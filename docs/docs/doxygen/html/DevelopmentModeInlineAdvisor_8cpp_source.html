<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: lib/Analysis/DevelopmentModeInlineAdvisor.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LLVM
   &#160;<span id="projectnumber">17.0.0git</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_a25db018342d3ae6c7e6779086c18378.html">Analysis</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">DevelopmentModeInlineAdvisor.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="DevelopmentModeInlineAdvisor_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- DevelopmentModeInlineAdvisor.cpp - runtime-loadable model runner  --===//</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// See https://llvm.org/LICENSE.txt for license information.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// This file implements a model runner using Tensorflow C APIs, allowing the</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// loading of a model from a command line option.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TensorSpec_8h.html">llvm/Analysis/TensorSpec.h</a>&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;llvm/Config/config.h&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#if defined(LLVM_HAVE_TFLITE)</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160; </div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BitVector_8h.html">llvm/ADT/BitVector.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CallGraph_8h.html">llvm/Analysis/CallGraph.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InlineSizeEstimatorAnalysis_8h.html">llvm/Analysis/InlineSizeEstimatorAnalysis.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MLInlineAdvisor_8h.html">llvm/Analysis/MLInlineAdvisor.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ModelUnderTrainingRunner_8h.html">llvm/Analysis/ModelUnderTrainingRunner.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="NoInferenceModelRunner_8h.html">llvm/Analysis/NoInferenceModelRunner.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TFUtils_8h.html">llvm/Analysis/Utils/TFUtils.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TrainingLogger_8h.html">llvm/Analysis/Utils/TrainingLogger.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="LLVMContext_8h.html">llvm/IR/LLVMContext.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CommandLine_8h.html">llvm/Support/CommandLine.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ManagedStatic_8h.html">llvm/Support/ManagedStatic.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160; </div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &lt;optional&gt;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160; </div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;std::string&gt;</a> TrainingLog(</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="stringliteral">&quot;training-log&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Path where the development - mode inlining log is saved.&quot;</span>));</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;std::string&gt;</a> TFModelUnderTrainingPath(</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="stringliteral">&quot;ml-inliner-model-under-training&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(R<span class="stringliteral">&quot;(Path to SavedModel from the previous training iteration.</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="stringliteral">The directory is also expected to contain a JSON specification of the </span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="stringliteral">outputs expected to be logged, where the first entry must be the </span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="stringliteral">inlining decision. The file containing the specification should be </span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="stringliteral">called output_spec.json. The expected JSON value is an array of </span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="stringliteral">dictionaries. Each dictionary should have 2 keys: </span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="stringliteral">- &quot;tensor_spec, followed by the TensorSpec description of the</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="stringliteral">output; and </span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="stringliteral">- &quot;logging_name&quot;, a string indicating the name to use when</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="stringliteral">logging the output values. </span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="stringliteral">Example:</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="stringliteral">[</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="stringliteral">  {</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="stringliteral">    &quot;logging_name&quot; : &quot;some_name&quot;, </span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="stringliteral">    &quot;tensor_spec&quot; : { </span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="stringliteral">      &quot;name&quot; : &quot;model_name&quot;, </span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="stringliteral">      &quot;port&quot; : 0,</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="stringliteral">      &quot;shape&quot; : [2, 3],</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="stringliteral">      &quot;type&quot; : &quot;float&quot;</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="stringliteral">      }</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="stringliteral">  }</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="stringliteral">]</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="stringliteral">The first value must always correspond to the decision.)&quot;));</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="stringliteral"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;std::string&gt;</a> TFOutputSpecOverride(</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="stringliteral">&quot;ml-inliner-output-spec-override&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Override the path to the output spec json file. See &quot;</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;             <span class="stringliteral">&quot;-ml-inliner-model-under-training documentation for the &quot;</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;             <span class="stringliteral">&quot;specification of that file.&quot;</span>));</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;std::string&gt;</a> TFFeedPrefix(<span class="stringliteral">&quot;ml-inliner-trained-model-feed-prefix&quot;</span>,</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                                         <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="stringliteral">&quot;action_&quot;</span>),</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                                         <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Prefix for feature names.&quot;</span>));</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">/// An InlineEvent, used by TrainingLogger.</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment"></span><span class="keyword">struct </span>InlineEvent {<span class="comment"></span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">  /// What the default policy&#39;s decision would have been.</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment"></span>  int64_t DefaultDecision = 0;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">  /// What we advised. When training off the default policy, this is the same as</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">  /// DefaultDecision.</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment"></span>  int64_t AdvisedDecision = 0;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">  /// What actually happened. This would be &#39;false&#39; in the case of an inline</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">  /// error, even if AdvisedDecision were true, otherwise it agrees with</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">  /// AdvisedDecision.</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> Effect = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">  /// What the change in size was: size_after - size_before</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment"></span>  int64_t Reward = 0;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;};</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">/// Collect data we may use for training a model.</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment"></span><span class="keyword">class </span>TrainingLogger final {</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  TrainingLogger(<a class="code" href="classllvm_1_1StringRef.html">StringRef</a> LogFileName, <span class="keyword">const</span> ModelUnderTrainingRunner *MUTR);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">  /// Log one inlining event.</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> logInlineEvent(<span class="keyword">const</span> InlineEvent &amp;Event,</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                      <span class="keyword">const</span> <a class="code" href="classllvm_1_1MLModelRunner.html">MLModelRunner</a> &amp;ModelRunner);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> LogFileName;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keyword">const</span> ModelUnderTrainingRunner *<span class="keyword">const</span> MUTR;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  std::unique_ptr&lt;Logger&gt; L;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <a class="code" href="classllvm_1_1BitVector.html">BitVector</a> Effects;<span class="comment"></span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">  /// Set these 2 clearly OOB, to make sure we set them later.</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment"></span>  <span class="keywordtype">size_t</span> DefaultDecisionPos = <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::numeric_limits&lt;size_t&gt;::max</a>();</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="keywordtype">size_t</span> DecisionPos = <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::numeric_limits&lt;size_t&gt;::max</a>();</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;};</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">/// An extension of the MLInlineAdvisor for the &#39;development&#39; mode, targeting</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">/// the offline training scenario. Note that training happens outside of the</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">/// compiler, this facility is concerned with producing training data (&quot;logs&quot;).</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">/// This InlineAdvisor can operate in the following modes:</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">/// 1) collect logs for the default policy. This is useful for bootstrapping</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">/// training, which will be considerably faster by starting from a reasonable</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">/// policy.</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">/// 2) collect logs for the ML policy, using a model from a previous</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">/// training. Potentially, that model uses internally some small random</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">/// perturbation of its weights, to induce exploration (setting this up is the</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">/// responsibility of the training algorithm). The logs would then be used to</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">/// retrain and improve on this model.</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">/// 3) use the provided model, with no logging. This is useful for end to end</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">/// validation - the model, in this case, is a release candidate and shouldn&#39;t</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">/// have random perturbations. It is a convenience feature: rather than needing</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">/// to take the release candidate model and compile it in &#39;release&#39; mode,</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">/// validate it, then potentially discard it, it&#39;s easier to just pass the model</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">/// to the compiler, albeit compilation would be slower, as a one-off. Once the</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">/// model behaves satisfactorily, it can be compiled AOT, for efficiency, in</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">/// release mode. The expectation is that a well-trained model provides a good</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">/// policy over a sufficiently diverse codebase, over many changes (i.e.</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">/// training happens seldom).</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment"></span><span class="keyword">class </span>DevelopmentModeMLInlineAdvisor : <span class="keyword">public</span> <a class="code" href="classllvm_1_1MLInlineAdvisor.html">MLInlineAdvisor</a> {</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  DevelopmentModeMLInlineAdvisor(</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      <a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M, <a class="code" href="classllvm_1_1AnalysisManager.html">ModuleAnalysisManager</a> &amp;<a class="code" href="PassBuilderBindings_8cpp.html#a85bddafa659a93a7a67c9094648259be">MAM</a>,</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      std::unique_ptr&lt;MLModelRunner&gt; ModelRunner,</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      <a class="code" href="MemDepPrinter_8cpp.html#a470d8721ad7c3b718e9daeabdaeb4700">std::function</a>&lt;<span class="keywordtype">bool</span>(<a class="code" href="classllvm_1_1CallBase.html">CallBase</a> &amp;)&gt; GetDefaultAdvice,</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      std::unique_ptr&lt;TrainingLogger&gt; <a class="code" href="classllvm_1_1Logger.html">Logger</a>);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160; </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="keywordtype">size_t</span> getTotalSizeEstimate();</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="keywordtype">void</span> updateNativeSizeEstimate(int64_t Change) {</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    *CurrentNativeSize += Change;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  }</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keywordtype">void</span> resetNativeSize(<a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <a class="code" href="classllvm_1_1PreservedAnalyses.html">PreservedAnalyses</a> PA = <a class="code" href="classllvm_1_1PreservedAnalyses.html#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    PA.<a class="code" href="classllvm_1_1PreservedAnalyses.html#ac8a842a601c470fa22db443ac34d0a67">abandon</a>&lt;<a class="code" href="classllvm_1_1InlineSizeEstimatorAnalysis.html">InlineSizeEstimatorAnalysis</a>&gt;();</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <a class="code" href="PassBuilderBindings_8cpp.html#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.<a class="code" href="classllvm_1_1AnalysisManager.html#a64b2a209a16bcd41375b5cae12690eaa">invalidate</a>(*<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, PA);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160; </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  std::unique_ptr&lt;MLInlineAdvice&gt;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  getAdviceFromModel(<a class="code" href="classllvm_1_1CallBase.html">CallBase</a> &amp;CB, <a class="code" href="classllvm_1_1OptimizationRemarkEmitter.html">OptimizationRemarkEmitter</a> &amp;ORE) <span class="keyword">override</span>;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  std::optional&lt;size_t&gt; getNativeSizeEstimate(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160; </div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="keywordtype">bool</span> isLogging()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> !!<a class="code" href="classllvm_1_1Logger.html">Logger</a>; }</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  std::unique_ptr&lt;MLInlineAdvice&gt; getMandatoryAdviceImpl(<a class="code" href="classllvm_1_1CallBase.html">CallBase</a> &amp;CB) <span class="keyword">override</span>;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160; </div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <a class="code" href="MemDepPrinter_8cpp.html#a470d8721ad7c3b718e9daeabdaeb4700">std::function</a>&lt;bool(<a class="code" href="classllvm_1_1CallBase.html">CallBase</a> &amp;)&gt; GetDefaultAdvice;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> IsDoingInference;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  std::unique_ptr&lt;TrainingLogger&gt; <a class="code" href="classllvm_1_1Logger.html">Logger</a>;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="keyword">const</span> std::optional&lt;int32_t&gt; InitialNativeSize;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  std::optional&lt;int32_t&gt; CurrentNativeSize;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;};</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">/// A variant of MLInlineAdvice that tracks all non-trivial inlining</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">/// decisions, for training/logging.</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment"></span><span class="keyword">class </span>LoggingMLInlineAdvice : <span class="keyword">public</span> <a class="code" href="classllvm_1_1MLInlineAdvice.html">MLInlineAdvice</a> {</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  LoggingMLInlineAdvice(DevelopmentModeMLInlineAdvisor *Advisor, <a class="code" href="classllvm_1_1CallBase.html">CallBase</a> &amp;CB,</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                        <a class="code" href="classllvm_1_1OptimizationRemarkEmitter.html">OptimizationRemarkEmitter</a> &amp;ORE, <span class="keywordtype">bool</span> Recommendation,</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                        TrainingLogger &amp;<a class="code" href="classllvm_1_1Logger.html">Logger</a>,</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                        std::optional&lt;size_t&gt; CallerSizeEstimateBefore,</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                        std::optional&lt;size_t&gt; CalleeSizeEstimateBefore,</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                        <span class="keywordtype">bool</span> DefaultDecision, <span class="keywordtype">bool</span> Mandatory = <span class="keyword">false</span>)</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      : <a class="code" href="classllvm_1_1MLInlineAdvice.html">MLInlineAdvice</a>(Advisor, CB, ORE, Recommendation), <a class="code" href="classllvm_1_1Logger.html">Logger</a>(<a class="code" href="classllvm_1_1Logger.html">Logger</a>),</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        CallerSizeEstimateBefore(CallerSizeEstimateBefore),</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        CalleeSizeEstimateBefore(CalleeSizeEstimateBefore),</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        DefaultDecision(DefaultDecision), Mandatory(Mandatory) {}</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160; </div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="keyword">virtual</span> ~LoggingMLInlineAdvice() = <span class="keywordflow">default</span>;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  DevelopmentModeMLInlineAdvisor *getAdvisor()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>DevelopmentModeMLInlineAdvisor *<span class="keyword">&gt;</span>(Advisor);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="keywordtype">void</span> recordInliningImpl()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <a class="code" href="classllvm_1_1MLInlineAdvice.html#a79fede4389dbc2b630710e3c09787a20">MLInlineAdvice::recordInliningImpl</a>();</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    getAdvisor()-&gt;resetNativeSize(Caller);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="keywordtype">int</span> Reward = <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::numeric_limits&lt;int&gt;::max</a>();</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1InlineSizeEstimatorAnalysis.html#af2afe642df2ccb614a3f8a1d80910df9">InlineSizeEstimatorAnalysis::isEvaluatorRequested</a>() &amp;&amp;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        !getAdvisor()-&gt;isForcedToStop()) {</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      <span class="keywordtype">int</span> NativeSizeAfter = *getAdvisor()-&gt;getNativeSizeEstimate(*Caller) +</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                            *CalleeSizeEstimateBefore;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      Reward = NativeSizeAfter -</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;               (*CallerSizeEstimateBefore + *CalleeSizeEstimateBefore);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      getAdvisor()-&gt;updateNativeSizeEstimate(Reward);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    }</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    log(Reward, <span class="comment">/*Success=*/</span><span class="keyword">true</span>);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="keywordtype">void</span> recordInliningWithCalleeDeletedImpl()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <a class="code" href="classllvm_1_1MLInlineAdvice.html#af08e89bee7499bc47dbc39d981c5c436">MLInlineAdvice::recordInliningWithCalleeDeletedImpl</a>();</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    getAdvisor()-&gt;resetNativeSize(Caller);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1InlineSizeEstimatorAnalysis.html#af2afe642df2ccb614a3f8a1d80910df9">InlineSizeEstimatorAnalysis::isEvaluatorRequested</a>() &amp;&amp;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        !getAdvisor()-&gt;isForcedToStop()) {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      <span class="keywordtype">int</span> NativeSizeAfter = *getAdvisor()-&gt;getNativeSizeEstimate(*Caller);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      <span class="keywordtype">int</span> Reward = NativeSizeAfter -</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                   (*CallerSizeEstimateBefore + *CalleeSizeEstimateBefore);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      getAdvisor()-&gt;updateNativeSizeEstimate(Reward);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      log(Reward, <span class="comment">/*Success=*/</span><span class="keyword">true</span>);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      log(NoReward, <span class="comment">/*Success=*/</span><span class="keyword">true</span>);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    }</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  }</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160; </div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <span class="keywordtype">void</span> recordUnsuccessfulInliningImpl(<span class="keyword">const</span> <a class="code" href="classllvm_1_1InlineResult.html">InlineResult</a> &amp;Result)<span class="keyword"> override </span>{</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <a class="code" href="classllvm_1_1MLInlineAdvice.html#ac725e56738dcc1fc8de94a7554491456">MLInlineAdvice::recordUnsuccessfulInliningImpl</a>(Result);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    log(NoReward, <span class="comment">/*Success=*/</span><span class="keyword">false</span>);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  }</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160; </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="keywordtype">void</span> recordUnattemptedInliningImpl()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <a class="code" href="classllvm_1_1MLInlineAdvice.html#afab4dde8e888e2564c2108a9c149f12d">MLInlineAdvice::recordUnattemptedInliningImpl</a>();</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    log(NoReward, <span class="comment">/*Success=*/</span><span class="keyword">false</span>);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keywordtype">void</span> log(int64_t Reward, <span class="keywordtype">bool</span> <a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a>) {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">if</span> (Mandatory)</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    InlineEvent Event;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    Event.AdvisedDecision = isInliningRecommended();</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    Event.DefaultDecision = DefaultDecision;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    Event.Effect = <a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a>;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    Event.Reward = Reward;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <a class="code" href="classllvm_1_1Logger.html">Logger</a>.logInlineEvent(Event, getAdvisor()-&gt;getModelRunner());</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160; </div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> int64_t NoReward = 0;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  TrainingLogger &amp;<a class="code" href="classllvm_1_1Logger.html">Logger</a>;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  <span class="keyword">const</span> std::optional&lt;size_t&gt; CallerSizeEstimateBefore;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <span class="keyword">const</span> std::optional&lt;size_t&gt; CalleeSizeEstimateBefore;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="keyword">const</span> int64_t DefaultDecision;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="keyword">const</span> int64_t Mandatory;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;};</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160; </div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> std::vector&lt;TensorSpec&gt; TrainingOnlyFeatures{</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    TensorSpec::createSpec&lt;int64_t&gt;(TFFeedPrefix + <span class="stringliteral">&quot;inlining_default&quot;</span>, {1}),</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    TensorSpec::createSpec&lt;float&gt;(TFFeedPrefix + <span class="stringliteral">&quot;discount&quot;</span>, {1}),</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    TensorSpec::createSpec&lt;float&gt;(TFFeedPrefix + <span class="stringliteral">&quot;reward&quot;</span>, {1}),</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    TensorSpec::createSpec&lt;int32_t&gt;(TFFeedPrefix + <span class="stringliteral">&quot;step_type&quot;</span>, {1})};</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160; </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> std::vector&lt;TensorSpec&gt; getInputFeatures() {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  std::vector&lt;TensorSpec&gt; InputSpecs;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="namespacellvm.html#a299d467a34db1328efc3b8279e1f435f">NumberOfFeatures</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    InputSpecs.push_back(TensorSpec::createSpec&lt;int64_t&gt;(</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        TFFeedPrefix + <a class="code" href="namespacellvm.html#a8ac326bbf3910d5f456f0b3bbf8de06f">FeatureMap</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].name(), <a class="code" href="namespacellvm.html#a8ac326bbf3910d5f456f0b3bbf8de06f">FeatureMap</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].shape()));</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <a class="code" href="namespacellvm.html#a39d3d23a084c4544ee5903203db10e8a">append_range</a>(InputSpecs, TrainingOnlyFeatures);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="keywordflow">return</span> InputSpecs;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;}</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160; </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;} <span class="comment">// namespace</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160; </div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;TrainingLogger::TrainingLogger(<a class="code" href="classllvm_1_1StringRef.html">StringRef</a> LogFileName,</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                               <span class="keyword">const</span> ModelUnderTrainingRunner *MUTR)</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    : LogFileName(LogFileName), MUTR(MUTR) {</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <span class="comment">// The first output is the inlining decision.</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  std::vector&lt;TensorSpec&gt; FT(<a class="code" href="namespacellvm.html#a8ac326bbf3910d5f456f0b3bbf8de06f">FeatureMap</a>.begin(), <a class="code" href="namespacellvm.html#a8ac326bbf3910d5f456f0b3bbf8de06f">FeatureMap</a>.end());</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160; </div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordflow">if</span> (MUTR)</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <a class="code" href="namespacellvm.html#a39d3d23a084c4544ee5903203db10e8a">append_range</a>(FT, MUTR-&gt;extraOutputsForLoggingSpecs());</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160; </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  DefaultDecisionPos = FT.size();</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  FT.push_back(TensorSpec::createSpec&lt;int64_t&gt;(<a class="code" href="namespacellvm.html#a09f08b747caff737ade6a58ada02d2bf">DefaultDecisionName</a>, {1}));</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160; </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  DecisionPos = FT.size();</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  FT.push_back(<a class="code" href="namespacellvm.html#aa22d2826f4a9ac07e8c53cad3f0178a6">InlineDecisionSpec</a>);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  std::error_code <a class="code" href="namespacellvm_1_1codeview.html#a2e1cbb0e2bd7a35ed99c31853dc45374a3fd6b696867d70225deda7868308679b">EC</a>;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="keyword">auto</span> <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> = std::make_unique&lt;raw_fd_ostream&gt;(TrainingLog, EC);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="keywordflow">if</span> (EC)</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; (<a class="code" href="namespacellvm_1_1codeview.html#a2e1cbb0e2bd7a35ed99c31853dc45374a3fd6b696867d70225deda7868308679b">EC</a>.message() + <span class="stringliteral">&quot;:&quot;</span> + TrainingLog);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160; </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  L = std::make_unique&lt;Logger&gt;(</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      <a class="code" href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">std::move</a>(<a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>), FT, TensorSpec::createSpec&lt;int64_t&gt;(<a class="code" href="namespacellvm.html#aa497b131be7719a15bde7cb3192d9bf8">RewardName</a>, {1}),</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      InlineSizeEstimatorAnalysis::isEvaluatorRequested());</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  L-&gt;switchContext(<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;}</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">/// Log one inlining event.</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> TrainingLogger::logInlineEvent(<span class="keyword">const</span> InlineEvent &amp;Event,</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                                    <span class="keyword">const</span> <a class="code" href="classllvm_1_1MLModelRunner.html">MLModelRunner</a> &amp;ModelRunner) {</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  L-&gt;startObservation();</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="keywordtype">size_t</span> CurrentFeature = 0;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="keywordflow">for</span> (; CurrentFeature &lt; <a class="code" href="namespacellvm.html#a299d467a34db1328efc3b8279e1f435f">NumberOfFeatures</a>; ++CurrentFeature)</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    L-&gt;logTensorValue(CurrentFeature,</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                      <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                          ModelRunner.<a class="code" href="classllvm_1_1MLModelRunner.html#a92c33ecc1d501bad3cd2058937ae567f">getTensorUntyped</a>(CurrentFeature)));</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160; </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="keywordflow">if</span> (MUTR)</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; MUTR-&gt;extraOutputsForLoggingSpecs().<a class="code" href="lib_2Target_2README_8txt.html#a02def7c594e9f19ff247ed0bf33d1c30">size</a>(); ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *RawData =</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;          <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(MUTR-&gt;getUntypedExtraOutputValue(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      L-&gt;logTensorValue(CurrentFeature, RawData);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      ++CurrentFeature;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    }</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CurrentFeature == DefaultDecisionPos);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  L-&gt;logTensorValue(DefaultDecisionPos,</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                    <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(&amp;Event.DefaultDecision));</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  L-&gt;logTensorValue(DecisionPos,</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                    <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(&amp;Event.AdvisedDecision));</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  L-&gt;endObservation();</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="keywordflow">if</span> (InlineSizeEstimatorAnalysis::isEvaluatorRequested())</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    L-&gt;logReward(Event.Reward);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="comment">// For debugging / later use</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  Effects.push_back(Event.Effect);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;}</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160; </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;DevelopmentModeMLInlineAdvisor::DevelopmentModeMLInlineAdvisor(</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, <a class="code" href="classllvm_1_1AnalysisManager.html">ModuleAnalysisManager</a> &amp;<a class="code" href="PassBuilderBindings_8cpp.html#a85bddafa659a93a7a67c9094648259be">MAM</a>,</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    std::unique_ptr&lt;MLModelRunner&gt; ModelRunner,</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <a class="code" href="MemDepPrinter_8cpp.html#a470d8721ad7c3b718e9daeabdaeb4700">std::function</a>&lt;<span class="keywordtype">bool</span>(<a class="code" href="classllvm_1_1CallBase.html">CallBase</a> &amp;)&gt; GetDefaultAdvice,</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    std::unique_ptr&lt;TrainingLogger&gt; <a class="code" href="classllvm_1_1Logger.html">Logger</a>)</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    : <a class="code" href="classllvm_1_1MLInlineAdvisor.html">MLInlineAdvisor</a>(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, <a class="code" href="PassBuilderBindings_8cpp.html#a85bddafa659a93a7a67c9094648259be">MAM</a>, <a class="code" href="namespacestd.html">std</a>::<a class="code" href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">move</a>(ModelRunner)),</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      GetDefaultAdvice(GetDefaultAdvice),</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      IsDoingInference(<a class="code" href="namespacellvm.html#a92ca992e52dddc420f4b069cae06dfbe">isa</a>&lt;ModelUnderTrainingRunner&gt;(getModelRunner())),</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      <a class="code" href="classllvm_1_1Logger.html">Logger</a>(<a class="code" href="namespacestd.html">std</a>::<a class="code" href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">move</a>(<a class="code" href="classllvm_1_1Logger.html">Logger</a>)),</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      InitialNativeSize(isLogging() ? getTotalSizeEstimate() : 0),</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      CurrentNativeSize(InitialNativeSize) {</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="comment">// We cannot have the case of neither inference nor logging.</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IsDoingInference || isLogging());</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;}</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160; </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;std::optional&lt;size_t&gt;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;DevelopmentModeMLInlineAdvisor::getNativeSizeEstimate(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="keywordflow">if</span> (!InlineSizeEstimatorAnalysis::isEvaluatorRequested())</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="keyword">auto</span> &amp;<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a> =</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      <a class="code" href="PassBuilderBindings_8cpp.html#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.<a class="code" href="classllvm_1_1AnalysisManager.html#ab9d3d5412c20747fd0110a046604f09a">getResult</a>&lt;<a class="code" href="classllvm_1_1InlineSizeEstimatorAnalysis.html">InlineSizeEstimatorAnalysis</a>&gt;(<span class="keyword">const_cast&lt;</span><a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<span class="keyword">&gt;</span>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>));</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>) {</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getParent()-&gt;getContext().emitError(</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <span class="stringliteral">&quot;Native size estimator is not present.&quot;</span>);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  }</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="keywordflow">return</span> *<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;}</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;std::unique_ptr&lt;MLInlineAdvice&gt;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;DevelopmentModeMLInlineAdvisor::getMandatoryAdviceImpl(<a class="code" href="classllvm_1_1CallBase.html">CallBase</a> &amp;CB) {</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="keywordflow">return</span> std::make_unique&lt;LoggingMLInlineAdvice&gt;(</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      <span class="comment">/*Advisor=*/</span><span class="keyword">this</span>,</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      <span class="comment">/*CB=*/</span>CB, <span class="comment">/*ORE=*/</span>getCallerORE(CB), <span class="comment">/*Recommendation=*/</span><span class="keyword">true</span>,</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <span class="comment">/*Logger=*/</span>*<a class="code" href="classllvm_1_1Logger.html">Logger</a>,</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      <span class="comment">/*CallerSizeEstimateBefore=*/</span>getNativeSizeEstimate(*CB.<a class="code" href="classllvm_1_1CallBase.html#afac5b39bcbb90d660f83d9b4bd8c6d95">getCaller</a>()),</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      <span class="comment">/*CalleeSizeEstimateBefore=*/</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      getNativeSizeEstimate(*CB.<a class="code" href="classllvm_1_1CallBase.html#a83b8c9e572130f403445c0b0f69b837c">getCalledFunction</a>()),</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <span class="comment">/*DefaultDecision=*/</span><span class="keyword">true</span>, <span class="comment">/*Mandatory*/</span> <span class="keyword">true</span>);</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;}</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160; </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;std::unique_ptr&lt;MLInlineAdvice&gt;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;DevelopmentModeMLInlineAdvisor::getAdviceFromModel(</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <a class="code" href="classllvm_1_1CallBase.html">CallBase</a> &amp;CB, <a class="code" href="classllvm_1_1OptimizationRemarkEmitter.html">OptimizationRemarkEmitter</a> &amp;ORE) {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <span class="keywordflow">if</span> (IsDoingInference &amp;&amp; !isLogging())</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordflow">return</span> MLInlineAdvisor::getAdviceFromModel(CB, ORE);</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160; </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <span class="keywordtype">bool</span> DefaultAdvice = GetDefaultAdvice(CB);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="keyword">auto</span> Recommendation =</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      IsDoingInference ? <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(ModelRunner-&gt;evaluate&lt;int64_t&gt;())</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                       : DefaultAdvice;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="keywordflow">return</span> std::make_unique&lt;LoggingMLInlineAdvice&gt;(</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      <span class="comment">/*Advisor=*/</span><span class="keyword">this</span>,</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      <span class="comment">/*CB=*/</span>CB, <span class="comment">/*ORE=*/</span>ORE, <span class="comment">/*Recommendation=*/</span>Recommendation,</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      <span class="comment">/*Logger=*/</span>*<a class="code" href="classllvm_1_1Logger.html">Logger</a>,</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      <span class="comment">/*CallerSizeEstimateBefore=*/</span>getNativeSizeEstimate(*CB.<a class="code" href="classllvm_1_1CallBase.html#afac5b39bcbb90d660f83d9b4bd8c6d95">getCaller</a>()),</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      <span class="comment">/*CalleeSizeEstimateBefore=*/</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      getNativeSizeEstimate(*CB.<a class="code" href="classllvm_1_1CallBase.html#a83b8c9e572130f403445c0b0f69b837c">getCalledFunction</a>()),</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <span class="comment">/*DefaultDecision=*/</span>DefaultAdvice);</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;}</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160; </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="keywordtype">size_t</span> DevelopmentModeMLInlineAdvisor::getTotalSizeEstimate() {</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="keywordflow">if</span> (!InlineSizeEstimatorAnalysis::isEvaluatorRequested())</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba366e1eac31eeb1a1892d62ccfc0c8cf8">Ret</a> = 0;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>) {</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.isDeclaration())</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba366e1eac31eeb1a1892d62ccfc0c8cf8">Ret</a> += *getNativeSizeEstimate(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  }</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba366e1eac31eeb1a1892d62ccfc0c8cf8">Ret</a>;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;}</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160; </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;std::unique_ptr&lt;InlineAdvisor&gt; <a class="code" href="namespacellvm.html#a3e7019a12915e2ed3b5ae8d64eb5256b">llvm::getDevelopmentModeAdvisor</a>(</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, <a class="code" href="classllvm_1_1AnalysisManager.html">ModuleAnalysisManager</a> &amp;<a class="code" href="PassBuilderBindings_8cpp.html#a85bddafa659a93a7a67c9094648259be">MAM</a>,</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <a class="code" href="MemDepPrinter_8cpp.html#a470d8721ad7c3b718e9daeabdaeb4700">std::function</a>&lt;<span class="keywordtype">bool</span>(<a class="code" href="classllvm_1_1CallBase.html">CallBase</a> &amp;)&gt; GetDefaultAdvice) {</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  <span class="keyword">auto</span> &amp;Ctx = <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.getContext();</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  std::unique_ptr&lt;MLModelRunner&gt; Runner;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <span class="keywordflow">if</span> (TFModelUnderTrainingPath.empty())</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    Runner.reset(<span class="keyword">new</span> <a class="code" href="classllvm_1_1NoInferenceModelRunner.html">NoInferenceModelRunner</a>(Ctx, getInputFeatures()));</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    Runner = ModelUnderTrainingRunner::createAndEnsureValid(</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        Ctx, TFModelUnderTrainingPath, <a class="code" href="MLRegallocEvictAdvisor_8cpp.html#af5e2460c58b78f9becd283f9f0dc70ee">DecisionName</a>, getInputFeatures(),</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        TFOutputSpecOverride);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <span class="keywordflow">if</span> (!Runner)</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  std::unique_ptr&lt;TrainingLogger&gt; <a class="code" href="classllvm_1_1Logger.html">Logger</a>;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <span class="keywordflow">if</span> (!TrainingLog.empty())</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <a class="code" href="classllvm_1_1Logger.html">Logger</a> = std::make_unique&lt;TrainingLogger&gt;(</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        TrainingLog, dyn_cast&lt;ModelUnderTrainingRunner&gt;(Runner.get()));</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160; </div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="keywordflow">return</span> std::make_unique&lt;DevelopmentModeMLInlineAdvisor&gt;(</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, <a class="code" href="PassBuilderBindings_8cpp.html#a85bddafa659a93a7a67c9094648259be">MAM</a>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">std::move</a>(Runner), GetDefaultAdvice, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">std::move</a>(<a class="code" href="classllvm_1_1Logger.html">Logger</a>));</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;}</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="preprocessor">#endif // defined(LLVM_HAVE_TFLITE)</span></div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="aclassllvm_1_1PreservedAnalyses_html"><div class="ttname"><a href="classllvm_1_1PreservedAnalyses.html">llvm::PreservedAnalyses</a></div><div class="ttdoc">A set of analyses that are preserved following a run of a transformation pass.</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00152">PassManager.h:152</a></div></div>
<div class="ttc" id="aNoInferenceModelRunner_8h_html"><div class="ttname"><a href="NoInferenceModelRunner_8h.html">NoInferenceModelRunner.h</a></div></div>
<div class="ttc" id="aTFUtils_8h_html"><div class="ttname"><a href="TFUtils_8h.html">TFUtils.h</a></div></div>
<div class="ttc" id="anamespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">This is an optimization pass for GlobalISel generic memory operations.</div><div class="ttdef"><b>Definition:</b> <a href="AddressRanges_8h_source.html#l00018">AddressRanges.h:18</a></div></div>
<div class="ttc" id="aclassllvm_1_1InlineSizeEstimatorAnalysis_html_af2afe642df2ccb614a3f8a1d80910df9"><div class="ttname"><a href="classllvm_1_1InlineSizeEstimatorAnalysis.html#af2afe642df2ccb614a3f8a1d80910df9">llvm::InlineSizeEstimatorAnalysis::isEvaluatorRequested</a></div><div class="ttdeci">static bool isEvaluatorRequested()</div><div class="ttdef"><b>Definition:</b> <a href="InlineSizeEstimatorAnalysis_8cpp_source.html#l00272">InlineSizeEstimatorAnalysis.cpp:272</a></div></div>
<div class="ttc" id="alib_2Target_2X86_2README_8txt_html_ac88fe1d3a61b056a4f64fbbb156a62ff"><div class="ttname"><a href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a></div><div class="ttdeci">We currently emits eax Perhaps this is what we really should generate is Is imull three or four cycles eax eax The current instruction priority is based on pattern complexity The former is more complex because it folds a load so the latter will not be emitted Perhaps we should use AddedComplexity to give LEA32r a higher priority We should always try to match LEA first since the LEA matching code does some estimate to determine whether the match is profitable if we care more about code then imull is better It s two bytes shorter than movl leal On a Pentium M</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2X86_2README_8txt_source.html#l00252">README.txt:252</a></div></div>
<div class="ttc" id="aclassllvm_1_1MLModelRunner_html_a92c33ecc1d501bad3cd2058937ae567f"><div class="ttname"><a href="classllvm_1_1MLModelRunner.html#a92c33ecc1d501bad3cd2058937ae567f">llvm::MLModelRunner::getTensorUntyped</a></div><div class="ttdeci">void * getTensorUntyped(size_t Index)</div><div class="ttdef"><b>Definition:</b> <a href="MLModelRunner_8h_source.html#l00045">MLModelRunner.h:45</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisManager_html_ab9d3d5412c20747fd0110a046604f09a"><div class="ttname"><a href="classllvm_1_1AnalysisManager.html#ab9d3d5412c20747fd0110a046604f09a">llvm::AnalysisManager::getResult</a></div><div class="ttdeci">PassT::Result &amp; getResult(IRUnitT &amp;IR, ExtraArgTs... ExtraArgs)</div><div class="ttdoc">Get the result of an analysis pass for a given IR unit.</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00774">PassManager.h:774</a></div></div>
<div class="ttc" id="anamespacellvm_html_a92ca992e52dddc420f4b069cae06dfbe"><div class="ttname"><a href="namespacellvm.html#a92ca992e52dddc420f4b069cae06dfbe">llvm::isa</a></div><div class="ttdeci">bool isa(const From &amp;Val)</div><div class="ttdoc">isa&lt;X&gt; - Return true if the parameter to the template is an instance of one of the template type argu...</div><div class="ttdef"><b>Definition:</b> <a href="Casting_8h_source.html#l00549">Casting.h:549</a></div></div>
<div class="ttc" id="aclassllvm_1_1Function_html"><div class="ttname"><a href="classllvm_1_1Function.html">llvm::Function</a></div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00059">Function.h:59</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisManager_html_a64b2a209a16bcd41375b5cae12690eaa"><div class="ttname"><a href="classllvm_1_1AnalysisManager.html#a64b2a209a16bcd41375b5cae12690eaa">llvm::AnalysisManager::invalidate</a></div><div class="ttdeci">void invalidate(IRUnitT &amp;IR, const PreservedAnalyses &amp;PA)</div><div class="ttdoc">Invalidate cached analyses for an IR unit.</div><div class="ttdef"><b>Definition:</b> <a href="PassManagerImpl_8h_source.html#l00089">PassManagerImpl.h:89</a></div></div>
<div class="ttc" id="aTensorSpec_8h_html"><div class="ttname"><a href="TensorSpec_8h.html">TensorSpec.h</a></div></div>
<div class="ttc" id="aManagedStatic_8h_html"><div class="ttname"><a href="ManagedStatic_8h.html">ManagedStatic.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1PreservedAnalyses_html_ac8a842a601c470fa22db443ac34d0a67"><div class="ttname"><a href="classllvm_1_1PreservedAnalyses.html#ac8a842a601c470fa22db443ac34d0a67">llvm::PreservedAnalyses::abandon</a></div><div class="ttdeci">void abandon()</div><div class="ttdoc">Mark an analysis as abandoned.</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00206">PassManager.h:206</a></div></div>
<div class="ttc" id="aPassBuilderBindings_8cpp_html_a83c7e5ca51099e4efa895791a02fb0ed"><div class="ttname"><a href="PassBuilderBindings_8cpp.html#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a></div><div class="ttdeci">FunctionAnalysisManager FAM</div><div class="ttdef"><b>Definition:</b> <a href="PassBuilderBindings_8cpp_source.html#l00059">PassBuilderBindings.cpp:59</a></div></div>
<div class="ttc" id="anamespacellvm_1_1cl_html_a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6"><div class="ttname"><a href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">llvm::cl::Hidden</a></div><div class="ttdeci">@ Hidden</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00138">CommandLine.h:138</a></div></div>
<div class="ttc" id="aMLRegallocEvictAdvisor_8cpp_html_af5e2460c58b78f9becd283f9f0dc70ee"><div class="ttname"><a href="MLRegallocEvictAdvisor_8cpp.html#af5e2460c58b78f9becd283f9f0dc70ee">DecisionName</a></div><div class="ttdeci">#define DecisionName</div></div>
<div class="ttc" id="anamespacellvm_html_ab4d4bc901fedd8857f647dcc2c0d71de"><div class="ttname"><a href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">llvm::max</a></div><div class="ttdeci">Expected&lt; ExpressionValue &gt; max(const ExpressionValue &amp;Lhs, const ExpressionValue &amp;Rhs)</div><div class="ttdef"><b>Definition:</b> <a href="FileCheck_8cpp_source.html#l00337">FileCheck.cpp:337</a></div></div>
<div class="ttc" id="anamespacellvm_1_1MipsISD_html_a422daf9aa810935178671306b651d69ba366e1eac31eeb1a1892d62ccfc0c8cf8"><div class="ttname"><a href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba366e1eac31eeb1a1892d62ccfc0c8cf8">llvm::MipsISD::Ret</a></div><div class="ttdeci">@ Ret</div><div class="ttdef"><b>Definition:</b> <a href="MipsISelLowering_8h_source.html#l00119">MipsISelLowering.h:119</a></div></div>
<div class="ttc" id="aModelUnderTrainingRunner_8h_html"><div class="ttname"><a href="ModelUnderTrainingRunner_8h.html">ModelUnderTrainingRunner.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_aa22d2826f4a9ac07e8c53cad3f0178a6"><div class="ttname"><a href="namespacellvm.html#aa22d2826f4a9ac07e8c53cad3f0178a6">llvm::InlineDecisionSpec</a></div><div class="ttdeci">const TensorSpec InlineDecisionSpec</div><div class="ttdef"><b>Definition:</b> <a href="MLInlineAdvisor_8cpp_source.html#l00096">MLInlineAdvisor.cpp:96</a></div></div>
<div class="ttc" id="aclassllvm_1_1MLInlineAdvice_html_a79fede4389dbc2b630710e3c09787a20"><div class="ttname"><a href="classllvm_1_1MLInlineAdvice.html#a79fede4389dbc2b630710e3c09787a20">llvm::MLInlineAdvice::recordInliningImpl</a></div><div class="ttdeci">void recordInliningImpl() override</div><div class="ttdef"><b>Definition:</b> <a href="MLInlineAdvisor_8cpp_source.html#l00476">MLInlineAdvisor.cpp:476</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_a96d73bbd7af15cb1fc38c3f4a3bd82e9"><div class="ttname"><a href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a></div><div class="ttdeci">#define F(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00055">MD5.cpp:55</a></div></div>
<div class="ttc" id="anamespacellvm_1_1RISCVFenceField_html_a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731"><div class="ttname"><a href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">llvm::RISCVFenceField::R</a></div><div class="ttdeci">@ R</div><div class="ttdef"><b>Definition:</b> <a href="RISCVBaseInfo_8h_source.html#l00278">RISCVBaseInfo.h:278</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7c46c742c31be54870e2038048e6b391"><div class="ttname"><a href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">llvm::dbgs</a></div><div class="ttdeci">raw_ostream &amp; dbgs()</div><div class="ttdoc">dbgs() - This returns a reference to a raw_ostream for debugging messages.</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8cpp_source.html#l00163">Debug.cpp:163</a></div></div>
<div class="ttc" id="aCommandLine_8h_html"><div class="ttname"><a href="CommandLine_8h.html">CommandLine.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1MLInlineAdvice_html_af08e89bee7499bc47dbc39d981c5c436"><div class="ttname"><a href="classllvm_1_1MLInlineAdvice.html#af08e89bee7499bc47dbc39d981c5c436">llvm::MLInlineAdvice::recordInliningWithCalleeDeletedImpl</a></div><div class="ttdeci">void recordInliningWithCalleeDeletedImpl() override</div><div class="ttdef"><b>Definition:</b> <a href="MLInlineAdvisor_8cpp_source.html#l00485">MLInlineAdvisor.cpp:485</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_a83b8c9e572130f403445c0b0f69b837c"><div class="ttname"><a href="classllvm_1_1CallBase.html#a83b8c9e572130f403445c0b0f69b837c">llvm::CallBase::getCalledFunction</a></div><div class="ttdeci">Function * getCalledFunction() const</div><div class="ttdoc">Returns the function called, or null if this is an indirect function invocation or the function signa...</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01406">InstrTypes.h:1406</a></div></div>
<div class="ttc" id="aPassBuilderBindings_8cpp_html_a85bddafa659a93a7a67c9094648259be"><div class="ttname"><a href="PassBuilderBindings_8cpp.html#a85bddafa659a93a7a67c9094648259be">MAM</a></div><div class="ttdeci">ModuleAnalysisManager MAM</div><div class="ttdef"><b>Definition:</b> <a href="PassBuilderBindings_8cpp_source.html#l00061">PassBuilderBindings.cpp:61</a></div></div>
<div class="ttc" id="aclassllvm_1_1MLInlineAdvice_html_ac725e56738dcc1fc8de94a7554491456"><div class="ttname"><a href="classllvm_1_1MLInlineAdvice.html#ac725e56738dcc1fc8de94a7554491456">llvm::MLInlineAdvice::recordUnsuccessfulInliningImpl</a></div><div class="ttdeci">void recordUnsuccessfulInliningImpl(const InlineResult &amp;Result) override</div><div class="ttdef"><b>Definition:</b> <a href="MLInlineAdvisor_8cpp_source.html#l00495">MLInlineAdvisor.cpp:495</a></div></div>
<div class="ttc" id="anamespacellvm_html_a09f08b747caff737ade6a58ada02d2bf"><div class="ttname"><a href="namespacellvm.html#a09f08b747caff737ade6a58ada02d2bf">llvm::DefaultDecisionName</a></div><div class="ttdeci">const char *const DefaultDecisionName</div><div class="ttdef"><b>Definition:</b> <a href="MLInlineAdvisor_8cpp_source.html#l00098">MLInlineAdvisor.cpp:98</a></div></div>
<div class="ttc" id="aBitVector_8h_html"><div class="ttname"><a href="BitVector_8h.html">BitVector.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1BitVector_html"><div class="ttname"><a href="classllvm_1_1BitVector.html">llvm::BitVector</a></div><div class="ttdef"><b>Definition:</b> <a href="BitVector_8h_source.html#l00075">BitVector.h:75</a></div></div>
<div class="ttc" id="aclassllvm_1_1NoInferenceModelRunner_html"><div class="ttname"><a href="classllvm_1_1NoInferenceModelRunner.html">llvm::NoInferenceModelRunner</a></div><div class="ttdoc">A pseudo model runner.</div><div class="ttdef"><b>Definition:</b> <a href="NoInferenceModelRunner_8h_source.html#l00020">NoInferenceModelRunner.h:20</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_afac5b39bcbb90d660f83d9b4bd8c6d95"><div class="ttname"><a href="classllvm_1_1CallBase.html#afac5b39bcbb90d660f83d9b4bd8c6d95">llvm::CallBase::getCaller</a></div><div class="ttdeci">Function * getCaller()</div><div class="ttdoc">Helper to get the caller (the parent function).</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l00293">Instructions.cpp:293</a></div></div>
<div class="ttc" id="aclassllvm_1_1cl_1_1opt_html"><div class="ttname"><a href="classllvm_1_1cl_1_1opt.html">llvm::cl::opt</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l01410">CommandLine.h:1410</a></div></div>
<div class="ttc" id="aInlineSizeEstimatorAnalysis_8h_html"><div class="ttname"><a href="InlineSizeEstimatorAnalysis_8h.html">InlineSizeEstimatorAnalysis.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1InlineSizeEstimatorAnalysis_html"><div class="ttname"><a href="classllvm_1_1InlineSizeEstimatorAnalysis.html">llvm::InlineSizeEstimatorAnalysis</a></div><div class="ttdef"><b>Definition:</b> <a href="InlineSizeEstimatorAnalysis_8h_source.html#l00019">InlineSizeEstimatorAnalysis.h:19</a></div></div>
<div class="ttc" id="alib_2Target_2ARM_2README_8txt_html_ad3a99906764c35b2694ae90fa57744a5"><div class="ttname"><a href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">move</a></div><div class="ttdeci">compiles ldr LCPI1_0 ldr ldr mov lsr tst moveq r1 ldr LCPI1_1 and r0 bx lr It would be better to do something like to fold the shift into the conditional move</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2ARM_2README_8txt_source.html#l00546">README.txt:546</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00058">MD5.cpp:58</a></div></div>
<div class="ttc" id="anamespacellvm_1_1cl_html_a10a041239ae1870cfcc064bfaa79fb65"><div class="ttname"><a href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">llvm::cl::init</a></div><div class="ttdeci">initializer&lt; Ty &gt; init(const Ty &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00445">CommandLine.h:445</a></div></div>
<div class="ttc" id="alib_2Target_2README_8txt_html_a02def7c594e9f19ff247ed0bf33d1c30"><div class="ttname"><a href="lib_2Target_2README_8txt.html#a02def7c594e9f19ff247ed0bf33d1c30">size</a></div><div class="ttdeci">i&lt; reg-&gt; size</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2README_8txt_source.html#l00166">README.txt:166</a></div></div>
<div class="ttc" id="aSILowerControlFlow_8cpp_html_a4868c5d81c5ccc98c47aeab6244346a0"><div class="ttname"><a href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a></div><div class="ttdeci">assert(ImpDefSCC.getReg()==AMDGPU::SCC &amp;&amp;ImpDefSCC.isDef())</div></div>
<div class="ttc" id="anamespacellvm_1_1codeview_html_a2e1cbb0e2bd7a35ed99c31853dc45374a3fd6b696867d70225deda7868308679b"><div class="ttname"><a href="namespacellvm_1_1codeview.html#a2e1cbb0e2bd7a35ed99c31853dc45374a3fd6b696867d70225deda7868308679b">llvm::codeview::CompileSym2Flags::EC</a></div><div class="ttdeci">@ EC</div></div>
<div class="ttc" id="aMemDepPrinter_8cpp_html_a470d8721ad7c3b718e9daeabdaeb4700"><div class="ttname"><a href="MemDepPrinter_8cpp.html#a470d8721ad7c3b718e9daeabdaeb4700">function</a></div><div class="ttdeci">print Print MemDeps of function</div><div class="ttdef"><b>Definition:</b> <a href="MemDepPrinter_8cpp_source.html#l00082">MemDepPrinter.cpp:82</a></div></div>
<div class="ttc" id="aclassllvm_1_1Module_html"><div class="ttname"><a href="classllvm_1_1Module.html">llvm::Module</a></div><div class="ttdoc">A Module instance is used to store all the information related to an LLVM module.</div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00065">Module.h:65</a></div></div>
<div class="ttc" id="aclassllvm_1_1OptimizationRemarkEmitter_html"><div class="ttname"><a href="classllvm_1_1OptimizationRemarkEmitter.html">llvm::OptimizationRemarkEmitter</a></div><div class="ttdoc">The optimization diagnostic interface.</div><div class="ttdef"><b>Definition:</b> <a href="OptimizationRemarkEmitter_8h_source.html#l00033">OptimizationRemarkEmitter.h:33</a></div></div>
<div class="ttc" id="aclassllvm_1_1StringRef_html"><div class="ttname"><a href="classllvm_1_1StringRef.html">llvm::StringRef</a></div><div class="ttdoc">StringRef - Represent a constant reference to a string, i.e.</div><div class="ttdef"><b>Definition:</b> <a href="StringRef_8h_source.html#l00050">StringRef.h:50</a></div></div>
<div class="ttc" id="anamespacellvm_html_a39d3d23a084c4544ee5903203db10e8a"><div class="ttname"><a href="namespacellvm.html#a39d3d23a084c4544ee5903203db10e8a">llvm::append_range</a></div><div class="ttdeci">void append_range(Container &amp;C, Range &amp;&amp;R)</div><div class="ttdoc">Wrapper function to append a range to a container.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l02014">STLExtras.h:2014</a></div></div>
<div class="ttc" id="aSampleProfWriter_8cpp_html_ac5f3689931c7238da06ba00cf1002c62"><div class="ttname"><a href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a></div><div class="ttdeci">raw_pwrite_stream &amp; OS</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfWriter_8cpp_source.html#l00053">SampleProfWriter.cpp:53</a></div></div>
<div class="ttc" id="anamespacestd_html"><div class="ttname"><a href="namespacestd.html">std</a></div><div class="ttdef"><b>Definition:</b> <a href="BitVector_8h_source.html#l00851">BitVector.h:851</a></div></div>
<div class="ttc" id="aclassllvm_1_1PreservedAnalyses_html_a1258a1ff55557c27684010ebd7283712"><div class="ttname"><a href="classllvm_1_1PreservedAnalyses.html#a1258a1ff55557c27684010ebd7283712">llvm::PreservedAnalyses::all</a></div><div class="ttdeci">static PreservedAnalyses all()</div><div class="ttdoc">Construct a special preserved set that preserves all passes.</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00158">PassManager.h:158</a></div></div>
<div class="ttc" id="aAArch64Disassembler_8cpp_html_abdb086b34295fb7aa09493c62d798465"><div class="ttname"><a href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a></div><div class="ttdeci">#define Success</div><div class="ttdef"><b>Definition:</b> <a href="AArch64Disassembler_8cpp_source.html#l00300">AArch64Disassembler.cpp:300</a></div></div>
<div class="ttc" id="anamespacellvm_html_a8ac326bbf3910d5f456f0b3bbf8de06f"><div class="ttname"><a href="namespacellvm.html#a8ac326bbf3910d5f456f0b3bbf8de06f">llvm::FeatureMap</a></div><div class="ttdeci">const std::vector&lt; TensorSpec &gt; FeatureMap</div><div class="ttdef"><b>Definition:</b> <a href="MLInlineAdvisor_8cpp_source.html#l00082">MLInlineAdvisor.cpp:82</a></div></div>
<div class="ttc" id="aTrainingLogger_8h_html"><div class="ttname"><a href="TrainingLogger_8h.html">TrainingLogger.h</a></div></div>
<div class="ttc" id="aMLInlineAdvisor_8h_html"><div class="ttname"><a href="MLInlineAdvisor_8h.html">MLInlineAdvisor.h</a></div></div>
<div class="ttc" id="aCallGraph_8h_html"><div class="ttname"><a href="CallGraph_8h.html">CallGraph.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1MLInlineAdvisor_html"><div class="ttname"><a href="classllvm_1_1MLInlineAdvisor.html">llvm::MLInlineAdvisor</a></div><div class="ttdef"><b>Definition:</b> <a href="MLInlineAdvisor_8h_source.html#l00028">MLInlineAdvisor.h:28</a></div></div>
<div class="ttc" id="aclassllvm_1_1Logger_html"><div class="ttname"><a href="classllvm_1_1Logger.html">llvm::Logger</a></div><div class="ttdoc">Logging utility - given an ordered specification of features, and assuming a scalar reward,...</div><div class="ttdef"><b>Definition:</b> <a href="TrainingLogger_8h_source.html#l00091">TrainingLogger.h:91</a></div></div>
<div class="ttc" id="anamespacellvm_html_a3e7019a12915e2ed3b5ae8d64eb5256b"><div class="ttname"><a href="namespacellvm.html#a3e7019a12915e2ed3b5ae8d64eb5256b">llvm::getDevelopmentModeAdvisor</a></div><div class="ttdeci">std::unique_ptr&lt; InlineAdvisor &gt; getDevelopmentModeAdvisor(Module &amp;M, ModuleAnalysisManager &amp;MAM, std::function&lt; bool(CallBase &amp;)&gt; GetDefaultAdvice)</div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html"><div class="ttname"><a href="classllvm_1_1CallBase.html">llvm::CallBase</a></div><div class="ttdoc">Base class for all callable instructions (InvokeInst and CallInst) Holds everything related to callin...</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01184">InstrTypes.h:1184</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisManager_html"><div class="ttname"><a href="classllvm_1_1AnalysisManager.html">llvm::AnalysisManager</a></div><div class="ttdoc">A container for analyses that lazily runs them and caches their results.</div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8h_source.html#l00042">InstructionSimplify.h:42</a></div></div>
<div class="ttc" id="aLLVMContext_8h_html"><div class="ttname"><a href="LLVMContext_8h.html">LLVMContext.h</a></div></div>
<div class="ttc" id="astructllvm_1_1cl_1_1desc_html"><div class="ttname"><a href="structllvm_1_1cl_1_1desc.html">llvm::cl::desc</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00411">CommandLine.h:411</a></div></div>
<div class="ttc" id="anamespacellvm_html_a299d467a34db1328efc3b8279e1f435f"><div class="ttname"><a href="namespacellvm.html#a299d467a34db1328efc3b8279e1f435f">llvm::NumberOfFeatures</a></div><div class="ttdeci">constexpr size_t NumberOfFeatures</div><div class="ttdef"><b>Definition:</b> <a href="InlineModelFeatureMaps_8h_source.html#l00129">InlineModelFeatureMaps.h:129</a></div></div>
<div class="ttc" id="aclassllvm_1_1MLInlineAdvice_html"><div class="ttname"><a href="classllvm_1_1MLInlineAdvice.html">llvm::MLInlineAdvice</a></div><div class="ttdoc">InlineAdvice that tracks changes post inlining.</div><div class="ttdef"><b>Definition:</b> <a href="MLInlineAdvisor_8h_source.html#l00094">MLInlineAdvisor.h:94</a></div></div>
<div class="ttc" id="aclassllvm_1_1InlineResult_html"><div class="ttname"><a href="classllvm_1_1InlineResult.html">llvm::InlineResult</a></div><div class="ttdoc">InlineResult is basically true or false.</div><div class="ttdef"><b>Definition:</b> <a href="InlineCost_8h_source.html#l00179">InlineCost.h:179</a></div></div>
<div class="ttc" id="anamespacellvm_html_aa497b131be7719a15bde7cb3192d9bf8"><div class="ttname"><a href="namespacellvm.html#aa497b131be7719a15bde7cb3192d9bf8">llvm::RewardName</a></div><div class="ttdeci">const char *const RewardName</div><div class="ttdef"><b>Definition:</b> <a href="MLInlineAdvisor_8cpp_source.html#l00099">MLInlineAdvisor.cpp:99</a></div></div>
<div class="ttc" id="aclassllvm_1_1MLModelRunner_html"><div class="ttname"><a href="classllvm_1_1MLModelRunner.html">llvm::MLModelRunner</a></div><div class="ttdoc">MLModelRunner interface: abstraction of a mechanism for evaluating a tensorflow &quot;saved model&quot;.</div><div class="ttdef"><b>Definition:</b> <a href="MLModelRunner_8h_source.html#l00024">MLModelRunner.h:24</a></div></div>
<div class="ttc" id="aclassllvm_1_1MLInlineAdvice_html_afab4dde8e888e2564c2108a9c149f12d"><div class="ttname"><a href="classllvm_1_1MLInlineAdvice.html#afab4dde8e888e2564c2108a9c149f12d">llvm::MLInlineAdvice::recordUnattemptedInliningImpl</a></div><div class="ttdeci">void recordUnattemptedInliningImpl() override</div><div class="ttdef"><b>Definition:</b> <a href="MLInlineAdvisor_8cpp_source.html#l00505">MLInlineAdvisor.cpp:505</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 7 2023 09:48:31 for LLVM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
