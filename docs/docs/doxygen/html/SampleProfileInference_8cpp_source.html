<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: lib/Transforms/Utils/SampleProfileInference.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LLVM
   &#160;<span id="projectnumber">17.0.0git</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_a72932e0778af28115095468f6286ff8.html">Transforms</a></li><li class="navelem"><a class="el" href="dir_f75c00afeb315f44d76556a7c675e6e8.html">Utils</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">SampleProfileInference.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="SampleProfileInference_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- SampleProfileInference.cpp - Adjust sample profiles in the IR ------===//</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// See https://llvm.org/LICENSE.txt for license information.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// This file implements a profile inference algorithm. Given an incomplete and</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// possibly imprecise block counts, the algorithm reconstructs realistic block</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// and edge counts that satisfy flow conservation rules, while minimally modify</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// input block counts.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160; </div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SampleProfileInference_8h.html">llvm/Transforms/Utils/SampleProfileInference.h</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BitVector_8h.html">llvm/ADT/BitVector.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CommandLine_8h.html">llvm/Support/CommandLine.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Debug_8h.html">llvm/Support/Debug.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;queue&gt;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &lt;set&gt;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;stack&gt;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160; </div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div>
<div class="line"><a name="l00025"></a><span class="lineno"><a class="line" href="SampleProfileInference_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">   25</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;sample-profile-inference&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160; </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160; </div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> SampleProfileEvenFlowDistribution(</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="stringliteral">&quot;sample-profile-even-flow-distribution&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Try to evenly distribute flow when there are multiple equally &quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;             <span class="stringliteral">&quot;likely options.&quot;</span>));</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160; </div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> SampleProfileRebalanceUnknown(</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="stringliteral">&quot;sample-profile-rebalance-unknown&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Evenly re-distribute flow among unknown subgraphs.&quot;</span>));</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> SampleProfileJoinIslands(</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="stringliteral">&quot;sample-profile-join-islands&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Join isolated components having positive flow.&quot;</span>));</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160; </div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;unsigned&gt;</a> SampleProfileProfiCostBlockInc(</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="stringliteral">&quot;sample-profile-profi-cost-block-inc&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(10), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;The cost of increasing a block&#39;s count by one.&quot;</span>));</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;unsigned&gt;</a> SampleProfileProfiCostBlockDec(</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="stringliteral">&quot;sample-profile-profi-cost-block-dec&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(20), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;The cost of decreasing a block&#39;s count by one.&quot;</span>));</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160; </div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;unsigned&gt;</a> SampleProfileProfiCostBlockEntryInc(</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="stringliteral">&quot;sample-profile-profi-cost-block-entry-inc&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(40), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;The cost of increasing the entry block&#39;s count by one.&quot;</span>));</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160; </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;unsigned&gt;</a> SampleProfileProfiCostBlockEntryDec(</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="stringliteral">&quot;sample-profile-profi-cost-block-entry-dec&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(10), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;The cost of decreasing the entry block&#39;s count by one.&quot;</span>));</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;unsigned&gt;</a> SampleProfileProfiCostBlockZeroInc(</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="stringliteral">&quot;sample-profile-profi-cost-block-zero-inc&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(11), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;The cost of increasing a count of zero-weight block by one.&quot;</span>));</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;unsigned&gt;</a> SampleProfileProfiCostBlockUnknownInc(</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="stringliteral">&quot;sample-profile-profi-cost-block-unknown-inc&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(0), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;The cost of increasing an unknown block&#39;s count by one.&quot;</span>));</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">/// A value indicating an infinite flow/capacity/weight of a block/edge.</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">/// Not using numeric_limits&lt;int64_t&gt;::max(), as the values can be summed up</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">/// during the execution.</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment"></span><span class="keyword">static</span> constexpr int64_t <a class="code" href="regcomp_8c.html#a12c2040f25d8e3a7b9e1c2024c618cb6">INF</a> = ((int64_t)1) &lt;&lt; 50;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">/// The minimum-cost maximum flow algorithm.</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">/// The algorithm finds the maximum flow of minimum cost on a given (directed)</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">/// network using a modified version of the classical Moore-Bellman-Ford</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">/// approach. The algorithm applies a number of augmentation iterations in which</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">/// flow is sent along paths of positive capacity from the source to the sink.</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">/// The worst-case time complexity of the implementation is O(v(f)*m*n), where</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">/// where m is the number of edges, n is the number of vertices, and v(f) is the</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">/// value of the maximum flow. However, the observed running time on typical</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">/// instances is sub-quadratic, that is, o(n^2).</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">/// The input is a set of edges with specified costs and capacities, and a pair</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">/// of nodes (source and sink). The output is the flow along each edge of the</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">/// minimum total cost respecting the given edge capacities.</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment"></span><span class="keyword">class </span>MinCostMaxFlow {</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  MinCostMaxFlow(<span class="keyword">const</span> <a class="code" href="structllvm_1_1ProfiParams.html">ProfiParams</a> &amp;Params) : Params(Params) {}</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="comment">// Initialize algorithm&#39;s data structures for a network of a given size.</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="TargetLibraryInfo_8cpp.html#a19d27915595e7f0a0ef271448bcdac6f">initialize</a>(<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> NodeCount, <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> SourceNode, <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> SinkNode) {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <a class="code" href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">Source</a> = SourceNode;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <a class="code" href="classllvm_1_1Target.html">Target</a> = SinkNode;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160; </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    Nodes = std::vector&lt;Node&gt;(NodeCount);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    Edges = std::vector&lt;std::vector&lt;Edge&gt;&gt;(NodeCount, std::vector&lt;Edge&gt;());</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keywordflow">if</span> (Params.<a class="code" href="structllvm_1_1ProfiParams.html#afa5c8536542aef51080617f59b7a4756">EvenFlowDistribution</a>)</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      AugmentingEdges =</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;          std::vector&lt;std::vector&lt;Edge *&gt;&gt;(NodeCount, std::vector&lt;Edge *&gt;());</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  }</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160; </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="comment">// Run the algorithm.</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  int64_t <a class="code" href="namespacellvm_1_1dxil_1_1PointerTypeAnalysis.html#ae574a4c1d84b9e67bc94489f356805b4">run</a>() {</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Starting profi for &quot;</span> &lt;&lt; Nodes.size() &lt;&lt; <span class="stringliteral">&quot; nodes\n&quot;</span>);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="comment">// Iteratively find an augmentation path/dag in the network and send the</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="comment">// flow along its edges</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordtype">size_t</span> AugmentationIters = applyFlowAugmentation();</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="comment">// Compute the total flow and its cost</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    int64_t TotalCost = 0;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    int64_t TotalFlow = 0;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Src = 0; Src &lt; Nodes.size(); Src++) {</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Edge : Edges[Src]) {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keywordflow">if</span> (Edge.Flow &gt; 0) {</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;          TotalCost += Edge.Cost * Edge.Flow;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;          <span class="keywordflow">if</span> (Src == <a class="code" href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">Source</a>)</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            TotalFlow += Edge.Flow;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      }</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    }</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Completed profi after &quot;</span> &lt;&lt; AugmentationIters</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot; iterations with &quot;</span> &lt;&lt; TotalFlow &lt;&lt; <span class="stringliteral">&quot; total flow&quot;</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot; of &quot;</span> &lt;&lt; TotalCost &lt;&lt; <span class="stringliteral">&quot; cost\n&quot;</span>);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    (void)TotalFlow;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    (void)AugmentationIters;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">return</span> TotalCost;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  }</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">  /// Adding an edge to the network with a specified capacity and a cost.</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">  /// Multiple edges between a pair of nodes are allowed but self-edges</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">  /// are not supported.</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="LazyCallGraph_8cpp.html#aec802e48dd5ef69029e285eddfc4158d">addEdge</a>(<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Src, <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Dst, int64_t Capacity, int64_t <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a>) {</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Capacity &gt; 0 &amp;&amp; <span class="stringliteral">&quot;adding an edge of zero capacity&quot;</span>);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Src != Dst &amp;&amp; <span class="stringliteral">&quot;loop edge are not supported&quot;</span>);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160; </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    Edge SrcEdge;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    SrcEdge.Dst = Dst;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    SrcEdge.Cost = <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a>;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    SrcEdge.Capacity = Capacity;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    SrcEdge.Flow = 0;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    SrcEdge.RevEdgeIndex = Edges[Dst].size();</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    Edge DstEdge;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    DstEdge.Dst = Src;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    DstEdge.Cost = -<a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a>;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    DstEdge.Capacity = 0;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    DstEdge.Flow = 0;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    DstEdge.RevEdgeIndex = Edges[Src].size();</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    Edges[Src].push_back(SrcEdge);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    Edges[Dst].push_back(DstEdge);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  }</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">  /// Adding an edge to the network of infinite capacity and a given cost.</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="LazyCallGraph_8cpp.html#aec802e48dd5ef69029e285eddfc4158d">addEdge</a>(<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Src, <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Dst, int64_t <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a>) {</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <a class="code" href="LazyCallGraph_8cpp.html#aec802e48dd5ef69029e285eddfc4158d">addEdge</a>(Src, Dst, <a class="code" href="regcomp_8c.html#a12c2040f25d8e3a7b9e1c2024c618cb6">INF</a>, <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a>);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">  /// Get the total flow from a given source node.</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">  /// Returns a list of pairs (target node, amount of flow to the target).</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment"></span>  <span class="keyword">const</span> std::vector&lt;std::pair&lt;uint64_t, int64_t&gt;&gt; getFlow(<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Src)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    std::vector&lt;std::pair&lt;uint64_t, int64_t&gt;&gt; <a class="code" href="SIAnnotateControlFlow_8cpp.html#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;Edge : Edges[Src]) {</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      <span class="keywordflow">if</span> (Edge.Flow &gt; 0)</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <a class="code" href="SIAnnotateControlFlow_8cpp.html#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>.push_back(std::make_pair(Edge.Dst, Edge.Flow));</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    }</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="SIAnnotateControlFlow_8cpp.html#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  }</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">  /// Get the total flow between a pair of nodes.</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment"></span>  int64_t getFlow(<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Src, <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Dst)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    int64_t <a class="code" href="SIAnnotateControlFlow_8cpp.html#acf797fa91d5b7065dfb68a2492df28c1">Flow</a> = 0;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;Edge : Edges[Src]) {</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <span class="keywordflow">if</span> (Edge.Dst == Dst) {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <a class="code" href="SIAnnotateControlFlow_8cpp.html#acf797fa91d5b7065dfb68a2492df28c1">Flow</a> += Edge.Flow;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      }</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="SIAnnotateControlFlow_8cpp.html#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  }</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160; </div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="keyword">private</span>:<span class="comment"></span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">  /// Iteratively find an augmentation path/dag in the network and send the</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">  /// flow along its edges. The method returns the number of applied iterations.</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment"></span>  <span class="keywordtype">size_t</span> applyFlowAugmentation() {</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordtype">size_t</span> AugmentationIters = 0;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordflow">while</span> (findAugmentingPath()) {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> PathCapacity = computeAugmentingPathCapacity();</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      <span class="keywordflow">while</span> (PathCapacity &gt; 0) {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <span class="keywordtype">bool</span> Progress = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keywordflow">if</span> (Params.<a class="code" href="structllvm_1_1ProfiParams.html#afa5c8536542aef51080617f59b7a4756">EvenFlowDistribution</a>) {</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;          <span class="comment">// Identify node/edge candidates for augmentation</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;          identifyShortestEdges(PathCapacity);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160; </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;          <span class="comment">// Find an augmenting DAG</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;          <span class="keyword">auto</span> AugmentingOrder = findAugmentingDAG();</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160; </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;          <span class="comment">// Apply the DAG augmentation</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;          Progress = augmentFlowAlongDAG(AugmentingOrder);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;          PathCapacity = computeAugmentingPathCapacity();</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        }</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160; </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <span class="keywordflow">if</span> (!Progress) {</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;          augmentFlowAlongPath(PathCapacity);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;          PathCapacity = 0;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        }</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160; </div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        AugmentationIters++;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      }</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    }</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordflow">return</span> AugmentationIters;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">  /// Compute the capacity of the cannonical augmenting path. If the path is</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">  /// saturated (that is, no flow can be sent along the path), then return 0.</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment"></span>  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> computeAugmentingPathCapacity() {</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> PathCapacity = <a class="code" href="regcomp_8c.html#a12c2040f25d8e3a7b9e1c2024c618cb6">INF</a>;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Now = <a class="code" href="classllvm_1_1Target.html">Target</a>;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordflow">while</span> (Now != <a class="code" href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">Source</a>) {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Pred = Nodes[Now].ParentNode;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      <span class="keyword">auto</span> &amp;Edge = Edges[Pred][Nodes[Now].ParentEdgeIndex];</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Edge.Capacity &gt;= Edge.Flow &amp;&amp; <span class="stringliteral">&quot;incorrect edge flow&quot;</span>);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> EdgeCapacity = <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a>(Edge.Capacity - Edge.Flow);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      PathCapacity = <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(PathCapacity, EdgeCapacity);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160; </div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      Now = Pred;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    }</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordflow">return</span> PathCapacity;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  }</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">  /// Check for existence of an augmenting path with a positive capacity.</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> findAugmentingPath() {</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="comment">// Initialize data structures</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Node : Nodes) {</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      Node.Distance = <a class="code" href="regcomp_8c.html#a12c2040f25d8e3a7b9e1c2024c618cb6">INF</a>;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      Node.ParentNode = <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a>(-1);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      Node.ParentEdgeIndex = <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a>(-1);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      Node.Taken = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    }</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160; </div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    std::queue&lt;uint64_t&gt; Queue;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    Queue.push(<a class="code" href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">Source</a>);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    Nodes[<a class="code" href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">Source</a>].Distance = 0;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    Nodes[<a class="code" href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">Source</a>].Taken = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">while</span> (!Queue.empty()) {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Src = Queue.front();</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      Queue.pop();</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      Nodes[Src].Taken = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <span class="comment">// Although the residual network contains edges with negative costs</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <span class="comment">// (in particular, backward edges), it can be shown that there are no</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="comment">// negative-weight cycles and the following two invariants are maintained:</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <span class="comment">// (i) Dist[Source, V] &gt;= 0 and (ii) Dist[V, Target] &gt;= 0 for all nodes V,</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      <span class="comment">// where Dist is the length of the shortest path between two nodes. This</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      <span class="comment">// allows to prune the search-space of the path-finding algorithm using</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="comment">// the following early-stop criteria:</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      <span class="comment">// -- If we find a path with zero-distance from Source to Target, stop the</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      <span class="comment">//    search, as the path is the shortest since Dist[Source, Target] &gt;= 0;</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      <span class="comment">// -- If we have Dist[Source, V] &gt; Dist[Source, Target], then do not</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      <span class="comment">//    process node V, as it is guaranteed _not_ to be on a shortest path</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <span class="comment">//    from Source to Target; it follows from inequalities</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <span class="comment">//    Dist[Source, Target] &gt;= Dist[Source, V] + Dist[V, Target]</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      <span class="comment">//                         &gt;= Dist[Source, V]</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <span class="keywordflow">if</span> (!Params.<a class="code" href="structllvm_1_1ProfiParams.html#afa5c8536542aef51080617f59b7a4756">EvenFlowDistribution</a> &amp;&amp; Nodes[<a class="code" href="classllvm_1_1Target.html">Target</a>].Distance == 0)</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      <span class="keywordflow">if</span> (Nodes[Src].Distance &gt; Nodes[<a class="code" href="classllvm_1_1Target.html">Target</a>].Distance)</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      <span class="comment">// Process adjacent edges</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> EdgeIdx = 0; EdgeIdx &lt; Edges[Src].size(); EdgeIdx++) {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <span class="keyword">auto</span> &amp;Edge = Edges[Src][EdgeIdx];</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="keywordflow">if</span> (Edge.Flow &lt; Edge.Capacity) {</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;          <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Dst = Edge.Dst;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;          int64_t NewDistance = Nodes[Src].Distance + Edge.Cost;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;          <span class="keywordflow">if</span> (Nodes[Dst].Distance &gt; NewDistance) {</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            <span class="comment">// Update the distance and the parent node/edge</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            Nodes[Dst].Distance = NewDistance;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            Nodes[Dst].ParentNode = Src;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            Nodes[Dst].ParentEdgeIndex = EdgeIdx;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            <span class="comment">// Add the node to the queue, if it is not there yet</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            <span class="keywordflow">if</span> (!Nodes[Dst].Taken) {</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;              Queue.push(Dst);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;              Nodes[Dst].Taken = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            }</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;          }</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      }</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    }</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160; </div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordflow">return</span> Nodes[<a class="code" href="classllvm_1_1Target.html">Target</a>].Distance != <a class="code" href="regcomp_8c.html#a12c2040f25d8e3a7b9e1c2024c618cb6">INF</a>;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  }</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">  /// Update the current flow along the augmenting path.</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> augmentFlowAlongPath(<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> PathCapacity) {</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PathCapacity &gt; 0 &amp;&amp; <span class="stringliteral">&quot;found an incorrect augmenting path&quot;</span>);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Now = <a class="code" href="classllvm_1_1Target.html">Target</a>;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordflow">while</span> (Now != <a class="code" href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">Source</a>) {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Pred = Nodes[Now].ParentNode;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      <span class="keyword">auto</span> &amp;Edge = Edges[Pred][Nodes[Now].ParentEdgeIndex];</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      <span class="keyword">auto</span> &amp;RevEdge = Edges[Now][Edge.RevEdgeIndex];</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160; </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      Edge.Flow += PathCapacity;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      RevEdge.Flow -= PathCapacity;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160; </div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      Now = Pred;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    }</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  }</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">  /// Find an Augmenting DAG order using a modified version of DFS in which we</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">  /// can visit a node multiple times. In the DFS search, when scanning each</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">  /// edge out of a node, continue search at Edge.Dst endpoint if it has not</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">  /// been discovered yet and its NumCalls &lt; MaxDfsCalls. The algorithm</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">  /// runs in O(MaxDfsCalls * |Edges| + |Nodes|) time.</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">  /// It returns an Augmenting Order (Taken nodes in decreasing Finish time)</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">  /// that starts with Source and ends with Target.</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment"></span>  std::vector&lt;uint64_t&gt; findAugmentingDAG() {</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="comment">// We use a stack based implemenation of DFS to avoid recursion.</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="comment">// Defining DFS data structures:</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="comment">// A pair (NodeIdx, EdgeIdx) at the top of the Stack denotes that</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="comment">//  - we are currently visiting Nodes[NodeIdx] and</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="comment">//  - the next edge to scan is Edges[NodeIdx][EdgeIdx]</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keyword">typedef</span> std::pair&lt;uint64_t, uint64_t&gt; StackItemType;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    std::stack&lt;StackItemType&gt; Stack;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    std::vector&lt;uint64_t&gt; AugmentingOrder;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="comment">// Phase 0: Initialize Node attributes and Time for DFS run</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Node : Nodes) {</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      Node.Discovery = 0;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      Node.Finish = 0;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      Node.NumCalls = 0;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      Node.Taken = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    }</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Time = 0;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="comment">// Mark Target as Taken</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="comment">// Taken attribute will be propagated backwards from Target towards Source</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    Nodes[<a class="code" href="classllvm_1_1Target.html">Target</a>].Taken = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160; </div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="comment">// Phase 1: Start DFS traversal from Source</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    Stack.emplace(<a class="code" href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">Source</a>, 0);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    Nodes[<a class="code" href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">Source</a>].Discovery = ++Time;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordflow">while</span> (!Stack.empty()) {</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      <span class="keyword">auto</span> NodeIdx = Stack.top().first;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      <span class="keyword">auto</span> EdgeIdx = Stack.top().second;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160; </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      <span class="comment">// If we haven&#39;t scanned all edges out of NodeIdx, continue scanning</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      <span class="keywordflow">if</span> (EdgeIdx &lt; Edges[NodeIdx].<a class="code" href="namespacellvm.html#a10f3d955592ae2bc745f57e5b48ae115">size</a>()) {</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        <span class="keyword">auto</span> &amp;Edge = Edges[NodeIdx][EdgeIdx];</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="keyword">auto</span> &amp;Dst = Nodes[Edge.Dst];</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        Stack.top().second++;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160; </div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <span class="keywordflow">if</span> (Edge.OnShortestPath) {</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;          <span class="comment">// If we haven&#39;t seen Edge.Dst so far, continue DFS search there</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;          <span class="keywordflow">if</span> (Dst.Discovery == 0 &amp;&amp; Dst.NumCalls &lt; MaxDfsCalls) {</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            Dst.Discovery = ++Time;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            Stack.emplace(Edge.Dst, 0);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            Dst.NumCalls++;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Dst.Taken &amp;&amp; Dst.Finish != 0) {</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            <span class="comment">// Else, if Edge.Dst already have a path to Target, so that NodeIdx</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            Nodes[NodeIdx].Taken = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;          }</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        }</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="comment">// If we are done scanning all edge out of NodeIdx</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        Stack.pop();</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <span class="comment">// If we haven&#39;t found a path from NodeIdx to Target, forget about it</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <span class="keywordflow">if</span> (!Nodes[NodeIdx].Taken) {</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;          Nodes[NodeIdx].Discovery = 0;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;          <span class="comment">// If we have found a path from NodeIdx to Target, then finish NodeIdx</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;          <span class="comment">// and propagate Taken flag to DFS parent unless at the Source</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;          Nodes[NodeIdx].Finish = ++Time;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;          <span class="comment">// NodeIdx == Source if and only if the stack is empty</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;          <span class="keywordflow">if</span> (NodeIdx != <a class="code" href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">Source</a>) {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!Stack.empty() &amp;&amp; <span class="stringliteral">&quot;empty stack while running dfs&quot;</span>);</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            Nodes[Stack.top().first].Taken = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;          }</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;          AugmentingOrder.push_back(NodeIdx);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        }</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      }</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    }</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="comment">// Nodes are collected decreasing Finish time, so the order is reversed</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <a class="code" href="namespacellvm.html#a6b0ac1fa4f05de76413c5e0ca6334035">std::reverse</a>(AugmentingOrder.begin(), AugmentingOrder.end());</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160; </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="comment">// Phase 2: Extract all forward (DAG) edges and fill in AugmentingEdges</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> Src : AugmentingOrder) {</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      AugmentingEdges[Src].clear();</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Edge : Edges[Src]) {</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Dst = Edge.Dst;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <span class="keywordflow">if</span> (Edge.OnShortestPath &amp;&amp; Nodes[Src].Taken &amp;&amp; Nodes[Dst].Taken &amp;&amp;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            Nodes[Dst].Finish &lt; Nodes[Src].Finish) {</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;          AugmentingEdges[Src].push_back(&amp;Edge);</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        }</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      }</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((Src == <a class="code" href="classllvm_1_1Target.html">Target</a> || !AugmentingEdges[Src].empty()) &amp;&amp;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;             <span class="stringliteral">&quot;incorrectly constructed augmenting edges&quot;</span>);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    }</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160; </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordflow">return</span> AugmentingOrder;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  }</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">  /// Update the current flow along the given (acyclic) subgraph specified by</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment">  /// the vertex order, AugmentingOrder. The objective is to send as much flow</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">  /// as possible while evenly distributing flow among successors of each node.</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">  /// After the update at least one edge is saturated.</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> augmentFlowAlongDAG(<span class="keyword">const</span> std::vector&lt;uint64_t&gt; &amp;AugmentingOrder) {</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="comment">// Phase 0: Initialization</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Src : AugmentingOrder) {</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      Nodes[Src].FracFlow = 0;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      Nodes[Src].IntFlow = 0;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Edge : AugmentingEdges[Src]) {</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        Edge-&gt;AugmentedFlow = 0;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;      }</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    }</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160; </div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="comment">// Phase 1: Send a unit of fractional flow along the DAG</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> MaxFlowAmount = <a class="code" href="regcomp_8c.html#a12c2040f25d8e3a7b9e1c2024c618cb6">INF</a>;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    Nodes[<a class="code" href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">Source</a>].FracFlow = 1.0;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Src : AugmentingOrder) {</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((Src == <a class="code" href="classllvm_1_1Target.html">Target</a> || Nodes[Src].FracFlow &gt; 0.0) &amp;&amp;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;             <span class="stringliteral">&quot;incorrectly computed fractional flow&quot;</span>);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      <span class="comment">// Distribute flow evenly among successors of Src</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Degree = AugmentingEdges[Src].size();</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Edge : AugmentingEdges[Src]) {</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <span class="keywordtype">double</span> EdgeFlow = Nodes[Src].FracFlow / Degree;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        Nodes[Edge-&gt;Dst].FracFlow += EdgeFlow;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        <span class="keywordflow">if</span> (Edge-&gt;Capacity == <a class="code" href="regcomp_8c.html#a12c2040f25d8e3a7b9e1c2024c618cb6">INF</a>)</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> MaxIntFlow = <a class="code" href="README-SSE_8txt.html#a698e4bd87a8adc0c042ae6b6e10ee6e1">double</a>(Edge-&gt;Capacity - Edge-&gt;Flow) / EdgeFlow;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        MaxFlowAmount = <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(MaxFlowAmount, MaxIntFlow);</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      }</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    }</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="comment">// Stop early if we cannot send any (integral) flow from Source to Target</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keywordflow">if</span> (MaxFlowAmount == 0)</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160; </div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="comment">// Phase 2: Send an integral flow of MaxFlowAmount</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    Nodes[<a class="code" href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">Source</a>].IntFlow = MaxFlowAmount;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Src : AugmentingOrder) {</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      <span class="keywordflow">if</span> (Src == <a class="code" href="classllvm_1_1Target.html">Target</a>)</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      <span class="comment">// Distribute flow evenly among successors of Src, rounding up to make</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      <span class="comment">// sure all flow is sent</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Degree = AugmentingEdges[Src].size();</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      <span class="comment">// We are guaranteeed that Node[Src].IntFlow &lt;= SuccFlow * Degree</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> SuccFlow = (Nodes[Src].IntFlow + Degree - 1) / Degree;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Edge : AugmentingEdges[Src]) {</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Dst = Edge-&gt;Dst;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> EdgeFlow = <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(Nodes[Src].IntFlow, SuccFlow);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        EdgeFlow = <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(EdgeFlow, <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a>(Edge-&gt;Capacity - Edge-&gt;Flow));</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        Nodes[Dst].IntFlow += EdgeFlow;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        Nodes[Src].IntFlow -= EdgeFlow;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        Edge-&gt;AugmentedFlow += EdgeFlow;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      }</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    }</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Nodes[<a class="code" href="classllvm_1_1Target.html">Target</a>].IntFlow &lt;= MaxFlowAmount);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    Nodes[<a class="code" href="classllvm_1_1Target.html">Target</a>].IntFlow = 0;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160; </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="comment">// Phase 3: Send excess flow back traversing the nodes backwards.</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="comment">// Because of rounding, not all flow can be sent along the edges of Src.</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="comment">// Hence, sending the remaining flow back to maintain flow conservation</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> Idx = AugmentingOrder.size() - 1; Idx &gt; 0; Idx--) {</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Src = AugmentingOrder[Idx - 1];</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      <span class="comment">// Try to send excess flow back along each edge.</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      <span class="comment">// Make sure we only send back flow we just augmented (AugmentedFlow).</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Edge : AugmentingEdges[Src]) {</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Dst = Edge-&gt;Dst;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        <span class="keywordflow">if</span> (Nodes[Dst].IntFlow == 0)</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> EdgeFlow = <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(Nodes[Dst].IntFlow, Edge-&gt;AugmentedFlow);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        Nodes[Dst].IntFlow -= EdgeFlow;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        Nodes[Src].IntFlow += EdgeFlow;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        Edge-&gt;AugmentedFlow -= EdgeFlow;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      }</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    }</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="comment">// Phase 4: Update flow values along all edges</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keywordtype">bool</span> HasSaturatedEdges = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Src : AugmentingOrder) {</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      <span class="comment">// Verify that we have sent all the excess flow from the node</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Src == <a class="code" href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">Source</a> || Nodes[Src].IntFlow == 0);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Edge : AugmentingEdges[Src]) {</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a>(Edge-&gt;Capacity - Edge-&gt;Flow) &gt;= Edge-&gt;AugmentedFlow);</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <span class="comment">// Update flow values along the edge and its reverse copy</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <span class="keyword">auto</span> &amp;RevEdge = Edges[Edge-&gt;Dst][Edge-&gt;RevEdgeIndex];</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        Edge-&gt;Flow += Edge-&gt;AugmentedFlow;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        RevEdge.Flow -= Edge-&gt;AugmentedFlow;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        <span class="keywordflow">if</span> (Edge-&gt;Capacity == Edge-&gt;Flow &amp;&amp; Edge-&gt;AugmentedFlow &gt; 0)</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;          HasSaturatedEdges = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      }</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    }</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160; </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="comment">// The augmentation is successful iff at least one edge becomes saturated</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordflow">return</span> HasSaturatedEdges;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  }</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">  /// Identify candidate (shortest) edges for augmentation.</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> identifyShortestEdges(<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> PathCapacity) {</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PathCapacity &gt; 0 &amp;&amp; <span class="stringliteral">&quot;found an incorrect augmenting DAG&quot;</span>);</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="comment">// To make sure the augmentation DAG contains only edges with large residual</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="comment">// capacity, we prune all edges whose capacity is below a fraction of</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="comment">// the capacity of the augmented path.</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="comment">// (All edges of the path itself are always in the DAG)</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> MinCapacity = <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(PathCapacity / 2, <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a>(1));</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160; </div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="comment">// Decide which edges are on a shortest path from Source to Target</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> Src = 0; Src &lt; Nodes.size(); Src++) {</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      <span class="comment">// An edge cannot be augmenting if the endpoint has large distance</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      <span class="keywordflow">if</span> (Nodes[Src].Distance &gt; Nodes[<a class="code" href="classllvm_1_1Target.html">Target</a>].Distance)</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160; </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Edge : Edges[Src]) {</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Dst = Edge.Dst;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        Edge.OnShortestPath =</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            Src != <a class="code" href="classllvm_1_1Target.html">Target</a> &amp;&amp; Dst != <a class="code" href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">Source</a> &amp;&amp;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            Nodes[Dst].Distance &lt;= Nodes[<a class="code" href="classllvm_1_1Target.html">Target</a>].Distance &amp;&amp;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;            Nodes[Dst].Distance == Nodes[Src].Distance + Edge.Cost &amp;&amp;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            Edge.Capacity &gt; Edge.Flow &amp;&amp;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a>(Edge.Capacity - Edge.Flow) &gt;= MinCapacity;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      }</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    }</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  }</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">  /// Maximum number of DFS iterations for DAG finding.</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> constexpr <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> MaxDfsCalls = 10;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment">  /// A node in a flow network.</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment"></span>  <span class="keyword">struct </span><a class="code" href="classNode.html#a7a56ed6baec69c476df398caa5c9aef5">Node</a> {<span class="comment"></span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">    /// The cost of the cheapest path from the source to the current node.</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment"></span>    int64_t Distance;<span class="comment"></span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment">    /// The node preceding the current one in the path.</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment"></span>    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> ParentNode;<span class="comment"></span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">    /// The index of the edge between ParentNode and the current node.</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment"></span>    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> ParentEdgeIndex;<span class="comment"></span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment">    /// An indicator of whether the current node is in a queue.</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span> Taken;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment">    /// Data fields utilized in DAG-augmentation:</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment">    /// Fractional flow.</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment"></span>    <span class="keywordtype">double</span> FracFlow;<span class="comment"></span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">    /// Integral flow.</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment"></span>    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> IntFlow;<span class="comment"></span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment">    /// Discovery time.</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment"></span>    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Discovery;<span class="comment"></span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">    /// Finish time.</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment"></span>    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Finish;<span class="comment"></span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment">    /// NumCalls.</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment"></span>    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> NumCalls;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  };</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment">  /// An edge in a flow network.</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment"></span>  <span class="keyword">struct </span>Edge {<span class="comment"></span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment">    /// The cost of the edge.</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment"></span>    int64_t <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a>;<span class="comment"></span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="comment">    /// The capacity of the edge.</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment"></span>    int64_t Capacity;<span class="comment"></span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment">    /// The current flow on the edge.</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment"></span>    int64_t <a class="code" href="SIAnnotateControlFlow_8cpp.html#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>;<span class="comment"></span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="comment">    /// The destination node of the edge.</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="comment"></span>    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Dst;<span class="comment"></span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="comment">    /// The index of the reverse edge between Dst and the current node.</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment"></span>    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> RevEdgeIndex;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">    /// Data fields utilized in DAG-augmentation:</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment">    /// Whether the edge is currently on a shortest path from Source to Target.</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span> OnShortestPath;<span class="comment"></span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment">    /// Extra flow along the edge.</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment"></span>    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> AugmentedFlow;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  };</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment">  /// The set of network nodes.</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment"></span>  std::vector&lt;Node&gt; Nodes;<span class="comment"></span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment">  /// The set of network edges.</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment"></span>  std::vector&lt;std::vector&lt;Edge&gt;&gt; Edges;<span class="comment"></span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="comment">  /// Source node of the flow.</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment"></span>  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> <a class="code" href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">Source</a>;<span class="comment"></span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment">  /// Target (sink) node of the flow.</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="comment"></span>  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> <a class="code" href="classllvm_1_1Target.html">Target</a>;<span class="comment"></span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment">  /// Augmenting edges.</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment"></span>  std::vector&lt;std::vector&lt;Edge *&gt;&gt; AugmentingEdges;<span class="comment"></span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment">  /// Params for flow computation.</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment"></span>  <span class="keyword">const</span> <a class="code" href="structllvm_1_1ProfiParams.html">ProfiParams</a> &amp;Params;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;};</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">/// A post-processing adjustment of the control flow. It applies two steps by</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment">/// rerouting some flow and making it more realistic:</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="comment">/// - First, it removes all isolated components (&quot;islands&quot;) with a positive flow</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="comment">///   that are unreachable from the entry block. For every such component, we</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment">///   find the shortest from the entry to an exit passing through the component,</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">///   and increase the flow by one unit along the path.</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment">/// - Second, it identifies all &quot;unknown subgraphs&quot; consisting of basic blocks</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment">///   with no sampled counts. Then it rebalnces the flow that goes through such</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">///   a subgraph so that each branch is taken with probability 50%.</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment">///   An unknown subgraph is such that for every two nodes u and v:</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment">///     - u dominates v and u is not unknown;</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment">///     - v post-dominates u; and</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment">///     - all inner-nodes of all (u,v)-paths are unknown.</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment"></span><span class="keyword">class </span>FlowAdjuster {</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  FlowAdjuster(<span class="keyword">const</span> <a class="code" href="structllvm_1_1ProfiParams.html">ProfiParams</a> &amp;Params, <a class="code" href="structllvm_1_1FlowFunction.html">FlowFunction</a> &amp;Func)</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      : Params(Params), Func(Func) {}</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="comment">  /// Apply the post-processing.</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="namespacellvm_1_1dxil_1_1PointerTypeAnalysis.html#ae574a4c1d84b9e67bc94489f356805b4">run</a>() {</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordflow">if</span> (Params.<a class="code" href="structllvm_1_1ProfiParams.html#a97439d73a5716992c931f74c45485fda">JoinIslands</a>) {</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;      <span class="comment">// Adjust the flow to get rid of isolated components</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      joinIsolatedComponents();</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    }</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160; </div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordflow">if</span> (Params.<a class="code" href="structllvm_1_1ProfiParams.html#a720bd9ea72871723cd4a8e413c40cf82">RebalanceUnknown</a>) {</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      <span class="comment">// Rebalance the flow inside unknown subgraphs</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      rebalanceUnknownSubgraphs();</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    }</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  }</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160; </div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <span class="keywordtype">void</span> joinIsolatedComponents() {</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="comment">// Find blocks that are reachable from the source</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="keyword">auto</span> Visited = <a class="code" href="classllvm_1_1BitVector.html">BitVector</a>(NumBlocks(), <span class="keyword">false</span>);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    findReachable(Func.Entry, Visited);</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160; </div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="comment">// Iterate over all non-reachable blocks and adjust their weights</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumBlocks(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) {</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      <span class="keyword">auto</span> &amp;Block = Func.Blocks[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      <span class="keywordflow">if</span> (Block.Flow &gt; 0 &amp;&amp; !Visited[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]) {</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        <span class="comment">// Find a path from the entry to an exit passing through the block I</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        <span class="keyword">auto</span> Path = findShortestPath(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <span class="comment">// Increase the flow along the path</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Path.size() &gt; 0 &amp;&amp; Path[0]-&gt;Source == Func.Entry &amp;&amp;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;               <span class="stringliteral">&quot;incorrectly computed path adjusting control flow&quot;</span>);</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        Func.Blocks[Func.Entry].Flow += 1;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Jump : Path) {</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;          Jump-&gt;Flow += 1;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;          Func.Blocks[Jump-&gt;Target].Flow += 1;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;          <span class="comment">// Update reachability</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;          findReachable(Jump-&gt;Target, Visited);</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        }</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      }</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    }</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  }</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment">  /// Run BFS from a given block along the jumps with a positive flow and mark</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment">  /// all reachable blocks.</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> findReachable(<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Src, <a class="code" href="classllvm_1_1BitVector.html">BitVector</a> &amp;Visited) {</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="keywordflow">if</span> (Visited[Src])</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    std::queue&lt;uint64_t&gt; Queue;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    Queue.push(Src);</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    Visited[Src] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="keywordflow">while</span> (!Queue.empty()) {</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      Src = Queue.front();</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      Queue.pop();</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Jump : Func.Blocks[Src].SuccJumps) {</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Dst = Jump-&gt;Target;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        <span class="keywordflow">if</span> (Jump-&gt;Flow &gt; 0 &amp;&amp; !Visited[Dst]) {</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;          Queue.push(Dst);</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;          Visited[Dst] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        }</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      }</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    }</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  }</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment">  /// Find the shortest path from the entry block to an exit block passing</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment">  /// through a given block.</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment"></span>  std::vector&lt;FlowJump *&gt; findShortestPath(<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> BlockIdx) {</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="comment">// A path from the entry block to BlockIdx</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="keyword">auto</span> ForwardPath = findShortestPath(Func.Entry, BlockIdx);</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="comment">// A path from BlockIdx to an exit block</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="keyword">auto</span> BackwardPath = findShortestPath(BlockIdx, AnyExitBlock);</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160; </div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <span class="comment">// Concatenate the two paths</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    std::vector&lt;FlowJump *&gt; Result;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    Result.insert(Result.end(), ForwardPath.begin(), ForwardPath.end());</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    Result.insert(Result.end(), BackwardPath.begin(), BackwardPath.end());</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordflow">return</span> Result;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  }</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="comment">  /// Apply the Dijkstra algorithm to find the shortest path from a given</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="comment">  /// Source to a given Target block.</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="comment">  /// If Target == -1, then the path ends at an exit block.</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="comment"></span>  std::vector&lt;FlowJump *&gt; findShortestPath(<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> <a class="code" href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">Source</a>, <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> <a class="code" href="classllvm_1_1Target.html">Target</a>) {</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="comment">// Quit early, if possible</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">Source</a> == <a class="code" href="classllvm_1_1Target.html">Target</a>)</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      <span class="keywordflow">return</span> std::vector&lt;FlowJump *&gt;();</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <span class="keywordflow">if</span> (Func.Blocks[<a class="code" href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">Source</a>].isExit() &amp;&amp; <a class="code" href="classllvm_1_1Target.html">Target</a> == AnyExitBlock)</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      <span class="keywordflow">return</span> std::vector&lt;FlowJump *&gt;();</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160; </div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="comment">// Initialize data structures</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="keyword">auto</span> Distance = std::vector&lt;int64_t&gt;(NumBlocks(), <a class="code" href="regcomp_8c.html#a12c2040f25d8e3a7b9e1c2024c618cb6">INF</a>);</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="keyword">auto</span> Parent = std::vector&lt;FlowJump *&gt;(NumBlocks(), <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    Distance[<a class="code" href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">Source</a>] = 0;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    std::set&lt;std::pair&lt;uint64_t, uint64_t&gt;&gt; Queue;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    Queue.insert(std::make_pair(Distance[<a class="code" href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">Source</a>], <a class="code" href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">Source</a>));</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160; </div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    <span class="comment">// Run the Dijkstra algorithm</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="keywordflow">while</span> (!Queue.empty()) {</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Src = Queue.begin()-&gt;second;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      Queue.erase(Queue.begin());</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;      <span class="comment">// If we found a solution, quit early</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;      <span class="keywordflow">if</span> (Src == <a class="code" href="classllvm_1_1Target.html">Target</a> ||</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;          (Func.Blocks[Src].isExit() &amp;&amp; <a class="code" href="classllvm_1_1Target.html">Target</a> == AnyExitBlock))</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160; </div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Jump : Func.Blocks[Src].SuccJumps) {</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Dst = Jump-&gt;Target;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        int64_t JumpDist = jumpDistance(Jump);</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        <span class="keywordflow">if</span> (Distance[Dst] &gt; Distance[Src] + JumpDist) {</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;          Queue.erase(std::make_pair(Distance[Dst], Dst));</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160; </div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;          Distance[Dst] = Distance[Src] + JumpDist;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;          Parent[Dst] = Jump;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160; </div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;          Queue.insert(std::make_pair(Distance[Dst], Dst));</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        }</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;      }</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    }</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="comment">// If Target is not provided, find the closest exit block</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Target.html">Target</a> == AnyExitBlock) {</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumBlocks(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) {</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <span class="keywordflow">if</span> (Func.Blocks[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].isExit() &amp;&amp; Parent[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Target.html">Target</a> == AnyExitBlock || Distance[<a class="code" href="classllvm_1_1Target.html">Target</a>] &gt; Distance[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]) {</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            <a class="code" href="classllvm_1_1Target.html">Target</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;          }</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        }</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      }</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    }</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Parent[<a class="code" href="classllvm_1_1Target.html">Target</a>] != <span class="keyword">nullptr</span> &amp;&amp; <span class="stringliteral">&quot;a path does not exist&quot;</span>);</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160; </div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="comment">// Extract the constructed path</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    std::vector&lt;FlowJump *&gt; Result;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Now = <a class="code" href="classllvm_1_1Target.html">Target</a>;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="keywordflow">while</span> (Now != <a class="code" href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">Source</a>) {</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Now == Parent[Now]-&gt;<a class="code" href="classllvm_1_1Target.html">Target</a> &amp;&amp; <span class="stringliteral">&quot;incorrect parent jump&quot;</span>);</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      Result.push_back(Parent[Now]);</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      Now = Parent[Now]-&gt;Source;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    }</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <span class="comment">// Reverse the path, since it is extracted from Target to Source</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <a class="code" href="namespacellvm.html#a6b0ac1fa4f05de76413c5e0ca6334035">std::reverse</a>(Result.begin(), Result.end());</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="keywordflow">return</span> Result;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  }</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="comment">  /// A distance of a path for a given jump.</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="comment">  /// In order to incite the path to use blocks/jumps with large positive flow,</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="comment">  /// and avoid changing branch probability of outgoing edges drastically,</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="comment">  /// set the jump distance so as:</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="comment">  ///   - to minimize the number of unlikely jumps used and subject to that,</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="comment">  ///   - to minimize the number of Flow == 0 jumps used and subject to that,</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="comment">  ///   - minimizes total multiplicative Flow increase for the remaining edges.</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="comment">  /// To capture this objective with integer distances, we round off fractional</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="comment">  /// parts to a multiple of 1 / BaseDistance.</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="comment"></span>  int64_t jumpDistance(<a class="code" href="structllvm_1_1FlowJump.html">FlowJump</a> *Jump)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <span class="keywordflow">if</span> (Jump-&gt;<a class="code" href="structllvm_1_1FlowJump.html#a061ed8974c636291de7f7cf5c76e4660">IsUnlikely</a>)</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      <span class="keywordflow">return</span> Params.<a class="code" href="structllvm_1_1ProfiParams.html#a8c360b59499f427030ac3969086b5cb8">CostUnlikely</a>;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> BaseDistance =</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(FlowAdjuster::MinBaseDistance,</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                 <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(Func.Blocks[Func.Entry].Flow,</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                          Params.<a class="code" href="structllvm_1_1ProfiParams.html#a8c360b59499f427030ac3969086b5cb8">CostUnlikely</a> / (2 * (NumBlocks() + 1))));</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="keywordflow">if</span> (Jump-&gt;<a class="code" href="structllvm_1_1FlowJump.html#aba9bc6e5c52dfa0898860eeadbbef59b">Flow</a> &gt; 0)</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      <span class="keywordflow">return</span> BaseDistance + BaseDistance / Jump-&gt;<a class="code" href="structllvm_1_1FlowJump.html#aba9bc6e5c52dfa0898860eeadbbef59b">Flow</a>;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="keywordflow">return</span> 2 * BaseDistance * (NumBlocks() + 1);</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  };</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160; </div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> NumBlocks()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> Func.Blocks.size(); }</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="comment">  /// Rebalance unknown subgraphs so that the flow is split evenly across the</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="comment">  /// outgoing branches of every block of the subgraph. The method iterates over</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="comment">  /// blocks with known weight and identifies unknown subgraphs rooted at the</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="comment">  /// blocks. Then it verifies if flow rebalancing is feasible and applies it.</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> rebalanceUnknownSubgraphs() {</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <span class="comment">// Try to find unknown subgraphs from each block</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="structllvm_1_1FlowBlock.html">FlowBlock</a> &amp;SrcBlock : Func.Blocks) {</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;      <span class="comment">// Verify if rebalancing rooted at SrcBlock is feasible</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      <span class="keywordflow">if</span> (!canRebalanceAtRoot(&amp;SrcBlock))</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160; </div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;      <span class="comment">// Find an unknown subgraphs starting at SrcBlock. Along the way,</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;      <span class="comment">// fill in known destinations and intermediate unknown blocks.</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      std::vector&lt;FlowBlock *&gt; UnknownBlocks;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      std::vector&lt;FlowBlock *&gt; KnownDstBlocks;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      findUnknownSubgraph(&amp;SrcBlock, KnownDstBlocks, UnknownBlocks);</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160; </div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      <span class="comment">// Verify if rebalancing of the subgraph is feasible. If the search is</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      <span class="comment">// successful, find the unique destination block (which can be null)</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;      <a class="code" href="structllvm_1_1FlowBlock.html">FlowBlock</a> *DstBlock = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      <span class="keywordflow">if</span> (!canRebalanceSubgraph(&amp;SrcBlock, KnownDstBlocks, UnknownBlocks,</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                                DstBlock))</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160; </div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;      <span class="comment">// We cannot rebalance subgraphs containing cycles among unknown blocks</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      <span class="keywordflow">if</span> (!isAcyclicSubgraph(&amp;SrcBlock, DstBlock, UnknownBlocks))</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160; </div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;      <span class="comment">// Rebalance the flow</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;      rebalanceUnknownSubgraph(&amp;SrcBlock, DstBlock, UnknownBlocks);</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    }</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  }</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment">  /// Verify if rebalancing rooted at a given block is possible.</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> canRebalanceAtRoot(<span class="keyword">const</span> <a class="code" href="structllvm_1_1FlowBlock.html">FlowBlock</a> *SrcBlock) {</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    <span class="comment">// Do not attempt to find unknown subgraphs from an unknown or a</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    <span class="comment">// zero-flow block</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="keywordflow">if</span> (SrcBlock-&gt;<a class="code" href="structllvm_1_1FlowBlock.html#aac571aba0964e18080de57124d2f9866">HasUnknownWeight</a> || SrcBlock-&gt;<a class="code" href="structllvm_1_1FlowBlock.html#a5204b5e55328f7a80fce9423c4cee8c1">Flow</a> == 0)</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160; </div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="comment">// Do not attempt to process subgraphs from a block w/o unknown sucessors</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="keywordtype">bool</span> HasUnknownSuccs = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Jump : SrcBlock-&gt;<a class="code" href="structllvm_1_1FlowBlock.html#ab471dfaaaa5b8d4801330067baab383e">SuccJumps</a>) {</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;      <span class="keywordflow">if</span> (Func.Blocks[Jump-&gt;<a class="code" href="structllvm_1_1FlowJump.html#aa017ffa5be8016e6feb941ceae7c89cc">Target</a>].HasUnknownWeight) {</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        HasUnknownSuccs = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;      }</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    }</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="keywordflow">if</span> (!HasUnknownSuccs)</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160; </div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;  }</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="comment">  /// Find an unknown subgraph starting at block SrcBlock. The method sets</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="comment">  /// identified destinations, KnownDstBlocks, and intermediate UnknownBlocks.</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> findUnknownSubgraph(<span class="keyword">const</span> <a class="code" href="structllvm_1_1FlowBlock.html">FlowBlock</a> *SrcBlock,</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                           std::vector&lt;FlowBlock *&gt; &amp;KnownDstBlocks,</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                           std::vector&lt;FlowBlock *&gt; &amp;UnknownBlocks) {</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="comment">// Run BFS from SrcBlock and make sure all paths are going through unknown</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="comment">// blocks and end at a known DstBlock</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="keyword">auto</span> Visited = <a class="code" href="classllvm_1_1BitVector.html">BitVector</a>(NumBlocks(), <span class="keyword">false</span>);</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    std::queue&lt;uint64_t&gt; Queue;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160; </div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    Queue.push(SrcBlock-&gt;<a class="code" href="structllvm_1_1FlowBlock.html#a13613f61cfca8d0f1a0f9a09f26353e0">Index</a>);</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    Visited[SrcBlock-&gt;<a class="code" href="structllvm_1_1FlowBlock.html#a13613f61cfca8d0f1a0f9a09f26353e0">Index</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keywordflow">while</span> (!Queue.empty()) {</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;      <span class="keyword">auto</span> &amp;Block = Func.Blocks[Queue.front()];</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;      Queue.pop();</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      <span class="comment">// Process blocks reachable from Block</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Jump : Block.SuccJumps) {</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        <span class="comment">// If Jump can be ignored, skip it</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        <span class="keywordflow">if</span> (ignoreJump(SrcBlock, <span class="keyword">nullptr</span>, Jump))</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160; </div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Dst = Jump-&gt;<a class="code" href="structllvm_1_1FlowJump.html#aa017ffa5be8016e6feb941ceae7c89cc">Target</a>;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        <span class="comment">// If Dst has been visited, skip Jump</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        <span class="keywordflow">if</span> (Visited[Dst])</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        <span class="comment">// Process block Dst</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        Visited[Dst] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        <span class="keywordflow">if</span> (!Func.Blocks[Dst].HasUnknownWeight) {</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;          KnownDstBlocks.<a class="code" href="classllvm_1_1BitVector.html#a78fbaa7c0fb39fae884cc54feb8c67da">push_back</a>(&amp;Func.Blocks[Dst]);</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;          Queue.push(Dst);</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;          UnknownBlocks.push_back(&amp;Func.Blocks[Dst]);</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        }</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;      }</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    }</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  }</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="comment">  /// Verify if rebalancing of the subgraph is feasible. If the checks are</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="comment">  /// successful, set the unique destination block, DstBlock (can be null).</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> canRebalanceSubgraph(<span class="keyword">const</span> <a class="code" href="structllvm_1_1FlowBlock.html">FlowBlock</a> *SrcBlock,</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;                            <span class="keyword">const</span> std::vector&lt;FlowBlock *&gt; &amp;KnownDstBlocks,</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;                            <span class="keyword">const</span> std::vector&lt;FlowBlock *&gt; &amp;UnknownBlocks,</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;                            <a class="code" href="structllvm_1_1FlowBlock.html">FlowBlock</a> *&amp;DstBlock) {</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <span class="comment">// If the list of unknown blocks is empty, we don&#39;t need rebalancing</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="keywordflow">if</span> (UnknownBlocks.empty())</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160; </div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    <span class="comment">// If there are multiple known sinks, we can&#39;t rebalance</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <span class="keywordflow">if</span> (KnownDstBlocks.size() &gt; 1)</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    DstBlock = KnownDstBlocks.empty() ? nullptr : KnownDstBlocks.front();</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160; </div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <span class="comment">// Verify sinks of the subgraph</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Block : UnknownBlocks) {</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      <span class="keywordflow">if</span> (Block-&gt;SuccJumps.empty()) {</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;        <span class="comment">// If there are multiple (known and unknown) sinks, we can&#39;t rebalance</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;        <span class="keywordflow">if</span> (DstBlock != <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;      }</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;      <span class="keywordtype">size_t</span> NumIgnoredJumps = 0;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Jump : Block-&gt;SuccJumps) {</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        <span class="keywordflow">if</span> (ignoreJump(SrcBlock, DstBlock, Jump))</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;          NumIgnoredJumps++;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;      }</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;      <span class="comment">// If there is a non-sink block in UnknownBlocks with all jumps ignored,</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      <span class="comment">// then we can&#39;t rebalance</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      <span class="keywordflow">if</span> (NumIgnoredJumps == Block-&gt;SuccJumps.size())</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    }</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160; </div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  }</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="comment">  /// Decide whether the Jump is ignored while processing an unknown subgraphs</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="comment">  /// rooted at basic block SrcBlock with the destination block, DstBlock.</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> ignoreJump(<span class="keyword">const</span> <a class="code" href="structllvm_1_1FlowBlock.html">FlowBlock</a> *SrcBlock, <span class="keyword">const</span> <a class="code" href="structllvm_1_1FlowBlock.html">FlowBlock</a> *DstBlock,</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;                  <span class="keyword">const</span> <a class="code" href="structllvm_1_1FlowJump.html">FlowJump</a> *Jump) {</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="comment">// Ignore unlikely jumps with zero flow</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <span class="keywordflow">if</span> (Jump-&gt;<a class="code" href="structllvm_1_1FlowJump.html#a061ed8974c636291de7f7cf5c76e4660">IsUnlikely</a> &amp;&amp; Jump-&gt;<a class="code" href="structllvm_1_1FlowJump.html#aba9bc6e5c52dfa0898860eeadbbef59b">Flow</a> == 0)</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160; </div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <span class="keyword">auto</span> JumpSource = &amp;Func.Blocks[Jump-&gt;<a class="code" href="structllvm_1_1FlowJump.html#ae9c91a5ea45940cfaa166511aadd2eb2">Source</a>];</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    <span class="keyword">auto</span> JumpTarget = &amp;Func.Blocks[Jump-&gt;<a class="code" href="structllvm_1_1FlowJump.html#aa017ffa5be8016e6feb941ceae7c89cc">Target</a>];</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160; </div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <span class="comment">// Do not ignore jumps coming into DstBlock</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    <span class="keywordflow">if</span> (DstBlock != <span class="keyword">nullptr</span> &amp;&amp; JumpTarget == DstBlock)</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160; </div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <span class="comment">// Ignore jumps out of SrcBlock to known blocks</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <span class="keywordflow">if</span> (!JumpTarget-&gt;HasUnknownWeight &amp;&amp; JumpSource == SrcBlock)</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160; </div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    <span class="comment">// Ignore jumps to known blocks with zero flow</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <span class="keywordflow">if</span> (!JumpTarget-&gt;HasUnknownWeight &amp;&amp; JumpTarget-&gt;Flow == 0)</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160; </div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  }</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;<span class="comment">  /// Verify if the given unknown subgraph is acyclic, and if yes, reorder</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="comment">  /// UnknownBlocks in the topological order (so that all jumps are &quot;forward&quot;).</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> isAcyclicSubgraph(<span class="keyword">const</span> <a class="code" href="structllvm_1_1FlowBlock.html">FlowBlock</a> *SrcBlock, <span class="keyword">const</span> <a class="code" href="structllvm_1_1FlowBlock.html">FlowBlock</a> *DstBlock,</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                         std::vector&lt;FlowBlock *&gt; &amp;UnknownBlocks) {</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <span class="comment">// Extract local in-degrees in the considered subgraph</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    <span class="keyword">auto</span> LocalInDegree = std::vector&lt;uint64_t&gt;(NumBlocks(), 0);</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    <span class="keyword">auto</span> fillInDegree = [&amp;](<span class="keyword">const</span> <a class="code" href="structllvm_1_1FlowBlock.html">FlowBlock</a> *Block) {</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Jump : Block-&gt;SuccJumps) {</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        <span class="keywordflow">if</span> (ignoreJump(SrcBlock, DstBlock, Jump))</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        LocalInDegree[Jump-&gt;<a class="code" href="structllvm_1_1FlowJump.html#aa017ffa5be8016e6feb941ceae7c89cc">Target</a>]++;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      }</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    };</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    fillInDegree(SrcBlock);</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Block : UnknownBlocks) {</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      fillInDegree(Block);</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    }</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="comment">// A loop containing SrcBlock</span></div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    <span class="keywordflow">if</span> (LocalInDegree[SrcBlock-&gt;<a class="code" href="structllvm_1_1FlowBlock.html#a13613f61cfca8d0f1a0f9a09f26353e0">Index</a>] &gt; 0)</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160; </div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    std::vector&lt;FlowBlock *&gt; AcyclicOrder;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    std::queue&lt;uint64_t&gt; Queue;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    Queue.push(SrcBlock-&gt;<a class="code" href="structllvm_1_1FlowBlock.html#a13613f61cfca8d0f1a0f9a09f26353e0">Index</a>);</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <span class="keywordflow">while</span> (!Queue.empty()) {</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      <a class="code" href="structllvm_1_1FlowBlock.html">FlowBlock</a> *Block = &amp;Func.Blocks[Queue.front()];</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;      Queue.pop();</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;      <span class="comment">// Stop propagation once we reach DstBlock, if any</span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;      <span class="keywordflow">if</span> (DstBlock != <span class="keyword">nullptr</span> &amp;&amp; Block == DstBlock)</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160; </div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;      <span class="comment">// Keep an acyclic order of unknown blocks</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;      <span class="keywordflow">if</span> (Block-&gt;HasUnknownWeight &amp;&amp; Block != SrcBlock)</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        AcyclicOrder.push_back(Block);</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160; </div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;      <span class="comment">// Add to the queue all successors with zero local in-degree</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Jump : Block-&gt;SuccJumps) {</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        <span class="keywordflow">if</span> (ignoreJump(SrcBlock, DstBlock, Jump))</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;        <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Dst = Jump-&gt;<a class="code" href="structllvm_1_1FlowJump.html#aa017ffa5be8016e6feb941ceae7c89cc">Target</a>;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;        LocalInDegree[Dst]--;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;        <span class="keywordflow">if</span> (LocalInDegree[Dst] == 0) {</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;          Queue.push(Dst);</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;        }</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;      }</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    }</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160; </div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <span class="comment">// If there is a cycle in the subgraph, AcyclicOrder contains only a subset</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="comment">// of all blocks</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <span class="keywordflow">if</span> (UnknownBlocks.size() != AcyclicOrder.size())</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    UnknownBlocks = AcyclicOrder;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  }</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="comment">  /// Rebalance a given subgraph rooted at SrcBlock, ending at DstBlock and</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;<span class="comment">  /// having UnknownBlocks intermediate blocks.</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> rebalanceUnknownSubgraph(<span class="keyword">const</span> <a class="code" href="structllvm_1_1FlowBlock.html">FlowBlock</a> *SrcBlock,</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;                                <span class="keyword">const</span> <a class="code" href="structllvm_1_1FlowBlock.html">FlowBlock</a> *DstBlock,</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;                                <span class="keyword">const</span> std::vector&lt;FlowBlock *&gt; &amp;UnknownBlocks) {</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SrcBlock-&gt;<a class="code" href="structllvm_1_1FlowBlock.html#a5204b5e55328f7a80fce9423c4cee8c1">Flow</a> &gt; 0 &amp;&amp; <span class="stringliteral">&quot;zero-flow block in unknown subgraph&quot;</span>);</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160; </div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <span class="comment">// Ditribute flow from the source block</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> BlockFlow = 0;</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <span class="comment">// SrcBlock&#39;s flow is the sum of outgoing flows along non-ignored jumps</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Jump : SrcBlock-&gt;<a class="code" href="structllvm_1_1FlowBlock.html#ab471dfaaaa5b8d4801330067baab383e">SuccJumps</a>) {</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;      <span class="keywordflow">if</span> (ignoreJump(SrcBlock, DstBlock, Jump))</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;      BlockFlow += Jump-&gt;<a class="code" href="structllvm_1_1FlowJump.html#aba9bc6e5c52dfa0898860eeadbbef59b">Flow</a>;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    }</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    rebalanceBlock(SrcBlock, DstBlock, SrcBlock, BlockFlow);</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160; </div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="comment">// Ditribute flow from the remaining blocks</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Block : UnknownBlocks) {</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Block-&gt;HasUnknownWeight &amp;&amp; <span class="stringliteral">&quot;incorrect unknown subgraph&quot;</span>);</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> BlockFlow = 0;</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      <span class="comment">// Block&#39;s flow is the sum of incoming flows</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Jump : Block-&gt;PredJumps) {</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        BlockFlow += Jump-&gt;<a class="code" href="structllvm_1_1FlowJump.html#aba9bc6e5c52dfa0898860eeadbbef59b">Flow</a>;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;      }</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;      Block-&gt;Flow = BlockFlow;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      rebalanceBlock(SrcBlock, DstBlock, Block, BlockFlow);</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    }</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  }</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="comment">  /// Redistribute flow for a block in a subgraph rooted at SrcBlock,</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="comment">  /// and ending at DstBlock.</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> rebalanceBlock(<span class="keyword">const</span> <a class="code" href="structllvm_1_1FlowBlock.html">FlowBlock</a> *SrcBlock, <span class="keyword">const</span> <a class="code" href="structllvm_1_1FlowBlock.html">FlowBlock</a> *DstBlock,</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;                      <span class="keyword">const</span> <a class="code" href="structllvm_1_1FlowBlock.html">FlowBlock</a> *Block, <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> BlockFlow) {</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    <span class="comment">// Process all successor jumps and update corresponding flow values</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    <span class="keywordtype">size_t</span> BlockDegree = 0;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Jump : Block-&gt;SuccJumps) {</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;      <span class="keywordflow">if</span> (ignoreJump(SrcBlock, DstBlock, Jump))</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;      BlockDegree++;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    }</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    <span class="comment">// If all successor jumps of the block are ignored, skip it</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <span class="keywordflow">if</span> (DstBlock == <span class="keyword">nullptr</span> &amp;&amp; BlockDegree == 0)</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BlockDegree &gt; 0 &amp;&amp; <span class="stringliteral">&quot;all outgoing jumps are ignored&quot;</span>);</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160; </div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="comment">// Each of the Block&#39;s successors gets the following amount of flow.</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    <span class="comment">// Rounding the value up so that all flow is propagated</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> SuccFlow = (BlockFlow + BlockDegree - 1) / BlockDegree;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Jump : Block-&gt;SuccJumps) {</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;      <span class="keywordflow">if</span> (ignoreJump(SrcBlock, DstBlock, Jump))</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;      <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> <a class="code" href="SIAnnotateControlFlow_8cpp.html#acf797fa91d5b7065dfb68a2492df28c1">Flow</a> = <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(SuccFlow, BlockFlow);</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;      Jump-&gt;<a class="code" href="structllvm_1_1FlowJump.html#aba9bc6e5c52dfa0898860eeadbbef59b">Flow</a> = <a class="code" href="SIAnnotateControlFlow_8cpp.html#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      BlockFlow -= <a class="code" href="SIAnnotateControlFlow_8cpp.html#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    }</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BlockFlow == 0 &amp;&amp; <span class="stringliteral">&quot;not all flow is propagated&quot;</span>);</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  }</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="comment">  /// A constant indicating an arbitrary exit block of a function.</span></div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> constexpr <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> AnyExitBlock = <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a>(-1);<span class="comment"></span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="comment">  /// Minimum BaseDistance for the jump distance values in island joining.</span></div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> constexpr <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> MinBaseDistance = 10000;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="comment">  /// Params for flow computation.</span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="comment"></span>  <span class="keyword">const</span> <a class="code" href="structllvm_1_1ProfiParams.html">ProfiParams</a> &amp;Params;<span class="comment"></span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="comment">  /// The function.</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="comment"></span>  <a class="code" href="structllvm_1_1FlowFunction.html">FlowFunction</a> &amp;Func;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;};</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160; </div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;std::pair&lt;int64_t, int64_t&gt; assignBlockCosts(<span class="keyword">const</span> <a class="code" href="structllvm_1_1ProfiParams.html">ProfiParams</a> &amp;Params,</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                                             <span class="keyword">const</span> <a class="code" href="structllvm_1_1FlowBlock.html">FlowBlock</a> &amp;Block);</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;std::pair&lt;int64_t, int64_t&gt; assignJumpCosts(<span class="keyword">const</span> <a class="code" href="structllvm_1_1ProfiParams.html">ProfiParams</a> &amp;Params,</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;                                            <span class="keyword">const</span> <a class="code" href="structllvm_1_1FlowJump.html">FlowJump</a> &amp;Jump);</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="comment">/// Initializing flow network for a given function.</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="comment">/// Every block is split into two nodes that are responsible for (i) an</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment">/// incoming flow, (ii) an outgoing flow; they penalize an increase or a</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment">/// reduction of the block weight.</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> initializeNetwork(<span class="keyword">const</span> <a class="code" href="structllvm_1_1ProfiParams.html">ProfiParams</a> &amp;Params, MinCostMaxFlow &amp;Network,</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;                       <a class="code" href="structllvm_1_1FlowFunction.html">FlowFunction</a> &amp;Func) {</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> NumBlocks = Func.Blocks.size();</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NumBlocks &gt; 1 &amp;&amp; <span class="stringliteral">&quot;Too few blocks in a function&quot;</span>);</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> NumJumps = Func.Jumps.size();</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NumJumps &gt; 0 &amp;&amp; <span class="stringliteral">&quot;Too few jumps in a function&quot;</span>);</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160; </div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  <span class="comment">// Introducing dummy source/sink pairs to allow flow circulation.</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  <span class="comment">// The nodes corresponding to blocks of the function have indicies in</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  <span class="comment">// the range [0 .. 2 * NumBlocks); the dummy sources/sinks are indexed by the</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  <span class="comment">// next four values.</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = 2 * NumBlocks;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> <a class="code" href="classT.html">T</a> = <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> + 1;</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> S1 = <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> + 2;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> <a class="code" href="Mips16ISelLowering_8cpp.html#ac16509a75e3d3fc46b9df1726be486ec">T1</a> = <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> + 3;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160; </div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;  Network.initialize(2 * NumBlocks + 4, S1, <a class="code" href="Mips16ISelLowering_8cpp.html#ac16509a75e3d3fc46b9df1726be486ec">T1</a>);</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160; </div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;  <span class="comment">// Initialize nodes of the flow network</span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a> = 0; <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a> &lt; NumBlocks; <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>++) {</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="keyword">auto</span> &amp;Block = Func.Blocks[<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>];</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160; </div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    <span class="comment">// Split every block into two auxiliary nodes to allow</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <span class="comment">// increase/reduction of the block count.</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> <a class="code" href="namespacellvm.html#a372f87e2cac1c83389c98554dc44806da807dbe7d1c25a633894d4a231b1c76d3">Bin</a> = 2 * <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Bout = 2 * <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a> + 1;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160; </div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    <span class="comment">// Edges from S and to T</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <span class="keywordflow">if</span> (Block.isEntry()) {</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;      Network.addEdge(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, <a class="code" href="namespacellvm.html#a372f87e2cac1c83389c98554dc44806da807dbe7d1c25a633894d4a231b1c76d3">Bin</a>, 0);</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Block.isExit()) {</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;      Network.addEdge(Bout, <a class="code" href="classT.html">T</a>, 0);</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    }</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160; </div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="comment">// Assign costs for increasing/decreasing the block counts</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <span class="keyword">auto</span> [AuxCostInc, AuxCostDec] = assignBlockCosts(Params, Block);</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160; </div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <span class="comment">// Add the corresponding edges to the network</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    Network.addEdge(<a class="code" href="namespacellvm.html#a372f87e2cac1c83389c98554dc44806da807dbe7d1c25a633894d4a231b1c76d3">Bin</a>, Bout, AuxCostInc);</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    <span class="keywordflow">if</span> (Block.Weight &gt; 0) {</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;      Network.addEdge(Bout, <a class="code" href="namespacellvm.html#a372f87e2cac1c83389c98554dc44806da807dbe7d1c25a633894d4a231b1c76d3">Bin</a>, Block.Weight, AuxCostDec);</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;      Network.addEdge(S1, Bout, Block.Weight, 0);</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;      Network.addEdge(<a class="code" href="namespacellvm.html#a372f87e2cac1c83389c98554dc44806da807dbe7d1c25a633894d4a231b1c76d3">Bin</a>, <a class="code" href="Mips16ISelLowering_8cpp.html#ac16509a75e3d3fc46b9df1726be486ec">T1</a>, Block.Weight, 0);</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    }</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  }</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160; </div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  <span class="comment">// Initialize edges of the flow network</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> J = 0; J &lt; NumJumps; J++) {</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <span class="keyword">auto</span> &amp;Jump = Func.Jumps[J];</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160; </div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    <span class="comment">// Get the endpoints corresponding to the jump</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Jin = 2 * Jump.<a class="code" href="structllvm_1_1FlowJump.html#ae9c91a5ea45940cfaa166511aadd2eb2">Source</a> + 1;</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Jout = 2 * Jump.<a class="code" href="structllvm_1_1FlowJump.html#aa017ffa5be8016e6feb941ceae7c89cc">Target</a>;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160; </div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    <span class="comment">// Assign costs for increasing/decreasing the jump counts</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    <span class="keyword">auto</span> [AuxCostInc, AuxCostDec] = assignJumpCosts(Params, Jump);</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160; </div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    <span class="comment">// Add the corresponding edges to the network</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    Network.addEdge(Jin, Jout, AuxCostInc);</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    <span class="keywordflow">if</span> (Jump.<a class="code" href="structllvm_1_1FlowJump.html#acdd34566a25bab9890d87c9de6e7e8b0">Weight</a> &gt; 0) {</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      Network.addEdge(Jout, Jin, Jump.<a class="code" href="structllvm_1_1FlowJump.html#acdd34566a25bab9890d87c9de6e7e8b0">Weight</a>, AuxCostDec);</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;      Network.addEdge(S1, Jout, Jump.<a class="code" href="structllvm_1_1FlowJump.html#acdd34566a25bab9890d87c9de6e7e8b0">Weight</a>, 0);</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;      Network.addEdge(Jin, <a class="code" href="Mips16ISelLowering_8cpp.html#ac16509a75e3d3fc46b9df1726be486ec">T1</a>, Jump.<a class="code" href="structllvm_1_1FlowJump.html#acdd34566a25bab9890d87c9de6e7e8b0">Weight</a>, 0);</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    }</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;  }</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160; </div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  <span class="comment">// Make sure we have a valid flow circulation</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;  Network.addEdge(<a class="code" href="classT.html">T</a>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, 0);</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;}</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="comment">/// Assign costs for increasing/decreasing the block counts.</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="comment"></span>std::pair&lt;int64_t, int64_t&gt; assignBlockCosts(<span class="keyword">const</span> <a class="code" href="structllvm_1_1ProfiParams.html">ProfiParams</a> &amp;Params,</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                                             <span class="keyword">const</span> <a class="code" href="structllvm_1_1FlowBlock.html">FlowBlock</a> &amp;Block) {</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;  <span class="comment">// Modifying the weight of an unlikely block is expensive</span></div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;  <span class="keywordflow">if</span> (Block.IsUnlikely)</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    <span class="keywordflow">return</span> std::make_pair(Params.<a class="code" href="structllvm_1_1ProfiParams.html#a8c360b59499f427030ac3969086b5cb8">CostUnlikely</a>, Params.<a class="code" href="structllvm_1_1ProfiParams.html#a8c360b59499f427030ac3969086b5cb8">CostUnlikely</a>);</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160; </div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;  <span class="comment">// Assign default values for the costs</span></div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;  int64_t CostInc = Params.<a class="code" href="structllvm_1_1ProfiParams.html#a39401e9ddaa84e388f7114f9f3b77c7e">CostBlockInc</a>;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;  int64_t CostDec = Params.<a class="code" href="structllvm_1_1ProfiParams.html#adcd8b45086bba7f4515e3e3d8fef41dc">CostBlockDec</a>;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;  <span class="comment">// Update the costs depending on the block metadata</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  <span class="keywordflow">if</span> (Block.HasUnknownWeight) {</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    CostInc = Params.<a class="code" href="structllvm_1_1ProfiParams.html#ad0fab235dca463ec9d48c5b6bfe9ccde">CostBlockUnknownInc</a>;</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    CostDec = 0;</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    <span class="comment">// Increasing the count for &quot;cold&quot; blocks with zero initial count is more</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    <span class="comment">// expensive than for &quot;hot&quot; ones</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    <span class="keywordflow">if</span> (Block.Weight == 0)</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;      CostInc = Params.<a class="code" href="structllvm_1_1ProfiParams.html#a9e351546ca08436a0e7a7ccfa08f5495">CostBlockZeroInc</a>;</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    <span class="comment">// Modifying the count of the entry block is expensive</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    <span class="keywordflow">if</span> (Block.isEntry()) {</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      CostInc = Params.<a class="code" href="structllvm_1_1ProfiParams.html#af820f5e80ca4cd2a823d4dbd16714bc1">CostBlockEntryInc</a>;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;      CostDec = Params.<a class="code" href="structllvm_1_1ProfiParams.html#aaa7f2d292f152d77537be66c67cd2008">CostBlockEntryDec</a>;</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    }</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  }</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;  <span class="keywordflow">return</span> std::make_pair(CostInc, CostDec);</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;}</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<span class="comment">/// Assign costs for increasing/decreasing the jump counts.</span></div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;<span class="comment"></span>std::pair&lt;int64_t, int64_t&gt; assignJumpCosts(<span class="keyword">const</span> <a class="code" href="structllvm_1_1ProfiParams.html">ProfiParams</a> &amp;Params,</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;                                            <span class="keyword">const</span> <a class="code" href="structllvm_1_1FlowJump.html">FlowJump</a> &amp;Jump) {</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;  <span class="comment">// Modifying the weight of an unlikely jump is expensive</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;  <span class="keywordflow">if</span> (Jump.<a class="code" href="structllvm_1_1FlowJump.html#a061ed8974c636291de7f7cf5c76e4660">IsUnlikely</a>)</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    <span class="keywordflow">return</span> std::make_pair(Params.<a class="code" href="structllvm_1_1ProfiParams.html#a8c360b59499f427030ac3969086b5cb8">CostUnlikely</a>, Params.<a class="code" href="structllvm_1_1ProfiParams.html#a8c360b59499f427030ac3969086b5cb8">CostUnlikely</a>);</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160; </div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;  <span class="comment">// Assign default values for the costs</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  int64_t CostInc = Params.<a class="code" href="structllvm_1_1ProfiParams.html#ac04da42f4440b9ea85d4ae6400b4e8ce">CostJumpInc</a>;</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  int64_t CostDec = Params.<a class="code" href="structllvm_1_1ProfiParams.html#a94bec6d7c1e0827854d72091aacf81f7">CostJumpDec</a>;</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;  <span class="comment">// Update the costs depending on the block metadata</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  <span class="keywordflow">if</span> (Jump.<a class="code" href="structllvm_1_1FlowJump.html#ae9c91a5ea45940cfaa166511aadd2eb2">Source</a> + 1 == Jump.<a class="code" href="structllvm_1_1FlowJump.html#aa017ffa5be8016e6feb941ceae7c89cc">Target</a>) {</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <span class="comment">// Adjusting the fall-through branch</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    CostInc = Params.<a class="code" href="structllvm_1_1ProfiParams.html#a55e432c2b9b6e25f5a83f1d5ac7655b7">CostJumpFTInc</a>;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    CostDec = Params.<a class="code" href="structllvm_1_1ProfiParams.html#adb1dd7977642b5222b9fac44305f562e">CostJumpFTDec</a>;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;  }</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  <span class="keywordflow">if</span> (Jump.<a class="code" href="structllvm_1_1FlowJump.html#a491b58e7abf9b59f256a3c66443a1ad5">HasUnknownWeight</a>) {</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <span class="comment">// The cost is different for fall-through and non-fall-through branches</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <span class="keywordflow">if</span> (Jump.<a class="code" href="structllvm_1_1FlowJump.html#ae9c91a5ea45940cfaa166511aadd2eb2">Source</a> + 1 == Jump.<a class="code" href="structllvm_1_1FlowJump.html#aa017ffa5be8016e6feb941ceae7c89cc">Target</a>)</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;      CostInc = Params.<a class="code" href="structllvm_1_1ProfiParams.html#a2aa4f0b714c6b54a55b97af255f6f62c">CostJumpUnknownFTInc</a>;</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;      CostInc = Params.<a class="code" href="structllvm_1_1ProfiParams.html#acecc0d05ec41075cc30e0c9bbb0c20b9">CostJumpUnknownInc</a>;</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    CostDec = 0;</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Jump.<a class="code" href="structllvm_1_1FlowJump.html#acdd34566a25bab9890d87c9de6e7e8b0">Weight</a> &gt; 0 &amp;&amp; <span class="stringliteral">&quot;found zero-weight jump with a positive weight&quot;</span>);</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  }</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;  <span class="keywordflow">return</span> std::make_pair(CostInc, CostDec);</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;}</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="comment">/// Extract resulting block and edge counts from the flow network.</span></div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> extractWeights(<span class="keyword">const</span> <a class="code" href="structllvm_1_1ProfiParams.html">ProfiParams</a> &amp;Params, MinCostMaxFlow &amp;Network,</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;                    <a class="code" href="structllvm_1_1FlowFunction.html">FlowFunction</a> &amp;Func) {</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> NumBlocks = Func.Blocks.size();</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> NumJumps = Func.Jumps.size();</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160; </div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;  <span class="comment">// Extract resulting jump counts</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> J = 0; J &lt; NumJumps; J++) {</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <span class="keyword">auto</span> &amp;Jump = Func.Jumps[J];</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> SrcOut = 2 * Jump.<a class="code" href="structllvm_1_1FlowJump.html#ae9c91a5ea45940cfaa166511aadd2eb2">Source</a> + 1;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> DstIn = 2 * Jump.<a class="code" href="structllvm_1_1FlowJump.html#aa017ffa5be8016e6feb941ceae7c89cc">Target</a>;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160; </div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    int64_t <a class="code" href="SIAnnotateControlFlow_8cpp.html#acf797fa91d5b7065dfb68a2492df28c1">Flow</a> = 0;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    int64_t AuxFlow = Network.getFlow(SrcOut, DstIn);</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    <span class="keywordflow">if</span> (Jump.<a class="code" href="structllvm_1_1FlowJump.html#ae9c91a5ea45940cfaa166511aadd2eb2">Source</a> != Jump.<a class="code" href="structllvm_1_1FlowJump.html#aa017ffa5be8016e6feb941ceae7c89cc">Target</a>)</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;      <a class="code" href="SIAnnotateControlFlow_8cpp.html#acf797fa91d5b7065dfb68a2492df28c1">Flow</a> = int64_t(Jump.<a class="code" href="structllvm_1_1FlowJump.html#acdd34566a25bab9890d87c9de6e7e8b0">Weight</a>) + AuxFlow;</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;      <a class="code" href="SIAnnotateControlFlow_8cpp.html#acf797fa91d5b7065dfb68a2492df28c1">Flow</a> = int64_t(Jump.<a class="code" href="structllvm_1_1FlowJump.html#acdd34566a25bab9890d87c9de6e7e8b0">Weight</a>) + (AuxFlow &gt; 0 ? AuxFlow : 0);</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160; </div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    Jump.<a class="code" href="structllvm_1_1FlowJump.html#aba9bc6e5c52dfa0898860eeadbbef59b">Flow</a> = <a class="code" href="SIAnnotateControlFlow_8cpp.html#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="SIAnnotateControlFlow_8cpp.html#acf797fa91d5b7065dfb68a2492df28c1">Flow</a> &gt;= 0 &amp;&amp; <span class="stringliteral">&quot;negative jump flow&quot;</span>);</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;  }</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160; </div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;  <span class="comment">// Extract resulting block counts</span></div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  <span class="keyword">auto</span> InFlow = std::vector&lt;uint64_t&gt;(NumBlocks, 0);</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;  <span class="keyword">auto</span> OutFlow = std::vector&lt;uint64_t&gt;(NumBlocks, 0);</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Jump : Func.Jumps) {</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    InFlow[Jump.<a class="code" href="structllvm_1_1FlowJump.html#aa017ffa5be8016e6feb941ceae7c89cc">Target</a>] += Jump.<a class="code" href="structllvm_1_1FlowJump.html#aba9bc6e5c52dfa0898860eeadbbef59b">Flow</a>;</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    OutFlow[Jump.<a class="code" href="structllvm_1_1FlowJump.html#ae9c91a5ea45940cfaa166511aadd2eb2">Source</a>] += Jump.<a class="code" href="structllvm_1_1FlowJump.html#aba9bc6e5c52dfa0898860eeadbbef59b">Flow</a>;</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;  }</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a> = 0; <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a> &lt; NumBlocks; <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>++) {</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    <span class="keyword">auto</span> &amp;Block = Func.Blocks[<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>];</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    Block.Flow = <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(OutFlow[<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>], InFlow[<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>]);</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;  }</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;}</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160; </div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;<span class="comment">/// Verify that the provided block/jump weights are as expected.</span></div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> verifyInput(<span class="keyword">const</span> <a class="code" href="structllvm_1_1FlowFunction.html">FlowFunction</a> &amp;Func) {</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  <span class="comment">// Verify the entry block</span></div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Func.Entry == 0 &amp;&amp; Func.Blocks[0].isEntry());</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 1; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; Func.Blocks.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) {</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!Func.Blocks[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].isEntry() &amp;&amp; <span class="stringliteral">&quot;multiple entry blocks&quot;</span>);</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;  }</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;  <span class="comment">// Verify CFG jumps</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Block : Func.Blocks) {</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!Block.isEntry() || !Block.isExit()) &amp;&amp;</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;           <span class="stringliteral">&quot;a block cannot be an entry and an exit&quot;</span>);</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  }</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  <span class="comment">// Verify input block weights</span></div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Block : Func.Blocks) {</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!Block.HasUnknownWeight || Block.Weight == 0 || Block.isEntry()) &amp;&amp;</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;           <span class="stringliteral">&quot;non-zero weight of a block w/o weight except for an entry&quot;</span>);</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;  }</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  <span class="comment">// Verify input jump weights</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Jump : Func.Jumps) {</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!Jump.<a class="code" href="structllvm_1_1FlowJump.html#a491b58e7abf9b59f256a3c66443a1ad5">HasUnknownWeight</a> || Jump.<a class="code" href="structllvm_1_1FlowJump.html#acdd34566a25bab9890d87c9de6e7e8b0">Weight</a> == 0) &amp;&amp;</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;           <span class="stringliteral">&quot;non-zero weight of a jump w/o weight&quot;</span>);</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  }</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;}</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;<span class="comment">/// Verify that the computed flow values satisfy flow conservation rules.</span></div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> verifyOutput(<span class="keyword">const</span> <a class="code" href="structllvm_1_1FlowFunction.html">FlowFunction</a> &amp;Func) {</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;  <span class="keyword">const</span> <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> NumBlocks = Func.Blocks.size();</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;  <span class="keyword">auto</span> InFlow = std::vector&lt;uint64_t&gt;(NumBlocks, 0);</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;  <span class="keyword">auto</span> OutFlow = std::vector&lt;uint64_t&gt;(NumBlocks, 0);</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;Jump : Func.Jumps) {</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    InFlow[Jump.<a class="code" href="structllvm_1_1FlowJump.html#aa017ffa5be8016e6feb941ceae7c89cc">Target</a>] += Jump.<a class="code" href="structllvm_1_1FlowJump.html#aba9bc6e5c52dfa0898860eeadbbef59b">Flow</a>;</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    OutFlow[Jump.<a class="code" href="structllvm_1_1FlowJump.html#ae9c91a5ea45940cfaa166511aadd2eb2">Source</a>] += Jump.<a class="code" href="structllvm_1_1FlowJump.html#aba9bc6e5c52dfa0898860eeadbbef59b">Flow</a>;</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;  }</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160; </div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> TotalInFlow = 0;</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> TotalOutFlow = 0;</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumBlocks; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) {</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    <span class="keyword">auto</span> &amp;Block = Func.Blocks[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    <span class="keywordflow">if</span> (Block.isEntry()) {</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;      TotalInFlow += Block.Flow;</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Block.Flow == OutFlow[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] &amp;&amp; <span class="stringliteral">&quot;incorrectly computed control flow&quot;</span>);</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Block.isExit()) {</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;      TotalOutFlow += Block.Flow;</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Block.Flow == InFlow[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] &amp;&amp; <span class="stringliteral">&quot;incorrectly computed control flow&quot;</span>);</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Block.Flow == OutFlow[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] &amp;&amp; <span class="stringliteral">&quot;incorrectly computed control flow&quot;</span>);</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Block.Flow == InFlow[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] &amp;&amp; <span class="stringliteral">&quot;incorrectly computed control flow&quot;</span>);</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    }</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  }</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TotalInFlow == TotalOutFlow &amp;&amp; <span class="stringliteral">&quot;incorrectly computed control flow&quot;</span>);</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160; </div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;  <span class="comment">// Verify that there are no isolated flow components</span></div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  <span class="comment">// One could modify FlowFunction to hold edges indexed by the sources, which</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;  <span class="comment">// will avoid a creation of the object</span></div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;  <span class="keyword">auto</span> PositiveFlowEdges = std::vector&lt;std::vector&lt;uint64_t&gt;&gt;(NumBlocks);</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;Jump : Func.Jumps) {</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    <span class="keywordflow">if</span> (Jump.<a class="code" href="structllvm_1_1FlowJump.html#aba9bc6e5c52dfa0898860eeadbbef59b">Flow</a> &gt; 0) {</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;      PositiveFlowEdges[Jump.<a class="code" href="structllvm_1_1FlowJump.html#ae9c91a5ea45940cfaa166511aadd2eb2">Source</a>].push_back(Jump.<a class="code" href="structllvm_1_1FlowJump.html#aa017ffa5be8016e6feb941ceae7c89cc">Target</a>);</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    }</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;  }</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160; </div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;  <span class="comment">// Run BFS from the source along edges with positive flow</span></div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;  std::queue&lt;uint64_t&gt; Queue;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;  <span class="keyword">auto</span> Visited = <a class="code" href="classllvm_1_1BitVector.html">BitVector</a>(NumBlocks, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;  Queue.push(Func.Entry);</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  Visited[Func.Entry] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;  <span class="keywordflow">while</span> (!Queue.empty()) {</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Src = Queue.front();</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    Queue.pop();</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Dst : PositiveFlowEdges[Src]) {</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;      <span class="keywordflow">if</span> (!Visited[Dst]) {</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;        Queue.push(Dst);</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;        Visited[Dst] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;      }</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    }</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;  }</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160; </div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;  <span class="comment">// Verify that every block that has a positive flow is reached from the source</span></div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;  <span class="comment">// along edges with a positive flow</span></div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumBlocks; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) {</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    <span class="keyword">auto</span> &amp;Block = Func.Blocks[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((Visited[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] || Block.Flow == 0) &amp;&amp; <span class="stringliteral">&quot;an isolated flow component&quot;</span>);</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;  }</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;}</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160; </div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;} <span class="comment">// end of anonymous namespace</span></div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;<span class="comment">/// Apply the profile inference algorithm for a given function</span></div>
<div class="line"><a name="l01308"></a><span class="lineno"><a class="line" href="namespacellvm.html#af962cc3b6565966cbc3d5c1289f31a11"> 1308</a></span>&#160;<span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#af962cc3b6565966cbc3d5c1289f31a11">llvm::applyFlowInference</a>(<span class="keyword">const</span> <a class="code" href="structllvm_1_1ProfiParams.html">ProfiParams</a> &amp;Params, <a class="code" href="structllvm_1_1FlowFunction.html">FlowFunction</a> &amp;Func) {</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;  <span class="comment">// Verify the input data</span></div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;  verifyInput(Func);</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160; </div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;  <span class="comment">// Create and apply an inference network model</span></div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;  <span class="keyword">auto</span> InferenceNetwork = MinCostMaxFlow(Params);</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;  initializeNetwork(Params, InferenceNetwork, Func);</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;  InferenceNetwork.run();</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160; </div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;  <span class="comment">// Extract flow values for every block and every edge</span></div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;  extractWeights(Params, InferenceNetwork, Func);</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160; </div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;  <span class="comment">// Post-processing adjustments to the flow</span></div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;  <span class="keyword">auto</span> Adjuster = FlowAdjuster(Params, Func);</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;  Adjuster.run();</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160; </div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;  <span class="comment">// Verify the result</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;  verifyOutput(Func);</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;}</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="comment">/// Apply the profile inference algorithm for a given flow function</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"><a class="line" href="namespacellvm.html#a97df254bc8c63986dc57817f0f553de9"> 1333</a></span>&#160;<span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#af962cc3b6565966cbc3d5c1289f31a11">llvm::applyFlowInference</a>(<a class="code" href="structllvm_1_1FlowFunction.html">FlowFunction</a> &amp;Func) {</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;  <a class="code" href="structllvm_1_1ProfiParams.html">ProfiParams</a> Params;</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;  <span class="comment">// Set the params from the command-line flags.</span></div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  Params.<a class="code" href="structllvm_1_1ProfiParams.html#afa5c8536542aef51080617f59b7a4756">EvenFlowDistribution</a> = SampleProfileEvenFlowDistribution;</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  Params.<a class="code" href="structllvm_1_1ProfiParams.html#a720bd9ea72871723cd4a8e413c40cf82">RebalanceUnknown</a> = SampleProfileRebalanceUnknown;</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;  Params.<a class="code" href="structllvm_1_1ProfiParams.html#a97439d73a5716992c931f74c45485fda">JoinIslands</a> = SampleProfileJoinIslands;</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;  Params.<a class="code" href="structllvm_1_1ProfiParams.html#a39401e9ddaa84e388f7114f9f3b77c7e">CostBlockInc</a> = SampleProfileProfiCostBlockInc;</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;  Params.<a class="code" href="structllvm_1_1ProfiParams.html#adcd8b45086bba7f4515e3e3d8fef41dc">CostBlockDec</a> = SampleProfileProfiCostBlockDec;</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;  Params.<a class="code" href="structllvm_1_1ProfiParams.html#af820f5e80ca4cd2a823d4dbd16714bc1">CostBlockEntryInc</a> = SampleProfileProfiCostBlockEntryInc;</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;  Params.<a class="code" href="structllvm_1_1ProfiParams.html#aaa7f2d292f152d77537be66c67cd2008">CostBlockEntryDec</a> = SampleProfileProfiCostBlockEntryDec;</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;  Params.<a class="code" href="structllvm_1_1ProfiParams.html#a9e351546ca08436a0e7a7ccfa08f5495">CostBlockZeroInc</a> = SampleProfileProfiCostBlockZeroInc;</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;  Params.<a class="code" href="structllvm_1_1ProfiParams.html#ad0fab235dca463ec9d48c5b6bfe9ccde">CostBlockUnknownInc</a> = SampleProfileProfiCostBlockUnknownInc;</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160; </div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;  <a class="code" href="namespacellvm.html#af962cc3b6565966cbc3d5c1289f31a11">applyFlowInference</a>(Params, Func);</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="astructllvm_1_1FlowJump_html_a491b58e7abf9b59f256a3c66443a1ad5"><div class="ttname"><a href="structllvm_1_1FlowJump.html#a491b58e7abf9b59f256a3c66443a1ad5">llvm::FlowJump::HasUnknownWeight</a></div><div class="ttdeci">bool HasUnknownWeight</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00069">SampleProfileInference.h:69</a></div></div>
<div class="ttc" id="astructllvm_1_1ProfiParams_html_af820f5e80ca4cd2a823d4dbd16714bc1"><div class="ttname"><a href="structllvm_1_1ProfiParams.html#af820f5e80ca4cd2a823d4dbd16714bc1">llvm::ProfiParams::CostBlockEntryInc</a></div><div class="ttdeci">unsigned CostBlockEntryInc</div><div class="ttdoc">The cost of increasing the entry block's count by one.</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00107">SampleProfileInference.h:107</a></div></div>
<div class="ttc" id="aclassllvm_1_1BitVector_html_a78fbaa7c0fb39fae884cc54feb8c67da"><div class="ttname"><a href="classllvm_1_1BitVector.html#a78fbaa7c0fb39fae884cc54feb8c67da">llvm::BitVector::push_back</a></div><div class="ttdeci">void push_back(bool Val)</div><div class="ttdef"><b>Definition:</b> <a href="BitVector_8h_source.html#l00459">BitVector.h:459</a></div></div>
<div class="ttc" id="anamespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">This is an optimization pass for GlobalISel generic memory operations.</div><div class="ttdef"><b>Definition:</b> <a href="AddressRanges_8h_source.html#l00018">AddressRanges.h:18</a></div></div>
<div class="ttc" id="aclassT_html"><div class="ttname"><a href="classT.html">T</a></div></div>
<div class="ttc" id="astructllvm_1_1ProfiParams_html_adb1dd7977642b5222b9fac44305f562e"><div class="ttname"><a href="structllvm_1_1ProfiParams.html#adb1dd7977642b5222b9fac44305f562e">llvm::ProfiParams::CostJumpFTDec</a></div><div class="ttdeci">unsigned CostJumpFTDec</div><div class="ttdoc">The cost of decreasing a fall-through jump's count by one.</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00125">SampleProfileInference.h:125</a></div></div>
<div class="ttc" id="aLazyCallGraph_8cpp_html_aec802e48dd5ef69029e285eddfc4158d"><div class="ttname"><a href="LazyCallGraph_8cpp.html#aec802e48dd5ef69029e285eddfc4158d">addEdge</a></div><div class="ttdeci">static void addEdge(SmallVectorImpl&lt; LazyCallGraph::Edge &gt; &amp;Edges, DenseMap&lt; LazyCallGraph::Node *, int &gt; &amp;EdgeIndexMap, LazyCallGraph::Node &amp;N, LazyCallGraph::Edge::Kind EK)</div><div class="ttdef"><b>Definition:</b> <a href="LazyCallGraph_8cpp_source.html#l00060">LazyCallGraph.cpp:60</a></div></div>
<div class="ttc" id="aclassllvm_1_1Target_html"><div class="ttname"><a href="classllvm_1_1Target.html">llvm::Target</a></div><div class="ttdoc">Target - Wrapper for Target specific information.</div><div class="ttdef"><b>Definition:</b> <a href="TargetRegistry_8h_source.html#l00149">TargetRegistry.h:149</a></div></div>
<div class="ttc" id="aREADME-SSE_8txt_html_a698e4bd87a8adc0c042ae6b6e10ee6e1"><div class="ttname"><a href="README-SSE_8txt.html#a698e4bd87a8adc0c042ae6b6e10ee6e1">double</a></div><div class="ttdeci">into xmm2 addss xmm2 xmm1 xmm3 addss xmm3 movaps xmm0 unpcklps xmm0 ret seems silly when it could just be one addps Expand libm rounding functions main should enable SSE DAZ mode and other fast SSE modes Think about doing i64 math in SSE regs on x86 This testcase should have no SSE instructions in and only one load from a constant double</div><div class="ttdef"><b>Definition:</b> <a href="README-SSE_8txt_source.html#l00085">README-SSE.txt:85</a></div></div>
<div class="ttc" id="astructllvm_1_1ProfiParams_html_a720bd9ea72871723cd4a8e413c40cf82"><div class="ttname"><a href="structllvm_1_1ProfiParams.html#a720bd9ea72871723cd4a8e413c40cf82">llvm::ProfiParams::RebalanceUnknown</a></div><div class="ttdeci">bool RebalanceUnknown</div><div class="ttdoc">Evenly re-distribute flow among unknown subgraphs.</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00092">SampleProfileInference.h:92</a></div></div>
<div class="ttc" id="anamespacellvm_1_1cl_html_a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6"><div class="ttname"><a href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">llvm::cl::Hidden</a></div><div class="ttdeci">@ Hidden</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00138">CommandLine.h:138</a></div></div>
<div class="ttc" id="astructllvm_1_1ProfiParams_html_a39401e9ddaa84e388f7114f9f3b77c7e"><div class="ttname"><a href="structllvm_1_1ProfiParams.html#a39401e9ddaa84e388f7114f9f3b77c7e">llvm::ProfiParams::CostBlockInc</a></div><div class="ttdeci">unsigned CostBlockInc</div><div class="ttdoc">The cost of increasing a block's count by one.</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00098">SampleProfileInference.h:98</a></div></div>
<div class="ttc" id="aMips16ISelLowering_8cpp_html_ac16509a75e3d3fc46b9df1726be486ec"><div class="ttname"><a href="Mips16ISelLowering_8cpp.html#ac16509a75e3d3fc46b9df1726be486ec">T1</a></div><div class="ttdeci">#define T1</div><div class="ttdef"><b>Definition:</b> <a href="Mips16ISelLowering_8cpp_source.html#l00340">Mips16ISelLowering.cpp:340</a></div></div>
<div class="ttc" id="astructllvm_1_1ProfiParams_html_a8c360b59499f427030ac3969086b5cb8"><div class="ttname"><a href="structllvm_1_1ProfiParams.html#a8c360b59499f427030ac3969086b5cb8">llvm::ProfiParams::CostUnlikely</a></div><div class="ttdeci">const int64_t CostUnlikely</div><div class="ttdoc">The cost of taking an unlikely block/jump.</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00134">SampleProfileInference.h:134</a></div></div>
<div class="ttc" id="anamespacellvm_html_ab4d4bc901fedd8857f647dcc2c0d71de"><div class="ttname"><a href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">llvm::max</a></div><div class="ttdeci">Expected&lt; ExpressionValue &gt; max(const ExpressionValue &amp;Lhs, const ExpressionValue &amp;Rhs)</div><div class="ttdef"><b>Definition:</b> <a href="FileCheck_8cpp_source.html#l00337">FileCheck.cpp:337</a></div></div>
<div class="ttc" id="aSampleProfileInference_8h_html"><div class="ttname"><a href="SampleProfileInference_8h.html">SampleProfileInference.h</a></div></div>
<div class="ttc" id="aclassNode_html_a7a56ed6baec69c476df398caa5c9aef5"><div class="ttname"><a href="classNode.html#a7a56ed6baec69c476df398caa5c9aef5">Node::Node</a></div><div class="ttdeci">Node(Kind K_, Prec Precedence_=Prec::Primary, Cache RHSComponentCache_=Cache::No, Cache ArrayCache_=Cache::No, Cache FunctionCache_=Cache::No)</div><div class="ttdef"><b>Definition:</b> <a href="ItaniumDemangle_8h_source.html#l00212">ItaniumDemangle.h:212</a></div></div>
<div class="ttc" id="aTargetLibraryInfo_8cpp_html_a19d27915595e7f0a0ef271448bcdac6f"><div class="ttname"><a href="TargetLibraryInfo_8cpp.html#a19d27915595e7f0a0ef271448bcdac6f">initialize</a></div><div class="ttdeci">static void initialize(TargetLibraryInfoImpl &amp;TLI, const Triple &amp;T, ArrayRef&lt; StringLiteral &gt; StandardNames)</div><div class="ttdoc">Initialize the set of available library functions based on the specified target triple.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLibraryInfo_8cpp_source.html#l00152">TargetLibraryInfo.cpp:152</a></div></div>
<div class="ttc" id="aDebug_8h_html_a08efc68d15935eb8889400a46c3749ba"><div class="ttname"><a href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a></div><div class="ttdeci">#define LLVM_DEBUG(X)</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8h_source.html#l00101">Debug.h:101</a></div></div>
<div class="ttc" id="astructllvm_1_1ProfiParams_html_a97439d73a5716992c931f74c45485fda"><div class="ttname"><a href="structllvm_1_1ProfiParams.html#a97439d73a5716992c931f74c45485fda">llvm::ProfiParams::JoinIslands</a></div><div class="ttdeci">bool JoinIslands</div><div class="ttdoc">Join isolated components having positive flow.</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00095">SampleProfileInference.h:95</a></div></div>
<div class="ttc" id="anamespacellvm_html_a372f87e2cac1c83389c98554dc44806da807dbe7d1c25a633894d4a231b1c76d3"><div class="ttname"><a href="namespacellvm.html#a372f87e2cac1c83389c98554dc44806da807dbe7d1c25a633894d4a231b1c76d3">llvm::SubDirectoryType::Bin</a></div><div class="ttdeci">@ Bin</div></div>
<div class="ttc" id="anamespacellvm_html_a7c46c742c31be54870e2038048e6b391"><div class="ttname"><a href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">llvm::dbgs</a></div><div class="ttdeci">raw_ostream &amp; dbgs()</div><div class="ttdoc">dbgs() - This returns a reference to a raw_ostream for debugging messages.</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8cpp_source.html#l00163">Debug.cpp:163</a></div></div>
<div class="ttc" id="aCommandLine_8h_html"><div class="ttname"><a href="CommandLine_8h.html">CommandLine.h</a></div></div>
<div class="ttc" id="astructllvm_1_1ProfiParams_html"><div class="ttname"><a href="structllvm_1_1ProfiParams.html">llvm::ProfiParams</a></div><div class="ttdoc">Various thresholds and options controlling the behavior of the profile inference algorithm.</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00087">SampleProfileInference.h:87</a></div></div>
<div class="ttc" id="aInlineOrder_8cpp_html_a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6"><div class="ttname"><a href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">InlinePriorityMode::Cost</a></div><div class="ttdeci">@ Cost</div></div>
<div class="ttc" id="astructllvm_1_1FlowJump_html_ae9c91a5ea45940cfaa166511aadd2eb2"><div class="ttname"><a href="structllvm_1_1FlowJump.html#ae9c91a5ea45940cfaa166511aadd2eb2">llvm::FlowJump::Source</a></div><div class="ttdeci">uint64_t Source</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00066">SampleProfileInference.h:66</a></div></div>
<div class="ttc" id="aBuiltinGCs_8cpp_html_a7abf5fb4071cb25dbce06dfb5ee3c937"><div class="ttname"><a href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a></div><div class="ttdeci">static GCRegistry::Add&lt; OcamlGC &gt; B(&quot;ocaml&quot;, &quot;ocaml 3.10-compatible GC&quot;)</div></div>
<div class="ttc" id="astructllvm_1_1FlowBlock_html"><div class="ttname"><a href="structllvm_1_1FlowBlock.html">llvm::FlowBlock</a></div><div class="ttdoc">A wrapper of a binary basic block.</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00048">SampleProfileInference.h:48</a></div></div>
<div class="ttc" id="aBitVector_8h_html"><div class="ttname"><a href="BitVector_8h.html">BitVector.h</a></div></div>
<div class="ttc" id="astructllvm_1_1ProfiParams_html_a94bec6d7c1e0827854d72091aacf81f7"><div class="ttname"><a href="structllvm_1_1ProfiParams.html#a94bec6d7c1e0827854d72091aacf81f7">llvm::ProfiParams::CostJumpDec</a></div><div class="ttdeci">unsigned CostJumpDec</div><div class="ttdoc">The cost of decreasing a jump's count by one.</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00122">SampleProfileInference.h:122</a></div></div>
<div class="ttc" id="aclassllvm_1_1BitVector_html"><div class="ttname"><a href="classllvm_1_1BitVector.html">llvm::BitVector</a></div><div class="ttdef"><b>Definition:</b> <a href="BitVector_8h_source.html#l00075">BitVector.h:75</a></div></div>
<div class="ttc" id="astructllvm_1_1ProfiParams_html_a9e351546ca08436a0e7a7ccfa08f5495"><div class="ttname"><a href="structllvm_1_1ProfiParams.html#a9e351546ca08436a0e7a7ccfa08f5495">llvm::ProfiParams::CostBlockZeroInc</a></div><div class="ttdeci">unsigned CostBlockZeroInc</div><div class="ttdoc">The cost of increasing a count of zero-weight block by one.</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00104">SampleProfileInference.h:104</a></div></div>
<div class="ttc" id="astructllvm_1_1FlowJump_html_acdd34566a25bab9890d87c9de6e7e8b0"><div class="ttname"><a href="structllvm_1_1FlowJump.html#acdd34566a25bab9890d87c9de6e7e8b0">llvm::FlowJump::Weight</a></div><div class="ttdeci">uint64_t Weight</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00068">SampleProfileInference.h:68</a></div></div>
<div class="ttc" id="anamespacellvm_1_1dxil_1_1PointerTypeAnalysis_html_ae574a4c1d84b9e67bc94489f356805b4"><div class="ttname"><a href="namespacellvm_1_1dxil_1_1PointerTypeAnalysis.html#ae574a4c1d84b9e67bc94489f356805b4">llvm::dxil::PointerTypeAnalysis::run</a></div><div class="ttdeci">PointerTypeMap run(const Module &amp;M)</div><div class="ttdoc">Compute the PointerTypeMap for the module M.</div><div class="ttdef"><b>Definition:</b> <a href="PointerTypeAnalysis_8cpp_source.html#l00189">PointerTypeAnalysis.cpp:189</a></div></div>
<div class="ttc" id="aADT_2tmp_8txt_html_a07ed0bfaa124c15897944fe3eaa971ab"><div class="ttname"><a href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a></div><div class="ttdeci">Class for arbitrary precision integers APInt is a functional replacement for common case unsigned integer type like unsigned long or uint64_t</div><div class="ttdef"><b>Definition:</b> <a href="ADT_2tmp_8txt_source.html#l00001">tmp.txt:1</a></div></div>
<div class="ttc" id="aclassllvm_1_1cl_1_1opt_html"><div class="ttname"><a href="classllvm_1_1cl_1_1opt.html">llvm::cl::opt&lt; bool &gt;</a></div></div>
<div class="ttc" id="astructllvm_1_1FlowBlock_html_a5204b5e55328f7a80fce9423c4cee8c1"><div class="ttname"><a href="structllvm_1_1FlowBlock.html#a5204b5e55328f7a80fce9423c4cee8c1">llvm::FlowBlock::Flow</a></div><div class="ttdeci">uint64_t Flow</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00053">SampleProfileInference.h:53</a></div></div>
<div class="ttc" id="astructllvm_1_1FlowJump_html_aba9bc6e5c52dfa0898860eeadbbef59b"><div class="ttname"><a href="structllvm_1_1FlowJump.html#aba9bc6e5c52dfa0898860eeadbbef59b">llvm::FlowJump::Flow</a></div><div class="ttdeci">uint64_t Flow</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00071">SampleProfileInference.h:71</a></div></div>
<div class="ttc" id="astructllvm_1_1FlowJump_html_a061ed8974c636291de7f7cf5c76e4660"><div class="ttname"><a href="structllvm_1_1FlowJump.html#a061ed8974c636291de7f7cf5c76e4660">llvm::FlowJump::IsUnlikely</a></div><div class="ttdeci">bool IsUnlikely</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00070">SampleProfileInference.h:70</a></div></div>
<div class="ttc" id="astructllvm_1_1ProfiParams_html_afa5c8536542aef51080617f59b7a4756"><div class="ttname"><a href="structllvm_1_1ProfiParams.html#afa5c8536542aef51080617f59b7a4756">llvm::ProfiParams::EvenFlowDistribution</a></div><div class="ttdeci">bool EvenFlowDistribution</div><div class="ttdoc">Evenly distribute flow when there are multiple equally likely options.</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00089">SampleProfileInference.h:89</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00058">MD5.cpp:58</a></div></div>
<div class="ttc" id="anamespacellvm_1_1cl_html_a10a041239ae1870cfcc064bfaa79fb65"><div class="ttname"><a href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">llvm::cl::init</a></div><div class="ttdeci">initializer&lt; Ty &gt; init(const Ty &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00445">CommandLine.h:445</a></div></div>
<div class="ttc" id="aSILowerControlFlow_8cpp_html_a4868c5d81c5ccc98c47aeab6244346a0"><div class="ttname"><a href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a></div><div class="ttdeci">assert(ImpDefSCC.getReg()==AMDGPU::SCC &amp;&amp;ImpDefSCC.isDef())</div></div>
<div class="ttc" id="astructllvm_1_1FlowBlock_html_aac571aba0964e18080de57124d2f9866"><div class="ttname"><a href="structllvm_1_1FlowBlock.html#aac571aba0964e18080de57124d2f9866">llvm::FlowBlock::HasUnknownWeight</a></div><div class="ttdeci">bool HasUnknownWeight</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00051">SampleProfileInference.h:51</a></div></div>
<div class="ttc" id="astructllvm_1_1ProfiParams_html_ad0fab235dca463ec9d48c5b6bfe9ccde"><div class="ttname"><a href="structllvm_1_1ProfiParams.html#ad0fab235dca463ec9d48c5b6bfe9ccde">llvm::ProfiParams::CostBlockUnknownInc</a></div><div class="ttdeci">unsigned CostBlockUnknownInc</div><div class="ttdoc">The cost of increasing an unknown block's count by one.</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00113">SampleProfileInference.h:113</a></div></div>
<div class="ttc" id="anamespacellvm_html_a10f3d955592ae2bc745f57e5b48ae115"><div class="ttname"><a href="namespacellvm.html#a10f3d955592ae2bc745f57e5b48ae115">llvm::size</a></div><div class="ttdeci">auto size(R &amp;&amp;Range, std::enable_if_t&lt; std::is_base_of&lt; std::random_access_iterator_tag, typename std::iterator_traits&lt; decltype(Range.begin())&gt;::iterator_category &gt;::value, void &gt; *=nullptr)</div><div class="ttdoc">Get the size of a range.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01716">STLExtras.h:1716</a></div></div>
<div class="ttc" id="anamespacellvm_1_1Sched_html_ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9"><div class="ttname"><a href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">llvm::Sched::Source</a></div><div class="ttdeci">@ Source</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l00100">TargetLowering.h:100</a></div></div>
<div class="ttc" id="anamespacellvm_html_a57f2ca0e57f4f7b13f56f9aa16af3e0d"><div class="ttname"><a href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">llvm::min</a></div><div class="ttdeci">Expected&lt; ExpressionValue &gt; min(const ExpressionValue &amp;Lhs, const ExpressionValue &amp;Rhs)</div><div class="ttdef"><b>Definition:</b> <a href="FileCheck_8cpp_source.html#l00357">FileCheck.cpp:357</a></div></div>
<div class="ttc" id="astructllvm_1_1ProfiParams_html_acecc0d05ec41075cc30e0c9bbb0c20b9"><div class="ttname"><a href="structllvm_1_1ProfiParams.html#acecc0d05ec41075cc30e0c9bbb0c20b9">llvm::ProfiParams::CostJumpUnknownInc</a></div><div class="ttdeci">unsigned CostJumpUnknownInc</div><div class="ttdoc">The cost of increasing an unknown jump's count by one.</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00128">SampleProfileInference.h:128</a></div></div>
<div class="ttc" id="alib_2Target_2ARM_2README_8txt_html_a1b45f45820a60c09244a87eb59824aec"><div class="ttname"><a href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a></div><div class="ttdeci">add sub stmia L5 ldr r0 bl L_printf $stub Instead of a and a wouldn t it be better to do three moves *Return an aggregate type is even return S</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2ARM_2README_8txt_source.html#l00210">README.txt:210</a></div></div>
<div class="ttc" id="anamespacellvm_html_af962cc3b6565966cbc3d5c1289f31a11"><div class="ttname"><a href="namespacellvm.html#af962cc3b6565966cbc3d5c1289f31a11">llvm::applyFlowInference</a></div><div class="ttdeci">void applyFlowInference(const ProfiParams &amp;Params, FlowFunction &amp;Func)</div><div class="ttdoc">Apply the profile inference algorithm for a given function.</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8cpp_source.html#l01308">SampleProfileInference.cpp:1308</a></div></div>
<div class="ttc" id="astructllvm_1_1ProfiParams_html_ac04da42f4440b9ea85d4ae6400b4e8ce"><div class="ttname"><a href="structllvm_1_1ProfiParams.html#ac04da42f4440b9ea85d4ae6400b4e8ce">llvm::ProfiParams::CostJumpInc</a></div><div class="ttdeci">unsigned CostJumpInc</div><div class="ttdoc">The cost of increasing a jump's count by one.</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00116">SampleProfileInference.h:116</a></div></div>
<div class="ttc" id="astructllvm_1_1FlowJump_html_aa017ffa5be8016e6feb941ceae7c89cc"><div class="ttname"><a href="structllvm_1_1FlowJump.html#aa017ffa5be8016e6feb941ceae7c89cc">llvm::FlowJump::Target</a></div><div class="ttdeci">uint64_t Target</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00067">SampleProfileInference.h:67</a></div></div>
<div class="ttc" id="astructllvm_1_1FlowBlock_html_a13613f61cfca8d0f1a0f9a09f26353e0"><div class="ttname"><a href="structllvm_1_1FlowBlock.html#a13613f61cfca8d0f1a0f9a09f26353e0">llvm::FlowBlock::Index</a></div><div class="ttdeci">uint64_t Index</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00049">SampleProfileInference.h:49</a></div></div>
<div class="ttc" id="astructllvm_1_1ProfiParams_html_aaa7f2d292f152d77537be66c67cd2008"><div class="ttname"><a href="structllvm_1_1ProfiParams.html#aaa7f2d292f152d77537be66c67cd2008">llvm::ProfiParams::CostBlockEntryDec</a></div><div class="ttdeci">unsigned CostBlockEntryDec</div><div class="ttdoc">The cost of decreasing the entry block's count by one.</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00110">SampleProfileInference.h:110</a></div></div>
<div class="ttc" id="astructllvm_1_1ProfiParams_html_adcd8b45086bba7f4515e3e3d8fef41dc"><div class="ttname"><a href="structllvm_1_1ProfiParams.html#adcd8b45086bba7f4515e3e3d8fef41dc">llvm::ProfiParams::CostBlockDec</a></div><div class="ttdeci">unsigned CostBlockDec</div><div class="ttdoc">The cost of decreasing a block's count by one.</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00101">SampleProfileInference.h:101</a></div></div>
<div class="ttc" id="astructllvm_1_1FlowFunction_html"><div class="ttname"><a href="structllvm_1_1FlowFunction.html">llvm::FlowFunction</a></div><div class="ttdoc">A wrapper of binary function with basic blocks and jumps.</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00075">SampleProfileInference.h:75</a></div></div>
<div class="ttc" id="astructllvm_1_1ProfiParams_html_a55e432c2b9b6e25f5a83f1d5ac7655b7"><div class="ttname"><a href="structllvm_1_1ProfiParams.html#a55e432c2b9b6e25f5a83f1d5ac7655b7">llvm::ProfiParams::CostJumpFTInc</a></div><div class="ttdeci">unsigned CostJumpFTInc</div><div class="ttdoc">The cost of increasing a fall-through jump's count by one.</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00119">SampleProfileInference.h:119</a></div></div>
<div class="ttc" id="astructllvm_1_1ProfiParams_html_a2aa4f0b714c6b54a55b97af255f6f62c"><div class="ttname"><a href="structllvm_1_1ProfiParams.html#a2aa4f0b714c6b54a55b97af255f6f62c">llvm::ProfiParams::CostJumpUnknownFTInc</a></div><div class="ttdeci">unsigned CostJumpUnknownFTInc</div><div class="ttdoc">The cost of increasing an unknown fall-through jump's count by one.</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00131">SampleProfileInference.h:131</a></div></div>
<div class="ttc" id="aSIAnnotateControlFlow_8cpp_html_acf797fa91d5b7065dfb68a2492df28c1"><div class="ttname"><a href="SIAnnotateControlFlow_8cpp.html#acf797fa91d5b7065dfb68a2492df28c1">Flow</a></div><div class="ttdeci">Annotate SI Control Flow</div><div class="ttdef"><b>Definition:</b> <a href="SIAnnotateControlFlow_8cpp_source.html#l00118">SIAnnotateControlFlow.cpp:118</a></div></div>
<div class="ttc" id="astructllvm_1_1FlowBlock_html_ab471dfaaaa5b8d4801330067baab383e"><div class="ttname"><a href="structllvm_1_1FlowBlock.html#ab471dfaaaa5b8d4801330067baab383e">llvm::FlowBlock::SuccJumps</a></div><div class="ttdeci">std::vector&lt; FlowJump * &gt; SuccJumps</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00054">SampleProfileInference.h:54</a></div></div>
<div class="ttc" id="anamespacellvm_html_a6b0ac1fa4f05de76413c5e0ca6334035"><div class="ttname"><a href="namespacellvm.html#a6b0ac1fa4f05de76413c5e0ca6334035">llvm::reverse</a></div><div class="ttdeci">auto reverse(ContainerTy &amp;&amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00484">STLExtras.h:484</a></div></div>
<div class="ttc" id="astructllvm_1_1cl_1_1desc_html"><div class="ttname"><a href="structllvm_1_1cl_1_1desc.html">llvm::cl::desc</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00411">CommandLine.h:411</a></div></div>
<div class="ttc" id="aDebug_8h_html"><div class="ttname"><a href="Debug_8h.html">Debug.h</a></div></div>
<div class="ttc" id="aregcomp_8c_html_a12c2040f25d8e3a7b9e1c2024c618cb6"><div class="ttname"><a href="regcomp_8c.html#a12c2040f25d8e3a7b9e1c2024c618cb6">INF</a></div><div class="ttdeci">#define INF</div></div>
<div class="ttc" id="astructllvm_1_1FlowJump_html"><div class="ttname"><a href="structllvm_1_1FlowJump.html">llvm::FlowJump</a></div><div class="ttdoc">A wrapper of a jump between two basic blocks.</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfileInference_8h_source.html#l00065">SampleProfileInference.h:65</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 7 2023 10:36:49 for LLVM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
