<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: lib/Transforms/Scalar/RewriteStatepointsForGC.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LLVM
   &#160;<span id="projectnumber">17.0.0git</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_a72932e0778af28115095468f6286ff8.html">Transforms</a></li><li class="navelem"><a class="el" href="dir_e6e1f1f37d351595fa984b942927b205.html">Scalar</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">RewriteStatepointsForGC.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="RewriteStatepointsForGC_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- RewriteStatepointsForGC.cpp - Make GC relocations explicit ---------===//</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// See https://llvm.org/LICENSE.txt for license information.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// Rewrite call/invoke instructions so as to make potential relocations</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// performed by the garbage collector explicit in the IR.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160; </div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="RewriteStatepointsForGC_8h.html">llvm/Transforms/Scalar/RewriteStatepointsForGC.h</a>&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160; </div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ArrayRef_8h.html">llvm/ADT/ArrayRef.h</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DenseMap_8h.html">llvm/ADT/DenseMap.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DenseSet_8h.html">llvm/ADT/DenseSet.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MapVector_8h.html">llvm/ADT/MapVector.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="STLExtras_8h.html">llvm/ADT/STLExtras.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SetVector_8h.html">llvm/ADT/SetVector.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallSet_8h.html">llvm/ADT/SmallSet.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallVector_8h.html">llvm/ADT/SmallVector.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="StringRef_8h.html">llvm/ADT/StringRef.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="iterator__range_8h.html">llvm/ADT/iterator_range.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DomTreeUpdater_8h.html">llvm/Analysis/DomTreeUpdater.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetLibraryInfo_8h.html">llvm/Analysis/TargetLibraryInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetTransformInfo_8h.html">llvm/Analysis/TargetTransformInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Argument_8h.html">llvm/IR/Argument.h</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Attributes_8h.html">llvm/IR/Attributes.h</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BasicBlock_8h.html">llvm/IR/BasicBlock.h</a>&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CallingConv_8h.html">llvm/IR/CallingConv.h</a>&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constant_8h.html">llvm/IR/Constant.h</a>&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constants_8h.html">llvm/IR/Constants.h</a>&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DataLayout_8h.html">llvm/IR/DataLayout.h</a>&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DerivedTypes_8h.html">llvm/IR/DerivedTypes.h</a>&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Dominators_8h.html">llvm/IR/Dominators.h</a>&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Function_8h.html">llvm/IR/Function.h</a>&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="GCStrategy_8h.html">llvm/IR/GCStrategy.h</a>&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IRBuilder_8h.html">llvm/IR/IRBuilder.h</a>&quot;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InstIterator_8h.html">llvm/IR/InstIterator.h</a>&quot;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InstrTypes_8h.html">llvm/IR/InstrTypes.h</a>&quot;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IR_2Instruction_8h.html">llvm/IR/Instruction.h</a>&quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Instructions_8h.html">llvm/IR/Instructions.h</a>&quot;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IntrinsicInst_8h.html">llvm/IR/IntrinsicInst.h</a>&quot;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Intrinsics_8h.html">llvm/IR/Intrinsics.h</a>&quot;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="LLVMContext_8h.html">llvm/IR/LLVMContext.h</a>&quot;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MDBuilder_8h.html">llvm/IR/MDBuilder.h</a>&quot;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Metadata_8h.html">llvm/IR/Metadata.h</a>&quot;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Module_8h.html">llvm/IR/Module.h</a>&quot;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Statepoint_8h.html">llvm/IR/Statepoint.h</a>&quot;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Type_8h.html">llvm/IR/Type.h</a>&quot;</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="User_8h.html">llvm/IR/User.h</a>&quot;</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Value_8h.html">llvm/IR/Value.h</a>&quot;</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ValueHandle_8h.html">llvm/IR/ValueHandle.h</a>&quot;</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InitializePasses_8h.html">llvm/InitializePasses.h</a>&quot;</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Pass_8h.html">llvm/Pass.h</a>&quot;</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Casting_8h.html">llvm/Support/Casting.h</a>&quot;</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CommandLine_8h.html">llvm/Support/CommandLine.h</a>&quot;</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Compiler_8h.html">llvm/Support/Compiler.h</a>&quot;</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Debug_8h.html">llvm/Support/Debug.h</a>&quot;</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Support_2ErrorHandling_8h.html">llvm/Support/ErrorHandling.h</a>&quot;</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="raw__ostream_8h.html">llvm/Support/raw_ostream.h</a>&quot;</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Transforms_2Scalar_8h.html">llvm/Transforms/Scalar.h</a>&quot;</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BasicBlockUtils_8h.html">llvm/Transforms/Utils/BasicBlockUtils.h</a>&quot;</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Transforms_2Utils_2Local_8h.html">llvm/Transforms/Utils/Local.h</a>&quot;</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="PromoteMemToReg_8h.html">llvm/Transforms/Utils/PromoteMemToReg.h</a>&quot;</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#include &lt;cstddef&gt;</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#include &lt;cstdint&gt;</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#include &lt;iterator&gt;</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#include &lt;optional&gt;</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#include &lt;set&gt;</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">#include &lt;utility&gt;</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">   79</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;rewrite-statepoints-for-gc&quot;</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160; </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">// Print the liveset found at the insert location</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a7685c70e8757fef2c3f8a4ff363de727">PrintLiveSet</a>(<span class="stringliteral">&quot;spp-print-liveset&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                                  <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">false</span>));</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a5526e43dee53a50b92a6f8c803cf7209">PrintLiveSetSize</a>(<span class="stringliteral">&quot;spp-print-liveset-size&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                                      <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">false</span>));</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">// Print out the base pointers for debugging</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a2f8133c8c84fda25efb484e4752d54b8">PrintBasePointers</a>(<span class="stringliteral">&quot;spp-print-base-pointers&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                                       <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">false</span>));</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">// Cost threshold measuring when it is profitable to rematerialize value instead</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">// of relocating it</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;unsigned&gt;</a></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<a class="code" href="RewriteStatepointsForGC_8cpp.html#a99bf3712c00fdf60fe9b59a2f503f2c5">RematerializationThreshold</a>(<span class="stringliteral">&quot;spp-rematerialization-threshold&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                           <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(6));</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="preprocessor">#ifdef EXPENSIVE_CHECKS</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#aae78323e579beb55b2c4820179d7b7e8">ClobberNonLive</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#aae78323e579beb55b2c4820179d7b7e8">  102</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#aae78323e579beb55b2c4820179d7b7e8">ClobberNonLive</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool, true&gt;</a> <a class="code" href="RewriteStatepointsForGC_8cpp.html#afe0e06ec4e283d4cb809dd463e2e65e9">ClobberNonLiveOverride</a>(<span class="stringliteral">&quot;rs4gc-clobber-non-live&quot;</span>,</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                                                  <a class="code" href="namespacellvm_1_1cl.html#aed47e4757f3240146f8ad40c2cdbf2d1">cl::location</a>(<a class="code" href="RewriteStatepointsForGC_8cpp.html#aae78323e579beb55b2c4820179d7b7e8">ClobberNonLive</a>),</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                                                  <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#a7d36e55d9eac11862a0db20973c68707">AllowStatepointWithNoDeoptInfo</a>(<span class="stringliteral">&quot;rs4gc-allow-statepoint-with-no-deopt-info&quot;</span>,</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                                   <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>));</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a2c16dd15d443e1027f7ffde8c13432c5">RematDerivedAtUses</a>(<span class="stringliteral">&quot;rs4gc-remat-derived-at-uses&quot;</span>,</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                                        <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>));</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">/// The IR fed into RewriteStatepointsForGC may have had attributes and</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">/// metadata implying dereferenceability that are no longer valid/correct after</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">/// RewriteStatepointsForGC has run. This is because semantically, after</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">/// RewriteStatepointsForGC runs, all calls to gc.statepoint &quot;free&quot; the entire</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">/// heap. stripNonValidData (conservatively) restores</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">/// correctness by erasing all attributes in the module that externally imply</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">/// dereferenceability. Similar reasoning also applies to the noalias</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">/// attributes and metadata. gc.statepoint can touch the entire heap including</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">/// noalias objects.</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">/// Apart from attributes and metadata, we also remove instructions that imply</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">/// constant physical memory: llvm.invariant.start.</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#aa44f7b8f4217ab0c4ae76b62d5d1ddd1">stripNonValidData</a>(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160; </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">// Find the GC strategy for a function, or null if it doesn&#39;t have one.</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="keyword">static</span> std::unique_ptr&lt;GCStrategy&gt; <a class="code" href="RewriteStatepointsForGC_8cpp.html#a19a380c6b55872909cc56792b8c98a77">findGCStrategy</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160; </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a8e774e505629c16421ed9b345ddb1f75">shouldRewriteStatepointsIn</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160; </div>
<div class="line"><a name="l00134"></a><span class="lineno"><a class="line" href="structllvm_1_1RewriteStatepointsForGC.html#af56b6dd2da7f65fa682eaf6a16cdb36a">  134</a></span>&#160;<a class="code" href="classllvm_1_1PreservedAnalyses.html">PreservedAnalyses</a> <a class="code" href="structllvm_1_1RewriteStatepointsForGC.html#af56b6dd2da7f65fa682eaf6a16cdb36a">RewriteStatepointsForGC::run</a>(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M,</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                                               <a class="code" href="classllvm_1_1AnalysisManager.html">ModuleAnalysisManager</a> &amp;AM) {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keyword">auto</span> &amp;<a class="code" href="PassBuilderBindings_8cpp.html#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a> = AM.<a class="code" href="classllvm_1_1AnalysisManager.html#ab9d3d5412c20747fd0110a046604f09a">getResult</a>&lt;<a class="code" href="classllvm_1_1InnerAnalysisManagerProxy.html">FunctionAnalysisManagerModuleProxy</a>&gt;(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>).getManager();</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>) {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="comment">// Nothing to do for declarations.</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.isDeclaration() || <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.empty())</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">// Policy choice says not to rewrite - the most common reason is that we&#39;re</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="comment">// compiling code without a GCStrategy.</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="RewriteStatepointsForGC_8cpp.html#a8e774e505629c16421ed9b345ddb1f75">shouldRewriteStatepointsIn</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>))</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160; </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keyword">auto</span> &amp;DT = <a class="code" href="PassBuilderBindings_8cpp.html#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.<a class="code" href="classllvm_1_1AnalysisManager.html#ab9d3d5412c20747fd0110a046604f09a">getResult</a>&lt;<a class="code" href="classllvm_1_1DominatorTreeAnalysis.html">DominatorTreeAnalysis</a>&gt;(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keyword">auto</span> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a> = <a class="code" href="PassBuilderBindings_8cpp.html#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.<a class="code" href="classllvm_1_1AnalysisManager.html#ab9d3d5412c20747fd0110a046604f09a">getResult</a>&lt;<a class="code" href="classllvm_1_1TargetIRAnalysis.html">TargetIRAnalysis</a>&gt;(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keyword">auto</span> &amp;TLI = <a class="code" href="PassBuilderBindings_8cpp.html#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.<a class="code" href="classllvm_1_1AnalysisManager.html#ab9d3d5412c20747fd0110a046604f09a">getResult</a>&lt;<a class="code" href="classllvm_1_1TargetLibraryAnalysis.html">TargetLibraryAnalysis</a>&gt;(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    Changed |= <a class="code" href="structllvm_1_1RewriteStatepointsForGC.html#ad69716246dabb743839cafceb902ef46">runOnFunction</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, DT, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, TLI);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  }</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keywordflow">if</span> (!Changed)</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1PreservedAnalyses.html#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="comment">// stripNonValidData asserts that shouldRewriteStatepointsIn</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="comment">// returns true for at least one function in the module.  Since at least</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="comment">// one function changed, we know that the precondition is satisfied.</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <a class="code" href="RewriteStatepointsForGC_8cpp.html#aa44f7b8f4217ab0c4ae76b62d5d1ddd1">stripNonValidData</a>(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160; </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <a class="code" href="classllvm_1_1PreservedAnalyses.html">PreservedAnalyses</a> PA;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  PA.<a class="code" href="classllvm_1_1PreservedAnalyses.html#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a class="code" href="classllvm_1_1TargetIRAnalysis.html">TargetIRAnalysis</a>&gt;();</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  PA.<a class="code" href="classllvm_1_1PreservedAnalyses.html#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a class="code" href="classllvm_1_1TargetLibraryAnalysis.html">TargetLibraryAnalysis</a>&gt;();</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keywordflow">return</span> PA;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;}</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160; </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160; </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="keyword">class </span>RewriteStatepointsForGCLegacyPass : <span class="keyword">public</span> <a class="code" href="classllvm_1_1ModulePass.html">ModulePass</a> {</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <a class="code" href="structllvm_1_1RewriteStatepointsForGC.html">RewriteStatepointsForGC</a> Impl;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>; <span class="comment">// Pass identification, replacement for typeid</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160; </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  RewriteStatepointsForGCLegacyPass() : <a class="code" href="classllvm_1_1ModulePass.html">ModulePass</a>(<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>), Impl() {</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <a class="code" href="namespacellvm.html#ac1eeead9c75f34e350b28aafb3122249">initializeRewriteStatepointsForGCLegacyPassPass</a>(</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        *<a class="code" href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  }</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160; </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="keywordtype">bool</span> runOnModule(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M)<span class="keyword"> override </span>{</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : M) {</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      <span class="comment">// Nothing to do for declarations.</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.isDeclaration() || <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.empty())</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      <span class="comment">// Policy choice says not to rewrite - the most common reason is that</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      <span class="comment">// we&#39;re compiling code without a GCStrategy.</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="RewriteStatepointsForGC_8cpp.html#a8e774e505629c16421ed9b345ddb1f75">shouldRewriteStatepointsIn</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>))</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160; </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a> =</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;          getAnalysis&lt;TargetTransformInfoWrapperPass&gt;().getTTI(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> &amp;TLI =</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;          getAnalysis&lt;TargetLibraryInfoWrapperPass&gt;().getTLI(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      <span class="keyword">auto</span> &amp;DT = getAnalysis&lt;DominatorTreeWrapperPass&gt;(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>).getDomTree();</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160; </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      Changed |= Impl.<a class="code" href="structllvm_1_1RewriteStatepointsForGC.html#ad69716246dabb743839cafceb902ef46">runOnFunction</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, DT, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, TLI);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    }</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160; </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">if</span> (!Changed)</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160; </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="comment">// stripNonValidData asserts that shouldRewriteStatepointsIn</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="comment">// returns true for at least one function in the module.  Since at least</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="comment">// one function changed, we know that the precondition is satisfied.</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#aa44f7b8f4217ab0c4ae76b62d5d1ddd1">stripNonValidData</a>(M);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  }</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160; </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="keywordtype">void</span> getAnalysisUsage(<a class="code" href="classllvm_1_1AnalysisUsage.html">AnalysisUsage</a> &amp;AU)<span class="keyword"> const override </span>{</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment">// We add and rewrite a bunch of instructions, but don&#39;t really do much</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="comment">// else.  We could in theory preserve a lot more analyses here.</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1DominatorTreeWrapperPass.html">DominatorTreeWrapperPass</a>&gt;();</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1TargetTransformInfoWrapperPass.html">TargetTransformInfoWrapperPass</a>&gt;();</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1TargetLibraryInfoWrapperPass.html">TargetLibraryInfoWrapperPass</a>&gt;();</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;};</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46">RewriteStatepointsForGCLegacyPass::ID</a> = 0;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno"><a class="line" href="namespacellvm.html#a91041531bb6b438d56bfb01919d8cd68">  224</a></span>&#160;<a class="code" href="classllvm_1_1ModulePass.html">ModulePass</a> *<a class="code" href="namespacellvm.html#a91041531bb6b438d56bfb01919d8cd68">llvm::createRewriteStatepointsForGCLegacyPass</a>() {</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> RewriteStatepointsForGCLegacyPass();</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;}</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160; </div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<a class="code" href="RewriteStatepointsForGC_8cpp.html#a8a5efaea67813b24d29c0022689a1fe0">INITIALIZE_PASS_BEGIN</a>(RewriteStatepointsForGCLegacyPass,</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                      <span class="stringliteral">&quot;rewrite-statepoints-for-gc&quot;</span>,</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                      <span class="stringliteral">&quot;Make relocations explicit at statepoints&quot;</span>, <span class="keyword">false</span>, <span class="keyword">false</span>)</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<a class="code" href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1DominatorTreeWrapperPass.html">DominatorTreeWrapperPass</a>)</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<a class="code" href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1TargetTransformInfoWrapperPass.html">TargetTransformInfoWrapperPass</a>)</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<a class="code" href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a>(RewriteStatepointsForGCLegacyPass,</div>
<div class="line"><a name="l00234"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a0230b531ba2214a31157027481fde94c">  234</a></span>&#160;                    &quot;<a class="code" href="PoisonChecking_8cpp.html#a702ebb77e7ff7f0a10a1b4690d8ecfc8">rewrite</a>-<a class="code" href="RewriteStatepointsForGC_8cpp.html#a056b1e140d5170fc706d4adc8cf051be">statepoints</a>-<a class="code" href="lib_2Target_2README_8txt.html#a7df6ed7588301267782c2bd4b7f6899d">for</a>-<a class="code" href="RewriteStatepointsForGC_8cpp.html#a0230b531ba2214a31157027481fde94c">gc</a>&quot;,</div>
<div class="line"><a name="l00235"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a056b1e140d5170fc706d4adc8cf051be">  235</a></span>&#160;                    &quot;Make relocations explicit <a class="code" href="lib_2Target_2ARM_2README_8txt.html#af84fbbd129a1fbd3981dfbe6f607ddf4">at</a> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a056b1e140d5170fc706d4adc8cf051be">statepoints</a>&quot;, <a class="code" href="namespacefalse.html">false</a>, <a class="code" href="namespacefalse.html">false</a>)</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;namespace {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; </div>
<div class="line"><a name="l00239"></a><span class="lineno"><a class="line" href="structfalse_1_1GCPtrLivenessData.html">  239</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structfalse_1_1GCPtrLivenessData.html">GCPtrLivenessData</a> {<span class="comment"></span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">  /// Values defined in this block.</span></div>
<div class="line"><a name="l00241"></a><span class="lineno"><a class="line" href="structfalse_1_1GCPtrLivenessData.html#a5d74d864b3841f6be01483a51cb555f2">  241</a></span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;BasicBlock *, SetVector&lt;Value *&gt;</a>&gt; <a class="code" href="structfalse_1_1GCPtrLivenessData.html#a5d74d864b3841f6be01483a51cb555f2">KillSet</a>;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">  /// Values used in this block (and thus live); does not included values</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">  /// killed within this block.</span></div>
<div class="line"><a name="l00245"></a><span class="lineno"><a class="line" href="structfalse_1_1GCPtrLivenessData.html#a263b8ea78b539b25b9fd82db939f3df2">  245</a></span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;BasicBlock *, SetVector&lt;Value *&gt;</a>&gt; <a class="code" href="structfalse_1_1GCPtrLivenessData.html#a263b8ea78b539b25b9fd82db939f3df2">LiveSet</a>;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">  /// Values live into this basic block (i.e. used by any</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">  /// instruction in this basic block or ones reachable from here)</span></div>
<div class="line"><a name="l00249"></a><span class="lineno"><a class="line" href="structfalse_1_1GCPtrLivenessData.html#a81725384795d316a7a2e379fa1b375bd">  249</a></span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;BasicBlock *, SetVector&lt;Value *&gt;</a>&gt; <a class="code" href="structfalse_1_1GCPtrLivenessData.html#a81725384795d316a7a2e379fa1b375bd">LiveIn</a>;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">  /// Values live out of this basic block (i.e. live into</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">  /// any successor block)</span></div>
<div class="line"><a name="l00253"></a><span class="lineno"><a class="line" href="structfalse_1_1GCPtrLivenessData.html#a42108e82db8532dfbdc909e9d160dd49">  253</a></span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;BasicBlock *, SetVector&lt;Value *&gt;</a>&gt; <a class="code" href="structfalse_1_1GCPtrLivenessData.html#a42108e82db8532dfbdc909e9d160dd49">LiveOut</a>;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;};</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160; </div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">// The type of the internal cache used inside the findBasePointers family</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">// of functions.  From the callers perspective, this is an opaque type and</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">// should not be inspected.</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">// In the actual implementation this caches two relations:</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment">// - The base relation itself (i.e. this pointer is based on that one)</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">// - The base defining value relation (i.e. before base_phi insertion)</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">// Generally, after the execution of a full findBasePointer call, only the</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">// base relation will remain.  Internally, we add a mixture of the two</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">// types, then update all the second type to the first type</span></div>
<div class="line"><a name="l00266"></a><span class="lineno"><a class="line" href="namespacefalse.html#a00af9f2347076bfb43b7d4e286feb576">  266</a></span>&#160;<span class="keyword">using</span> <a class="code" href="classllvm_1_1MapVector.html">DefiningValueMapTy</a> = <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;Value *, Value *&gt;</a>;</div>
<div class="line"><a name="l00267"></a><span class="lineno"><a class="line" href="namespacefalse.html#a9f5b65a81eb5133d76ed041f31f7ceac">  267</a></span>&#160;<span class="keyword">using</span> <a class="code" href="classllvm_1_1MapVector.html">IsKnownBaseMapTy</a> = <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;Value *, bool&gt;</a>;</div>
<div class="line"><a name="l00268"></a><span class="lineno"><a class="line" href="namespacefalse.html#abbdd09796205857296660052b67cc167">  268</a></span>&#160;<span class="keyword">using</span> <a class="code" href="classllvm_1_1MapVector.html">PointerToBaseTy</a> = <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;Value *, Value *&gt;</a>;</div>
<div class="line"><a name="l00269"></a><span class="lineno"><a class="line" href="namespacefalse.html#afaa1384eeb44548e3d6b1324ebc65c3c">  269</a></span>&#160;<span class="keyword">using</span> <a class="code" href="classllvm_1_1SetVector.html">StatepointLiveSetTy</a> = <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;Value *&gt;</a>;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="keyword">using</span> <a class="code" href="classllvm_1_1MapVector.html">RematerializedValueMapTy</a> =</div>
<div class="line"><a name="l00271"></a><span class="lineno"><a class="line" href="namespacefalse.html#ac6a673a7af50c8b1760115a5dd9c0b04">  271</a></span>&#160;    <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;AssertingVH&lt;Instruction&gt;</a>, <a class="code" href="classllvm_1_1AssertingVH.html">AssertingVH&lt;Value&gt;</a>&gt;;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160; </div>
<div class="line"><a name="l00273"></a><span class="lineno"><a class="line" href="structfalse_1_1PartiallyConstructedSafepointRecord.html">  273</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structfalse_1_1PartiallyConstructedSafepointRecord.html">PartiallyConstructedSafepointRecord</a> {<span class="comment"></span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">  /// The set of values known to be live across this safepoint</span></div>
<div class="line"><a name="l00275"></a><span class="lineno"><a class="line" href="structfalse_1_1PartiallyConstructedSafepointRecord.html#ac5b67707918609d196c7520002a71eb0">  275</a></span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SetVector.html">StatepointLiveSetTy</a> <a class="code" href="structfalse_1_1PartiallyConstructedSafepointRecord.html#ac5b67707918609d196c7520002a71eb0">LiveSet</a>;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">  /// The *new* gc.statepoint instruction itself.  This produces the token</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">  /// that normal path gc.relocates and the gc.result are tied to.</span></div>
<div class="line"><a name="l00279"></a><span class="lineno"><a class="line" href="structfalse_1_1PartiallyConstructedSafepointRecord.html#a367390a55701be6bcb3949287fa5c1d4">  279</a></span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1GCStatepointInst.html">GCStatepointInst</a> *<a class="code" href="structfalse_1_1PartiallyConstructedSafepointRecord.html#a367390a55701be6bcb3949287fa5c1d4">StatepointToken</a>;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">  /// Instruction to which exceptional gc relocates are attached</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">  /// Makes it easier to iterate through them during relocationViaAlloca.</span></div>
<div class="line"><a name="l00283"></a><span class="lineno"><a class="line" href="structfalse_1_1PartiallyConstructedSafepointRecord.html#a18be5ba1ab66d93f64d7bca9969d3b4d">  283</a></span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="structfalse_1_1PartiallyConstructedSafepointRecord.html#a18be5ba1ab66d93f64d7bca9969d3b4d">UnwindToken</a>;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">  /// Record live values we are rematerialized instead of relocating.</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">  /// They are not included into &#39;LiveSet&#39; field.</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">  /// Maps rematerialized copy to it&#39;s original value.</span></div>
<div class="line"><a name="l00288"></a><span class="lineno"><a class="line" href="structfalse_1_1PartiallyConstructedSafepointRecord.html#a0c847ecc206da763ea4a650ea9e8d6c4">  288</a></span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1MapVector.html">RematerializedValueMapTy</a> <a class="code" href="structfalse_1_1PartiallyConstructedSafepointRecord.html#a0c847ecc206da763ea4a650ea9e8d6c4">RematerializedValues</a>;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;};</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno"><a class="line" href="structfalse_1_1RematerizlizationCandidateRecord.html">  291</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structfalse_1_1RematerizlizationCandidateRecord.html">RematerizlizationCandidateRecord</a> {</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="comment">// Chain from derived pointer to base.</span></div>
<div class="line"><a name="l00293"></a><span class="lineno"><a class="line" href="structfalse_1_1RematerizlizationCandidateRecord.html#a85ca3146236c8f6ba918f0ec93cf680e">  293</a></span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 3&gt;</a> <a class="code" href="structfalse_1_1RematerizlizationCandidateRecord.html#a85ca3146236c8f6ba918f0ec93cf680e">ChainToBase</a>;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="comment">// Original base.</span></div>
<div class="line"><a name="l00295"></a><span class="lineno"><a class="line" href="structfalse_1_1RematerizlizationCandidateRecord.html#a31f8a4989f28d9a38bbc1eb629fc30e4">  295</a></span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="structfalse_1_1RematerizlizationCandidateRecord.html#a31f8a4989f28d9a38bbc1eb629fc30e4">RootOfChain</a>;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="comment">// Cost of chain.</span></div>
<div class="line"><a name="l00297"></a><span class="lineno"><a class="line" href="structfalse_1_1RematerizlizationCandidateRecord.html#af2c3c80e9c73720e3faed63f28a6f9dd">  297</a></span>&#160;  <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> <a class="code" href="structfalse_1_1RematerizlizationCandidateRecord.html#af2c3c80e9c73720e3faed63f28a6f9dd">Cost</a>;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;};</div>
<div class="line"><a name="l00299"></a><span class="lineno"><a class="line" href="namespacefalse.html#a63e6cab42597b0c6d4c6826a9a44dd59">  299</a></span>&#160;<span class="keyword">using</span> <a class="code" href="classllvm_1_1MapVector.html">RematCandTy</a> = <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;Value *, RematerizlizationCandidateRecord&gt;</a>;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160; </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160; </div>
<div class="line"><a name="l00303"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a6580c40c364979dcdc7847ebac738e15">  303</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Use&gt;</a> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a6580c40c364979dcdc7847ebac738e15">GetDeoptBundleOperands</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1CallBase.html">CallBase</a> *Call) {</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  std::optional&lt;OperandBundleUse&gt; DeoptBundle =</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      Call-&gt;getOperandBundle(<a class="code" href="classllvm_1_1LLVMContext.html#a800c1300065ca1615d2f4fb88623afd5a3f6df86c6efab701ade7abbc3134c25a">LLVMContext::OB_deopt</a>);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160; </div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="keywordflow">if</span> (!DeoptBundle) {</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="RewriteStatepointsForGC_8cpp.html#a7d36e55d9eac11862a0db20973c68707">AllowStatepointWithNoDeoptInfo</a> &amp;&amp;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;           <span class="stringliteral">&quot;Found non-leaf call without deopt info!&quot;</span>);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  }</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; </div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="keywordflow">return</span> DeoptBundle-&gt;Inputs;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;}</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">/// Compute the live-in set for every basic block in the function</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a9b5f57931ea7a3a623b6e8ac416177c1">computeLiveInValues</a>(<a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;DT, <a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                                GCPtrLivenessData &amp;<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>, <a class="code" href="classllvm_1_1GCStrategy.html">GCStrategy</a> *GC);</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">/// Given results from the dataflow liveness computation, find the set of live</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">/// Values at a particular instruction.</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a990710c9124f4c4183d029f678f8c13b">findLiveSetAtInst</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *inst, GCPtrLivenessData &amp;<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>,</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                              <a class="code" href="namespacefalse.html#afaa1384eeb44548e3d6b1324ebc65c3c">StatepointLiveSetTy</a> &amp;out, <a class="code" href="classllvm_1_1GCStrategy.html">GCStrategy</a> *GC);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a1fb4b1f16603d68ce7b6e6742f3115da">  325</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a1fb4b1f16603d68ce7b6e6742f3115da">isGCPointerType</a>(<a class="code" href="classllvm_1_1Type.html">Type</a> *<a class="code" href="classT.html">T</a>, <a class="code" href="classllvm_1_1GCStrategy.html">GCStrategy</a> *GC) {</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(GC &amp;&amp; <span class="stringliteral">&quot;GC Strategy for isGCPointerType cannot be null&quot;</span>);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; </div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="keywordflow">if</span> (!isa&lt;PointerType&gt;(<a class="code" href="classT.html">T</a>))</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160; </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="comment">// conservative - same as StatepointLowering</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <span class="keywordflow">return</span> GC-&gt;isGCManagedPointer(<a class="code" href="classT.html">T</a>).value_or(<span class="keyword">true</span>);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;}</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160; </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">// Return true if this type is one which a) is a gc pointer or contains a GC</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">// pointer and b) is of a type this code expects to encounter as a live value.</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">// (The insertion code will assert that a type which matches (a) and not (b)</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">// is not encountered.)</span></div>
<div class="line"><a name="l00339"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#aa24dcfb77b1890aaa6d1f687eeffe665">  339</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#aa24dcfb77b1890aaa6d1f687eeffe665">isHandledGCPointerType</a>(<a class="code" href="classllvm_1_1Type.html">Type</a> *<a class="code" href="classT.html">T</a>, <a class="code" href="classllvm_1_1GCStrategy.html">GCStrategy</a> *GC) {</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="comment">// We fully support gc pointers</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="RewriteStatepointsForGC_8cpp.html#a1fb4b1f16603d68ce7b6e6742f3115da">isGCPointerType</a>(<a class="code" href="classT.html">T</a>, GC))</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="comment">// We partially support vectors of gc pointers. The code will assert if it</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="comment">// can&#39;t handle something.</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> VT = dyn_cast&lt;VectorType&gt;(<a class="code" href="classT.html">T</a>))</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="RewriteStatepointsForGC_8cpp.html#a1fb4b1f16603d68ce7b6e6742f3115da">isGCPointerType</a>(VT-&gt;getElementType(), GC))</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;}</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160; </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">/// Returns true if this type contains a gc pointer whether we know how to</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment"></span><span class="comment">/// handle that type or not.</span></div>
<div class="line"><a name="l00354"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a406e7b8519deb844fdccfc38a9cc5db2">  354</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a406e7b8519deb844fdccfc38a9cc5db2">containsGCPtrType</a>(<a class="code" href="classllvm_1_1Type.html">Type</a> *Ty, <a class="code" href="classllvm_1_1GCStrategy.html">GCStrategy</a> *GC) {</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="RewriteStatepointsForGC_8cpp.html#a1fb4b1f16603d68ce7b6e6742f3115da">isGCPointerType</a>(Ty, GC))</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1VectorType.html">VectorType</a> *VT = dyn_cast&lt;VectorType&gt;(Ty))</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a1fb4b1f16603d68ce7b6e6742f3115da">isGCPointerType</a>(VT-&gt;getScalarType(), GC);</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ArrayType.html">ArrayType</a> *AT = dyn_cast&lt;ArrayType&gt;(Ty))</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a406e7b8519deb844fdccfc38a9cc5db2">containsGCPtrType</a>(AT-&gt;getElementType(), GC);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StructType.html">StructType</a> *<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a> = dyn_cast&lt;StructType&gt;(Ty))</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">llvm::any_of</a>(<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;elements(),</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                        [GC](<a class="code" href="classllvm_1_1Type.html">Type</a> *Ty) { return containsGCPtrType(Ty, GC); });</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;}</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160; </div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">// Returns true if this is a type which a) is a gc pointer or contains a GC</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">// pointer and b) is of a type which the code doesn&#39;t expect (i.e. first class</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">// aggregates).  Used to trip assertions.</span></div>
<div class="line"><a name="l00370"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#aac0cb310804ea09b44a5d79f93319d42">  370</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#aac0cb310804ea09b44a5d79f93319d42">isUnhandledGCPointerType</a>(<a class="code" href="classllvm_1_1Type.html">Type</a> *Ty, <a class="code" href="classllvm_1_1GCStrategy.html">GCStrategy</a> *GC) {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a406e7b8519deb844fdccfc38a9cc5db2">containsGCPtrType</a>(Ty, GC) &amp;&amp; !<a class="code" href="RewriteStatepointsForGC_8cpp.html#aa24dcfb77b1890aaa6d1f687eeffe665">isHandledGCPointerType</a>(Ty, GC);</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;}</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160; </div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">// Return the name of the value suffixed with the provided value, or if the</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">// value didn&#39;t have a name, the default value specified.</span></div>
<div class="line"><a name="l00377"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#acb0214b30fb2b9e1d6e1cf6cc851b3e5">  377</a></span>&#160;<span class="keyword">static</span> std::string <a class="code" href="RewriteStatepointsForGC_8cpp.html#acb0214b30fb2b9e1d6e1cf6cc851b3e5">suffixed_name_or</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> Suffix,</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                                    <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> DefaultName) {</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="keywordflow">return</span> V-&gt;<a class="code" href="classllvm_1_1Value.html#ad9d88ae321b98d8a3b7f394977ae6d7f">hasName</a>() ? (V-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + Suffix).str() : DefaultName.<a class="code" href="classllvm_1_1StringRef.html#a223dd14e7d12bc5cea01889b972a98b2">str</a>();</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;}</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160; </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">// Conservatively identifies any definitions which might be live at the</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">// given instruction. The  analysis is performed immediately before the</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">// given instruction. Values defined by that instruction are not considered</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">// live.  Values used by that instruction are considered live.</span></div>
<div class="line"><a name="l00386"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a495b5fc8d39e47e06482653850d78986">  386</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a495b5fc8d39e47e06482653850d78986">analyzeParsePointLiveness</a>(</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;DT, GCPtrLivenessData &amp;OriginalLivenessData, <a class="code" href="classllvm_1_1CallBase.html">CallBase</a> *Call,</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    PartiallyConstructedSafepointRecord &amp;Result, <a class="code" href="classllvm_1_1GCStrategy.html">GCStrategy</a> *GC) {</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <a class="code" href="namespacefalse.html#afaa1384eeb44548e3d6b1324ebc65c3c">StatepointLiveSetTy</a> LiveSet;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <a class="code" href="RewriteStatepointsForGC_8cpp.html#a990710c9124f4c4183d029f678f8c13b">findLiveSetAtInst</a>(Call, OriginalLivenessData, LiveSet, GC);</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160; </div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="RewriteStatepointsForGC_8cpp.html#a7685c70e8757fef2c3f8a4ff363de727">PrintLiveSet</a>) {</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Live Variables:\n&quot;</span>;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : LiveSet)</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; V-&gt;getName() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; *V &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  }</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="RewriteStatepointsForGC_8cpp.html#a5526e43dee53a50b92a6f8c803cf7209">PrintLiveSetSize</a>) {</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Safepoint For: &quot;</span> &lt;&lt; Call-&gt;getCalledOperand()-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Number live values: &quot;</span> &lt;&lt; LiveSet.size() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  }</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  Result.LiveSet = LiveSet;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;}</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">/// Returns true if V is a known base.</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a35f66218c3cefa695f682f1b0a1d316b">isKnownBase</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <span class="keyword">const</span> <a class="code" href="namespacefalse.html#a9f5b65a81eb5133d76ed041f31f7ceac">IsKnownBaseMapTy</a> &amp;KnownBases);</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">/// Caches the IsKnownBase flag for a value and asserts that it wasn&#39;t present</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">/// in the cache before.</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#ac2341c000429806910e78643bbcc1059">setKnownBase</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <span class="keywordtype">bool</span> IsKnownBase,</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                         <a class="code" href="namespacefalse.html#a9f5b65a81eb5133d76ed041f31f7ceac">IsKnownBaseMapTy</a> &amp;KnownBases);</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160; </div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="RewriteStatepointsForGC_8cpp.html#af276809421b9e562341d3c420ff29712">findBaseDefiningValue</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacefalse.html#a00af9f2347076bfb43b7d4e286feb576">DefiningValueMapTy</a> &amp;Cache,</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                                    <a class="code" href="namespacefalse.html#a9f5b65a81eb5133d76ed041f31f7ceac">IsKnownBaseMapTy</a> &amp;KnownBases);</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">/// Return a base defining value for the &#39;Index&#39; element of the given vector</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">/// instruction &#39;I&#39;.  If Index is null, returns a BDV for the entire vector</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">/// &#39;I&#39;.  As an optimization, this method will try to determine when the</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">/// element is known to already be a base pointer.  If this can be established,</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">/// the second value in the returned pair will be true.  Note that either a</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">/// vector or a pointer typed value can be returned.  For the former, the</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">/// vector returned is a BDV (and possibly a base) of the entire vector &#39;I&#39;.</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">/// If the later, the return pointer is a BDV (or possibly a base) for the</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">/// particular element in &#39;I&#39;.</span></div>
<div class="line"><a name="l00424"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#ae14867f68a4ddb46faa119f144edb974">  424</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="RewriteStatepointsForGC_8cpp.html#ae14867f68a4ddb46faa119f144edb974">findBaseDefiningValueOfVector</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacefalse.html#a00af9f2347076bfb43b7d4e286feb576">DefiningValueMapTy</a> &amp;Cache,</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                                            <a class="code" href="namespacefalse.html#a9f5b65a81eb5133d76ed041f31f7ceac">IsKnownBaseMapTy</a> &amp;KnownBases) {</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="comment">// Each case parallels findBaseDefiningValue below, see that code for</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <span class="comment">// detailed motivation.</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160; </div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="keyword">auto</span> Cached = Cache.find(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <span class="keywordflow">if</span> (Cached != Cache.end())</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keywordflow">return</span> Cached-&gt;second;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160; </div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="keywordflow">if</span> (isa&lt;Argument&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="comment">// An incoming argument to the function is a base pointer</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    Cache[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#ac2341c000429806910e78643bbcc1059">setKnownBase</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="comment">/* IsKnownBase */</span><span class="keyword">true</span>, KnownBases);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  }</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160; </div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <span class="keywordflow">if</span> (isa&lt;Constant&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="comment">// Base of constant vector consists only of constant null pointers.</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="comment">// For reasoning see similar case inside &#39;findBaseDefiningValue&#39; function.</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keyword">auto</span> *CAZ = <a class="code" href="classllvm_1_1ConstantAggregateZero.html#abfa1cf8b4348407b167f93bc7c01055f">ConstantAggregateZero::get</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType());</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    Cache[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = CAZ;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#ac2341c000429806910e78643bbcc1059">setKnownBase</a>(CAZ, <span class="comment">/* IsKnownBase */</span><span class="keyword">true</span>, KnownBases);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordflow">return</span> CAZ;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  }</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160; </div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="keywordflow">if</span> (isa&lt;LoadInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    Cache[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#ac2341c000429806910e78643bbcc1059">setKnownBase</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="comment">/* IsKnownBase */</span><span class="keyword">true</span>, KnownBases);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  }</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160; </div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="keywordflow">if</span> (isa&lt;InsertElementInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="comment">// We don&#39;t know whether this vector contains entirely base pointers or</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="comment">// not.  To be conservatively correct, we treat it as a BDV and will</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="comment">// duplicate code as needed to construct a parallel vector of bases.</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    Cache[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#ac2341c000429806910e78643bbcc1059">setKnownBase</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="comment">/* IsKnownBase */</span><span class="keyword">false</span>, KnownBases);</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  }</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160; </div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <span class="keywordflow">if</span> (isa&lt;ShuffleVectorInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="comment">// We don&#39;t know whether this vector contains entirely base pointers or</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="comment">// not.  To be conservatively correct, we treat it as a BDV and will</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="comment">// duplicate code as needed to construct a parallel vector of bases.</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="comment">// TODO: There a number of local optimizations which could be applied here</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="comment">// for particular sufflevector patterns.</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    Cache[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#ac2341c000429806910e78643bbcc1059">setKnownBase</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="comment">/* IsKnownBase */</span><span class="keyword">false</span>, KnownBases);</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  }</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="comment">// The behavior of getelementptr instructions is the same for vector and</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <span class="comment">// non-vector data types.</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = dyn_cast&lt;GetElementPtrInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keyword">auto</span> *BDV =</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        <a class="code" href="RewriteStatepointsForGC_8cpp.html#af276809421b9e562341d3c420ff29712">findBaseDefiningValue</a>(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getPointerOperand(), Cache, KnownBases);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    Cache[<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>] = BDV;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keywordflow">return</span> BDV;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  }</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160; </div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="comment">// The behavior of freeze instructions is the same for vector and</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <span class="comment">// non-vector data types.</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Freeze = dyn_cast&lt;FreezeInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keyword">auto</span> *BDV = <a class="code" href="RewriteStatepointsForGC_8cpp.html#af276809421b9e562341d3c420ff29712">findBaseDefiningValue</a>(Freeze-&gt;getOperand(0), Cache, KnownBases);</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    Cache[Freeze] = BDV;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordflow">return</span> BDV;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  }</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160; </div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  <span class="comment">// If the pointer comes through a bitcast of a vector of pointers to</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <span class="comment">// a vector of another type of pointer, then look through the bitcast</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *BC = dyn_cast&lt;BitCastInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keyword">auto</span> *BDV = <a class="code" href="RewriteStatepointsForGC_8cpp.html#af276809421b9e562341d3c420ff29712">findBaseDefiningValue</a>(BC-&gt;getOperand(0), Cache, KnownBases);</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    Cache[BC] = BDV;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="keywordflow">return</span> BDV;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  }</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160; </div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  <span class="comment">// We assume that functions in the source language only return base</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="comment">// pointers.  This should probably be generalized via attributes to support</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <span class="comment">// both source language and internal functions.</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  <span class="keywordflow">if</span> (isa&lt;CallInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || isa&lt;InvokeInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    Cache[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#ac2341c000429806910e78643bbcc1059">setKnownBase</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="comment">/* IsKnownBase */</span><span class="keyword">true</span>, KnownBases);</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  }</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160; </div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  <span class="comment">// A PHI or Select is a base defining value.  The outer findBasePointer</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <span class="comment">// algorithm is responsible for constructing a base value for this BDV.</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((isa&lt;SelectInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || isa&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;         <span class="stringliteral">&quot;unknown vector instruction - no base found for vector element&quot;</span>);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  Cache[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <a class="code" href="RewriteStatepointsForGC_8cpp.html#ac2341c000429806910e78643bbcc1059">setKnownBase</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="comment">/* IsKnownBase */</span><span class="keyword">false</span>, KnownBases);</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;}</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">/// Helper function for findBasePointer - Will return a value which either a)</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment">/// defines the base pointer for the input, b) blocks the simple search</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">/// (i.e. a PHI or Select of two derived pointers), or c) involves a change</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">/// from pointer to vector type or back.</span></div>
<div class="line"><a name="l00522"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#af276809421b9e562341d3c420ff29712">  522</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="RewriteStatepointsForGC_8cpp.html#af276809421b9e562341d3c420ff29712">findBaseDefiningValue</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacefalse.html#a00af9f2347076bfb43b7d4e286feb576">DefiningValueMapTy</a> &amp;Cache,</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                                    <a class="code" href="namespacefalse.html#a9f5b65a81eb5133d76ed041f31f7ceac">IsKnownBaseMapTy</a> &amp;KnownBases) {</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()-&gt;isPtrOrPtrVectorTy() &amp;&amp;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;         <span class="stringliteral">&quot;Illegal to ask for the base pointer of a non-pointer type&quot;</span>);</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="keyword">auto</span> Cached = Cache.find(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="keywordflow">if</span> (Cached != Cache.end())</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordflow">return</span> Cached-&gt;second;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160; </div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()-&gt;isVectorTy())</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#ae14867f68a4ddb46faa119f144edb974">findBaseDefiningValueOfVector</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Cache, KnownBases);</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160; </div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="keywordflow">if</span> (isa&lt;Argument&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="comment">// An incoming argument to the function is a base pointer</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="comment">// We should have never reached here if this argument isn&#39;t an gc value</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    Cache[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#ac2341c000429806910e78643bbcc1059">setKnownBase</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="comment">/* IsKnownBase */</span><span class="keyword">true</span>, KnownBases);</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  }</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160; </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <span class="keywordflow">if</span> (isa&lt;Constant&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="comment">// We assume that objects with a constant base (e.g. a global) can&#39;t move</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="comment">// and don&#39;t need to be reported to the collector because they are always</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="comment">// live. Besides global references, all kinds of constants (e.g. undef,</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="comment">// constant expressions, null pointers) can be introduced by the inliner or</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="comment">// the optimizer, especially on dynamically dead paths.</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="comment">// Here we treat all of them as having single null base. By doing this we</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="comment">// trying to avoid problems reporting various conflicts in a form of</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="comment">// &quot;phi (const1, const2)&quot; or &quot;phi (const, regular gc ptr)&quot;.</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="comment">// See constant.ll file for relevant test cases.</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160; </div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keyword">auto</span> *CPN = <a class="code" href="classllvm_1_1ConstantPointerNull.html#a96f5c85e4022e369266541b2db3fda69">ConstantPointerNull::get</a>(cast&lt;PointerType&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()));</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    Cache[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = CPN;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#ac2341c000429806910e78643bbcc1059">setKnownBase</a>(CPN, <span class="comment">/* IsKnownBase */</span><span class="keyword">true</span>, KnownBases);</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keywordflow">return</span> CPN;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  }</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160; </div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <span class="comment">// inttoptrs in an integral address space are currently ill-defined.  We</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <span class="comment">// treat them as defining base pointers here for consistency with the</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <span class="comment">// constant rule above and because we don&#39;t really have a better semantic</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="comment">// to give them.  Note that the optimizer is always free to insert undefined</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <span class="comment">// behavior on dynamically dead paths as well.</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <span class="keywordflow">if</span> (isa&lt;IntToPtrInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    Cache[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#ac2341c000429806910e78643bbcc1059">setKnownBase</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="comment">/* IsKnownBase */</span><span class="keyword">true</span>, KnownBases);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  }</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160; </div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1CastInst.html">CastInst</a> *CI = dyn_cast&lt;CastInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a> = CI-&gt;stripPointerCasts();</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="comment">// If stripping pointer casts changes the address space there is an</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="comment">// addrspacecast in between.</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(cast&lt;PointerType&gt;(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a>-&gt;getType())-&gt;getAddressSpace() ==</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;               cast&lt;PointerType&gt;(CI-&gt;getType())-&gt;getAddressSpace() &amp;&amp;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;           <span class="stringliteral">&quot;unsupported addrspacecast&quot;</span>);</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="comment">// If we find a cast instruction here, it means we&#39;ve found a cast which is</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="comment">// not simply a pointer cast (i.e. an inttoptr).  We don&#39;t know how to</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="comment">// handle int-&gt;ptr conversion.</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!isa&lt;CastInst&gt;(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a>) &amp;&amp; <span class="stringliteral">&quot;shouldn&#39;t find another cast here&quot;</span>);</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="keyword">auto</span> *BDV = <a class="code" href="RewriteStatepointsForGC_8cpp.html#af276809421b9e562341d3c420ff29712">findBaseDefiningValue</a>(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a>, Cache, KnownBases);</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    Cache[CI] = BDV;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="keywordflow">return</span> BDV;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  }</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160; </div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  <span class="keywordflow">if</span> (isa&lt;LoadInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="comment">// The value loaded is an gc base itself</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    Cache[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#ac2341c000429806910e78643bbcc1059">setKnownBase</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="comment">/* IsKnownBase */</span><span class="keyword">true</span>, KnownBases);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  }</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160; </div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = dyn_cast&lt;GetElementPtrInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="comment">// The base of this GEP is the base</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="keyword">auto</span> *BDV =</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <a class="code" href="RewriteStatepointsForGC_8cpp.html#af276809421b9e562341d3c420ff29712">findBaseDefiningValue</a>(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getPointerOperand(), Cache, KnownBases);</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    Cache[<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>] = BDV;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="keywordflow">return</span> BDV;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  }</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160; </div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Freeze = dyn_cast&lt;FreezeInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="keyword">auto</span> *BDV = <a class="code" href="RewriteStatepointsForGC_8cpp.html#af276809421b9e562341d3c420ff29712">findBaseDefiningValue</a>(Freeze-&gt;getOperand(0), Cache, KnownBases);</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    Cache[Freeze] = BDV;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="keywordflow">return</span> BDV;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  }</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160; </div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *II = dyn_cast&lt;IntrinsicInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keywordflow">switch</span> (II-&gt;getIntrinsicID()) {</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      <span class="comment">// fall through to general call handling</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordflow">case</span> Intrinsic::experimental_gc_statepoint:</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;statepoints don&#39;t produce pointers&quot;</span>);</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="keywordflow">case</span> Intrinsic::experimental_gc_relocate:</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;      <span class="comment">// Rerunning safepoint insertion after safepoints are already</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      <span class="comment">// inserted is not supported.  It could probably be made to work,</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      <span class="comment">// but why are you doing this?  There&#39;s no good reason.</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;repeat safepoint insertion is not supported&quot;</span>);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="keywordflow">case</span> Intrinsic::gcroot:</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      <span class="comment">// Currently, this mechanism hasn&#39;t been extended to work with gcroot.</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      <span class="comment">// There&#39;s no reason it couldn&#39;t be, but I haven&#39;t thought about the</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      <span class="comment">// implications much.</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;          <span class="stringliteral">&quot;interaction with the gcroot mechanism is not supported&quot;</span>);</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="keywordflow">case</span> Intrinsic::experimental_gc_get_pointer_base:</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      <span class="keyword">auto</span> *BDV = <a class="code" href="RewriteStatepointsForGC_8cpp.html#af276809421b9e562341d3c420ff29712">findBaseDefiningValue</a>(II-&gt;getOperand(0), Cache, KnownBases);</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      Cache[II] = BDV;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      <span class="keywordflow">return</span> BDV;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    }</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  }</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="comment">// We assume that functions in the source language only return base</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <span class="comment">// pointers.  This should probably be generalized via attributes to support</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <span class="comment">// both source language and internal functions.</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <span class="keywordflow">if</span> (isa&lt;CallInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || isa&lt;InvokeInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    Cache[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#ac2341c000429806910e78643bbcc1059">setKnownBase</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="comment">/* IsKnownBase */</span><span class="keyword">true</span>, KnownBases);</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  }</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160; </div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <span class="comment">// TODO: I have absolutely no idea how to implement this part yet.  It&#39;s not</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  <span class="comment">// necessarily hard, I just haven&#39;t really looked at it yet.</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!isa&lt;LandingPadInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; <span class="stringliteral">&quot;Landing Pad is unimplemented&quot;</span>);</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160; </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  <span class="keywordflow">if</span> (isa&lt;AtomicCmpXchgInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="comment">// A CAS is effectively a atomic store and load combined under a</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <span class="comment">// predicate.  From the perspective of base pointers, we just treat it</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="comment">// like a load.</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    Cache[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#ac2341c000429806910e78643bbcc1059">setKnownBase</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="comment">/* IsKnownBase */</span><span class="keyword">true</span>, KnownBases);</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  }</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160; </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!isa&lt;AtomicRMWInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; <span class="stringliteral">&quot;Xchg handled above, all others are &quot;</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                                   <span class="stringliteral">&quot;binary ops which don&#39;t apply to pointers&quot;</span>);</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160; </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  <span class="comment">// The aggregate ops.  Aggregates can either be in the heap or on the</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  <span class="comment">// stack, but in either case, this is simply a field load.  As a result,</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  <span class="comment">// this is a defining definition of the base just like a load is.</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  <span class="keywordflow">if</span> (isa&lt;ExtractValueInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    Cache[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#ac2341c000429806910e78643bbcc1059">setKnownBase</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="comment">/* IsKnownBase */</span><span class="keyword">true</span>, KnownBases);</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  }</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160; </div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  <span class="comment">// We should never see an insert vector since that would require we be</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  <span class="comment">// tracing back a struct value not a pointer value.</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!isa&lt;InsertValueInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;         <span class="stringliteral">&quot;Base pointer for a struct is meaningless&quot;</span>);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160; </div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  <span class="comment">// This value might have been generated by findBasePointer() called when</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  <span class="comment">// substituting gc.get.pointer.base() intrinsic.</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  <span class="keywordtype">bool</span> IsKnownBase =</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      isa&lt;Instruction&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; cast&lt;Instruction&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getMetadata(<span class="stringliteral">&quot;is_base_value&quot;</span>);</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  <a class="code" href="RewriteStatepointsForGC_8cpp.html#ac2341c000429806910e78643bbcc1059">setKnownBase</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="comment">/* IsKnownBase */</span>IsKnownBase, KnownBases);</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  Cache[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160; </div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  <span class="comment">// An extractelement produces a base result exactly when it&#39;s input does.</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <span class="comment">// We may need to insert a parallel instruction to extract the appropriate</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  <span class="comment">// element out of the base vector corresponding to the input. Given this,</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  <span class="comment">// it&#39;s analogous to the phi and select case even though it&#39;s not a merge.</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <span class="keywordflow">if</span> (isa&lt;ExtractElementInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <span class="comment">// Note: There a lot of obvious peephole cases here.  This are deliberately</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="comment">// handled after the main base pointer inference algorithm to make writing</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="comment">// test cases to exercise that code easier.</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160; </div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <span class="comment">// The last two cases here don&#39;t return a base pointer.  Instead, they</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  <span class="comment">// return a value which dynamically selects from among several base</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  <span class="comment">// derived pointers (each with it&#39;s own base potentially).  It&#39;s the job of</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <span class="comment">// the caller to resolve these.</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((isa&lt;SelectInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || isa&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;         <span class="stringliteral">&quot;missing instruction case in findBaseDefiningValue&quot;</span>);</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;}</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="comment">/// Returns the base defining value for this value.</span></div>
<div class="line"><a name="l00696"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#abee5adade9e071a19accfe1f3086cd47">  696</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="RewriteStatepointsForGC_8cpp.html#abee5adade9e071a19accfe1f3086cd47">findBaseDefiningValueCached</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacefalse.html#a00af9f2347076bfb43b7d4e286feb576">DefiningValueMapTy</a> &amp;Cache,</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                                          <a class="code" href="namespacefalse.html#a9f5b65a81eb5133d76ed041f31f7ceac">IsKnownBaseMapTy</a> &amp;KnownBases) {</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  <span class="keywordflow">if</span> (Cache.find(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) == Cache.end()) {</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <span class="keyword">auto</span> *BDV = <a class="code" href="RewriteStatepointsForGC_8cpp.html#af276809421b9e562341d3c420ff29712">findBaseDefiningValue</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Cache, KnownBases);</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    Cache[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = BDV;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;fBDV-cached: &quot;</span> &lt;&lt; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getName() &lt;&lt; <span class="stringliteral">&quot; -&gt; &quot;</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                      &lt;&lt; Cache[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;, is known base = &quot;</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                      &lt;&lt; KnownBases[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  }</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Cache[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] != <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(KnownBases.find(Cache[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]) != KnownBases.end() &amp;&amp;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;         <span class="stringliteral">&quot;Cached value must be present in known bases map&quot;</span>);</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;  <span class="keywordflow">return</span> Cache[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;}</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="comment">/// Return a base pointer for this value if known.  Otherwise, return it&#39;s</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="comment">/// base defining value.</span></div>
<div class="line"><a name="l00713"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#af706759f2159b0a0573c72456c55c828">  713</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="RewriteStatepointsForGC_8cpp.html#af706759f2159b0a0573c72456c55c828">findBaseOrBDV</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacefalse.html#a00af9f2347076bfb43b7d4e286feb576">DefiningValueMapTy</a> &amp;Cache,</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                            <a class="code" href="namespacefalse.html#a9f5b65a81eb5133d76ed041f31f7ceac">IsKnownBaseMapTy</a> &amp;KnownBases) {</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a> = <a class="code" href="RewriteStatepointsForGC_8cpp.html#abee5adade9e071a19accfe1f3086cd47">findBaseDefiningValueCached</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Cache, KnownBases);</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  <span class="keyword">auto</span> Found = Cache.find(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a>);</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  <span class="keywordflow">if</span> (Found != Cache.end()) {</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="comment">// Either a base-of relation, or a self reference.  Caller must check.</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="keywordflow">return</span> Found-&gt;second;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  }</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  <span class="comment">// Only a BDV available</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a>;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;}</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160; </div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="comment">/// This value is a base pointer that is not generated by RS4GC, i.e. it already</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="comment"></span><span class="comment">/// exists in the code.</span></div>
<div class="line"><a name="l00728"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#aba191a63377d6bc21b701c484af2a82c">  728</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#aba191a63377d6bc21b701c484af2a82c">isOriginalBaseResult</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <span class="comment">// no recursion possible</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  <span class="keywordflow">return</span> !isa&lt;PHINode&gt;(V) &amp;&amp; !isa&lt;SelectInst&gt;(V) &amp;&amp;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;         !isa&lt;ExtractElementInst&gt;(V) &amp;&amp; !isa&lt;InsertElementInst&gt;(V) &amp;&amp;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;         !isa&lt;ShuffleVectorInst&gt;(V);</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;}</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160; </div>
<div class="line"><a name="l00736"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a35f66218c3cefa695f682f1b0a1d316b">  736</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a35f66218c3cefa695f682f1b0a1d316b">isKnownBase</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <span class="keyword">const</span> <a class="code" href="namespacefalse.html#a9f5b65a81eb5133d76ed041f31f7ceac">IsKnownBaseMapTy</a> &amp;KnownBases) {</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  <span class="keyword">auto</span> It = KnownBases.find(V);</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(It != KnownBases.end() &amp;&amp; <span class="stringliteral">&quot;Value not present in the map&quot;</span>);</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;  <span class="keywordflow">return</span> It-&gt;second;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;}</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160; </div>
<div class="line"><a name="l00742"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#ac2341c000429806910e78643bbcc1059">  742</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#ac2341c000429806910e78643bbcc1059">setKnownBase</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <span class="keywordtype">bool</span> IsKnownBase,</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                         <a class="code" href="namespacefalse.html#a9f5b65a81eb5133d76ed041f31f7ceac">IsKnownBaseMapTy</a> &amp;KnownBases) {</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  <span class="keyword">auto</span> It = KnownBases.find(V);</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  <span class="keywordflow">if</span> (It != KnownBases.end())</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(It-&gt;second == IsKnownBase &amp;&amp; <span class="stringliteral">&quot;Changing already present value&quot;</span>);</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  KnownBases[V] = IsKnownBase;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;}</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160; </div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="comment">// Returns true if First and Second values are both scalar or both vector.</span></div>
<div class="line"><a name="l00753"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a9e70d6aa9b2f9a1b6bff9f405910e1ba">  753</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a9e70d6aa9b2f9a1b6bff9f405910e1ba">areBothVectorOrScalar</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *First, <a class="code" href="classllvm_1_1Value.html">Value</a> *Second) {</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  <span class="keywordflow">return</span> isa&lt;VectorType&gt;(<a class="code" href="lib_2Target_2README_8txt.html#ab24db72f7bd10b13351812874015861b">First</a>-&gt;getType()) ==</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;         isa&lt;VectorType&gt;(Second-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;}</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160; </div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="comment">/// Models the state of a single base defining value in the findBasePointer</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="comment">/// algorithm for determining where a new instruction is needed to propagate</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="comment">/// the base of this BDV.</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="comment"></span><span class="keyword">class </span>BDVState {</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  <span class="keyword">enum</span> StatusTy {</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;     <span class="comment">// Starting state of lattice</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;     <a class="code" href="namespacellvm_1_1pdb.html#a434cfa04e4ed34b7a901378557d4ca9eab5923ebc864d1679cf1c3a929c122037">Unknown</a>,</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;     <span class="comment">// Some specific base value -- does *not* mean that instruction</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;     <span class="comment">// propagates the base of the object</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;     <span class="comment">// ex: gep %arg, 16 -&gt; %arg is the base value</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;     <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>,</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;     <span class="comment">// Need to insert a node to represent a merge.</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;     Conflict</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  };</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160; </div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  BDVState() {</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;missing state in map&quot;</span>);</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  }</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160; </div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  <span class="keyword">explicit</span> BDVState(<a class="code" href="classllvm_1_1Value.html">Value</a> *OriginalValue)</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    : OriginalValue(OriginalValue) {}</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;  <span class="keyword">explicit</span> BDVState(<a class="code" href="classllvm_1_1Value.html">Value</a> *OriginalValue, StatusTy <a class="code" href="structStatus.html">Status</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *BaseValue = <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    : OriginalValue(OriginalValue), <a class="code" href="structStatus.html">Status</a>(<a class="code" href="structStatus.html">Status</a>), BaseValue(BaseValue) {</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="structStatus.html">Status</a> != Base || BaseValue);</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  }</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160; </div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  StatusTy getStatus()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structStatus.html">Status</a>; }</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *getOriginalValue()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> OriginalValue; }</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *getBaseValue()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> BaseValue; }</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160; </div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <span class="keywordtype">bool</span> isBase()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> getStatus() == <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>; }</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  <span class="keywordtype">bool</span> isUnknown()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> getStatus() == <a class="code" href="namespacellvm_1_1pdb.html#a434cfa04e4ed34b7a901378557d4ca9eab5923ebc864d1679cf1c3a929c122037">Unknown</a>; }</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  <span class="keywordtype">bool</span> isConflict()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> getStatus() == Conflict; }</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160; </div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  <span class="comment">// Values of type BDVState form a lattice, and this function implements the</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  <span class="comment">// meet</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  <span class="comment">// operation.</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <span class="keywordtype">void</span> meet(<span class="keyword">const</span> BDVState &amp;Other) {</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="keyword">auto</span> markConflict = [&amp;]() {</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      <a class="code" href="structStatus.html">Status</a> = BDVState::Conflict;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;      BaseValue = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    };</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="comment">// Conflict is a final state.</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    <span class="keywordflow">if</span> (isConflict())</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="comment">// if we are not known - just take other state.</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="keywordflow">if</span> (isUnknown()) {</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;      <a class="code" href="structStatus.html">Status</a> = <a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.getStatus();</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;      BaseValue = <a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.getBaseValue();</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    }</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="comment">// We are base.</span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isBase() &amp;&amp; <span class="stringliteral">&quot;Unknown state&quot;</span>);</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="comment">// If other is unknown - just keep our state.</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.isUnknown())</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <span class="comment">// If other is conflict - it is a final state.</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.isConflict())</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      <span class="keywordflow">return</span> markConflict();</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="comment">// Other is base as well.</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.isBase() &amp;&amp; <span class="stringliteral">&quot;Unknown state&quot;</span>);</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="comment">// If bases are different - Conflict.</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <span class="keywordflow">if</span> (getBaseValue() != <a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.getBaseValue())</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      <span class="keywordflow">return</span> markConflict();</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="comment">// We are identical, do nothing.</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  }</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160; </div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#a4d812a2dd18aa186c164447e20e348e7">operator==</a>(<span class="keyword">const</span> BDVState &amp;Other)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <span class="keywordflow">return</span> OriginalValue == <a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.OriginalValue &amp;&amp; BaseValue == <a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.BaseValue &amp;&amp;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;      <a class="code" href="structStatus.html">Status</a> == <a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.Status;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  }</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160; </div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#a2f883c895f4d244f4ed56ed8a8c160c1">operator!=</a>(<span class="keyword">const</span> BDVState &amp;other)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> !(*<span class="keyword">this</span> == other); }</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160; </div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  <a class="code" href="Compiler_8h.html#aa863693eef567397d9c292da5bf22d34">LLVM_DUMP_METHOD</a></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a03503773241005f01b090b9862aad304">dump</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <a class="code" href="namespacellvm.html#a67980a8ae101d2fda845eb750ffb1942">print</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>());</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  }</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160; </div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a67980a8ae101d2fda845eb750ffb1942">print</a>(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;<a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <span class="keywordflow">switch</span> (getStatus()) {</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1pdb.html#a434cfa04e4ed34b7a901378557d4ca9eab5923ebc864d1679cf1c3a929c122037">Unknown</a>:</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;      <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; <span class="stringliteral">&quot;U&quot;</span>;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>:</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;      <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; <span class="stringliteral">&quot;B&quot;</span>;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="keywordflow">case</span> Conflict:</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;      <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; <span class="stringliteral">&quot;C&quot;</span>;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    }</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; <span class="stringliteral">&quot; (base &quot;</span> &lt;&lt; getBaseValue() &lt;&lt; <span class="stringliteral">&quot; - &quot;</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;       &lt;&lt; (getBaseValue() ? getBaseValue()-&gt;getName() : <span class="stringliteral">&quot;nullptr&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;       &lt;&lt; <span class="stringliteral">&quot; for  &quot;</span>  &lt;&lt; OriginalValue-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;:&quot;</span>;</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  }</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160; </div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <a class="code" href="classllvm_1_1AssertingVH.html">AssertingVH&lt;Value&gt;</a> OriginalValue; <span class="comment">// instruction this state corresponds to</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  StatusTy <a class="code" href="structStatus.html">Status</a> = <a class="code" href="namespacellvm_1_1pdb.html#a434cfa04e4ed34b7a901378557d4ca9eab5923ebc864d1679cf1c3a929c122037">Unknown</a>;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  <a class="code" href="classllvm_1_1AssertingVH.html">AssertingVH&lt;Value&gt;</a> BaseValue = <span class="keyword">nullptr</span>; <span class="comment">// Non-null only if Status == Base.</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;};</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160; </div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160; </div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l00867"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#adcabc3da979b5d96026b59b8b27f2cde">  867</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;<a class="code" href="namespacellvm.html#a5ee0a415cf089775fd277550b257f74e">operator&lt;&lt;</a>(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;<a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>, <span class="keyword">const</span> BDVState &amp;State) {</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  State.print(<a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>);</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;}</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="comment">/// For a given value or instruction, figure out what base ptr its derived from.</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="comment">/// For gc objects, this is simply itself.  On success, returns a value which is</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="comment">/// the base pointer.  (This is reliable and can be used for relocation.)  On</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="comment">/// failure, returns nullptr.</span></div>
<div class="line"><a name="l00877"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a1b9baa03d5a238d6a2b34668dfe087b3">  877</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="RewriteStatepointsForGC_8cpp.html#a1b9baa03d5a238d6a2b34668dfe087b3">findBasePointer</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacefalse.html#a00af9f2347076bfb43b7d4e286feb576">DefiningValueMapTy</a> &amp;Cache,</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                              <a class="code" href="namespacefalse.html#a9f5b65a81eb5133d76ed041f31f7ceac">IsKnownBaseMapTy</a> &amp;KnownBases) {</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a> = <a class="code" href="RewriteStatepointsForGC_8cpp.html#af706759f2159b0a0573c72456c55c828">findBaseOrBDV</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Cache, KnownBases);</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160; </div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="RewriteStatepointsForGC_8cpp.html#a35f66218c3cefa695f682f1b0a1d316b">isKnownBase</a>(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a>, KnownBases) &amp;&amp; <a class="code" href="RewriteStatepointsForGC_8cpp.html#a9e70d6aa9b2f9a1b6bff9f405910e1ba">areBothVectorOrScalar</a>(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a>;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160; </div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  <span class="comment">// Here&#39;s the rough algorithm:</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <span class="comment">// - For every SSA value, construct a mapping to either an actual base</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="comment">//   pointer or a PHI which obscures the base pointer.</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  <span class="comment">// - Construct a mapping from PHI to unknown TOP state.  Use an</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <span class="comment">//   optimistic algorithm to propagate base pointer information.  Lattice</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  <span class="comment">//   looks like:</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  <span class="comment">//   UNKNOWN</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  <span class="comment">//   b1 b2 b3 b4</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  <span class="comment">//   CONFLICT</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  <span class="comment">//   When algorithm terminates, all PHIs will either have a single concrete</span></div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  <span class="comment">//   base or be in a conflict state.</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  <span class="comment">// - For every conflict, insert a dummy PHI node without arguments.  Add</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  <span class="comment">//   these to the base[Instruction] = BasePtr mapping.  For every</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  <span class="comment">//   non-conflict, add the actual base.</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  <span class="comment">//  - For every conflict, add arguments for the base[a] of each input</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  <span class="comment">//   arguments.</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  <span class="comment">// Note: A simpler form of this would be to add the conflict form of all</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  <span class="comment">// PHIs without running the optimistic algorithm.  This would be</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  <span class="comment">// analogous to pessimistic data flow and would likely lead to an</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  <span class="comment">// overall worse solution.</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160; </div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  <span class="keyword">auto</span> isExpectedBDVType = [](<a class="code" href="classllvm_1_1Value.html">Value</a> *BDV) {</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    <span class="keywordflow">return</span> isa&lt;PHINode&gt;(BDV) || isa&lt;SelectInst&gt;(BDV) ||</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;           isa&lt;ExtractElementInst&gt;(BDV) || isa&lt;InsertElementInst&gt;(BDV) ||</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;           isa&lt;ShuffleVectorInst&gt;(BDV);</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  };</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160; </div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  <span class="comment">// Once populated, will contain a mapping from each potentially non-base BDV</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  <span class="comment">// to a lattice value (described above) which corresponds to that BDV.</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  <span class="comment">// We use the order of insertion (DFS over the def/use graph) to provide a</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  <span class="comment">// stable deterministic ordering for visiting DenseMaps (which are unordered)</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  <span class="comment">// below.  This is important for deterministic compilation.</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;Value *, BDVState&gt;</a> States;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160; </div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  <span class="keyword">auto</span> VerifyStates = [&amp;]() {</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Entry : States) {</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Entry.first == Entry.second.getOriginalValue());</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    }</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  };</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160; </div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  <span class="keyword">auto</span> visitBDVOperands = [](<a class="code" href="classllvm_1_1Value.html">Value</a> *BDV, <a class="code" href="MemDepPrinter_8cpp.html#a470d8721ad7c3b718e9daeabdaeb4700">std::function</a>&lt;void (<a class="code" href="classllvm_1_1Value.html">Value</a>*)&gt; <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = dyn_cast&lt;PHINode&gt;(BDV)) {</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *InVal : PN-&gt;incoming_values())</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>(InVal);</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;SelectInst&gt;(BDV)) {</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;      <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getTrueValue());</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getFalseValue());</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *EE = dyn_cast&lt;ExtractElementInst&gt;(BDV)) {</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>(EE-&gt;getVectorOperand());</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a> = dyn_cast&lt;InsertElementInst&gt;(BDV)) {</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;      <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>(<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>-&gt;getOperand(0));</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;      <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>(<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>-&gt;getOperand(1));</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *SV = dyn_cast&lt;ShuffleVectorInst&gt;(BDV)) {</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;      <span class="comment">// For a canonical broadcast, ignore the undef argument</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      <span class="comment">// (without this, we insert a parallel base shuffle for every broadcast)</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;      <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>(SV-&gt;getOperand(0));</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      <span class="keywordflow">if</span> (!SV-&gt;isZeroEltSplat())</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>(SV-&gt;getOperand(1));</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;      <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;unexpected BDV type&quot;</span>);</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    }</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  };</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160; </div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160; </div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  <span class="comment">// Recursively fill in all base defining values reachable from the initial</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  <span class="comment">// one for which we don&#39;t already know a definite base value for</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  <span class="comment">/* scope */</span> {</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value*, 16&gt;</a> Worklist;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    Worklist.push_back(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a>);</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    States.<a class="code" href="classllvm_1_1MapVector.html#a9318649185cfc66ba4b4eb66d5968e00">insert</a>({<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a>, BDVState(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a>)});</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="keywordflow">while</span> (!Worklist.empty()) {</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Current = Worklist.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a0c8ffe664a36e30d49c84d0aded2fe08">pop_back_val</a>();</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a class="code" href="RewriteStatepointsForGC_8cpp.html#aba191a63377d6bc21b701c484af2a82c">isOriginalBaseResult</a>(Current) &amp;&amp; <span class="stringliteral">&quot;why did it get added?&quot;</span>);</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160; </div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;      <span class="keyword">auto</span> visitIncomingValue = [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *InVal) {</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = <a class="code" href="RewriteStatepointsForGC_8cpp.html#af706759f2159b0a0573c72456c55c828">findBaseOrBDV</a>(InVal, Cache, KnownBases);</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="RewriteStatepointsForGC_8cpp.html#a35f66218c3cefa695f682f1b0a1d316b">isKnownBase</a>(<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, KnownBases) &amp;&amp; <a class="code" href="RewriteStatepointsForGC_8cpp.html#a9e70d6aa9b2f9a1b6bff9f405910e1ba">areBothVectorOrScalar</a>(<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, InVal))</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;          <span class="comment">// Known bases won&#39;t need new instructions introduced and can be</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;          <span class="comment">// ignored safely. However, this can only be done when InVal and Base</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;          <span class="comment">// are both scalar or both vector. Otherwise, we need to find a</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;          <span class="comment">// correct BDV for InVal, by creating an entry in the lattice</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;          <span class="comment">// (States).</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;          <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isExpectedBDVType(<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>) &amp;&amp; <span class="stringliteral">&quot;the only non-base values &quot;</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;               <span class="stringliteral">&quot;we see should be base defining values&quot;</span>);</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;        <span class="keywordflow">if</span> (States.<a class="code" href="classllvm_1_1MapVector.html#a9318649185cfc66ba4b4eb66d5968e00">insert</a>(std::make_pair(<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, BDVState(<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>))).second)</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;          Worklist.push_back(<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>);</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      };</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160; </div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      visitBDVOperands(Current, visitIncomingValue);</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    }</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  }</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160; </div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  VerifyStates();</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;States after initialization:\n&quot;</span>);</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;Pair : States) {</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; Pair.second &lt;&lt; <span class="stringliteral">&quot; for &quot;</span> &lt;&lt; *Pair.first &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  }</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160; </div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  <span class="comment">// Iterate forward through the value graph pruning any node from the state</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  <span class="comment">// list where all of the inputs are base pointers.  The purpose of this is to</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  <span class="comment">// reuse existing values when the derived pointer we were asked to materialize</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  <span class="comment">// a base pointer for happens to be a base pointer itself.  (Or a sub-graph</span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  <span class="comment">// feeding it does.)</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *&gt;</a> <a class="code" href="ARMLowOverheadLoops_8cpp.html#a3bf42baf773b375802538951c88d8e12">ToRemove</a>;</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    <a class="code" href="ARMLowOverheadLoops_8cpp.html#a3bf42baf773b375802538951c88d8e12">ToRemove</a>.clear();</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> Pair : States) {</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *BDV = Pair.first;</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;      <span class="keyword">auto</span> canPruneInput = [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;        <span class="comment">// If the input of the BDV is the BDV itself we can prune it. This is</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        <span class="comment">// only possible if the BDV is a PHI node.</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        <span class="keywordflow">if</span> (V-&gt;stripPointerCasts() == BDV)</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *VBDV = <a class="code" href="RewriteStatepointsForGC_8cpp.html#af706759f2159b0a0573c72456c55c828">findBaseOrBDV</a>(V, Cache, KnownBases);</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        <span class="keywordflow">if</span> (V-&gt;stripPointerCasts() != VBDV)</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        <span class="comment">// The assumption is that anything not in the state list is</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        <span class="comment">// propagates a base pointer.</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;        <span class="keywordflow">return</span> States.count(VBDV) == 0;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;      };</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160; </div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;      <span class="keywordtype">bool</span> CanPrune = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;      visitBDVOperands(BDV, [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>) {</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        CanPrune = CanPrune &amp;&amp; canPruneInput(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>);</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;      });</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;      <span class="keywordflow">if</span> (CanPrune)</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        <a class="code" href="ARMLowOverheadLoops_8cpp.html#a3bf42baf773b375802538951c88d8e12">ToRemove</a>.push_back(BDV);</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    }</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : <a class="code" href="ARMLowOverheadLoops_8cpp.html#a3bf42baf773b375802538951c88d8e12">ToRemove</a>) {</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      States.erase(V);</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      <span class="comment">// Cache the fact V is it&#39;s own base for later usage.</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;      Cache[V] = V;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    }</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  } <span class="keywordflow">while</span> (!<a class="code" href="ARMLowOverheadLoops_8cpp.html#a3bf42baf773b375802538951c88d8e12">ToRemove</a>.empty());</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160; </div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  <span class="comment">// Did we manage to prove that Def itself must be a base pointer?</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  <span class="keywordflow">if</span> (!States.count(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a>))</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a>;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160; </div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  <span class="comment">// Return a phi state for a base defining value.  We&#39;ll generate a new</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  <span class="comment">// base state for known bases and expect to find a cached state otherwise.</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  <span class="keyword">auto</span> GetStateForBDV = [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *BaseValue, <a class="code" href="classllvm_1_1Value.html">Value</a> *Input) {</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <span class="keyword">auto</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = States.find(BaseValue);</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != States.end())</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="RewriteStatepointsForGC_8cpp.html#a9e70d6aa9b2f9a1b6bff9f405910e1ba">areBothVectorOrScalar</a>(BaseValue, Input));</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    <span class="keywordflow">return</span> BDVState(BaseValue, <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">BDVState::Base</a>, BaseValue);</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;  };</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160; </div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  <span class="keywordtype">bool</span> Progress = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;  <span class="keywordflow">while</span> (Progress) {</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> OldSize = States.size();</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    Progress = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    <span class="comment">// We&#39;re only changing values in this loop, thus safe to keep iterators.</span></div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    <span class="comment">// Since this is computing a fixed point, the order of visit does not</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    <span class="comment">// effect the result.  TODO: We could use a worklist here and make this run</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    <span class="comment">// much faster.</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> Pair : States) {</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *BDV = Pair.first;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;      <span class="comment">// Only values that do not have known bases or those that have differing</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;      <span class="comment">// type (scalar versus vector) from a possible known base should be in the</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;      <span class="comment">// lattice.</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!<a class="code" href="RewriteStatepointsForGC_8cpp.html#a35f66218c3cefa695f682f1b0a1d316b">isKnownBase</a>(BDV, KnownBases) ||</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;             !<a class="code" href="RewriteStatepointsForGC_8cpp.html#a9e70d6aa9b2f9a1b6bff9f405910e1ba">areBothVectorOrScalar</a>(BDV, Pair.second.getBaseValue())) &amp;&amp;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;                 <span class="stringliteral">&quot;why did it get added?&quot;</span>);</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160; </div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      BDVState NewState(BDV);</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      visitBDVOperands(BDV, [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>) {</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *BDV = <a class="code" href="RewriteStatepointsForGC_8cpp.html#af706759f2159b0a0573c72456c55c828">findBaseOrBDV</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>, Cache, KnownBases);</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;        <span class="keyword">auto</span> OpState = GetStateForBDV(BDV, <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>);</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;        NewState.meet(OpState);</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;      });</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160; </div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;      BDVState OldState = States[BDV];</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;      <span class="keywordflow">if</span> (OldState != NewState) {</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        Progress = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;        States[BDV] = NewState;</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;      }</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    }</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160; </div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OldSize == States.size() &amp;&amp;</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;           <span class="stringliteral">&quot;fixed point shouldn&#39;t be adding any new nodes to state&quot;</span>);</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;  }</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160; </div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  VerifyStates();</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;States after meet iteration:\n&quot;</span>);</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;Pair : States) {</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; Pair.second &lt;&lt; <span class="stringliteral">&quot; for &quot;</span> &lt;&lt; *Pair.first &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;  }</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160; </div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  <span class="comment">// Handle all instructions that have a vector BDV, but the instruction itself</span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;  <span class="comment">// is of scalar type.</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> Pair : States) {</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = cast&lt;Instruction&gt;(Pair.first);</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    BDVState State = Pair.second;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    <span class="keyword">auto</span> *BaseValue = State.getBaseValue();</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <span class="comment">// Only values that do not have known bases or those that have differing</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    <span class="comment">// type (scalar versus vector) from a possible known base should be in the</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    <span class="comment">// lattice.</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;        (!<a class="code" href="RewriteStatepointsForGC_8cpp.html#a35f66218c3cefa695f682f1b0a1d316b">isKnownBase</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, KnownBases) || !<a class="code" href="RewriteStatepointsForGC_8cpp.html#a9e70d6aa9b2f9a1b6bff9f405910e1ba">areBothVectorOrScalar</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, BaseValue)) &amp;&amp;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;        <span class="stringliteral">&quot;why did it get added?&quot;</span>);</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!State.isUnknown() &amp;&amp; <span class="stringliteral">&quot;Optimistic algorithm didn&#39;t complete!&quot;</span>);</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160; </div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    <span class="keywordflow">if</span> (!State.isBase() || !isa&lt;VectorType&gt;(BaseValue-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()))</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    <span class="comment">// extractelement instructions are a bit special in that we may need to</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <span class="comment">// insert an extract even when we know an exact base for the instruction.</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    <span class="comment">// The problem is that we need to convert from a vector base to a scalar</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    <span class="comment">// base for the particular indice we&#39;re interested in.</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <span class="keywordflow">if</span> (isa&lt;ExtractElementInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;      <span class="keyword">auto</span> *EE = cast&lt;ExtractElementInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;      <span class="comment">// TODO: In many cases, the new instruction is just EE itself.  We should</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      <span class="comment">// exploit this, but can&#39;t do it here since it would break the invariant</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;      <span class="comment">// about the BDV not being known to be a base.</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;      <span class="keyword">auto</span> *BaseInst = <a class="code" href="classllvm_1_1ExtractElementInst.html#a5d496a334eff64bb2873339b54df932a">ExtractElementInst::Create</a>(</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;          State.getBaseValue(), EE-&gt;getIndexOperand(), <span class="stringliteral">&quot;base_ee&quot;</span>, EE);</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;      BaseInst-&gt;setMetadata(<span class="stringliteral">&quot;is_base_value&quot;</span>, <a class="code" href="classllvm_1_1MDNode.html#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getContext(), {}));</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      States[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = BDVState(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">BDVState::Base</a>, BaseInst);</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      <a class="code" href="RewriteStatepointsForGC_8cpp.html#ac2341c000429806910e78643bbcc1059">setKnownBase</a>(BaseInst, <span class="comment">/* IsKnownBase */</span><span class="keyword">true</span>, KnownBases);</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!isa&lt;VectorType&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType())) {</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;      <span class="comment">// We need to handle cases that have a vector base but the instruction is</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;      <span class="comment">// a scalar type (these could be phis or selects or any instruction that</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;      <span class="comment">// are of scalar type, but the base can be a vector type).  We</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;      <span class="comment">// conservatively set this as conflict.  Setting the base value for these</span></div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;      <span class="comment">// conflicts is handled in the next loop which traverses States.</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;      States[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = BDVState(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, BDVState::Conflict);</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    }</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;  }</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160; </div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;  VerifyStates();</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160; </div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;  <span class="comment">// Insert Phis for all conflicts</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;  <span class="comment">// TODO: adjust naming patterns to avoid this order of iteration dependency</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> Pair : States) {</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = cast&lt;Instruction&gt;(Pair.first);</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    BDVState State = Pair.second;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <span class="comment">// Only values that do not have known bases or those that have differing</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    <span class="comment">// type (scalar versus vector) from a possible known base should be in the</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    <span class="comment">// lattice.</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!<a class="code" href="RewriteStatepointsForGC_8cpp.html#a35f66218c3cefa695f682f1b0a1d316b">isKnownBase</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, KnownBases) ||</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;            !<a class="code" href="RewriteStatepointsForGC_8cpp.html#a9e70d6aa9b2f9a1b6bff9f405910e1ba">areBothVectorOrScalar</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, State.getBaseValue())) &amp;&amp;</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;           <span class="stringliteral">&quot;why did it get added?&quot;</span>);</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!State.isUnknown() &amp;&amp; <span class="stringliteral">&quot;Optimistic algorithm didn&#39;t complete!&quot;</span>);</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160; </div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    <span class="comment">// Since we&#39;re joining a vector and scalar base, they can never be the</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    <span class="comment">// same.  As a result, we should always see insert element having reached</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    <span class="comment">// the conflict state.</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!isa&lt;InsertElementInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || State.isConflict());</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160; </div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    <span class="keywordflow">if</span> (!State.isConflict())</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160; </div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    <span class="keyword">auto</span> getMangledName = [](<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) -&gt; std::string {</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#acb0214b30fb2b9e1d6e1cf6cc851b3e5">suffixed_name_or</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="stringliteral">&quot;.base&quot;</span>, <span class="stringliteral">&quot;base_phi&quot;</span>);</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;SelectInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#acb0214b30fb2b9e1d6e1cf6cc851b3e5">suffixed_name_or</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="stringliteral">&quot;.base&quot;</span>, <span class="stringliteral">&quot;base_select&quot;</span>);</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;ExtractElementInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#acb0214b30fb2b9e1d6e1cf6cc851b3e5">suffixed_name_or</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="stringliteral">&quot;.base&quot;</span>, <span class="stringliteral">&quot;base_ee&quot;</span>);</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;InsertElementInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#acb0214b30fb2b9e1d6e1cf6cc851b3e5">suffixed_name_or</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="stringliteral">&quot;.base&quot;</span>, <span class="stringliteral">&quot;base_ie&quot;</span>);</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#acb0214b30fb2b9e1d6e1cf6cc851b3e5">suffixed_name_or</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="stringliteral">&quot;.base&quot;</span>, <span class="stringliteral">&quot;base_sv&quot;</span>);</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;      }</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    };</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160; </div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *BaseInst = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;clone();</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    BaseInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    BaseInst-&gt;<a class="code" href="classllvm_1_1Value.html#a35ee267850af7c235474a8c46c7ac5af">setName</a>(getMangledName(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <span class="comment">// Add metadata marking this as a base value</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    BaseInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(<span class="stringliteral">&quot;is_base_value&quot;</span>, <a class="code" href="classllvm_1_1MDNode.html#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getContext(), {}));</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    States[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = BDVState(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, BDVState::Conflict, BaseInst);</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#ac2341c000429806910e78643bbcc1059">setKnownBase</a>(BaseInst, <span class="comment">/* IsKnownBase */</span><span class="keyword">true</span>, KnownBases);</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;  }</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160; </div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;  VerifyStates();</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160; </div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  <span class="comment">// Returns a instruction which produces the base pointer for a given</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;  <span class="comment">// instruction.  The instruction is assumed to be an input to one of the BDVs</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  <span class="comment">// seen in the inference algorithm above.  As such, we must either already</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  <span class="comment">// know it&#39;s base defining value is a base, or have inserted a new</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;  <span class="comment">// instruction to propagate the base of it&#39;s BDV and have entered that newly</span></div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;  <span class="comment">// introduced instruction into the state table.  In either case, we are</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;  <span class="comment">// assured to be able to determine an instruction which produces it&#39;s base</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;  <span class="comment">// pointer.</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;  <span class="keyword">auto</span> getBaseForInput = [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *Input, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *InsertPt) {</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *BDV = <a class="code" href="RewriteStatepointsForGC_8cpp.html#af706759f2159b0a0573c72456c55c828">findBaseOrBDV</a>(Input, Cache, KnownBases);</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <span class="keywordflow">if</span> (!States.count(BDV)) {</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="RewriteStatepointsForGC_8cpp.html#a9e70d6aa9b2f9a1b6bff9f405910e1ba">areBothVectorOrScalar</a>(BDV, Input));</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;      <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = BDV;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;      <span class="comment">// Either conflict or base.</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(States.count(BDV));</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;      <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = States[BDV].getBaseValue();</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    }</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> &amp;&amp; <span class="stringliteral">&quot;Can&#39;t be null&quot;</span>);</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <span class="comment">// The cast is needed since base traversal may strip away bitcasts</span></div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>-&gt;getType() != Input-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() &amp;&amp; InsertPt)</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;      <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = <span class="keyword">new</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a>(<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, Input-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), <span class="stringliteral">&quot;cast&quot;</span>, InsertPt);</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;  };</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160; </div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;  <span class="comment">// Fixup all the inputs of the new PHIs.  Visit order needs to be</span></div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;  <span class="comment">// deterministic and predictable because we&#39;re naming newly created</span></div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  <span class="comment">// instructions.</span></div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> Pair : States) {</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *BDV = cast&lt;Instruction&gt;(Pair.first);</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    BDVState State = Pair.second;</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160; </div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    <span class="comment">// Only values that do not have known bases or those that have differing</span></div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <span class="comment">// type (scalar versus vector) from a possible known base should be in the</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    <span class="comment">// lattice.</span></div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!<a class="code" href="RewriteStatepointsForGC_8cpp.html#a35f66218c3cefa695f682f1b0a1d316b">isKnownBase</a>(BDV, KnownBases) ||</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;            !<a class="code" href="RewriteStatepointsForGC_8cpp.html#a9e70d6aa9b2f9a1b6bff9f405910e1ba">areBothVectorOrScalar</a>(BDV, State.getBaseValue())) &amp;&amp;</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;           <span class="stringliteral">&quot;why did it get added?&quot;</span>);</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!State.isUnknown() &amp;&amp; <span class="stringliteral">&quot;Optimistic algorithm didn&#39;t complete!&quot;</span>);</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <span class="keywordflow">if</span> (!State.isConflict())</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160; </div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *BasePHI = dyn_cast&lt;PHINode&gt;(State.getBaseValue())) {</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;      <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = cast&lt;PHINode&gt;(BDV);</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> NumPHIValues = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>();</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160; </div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;      <span class="comment">// The IR verifier requires phi nodes with multiple entries from the</span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;      <span class="comment">// same basic block to have the same incoming value for each of those</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;      <span class="comment">// entries.  Since we&#39;re inserting bitcasts in the loop, make sure we</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;      <span class="comment">// do so at least once per incoming block.</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;      <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;BasicBlock *, Value*&gt;</a> BlockToValue;</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; NumPHIValues; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *InVal = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a16c39eb6e60b42a40c399d8d65347bb6">getIncomingValue</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *InBB = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a8ce0c4746a1ec805e66409d20ae93922">getIncomingBlock</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;        <span class="keywordflow">if</span> (!BlockToValue.<a class="code" href="classllvm_1_1DenseMapBase.html#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(InBB))</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;          BlockToValue[InBB] = getBaseForInput(InVal, InBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>());</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *OldBase = BlockToValue[InBB];</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = getBaseForInput(InVal, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160; </div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;          <span class="comment">// We can&#39;t use `stripPointerCasts` instead of this function because</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;          <span class="comment">// `stripPointerCasts` doesn&#39;t handle vectors of pointers.</span></div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;          <span class="keyword">auto</span> StripBitCasts = [](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) -&gt; <a class="code" href="classllvm_1_1Value.html">Value</a> * {</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;            <span class="keywordflow">while</span> (<span class="keyword">auto</span> *BC = dyn_cast&lt;BitCastInst&gt;(V))</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;              V = BC-&gt;getOperand(0);</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;            <span class="keywordflow">return</span> V;</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;          };</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;          <span class="comment">// In essence this assert states: the only way two values</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;          <span class="comment">// incoming from the same basic block may be different is by</span></div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;          <span class="comment">// being different bitcasts of the same value.  A cleanup</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;          <span class="comment">// that remains TODO is changing findBaseOrBDV to return an</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;          <span class="comment">// llvm::Value of the correct type (and still remain pure).</span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;          <span class="comment">// This will remove the need to add bitcasts.</span></div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(StripBitCasts(<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>) == StripBitCasts(OldBase) &amp;&amp;</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;                 <span class="stringliteral">&quot;findBaseOrBDV should be pure!&quot;</span>);</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;        }</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = BlockToValue[InBB];</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;        BasePHI-&gt;setIncomingValue(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>);</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;      }</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *BaseSI =</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;                   dyn_cast&lt;SelectInst&gt;(State.getBaseValue())) {</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;      <a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = cast&lt;SelectInst&gt;(BDV);</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160; </div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;      <span class="comment">// Find the instruction which produces the base for each input.</span></div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;      <span class="comment">// We may need to insert a bitcast.</span></div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;      BaseSI-&gt;setTrueValue(getBaseForInput(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getTrueValue(), BaseSI));</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;      BaseSI-&gt;setFalseValue(getBaseForInput(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getFalseValue(), BaseSI));</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *BaseEE =</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;                   dyn_cast&lt;ExtractElementInst&gt;(State.getBaseValue())) {</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *InVal = cast&lt;ExtractElementInst&gt;(BDV)-&gt;getVectorOperand();</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;      <span class="comment">// Find the instruction which produces the base for each input.  We may</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;      <span class="comment">// need to insert a bitcast.</span></div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;      BaseEE-&gt;setOperand(0, getBaseForInput(InVal, BaseEE));</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *BaseIE = dyn_cast&lt;InsertElementInst&gt;(State.getBaseValue())){</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;      <span class="keyword">auto</span> *BdvIE = cast&lt;InsertElementInst&gt;(BDV);</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;      <span class="keyword">auto</span> UpdateOperand = [&amp;](<span class="keywordtype">int</span> OperandIdx) {</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *InVal = BdvIE-&gt;getOperand(OperandIdx);</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = getBaseForInput(InVal, BaseIE);</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;        BaseIE-&gt;setOperand(OperandIdx, <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>);</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;      };</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;      UpdateOperand(0); <span class="comment">// vector operand</span></div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;      UpdateOperand(1); <span class="comment">// scalar operand</span></div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;      <span class="keyword">auto</span> *BaseSV = cast&lt;ShuffleVectorInst&gt;(State.getBaseValue());</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;      <span class="keyword">auto</span> *BdvSV = cast&lt;ShuffleVectorInst&gt;(BDV);</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;      <span class="keyword">auto</span> UpdateOperand = [&amp;](<span class="keywordtype">int</span> OperandIdx) {</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *InVal = BdvSV-&gt;getOperand(OperandIdx);</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = getBaseForInput(InVal, BaseSV);</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;        BaseSV-&gt;setOperand(OperandIdx, <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>);</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;      };</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;      UpdateOperand(0); <span class="comment">// vector operand</span></div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;      <span class="keywordflow">if</span> (!BdvSV-&gt;isZeroEltSplat())</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;        UpdateOperand(1); <span class="comment">// vector operand</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;        <span class="comment">// Never read, so just use undef</span></div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *InVal = BdvSV-&gt;getOperand(1);</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        BaseSV-&gt;setOperand(1, <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(InVal-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()));</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;      }</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    }</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;  }</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160; </div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;  VerifyStates();</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160; </div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;  <span class="comment">// Cache all of our results so we can cheaply reuse them</span></div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;  <span class="comment">// NOTE: This is actually two caches: one of the base defining value</span></div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;  <span class="comment">// relation and one of the base pointer relation!  FIXME</span></div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> Pair : States) {</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    <span class="keyword">auto</span> *BDV = Pair.first;</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = Pair.second.getBaseValue();</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BDV &amp;&amp; <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>);</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    <span class="comment">// Only values that do not have known bases or those that have differing</span></div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    <span class="comment">// type (scalar versus vector) from a possible known base should be in the</span></div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;    <span class="comment">// lattice.</span></div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;        (!<a class="code" href="RewriteStatepointsForGC_8cpp.html#a35f66218c3cefa695f682f1b0a1d316b">isKnownBase</a>(BDV, KnownBases) || !<a class="code" href="RewriteStatepointsForGC_8cpp.html#a9e70d6aa9b2f9a1b6bff9f405910e1ba">areBothVectorOrScalar</a>(BDV, <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>)) &amp;&amp;</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;        <span class="stringliteral">&quot;why did it get added?&quot;</span>);</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160; </div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Updating base value cache&quot;</span></div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;               &lt;&lt; <span class="stringliteral">&quot; for: &quot;</span> &lt;&lt; BDV-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() &lt;&lt; <span class="stringliteral">&quot; from: &quot;</span></div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;               &lt;&lt; (Cache.count(BDV) ? Cache[BDV]-&gt;getName().str() : <span class="stringliteral">&quot;none&quot;</span>)</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;               &lt;&lt; <span class="stringliteral">&quot; to: &quot;</span> &lt;&lt; <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160; </div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    Cache[BDV] = <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>;</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;  }</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Cache.count(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a>));</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;  <span class="keywordflow">return</span> Cache[<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a>];</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;}</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160; </div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="comment">// For a set of live pointers (base and/or derived), identify the base</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;<span class="comment">// pointer of the object which they are derived from.  This routine will</span></div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;<span class="comment">// mutate the IR graph as needed to make the &#39;base&#39; pointer live at the</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="comment">// definition site of &#39;derived&#39;.  This ensures that any use of &#39;derived&#39; can</span></div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;<span class="comment">// also use &#39;base&#39;.  This may involve the insertion of a number of</span></div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="comment">// additional PHI nodes.</span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="comment">// preconditions: live is a set of pointer type Values</span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="comment">// side effects: may insert PHI nodes into the existing CFG, will preserve</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="comment">// CFG, will not remove or mutate any existing nodes</span></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;<span class="comment">// post condition: PointerToBase contains one (derived, base) pair for every</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;<span class="comment">// pointer in live.  Note that derived can be equal to base if the original</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="comment">// pointer was a base pointer.</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a8b9e4ec572c189d8f8afc4f71da55a9c"> 1347</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a8b9e4ec572c189d8f8afc4f71da55a9c">findBasePointers</a>(<span class="keyword">const</span> <a class="code" href="namespacefalse.html#afaa1384eeb44548e3d6b1324ebc65c3c">StatepointLiveSetTy</a> &amp;live,</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;                             <a class="code" href="namespacefalse.html#abbdd09796205857296660052b67cc167">PointerToBaseTy</a> &amp;PointerToBase, <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> *DT,</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;                             <a class="code" href="namespacefalse.html#a00af9f2347076bfb43b7d4e286feb576">DefiningValueMapTy</a> &amp;DVCache,</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;                             <a class="code" href="namespacefalse.html#a9f5b65a81eb5133d76ed041f31f7ceac">IsKnownBaseMapTy</a> &amp;KnownBases) {</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *ptr : live) {</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="lib_2Target_2SystemZ_2README_8txt.html#aff41f78457c5b0beb8af78edab100d70">base</a> = <a class="code" href="RewriteStatepointsForGC_8cpp.html#a1b9baa03d5a238d6a2b34668dfe087b3">findBasePointer</a>(ptr, DVCache, KnownBases);</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="lib_2Target_2SystemZ_2README_8txt.html#aff41f78457c5b0beb8af78edab100d70">base</a> &amp;&amp; <span class="stringliteral">&quot;failed to find base pointer&quot;</span>);</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    PointerToBase[ptr] = <a class="code" href="lib_2Target_2SystemZ_2README_8txt.html#aff41f78457c5b0beb8af78edab100d70">base</a>;</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!isa&lt;Instruction&gt;(<a class="code" href="lib_2Target_2SystemZ_2README_8txt.html#aff41f78457c5b0beb8af78edab100d70">base</a>) || !isa&lt;Instruction&gt;(ptr) ||</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;            DT-&gt;<a class="code" href="classllvm_1_1DominatorTree.html#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(cast&lt;Instruction&gt;(<a class="code" href="lib_2Target_2SystemZ_2README_8txt.html#aff41f78457c5b0beb8af78edab100d70">base</a>)-&gt;getParent(),</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;                          cast&lt;Instruction&gt;(ptr)-&gt;getParent())) &amp;&amp;</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;           <span class="stringliteral">&quot;The base we found better dominate the derived pointer&quot;</span>);</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;  }</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;}</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;<span class="comment">/// Find the required based pointers (and adjust the live set) for the given</span></div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="comment">/// parse point.</span></div>
<div class="line"><a name="l01364"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a8c10e113105c9e4572375106371d8ae6"> 1364</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a8b9e4ec572c189d8f8afc4f71da55a9c">findBasePointers</a>(<a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;DT, <a class="code" href="namespacefalse.html#a00af9f2347076bfb43b7d4e286feb576">DefiningValueMapTy</a> &amp;DVCache,</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;                             <a class="code" href="classllvm_1_1CallBase.html">CallBase</a> *Call,</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;                             PartiallyConstructedSafepointRecord &amp;<a class="code" href="README__P9_8txt.html#ae070adaf1b4bf0e7c12fcae2b9c5ae67">result</a>,</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;                             <a class="code" href="namespacefalse.html#abbdd09796205857296660052b67cc167">PointerToBaseTy</a> &amp;PointerToBase,</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;                             <a class="code" href="namespacefalse.html#a9f5b65a81eb5133d76ed041f31f7ceac">IsKnownBaseMapTy</a> &amp;KnownBases) {</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;  <a class="code" href="namespacefalse.html#afaa1384eeb44548e3d6b1324ebc65c3c">StatepointLiveSetTy</a> PotentiallyDerivedPointers = <a class="code" href="README__P9_8txt.html#ae070adaf1b4bf0e7c12fcae2b9c5ae67">result</a>.LiveSet;</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;  <span class="comment">// We assume that all pointers passed to deopt are base pointers; as an</span></div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;  <span class="comment">// optimization, we can use this to avoid seperately materializing the base</span></div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;  <span class="comment">// pointer graph.  This is only relevant since we&#39;re very conservative about</span></div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;  <span class="comment">// generating new conflict nodes during base pointer insertion.  If we were</span></div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;  <span class="comment">// smarter there, this would be irrelevant.</span></div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> Opt = Call-&gt;getOperandBundle(<a class="code" href="classllvm_1_1LLVMContext.html#a800c1300065ca1615d2f4fb88623afd5a3f6df86c6efab701ade7abbc3134c25a">LLVMContext::OB_deopt</a>))</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : Opt-&gt;Inputs) {</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;      <span class="keywordflow">if</span> (!PotentiallyDerivedPointers.count(V))</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;      PotentiallyDerivedPointers.remove(V);</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;      PointerToBase[V] = V;</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    }</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;  <a class="code" href="RewriteStatepointsForGC_8cpp.html#a8b9e4ec572c189d8f8afc4f71da55a9c">findBasePointers</a>(PotentiallyDerivedPointers, PointerToBase, &amp;DT, DVCache,</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;                   KnownBases);</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;}</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="comment">/// Given an updated version of the dataflow liveness results, update the</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="comment">/// liveset and base pointer maps for the call site CS.</span></div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#af864550d3c61aff5c6777610fdba8b7f">recomputeLiveInValues</a>(GCPtrLivenessData &amp;RevisedLivenessData,</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;                                  <a class="code" href="classllvm_1_1CallBase.html">CallBase</a> *Call,</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;                                  PartiallyConstructedSafepointRecord &amp;<a class="code" href="README__P9_8txt.html#ae070adaf1b4bf0e7c12fcae2b9c5ae67">result</a>,</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;                                  <a class="code" href="namespacefalse.html#abbdd09796205857296660052b67cc167">PointerToBaseTy</a> &amp;PointerToBase,</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;                                  <a class="code" href="classllvm_1_1GCStrategy.html">GCStrategy</a> *GC);</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160; </div>
<div class="line"><a name="l01394"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a17d6db03c2e193f9d391dae5b3847edf"> 1394</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#af864550d3c61aff5c6777610fdba8b7f">recomputeLiveInValues</a>(</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    <a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;DT, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;CallBase *&gt;</a> toUpdate,</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    <a class="code" href="classllvm_1_1MutableArrayRef.html">MutableArrayRef&lt;struct PartiallyConstructedSafepointRecord&gt;</a> records,</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    <a class="code" href="namespacefalse.html#abbdd09796205857296660052b67cc167">PointerToBaseTy</a> &amp;PointerToBase, <a class="code" href="classllvm_1_1GCStrategy.html">GCStrategy</a> *GC) {</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;  <span class="comment">// TODO-PERF: reuse the original liveness, then simply run the dataflow</span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;  <span class="comment">// again.  The old values are still live and will help it stabilize quickly.</span></div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;  GCPtrLivenessData RevisedLivenessData;</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;  <a class="code" href="RewriteStatepointsForGC_8cpp.html#a9b5f57931ea7a3a623b6e8ac416177c1">computeLiveInValues</a>(DT, <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, RevisedLivenessData, GC);</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; records.size(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    <span class="keyword">struct </span>PartiallyConstructedSafepointRecord &amp;<a class="code" href="LazyValueInfo_8cpp.html#add11cb1bc38847ce70e526af765dcce7">info</a> = records[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#af864550d3c61aff5c6777610fdba8b7f">recomputeLiveInValues</a>(RevisedLivenessData, toUpdate[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="LazyValueInfo_8cpp.html#add11cb1bc38847ce70e526af765dcce7">info</a>, PointerToBase,</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;                          GC);</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  }</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;}</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160; </div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;<span class="comment">// Utility function which clones all instructions from &quot;ChainToBase&quot;</span></div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="comment">// and inserts them before &quot;InsertBefore&quot;. Returns rematerialized value</span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="comment">// which should be used after statepoint.</span></div>
<div class="line"><a name="l01412"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a0d959321ece754ecd86333ecfd33bac4"> 1412</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="RewriteStatepointsForGC_8cpp.html#a0d959321ece754ecd86333ecfd33bac4">rematerializeChain</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Instruction *&gt;</a> ChainToBase,</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;                                       <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *InsertBefore,</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;                                       <a class="code" href="classllvm_1_1Value.html">Value</a> *RootOfChain,</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;                                       <a class="code" href="classllvm_1_1Value.html">Value</a> *AlternateLiveBase) {</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *LastClonedValue = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *LastValue = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;  <span class="comment">// Walk backwards to visit top-most instructions first.</span></div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Instr :</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;       <a class="code" href="namespacellvm.html#ad1a91b49e0c092818a0b82f6cc130a1b">make_range</a>(ChainToBase.<a class="code" href="classllvm_1_1ArrayRef.html#aebe6da1ab4a07020669f3d6148c0b559">rbegin</a>(), ChainToBase.<a class="code" href="classllvm_1_1ArrayRef.html#a709f5d7f042648ec20197939d9a6805f">rend</a>())) {</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <span class="comment">// Only GEP&#39;s and casts are supported as we need to be careful to not</span></div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    <span class="comment">// introduce any new uses of pointers not in the liveset.</span></div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    <span class="comment">// Note that it&#39;s fine to introduce new uses of pointers which were</span></div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    <span class="comment">// otherwise not used after this statepoint.</span></div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isa&lt;GetElementPtrInst&gt;(Instr) || isa&lt;CastInst&gt;(Instr));</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160; </div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ClonedValue = Instr-&gt;<a class="code" href="classllvm_1_1Instruction.html#a0a4d51e372293abe5e5f6dac133e80a6">clone</a>();</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    ClonedValue-&gt;<a class="code" href="classllvm_1_1Instruction.html#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(InsertBefore);</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    ClonedValue-&gt;<a class="code" href="classllvm_1_1Value.html#a35ee267850af7c235474a8c46c7ac5af">setName</a>(Instr-&gt;getName() + <span class="stringliteral">&quot;.remat&quot;</span>);</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160; </div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    <span class="comment">// If it is not first instruction in the chain then it uses previously</span></div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    <span class="comment">// cloned value. We should update it to use cloned value.</span></div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    <span class="keywordflow">if</span> (LastClonedValue) {</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LastValue);</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;      ClonedValue-&gt;<a class="code" href="classllvm_1_1User.html#a1600c7959045cb6b6a5f5a1d427ec67e">replaceUsesOfWith</a>(LastValue, LastClonedValue);</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *OpValue : ClonedValue-&gt;<a class="code" href="classllvm_1_1User.html#a176409317fc26e8be3c6af0193643c27">operand_values</a>()) {</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;        <span class="comment">// Assert that cloned instruction does not use any instructions from</span></div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;        <span class="comment">// this chain other than LastClonedValue</span></div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a class="code" href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">is_contained</a>(ChainToBase, OpValue) &amp;&amp;</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;               <span class="stringliteral">&quot;incorrect use in rematerialization chain&quot;</span>);</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;        <span class="comment">// Assert that the cloned instruction does not use the RootOfChain</span></div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;        <span class="comment">// or the AlternateLiveBase.</span></div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OpValue != RootOfChain &amp;&amp; OpValue != AlternateLiveBase);</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;      }</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;      <span class="comment">// For the first instruction, replace the use of unrelocated base i.e.</span></div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;      <span class="comment">// RootOfChain/OrigRootPhi, with the corresponding PHI present in the</span></div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;      <span class="comment">// live set. They have been proved to be the same PHI nodes.  Note</span></div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;      <span class="comment">// that the *only* use of the RootOfChain in the ChainToBase list is</span></div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;      <span class="comment">// the first Value in the list.</span></div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;      <span class="keywordflow">if</span> (RootOfChain != AlternateLiveBase)</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;        ClonedValue-&gt;<a class="code" href="classllvm_1_1User.html#a1600c7959045cb6b6a5f5a1d427ec67e">replaceUsesOfWith</a>(RootOfChain, AlternateLiveBase);</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    }</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160; </div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    LastClonedValue = ClonedValue;</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    LastValue = Instr;</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;  }</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LastClonedValue);</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;  <span class="keywordflow">return</span> LastClonedValue;</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;}</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160; </div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;<span class="comment">// When inserting gc.relocate and gc.result calls, we need to ensure there are</span></div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;<span class="comment">// no uses of the original value / return value between the gc.statepoint and</span></div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;<span class="comment">// the gc.relocate / gc.result call.  One case which can arise is a phi node</span></div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;<span class="comment">// starting one of the successor blocks.  We also need to be able to insert the</span></div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;<span class="comment">// gc.relocates only on the path which goes through the statepoint.  We might</span></div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;<span class="comment">// need to split an edge to make this possible.</span></div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *</div>
<div class="line"><a name="l01471"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a15f212bb9de8ad1bff2d4732f12397ee"> 1471</a></span>&#160;<a class="code" href="RewriteStatepointsForGC_8cpp.html#a15f212bb9de8ad1bff2d4732f12397ee">normalizeForInvokeSafepoint</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *InvokeParent,</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;                            <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;DT) {</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba366e1eac31eeb1a1892d62ccfc0c8cf8">Ret</a> = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>;</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getUniquePredecessor())</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba366e1eac31eeb1a1892d62ccfc0c8cf8">Ret</a> = <a class="code" href="namespacellvm.html#a9d391b6acc6d90c9b8a8442324b1aa6f">SplitBlockPredecessors</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, InvokeParent, <span class="stringliteral">&quot;&quot;</span>, &amp;DT);</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160; </div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;  <span class="comment">// Now that &#39;Ret&#39; has unique predecessor we can safely remove all phi nodes</span></div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;  <span class="comment">// from it</span></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;  <a class="code" href="namespacellvm.html#ab7e8be1d1ae7e526ea156b60c51c10e5">FoldSingleEntryPHINodes</a>(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba366e1eac31eeb1a1892d62ccfc0c8cf8">Ret</a>);</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!isa&lt;PHINode&gt;(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba366e1eac31eeb1a1892d62ccfc0c8cf8">Ret</a>-&gt;begin()) &amp;&amp;</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;         <span class="stringliteral">&quot;All PHI nodes should have been removed!&quot;</span>);</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160; </div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;  <span class="comment">// At this point, we can safely insert a gc.relocate or gc.result as the first</span></div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;  <span class="comment">// instruction in Ret if needed.</span></div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba366e1eac31eeb1a1892d62ccfc0c8cf8">Ret</a>;</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;}</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160; </div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;<span class="comment">// List of all function attributes which must be stripped when lowering from</span></div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;<span class="comment">// abstract machine model to physical machine model.  Essentially, these are</span></div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;<span class="comment">// all the effects a safepoint might have which we ignored in the abstract</span></div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;<span class="comment">// machine model for purposes of optimization.  We have to strip these on</span></div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;<span class="comment">// both function declarations and call sites.</span></div>
<div class="line"><a name="l01493"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a9d33f9de1cf6f2a221b8d60dd95effb9"> 1493</a></span>&#160;<span class="keyword">static</span> constexpr <a class="code" href="classllvm_1_1Attribute.html#aab7ee4b8fd1d3e7e4cea87868855e60e">Attribute::AttrKind</a> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a9d33f9de1cf6f2a221b8d60dd95effb9">FnAttrsToStrip</a>[] =</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;  {Attribute::Memory, Attribute::NoSync, Attribute::NoFree};</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160; </div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;<span class="comment">// Create new attribute set containing only attributes which can be transferred</span></div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;<span class="comment">// from original call to the safepoint.</span></div>
<div class="line"><a name="l01498"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a50fac92017d0843263cc84ebc2d1ac45"> 1498</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1AttributeList.html">AttributeList</a> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a50fac92017d0843263cc84ebc2d1ac45">legalizeCallAttributes</a>(<a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx,</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;                                            <a class="code" href="classllvm_1_1AttributeList.html">AttributeList</a> OrigAL,</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;                                            <a class="code" href="classllvm_1_1AttributeList.html">AttributeList</a> StatepointAL) {</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;  <span class="keywordflow">if</span> (OrigAL.<a class="code" href="classllvm_1_1AttributeList.html#a5269e6b95f5007a652d53ca847cca6f3">isEmpty</a>())</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    <span class="keywordflow">return</span> StatepointAL;</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160; </div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;  <span class="comment">// Remove the readonly, readnone, and statepoint function attributes.</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;  <a class="code" href="classllvm_1_1AttrBuilder.html">AttrBuilder</a> FnAttrs(Ctx, OrigAL.<a class="code" href="classllvm_1_1AttributeList.html#a1cf553641e8527095ae4c8ec88a2cd92">getFnAttrs</a>());</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> Attr : <a class="code" href="RewriteStatepointsForGC_8cpp.html#a9d33f9de1cf6f2a221b8d60dd95effb9">FnAttrsToStrip</a>)</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    FnAttrs.<a class="code" href="classllvm_1_1AttrBuilder.html#aa63e528eeff5082f6920b10244143920">removeAttribute</a>(Attr);</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160; </div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Attribute.html">Attribute</a> <a class="code" href="README__ALTIVEC_8txt.html#a015846b6188ce15e08cd94c74a9df1a3">A</a> : OrigAL.<a class="code" href="classllvm_1_1AttributeList.html#a1cf553641e8527095ae4c8ec88a2cd92">getFnAttrs</a>()) {</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ae63d2db6b5c5d02973f882f17caf52b6">isStatepointDirectiveAttr</a>(<a class="code" href="README__ALTIVEC_8txt.html#a015846b6188ce15e08cd94c74a9df1a3">A</a>))</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;      FnAttrs.<a class="code" href="classllvm_1_1AttrBuilder.html#aa63e528eeff5082f6920b10244143920">removeAttribute</a>(<a class="code" href="README__ALTIVEC_8txt.html#a015846b6188ce15e08cd94c74a9df1a3">A</a>);</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;  }</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160; </div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;  <span class="comment">// Just skip parameter and return attributes for now</span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;  <span class="keywordflow">return</span> StatepointAL.<a class="code" href="classllvm_1_1AttributeList.html#a5d7d1a9d74e14b7535745a80fbc51f70">addFnAttributes</a>(Ctx, FnAttrs);</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;}</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;<span class="comment">/// Helper function to place all gc relocates necessary for the given</span></div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;<span class="comment">/// statepoint.</span></div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;<span class="comment">/// Inputs:</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;<span class="comment">///   liveVariables - list of variables to be relocated.</span></div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;<span class="comment">///   basePtrs - base pointers.</span></div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;<span class="comment">///   statepointToken - statepoint instruction to which relocates should be</span></div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;<span class="comment">///   bound.</span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;<span class="comment">///   Builder - Llvm IR builder to be used to construct new calls.</span></div>
<div class="line"><a name="l01526"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#ace7e2f01b65afba76343f22d042a12df"> 1526</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#ace7e2f01b65afba76343f22d042a12df">CreateGCRelocates</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> <a class="code" href="classllvm_1_1LiveVariables.html">LiveVariables</a>,</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;                              <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> BasePtrs,</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;                              <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *StatepointToken,</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;                              <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="classllvm_1_1GCStrategy.html">GCStrategy</a> *GC) {</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LiveVariables.html">LiveVariables</a>.empty())</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160; </div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;  <span class="keyword">auto</span> FindIndex = [](<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> LiveVec, <a class="code" href="classllvm_1_1Value.html">Value</a> *Val) {</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    <span class="keyword">auto</span> ValIt = <a class="code" href="namespacellvm.html#a086e9fbdb06276db7753101a08a63adf">llvm::find</a>(LiveVec, Val);</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ValIt != LiveVec.<a class="code" href="classllvm_1_1ArrayRef.html#a7ca5197533a9c1fb8a2bd30587fcec6b">end</a>() &amp;&amp; <span class="stringliteral">&quot;Val not found in LiveVec!&quot;</span>);</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a> = std::distance(LiveVec.<a class="code" href="classllvm_1_1ArrayRef.html#aab36927882fbfdcbb860d87fd9c30da8">begin</a>(), ValIt);</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a> &lt; LiveVec.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() &amp;&amp; <span class="stringliteral">&quot;Bug in std::find?&quot;</span>);</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="ELFObjHandler_8cpp.html#aef61945034b9431b804748fc317c5548">Index</a>;</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;  };</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;  <a class="code" href="classllvm_1_1Module.html">Module</a> *<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a> = StatepointToken-&gt;<a class="code" href="classllvm_1_1Instruction.html#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>();</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160; </div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;  <span class="comment">// All gc_relocate are generated as i8 addrspace(1)* (or a vector type whose</span></div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;  <span class="comment">// element type is i8 addrspace(1)*). We originally generated unique</span></div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;  <span class="comment">// declarations for each pointer type, but this proved problematic because</span></div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;  <span class="comment">// the intrinsic mangling code is incomplete and fragile.  Since we&#39;re moving</span></div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;  <span class="comment">// towards a single unified pointer type anyways, we can just cast everything</span></div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;  <span class="comment">// to an i8* of the right address space.  A bitcast is added later to convert</span></div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;  <span class="comment">// gc_relocate to the actual value&#39;s type.</span></div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;  <span class="keyword">auto</span> getGCRelocateDecl = [&amp;](<a class="code" href="classllvm_1_1Type.html">Type</a> *Ty) {</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="RewriteStatepointsForGC_8cpp.html#aa24dcfb77b1890aaa6d1f687eeffe665">isHandledGCPointerType</a>(Ty, GC));</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    <span class="keyword">auto</span> AS = Ty-&gt;getScalarType()-&gt;getPointerAddressSpace();</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *NewTy = <a class="code" href="classllvm_1_1Type.html#a7fe9ccd4893f4e2caa826126c09545ea">Type::getInt8PtrTy</a>(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>-&gt;getContext(), AS);</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *VT = dyn_cast&lt;VectorType&gt;(Ty))</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;      NewTy = <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(NewTy,</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;                                   cast&lt;FixedVectorType&gt;(VT)-&gt;getNumElements());</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1Intrinsic.html#aefa39f6b622360ce4e947feb9f671b73">Intrinsic::getDeclaration</a>(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, Intrinsic::experimental_gc_relocate,</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;                                     {NewTy});</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;  };</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160; </div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;  <span class="comment">// Lazily populated map from input types to the canonicalized form mentioned</span></div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  <span class="comment">// in the comment above.  This should probably be cached somewhere more</span></div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;  <span class="comment">// broadly.</span></div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Type *, Function *&gt;</a> TypeToDeclMap;</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160; </div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="classllvm_1_1LiveVariables.html">LiveVariables</a>.size(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    <span class="comment">// Generate the gc.relocate call and save the result</span></div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *BaseIdx = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt32(FindIndex(<a class="code" href="classllvm_1_1LiveVariables.html">LiveVariables</a>, BasePtrs[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]));</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *LiveIdx = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt32(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160; </div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty = <a class="code" href="classllvm_1_1LiveVariables.html">LiveVariables</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;getType();</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;    <span class="keywordflow">if</span> (!TypeToDeclMap.<a class="code" href="classllvm_1_1DenseMapBase.html#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(Ty))</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;      TypeToDeclMap[Ty] = getGCRelocateDecl(Ty);</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    <a class="code" href="classllvm_1_1Function.html">Function</a> *GCRelocateDecl = TypeToDeclMap[Ty];</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160; </div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    <span class="comment">// only specify a debug name if we can give a useful one</span></div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;    <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *Reloc = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCall(</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;        GCRelocateDecl, {StatepointToken, BaseIdx, LiveIdx},</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;        <a class="code" href="RewriteStatepointsForGC_8cpp.html#acb0214b30fb2b9e1d6e1cf6cc851b3e5">suffixed_name_or</a>(<a class="code" href="classllvm_1_1LiveVariables.html">LiveVariables</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>], <span class="stringliteral">&quot;.relocated&quot;</span>, <span class="stringliteral">&quot;&quot;</span>));</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;    <span class="comment">// Trick CodeGen into thinking there are lots of free registers at this</span></div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;    <span class="comment">// fake call.</span></div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    Reloc-&gt;<a class="code" href="classllvm_1_1CallBase.html#a0851b4de29686e9c3918449b054cfada">setCallingConv</a>(<a class="code" href="namespacellvm_1_1CallingConv.html#a5b166ae228ebbfdb96736d6022f3feeda94ec9273479164e4aec1d5d91b71dc85">CallingConv::Cold</a>);</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;  }</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;}</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160; </div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;<span class="comment">/// This struct is used to defer RAUWs and `eraseFromParent` s.  Using this</span></div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;<span class="comment">/// avoids having to worry about keeping around dangling pointers to Values.</span></div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;<span class="comment"></span><span class="keyword">class </span>DeferredReplacement {</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;  <a class="code" href="classllvm_1_1AssertingVH.html">AssertingVH&lt;Instruction&gt;</a> Old;</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;  <a class="code" href="classllvm_1_1AssertingVH.html">AssertingVH&lt;Instruction&gt;</a> <a class="code" href="namespacellvm_1_1ms__demangle.html#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a>;</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;  <span class="keywordtype">bool</span> IsDeoptimize = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160; </div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;  DeferredReplacement() = <span class="keywordflow">default</span>;</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160; </div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;  <span class="keyword">static</span> DeferredReplacement createRAUW(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Old, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *New) {</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Old != New &amp;&amp; Old &amp;&amp; New &amp;&amp;</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;           <span class="stringliteral">&quot;Cannot RAUW equal values or to / from null!&quot;</span>);</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160; </div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;    DeferredReplacement <a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>;</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;    <a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>.Old = Old;</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;    <a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>.New = <a class="code" href="namespacellvm_1_1ms__demangle.html#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a>;</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>;</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;  }</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160; </div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;  <span class="keyword">static</span> DeferredReplacement createDelete(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ToErase) {</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    DeferredReplacement <a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>;</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;    <a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>.Old = ToErase;</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>;</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;  }</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160; </div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;  <span class="keyword">static</span> DeferredReplacement createDeoptimizeReplacement(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Old) {</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;    <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = cast&lt;CallInst&gt;(Old)-&gt;getCalledFunction();</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> &amp;&amp; <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getIntrinsicID() == Intrinsic::experimental_deoptimize &amp;&amp;</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;           <span class="stringliteral">&quot;Only way to construct a deoptimize deferred replacement&quot;</span>);</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;    DeferredReplacement <a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>;</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    <a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>.Old = Old;</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;    <a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>.IsDeoptimize = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>;</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;  }</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="comment">  /// Does the task represented by this instance.</span></div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> doReplacement() {</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *OldI = Old;</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NewI = <a class="code" href="namespacellvm_1_1ms__demangle.html#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a>;</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160; </div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OldI != NewI &amp;&amp; <span class="stringliteral">&quot;Disallowed at construction?!&quot;</span>);</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!IsDeoptimize || !New) &amp;&amp;</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;           <span class="stringliteral">&quot;Deoptimize intrinsics are not replaced!&quot;</span>);</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160; </div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;    Old = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;    <a class="code" href="namespacellvm_1_1ms__demangle.html#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160; </div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;    <span class="keywordflow">if</span> (NewI)</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;      OldI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewI);</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160; </div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    <span class="keywordflow">if</span> (IsDeoptimize) {</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;      <span class="comment">// Note: we&#39;ve inserted instructions, so the call to llvm.deoptimize may</span></div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;      <span class="comment">// not necessarily be followed by the matching return.</span></div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;      <span class="keyword">auto</span> *RI = cast&lt;ReturnInst&gt;(OldI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>());</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;      <span class="keyword">new</span> <a class="code" href="classllvm_1_1UnreachableInst.html">UnreachableInst</a>(RI-&gt;getContext(), RI);</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;      RI-&gt;eraseFromParent();</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    }</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160; </div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;    OldI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;  }</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;};</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160; </div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160; </div>
<div class="line"><a name="l01654"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#ad6d87a400bc9669540b19739d36b4488"> 1654</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> <a class="code" href="RewriteStatepointsForGC_8cpp.html#ad6d87a400bc9669540b19739d36b4488">getDeoptLowering</a>(<a class="code" href="classllvm_1_1CallBase.html">CallBase</a> *Call) {</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *DeoptLowering = <span class="stringliteral">&quot;deopt-lowering&quot;</span>;</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;  <span class="keywordflow">if</span> (Call-&gt;hasFnAttr(DeoptLowering)) {</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    <span class="comment">// FIXME: Calls have a *really* confusing interface around attributes</span></div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;    <span class="comment">// with values.</span></div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1AttributeList.html">AttributeList</a> &amp;CSAS = Call-&gt;getAttributes();</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;    <span class="keywordflow">if</span> (CSAS.<a class="code" href="classllvm_1_1AttributeList.html#a61054ea97168f709c1e46345f80c16a3">hasFnAttr</a>(DeoptLowering))</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;      <span class="keywordflow">return</span> CSAS.<a class="code" href="classllvm_1_1AttributeList.html#a90024ee48918b2167a4c9409750d4148">getFnAttr</a>(DeoptLowering).<a class="code" href="classllvm_1_1Attribute.html#a968930aea9d9efa8d46dd890fce75643">getValueAsString</a>();</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;    <a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = Call-&gt;getCalledFunction();</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> &amp;&amp; <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;hasFnAttribute(DeoptLowering));</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFnAttribute(DeoptLowering).getValueAsString();</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;  }</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;  <span class="keywordflow">return</span> <span class="stringliteral">&quot;live-through&quot;</span>;</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;}</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160; </div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l01670"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a03f51e12bc910c9dc19f38b36f58a223"> 1670</a></span>&#160;<a class="code" href="RewriteStatepointsForGC_8cpp.html#a03f51e12bc910c9dc19f38b36f58a223">makeStatepointExplicitImpl</a>(<a class="code" href="classllvm_1_1CallBase.html">CallBase</a> *Call, <span class="comment">/* to replace */</span></div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;                           <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Value *&gt;</a> &amp;BasePtrs,</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;                           <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Value *&gt;</a> &amp;<a class="code" href="classllvm_1_1LiveVariables.html">LiveVariables</a>,</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;                           PartiallyConstructedSafepointRecord &amp;Result,</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;                           std::vector&lt;DeferredReplacement&gt; &amp;Replacements,</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;                           <span class="keyword">const</span> <a class="code" href="namespacefalse.html#abbdd09796205857296660052b67cc167">PointerToBaseTy</a> &amp;PointerToBase,</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;                           <a class="code" href="classllvm_1_1GCStrategy.html">GCStrategy</a> *GC) {</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BasePtrs.size() == <a class="code" href="classllvm_1_1LiveVariables.html">LiveVariables</a>.size());</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160; </div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;  <span class="comment">// Then go ahead and use the builder do actually do the inserts.  We insert</span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;  <span class="comment">// immediately before the previous instruction under the assumption that all</span></div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;  <span class="comment">// arguments will be available here.  We can&#39;t insert afterwards since we may</span></div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;  <span class="comment">// be replacing a terminator.</span></div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(Call);</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160; </div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;  <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> GCArgs(<a class="code" href="classllvm_1_1LiveVariables.html">LiveVariables</a>);</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> StatepointID = <a class="code" href="structllvm_1_1StatepointDirectives.html#a372b846903df662f9ef300b8821f42a9">StatepointDirectives::DefaultStatepointID</a>;</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;  <a class="code" href="classuint32__t.html">uint32_t</a> NumPatchBytes = 0;</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;  <a class="code" href="classuint32__t.html">uint32_t</a> Flags = <a class="code" href="classuint32__t.html">uint32_t</a>(<a class="code" href="namespacellvm.html#abba0f0474eb4e32d1ed7b6dfdb0d5140a6adf97f83acf6453d4a6a4b1070f3754">StatepointFlags::None</a>);</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160; </div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 8&gt;</a> CallArgs(Call-&gt;args());</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;  std::optional&lt;ArrayRef&lt;Use&gt;&gt; DeoptArgs;</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> Bundle = Call-&gt;getOperandBundle(<a class="code" href="classllvm_1_1LLVMContext.html#a800c1300065ca1615d2f4fb88623afd5a3f6df86c6efab701ade7abbc3134c25a">LLVMContext::OB_deopt</a>))</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;    DeoptArgs = Bundle-&gt;Inputs;</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;  std::optional&lt;ArrayRef&lt;Use&gt;&gt; TransitionArgs;</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> Bundle = Call-&gt;getOperandBundle(<a class="code" href="classllvm_1_1LLVMContext.html#a800c1300065ca1615d2f4fb88623afd5a3adfd6f3291adf59a7977597741211c6">LLVMContext::OB_gc_transition</a>)) {</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    TransitionArgs = Bundle-&gt;Inputs;</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;    <span class="comment">// TODO: This flag no longer serves a purpose and can be removed later</span></div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;    Flags |= <a class="code" href="classuint32__t.html">uint32_t</a>(<a class="code" href="namespacellvm.html#abba0f0474eb4e32d1ed7b6dfdb0d5140a9db1ed1dc0fe1fc6b917ab0430b7844c">StatepointFlags::GCTransition</a>);</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;  }</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160; </div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;  <span class="comment">// Instead of lowering calls to @llvm.experimental.deoptimize as normal calls</span></div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;  <span class="comment">// with a return value, we lower then as never returning calls to</span></div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;  <span class="comment">// __llvm_deoptimize that are followed by unreachable to get better codegen.</span></div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;  <span class="keywordtype">bool</span> IsDeoptimize = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160; </div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;  <a class="code" href="structllvm_1_1StatepointDirectives.html">StatepointDirectives</a> SD =</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;      <a class="code" href="namespacellvm.html#a830906f493a6d5c69ac5a94675c657fb">parseStatepointDirectivesFromAttrs</a>(Call-&gt;getAttributes());</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;  <span class="keywordflow">if</span> (SD.<a class="code" href="structllvm_1_1StatepointDirectives.html#a10a80a4141f323a8bba4e9b468680315">NumPatchBytes</a>)</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    NumPatchBytes = *SD.<a class="code" href="structllvm_1_1StatepointDirectives.html#a10a80a4141f323a8bba4e9b468680315">NumPatchBytes</a>;</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;  <span class="keywordflow">if</span> (SD.<a class="code" href="structllvm_1_1StatepointDirectives.html#a2ede8b2894838fd273ba88088457af7e">StatepointID</a>)</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;    StatepointID = *SD.<a class="code" href="structllvm_1_1StatepointDirectives.html#a2ede8b2894838fd273ba88088457af7e">StatepointID</a>;</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160; </div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;  <span class="comment">// Pass through the requested lowering if any.  The default is live-through.</span></div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;  <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> DeoptLowering = <a class="code" href="RewriteStatepointsForGC_8cpp.html#ad6d87a400bc9669540b19739d36b4488">getDeoptLowering</a>(Call);</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;  <span class="keywordflow">if</span> (DeoptLowering.<a class="code" href="classllvm_1_1StringRef.html#aa3595f2a07a2268edcfbf41ffa40cabf">equals</a>(<span class="stringliteral">&quot;live-in&quot;</span>))</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    Flags |= <a class="code" href="classuint32__t.html">uint32_t</a>(<a class="code" href="namespacellvm.html#abba0f0474eb4e32d1ed7b6dfdb0d5140a8cf633e3cd4e8b21a16304c58495bfbc">StatepointFlags::DeoptLiveIn</a>);</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DeoptLowering.<a class="code" href="classllvm_1_1StringRef.html#aa3595f2a07a2268edcfbf41ffa40cabf">equals</a>(<span class="stringliteral">&quot;live-through&quot;</span>) &amp;&amp; <span class="stringliteral">&quot;Unsupported value!&quot;</span>);</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;  }</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160; </div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;  <a class="code" href="classllvm_1_1FunctionCallee.html">FunctionCallee</a> CallTarget(Call-&gt;getFunctionType(), Call-&gt;getCalledOperand());</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = dyn_cast&lt;Function&gt;(CallTarget.<a class="code" href="classllvm_1_1FunctionCallee.html#a0055cd5464b935f571b36979a86bd7fc">getCallee</a>())) {</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;    <span class="keyword">auto</span> IID = <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getIntrinsicID();</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;    <span class="keywordflow">if</span> (IID == Intrinsic::experimental_deoptimize) {</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;      <span class="comment">// Calls to llvm.experimental.deoptimize are lowered to calls to the</span></div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;      <span class="comment">// __llvm_deoptimize symbol.  We want to resolve this now, since the</span></div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;      <span class="comment">// verifier does not allow taking the address of an intrinsic function.</span></div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160; </div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Type *, 8&gt;</a> DomainTy;</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a> : CallArgs)</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;        DomainTy.push_back(<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a>-&gt;getType());</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;      <span class="keyword">auto</span> *FTy = <a class="code" href="classllvm_1_1FunctionType.html#a7e89b55242c964ae61b7850e99cacef0">FunctionType::get</a>(<a class="code" href="classllvm_1_1Type.html#a6e20e76960d952de088354cbcd14c3ab">Type::getVoidTy</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getContext()), DomainTy,</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;                                    <span class="comment">/* isVarArg = */</span> <span class="keyword">false</span>);</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160; </div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;      <span class="comment">// Note: CallTarget can be a bitcast instruction of a symbol if there are</span></div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;      <span class="comment">// calls to @llvm.experimental.deoptimize with different argument types in</span></div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;      <span class="comment">// the same module.  This is fine -- we assume the frontend knew what it</span></div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;      <span class="comment">// was doing when generating this kind of IR.</span></div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;      CallTarget = <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getParent()</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;                       -&gt;getOrInsertFunction(<span class="stringliteral">&quot;__llvm_deoptimize&quot;</span>, FTy);</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160; </div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;      IsDeoptimize = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (IID == Intrinsic::memcpy_element_unordered_atomic ||</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;               IID == Intrinsic::memmove_element_unordered_atomic) {</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;      <span class="comment">// Unordered atomic memcpy and memmove intrinsics which are not explicitly</span></div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;      <span class="comment">// marked as &quot;gc-leaf-function&quot; should be lowered in a GC parseable way.</span></div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;      <span class="comment">// Specifically, these calls should be lowered to the</span></div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;      <span class="comment">// __llvm_{memcpy|memmove}_element_unordered_atomic_safepoint symbols.</span></div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;      <span class="comment">// Similarly to __llvm_deoptimize we want to resolve this now, since the</span></div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;      <span class="comment">// verifier does not allow taking the address of an intrinsic function.</span></div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;      <span class="comment">// Moreover we need to shuffle the arguments for the call in order to</span></div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;      <span class="comment">// accommodate GC. The underlying source and destination objects might be</span></div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;      <span class="comment">// relocated during copy operation should the GC occur. To relocate the</span></div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;      <span class="comment">// derived source and destination pointers the implementation of the</span></div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;      <span class="comment">// intrinsic should know the corresponding base pointers.</span></div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;      <span class="comment">// To make the base pointers available pass them explicitly as arguments:</span></div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;      <span class="comment">//   memcpy(dest_derived, source_derived, ...) =&gt;</span></div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;      <span class="comment">//   memcpy(dest_base, dest_offset, source_base, source_offset, ...)</span></div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;      <span class="keyword">auto</span> &amp;<a class="code" href="NVVMIntrRange_8cpp.html#afad351d7bf10ac0446b64e7827634e94">Context</a> = Call-&gt;getContext();</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;      <span class="keyword">auto</span> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a> = Call-&gt;getModule()-&gt;getDataLayout();</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;      <span class="keyword">auto</span> GetBaseAndOffset = [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *Derived) {</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;        <span class="comment">// Optimizations in unreachable code might substitute the real pointer</span></div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;        <span class="comment">// with undef, poison or null-derived constant. Return null base for</span></div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;        <span class="comment">// them to be consistent with the handling in the main algorithm in</span></div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;        <span class="comment">// findBaseDefiningValue.</span></div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;        <span class="keywordflow">if</span> (isa&lt;Constant&gt;(Derived))</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;          <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> =</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;              <a class="code" href="classllvm_1_1ConstantPointerNull.html#a96f5c85e4022e369266541b2db3fda69">ConstantPointerNull::get</a>(cast&lt;PointerType&gt;(Derived-&gt;getType()));</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PointerToBase.count(Derived));</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;          <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = PointerToBase.find(Derived)-&gt;second;</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;        }</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;        <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm.html#a2c3c18bffdc25d969233c5448bdfe7eb">AddressSpace</a> = Derived-&gt;getType()-&gt;getPointerAddressSpace();</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;        <span class="keywordtype">unsigned</span> IntPtrSize = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getPointerSizeInBits(<a class="code" href="namespacellvm.html#a2c3c18bffdc25d969233c5448bdfe7eb">AddressSpace</a>);</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *Base_int = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePtrToInt(</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;            <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, <a class="code" href="classllvm_1_1Type.html#acaf8e4c3e40e01e848c1fad5f05b81cd">Type::getIntNTy</a>(<a class="code" href="NVVMIntrRange_8cpp.html#afad351d7bf10ac0446b64e7827634e94">Context</a>, IntPtrSize));</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *Derived_int = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePtrToInt(</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;            Derived, <a class="code" href="classllvm_1_1Type.html#acaf8e4c3e40e01e848c1fad5f05b81cd">Type::getIntNTy</a>(<a class="code" href="NVVMIntrRange_8cpp.html#afad351d7bf10ac0446b64e7827634e94">Context</a>, IntPtrSize));</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;        <span class="keywordflow">return</span> std::make_pair(<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSub(Derived_int, Base_int));</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;      };</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160; </div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;      <span class="keyword">auto</span> *Dest = CallArgs[0];</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *DestBase, *DestOffset;</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;      std::tie(DestBase, DestOffset) = GetBaseAndOffset(Dest);</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160; </div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">Source</a> = CallArgs[1];</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *SourceBase, *SourceOffset;</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;      std::tie(SourceBase, SourceOffset) = GetBaseAndOffset(<a class="code" href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">Source</a>);</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160; </div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;      <span class="keyword">auto</span> *LengthInBytes = CallArgs[2];</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;      <span class="keyword">auto</span> *ElementSizeCI = cast&lt;ConstantInt&gt;(CallArgs[3]);</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160; </div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;      CallArgs.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;      CallArgs.push_back(DestBase);</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;      CallArgs.push_back(DestOffset);</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;      CallArgs.push_back(SourceBase);</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;      CallArgs.push_back(SourceOffset);</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;      CallArgs.push_back(LengthInBytes);</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160; </div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Type *, 8&gt;</a> DomainTy;</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a> : CallArgs)</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;        DomainTy.push_back(<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a>-&gt;getType());</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;      <span class="keyword">auto</span> *FTy = <a class="code" href="classllvm_1_1FunctionType.html#a7e89b55242c964ae61b7850e99cacef0">FunctionType::get</a>(<a class="code" href="classllvm_1_1Type.html#a6e20e76960d952de088354cbcd14c3ab">Type::getVoidTy</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getContext()), DomainTy,</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;                                    <span class="comment">/* isVarArg = */</span> <span class="keyword">false</span>);</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160; </div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;      <span class="keyword">auto</span> GetFunctionName = [](<a class="code" href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IID, <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *ElementSizeCI) {</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;        <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> ElementSize = ElementSizeCI-&gt;<a class="code" href="classllvm_1_1APInt.html#a217e0207d9cc8e046c2dccbf0e4bb198">getZExtValue</a>();</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;        <span class="keywordflow">if</span> (IID == Intrinsic::memcpy_element_unordered_atomic) {</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;          <span class="keywordflow">switch</span> (ElementSize) {</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;          <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;__llvm_memcpy_element_unordered_atomic_safepoint_1&quot;</span>;</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;          <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;__llvm_memcpy_element_unordered_atomic_safepoint_2&quot;</span>;</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;          <span class="keywordflow">case</span> 4:</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;__llvm_memcpy_element_unordered_atomic_safepoint_4&quot;</span>;</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;          <span class="keywordflow">case</span> 8:</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;__llvm_memcpy_element_unordered_atomic_safepoint_8&quot;</span>;</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;          <span class="keywordflow">case</span> 16:</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;__llvm_memcpy_element_unordered_atomic_safepoint_16&quot;</span>;</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;          <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;            <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;unexpected element size!&quot;</span>);</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;          }</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;        }</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IID == Intrinsic::memmove_element_unordered_atomic);</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;        <span class="keywordflow">switch</span> (ElementSize) {</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;        <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;          <span class="keywordflow">return</span> <span class="stringliteral">&quot;__llvm_memmove_element_unordered_atomic_safepoint_1&quot;</span>;</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;        <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;          <span class="keywordflow">return</span> <span class="stringliteral">&quot;__llvm_memmove_element_unordered_atomic_safepoint_2&quot;</span>;</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;        <span class="keywordflow">case</span> 4:</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;          <span class="keywordflow">return</span> <span class="stringliteral">&quot;__llvm_memmove_element_unordered_atomic_safepoint_4&quot;</span>;</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;        <span class="keywordflow">case</span> 8:</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;          <span class="keywordflow">return</span> <span class="stringliteral">&quot;__llvm_memmove_element_unordered_atomic_safepoint_8&quot;</span>;</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;        <span class="keywordflow">case</span> 16:</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;          <span class="keywordflow">return</span> <span class="stringliteral">&quot;__llvm_memmove_element_unordered_atomic_safepoint_16&quot;</span>;</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;          <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;unexpected element size!&quot;</span>);</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;        }</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;      };</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160; </div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;      CallTarget =</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;          <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getParent()</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;              -&gt;getOrInsertFunction(GetFunctionName(IID, ElementSizeCI), FTy);</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;    }</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;  }</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160; </div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;  <span class="comment">// Create the statepoint given all the arguments</span></div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;  <a class="code" href="classllvm_1_1GCStatepointInst.html">GCStatepointInst</a> *Token = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *CI = dyn_cast&lt;CallInst&gt;(Call)) {</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;    <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *SPCall = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateGCStatepointCall(</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;        StatepointID, NumPatchBytes, CallTarget, Flags, CallArgs,</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;        TransitionArgs, DeoptArgs, GCArgs, <span class="stringliteral">&quot;safepoint_token&quot;</span>);</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160; </div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;    SPCall-&gt;<a class="code" href="classllvm_1_1CallInst.html#a68573712cd73746e416002907c9af79b">setTailCallKind</a>(CI-&gt;getTailCallKind());</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;    SPCall-&gt;<a class="code" href="classllvm_1_1CallBase.html#a0851b4de29686e9c3918449b054cfada">setCallingConv</a>(CI-&gt;getCallingConv());</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160; </div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;    <span class="comment">// Currently we will fail on parameter attributes and on certain</span></div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;    <span class="comment">// function attributes.  In case if we can handle this set of attributes -</span></div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;    <span class="comment">// set up function attrs directly on statepoint and return attrs later for</span></div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;    <span class="comment">// gc_result intrinsic.</span></div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;    SPCall-&gt;<a class="code" href="classllvm_1_1CallBase.html#a9da3b29e8e71b9be4645874e1721207a">setAttributes</a>(<a class="code" href="RewriteStatepointsForGC_8cpp.html#a50fac92017d0843263cc84ebc2d1ac45">legalizeCallAttributes</a>(</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;        CI-&gt;getContext(), CI-&gt;getAttributes(), SPCall-&gt;<a class="code" href="classllvm_1_1CallBase.html#ae0c55761fce39dd71617690b04385193">getAttributes</a>()));</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160; </div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;    Token = cast&lt;GCStatepointInst&gt;(SPCall);</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160; </div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;    <span class="comment">// Put the following gc_result and gc_relocate calls immediately after the</span></div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;    <span class="comment">// the old call (which we&#39;re about to delete)</span></div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CI-&gt;getNextNode() &amp;&amp; <span class="stringliteral">&quot;Not a terminator, must have next!&quot;</span>);</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(CI-&gt;getNextNode());</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetCurrentDebugLocation(CI-&gt;getNextNode()-&gt;getDebugLoc());</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;    <span class="keyword">auto</span> *II = cast&lt;InvokeInst&gt;(Call);</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160; </div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;    <span class="comment">// Insert the new invoke into the old block.  We&#39;ll remove the old one in a</span></div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    <span class="comment">// moment at which point this will become the new terminator for the</span></div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;    <span class="comment">// original block.</span></div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    <a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *SPInvoke = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateGCStatepointInvoke(</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;        StatepointID, NumPatchBytes, CallTarget, II-&gt;getNormalDest(),</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;        II-&gt;getUnwindDest(), Flags, CallArgs, TransitionArgs, DeoptArgs, GCArgs,</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;        <span class="stringliteral">&quot;statepoint_token&quot;</span>);</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160; </div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;    SPInvoke-&gt;<a class="code" href="classllvm_1_1CallBase.html#a0851b4de29686e9c3918449b054cfada">setCallingConv</a>(II-&gt;getCallingConv());</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160; </div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;    <span class="comment">// Currently we will fail on parameter attributes and on certain</span></div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;    <span class="comment">// function attributes.  In case if we can handle this set of attributes -</span></div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;    <span class="comment">// set up function attrs directly on statepoint and return attrs later for</span></div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;    <span class="comment">// gc_result intrinsic.</span></div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;    SPInvoke-&gt;<a class="code" href="classllvm_1_1CallBase.html#a9da3b29e8e71b9be4645874e1721207a">setAttributes</a>(<a class="code" href="RewriteStatepointsForGC_8cpp.html#a50fac92017d0843263cc84ebc2d1ac45">legalizeCallAttributes</a>(</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;        II-&gt;getContext(), II-&gt;getAttributes(), SPInvoke-&gt;<a class="code" href="classllvm_1_1CallBase.html#ae0c55761fce39dd71617690b04385193">getAttributes</a>()));</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160; </div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;    Token = cast&lt;GCStatepointInst&gt;(SPInvoke);</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160; </div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;    <span class="comment">// Generate gc relocates in exceptional path</span></div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *UnwindBlock = II-&gt;getUnwindDest();</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!isa&lt;PHINode&gt;(UnwindBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>()) &amp;&amp;</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;           UnwindBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a74aa9daea070e2ad3394a3ec58b7316a">getUniquePredecessor</a>() &amp;&amp;</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;           <span class="stringliteral">&quot;can&#39;t safely insert in this block!&quot;</span>);</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160; </div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(&amp;*UnwindBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>());</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetCurrentDebugLocation(II-&gt;getDebugLoc());</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160; </div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;    <span class="comment">// Attach exceptional gc relocates to the landingpad.</span></div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ExceptionalToken = UnwindBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a1553a166adb52e29e3a240dd37627ad9">getLandingPadInst</a>();</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;    Result.UnwindToken = ExceptionalToken;</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160; </div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#ace7e2f01b65afba76343f22d042a12df">CreateGCRelocates</a>(<a class="code" href="classllvm_1_1LiveVariables.html">LiveVariables</a>, BasePtrs, ExceptionalToken, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, GC);</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160; </div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;    <span class="comment">// Generate gc relocates and returns for normal block</span></div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *NormalDest = II-&gt;getNormalDest();</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!isa&lt;PHINode&gt;(NormalDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>()) &amp;&amp;</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;           NormalDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a74aa9daea070e2ad3394a3ec58b7316a">getUniquePredecessor</a>() &amp;&amp;</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;           <span class="stringliteral">&quot;can&#39;t safely insert in this block!&quot;</span>);</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160; </div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(&amp;*NormalDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>());</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160; </div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;    <span class="comment">// gc relocates will be generated later as if it were regular call</span></div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;    <span class="comment">// statepoint</span></div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;  }</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Token &amp;&amp; <span class="stringliteral">&quot;Should be set in one of the above branches!&quot;</span>);</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160; </div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;  <span class="keywordflow">if</span> (IsDeoptimize) {</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;    <span class="comment">// If we&#39;re wrapping an @llvm.experimental.deoptimize in a statepoint, we</span></div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;    <span class="comment">// transform the tail-call like structure to a call to a void function</span></div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;    <span class="comment">// followed by unreachable to get better codegen.</span></div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;    Replacements.push_back(</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;        DeferredReplacement::createDeoptimizeReplacement(Call));</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;    Token-&gt;<a class="code" href="classllvm_1_1Value.html#a35ee267850af7c235474a8c46c7ac5af">setName</a>(<span class="stringliteral">&quot;statepoint_token&quot;</span>);</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;    <span class="keywordflow">if</span> (!Call-&gt;getType()-&gt;isVoidTy() &amp;&amp; !Call-&gt;use_empty()) {</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;      <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> Name = Call-&gt;hasName() ? Call-&gt;getName() : <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;      <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *GCResult = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateGCResult(Token, Call-&gt;getType(), Name);</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;      GCResult-&gt;<a class="code" href="classllvm_1_1CallBase.html#a9da3b29e8e71b9be4645874e1721207a">setAttributes</a>(</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;          <a class="code" href="classllvm_1_1AttributeList.html#a5cc6492c8f2e06a8bae9dc0d121fab9f">AttributeList::get</a>(GCResult-&gt;<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), <a class="code" href="classllvm_1_1AttributeList.html#af5dcb6d3da4b30a7d21c9fb39bbf1a68a167699508089d6cf7e6afe448d82e6df">AttributeList::ReturnIndex</a>,</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;                             Call-&gt;getAttributes().getRetAttrs()));</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160; </div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;      <span class="comment">// We cannot RAUW or delete CS.getInstruction() because it could be in the</span></div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;      <span class="comment">// live set of some other safepoint, in which case that safepoint&#39;s</span></div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;      <span class="comment">// PartiallyConstructedSafepointRecord will hold a raw pointer to this</span></div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;      <span class="comment">// llvm::Instruction.  Instead, we defer the replacement and deletion to</span></div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;      <span class="comment">// after the live sets have been made explicit in the IR, and we no longer</span></div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;      <span class="comment">// have raw pointers to worry about.</span></div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;      Replacements.emplace_back(</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;          DeferredReplacement::createRAUW(Call, GCResult));</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;      Replacements.emplace_back(DeferredReplacement::createDelete(Call));</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;    }</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;  }</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160; </div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;  Result.StatepointToken = Token;</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160; </div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;  <span class="comment">// Second, create a gc.relocate for every live variable</span></div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;  <a class="code" href="RewriteStatepointsForGC_8cpp.html#ace7e2f01b65afba76343f22d042a12df">CreateGCRelocates</a>(<a class="code" href="classllvm_1_1LiveVariables.html">LiveVariables</a>, BasePtrs, Token, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, GC);</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;}</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160; </div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;<span class="comment">// Replace an existing gc.statepoint with a new one and a set of gc.relocates</span></div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;<span class="comment">// which make the relocations happening at this safepoint explicit.</span></div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;<span class="comment">// WARNING: Does not do any fixup to adjust users of the original live</span></div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;<span class="comment">// values.  That&#39;s the callers responsibility.</span></div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l01964"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#acad221a6df1d4872c6cca80bc913f7b7"> 1964</a></span>&#160;<a class="code" href="RewriteStatepointsForGC_8cpp.html#acad221a6df1d4872c6cca80bc913f7b7">makeStatepointExplicit</a>(<a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;DT, <a class="code" href="classllvm_1_1CallBase.html">CallBase</a> *Call,</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;                       PartiallyConstructedSafepointRecord &amp;Result,</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;                       std::vector&lt;DeferredReplacement&gt; &amp;Replacements,</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;                       <span class="keyword">const</span> <a class="code" href="namespacefalse.html#abbdd09796205857296660052b67cc167">PointerToBaseTy</a> &amp;PointerToBase, <a class="code" href="classllvm_1_1GCStrategy.html">GCStrategy</a> *GC) {</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> &amp;LiveSet = Result.LiveSet;</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160; </div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;  <span class="comment">// Convert to vector for efficient cross referencing.</span></div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 64&gt;</a> BaseVec, LiveVec;</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;  LiveVec.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(LiveSet.size());</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;  BaseVec.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(LiveSet.size());</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *L : LiveSet) {</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;    LiveVec.push_back(L);</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PointerToBase.count(L));</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = PointerToBase.find(L)-&gt;second;</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;    BaseVec.push_back(<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>);</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;  }</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LiveVec.size() == BaseVec.size());</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160; </div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;  <span class="comment">// Do the actual rewriting and delete the old statepoint</span></div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;  <a class="code" href="RewriteStatepointsForGC_8cpp.html#a03f51e12bc910c9dc19f38b36f58a223">makeStatepointExplicitImpl</a>(Call, BaseVec, LiveVec, Result, Replacements,</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;                             PointerToBase, GC);</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;}</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160; </div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;<span class="comment">// Helper function for the relocationViaAlloca.</span></div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;<span class="comment">// It receives iterator to the statepoint gc relocates and emits a store to the</span></div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;<span class="comment">// assigned location (via allocaMap) for the each one of them.  It adds the</span></div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;<span class="comment">// visited values into the visitedLiveValues set, which we will later use them</span></div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;<span class="comment">// for validation checking.</span></div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l01994"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a3e3071be46334a57263e70548609d657"> 1994</a></span>&#160;<a class="code" href="RewriteStatepointsForGC_8cpp.html#a3e3071be46334a57263e70548609d657">insertRelocationStores</a>(<a class="code" href="classllvm_1_1iterator__range.html">iterator_range&lt;Value::user_iterator&gt;</a> GCRelocs,</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;                       <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, AllocaInst *&gt;</a> &amp;AllocaMap,</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;                       <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;Value *&gt;</a> &amp;VisitedLiveValues) {</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1User.html">User</a> *U : GCRelocs) {</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;    <a class="code" href="classllvm_1_1GCRelocateInst.html">GCRelocateInst</a> *Relocate = dyn_cast&lt;GCRelocateInst&gt;(U);</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;    <span class="keywordflow">if</span> (!Relocate)</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160; </div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *OriginalValue = Relocate-&gt;<a class="code" href="classllvm_1_1GCRelocateInst.html#ae587391ac557593d998dbca4e62f0dab">getDerivedPtr</a>();</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(AllocaMap.<a class="code" href="classllvm_1_1DenseMapBase.html#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(OriginalValue));</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Alloca = AllocaMap[OriginalValue];</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160; </div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;    <span class="comment">// Emit store into the related alloca</span></div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;    <span class="comment">// All gc_relocates are i8 addrspace(1)* typed, and it must be bitcasted to</span></div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;    <span class="comment">// the correct type according to alloca.</span></div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Relocate-&gt;<a class="code" href="classllvm_1_1ilist__node__with__parent.html#a26708685cc8b94fe3d7092ee080dbb34">getNextNode</a>() &amp;&amp;</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;           <span class="stringliteral">&quot;Should always have one since it&#39;s not a terminator&quot;</span>);</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(Relocate-&gt;<a class="code" href="classllvm_1_1ilist__node__with__parent.html#a26708685cc8b94fe3d7092ee080dbb34">getNextNode</a>());</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *CastedRelocatedValue =</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(Relocate,</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;                            cast&lt;AllocaInst&gt;(Alloca)-&gt;getAllocatedType(),</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;                            <a class="code" href="RewriteStatepointsForGC_8cpp.html#acb0214b30fb2b9e1d6e1cf6cc851b3e5">suffixed_name_or</a>(Relocate, <span class="stringliteral">&quot;.casted&quot;</span>, <span class="stringliteral">&quot;&quot;</span>));</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160; </div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;    <span class="keyword">new</span> <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a>(CastedRelocatedValue, Alloca,</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;                  cast&lt;Instruction&gt;(CastedRelocatedValue)-&gt;getNextNode());</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160; </div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;    VisitedLiveValues.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a79eed48913651aeedda2eed25201ea84">insert</a>(OriginalValue);</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;  }</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;}</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160; </div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;<span class="comment">// Helper function for the &quot;relocationViaAlloca&quot;. Similar to the</span></div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;<span class="comment">// &quot;insertRelocationStores&quot; but works for rematerialized values.</span></div>
<div class="line"><a name="l02028"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a8210289419425d82cf453d7b32bd2d2c"> 2028</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a8210289419425d82cf453d7b32bd2d2c">insertRematerializationStores</a>(</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacefalse.html#ac6a673a7af50c8b1760115a5dd9c0b04">RematerializedValueMapTy</a> &amp;RematerializedValues,</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, AllocaInst *&gt;</a> &amp;AllocaMap,</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;    <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;Value *&gt;</a> &amp;VisitedLiveValues) {</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> RematerializedValuePair: RematerializedValues) {</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *RematerializedValue = RematerializedValuePair.first;</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *OriginalValue = RematerializedValuePair.second;</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160; </div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(AllocaMap.<a class="code" href="classllvm_1_1DenseMapBase.html#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(OriginalValue) &amp;&amp;</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;           <span class="stringliteral">&quot;Can not find alloca for rematerialized value&quot;</span>);</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Alloca = AllocaMap[OriginalValue];</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160; </div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    <span class="keyword">new</span> <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a>(RematerializedValue, Alloca,</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;                  RematerializedValue-&gt;<a class="code" href="classllvm_1_1ilist__node__with__parent.html#a26708685cc8b94fe3d7092ee080dbb34">getNextNode</a>());</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160; </div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;    VisitedLiveValues.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a79eed48913651aeedda2eed25201ea84">insert</a>(OriginalValue);</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;  }</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;}</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;<span class="comment">/// Do all the relocation update via allocas and mem2reg</span></div>
<div class="line"><a name="l02050"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a55412d2c237115c95f20e12ba0d95922"> 2050</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a55412d2c237115c95f20e12ba0d95922">relocationViaAlloca</a>(</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;    <a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;DT, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> Live,</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;    <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;PartiallyConstructedSafepointRecord&gt;</a> Records) {</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;  <span class="comment">// record initial number of (static) allocas; we&#39;ll check we have the same</span></div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;  <span class="comment">// number when we get done.</span></div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;  <span class="keywordtype">int</span> InitialAllocaNum = 0;</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getEntryBlock())</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;    <span class="keywordflow">if</span> (isa&lt;AllocaInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;      InitialAllocaNum++;</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160; </div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;  <span class="comment">// TODO-PERF: change data structures, reserve</span></div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, AllocaInst *&gt;</a> AllocaMap;</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;AllocaInst *, 200&gt;</a> PromotableAllocas;</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;  <span class="comment">// Used later to chack that we have enough allocas to store all values</span></div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;  std::size_t NumRematerializedValues = 0;</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;  PromotableAllocas.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(Live.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160; </div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;  <span class="comment">// Emit alloca for &quot;LiveValue&quot; and record it in &quot;allocaMap&quot; and</span></div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;  <span class="comment">// &quot;PromotableAllocas&quot;</span></div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getParent()-&gt;getDataLayout();</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;  <span class="keyword">auto</span> emitAllocaFor = [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *LiveValue) {</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;    <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *Alloca = <span class="keyword">new</span> <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a>(LiveValue-&gt;getType(),</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;                                        <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getAllocaAddrSpace(), <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;                                        <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getEntryBlock().getFirstNonPHI());</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;    AllocaMap[LiveValue] = Alloca;</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;    PromotableAllocas.push_back(Alloca);</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;  };</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160; </div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;  <span class="comment">// Emit alloca for each live gc pointer</span></div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : Live)</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;    emitAllocaFor(V);</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160; </div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;  <span class="comment">// Emit allocas for rematerialized values</span></div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a> : Records)</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> RematerializedValuePair : <a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RematerializedValues) {</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *OriginalValue = RematerializedValuePair.second;</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;      <span class="keywordflow">if</span> (AllocaMap.<a class="code" href="classllvm_1_1DenseMapBase.html#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(OriginalValue) != 0)</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160; </div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;      emitAllocaFor(OriginalValue);</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;      ++NumRematerializedValues;</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;    }</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160; </div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;  <span class="comment">// The next two loops are part of the same conceptual operation.  We need to</span></div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;  <span class="comment">// insert a store to the alloca after the original def and at each</span></div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;  <span class="comment">// redefinition.  We need to insert a load before each use.  These are split</span></div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;  <span class="comment">// into distinct loops for performance reasons.</span></div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160; </div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;  <span class="comment">// Update gc pointer after each statepoint: either store a relocated value or</span></div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;  <span class="comment">// null (if no relocated value was found for this gc pointer and it is not a</span></div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;  <span class="comment">// gc_result).  This must happen before we update the statepoint with load of</span></div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;  <span class="comment">// alloca otherwise we lose the link between statepoint and old def.</span></div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a> : Records) {</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Statepoint = <a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.StatepointToken;</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160; </div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;    <span class="comment">// This will be used for consistency check</span></div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;    <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;Value *&gt;</a> VisitedLiveValues;</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160; </div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;    <span class="comment">// Insert stores for normal statepoint gc relocates</span></div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#a3e3071be46334a57263e70548609d657">insertRelocationStores</a>(Statepoint-&gt;<a class="code" href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">users</a>(), AllocaMap, VisitedLiveValues);</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160; </div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;    <span class="comment">// In case if it was invoke statepoint</span></div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;    <span class="comment">// we will insert stores for exceptional path gc relocates.</span></div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;    <span class="keywordflow">if</span> (isa&lt;InvokeInst&gt;(Statepoint)) {</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;      <a class="code" href="RewriteStatepointsForGC_8cpp.html#a3e3071be46334a57263e70548609d657">insertRelocationStores</a>(<a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.UnwindToken-&gt;users(), AllocaMap,</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;                             VisitedLiveValues);</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;    }</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160; </div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;    <span class="comment">// Do similar thing with rematerialized values</span></div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#a8210289419425d82cf453d7b32bd2d2c">insertRematerializationStores</a>(<a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RematerializedValues, AllocaMap,</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;                                  VisitedLiveValues);</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160; </div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="RewriteStatepointsForGC_8cpp.html#aae78323e579beb55b2c4820179d7b7e8">ClobberNonLive</a>) {</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;      <span class="comment">// As a debugging aid, pretend that an unrelocated pointer becomes null at</span></div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;      <span class="comment">// the gc.statepoint.  This will turn some subtle GC problems into</span></div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;      <span class="comment">// slightly easier to debug SEGVs.  Note that on large IR files with</span></div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;      <span class="comment">// lots of gc.statepoints this is extremely costly both memory and time</span></div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;      <span class="comment">// wise.</span></div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;AllocaInst *, 64&gt;</a> ToClobber;</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> Pair : AllocaMap) {</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a> = Pair.first;</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;        <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *Alloca = Pair.second;</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160; </div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;        <span class="comment">// This value was relocated</span></div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;        <span class="keywordflow">if</span> (VisitedLiveValues.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#afe504aa31a6a354cec13f5b32d0b1d9d">count</a>(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a>)) {</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;        }</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;        ToClobber.push_back(Alloca);</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;      }</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160; </div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;      <span class="keyword">auto</span> InsertClobbersAt = [&amp;](<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *IP) {</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> *AI : ToClobber) {</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;          <span class="keyword">auto</span> AT = AI-&gt;getAllocatedType();</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;          <a class="code" href="classllvm_1_1Constant.html">Constant</a> *CPN;</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;          <span class="keywordflow">if</span> (AT-&gt;isVectorTy())</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;            CPN = <a class="code" href="classllvm_1_1ConstantAggregateZero.html#abfa1cf8b4348407b167f93bc7c01055f">ConstantAggregateZero::get</a>(AT);</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;            CPN = <a class="code" href="classllvm_1_1ConstantPointerNull.html#a96f5c85e4022e369266541b2db3fda69">ConstantPointerNull::get</a>(cast&lt;PointerType&gt;(AT));</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;          <span class="keyword">new</span> <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a>(CPN, AI, IP);</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;        }</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;      };</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160; </div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;      <span class="comment">// Insert the clobbering stores.  These may get intermixed with the</span></div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;      <span class="comment">// gc.results and gc.relocates, but that&#39;s fine.</span></div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> II = dyn_cast&lt;InvokeInst&gt;(Statepoint)) {</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;        InsertClobbersAt(&amp;*II-&gt;getNormalDest()-&gt;getFirstInsertionPt());</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;        InsertClobbersAt(&amp;*II-&gt;getUnwindDest()-&gt;getFirstInsertionPt());</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;        InsertClobbersAt(cast&lt;Instruction&gt;(Statepoint)-&gt;getNextNode());</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;      }</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;    }</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;  }</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160; </div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;  <span class="comment">// Update use with load allocas and add store for gc_relocated.</span></div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> Pair : AllocaMap) {</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a> = Pair.first;</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;    <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *Alloca = Pair.second;</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160; </div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;    <span class="comment">// We pre-record the uses of allocas so that we dont have to worry about</span></div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;    <span class="comment">// later update that changes the user information..</span></div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160; </div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 20&gt;</a> <a class="code" href="ARMLowOverheadLoops_8cpp.html#a0a0971d62011c35b29ff4a2325d45e93">Uses</a>;</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;    <span class="comment">// PERF: trade a linear scan for repeated reallocation</span></div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;    <a class="code" href="ARMLowOverheadLoops_8cpp.html#a0a0971d62011c35b29ff4a2325d45e93">Uses</a>.reserve(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a>-&gt;getNumUses());</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1User.html">User</a> *U : <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a>-&gt;users()) {</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;      <span class="keywordflow">if</span> (!isa&lt;ConstantExpr&gt;(U)) {</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;        <span class="comment">// If the def has a ConstantExpr use, then the def is either a</span></div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;        <span class="comment">// ConstantExpr use itself or null.  In either case</span></div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;        <span class="comment">// (recursively in the first, directly in the second), the oop</span></div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;        <span class="comment">// it is ultimately dependent on is null and this particular</span></div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;        <span class="comment">// use does not need to be fixed up.</span></div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;        <a class="code" href="ARMLowOverheadLoops_8cpp.html#a0a0971d62011c35b29ff4a2325d45e93">Uses</a>.push_back(cast&lt;Instruction&gt;(U));</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;      }</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;    }</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160; </div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;    <a class="code" href="namespacellvm.html#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a>(<a class="code" href="ARMLowOverheadLoops_8cpp.html#a0a0971d62011c35b29ff4a2325d45e93">Uses</a>);</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;    <span class="keyword">auto</span> <a class="code" href="namespacellvm.html#ac10d13c57a7adf4a1f140afd5321309bad55b30607c2a9a2616347d6edb789f6b">Last</a> = <a class="code" href="namespacellvm.html#a92be87f8a371f277f7260fb99592d5f4">std::unique</a>(<a class="code" href="ARMLowOverheadLoops_8cpp.html#a0a0971d62011c35b29ff4a2325d45e93">Uses</a>.begin(), <a class="code" href="ARMLowOverheadLoops_8cpp.html#a0a0971d62011c35b29ff4a2325d45e93">Uses</a>.end());</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;    <a class="code" href="ARMLowOverheadLoops_8cpp.html#a0a0971d62011c35b29ff4a2325d45e93">Uses</a>.erase(<a class="code" href="namespacellvm.html#ac10d13c57a7adf4a1f140afd5321309bad55b30607c2a9a2616347d6edb789f6b">Last</a>, <a class="code" href="ARMLowOverheadLoops_8cpp.html#a0a0971d62011c35b29ff4a2325d45e93">Uses</a>.end());</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160; </div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1Use.html">Use</a> : <a class="code" href="ARMLowOverheadLoops_8cpp.html#a0a0971d62011c35b29ff4a2325d45e93">Uses</a>) {</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;      <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(<a class="code" href="classllvm_1_1Use.html">Use</a>)) {</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;        <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *Phi = cast&lt;PHINode&gt;(<a class="code" href="classllvm_1_1Use.html">Use</a>);</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; Phi-&gt;<a class="code" href="classllvm_1_1PHINode.html#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a> == Phi-&gt;<a class="code" href="classllvm_1_1PHINode.html#a16c39eb6e60b42a40c399d8d65347bb6">getIncomingValue</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)) {</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;            <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a> =</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;                <span class="keyword">new</span> <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a>(Alloca-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a074617b3e2f9f98ee3a2ac208e8e7210">getAllocatedType</a>(), Alloca, <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;                             Phi-&gt;<a class="code" href="classllvm_1_1PHINode.html#a8ce0c4746a1ec805e66409d20ae93922">getIncomingBlock</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>());</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;            Phi-&gt;<a class="code" href="classllvm_1_1PHINode.html#a88cdefb709309eddc6e5daca0be6a7b4">setIncomingValue</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a>);</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;          }</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;        }</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;        <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a> =</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;            <span class="keyword">new</span> <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a>(Alloca-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a074617b3e2f9f98ee3a2ac208e8e7210">getAllocatedType</a>(), Alloca, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="classllvm_1_1Use.html">Use</a>);</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;        <a class="code" href="classllvm_1_1Use.html">Use</a>-&gt;replaceUsesOfWith(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a>, <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a>);</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;      }</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;    }</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160; </div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;    <span class="comment">// Emit store for the initial gc value.  Store must be inserted after load,</span></div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;    <span class="comment">// otherwise store will be in alloca&#39;s use list and an extra load will be</span></div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;    <span class="comment">// inserted before it.</span></div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;    <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Store</a> = <span class="keyword">new</span> <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a>(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a>, Alloca, <span class="comment">/*volatile*/</span> <span class="keyword">false</span>,</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;                                     <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getABITypeAlign(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a>-&gt;getType()));</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst = dyn_cast&lt;Instruction&gt;(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a>)) {</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *Invoke = dyn_cast&lt;InvokeInst&gt;(Inst)) {</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;        <span class="comment">// InvokeInst is a terminator so the store need to be inserted into its</span></div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;        <span class="comment">// normal destination block.</span></div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;        <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *NormalDest = Invoke-&gt;getNormalDest();</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;        <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;insertBefore(NormalDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a46ef6115027606b67adcf4d28f3dac17">getFirstNonPHI</a>());</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!Inst-&gt;isTerminator() &amp;&amp;</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;               <span class="stringliteral">&quot;The only terminator that can produce a value is &quot;</span></div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;               <span class="stringliteral">&quot;InvokeInst which is handled above.&quot;</span>);</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;        <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;insertAfter(Inst);</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;      }</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isa&lt;Argument&gt;(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a>));</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;      <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;insertAfter(cast&lt;Instruction&gt;(Alloca));</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;    }</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;  }</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160; </div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PromotableAllocas.size() == Live.size() + NumRematerializedValues &amp;&amp;</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;         <span class="stringliteral">&quot;we must have the same allocas with lives&quot;</span>);</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;  (void) NumRematerializedValues;</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;  <span class="keywordflow">if</span> (!PromotableAllocas.empty()) {</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;    <span class="comment">// Apply mem2reg to promote alloca to SSA</span></div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;    <a class="code" href="namespacellvm.html#a1a4cac84457299517e69ff9764fed2db">PromoteMemToReg</a>(PromotableAllocas, DT);</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;  }</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160; </div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getEntryBlock())</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;    <span class="keywordflow">if</span> (isa&lt;AllocaInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;      InitialAllocaNum--;</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InitialAllocaNum == 0 &amp;&amp; <span class="stringliteral">&quot;We must not introduce any extra allocas&quot;</span>);</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;}</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;<span class="comment">/// Implement a unique function which doesn&#39;t require we sort the input</span></div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;<span class="comment">/// vector.  Doing so has the effect of changing the output of a couple of</span></div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;<span class="comment">/// tests in ways which make them less useful in testing fused safepoints.</span></div>
<div class="line"><a name="l02251"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a1d739ace36dfd7ba0b4069716611fd74"> 2251</a></span>&#160;<span class="comment"></span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a1d739ace36dfd7ba0b4069716611fd74">unique_unsorted</a>(<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;T&gt;</a> &amp;Vec) {</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;  <a class="code" href="classllvm_1_1SmallSet.html">SmallSet&lt;T, 8&gt;</a> Seen;</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;  <a class="code" href="namespacellvm.html#ac9a7de5a04920954ac964059cfc428ad">erase_if</a>(Vec, [&amp;](<span class="keyword">const</span> <a class="code" href="classT.html">T</a> &amp;V) { <span class="keywordflow">return</span> !Seen.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(V).second; });</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;}</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;<span class="comment">/// Insert holders so that each Value is obviously live through the entire</span></div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;<span class="comment">/// lifetime of the call.</span></div>
<div class="line"><a name="l02258"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a6b7912ea5edc4563fe03afc57fa9b0c6"> 2258</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a6b7912ea5edc4563fe03afc57fa9b0c6">insertUseHolderAfter</a>(<a class="code" href="classllvm_1_1CallBase.html">CallBase</a> *Call, <span class="keyword">const</span> <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> Values,</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;                                 <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;CallInst *&gt;</a> &amp;Holders) {</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;  <span class="keywordflow">if</span> (Values.<a class="code" href="classllvm_1_1ArrayRef.html#ac835b8735b1b2faec0efdca236e37d94">empty</a>())</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;    <span class="comment">// No values to hold live, might as well not insert the empty holder</span></div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160; </div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;  <a class="code" href="classllvm_1_1Module.html">Module</a> *<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a> = Call-&gt;getModule();</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;  <span class="comment">// Use a dummy vararg function to actually hold the values live</span></div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;  <a class="code" href="classllvm_1_1FunctionCallee.html">FunctionCallee</a> Func = <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>-&gt;getOrInsertFunction(</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;      <span class="stringliteral">&quot;__tmp_use&quot;</span>, <a class="code" href="classllvm_1_1FunctionType.html#a7e89b55242c964ae61b7850e99cacef0">FunctionType::get</a>(<a class="code" href="classllvm_1_1Type.html#a6e20e76960d952de088354cbcd14c3ab">Type::getVoidTy</a>(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>-&gt;getContext()), <span class="keyword">true</span>));</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;  <span class="keywordflow">if</span> (isa&lt;CallInst&gt;(Call)) {</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;    <span class="comment">// For call safepoints insert dummy calls right after safepoint</span></div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;    Holders.push_back(</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;        <a class="code" href="classllvm_1_1CallInst.html#a850d8262cd900958b3153c4aa080b2bb">CallInst::Create</a>(Func, Values, <span class="stringliteral">&quot;&quot;</span>, &amp;*++Call-&gt;getIterator()));</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;  }</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;  <span class="comment">// For invoke safepooints insert dummy calls both in normal and</span></div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;  <span class="comment">// exceptional destination blocks</span></div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;  <span class="keyword">auto</span> *II = cast&lt;InvokeInst&gt;(Call);</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;  Holders.push_back(<a class="code" href="classllvm_1_1CallInst.html#a850d8262cd900958b3153c4aa080b2bb">CallInst::Create</a>(</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;      Func, Values, <span class="stringliteral">&quot;&quot;</span>, &amp;*II-&gt;getNormalDest()-&gt;getFirstInsertionPt()));</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;  Holders.push_back(<a class="code" href="classllvm_1_1CallInst.html#a850d8262cd900958b3153c4aa080b2bb">CallInst::Create</a>(</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;      Func, Values, <span class="stringliteral">&quot;&quot;</span>, &amp;*II-&gt;getUnwindDest()-&gt;getFirstInsertionPt()));</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;}</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160; </div>
<div class="line"><a name="l02283"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#ae4bde92835730133920c426289e5d59b"> 2283</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#ae4bde92835730133920c426289e5d59b">findLiveReferences</a>(</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;    <a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;DT, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;CallBase *&gt;</a> toUpdate,</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;    <a class="code" href="classllvm_1_1MutableArrayRef.html">MutableArrayRef&lt;struct PartiallyConstructedSafepointRecord&gt;</a> records,</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;    <a class="code" href="classllvm_1_1GCStrategy.html">GCStrategy</a> *GC) {</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;  GCPtrLivenessData OriginalLivenessData;</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;  <a class="code" href="RewriteStatepointsForGC_8cpp.html#a9b5f57931ea7a3a623b6e8ac416177c1">computeLiveInValues</a>(DT, <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, OriginalLivenessData, GC);</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; records.size(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;    <span class="keyword">struct </span>PartiallyConstructedSafepointRecord &amp;<a class="code" href="LazyValueInfo_8cpp.html#add11cb1bc38847ce70e526af765dcce7">info</a> = records[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#a495b5fc8d39e47e06482653850d78986">analyzeParsePointLiveness</a>(DT, OriginalLivenessData, toUpdate[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="LazyValueInfo_8cpp.html#add11cb1bc38847ce70e526af765dcce7">info</a>, GC);</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;  }</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;}</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160; </div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;<span class="comment">// Helper function for the &quot;rematerializeLiveValues&quot;. It walks use chain</span></div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;<span class="comment">// starting from the &quot;CurrentValue&quot; until it reaches the root of the chain, i.e.</span></div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;<span class="comment">// the base or a value it cannot process. Only &quot;simple&quot; values are processed</span></div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;<span class="comment">// (currently it is GEP&#39;s and casts). The returned root is  examined by the</span></div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;<span class="comment">// callers of findRematerializableChainToBasePointer.  Fills &quot;ChainToBase&quot; array</span></div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;<span class="comment">// with all visited values.</span></div>
<div class="line"><a name="l02301"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#aaed6c13c4f5949ede0d5dd8182a09952"> 2301</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a>* <a class="code" href="RewriteStatepointsForGC_8cpp.html#aaed6c13c4f5949ede0d5dd8182a09952">findRematerializableChainToBasePointer</a>(</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;  <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction*&gt;</a> &amp;ChainToBase,</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *CurrentValue) {</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = dyn_cast&lt;GetElementPtrInst&gt;(CurrentValue)) {</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;    ChainToBase.push_back(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>);</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#aaed6c13c4f5949ede0d5dd8182a09952">findRematerializableChainToBasePointer</a>(ChainToBase,</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;                                                  <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getPointerOperand());</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;  }</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160; </div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1CastInst.html">CastInst</a> *CI = dyn_cast&lt;CastInst&gt;(CurrentValue)) {</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;    <span class="keywordflow">if</span> (!CI-&gt;isNoopCast(CI-&gt;getModule()-&gt;getDataLayout()))</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;      <span class="keywordflow">return</span> CI;</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160; </div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;    ChainToBase.push_back(CI);</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#aaed6c13c4f5949ede0d5dd8182a09952">findRematerializableChainToBasePointer</a>(ChainToBase,</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;                                                  CI-&gt;getOperand(0));</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;  }</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160; </div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;  <span class="comment">// We have reached the root of the chain, which is either equal to the base or</span></div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;  <span class="comment">// is the first unsupported value along the use chain.</span></div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;  <span class="keywordflow">return</span> CurrentValue;</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;}</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160; </div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;<span class="comment">// Helper function for the &quot;rematerializeLiveValues&quot;. Compute cost of the use</span></div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;<span class="comment">// chain we are going to rematerialize.</span></div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a></div>
<div class="line"><a name="l02327"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#aaa14b4fc802d9aa388b369deb1a1ef60"> 2327</a></span>&#160;<a class="code" href="RewriteStatepointsForGC_8cpp.html#aaa14b4fc802d9aa388b369deb1a1ef60">chainToBasePointerCost</a>(<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;Chain,</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;                       <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) {</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;  <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> = 0;</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160; </div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Instr : Chain) {</div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1CastInst.html">CastInst</a> *CI = dyn_cast&lt;CastInst&gt;(Instr)) {</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CI-&gt;isNoopCast(CI-&gt;getModule()-&gt;getDataLayout()) &amp;&amp;</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;             <span class="stringliteral">&quot;non noop cast is found during rematerialization&quot;</span>);</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160; </div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *SrcTy = CI-&gt;getOperand(0)-&gt;getType();</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;      <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> += <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>.<a class="code" href="classllvm_1_1TargetTransformInfo.html#a425eab58717b81784602a0b169dd9ff8">getCastInstrCost</a>(CI-&gt;getOpcode(), CI-&gt;getType(), SrcTy,</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;                                   <a class="code" href="classllvm_1_1TargetTransformInfo.html#a096c8b641174dc0e486006926c5202cf">TTI::getCastContextHint</a>(CI),</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;                                   <a class="code" href="classllvm_1_1TargetTransformInfo.html#a706f223f760b55668fbae74202b816bba7f80055e1969cb850739546467460ad8">TargetTransformInfo::TCK_SizeAndLatency</a>, CI);</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160; </div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = dyn_cast&lt;GetElementPtrInst&gt;(Instr)) {</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;      <span class="comment">// Cost of the address calculation</span></div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *ValTy = <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getSourceElementType();</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;      <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> += <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>.<a class="code" href="classllvm_1_1TargetTransformInfo.html#a246f298958a4a730bf7d3a64440dd47b">getAddressComputationCost</a>(ValTy);</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160; </div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;      <span class="comment">// And cost of the GEP itself</span></div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;      <span class="comment">// TODO: Use TTI-&gt;getGEPCost here (it exists, but appears to be not</span></div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;      <span class="comment">//       allowed for the external usage)</span></div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;hasAllConstantIndices())</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;        <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> += 2;</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160; </div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;      <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;unsupported instruction type during rematerialization&quot;</span>);</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;    }</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;  }</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160; </div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a>;</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;}</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160; </div>
<div class="line"><a name="l02360"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a55b03f8424779067813a7747a82a0b45"> 2360</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a55b03f8424779067813a7747a82a0b45">AreEquivalentPhiNodes</a>(<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> &amp;OrigRootPhi, <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> &amp;AlternateRootPhi) {</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;  <span class="keywordtype">unsigned</span> PhiNum = OrigRootPhi.<a class="code" href="classllvm_1_1PHINode.html#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>();</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;  <span class="keywordflow">if</span> (PhiNum != AlternateRootPhi.<a class="code" href="classllvm_1_1PHINode.html#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>() ||</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;      OrigRootPhi.<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() != AlternateRootPhi.<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>())</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;  <span class="comment">// Map of incoming values and their corresponding basic blocks of</span></div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;  <span class="comment">// OrigRootPhi.</span></div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;  <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;Value *, BasicBlock *, 8&gt;</a> CurrentIncomingValues;</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; PhiNum; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;    CurrentIncomingValues[OrigRootPhi.<a class="code" href="classllvm_1_1PHINode.html#a16c39eb6e60b42a40c399d8d65347bb6">getIncomingValue</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)] =</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;        OrigRootPhi.<a class="code" href="classllvm_1_1PHINode.html#a8ce0c4746a1ec805e66409d20ae93922">getIncomingBlock</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160; </div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;  <span class="comment">// Both current and base PHIs should have same incoming values and</span></div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;  <span class="comment">// the same basic blocks corresponding to the incoming values.</span></div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; PhiNum; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;    <span class="keyword">auto</span> CIVI =</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;        CurrentIncomingValues.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(AlternateRootPhi.<a class="code" href="classllvm_1_1PHINode.html#a16c39eb6e60b42a40c399d8d65347bb6">getIncomingValue</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;    <span class="keywordflow">if</span> (CIVI == CurrentIncomingValues.<a class="code" href="classllvm_1_1DenseMapBase.html#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *CurrentIncomingBB = CIVI-&gt;second;</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;    <span class="keywordflow">if</span> (CurrentIncomingBB != AlternateRootPhi.<a class="code" href="classllvm_1_1PHINode.html#a8ce0c4746a1ec805e66409d20ae93922">getIncomingBlock</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>))</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;  }</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;}</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160; </div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;<span class="comment">// Find derived pointers that can be recomputed cheap enough and fill</span></div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;<span class="comment">// RematerizationCandidates with such candidates.</span></div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l02389"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a07a6eb3eef6937d9da40864010f07dbf"> 2389</a></span>&#160;<a class="code" href="RewriteStatepointsForGC_8cpp.html#a07a6eb3eef6937d9da40864010f07dbf">findRematerializationCandidates</a>(<a class="code" href="namespacefalse.html#abbdd09796205857296660052b67cc167">PointerToBaseTy</a> PointerToBase,</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;                                <a class="code" href="namespacefalse.html#a63e6cab42597b0c6d4c6826a9a44dd59">RematCandTy</a> &amp;RematerizationCandidates,</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;                                <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) {</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ChainLengthThreshold = 10;</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160; </div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> P2B : PointerToBase) {</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;    <span class="keyword">auto</span> *Derived = P2B.first;</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;    <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = P2B.second;</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;    <span class="comment">// Consider only derived pointers.</span></div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;    <span class="keywordflow">if</span> (Derived == <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>)</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160; </div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;    <span class="comment">// For each live pointer find its defining chain.</span></div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 3&gt;</a> ChainToBase;</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *RootOfChain =</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;        <a class="code" href="RewriteStatepointsForGC_8cpp.html#aaed6c13c4f5949ede0d5dd8182a09952">findRematerializableChainToBasePointer</a>(ChainToBase, Derived);</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160; </div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;    <span class="comment">// Nothing to do, or chain is too long</span></div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;    <span class="keywordflow">if</span> ( ChainToBase.size() == 0 ||</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;        ChainToBase.size() &gt; ChainLengthThreshold)</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160; </div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;    <span class="comment">// Handle the scenario where the RootOfChain is not equal to the</span></div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;    <span class="comment">// Base Value, but they are essentially the same phi values.</span></div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;    <span class="keywordflow">if</span> (RootOfChain != PointerToBase[Derived]) {</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;      <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *OrigRootPhi = dyn_cast&lt;PHINode&gt;(RootOfChain);</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;      <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *AlternateRootPhi = dyn_cast&lt;PHINode&gt;(PointerToBase[Derived]);</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;      <span class="keywordflow">if</span> (!OrigRootPhi || !AlternateRootPhi)</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;      <span class="comment">// PHI nodes that have the same incoming values, and belonging to the same</span></div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;      <span class="comment">// basic blocks are essentially the same SSA value.  When the original phi</span></div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;      <span class="comment">// has incoming values with different base pointers, the original phi is</span></div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;      <span class="comment">// marked as conflict, and an additional `AlternateRootPhi` with the same</span></div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;      <span class="comment">// incoming values get generated by the findBasePointer function. We need</span></div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;      <span class="comment">// to identify the newly generated AlternateRootPhi (.base version of phi)</span></div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;      <span class="comment">// and RootOfChain (the original phi node itself) are the same, so that we</span></div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;      <span class="comment">// can rematerialize the gep and casts. This is a workaround for the</span></div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;      <span class="comment">// deficiency in the findBasePointer algorithm.</span></div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="RewriteStatepointsForGC_8cpp.html#a55b03f8424779067813a7747a82a0b45">AreEquivalentPhiNodes</a>(*OrigRootPhi, *AlternateRootPhi))</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;    }</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;    <span class="comment">// Compute cost of this chain.</span></div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;    <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> = <a class="code" href="RewriteStatepointsForGC_8cpp.html#aaa14b4fc802d9aa388b369deb1a1ef60">chainToBasePointerCost</a>(ChainToBase, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>);</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;    <span class="comment">// TODO: We can also account for cases when we will be able to remove some</span></div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;    <span class="comment">//       of the rematerialized values by later optimization passes. I.e if</span></div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;    <span class="comment">//       we rematerialized several intersecting chains. Or if original values</span></div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;    <span class="comment">//       don&#39;t have any uses besides this statepoint.</span></div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160; </div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;    <span class="comment">// Ok, there is a candidate.</span></div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;    RematerizlizationCandidateRecord <a class="code" href="classllvm_1_1Record.html">Record</a>;</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;    <a class="code" href="classllvm_1_1Record.html">Record</a>.ChainToBase = ChainToBase;</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;    <a class="code" href="classllvm_1_1Record.html">Record</a>.RootOfChain = RootOfChain;</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;    <a class="code" href="classllvm_1_1Record.html">Record</a>.Cost = <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a>;</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;    RematerizationCandidates.insert({ Derived, <a class="code" href="classllvm_1_1Record.html">Record</a> });</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;  }</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;}</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160; </div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;<span class="comment">// Try to rematerialize derived pointers immediately before their uses</span></div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;<span class="comment">// (instead of rematerializing after every statepoint it is live through).</span></div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;<span class="comment">// This can be beneficial when derived pointer is live across many</span></div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;<span class="comment">// statepoints, but uses are rare.</span></div>
<div class="line"><a name="l02450"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#aa175634946d91981b87f76ed9a583f27"> 2450</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#aa175634946d91981b87f76ed9a583f27">rematerializeLiveValuesAtUses</a>(</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;    <a class="code" href="namespacefalse.html#a63e6cab42597b0c6d4c6826a9a44dd59">RematCandTy</a> &amp;RematerizationCandidates,</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;    <a class="code" href="classllvm_1_1MutableArrayRef.html">MutableArrayRef&lt;PartiallyConstructedSafepointRecord&gt;</a> Records,</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;    <a class="code" href="namespacefalse.html#abbdd09796205857296660052b67cc167">PointerToBaseTy</a> &amp;PointerToBase) {</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="RewriteStatepointsForGC_8cpp.html#a2c16dd15d443e1027f7ffde8c13432c5">RematDerivedAtUses</a>)</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160; </div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 32&gt;</a> LiveValuesToBeDeleted;</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160; </div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Rematerialize derived pointers at uses, &quot;</span></div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;Num statepoints: &quot;</span> &lt;&lt; Records.size() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160; </div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;It : RematerizationCandidates) {</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Cand = cast&lt;Instruction&gt;(It.first);</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;    <span class="keyword">auto</span> &amp;<a class="code" href="classllvm_1_1Record.html">Record</a> = It.second;</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160; </div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Record.html">Record</a>.Cost &gt;= <a class="code" href="RewriteStatepointsForGC_8cpp.html#a99bf3712c00fdf60fe9b59a2f503f2c5">RematerializationThreshold</a>)</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160; </div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;    <span class="keywordflow">if</span> (Cand-&gt;<a class="code" href="classllvm_1_1Value.html#af21f61086e696a788f549768fdc26a93">user_empty</a>())</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160; </div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;    <span class="keywordflow">if</span> (Cand-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *U = dyn_cast&lt;Instruction&gt;(Cand-&gt;<a class="code" href="classllvm_1_1Value.html#a93270009c3358fba0a61654a9376ab4c">getUniqueUndroppableUser</a>()))</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;        <span class="keywordflow">if</span> (U-&gt;getParent() == Cand-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>())</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160; </div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;    <span class="comment">// Rematerialization before PHI nodes is not implemented.</span></div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">llvm::any_of</a>(Cand-&gt;<a class="code" href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">users</a>(),</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;                     [](<span class="keyword">const</span> <span class="keyword">auto</span> *U) { return isa&lt;PHINode&gt;(U); }))</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160; </div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Trying cand &quot;</span> &lt;&lt; *Cand &lt;&lt; <span class="stringliteral">&quot; ... &quot;</span>);</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160; </div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;    <span class="comment">// Count of rematerialization instructions we introduce is equal to number</span></div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;    <span class="comment">// of candidate uses.</span></div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;    <span class="comment">// Count of rematerialization instructions we eliminate is equal to number</span></div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;    <span class="comment">// of statepoints it is live through.</span></div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;    <span class="comment">// Consider transformation profitable if latter is greater than former</span></div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;    <span class="comment">// (in other words, we create less than eliminate).</span></div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;    <span class="keywordtype">unsigned</span> NumLiveStatepoints = <a class="code" href="namespacellvm.html#ac214df91cdc242f4710ea5a93939c678">llvm::count_if</a>(</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;        Records, [Cand](<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>) { <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.LiveSet.contains(Cand); });</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;    <span class="keywordtype">unsigned</span> NumUses = Cand-&gt;<a class="code" href="classllvm_1_1Value.html#aba0055050d741f60b6e0523507a2c79f">getNumUses</a>();</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160; </div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Num uses: &quot;</span> &lt;&lt; NumUses &lt;&lt; <span class="stringliteral">&quot; Num live statepoints: &quot;</span></div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;                      &lt;&lt; NumLiveStatepoints &lt;&lt; <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160; </div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;    <span class="keywordflow">if</span> (NumLiveStatepoints &lt; NumUses) {</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;not profitable\n&quot;</span>);</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;    }</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160; </div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;    <span class="comment">// If rematerialization is &#39;free&#39;, then favor rematerialization at</span></div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;    <span class="comment">// uses as it generally shortens live ranges.</span></div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;    <span class="comment">// TODO: Short (size ==1) chains only?</span></div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;    <span class="keywordflow">if</span> (NumLiveStatepoints == NumUses &amp;&amp; <a class="code" href="classllvm_1_1Record.html">Record</a>.Cost &gt; 0) {</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;not profitable\n&quot;</span>);</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;    }</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160; </div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;looks profitable\n&quot;</span>);</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160; </div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;    <span class="comment">// ChainToBase may contain another remat candidate (as a sub chain) which</span></div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;    <span class="comment">// has been rewritten by now. Need to recollect chain to have up to date</span></div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;    <span class="comment">// value.</span></div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;    <span class="comment">// TODO: sort records in findRematerializationCandidates() in</span></div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;    <span class="comment">// decreasing chain size order?</span></div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Record.html">Record</a>.ChainToBase.size() &gt; 1) {</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;      <a class="code" href="classllvm_1_1Record.html">Record</a>.ChainToBase.clear();</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;      <a class="code" href="RewriteStatepointsForGC_8cpp.html#aaed6c13c4f5949ede0d5dd8182a09952">findRematerializableChainToBasePointer</a>(<a class="code" href="classllvm_1_1Record.html">Record</a>.ChainToBase, Cand);</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;    }</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160; </div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;    <span class="comment">// Current rematerialization algorithm is very simple: we rematerialize</span></div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;    <span class="comment">// immediately before EVERY use, even if there are several uses in same</span></div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;    <span class="comment">// block or if use is local to Cand Def. The reason is that this allows</span></div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;    <span class="comment">// us to avoid recomputing liveness without complicated analysis:</span></div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;    <span class="comment">// - If we did not eliminate all uses of original Candidate, we do not</span></div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;    <span class="comment">//   know exaclty in what BBs it is still live.</span></div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;    <span class="comment">// - If we rematerialize once per BB, we need to find proper insertion</span></div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;    <span class="comment">//   place (first use in block, but after Def) and analyze if there is</span></div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;    <span class="comment">//   statepoint between uses in the block.</span></div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;    <span class="keywordflow">while</span> (!Cand-&gt;<a class="code" href="classllvm_1_1Value.html#af21f61086e696a788f549768fdc26a93">user_empty</a>()) {</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *UserI = cast&lt;Instruction&gt;(*Cand-&gt;<a class="code" href="classllvm_1_1Value.html#a158da2b6d3d938aaa15b6acd00150e2c">user_begin</a>());</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *RematChain = <a class="code" href="RewriteStatepointsForGC_8cpp.html#a0d959321ece754ecd86333ecfd33bac4">rematerializeChain</a>(</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;          <a class="code" href="classllvm_1_1Record.html">Record</a>.ChainToBase, UserI, <a class="code" href="classllvm_1_1Record.html">Record</a>.RootOfChain, PointerToBase[Cand]);</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;      UserI-&gt;<a class="code" href="classllvm_1_1User.html#a1600c7959045cb6b6a5f5a1d427ec67e">replaceUsesOfWith</a>(Cand, RematChain);</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;      PointerToBase[RematChain] = PointerToBase[Cand];</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;    }</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;    LiveValuesToBeDeleted.push_back(Cand);</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;  }</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160; </div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Rematerialized &quot;</span> &lt;&lt; LiveValuesToBeDeleted.size()</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; derived pointers\n&quot;</span>);</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Cand : LiveValuesToBeDeleted) {</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Cand-&gt;use_empty() &amp;&amp; <span class="stringliteral">&quot;Unexpected user remain&quot;</span>);</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;    RematerizationCandidates.erase(Cand);</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a> : Records) {</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.LiveSet.contains(Cand) ||</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;             <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.LiveSet.contains(PointerToBase[Cand]));</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;      <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.LiveSet.remove(Cand);</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;    }</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;  }</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160; </div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;  <span class="comment">// Recollect not rematerialized chains - we might have rewritten</span></div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;  <span class="comment">// their sub-chains.</span></div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;  <span class="keywordflow">if</span> (!LiveValuesToBeDeleted.empty()) {</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> : RematerizationCandidates) {</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;      <span class="keyword">auto</span> &amp;<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a> = <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>.second;</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.ChainToBase.size() &gt; 1) {</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;        <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.ChainToBase.clear();</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;        <a class="code" href="RewriteStatepointsForGC_8cpp.html#aaed6c13c4f5949ede0d5dd8182a09952">findRematerializableChainToBasePointer</a>(<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.ChainToBase, <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>.first);</div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;      }</div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;    }</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;  }</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;}</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160; </div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;<span class="comment">// From the statepoint live set pick values that are cheaper to recompute then</span></div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;<span class="comment">// to relocate. Remove this values from the live set, rematerialize them after</span></div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;<span class="comment">// statepoint and record them in &quot;Info&quot; structure. Note that similar to</span></div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;<span class="comment">// relocated values we don&#39;t do any user adjustments here.</span></div>
<div class="line"><a name="l02570"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a0650e5c5d027b7ef00c23a7921c114db"> 2570</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a0650e5c5d027b7ef00c23a7921c114db">rematerializeLiveValues</a>(<a class="code" href="classllvm_1_1CallBase.html">CallBase</a> *<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a>,</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;                                    PartiallyConstructedSafepointRecord &amp;<a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>,</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;                                    <a class="code" href="namespacefalse.html#abbdd09796205857296660052b67cc167">PointerToBaseTy</a> &amp;PointerToBase,</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;                                    <a class="code" href="namespacefalse.html#a63e6cab42597b0c6d4c6826a9a44dd59">RematCandTy</a> &amp;RematerizationCandidates,</div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;                                    <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) {</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;  <span class="comment">// Record values we are going to delete from this statepoint live set.</span></div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;  <span class="comment">// We can not di this in following loop due to iterator invalidation.</span></div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 32&gt;</a> LiveValuesToBeDeleted;</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160; </div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *LiveValue : <a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.LiveSet) {</div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;    <span class="keyword">auto</span> It = RematerizationCandidates.find(LiveValue);</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;    <span class="keywordflow">if</span> (It == RematerizationCandidates.end())</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160; </div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;    RematerizlizationCandidateRecord &amp;<a class="code" href="classllvm_1_1Record.html">Record</a> = It-&gt;second;</div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160; </div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;    <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> = <a class="code" href="classllvm_1_1Record.html">Record</a>.Cost;</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;    <span class="comment">// For invokes we need to rematerialize each chain twice - for normal and</span></div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;    <span class="comment">// for unwind basic blocks. Model this by multiplying cost by two.</span></div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;    <span class="keywordflow">if</span> (isa&lt;InvokeInst&gt;(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a>))</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;      <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> *= 2;</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160; </div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;    <span class="comment">// If it&#39;s too expensive - skip it.</span></div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> &gt;= <a class="code" href="RewriteStatepointsForGC_8cpp.html#a99bf3712c00fdf60fe9b59a2f503f2c5">RematerializationThreshold</a>)</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160; </div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;    <span class="comment">// Remove value from the live set</span></div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;    LiveValuesToBeDeleted.push_back(LiveValue);</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160; </div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;    <span class="comment">// Clone instructions and record them inside &quot;Info&quot; structure.</span></div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160; </div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;    <span class="comment">// Different cases for calls and invokes. For invokes we need to clone</span></div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;    <span class="comment">// instructions both on normal and unwind path.</span></div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;    <span class="keywordflow">if</span> (isa&lt;CallInst&gt;(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a>)) {</div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *InsertBefore = <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a>-&gt;getNextNode();</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InsertBefore);</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *RematerializedValue =</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;          <a class="code" href="RewriteStatepointsForGC_8cpp.html#a0d959321ece754ecd86333ecfd33bac4">rematerializeChain</a>(<a class="code" href="classllvm_1_1Record.html">Record</a>.ChainToBase, InsertBefore,</div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;                             <a class="code" href="classllvm_1_1Record.html">Record</a>.RootOfChain, PointerToBase[LiveValue]);</div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;      <a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RematerializedValues[RematerializedValue] = LiveValue;</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;      <span class="keyword">auto</span> *Invoke = cast&lt;InvokeInst&gt;(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a>);</div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160; </div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NormalInsertBefore =</div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;          &amp;*Invoke-&gt;getNormalDest()-&gt;getFirstInsertionPt();</div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *UnwindInsertBefore =</div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;          &amp;*Invoke-&gt;getUnwindDest()-&gt;getFirstInsertionPt();</div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160; </div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NormalRematerializedValue =</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;          <a class="code" href="RewriteStatepointsForGC_8cpp.html#a0d959321ece754ecd86333ecfd33bac4">rematerializeChain</a>(<a class="code" href="classllvm_1_1Record.html">Record</a>.ChainToBase, NormalInsertBefore,</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;                             <a class="code" href="classllvm_1_1Record.html">Record</a>.RootOfChain, PointerToBase[LiveValue]);</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *UnwindRematerializedValue =</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;          <a class="code" href="RewriteStatepointsForGC_8cpp.html#a0d959321ece754ecd86333ecfd33bac4">rematerializeChain</a>(<a class="code" href="classllvm_1_1Record.html">Record</a>.ChainToBase, UnwindInsertBefore,</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;                             <a class="code" href="classllvm_1_1Record.html">Record</a>.RootOfChain, PointerToBase[LiveValue]);</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160; </div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;      <a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RematerializedValues[NormalRematerializedValue] = LiveValue;</div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;      <a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RematerializedValues[UnwindRematerializedValue] = LiveValue;</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;    }</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;  }</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160; </div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;  <span class="comment">// Remove rematerialized values from the live set.</span></div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *LiveValue: LiveValuesToBeDeleted) {</div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;    <a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.LiveSet.remove(LiveValue);</div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;  }</div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;}</div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160; </div>
<div class="line"><a name="l02636"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#af001e6326d49bf139dfeee21772f01f0"> 2636</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#af001e6326d49bf139dfeee21772f01f0">inlineGetBaseAndOffset</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;                                   <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;CallInst *&gt;</a> &amp;Intrinsics,</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;                                   <a class="code" href="namespacefalse.html#a00af9f2347076bfb43b7d4e286feb576">DefiningValueMapTy</a> &amp;DVCache,</div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;                                   <a class="code" href="namespacefalse.html#a9f5b65a81eb5133d76ed041f31f7ceac">IsKnownBaseMapTy</a> &amp;KnownBases) {</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;  <span class="keyword">auto</span> &amp;<a class="code" href="NVVMIntrRange_8cpp.html#afad351d7bf10ac0446b64e7827634e94">Context</a> = <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getContext();</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;  <span class="keyword">auto</span> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getParent()-&gt;getDataLayout();</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160; </div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Callsite : Intrinsics)</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;    <span class="keywordflow">switch</span> (Callsite-&gt;getIntrinsicID()) {</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;    <span class="keywordflow">case</span> Intrinsic::experimental_gc_get_pointer_base: {</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;      Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> =</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;          <a class="code" href="RewriteStatepointsForGC_8cpp.html#a1b9baa03d5a238d6a2b34668dfe087b3">findBasePointer</a>(Callsite-&gt;getOperand(0), DVCache, KnownBases);</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!DVCache.count(Callsite));</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;      <span class="keyword">auto</span> *BaseBC = <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a>(Callsite).<a class="code" href="classllvm_1_1IRBuilderBase.html#a06d64f226fabd94d694d6abd82e3c7b3">CreateBitCast</a>(</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;          <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, Callsite-&gt;getType(), <a class="code" href="RewriteStatepointsForGC_8cpp.html#acb0214b30fb2b9e1d6e1cf6cc851b3e5">suffixed_name_or</a>(<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, <span class="stringliteral">&quot;.cast&quot;</span>, <span class="stringliteral">&quot;&quot;</span>));</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;      <span class="keywordflow">if</span> (BaseBC != <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>)</div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;        DVCache[BaseBC] = <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>;</div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;      Callsite-&gt;replaceAllUsesWith(BaseBC);</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;      <span class="keywordflow">if</span> (!BaseBC-&gt;hasName())</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;        BaseBC-&gt;takeName(Callsite);</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;      Callsite-&gt;eraseFromParent();</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;    }</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;    <span class="keywordflow">case</span> Intrinsic::experimental_gc_get_pointer_offset: {</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;      Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Derived = Callsite-&gt;getOperand(0);</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = <a class="code" href="RewriteStatepointsForGC_8cpp.html#a1b9baa03d5a238d6a2b34668dfe087b3">findBasePointer</a>(Derived, DVCache, KnownBases);</div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!DVCache.count(Callsite));</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm.html#a2c3c18bffdc25d969233c5448bdfe7eb">AddressSpace</a> = Derived-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>();</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;      <span class="keywordtype">unsigned</span> IntPtrSize = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getPointerSizeInBits(<a class="code" href="namespacellvm.html#a2c3c18bffdc25d969233c5448bdfe7eb">AddressSpace</a>);</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;      <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(Callsite);</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *BaseInt =</div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;          <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePtrToInt(<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, <a class="code" href="classllvm_1_1Type.html#acaf8e4c3e40e01e848c1fad5f05b81cd">Type::getIntNTy</a>(<a class="code" href="NVVMIntrRange_8cpp.html#afad351d7bf10ac0446b64e7827634e94">Context</a>, IntPtrSize),</div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;                                 <a class="code" href="RewriteStatepointsForGC_8cpp.html#acb0214b30fb2b9e1d6e1cf6cc851b3e5">suffixed_name_or</a>(<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, <span class="stringliteral">&quot;.int&quot;</span>, <span class="stringliteral">&quot;&quot;</span>));</div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *DerivedInt =</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;          <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePtrToInt(Derived, <a class="code" href="classllvm_1_1Type.html#acaf8e4c3e40e01e848c1fad5f05b81cd">Type::getIntNTy</a>(<a class="code" href="NVVMIntrRange_8cpp.html#afad351d7bf10ac0446b64e7827634e94">Context</a>, IntPtrSize),</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;                                 <a class="code" href="RewriteStatepointsForGC_8cpp.html#acb0214b30fb2b9e1d6e1cf6cc851b3e5">suffixed_name_or</a>(Derived, <span class="stringliteral">&quot;.int&quot;</span>, <span class="stringliteral">&quot;&quot;</span>));</div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm.html#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSub(DerivedInt, BaseInt);</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;      Callsite-&gt;replaceAllUsesWith(<a class="code" href="namespacellvm.html#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>);</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;      <a class="code" href="namespacellvm.html#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>-&gt;takeName(Callsite);</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;      Callsite-&gt;eraseFromParent();</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;    }</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;      <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Unknown intrinsic&quot;</span>);</div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;    }</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160; </div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;}</div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160; </div>
<div class="line"><a name="l02688"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a864a2ad11bbf83cf2b910e43d461cd02"> 2688</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a864a2ad11bbf83cf2b910e43d461cd02">insertParsePoints</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;DT,</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;                              <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>,</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;                              <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;CallBase *&gt;</a> &amp;ToUpdate,</div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;                              <a class="code" href="namespacefalse.html#a00af9f2347076bfb43b7d4e286feb576">DefiningValueMapTy</a> &amp;DVCache,</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;                              <a class="code" href="namespacefalse.html#a9f5b65a81eb5133d76ed041f31f7ceac">IsKnownBaseMapTy</a> &amp;KnownBases) {</div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;  std::unique_ptr&lt;GCStrategy&gt; GC = <a class="code" href="RewriteStatepointsForGC_8cpp.html#a19a380c6b55872909cc56792b8c98a77">findGCStrategy</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160; </div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;  <span class="comment">// Validate the input</span></div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;  std::set&lt;CallBase *&gt; Uniqued;</div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;  Uniqued.insert(ToUpdate.begin(), ToUpdate.end());</div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Uniqued.size() == ToUpdate.size() &amp;&amp; <span class="stringliteral">&quot;no duplicates please!&quot;</span>);</div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160; </div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1CallBase.html">CallBase</a> *<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a> : ToUpdate)</div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a>-&gt;getFunction() == &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160; </div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;  <span class="comment">// When inserting gc.relocates for invokes, we need to be able to insert at</span></div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;  <span class="comment">// the top of the successor blocks.  See the comment on</span></div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;  <span class="comment">// normalForInvokeSafepoint on exactly what is needed.  Note that this step</span></div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;  <span class="comment">// may restructure the CFG.</span></div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1CallBase.html">CallBase</a> *<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a> : ToUpdate) {</div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;    <span class="keyword">auto</span> *II = dyn_cast&lt;InvokeInst&gt;(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a>);</div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;    <span class="keywordflow">if</span> (!II)</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#a15f212bb9de8ad1bff2d4732f12397ee">normalizeForInvokeSafepoint</a>(II-&gt;getNormalDest(), II-&gt;getParent(), DT);</div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#a15f212bb9de8ad1bff2d4732f12397ee">normalizeForInvokeSafepoint</a>(II-&gt;getUnwindDest(), II-&gt;getParent(), DT);</div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;  }</div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160; </div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;  <span class="comment">// A list of dummy calls added to the IR to keep various values obviously</span></div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;  <span class="comment">// live in the IR.  We&#39;ll remove all of these when done.</span></div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;CallInst *, 64&gt;</a> Holders;</div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160; </div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;  <span class="comment">// Insert a dummy call with all of the deopt operands we&#39;ll need for the</span></div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;  <span class="comment">// actual safepoint insertion as arguments.  This ensures reference operands</span></div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;  <span class="comment">// in the deopt argument list are considered live through the safepoint (and</span></div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;  <span class="comment">// thus makes sure they get relocated.)</span></div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1CallBase.html">CallBase</a> *<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a> : ToUpdate) {</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 64&gt;</a> DeoptValues;</div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160; </div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a> : <a class="code" href="RewriteStatepointsForGC_8cpp.html#a6580c40c364979dcdc7847ebac738e15">GetDeoptBundleOperands</a>(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a>)) {</div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a class="code" href="RewriteStatepointsForGC_8cpp.html#aac0cb310804ea09b44a5d79f93319d42">isUnhandledGCPointerType</a>(<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a>-&gt;getType(), GC.get()) &amp;&amp;</div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;             <span class="stringliteral">&quot;support for FCA unimplemented&quot;</span>);</div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="RewriteStatepointsForGC_8cpp.html#aa24dcfb77b1890aaa6d1f687eeffe665">isHandledGCPointerType</a>(<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a>-&gt;getType(), GC.get()))</div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;        DeoptValues.push_back(<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a>);</div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;    }</div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160; </div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#a6b7912ea5edc4563fe03afc57fa9b0c6">insertUseHolderAfter</a>(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a>, DeoptValues, Holders);</div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;  }</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160; </div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;PartiallyConstructedSafepointRecord, 64&gt;</a> Records(ToUpdate.size());</div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160; </div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;  <span class="comment">// A) Identify all gc pointers which are statically live at the given call</span></div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;  <span class="comment">// site.</span></div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;  <a class="code" href="RewriteStatepointsForGC_8cpp.html#ae4bde92835730133920c426289e5d59b">findLiveReferences</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, DT, ToUpdate, Records, GC.get());</div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;<span class="comment">  /// Global mapping from live pointers to a base-defining-value.</span></div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;<span class="comment"></span>  <a class="code" href="namespacefalse.html#abbdd09796205857296660052b67cc167">PointerToBaseTy</a> PointerToBase;</div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160; </div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;  <span class="comment">// B) Find the base pointers for each live pointer</span></div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; Records.size(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;    PartiallyConstructedSafepointRecord &amp;<a class="code" href="LazyValueInfo_8cpp.html#add11cb1bc38847ce70e526af765dcce7">info</a> = Records[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#a8b9e4ec572c189d8f8afc4f71da55a9c">findBasePointers</a>(DT, DVCache, ToUpdate[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>], <a class="code" href="LazyValueInfo_8cpp.html#add11cb1bc38847ce70e526af765dcce7">info</a>, PointerToBase, KnownBases);</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;  }</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="RewriteStatepointsForGC_8cpp.html#a2f8133c8c84fda25efb484e4752d54b8">PrintBasePointers</a>) {</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;    <a class="code" href="namespacellvm.html#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>() &lt;&lt; <span class="stringliteral">&quot;Base Pairs (w/o Relocation):\n&quot;</span>;</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Pair : PointerToBase) {</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;      <a class="code" href="namespacellvm.html#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>() &lt;&lt; <span class="stringliteral">&quot; derived &quot;</span>;</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;      Pair.first-&gt;printAsOperand(<a class="code" href="namespacellvm.html#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>(), <span class="keyword">false</span>);</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;      <a class="code" href="namespacellvm.html#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>() &lt;&lt; <span class="stringliteral">&quot; base &quot;</span>;</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;      Pair.second-&gt;printAsOperand(<a class="code" href="namespacellvm.html#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>(), <span class="keyword">false</span>);</div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;      <a class="code" href="namespacellvm.html#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;      ;</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;    }</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;  }</div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160; </div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;  <span class="comment">// The base phi insertion logic (for any safepoint) may have inserted new</span></div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;  <span class="comment">// instructions which are now live at some safepoint.  The simplest such</span></div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;  <span class="comment">// example is:</span></div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;  <span class="comment">// loop:</span></div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;  <span class="comment">//   phi a  &lt;-- will be a new base_phi here</span></div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;  <span class="comment">//   safepoint 1 &lt;-- that needs to be live here</span></div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;  <span class="comment">//   gep a + 1</span></div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;  <span class="comment">//   safepoint 2</span></div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;  <span class="comment">//   br loop</span></div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;  <span class="comment">// We insert some dummy calls after each safepoint to definitely hold live</span></div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;  <span class="comment">// the base pointers which were identified for that safepoint.  We&#39;ll then</span></div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;  <span class="comment">// ask liveness for _every_ base inserted to see what is now live.  Then we</span></div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;  <span class="comment">// remove the dummy calls.</span></div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;  Holders.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(Holders.size() + Records.size());</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; Records.size(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;    PartiallyConstructedSafepointRecord &amp;<a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a> = Records[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160; </div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 128&gt;</a> Bases;</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Derived : <a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.LiveSet) {</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PointerToBase.count(Derived) &amp;&amp; <span class="stringliteral">&quot;Missed base for derived pointer&quot;</span>);</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;      Bases.push_back(PointerToBase[Derived]);</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;    }</div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160; </div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#a6b7912ea5edc4563fe03afc57fa9b0c6">insertUseHolderAfter</a>(ToUpdate[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>], Bases, Holders);</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;  }</div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160; </div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;  <span class="comment">// By selecting base pointers, we&#39;ve effectively inserted new uses. Thus, we</span></div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;  <span class="comment">// need to rerun liveness.  We may *also* have inserted new defs, but that&#39;s</span></div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;  <span class="comment">// not the key issue.</span></div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;  <a class="code" href="RewriteStatepointsForGC_8cpp.html#af864550d3c61aff5c6777610fdba8b7f">recomputeLiveInValues</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, DT, ToUpdate, Records, PointerToBase, GC.get());</div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160; </div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="RewriteStatepointsForGC_8cpp.html#a2f8133c8c84fda25efb484e4752d54b8">PrintBasePointers</a>) {</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;    <a class="code" href="namespacellvm.html#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>() &lt;&lt; <span class="stringliteral">&quot;Base Pairs: (w/Relocation)\n&quot;</span>;</div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> Pair : PointerToBase) {</div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;      <a class="code" href="namespacellvm.html#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>() &lt;&lt; <span class="stringliteral">&quot; derived &quot;</span>;</div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;      Pair.first-&gt;printAsOperand(<a class="code" href="namespacellvm.html#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>(), <span class="keyword">false</span>);</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;      <a class="code" href="namespacellvm.html#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>() &lt;&lt; <span class="stringliteral">&quot; base &quot;</span>;</div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;      Pair.second-&gt;printAsOperand(<a class="code" href="namespacellvm.html#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>(), <span class="keyword">false</span>);</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;      <a class="code" href="namespacellvm.html#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;    }</div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;  }</div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160; </div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;  <span class="comment">// It is possible that non-constant live variables have a constant base.  For</span></div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;  <span class="comment">// example, a GEP with a variable offset from a global.  In this case we can</span></div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;  <span class="comment">// remove it from the liveset.  We already don&#39;t add constants to the liveset</span></div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;  <span class="comment">// because we assume they won&#39;t move at runtime and the GC doesn&#39;t need to be</span></div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;  <span class="comment">// informed about them.  The same reasoning applies if the base is constant.</span></div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;  <span class="comment">// Note that the relocation placement code relies on this filtering for</span></div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;  <span class="comment">// correctness as it expects the base to be in the liveset, which isn&#39;t true</span></div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;  <span class="comment">// if the base is constant.</span></div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a> : Records) {</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;    <a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.LiveSet.remove_if([&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *LiveV) {</div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PointerToBase.count(LiveV) &amp;&amp; <span class="stringliteral">&quot;Missed base for derived pointer&quot;</span>);</div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;      <span class="keywordflow">return</span> isa&lt;Constant&gt;(PointerToBase[LiveV]);</div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;    });</div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;  }</div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160; </div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI : Holders)</div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;    CI-&gt;eraseFromParent();</div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160; </div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;  Holders.clear();</div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160; </div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;  <span class="comment">// Compute the cost of possible re-materialization of derived pointers.</span></div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;  <a class="code" href="namespacefalse.html#a63e6cab42597b0c6d4c6826a9a44dd59">RematCandTy</a> RematerizationCandidates;</div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;  <a class="code" href="RewriteStatepointsForGC_8cpp.html#a07a6eb3eef6937d9da40864010f07dbf">findRematerializationCandidates</a>(PointerToBase, RematerizationCandidates, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>);</div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160; </div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;  <span class="comment">// In order to reduce live set of statepoint we might choose to rematerialize</span></div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;  <span class="comment">// some values instead of relocating them. This is purely an optimization and</span></div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;  <span class="comment">// does not influence correctness.</span></div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;  <span class="comment">// First try rematerialization at uses, then after statepoints.</span></div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;  <a class="code" href="RewriteStatepointsForGC_8cpp.html#aa175634946d91981b87f76ed9a583f27">rematerializeLiveValuesAtUses</a>(RematerizationCandidates, Records,</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;                                PointerToBase);</div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; Records.size(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#a0650e5c5d027b7ef00c23a7921c114db">rematerializeLiveValues</a>(ToUpdate[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>], Records[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>], PointerToBase,</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;                            RematerizationCandidates, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>);</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160; </div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;  <span class="comment">// We need this to safely RAUW and delete call or invoke return values that</span></div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;  <span class="comment">// may themselves be live over a statepoint.  For details, please see usage in</span></div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;  <span class="comment">// makeStatepointExplicitImpl.</span></div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;  std::vector&lt;DeferredReplacement&gt; Replacements;</div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160; </div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;  <span class="comment">// Now run through and replace the existing statepoints with new ones with</span></div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;  <span class="comment">// the live variables listed.  We do not yet update uses of the values being</span></div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;  <span class="comment">// relocated. We have references to live variables that need to</span></div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;  <span class="comment">// survive to the last iteration of this loop.  (By construction, the</span></div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;  <span class="comment">// previous statepoint can not be a live variable, thus we can and remove</span></div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;  <span class="comment">// the old statepoint calls as we go.)</span></div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; Records.size(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#acad221a6df1d4872c6cca80bc913f7b7">makeStatepointExplicit</a>(DT, ToUpdate[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>], Records[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>], Replacements,</div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;                           PointerToBase, GC.get());</div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160; </div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;  ToUpdate.clear(); <span class="comment">// prevent accident use of invalid calls.</span></div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160; </div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;PR : Replacements)</div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;    PR.doReplacement();</div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160; </div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;  Replacements.clear();</div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160; </div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a> : Records) {</div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;    <span class="comment">// These live sets may contain state Value pointers, since we replaced calls</span></div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;    <span class="comment">// with operand bundles with calls wrapped in gc.statepoint, and some of</span></div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;    <span class="comment">// those calls may have been def&#39;ing live gc pointers.  Clear these out to</span></div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;    <span class="comment">// avoid accidentally using them.</span></div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;    <span class="comment">// TODO: We should create a separate data structure that does not contain</span></div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;    <span class="comment">// these live sets, and migrate to using that data structure from this point</span></div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;    <span class="comment">// onward.</span></div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;    <a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.LiveSet.clear();</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;  }</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;  PointerToBase.clear();</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160; </div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;  <span class="comment">// Do all the fixups of the original live variables to their relocated selves</span></div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 128&gt;</a> Live;</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; Records.size(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;    PartiallyConstructedSafepointRecord &amp;<a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a> = Records[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160; </div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;    <span class="comment">// We can&#39;t simply save the live set from the original insertion.  One of</span></div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;    <span class="comment">// the live values might be the result of a call which needs a safepoint.</span></div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;    <span class="comment">// That Value* no longer exists and we need to use the new gc_result.</span></div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;    <span class="comment">// Thankfully, the live set is embedded in the statepoint (and updated), so</span></div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;    <span class="comment">// we just grab that.</span></div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;    <a class="code" href="namespacellvm.html#a39d3d23a084c4544ee5903203db10e8a">llvm::append_range</a>(Live, <a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.StatepointToken-&gt;gc_args());</div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;    <span class="comment">// Do some basic validation checking on our liveness results before</span></div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;    <span class="comment">// performing relocation.  Relocation can and will turn mistakes in liveness</span></div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;    <span class="comment">// results into non-sensical code which is must harder to debug.</span></div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;    <span class="comment">// TODO: It would be nice to test consistency as well</span></div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DT.<a class="code" href="classllvm_1_1DominatorTree.html#a1a70f2c359aadd76a72aaaede16aca4a">isReachableFromEntry</a>(<a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.StatepointToken-&gt;getParent()) &amp;&amp;</div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;           <span class="stringliteral">&quot;statepoint must be reachable or liveness is meaningless&quot;</span>);</div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : <a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.StatepointToken-&gt;gc_args()) {</div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;      <span class="keywordflow">if</span> (!isa&lt;Instruction&gt;(V))</div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;        <span class="comment">// Non-instruction values trivial dominate all possible uses</span></div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;      <span class="keyword">auto</span> *LiveInst = cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DT.<a class="code" href="classllvm_1_1DominatorTree.html#a1a70f2c359aadd76a72aaaede16aca4a">isReachableFromEntry</a>(LiveInst-&gt;getParent()) &amp;&amp;</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;             <span class="stringliteral">&quot;unreachable values should never be live&quot;</span>);</div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DT.<a class="code" href="classllvm_1_1DominatorTree.html#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(LiveInst, <a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.StatepointToken) &amp;&amp;</div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;             <span class="stringliteral">&quot;basic SSA liveness expectation violated by liveness analysis&quot;</span>);</div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;    }</div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;  }</div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;  <a class="code" href="RewriteStatepointsForGC_8cpp.html#a1d739ace36dfd7ba0b4069716611fd74">unique_unsorted</a>(Live);</div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160; </div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;  <span class="comment">// Validation check</span></div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> : Live)</div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="RewriteStatepointsForGC_8cpp.html#aa24dcfb77b1890aaa6d1f687eeffe665">isHandledGCPointerType</a>(<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getType(), GC.get()) &amp;&amp;</div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;           <span class="stringliteral">&quot;must be a gc pointer type&quot;</span>);</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160; </div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;  <a class="code" href="RewriteStatepointsForGC_8cpp.html#a55412d2c237115c95f20e12ba0d95922">relocationViaAlloca</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, DT, Live, Records);</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;  <span class="keywordflow">return</span> !Records.empty();</div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;}</div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160; </div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;<span class="comment">// List of all parameter and return attributes which must be stripped when</span></div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;<span class="comment">// lowering from the abstract machine model.  Note that we list attributes</span></div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;<span class="comment">// here which aren&#39;t valid as return attributes, that is okay.</span></div>
<div class="line"><a name="l02921"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#ae50a94a56edda301bd0af57f7dd2da49"> 2921</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1AttributeMask.html">AttributeMask</a> <a class="code" href="RewriteStatepointsForGC_8cpp.html#ae50a94a56edda301bd0af57f7dd2da49">getParamAndReturnAttributesToRemove</a>() {</div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;  <a class="code" href="classllvm_1_1AttributeMask.html">AttributeMask</a> <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>;</div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;  <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.addAttribute(Attribute::Dereferenceable);</div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;  <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.addAttribute(Attribute::DereferenceableOrNull);</div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;  <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.addAttribute(Attribute::ReadNone);</div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;  <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.addAttribute(Attribute::ReadOnly);</div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;  <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.addAttribute(Attribute::WriteOnly);</div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;  <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.addAttribute(Attribute::NoAlias);</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;  <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.addAttribute(Attribute::NoFree);</div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>;</div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;}</div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160; </div>
<div class="line"><a name="l02933"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a97d7bb2d0dc7b8e471e481ef8e4d3986"> 2933</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a97d7bb2d0dc7b8e471e481ef8e4d3986">stripNonValidAttributesFromPrototype</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;  <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx = <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getContext();</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160; </div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;  <span class="comment">// Intrinsics are very delicate.  Lowering sometimes depends the presence</span></div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;  <span class="comment">// of certain attributes for correctness, but we may have also inferred</span></div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;  <span class="comment">// additional ones in the abstract machine model which need stripped.  This</span></div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;  <span class="comment">// assumes that the attributes defined in Intrinsic.td are conservatively</span></div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;  <span class="comment">// correct for both physical and abstract model.</span></div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> <span class="keywordtype">id</span> = <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getIntrinsicID()) {</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;    <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.setAttributes(<a class="code" href="namespacellvm_1_1Intrinsic.html#a89cda2218259523c41863fc1175d6907">Intrinsic::getAttributes</a>(Ctx, <span class="keywordtype">id</span>));</div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;  }</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160; </div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;  <a class="code" href="classllvm_1_1AttributeMask.html">AttributeMask</a> <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a> = <a class="code" href="RewriteStatepointsForGC_8cpp.html#ae50a94a56edda301bd0af57f7dd2da49">getParamAndReturnAttributesToRemove</a>();</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Argument.html">Argument</a> &amp;<a class="code" href="README__ALTIVEC_8txt.html#a015846b6188ce15e08cd94c74a9df1a3">A</a> : <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.args())</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;    <span class="keywordflow">if</span> (isa&lt;PointerType&gt;(<a class="code" href="README__ALTIVEC_8txt.html#a015846b6188ce15e08cd94c74a9df1a3">A</a>.getType()))</div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;      <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.removeParamAttrs(<a class="code" href="README__ALTIVEC_8txt.html#a015846b6188ce15e08cd94c74a9df1a3">A</a>.getArgNo(), <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>);</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160; </div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;  <span class="keywordflow">if</span> (isa&lt;PointerType&gt;(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getReturnType()))</div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;    <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.removeRetAttrs(<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>);</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160; </div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> Attr : <a class="code" href="RewriteStatepointsForGC_8cpp.html#a9d33f9de1cf6f2a221b8d60dd95effb9">FnAttrsToStrip</a>)</div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;    <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.removeFnAttr(Attr);</div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;}</div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;<span class="comment">/// Certain metadata on instructions are invalid after running RS4GC.</span></div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;<span class="comment">/// Optimizations that run after RS4GC can incorrectly use this metadata to</span></div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;<span class="comment">/// optimize functions. We drop such metadata on the instruction.</span></div>
<div class="line"><a name="l02961"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a9d12b579baa093a4a9e2eb24c69b7129"> 2961</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a9d12b579baa093a4a9e2eb24c69b7129">stripInvalidMetadataFromInstruction</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;  <span class="keywordflow">if</span> (!isa&lt;LoadInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !isa&lt;StoreInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;  <span class="comment">// These are the attributes that are still valid on loads and stores after</span></div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;  <span class="comment">// RS4GC.</span></div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;  <span class="comment">// The metadata implying dereferenceability and noalias are (conservatively)</span></div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;  <span class="comment">// dropped.  This is because semantically, after RewriteStatepointsForGC runs,</span></div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;  <span class="comment">// all calls to gc.statepoint &quot;free&quot; the entire heap. Also, gc.statepoint can</span></div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;  <span class="comment">// touch the entire heap including noalias objects. Note: The reasoning is</span></div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;  <span class="comment">// same as stripping the dereferenceability and noalias attributes that are</span></div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;  <span class="comment">// analogous to the metadata counterparts.</span></div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;  <span class="comment">// We also drop the invariant.load metadata on the load because that metadata</span></div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;  <span class="comment">// implies the address operand to the load points to memory that is never</span></div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;  <span class="comment">// changed once it became dereferenceable. This is no longer true after RS4GC.</span></div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;  <span class="comment">// Similar reasoning applies to invariant.group metadata, which applies to</span></div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;  <span class="comment">// loads within a group.</span></div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;  <span class="keywordtype">unsigned</span> ValidMetadataAfterRS4GC[] = {LLVMContext::MD_tbaa,</div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;                         LLVMContext::MD_range,</div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;                         LLVMContext::MD_alias_scope,</div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;                         LLVMContext::MD_nontemporal,</div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;                         LLVMContext::MD_nonnull,</div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;                         LLVMContext::MD_align,</div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;                         LLVMContext::MD_type};</div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160; </div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;  <span class="comment">// Drops all metadata on the instruction other than ValidMetadataAfterRS4GC.</span></div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;  <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.dropUnknownNonDebugMetadata(ValidMetadataAfterRS4GC);</div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;}</div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160; </div>
<div class="line"><a name="l02989"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a2bf12026ed9de594d2117077b422c24d"> 2989</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a2bf12026ed9de594d2117077b422c24d">stripNonValidDataFromBody</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.empty())</div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160; </div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;  <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx = <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getContext();</div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;  <a class="code" href="classllvm_1_1MDBuilder.html">MDBuilder</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(Ctx);</div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160; </div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;  <span class="comment">// Set of invariantstart instructions that we need to remove.</span></div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;  <span class="comment">// Use this to avoid invalidating the instruction iterator.</span></div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;IntrinsicInst*, 12&gt;</a> InvariantStartInstructions;</div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160; </div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="namespacellvm.html#a7e3e687ddfdcbacd404bcf17b917dd88">instructions</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)) {</div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;    <span class="comment">// invariant.start on memory location implies that the referenced memory</span></div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;    <span class="comment">// location is constant and unchanging. This is no longer true after</span></div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;    <span class="comment">// RewriteStatepointsForGC runs because there can be calls to gc.statepoint</span></div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;    <span class="comment">// which frees the entire heap and the presence of invariant.start allows</span></div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;    <span class="comment">// the optimizer to sink the load of a memory location past a statepoint,</span></div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;    <span class="comment">// which is incorrect.</span></div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *II = dyn_cast&lt;IntrinsicInst&gt;(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;      <span class="keywordflow">if</span> (II-&gt;getIntrinsicID() == Intrinsic::invariant_start) {</div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;        InvariantStartInstructions.push_back(II);</div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;      }</div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160; </div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *<a class="code" href="namespacellvm_1_1dwarf.html#ac94a19fc8c57bf0350fc4e9f45897828">Tag</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getMetadata(LLVMContext::MD_tbaa)) {</div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;      <a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *MutableTBAA = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.createMutableTBAAAccessTag(<a class="code" href="namespacellvm_1_1dwarf.html#ac94a19fc8c57bf0350fc4e9f45897828">Tag</a>);</div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.setMetadata(LLVMContext::MD_tbaa, MutableTBAA);</div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;    }</div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160; </div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#a9d12b579baa093a4a9e2eb24c69b7129">stripInvalidMetadataFromInstruction</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160; </div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;    <a class="code" href="classllvm_1_1AttributeMask.html">AttributeMask</a> <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a> = <a class="code" href="RewriteStatepointsForGC_8cpp.html#ae50a94a56edda301bd0af57f7dd2da49">getParamAndReturnAttributesToRemove</a>();</div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a> = dyn_cast&lt;CallBase&gt;(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a>-&gt;arg_size(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;        <span class="keywordflow">if</span> (isa&lt;PointerType&gt;(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a>-&gt;getArgOperand(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;getType()))</div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;          <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a>-&gt;removeParamAttrs(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>);</div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;      <span class="keywordflow">if</span> (isa&lt;PointerType&gt;(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a>-&gt;getType()))</div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;        <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a>-&gt;removeRetAttrs(<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>);</div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;    }</div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;  }</div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160; </div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;  <span class="comment">// Delete the invariant.start instructions and RAUW undef.</span></div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *II : InvariantStartInstructions) {</div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;    II-&gt;replaceAllUsesWith(<a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(II-&gt;getType()));</div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;    II-&gt;eraseFromParent();</div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;  }</div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;}</div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;<span class="comment">/// Looks up the GC strategy for a given function, returning null if the</span></div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;<span class="comment">/// function doesn&#39;t have a GC tag. The strategy is stored in the cache.</span></div>
<div class="line"><a name="l03039"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a19a380c6b55872909cc56792b8c98a77"> 3039</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> std::unique_ptr&lt;GCStrategy&gt; <a class="code" href="RewriteStatepointsForGC_8cpp.html#a19a380c6b55872909cc56792b8c98a77">findGCStrategy</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasGC())</div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160; </div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#ac94cf747f5fb3d8bef69ba5168873f55">getGCStrategy</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getGC());</div>
<div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;}</div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;<span class="comment">/// Returns true if this function should be rewritten by this pass.  The main</span></div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;<span class="comment">/// point of this function is as an extension point for custom logic.</span></div>
<div class="line"><a name="l03048"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a8e774e505629c16421ed9b345ddb1f75"> 3048</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a8e774e505629c16421ed9b345ddb1f75">shouldRewriteStatepointsIn</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasGC())</div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160; </div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;  std::unique_ptr&lt;GCStrategy&gt; Strategy = <a class="code" href="RewriteStatepointsForGC_8cpp.html#a19a380c6b55872909cc56792b8c98a77">findGCStrategy</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160; </div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Strategy &amp;&amp; <span class="stringliteral">&quot;GC strategy is required by function, but was not found&quot;</span>);</div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160; </div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;  <span class="keywordflow">return</span> Strategy-&gt;useRS4GC();</div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;}</div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160; </div>
<div class="line"><a name="l03059"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#aa44f7b8f4217ab0c4ae76b62d5d1ddd1"> 3059</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#aa44f7b8f4217ab0c4ae76b62d5d1ddd1">stripNonValidData</a>(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>) {</div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">llvm::any_of</a>(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, <a class="code" href="RewriteStatepointsForGC_8cpp.html#a8e774e505629c16421ed9b345ddb1f75">shouldRewriteStatepointsIn</a>) &amp;&amp; <span class="stringliteral">&quot;precondition!&quot;</span>);</div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160; </div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>)</div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#a97d7bb2d0dc7b8e471e481ef8e4d3986">stripNonValidAttributesFromPrototype</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160; </div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>)</div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#a2bf12026ed9de594d2117077b422c24d">stripNonValidDataFromBody</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;}</div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160; </div>
<div class="line"><a name="l03071"></a><span class="lineno"><a class="line" href="structllvm_1_1RewriteStatepointsForGC.html#ad69716246dabb743839cafceb902ef46"> 3071</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="structllvm_1_1RewriteStatepointsForGC.html#ad69716246dabb743839cafceb902ef46">RewriteStatepointsForGC::runOnFunction</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;DT,</div>
<div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;                                            <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>,</div>
<div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;                                            <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> &amp;TLI) {</div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.isDeclaration() &amp;&amp; !<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.empty() &amp;&amp;</div>
<div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;         <span class="stringliteral">&quot;need function body to rewrite statepoints in&quot;</span>);</div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="RewriteStatepointsForGC_8cpp.html#a8e774e505629c16421ed9b345ddb1f75">shouldRewriteStatepointsIn</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &amp;&amp; <span class="stringliteral">&quot;mismatch in rewrite decision&quot;</span>);</div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160; </div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;  <span class="keyword">auto</span> NeedsRewrite = [&amp;TLI](<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a> = dyn_cast&lt;CallBase&gt;(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;      <span class="keywordflow">if</span> (isa&lt;GCStatepointInst&gt;(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a>))</div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#af75ecbb2ce891821d146a047f17d4dd1">callsGCLeafFunction</a>(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a>, TLI))</div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160; </div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;      <span class="comment">// Normally it&#39;s up to the frontend to make sure that non-leaf calls also</span></div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;      <span class="comment">// have proper deopt state if it is required. We make an exception for</span></div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;      <span class="comment">// element atomic memcpy/memmove intrinsics here. Unlike other intrinsics</span></div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;      <span class="comment">// these are non-leaf by default. They might be generated by the optimizer</span></div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;      <span class="comment">// which doesn&#39;t know how to produce a proper deopt state. So if we see a</span></div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;      <span class="comment">// non-leaf memcpy/memmove without deopt state just treat it as a leaf</span></div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;      <span class="comment">// copy and don&#39;t produce a statepoint.</span></div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="RewriteStatepointsForGC_8cpp.html#a7d36e55d9eac11862a0db20973c68707">AllowStatepointWithNoDeoptInfo</a> &amp;&amp;</div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;          !<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a>-&gt;getOperandBundle(<a class="code" href="classllvm_1_1LLVMContext.html#a800c1300065ca1615d2f4fb88623afd5a3f6df86c6efab701ade7abbc3134c25a">LLVMContext::OB_deopt</a>)) {</div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((isa&lt;AtomicMemCpyInst&gt;(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a>) || isa&lt;AtomicMemMoveInst&gt;(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a>)) &amp;&amp;</div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;               <span class="stringliteral">&quot;Don&#39;t expect any other calls here!&quot;</span>);</div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;      }</div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;    }</div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;  };</div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160; </div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;  <span class="comment">// Delete any unreachable statepoints so that we don&#39;t have unrewritten</span></div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;  <span class="comment">// statepoints surviving this pass.  This makes testing easier and the</span></div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;  <span class="comment">// resulting IR less confusing to human readers.</span></div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;  <a class="code" href="classllvm_1_1DomTreeUpdater.html">DomTreeUpdater</a> DTU(DT, <a class="code" href="classllvm_1_1DomTreeUpdater.html#a8bf4c30be33831d7882d6880b8ae433da46a9ebdb80117bfa1f0cdea65438290a">DomTreeUpdater::UpdateStrategy::Lazy</a>);</div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <a class="code" href="namespacellvm.html#aec88b7682025edff7984c3b6c8da8ac9">removeUnreachableBlocks</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, &amp;DTU);</div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;  <span class="comment">// Flush the Dominator Tree.</span></div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;  DTU.<a class="code" href="classllvm_1_1DomTreeUpdater.html#ae529b0d73b54361e5151985f93497001">getDomTree</a>();</div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160; </div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;  <span class="comment">// Gather all the statepoints which need rewritten.  Be careful to only</span></div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;  <span class="comment">// consider those in reachable code since we need to ask dominance queries</span></div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;  <span class="comment">// when rewriting.  We&#39;ll delete the unreachable ones in a moment.</span></div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;CallBase *, 64&gt;</a> ParsePointNeeded;</div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;CallInst *, 64&gt;</a> Intrinsics;</div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="namespacellvm.html#a7e3e687ddfdcbacd404bcf17b917dd88">instructions</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)) {</div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;    <span class="comment">// TODO: only the ones with the flag set!</span></div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;    <span class="keywordflow">if</span> (NeedsRewrite(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;      <span class="comment">// NOTE removeUnreachableBlocks() is stronger than</span></div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;      <span class="comment">// DominatorTree::isReachableFromEntry(). In other words</span></div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;      <span class="comment">// removeUnreachableBlocks can remove some blocks for which</span></div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;      <span class="comment">// isReachableFromEntry() returns true.</span></div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DT.<a class="code" href="classllvm_1_1DominatorTree.html#a1a70f2c359aadd76a72aaaede16aca4a">isReachableFromEntry</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getParent()) &amp;&amp;</div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;            <span class="stringliteral">&quot;no unreachable blocks expected&quot;</span>);</div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;      ParsePointNeeded.push_back(cast&lt;CallBase&gt;(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;    }</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *CI = dyn_cast&lt;CallInst&gt;(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;      <span class="keywordflow">if</span> (CI-&gt;getIntrinsicID() == Intrinsic::experimental_gc_get_pointer_base ||</div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;          CI-&gt;getIntrinsicID() == Intrinsic::experimental_gc_get_pointer_offset)</div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;        Intrinsics.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>(CI);</div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;  }</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160; </div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;  <span class="comment">// Return early if no work to do.</span></div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;  <span class="keywordflow">if</span> (ParsePointNeeded.empty() &amp;&amp; Intrinsics.empty())</div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;    <span class="keywordflow">return</span> MadeChange;</div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160; </div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;  <span class="comment">// As a prepass, go ahead and aggressively destroy single entry phi nodes.</span></div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;  <span class="comment">// These are created by LCSSA.  They have the effect of increasing the size</span></div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;  <span class="comment">// of liveness sets for no good reason.  It may be harder to do this post</span></div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;  <span class="comment">// insertion since relocations and base phis can confuse things.</span></div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> &amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> : <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>.getUniquePredecessor())</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;      MadeChange |= <a class="code" href="namespacellvm.html#ab7e8be1d1ae7e526ea156b60c51c10e5">FoldSingleEntryPHINodes</a>(&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160; </div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;  <span class="comment">// Before we start introducing relocations, we want to tweak the IR a bit to</span></div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;  <span class="comment">// avoid unfortunate code generation effects.  The main example is that we</span></div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;  <span class="comment">// want to try to make sure the comparison feeding a branch is after any</span></div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;  <span class="comment">// safepoints.  Otherwise, we end up with a comparison of pre-relocation</span></div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;  <span class="comment">// values feeding a branch after relocation.  This is semantically correct,</span></div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;  <span class="comment">// but results in extra register pressure since both the pre-relocation and</span></div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;  <span class="comment">// post-relocation copies must be available in registers.  For code without</span></div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;  <span class="comment">// relocations this is handled elsewhere, but teaching the scheduler to</span></div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;  <span class="comment">// reverse the transform we&#39;re about to do would be slightly complex.</span></div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;  <span class="comment">// Note: This may extend the live range of the inputs to the icmp and thus</span></div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;  <span class="comment">// increase the liveset of any statepoint we move over.  This is profitable</span></div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;  <span class="comment">// as long as all statepoints are in rare blocks.  If we had in-register</span></div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;  <span class="comment">// lowering for live values this would be a much safer transform.</span></div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;  <span class="keyword">auto</span> getConditionInst = [](<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TI) -&gt; <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> * {</div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *BI = dyn_cast&lt;BranchInst&gt;(TI))</div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;      <span class="keywordflow">if</span> (BI-&gt;isConditional())</div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;        <span class="keywordflow">return</span> dyn_cast&lt;Instruction&gt;(BI-&gt;getCondition());</div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;    <span class="comment">// TODO: Extend this to handle switches</span></div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;  };</div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> &amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> : <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TI = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>.getTerminator();</div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a> = getConditionInst(TI))</div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;      <span class="comment">// TODO: Handle more than just ICmps here.  We should be able to move</span></div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;      <span class="comment">// most instructions without side effects or memory access.</span></div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;      <span class="keywordflow">if</span> (isa&lt;ICmpInst&gt;(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>) &amp;&amp; <a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>-&gt;hasOneUse()) {</div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;        MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;        <a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>-&gt;moveBefore(TI);</div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;      }</div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;  }</div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160; </div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;  <span class="comment">// Nasty workaround - The base computation code in the main algorithm doesn&#39;t</span></div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;  <span class="comment">// consider the fact that a GEP can be used to convert a scalar to a vector.</span></div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;  <span class="comment">// The right fix for this is to integrate GEPs into the base rewriting</span></div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;  <span class="comment">// algorithm properly, this is just a short term workaround to prevent</span></div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;  <span class="comment">// crashes by canonicalizing such GEPs into fully vector GEPs.</span></div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="namespacellvm.html#a7e3e687ddfdcbacd404bcf17b917dd88">instructions</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)) {</div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;    <span class="keywordflow">if</span> (!isa&lt;GetElementPtrInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160; </div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;    <span class="keywordtype">unsigned</span> VF = 0;</div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getNumOperands(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *OpndVTy = dyn_cast&lt;VectorType&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;getType())) {</div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VF == 0 ||</div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;               VF == cast&lt;FixedVectorType&gt;(OpndVTy)-&gt;getNumElements());</div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;        VF = cast&lt;FixedVectorType&gt;(OpndVTy)-&gt;getNumElements();</div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;      }</div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160; </div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;    <span class="comment">// It&#39;s the vector to scalar traversal through the pointer operand which</span></div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;    <span class="comment">// confuses base pointer rewriting, so limit ourselves to that case.</span></div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0)-&gt;getType()-&gt;isVectorTy() &amp;&amp; VF != 0) {</div>
<div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;      <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;      <span class="keyword">auto</span> *Splat = <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>.CreateVectorSplat(VF, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0));</div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.setOperand(0, Splat);</div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;      MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;    }</div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;  }</div>
<div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160; </div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;  <span class="comment">// Cache the &#39;defining value&#39; relation used in the computation and</span></div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;  <span class="comment">// insertion of base phis and selects.  This ensures that we don&#39;t insert</span></div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;  <span class="comment">// large numbers of duplicate base_phis. Use one cache for both</span></div>
<div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;  <span class="comment">// inlineGetBaseAndOffset() and insertParsePoints().</span></div>
<div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;  <a class="code" href="namespacefalse.html#a00af9f2347076bfb43b7d4e286feb576">DefiningValueMapTy</a> DVCache;</div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160; </div>
<div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;  <span class="comment">// Mapping between a base values and a flag indicating whether it&#39;s a known</span></div>
<div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;  <span class="comment">// base or not.</span></div>
<div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;  <a class="code" href="namespacefalse.html#a9f5b65a81eb5133d76ed041f31f7ceac">IsKnownBaseMapTy</a> KnownBases;</div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160; </div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;  <span class="keywordflow">if</span> (!Intrinsics.empty())</div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;    <span class="comment">// Inline @gc.get.pointer.base() and @gc.get.pointer.offset() before finding</span></div>
<div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;    <span class="comment">// live references.</span></div>
<div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;    MadeChange |= <a class="code" href="RewriteStatepointsForGC_8cpp.html#af001e6326d49bf139dfeee21772f01f0">inlineGetBaseAndOffset</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, Intrinsics, DVCache, KnownBases);</div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160; </div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;  <span class="keywordflow">if</span> (!ParsePointNeeded.empty())</div>
<div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;    MadeChange |=</div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;        <a class="code" href="RewriteStatepointsForGC_8cpp.html#a864a2ad11bbf83cf2b910e43d461cd02">insertParsePoints</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, DT, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, ParsePointNeeded, DVCache, KnownBases);</div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160; </div>
<div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div>
<div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;}</div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160; </div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;<span class="comment">// liveness computation via standard dataflow</span></div>
<div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;<span class="comment">// -------------------------------------------------------------------</span></div>
<div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160; </div>
<div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;<span class="comment">// TODO: Consider using bitvectors for liveness, the set of potentially</span></div>
<div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;<span class="comment">// interesting values should be small and easy to pre-compute.</span></div>
<div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;<span class="comment">/// Compute the live-in set for the location rbegin starting from</span></div>
<div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;<span class="comment">/// the live-out set of the basic block</span></div>
<div class="line"><a name="l03233"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a7db97c1724471a0bb5b2e24cc5153d9b"> 3233</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a9b5f57931ea7a3a623b6e8ac416177c1">computeLiveInValues</a>(<a class="code" href="classllvm_1_1BasicBlock.html#a6d3231fb84ed4182ec22e9442a87dbf8">BasicBlock::reverse_iterator</a> Begin,</div>
<div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;                                <a class="code" href="classllvm_1_1BasicBlock.html#a6d3231fb84ed4182ec22e9442a87dbf8">BasicBlock::reverse_iterator</a> End,</div>
<div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;                                <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;Value *&gt;</a> &amp;LiveTmp, <a class="code" href="classllvm_1_1GCStrategy.html">GCStrategy</a> *GC) {</div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="namespacellvm.html#ad1a91b49e0c092818a0b82f6cc130a1b">make_range</a>(Begin, End)) {</div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;    <span class="comment">// KILL/Def - Remove this definition from LiveIn</span></div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;    LiveTmp.<a class="code" href="classllvm_1_1SetVector.html#a6357ff5654c7cbe5fed8516dc8328eb4">remove</a>(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160; </div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;    <span class="comment">// Don&#39;t consider *uses* in PHI nodes, we handle their contribution to</span></div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;    <span class="comment">// predecessor blocks when we seed the LiveOut sets</span></div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;    <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160; </div>
<div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;    <span class="comment">// USE - Add to the LiveIn set for this instruction</span></div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.operands()) {</div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a class="code" href="RewriteStatepointsForGC_8cpp.html#aac0cb310804ea09b44a5d79f93319d42">isUnhandledGCPointerType</a>(V-&gt;getType(), GC) &amp;&amp;</div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;             <span class="stringliteral">&quot;support for FCA unimplemented&quot;</span>);</div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="RewriteStatepointsForGC_8cpp.html#aa24dcfb77b1890aaa6d1f687eeffe665">isHandledGCPointerType</a>(V-&gt;getType(), GC) &amp;&amp; !isa&lt;Constant&gt;(V)) {</div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;        <span class="comment">// The choice to exclude all things constant here is slightly subtle.</span></div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;        <span class="comment">// There are two independent reasons:</span></div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;        <span class="comment">// - We assume that things which are constant (from LLVM&#39;s definition)</span></div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;        <span class="comment">// do not move at runtime.  For example, the address of a global</span></div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;        <span class="comment">// variable is fixed, even though it&#39;s contents may not be.</span></div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;        <span class="comment">// - Second, we can&#39;t disallow arbitrary inttoptr constants even</span></div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;        <span class="comment">// if the language frontend does.  Optimization passes are free to</span></div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;        <span class="comment">// locally exploit facts without respect to global reachability.  This</span></div>
<div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;        <span class="comment">// can create sections of code which are dynamically unreachable and</span></div>
<div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;        <span class="comment">// contain just about anything.  (see constants.ll in tests)</span></div>
<div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;        LiveTmp.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(V);</div>
<div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;      }</div>
<div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;    }</div>
<div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;  }</div>
<div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;}</div>
<div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160; </div>
<div class="line"><a name="l03266"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a54a040cceb9c0ff9921d8eeec2966a55"> 3266</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a54a040cceb9c0ff9921d8eeec2966a55">computeLiveOutSeed</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;Value *&gt;</a> &amp;LiveTmp,</div>
<div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;                               <a class="code" href="classllvm_1_1GCStrategy.html">GCStrategy</a> *GC) {</div>
<div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ : <a class="code" href="namespacellvm.html#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)) {</div>
<div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : *Succ) {</div>
<div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;      <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = dyn_cast&lt;PHINode&gt;(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;      <span class="keywordflow">if</span> (!PN)</div>
<div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160; </div>
<div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#adfb61ffe25c950c75c86310245b3ef39">getIncomingValueForBlock</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a class="code" href="RewriteStatepointsForGC_8cpp.html#aac0cb310804ea09b44a5d79f93319d42">isUnhandledGCPointerType</a>(V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), GC) &amp;&amp;</div>
<div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;             <span class="stringliteral">&quot;support for FCA unimplemented&quot;</span>);</div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="RewriteStatepointsForGC_8cpp.html#aa24dcfb77b1890aaa6d1f687eeffe665">isHandledGCPointerType</a>(V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), GC) &amp;&amp; !isa&lt;Constant&gt;(V))</div>
<div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;        LiveTmp.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(V);</div>
<div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;    }</div>
<div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;  }</div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;}</div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160; </div>
<div class="line"><a name="l03283"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a40040abec5a5a5537a719bb14c60337e"> 3283</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;Value *&gt;</a> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a40040abec5a5a5537a719bb14c60337e">computeKillSet</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <a class="code" href="classllvm_1_1GCStrategy.html">GCStrategy</a> *GC) {</div>
<div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;  <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;Value *&gt;</a> KillSet;</div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="RewriteStatepointsForGC_8cpp.html#aa24dcfb77b1890aaa6d1f687eeffe665">isHandledGCPointerType</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType(), GC))</div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;      KillSet.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;  <span class="keywordflow">return</span> KillSet;</div>
<div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;}</div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160; </div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;<span class="comment">/// Check that the items in &#39;Live&#39; dominate &#39;TI&#39;.  This is used as a basic</span></div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;<span class="comment"></span><span class="comment">/// validation check for the liveness computation.</span></div>
<div class="line"><a name="l03294"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#ad1f0acfffdda650ed4ceb4d4622c1248"> 3294</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#ad1f0acfffdda650ed4ceb4d4622c1248">checkBasicSSA</a>(<a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;DT, <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;Value *&gt;</a> &amp;Live,</div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;                          <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TI, <span class="keywordtype">bool</span> TermOkay = <span class="keyword">false</span>) {</div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : Live) {</div>
<div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V)) {</div>
<div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;      <span class="comment">// The terminator can be a member of the LiveOut set.  LLVM&#39;s definition</span></div>
<div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;      <span class="comment">// of instruction dominance states that V does not dominate itself.  As</span></div>
<div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;      <span class="comment">// such, we need to special case this to allow it.</span></div>
<div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;      <span class="keywordflow">if</span> (TermOkay &amp;&amp; TI == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DT.<a class="code" href="classllvm_1_1DominatorTree.html#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, TI) &amp;&amp;</div>
<div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;             <span class="stringliteral">&quot;basic SSA liveness expectation violated by liveness analysis&quot;</span>);</div>
<div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;    }</div>
<div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;  }</div>
<div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;}</div>
<div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;<span class="comment">/// Check that all the liveness sets used during the computation of liveness</span></div>
<div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;<span class="comment">/// obey basic SSA properties.  This is useful for finding cases where we miss</span></div>
<div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;<span class="comment">/// a def.</span></div>
<div class="line"><a name="l03312"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a116214243278440ab010746880a8e6e5"> 3312</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#ad1f0acfffdda650ed4ceb4d4622c1248">checkBasicSSA</a>(<a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;DT, GCPtrLivenessData &amp;<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>,</div>
<div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;                          <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> &amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;  <a class="code" href="RewriteStatepointsForGC_8cpp.html#ad1f0acfffdda650ed4ceb4d4622c1248">checkBasicSSA</a>(DT, <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.LiveSet[&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>], <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>.getTerminator());</div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;  <a class="code" href="RewriteStatepointsForGC_8cpp.html#ad1f0acfffdda650ed4ceb4d4622c1248">checkBasicSSA</a>(DT, <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.LiveOut[&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>], <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>.getTerminator(), <span class="keyword">true</span>);</div>
<div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;  <a class="code" href="RewriteStatepointsForGC_8cpp.html#ad1f0acfffdda650ed4ceb4d4622c1248">checkBasicSSA</a>(DT, <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.LiveIn[&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>], <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>.getTerminator());</div>
<div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;}</div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160; </div>
<div class="line"><a name="l03320"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a9b5f57931ea7a3a623b6e8ac416177c1"> 3320</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a9b5f57931ea7a3a623b6e8ac416177c1">computeLiveInValues</a>(<a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;DT, <a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</div>
<div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;                                GCPtrLivenessData &amp;<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>, <a class="code" href="classllvm_1_1GCStrategy.html">GCStrategy</a> *GC) {</div>
<div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;  <a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;BasicBlock *, 32&gt;</a> Worklist;</div>
<div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160; </div>
<div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;  <span class="comment">// Seed the liveness for each individual block</span></div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> &amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> : <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;    <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.KillSet[&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>] = <a class="code" href="RewriteStatepointsForGC_8cpp.html#a40040abec5a5a5537a719bb14c60337e">computeKillSet</a>(&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, GC);</div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;    <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.LiveSet[&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>].clear();</div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#a9b5f57931ea7a3a623b6e8ac416177c1">computeLiveInValues</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>.rbegin(), <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>.rend(), <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.LiveSet[&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>], GC);</div>
<div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160; </div>
<div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1RegState.html#aef4cc0c855dc833e2a9d58a50703320da9ddde91ef09476d28a088fe57f8e2921">Kill</a> : <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.KillSet[&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>])</div>
<div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.LiveSet[&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>].count(<a class="code" href="namespacellvm_1_1RegState.html#aef4cc0c855dc833e2a9d58a50703320da9ddde91ef09476d28a088fe57f8e2921">Kill</a>) &amp;&amp; <span class="stringliteral">&quot;live set contains kill&quot;</span>);</div>
<div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160; </div>
<div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;    <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.LiveOut[&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>] = <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;Value *&gt;</a>();</div>
<div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#a54a040cceb9c0ff9921d8eeec2966a55">computeLiveOutSeed</a>(&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.LiveOut[&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>], GC);</div>
<div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;    <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.LiveIn[&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>] = <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.LiveSet[&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>];</div>
<div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;    <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.LiveIn[&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>].set_union(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.LiveOut[&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>]);</div>
<div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;    <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.LiveIn[&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>].set_subtract(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.KillSet[&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>]);</div>
<div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.LiveIn[&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>].empty())</div>
<div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;      Worklist.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(<a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>), <a class="code" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>(&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>));</div>
<div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;  }</div>
<div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160; </div>
<div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;  <span class="comment">// Propagate that liveness until stable</span></div>
<div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;  <span class="keywordflow">while</span> (!Worklist.<a class="code" href="classllvm_1_1SetVector.html#aaf9ee38b9973681c1720aaf03af3a069">empty</a>()) {</div>
<div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = Worklist.<a class="code" href="classllvm_1_1SetVector.html#a3499f6a24500afba2c318295ad2d2d05">pop_back_val</a>();</div>
<div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160; </div>
<div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;    <span class="comment">// Compute our new liveout set, then exit early if it hasn&#39;t changed despite</span></div>
<div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;    <span class="comment">// the contribution of our successor.</span></div>
<div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;    <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;Value *&gt;</a> LiveOut = <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.LiveOut[<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>];</div>
<div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> OldLiveOutSize = LiveOut.<a class="code" href="classllvm_1_1SetVector.html#a18b9d328d2490f447589ba60345eba6e">size</a>();</div>
<div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ : <a class="code" href="namespacellvm.html#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)) {</div>
<div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.LiveIn.count(Succ));</div>
<div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;      LiveOut.<a class="code" href="classllvm_1_1SetVector.html#aab7c4f6a6bb1a55a419befdf7895c9da">set_union</a>(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.LiveIn[Succ]);</div>
<div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;    }</div>
<div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;    <span class="comment">// assert OutLiveOut is a subset of LiveOut</span></div>
<div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;    <span class="keywordflow">if</span> (OldLiveOutSize == LiveOut.<a class="code" href="classllvm_1_1SetVector.html#a18b9d328d2490f447589ba60345eba6e">size</a>()) {</div>
<div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;      <span class="comment">// If the sets are the same size, then we didn&#39;t actually add anything</span></div>
<div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;      <span class="comment">// when unioning our successors LiveIn.  Thus, the LiveIn of this block</span></div>
<div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;      <span class="comment">// hasn&#39;t changed.</span></div>
<div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;    }</div>
<div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;    <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.LiveOut[<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>] = LiveOut;</div>
<div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160; </div>
<div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;    <span class="comment">// Apply the effects of this basic block</span></div>
<div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;    <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;Value *&gt;</a> LiveTmp = LiveOut;</div>
<div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;    LiveTmp.<a class="code" href="classllvm_1_1SetVector.html#aab7c4f6a6bb1a55a419befdf7895c9da">set_union</a>(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.LiveSet[<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>]);</div>
<div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;    LiveTmp.<a class="code" href="classllvm_1_1SetVector.html#afb844e6f81cb0ca752888e80798976ec">set_subtract</a>(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.KillSet[<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>]);</div>
<div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160; </div>
<div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.LiveIn.count(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>));</div>
<div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;Value *&gt;</a> &amp;OldLiveIn = <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.LiveIn[<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>];</div>
<div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;    <span class="comment">// assert: OldLiveIn is a subset of LiveTmp</span></div>
<div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;    <span class="keywordflow">if</span> (OldLiveIn.<a class="code" href="classllvm_1_1SetVector.html#a18b9d328d2490f447589ba60345eba6e">size</a>() != LiveTmp.<a class="code" href="classllvm_1_1SetVector.html#a18b9d328d2490f447589ba60345eba6e">size</a>()) {</div>
<div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;      <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.LiveIn[<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>] = LiveTmp;</div>
<div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;      Worklist.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(<a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>), <a class="code" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>));</div>
<div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;    }</div>
<div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;  } <span class="comment">// while (!Worklist.empty())</span></div>
<div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160; </div>
<div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;  <span class="comment">// Verify our output against SSA properties.  This helps catch any</span></div>
<div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;  <span class="comment">// missing kills during the above iteration.</span></div>
<div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> &amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> : <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</div>
<div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;    <a class="code" href="RewriteStatepointsForGC_8cpp.html#ad1f0acfffdda650ed4ceb4d4622c1248">checkBasicSSA</a>(DT, <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;}</div>
<div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160; </div>
<div class="line"><a name="l03387"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#a990710c9124f4c4183d029f678f8c13b"> 3387</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#a990710c9124f4c4183d029f678f8c13b">findLiveSetAtInst</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst, GCPtrLivenessData &amp;<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>,</div>
<div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;                              <a class="code" href="namespacefalse.html#afaa1384eeb44548e3d6b1324ebc65c3c">StatepointLiveSetTy</a> &amp;Out, <a class="code" href="classllvm_1_1GCStrategy.html">GCStrategy</a> *GC) {</div>
<div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160; </div>
<div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;  <span class="comment">// Note: The copy is intentional and required</span></div>
<div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.LiveOut.count(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>));</div>
<div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;  <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;Value *&gt;</a> LiveOut = <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.LiveOut[<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>];</div>
<div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160; </div>
<div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;  <span class="comment">// We want to handle the statepoint itself oddly.  It&#39;s</span></div>
<div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;  <span class="comment">// call result is not live (normal), nor are it&#39;s arguments</span></div>
<div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;  <span class="comment">// (unless they&#39;re used again later).  This adjustment is</span></div>
<div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;  <span class="comment">// specifically what we need to relocate</span></div>
<div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;  <a class="code" href="RewriteStatepointsForGC_8cpp.html#a9b5f57931ea7a3a623b6e8ac416177c1">computeLiveInValues</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;rbegin(), ++Inst-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>().<a class="code" href="classllvm_1_1ilist__iterator.html#a78fdbf2880abbb855abdb5bf030d9105">getReverse</a>(), LiveOut,</div>
<div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;                      GC);</div>
<div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;  LiveOut.<a class="code" href="classllvm_1_1SetVector.html#a6357ff5654c7cbe5fed8516dc8328eb4">remove</a>(Inst);</div>
<div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;  Out.insert(LiveOut.<a class="code" href="classllvm_1_1SetVector.html#adb13793b98ab59209a5309d26f831850">begin</a>(), LiveOut.<a class="code" href="classllvm_1_1SetVector.html#affac0dc3d407ef3dee29b8bc9a4836bc">end</a>());</div>
<div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;}</div>
<div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160; </div>
<div class="line"><a name="l03405"></a><span class="lineno"><a class="line" href="RewriteStatepointsForGC_8cpp.html#af864550d3c61aff5c6777610fdba8b7f"> 3405</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="RewriteStatepointsForGC_8cpp.html#af864550d3c61aff5c6777610fdba8b7f">recomputeLiveInValues</a>(GCPtrLivenessData &amp;RevisedLivenessData,</div>
<div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;                                  <a class="code" href="classllvm_1_1CallBase.html">CallBase</a> *<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a>,</div>
<div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;                                  PartiallyConstructedSafepointRecord &amp;<a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>,</div>
<div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;                                  <a class="code" href="namespacefalse.html#abbdd09796205857296660052b67cc167">PointerToBaseTy</a> &amp;PointerToBase,</div>
<div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;                                  <a class="code" href="classllvm_1_1GCStrategy.html">GCStrategy</a> *GC) {</div>
<div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;  <a class="code" href="namespacefalse.html#afaa1384eeb44548e3d6b1324ebc65c3c">StatepointLiveSetTy</a> Updated;</div>
<div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;  <a class="code" href="RewriteStatepointsForGC_8cpp.html#a990710c9124f4c4183d029f678f8c13b">findLiveSetAtInst</a>(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a>, RevisedLivenessData, Updated, GC);</div>
<div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160; </div>
<div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;  <span class="comment">// We may have base pointers which are now live that weren&#39;t before.  We need</span></div>
<div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;  <span class="comment">// to update the PointerToBase structure to reflect this.</span></div>
<div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *V : Updated)</div>
<div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;    PointerToBase.insert({ V, V });</div>
<div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160; </div>
<div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;  <a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.LiveSet = Updated;</div>
<div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_ae14867f68a4ddb46faa119f144edb974"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#ae14867f68a4ddb46faa119f144edb974">findBaseDefiningValueOfVector</a></div><div class="ttdeci">static Value * findBaseDefiningValueOfVector(Value *I, DefiningValueMapTy &amp;Cache, IsKnownBaseMapTy &amp;KnownBases)</div><div class="ttdoc">Return a base defining value for the 'Index' element of the given vector instruction 'I'.</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00424">RewriteStatepointsForGC.cpp:424</a></div></div>
<div class="ttc" id="alib_2Target_2README_8txt_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2README_8txt_source.html#l00029">README.txt:29</a></div></div>
<div class="ttc" id="aclassllvm_1_1InstructionCost_html"><div class="ttname"><a href="classllvm_1_1InstructionCost.html">llvm::InstructionCost</a></div><div class="ttdef"><b>Definition:</b> <a href="InstructionCost_8h_source.html#l00029">InstructionCost.h:29</a></div></div>
<div class="ttc" id="aclassllvm_1_1PreservedAnalyses_html"><div class="ttname"><a href="classllvm_1_1PreservedAnalyses.html">llvm::PreservedAnalyses</a></div><div class="ttdoc">A set of analyses that are preserved following a run of a transformation pass.</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00152">PassManager.h:152</a></div></div>
<div class="ttc" id="aclassllvm_1_1Argument_html"><div class="ttname"><a href="classllvm_1_1Argument.html">llvm::Argument</a></div><div class="ttdoc">This class represents an incoming formal argument to a Function.</div><div class="ttdef"><b>Definition:</b> <a href="Argument_8h_source.html#l00028">Argument.h:28</a></div></div>
<div class="ttc" id="astructfalse_1_1GCPtrLivenessData_html_a81725384795d316a7a2e379fa1b375bd"><div class="ttname"><a href="structfalse_1_1GCPtrLivenessData.html#a81725384795d316a7a2e379fa1b375bd">false::GCPtrLivenessData::LiveIn</a></div><div class="ttdeci">MapVector&lt; BasicBlock *, SetVector&lt; Value * &gt; &gt; LiveIn</div><div class="ttdoc">Values live into this basic block (i.e.</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00249">RewriteStatepointsForGC.cpp:249</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a3e3071be46334a57263e70548609d657"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a3e3071be46334a57263e70548609d657">insertRelocationStores</a></div><div class="ttdeci">static void insertRelocationStores(iterator_range&lt; Value::user_iterator &gt; GCRelocs, DenseMap&lt; Value *, AllocaInst * &gt; &amp;AllocaMap, DenseSet&lt; Value * &gt; &amp;VisitedLiveValues)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l01994">RewriteStatepointsForGC.cpp:1994</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a9d12b579baa093a4a9e2eb24c69b7129"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a9d12b579baa093a4a9e2eb24c69b7129">stripInvalidMetadataFromInstruction</a></div><div class="ttdeci">static void stripInvalidMetadataFromInstruction(Instruction &amp;I)</div><div class="ttdoc">Certain metadata on instructions are invalid after running RS4GC.</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l02961">RewriteStatepointsForGC.cpp:2961</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetIRAnalysis_html"><div class="ttname"><a href="classllvm_1_1TargetIRAnalysis.html">llvm::TargetIRAnalysis</a></div><div class="ttdoc">Analysis pass providing the TargetTransformInfo.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l02626">TargetTransformInfo.h:2626</a></div></div>
<div class="ttc" id="astructllvm_1_1StatepointDirectives_html_a2ede8b2894838fd273ba88088457af7e"><div class="ttname"><a href="structllvm_1_1StatepointDirectives.html#a2ede8b2894838fd273ba88088457af7e">llvm::StatepointDirectives::StatepointID</a></div><div class="ttdeci">std::optional&lt; uint64_t &gt; StatepointID</div><div class="ttdef"><b>Definition:</b> <a href="Statepoint_8h_source.html#l00237">Statepoint.h:237</a></div></div>
<div class="ttc" id="aCompiler_8h_html_aa863693eef567397d9c292da5bf22d34"><div class="ttname"><a href="Compiler_8h.html#aa863693eef567397d9c292da5bf22d34">LLVM_DUMP_METHOD</a></div><div class="ttdeci">#define LLVM_DUMP_METHOD</div><div class="ttdoc">Mark debug helper function definitions like dump() that should not be stripped from debug builds.</div><div class="ttdef"><b>Definition:</b> <a href="Compiler_8h_source.html#l00492">Compiler.h:492</a></div></div>
<div class="ttc" id="astructfalse_1_1PartiallyConstructedSafepointRecord_html_ac5b67707918609d196c7520002a71eb0"><div class="ttname"><a href="structfalse_1_1PartiallyConstructedSafepointRecord.html#ac5b67707918609d196c7520002a71eb0">false::PartiallyConstructedSafepointRecord::LiveSet</a></div><div class="ttdeci">StatepointLiveSetTy LiveSet</div><div class="ttdoc">The set of values known to be live across this safepoint.</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00275">RewriteStatepointsForGC.cpp:275</a></div></div>
<div class="ttc" id="anamespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">This is an optimization pass for GlobalISel generic memory operations.</div><div class="ttdef"><b>Definition:</b> <a href="AddressRanges_8h_source.html#l00018">AddressRanges.h:18</a></div></div>
<div class="ttc" id="anamespacellvm_1_1tgtok_html_abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a"><div class="ttname"><a href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">llvm::tgtok::Def</a></div><div class="ttdeci">@ Def</div><div class="ttdef"><b>Definition:</b> <a href="TGLexer_8h_source.html#l00050">TGLexer.h:50</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_afe0e06ec4e283d4cb809dd463e2e65e9"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#afe0e06ec4e283d4cb809dd463e2e65e9">ClobberNonLiveOverride</a></div><div class="ttdeci">static cl::opt&lt; bool, true &gt; ClobberNonLiveOverride(&quot;rs4gc-clobber-non-live&quot;, cl::location(ClobberNonLive), cl::Hidden)</div></div>
<div class="ttc" id="alib_2Target_2X86_2README_8txt_html_ac88fe1d3a61b056a4f64fbbb156a62ff"><div class="ttname"><a href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a></div><div class="ttdeci">We currently emits eax Perhaps this is what we really should generate is Is imull three or four cycles eax eax The current instruction priority is based on pattern complexity The former is more complex because it folds a load so the latter will not be emitted Perhaps we should use AddedComplexity to give LEA32r a higher priority We should always try to match LEA first since the LEA matching code does some estimate to determine whether the match is profitable if we care more about code then imull is better It s two bytes shorter than movl leal On a Pentium M</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2X86_2README_8txt_source.html#l00252">README.txt:252</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a4ba3a5be6c0e9b9e8a525de055836733"><div class="ttname"><a href="classllvm_1_1Instruction.html#a4ba3a5be6c0e9b9e8a525de055836733">llvm::Instruction::getModule</a></div><div class="ttdeci">const Module * getModule() const</div><div class="ttdoc">Return the module owning the function this instruction belongs to or nullptr it the function does not...</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00070">Instruction.cpp:70</a></div></div>
<div class="ttc" id="astructfalse_1_1GCPtrLivenessData_html"><div class="ttname"><a href="structfalse_1_1GCPtrLivenessData.html">false::GCPtrLivenessData</a></div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00239">RewriteStatepointsForGC.cpp:239</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a6b7912ea5edc4563fe03afc57fa9b0c6"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a6b7912ea5edc4563fe03afc57fa9b0c6">insertUseHolderAfter</a></div><div class="ttdeci">static void insertUseHolderAfter(CallBase *Call, const ArrayRef&lt; Value * &gt; Values, SmallVectorImpl&lt; CallInst * &gt; &amp;Holders)</div><div class="ttdoc">Insert holders so that each Value is obviously live through the entire lifetime of the call.</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l02258">RewriteStatepointsForGC.cpp:2258</a></div></div>
<div class="ttc" id="anamespacellvm_html_ad1a91b49e0c092818a0b82f6cc130a1b"><div class="ttname"><a href="namespacellvm.html#ad1a91b49e0c092818a0b82f6cc130a1b">llvm::make_range</a></div><div class="ttdeci">iterator_range&lt; T &gt; make_range(T x, T y)</div><div class="ttdoc">Convenience function for iterating over sub-ranges.</div><div class="ttdef"><b>Definition:</b> <a href="iterator__range_8h_source.html#l00053">iterator_range.h:53</a></div></div>
<div class="ttc" id="astructllvm_1_1RewriteStatepointsForGC_html_ad69716246dabb743839cafceb902ef46"><div class="ttname"><a href="structllvm_1_1RewriteStatepointsForGC.html#ad69716246dabb743839cafceb902ef46">llvm::RewriteStatepointsForGC::runOnFunction</a></div><div class="ttdeci">bool runOnFunction(Function &amp;F, DominatorTree &amp;, TargetTransformInfo &amp;, const TargetLibraryInfo &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l03071">RewriteStatepointsForGC.cpp:3071</a></div></div>
<div class="ttc" id="aclassllvm_1_1DataLayout_html"><div class="ttname"><a href="classllvm_1_1DataLayout.html">llvm::DataLayout</a></div><div class="ttdoc">A parsed version of the target data layout string in and methods for querying it.</div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00110">DataLayout.h:110</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AArch64PACKey_html_abf4394f452bde3f544999858d71e4b46"><div class="ttname"><a href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46">llvm::AArch64PACKey::ID</a></div><div class="ttdeci">ID</div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00790">AArch64BaseInfo.h:790</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a3a402430a1bbe70a9282dcb0e0b6a2cd"><div class="ttname"><a href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">llvm::Value::hasOneUse</a></div><div class="ttdeci">bool hasOneUse() const</div><div class="ttdoc">Return true if there is exactly one use of this value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00434">Value.h:434</a></div></div>
<div class="ttc" id="aMetadata_8h_html"><div class="ttname"><a href="Metadata_8h.html">Metadata.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a7fe9ccd4893f4e2caa826126c09545ea"><div class="ttname"><a href="classllvm_1_1Type.html#a7fe9ccd4893f4e2caa826126c09545ea">llvm::Type::getInt8PtrTy</a></div><div class="ttdeci">static PointerType * getInt8PtrTy(LLVMContext &amp;C, unsigned AS=0)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00293">Type.cpp:293</a></div></div>
<div class="ttc" id="aclassllvm_1_1GCStrategy_html"><div class="ttname"><a href="classllvm_1_1GCStrategy.html">llvm::GCStrategy</a></div><div class="ttdoc">GCStrategy describes a garbage collector algorithm's code generation requirements,...</div><div class="ttdef"><b>Definition:</b> <a href="GCStrategy_8h_source.html#l00063">GCStrategy.h:63</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a55412d2c237115c95f20e12ba0d95922"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a55412d2c237115c95f20e12ba0d95922">relocationViaAlloca</a></div><div class="ttdeci">static void relocationViaAlloca(Function &amp;F, DominatorTree &amp;DT, ArrayRef&lt; Value * &gt; Live, ArrayRef&lt; PartiallyConstructedSafepointRecord &gt; Records)</div><div class="ttdoc">Do all the relocation update via allocas and mem2reg.</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l02050">RewriteStatepointsForGC.cpp:2050</a></div></div>
<div class="ttc" id="aclassllvm_1_1ModulePass_html"><div class="ttname"><a href="classllvm_1_1ModulePass.html">llvm::ModulePass</a></div><div class="ttdoc">ModulePass class - This class is used to implement unstructured interprocedural optimizations and ana...</div><div class="ttdef"><b>Definition:</b> <a href="Pass_8h_source.html#l00248">Pass.h:248</a></div></div>
<div class="ttc" id="aIntrinsicInst_8h_html"><div class="ttname"><a href="IntrinsicInst_8h.html">IntrinsicInst.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisManager_html_ab9d3d5412c20747fd0110a046604f09a"><div class="ttname"><a href="classllvm_1_1AnalysisManager.html#ab9d3d5412c20747fd0110a046604f09a">llvm::AnalysisManager::getResult</a></div><div class="ttdeci">PassT::Result &amp; getResult(IRUnitT &amp;IR, ExtraArgTs... ExtraArgs)</div><div class="ttdoc">Get the result of an analysis pass for a given IR unit.</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00774">PassManager.h:774</a></div></div>
<div class="ttc" id="aTransforms_2Scalar_8h_html"><div class="ttname"><a href="Transforms_2Scalar_8h.html">Scalar.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_ac1eeead9c75f34e350b28aafb3122249"><div class="ttname"><a href="namespacellvm.html#ac1eeead9c75f34e350b28aafb3122249">llvm::initializeRewriteStatepointsForGCLegacyPassPass</a></div><div class="ttdeci">void initializeRewriteStatepointsForGCLegacyPassPass(PassRegistry &amp;)</div></div>
<div class="ttc" id="aInstIterator_8h_html"><div class="ttname"><a href="InstIterator_8h.html">InstIterator.h</a></div></div>
<div class="ttc" id="aclassT_html"><div class="ttname"><a href="classT.html">T</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a495b5fc8d39e47e06482653850d78986"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a495b5fc8d39e47e06482653850d78986">analyzeParsePointLiveness</a></div><div class="ttdeci">static void analyzeParsePointLiveness(DominatorTree &amp;DT, GCPtrLivenessData &amp;OriginalLivenessData, CallBase *Call, PartiallyConstructedSafepointRecord &amp;Result, GCStrategy *GC)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00386">RewriteStatepointsForGC.cpp:386</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a55b03f8424779067813a7747a82a0b45"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a55b03f8424779067813a7747a82a0b45">AreEquivalentPhiNodes</a></div><div class="ttdeci">static bool AreEquivalentPhiNodes(PHINode &amp;OrigRootPhi, PHINode &amp;AlternateRootPhi)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l02360">RewriteStatepointsForGC.cpp:2360</a></div></div>
<div class="ttc" id="aclassllvm_1_1Function_html"><div class="ttname"><a href="classllvm_1_1Function.html">llvm::Function</a></div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00059">Function.h:59</a></div></div>
<div class="ttc" id="anamespacellvm_1_1cl_html_aed47e4757f3240146f8ad40c2cdbf2d1"><div class="ttname"><a href="namespacellvm_1_1cl.html#aed47e4757f3240146f8ad40c2cdbf2d1">llvm::cl::location</a></div><div class="ttdeci">LocationClass&lt; Ty &gt; location(Ty &amp;L)</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00465">CommandLine.h:465</a></div></div>
<div class="ttc" id="aclassllvm_1_1Attribute_html"><div class="ttname"><a href="classllvm_1_1Attribute.html">llvm::Attribute</a></div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8h_source.html#l00067">Attributes.h:67</a></div></div>
<div class="ttc" id="anamespacellvm_html_af75ecbb2ce891821d146a047f17d4dd1"><div class="ttname"><a href="namespacellvm.html#af75ecbb2ce891821d146a047f17d4dd1">llvm::callsGCLeafFunction</a></div><div class="ttdeci">bool callsGCLeafFunction(const CallBase *Call, const TargetLibraryInfo &amp;TLI)</div><div class="ttdoc">Return true if this call calls a gc leaf function.</div><div class="ttdef"><b>Definition:</b> <a href="Transforms_2Utils_2Local_8cpp_source.html#l02889">Local.cpp:2889</a></div></div>
<div class="ttc" id="anamespacellvm_html_ac10d13c57a7adf4a1f140afd5321309bad55b30607c2a9a2616347d6edb789f6b"><div class="ttname"><a href="namespacellvm.html#ac10d13c57a7adf4a1f140afd5321309bad55b30607c2a9a2616347d6edb789f6b">llvm::PseudoProbeReservedId::Last</a></div><div class="ttdeci">@ Last</div></div>
<div class="ttc" id="aStringRef_8h_html"><div class="ttname"><a href="StringRef_8h.html">StringRef.h</a></div></div>
<div class="ttc" id="aREADME-SSE_8txt_html_a63d206a063eefcdf8c318ded97b65020"><div class="ttname"><a href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a></div><div class="ttdeci">This currently compiles esp xmm0 movsd esp eax eax esp ret We should use not the dag combiner This is because dagcombine2 needs to be able to see through the X86ISD::Wrapper which DAGCombine can t really do The code for turning x load into a single vector load is target independent and should be moved to the dag combiner The code for turning x load into a vector load can only handle a direct load from a global or a direct load from the stack It should be generalized to handle any load from P</div><div class="ttdef"><b>Definition:</b> <a href="README-SSE_8txt_source.html#l00411">README-SSE.txt:411</a></div></div>
<div class="ttc" id="aPass_8h_html"><div class="ttname"><a href="Pass_8h.html">Pass.h</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a50fac92017d0843263cc84ebc2d1ac45"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a50fac92017d0843263cc84ebc2d1ac45">legalizeCallAttributes</a></div><div class="ttdeci">static AttributeList legalizeCallAttributes(LLVMContext &amp;Ctx, AttributeList OrigAL, AttributeList StatepointAL)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l01498">RewriteStatepointsForGC.cpp:1498</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html_a18b9d328d2490f447589ba60345eba6e"><div class="ttname"><a href="classllvm_1_1SetVector.html#a18b9d328d2490f447589ba60345eba6e">llvm::SetVector::size</a></div><div class="ttdeci">size_type size() const</div><div class="ttdoc">Determine the number of elements in the SetVector.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00077">SetVector.h:77</a></div></div>
<div class="ttc" id="aclassllvm_1_1BitCastInst_html"><div class="ttname"><a href="classllvm_1_1BitCastInst.html">llvm::BitCastInst</a></div><div class="ttdoc">This class represents a no-op cast from one type to another.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l05258">Instructions.h:5258</a></div></div>
<div class="ttc" id="aclassllvm_1_1AttributeList_html_a5d7d1a9d74e14b7535745a80fbc51f70"><div class="ttname"><a href="classllvm_1_1AttributeList.html#a5d7d1a9d74e14b7535745a80fbc51f70">llvm::AttributeList::addFnAttributes</a></div><div class="ttdeci">AttributeList addFnAttributes(LLVMContext &amp;C, const AttrBuilder &amp;B) const</div><div class="ttdoc">Add function attribute to the list.</div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8h_source.html#l00541">Attributes.h:541</a></div></div>
<div class="ttc" id="anamespacellvm_html_a26e2a938b431eaa6eca2beaa96410c9d"><div class="ttname"><a href="namespacellvm.html#a26e2a938b431eaa6eca2beaa96410c9d">llvm::successors</a></div><div class="ttdeci">auto successors(const MachineBasicBlock *BB)</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l01265">MachineBasicBlock.h:1265</a></div></div>
<div class="ttc" id="astructllvm_1_1RewriteStatepointsForGC_html"><div class="ttname"><a href="structllvm_1_1RewriteStatepointsForGC.html">llvm::RewriteStatepointsForGC</a></div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8h_source.html#l00029">RewriteStatepointsForGC.h:29</a></div></div>
<div class="ttc" id="aclassllvm_1_1ilist__node__with__parent_html_a26708685cc8b94fe3d7092ee080dbb34"><div class="ttname"><a href="classllvm_1_1ilist__node__with__parent.html#a26708685cc8b94fe3d7092ee080dbb34">llvm::ilist_node_with_parent::getNextNode</a></div><div class="ttdeci">NodeTy * getNextNode()</div><div class="ttdoc">Get the next node, or nullptr for the list tail.</div><div class="ttdef"><b>Definition:</b> <a href="ilist__node_8h_source.html#l00289">ilist_node.h:289</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a246f298958a4a730bf7d3a64440dd47b"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a246f298958a4a730bf7d3a64440dd47b">llvm::TargetTransformInfo::getAddressComputationCost</a></div><div class="ttdeci">InstructionCost getAddressComputationCost(Type *Ty, ScalarEvolution *SE=nullptr, const SCEV *Ptr=nullptr) const</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l01004">TargetTransformInfo.cpp:1004</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector&lt; Instruction *, 3 &gt;</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallInst_html_a68573712cd73746e416002907c9af79b"><div class="ttname"><a href="classllvm_1_1CallInst.html#a68573712cd73746e416002907c9af79b">llvm::CallInst::setTailCallKind</a></div><div class="ttdeci">void setTailCallKind(TailCallKind TCK)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01686">Instructions.h:1686</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_ad9d88ae321b98d8a3b7f394977ae6d7f"><div class="ttname"><a href="classllvm_1_1Value.html#ad9d88ae321b98d8a3b7f394977ae6d7f">llvm::Value::hasName</a></div><div class="ttdeci">bool hasName() const</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00261">Value.h:261</a></div></div>
<div class="ttc" id="aSupport_2ErrorHandling_8h_html"><div class="ttname"><a href="Support_2ErrorHandling_8h.html">ErrorHandling.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html">llvm::TargetTransformInfo</a></div><div class="ttdoc">This pass provides access to the codegen interfaces that are needed for IR-level transformations.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00196">TargetTransformInfo.h:196</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a5ab2d0b0f0b8ceec3b907184e7567197"><div class="ttname"><a href="classllvm_1_1Type.html#a5ab2d0b0f0b8ceec3b907184e7567197">llvm::Type::getPointerAddressSpace</a></div><div class="ttdeci">unsigned getPointerAddressSpace() const</div><div class="ttdoc">Get the address space of this pointer or pointer vector type.</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00729">DerivedTypes.h:729</a></div></div>
<div class="ttc" id="aARMLowOverheadLoops_8cpp_html_a3bf42baf773b375802538951c88d8e12"><div class="ttname"><a href="ARMLowOverheadLoops_8cpp.html#a3bf42baf773b375802538951c88d8e12">ToRemove</a></div><div class="ttdeci">ReachingDefAnalysis InstSet &amp; ToRemove</div><div class="ttdef"><b>Definition:</b> <a href="ARMLowOverheadLoops_8cpp_source.html#l00547">ARMLowOverheadLoops.cpp:547</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_aba191a63377d6bc21b701c484af2a82c"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#aba191a63377d6bc21b701c484af2a82c">isOriginalBaseResult</a></div><div class="ttdeci">static bool isOriginalBaseResult(Value *V)</div><div class="ttdoc">This value is a base pointer that is not generated by RS4GC, i.e.</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00728">RewriteStatepointsForGC.cpp:728</a></div></div>
<div class="ttc" id="aclassllvm_1_1IRBuilder_html"><div class="ttname"><a href="classllvm_1_1IRBuilder.html">llvm::IRBuilder&lt;&gt;</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a990710c9124f4c4183d029f678f8c13b"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a990710c9124f4c4183d029f678f8c13b">findLiveSetAtInst</a></div><div class="ttdeci">static void findLiveSetAtInst(Instruction *inst, GCPtrLivenessData &amp;Data, StatepointLiveSetTy &amp;out, GCStrategy *GC)</div><div class="ttdoc">Given results from the dataflow liveness computation, find the set of live Values at a particular ins...</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l03387">RewriteStatepointsForGC.cpp:3387</a></div></div>
<div class="ttc" id="aMapVector_8h_html"><div class="ttname"><a href="MapVector_8h.html">MapVector.h</a></div></div>
<div class="ttc" id="aDomTreeUpdater_8h_html"><div class="ttname"><a href="DomTreeUpdater_8h.html">DomTreeUpdater.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_ac9a7de5a04920954ac964059cfc428ad"><div class="ttname"><a href="namespacellvm.html#ac9a7de5a04920954ac964059cfc428ad">llvm::erase_if</a></div><div class="ttdeci">void erase_if(Container &amp;C, UnaryPredicate P)</div><div class="ttdoc">Provide a container algorithm similar to C++ Library Fundamentals v2's erase_if which is equivalent t...</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01998">STLExtras.h:1998</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallDenseMap_html"><div class="ttname"><a href="classllvm_1_1SmallDenseMap.html">llvm::SmallDenseMap</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00880">DenseMap.h:880</a></div></div>
<div class="ttc" id="aclassllvm_1_1FunctionType_html_a7e89b55242c964ae61b7850e99cacef0"><div class="ttname"><a href="classllvm_1_1FunctionType.html#a7e89b55242c964ae61b7850e99cacef0">llvm::FunctionType::get</a></div><div class="ttdeci">static FunctionType * get(Type *Result, ArrayRef&lt; Type * &gt; Params, bool isVarArg)</div><div class="ttdoc">This static method is the primary way of constructing a FunctionType.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00363">Type.cpp:363</a></div></div>
<div class="ttc" id="aTransforms_2Utils_2Local_8h_html"><div class="ttname"><a href="Transforms_2Utils_2Local_8h.html">Local.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1AttributeList_html_a5cc6492c8f2e06a8bae9dc0d121fab9f"><div class="ttname"><a href="classllvm_1_1AttributeList.html#a5cc6492c8f2e06a8bae9dc0d121fab9f">llvm::AttributeList::get</a></div><div class="ttdeci">static AttributeList get(LLVMContext &amp;C, ArrayRef&lt; std::pair&lt; unsigned, Attribute &gt;&gt; Attrs)</div><div class="ttdoc">Create an AttributeList with the specified parameters in it.</div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8cpp_source.html#l01132">Attributes.cpp:1132</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a482498a1c760122fd33c7fc8190dd277"><div class="ttname"><a href="classllvm_1_1Instruction.html#a482498a1c760122fd33c7fc8190dd277">llvm::Instruction::insertBefore</a></div><div class="ttdeci">void insertBefore(Instruction *InsertPos)</div><div class="ttdoc">Insert an unlinked instruction into a basic block immediately before the specified instruction.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00088">Instruction.cpp:88</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a35f66218c3cefa695f682f1b0a1d316b"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a35f66218c3cefa695f682f1b0a1d316b">isKnownBase</a></div><div class="ttdeci">static bool isKnownBase(Value *V, const IsKnownBaseMapTy &amp;KnownBases)</div><div class="ttdoc">Returns true if V is a known base.</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00736">RewriteStatepointsForGC.cpp:736</a></div></div>
<div class="ttc" id="aclassllvm_1_1DominatorTree_html"><div class="ttname"><a href="classllvm_1_1DominatorTree.html">llvm::DominatorTree</a></div><div class="ttdoc">Concrete subclass of DominatorTreeBase that is used to compute a normal dominator tree.</div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00166">Dominators.h:166</a></div></div>
<div class="ttc" id="aPassBuilderBindings_8cpp_html_a83c7e5ca51099e4efa895791a02fb0ed"><div class="ttname"><a href="PassBuilderBindings_8cpp.html#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a></div><div class="ttdeci">FunctionAnalysisManager FAM</div><div class="ttdef"><b>Definition:</b> <a href="PassBuilderBindings_8cpp_source.html#l00059">PassBuilderBindings.cpp:59</a></div></div>
<div class="ttc" id="anamespacellvm_1_1cl_html_a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6"><div class="ttname"><a href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">llvm::cl::Hidden</a></div><div class="ttdeci">@ Hidden</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00138">CommandLine.h:138</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a406e7b8519deb844fdccfc38a9cc5db2"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a406e7b8519deb844fdccfc38a9cc5db2">containsGCPtrType</a></div><div class="ttdeci">static bool containsGCPtrType(Type *Ty, GCStrategy *GC)</div><div class="ttdoc">Returns true if this type contains a gc pointer whether we know how to handle that type or not.</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00354">RewriteStatepointsForGC.cpp:354</a></div></div>
<div class="ttc" id="aclassllvm_1_1ExtractElementInst_html_a5d496a334eff64bb2873339b54df932a"><div class="ttname"><a href="classllvm_1_1ExtractElementInst.html#a5d496a334eff64bb2873339b54df932a">llvm::ExtractElementInst::Create</a></div><div class="ttdeci">static ExtractElementInst * Create(Value *Vec, Value *Idx, const Twine &amp;NameStr=&quot;&quot;, Instruction *InsertBefore=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01894">Instructions.h:1894</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html"><div class="ttname"><a href="classllvm_1_1Type.html">llvm::Type</a></div><div class="ttdoc">The instances of the Type class are immutable: once they are created, they are never changed.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00045">Type.h:45</a></div></div>
<div class="ttc" id="aDenseMap_8h_html"><div class="ttname"><a href="DenseMap_8h.html">DenseMap.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_aec88b7682025edff7984c3b6c8da8ac9"><div class="ttname"><a href="namespacellvm.html#aec88b7682025edff7984c3b6c8da8ac9">llvm::removeUnreachableBlocks</a></div><div class="ttdeci">bool removeUnreachableBlocks(Function &amp;F, DomTreeUpdater *DTU=nullptr, MemorySSAUpdater *MSSAU=nullptr)</div><div class="ttdoc">Remove all blocks that can not be reached from the function's entry.</div><div class="ttdef"><b>Definition:</b> <a href="Transforms_2Utils_2Local_8cpp_source.html#l02614">Local.cpp:2614</a></div></div>
<div class="ttc" id="aModule_8h_html"><div class="ttname"><a href="Module_8h.html">Module.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1AttributeList_html"><div class="ttname"><a href="classllvm_1_1AttributeList.html">llvm::AttributeList</a></div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8h_source.html#l00432">Attributes.h:432</a></div></div>
<div class="ttc" id="aclassllvm_1_1AttributeMask_html"><div class="ttname"><a href="classllvm_1_1AttributeMask.html">llvm::AttributeMask</a></div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8h_source.html#l00979">Attributes.h:979</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_ae0c55761fce39dd71617690b04385193"><div class="ttname"><a href="classllvm_1_1CallBase.html#ae0c55761fce39dd71617690b04385193">llvm::CallBase::getAttributes</a></div><div class="ttdeci">AttributeList getAttributes() const</div><div class="ttdoc">Return the parameter attributes for this call.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01484">InstrTypes.h:1484</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a97d7bb2d0dc7b8e471e481ef8e4d3986"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a97d7bb2d0dc7b8e471e481ef8e4d3986">stripNonValidAttributesFromPrototype</a></div><div class="ttdeci">static void stripNonValidAttributesFromPrototype(Function &amp;F)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l02933">RewriteStatepointsForGC.cpp:2933</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallSet_html"><div class="ttname"><a href="classllvm_1_1SmallSet.html">llvm::SmallSet</a></div><div class="ttdoc">SmallSet - This maintains a set of unique values, optimizing for the case when the set is small (less...</div><div class="ttdef"><b>Definition:</b> <a href="SmallSet_8h_source.html#l00135">SmallSet.h:135</a></div></div>
<div class="ttc" id="aclassllvm_1_1AttributeList_html_a1cf553641e8527095ae4c8ec88a2cd92"><div class="ttname"><a href="classllvm_1_1AttributeList.html#a1cf553641e8527095ae4c8ec88a2cd92">llvm::AttributeList::getFnAttrs</a></div><div class="ttdeci">AttributeSet getFnAttrs() const</div><div class="ttdoc">The function attributes are returned.</div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8cpp_source.html#l01462">Attributes.cpp:1462</a></div></div>
<div class="ttc" id="astructfalse_1_1PartiallyConstructedSafepointRecord_html_a18be5ba1ab66d93f64d7bca9969d3b4d"><div class="ttname"><a href="structfalse_1_1PartiallyConstructedSafepointRecord.html#a18be5ba1ab66d93f64d7bca9969d3b4d">false::PartiallyConstructedSafepointRecord::UnwindToken</a></div><div class="ttdeci">Instruction * UnwindToken</div><div class="ttdoc">Instruction to which exceptional gc relocates are attached Makes it easier to iterate through them du...</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00283">RewriteStatepointsForGC.cpp:283</a></div></div>
<div class="ttc" id="anamespacellvm_html_a2f883c895f4d244f4ed56ed8a8c160c1"><div class="ttname"><a href="namespacellvm.html#a2f883c895f4d244f4ed56ed8a8c160c1">llvm::operator!=</a></div><div class="ttdeci">bool operator!=(uint64_t V1, const APInt &amp;V2)</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l02040">APInt.h:2040</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_aac0cb310804ea09b44a5d79f93319d42"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#aac0cb310804ea09b44a5d79f93319d42">isUnhandledGCPointerType</a></div><div class="ttdeci">static bool isUnhandledGCPointerType(Type *Ty, GCStrategy *GC)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00370">RewriteStatepointsForGC.cpp:370</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a53408c95a7bfb5443b43fb2134c3eb23"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a53408c95a7bfb5443b43fb2134c3eb23">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::count</a></div><div class="ttdeci">size_type count(const_arg_type_t&lt; KeyT &gt; Val) const</div><div class="ttdoc">Return 1 if the specified key is in the map, 0 otherwise.</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00145">DenseMap.h:145</a></div></div>
<div class="ttc" id="aclassllvm_1_1MapVector_html"><div class="ttname"><a href="classllvm_1_1MapVector.html">llvm::MapVector</a></div><div class="ttdoc">This class implements a map that also provides access to all stored values in a deterministic order.</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00037">MapVector.h:37</a></div></div>
<div class="ttc" id="anamespacellvm_1_1Intrinsic_html_a89cda2218259523c41863fc1175d6907"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a89cda2218259523c41863fc1175d6907">llvm::Intrinsic::getAttributes</a></div><div class="ttdeci">AttributeList getAttributes(LLVMContext &amp;C, ID id)</div><div class="ttdoc">Return the attributes for an intrinsic.</div></div>
<div class="ttc" id="alib_2Target_2ARM_2README_8txt_html_af84fbbd129a1fbd3981dfbe6f607ddf4"><div class="ttname"><a href="lib_2Target_2ARM_2README_8txt.html#af84fbbd129a1fbd3981dfbe6f607ddf4">at</a></div><div class="ttdeci">compiles ldr LCPI1_0 ldr ldr mov lsr tst moveq r1 ldr LCPI1_1 and r0 bx lr It would be better to do something like to fold the shift into the conditional ldr LCPI1_0 ldr ldr tst movne lsr ldr LCPI1_1 and r0 bx lr it saves an instruction and a register It might be profitable to cse MOVi16 if there are lots of bit immediates with the same bottom half Robert Muth started working on an alternate jump table implementation that does not put the tables in line in the text This is more like the llvm default jump table implementation This might be useful sometime Several revisions of patches are on the mailing beginning at</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2ARM_2README_8txt_source.html#l00582">README.txt:582</a></div></div>
<div class="ttc" id="anamespacellvm_html_a1a4cac84457299517e69ff9764fed2db"><div class="ttname"><a href="namespacellvm.html#a1a4cac84457299517e69ff9764fed2db">llvm::PromoteMemToReg</a></div><div class="ttdeci">void PromoteMemToReg(ArrayRef&lt; AllocaInst * &gt; Allocas, DominatorTree &amp;DT, AssumptionCache *AC=nullptr)</div><div class="ttdoc">Promote the specified list of alloca instructions into scalar registers, inserting PHI nodes as appro...</div><div class="ttdef"><b>Definition:</b> <a href="PromoteMemoryToRegister_8cpp_source.html#l01102">PromoteMemoryToRegister.cpp:1102</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a158da2b6d3d938aaa15b6acd00150e2c"><div class="ttname"><a href="classllvm_1_1Value.html#a158da2b6d3d938aaa15b6acd00150e2c">llvm::Value::user_begin</a></div><div class="ttdeci">user_iterator user_begin()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00397">Value.h:397</a></div></div>
<div class="ttc" id="anamespacellvm_html_a9a7b5c68c90f85baaedaa854cc5002cc"><div class="ttname"><a href="namespacellvm.html#a9a7b5c68c90f85baaedaa854cc5002cc">llvm::errs</a></div><div class="ttdeci">raw_fd_ostream &amp; errs()</div><div class="ttdoc">This returns a reference to a raw_ostream for standard error.</div><div class="ttdef"><b>Definition:</b> <a href="raw__ostream_8cpp_source.html#l00899">raw_ostream.cpp:899</a></div></div>
<div class="ttc" id="anamespacellvm_1_1MipsISD_html_a422daf9aa810935178671306b651d69ba366e1eac31eeb1a1892d62ccfc0c8cf8"><div class="ttname"><a href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba366e1eac31eeb1a1892d62ccfc0c8cf8">llvm::MipsISD::Ret</a></div><div class="ttdeci">@ Ret</div><div class="ttdef"><b>Definition:</b> <a href="MipsISelLowering_8h_source.html#l00119">MipsISelLowering.h:119</a></div></div>
<div class="ttc" id="anamespacellvm_html_a03503773241005f01b090b9862aad304"><div class="ttname"><a href="namespacellvm.html#a03503773241005f01b090b9862aad304">llvm::dump</a></div><div class="ttdeci">void dump(const SparseBitVector&lt; ElementSize &gt; &amp;LHS, raw_ostream &amp;out)</div><div class="ttdef"><b>Definition:</b> <a href="SparseBitVector_8h_source.html#l00877">SparseBitVector.h:877</a></div></div>
<div class="ttc" id="aSTLExtras_8h_html"><div class="ttname"><a href="STLExtras_8h.html">STLExtras.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayType_html"><div class="ttname"><a href="classllvm_1_1ArrayType.html">llvm::ArrayType</a></div><div class="ttdoc">Class to represent array types.</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00357">DerivedTypes.h:357</a></div></div>
<div class="ttc" id="anamespacellvm_1_1dwarf_html_ac94a19fc8c57bf0350fc4e9f45897828"><div class="ttname"><a href="namespacellvm_1_1dwarf.html#ac94a19fc8c57bf0350fc4e9f45897828">llvm::dwarf::Tag</a></div><div class="ttdeci">Tag</div><div class="ttdef"><b>Definition:</b> <a href="Dwarf_8h_source.html#l00103">Dwarf.h:103</a></div></div>
<div class="ttc" id="aclassllvm_1_1detail_1_1DenseSetImpl_html_a79eed48913651aeedda2eed25201ea84"><div class="ttname"><a href="classllvm_1_1detail_1_1DenseSetImpl.html#a79eed48913651aeedda2eed25201ea84">llvm::detail::DenseSetImpl::insert</a></div><div class="ttdeci">std::pair&lt; iterator, bool &gt; insert(const ValueT &amp;V)</div><div class="ttdef"><b>Definition:</b> <a href="DenseSet_8h_source.html#l00206">DenseSet.h:206</a></div></div>
<div class="ttc" id="anamespacellvm_1_1SPII_html_a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f"><div class="ttname"><a href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">llvm::SPII::Load</a></div><div class="ttdeci">@ Load</div><div class="ttdef"><b>Definition:</b> <a href="SparcInstrInfo_8h_source.html#l00032">SparcInstrInfo.h:32</a></div></div>
<div class="ttc" id="aclassllvm_1_1detail_1_1DenseSetImpl_html_afe504aa31a6a354cec13f5b32d0b1d9d"><div class="ttname"><a href="classllvm_1_1detail_1_1DenseSetImpl.html#afe504aa31a6a354cec13f5b32d0b1d9d">llvm::detail::DenseSetImpl::count</a></div><div class="ttdeci">size_type count(const_arg_type_t&lt; ValueT &gt; V) const</div><div class="ttdoc">Return 1 if the specified key is in the set, 0 otherwise.</div><div class="ttdef"><b>Definition:</b> <a href="DenseSet_8h_source.html#l00097">DenseSet.h:97</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_a88cdefb709309eddc6e5daca0be6a7b4"><div class="ttname"><a href="classllvm_1_1PHINode.html#a88cdefb709309eddc6e5daca0be6a7b4">llvm::PHINode::setIncomingValue</a></div><div class="ttdeci">void setIncomingValue(unsigned i, Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02797">Instructions.h:2797</a></div></div>
<div class="ttc" id="anamespacellvm_html_ac214df91cdc242f4710ea5a93939c678"><div class="ttname"><a href="namespacellvm.html#ac214df91cdc242f4710ea5a93939c678">llvm::count_if</a></div><div class="ttdeci">auto count_if(R &amp;&amp;Range, UnaryPredicate P)</div><div class="ttdoc">Wrapper function around std::count_if to count the number of times an element satisfying a given pred...</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01903">STLExtras.h:1903</a></div></div>
<div class="ttc" id="anamespacellvm_html_ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d"><div class="ttname"><a href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">llvm::Data</a></div><div class="ttdeci">@ Data</div><div class="ttdef"><b>Definition:</b> <a href="SIMachineScheduler_8h_source.html#l00055">SIMachineScheduler.h:55</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html_ac835b8735b1b2faec0efdca236e37d94"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#ac835b8735b1b2faec0efdca236e37d94">llvm::ArrayRef::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdoc">empty - Check if the array is empty.</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00158">ArrayRef.h:158</a></div></div>
<div class="ttc" id="anamespacellvm_html_a91041531bb6b438d56bfb01919d8cd68"><div class="ttname"><a href="namespacellvm.html#a91041531bb6b438d56bfb01919d8cd68">llvm::createRewriteStatepointsForGCLegacyPass</a></div><div class="ttdeci">ModulePass * createRewriteStatepointsForGCLegacyPass()</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00224">RewriteStatepointsForGC.cpp:224</a></div></div>
<div class="ttc" id="aDebug_8h_html_a08efc68d15935eb8889400a46c3749ba"><div class="ttname"><a href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a></div><div class="ttdeci">#define LLVM_DEBUG(X)</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8h_source.html#l00101">Debug.h:101</a></div></div>
<div class="ttc" id="aclassllvm_1_1MDNode_html_a7d10a7b9b7f40b04d27ed97c38ea1950"><div class="ttname"><a href="classllvm_1_1MDNode.html#a7d10a7b9b7f40b04d27ed97c38ea1950">llvm::MDNode::get</a></div><div class="ttdeci">static MDTuple * get(LLVMContext &amp;Context, ArrayRef&lt; Metadata * &gt; MDs)</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8h_source.html#l01399">Metadata.h:1399</a></div></div>
<div class="ttc" id="aclassllvm_1_1AttrBuilder_html_aa63e528eeff5082f6920b10244143920"><div class="ttname"><a href="classllvm_1_1AttrBuilder.html#aa63e528eeff5082f6920b10244143920">llvm::AttrBuilder::removeAttribute</a></div><div class="ttdeci">AttrBuilder &amp; removeAttribute(Attribute::AttrKind Val)</div><div class="ttdoc">Remove an attribute from the builder.</div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8cpp_source.html#l01704">Attributes.cpp:1704</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_a96d73bbd7af15cb1fc38c3f4a3bd82e9"><div class="ttname"><a href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a></div><div class="ttdeci">#define F(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00055">MD5.cpp:55</a></div></div>
<div class="ttc" id="anamespacellvm_1_1RISCVFenceField_html_a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731"><div class="ttname"><a href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">llvm::RISCVFenceField::R</a></div><div class="ttdeci">@ R</div><div class="ttdef"><b>Definition:</b> <a href="RISCVBaseInfo_8h_source.html#l00278">RISCVBaseInfo.h:278</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a9247a212ea89acc9573fa7e7f557eaba"><div class="ttname"><a href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">llvm::Instruction::setMetadata</a></div><div class="ttdeci">void setMetadata(unsigned KindID, MDNode *Node)</div><div class="ttdoc">Set the metadata of the specified kind to the specified node.</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8cpp_source.html#l01455">Metadata.cpp:1455</a></div></div>
<div class="ttc" id="aclassllvm_1_1DomTreeUpdater_html_a8bf4c30be33831d7882d6880b8ae433da46a9ebdb80117bfa1f0cdea65438290a"><div class="ttname"><a href="classllvm_1_1DomTreeUpdater.html#a8bf4c30be33831d7882d6880b8ae433da46a9ebdb80117bfa1f0cdea65438290a">llvm::DomTreeUpdater::UpdateStrategy::Lazy</a></div><div class="ttdeci">@ Lazy</div></div>
<div class="ttc" id="aARMLowOverheadLoops_8cpp_html_a0a0971d62011c35b29ff4a2325d45e93"><div class="ttname"><a href="ARMLowOverheadLoops_8cpp.html#a0a0971d62011c35b29ff4a2325d45e93">Uses</a></div><div class="ttdeci">SmallPtrSet&lt; MachineInstr *, 2 &gt; Uses</div><div class="ttdef"><b>Definition:</b> <a href="ARMLowOverheadLoops_8cpp_source.html#l00590">ARMLowOverheadLoops.cpp:590</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html"><div class="ttname"><a href="classllvm_1_1BasicBlock.html">llvm::BasicBlock</a></div><div class="ttdoc">LLVM Basic Block Representation.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00055">BasicBlock.h:55</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_aaed6c13c4f5949ede0d5dd8182a09952"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#aaed6c13c4f5949ede0d5dd8182a09952">findRematerializableChainToBasePointer</a></div><div class="ttdeci">static Value * findRematerializableChainToBasePointer(SmallVectorImpl&lt; Instruction * &gt; &amp;ChainToBase, Value *CurrentValue)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l02301">RewriteStatepointsForGC.cpp:2301</a></div></div>
<div class="ttc" id="aREADME__P9_8txt_html_ae070adaf1b4bf0e7c12fcae2b9c5ae67"><div class="ttname"><a href="README__P9_8txt.html#ae070adaf1b4bf0e7c12fcae2b9c5ae67">result</a></div><div class="ttdeci">It looks like we only need to define PPCfmarto for these because according to these instructions perform RTO on fma s result</div><div class="ttdef"><b>Definition:</b> <a href="README__P9_8txt_source.html#l00256">README_P9.txt:256</a></div></div>
<div class="ttc" id="aNVVMIntrRange_8cpp_html_afad351d7bf10ac0446b64e7827634e94"><div class="ttname"><a href="NVVMIntrRange_8cpp.html#afad351d7bf10ac0446b64e7827634e94">Context</a></div><div class="ttdeci">LLVMContext &amp; Context</div><div class="ttdef"><b>Definition:</b> <a href="NVVMIntrRange_8cpp_source.html#l00066">NVVMIntrRange.cpp:66</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7c46c742c31be54870e2038048e6b391"><div class="ttname"><a href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">llvm::dbgs</a></div><div class="ttdeci">raw_ostream &amp; dbgs()</div><div class="ttdoc">dbgs() - This returns a reference to a raw_ostream for debugging messages.</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8cpp_source.html#l00163">Debug.cpp:163</a></div></div>
<div class="ttc" id="aclassllvm_1_1GCStatepointInst_html"><div class="ttname"><a href="classllvm_1_1GCStatepointInst.html">llvm::GCStatepointInst</a></div><div class="ttdoc">Represents a gc.statepoint intrinsic call.</div><div class="ttdef"><b>Definition:</b> <a href="Statepoint_8h_source.html#l00061">Statepoint.h:61</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_aa175634946d91981b87f76ed9a583f27"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#aa175634946d91981b87f76ed9a583f27">rematerializeLiveValuesAtUses</a></div><div class="ttdeci">static void rematerializeLiveValuesAtUses(RematCandTy &amp;RematerizationCandidates, MutableArrayRef&lt; PartiallyConstructedSafepointRecord &gt; Records, PointerToBaseTy &amp;PointerToBase)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l02450">RewriteStatepointsForGC.cpp:2450</a></div></div>
<div class="ttc" id="aclassllvm_1_1DominatorTree_html_a5c69311e8d44898dac36a155c3d8691d"><div class="ttname"><a href="classllvm_1_1DominatorTree.html#a5c69311e8d44898dac36a155c3d8691d">llvm::DominatorTree::dominates</a></div><div class="ttdeci">bool dominates(const BasicBlock *BB, const Use &amp;U) const</div><div class="ttdoc">Return true if the (end of the) basic block BB dominates the use U.</div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8cpp_source.html#l00122">Dominators.cpp:122</a></div></div>
<div class="ttc" id="astructfalse_1_1RematerizlizationCandidateRecord_html_a85ca3146236c8f6ba918f0ec93cf680e"><div class="ttname"><a href="structfalse_1_1RematerizlizationCandidateRecord.html#a85ca3146236c8f6ba918f0ec93cf680e">false::RematerizlizationCandidateRecord::ChainToBase</a></div><div class="ttdeci">SmallVector&lt; Instruction *, 3 &gt; ChainToBase</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00293">RewriteStatepointsForGC.cpp:293</a></div></div>
<div class="ttc" id="aAMDGPULibCalls_8cpp_html_afecf1cc1292b07f57d343c0f4d682044"><div class="ttname"><a href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a></div><div class="ttdeci">amdgpu Simplify well known AMD library false FunctionCallee Value * Arg</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPULibCalls_8cpp_source.html#l00187">AMDGPULibCalls.cpp:187</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a07a6eb3eef6937d9da40864010f07dbf"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a07a6eb3eef6937d9da40864010f07dbf">findRematerializationCandidates</a></div><div class="ttdeci">static void findRematerializationCandidates(PointerToBaseTy PointerToBase, RematCandTy &amp;RematerizationCandidates, TargetTransformInfo &amp;TTI)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l02389">RewriteStatepointsForGC.cpp:2389</a></div></div>
<div class="ttc" id="aIR_2Instruction_8h_html"><div class="ttname"><a href="IR_2Instruction_8h.html">Instruction.h</a></div></div>
<div class="ttc" id="aCommandLine_8h_html"><div class="ttname"><a href="CommandLine_8h.html">CommandLine.h</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_acad221a6df1d4872c6cca80bc913f7b7"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#acad221a6df1d4872c6cca80bc913f7b7">makeStatepointExplicit</a></div><div class="ttdeci">static void makeStatepointExplicit(DominatorTree &amp;DT, CallBase *Call, PartiallyConstructedSafepointRecord &amp;Result, std::vector&lt; DeferredReplacement &gt; &amp;Replacements, const PointerToBaseTy &amp;PointerToBase, GCStrategy *GC)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l01964">RewriteStatepointsForGC.cpp:1964</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html_a6357ff5654c7cbe5fed8516dc8328eb4"><div class="ttname"><a href="classllvm_1_1SetVector.html#a6357ff5654c7cbe5fed8516dc8328eb4">llvm::SetVector::remove</a></div><div class="ttdeci">bool remove(const value_type &amp;X)</div><div class="ttdoc">Remove an item from the set vector.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00157">SetVector.h:157</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html"><div class="ttname"><a href="classllvm_1_1ConstantInt.html">llvm::ConstantInt</a></div><div class="ttdoc">This is the shared class of boolean and integer constants.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00078">Constants.h:78</a></div></div>
<div class="ttc" id="astructfalse_1_1PartiallyConstructedSafepointRecord_html"><div class="ttname"><a href="structfalse_1_1PartiallyConstructedSafepointRecord.html">false::PartiallyConstructedSafepointRecord</a></div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00273">RewriteStatepointsForGC.cpp:273</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a19a380c6b55872909cc56792b8c98a77"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a19a380c6b55872909cc56792b8c98a77">findGCStrategy</a></div><div class="ttdeci">static std::unique_ptr&lt; GCStrategy &gt; findGCStrategy(Function &amp;F)</div><div class="ttdoc">Looks up the GC strategy for a given function, returning null if the function doesn't have a GC tag.</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l03039">RewriteStatepointsForGC.cpp:3039</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a096c8b641174dc0e486006926c5202cf"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a096c8b641174dc0e486006926c5202cf">llvm::TargetTransformInfo::getCastContextHint</a></div><div class="ttdeci">static CastContextHint getCastContextHint(const Instruction *I)</div><div class="ttdoc">Calculates a CastContextHint from I.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00826">TargetTransformInfo.cpp:826</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html_adb13793b98ab59209a5309d26f831850"><div class="ttname"><a href="classllvm_1_1SetVector.html#adb13793b98ab59209a5309d26f831850">llvm::SetVector::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdoc">Get an iterator to the beginning of the SetVector.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00082">SetVector.h:82</a></div></div>
<div class="ttc" id="aclassllvm_1_1PassRegistry_html_a05a729900b76c89e808c6c3094921b2f"><div class="ttname"><a href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">llvm::PassRegistry::getPassRegistry</a></div><div class="ttdeci">static PassRegistry * getPassRegistry()</div><div class="ttdoc">getPassRegistry - Access the global registry object, which is automatically initialized at applicatio...</div><div class="ttdef"><b>Definition:</b> <a href="PassRegistry_8cpp_source.html#l00024">PassRegistry.cpp:24</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a0650e5c5d027b7ef00c23a7921c114db"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a0650e5c5d027b7ef00c23a7921c114db">rematerializeLiveValues</a></div><div class="ttdeci">static void rematerializeLiveValues(CallBase *Call, PartiallyConstructedSafepointRecord &amp;Info, PointerToBaseTy &amp;PointerToBase, RematCandTy &amp;RematerizationCandidates, TargetTransformInfo &amp;TTI)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l02570">RewriteStatepointsForGC.cpp:2570</a></div></div>
<div class="ttc" id="aclassllvm_1_1MutableArrayRef_html"><div class="ttname"><a href="classllvm_1_1MutableArrayRef.html">llvm::MutableArrayRef</a></div><div class="ttdoc">MutableArrayRef - Represent a mutable reference to an array (0 or more elements consecutively in memo...</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00027">ArrayRef.h:27</a></div></div>
<div class="ttc" id="aConstants_8h_html"><div class="ttname"><a href="Constants_8h.html">Constants.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_a16c39eb6e60b42a40c399d8d65347bb6"><div class="ttname"><a href="classllvm_1_1PHINode.html#a16c39eb6e60b42a40c399d8d65347bb6">llvm::PHINode::getIncomingValue</a></div><div class="ttdeci">Value * getIncomingValue(unsigned i) const</div><div class="ttdoc">Return incoming value number x.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02794">Instructions.h:2794</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_aaa14b4fc802d9aa388b369deb1a1ef60"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#aaa14b4fc802d9aa388b369deb1a1ef60">chainToBasePointerCost</a></div><div class="ttdeci">static InstructionCost chainToBasePointerCost(SmallVectorImpl&lt; Instruction * &gt; &amp;Chain, TargetTransformInfo &amp;TTI)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l02327">RewriteStatepointsForGC.cpp:2327</a></div></div>
<div class="ttc" id="aclassllvm_1_1AllocaInst_html_a074617b3e2f9f98ee3a2ac208e8e7210"><div class="ttname"><a href="classllvm_1_1AllocaInst.html#a074617b3e2f9f98ee3a2ac208e8e7210">llvm::AllocaInst::getAllocatedType</a></div><div class="ttdeci">Type * getAllocatedType() const</div><div class="ttdoc">Return the type that is being allocated by the instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00118">Instructions.h:118</a></div></div>
<div class="ttc" id="aInlineOrder_8cpp_html_a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6"><div class="ttname"><a href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">InlinePriorityMode::Cost</a></div><div class="ttdeci">@ Cost</div></div>
<div class="ttc" id="astructfalse_1_1GCPtrLivenessData_html_a5d74d864b3841f6be01483a51cb555f2"><div class="ttname"><a href="structfalse_1_1GCPtrLivenessData.html#a5d74d864b3841f6be01483a51cb555f2">false::GCPtrLivenessData::KillSet</a></div><div class="ttdeci">MapVector&lt; BasicBlock *, SetVector&lt; Value * &gt; &gt; KillSet</div><div class="ttdoc">Values defined in this block.</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00241">RewriteStatepointsForGC.cpp:241</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a8b9e4ec572c189d8f8afc4f71da55a9c"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a8b9e4ec572c189d8f8afc4f71da55a9c">findBasePointers</a></div><div class="ttdeci">static void findBasePointers(const StatepointLiveSetTy &amp;live, PointerToBaseTy &amp;PointerToBase, DominatorTree *DT, DefiningValueMapTy &amp;DVCache, IsKnownBaseMapTy &amp;KnownBases)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l01347">RewriteStatepointsForGC.cpp:1347</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html"><div class="ttname"><a href="classllvm_1_1User.html">llvm::User</a></div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00044">User.h:44</a></div></div>
<div class="ttc" id="aIntrinsics_8h_html"><div class="ttname"><a href="Intrinsics_8h.html">Intrinsics.h</a></div></div>
<div class="ttc" id="aInstrTypes_8h_html"><div class="ttname"><a href="InstrTypes_8h.html">InstrTypes.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_a9da3b29e8e71b9be4645874e1721207a"><div class="ttname"><a href="classllvm_1_1CallBase.html#a9da3b29e8e71b9be4645874e1721207a">llvm::CallBase::setAttributes</a></div><div class="ttdeci">void setAttributes(AttributeList A)</div><div class="ttdoc">Set the parameter attributes for this call.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01488">InstrTypes.h:1488</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a0ed5f3ab3c2e4196ee0cffffa080c062"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">llvm::BasicBlock::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdoc">Instruction iterator methods.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00314">BasicBlock.h:314</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a1fb4b1f16603d68ce7b6e6742f3115da"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a1fb4b1f16603d68ce7b6e6742f3115da">isGCPointerType</a></div><div class="ttdeci">static bool isGCPointerType(Type *T, GCStrategy *GC)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00325">RewriteStatepointsForGC.cpp:325</a></div></div>
<div class="ttc" id="astructfalse_1_1RematerizlizationCandidateRecord_html_a31f8a4989f28d9a38bbc1eb629fc30e4"><div class="ttname"><a href="structfalse_1_1RematerizlizationCandidateRecord.html#a31f8a4989f28d9a38bbc1eb629fc30e4">false::RematerizlizationCandidateRecord::RootOfChain</a></div><div class="ttdeci">Value * RootOfChain</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00295">RewriteStatepointsForGC.cpp:295</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallInst_html_a850d8262cd900958b3153c4aa080b2bb"><div class="ttname"><a href="classllvm_1_1CallInst.html#a850d8262cd900958b3153c4aa080b2bb">llvm::CallInst::Create</a></div><div class="ttdeci">static CallInst * Create(FunctionType *Ty, Value *F, const Twine &amp;NameStr=&quot;&quot;, Instruction *InsertBefore=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01528">Instructions.h:1528</a></div></div>
<div class="ttc" id="aSIInstrInfo_8cpp_html_a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791"><div class="ttname"><a href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a></div><div class="ttdeci">@ SI</div><div class="ttdef"><b>Definition:</b> <a href="SIInstrInfo_8cpp_source.html#l07993">SIInstrInfo.cpp:7993</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisUsage_html"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html">llvm::AnalysisUsage</a></div><div class="ttdoc">Represent the analysis usage information of a pass.</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00047">PassAnalysisSupport.h:47</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a8210289419425d82cf453d7b32bd2d2c"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a8210289419425d82cf453d7b32bd2d2c">insertRematerializationStores</a></div><div class="ttdeci">static void insertRematerializationStores(const RematerializedValueMapTy &amp;RematerializedValues, DenseMap&lt; Value *, AllocaInst * &gt; &amp;AllocaMap, DenseSet&lt; Value * &gt; &amp;VisitedLiveValues)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l02028">RewriteStatepointsForGC.cpp:2028</a></div></div>
<div class="ttc" id="aTargetLibraryInfo_8h_html"><div class="ttname"><a href="TargetLibraryInfo_8h.html">TargetLibraryInfo.h</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_ad6d87a400bc9669540b19739d36b4488"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#ad6d87a400bc9669540b19739d36b4488">getDeoptLowering</a></div><div class="ttdeci">static StringRef getDeoptLowering(CallBase *Call)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l01654">RewriteStatepointsForGC.cpp:1654</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8h_html"><div class="ttname"><a href="RewriteStatepointsForGC_8h.html">RewriteStatepointsForGC.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1SPII_html_a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856"><div class="ttname"><a href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">llvm::SPII::Store</a></div><div class="ttdeci">@ Store</div><div class="ttdef"><b>Definition:</b> <a href="SparcInstrInfo_8h_source.html#l00033">SparcInstrInfo.h:33</a></div></div>
<div class="ttc" id="aDenseSet_8h_html"><div class="ttname"><a href="DenseSet_8h.html">DenseSet.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a161fd4e9fa5367f64c2a4c9e921c3ad3"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a161fd4e9fa5367f64c2a4c9e921c3ad3">llvm::BasicBlock::getFirstInsertionPt</a></div><div class="ttdeci">const_iterator getFirstInsertionPt() const</div><div class="ttdoc">Returns an iterator to the first instruction in this block that is suitable for inserting a non-PHI i...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00245">BasicBlock.cpp:245</a></div></div>
<div class="ttc" id="anamespacefalse_html"><div class="ttname"><a href="namespacefalse.html">false</a></div><div class="ttdef"><b>Definition:</b> <a href="StackSlotColoring_8cpp_source.html#l00141">StackSlotColoring.cpp:141</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_aae78323e579beb55b2c4820179d7b7e8"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#aae78323e579beb55b2c4820179d7b7e8">ClobberNonLive</a></div><div class="ttdeci">static bool ClobberNonLive</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00102">RewriteStatepointsForGC.cpp:102</a></div></div>
<div class="ttc" id="anamespacellvm_1_1dwarf_html_a5d3c920b66ea797d6adb243862fdf47a"><div class="ttname"><a href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">llvm::dwarf::Index</a></div><div class="ttdeci">Index</div><div class="ttdef"><b>Definition:</b> <a href="Dwarf_8h_source.html#l00550">Dwarf.h:550</a></div></div>
<div class="ttc" id="aBuiltinGCs_8cpp_html_a7abf5fb4071cb25dbce06dfb5ee3c937"><div class="ttname"><a href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a></div><div class="ttdeci">static GCRegistry::Add&lt; OcamlGC &gt; B(&quot;ocaml&quot;, &quot;ocaml 3.10-compatible GC&quot;)</div></div>
<div class="ttc" id="alib_2Target_2README_8txt_html_ab24db72f7bd10b13351812874015861b"><div class="ttname"><a href="lib_2Target_2README_8txt.html#ab24db72f7bd10b13351812874015861b">First</a></div><div class="ttdeci">into llvm powi allowing the code generator to produce balanced multiplication trees First</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2README_8txt_source.html#l00054">README.txt:54</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_adfb61ffe25c950c75c86310245b3ef39"><div class="ttname"><a href="classllvm_1_1PHINode.html#adfb61ffe25c950c75c86310245b3ef39">llvm::PHINode::getIncomingValueForBlock</a></div><div class="ttdeci">Value * getIncomingValueForBlock(const BasicBlock *BB) const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02889">Instructions.h:2889</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html"><div class="ttname"><a href="classllvm_1_1Instruction.html">llvm::Instruction</a></div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00041">Instruction.h:41</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a056b1e140d5170fc706d4adc8cf051be"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a056b1e140d5170fc706d4adc8cf051be">statepoints</a></div><div class="ttdeci">rewrite statepoints for Make relocations at statepoints</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00235">RewriteStatepointsForGC.cpp:235</a></div></div>
<div class="ttc" id="aclassllvm_1_1AttributeList_html_a61054ea97168f709c1e46345f80c16a3"><div class="ttname"><a href="classllvm_1_1AttributeList.html#a61054ea97168f709c1e46345f80c16a3">llvm::AttributeList::hasFnAttr</a></div><div class="ttdeci">bool hasFnAttr(Attribute::AttrKind Kind) const</div><div class="ttdoc">Return true if the attribute exists for the function.</div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8cpp_source.html#l01479">Attributes.cpp:1479</a></div></div>
<div class="ttc" id="aclassllvm_1_1DominatorTreeWrapperPass_html"><div class="ttname"><a href="classllvm_1_1DominatorTreeWrapperPass.html">llvm::DominatorTreeWrapperPass</a></div><div class="ttdoc">Legacy analysis pass which computes a DominatorTree.</div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00314">Dominators.h:314</a></div></div>
<div class="ttc" id="aMDBuilder_8h_html"><div class="ttname"><a href="MDBuilder_8h.html">MDBuilder.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a217e0207d9cc8e046c2dccbf0e4bb198"><div class="ttname"><a href="classllvm_1_1APInt.html#a217e0207d9cc8e046c2dccbf0e4bb198">llvm::APInt::getZExtValue</a></div><div class="ttdeci">uint64_t getZExtValue() const</div><div class="ttdoc">Get zero extended value.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01494">APInt.h:1494</a></div></div>
<div class="ttc" id="aclassllvm_1_1raw__ostream_html"><div class="ttname"><a href="classllvm_1_1raw__ostream.html">llvm::raw_ostream</a></div><div class="ttdoc">This class implements an extremely fast bulk output stream that can only output to a stream.</div><div class="ttdef"><b>Definition:</b> <a href="raw__ostream_8h_source.html#l00052">raw_ostream.h:52</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a35ee267850af7c235474a8c46c7ac5af"><div class="ttname"><a href="classllvm_1_1Value.html#a35ee267850af7c235474a8c46c7ac5af">llvm::Value::setName</a></div><div class="ttdeci">void setName(const Twine &amp;Name)</div><div class="ttdoc">Change the name of the value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00375">Value.cpp:375</a></div></div>
<div class="ttc" id="anamespacellvm_html_a5ee0a415cf089775fd277550b257f74e"><div class="ttname"><a href="namespacellvm.html#a5ee0a415cf089775fd277550b257f74e">llvm::operator&lt;&lt;</a></div><div class="ttdeci">raw_ostream &amp; operator&lt;&lt;(raw_ostream &amp;OS, const APFixedPoint &amp;FX)</div><div class="ttdef"><b>Definition:</b> <a href="APFixedPoint_8h_source.html#l00292">APFixedPoint.h:292</a></div></div>
<div class="ttc" id="aclassllvm_1_1UndefValue_html_a4ae5ff22b700a42bcc5d889233721335"><div class="ttname"><a href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">llvm::UndefValue::get</a></div><div class="ttdeci">static UndefValue * get(Type *T)</div><div class="ttdoc">Static factory methods - Return an 'undef' object of the specified type.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01740">Constants.cpp:1740</a></div></div>
<div class="ttc" id="aclassllvm_1_1DomTreeUpdater_html"><div class="ttname"><a href="classllvm_1_1DomTreeUpdater.html">llvm::DomTreeUpdater</a></div><div class="ttdef"><b>Definition:</b> <a href="DomTreeUpdater_8h_source.html#l00028">DomTreeUpdater.h:28</a></div></div>
<div class="ttc" id="anamespacefalse_html_a9f5b65a81eb5133d76ed041f31f7ceac"><div class="ttname"><a href="namespacefalse.html#a9f5b65a81eb5133d76ed041f31f7ceac">false::IsKnownBaseMapTy</a></div><div class="ttdeci">MapVector&lt; Value *, bool &gt; IsKnownBaseMapTy</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00267">RewriteStatepointsForGC.cpp:267</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html_aebe6da1ab4a07020669f3d6148c0b559"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#aebe6da1ab4a07020669f3d6148c0b559">llvm::ArrayRef::rbegin</a></div><div class="ttdeci">reverse_iterator rbegin() const</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00154">ArrayRef.h:154</a></div></div>
<div class="ttc" id="anamespacellvm_html_a9d391b6acc6d90c9b8a8442324b1aa6f"><div class="ttname"><a href="namespacellvm.html#a9d391b6acc6d90c9b8a8442324b1aa6f">llvm::SplitBlockPredecessors</a></div><div class="ttdeci">BasicBlock * SplitBlockPredecessors(BasicBlock *BB, ArrayRef&lt; BasicBlock * &gt; Preds, const char *Suffix, DominatorTree *DT, LoopInfo *LI=nullptr, MemorySSAUpdater *MSSAU=nullptr, bool PreserveLCSSA=false)</div><div class="ttdoc">This method introduces at least one new basic block into the function and moves some of the predecess...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockUtils_8cpp_source.html#l01272">BasicBlockUtils.cpp:1272</a></div></div>
<div class="ttc" id="aCSEInfo_8cpp_html_a75f8a8519c2c9b30e7c06dc5e256fffa"><div class="ttname"><a href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a></div><div class="ttdeci">Analysis containing CSE Info</div><div class="ttdef"><b>Definition:</b> <a href="CSEInfo_8cpp_source.html#l00027">CSEInfo.cpp:27</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a6580c40c364979dcdc7847ebac738e15"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a6580c40c364979dcdc7847ebac738e15">GetDeoptBundleOperands</a></div><div class="ttdeci">static ArrayRef&lt; Use &gt; GetDeoptBundleOperands(const CallBase *Call)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00303">RewriteStatepointsForGC.cpp:303</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a8a5efaea67813b24d29c0022689a1fe0"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a8a5efaea67813b24d29c0022689a1fe0">INITIALIZE_PASS_BEGIN</a></div><div class="ttdeci">INITIALIZE_PASS_BEGIN(RewriteStatepointsForGCLegacyPass, &quot;rewrite-statepoints-for-gc&quot;, &quot;Make relocations explicit at statepoints&quot;, false, false) INITIALIZE_PASS_END(RewriteStatepointsForGCLegacyPass</div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_aa24dcfb77b1890aaa6d1f687eeffe665"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#aa24dcfb77b1890aaa6d1f687eeffe665">isHandledGCPointerType</a></div><div class="ttdeci">static bool isHandledGCPointerType(Type *T, GCStrategy *GC)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00339">RewriteStatepointsForGC.cpp:339</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a9e70d6aa9b2f9a1b6bff9f405910e1ba"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a9e70d6aa9b2f9a1b6bff9f405910e1ba">areBothVectorOrScalar</a></div><div class="ttdeci">static bool areBothVectorOrScalar(Value *First, Value *Second)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00753">RewriteStatepointsForGC.cpp:753</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a46ef6115027606b67adcf4d28f3dac17"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a46ef6115027606b67adcf4d28f3dac17">llvm::BasicBlock::getFirstNonPHI</a></div><div class="ttdeci">const Instruction * getFirstNonPHI() const</div><div class="ttdoc">Returns a pointer to the first instruction in this block that is not a PHINode instruction.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00208">BasicBlock.cpp:208</a></div></div>
<div class="ttc" id="aclassllvm_1_1FixedVectorType_html_af9a870d5df50fe0133a410b7c9114c80"><div class="ttname"><a href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">llvm::FixedVectorType::get</a></div><div class="ttdeci">static FixedVectorType * get(Type *ElementType, unsigned NumElts)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00686">Type.cpp:686</a></div></div>
<div class="ttc" id="anamespacellvm_1_1MCID_html_ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f"><div class="ttname"><a href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">llvm::MCID::Call</a></div><div class="ttdeci">@ Call</div><div class="ttdef"><b>Definition:</b> <a href="MCInstrDesc_8h_source.html#l00156">MCInstrDesc.h:156</a></div></div>
<div class="ttc" id="anamespacellvm_html_a2c3c18bffdc25d969233c5448bdfe7eb"><div class="ttname"><a href="namespacellvm.html#a2c3c18bffdc25d969233c5448bdfe7eb">llvm::AddressSpace</a></div><div class="ttdeci">AddressSpace</div><div class="ttdef"><b>Definition:</b> <a href="NVPTXBaseInfo_8h_source.html#l00021">NVPTXBaseInfo.h:21</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html_aaf9ee38b9973681c1720aaf03af3a069"><div class="ttname"><a href="classllvm_1_1SetVector.html#aaf9ee38b9973681c1720aaf03af3a069">llvm::SetVector&lt; T, SmallVector&lt; T, N &gt;, SmallDenseSet&lt; T, N &gt; &gt;::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdoc">Determine if the SetVector is empty or not.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00072">SetVector.h:72</a></div></div>
<div class="ttc" id="aclassllvm_1_1Attribute_html_a968930aea9d9efa8d46dd890fce75643"><div class="ttname"><a href="classllvm_1_1Attribute.html#a968930aea9d9efa8d46dd890fce75643">llvm::Attribute::getValueAsString</a></div><div class="ttdeci">StringRef getValueAsString() const</div><div class="ttdoc">Return the attribute's value as a string.</div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8cpp_source.html#l00312">Attributes.cpp:312</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_aef51af4b490af6b3bf2dfbc8737a8f9f"><div class="ttname"><a href="classllvm_1_1PHINode.html#aef51af4b490af6b3bf2dfbc8737a8f9f">llvm::PHINode::getNumIncomingValues</a></div><div class="ttdeci">unsigned getNumIncomingValues() const</div><div class="ttdoc">Return the number of incoming edges.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02790">Instructions.h:2790</a></div></div>
<div class="ttc" id="astructfalse_1_1GCPtrLivenessData_html_a42108e82db8532dfbdc909e9d160dd49"><div class="ttname"><a href="structfalse_1_1GCPtrLivenessData.html#a42108e82db8532dfbdc909e9d160dd49">false::GCPtrLivenessData::LiveOut</a></div><div class="ttdeci">MapVector&lt; BasicBlock *, SetVector&lt; Value * &gt; &gt; LiveOut</div><div class="ttdoc">Values live out of this basic block (i.e.</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00253">RewriteStatepointsForGC.cpp:253</a></div></div>
<div class="ttc" id="aStatepoint_8h_html"><div class="ttname"><a href="Statepoint_8h.html">Statepoint.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html_a709f5d7f042648ec20197939d9a6805f"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#a709f5d7f042648ec20197939d9a6805f">llvm::ArrayRef::rend</a></div><div class="ttdeci">reverse_iterator rend() const</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00155">ArrayRef.h:155</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a864a2ad11bbf83cf2b910e43d461cd02"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a864a2ad11bbf83cf2b910e43d461cd02">insertParsePoints</a></div><div class="ttdeci">static bool insertParsePoints(Function &amp;F, DominatorTree &amp;DT, TargetTransformInfo &amp;TTI, SmallVectorImpl&lt; CallBase * &gt; &amp;ToUpdate, DefiningValueMapTy &amp;DVCache, IsKnownBaseMapTy &amp;KnownBases)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l02688">RewriteStatepointsForGC.cpp:2688</a></div></div>
<div class="ttc" id="anamespacellvm_1_1CallingConv_html_a188c0836f8c3528401f1c236fd93b977"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">llvm::CallingConv::ID</a></div><div class="ttdeci">unsigned ID</div><div class="ttdoc">LLVM IR allows to use arbitrary numbers as calling convention identifiers.</div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00024">CallingConv.h:24</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a7685c70e8757fef2c3f8a4ff363de727"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a7685c70e8757fef2c3f8a4ff363de727">PrintLiveSet</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; PrintLiveSet(&quot;spp-print-liveset&quot;, cl::Hidden, cl::init(false))</div></div>
<div class="ttc" id="aType_8h_html"><div class="ttname"><a href="Type_8h.html">Type.h</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a15f212bb9de8ad1bff2d4732f12397ee"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a15f212bb9de8ad1bff2d4732f12397ee">normalizeForInvokeSafepoint</a></div><div class="ttdeci">static BasicBlock * normalizeForInvokeSafepoint(BasicBlock *BB, BasicBlock *InvokeParent, DominatorTree &amp;DT)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l01471">RewriteStatepointsForGC.cpp:1471</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html_aab7c4f6a6bb1a55a419befdf7895c9da"><div class="ttname"><a href="classllvm_1_1SetVector.html#aab7c4f6a6bb1a55a419befdf7895c9da">llvm::SetVector::set_union</a></div><div class="ttdeci">bool set_union(const STy &amp;S)</div><div class="ttdoc">Compute This := This u S, return whether 'This' changed.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00243">SetVector.h:243</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_ac2341c000429806910e78643bbcc1059"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#ac2341c000429806910e78643bbcc1059">setKnownBase</a></div><div class="ttdeci">static void setKnownBase(Value *V, bool IsKnownBase, IsKnownBaseMapTy &amp;KnownBases)</div><div class="ttdoc">Caches the IsKnownBase flag for a value and asserts that it wasn't present in the cache before.</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00742">RewriteStatepointsForGC.cpp:742</a></div></div>
<div class="ttc" id="aPassSupport_8h_html_a74ce8276b89067e806f67c45a6d92575"><div class="ttname"><a href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a></div><div class="ttdeci">#define INITIALIZE_PASS_END(passName, arg, name, cfg, analysis)</div><div class="ttdef"><b>Definition:</b> <a href="PassSupport_8h_source.html#l00059">PassSupport.h:59</a></div></div>
<div class="ttc" id="aclassllvm_1_1StringRef_html_aa3595f2a07a2268edcfbf41ffa40cabf"><div class="ttname"><a href="classllvm_1_1StringRef.html#aa3595f2a07a2268edcfbf41ffa40cabf">llvm::StringRef::equals</a></div><div class="ttdeci">bool equals(StringRef RHS) const</div><div class="ttdoc">equals - Check for string equality, this is more efficient than compare() when the relative ordering ...</div><div class="ttdef"><b>Definition:</b> <a href="StringRef_8h_source.html#l00164">StringRef.h:164</a></div></div>
<div class="ttc" id="aADT_2tmp_8txt_html_a07ed0bfaa124c15897944fe3eaa971ab"><div class="ttname"><a href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a></div><div class="ttdeci">Class for arbitrary precision integers APInt is a functional replacement for common case unsigned integer type like unsigned long or uint64_t</div><div class="ttdef"><b>Definition:</b> <a href="ADT_2tmp_8txt_source.html#l00001">tmp.txt:1</a></div></div>
<div class="ttc" id="aclassllvm_1_1InvokeInst_html"><div class="ttname"><a href="classllvm_1_1InvokeInst.html">llvm::InvokeInst</a></div><div class="ttdoc">Invoke instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03814">Instructions.h:3814</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ARM__PROC_html_a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e"><div class="ttname"><a href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">llvm::ARM_PROC::IE</a></div><div class="ttdeci">@ IE</div><div class="ttdef"><b>Definition:</b> <a href="MCTargetDesc_2ARMBaseInfo_8h_source.html#l00027">ARMBaseInfo.h:27</a></div></div>
<div class="ttc" id="anamespacellvm_html_a74cdbd1e4f731e7d7cd83461b8b1de0b"><div class="ttname"><a href="namespacellvm.html#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a></div><div class="ttdeci">void sort(IteratorTy Start, IteratorTy End)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01683">STLExtras.h:1683</a></div></div>
<div class="ttc" id="aclassllvm_1_1VectorType_html"><div class="ttname"><a href="classllvm_1_1VectorType.html">llvm::VectorType</a></div><div class="ttdoc">Base class of all SIMD vector types.</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00389">DerivedTypes.h:389</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a9b5f57931ea7a3a623b6e8ac416177c1"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a9b5f57931ea7a3a623b6e8ac416177c1">computeLiveInValues</a></div><div class="ttdeci">static void computeLiveInValues(DominatorTree &amp;DT, Function &amp;F, GCPtrLivenessData &amp;Data, GCStrategy *GC)</div><div class="ttdoc">Compute the live-in set for every basic block in the function.</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l03320">RewriteStatepointsForGC.cpp:3320</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseSet_html"><div class="ttname"><a href="classllvm_1_1DenseSet.html">llvm::DenseSet&lt; Value * &gt;</a></div></div>
<div class="ttc" id="anamespacefalse_html_a00af9f2347076bfb43b7d4e286feb576"><div class="ttname"><a href="namespacefalse.html#a00af9f2347076bfb43b7d4e286feb576">false::DefiningValueMapTy</a></div><div class="ttdeci">MapVector&lt; Value *, Value * &gt; DefiningValueMapTy</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00266">RewriteStatepointsForGC.cpp:266</a></div></div>
<div class="ttc" id="aBasicBlock_8h_html"><div class="ttname"><a href="BasicBlock_8h.html">BasicBlock.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1cl_1_1opt_html"><div class="ttname"><a href="classllvm_1_1cl_1_1opt.html">llvm::cl::opt&lt; bool &gt;</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a03f51e12bc910c9dc19f38b36f58a223"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a03f51e12bc910c9dc19f38b36f58a223">makeStatepointExplicitImpl</a></div><div class="ttdeci">static void makeStatepointExplicitImpl(CallBase *Call, const SmallVectorImpl&lt; Value * &gt; &amp;BasePtrs, const SmallVectorImpl&lt; Value * &gt; &amp;LiveVariables, PartiallyConstructedSafepointRecord &amp;Result, std::vector&lt; DeferredReplacement &gt; &amp;Replacements, const PointerToBaseTy &amp;PointerToBase, GCStrategy *GC)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l01670">RewriteStatepointsForGC.cpp:1670</a></div></div>
<div class="ttc" id="anamespacellvm_html_ae63d2db6b5c5d02973f882f17caf52b6"><div class="ttname"><a href="namespacellvm.html#ae63d2db6b5c5d02973f882f17caf52b6">llvm::isStatepointDirectiveAttr</a></div><div class="ttdeci">bool isStatepointDirectiveAttr(Attribute Attr)</div><div class="ttdoc">Return true if the Attr is an attribute that is a statepoint directive.</div><div class="ttdef"><b>Definition:</b> <a href="Statepoint_8cpp_source.html#l00018">Statepoint.cpp:18</a></div></div>
<div class="ttc" id="aclassllvm_1_1AttributeList_html_af5dcb6d3da4b30a7d21c9fb39bbf1a68a167699508089d6cf7e6afe448d82e6df"><div class="ttname"><a href="classllvm_1_1AttributeList.html#af5dcb6d3da4b30a7d21c9fb39bbf1a68a167699508089d6cf7e6afe448d82e6df">llvm::AttributeList::ReturnIndex</a></div><div class="ttdeci">@ ReturnIndex</div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8h_source.html#l00435">Attributes.h:435</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_ad1f0acfffdda650ed4ceb4d4622c1248"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#ad1f0acfffdda650ed4ceb4d4622c1248">checkBasicSSA</a></div><div class="ttdeci">static void checkBasicSSA(DominatorTree &amp;DT, SetVector&lt; Value * &gt; &amp;Live, Instruction *TI, bool TermOkay=false)</div><div class="ttdoc">Check that the items in 'Live' dominate 'TI'.</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l03294">RewriteStatepointsForGC.cpp:3294</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7e3e687ddfdcbacd404bcf17b917dd88"><div class="ttname"><a href="namespacellvm.html#a7e3e687ddfdcbacd404bcf17b917dd88">llvm::instructions</a></div><div class="ttdeci">inst_range instructions(Function *F)</div><div class="ttdef"><b>Definition:</b> <a href="InstIterator_8h_source.html#l00133">InstIterator.h:133</a></div></div>
<div class="ttc" id="aclassllvm_1_1IRBuilderBase_html_a06d64f226fabd94d694d6abd82e3c7b3"><div class="ttname"><a href="classllvm_1_1IRBuilderBase.html#a06d64f226fabd94d694d6abd82e3c7b3">llvm::IRBuilderBase::CreateBitCast</a></div><div class="ttdeci">Value * CreateBitCast(Value *V, Type *DestTy, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l02008">IRBuilder.h:2008</a></div></div>
<div class="ttc" id="aclassllvm_1_1StoreInst_html"><div class="ttname"><a href="classllvm_1_1StoreInst.html">llvm::StoreInst</a></div><div class="ttdoc">An instruction for storing to memory.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00301">Instructions.h:301</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_abee5adade9e071a19accfe1f3086cd47"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#abee5adade9e071a19accfe1f3086cd47">findBaseDefiningValueCached</a></div><div class="ttdeci">static Value * findBaseDefiningValueCached(Value *I, DefiningValueMapTy &amp;Cache, IsKnownBaseMapTy &amp;KnownBases)</div><div class="ttdoc">Returns the base defining value for this value.</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00696">RewriteStatepointsForGC.cpp:696</a></div></div>
<div class="ttc" id="aclassllvm_1_1Constant_html"><div class="ttname"><a href="classllvm_1_1Constant.html">llvm::Constant</a></div><div class="ttdoc">This is an important base class in LLVM.</div><div class="ttdef"><b>Definition:</b> <a href="Constant_8h_source.html#l00041">Constant.h:41</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_ae6b978645b8ac72d1a35e1298ffdd4f0"><div class="ttname"><a href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">llvm::Instruction::eraseFromParent</a></div><div class="ttdeci">SymbolTableList&lt; Instruction &gt;::iterator eraseFromParent()</div><div class="ttdoc">This method unlinks 'this' from the containing basic block and deletes it.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00082">Instruction.cpp:82</a></div></div>
<div class="ttc" id="aclassllvm_1_1GCRelocateInst_html"><div class="ttname"><a href="classllvm_1_1GCRelocateInst.html">llvm::GCRelocateInst</a></div><div class="ttdoc">Represents calls to the gc.relocate intrinsic.</div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l01477">IntrinsicInst.h:1477</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a40040abec5a5a5537a719bb14c60337e"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a40040abec5a5a5537a719bb14c60337e">computeKillSet</a></div><div class="ttdeci">static SetVector&lt; Value * &gt; computeKillSet(BasicBlock *BB, GCStrategy *GC)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l03283">RewriteStatepointsForGC.cpp:3283</a></div></div>
<div class="ttc" id="anamespacellvm_html_abba0f0474eb4e32d1ed7b6dfdb0d5140a6adf97f83acf6453d4a6a4b1070f3754"><div class="ttname"><a href="namespacellvm.html#abba0f0474eb4e32d1ed7b6dfdb0d5140a6adf97f83acf6453d4a6a4b1070f3754">llvm::StatepointFlags::None</a></div><div class="ttdeci">@ None</div></div>
<div class="ttc" id="aELFObjHandler_8cpp_html_aef61945034b9431b804748fc317c5548"><div class="ttname"><a href="ELFObjHandler_8cpp.html#aef61945034b9431b804748fc317c5548">Index</a></div><div class="ttdeci">uint32_t Index</div><div class="ttdef"><b>Definition:</b> <a href="ELFObjHandler_8cpp_source.html#l00083">ELFObjHandler.cpp:83</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLibraryInfoWrapperPass_html"><div class="ttname"><a href="classllvm_1_1TargetLibraryInfoWrapperPass.html">llvm::TargetLibraryInfoWrapperPass</a></div><div class="ttdef"><b>Definition:</b> <a href="TargetLibraryInfo_8h_source.html#l00565">TargetLibraryInfo.h:565</a></div></div>
<div class="ttc" id="anamespacellvm_1_1pdb_html_a434cfa04e4ed34b7a901378557d4ca9eab5923ebc864d1679cf1c3a929c122037"><div class="ttname"><a href="namespacellvm_1_1pdb.html#a434cfa04e4ed34b7a901378557d4ca9eab5923ebc864d1679cf1c3a929c122037">llvm::pdb::Unknown</a></div><div class="ttdeci">@ Unknown</div><div class="ttdef"><b>Definition:</b> <a href="PDBTypes_8h_source.html#l00396">PDBTypes.h:396</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfoWrapperPass_html"><div class="ttname"><a href="classllvm_1_1TargetTransformInfoWrapperPass.html">llvm::TargetTransformInfoWrapperPass</a></div><div class="ttdoc">Wrapper pass for TargetTransformInfo.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l02682">TargetTransformInfo.h:2682</a></div></div>
<div class="ttc" id="aBuiltinGCs_8cpp_html_a9bf617fd3367180fb96cebccfaae8dfa"><div class="ttname"><a href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a></div><div class="ttdeci">static GCRegistry::Add&lt; StatepointGC &gt; D(&quot;statepoint-example&quot;, &quot;an example strategy for statepoint&quot;)</div></div>
<div class="ttc" id="anamespacellvm_html_a086e9fbdb06276db7753101a08a63adf"><div class="ttname"><a href="namespacellvm.html#a086e9fbdb06276db7753101a08a63adf">llvm::find</a></div><div class="ttdeci">auto find(R &amp;&amp;Range, const T &amp;Val)</div><div class="ttdoc">Provide wrappers to std::find which take ranges instead of having to pass begin/end explicitly.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01755">STLExtras.h:1755</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ARM__MB_html_ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2"><div class="ttname"><a href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">llvm::ARM_MB::ST</a></div><div class="ttdeci">@ ST</div><div class="ttdef"><b>Definition:</b> <a href="MCTargetDesc_2ARMBaseInfo_8h_source.html#l00073">ARMBaseInfo.h:73</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a93270009c3358fba0a61654a9376ab4c"><div class="ttname"><a href="classllvm_1_1Value.html#a93270009c3358fba0a61654a9376ab4c">llvm::Value::getUniqueUndroppableUser</a></div><div class="ttdeci">User * getUniqueUndroppableUser()</div><div class="ttdoc">Return true if there is exactly one unique user of this value that cannot be dropped (that user can h...</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00178">Value.cpp:178</a></div></div>
<div class="ttc" id="aclassllvm_1_1GCRelocateInst_html_ae587391ac557593d998dbca4e62f0dab"><div class="ttname"><a href="classllvm_1_1GCRelocateInst.html#ae587391ac557593d998dbca4e62f0dab">llvm::GCRelocateInst::getDerivedPtr</a></div><div class="ttdeci">Value * getDerivedPtr() const</div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8cpp_source.html#l00824">IntrinsicInst.cpp:824</a></div></div>
<div class="ttc" id="aSVEIntrinsicOpts_8cpp_html_a2bb87eb1bcbc74783a83ae945eb8fa36"><div class="ttname"><a href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a></div><div class="ttdeci">INITIALIZE_PASS_DEPENDENCY(DominatorTreeWrapperPass)</div></div>
<div class="ttc" id="aclassllvm_1_1PreservedAnalyses_html_ad966bea18aa62ffb9e040509adc7c99f"><div class="ttname"><a href="classllvm_1_1PreservedAnalyses.html#ad966bea18aa62ffb9e040509adc7c99f">llvm::PreservedAnalyses::preserve</a></div><div class="ttdeci">void preserve()</div><div class="ttdoc">Mark an analysis as preserved.</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00173">PassManager.h:173</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantPointerNull_html_a96f5c85e4022e369266541b2db3fda69"><div class="ttname"><a href="classllvm_1_1ConstantPointerNull.html#a96f5c85e4022e369266541b2db3fda69">llvm::ConstantPointerNull::get</a></div><div class="ttdeci">static ConstantPointerNull * get(PointerType *T)</div><div class="ttdoc">Static factory methods - Return objects of the specified value.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01707">Constants.cpp:1707</a></div></div>
<div class="ttc" id="astructllvm_1_1StatepointDirectives_html"><div class="ttname"><a href="structllvm_1_1StatepointDirectives.html">llvm::StatepointDirectives</a></div><div class="ttdoc">Call sites that get wrapped by a gc.statepoint (currently only in RewriteStatepointsForGC and potenti...</div><div class="ttdef"><b>Definition:</b> <a href="Statepoint_8h_source.html#l00235">Statepoint.h:235</a></div></div>
<div class="ttc" id="aclassllvm_1_1LLVMContext_html"><div class="ttname"><a href="classllvm_1_1LLVMContext.html">llvm::LLVMContext</a></div><div class="ttdoc">This is an important class for using LLVM in a threaded context.</div><div class="ttdef"><b>Definition:</b> <a href="LLVMContext_8h_source.html#l00067">LLVMContext.h:67</a></div></div>
<div class="ttc" id="anamespacellvm_1_1numbers_html_a92f4283d4e0e2ea1776894b3ae93640f"><div class="ttname"><a href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">llvm::numbers::e</a></div><div class="ttdeci">constexpr double e</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00031">MathExtras.h:31</a></div></div>
<div class="ttc" id="aPromoteMemToReg_8h_html"><div class="ttname"><a href="PromoteMemToReg_8h.html">PromoteMemToReg.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1DomTreeUpdater_html_ae529b0d73b54361e5151985f93497001"><div class="ttname"><a href="classllvm_1_1DomTreeUpdater.html#ae529b0d73b54361e5151985f93497001">llvm::DomTreeUpdater::getDomTree</a></div><div class="ttdeci">DominatorTree &amp; getDomTree()</div><div class="ttdoc">Flush DomTree updates and return DomTree.</div><div class="ttdef"><b>Definition:</b> <a href="DomTreeUpdater_8cpp_source.html#l00303">DomTreeUpdater.cpp:303</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMap_html"><div class="ttname"><a href="classllvm_1_1DenseMap.html">llvm::DenseMap</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00714">DenseMap.h:714</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a9d33f9de1cf6f2a221b8d60dd95effb9"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a9d33f9de1cf6f2a221b8d60dd95effb9">FnAttrsToStrip</a></div><div class="ttdeci">static constexpr Attribute::AttrKind FnAttrsToStrip[]</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l01493">RewriteStatepointsForGC.cpp:1493</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00058">MD5.cpp:58</a></div></div>
<div class="ttc" id="aclassllvm_1_1AttrBuilder_html"><div class="ttname"><a href="classllvm_1_1AttrBuilder.html">llvm::AttrBuilder</a></div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8h_source.html#l01040">Attributes.h:1040</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html_afb844e6f81cb0ca752888e80798976ec"><div class="ttname"><a href="classllvm_1_1SetVector.html#afb844e6f81cb0ca752888e80798976ec">llvm::SetVector::set_subtract</a></div><div class="ttdeci">void set_subtract(const STy &amp;S)</div><div class="ttdoc">Compute This := This - B TODO: We should be able to use set_subtract from SetOperations....</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00258">SetVector.h:258</a></div></div>
<div class="ttc" id="aclassllvm_1_1GetElementPtrInst_html"><div class="ttname"><a href="classllvm_1_1GetElementPtrInst.html">llvm::GetElementPtrInst</a></div><div class="ttdoc">an instruction for type-safe pointer arithmetic to access elements of arrays and structs</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00940">Instructions.h:940</a></div></div>
<div class="ttc" id="aclassllvm_1_1Attribute_html_aab7ee4b8fd1d3e7e4cea87868855e60e"><div class="ttname"><a href="classllvm_1_1Attribute.html#aab7ee4b8fd1d3e7e4cea87868855e60e">llvm::Attribute::AttrKind</a></div><div class="ttdeci">AttrKind</div><div class="ttdoc">This enumeration lists the attributes that can be associated with parameters, function results,...</div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8h_source.html#l00086">Attributes.h:86</a></div></div>
<div class="ttc" id="anamespacellvm_1_1cl_html_a10a041239ae1870cfcc064bfaa79fb65"><div class="ttname"><a href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">llvm::cl::init</a></div><div class="ttdeci">initializer&lt; Ty &gt; init(const Ty &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00445">CommandLine.h:445</a></div></div>
<div class="ttc" id="anamespacellvm_html_acd1cd968cb420c82d70926920fcdc7d7"><div class="ttname"><a href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">llvm::is_contained</a></div><div class="ttdeci">bool is_contained(R &amp;&amp;Range, const E &amp;Element)</div><div class="ttdoc">Wrapper function around std::find to detect if an element exists in a container.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01869">STLExtras.h:1869</a></div></div>
<div class="ttc" id="aArrayRef_8h_html"><div class="ttname"><a href="ArrayRef_8h.html">ArrayRef.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a0c047f127ed4380a6f383d70bec4eb94"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">llvm::DenseMapBase&lt; SmallDenseMap&lt; KeyT, ValueT, 4, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::find</a></div><div class="ttdeci">iterator find(const_arg_type_t&lt; KeyT &gt; Val)</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00150">DenseMap.h:150</a></div></div>
<div class="ttc" id="aIRBuilder_8h_html"><div class="ttname"><a href="IRBuilder_8h.html">IRBuilder.h</a></div></div>
<div class="ttc" id="aSILowerControlFlow_8cpp_html_a4868c5d81c5ccc98c47aeab6244346a0"><div class="ttname"><a href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a></div><div class="ttdeci">assert(ImpDefSCC.getReg()==AMDGPU::SCC &amp;&amp;ImpDefSCC.isDef())</div></div>
<div class="ttc" id="astructllvm_1_1StatepointDirectives_html_a10a80a4141f323a8bba4e9b468680315"><div class="ttname"><a href="structllvm_1_1StatepointDirectives.html#a10a80a4141f323a8bba4e9b468680315">llvm::StatepointDirectives::NumPatchBytes</a></div><div class="ttdeci">std::optional&lt; uint32_t &gt; NumPatchBytes</div><div class="ttdef"><b>Definition:</b> <a href="Statepoint_8h_source.html#l00236">Statepoint.h:236</a></div></div>
<div class="ttc" id="alib_2Target_2SystemZ_2README_8txt_html_aff41f78457c5b0beb8af78edab100d70"><div class="ttname"><a href="lib_2Target_2SystemZ_2README_8txt.html#aff41f78457c5b0beb8af78edab100d70">base</a></div><div class="ttdeci">therefore end up llgh r3 lr r0 br r14 but truncating the load would lh r3 br r14 Functions ret i64 and ought to be implemented ngr r0 br r14 but two address optimizations reverse the order of the AND and ngr r2 lgr r0 br r14 CodeGen SystemZ and ll has several examples of this Out of range displacements are usually handled by loading the full address into a register In many cases it would be better to create an anchor point instead E g i64 base</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2SystemZ_2README_8txt_source.html#l00125">README.txt:125</a></div></div>
<div class="ttc" id="aclassllvm_1_1DominatorTree_html_a1a70f2c359aadd76a72aaaede16aca4a"><div class="ttname"><a href="classllvm_1_1DominatorTree.html#a1a70f2c359aadd76a72aaaede16aca4a">llvm::DominatorTree::isReachableFromEntry</a></div><div class="ttdeci">bool isReachableFromEntry(const Use &amp;U) const</div><div class="ttdoc">Provide an overload for a Use.</div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8cpp_source.html#l00335">Dominators.cpp:335</a></div></div>
<div class="ttc" id="aTargetLibraryInfo_8cpp_html_aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053"><div class="ttname"><a href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a></div><div class="ttdeci">@ Ptr</div><div class="ttdef"><b>Definition:</b> <a href="TargetLibraryInfo_8cpp_source.html#l00062">TargetLibraryInfo.cpp:62</a></div></div>
<div class="ttc" id="aclassllvm_1_1SelectInst_html"><div class="ttname"><a href="classllvm_1_1SelectInst.html">llvm::SelectInst</a></div><div class="ttdoc">This class represents the LLVM 'select' instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01746">Instructions.h:1746</a></div></div>
<div class="ttc" id="aiterator__range_8h_html"><div class="ttname"><a href="iterator__range_8h.html">iterator_range.h</a></div></div>
<div class="ttc" id="aMemDepPrinter_8cpp_html_a470d8721ad7c3b718e9daeabdaeb4700"><div class="ttname"><a href="MemDepPrinter_8cpp.html#a470d8721ad7c3b718e9daeabdaeb4700">function</a></div><div class="ttdeci">print Print MemDeps of function</div><div class="ttdef"><b>Definition:</b> <a href="MemDepPrinter_8cpp_source.html#l00082">MemDepPrinter.cpp:82</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_af21f61086e696a788f549768fdc26a93"><div class="ttname"><a href="classllvm_1_1Value.html#af21f61086e696a788f549768fdc26a93">llvm::Value::user_empty</a></div><div class="ttdeci">bool user_empty() const</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00385">Value.h:385</a></div></div>
<div class="ttc" id="aclassllvm_1_1Record_html"><div class="ttname"><a href="classllvm_1_1Record.html">llvm::Record</a></div><div class="ttdef"><b>Definition:</b> <a href="Record_8h_source.html#l01577">Record.h:1577</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a425eab58717b81784602a0b169dd9ff8"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a425eab58717b81784602a0b169dd9ff8">llvm::TargetTransformInfo::getCastInstrCost</a></div><div class="ttdeci">InstructionCost getCastInstrCost(unsigned Opcode, Type *Dst, Type *Src, TTI::CastContextHint CCH, TTI::TargetCostKind CostKind=TTI::TCK_SizeAndLatency, const Instruction *I=nullptr) const</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00869">TargetTransformInfo.cpp:869</a></div></div>
<div class="ttc" id="aclassllvm_1_1Module_html"><div class="ttname"><a href="classllvm_1_1Module.html">llvm::Module</a></div><div class="ttdoc">A Module instance is used to store all the information related to an LLVM module.</div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00065">Module.h:65</a></div></div>
<div class="ttc" id="aclassllvm_1_1MDNode_html"><div class="ttname"><a href="classllvm_1_1MDNode.html">llvm::MDNode</a></div><div class="ttdoc">Metadata node.</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8h_source.html#l00943">Metadata.h:943</a></div></div>
<div class="ttc" id="anamespacefalse_html_ac6a673a7af50c8b1760115a5dd9c0b04"><div class="ttname"><a href="namespacefalse.html#ac6a673a7af50c8b1760115a5dd9c0b04">false::RematerializedValueMapTy</a></div><div class="ttdeci">MapVector&lt; AssertingVH&lt; Instruction &gt;, AssertingVH&lt; Value &gt; &gt; RematerializedValueMapTy</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00271">RewriteStatepointsForGC.cpp:271</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a2c16dd15d443e1027f7ffde8c13432c5"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a2c16dd15d443e1027f7ffde8c13432c5">RematDerivedAtUses</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; RematDerivedAtUses(&quot;rs4gc-remat-derived-at-uses&quot;, cl::Hidden, cl::init(true))</div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a8e774e505629c16421ed9b345ddb1f75"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a8e774e505629c16421ed9b345ddb1f75">shouldRewriteStatepointsIn</a></div><div class="ttdeci">static bool shouldRewriteStatepointsIn(Function &amp;F)</div><div class="ttdoc">Returns true if this function should be rewritten by this pass.</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l03048">RewriteStatepointsForGC.cpp:3048</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a0230b531ba2214a31157027481fde94c"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a0230b531ba2214a31157027481fde94c">gc</a></div><div class="ttdeci">rewrite statepoints for gc</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00234">RewriteStatepointsForGC.cpp:234</a></div></div>
<div class="ttc" id="aLazyValueInfo_8cpp_html_add11cb1bc38847ce70e526af765dcce7"><div class="ttname"><a href="LazyValueInfo_8cpp.html#add11cb1bc38847ce70e526af765dcce7">info</a></div><div class="ttdeci">lazy value info</div><div class="ttdef"><b>Definition:</b> <a href="LazyValueInfo_8cpp_source.html#l00058">LazyValueInfo.cpp:58</a></div></div>
<div class="ttc" id="astructStatus_html"><div class="ttname"><a href="structStatus.html">Status</a></div><div class="ttdef"><b>Definition:</b> <a href="SIModeRegister_8cpp_source.html#l00029">SIModeRegister.cpp:29</a></div></div>
<div class="ttc" id="aAssumeBundleBuilder_8cpp_html_afb136e0532bcaed86521b462e6538d62"><div class="ttname"><a href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a></div><div class="ttdeci">assume Assume Builder</div><div class="ttdef"><b>Definition:</b> <a href="AssumeBundleBuilder_8cpp_source.html#l00651">AssumeBundleBuilder.cpp:651</a></div></div>
<div class="ttc" id="anamespacellvm_html_a4d812a2dd18aa186c164447e20e348e7"><div class="ttname"><a href="namespacellvm.html#a4d812a2dd18aa186c164447e20e348e7">llvm::operator==</a></div><div class="ttdeci">bool operator==(const AddressRangeValuePair &amp;LHS, const AddressRangeValuePair &amp;RHS)</div><div class="ttdef"><b>Definition:</b> <a href="AddressRanges_8h_source.html#l00153">AddressRanges.h:153</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html_a72d928b7fc2c5f2d56c6ac0265fd9c6e"><div class="ttname"><a href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">llvm::SetVector::insert</a></div><div class="ttdeci">bool insert(const value_type &amp;X)</div><div class="ttdoc">Insert a new element into the SetVector.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00141">SetVector.h:141</a></div></div>
<div class="ttc" id="anamespacellvm_html_a67980a8ae101d2fda845eb750ffb1942"><div class="ttname"><a href="namespacellvm.html#a67980a8ae101d2fda845eb750ffb1942">llvm::print</a></div><div class="ttdeci">Printable print(const GCNRegPressure &amp;RP, const GCNSubtarget *ST=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="GCNRegPressure_8cpp_source.html#l00138">GCNRegPressure.cpp:138</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a7d36e55d9eac11862a0db20973c68707"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a7d36e55d9eac11862a0db20973c68707">AllowStatepointWithNoDeoptInfo</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; AllowStatepointWithNoDeoptInfo(&quot;rs4gc-allow-statepoint-with-no-deopt-info&quot;, cl::Hidden, cl::init(true))</div></div>
<div class="ttc" id="anamespacefalse_html_abbdd09796205857296660052b67cc167"><div class="ttname"><a href="namespacefalse.html#abbdd09796205857296660052b67cc167">false::PointerToBaseTy</a></div><div class="ttdeci">MapVector&lt; Value *, Value * &gt; PointerToBaseTy</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00268">RewriteStatepointsForGC.cpp:268</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a0a4d51e372293abe5e5f6dac133e80a6"><div class="ttname"><a href="classllvm_1_1Instruction.html#a0a4d51e372293abe5e5f6dac133e80a6">llvm::Instruction::clone</a></div><div class="ttdeci">Instruction * clone() const</div><div class="ttdoc">Create a copy of 'this' instruction that is identical in all ways except the following:</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00903">Instruction.cpp:903</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_ae50a94a56edda301bd0af57f7dd2da49"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#ae50a94a56edda301bd0af57f7dd2da49">getParamAndReturnAttributesToRemove</a></div><div class="ttdeci">static AttributeMask getParamAndReturnAttributesToRemove()</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l02921">RewriteStatepointsForGC.cpp:2921</a></div></div>
<div class="ttc" id="anamespacellvm_1_1Sched_html_ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9"><div class="ttname"><a href="namespacellvm_1_1Sched.html#ac1547cccaf660851fcd6863d1e60309eac13545a6345c7d5b3c9cc8932ad3b0e9">llvm::Sched::Source</a></div><div class="ttdeci">@ Source</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l00100">TargetLowering.h:100</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html"><div class="ttname"><a href="classllvm_1_1ArrayRef.html">llvm::ArrayRef</a></div><div class="ttdoc">ArrayRef - Represent a constant reference to an array (0 or more elements consecutively in memory),...</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00033">APInt.h:33</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html_a3499f6a24500afba2c318295ad2d2d05"><div class="ttname"><a href="classllvm_1_1SetVector.html#a3499f6a24500afba2c318295ad2d2d05">llvm::SetVector&lt; T, SmallVector&lt; T, N &gt;, SmallDenseSet&lt; T, N &gt; &gt;::pop_back_val</a></div><div class="ttdeci">T pop_back_val()</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00225">SetVector.h:225</a></div></div>
<div class="ttc" id="aclassllvm_1_1MapVector_html_a9318649185cfc66ba4b4eb66d5968e00"><div class="ttname"><a href="classllvm_1_1MapVector.html#a9318649185cfc66ba4b4eb66d5968e00">llvm::MapVector::insert</a></div><div class="ttdeci">std::pair&lt; iterator, bool &gt; insert(const std::pair&lt; KeyT, ValueT &gt; &amp;KV)</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00118">MapVector.h:118</a></div></div>
<div class="ttc" id="anamespacellvm_html_a61d13d6824ec46c31260a4fd0997eda0"><div class="ttname"><a href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">llvm::any_of</a></div><div class="ttdeci">bool any_of(R &amp;&amp;range, UnaryPredicate P)</div><div class="ttdoc">Provide wrappers to std::any_of which take ranges instead of having to pass begin/end explicitly.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01742">STLExtras.h:1742</a></div></div>
<div class="ttc" id="aDataLayout_8h_html"><div class="ttname"><a href="DataLayout_8h.html">DataLayout.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1StructType_html"><div class="ttname"><a href="classllvm_1_1StructType.html">llvm::StructType</a></div><div class="ttdoc">Class to represent struct types.</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00213">DerivedTypes.h:213</a></div></div>
<div class="ttc" id="aBasicBlockSections_8cpp_html_a5fd0741d696f28faf65b33f6c6af8fda"><div class="ttname"><a href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a></div><div class="ttdeci">SmallVector&lt; MachineOperand, 4 &gt; Cond</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockSections_8cpp_source.html#l00137">BasicBlockSections.cpp:137</a></div></div>
<div class="ttc" id="aclassllvm_1_1StringRef_html"><div class="ttname"><a href="classllvm_1_1StringRef.html">llvm::StringRef</a></div><div class="ttdoc">StringRef - Represent a constant reference to a string, i.e.</div><div class="ttdef"><b>Definition:</b> <a href="StringRef_8h_source.html#l00050">StringRef.h:50</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_ace7e2f01b65afba76343f22d042a12df"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#ace7e2f01b65afba76343f22d042a12df">CreateGCRelocates</a></div><div class="ttdeci">static void CreateGCRelocates(ArrayRef&lt; Value * &gt; LiveVariables, ArrayRef&lt; Value * &gt; BasePtrs, Instruction *StatepointToken, IRBuilder&lt;&gt; &amp;Builder, GCStrategy *GC)</div><div class="ttdoc">Helper function to place all gc relocates necessary for the given statepoint.</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l01526">RewriteStatepointsForGC.cpp:1526</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a706f223f760b55668fbae74202b816bba7f80055e1969cb850739546467460ad8"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a706f223f760b55668fbae74202b816bba7f80055e1969cb850739546467460ad8">llvm::TargetTransformInfo::TCK_SizeAndLatency</a></div><div class="ttdeci">@ TCK_SizeAndLatency</div><div class="ttdoc">The weighted sum of size and latency.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00245">TargetTransformInfo.h:245</a></div></div>
<div class="ttc" id="anamespacellvm_html_a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4"><div class="ttname"><a href="namespacellvm.html#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">llvm::Offset</a></div><div class="ttdeci">@ Offset</div><div class="ttdef"><b>Definition:</b> <a href="DWP_8cpp_source.html#l00406">DWP.cpp:406</a></div></div>
<div class="ttc" id="aSupport_2ErrorHandling_8h_html_ace243f5c25697a1107cce46626b3dc94"><div class="ttname"><a href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a></div><div class="ttdeci">#define llvm_unreachable(msg)</div><div class="ttdoc">Marks that the current location is not supposed to be reachable.</div><div class="ttdef"><b>Definition:</b> <a href="Support_2ErrorHandling_8h_source.html#l00143">ErrorHandling.h:143</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_aba0055050d741f60b6e0523507a2c79f"><div class="ttname"><a href="classllvm_1_1Value.html#aba0055050d741f60b6e0523507a2c79f">llvm::Value::getNumUses</a></div><div class="ttdeci">unsigned getNumUses() const</div><div class="ttdoc">This method computes the number of uses of this Value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00254">Value.cpp:254</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a6393a2d4fe7e10b28a0dcc35f881567b"><div class="ttname"><a href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">llvm::Value::getType</a></div><div class="ttdeci">Type * getType() const</div><div class="ttdoc">All values are typed, get the type of this value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00255">Value.h:255</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a74aa9daea070e2ad3394a3ec58b7316a"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a74aa9daea070e2ad3394a3ec58b7316a">llvm::BasicBlock::getUniquePredecessor</a></div><div class="ttdeci">const BasicBlock * getUniquePredecessor() const</div><div class="ttdoc">Return the predecessor of this block if it has a unique predecessor block.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00292">BasicBlock.cpp:292</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a3ab5fc45117b450e8bb04e564cb6e5f2"><div class="ttname"><a href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">llvm::Value::replaceAllUsesWith</a></div><div class="ttdeci">void replaceAllUsesWith(Value *V)</div><div class="ttdoc">Change all uses of this to point to a new Value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00532">Value.cpp:532</a></div></div>
<div class="ttc" id="aREADME__ALTIVEC_8txt_html_a015846b6188ce15e08cd94c74a9df1a3"><div class="ttname"><a href="README__ALTIVEC_8txt.html#a015846b6188ce15e08cd94c74a9df1a3">A</a></div><div class="ttdeci">* A</div><div class="ttdef"><b>Definition:</b> <a href="README__ALTIVEC_8txt_source.html#l00089">README_ALTIVEC.txt:89</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ms__demangle_html_a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e"><div class="ttname"><a href="namespacellvm_1_1ms__demangle.html#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">llvm::ms_demangle::IntrinsicFunctionKind::New</a></div><div class="ttdeci">@ New</div></div>
<div class="ttc" id="aclassuint32__t_html"><div class="ttname"><a href="classuint32__t.html">uint32_t</a></div></div>
<div class="ttc" id="aCompiler_8h_html"><div class="ttname"><a href="Compiler_8h.html">Compiler.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_a39d3d23a084c4544ee5903203db10e8a"><div class="ttname"><a href="namespacellvm.html#a39d3d23a084c4544ee5903203db10e8a">llvm::append_range</a></div><div class="ttdeci">void append_range(Container &amp;C, Range &amp;&amp;R)</div><div class="ttdoc">Wrapper function to append a range to a container.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l02014">STLExtras.h:2014</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_ab3fc0225d8aaf8434026c3573f961f2c"><div class="ttname"><a href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">llvm::Value::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const</div><div class="ttdoc">All values hold a context through their type.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00994">Value.cpp:994</a></div></div>
<div class="ttc" id="aclassllvm_1_1ilist__node__impl_html_af719fc783be6589465137d997701a432"><div class="ttname"><a href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">llvm::ilist_node_impl::getIterator</a></div><div class="ttdeci">self_iterator getIterator()</div><div class="ttdef"><b>Definition:</b> <a href="ilist__node_8h_source.html#l00082">ilist_node.h:82</a></div></div>
<div class="ttc" id="aAArch64SLSHardening_8cpp_html_ad467c4ab9119043f9b7750ab986be61a"><div class="ttname"><a href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a></div><div class="ttdeci">MachineBasicBlock MachineBasicBlock::iterator DebugLoc DL</div><div class="ttdef"><b>Definition:</b> <a href="AArch64SLSHardening_8cpp_source.html#l00076">AArch64SLSHardening.cpp:76</a></div></div>
<div class="ttc" id="anamespacellvm_html_a92be87f8a371f277f7260fb99592d5f4"><div class="ttname"><a href="namespacellvm.html#a92be87f8a371f277f7260fb99592d5f4">llvm::unique</a></div><div class="ttdeci">auto unique(Range &amp;&amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="GenericUniformityImpl_8h_source.html#l00056">GenericUniformityImpl.h:56</a></div></div>
<div class="ttc" id="aclassllvm_1_1CastInst_html"><div class="ttname"><a href="classllvm_1_1CastInst.html">llvm::CastInst</a></div><div class="ttdoc">This is the base class for all instructions that perform data casts.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00428">InstrTypes.h:428</a></div></div>
<div class="ttc" id="anamespacellvm_html_abba0f0474eb4e32d1ed7b6dfdb0d5140a9db1ed1dc0fe1fc6b917ab0430b7844c"><div class="ttname"><a href="namespacellvm.html#abba0f0474eb4e32d1ed7b6dfdb0d5140a9db1ed1dc0fe1fc6b917ab0430b7844c">llvm::StatepointFlags::GCTransition</a></div><div class="ttdeci">@ GCTransition</div><div class="ttdoc">Indicates that this statepoint is a transition from GC-aware code to code that is not GC-aware.</div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_adb5c319f5905c1d3ca9eb5df546388c5"><div class="ttname"><a href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">llvm::Value::getName</a></div><div class="ttdeci">StringRef getName() const</div><div class="ttdoc">Return a constant reference to the value's name.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00308">Value.cpp:308</a></div></div>
<div class="ttc" id="alib_2Target_2README_8txt_html_a7df6ed7588301267782c2bd4b7f6899d"><div class="ttname"><a href="lib_2Target_2README_8txt.html#a7df6ed7588301267782c2bd4b7f6899d">for</a></div><div class="ttdeci">this could be done in SelectionDAGISel along with other special for</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2README_8txt_source.html#l00104">README.txt:104</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoadInst_html"><div class="ttname"><a href="classllvm_1_1LoadInst.html">llvm::LoadInst</a></div><div class="ttdoc">An instruction for reading from memory.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00177">Instructions.h:177</a></div></div>
<div class="ttc" id="aValueHandle_8h_html"><div class="ttname"><a href="ValueHandle_8h.html">ValueHandle.h</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a0d959321ece754ecd86333ecfd33bac4"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a0d959321ece754ecd86333ecfd33bac4">rematerializeChain</a></div><div class="ttdeci">static Instruction * rematerializeChain(ArrayRef&lt; Instruction * &gt; ChainToBase, Instruction *InsertBefore, Value *RootOfChain, Value *AlternateLiveBase)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l01412">RewriteStatepointsForGC.cpp:1412</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html_a1600c7959045cb6b6a5f5a1d427ec67e"><div class="ttname"><a href="classllvm_1_1User.html#a1600c7959045cb6b6a5f5a1d427ec67e">llvm::User::replaceUsesOfWith</a></div><div class="ttdeci">bool replaceUsesOfWith(Value *From, Value *To)</div><div class="ttdoc">Replace uses of one Value with another.</div><div class="ttdef"><b>Definition:</b> <a href="User_8cpp_source.html#l00021">User.cpp:21</a></div></div>
<div class="ttc" id="aSampleProfWriter_8cpp_html_ac5f3689931c7238da06ba00cf1002c62"><div class="ttname"><a href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a></div><div class="ttdeci">raw_pwrite_stream &amp; OS</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfWriter_8cpp_source.html#l00053">SampleProfWriter.cpp:53</a></div></div>
<div class="ttc" id="anamespacellvm_1_1Intrinsic_html_aefa39f6b622360ce4e947feb9f671b73"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#aefa39f6b622360ce4e947feb9f671b73">llvm::Intrinsic::getDeclaration</a></div><div class="ttdeci">Function * getDeclaration(Module *M, ID id, ArrayRef&lt; Type * &gt; Tys=std::nullopt)</div><div class="ttdoc">Create or insert an LLVM Function declaration for an intrinsic, and return it.</div><div class="ttdef"><b>Definition:</b> <a href="Function_8cpp_source.html#l01502">Function.cpp:1502</a></div></div>
<div class="ttc" id="aPoisonChecking_8cpp_html_a702ebb77e7ff7f0a10a1b4690d8ecfc8"><div class="ttname"><a href="PoisonChecking_8cpp.html#a702ebb77e7ff7f0a10a1b4690d8ecfc8">rewrite</a></div><div class="ttdeci">static bool rewrite(Function &amp;F)</div><div class="ttdef"><b>Definition:</b> <a href="PoisonChecking_8cpp_source.html#l00255">PoisonChecking.cpp:255</a></div></div>
<div class="ttc" id="aclassllvm_1_1FunctionCallee_html_a0055cd5464b935f571b36979a86bd7fc"><div class="ttname"><a href="classllvm_1_1FunctionCallee.html#a0055cd5464b935f571b36979a86bd7fc">llvm::FunctionCallee::getCallee</a></div><div class="ttdeci">Value * getCallee()</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00184">DerivedTypes.h:184</a></div></div>
<div class="ttc" id="aArgument_8h_html"><div class="ttname"><a href="Argument_8h.html">Argument.h</a></div></div>
<div class="ttc" id="aCallingConv_8h_html"><div class="ttname"><a href="CallingConv_8h.html">CallingConv.h</a></div></div>
<div class="ttc" id="aAttributes_8h_html"><div class="ttname"><a href="Attributes_8h.html">Attributes.h</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a54a040cceb9c0ff9921d8eeec2966a55"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a54a040cceb9c0ff9921d8eeec2966a55">computeLiveOutSeed</a></div><div class="ttdeci">static void computeLiveOutSeed(BasicBlock *BB, SetVector&lt; Value * &gt; &amp;LiveTmp, GCStrategy *GC)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l03266">RewriteStatepointsForGC.cpp:3266</a></div></div>
<div class="ttc" id="aConstant_8h_html"><div class="ttname"><a href="Constant_8h.html">Constant.h</a></div></div>
<div class="ttc" id="astructfalse_1_1PartiallyConstructedSafepointRecord_html_a367390a55701be6bcb3949287fa5c1d4"><div class="ttname"><a href="structfalse_1_1PartiallyConstructedSafepointRecord.html#a367390a55701be6bcb3949287fa5c1d4">false::PartiallyConstructedSafepointRecord::StatepointToken</a></div><div class="ttdeci">GCStatepointInst * StatepointToken</div><div class="ttdoc">The new gc.statepoint instruction itself.</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00279">RewriteStatepointsForGC.cpp:279</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_af276809421b9e562341d3c420ff29712"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#af276809421b9e562341d3c420ff29712">findBaseDefiningValue</a></div><div class="ttdeci">static Value * findBaseDefiningValue(Value *I, DefiningValueMapTy &amp;Cache, IsKnownBaseMapTy &amp;KnownBases)</div><div class="ttdoc">Helper function for findBasePointer - Will return a value which either a) defines the base pointer fo...</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00522">RewriteStatepointsForGC.cpp:522</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_acaf8e4c3e40e01e848c1fad5f05b81cd"><div class="ttname"><a href="classllvm_1_1Type.html#acaf8e4c3e40e01e848c1fad5f05b81cd">llvm::Type::getIntNTy</a></div><div class="ttdeci">static IntegerType * getIntNTy(LLVMContext &amp;C, unsigned N)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00245">Type.cpp:245</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a65520b9c67759099e313d0f4e7b5ff9e"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a65520b9c67759099e313d0f4e7b5ff9e">llvm::DenseMapBase&lt; SmallDenseMap&lt; KeyT, ValueT, 4, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00084">DenseMap.h:84</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1SendMsg_html_a8594419a4ddfad2c9a79279c490e466d"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">llvm::AMDGPU::SendMsg::Op</a></div><div class="ttdeci">Op</div><div class="ttdef"><b>Definition:</b> <a href="SIDefines_8h_source.html#l00357">SIDefines.h:357</a></div></div>
<div class="ttc" id="aclassllvm_1_1PreservedAnalyses_html_a1258a1ff55557c27684010ebd7283712"><div class="ttname"><a href="classllvm_1_1PreservedAnalyses.html#a1258a1ff55557c27684010ebd7283712">llvm::PreservedAnalyses::all</a></div><div class="ttdeci">static PreservedAnalyses all()</div><div class="ttdoc">Construct a special preserved set that preserves all passes.</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00158">PassManager.h:158</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html_aab36927882fbfdcbb860d87fd9c30da8"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#aab36927882fbfdcbb860d87fd9c30da8">llvm::ArrayRef::begin</a></div><div class="ttdeci">iterator begin() const</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00151">ArrayRef.h:151</a></div></div>
<div class="ttc" id="aclassllvm_1_1LLVMContext_html_a800c1300065ca1615d2f4fb88623afd5a3f6df86c6efab701ade7abbc3134c25a"><div class="ttname"><a href="classllvm_1_1LLVMContext.html#a800c1300065ca1615d2f4fb88623afd5a3f6df86c6efab701ade7abbc3134c25a">llvm::LLVMContext::OB_deopt</a></div><div class="ttdeci">@ OB_deopt</div><div class="ttdef"><b>Definition:</b> <a href="LLVMContext_8h_source.html#l00089">LLVMContext.h:89</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a99bf3712c00fdf60fe9b59a2f503f2c5"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a99bf3712c00fdf60fe9b59a2f503f2c5">RematerializationThreshold</a></div><div class="ttdeci">static cl::opt&lt; unsigned &gt; RematerializationThreshold(&quot;spp-rematerialization-threshold&quot;, cl::Hidden, cl::init(6))</div></div>
<div class="ttc" id="aclassllvm_1_1LLVMContext_html_a800c1300065ca1615d2f4fb88623afd5a3adfd6f3291adf59a7977597741211c6"><div class="ttname"><a href="classllvm_1_1LLVMContext.html#a800c1300065ca1615d2f4fb88623afd5a3adfd6f3291adf59a7977597741211c6">llvm::LLVMContext::OB_gc_transition</a></div><div class="ttdeci">@ OB_gc_transition</div><div class="ttdef"><b>Definition:</b> <a href="LLVMContext_8h_source.html#l00091">LLVMContext.h:91</a></div></div>
<div class="ttc" id="anamespacellvm_html_a5eeaf08e96168c2cac8960f87f0ef360"><div class="ttname"><a href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">llvm::pred_end</a></div><div class="ttdeci">Interval::pred_iterator pred_end(Interval *I)</div><div class="ttdef"><b>Definition:</b> <a href="Interval_8h_source.html#l00112">Interval.h:112</a></div></div>
<div class="ttc" id="astructfalse_1_1RematerizlizationCandidateRecord_html_af2c3c80e9c73720e3faed63f28a6f9dd"><div class="ttname"><a href="structfalse_1_1RematerizlizationCandidateRecord.html#af2c3c80e9c73720e3faed63f28a6f9dd">false::RematerizlizationCandidateRecord::Cost</a></div><div class="ttdeci">InstructionCost Cost</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00297">RewriteStatepointsForGC.cpp:297</a></div></div>
<div class="ttc" id="aCasting_8h_html"><div class="ttname"><a href="Casting_8h.html">Casting.h</a></div></div>
<div class="ttc" id="aFunction_8h_html"><div class="ttname"><a href="Function_8h.html">Function.h</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a1d739ace36dfd7ba0b4069716611fd74"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a1d739ace36dfd7ba0b4069716611fd74">unique_unsorted</a></div><div class="ttdeci">static void unique_unsorted(SmallVectorImpl&lt; T &gt; &amp;Vec)</div><div class="ttdoc">Implement a unique function which doesn't require we sort the input vector.</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l02251">RewriteStatepointsForGC.cpp:2251</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a5526e43dee53a50b92a6f8c803cf7209"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a5526e43dee53a50b92a6f8c803cf7209">PrintLiveSetSize</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; PrintLiveSetSize(&quot;spp-print-liveset-size&quot;, cl::Hidden, cl::init(false))</div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_af864550d3c61aff5c6777610fdba8b7f"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#af864550d3c61aff5c6777610fdba8b7f">recomputeLiveInValues</a></div><div class="ttdeci">static void recomputeLiveInValues(GCPtrLivenessData &amp;RevisedLivenessData, CallBase *Call, PartiallyConstructedSafepointRecord &amp;result, PointerToBaseTy &amp;PointerToBase, GCStrategy *GC)</div><div class="ttdoc">Given an updated version of the dataflow liveness results, update the liveset and base pointer maps f...</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l03405">RewriteStatepointsForGC.cpp:3405</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_af001e6326d49bf139dfeee21772f01f0"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#af001e6326d49bf139dfeee21772f01f0">inlineGetBaseAndOffset</a></div><div class="ttdeci">static bool inlineGetBaseAndOffset(Function &amp;F, SmallVectorImpl&lt; CallInst * &gt; &amp;Intrinsics, DefiningValueMapTy &amp;DVCache, IsKnownBaseMapTy &amp;KnownBases)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l02636">RewriteStatepointsForGC.cpp:2636</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLibraryInfo_html"><div class="ttname"><a href="classllvm_1_1TargetLibraryInfo.html">llvm::TargetLibraryInfo</a></div><div class="ttdoc">Provides information about what library functions are available for the current target.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLibraryInfo_8h_source.html#l00234">TargetLibraryInfo.h:234</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html_a176409317fc26e8be3c6af0193643c27"><div class="ttname"><a href="classllvm_1_1User.html#a176409317fc26e8be3c6af0193643c27">llvm::User::operand_values</a></div><div class="ttdeci">iterator_range&lt; value_op_iterator &gt; operand_values()</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00266">User.h:266</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_aac0ea55010b7b1a301e65a0baea057aa"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">llvm::SmallVectorImpl::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00614">SmallVector.h:614</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a1b9baa03d5a238d6a2b34668dfe087b3"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a1b9baa03d5a238d6a2b34668dfe087b3">findBasePointer</a></div><div class="ttdeci">static Value * findBasePointer(Value *I, DefiningValueMapTy &amp;Cache, IsKnownBaseMapTy &amp;KnownBases)</div><div class="ttdoc">For a given value or instruction, figure out what base ptr its derived from.</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00877">RewriteStatepointsForGC.cpp:877</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallSet_html_a1679469af9bb8ccfbe98441fb8228c79"><div class="ttname"><a href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">llvm::SmallSet::insert</a></div><div class="ttdeci">std::pair&lt; const_iterator, bool &gt; insert(const T &amp;V)</div><div class="ttdoc">insert - Insert an element into the set if it isn't already there.</div><div class="ttdef"><b>Definition:</b> <a href="SmallSet_8h_source.html#l00177">SmallSet.h:177</a></div></div>
<div class="ttc" id="anamespacellvm_html_ab7e8be1d1ae7e526ea156b60c51c10e5"><div class="ttname"><a href="namespacellvm.html#ab7e8be1d1ae7e526ea156b60c51c10e5">llvm::FoldSingleEntryPHINodes</a></div><div class="ttdeci">bool FoldSingleEntryPHINodes(BasicBlock *BB, MemoryDependenceResults *MemDep=nullptr)</div><div class="ttdoc">We know that BB has one predecessor.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockUtils_8cpp_source.html#l00144">BasicBlockUtils.cpp:144</a></div></div>
<div class="ttc" id="aclassllvm_1_1IntrinsicInst_html"><div class="ttname"><a href="classllvm_1_1IntrinsicInst.html">llvm::IntrinsicInst</a></div><div class="ttdoc">A wrapper class for inspecting calls to intrinsic functions.</div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00047">IntrinsicInst.h:47</a></div></div>
<div class="ttc" id="aclassllvm_1_1MDBuilder_html"><div class="ttname"><a href="classllvm_1_1MDBuilder.html">llvm::MDBuilder</a></div><div class="ttdef"><b>Definition:</b> <a href="MDBuilder_8h_source.html#l00036">MDBuilder.h:36</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7e108932dc3da5294aed99a353aac9c4"><div class="ttname"><a href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">llvm::pred_begin</a></div><div class="ttdeci">Interval::pred_iterator pred_begin(Interval *I)</div><div class="ttdoc">pred_begin/pred_end - define methods so that Intervals may be used just like BasicBlocks can with the...</div><div class="ttdef"><b>Definition:</b> <a href="Interval_8h_source.html#l00109">Interval.h:109</a></div></div>
<div class="ttc" id="anamespacellvm_1_1RegState_html_aef4cc0c855dc833e2a9d58a50703320da9ddde91ef09476d28a088fe57f8e2921"><div class="ttname"><a href="namespacellvm_1_1RegState.html#aef4cc0c855dc833e2a9d58a50703320da9ddde91ef09476d28a088fe57f8e2921">llvm::RegState::Kill</a></div><div class="ttdeci">@ Kill</div><div class="ttdoc">The last use of a register.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstrBuilder_8h_source.html#l00048">MachineInstrBuilder.h:48</a></div></div>
<div class="ttc" id="aclassllvm_1_1DominatorTreeAnalysis_html"><div class="ttname"><a href="classllvm_1_1DominatorTreeAnalysis.html">llvm::DominatorTreeAnalysis</a></div><div class="ttdoc">Analysis pass which computes a DominatorTree.</div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00279">Dominators.h:279</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a6e20e76960d952de088354cbcd14c3ab"><div class="ttname"><a href="classllvm_1_1Type.html#a6e20e76960d952de088354cbcd14c3ab">llvm::Type::getVoidTy</a></div><div class="ttdeci">static Type * getVoidTy(LLVMContext &amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00224">Type.cpp:224</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html_affac0dc3d407ef3dee29b8bc9a4836bc"><div class="ttname"><a href="classllvm_1_1SetVector.html#affac0dc3d407ef3dee29b8bc9a4836bc">llvm::SetVector::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdoc">Get an iterator to the end of the SetVector.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00092">SetVector.h:92</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a6d3231fb84ed4182ec22e9442a87dbf8"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a6d3231fb84ed4182ec22e9442a87dbf8">llvm::BasicBlock::reverse_iterator</a></div><div class="ttdeci">InstListType::reverse_iterator reverse_iterator</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00089">BasicBlock.h:89</a></div></div>
<div class="ttc" id="aInstructions_8h_html"><div class="ttname"><a href="Instructions_8h.html">Instructions.h</a></div></div>
<div class="ttc" id="aELFYAML_8cpp_html_a941c34da9850676ce3380813c636cff2"><div class="ttname"><a href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a></div><div class="ttdeci">std::optional&lt; std::vector&lt; StOtherPiece &gt; &gt; Other</div><div class="ttdef"><b>Definition:</b> <a href="ELFYAML_8cpp_source.html#l01260">ELFYAML.cpp:1260</a></div></div>
<div class="ttc" id="anamespacellvm_html_a830906f493a6d5c69ac5a94675c657fb"><div class="ttname"><a href="namespacellvm.html#a830906f493a6d5c69ac5a94675c657fb">llvm::parseStatepointDirectivesFromAttrs</a></div><div class="ttdeci">StatepointDirectives parseStatepointDirectivesFromAttrs(AttributeList AS)</div><div class="ttdoc">Parse out statepoint directives from the function attributes present in AS.</div><div class="ttdef"><b>Definition:</b> <a href="Statepoint_8cpp_source.html#l00024">Statepoint.cpp:24</a></div></div>
<div class="ttc" id="aSmallVector_8h_html"><div class="ttname"><a href="SmallVector_8h.html">SmallVector.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1ilist__iterator_html_a78fdbf2880abbb855abdb5bf030d9105"><div class="ttname"><a href="classllvm_1_1ilist__iterator.html#a78fdbf2880abbb855abdb5bf030d9105">llvm::ilist_iterator::getReverse</a></div><div class="ttdeci">ilist_iterator&lt; OptionsT, !IsReverse, IsConst &gt; getReverse() const</div><div class="ttdoc">Get a reverse iterator to the same node.</div><div class="ttdef"><b>Definition:</b> <a href="ilist__iterator_8h_source.html#l00121">ilist_iterator.h:121</a></div></div>
<div class="ttc" id="aUser_8h_html"><div class="ttname"><a href="User_8h.html">User.h</a></div></div>
<div class="ttc" id="aDominators_8h_html"><div class="ttname"><a href="Dominators_8h.html">Dominators.h</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_aa44f7b8f4217ab0c4ae76b62d5d1ddd1"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#aa44f7b8f4217ab0c4ae76b62d5d1ddd1">stripNonValidData</a></div><div class="ttdeci">static void stripNonValidData(Module &amp;M)</div><div class="ttdoc">The IR fed into RewriteStatepointsForGC may have had attributes and metadata implying dereferenceabil...</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l03059">RewriteStatepointsForGC.cpp:3059</a></div></div>
<div class="ttc" id="astructllvm_1_1StatepointDirectives_html_a372b846903df662f9ef300b8821f42a9"><div class="ttname"><a href="structllvm_1_1StatepointDirectives.html#a372b846903df662f9ef300b8821f42a9">llvm::StatepointDirectives::DefaultStatepointID</a></div><div class="ttdeci">static const uint64_t DefaultStatepointID</div><div class="ttdef"><b>Definition:</b> <a href="Statepoint_8h_source.html#l00239">Statepoint.h:239</a></div></div>
<div class="ttc" id="astructfalse_1_1GCPtrLivenessData_html_a263b8ea78b539b25b9fd82db939f3df2"><div class="ttname"><a href="structfalse_1_1GCPtrLivenessData.html#a263b8ea78b539b25b9fd82db939f3df2">false::GCPtrLivenessData::LiveSet</a></div><div class="ttdeci">MapVector&lt; BasicBlock *, SetVector&lt; Value * &gt; &gt; LiveSet</div><div class="ttdoc">Values used in this block (and thus live); does not included values killed within this block.</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00245">RewriteStatepointsForGC.cpp:245</a></div></div>
<div class="ttc" id="aclassllvm_1_1AssertingVH_html"><div class="ttname"><a href="classllvm_1_1AssertingVH.html">llvm::AssertingVH</a></div><div class="ttdoc">Value handle that asserts if the Value is deleted.</div><div class="ttdef"><b>Definition:</b> <a href="ValueHandle_8h_source.html#l00260">ValueHandle.h:260</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a1a7f07aaef6a3bee130bf0e0f0536802"><div class="ttname"><a href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">llvm::Instruction::getParent</a></div><div class="ttdeci">const BasicBlock * getParent() const</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00090">Instruction.h:90</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_a0c8ffe664a36e30d49c84d0aded2fe08"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a0c8ffe664a36e30d49c84d0aded2fe08">llvm::SmallVectorImpl::pop_back_val</a></div><div class="ttdeci">T pop_back_val()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00677">SmallVector.h:677</a></div></div>
<div class="ttc" id="anamespacellvm_html_ac94cf747f5fb3d8bef69ba5168873f55"><div class="ttname"><a href="namespacellvm.html#ac94cf747f5fb3d8bef69ba5168873f55">llvm::getGCStrategy</a></div><div class="ttdeci">std::unique_ptr&lt; GCStrategy &gt; getGCStrategy(const StringRef Name)</div><div class="ttdoc">Lookup the GCStrategy object associated with the given gc name.</div><div class="ttdef"><b>Definition:</b> <a href="GCStrategy_8cpp_source.html#l00024">GCStrategy.cpp:24</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_a8ce0c4746a1ec805e66409d20ae93922"><div class="ttname"><a href="classllvm_1_1PHINode.html#a8ce0c4746a1ec805e66409d20ae93922">llvm::PHINode::getIncomingBlock</a></div><div class="ttdeci">BasicBlock * getIncomingBlock(unsigned i) const</div><div class="ttdoc">Return incoming basic block number i.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02814">Instructions.h:2814</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html_a85ffb6531d4cda988ea81f18d4e56fb7"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">llvm::ArrayRef::size</a></div><div class="ttdeci">size_t size() const</div><div class="ttdoc">size - Get the array size.</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00163">ArrayRef.h:163</a></div></div>
<div class="ttc" id="aTargetTransformInfo_8h_html"><div class="ttname"><a href="TargetTransformInfo_8h.html">TargetTransformInfo.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1iterator__range_html"><div class="ttname"><a href="classllvm_1_1iterator__range.html">llvm::iterator_range</a></div><div class="ttdoc">A range adaptor for a pair of iterators.</div><div class="ttdef"><b>Definition:</b> <a href="iterator__range_8h_source.html#l00030">iterator_range.h:30</a></div></div>
<div class="ttc" id="aclassllvm_1_1FunctionCallee_html"><div class="ttname"><a href="classllvm_1_1FunctionCallee.html">llvm::FunctionCallee</a></div><div class="ttdoc">A handy container for a FunctionType+Callee-pointer pair, which can be passed around as a single enti...</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00165">DerivedTypes.h:165</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html"><div class="ttname"><a href="classllvm_1_1PHINode.html">llvm::PHINode</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02708">Instructions.h:2708</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a8de021e28a3c04c9216ad8decf104f02"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">llvm::BasicBlock::getTerminator</a></div><div class="ttdeci">const Instruction * getTerminator() const LLVM_READONLY</div><div class="ttdoc">Returns the terminator instruction if the block is well formed or null if the block is not well forme...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00127">BasicBlock.h:127</a></div></div>
<div class="ttc" id="astructfalse_1_1RematerizlizationCandidateRecord_html"><div class="ttname"><a href="structfalse_1_1RematerizlizationCandidateRecord.html">false::RematerizlizationCandidateRecord</a></div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00291">RewriteStatepointsForGC.cpp:291</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html">llvm::SmallVectorImpl&lt; Value * &gt;</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html"><div class="ttname"><a href="classllvm_1_1CallBase.html">llvm::CallBase</a></div><div class="ttdoc">Base class for all callable instructions (InvokeInst and CallInst) Holds everything related to callin...</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01184">InstrTypes.h:1184</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a1553a166adb52e29e3a240dd37627ad9"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a1553a166adb52e29e3a240dd37627ad9">llvm::BasicBlock::getLandingPadInst</a></div><div class="ttdeci">const LandingPadInst * getLandingPadInst() const</div><div class="ttdoc">Return the landingpad instruction associated with the landing pad.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00517">BasicBlock.cpp:517</a></div></div>
<div class="ttc" id="aDerivedTypes_8h_html"><div class="ttname"><a href="DerivedTypes_8h.html">DerivedTypes.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallSetVector_html"><div class="ttname"><a href="classllvm_1_1SmallSetVector.html">llvm::SmallSetVector</a></div><div class="ttdoc">A SetVector that performs no allocations if smaller than a certain size.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00300">SetVector.h:300</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisManager_html"><div class="ttname"><a href="classllvm_1_1AnalysisManager.html">llvm::AnalysisManager</a></div><div class="ttdoc">A container for analyses that lazily runs them and caches their results.</div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8h_source.html#l00042">InstructionSimplify.h:42</a></div></div>
<div class="ttc" id="aclassllvm_1_1StringRef_html_a223dd14e7d12bc5cea01889b972a98b2"><div class="ttname"><a href="classllvm_1_1StringRef.html#a223dd14e7d12bc5cea01889b972a98b2">llvm::StringRef::str</a></div><div class="ttdeci">std::string str() const</div><div class="ttdoc">str - Get the contents as an std::string.</div><div class="ttdef"><b>Definition:</b> <a href="StringRef_8h_source.html#l00222">StringRef.h:222</a></div></div>
<div class="ttc" id="anamespacellvm_html_abba0f0474eb4e32d1ed7b6dfdb0d5140a8cf633e3cd4e8b21a16304c58495bfbc"><div class="ttname"><a href="namespacellvm.html#abba0f0474eb4e32d1ed7b6dfdb0d5140a8cf633e3cd4e8b21a16304c58495bfbc">llvm::StatepointFlags::DeoptLiveIn</a></div><div class="ttdeci">@ DeoptLiveIn</div><div class="ttdoc">Mark the deopt arguments associated with the statepoint as only being &quot;live-in&quot;.</div></div>
<div class="ttc" id="aclassllvm_1_1InnerAnalysisManagerProxy_html"><div class="ttname"><a href="classllvm_1_1InnerAnalysisManagerProxy.html">llvm::InnerAnalysisManagerProxy</a></div><div class="ttdoc">An analysis over an &quot;outer&quot; IR unit that provides access to an analysis manager over an &quot;inner&quot; IR un...</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00931">PassManager.h:931</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallInst_html"><div class="ttname"><a href="classllvm_1_1CallInst.html">llvm::CallInst</a></div><div class="ttdoc">This class represents a function call, abstracting a target machine's calling convention.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01485">Instructions.h:1485</a></div></div>
<div class="ttc" id="alib_2CodeGen_2README_8txt_html_a09776db24cf586ec9f1e18f3bae14099"><div class="ttname"><a href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a></div><div class="ttdeci">Common register allocation spilling lr str ldr sxth r3 ldr mla r4 can lr mov lr str ldr sxth r3 mla r4 and then merge mul and lr str ldr sxth r3 mla r4 It also increase the likelihood the store may become dead bb27 Successors according to LLVM BB</div><div class="ttdef"><b>Definition:</b> <a href="lib_2CodeGen_2README_8txt_source.html#l00039">README.txt:39</a></div></div>
<div class="ttc" id="aHexagonCommonGEP_8cpp_html_ad532e8710e50302e0a376b61c91fa91d"><div class="ttname"><a href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a></div><div class="ttdeci">Hexagon Common GEP</div><div class="ttdef"><b>Definition:</b> <a href="HexagonCommonGEP_8cpp_source.html#l00171">HexagonCommonGEP.cpp:171</a></div></div>
<div class="ttc" id="aclassllvm_1_1LiveVariables_html"><div class="ttname"><a href="classllvm_1_1LiveVariables.html">llvm::LiveVariables</a></div><div class="ttdef"><b>Definition:</b> <a href="LiveVariables_8h_source.html#l00047">LiveVariables.h:47</a></div></div>
<div class="ttc" id="aclassllvm_1_1UnreachableInst_html"><div class="ttname"><a href="classllvm_1_1UnreachableInst.html">llvm::UnreachableInst</a></div><div class="ttdoc">This function has undefined behavior.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l04773">Instructions.h:4773</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_acb0214b30fb2b9e1d6e1cf6cc851b3e5"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#acb0214b30fb2b9e1d6e1cf6cc851b3e5">suffixed_name_or</a></div><div class="ttdeci">static std::string suffixed_name_or(Value *V, StringRef Suffix, StringRef DefaultName)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00377">RewriteStatepointsForGC.cpp:377</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisUsage_html_ae5c60fd282ee894c87ea02c3f0fcb6d0"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">llvm::AnalysisUsage::addRequired</a></div><div class="ttdeci">AnalysisUsage &amp; addRequired()</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00075">PassAnalysisSupport.h:75</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_ae4bde92835730133920c426289e5d59b"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#ae4bde92835730133920c426289e5d59b">findLiveReferences</a></div><div class="ttdeci">static void findLiveReferences(Function &amp;F, DominatorTree &amp;DT, ArrayRef&lt; CallBase * &gt; toUpdate, MutableArrayRef&lt; struct PartiallyConstructedSafepointRecord &gt; records, GCStrategy *GC)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l02283">RewriteStatepointsForGC.cpp:2283</a></div></div>
<div class="ttc" id="aLLVMContext_8h_html"><div class="ttname"><a href="LLVMContext_8h.html">LLVMContext.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1AllocaInst_html"><div class="ttname"><a href="classllvm_1_1AllocaInst.html">llvm::AllocaInst</a></div><div class="ttdoc">an instruction to allocate memory on the stack</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00058">Instructions.h:58</a></div></div>
<div class="ttc" id="astructfalse_1_1PartiallyConstructedSafepointRecord_html_a0c847ecc206da763ea4a650ea9e8d6c4"><div class="ttname"><a href="structfalse_1_1PartiallyConstructedSafepointRecord.html#a0c847ecc206da763ea4a650ea9e8d6c4">false::PartiallyConstructedSafepointRecord::RematerializedValues</a></div><div class="ttdeci">RematerializedValueMapTy RematerializedValues</div><div class="ttdoc">Record live values we are rematerialized instead of relocating.</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00288">RewriteStatepointsForGC.cpp:288</a></div></div>
<div class="ttc" id="astructllvm_1_1RewriteStatepointsForGC_html_af56b6dd2da7f65fa682eaf6a16cdb36a"><div class="ttname"><a href="structllvm_1_1RewriteStatepointsForGC.html#af56b6dd2da7f65fa682eaf6a16cdb36a">llvm::RewriteStatepointsForGC::run</a></div><div class="ttdeci">PreservedAnalyses run(Module &amp;M, ModuleAnalysisManager &amp;AM)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00134">RewriteStatepointsForGC.cpp:134</a></div></div>
<div class="ttc" id="araw__ostream_8h_html"><div class="ttname"><a href="raw__ostream_8h.html">raw_ostream.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html"><div class="ttname"><a href="classllvm_1_1SetVector.html">llvm::SetVector&lt; Value * &gt;</a></div></div>
<div class="ttc" id="anamespacellvm_1_1CallingConv_html_a5b166ae228ebbfdb96736d6022f3feeda94ec9273479164e4aec1d5d91b71dc85"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a5b166ae228ebbfdb96736d6022f3feeda94ec9273479164e4aec1d5d91b71dc85">llvm::CallingConv::Cold</a></div><div class="ttdeci">@ Cold</div><div class="ttdoc">Attempts to make code in the caller as efficient as possible under the assumption that the call is no...</div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00047">CallingConv.h:47</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantAggregateZero_html_abfa1cf8b4348407b167f93bc7c01055f"><div class="ttname"><a href="classllvm_1_1ConstantAggregateZero.html#abfa1cf8b4348407b167f93bc7c01055f">llvm::ConstantAggregateZero::get</a></div><div class="ttdeci">static ConstantAggregateZero * get(Type *Ty)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01595">Constants.cpp:1595</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_a499ea32ca1b8d16cedfe01d1e5b08f29"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a499ea32ca1b8d16cedfe01d1e5b08f29">llvm::SmallVectorImpl::reserve</a></div><div class="ttdeci">void reserve(size_type N)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00667">SmallVector.h:667</a></div></div>
<div class="ttc" id="aBasicBlockUtils_8h_html"><div class="ttname"><a href="BasicBlockUtils_8h.html">BasicBlockUtils.h</a></div></div>
<div class="ttc" id="anamespacefalse_html_afaa1384eeb44548e3d6b1324ebc65c3c"><div class="ttname"><a href="namespacefalse.html#afaa1384eeb44548e3d6b1324ebc65c3c">false::StatepointLiveSetTy</a></div><div class="ttdeci">SetVector&lt; Value * &gt; StatepointLiveSetTy</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00269">RewriteStatepointsForGC.cpp:269</a></div></div>
<div class="ttc" id="aclassllvm_1_1AttributeList_html_a90024ee48918b2167a4c9409750d4148"><div class="ttname"><a href="classllvm_1_1AttributeList.html#a90024ee48918b2167a4c9409750d4148">llvm::AttributeList::getFnAttr</a></div><div class="ttdeci">Attribute getFnAttr(Attribute::AttrKind Kind) const</div><div class="ttdoc">Return the attribute object that exists for the function.</div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8h_source.html#l00823">Attributes.h:823</a></div></div>
<div class="ttc" id="aValue_8h_html"><div class="ttname"><a href="Value_8h.html">Value.h</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a2bf12026ed9de594d2117077b422c24d"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a2bf12026ed9de594d2117077b422c24d">stripNonValidDataFromBody</a></div><div class="ttdeci">static void stripNonValidDataFromBody(Function &amp;F)</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l02989">RewriteStatepointsForGC.cpp:2989</a></div></div>
<div class="ttc" id="aInitializePasses_8h_html"><div class="ttname"><a href="InitializePasses_8h.html">InitializePasses.h</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_af706759f2159b0a0573c72456c55c828"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#af706759f2159b0a0573c72456c55c828">findBaseOrBDV</a></div><div class="ttdeci">static Value * findBaseOrBDV(Value *I, DefiningValueMapTy &amp;Cache, IsKnownBaseMapTy &amp;KnownBases)</div><div class="ttdoc">Return a base pointer for this value if known.</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00713">RewriteStatepointsForGC.cpp:713</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html"><div class="ttname"><a href="classllvm_1_1Value.html">llvm::Value</a></div><div class="ttdoc">LLVM Value Representation.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00074">Value.h:74</a></div></div>
<div class="ttc" id="aRewriteStatepointsForGC_8cpp_html_a2f8133c8c84fda25efb484e4752d54b8"><div class="ttname"><a href="RewriteStatepointsForGC_8cpp.html#a2f8133c8c84fda25efb484e4752d54b8">PrintBasePointers</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; PrintBasePointers(&quot;spp-print-base-pointers&quot;, cl::Hidden, cl::init(false))</div></div>
<div class="ttc" id="aDebug_8h_html"><div class="ttname"><a href="Debug_8h.html">Debug.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLibraryAnalysis_html"><div class="ttname"><a href="classllvm_1_1TargetLibraryAnalysis.html">llvm::TargetLibraryAnalysis</a></div><div class="ttdoc">Analysis pass providing the TargetLibraryInfo.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLibraryInfo_8h_source.html#l00540">TargetLibraryInfo.h:540</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_ab4e0512c7e1c7adaa56677e3155685f1"><div class="ttname"><a href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">llvm::Value::users</a></div><div class="ttdeci">iterator_range&lt; user_iterator &gt; users()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00421">Value.h:421</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html_a7ca5197533a9c1fb8a2bd30587fcec6b"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#a7ca5197533a9c1fb8a2bd30587fcec6b">llvm::ArrayRef::end</a></div><div class="ttdeci">iterator end() const</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00152">ArrayRef.h:152</a></div></div>
<div class="ttc" id="aclassllvm_1_1AttributeList_html_a5269e6b95f5007a652d53ca847cca6f3"><div class="ttname"><a href="classllvm_1_1AttributeList.html#a5269e6b95f5007a652d53ca847cca6f3">llvm::AttributeList::isEmpty</a></div><div class="ttdeci">bool isEmpty() const</div><div class="ttdoc">Return true if there are no attributes.</div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8h_source.html#l00942">Attributes.h:942</a></div></div>
<div class="ttc" id="aSetVector_8h_html"><div class="ttname"><a href="SetVector_8h.html">SetVector.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1sampleprof_html_a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41"><div class="ttname"><a href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">llvm::sampleprof::Base</a></div><div class="ttdeci">@ Base</div><div class="ttdef"><b>Definition:</b> <a href="Discriminator_8h_source.html#l00058">Discriminator.h:58</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_a0851b4de29686e9c3918449b054cfada"><div class="ttname"><a href="classllvm_1_1CallBase.html#a0851b4de29686e9c3918449b054cfada">llvm::CallBase::setCallingConv</a></div><div class="ttdeci">void setCallingConv(CallingConv::ID CC)</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01469">InstrTypes.h:1469</a></div></div>
<div class="ttc" id="aclassllvm_1_1Use_html"><div class="ttname"><a href="classllvm_1_1Use.html">llvm::Use</a></div><div class="ttdoc">A Use represents the edge between a Value definition and its users.</div><div class="ttdef"><b>Definition:</b> <a href="Use_8h_source.html#l00043">Use.h:43</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_a396fcfee6914c76974b73c3d203da6a5"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">llvm::SmallVectorImpl::emplace_back</a></div><div class="ttdeci">reference emplace_back(ArgTypes &amp;&amp;... Args)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00941">SmallVector.h:941</a></div></div>
<div class="ttc" id="aSmallSet_8h_html"><div class="ttname"><a href="SmallSet_8h.html">SmallSet.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1Intrinsic_html_a80add6b3b1cdaec560907995127adc16"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">llvm::Intrinsic::ID</a></div><div class="ttdeci">unsigned ID</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00039">TargetTransformInfo.h:39</a></div></div>
<div class="ttc" id="aGCStrategy_8h_html"><div class="ttname"><a href="GCStrategy_8h.html">GCStrategy.h</a></div></div>
<div class="ttc" id="anamespacefalse_html_a63e6cab42597b0c6d4c6826a9a44dd59"><div class="ttname"><a href="namespacefalse.html#a63e6cab42597b0c6d4c6826a9a44dd59">false::RematCandTy</a></div><div class="ttdeci">MapVector&lt; Value *, RematerizlizationCandidateRecord &gt; RematCandTy</div><div class="ttdef"><b>Definition:</b> <a href="RewriteStatepointsForGC_8cpp_source.html#l00299">RewriteStatepointsForGC.cpp:299</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 7 2023 10:34:49 for LLVM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
