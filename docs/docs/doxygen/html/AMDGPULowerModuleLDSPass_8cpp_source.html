<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: lib/Target/AMDGPU/AMDGPULowerModuleLDSPass.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LLVM
   &#160;<span id="projectnumber">17.0.0git</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_794e483eb1cc7921d35fd149d9cc325b.html">Target</a></li><li class="navelem"><a class="el" href="dir_447ce995d6e35417de5ec3060e97c93e.html">AMDGPU</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">AMDGPULowerModuleLDSPass.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="AMDGPULowerModuleLDSPass_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===-- AMDGPULowerModuleLDSPass.cpp ------------------------------*- C++ -*-=//</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// See https://llvm.org/LICENSE.txt for license information.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// This pass eliminates local data store, LDS, uses from non-kernel functions.</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// LDS is contiguous memory allocated per kernel execution.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// Background.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">// The programming model is global variables, or equivalently function local</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">// static variables, accessible from kernels or other functions. For uses from</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">// kernels this is straightforward - assign an integer to the kernel for the</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">// memory required by all the variables combined, allocate them within that.</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">// For uses from functions there are performance tradeoffs to choose between.</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">// This model means the GPU runtime can specify the amount of memory allocated.</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">// If this is more than the kernel assumed, the excess can be made available</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">// using a language specific feature, which IR represents as a variable with</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">// no initializer. This feature is not yet implemented for non-kernel functions.</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">// This lowering could be extended to handle that use case, but would probably</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">// require closer integration with promoteAllocaToLDS.</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">// Consequences of this GPU feature:</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">// - memory is limited and exceeding it halts compilation</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">// - a global accessed by one kernel exists independent of other kernels</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">// - a global exists independent of simultaneous execution of the same kernel</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">// - the address of the global may be different from different kernels as they</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">//   do not alias, which permits only allocating variables they use</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">// - if the address is allowed to differ, functions need help to find it</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">// Uses from kernels are implemented here by grouping them in a per-kernel</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">// struct instance. This duplicates the variables, accurately modelling their</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">// aliasing properties relative to a single global representation. It also</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">// permits control over alignment via padding.</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">// Uses from functions are more complicated and the primary purpose of this</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">// IR pass. Several different lowering are chosen between to meet requirements</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">// to avoid allocating any LDS where it is not necessary, as that impacts</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">// occupancy and may fail the compilation, while not imposing overhead on a</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">// feature whose primary advantage over global memory is performance. The basic</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">// design goal is to avoid one kernel imposing overhead on another.</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">// Implementation.</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">// LDS variables with constant annotation or non-undef initializer are passed</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">// through unchanged for simplification or error diagnostics in later passes.</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">// Non-undef initializers are not yet implemented for LDS.</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">// LDS variables that are always allocated at the same address can be found</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">// by lookup at that address. Otherwise runtime information/cost is required.</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">// The simplest strategy possible is to group all LDS variables in a single</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">// struct and allocate that struct in every kernel such that the original</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">// variables are always at the same address. LDS is however a limited resource</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">// so this strategy is unusable in practice. It is not implemented here.</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">// Strategy | Precise allocation | Zero runtime cost | General purpose |</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">//  --------+--------------------+-------------------+-----------------+</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">//   Module |                 No |               Yes |             Yes |</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">//    Table |                Yes |                No |             Yes |</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">//   Kernel |                Yes |               Yes |              No |</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">//   Hybrid |                Yes |           Partial |             Yes |</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">// Module spends LDS memory to save cycles. Table spends cycles and global</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">// memory to save LDS. Kernel is as fast as kernel allocation but only works</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">// for variables that are known reachable from a single kernel. Hybrid picks</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">// between all three. When forced to choose between LDS and cycles it minimises</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">// LDS use.</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160; </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">// The &quot;module&quot; lowering implemented here finds LDS variables which are used by</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">// non-kernel functions and creates a new struct with a field for each of those</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">// LDS variables. Variables that are only used from kernels are excluded.</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">// Kernels that do not use this struct are annoteated with the attribute</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">// amdgpu-elide-module-lds which allows the back end to elide the allocation.</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">// The &quot;table&quot; lowering implemented here has three components.</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">// First kernels are assigned a unique integer identifier which is available in</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">// functions it calls through the intrinsic amdgcn_lds_kernel_id. The integer</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">// is passed through a specific SGPR, thus works with indirect calls.</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">// Second, each kernel allocates LDS variables independent of other kernels and</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">// writes the addresses it chose for each variable into an array in consistent</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">// order. If the kernel does not allocate a given variable, it writes undef to</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">// the corresponding array location. These arrays are written to a constant</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">// table in the order matching the kernel unique integer identifier.</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">// Third, uses from non-kernel functions are replaced with a table lookup using</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">// the intrinsic function to find the address of the variable.</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">// &quot;Kernel&quot; lowering is only applicable for variables that are unambiguously</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">// reachable from exactly one kernel. For those cases, accesses to the variable</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">// can be lowered to ConstantExpr address of a struct instance specific to that</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">// one kernel. This is zero cost in space and in compute. It will raise a fatal</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">// error on any variable that might be reachable from multiple kernels and is</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">// thus most easily used as part of the hybrid lowering strategy.</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">// Hybrid lowering is a mixture of the above. It uses the zero cost kernel</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">// lowering where it can. It lowers the variable accessed by the greatest</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">// number of kernels using the module strategy as that is free for the first</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">// variable. Any futher variables that can be lowered with the module strategy</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">// without incurring LDS memory overhead are. The remaining ones are lowered</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">// via table.</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">// Consequences</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">// - No heuristics or user controlled magic numbers, hybrid is the right choice</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">// - Kernels that don&#39;t use functions (or have had them all inlined) are not</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">//   affected by any lowering for kernels that do.</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">// - Kernels that don&#39;t make indirect function calls are not affected by those</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">//   that do.</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">// - Variables which are used by lots of kernels, e.g. those injected by a</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">//   language runtime in most kernels, are expected to have no overhead</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">// - Implementations that instantiate templates per-kernel where those templates</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">//   use LDS are expected to hit the &quot;Kernel&quot; lowering strategy</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">// - The runtime properties impose a cost in compiler implementation complexity</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160; </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AMDGPU_8h.html">AMDGPU.h</a>&quot;</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AMDGPUBaseInfo_8h.html">Utils/AMDGPUBaseInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AMDGPUMemoryUtils_8h.html">Utils/AMDGPUMemoryUtils.h</a>&quot;</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BitVector_8h.html">llvm/ADT/BitVector.h</a>&quot;</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DenseMap_8h.html">llvm/ADT/DenseMap.h</a>&quot;</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DenseSet_8h.html">llvm/ADT/DenseSet.h</a>&quot;</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="STLExtras_8h.html">llvm/ADT/STLExtras.h</a>&quot;</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SetOperations_8h.html">llvm/ADT/SetOperations.h</a>&quot;</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SetVector_8h.html">llvm/ADT/SetVector.h</a>&quot;</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CallGraph_8h.html">llvm/Analysis/CallGraph.h</a>&quot;</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constants_8h.html">llvm/IR/Constants.h</a>&quot;</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DerivedTypes_8h.html">llvm/IR/DerivedTypes.h</a>&quot;</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IRBuilder_8h.html">llvm/IR/IRBuilder.h</a>&quot;</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InlineAsm_8h.html">llvm/IR/InlineAsm.h</a>&quot;</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Instructions_8h.html">llvm/IR/Instructions.h</a>&quot;</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="preprocessor">#include &quot;llvm/IR/IntrinsicsAMDGPU.h&quot;</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MDBuilder_8h.html">llvm/IR/MDBuilder.h</a>&quot;</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InitializePasses_8h.html">llvm/InitializePasses.h</a>&quot;</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Pass_8h.html">llvm/Pass.h</a>&quot;</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CommandLine_8h.html">llvm/Support/CommandLine.h</a>&quot;</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Debug_8h.html">llvm/Support/Debug.h</a>&quot;</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="OptimizedStructLayout_8h.html">llvm/Support/OptimizedStructLayout.h</a>&quot;</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BasicBlockUtils_8h.html">llvm/Transforms/Utils/BasicBlockUtils.h</a>&quot;</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ModuleUtils_8h.html">llvm/Transforms/Utils/ModuleUtils.h</a>&quot;</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="preprocessor">#include &lt;tuple&gt;</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160; </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="preprocessor">#include &lt;cstdio&gt;</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno"><a class="line" href="AMDGPULowerModuleLDSPass_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">  150</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;amdgpu-lower-module-lds&quot;</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160; </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> SuperAlignLDSGlobals(</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="stringliteral">&quot;amdgpu-super-align-lds-globals&quot;</span>,</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Increase alignment of LDS if it is not on align boundary&quot;</span>),</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160; </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="keyword">enum class</span> LoweringKind { module, table, kernel, hybrid };</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;LoweringKind&gt;</a> LoweringKindLoc(</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="stringliteral">&quot;amdgpu-lower-module-lds-strategy&quot;</span>,</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Specify lowering strategy for function LDS access:&quot;</span>), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(LoweringKind::module),</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <a class="code" href="namespacellvm_1_1cl.html#a8fa743aa76b6902028f8a643dfb87171">cl::values</a>(</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <a class="code" href="CommandLine_8h.html#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(LoweringKind::table, <span class="stringliteral">&quot;table&quot;</span>, <span class="stringliteral">&quot;Lower via table lookup&quot;</span>),</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <a class="code" href="CommandLine_8h.html#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(LoweringKind::module, <span class="stringliteral">&quot;module&quot;</span>, <span class="stringliteral">&quot;Lower via module struct&quot;</span>),</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <a class="code" href="CommandLine_8h.html#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            LoweringKind::kernel, <span class="stringliteral">&quot;kernel&quot;</span>,</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            <span class="stringliteral">&quot;Lower variables reachable from one kernel, otherwise abort&quot;</span>),</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <a class="code" href="CommandLine_8h.html#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(LoweringKind::hybrid, <span class="stringliteral">&quot;hybrid&quot;</span>,</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                   <span class="stringliteral">&quot;Lower via mixture of above strategies&quot;</span>)));</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160; </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="keywordtype">bool</span> isKernelLDS(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="comment">// Some weirdness here. AMDGPU::isKernelCC does not call into</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="comment">// AMDGPU::isKernel with the calling conv, it instead calls into</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="comment">// isModuleEntryFunction which returns true for more calling conventions</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="comment">// than AMDGPU::isKernel does. There&#39;s a FIXME on AMDGPU::isKernel.</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="comment">// There&#39;s also a test that checks that the LDS lowering does not hit on</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="comment">// a graphics shader, denoted amdgpu_ps, so stay with the limited case.</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="comment">// Putting LDS in the name of the function to draw attention to this.</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1AMDGPU.html#a3cc437d6699fb55c69e78b5d0cad641d">AMDGPU::isKernel</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getCallingConv());</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;}</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160; </div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="keyword">class </span>AMDGPULowerModuleLDS : <span class="keyword">public</span> <a class="code" href="classllvm_1_1ModulePass.html">ModulePass</a> {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160; </div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  removeLocalVarsFromUsedLists(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>,</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                               <span class="keyword">const</span> <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;GlobalVariable *&gt;</a> &amp;LocalVars) {</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">// The verifier rejects used lists containing an inttoptr of a constant</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="comment">// so remove the variables from these lists before replaceAllUsesWith</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Constant *, 8&gt;</a> LocalVarsSet;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *<a class="code" href="namespacellvm_1_1lltok.html#af353621f14cb4b4b3af5ffaff84076b1ae36e00240f3d66893bba6244f341872b">LocalVar</a> : LocalVars)</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      LocalVarsSet.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(cast&lt;Constant&gt;(<a class="code" href="namespacellvm_1_1lltok.html#af353621f14cb4b4b3af5ffaff84076b1ae36e00240f3d66893bba6244f341872b">LocalVar</a>-&gt;stripPointerCasts()));</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160; </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <a class="code" href="namespacellvm.html#a93421534a6486ff3e80f748446756ce5">removeFromUsedLists</a>(</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, [&amp;LocalVarsSet](<a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>) { <span class="keywordflow">return</span> LocalVarsSet.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>); });</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *<a class="code" href="namespacellvm_1_1lltok.html#af353621f14cb4b4b3af5ffaff84076b1ae36e00240f3d66893bba6244f341872b">LocalVar</a> : LocalVars)</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      <a class="code" href="namespacellvm_1_1lltok.html#af353621f14cb4b4b3af5ffaff84076b1ae36e00240f3d66893bba6244f341872b">LocalVar</a>-&gt;removeDeadConstantUsers();</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  }</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160; </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> markUsedByKernel(<a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="classllvm_1_1Function.html">Function</a> *Func,</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                               <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *SGV) {</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="comment">// The llvm.amdgcn.module.lds instance is implicitly used by all kernels</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="comment">// that might call a function which accesses a field within it. This is</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="comment">// presently approximated to &#39;all kernels&#39; if there are any such functions</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="comment">// in the module. This implicit use is redefined as an explicit use here so</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="comment">// that later passes, specifically PromoteAlloca, account for the required</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="comment">// memory without any knowledge of this transform.</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160; </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="comment">// An operand bundle on llvm.donothing works because the call instruction</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="comment">// survives until after the last pass that needs to account for LDS. It is</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="comment">// better than inline asm as the latter survives until the end of codegen. A</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="comment">// totally robust solution would be a function with the same semantics as</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">// llvm.donothing that takes a pointer to the instance and is lowered to a</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">// no-op after LDS is allocated, but that is not presently necessary.</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx = Func-&gt;getContext();</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(Func-&gt;getEntryBlock().getFirstNonPHI());</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <a class="code" href="classllvm_1_1FunctionType.html">FunctionType</a> *FTy = <a class="code" href="classllvm_1_1FunctionType.html#a7e89b55242c964ae61b7850e99cacef0">FunctionType::get</a>(<a class="code" href="classllvm_1_1Type.html#a6e20e76960d952de088354cbcd14c3ab">Type::getVoidTy</a>(Ctx), {});</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160; </div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <a class="code" href="classllvm_1_1Function.html">Function</a> *Decl =</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <a class="code" href="namespacellvm_1_1Intrinsic.html#aefa39f6b622360ce4e947feb9f671b73">Intrinsic::getDeclaration</a>(Func-&gt;getParent(), Intrinsic::donothing, {});</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160; </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *UseInstance[1] = {<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateInBoundsGEP(</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        SGV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a29e0b1c558b350347e2652b35b26fea8">getValueType</a>(), SGV, <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(<a class="code" href="classllvm_1_1Type.html#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(Ctx), 0))};</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160; </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCall(FTy, Decl, {},</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                       {<a class="code" href="classllvm_1_1OperandBundleDefT.html">OperandBundleDefT&lt;Value *&gt;</a>(<span class="stringliteral">&quot;ExplicitUse&quot;</span>, UseInstance)},</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                       <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">bool</span> eliminateConstantExprUsesOfLDSFromAllInstructions(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>) {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="comment">// Constants are uniqued within LLVM. A ConstantExpr referring to a LDS</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="comment">// global may have uses from multiple different functions as a result.</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="comment">// This pass specialises LDS variables with respect to the kernel that</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="comment">// allocates them.</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160; </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="comment">// This is semantically equivalent to:</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="comment">// for (auto &amp;F : M.functions())</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="comment">//   for (auto &amp;BB : F)</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="comment">//     for (auto &amp;I : BB)</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="comment">//       for (Use &amp;Op : I.operands())</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="comment">//         if (constantExprUsesLDS(Op))</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="comment">//           replaceConstantExprInFunction(I, Op);</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160; </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="comment">// Find all ConstantExpr that are direct users of an LDS global</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;ConstantExpr *&gt;</a> Stack;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;GV : <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.globals())</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1AMDGPU.html#a9a6f055381f5a946e37ab4d9e4a221d8">AMDGPU::isLDSVariableToLower</a>(GV))</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1User.html">User</a> *U : GV.<a class="code" href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">users</a>())</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;ConstantExpr&gt;(U))</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            Stack.push_back(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160; </div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="comment">// Expand to include constexpr users of direct users</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;ConstantExpr *&gt;</a> ConstExprUsersOfLDS;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordflow">while</span> (!Stack.empty()) {</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      <a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *V = Stack.pop_back_val();</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      <span class="keywordflow">if</span> (ConstExprUsersOfLDS.<a class="code" href="classllvm_1_1SetVector.html#a51469ab7f147668678a486661b02ae59">contains</a>(V))</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      ConstExprUsersOfLDS.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(V);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160; </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Nested : V-&gt;<a class="code" href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">users</a>())</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *CE = dyn_cast&lt;ConstantExpr&gt;(Nested))</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;          Stack.push_back(CE);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    }</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; </div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="comment">// Find all instructions that use any of the ConstExpr users of LDS</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;Instruction *&gt;</a> <a class="code" href="classllvm_1_1InstructionWorklist.html">InstructionWorklist</a>;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *CE : ConstExprUsersOfLDS)</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1User.html">User</a> *U : CE-&gt;users())</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(U))</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;          <a class="code" href="classllvm_1_1InstructionWorklist.html">InstructionWorklist</a>.insert(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160; </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="comment">// Replace those ConstExpr operands with instructions</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordflow">while</span> (!<a class="code" href="classllvm_1_1InstructionWorklist.html">InstructionWorklist</a>.empty()) {</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="classllvm_1_1InstructionWorklist.html">InstructionWorklist</a>.pop_back_val();</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U : <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands()) {</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <span class="keyword">auto</span> *BI = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Phi = dyn_cast&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;          <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = Phi-&gt;getIncomingBlock(U);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;          <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> It = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getFirstInsertionPt();</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(It != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;end() &amp;&amp; <span class="stringliteral">&quot;Unexpected empty basic block&quot;</span>);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;          BI = &amp;(*(It));</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        }</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;ConstantExpr&gt;(U.get())) {</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;          <span class="keywordflow">if</span> (ConstExprUsersOfLDS.contains(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>)) {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NI = <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getAsInstruction(BI);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            <a class="code" href="classllvm_1_1InstructionWorklist.html">InstructionWorklist</a>.insert(NI);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            U.set(NI);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;removeDeadConstantUsers();</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;          }</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        }</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      }</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    }</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160; </div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  }</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160; </div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; </div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  AMDGPULowerModuleLDS() : <a class="code" href="classllvm_1_1ModulePass.html">ModulePass</a>(<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>) {</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <a class="code" href="namespacellvm.html#a79a7b64538cabbf4054b62a0cecc0c09">initializeAMDGPULowerModuleLDSPass</a>(*<a class="code" href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  }</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160; </div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="keyword">using</span> FunctionVariableMap = <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Function *, DenseSet&lt;GlobalVariable *&gt;</a>&gt;;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160; </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="keyword">using</span> VariableFunctionMap = <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;GlobalVariable *, DenseSet&lt;Function *&gt;</a>&gt;;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160; </div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> getUsesOfLDSByFunction(<a class="code" href="classllvm_1_1CallGraph.html">CallGraph</a> <span class="keyword">const</span> &amp;CG, <a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>,</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                                     FunctionVariableMap &amp;kernels,</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                                     FunctionVariableMap &amp;<a class="code" href="AMDGPUPropagateAttributes_8cpp.html#a89aee22a588785ca0c0755b95871b79e">functions</a>) {</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="comment">// Get uses from the current function, excluding uses by called functions</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="comment">// Two output variables to avoid walking the globals list twice</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;GV : <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.globals()) {</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1AMDGPU.html#a9a6f055381f5a946e37ab4d9e4a221d8">AMDGPU::isLDSVariableToLower</a>(GV)) {</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      }</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160; </div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;User *, 16&gt;</a> Stack(GV.users());</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1User.html">User</a> *V : GV.<a class="code" href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">users</a>()) {</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V)) {</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;          <a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getFunction();</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;          <span class="keywordflow">if</span> (isKernelLDS(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)) {</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            kernels[<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>].insert(&amp;GV);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            <a class="code" href="AMDGPUPropagateAttributes_8cpp.html#a89aee22a588785ca0c0755b95871b79e">functions</a>[<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>].insert(&amp;GV);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;          }</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        }</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      }</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    }</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  }</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160; </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="keyword">struct </span>LDSUsesInfoTy {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    FunctionVariableMap direct_access;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    FunctionVariableMap indirect_access;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  };</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160; </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <span class="keyword">static</span> LDSUsesInfoTy getTransitiveUsesOfLDS(<a class="code" href="classllvm_1_1CallGraph.html">CallGraph</a> <span class="keyword">const</span> &amp;CG, <a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>) {</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160; </div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    FunctionVariableMap direct_map_kernel;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    FunctionVariableMap direct_map_function;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    getUsesOfLDSByFunction(CG, <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, direct_map_kernel, direct_map_function);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160; </div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="comment">// Collect variables that are used by functions whose address has escaped</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;GlobalVariable *&gt;</a> VariablesReachableThroughFunctionPointer;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.functions()) {</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <span class="keywordflow">if</span> (!isKernelLDS(&amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>))</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasAddressTaken(<span class="keyword">nullptr</span>,</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                                <span class="comment">/* IgnoreCallbackUses */</span> <span class="keyword">false</span>,</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                                <span class="comment">/* IgnoreAssumeLikeCalls */</span> <span class="keyword">false</span>,</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                                <span class="comment">/* IgnoreLLVMUsed */</span> <span class="keyword">true</span>,</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                                <span class="comment">/* IgnoreArcAttachedCall */</span> <span class="keyword">false</span>)) {</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;          <a class="code" href="namespacellvm.html#a8b4f88b1fadc8f51a643e5faaa13afa6">set_union</a>(VariablesReachableThroughFunctionPointer,</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                    direct_map_function[&amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>]);</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        }</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    }</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160; </div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="keyword">auto</span> functionMakesUnknownCall = [&amp;](<span class="keyword">const</span> <a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) -&gt; <span class="keywordtype">bool</span> {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;isDeclaration());</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1CallGraphNode.html#afe3782c535fa39673c4e160fcbdf1515">CallGraphNode::CallRecord</a> R : *CG[<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>]) {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <span class="keywordflow">if</span> (!R.second-&gt;getFunction()) {</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        }</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      }</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    };</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160; </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="comment">// Work out which variables are reachable through function calls</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    FunctionVariableMap transitive_map_function = direct_map_function;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160; </div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="comment">// If the function makes any unknown call, assume the worst case that it can</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="comment">// access all variables accessed by functions whose address escaped</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.functions()) {</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.isDeclaration() &amp;&amp; functionMakesUnknownCall(&amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)) {</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <span class="keywordflow">if</span> (!isKernelLDS(&amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)) {</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;          <a class="code" href="namespacellvm.html#a8b4f88b1fadc8f51a643e5faaa13afa6">set_union</a>(transitive_map_function[&amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>],</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                    VariablesReachableThroughFunctionPointer);</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        }</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      }</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    }</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160; </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="comment">// Direct implementation of collecting all variables reachable from each</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="comment">// function</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;Func : <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.functions()) {</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      <span class="keywordflow">if</span> (Func.isDeclaration() || isKernelLDS(&amp;Func))</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160; </div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;Function *&gt;</a> seen; <span class="comment">// catches cycles</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Function *, 4&gt;</a> wip{&amp;Func};</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160; </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      <span class="keywordflow">while</span> (!wip.empty()) {</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = wip.pop_back_val();</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160; </div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="comment">// Can accelerate this by referring to transitive map for functions that</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        <span class="comment">// have already been computed, with more care than this</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        <a class="code" href="namespacellvm.html#a8b4f88b1fadc8f51a643e5faaa13afa6">set_union</a>(transitive_map_function[&amp;Func], direct_map_function[<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>]);</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160; </div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1CallGraphNode.html#afe3782c535fa39673c4e160fcbdf1515">CallGraphNode::CallRecord</a> R : *CG[<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>]) {</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;          <a class="code" href="classllvm_1_1Function.html">Function</a> *ith = R.second-&gt;getFunction();</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;          <span class="keywordflow">if</span> (ith) {</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            <span class="keywordflow">if</span> (!seen.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(ith)) {</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;              seen.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a79eed48913651aeedda2eed25201ea84">insert</a>(ith);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;              wip.push_back(ith);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            }</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;          }</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        }</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      }</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    }</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160; </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="comment">// direct_map_kernel lists which variables are used by the kernel</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="comment">// find the variables which are used through a function call</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    FunctionVariableMap indirect_map_kernel;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;Func : <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.functions()) {</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      <span class="keywordflow">if</span> (Func.isDeclaration() || !isKernelLDS(&amp;Func))</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160; </div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1CallGraphNode.html#afe3782c535fa39673c4e160fcbdf1515">CallGraphNode::CallRecord</a> R : *CG[&amp;Func]) {</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        <a class="code" href="classllvm_1_1Function.html">Function</a> *ith = R.second-&gt;getFunction();</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="keywordflow">if</span> (ith) {</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;          <a class="code" href="namespacellvm.html#a8b4f88b1fadc8f51a643e5faaa13afa6">set_union</a>(indirect_map_kernel[&amp;Func], transitive_map_function[ith]);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;          <a class="code" href="namespacellvm.html#a8b4f88b1fadc8f51a643e5faaa13afa6">set_union</a>(indirect_map_kernel[&amp;Func],</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                    VariablesReachableThroughFunctionPointer);</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        }</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      }</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    }</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160; </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordflow">return</span> {<a class="code" href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">std::move</a>(direct_map_kernel), <a class="code" href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">std::move</a>(indirect_map_kernel)};</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160; </div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  <span class="keyword">struct </span>LDSVariableReplacement {</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *SGV = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;GlobalVariable *, Constant *&gt;</a> LDSVarsToConstantGEP;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  };</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160; </div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <span class="comment">// remap from lds global to a constantexpr gep to where it has been moved to</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <span class="comment">// for each kernel</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="comment">// an array with an element for each kernel containing where the corresponding</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="comment">// variable was remapped to</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160; </div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="keyword">static</span> <a class="code" href="classllvm_1_1Constant.html">Constant</a> *getAddressesOfVariablesInKernel(</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;      <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;GlobalVariable *&gt;</a> Variables,</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;GlobalVariable *, Constant *&gt;</a> &amp;LDSVarsToConstantGEP) {</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="comment">// Create a ConstantArray containing the address of each Variable within the</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="comment">// kernel corresponding to LDSVarsToConstantGEP, or poison if that kernel</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="comment">// does not allocate it</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="comment">// TODO: Drop the ptrtoint conversion</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160; </div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *I32 = <a class="code" href="classllvm_1_1Type.html#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(Ctx);</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160; </div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <a class="code" href="classllvm_1_1ArrayType.html">ArrayType</a> *KernelOffsetsType = <a class="code" href="classllvm_1_1ArrayType.html#adf411edc4f135b570ab218079474ce77">ArrayType::get</a>(I32, Variables.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160; </div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Constant *&gt;</a> Elements;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; Variables.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV = Variables[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      <span class="keywordflow">if</span> (LDSVarsToConstantGEP.<a class="code" href="classllvm_1_1DenseMapBase.html#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(GV) != 0) {</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="keyword">auto</span> elt = <a class="code" href="classllvm_1_1ConstantExpr.html#a652380f28d1a7011e05d0787b6024d48">ConstantExpr::getPtrToInt</a>(LDSVarsToConstantGEP[GV], I32);</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        Elements.push_back(elt);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        Elements.push_back(<a class="code" href="classllvm_1_1PoisonValue.html#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(I32));</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      }</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    }</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1ConstantArray.html#a0900dacdc7ad8e3ea0cc92993c7fd422">ConstantArray::get</a>(KernelOffsetsType, Elements);</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  }</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160; </div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="keyword">static</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *buildLookupTable(</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      <a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;GlobalVariable *&gt;</a> Variables,</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Function *&gt;</a> kernels,</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Function *, LDSVariableReplacement&gt;</a> &amp;KernelToReplacement) {</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keywordflow">if</span> (Variables.<a class="code" href="classllvm_1_1ArrayRef.html#ac835b8735b1b2faec0efdca236e37d94">empty</a>()) {</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    }</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx = <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.getContext();</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160; </div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> NumberVariables = Variables.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>();</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> NumberKernels = kernels.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>();</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160; </div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <a class="code" href="classllvm_1_1ArrayType.html">ArrayType</a> *KernelOffsetsType =</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <a class="code" href="classllvm_1_1ArrayType.html#adf411edc4f135b570ab218079474ce77">ArrayType::get</a>(<a class="code" href="classllvm_1_1Type.html#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(Ctx), NumberVariables);</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160; </div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <a class="code" href="classllvm_1_1ArrayType.html">ArrayType</a> *AllKernelsOffsetsType =</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <a class="code" href="classllvm_1_1ArrayType.html#adf411edc4f135b570ab218079474ce77">ArrayType::get</a>(KernelOffsetsType, NumberKernels);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160; </div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    std::vector&lt;Constant *&gt; overallConstantExprElts(NumberKernels);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; NumberKernels; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      LDSVariableReplacement Replacement = KernelToReplacement[kernels[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]];</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      overallConstantExprElts[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] = getAddressesOfVariablesInKernel(</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;          Ctx, Variables, Replacement.LDSVarsToConstantGEP);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    }</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160; </div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">init</a> =</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        <a class="code" href="classllvm_1_1ConstantArray.html#a0900dacdc7ad8e3ea0cc92993c7fd422">ConstantArray::get</a>(AllKernelsOffsetsType, overallConstantExprElts);</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a>(</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, AllKernelsOffsetsType, <span class="keyword">true</span>, <a class="code" href="classllvm_1_1GlobalValue.html#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">init</a>,</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="stringliteral">&quot;llvm.amdgcn.lds.offset.table&quot;</span>, <span class="keyword">nullptr</span>, <a class="code" href="classllvm_1_1GlobalValue.html#a05c6b3b9372b56d130e005db4837da62a7483b56cbb22b39c485b4648ea3374b0">GlobalValue::NotThreadLocal</a>,</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <a class="code" href="namespacellvm_1_1AMDGPUAS.html#ab1843c6566c95d94d6e36a857b8d2b3faa6d3112da64eecbdbb50aacb5f8251e8">AMDGPUAS::CONSTANT_ADDRESS</a>);</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  }</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160; </div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <span class="keywordtype">void</span> replaceUsesInInstructionsWithTableLookup(</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      <a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;GlobalVariable *&gt;</a> ModuleScopeVariables,</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *LookupTable) {</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160; </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx = <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.getContext();</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(Ctx);</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *I32 = <a class="code" href="classllvm_1_1Type.html#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(Ctx);</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="comment">// Accesses from a function use the amdgcn_lds_kernel_id intrinsic which</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="comment">// lowers to a read from a live in register. Emit it once in the entry</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="comment">// block to spare deduplicating it later.</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160; </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Function *, Value *&gt;</a> tableKernelIndexCache;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="keyword">auto</span> getTableKernelIndex = [&amp;](<a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) -&gt; <a class="code" href="classllvm_1_1Value.html">Value</a> * {</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      <span class="keywordflow">if</span> (tableKernelIndexCache.<a class="code" href="classllvm_1_1DenseMapBase.html#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) == 0) {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx = <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.getContext();</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        <a class="code" href="classllvm_1_1FunctionType.html">FunctionType</a> *FTy = <a class="code" href="classllvm_1_1FunctionType.html#a7e89b55242c964ae61b7850e99cacef0">FunctionType::get</a>(<a class="code" href="classllvm_1_1Type.html#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(Ctx), {});</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <a class="code" href="classllvm_1_1Function.html">Function</a> *Decl =</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            <a class="code" href="namespacellvm_1_1Intrinsic.html#aefa39f6b622360ce4e947feb9f671b73">Intrinsic::getDeclaration</a>(&amp;<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, Intrinsic::amdgcn_lds_kernel_id, {});</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160; </div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a> =</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getEntryBlock().getFirstNonPHIOrDbgOrAlloca();</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = *<a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a>;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(&amp;<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160; </div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        tableKernelIndexCache[<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>] = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCall(FTy, Decl, {});</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      }</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160; </div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      <span class="keywordflow">return</span> tableKernelIndexCache[<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>];</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    };</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160; </div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a> = 0; <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a> &lt; ModuleScopeVariables.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(); <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>++) {</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      <span class="keyword">auto</span> *GV = ModuleScopeVariables[<a class="code" href="ELFObjHandler_8cpp.html#aef61945034b9431b804748fc317c5548">Index</a>];</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160; </div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U : <a class="code" href="namespacellvm.html#a8154638df88e4eaa568b67b23d463dac">make_early_inc_range</a>(GV-&gt;uses())) {</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(U.getUser());</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160; </div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *tableKernelIndex = getTableKernelIndex(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getFunction());</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160; </div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        <span class="comment">// So if the phi uses this value multiple times, what does this look</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        <span class="comment">// like?</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Phi = dyn_cast&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;          <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = Phi-&gt;getIncomingBlock(U);</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;          <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(&amp;(*(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getFirstInsertionPt())));</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;          <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        }</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160; </div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *GEPIdx[3] = {</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(I32, 0),</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            tableKernelIndex,</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;            <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(I32, <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>),</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        };</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160; </div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *Address = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateInBoundsGEP(</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;            LookupTable-&gt;getValueType(), LookupTable, GEPIdx, GV-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>());</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160; </div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *loaded = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateLoad(I32, Address);</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160; </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *replacement =</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntToPtr(loaded, GV-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), GV-&gt;getName());</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160; </div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        U.set(replacement);</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      }</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    }</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  }</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160; </div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  <span class="keyword">static</span> <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;Function *&gt;</a> kernelsThatIndirectlyAccessAnyOfPassedVariables(</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      <a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, LDSUsesInfoTy &amp;LDSUsesInfo,</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;GlobalVariable *&gt;</a> <span class="keyword">const</span> &amp;VariableSet) {</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160; </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;Function *&gt;</a> <a class="code" href="namespacellvm_1_1omp.html#ad0bfab3ccd7ff108ad4e4619d343f9a7">KernelSet</a>;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160; </div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordflow">if</span> (VariableSet.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a9a3c9d867ff6bde97841c2b7983f5c70">empty</a>()) <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1omp.html#ad0bfab3ccd7ff108ad4e4619d343f9a7">KernelSet</a>;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160; </div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;Func : <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.functions()) {</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      <span class="keywordflow">if</span> (Func.isDeclaration() || !isKernelLDS(&amp;Func))</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV : LDSUsesInfo.indirect_access[&amp;Func]) {</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <span class="keywordflow">if</span> (VariableSet.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(GV)) {</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;          <a class="code" href="namespacellvm_1_1omp.html#ad0bfab3ccd7ff108ad4e4619d343f9a7">KernelSet</a>.insert(&amp;Func);</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        }</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      }</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    }</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160; </div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1omp.html#ad0bfab3ccd7ff108ad4e4619d343f9a7">KernelSet</a>;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  }</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160; </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  <span class="keyword">static</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  chooseBestVariableForModuleStrategy(<span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                                      VariableFunctionMap &amp;LDSVars) {</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="comment">// Find the global variable with the most indirect uses from kernels</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160; </div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keyword">struct </span>CandidateTy {</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      <span class="keywordtype">size_t</span> UserCount = 0;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      <span class="keywordtype">size_t</span> Size = 0;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160; </div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      CandidateTy() = <span class="keywordflow">default</span>;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160; </div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      CandidateTy(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV, <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> UserCount, <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> AllocSize)</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;          : GV(GV), UserCount(UserCount), Size(AllocSize) {}</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160; </div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      <span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#a061b224a1a3c3486fd854e5009a858c9">operator&lt;</a>(<span class="keyword">const</span> CandidateTy &amp;<a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <span class="comment">// Fewer users makes module scope variable less attractive</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        <span class="keywordflow">if</span> (UserCount &lt; <a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.UserCount) {</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        }</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        <span class="keywordflow">if</span> (UserCount &gt; <a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.UserCount) {</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        }</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160; </div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <span class="comment">// Bigger makes module scope variable less attractive</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <span class="keywordflow">if</span> (Size &lt; <a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.Size) {</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        }</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160; </div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <span class="keywordflow">if</span> (Size &gt; <a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.Size) {</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        }</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160; </div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        <span class="comment">// Arbitrary but consistent</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        <span class="keywordflow">return</span> GV-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() &lt; <a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.GV-&gt;getName();</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      }</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    };</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160; </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    CandidateTy MostUsed;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160; </div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;K : LDSVars) {</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV = K.first;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <span class="keywordflow">if</span> (K.second.size() &lt;= 1) {</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        <span class="comment">// A variable reachable by only one kernel is best lowered with kernel</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        <span class="comment">// strategy</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      }</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      CandidateTy Candidate(GV, K.second.size(),</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                      <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a29e0b1c558b350347e2652b35b26fea8">getValueType</a>()).getFixedValue());</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      <span class="keywordflow">if</span> (MostUsed &lt; Candidate)</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        MostUsed = Candidate;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    }</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="keywordflow">return</span> MostUsed.GV;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  }</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160; </div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  <span class="keywordtype">bool</span> runOnModule(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>)<span class="keyword"> override </span>{</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx = <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.getContext();</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <a class="code" href="classllvm_1_1CallGraph.html">CallGraph</a> CG = <a class="code" href="classllvm_1_1CallGraph.html">CallGraph</a>(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>);</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="keywordtype">bool</span> Changed = superAlignLDSGlobals(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>);</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160; </div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    Changed |= eliminateConstantExprUsesOfLDSFromAllInstructions(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>);</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160; </div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    Changed = <span class="keyword">true</span>; <span class="comment">// todo: narrow this down</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160; </div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="comment">// For each kernel, what variables does it access directly or through</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="comment">// callees</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    LDSUsesInfoTy LDSUsesInfo = getTransitiveUsesOfLDS(CG, <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>);</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160; </div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <span class="comment">// For each variable accessed through callees, which kernels access it</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    VariableFunctionMap LDSToKernelsThatNeedToAccessItIndirectly;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;K : LDSUsesInfo.indirect_access) {</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      <a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = K.first;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isKernelLDS(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>));</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV : K.second) {</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        LDSToKernelsThatNeedToAccessItIndirectly[GV].insert(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      }</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    }</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160; </div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="comment">// Partition variables into the different strategies</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;GlobalVariable *&gt;</a> ModuleScopeVariables;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;GlobalVariable *&gt;</a> TableLookupVariables;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;GlobalVariable *&gt;</a> KernelAccessVariables;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160; </div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    {</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *HybridModuleRoot =</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;          LoweringKindLoc != LoweringKind::hybrid</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;              ? nullptr</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;              : chooseBestVariableForModuleStrategy(</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                    <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.getDataLayout(),</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                    LDSToKernelsThatNeedToAccessItIndirectly);</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160; </div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;Function *&gt;</a> <span class="keyword">const</span> EmptySet;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;Function *&gt;</a> <span class="keyword">const</span> &amp;HybridModuleRootKernels =</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;          HybridModuleRoot</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;              ? LDSToKernelsThatNeedToAccessItIndirectly[HybridModuleRoot]</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;              : EmptySet;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160; </div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;K : LDSToKernelsThatNeedToAccessItIndirectly) {</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        <span class="comment">// Each iteration of this loop assigns exactly one global variable to</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        <span class="comment">// exactly one of the implementation strategies.</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160; </div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV = K.first;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1AMDGPU.html#a9a6f055381f5a946e37ab4d9e4a221d8">AMDGPU::isLDSVariableToLower</a>(*GV));</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(K.second.size() != 0);</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160; </div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        <span class="keywordflow">switch</span> (LoweringKindLoc) {</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        <span class="keywordflow">case</span> LoweringKind::module:</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;          ModuleScopeVariables.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a79eed48913651aeedda2eed25201ea84">insert</a>(GV);</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160; </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        <span class="keywordflow">case</span> LoweringKind::table:</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;          TableLookupVariables.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a79eed48913651aeedda2eed25201ea84">insert</a>(GV);</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160; </div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        <span class="keywordflow">case</span> LoweringKind::kernel:</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;          <span class="keywordflow">if</span> (K.second.size() == 1) {</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;            KernelAccessVariables.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a79eed48913651aeedda2eed25201ea84">insert</a>(GV);</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;            <a class="code" href="namespacellvm.html#a7f2a3d4dcfee70225988aec53ff1e173">report_fatal_error</a>(</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                <span class="stringliteral">&quot;cannot lower LDS &#39;&quot;</span> + GV-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() +</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                <span class="stringliteral">&quot;&#39; to kernel access as it is reachable from multiple kernels&quot;</span>);</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;          }</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160; </div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        <span class="keywordflow">case</span> LoweringKind::hybrid: {</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;          <span class="keywordflow">if</span> (GV == HybridModuleRoot) {</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;            <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(K.second.size() != 1);</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            ModuleScopeVariables.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a79eed48913651aeedda2eed25201ea84">insert</a>(GV);</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (K.second.size() == 1) {</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;            KernelAccessVariables.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a79eed48913651aeedda2eed25201ea84">insert</a>(GV);</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a38740a7e3fde66312240ec2cbf003fc2">set_is_subset</a>(K.second, HybridModuleRootKernels)) {</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;            ModuleScopeVariables.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a79eed48913651aeedda2eed25201ea84">insert</a>(GV);</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;            TableLookupVariables.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a79eed48913651aeedda2eed25201ea84">insert</a>(GV);</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;          }</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        }</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        }</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      }</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160; </div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ModuleScopeVariables.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a9a025cb106832026cd05c2b4648a699f">size</a>() + TableLookupVariables.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a9a025cb106832026cd05c2b4648a699f">size</a>() +</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                 KernelAccessVariables.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a9a025cb106832026cd05c2b4648a699f">size</a>() ==</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;             LDSToKernelsThatNeedToAccessItIndirectly.size());</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    } <span class="comment">// Variables have now been partitioned into the three lowering strategies.</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160; </div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="comment">// If the kernel accesses a variable that is going to be stored in the</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="comment">// module instance through a call then that kernel needs to allocate the</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <span class="comment">// module instance</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;Function *&gt;</a> KernelsThatAllocateModuleLDS =</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        kernelsThatIndirectlyAccessAnyOfPassedVariables(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, LDSUsesInfo,</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                                                        ModuleScopeVariables);</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;Function *&gt;</a> KernelsThatAllocateTableLDS =</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        kernelsThatIndirectlyAccessAnyOfPassedVariables(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, LDSUsesInfo,</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;                                                        TableLookupVariables);</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160; </div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="keywordflow">if</span> (!ModuleScopeVariables.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a9a3c9d867ff6bde97841c2b7983f5c70">empty</a>()) {</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;      LDSVariableReplacement ModuleScopeReplacement =</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;          createLDSVariableReplacement(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, <span class="stringliteral">&quot;llvm.amdgcn.module.lds&quot;</span>,</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                                       ModuleScopeVariables);</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160; </div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      <a class="code" href="namespacellvm.html#aab730f72aa213d5ecc7d1101efda8811">appendToCompilerUsed</a>(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>,</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                           {<span class="keyword">static_cast&lt;</span><a class="code" href="classllvm_1_1GlobalValue.html">GlobalValue</a> *<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                               <a class="code" href="classllvm_1_1ConstantExpr.html#a28bf8984fbfb08fd27df435e631e6832">ConstantExpr::getPointerBitCastOrAddrSpaceCast</a>(</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                                   cast&lt;Constant&gt;(ModuleScopeReplacement.SGV),</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                                   <a class="code" href="classllvm_1_1Type.html#a7fe9ccd4893f4e2caa826126c09545ea">Type::getInt8PtrTy</a>(Ctx)))});</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160; </div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;      <span class="comment">// historic</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;      removeLocalVarsFromUsedLists(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, ModuleScopeVariables);</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160; </div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      <span class="comment">// Replace all uses of module scope variable from non-kernel functions</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;      replaceLDSVariablesWithStruct(</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;          <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, ModuleScopeVariables, ModuleScopeReplacement, [&amp;](<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U) {</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;            <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(U.<a class="code" href="classllvm_1_1Use.html#a50a2e57da274f8d69b9f932977379cdf">getUser</a>());</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;              <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            }</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            <a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getFunction();</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            <span class="keywordflow">return</span> !isKernelLDS(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;          });</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160; </div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      <span class="comment">// Replace uses of module scope variable from kernel functions that</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;      <span class="comment">// allocate the module scope variable, otherwise leave them unchanged</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      <span class="comment">// Record on each kernel whether the module scope global is used by it</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160; </div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;      <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx = <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.getContext();</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(Ctx);</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160; </div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;Func : <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.functions()) {</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <span class="keywordflow">if</span> (Func.isDeclaration() || !isKernelLDS(&amp;Func))</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160; </div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <span class="keywordflow">if</span> (KernelsThatAllocateModuleLDS.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(&amp;Func)) {</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;          replaceLDSVariablesWithStruct(</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;              <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, ModuleScopeVariables, ModuleScopeReplacement, [&amp;](<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U) {</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(U.<a class="code" href="classllvm_1_1Use.html#a50a2e57da274f8d69b9f932977379cdf">getUser</a>());</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;                <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;                  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                }</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;                <a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getFunction();</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> == &amp;Func;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;              });</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160; </div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;          markUsedByKernel(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, &amp;Func, ModuleScopeReplacement.SGV);</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160; </div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;          Func.addFnAttr(<span class="stringliteral">&quot;amdgpu-elide-module-lds&quot;</span>);</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        }</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;      }</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    }</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160; </div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <span class="comment">// Create a struct for each kernel for the non-module-scope variables</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Function *, LDSVariableReplacement&gt;</a> KernelToReplacement;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;Func : <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.functions()) {</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      <span class="keywordflow">if</span> (Func.isDeclaration() || !isKernelLDS(&amp;Func))</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160; </div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;GlobalVariable *&gt;</a> KernelUsedVariables;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;v : LDSUsesInfo.direct_access[&amp;Func]) {</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        KernelUsedVariables.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a79eed48913651aeedda2eed25201ea84">insert</a>(v);</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      }</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;v : LDSUsesInfo.indirect_access[&amp;Func]) {</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;        KernelUsedVariables.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a79eed48913651aeedda2eed25201ea84">insert</a>(v);</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;      }</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160; </div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;      <span class="comment">// Variables allocated in module lds must all resolve to that struct,</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;      <span class="comment">// not to the per-kernel instance.</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;      <span class="keywordflow">if</span> (KernelsThatAllocateModuleLDS.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(&amp;Func)) {</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *v : ModuleScopeVariables) {</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;          KernelUsedVariables.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#af972d87e15b5f6ed61bd5c3956c5213d">erase</a>(v);</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        }</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;      }</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160; </div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;      <span class="keywordflow">if</span> (KernelUsedVariables.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a9a3c9d867ff6bde97841c2b7983f5c70">empty</a>()) {</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        <span class="comment">// Either used no LDS, or all the LDS it used was also in module</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;      }</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160; </div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      <span class="comment">// The association between kernel function and LDS struct is done by</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;      <span class="comment">// symbol name, which only works if the function in question has a</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;      <span class="comment">// name This is not expected to be a problem in practice as kernels</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;      <span class="comment">// are called by name making anonymous ones (which are named by the</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;      <span class="comment">// backend) difficult to use. This does mean that llvm test cases need</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;      <span class="comment">// to name the kernels.</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;      <span class="keywordflow">if</span> (!Func.hasName()) {</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <a class="code" href="namespacellvm.html#a7f2a3d4dcfee70225988aec53ff1e173">report_fatal_error</a>(<span class="stringliteral">&quot;Anonymous kernels cannot use LDS variables&quot;</span>);</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;      }</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160; </div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;      std::string <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a218a3df235546fc092fe0f463e6b714d">VarName</a> =</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;          (<a class="code" href="classllvm_1_1Twine.html">Twine</a>(<span class="stringliteral">&quot;llvm.amdgcn.kernel.&quot;</span>) + Func.getName() + <span class="stringliteral">&quot;.lds&quot;</span>).str();</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160; </div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      <span class="keyword">auto</span> Replacement =</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;          createLDSVariableReplacement(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a218a3df235546fc092fe0f463e6b714d">VarName</a>, KernelUsedVariables);</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160; </div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      <span class="comment">// remove preserves existing codegen</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      removeLocalVarsFromUsedLists(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, KernelUsedVariables);</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      KernelToReplacement[&amp;Func] = Replacement;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160; </div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      <span class="comment">// Rewrite uses within kernel to the new struct</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      replaceLDSVariablesWithStruct(</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;          <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, KernelUsedVariables, Replacement, [&amp;Func](<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U) {</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;            <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(U.<a class="code" href="classllvm_1_1Use.html#a50a2e57da274f8d69b9f932977379cdf">getUser</a>());</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getFunction() == &amp;Func;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;          });</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    }</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160; </div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="comment">// Lower zero cost accesses to the kernel instances just created</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;GV : KernelAccessVariables) {</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;      <span class="keyword">auto</span> &amp;funcs = LDSToKernelsThatNeedToAccessItIndirectly[GV];</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(funcs.size() == 1); <span class="comment">// Only one kernel can access it</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;      LDSVariableReplacement Replacement =</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;          KernelToReplacement[*(funcs.begin())];</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160; </div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;      <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;GlobalVariable *&gt;</a> Vec;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;      Vec.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a79eed48913651aeedda2eed25201ea84">insert</a>(GV);</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160; </div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;      replaceLDSVariablesWithStruct(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, Vec, Replacement, [](<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U) {</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                                                           <span class="keywordflow">return</span> isa&lt;Instruction&gt;(U.<a class="code" href="classllvm_1_1Use.html#a50a2e57da274f8d69b9f932977379cdf">getUser</a>());</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;      });</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    }</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160; </div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="keywordflow">if</span> (!KernelsThatAllocateTableLDS.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a9a3c9d867ff6bde97841c2b7983f5c70">empty</a>()) {</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      <span class="comment">// Collect the kernels that allocate table lookup LDS</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;      std::vector&lt;Function *&gt; OrderedKernels;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;      {</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;Func : <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.functions()) {</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;          <span class="keywordflow">if</span> (Func.isDeclaration())</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;          <span class="keywordflow">if</span> (!isKernelLDS(&amp;Func))</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160; </div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;          <span class="keywordflow">if</span> (KernelsThatAllocateTableLDS.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(&amp;Func)) {</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;            <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Func.hasName()); <span class="comment">// else fatal error earlier</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;            OrderedKernels.push_back(&amp;Func);</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;          }</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        }</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160; </div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        <span class="comment">// Put them in an arbitrary but reproducible order</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        <a class="code" href="namespacellvm.html#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a>(OrderedKernels.begin(), OrderedKernels.end(),</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;                   [](<span class="keyword">const</span> <a class="code" href="classllvm_1_1Function.html">Function</a> *lhs, <span class="keyword">const</span> <a class="code" href="classllvm_1_1Function.html">Function</a> *rhs) -&gt; <span class="keywordtype">bool</span> {</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                     return lhs-&gt;getName() &lt; rhs-&gt;getName();</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                   });</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160; </div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        <span class="comment">// Annotate the kernels with their order in this vector</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx = <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.getContext();</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(Ctx);</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160; </div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        <span class="keywordflow">if</span> (OrderedKernels.size() &gt; UINT32_MAX) {</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;          <span class="comment">// 32 bit keeps it in one SGPR. &gt; 2**32 kernels won&#39;t fit on the GPU</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;          <a class="code" href="namespacellvm.html#a7f2a3d4dcfee70225988aec53ff1e173">report_fatal_error</a>(<span class="stringliteral">&quot;Unimplemented LDS lowering for &gt; 2**32 kernels&quot;</span>);</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        }</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160; </div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; OrderedKernels.size(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;          <a class="code" href="classllvm_1_1Metadata.html">Metadata</a> *AttrMDArgs[1] = {</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;              <a class="code" href="classllvm_1_1ConstantAsMetadata.html#a703ab6c3e14ff7565866468d731f537a">ConstantAsMetadata::get</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt32(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)),</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;          };</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;          OrderedKernels[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;setMetadata(<span class="stringliteral">&quot;llvm.amdgcn.lds.kernel.id&quot;</span>,</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                                         <a class="code" href="classllvm_1_1MDNode.html#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(Ctx, AttrMDArgs));</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160; </div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;          markUsedByKernel(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, OrderedKernels[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                           KernelToReplacement[OrderedKernels[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]].SGV);</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        }</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      }</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160; </div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;      <span class="comment">// The order must be consistent between lookup table and accesses to</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;      <span class="comment">// lookup table</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      std::vector&lt;GlobalVariable *&gt; TableLookupVariablesOrdered(</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;          TableLookupVariables.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#ad7dc7318244359268414719e0959346e">begin</a>(), TableLookupVariables.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a8cd802dcaed35e1f28ea3cbe4af4eff5">end</a>());</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      <a class="code" href="namespacellvm.html#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a>(TableLookupVariablesOrdered.begin(),</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                 TableLookupVariablesOrdered.end(),</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                 [](<span class="keyword">const</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *lhs, <span class="keyword">const</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *rhs) {</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                   return lhs-&gt;getName() &lt; rhs-&gt;getName();</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                 });</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160; </div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;      <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *LookupTable = buildLookupTable(</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;          <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, TableLookupVariablesOrdered, OrderedKernels, KernelToReplacement);</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;      replaceUsesInInstructionsWithTableLookup(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, TableLookupVariablesOrdered,</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;                                               LookupTable);</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    }</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160; </div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;GV : <a class="code" href="namespacellvm.html#a8154638df88e4eaa568b67b23d463dac">make_early_inc_range</a>(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.globals()))</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1AMDGPU.html#a9a6f055381f5a946e37ab4d9e4a221d8">AMDGPU::isLDSVariableToLower</a>(GV)) {</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160; </div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        <span class="comment">// probably want to remove from used lists</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        GV.removeDeadConstantUsers();</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        <span class="keywordflow">if</span> (GV.use_empty())</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;          GV.eraseFromParent();</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;      }</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160; </div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  }</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160; </div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  <span class="comment">// Increase the alignment of LDS globals if necessary to maximise the chance</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  <span class="comment">// that we can use aligned LDS instructions to access them.</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">bool</span> superAlignLDSGlobals(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>) {</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.getDataLayout();</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keywordflow">if</span> (!SuperAlignLDSGlobals) {</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;      <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    }</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160; </div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;GV : <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.globals()) {</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;      <span class="keywordflow">if</span> (GV.getType()-&gt;getPointerAddressSpace() != <a class="code" href="namespacellvm_1_1AMDGPUAS.html#ab1843c6566c95d94d6e36a857b8d2b3fa77b1c964e2ff99057bf5e75140457abe">AMDGPUAS::LOCAL_ADDRESS</a>) {</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;        <span class="comment">// Only changing alignment of LDS variables</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;      }</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;      <span class="keywordflow">if</span> (!GV.hasInitializer()) {</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        <span class="comment">// cuda/hip extern __shared__ variable, leave alignment alone</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      }</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160; </div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;      <a class="code" href="structllvm_1_1Align.html">Align</a> Alignment = <a class="code" href="namespacellvm_1_1AMDGPU.html#a4f422b014bb0d10d7e6e07d06035a77c">AMDGPU::getAlign</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, &amp;GV);</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      <a class="code" href="classllvm_1_1TypeSize.html">TypeSize</a> GVSize = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(GV.getValueType());</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160; </div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;      <span class="keywordflow">if</span> (GVSize &gt; 8) {</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        <span class="comment">// We might want to use a b96 or b128 load/store</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;        Alignment = <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(Alignment, <a class="code" href="ELFObjHandler_8cpp.html#a043cdaf7b89aaeeb127be5d93411637f">Align</a>(16));</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (GVSize &gt; 4) {</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        <span class="comment">// We might want to use a b64 load/store</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;        Alignment = <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(Alignment, <a class="code" href="ELFObjHandler_8cpp.html#a043cdaf7b89aaeeb127be5d93411637f">Align</a>(8));</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (GVSize &gt; 2) {</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        <span class="comment">// We might want to use a b32 load/store</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;        Alignment = <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(Alignment, <a class="code" href="ELFObjHandler_8cpp.html#a043cdaf7b89aaeeb127be5d93411637f">Align</a>(4));</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (GVSize &gt; 1) {</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        <span class="comment">// We might want to use a b16 load/store</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        Alignment = <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(Alignment, <a class="code" href="ELFObjHandler_8cpp.html#a043cdaf7b89aaeeb127be5d93411637f">Align</a>(2));</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;      }</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160; </div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;      <span class="keywordflow">if</span> (Alignment != <a class="code" href="namespacellvm_1_1AMDGPU.html#a4f422b014bb0d10d7e6e07d06035a77c">AMDGPU::getAlign</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, &amp;GV)) {</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        GV.setAlignment(Alignment);</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;      }</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    }</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  }</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160; </div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  <span class="keyword">static</span> LDSVariableReplacement createLDSVariableReplacement(</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;      <a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, std::string <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a218a3df235546fc092fe0f463e6b714d">VarName</a>,</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;      <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;GlobalVariable *&gt;</a> <span class="keyword">const</span> &amp;LDSVarsToTransform) {</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <span class="comment">// Create a struct instance containing LDSVarsToTransform and map from those</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <span class="comment">// variables to ConstantExprGEP</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    <span class="comment">// Variables may be introduced to meet alignment requirements. No aliasing</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    <span class="comment">// metadata is useful for these as they have no uses. Erased before return.</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160; </div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx = <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.getContext();</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.getDataLayout();</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!LDSVarsToTransform.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a9a3c9d867ff6bde97841c2b7983f5c70">empty</a>());</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160; </div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;OptimizedStructLayoutField, 8&gt;</a> LayoutFields;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    LayoutFields.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(LDSVarsToTransform.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a9a025cb106832026cd05c2b4648a699f">size</a>());</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    {</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;      <span class="comment">// The order of fields in this struct depends on the order of</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;      <span class="comment">// varables in the argument which varies when changing how they</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;      <span class="comment">// are identified, leading to spurious test breakage.</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;      std::vector&lt;GlobalVariable *&gt; Sorted(LDSVarsToTransform.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#ad7dc7318244359268414719e0959346e">begin</a>(),</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;                                           LDSVarsToTransform.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a8cd802dcaed35e1f28ea3cbe4af4eff5">end</a>());</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      <a class="code" href="namespacellvm.html#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a>(Sorted.begin(), Sorted.end(),</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                 [](<span class="keyword">const</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *lhs, <span class="keyword">const</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *rhs) {</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                   return lhs-&gt;getName() &lt; rhs-&gt;getName();</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;                 });</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV : Sorted) {</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        <a class="code" href="structllvm_1_1OptimizedStructLayoutField.html">OptimizedStructLayoutField</a> <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>(GV,</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;                                     <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(GV-&gt;getValueType()),</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;                                     <a class="code" href="namespacellvm_1_1AMDGPU.html#a4f422b014bb0d10d7e6e07d06035a77c">AMDGPU::getAlign</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, GV));</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;        LayoutFields.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      }</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    }</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160; </div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <a class="code" href="namespacellvm.html#aae35ec9b920ff3bb892cd872877a89fe">performOptimizedStructLayout</a>(LayoutFields);</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160; </div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    std::vector&lt;GlobalVariable *&gt; LocalVars;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    <a class="code" href="classllvm_1_1BitVector.html">BitVector</a> IsPaddingField;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    LocalVars.<a class="code" href="classllvm_1_1BitVector.html#a6940ad301a9c7053fdcb2acfbda169e5">reserve</a>(LDSVarsToTransform.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a9a025cb106832026cd05c2b4648a699f">size</a>()); <span class="comment">// will be at least this large</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    IsPaddingField.<a class="code" href="classllvm_1_1BitVector.html#a6940ad301a9c7053fdcb2acfbda169e5">reserve</a>(LDSVarsToTransform.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a9a025cb106832026cd05c2b4648a699f">size</a>());</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    {</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;      <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> CurrentOffset = 0;</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; LayoutFields.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) {</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;        <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *FGV = <span class="keyword">static_cast&lt;</span><a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *<span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;            <span class="keyword">const_cast&lt;</span><span class="keywordtype">void</span> *<span class="keyword">&gt;</span>(LayoutFields[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].Id));</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        <a class="code" href="structllvm_1_1Align.html">Align</a> DataAlign = LayoutFields[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].Alignment;</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160; </div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;        <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> DataAlignV = DataAlign.<a class="code" href="structllvm_1_1Align.html#a80735739b49cf97a491922c8f9af2cc1">value</a>();</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Rem = CurrentOffset % DataAlignV) {</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;          <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Padding = DataAlignV - Rem;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160; </div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;          <span class="comment">// Append an array of padding bytes to meet alignment requested</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;          <span class="comment">// Note (o +      (a - (o % a)) ) % a == 0</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;          <span class="comment">//      (offset + Padding       ) % align == 0</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160; </div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;          <a class="code" href="classllvm_1_1Type.html">Type</a> *ATy = <a class="code" href="classllvm_1_1ArrayType.html#adf411edc4f135b570ab218079474ce77">ArrayType::get</a>(<a class="code" href="classllvm_1_1Type.html#a7ba5de75f50bb4a4ba920698edf39b28">Type::getInt8Ty</a>(Ctx), Padding);</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;          LocalVars.push_back(<span class="keyword">new</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a>(</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;              <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, ATy, <span class="keyword">false</span>, <a class="code" href="classllvm_1_1GlobalValue.html#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>, <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(ATy),</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;              <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">nullptr</span>, <a class="code" href="classllvm_1_1GlobalValue.html#a05c6b3b9372b56d130e005db4837da62a7483b56cbb22b39c485b4648ea3374b0">GlobalValue::NotThreadLocal</a>, <a class="code" href="namespacellvm_1_1AMDGPUAS.html#ab1843c6566c95d94d6e36a857b8d2b3fa77b1c964e2ff99057bf5e75140457abe">AMDGPUAS::LOCAL_ADDRESS</a>,</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;              <span class="keyword">false</span>));</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;          IsPaddingField.<a class="code" href="classllvm_1_1BitVector.html#a78fbaa7c0fb39fae884cc54feb8c67da">push_back</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;          CurrentOffset += Padding;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;        }</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160; </div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;        LocalVars.push_back(FGV);</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;        IsPaddingField.<a class="code" href="classllvm_1_1BitVector.html#a78fbaa7c0fb39fae884cc54feb8c67da">push_back</a>(<span class="keyword">false</span>);</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;        CurrentOffset += LayoutFields[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].Size;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;      }</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    }</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160; </div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    std::vector&lt;Type *&gt; LocalVarTypes;</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    LocalVarTypes.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(LocalVars.size());</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    <a class="code" href="lib_2Target_2README_8txt.html#a69955d334349c9adad86cd95171dce4c">std::transform</a>(</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;        LocalVars.cbegin(), LocalVars.cend(), std::back_inserter(LocalVarTypes),</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;        [](<span class="keyword">const</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *V) -&gt; <a class="code" href="classllvm_1_1Type.html">Type</a> * { return V-&gt;getValueType(); });</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160; </div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <a class="code" href="classllvm_1_1StructType.html">StructType</a> *LDSTy = <a class="code" href="classllvm_1_1StructType.html#a82648246c07eb8a33f628eea28cb988c">StructType::create</a>(Ctx, LocalVarTypes, <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a218a3df235546fc092fe0f463e6b714d">VarName</a> + <span class="stringliteral">&quot;.t&quot;</span>);</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160; </div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <a class="code" href="structllvm_1_1Align.html">Align</a> StructAlign = <a class="code" href="namespacellvm_1_1AMDGPU.html#a4f422b014bb0d10d7e6e07d06035a77c">AMDGPU::getAlign</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, LocalVars[0]);</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160; </div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *SGV = <span class="keyword">new</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a>(</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;        <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, LDSTy, <span class="keyword">false</span>, <a class="code" href="classllvm_1_1GlobalValue.html#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>, <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(LDSTy),</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;        <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a218a3df235546fc092fe0f463e6b714d">VarName</a>, <span class="keyword">nullptr</span>, <a class="code" href="classllvm_1_1GlobalValue.html#a05c6b3b9372b56d130e005db4837da62a7483b56cbb22b39c485b4648ea3374b0">GlobalValue::NotThreadLocal</a>, <a class="code" href="namespacellvm_1_1AMDGPUAS.html#ab1843c6566c95d94d6e36a857b8d2b3fa77b1c964e2ff99057bf5e75140457abe">AMDGPUAS::LOCAL_ADDRESS</a>,</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;        <span class="keyword">false</span>);</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    SGV-&gt;<a class="code" href="classllvm_1_1GlobalObject.html#a49b398b1c83ef4d42c8f7756b443f61f">setAlignment</a>(StructAlign);</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160; </div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;GlobalVariable *, Constant *&gt;</a> Map;</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *I32 = <a class="code" href="classllvm_1_1Type.html#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(Ctx);</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; LocalVars.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) {</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;      <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV = LocalVars[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;      <a class="code" href="classllvm_1_1Constant.html">Constant</a> *GEPIdx[] = {<a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(I32, 0), <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(I32, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)};</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;      <a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a class="code" href="classllvm_1_1ConstantExpr.html#abae3f750ce4d2edcea30f08fe9e29721">ConstantExpr::getGetElementPtr</a>(LDSTy, SGV, GEPIdx, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;      <span class="keywordflow">if</span> (IsPaddingField[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]) {</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(GV-&gt;<a class="code" href="classllvm_1_1Value.html#a9d7de807ebdfe1819df3ff6cb0f16158">use_empty</a>());</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;        GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#ae0cf03d5de37330b1eb69dd22a1d5057">eraseFromParent</a>();</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;        Map[GV] = <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;      }</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    }</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Map.size() == LDSVarsToTransform.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a9a025cb106832026cd05c2b4648a699f">size</a>());</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    <span class="keywordflow">return</span> {SGV, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">std::move</a>(Map)};</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  }</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160; </div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> PredicateTy&gt;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;  <span class="keywordtype">void</span> replaceLDSVariablesWithStruct(</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      <a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;GlobalVariable *&gt;</a> <span class="keyword">const</span> &amp;LDSVarsToTransformArg,</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;      LDSVariableReplacement Replacement, PredicateTy <a class="code" href="namespacellvm_1_1PPC.html#a14028f7fe73a11dabc6583510cc0a355">Predicate</a>) {</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx = <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.getContext();</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.getDataLayout();</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160; </div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    <span class="comment">// A hack... we need to insert the aliasing info in a predictable order for</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    <span class="comment">// lit tests. Would like to have them in a stable order already, ideally the</span></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    <span class="comment">// same order they get allocated, which might mean an ordered set container</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    std::vector&lt;GlobalVariable *&gt; LDSVarsToTransform(</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;        LDSVarsToTransformArg.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#ad7dc7318244359268414719e0959346e">begin</a>(), LDSVarsToTransformArg.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a8cd802dcaed35e1f28ea3cbe4af4eff5">end</a>());</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    <a class="code" href="namespacellvm.html#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a>(LDSVarsToTransform.begin(), LDSVarsToTransform.end(),</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;               [](<span class="keyword">const</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *lhs, <span class="keyword">const</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *rhs) {</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;                 return lhs-&gt;getName() &lt; rhs-&gt;getName();</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;               });</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160; </div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <span class="comment">// Create alias.scope and their lists. Each field in the new structure</span></div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    <span class="comment">// does not alias with all other fields.</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;MDNode *&gt;</a> AliasScopes;</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Metadata *&gt;</a> NoAliasList;</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> NumberVars = LDSVarsToTransform.size();</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    <span class="keywordflow">if</span> (NumberVars &gt; 1) {</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;      <a class="code" href="classllvm_1_1MDBuilder.html">MDBuilder</a> MDB(Ctx);</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;      AliasScopes.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(NumberVars);</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;      <a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *<a class="code" href="CorrelatedValuePropagation_8cpp.html#aad75d6f4f14a7b791076c6785aa59be4">Domain</a> = MDB.<a class="code" href="classllvm_1_1MDBuilder.html#aa1408308630d4280bd656a54dc92af1d">createAnonymousAliasScopeDomain</a>();</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumberVars; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) {</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;        <a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *Scope = MDB.<a class="code" href="classllvm_1_1MDBuilder.html#ab3c477eaa7266e85f2a8caf885854e49">createAnonymousAliasScope</a>(<a class="code" href="CorrelatedValuePropagation_8cpp.html#aad75d6f4f14a7b791076c6785aa59be4">Domain</a>);</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;        AliasScopes.push_back(Scope);</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;      }</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;      NoAliasList.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a7efd1f0c1206d95e4fe01a9b49a57b82">append</a>(&amp;AliasScopes[1], AliasScopes.end());</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    }</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160; </div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    <span class="comment">// Replace uses of ith variable with a constantexpr to the corresponding</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    <span class="comment">// field of the instance that will be allocated by AMDGPUMachineFunction</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumberVars; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) {</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;      <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV = LDSVarsToTransform[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;      <a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = Replacement.LDSVarsToConstantGEP[GV];</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160; </div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;      GV-&gt;<a class="code" href="classllvm_1_1Value.html#a7e8dad1701aa6445be4a29f654b0473c">replaceUsesWithIf</a>(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, <a class="code" href="namespacellvm_1_1PPC.html#a14028f7fe73a11dabc6583510cc0a355">Predicate</a>);</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160; </div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;      <a class="code" href="classllvm_1_1APInt.html">APInt</a> APOff(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIndexTypeSizeInBits(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getType()), 0);</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;      <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;stripAndAccumulateInBoundsConstantOffsets(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, APOff);</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> <a class="code" href="namespacellvm.html#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = APOff.<a class="code" href="classllvm_1_1APInt.html#a217e0207d9cc8e046c2dccbf0e4bb198">getZExtValue</a>();</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160; </div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;      <a class="code" href="structllvm_1_1Align.html">Align</a> A =</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;          <a class="code" href="namespacellvm.html#acd6aa057934751aaac54e5c18bcc18eb">commonAlignment</a>(Replacement.SGV-&gt;getAlign().valueOrOne(), <a class="code" href="namespacellvm.html#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>);</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160; </div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        NoAliasList[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> - 1] = AliasScopes[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> - 1];</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;      <a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *NoAlias =</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;          NoAliasList.empty() ? nullptr : <a class="code" href="classllvm_1_1MDNode.html#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(Ctx, NoAliasList);</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;      <a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *AliasScope =</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;          AliasScopes.empty() ? nullptr : <a class="code" href="classllvm_1_1MDNode.html#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(Ctx, {AliasScopes[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]});</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160; </div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;      refineUsesAlignmentAndAA(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, A, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, AliasScope, NoAlias);</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    }</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;  }</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160; </div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  <span class="keywordtype">void</span> refineUsesAlignmentAndAA(<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, <a class="code" href="structllvm_1_1Align.html">Align</a> A, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;                                <a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *AliasScope, <a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *NoAlias,</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;                                <span class="keywordtype">unsigned</span> <a class="code" href="InstCombineMulDivRem_8cpp.html#a26e11e9c1ef55164b429eb9dc019f213">MaxDepth</a> = 5) {</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="InstCombineMulDivRem_8cpp.html#a26e11e9c1ef55164b429eb9dc019f213">MaxDepth</a> || (A == 1 &amp;&amp; !AliasScope))</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160; </div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1User.html">User</a> *U : <a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;users()) {</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(U)) {</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        <span class="keywordflow">if</span> (AliasScope &amp;&amp; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayReadOrWriteMemory()) {</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;          <a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *AS = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getMetadata(LLVMContext::MD_alias_scope);</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;          AS = (AS ? <a class="code" href="classllvm_1_1MDNode.html#a088247f165cc7e2ca9a3917adc0e75df">MDNode::getMostGenericAliasScope</a>(AS, AliasScope)</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;                   : AliasScope);</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;          <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;setMetadata(LLVMContext::MD_alias_scope, AS);</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160; </div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;          <a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *NA = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getMetadata(LLVMContext::MD_noalias);</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;          NA = (NA ? <a class="code" href="classllvm_1_1MDNode.html#acdbfda46c9837123ef7143244fc1f904">MDNode::intersect</a>(NA, NoAlias) : NoAlias);</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;          <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;setMetadata(LLVMContext::MD_noalias, NA);</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;        }</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;      }</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160; </div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *LI = dyn_cast&lt;LoadInst&gt;(U)) {</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;        LI-&gt;setAlignment(<a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(A, LI-&gt;getAlign()));</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;      }</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;StoreInst&gt;(U)) {</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getPointerOperand() == <a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>)</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;          <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;setAlignment(<a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(A, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getAlign()));</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;      }</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *AI = dyn_cast&lt;AtomicRMWInst&gt;(U)) {</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;        <span class="comment">// None of atomicrmw operations can work on pointers, but let&#39;s</span></div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;        <span class="comment">// check it anyway in case it will or we will process ConstantExpr.</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;        <span class="keywordflow">if</span> (AI-&gt;getPointerOperand() == <a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>)</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;          AI-&gt;setAlignment(<a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(A, AI-&gt;getAlign()));</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;      }</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *AI = dyn_cast&lt;AtomicCmpXchgInst&gt;(U)) {</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;        <span class="keywordflow">if</span> (AI-&gt;getPointerOperand() == <a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>)</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;          AI-&gt;setAlignment(<a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(A, AI-&gt;getAlign()));</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;      }</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = dyn_cast&lt;GetElementPtrInst&gt;(U)) {</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIndexTypeSizeInBits(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getType());</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;        <a class="code" href="classllvm_1_1APInt.html">APInt</a> Off(<a class="code" href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>, 0);</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getPointerOperand() == <a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>) {</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;          <a class="code" href="structllvm_1_1Align.html">Align</a> GA;</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;accumulateConstantOffset(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, Off))</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;            GA = <a class="code" href="namespacellvm.html#acd6aa057934751aaac54e5c18bcc18eb">commonAlignment</a>(A, Off.getLimitedValue());</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;          refineUsesAlignmentAndAA(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, GA, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, AliasScope, NoAlias,</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;                                   <a class="code" href="InstCombineMulDivRem_8cpp.html#a26e11e9c1ef55164b429eb9dc019f213">MaxDepth</a> - 1);</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        }</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;      }</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(U)) {</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::BitCast ||</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;            <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::AddrSpaceCast)</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;          refineUsesAlignmentAndAA(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, A, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, AliasScope, NoAlias, <a class="code" href="InstCombineMulDivRem_8cpp.html#a26e11e9c1ef55164b429eb9dc019f213">MaxDepth</a> - 1);</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;      }</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    }</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  }</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;};</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160; </div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;} <span class="comment">// namespace</span></div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46">AMDGPULowerModuleLDS::ID</a> = 0;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160; </div>
<div class="line"><a name="l01227"></a><span class="lineno"><a class="line" href="namespacellvm.html#a3586ce24bb38b6b30b9a7a36aea4f478"> 1227</a></span>&#160;<span class="keywordtype">char</span> &amp;<a class="code" href="namespacellvm.html#a3586ce24bb38b6b30b9a7a36aea4f478">llvm::AMDGPULowerModuleLDSID</a> = <a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46">AMDGPULowerModuleLDS::ID</a>;</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160; </div>
<div class="line"><a name="l01229"></a><span class="lineno"><a class="line" href="AMDGPULowerModuleLDSPass_8cpp.html#a07bc85014fb598026911582ea33f77a0"> 1229</a></span>&#160;<a class="code" href="AMDGPULowerModuleLDSPass_8cpp.html#a07bc85014fb598026911582ea33f77a0">INITIALIZE_PASS</a>(AMDGPULowerModuleLDS, <a class="code" href="AMDGPULowerModuleLDSPass_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a>,</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;                <span class="stringliteral">&quot;Lower uses of LDS variables from non-kernel functions&quot;</span>, <span class="keyword">false</span>,</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;                <span class="keyword">false</span>)</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160; </div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;<a class="code" href="classllvm_1_1ModulePass.html">ModulePass</a> *<a class="code" href="namespacellvm.html">llvm</a>::<a class="code" href="namespacellvm.html#aff0cc35b8ef4641e9cb52c8bddb44713">createAMDGPULowerModuleLDSPass</a>() {</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> AMDGPULowerModuleLDS();</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;}</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160; </div>
<div class="line"><a name="l01237"></a><span class="lineno"><a class="line" href="structllvm_1_1AMDGPULowerModuleLDSPass.html#a76be940af9a6ce8a688affa5368cd3cb"> 1237</a></span>&#160;<a class="code" href="classllvm_1_1PreservedAnalyses.html">PreservedAnalyses</a> <a class="code" href="structllvm_1_1AMDGPULowerModuleLDSPass.html#a76be940af9a6ce8a688affa5368cd3cb">AMDGPULowerModuleLDSPass::run</a>(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M,</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;                                                <a class="code" href="classllvm_1_1AnalysisManager.html">ModuleAnalysisManager</a> &amp;) {</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  <span class="keywordflow">return</span> AMDGPULowerModuleLDS().runOnModule(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>) ? <a class="code" href="classllvm_1_1PreservedAnalyses.html#a03797a73044a81cbc6a3409d6c72ee8f">PreservedAnalyses::none</a>()</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;                                               : <a class="code" href="classllvm_1_1PreservedAnalyses.html#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="alib_2Target_2README_8txt_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2README_8txt_source.html#l00029">README.txt:29</a></div></div>
<div class="ttc" id="aclassllvm_1_1PreservedAnalyses_html"><div class="ttname"><a href="classllvm_1_1PreservedAnalyses.html">llvm::PreservedAnalyses</a></div><div class="ttdoc">A set of analyses that are preserved following a run of a transformation pass.</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00152">PassManager.h:152</a></div></div>
<div class="ttc" id="aAMDGPUPropagateAttributes_8cpp_html_a89aee22a588785ca0c0755b95871b79e"><div class="ttname"><a href="AMDGPUPropagateAttributes_8cpp.html#a89aee22a588785ca0c0755b95871b79e">functions</a></div><div class="ttdeci">amdgpu propagate attributes Late propagate attributes from kernels to functions</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUPropagateAttributes_8cpp_source.html#l00196">AMDGPUPropagateAttributes.cpp:196</a></div></div>
<div class="ttc" id="aclassllvm_1_1GlobalVariable_html_ae0cf03d5de37330b1eb69dd22a1d5057"><div class="ttname"><a href="classllvm_1_1GlobalVariable.html#ae0cf03d5de37330b1eb69dd22a1d5057">llvm::GlobalVariable::eraseFromParent</a></div><div class="ttdeci">void eraseFromParent()</div><div class="ttdoc">eraseFromParent - This method unlinks 'this' from the containing module and deletes it.</div><div class="ttdef"><b>Definition:</b> <a href="Globals_8cpp_source.html#l00468">Globals.cpp:468</a></div></div>
<div class="ttc" id="aclassllvm_1_1BitVector_html_a78fbaa7c0fb39fae884cc54feb8c67da"><div class="ttname"><a href="classllvm_1_1BitVector.html#a78fbaa7c0fb39fae884cc54feb8c67da">llvm::BitVector::push_back</a></div><div class="ttdeci">void push_back(bool Val)</div><div class="ttdef"><b>Definition:</b> <a href="BitVector_8h_source.html#l00459">BitVector.h:459</a></div></div>
<div class="ttc" id="anamespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">This is an optimization pass for GlobalISel generic memory operations.</div><div class="ttdef"><b>Definition:</b> <a href="AddressRanges_8h_source.html#l00018">AddressRanges.h:18</a></div></div>
<div class="ttc" id="alib_2Target_2X86_2README_8txt_html_ac88fe1d3a61b056a4f64fbbb156a62ff"><div class="ttname"><a href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a></div><div class="ttdeci">We currently emits eax Perhaps this is what we really should generate is Is imull three or four cycles eax eax The current instruction priority is based on pattern complexity The former is more complex because it folds a load so the latter will not be emitted Perhaps we should use AddedComplexity to give LEA32r a higher priority We should always try to match LEA first since the LEA matching code does some estimate to determine whether the match is profitable if we care more about code then imull is better It s two bytes shorter than movl leal On a Pentium M</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2X86_2README_8txt_source.html#l00252">README.txt:252</a></div></div>
<div class="ttc" id="aREADME-SSE_8txt_html_abb4ce3bc3096a12d4b93460bf78bcf95"><div class="ttname"><a href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a></div><div class="ttdeci">into xmm2 addss xmm2 xmm1 xmm3 addss xmm3 movaps xmm0 unpcklps xmm0 ret seems silly when it could just be one addps Expand libm rounding functions main should enable SSE DAZ mode and other fast SSE modes Think about doing i64 math in SSE regs on x86 This testcase should have no SSE instructions in it</div><div class="ttdef"><b>Definition:</b> <a href="README-SSE_8txt_source.html#l00081">README-SSE.txt:81</a></div></div>
<div class="ttc" id="anamespacellvm_html_a38740a7e3fde66312240ec2cbf003fc2"><div class="ttname"><a href="namespacellvm.html#a38740a7e3fde66312240ec2cbf003fc2">llvm::set_is_subset</a></div><div class="ttdeci">bool set_is_subset(const S1Ty &amp;S1, const S2Ty &amp;S2)</div><div class="ttdoc">set_is_subset(A, B) - Return true iff A in B</div><div class="ttdef"><b>Definition:</b> <a href="SetOperations_8h_source.html#l00072">SetOperations.h:72</a></div></div>
<div class="ttc" id="aclassllvm_1_1DataLayout_html"><div class="ttname"><a href="classllvm_1_1DataLayout.html">llvm::DataLayout</a></div><div class="ttdoc">A parsed version of the target data layout string in and methods for querying it.</div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00110">DataLayout.h:110</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AArch64PACKey_html_abf4394f452bde3f544999858d71e4b46"><div class="ttname"><a href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46">llvm::AArch64PACKey::ID</a></div><div class="ttdeci">ID</div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00790">AArch64BaseInfo.h:790</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPUAS_html_ab1843c6566c95d94d6e36a857b8d2b3fa77b1c964e2ff99057bf5e75140457abe"><div class="ttname"><a href="namespacellvm_1_1AMDGPUAS.html#ab1843c6566c95d94d6e36a857b8d2b3fa77b1c964e2ff99057bf5e75140457abe">llvm::AMDGPUAS::LOCAL_ADDRESS</a></div><div class="ttdeci">@ LOCAL_ADDRESS</div><div class="ttdoc">Address space for local memory.</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPU_8h_source.html#l00377">AMDGPU.h:377</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a7fe9ccd4893f4e2caa826126c09545ea"><div class="ttname"><a href="classllvm_1_1Type.html#a7fe9ccd4893f4e2caa826126c09545ea">llvm::Type::getInt8PtrTy</a></div><div class="ttdeci">static PointerType * getInt8PtrTy(LLVMContext &amp;C, unsigned AS=0)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00293">Type.cpp:293</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a98c0a84a5dfa8bce341c829709f171e5"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">llvm::BasicBlock::iterator</a></div><div class="ttdeci">InstListType::iterator iterator</div><div class="ttdoc">Instruction iterators...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00087">BasicBlock.h:87</a></div></div>
<div class="ttc" id="aclassllvm_1_1ModulePass_html"><div class="ttname"><a href="classllvm_1_1ModulePass.html">llvm::ModulePass</a></div><div class="ttdoc">ModulePass class - This class is used to implement unstructured interprocedural optimizations and ana...</div><div class="ttdef"><b>Definition:</b> <a href="Pass_8h_source.html#l00248">Pass.h:248</a></div></div>
<div class="ttc" id="aSetOperations_8h_html"><div class="ttname"><a href="SetOperations_8h.html">SetOperations.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Function_html"><div class="ttname"><a href="classllvm_1_1Function.html">llvm::Function</a></div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00059">Function.h:59</a></div></div>
<div class="ttc" id="aclassllvm_1_1BitVector_html_a6940ad301a9c7053fdcb2acfbda169e5"><div class="ttname"><a href="classllvm_1_1BitVector.html#a6940ad301a9c7053fdcb2acfbda169e5">llvm::BitVector::reserve</a></div><div class="ttdeci">void reserve(unsigned N)</div><div class="ttdef"><b>Definition:</b> <a href="BitVector_8h_source.html#l00341">BitVector.h:341</a></div></div>
<div class="ttc" id="aPass_8h_html"><div class="ttname"><a href="Pass_8h.html">Pass.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_a8b4f88b1fadc8f51a643e5faaa13afa6"><div class="ttname"><a href="namespacellvm.html#a8b4f88b1fadc8f51a643e5faaa13afa6">llvm::set_union</a></div><div class="ttdeci">bool set_union(S1Ty &amp;S1, const S2Ty &amp;S2)</div><div class="ttdoc">set_union(A, B) - Compute A := A u B, return whether A changed.</div><div class="ttdef"><b>Definition:</b> <a href="SetOperations_8h_source.html#l00023">SetOperations.h:23</a></div></div>
<div class="ttc" id="anamespacellvm_1_1lltok_html_af353621f14cb4b4b3af5ffaff84076b1ae36e00240f3d66893bba6244f341872b"><div class="ttname"><a href="namespacellvm_1_1lltok.html#af353621f14cb4b4b3af5ffaff84076b1ae36e00240f3d66893bba6244f341872b">llvm::lltok::LocalVar</a></div><div class="ttdeci">@ LocalVar</div><div class="ttdef"><b>Definition:</b> <a href="LLToken_8h_source.html#l00442">LLToken.h:442</a></div></div>
<div class="ttc" id="aclassllvm_1_1GlobalValue_html_a05c6b3b9372b56d130e005db4837da62a7483b56cbb22b39c485b4648ea3374b0"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#a05c6b3b9372b56d130e005db4837da62a7483b56cbb22b39c485b4648ea3374b0">llvm::GlobalValue::NotThreadLocal</a></div><div class="ttdeci">@ NotThreadLocal</div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00192">GlobalValue.h:192</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector</a></div><div class="ttdoc">This is a 'vector' (really, a variable-sized array), optimized for the case when the array is small.</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l01199">SmallVector.h:1199</a></div></div>
<div class="ttc" id="aInlineAsm_8h_html"><div class="ttname"><a href="InlineAsm_8h.html">InlineAsm.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_a3586ce24bb38b6b30b9a7a36aea4f478"><div class="ttname"><a href="namespacellvm.html#a3586ce24bb38b6b30b9a7a36aea4f478">llvm::AMDGPULowerModuleLDSID</a></div><div class="ttdeci">char &amp; AMDGPULowerModuleLDSID</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPULowerModuleLDSPass_8cpp_source.html#l01227">AMDGPULowerModuleLDSPass.cpp:1227</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantExpr_html_abae3f750ce4d2edcea30f08fe9e29721"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#abae3f750ce4d2edcea30f08fe9e29721">llvm::ConstantExpr::getGetElementPtr</a></div><div class="ttdeci">static Constant * getGetElementPtr(Type *Ty, Constant *C, ArrayRef&lt; Constant * &gt; IdxList, bool InBounds=false, std::optional&lt; unsigned &gt; InRangeIndex=std::nullopt, Type *OnlyIfReducedTy=nullptr)</div><div class="ttdoc">Getelementptr form.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l01245">Constants.h:1245</a></div></div>
<div class="ttc" id="aclassllvm_1_1IRBuilder_html"><div class="ttname"><a href="classllvm_1_1IRBuilder.html">llvm::IRBuilder&lt;&gt;</a></div></div>
<div class="ttc" id="aclassllvm_1_1GlobalVariable_html"><div class="ttname"><a href="classllvm_1_1GlobalVariable.html">llvm::GlobalVariable</a></div><div class="ttdef"><b>Definition:</b> <a href="GlobalVariable_8h_source.html#l00039">GlobalVariable.h:39</a></div></div>
<div class="ttc" id="aclassllvm_1_1FunctionType_html_a7e89b55242c964ae61b7850e99cacef0"><div class="ttname"><a href="classllvm_1_1FunctionType.html#a7e89b55242c964ae61b7850e99cacef0">llvm::FunctionType::get</a></div><div class="ttdeci">static FunctionType * get(Type *Result, ArrayRef&lt; Type * &gt; Params, bool isVarArg)</div><div class="ttdoc">This static method is the primary way of constructing a FunctionType.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00363">Type.cpp:363</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallGraph_html"><div class="ttname"><a href="classllvm_1_1CallGraph.html">llvm::CallGraph</a></div><div class="ttdoc">The basic data container for the call graph of a Module of IR.</div><div class="ttdef"><b>Definition:</b> <a href="CallGraph_8h_source.html#l00072">CallGraph.h:72</a></div></div>
<div class="ttc" id="anamespacellvm_1_1tgtok_html_abbc5259d649363016626e2529fabe0c5a218a3df235546fc092fe0f463e6b714d"><div class="ttname"><a href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a218a3df235546fc092fe0f463e6b714d">llvm::tgtok::VarName</a></div><div class="ttdeci">@ VarName</div><div class="ttdef"><b>Definition:</b> <a href="TGLexer_8h_source.html#l00072">TGLexer.h:72</a></div></div>
<div class="ttc" id="anamespacellvm_1_1cl_html_a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6"><div class="ttname"><a href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">llvm::cl::Hidden</a></div><div class="ttdeci">@ Hidden</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00138">CommandLine.h:138</a></div></div>
<div class="ttc" id="aclassllvm_1_1PreservedAnalyses_html_a03797a73044a81cbc6a3409d6c72ee8f"><div class="ttname"><a href="classllvm_1_1PreservedAnalyses.html#a03797a73044a81cbc6a3409d6c72ee8f">llvm::PreservedAnalyses::none</a></div><div class="ttdeci">static PreservedAnalyses none()</div><div class="ttdoc">Convenience factory function for the empty preserved set.</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00155">PassManager.h:155</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html"><div class="ttname"><a href="classllvm_1_1Type.html">llvm::Type</a></div><div class="ttdoc">The instances of the Type class are immutable: once they are created, they are never changed.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00045">Type.h:45</a></div></div>
<div class="ttc" id="aDenseMap_8h_html"><div class="ttname"><a href="DenseMap_8h.html">DenseMap.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1OperandBundleDefT_html"><div class="ttname"><a href="classllvm_1_1OperandBundleDefT.html">llvm::OperandBundleDefT</a></div><div class="ttdoc">A container for an operand bundle being viewed as a set of values rather than a set of uses.</div><div class="ttdef"><b>Definition:</b> <a href="AutoUpgrade_8h_source.html#l00032">AutoUpgrade.h:32</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a53408c95a7bfb5443b43fb2134c3eb23"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a53408c95a7bfb5443b43fb2134c3eb23">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::count</a></div><div class="ttdeci">size_type count(const_arg_type_t&lt; KeyT &gt; Val) const</div><div class="ttdoc">Return 1 if the specified key is in the map, 0 otherwise.</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00145">DenseMap.h:145</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantAsMetadata_html_a703ab6c3e14ff7565866468d731f537a"><div class="ttname"><a href="classllvm_1_1ConstantAsMetadata.html#a703ab6c3e14ff7565866468d731f537a">llvm::ConstantAsMetadata::get</a></div><div class="ttdeci">static ConstantAsMetadata * get(Constant *C)</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8h_source.html#l00419">Metadata.h:419</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSet_html"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html">llvm::SmallPtrSet</a></div><div class="ttdoc">SmallPtrSet - This class implements a set which is optimized for holding SmallSize or less elements.</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00450">SmallPtrSet.h:450</a></div></div>
<div class="ttc" id="anamespacellvm_html_ab4d4bc901fedd8857f647dcc2c0d71de"><div class="ttname"><a href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">llvm::max</a></div><div class="ttdeci">Expected&lt; ExpressionValue &gt; max(const ExpressionValue &amp;Lhs, const ExpressionValue &amp;Rhs)</div><div class="ttdef"><b>Definition:</b> <a href="FileCheck_8cpp_source.html#l00337">FileCheck.cpp:337</a></div></div>
<div class="ttc" id="aSTLExtras_8h_html"><div class="ttname"><a href="STLExtras_8h.html">STLExtras.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayType_html"><div class="ttname"><a href="classllvm_1_1ArrayType.html">llvm::ArrayType</a></div><div class="ttdoc">Class to represent array types.</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00357">DerivedTypes.h:357</a></div></div>
<div class="ttc" id="aclassllvm_1_1StructType_html_a82648246c07eb8a33f628eea28cb988c"><div class="ttname"><a href="classllvm_1_1StructType.html#a82648246c07eb8a33f628eea28cb988c">llvm::StructType::create</a></div><div class="ttdeci">static StructType * create(LLVMContext &amp;Context, StringRef Name)</div><div class="ttdoc">This creates an identified struct.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00515">Type.cpp:515</a></div></div>
<div class="ttc" id="aclassllvm_1_1detail_1_1DenseSetImpl_html_a79eed48913651aeedda2eed25201ea84"><div class="ttname"><a href="classllvm_1_1detail_1_1DenseSetImpl.html#a79eed48913651aeedda2eed25201ea84">llvm::detail::DenseSetImpl::insert</a></div><div class="ttdeci">std::pair&lt; iterator, bool &gt; insert(const ValueT &amp;V)</div><div class="ttdef"><b>Definition:</b> <a href="DenseSet_8h_source.html#l00206">DenseSet.h:206</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a7ba5de75f50bb4a4ba920698edf39b28"><div class="ttname"><a href="classllvm_1_1Type.html#a7ba5de75f50bb4a4ba920698edf39b28">llvm::Type::getInt8Ty</a></div><div class="ttdeci">static IntegerType * getInt8Ty(LLVMContext &amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00239">Type.cpp:239</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a30dd396c5b40cd86c1591872e574ccdf"><div class="ttname"><a href="classllvm_1_1Type.html#a30dd396c5b40cd86c1591872e574ccdf">llvm::Type::getInt32Ty</a></div><div class="ttdeci">static IntegerType * getInt32Ty(LLVMContext &amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00241">Type.cpp:241</a></div></div>
<div class="ttc" id="aclassllvm_1_1MDBuilder_html_ab3c477eaa7266e85f2a8caf885854e49"><div class="ttname"><a href="classllvm_1_1MDBuilder.html#ab3c477eaa7266e85f2a8caf885854e49">llvm::MDBuilder::createAnonymousAliasScope</a></div><div class="ttdeci">MDNode * createAnonymousAliasScope(MDNode *Domain, StringRef Name=StringRef())</div><div class="ttdoc">Return metadata appropriate for an alias scope root node.</div><div class="ttdef"><b>Definition:</b> <a href="MDBuilder_8h_source.html#l00159">MDBuilder.h:159</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html_ac835b8735b1b2faec0efdca236e37d94"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#ac835b8735b1b2faec0efdca236e37d94">llvm::ArrayRef::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdoc">empty - Check if the array is empty.</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00158">ArrayRef.h:158</a></div></div>
<div class="ttc" id="aclassllvm_1_1MDNode_html_a7d10a7b9b7f40b04d27ed97c38ea1950"><div class="ttname"><a href="classllvm_1_1MDNode.html#a7d10a7b9b7f40b04d27ed97c38ea1950">llvm::MDNode::get</a></div><div class="ttdeci">static MDTuple * get(LLVMContext &amp;Context, ArrayRef&lt; Metadata * &gt; MDs)</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8h_source.html#l01399">Metadata.h:1399</a></div></div>
<div class="ttc" id="anamespacellvm_html_acd6aa057934751aaac54e5c18bcc18eb"><div class="ttname"><a href="namespacellvm.html#acd6aa057934751aaac54e5c18bcc18eb">llvm::commonAlignment</a></div><div class="ttdeci">Align commonAlignment(Align A, uint64_t Offset)</div><div class="ttdoc">Returns the alignment that satisfies both alignments.</div><div class="ttdef"><b>Definition:</b> <a href="Alignment_8h_source.html#l00212">Alignment.h:212</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_a96d73bbd7af15cb1fc38c3f4a3bd82e9"><div class="ttname"><a href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a></div><div class="ttdeci">#define F(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00055">MD5.cpp:55</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html"><div class="ttname"><a href="classllvm_1_1BasicBlock.html">llvm::BasicBlock</a></div><div class="ttdoc">LLVM Basic Block Representation.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00055">BasicBlock.h:55</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_html_a3cc437d6699fb55c69e78b5d0cad641d"><div class="ttname"><a href="namespacellvm_1_1AMDGPU.html#a3cc437d6699fb55c69e78b5d0cad641d">llvm::AMDGPU::isKernel</a></div><div class="ttdeci">LLVM_READNONE bool isKernel(CallingConv::ID CC)</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUBaseInfo_8h_source.html#l01106">AMDGPUBaseInfo.h:1106</a></div></div>
<div class="ttc" id="aclassllvm_1_1detail_1_1DenseSetImpl_html_a8cd802dcaed35e1f28ea3cbe4af4eff5"><div class="ttname"><a href="classllvm_1_1detail_1_1DenseSetImpl.html#a8cd802dcaed35e1f28ea3cbe4af4eff5">llvm::detail::DenseSetImpl&lt; ValueT, DenseMap&lt; ValueT, detail::DenseSetEmpty, DenseMapInfo&lt; ValueT &gt;, detail::DenseSetPair&lt; ValueT &gt; &gt;, DenseMapInfo&lt; ValueT &gt; &gt;::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="DenseSet_8h_source.html#l00174">DenseSet.h:174</a></div></div>
<div class="ttc" id="aCommandLine_8h_html"><div class="ttname"><a href="CommandLine_8h.html">CommandLine.h</a></div></div>
<div class="ttc" id="aAMDGPUMemoryUtils_8h_html"><div class="ttname"><a href="AMDGPUMemoryUtils_8h.html">AMDGPUMemoryUtils.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1PassRegistry_html_a05a729900b76c89e808c6c3094921b2f"><div class="ttname"><a href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">llvm::PassRegistry::getPassRegistry</a></div><div class="ttdeci">static PassRegistry * getPassRegistry()</div><div class="ttdoc">getPassRegistry - Access the global registry object, which is automatically initialized at applicatio...</div><div class="ttdef"><b>Definition:</b> <a href="PassRegistry_8cpp_source.html#l00024">PassRegistry.cpp:24</a></div></div>
<div class="ttc" id="aConstants_8h_html"><div class="ttname"><a href="Constants_8h.html">Constants.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html"><div class="ttname"><a href="classllvm_1_1User.html">llvm::User</a></div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00044">User.h:44</a></div></div>
<div class="ttc" id="aREADME__ALTIVEC_8txt_html_a9aacd9146afe44bf656cd664e2a88c8c"><div class="ttname"><a href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a></div><div class="ttdeci">(vector float) vec_cmpeq(*A, *B) C</div><div class="ttdef"><b>Definition:</b> <a href="README__ALTIVEC_8txt_source.html#l00086">README_ALTIVEC.txt:86</a></div></div>
<div class="ttc" id="anamespacellvm_html_aff0cc35b8ef4641e9cb52c8bddb44713"><div class="ttname"><a href="namespacellvm.html#aff0cc35b8ef4641e9cb52c8bddb44713">llvm::createAMDGPULowerModuleLDSPass</a></div><div class="ttdeci">ModulePass * createAMDGPULowerModuleLDSPass()</div></div>
<div class="ttc" id="aSIInstrInfo_8cpp_html_a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791"><div class="ttname"><a href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a></div><div class="ttdeci">@ SI</div><div class="ttdef"><b>Definition:</b> <a href="SIInstrInfo_8cpp_source.html#l07993">SIInstrInfo.cpp:7993</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantExpr_html_a652380f28d1a7011e05d0787b6024d48"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#a652380f28d1a7011e05d0787b6024d48">llvm::ConstantExpr::getPtrToInt</a></div><div class="ttdeci">static Constant * getPtrToInt(Constant *C, Type *Ty, bool OnlyIfReduced=false)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l02201">Constants.cpp:2201</a></div></div>
<div class="ttc" id="aCorrelatedValuePropagation_8cpp_html_aad75d6f4f14a7b791076c6785aa59be4"><div class="ttname"><a href="CorrelatedValuePropagation_8cpp.html#aad75d6f4f14a7b791076c6785aa59be4">Domain</a></div><div class="ttdeci">Domain</div><div class="ttdef"><b>Definition:</b> <a href="CorrelatedValuePropagation_8cpp_source.html#l00696">CorrelatedValuePropagation.cpp:696</a></div></div>
<div class="ttc" id="aAMDGPULowerModuleLDSPass_8cpp_html_ad78e062f62e0d6e453941fb4ca843e4d"><div class="ttname"><a href="AMDGPULowerModuleLDSPass_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a></div><div class="ttdeci">#define DEBUG_TYPE</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPULowerModuleLDSPass_8cpp_source.html#l00150">AMDGPULowerModuleLDSPass.cpp:150</a></div></div>
<div class="ttc" id="anamespacellvm_1_1omp_html_ad0bfab3ccd7ff108ad4e4619d343f9a7"><div class="ttname"><a href="namespacellvm_1_1omp.html#ad0bfab3ccd7ff108ad4e4619d343f9a7">llvm::omp::KernelSet</a></div><div class="ttdeci">SetVector&lt; Kernel &gt; KernelSet</div><div class="ttdoc">Set of kernels in the module.</div><div class="ttdef"><b>Definition:</b> <a href="OpenMPOpt_8h_source.html#l00024">OpenMPOpt.h:24</a></div></div>
<div class="ttc" id="aDenseSet_8h_html"><div class="ttname"><a href="DenseSet_8h.html">DenseSet.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1dwarf_html_a5d3c920b66ea797d6adb243862fdf47a"><div class="ttname"><a href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">llvm::dwarf::Index</a></div><div class="ttdeci">Index</div><div class="ttdef"><b>Definition:</b> <a href="Dwarf_8h_source.html#l00550">Dwarf.h:550</a></div></div>
<div class="ttc" id="aclassllvm_1_1detail_1_1DenseSetImpl_html_a9a025cb106832026cd05c2b4648a699f"><div class="ttname"><a href="classllvm_1_1detail_1_1DenseSetImpl.html#a9a025cb106832026cd05c2b4648a699f">llvm::detail::DenseSetImpl&lt; ValueT, DenseMap&lt; ValueT, detail::DenseSetEmpty, DenseMapInfo&lt; ValueT &gt;, detail::DenseSetPair&lt; ValueT &gt; &gt;, DenseMapInfo&lt; ValueT &gt; &gt;::size</a></div><div class="ttdeci">size_type size() const</div><div class="ttdef"><b>Definition:</b> <a href="DenseSet_8h_source.html#l00081">DenseSet.h:81</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html"><div class="ttname"><a href="classllvm_1_1Instruction.html">llvm::Instruction</a></div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00041">Instruction.h:41</a></div></div>
<div class="ttc" id="anamespacellvm_html_a93421534a6486ff3e80f748446756ce5"><div class="ttname"><a href="namespacellvm.html#a93421534a6486ff3e80f748446756ce5">llvm::removeFromUsedLists</a></div><div class="ttdeci">void removeFromUsedLists(Module &amp;M, function_ref&lt; bool(Constant *)&gt; ShouldRemove)</div><div class="ttdoc">Removes global values from the llvm.used and llvm.compiler.used arrays.</div><div class="ttdef"><b>Definition:</b> <a href="ModuleUtils_8cpp_source.html#l00147">ModuleUtils.cpp:147</a></div></div>
<div class="ttc" id="aMDBuilder_8h_html"><div class="ttname"><a href="MDBuilder_8h.html">MDBuilder.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_aab730f72aa213d5ecc7d1101efda8811"><div class="ttname"><a href="namespacellvm.html#aab730f72aa213d5ecc7d1101efda8811">llvm::appendToCompilerUsed</a></div><div class="ttdeci">void appendToCompilerUsed(Module &amp;M, ArrayRef&lt; GlobalValue * &gt; Values)</div><div class="ttdoc">Adds global values to the llvm.compiler.used list.</div><div class="ttdef"><b>Definition:</b> <a href="ModuleUtils_8cpp_source.html#l00113">ModuleUtils.cpp:113</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7f2a3d4dcfee70225988aec53ff1e173"><div class="ttname"><a href="namespacellvm.html#a7f2a3d4dcfee70225988aec53ff1e173">llvm::report_fatal_error</a></div><div class="ttdeci">void report_fatal_error(Error Err, bool gen_crash_diag=true)</div><div class="ttdoc">Report a serious error, calling any installed error handler.</div><div class="ttdef"><b>Definition:</b> <a href="Testing_2Support_2Error_8cpp_source.html#l00145">Error.cpp:145</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a217e0207d9cc8e046c2dccbf0e4bb198"><div class="ttname"><a href="classllvm_1_1APInt.html#a217e0207d9cc8e046c2dccbf0e4bb198">llvm::APInt::getZExtValue</a></div><div class="ttdeci">uint64_t getZExtValue() const</div><div class="ttdoc">Get zero extended value.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01494">APInt.h:1494</a></div></div>
<div class="ttc" id="aclassllvm_1_1UndefValue_html_a4ae5ff22b700a42bcc5d889233721335"><div class="ttname"><a href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">llvm::UndefValue::get</a></div><div class="ttdeci">static UndefValue * get(Type *T)</div><div class="ttdoc">Static factory methods - Return an 'undef' object of the specified type.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01740">Constants.cpp:1740</a></div></div>
<div class="ttc" id="aBitVector_8h_html"><div class="ttname"><a href="BitVector_8h.html">BitVector.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_a969709dd49c28865a482d8b870f87c46"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">llvm::ConstantInt::get</a></div><div class="ttdeci">static Constant * get(Type *Ty, uint64_t V, bool IsSigned=false)</div><div class="ttdoc">If Ty is a vector type, return a Constant with a splat of the given value.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00887">Constants.cpp:887</a></div></div>
<div class="ttc" id="aclassllvm_1_1Use_html_a50a2e57da274f8d69b9f932977379cdf"><div class="ttname"><a href="classllvm_1_1Use.html#a50a2e57da274f8d69b9f932977379cdf">llvm::Use::getUser</a></div><div class="ttdeci">User * getUser() const</div><div class="ttdoc">Returns the User that contains this Use.</div><div class="ttdef"><b>Definition:</b> <a href="Use_8h_source.html#l00072">Use.h:72</a></div></div>
<div class="ttc" id="aclassllvm_1_1BitVector_html"><div class="ttname"><a href="classllvm_1_1BitVector.html">llvm::BitVector</a></div><div class="ttdef"><b>Definition:</b> <a href="BitVector_8h_source.html#l00075">BitVector.h:75</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_a7efd1f0c1206d95e4fe01a9b49a57b82"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a7efd1f0c1206d95e4fe01a9b49a57b82">llvm::SmallVectorImpl::append</a></div><div class="ttdeci">void append(ItTy in_start, ItTy in_end)</div><div class="ttdoc">Add the specified range to the end of the SmallVector.</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00687">SmallVector.h:687</a></div></div>
<div class="ttc" id="aELFObjHandler_8cpp_html_a043cdaf7b89aaeeb127be5d93411637f"><div class="ttname"><a href="ELFObjHandler_8cpp.html#a043cdaf7b89aaeeb127be5d93411637f">Align</a></div><div class="ttdeci">uint64_t Align</div><div class="ttdef"><b>Definition:</b> <a href="ELFObjHandler_8cpp_source.html#l00082">ELFObjHandler.cpp:82</a></div></div>
<div class="ttc" id="aAMDGPULowerModuleLDSPass_8cpp_html_a07bc85014fb598026911582ea33f77a0"><div class="ttname"><a href="AMDGPULowerModuleLDSPass_8cpp.html#a07bc85014fb598026911582ea33f77a0">INITIALIZE_PASS</a></div><div class="ttdeci">INITIALIZE_PASS(AMDGPULowerModuleLDS, DEBUG_TYPE, &quot;Lower uses of LDS variables from non-kernel functions&quot;, false, false) ModulePass *llvm</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPULowerModuleLDSPass_8cpp_source.html#l01229">AMDGPULowerModuleLDSPass.cpp:1229</a></div></div>
<div class="ttc" id="aclassllvm_1_1GlobalValue_html_aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">llvm::GlobalValue::InternalLinkage</a></div><div class="ttdeci">@ InternalLinkage</div><div class="ttdoc">Rename collisions when linking (static functions).</div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00055">GlobalValue.h:55</a></div></div>
<div class="ttc" id="astructllvm_1_1Align_html"><div class="ttname"><a href="structllvm_1_1Align.html">llvm::Align</a></div><div class="ttdoc">This struct is a compact representation of a valid (non-zero power of two) alignment.</div><div class="ttdef"><b>Definition:</b> <a href="Alignment_8h_source.html#l00039">Alignment.h:39</a></div></div>
<div class="ttc" id="aclassllvm_1_1Metadata_html"><div class="ttname"><a href="classllvm_1_1Metadata.html">llvm::Metadata</a></div><div class="ttdoc">Root of the metadata hierarchy.</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8h_source.html#l00061">Metadata.h:61</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a9d7de807ebdfe1819df3ff6cb0f16158"><div class="ttname"><a href="classllvm_1_1Value.html#a9d7de807ebdfe1819df3ff6cb0f16158">llvm::Value::use_empty</a></div><div class="ttdeci">bool use_empty() const</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00344">Value.h:344</a></div></div>
<div class="ttc" id="anamespacellvm_1_1CallingConv_html_a188c0836f8c3528401f1c236fd93b977"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">llvm::CallingConv::ID</a></div><div class="ttdeci">unsigned ID</div><div class="ttdoc">LLVM IR allows to use arbitrary numbers as calling convention identifiers.</div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00024">CallingConv.h:24</a></div></div>
<div class="ttc" id="aclassllvm_1_1MDBuilder_html_aa1408308630d4280bd656a54dc92af1d"><div class="ttname"><a href="classllvm_1_1MDBuilder.html#aa1408308630d4280bd656a54dc92af1d">llvm::MDBuilder::createAnonymousAliasScopeDomain</a></div><div class="ttdeci">MDNode * createAnonymousAliasScopeDomain(StringRef Name=StringRef())</div><div class="ttdoc">Return metadata appropriate for an alias scope domain node.</div><div class="ttdef"><b>Definition:</b> <a href="MDBuilder_8h_source.html#l00152">MDBuilder.h:152</a></div></div>
<div class="ttc" id="aADT_2tmp_8txt_html_a07ed0bfaa124c15897944fe3eaa971ab"><div class="ttname"><a href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a></div><div class="ttdeci">Class for arbitrary precision integers APInt is a functional replacement for common case unsigned integer type like unsigned long or uint64_t</div><div class="ttdef"><b>Definition:</b> <a href="ADT_2tmp_8txt_source.html#l00001">tmp.txt:1</a></div></div>
<div class="ttc" id="anamespacellvm_html_a74cdbd1e4f731e7d7cd83461b8b1de0b"><div class="ttname"><a href="namespacellvm.html#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a></div><div class="ttdeci">void sort(IteratorTy Start, IteratorTy End)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01683">STLExtras.h:1683</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseSet_html"><div class="ttname"><a href="classllvm_1_1DenseSet.html">llvm::DenseSet</a></div><div class="ttdoc">Implements a dense probed hash-table based set.</div><div class="ttdef"><b>Definition:</b> <a href="DenseSet_8h_source.html#l00268">DenseSet.h:268</a></div></div>
<div class="ttc" id="aclassllvm_1_1cl_1_1opt_html"><div class="ttname"><a href="classllvm_1_1cl_1_1opt.html">llvm::cl::opt&lt; bool &gt;</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PPC_html_a14028f7fe73a11dabc6583510cc0a355"><div class="ttname"><a href="namespacellvm_1_1PPC.html#a14028f7fe73a11dabc6583510cc0a355">llvm::PPC::Predicate</a></div><div class="ttdeci">Predicate</div><div class="ttdoc">Predicate - These are &quot;(BI &lt;&lt; 5) | BO&quot; for various predicates.</div><div class="ttdef"><b>Definition:</b> <a href="PPCPredicates_8h_source.html#l00026">PPCPredicates.h:26</a></div></div>
<div class="ttc" id="aclassllvm_1_1GlobalValue_html"><div class="ttname"><a href="classllvm_1_1GlobalValue.html">llvm::GlobalValue</a></div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00044">GlobalValue.h:44</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html_a51469ab7f147668678a486661b02ae59"><div class="ttname"><a href="classllvm_1_1SetVector.html#a51469ab7f147668678a486661b02ae59">llvm::SetVector::contains</a></div><div class="ttdeci">bool contains(const key_type &amp;key) const</div><div class="ttdoc">Check if the SetVector contains the given key.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00202">SetVector.h:202</a></div></div>
<div class="ttc" id="aclassllvm_1_1Constant_html"><div class="ttname"><a href="classllvm_1_1Constant.html">llvm::Constant</a></div><div class="ttdoc">This is an important base class in LLVM.</div><div class="ttdef"><b>Definition:</b> <a href="Constant_8h_source.html#l00041">Constant.h:41</a></div></div>
<div class="ttc" id="aclassllvm_1_1MDNode_html_acdbfda46c9837123ef7143244fc1f904"><div class="ttname"><a href="classllvm_1_1MDNode.html#acdbfda46c9837123ef7143244fc1f904">llvm::MDNode::intersect</a></div><div class="ttdeci">static MDNode * intersect(MDNode *A, MDNode *B)</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8cpp_source.html#l01019">Metadata.cpp:1019</a></div></div>
<div class="ttc" id="anamespacellvm_1_1cl_html_a8fa743aa76b6902028f8a643dfb87171"><div class="ttname"><a href="namespacellvm_1_1cl.html#a8fa743aa76b6902028f8a643dfb87171">llvm::cl::values</a></div><div class="ttdeci">ValuesClass values(OptsTy... Options)</div><div class="ttdoc">Helper to build a ValuesClass by forwarding a variable number of arguments as an initializer list to ...</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00703">CommandLine.h:703</a></div></div>
<div class="ttc" id="aELFObjHandler_8cpp_html_aef61945034b9431b804748fc317c5548"><div class="ttname"><a href="ELFObjHandler_8cpp.html#aef61945034b9431b804748fc317c5548">Index</a></div><div class="ttdeci">uint32_t Index</div><div class="ttdef"><b>Definition:</b> <a href="ELFObjHandler_8cpp_source.html#l00083">ELFObjHandler.cpp:83</a></div></div>
<div class="ttc" id="alib_2Target_2ARM_2README_8txt_html_ad3a99906764c35b2694ae90fa57744a5"><div class="ttname"><a href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">move</a></div><div class="ttdeci">compiles ldr LCPI1_0 ldr ldr mov lsr tst moveq r1 ldr LCPI1_1 and r0 bx lr It would be better to do something like to fold the shift into the conditional move</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2ARM_2README_8txt_source.html#l00546">README.txt:546</a></div></div>
<div class="ttc" id="aclassllvm_1_1LLVMContext_html"><div class="ttname"><a href="classllvm_1_1LLVMContext.html">llvm::LLVMContext</a></div><div class="ttdoc">This is an important class for using LLVM in a threaded context.</div><div class="ttdef"><b>Definition:</b> <a href="LLVMContext_8h_source.html#l00067">LLVMContext.h:67</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMap_html"><div class="ttname"><a href="classllvm_1_1DenseMap.html">llvm::DenseMap</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00714">DenseMap.h:714</a></div></div>
<div class="ttc" id="anamespacellvm_html_a061b224a1a3c3486fd854e5009a858c9"><div class="ttname"><a href="namespacellvm.html#a061b224a1a3c3486fd854e5009a858c9">llvm::operator&lt;</a></div><div class="ttdeci">bool operator&lt;(int64_t V1, const APSInt &amp;V2)</div><div class="ttdef"><b>Definition:</b> <a href="APSInt_8h_source.html#l00361">APSInt.h:361</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00058">MD5.cpp:58</a></div></div>
<div class="ttc" id="aclassllvm_1_1detail_1_1DenseSetImpl_html_a9a3c9d867ff6bde97841c2b7983f5c70"><div class="ttname"><a href="classllvm_1_1detail_1_1DenseSetImpl.html#a9a3c9d867ff6bde97841c2b7983f5c70">llvm::detail::DenseSetImpl&lt; ValueT, DenseMap&lt; ValueT, detail::DenseSetEmpty, DenseMapInfo&lt; ValueT &gt;, detail::DenseSetPair&lt; ValueT &gt; &gt;, DenseMapInfo&lt; ValueT &gt; &gt;::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdef"><b>Definition:</b> <a href="DenseSet_8h_source.html#l00080">DenseSet.h:80</a></div></div>
<div class="ttc" id="anamespacellvm_1_1cl_html_a10a041239ae1870cfcc064bfaa79fb65"><div class="ttname"><a href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">llvm::cl::init</a></div><div class="ttdeci">initializer&lt; Ty &gt; init(const Ty &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00445">CommandLine.h:445</a></div></div>
<div class="ttc" id="anamespacellvm_html_a8154638df88e4eaa568b67b23d463dac"><div class="ttname"><a href="namespacellvm.html#a8154638df88e4eaa568b67b23d463dac">llvm::make_early_inc_range</a></div><div class="ttdeci">iterator_range&lt; early_inc_iterator_impl&lt; detail::IterOfRange&lt; RangeT &gt; &gt; &gt; make_early_inc_range(RangeT &amp;&amp;Range)</div><div class="ttdoc">Make a range that does early increment to allow mutation of the underlying range without disrupting i...</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00721">STLExtras.h:721</a></div></div>
<div class="ttc" id="aclassllvm_1_1detail_1_1DenseSetImpl_html_ad7dc7318244359268414719e0959346e"><div class="ttname"><a href="classllvm_1_1detail_1_1DenseSetImpl.html#ad7dc7318244359268414719e0959346e">llvm::detail::DenseSetImpl&lt; ValueT, DenseMap&lt; ValueT, detail::DenseSetEmpty, DenseMapInfo&lt; ValueT &gt;, detail::DenseSetPair&lt; ValueT &gt; &gt;, DenseMapInfo&lt; ValueT &gt; &gt;::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="DenseSet_8h_source.html#l00173">DenseSet.h:173</a></div></div>
<div class="ttc" id="aOptimizedStructLayout_8h_html"><div class="ttname"><a href="OptimizedStructLayout_8h.html">OptimizedStructLayout.h</a></div></div>
<div class="ttc" id="aIRBuilder_8h_html"><div class="ttname"><a href="IRBuilder_8h.html">IRBuilder.h</a></div></div>
<div class="ttc" id="aSILowerControlFlow_8cpp_html_a4868c5d81c5ccc98c47aeab6244346a0"><div class="ttname"><a href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a></div><div class="ttdeci">assert(ImpDefSCC.getReg()==AMDGPU::SCC &amp;&amp;ImpDefSCC.isDef())</div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_html_a9a6f055381f5a946e37ab4d9e4a221d8"><div class="ttname"><a href="namespacellvm_1_1AMDGPU.html#a9a6f055381f5a946e37ab4d9e4a221d8">llvm::AMDGPU::isLDSVariableToLower</a></div><div class="ttdeci">bool isLDSVariableToLower(const GlobalVariable &amp;GV)</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUMemoryUtils_8cpp_source.html#l00078">AMDGPUMemoryUtils.cpp:78</a></div></div>
<div class="ttc" id="aTargetLibraryInfo_8cpp_html_aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053"><div class="ttname"><a href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a></div><div class="ttdeci">@ Ptr</div><div class="ttdef"><b>Definition:</b> <a href="TargetLibraryInfo_8cpp_source.html#l00062">TargetLibraryInfo.cpp:62</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayType_html_adf411edc4f135b570ab218079474ce77"><div class="ttname"><a href="classllvm_1_1ArrayType.html#adf411edc4f135b570ab218079474ce77">llvm::ArrayType::get</a></div><div class="ttdeci">static ArrayType * get(Type *ElementType, uint64_t NumElements)</div><div class="ttdoc">This static method is the primary way to construct an ArrayType.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00640">Type.cpp:640</a></div></div>
<div class="ttc" id="aclassllvm_1_1Module_html"><div class="ttname"><a href="classllvm_1_1Module.html">llvm::Module</a></div><div class="ttdoc">A Module instance is used to store all the information related to an LLVM module.</div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00065">Module.h:65</a></div></div>
<div class="ttc" id="aclassllvm_1_1MDNode_html"><div class="ttname"><a href="classllvm_1_1MDNode.html">llvm::MDNode</a></div><div class="ttdoc">Metadata node.</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8h_source.html#l00943">Metadata.h:943</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImpl_html_a1f475b0df44ebd7169e720fa1bf9169e"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html#a1f475b0df44ebd7169e720fa1bf9169e">llvm::SmallPtrSetImpl::count</a></div><div class="ttdeci">size_type count(ConstPtrType Ptr) const</div><div class="ttdoc">count - Return 1 if the specified pointer is in the set, 0 otherwise.</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00383">SmallPtrSet.h:383</a></div></div>
<div class="ttc" id="aAssumeBundleBuilder_8cpp_html_afb136e0532bcaed86521b462e6538d62"><div class="ttname"><a href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a></div><div class="ttdeci">assume Assume Builder</div><div class="ttdef"><b>Definition:</b> <a href="AssumeBundleBuilder_8cpp_source.html#l00651">AssumeBundleBuilder.cpp:651</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html"><div class="ttname"><a href="classllvm_1_1APInt.html">llvm::APInt</a></div><div class="ttdoc">Class for arbitrary precision integers.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00075">APInt.h:75</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html_a72d928b7fc2c5f2d56c6ac0265fd9c6e"><div class="ttname"><a href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">llvm::SetVector::insert</a></div><div class="ttdeci">bool insert(const value_type &amp;X)</div><div class="ttdoc">Insert a new element into the SetVector.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00141">SetVector.h:141</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html"><div class="ttname"><a href="classllvm_1_1ArrayRef.html">llvm::ArrayRef</a></div><div class="ttdoc">ArrayRef - Represent a constant reference to an array (0 or more elements consecutively in memory),...</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00033">APInt.h:33</a></div></div>
<div class="ttc" id="aclassllvm_1_1StructType_html"><div class="ttname"><a href="classllvm_1_1StructType.html">llvm::StructType</a></div><div class="ttdoc">Class to represent struct types.</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00213">DerivedTypes.h:213</a></div></div>
<div class="ttc" id="aAMDGPU_8h_html"><div class="ttname"><a href="AMDGPU_8h.html">AMDGPU.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4"><div class="ttname"><a href="namespacellvm.html#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">llvm::Offset</a></div><div class="ttdeci">@ Offset</div><div class="ttdef"><b>Definition:</b> <a href="DWP_8cpp_source.html#l00406">DWP.cpp:406</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a6393a2d4fe7e10b28a0dcc35f881567b"><div class="ttname"><a href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">llvm::Value::getType</a></div><div class="ttdeci">Type * getType() const</div><div class="ttdoc">All values are typed, get the type of this value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00255">Value.h:255</a></div></div>
<div class="ttc" id="aclassllvm_1_1detail_1_1DenseSetImpl_html_ad409c2de8502b94c8a0b1193307c63b6"><div class="ttname"><a href="classllvm_1_1detail_1_1DenseSetImpl.html#ad409c2de8502b94c8a0b1193307c63b6">llvm::detail::DenseSetImpl::contains</a></div><div class="ttdeci">bool contains(const_arg_type_t&lt; ValueT &gt; V) const</div><div class="ttdoc">Check if the set contains the given element.</div><div class="ttdef"><b>Definition:</b> <a href="DenseSet_8h_source.html#l00185">DenseSet.h:185</a></div></div>
<div class="ttc" id="aclassllvm_1_1MDNode_html_a088247f165cc7e2ca9a3917adc0e75df"><div class="ttname"><a href="classllvm_1_1MDNode.html#a088247f165cc7e2ca9a3917adc0e75df">llvm::MDNode::getMostGenericAliasScope</a></div><div class="ttdeci">static MDNode * getMostGenericAliasScope(MDNode *A, MDNode *B)</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8cpp_source.html#l01032">Metadata.cpp:1032</a></div></div>
<div class="ttc" id="aAArch64SLSHardening_8cpp_html_ad467c4ab9119043f9b7750ab986be61a"><div class="ttname"><a href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a></div><div class="ttdeci">MachineBasicBlock MachineBasicBlock::iterator DebugLoc DL</div><div class="ttdef"><b>Definition:</b> <a href="AArch64SLSHardening_8cpp_source.html#l00076">AArch64SLSHardening.cpp:76</a></div></div>
<div class="ttc" id="aCommandLine_8h_html_a187fd767976b311c09dff5e05ac0c1bc"><div class="ttname"><a href="CommandLine_8h.html#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a></div><div class="ttdeci">#define clEnumValN(ENUMVAL, FLAGNAME, DESC)</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00678">CommandLine.h:678</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_adb5c319f5905c1d3ca9eb5df546388c5"><div class="ttname"><a href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">llvm::Value::getName</a></div><div class="ttdeci">StringRef getName() const</div><div class="ttdoc">Return a constant reference to the value's name.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00308">Value.cpp:308</a></div></div>
<div class="ttc" id="anamespacellvm_html_aae35ec9b920ff3bb892cd872877a89fe"><div class="ttname"><a href="namespacellvm.html#aae35ec9b920ff3bb892cd872877a89fe">llvm::performOptimizedStructLayout</a></div><div class="ttdeci">std::pair&lt; uint64_t, Align &gt; performOptimizedStructLayout(MutableArrayRef&lt; OptimizedStructLayoutField &gt; Fields)</div><div class="ttdoc">Compute a layout for a struct containing the given fields, making a best-effort attempt to minimize t...</div><div class="ttdef"><b>Definition:</b> <a href="OptimizedStructLayout_8cpp_source.html#l00043">OptimizedStructLayout.cpp:43</a></div></div>
<div class="ttc" id="anamespacellvm_1_1Intrinsic_html_aefa39f6b622360ce4e947feb9f671b73"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#aefa39f6b622360ce4e947feb9f671b73">llvm::Intrinsic::getDeclaration</a></div><div class="ttdeci">Function * getDeclaration(Module *M, ID id, ArrayRef&lt; Type * &gt; Tys=std::nullopt)</div><div class="ttdoc">Create or insert an LLVM Function declaration for an intrinsic, and return it.</div><div class="ttdef"><b>Definition:</b> <a href="Function_8cpp_source.html#l01502">Function.cpp:1502</a></div></div>
<div class="ttc" id="aInstCombineMulDivRem_8cpp_html_a26e11e9c1ef55164b429eb9dc019f213"><div class="ttname"><a href="InstCombineMulDivRem_8cpp.html#a26e11e9c1ef55164b429eb9dc019f213">MaxDepth</a></div><div class="ttdeci">static const unsigned MaxDepth</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineMulDivRem_8cpp_source.html#l01118">InstCombineMulDivRem.cpp:1118</a></div></div>
<div class="ttc" id="anamespacellvm_html_a79a7b64538cabbf4054b62a0cecc0c09"><div class="ttname"><a href="namespacellvm.html#a79a7b64538cabbf4054b62a0cecc0c09">llvm::initializeAMDGPULowerModuleLDSPass</a></div><div class="ttdeci">void initializeAMDGPULowerModuleLDSPass(PassRegistry &amp;)</div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_html_a4f422b014bb0d10d7e6e07d06035a77c"><div class="ttname"><a href="namespacellvm_1_1AMDGPU.html#a4f422b014bb0d10d7e6e07d06035a77c">llvm::AMDGPU::getAlign</a></div><div class="ttdeci">Align getAlign(DataLayout const &amp;DL, const GlobalVariable *GV)</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUMemoryUtils_8cpp_source.html#l00029">AMDGPUMemoryUtils.cpp:29</a></div></div>
<div class="ttc" id="aclassllvm_1_1Twine_html"><div class="ttname"><a href="classllvm_1_1Twine.html">llvm::Twine</a></div><div class="ttdoc">Twine - A lightweight data structure for efficiently representing the concatenation of temporary valu...</div><div class="ttdef"><b>Definition:</b> <a href="Twine_8h_source.html#l00081">Twine.h:81</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantExpr_html"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html">llvm::ConstantExpr</a></div><div class="ttdoc">A constant value that is initialized with an expression using other constant values.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00998">Constants.h:998</a></div></div>
<div class="ttc" id="aclassllvm_1_1PreservedAnalyses_html_a1258a1ff55557c27684010ebd7283712"><div class="ttname"><a href="classllvm_1_1PreservedAnalyses.html#a1258a1ff55557c27684010ebd7283712">llvm::PreservedAnalyses::all</a></div><div class="ttdeci">static PreservedAnalyses all()</div><div class="ttdoc">Construct a special preserved set that preserves all passes.</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00158">PassManager.h:158</a></div></div>
<div class="ttc" id="astructllvm_1_1Align_html_a80735739b49cf97a491922c8f9af2cc1"><div class="ttname"><a href="structllvm_1_1Align.html#a80735739b49cf97a491922c8f9af2cc1">llvm::Align::value</a></div><div class="ttdeci">uint64_t value() const</div><div class="ttdoc">This is a hole in the type system and should not be abused.</div><div class="ttdef"><b>Definition:</b> <a href="Alignment_8h_source.html#l00085">Alignment.h:85</a></div></div>
<div class="ttc" id="aclassllvm_1_1TypeSize_html"><div class="ttname"><a href="classllvm_1_1TypeSize.html">llvm::TypeSize</a></div><div class="ttdef"><b>Definition:</b> <a href="TypeSize_8h_source.html#l00314">TypeSize.h:314</a></div></div>
<div class="ttc" id="anamespacellvm_html_abee0df5f7f703bb4462aba260ba0a60f"><div class="ttname"><a href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">llvm::BitWidth</a></div><div class="ttdeci">constexpr unsigned BitWidth</div><div class="ttdef"><b>Definition:</b> <a href="BitmaskEnum_8h_source.html#l00147">BitmaskEnum.h:147</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantArray_html_a0900dacdc7ad8e3ea0cc92993c7fd422"><div class="ttname"><a href="classllvm_1_1ConstantArray.html#a0900dacdc7ad8e3ea0cc92993c7fd422">llvm::ConstantArray::get</a></div><div class="ttdeci">static Constant * get(ArrayType *T, ArrayRef&lt; Constant * &gt; V)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01249">Constants.cpp:1249</a></div></div>
<div class="ttc" id="aclassllvm_1_1InstructionWorklist_html"><div class="ttname"><a href="classllvm_1_1InstructionWorklist.html">llvm::InstructionWorklist</a></div><div class="ttdoc">InstructionWorklist - This is the worklist management logic for InstCombine and other simplification ...</div><div class="ttdef"><b>Definition:</b> <a href="InstructionWorklist_8h_source.html#l00025">InstructionWorklist.h:25</a></div></div>
<div class="ttc" id="alib_2Target_2README_8txt_html_a69955d334349c9adad86cd95171dce4c"><div class="ttname"><a href="lib_2Target_2README_8txt.html#a69955d334349c9adad86cd95171dce4c">transform</a></div><div class="ttdeci">instcombine should handle this transform</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2README_8txt_source.html#l00262">README.txt:262</a></div></div>
<div class="ttc" id="aclassllvm_1_1MDBuilder_html"><div class="ttname"><a href="classllvm_1_1MDBuilder.html">llvm::MDBuilder</a></div><div class="ttdef"><b>Definition:</b> <a href="MDBuilder_8h_source.html#l00036">MDBuilder.h:36</a></div></div>
<div class="ttc" id="aCallGraph_8h_html"><div class="ttname"><a href="CallGraph_8h.html">CallGraph.h</a></div></div>
<div class="ttc" id="astructllvm_1_1AMDGPULowerModuleLDSPass_html_a76be940af9a6ce8a688affa5368cd3cb"><div class="ttname"><a href="structllvm_1_1AMDGPULowerModuleLDSPass.html#a76be940af9a6ce8a688affa5368cd3cb">llvm::AMDGPULowerModuleLDSPass::run</a></div><div class="ttdeci">PreservedAnalyses run(Module &amp;M, ModuleAnalysisManager &amp;AM)</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPULowerModuleLDSPass_8cpp_source.html#l01237">AMDGPULowerModuleLDSPass.cpp:1237</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a6e20e76960d952de088354cbcd14c3ab"><div class="ttname"><a href="classllvm_1_1Type.html#a6e20e76960d952de088354cbcd14c3ab">llvm::Type::getVoidTy</a></div><div class="ttdeci">static Type * getVoidTy(LLVMContext &amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00224">Type.cpp:224</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallGraphNode_html_afe3782c535fa39673c4e160fcbdf1515"><div class="ttname"><a href="classllvm_1_1CallGraphNode.html#afe3782c535fa39673c4e160fcbdf1515">llvm::CallGraphNode::CallRecord</a></div><div class="ttdeci">std::pair&lt; std::optional&lt; WeakTrackingVH &gt;, CallGraphNode * &gt; CallRecord</div><div class="ttdoc">A pair of the calling instruction (a call or invoke) and the call graph node being called.</div><div class="ttdef"><b>Definition:</b> <a href="CallGraph_8h_source.html#l00178">CallGraph.h:178</a></div></div>
<div class="ttc" id="aInstructions_8h_html"><div class="ttname"><a href="Instructions_8h.html">Instructions.h</a></div></div>
<div class="ttc" id="aELFYAML_8cpp_html_a941c34da9850676ce3380813c636cff2"><div class="ttname"><a href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a></div><div class="ttdeci">std::optional&lt; std::vector&lt; StOtherPiece &gt; &gt; Other</div><div class="ttdef"><b>Definition:</b> <a href="ELFYAML_8cpp_source.html#l01260">ELFYAML.cpp:1260</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantExpr_html_a28bf8984fbfb08fd27df435e631e6832"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#a28bf8984fbfb08fd27df435e631e6832">llvm::ConstantExpr::getPointerBitCastOrAddrSpaceCast</a></div><div class="ttdeci">static Constant * getPointerBitCastOrAddrSpaceCast(Constant *C, Type *Ty)</div><div class="ttdoc">Create a BitCast or AddrSpaceCast for a pointer type depending on the address space.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l02056">Constants.cpp:2056</a></div></div>
<div class="ttc" id="aModuleUtils_8h_html"><div class="ttname"><a href="ModuleUtils_8h.html">ModuleUtils.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html_a85ffb6531d4cda988ea81f18d4e56fb7"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">llvm::ArrayRef::size</a></div><div class="ttdeci">size_t size() const</div><div class="ttdoc">size - Get the array size.</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00163">ArrayRef.h:163</a></div></div>
<div class="ttc" id="aclassllvm_1_1detail_1_1DenseSetImpl_html_af972d87e15b5f6ed61bd5c3956c5213d"><div class="ttname"><a href="classllvm_1_1detail_1_1DenseSetImpl.html#af972d87e15b5f6ed61bd5c3956c5213d">llvm::detail::DenseSetImpl&lt; ValueT, DenseMap&lt; ValueT, detail::DenseSetEmpty, DenseMapInfo&lt; ValueT &gt;, detail::DenseSetPair&lt; ValueT &gt; &gt;, DenseMapInfo&lt; ValueT &gt; &gt;::erase</a></div><div class="ttdeci">bool erase(const ValueT &amp;V)</div><div class="ttdef"><b>Definition:</b> <a href="DenseSet_8h_source.html#l00101">DenseSet.h:101</a></div></div>
<div class="ttc" id="aDerivedTypes_8h_html"><div class="ttname"><a href="DerivedTypes_8h.html">DerivedTypes.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisManager_html"><div class="ttname"><a href="classllvm_1_1AnalysisManager.html">llvm::AnalysisManager</a></div><div class="ttdoc">A container for analyses that lazily runs them and caches their results.</div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8h_source.html#l00042">InstructionSimplify.h:42</a></div></div>
<div class="ttc" id="aclassllvm_1_1GlobalValue_html_a29e0b1c558b350347e2652b35b26fea8"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#a29e0b1c558b350347e2652b35b26fea8">llvm::GlobalValue::getValueType</a></div><div class="ttdeci">Type * getValueType() const</div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00292">GlobalValue.h:292</a></div></div>
<div class="ttc" id="alib_2CodeGen_2README_8txt_html_a09776db24cf586ec9f1e18f3bae14099"><div class="ttname"><a href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a></div><div class="ttdeci">Common register allocation spilling lr str ldr sxth r3 ldr mla r4 can lr mov lr str ldr sxth r3 mla r4 and then merge mul and lr str ldr sxth r3 mla r4 It also increase the likelihood the store may become dead bb27 Successors according to LLVM BB</div><div class="ttdef"><b>Definition:</b> <a href="lib_2CodeGen_2README_8txt_source.html#l00039">README.txt:39</a></div></div>
<div class="ttc" id="aHexagonCommonGEP_8cpp_html_ad532e8710e50302e0a376b61c91fa91d"><div class="ttname"><a href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a></div><div class="ttdeci">Hexagon Common GEP</div><div class="ttdef"><b>Definition:</b> <a href="HexagonCommonGEP_8cpp_source.html#l00171">HexagonCommonGEP.cpp:171</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a7e8dad1701aa6445be4a29f654b0473c"><div class="ttname"><a href="classllvm_1_1Value.html#a7e8dad1701aa6445be4a29f654b0473c">llvm::Value::replaceUsesWithIf</a></div><div class="ttdeci">void replaceUsesWithIf(Value *New, llvm::function_ref&lt; bool(Use &amp;U)&gt; ShouldReplace)</div><div class="ttdoc">Go through the uses list for this definition and make each use point to &quot;V&quot; if the callback ShouldRep...</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00540">Value.cpp:540</a></div></div>
<div class="ttc" id="astructllvm_1_1OptimizedStructLayoutField_html"><div class="ttname"><a href="structllvm_1_1OptimizedStructLayoutField.html">llvm::OptimizedStructLayoutField</a></div><div class="ttdoc">A field in a structure.</div><div class="ttdef"><b>Definition:</b> <a href="OptimizedStructLayout_8h_source.html#l00045">OptimizedStructLayout.h:45</a></div></div>
<div class="ttc" id="aclassllvm_1_1GlobalObject_html_a49b398b1c83ef4d42c8f7756b443f61f"><div class="ttname"><a href="classllvm_1_1GlobalObject.html#a49b398b1c83ef4d42c8f7756b443f61f">llvm::GlobalObject::setAlignment</a></div><div class="ttdeci">void setAlignment(Align Align)</div><div class="ttdoc">Sets the alignment attribute of the GlobalObject.</div><div class="ttdef"><b>Definition:</b> <a href="Globals_8cpp_source.html#l00130">Globals.cpp:130</a></div></div>
<div class="ttc" id="astructllvm_1_1cl_1_1desc_html"><div class="ttname"><a href="structllvm_1_1cl_1_1desc.html">llvm::cl::desc</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00411">CommandLine.h:411</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html"><div class="ttname"><a href="classllvm_1_1SetVector.html">llvm::SetVector</a></div><div class="ttdoc">A vector that has set insertion semantics.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00040">SetVector.h:40</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_a499ea32ca1b8d16cedfe01d1e5b08f29"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a499ea32ca1b8d16cedfe01d1e5b08f29">llvm::SmallVectorImpl::reserve</a></div><div class="ttdeci">void reserve(size_type N)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00667">SmallVector.h:667</a></div></div>
<div class="ttc" id="aBasicBlockUtils_8h_html"><div class="ttname"><a href="BasicBlockUtils_8h.html">BasicBlockUtils.h</a></div></div>
<div class="ttc" id="aInitializePasses_8h_html"><div class="ttname"><a href="InitializePasses_8h.html">InitializePasses.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html"><div class="ttname"><a href="classllvm_1_1Value.html">llvm::Value</a></div><div class="ttdoc">LLVM Value Representation.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00074">Value.h:74</a></div></div>
<div class="ttc" id="aDebug_8h_html"><div class="ttname"><a href="Debug_8h.html">Debug.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_ab4e0512c7e1c7adaa56677e3155685f1"><div class="ttname"><a href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">llvm::Value::users</a></div><div class="ttdeci">iterator_range&lt; user_iterator &gt; users()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00421">Value.h:421</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPUAS_html_ab1843c6566c95d94d6e36a857b8d2b3faa6d3112da64eecbdbb50aacb5f8251e8"><div class="ttname"><a href="namespacellvm_1_1AMDGPUAS.html#ab1843c6566c95d94d6e36a857b8d2b3faa6d3112da64eecbdbb50aacb5f8251e8">llvm::AMDGPUAS::CONSTANT_ADDRESS</a></div><div class="ttdeci">@ CONSTANT_ADDRESS</div><div class="ttdoc">Address space for constant memory (VTX2).</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPU_8h_source.html#l00376">AMDGPU.h:376</a></div></div>
<div class="ttc" id="aSetVector_8h_html"><div class="ttname"><a href="SetVector_8h.html">SetVector.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1FunctionType_html"><div class="ttname"><a href="classllvm_1_1FunctionType.html">llvm::FunctionType</a></div><div class="ttdoc">Class to represent function types.</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00103">DerivedTypes.h:103</a></div></div>
<div class="ttc" id="aclassllvm_1_1Use_html"><div class="ttname"><a href="classllvm_1_1Use.html">llvm::Use</a></div><div class="ttdoc">A Use represents the edge between a Value definition and its users.</div><div class="ttdef"><b>Definition:</b> <a href="Use_8h_source.html#l00043">Use.h:43</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_a396fcfee6914c76974b73c3d203da6a5"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">llvm::SmallVectorImpl::emplace_back</a></div><div class="ttdeci">reference emplace_back(ArgTypes &amp;&amp;... Args)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00941">SmallVector.h:941</a></div></div>
<div class="ttc" id="aAMDGPUBaseInfo_8h_html"><div class="ttname"><a href="AMDGPUBaseInfo_8h.html">AMDGPUBaseInfo.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImpl_html_a6bc6fb89fe2e91c25559a8631f56e27e"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">llvm::SmallPtrSetImpl::insert</a></div><div class="ttdeci">std::pair&lt; iterator, bool &gt; insert(PtrType Ptr)</div><div class="ttdoc">Inserts Ptr if and only if there is no element in the container equal to Ptr.</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00365">SmallPtrSet.h:365</a></div></div>
<div class="ttc" id="aclassllvm_1_1PoisonValue_html_a1bf08613fb664a2e377a9a72c59a6b66"><div class="ttname"><a href="classllvm_1_1PoisonValue.html#a1bf08613fb664a2e377a9a72c59a6b66">llvm::PoisonValue::get</a></div><div class="ttdeci">static PoisonValue * get(Type *T)</div><div class="ttdoc">Static factory methods - Return an 'poison' object of the specified type.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01759">Constants.cpp:1759</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 7 2023 10:09:10 for LLVM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
