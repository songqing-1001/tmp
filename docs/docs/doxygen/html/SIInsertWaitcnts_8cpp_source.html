<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: lib/Target/AMDGPU/SIInsertWaitcnts.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LLVM
   &#160;<span id="projectnumber">17.0.0git</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_794e483eb1cc7921d35fd149d9cc325b.html">Target</a></li><li class="navelem"><a class="el" href="dir_447ce995d6e35417de5ec3060e97c93e.html">AMDGPU</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">SIInsertWaitcnts.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="SIInsertWaitcnts_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- SIInsertWaitcnts.cpp - Insert Wait Instructions --------------------===//</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// See https://llvm.org/LICENSE.txt for license information.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span><span class="comment"></span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">/// \file</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">/// Insert wait instructions for memory reads and writes.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">/// Memory reads and writes are issued asynchronously, so we need to insert</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">/// S_WAITCNT instructions when we want to access any of their results or</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">/// overwrite any register that&#39;s used asynchronously.</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">/// TODO: This pass currently keeps one timeline per hardware counter. A more</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">/// finely-grained approach that keeps one timeline per event type could</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">/// sometimes get away with generating weaker s_waitcnt instructions. For</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">/// example, when both SMEM and LDS are in flight and we need to wait for</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">/// the i-th-last LDS instruction, then an lgkmcnt(i) is actually sufficient,</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">/// but the pass will currently generate a conservative lgkmcnt(0) because</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">/// multiple event types are in flight.</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"></span><span class="comment">//</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160; </div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AMDGPU_8h.html">AMDGPU.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="GCNSubtarget_8h.html">GCNSubtarget.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AMDGPUMCTargetDesc_8h.html">MCTargetDesc/AMDGPUMCTargetDesc.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SIMachineFunctionInfo_8h.html">SIMachineFunctionInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AMDGPUBaseInfo_8h.html">Utils/AMDGPUBaseInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MapVector_8h.html">llvm/ADT/MapVector.h</a>&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="PostOrderIterator_8h.html">llvm/ADT/PostOrderIterator.h</a>&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Sequence_8h.html">llvm/ADT/Sequence.h</a>&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineLoopInfo_8h.html">llvm/CodeGen/MachineLoopInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachinePostDominators_8h.html">llvm/CodeGen/MachinePostDominators.h</a>&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InitializePasses_8h.html">llvm/InitializePasses.h</a>&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DebugCounter_8h.html">llvm/Support/DebugCounter.h</a>&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetParser_8h.html">llvm/TargetParser/TargetParser.h</a>&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="SIInsertWaitcnts_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">   41</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;si-insert-waitcnts&quot;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<a class="code" href="SIInsertWaitcnts_8cpp.html#abb5f557136c002ba27b210cd2b0ce543">DEBUG_COUNTER</a>(ForceExpCounter, <a class="code" href="SIInsertWaitcnts_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a><span class="stringliteral">&quot;-forceexp&quot;</span>,</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;              <span class="stringliteral">&quot;Force emit s_waitcnt expcnt(0) instrs&quot;</span>);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<a class="code" href="SIInsertWaitcnts_8cpp.html#abb5f557136c002ba27b210cd2b0ce543">DEBUG_COUNTER</a>(ForceLgkmCounter, <a class="code" href="SIInsertWaitcnts_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a><span class="stringliteral">&quot;-forcelgkm&quot;</span>,</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;              <span class="stringliteral">&quot;Force emit s_waitcnt lgkmcnt(0) instrs&quot;</span>);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<a class="code" href="SIInsertWaitcnts_8cpp.html#abb5f557136c002ba27b210cd2b0ce543">DEBUG_COUNTER</a>(ForceVMCounter, <a class="code" href="SIInsertWaitcnts_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a><span class="stringliteral">&quot;-forcevm&quot;</span>,</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;              <span class="stringliteral">&quot;Force emit s_waitcnt vmcnt(0) instrs&quot;</span>);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160; </div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="SIInsertWaitcnts_8cpp.html#a6b9b0a85e71198a4aca6ffd4427fc38e">ForceEmitZeroFlag</a>(</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="stringliteral">&quot;amdgpu-waitcnt-forcezero&quot;</span>,</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Force all waitcnt instrs to be emitted as s_waitcnt vmcnt(0) expcnt(0) lgkmcnt(0)&quot;</span>),</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">false</span>), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">// Class of object that encapsulates latest instruction counter score</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">// associated with the operand.  Used for determining whether</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">// s_waitcnt instruction needs to be emitted.</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="SIInsertWaitcnts_8cpp.html#ac57a217835a5c4c14745e58b6763701c">   60</a></span>&#160;<span class="preprocessor">#define CNT_MASK(t) (1u &lt;&lt; (t))</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="keyword">enum</span> InstCounterType { <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a> = 0, <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>, <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">EXP_CNT</a>, VS_CNT, NUM_INST_CNTS };</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;} <span class="comment">// namespace</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160; </div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacellvm.html">llvm</a> {</div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="structllvm_1_1enum__iteration__traits_3_01InstCounterType_01_4.html">   66</a></span>&#160;<span class="keyword">template</span> &lt;&gt; <span class="keyword">struct </span><a class="code" href="structllvm_1_1enum__iteration__traits.html">enum_iteration_traits</a>&lt;InstCounterType&gt; {</div>
<div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="structllvm_1_1enum__iteration__traits_3_01InstCounterType_01_4.html#aa6ce9599978d8441ef71860dd3ccedcb">   67</a></span>&#160;  <span class="keyword">static</span> constexpr <span class="keywordtype">bool</span> <a class="code" href="structllvm_1_1enum__iteration__traits.html#a388dfbdc88932be20ae924a6e2942d6b">is_iterable</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;};</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;} <span class="comment">// namespace llvm</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160; </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="keyword">auto</span> inst_counter_types() { <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a1dbde216a4e94e36451ff3ae695d8405">enum_seq</a>(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>, NUM_INST_CNTS); }</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160; </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="keyword">using</span> RegInterval = std::pair&lt;int, int&gt;;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160; </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="keyword">struct </span>HardwareLimits {</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="keywordtype">unsigned</span> VmcntMax;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="keywordtype">unsigned</span> ExpcntMax;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="keywordtype">unsigned</span> LgkmcntMax;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="keywordtype">unsigned</span> VscntMax;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;};</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="keyword">struct </span>RegisterEncoding {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="keywordtype">unsigned</span> VGPR0;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordtype">unsigned</span> VGPRL;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="keywordtype">unsigned</span> SGPR0;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keywordtype">unsigned</span> SGPRL;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;};</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="keyword">enum</span> WaitEventType {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  VMEM_ACCESS,       <span class="comment">// vector-memory read &amp; write</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  VMEM_READ_ACCESS,  <span class="comment">// vector-memory read</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  VMEM_WRITE_ACCESS, <span class="comment">// vector-memory write</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  LDS_ACCESS,        <span class="comment">// lds read &amp; write</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  GDS_ACCESS,        <span class="comment">// gds read &amp; write</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  SQ_MESSAGE,        <span class="comment">// send message</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  SMEM_ACCESS,       <span class="comment">// scalar-memory read &amp; write</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  EXP_GPR_LOCK,      <span class="comment">// export holding on its data src</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  GDS_GPR_LOCK,      <span class="comment">// GDS holding on its data and addr src</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  EXP_POS_ACCESS,    <span class="comment">// write to export position</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  EXP_PARAM_ACCESS,  <span class="comment">// write to export parameter</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  VMW_GPR_LOCK,      <span class="comment">// vector-memory write holding on its data src</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  EXP_LDS_ACCESS,    <span class="comment">// read by ldsdir counting as export</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  NUM_WAIT_EVENTS,</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;};</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> WaitEventMaskForInst[NUM_INST_CNTS] = {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    (1 &lt;&lt; VMEM_ACCESS) | (1 &lt;&lt; VMEM_READ_ACCESS),</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    (1 &lt;&lt; SMEM_ACCESS) | (1 &lt;&lt; LDS_ACCESS) | (1 &lt;&lt; GDS_ACCESS) |</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        (1 &lt;&lt; SQ_MESSAGE),</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    (1 &lt;&lt; EXP_GPR_LOCK) | (1 &lt;&lt; GDS_GPR_LOCK) | (1 &lt;&lt; VMW_GPR_LOCK) |</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        (1 &lt;&lt; EXP_PARAM_ACCESS) | (1 &lt;&lt; EXP_POS_ACCESS) | (1 &lt;&lt; EXP_LDS_ACCESS),</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    (1 &lt;&lt; VMEM_WRITE_ACCESS)};</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160; </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">// The mapping is:</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">//  0                .. SQ_MAX_PGM_VGPRS-1               real VGPRs</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">//  SQ_MAX_PGM_VGPRS .. NUM_ALL_VGPRS-1                  extra VGPR-like slots</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">//  NUM_ALL_VGPRS    .. NUM_ALL_VGPRS+SQ_MAX_PGM_SGPRS-1 real SGPRs</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">// We reserve a fixed number of VGPR slots in the scoring tables for</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">// special tokens like SCMEM_LDS (needed for buffer load to LDS).</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="keyword">enum</span> RegisterMapping {</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  SQ_MAX_PGM_VGPRS = 512, <span class="comment">// Maximum programmable VGPRs across all targets.</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  AGPR_OFFSET = 256,      <span class="comment">// Maximum programmable ArchVGPRs across all targets.</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  SQ_MAX_PGM_SGPRS = 256, <span class="comment">// Maximum programmable SGPRs across all targets.</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  NUM_EXTRA_VGPRS = 1,    <span class="comment">// A reserved slot for DS.</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  EXTRA_VGPR_LDS = 0,     <span class="comment">// An artificial register to track LDS writes.</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  NUM_ALL_VGPRS = SQ_MAX_PGM_VGPRS + NUM_EXTRA_VGPRS, <span class="comment">// Where SGPR starts.</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;};</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160; </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">// Enumerate different types of result-returning VMEM operations. Although</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">// s_waitcnt orders them all with a single vmcnt counter, in the absence of</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">// s_waitcnt only instructions of the same VmemType are guaranteed to write</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">// their results in order -- so there is no need to insert an s_waitcnt between</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">// two instructions of the same type that write the same vgpr.</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="keyword">enum</span> VmemType {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="comment">// BUF instructions and MIMG instructions without a sampler.</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  VMEM_NOSAMPLER,</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="comment">// MIMG instructions with a sampler.</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  VMEM_SAMPLER,</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="comment">// BVH instructions</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  VMEM_BVH</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;};</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160; </div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> updateVMCntOnly(<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;Inst) {</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1SIInstrInfo.html#a08b830059090a1bb27b14e1e524fdb46">SIInstrInfo::isVMEM</a>(Inst) || <a class="code" href="classllvm_1_1SIInstrInfo.html#a65dcf8264f3f411eed5734a4b1ad7efa">SIInstrInfo::isFLATGlobal</a>(Inst) ||</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;         <a class="code" href="classllvm_1_1SIInstrInfo.html#a13fdc38a01504ed9a44abd1c9018737d">SIInstrInfo::isFLATScratch</a>(Inst);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;}</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160; </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;VmemType getVmemType(<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;Inst) {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(updateVMCntOnly(Inst));</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classllvm_1_1SIInstrInfo.html#abdcf600002fd489c76924f2ec4f4fc0f">SIInstrInfo::isMIMG</a>(Inst))</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordflow">return</span> VMEM_NOSAMPLER;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keyword">const</span> AMDGPU::MIMGInfo *<a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a> = <a class="code" href="namespacellvm_1_1AMDGPU.html#a2fa58f3e19c6038d01bd699308237c14">AMDGPU::getMIMGInfo</a>(Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>());</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="keyword">const</span> AMDGPU::MIMGBaseOpcodeInfo *BaseInfo =</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      <a class="code" href="namespacellvm_1_1AMDGPU.html#a8adcca4377f5dfb320d2f81a84a9998e">AMDGPU::getMIMGBaseOpcodeInfo</a>(<a class="code" href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>-&gt;BaseOpcode);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="keywordflow">return</span> BaseInfo-&gt;BVH ? VMEM_BVH</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                       : BaseInfo-&gt;Sampler ? VMEM_SAMPLER : VMEM_NOSAMPLER;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;}</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="keywordtype">void</span> addWait(AMDGPU::Waitcnt &amp;<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>, InstCounterType <a class="code" href="classT.html">T</a>, <span class="keywordtype">unsigned</span> Count) {</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="keywordflow">switch</span> (<a class="code" href="classT.html">T</a>) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>:</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.VmCnt = <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.VmCnt, Count);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">EXP_CNT</a>:</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.ExpCnt = <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.ExpCnt, Count);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>:</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.LgkmCnt = <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.LgkmCnt, Count);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keywordflow">case</span> VS_CNT:</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.VsCnt = <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.VsCnt, Count);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;bad InstCounterType&quot;</span>);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  }</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;}</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">// This objects maintains the current score brackets of each wait counter, and</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">// a per-register scoreboard for each wait counter.</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">// We also maintain the latest score for every event type that can change the</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">// waitcnt in order to know if there are multiple types of events within</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">// the brackets. When multiple types of event happen in the bracket,</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">// wait count may get decreased out of order, therefore we need to put in</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">// &quot;s_waitcnt 0&quot; before use.</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="keyword">class </span>WaitcntBrackets {</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  WaitcntBrackets(<span class="keyword">const</span> <a class="code" href="classllvm_1_1GCNSubtarget.html">GCNSubtarget</a> *SubTarget, HardwareLimits Limits,</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                  RegisterEncoding Encoding)</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      : <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>(SubTarget), Limits(Limits), Encoding(Encoding) {}</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="keywordtype">unsigned</span> getWaitCountMax(InstCounterType <a class="code" href="classT.html">T</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="classT.html">T</a>) {</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>:</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      <span class="keywordflow">return</span> Limits.VmcntMax;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>:</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      <span class="keywordflow">return</span> Limits.LgkmcntMax;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">EXP_CNT</a>:</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      <span class="keywordflow">return</span> Limits.ExpcntMax;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">case</span> VS_CNT:</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="keywordflow">return</span> Limits.VscntMax;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    }</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  }</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160; </div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="keywordtype">unsigned</span> getScoreLB(InstCounterType <a class="code" href="classT.html">T</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="classT.html">T</a> &lt; NUM_INST_CNTS);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">return</span> ScoreLBs[<a class="code" href="classT.html">T</a>];</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  }</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160; </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="keywordtype">unsigned</span> getScoreUB(InstCounterType <a class="code" href="classT.html">T</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="classT.html">T</a> &lt; NUM_INST_CNTS);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordflow">return</span> ScoreUBs[<a class="code" href="classT.html">T</a>];</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160; </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordtype">unsigned</span> getScoreRange(InstCounterType <a class="code" href="classT.html">T</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keywordflow">return</span> getScoreUB(<a class="code" href="classT.html">T</a>) - getScoreLB(<a class="code" href="classT.html">T</a>);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  }</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160; </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="comment">// Mapping from event to counter.</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  InstCounterType eventCounter(WaitEventType <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="classT.html">T</a> : inst_counter_types()) {</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      <span class="keywordflow">if</span> (WaitEventMaskForInst[<a class="code" href="classT.html">T</a>] &amp; (1 &lt;&lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>))</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classT.html">T</a>;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    }</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;event type has no associated counter&quot;</span>);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  }</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160; </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="keywordtype">unsigned</span> getRegScore(<span class="keywordtype">int</span> GprNo, InstCounterType <a class="code" href="classT.html">T</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keywordflow">if</span> (GprNo &lt; NUM_ALL_VGPRS) {</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <span class="keywordflow">return</span> VgprScores[<a class="code" href="classT.html">T</a>][GprNo];</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="classT.html">T</a> == <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordflow">return</span> SgprScores[GprNo - NUM_ALL_VGPRS];</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  }</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="LoopDeletion_8cpp.html#a66a2592ace8a67bc796c72710d632bab">merge</a>(<span class="keyword">const</span> WaitcntBrackets &amp;Other);</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160; </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  RegInterval getRegInterval(<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1SIInstrInfo.html">SIInstrInfo</a> *<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>,</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                             <span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineRegisterInfo.html">MachineRegisterInfo</a> *<a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>,</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                             <span class="keyword">const</span> <a class="code" href="classllvm_1_1SIRegisterInfo.html">SIRegisterInfo</a> *<a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <span class="keywordtype">unsigned</span> OpNo) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160; </div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="keywordtype">bool</span> counterOutOfOrder(InstCounterType <a class="code" href="classT.html">T</a>) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="keywordtype">void</span> simplifyWaitcnt(AMDGPU::Waitcnt &amp;<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <span class="keywordtype">void</span> simplifyWaitcnt(InstCounterType <a class="code" href="classT.html">T</a>, <span class="keywordtype">unsigned</span> &amp;Count) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="keywordtype">void</span> determineWait(InstCounterType <a class="code" href="classT.html">T</a>, <span class="keywordtype">int</span> RegNo, AMDGPU::Waitcnt &amp;<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  <span class="keywordtype">void</span> applyWaitcnt(<span class="keyword">const</span> AMDGPU::Waitcnt &amp;<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <span class="keywordtype">void</span> applyWaitcnt(InstCounterType <a class="code" href="classT.html">T</a>, <span class="keywordtype">unsigned</span> Count);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="keywordtype">void</span> updateByEvent(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SIInstrInfo.html">SIInstrInfo</a> *<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1SIRegisterInfo.html">SIRegisterInfo</a> *<a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>,</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                     <span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineRegisterInfo.html">MachineRegisterInfo</a> *<a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, WaitEventType <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>,</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                     <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160; </div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="keywordtype">unsigned</span> hasPendingEvent()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> PendingEvents; }</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="keywordtype">unsigned</span> hasPendingEvent(WaitEventType <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordflow">return</span> PendingEvents &amp; (1 &lt;&lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  }</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="keywordtype">unsigned</span> hasPendingEvent(InstCounterType <a class="code" href="classT.html">T</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keywordtype">unsigned</span> HasPending = PendingEvents &amp; WaitEventMaskForInst[<a class="code" href="classT.html">T</a>];</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((HasPending != 0) == (getScoreRange(<a class="code" href="classT.html">T</a>) != 0));</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordflow">return</span> HasPending;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  }</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160; </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="keywordtype">bool</span> hasMixedPendingEvents(InstCounterType <a class="code" href="classT.html">T</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordtype">unsigned</span> Events = hasPendingEvent(<a class="code" href="classT.html">T</a>);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="comment">// Return true if more than one bit is set in Events.</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">return</span> Events &amp; (Events - 1);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  }</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160; </div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keywordtype">bool</span> hasPendingFlat()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">return</span> ((LastFlat[<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>] &gt; ScoreLBs[<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>] &amp;&amp;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;             LastFlat[<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>] &lt;= ScoreUBs[<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>]) ||</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            (LastFlat[<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>] &gt; ScoreLBs[<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>] &amp;&amp;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;             LastFlat[<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>] &lt;= ScoreUBs[<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>]));</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  }</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160; </div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordtype">void</span> setPendingFlat() {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    LastFlat[<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>] = ScoreUBs[<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>];</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    LastFlat[<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>] = ScoreUBs[<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>];</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  }</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160; </div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="comment">// Return true if there might be pending writes to the specified vgpr by VMEM</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="comment">// instructions with types different from V.</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="keywordtype">bool</span> hasOtherPendingVmemTypes(<span class="keywordtype">int</span> GprNo, VmemType V)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(GprNo &lt; NUM_ALL_VGPRS);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">return</span> VgprVmemTypes[GprNo] &amp; ~(1 &lt;&lt; V);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="keywordtype">void</span> clearVgprVmemTypes(<span class="keywordtype">int</span> GprNo) {</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(GprNo &lt; NUM_ALL_VGPRS);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    VgprVmemTypes[GprNo] = 0;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  }</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a67980a8ae101d2fda845eb750ffb1942">print</a>(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a03503773241005f01b090b9862aad304">dump</a>() { <a class="code" href="namespacellvm.html#a67980a8ae101d2fda845eb750ffb1942">print</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()); }</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160; </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keyword">struct </span>MergeInfo {</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordtype">unsigned</span> OldLB;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordtype">unsigned</span> OtherLB;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordtype">unsigned</span> MyShift;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keywordtype">unsigned</span> OtherShift;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  };</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">bool</span> mergeScore(<span class="keyword">const</span> MergeInfo &amp;M, <span class="keywordtype">unsigned</span> &amp;Score,</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                         <span class="keywordtype">unsigned</span> OtherScore);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="keywordtype">void</span> setScoreLB(InstCounterType <a class="code" href="classT.html">T</a>, <span class="keywordtype">unsigned</span> Val) {</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="classT.html">T</a> &lt; NUM_INST_CNTS);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    ScoreLBs[<a class="code" href="classT.html">T</a>] = Val;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  }</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="keywordtype">void</span> setScoreUB(InstCounterType <a class="code" href="classT.html">T</a>, <span class="keywordtype">unsigned</span> Val) {</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="classT.html">T</a> &lt; NUM_INST_CNTS);</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    ScoreUBs[<a class="code" href="classT.html">T</a>] = Val;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160; </div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classT.html">T</a> != <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">EXP_CNT</a>)</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160; </div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keywordflow">if</span> (getScoreRange(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">EXP_CNT</a>) &gt; getWaitCountMax(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">EXP_CNT</a>))</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      ScoreLBs[<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">EXP_CNT</a>] = ScoreUBs[<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">EXP_CNT</a>] - getWaitCountMax(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">EXP_CNT</a>);</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  }</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="keywordtype">void</span> setRegScore(<span class="keywordtype">int</span> GprNo, InstCounterType <a class="code" href="classT.html">T</a>, <span class="keywordtype">unsigned</span> Val) {</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="keywordflow">if</span> (GprNo &lt; NUM_ALL_VGPRS) {</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      VgprUB = <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(VgprUB, GprNo);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      VgprScores[<a class="code" href="classT.html">T</a>][GprNo] = Val;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="classT.html">T</a> == <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      SgprUB = <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(SgprUB, GprNo - NUM_ALL_VGPRS);</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      SgprScores[GprNo - NUM_ALL_VGPRS] = Val;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    }</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  }</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160; </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="keywordtype">void</span> setExpScore(<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1SIInstrInfo.html">SIInstrInfo</a> *<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>,</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                   <span class="keyword">const</span> <a class="code" href="classllvm_1_1SIRegisterInfo.html">SIRegisterInfo</a> *<a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineRegisterInfo.html">MachineRegisterInfo</a> *<a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>,</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                   <span class="keywordtype">unsigned</span> OpNo, <span class="keywordtype">unsigned</span> Val);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160; </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1GCNSubtarget.html">GCNSubtarget</a> *<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  HardwareLimits Limits = {};</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  RegisterEncoding Encoding = {};</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="keywordtype">unsigned</span> ScoreLBs[NUM_INST_CNTS] = {0};</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="keywordtype">unsigned</span> ScoreUBs[NUM_INST_CNTS] = {0};</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="keywordtype">unsigned</span> PendingEvents = 0;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="comment">// Remember the last flat memory operation.</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="keywordtype">unsigned</span> LastFlat[NUM_INST_CNTS] = {0};</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="comment">// wait_cnt scores for every vgpr.</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="comment">// Keep track of the VgprUB and SgprUB to make merge at join efficient.</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="keywordtype">int</span> VgprUB = -1;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <span class="keywordtype">int</span> SgprUB = -1;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="keywordtype">unsigned</span> VgprScores[NUM_INST_CNTS][NUM_ALL_VGPRS] = {{0}};</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="comment">// Wait cnt scores for every sgpr, only lgkmcnt is relevant.</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <span class="keywordtype">unsigned</span> SgprScores[SQ_MAX_PGM_SGPRS] = {0};</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="comment">// Bitmask of the VmemTypes of VMEM instructions that might have a pending</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="comment">// write to each vgpr.</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> VgprVmemTypes[NUM_ALL_VGPRS] = {0};</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;};</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160; </div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="keyword">class </span>SIInsertWaitcnts : <span class="keyword">public</span> <a class="code" href="classllvm_1_1MachineFunctionPass.html">MachineFunctionPass</a> {</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1GCNSubtarget.html">GCNSubtarget</a> *<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SIInstrInfo.html">SIInstrInfo</a> *<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SIRegisterInfo.html">SIRegisterInfo</a> *<a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineRegisterInfo.html">MachineRegisterInfo</a> *<a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  AMDGPU::IsaVersion <a class="code" href="blake3__impl_8h.html#a78823051d1dad34b9b3d8120112e674d">IV</a>;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160; </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;MachineInstr *&gt;</a> TrackedWaitcntSet;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const Value *, MachineBasicBlock *&gt;</a> SLoadAddresses;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;MachineBasicBlock *, bool&gt;</a> PreheadersToFlush;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <a class="code" href="classllvm_1_1MachineLoopInfo.html">MachineLoopInfo</a> *MLI;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <a class="code" href="classllvm_1_1MachinePostDominatorTree.html">MachinePostDominatorTree</a> *PDT;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160; </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="keyword">struct </span>BlockInfo {</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    std::unique_ptr&lt;WaitcntBrackets&gt; Incoming;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="keywordtype">bool</span> Dirty = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160; </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keyword">explicit</span> BlockInfo(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>) : <a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>) {}</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  };</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160; </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;MachineBasicBlock *, BlockInfo&gt;</a> BlockInfos;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160; </div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="comment">// ForceEmitZeroWaitcnts: force all waitcnts insts to be s_waitcnt 0</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="comment">// because of amdgpu-waitcnt-forcezero flag</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="keywordtype">bool</span> ForceEmitZeroWaitcnts;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="keywordtype">bool</span> ForceEmitWaitcnt[NUM_INST_CNTS];</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160; </div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160; </div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  SIInsertWaitcnts() : <a class="code" href="classllvm_1_1MachineFunctionPass.html">MachineFunctionPass</a>(<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>) {</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    (void)ForceExpCounter;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    (void)ForceLgkmCounter;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    (void)ForceVMCounter;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  }</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160; </div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <span class="keywordtype">bool</span> shouldFlushVmCnt(<a class="code" href="classllvm_1_1MachineLoop.html">MachineLoop</a> *ML, WaitcntBrackets &amp;Brackets);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="keywordtype">bool</span> isPreheaderToFlush(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>,</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                          WaitcntBrackets &amp;ScoreBrackets);</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="keywordtype">bool</span> runOnMachineFunction(<a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> &amp;MF) <span class="keyword">override</span>;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160; </div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> getPassName()<span class="keyword"> const override </span>{</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;SI insert wait instructions&quot;</span>;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  }</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160; </div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <span class="keywordtype">void</span> getAnalysisUsage(<a class="code" href="classllvm_1_1AnalysisUsage.html">AnalysisUsage</a> &amp;AU)<span class="keyword"> const override </span>{</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#af11a6ebf7ab3c388234cb6d5378439a3">setPreservesCFG</a>();</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1MachineLoopInfo.html">MachineLoopInfo</a>&gt;();</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1MachinePostDominatorTree.html">MachinePostDominatorTree</a>&gt;();</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <a class="code" href="classllvm_1_1MachineFunctionPass.html#a864fd57b4304ef933b3281d0ef85a88e">MachineFunctionPass::getAnalysisUsage</a>(AU);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  }</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160; </div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  <span class="keywordtype">bool</span> isForceEmitWaitcnt()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="classT.html">T</a> : inst_counter_types())</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      <span class="keywordflow">if</span> (ForceEmitWaitcnt[<a class="code" href="classT.html">T</a>])</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  }</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160; </div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  AMDGPU::Waitcnt allZeroWaitcnt()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="structllvm_1_1AMDGPU_1_1Waitcnt.html#a679b4910131f57ac1d61dfa0a209df01">AMDGPU::Waitcnt::allZero</a>(<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;hasVscnt());</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  }</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160; </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <span class="keywordtype">void</span> setForceEmitWaitcnt() {</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">// For non-debug builds, ForceEmitWaitcnt has been initialized to false;</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">// For debug builds, get the debug counter info and adjust if need be</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1DebugCounter.html#a50989c336e006eb7f8c168f04dbb32a4">DebugCounter::isCounterSet</a>(ForceExpCounter) &amp;&amp;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        <a class="code" href="classllvm_1_1DebugCounter.html#a5aace8653ce3726ef07194dcf6bce2bf">DebugCounter::shouldExecute</a>(ForceExpCounter)) {</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      ForceEmitWaitcnt[<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">EXP_CNT</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      ForceEmitWaitcnt[<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">EXP_CNT</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    }</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160; </div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1DebugCounter.html#a50989c336e006eb7f8c168f04dbb32a4">DebugCounter::isCounterSet</a>(ForceLgkmCounter) &amp;&amp;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <a class="code" href="classllvm_1_1DebugCounter.html#a5aace8653ce3726ef07194dcf6bce2bf">DebugCounter::shouldExecute</a>(ForceLgkmCounter)) {</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      ForceEmitWaitcnt[<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      ForceEmitWaitcnt[<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    }</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160; </div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1DebugCounter.html#a50989c336e006eb7f8c168f04dbb32a4">DebugCounter::isCounterSet</a>(ForceVMCounter) &amp;&amp;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        <a class="code" href="classllvm_1_1DebugCounter.html#a5aace8653ce3726ef07194dcf6bce2bf">DebugCounter::shouldExecute</a>(ForceVMCounter)) {</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      ForceEmitWaitcnt[<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      ForceEmitWaitcnt[<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    }</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="preprocessor">#endif // NDEBUG</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  }</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160; </div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="comment">// Return the appropriate VMEM_*_ACCESS type for Inst, which must be a VMEM or</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="comment">// FLAT instruction.</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  WaitEventType getVmemWaitEventType(<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;Inst)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="classllvm_1_1SIInstrInfo.html#a08b830059090a1bb27b14e1e524fdb46">SIInstrInfo::isVMEM</a>(Inst) || <a class="code" href="classllvm_1_1SIInstrInfo.html#adc3333d2d5974f4068df84f8706fc7d2">SIInstrInfo::isFLAT</a>(Inst));</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;hasVscnt())</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      <span class="keywordflow">return</span> VMEM_ACCESS;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordflow">if</span> (Inst.<a class="code" href="classllvm_1_1MachineInstr.html#ab96f3235c18e659758517d0532d606c9">mayStore</a>() &amp;&amp; !<a class="code" href="classllvm_1_1SIInstrInfo.html#a6c4c2a9d09070e2709f9725a915575e4">SIInstrInfo::isAtomicRet</a>(Inst))</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      <span class="keywordflow">return</span> VMEM_WRITE_ACCESS;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="keywordflow">return</span> VMEM_READ_ACCESS;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  }</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160; </div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="keywordtype">bool</span> mayAccessVMEMThroughFlat(<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <span class="keywordtype">bool</span> mayAccessLDSThroughFlat(<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="keywordtype">bool</span> generateWaitcntInstBefore(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>,</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                                 WaitcntBrackets &amp;ScoreBrackets,</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                                 <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *OldWaitcntInstr,</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                                 <span class="keywordtype">bool</span> FlushVmCnt);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="keywordtype">bool</span> generateWaitcntBlockEnd(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> &amp;Block,</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                               WaitcntBrackets &amp;ScoreBrackets,</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                               <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *OldWaitcntInstr);</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  <span class="keywordtype">bool</span> generateWaitcnt(AMDGPU::Waitcnt <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>,</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                       <a class="code" href="classllvm_1_1ilist__iterator.html">MachineBasicBlock::instr_iterator</a> It,</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                       <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> &amp;Block, WaitcntBrackets &amp;ScoreBrackets,</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                       <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *OldWaitcntInstr);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <span class="keywordtype">void</span> updateEventWaitcntAfter(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;Inst,</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                               WaitcntBrackets *ScoreBrackets);</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <span class="keywordtype">bool</span> insertWaitcntInBlock(<a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> &amp;MF, <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> &amp;Block,</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                            WaitcntBrackets &amp;ScoreBrackets);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="keywordtype">bool</span> applyPreexistingWaitcnt(WaitcntBrackets &amp;ScoreBrackets,</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                               <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;OldWaitcntInstr,</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                               AMDGPU::Waitcnt &amp;<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>,</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                               <a class="code" href="classllvm_1_1ilist__iterator.html">MachineBasicBlock::instr_iterator</a> It) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;};</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160; </div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160; </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;RegInterval WaitcntBrackets::getRegInterval(<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>,</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                                            <span class="keyword">const</span> <a class="code" href="classllvm_1_1SIInstrInfo.html">SIInstrInfo</a> *<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>,</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                                            <span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineRegisterInfo.html">MachineRegisterInfo</a> *<a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>,</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                                            <span class="keyword">const</span> <a class="code" href="classllvm_1_1SIRegisterInfo.html">SIRegisterInfo</a> *<a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>,</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                                            <span class="keywordtype">unsigned</span> OpNo)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineOperand.html">MachineOperand</a> &amp;<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getOperand(OpNo);</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;<a class="code" href="classllvm_1_1TargetRegisterInfo.html#af2f8f83c931fa084058914c65af13984">isInAllocatableClass</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.getReg()))</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keywordflow">return</span> {-1, -1};</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160; </div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="comment">// A use via a PW operand does not need a waitcnt.</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <span class="comment">// A partial write is not a WAW.</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.getSubReg() || !<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.isUndef());</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160; </div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  RegInterval <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160; </div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1X86Disassembler.html#a1e59b79e1d09149912cad9c0ef2809ad">Reg</a> = <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;<a class="code" href="classllvm_1_1MCRegisterInfo.html#a8ce9439c5f364d8b85930e0ee689bbb8">getEncodingValue</a>(<a class="code" href="namespacellvm_1_1AMDGPU.html#ab1b1fa0e6e5c1b25ef79b0f7c121a6c1">AMDGPU::getMCReg</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.getReg(), *<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>));</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160; </div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;isVectorRegister(*<a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.getReg())) {</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1X86Disassembler.html#a1e59b79e1d09149912cad9c0ef2809ad">Reg</a> &gt;= Encoding.VGPR0 &amp;&amp; <a class="code" href="namespacellvm_1_1X86Disassembler.html#a1e59b79e1d09149912cad9c0ef2809ad">Reg</a> &lt;= Encoding.VGPRL);</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>.first = <a class="code" href="namespacellvm_1_1X86Disassembler.html#a1e59b79e1d09149912cad9c0ef2809ad">Reg</a> - Encoding.VGPR0;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;isAGPR(*<a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.getReg()))</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>.first += AGPR_OFFSET;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>.first &gt;= 0 &amp;&amp; <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>.first &lt; SQ_MAX_PGM_VGPRS);</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;isSGPRReg(*<a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.getReg())) {</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1X86Disassembler.html#a1e59b79e1d09149912cad9c0ef2809ad">Reg</a> &gt;= Encoding.SGPR0 &amp;&amp; <a class="code" href="namespacellvm_1_1X86Disassembler.html#a1e59b79e1d09149912cad9c0ef2809ad">Reg</a> &lt; SQ_MAX_PGM_SGPRS);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>.first = <a class="code" href="namespacellvm_1_1X86Disassembler.html#a1e59b79e1d09149912cad9c0ef2809ad">Reg</a> - Encoding.SGPR0 + NUM_ALL_VGPRS;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>.first &gt;= NUM_ALL_VGPRS &amp;&amp;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;           <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>.first &lt; SQ_MAX_PGM_SGPRS + NUM_ALL_VGPRS);</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  }</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <span class="comment">// TODO: Handle TTMP</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  <span class="comment">// else if (TRI-&gt;isTTMP(*MRI, Reg.getReg())) ...</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordflow">return</span> {-1, -1};</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetRegisterClass.html">TargetRegisterClass</a> *RC = <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getOpRegClass(*<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, OpNo);</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1Check.html#a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396">Size</a> = <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;<a class="code" href="classllvm_1_1TargetRegisterInfo.html#a251557179fe64bb09bd7e327c60c6b24">getRegSizeInBits</a>(*RC);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>.second = <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>.first + ((<a class="code" href="namespacellvm_1_1Check.html#a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396">Size</a> + 16) / 32);</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160; </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;}</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160; </div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="keywordtype">void</span> WaitcntBrackets::setExpScore(<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>,</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                                  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SIInstrInfo.html">SIInstrInfo</a> *<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>,</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                                  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SIRegisterInfo.html">SIRegisterInfo</a> *<a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>,</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                                  <span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineRegisterInfo.html">MachineRegisterInfo</a> *<a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, <span class="keywordtype">unsigned</span> OpNo,</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                                  <span class="keywordtype">unsigned</span> Val) {</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  RegInterval <a class="code" href="classllvm_1_1Interval.html">Interval</a> = getRegInterval(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, OpNo);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;isVectorRegister(*<a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getOperand(OpNo).getReg()));</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> RegNo = <a class="code" href="classllvm_1_1Interval.html">Interval</a>.first; RegNo &lt; <a class="code" href="classllvm_1_1Interval.html">Interval</a>.second; ++RegNo) {</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    setRegScore(RegNo, <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">EXP_CNT</a>, Val);</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  }</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;}</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160; </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment">// MUBUF and FLAT LDS DMA operations need a wait on vmcnt before LDS written</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment">// can be accessed. A load from LDS to VMEM does not need a wait.</span></div>
<div class="line"><a name="l00543"></a><span class="lineno"><a class="line" href="SIInsertWaitcnts_8cpp.html#ab4827b9d3e3811c1e2f5cbe42b5174e3">  543</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SIInsertWaitcnts_8cpp.html#ab4827b9d3e3811c1e2f5cbe42b5174e3">mayWriteLDSThroughDMA</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) {</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1SIInstrInfo.html#ade8d533000b775c514d9ac189b66c3a5">SIInstrInfo::isVALU</a>(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) &amp;&amp;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;         (<a class="code" href="classllvm_1_1SIInstrInfo.html#a8616d2d8f4c04005569e89bcfe67e421">SIInstrInfo::isMUBUF</a>(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) || <a class="code" href="classllvm_1_1SIInstrInfo.html#adc3333d2d5974f4068df84f8706fc7d2">SIInstrInfo::isFLAT</a>(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>)) &amp;&amp;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;         <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() != AMDGPU::BUFFER_STORE_LDS_DWORD;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;}</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160; </div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="keywordtype">void</span> WaitcntBrackets::updateByEvent(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SIInstrInfo.html">SIInstrInfo</a> *<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>,</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                                    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SIRegisterInfo.html">SIRegisterInfo</a> *<a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>,</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                                    <span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineRegisterInfo.html">MachineRegisterInfo</a> *<a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>,</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                                    WaitEventType <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;Inst) {</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  InstCounterType <a class="code" href="classT.html">T</a> = eventCounter(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <span class="keywordtype">unsigned</span> CurrScore = getScoreUB(<a class="code" href="classT.html">T</a>) + 1;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <span class="keywordflow">if</span> (CurrScore == 0)</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <a class="code" href="namespacellvm.html#a7f2a3d4dcfee70225988aec53ff1e173">report_fatal_error</a>(<span class="stringliteral">&quot;InsertWaitcnt score wraparound&quot;</span>);</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  <span class="comment">// PendingEvents and ScoreUB need to be update regardless if this event</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <span class="comment">// changes the score of a register or not.</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <span class="comment">// Examples including vm_cnt when buffer-store or lgkm_cnt when send-message.</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  PendingEvents |= 1 &lt;&lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  setScoreUB(<a class="code" href="classT.html">T</a>, CurrScore);</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160; </div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classT.html">T</a> == <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">EXP_CNT</a>) {</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="comment">// Put score on the source vgprs. If this is a store, just use those</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="comment">// specific register(s).</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isDS(Inst) &amp;&amp; (Inst.<a class="code" href="classllvm_1_1MachineInstr.html#ab96f3235c18e659758517d0532d606c9">mayStore</a>() || Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a682028ac4a06c9e3550fa8e6e1909fa9">mayLoad</a>())) {</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      <span class="keywordtype">int</span> AddrOpIdx =</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;          <a class="code" href="namespacellvm_1_1AMDGPU.html#a27efe1286cc31f5fc95355af30b0356c">AMDGPU::getNamedOperandIdx</a>(Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>(), AMDGPU::OpName::addr);</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      <span class="comment">// All GDS operations must protect their address register (same as</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      <span class="comment">// export.)</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      <span class="keywordflow">if</span> (AddrOpIdx != -1) {</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        setExpScore(&amp;Inst, <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, AddrOpIdx, CurrScore);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160; </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      <span class="keywordflow">if</span> (Inst.<a class="code" href="classllvm_1_1MachineInstr.html#ab96f3235c18e659758517d0532d606c9">mayStore</a>()) {</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1AMDGPU.html#a8f27aa11689bf9b12f6fb0e436e367c7">AMDGPU::hasNamedOperand</a>(Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>(), AMDGPU::OpName::data0)) {</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;          setExpScore(</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;              &amp;Inst, <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>,</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;              <a class="code" href="namespacellvm_1_1AMDGPU.html#a27efe1286cc31f5fc95355af30b0356c">AMDGPU::getNamedOperandIdx</a>(Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>(), AMDGPU::OpName::data0),</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;              CurrScore);</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        }</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1AMDGPU.html#a8f27aa11689bf9b12f6fb0e436e367c7">AMDGPU::hasNamedOperand</a>(Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>(), AMDGPU::OpName::data1)) {</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;          setExpScore(&amp;Inst, <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>,</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                      <a class="code" href="namespacellvm_1_1AMDGPU.html#a27efe1286cc31f5fc95355af30b0356c">AMDGPU::getNamedOperandIdx</a>(Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>(),</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                                                 AMDGPU::OpName::data1),</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                      CurrScore);</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        }</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SIInstrInfo.html#a6c4c2a9d09070e2709f9725a915575e4">SIInstrInfo::isAtomicRet</a>(Inst) &amp;&amp;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                 Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>() != AMDGPU::DS_GWS_INIT &amp;&amp;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                 Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>() != AMDGPU::DS_GWS_SEMA_V &amp;&amp;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                 Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>() != AMDGPU::DS_GWS_SEMA_BR &amp;&amp;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                 Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>() != AMDGPU::DS_GWS_SEMA_P &amp;&amp;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                 Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>() != AMDGPU::DS_GWS_BARRIER &amp;&amp;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                 Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>() != AMDGPU::DS_APPEND &amp;&amp;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                 Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>() != AMDGPU::DS_CONSUME &amp;&amp;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                 Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>() != <a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eabf84d249106fbef805c08aae16f19968">AMDGPU::DS_ORDERED_COUNT</a>) {</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a432824f0975bb863478bf4ef3a5df258">getNumOperands</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;          <span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineOperand.html">MachineOperand</a> &amp;<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a3f7a45f6e10668a5f702e26bca80d18e">getOperand</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.isReg() &amp;&amp; !<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.isDef() &amp;&amp;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;              <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;isVectorRegister(*<a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.getReg())) {</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;            setExpScore(&amp;Inst, <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, CurrScore);</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;          }</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        }</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      }</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isFLAT(Inst)) {</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      <span class="keywordflow">if</span> (Inst.<a class="code" href="classllvm_1_1MachineInstr.html#ab96f3235c18e659758517d0532d606c9">mayStore</a>()) {</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        setExpScore(</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            &amp;Inst, <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>,</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            <a class="code" href="namespacellvm_1_1AMDGPU.html#a27efe1286cc31f5fc95355af30b0356c">AMDGPU::getNamedOperandIdx</a>(Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>(), AMDGPU::OpName::data),</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;            CurrScore);</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SIInstrInfo.html#a6c4c2a9d09070e2709f9725a915575e4">SIInstrInfo::isAtomicRet</a>(Inst)) {</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        setExpScore(</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;            &amp;Inst, <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>,</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;            <a class="code" href="namespacellvm_1_1AMDGPU.html#a27efe1286cc31f5fc95355af30b0356c">AMDGPU::getNamedOperandIdx</a>(Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>(), AMDGPU::OpName::data),</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;            CurrScore);</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      }</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isMIMG(Inst)) {</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      <span class="keywordflow">if</span> (Inst.<a class="code" href="classllvm_1_1MachineInstr.html#ab96f3235c18e659758517d0532d606c9">mayStore</a>()) {</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        setExpScore(&amp;Inst, <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, 0, CurrScore);</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SIInstrInfo.html#a6c4c2a9d09070e2709f9725a915575e4">SIInstrInfo::isAtomicRet</a>(Inst)) {</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        setExpScore(</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            &amp;Inst, <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>,</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            <a class="code" href="namespacellvm_1_1AMDGPU.html#a27efe1286cc31f5fc95355af30b0356c">AMDGPU::getNamedOperandIdx</a>(Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>(), AMDGPU::OpName::data),</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            CurrScore);</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      }</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isMTBUF(Inst)) {</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      <span class="keywordflow">if</span> (Inst.<a class="code" href="classllvm_1_1MachineInstr.html#ab96f3235c18e659758517d0532d606c9">mayStore</a>()) {</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        setExpScore(&amp;Inst, <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, 0, CurrScore);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      }</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isMUBUF(Inst)) {</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;      <span class="keywordflow">if</span> (Inst.<a class="code" href="classllvm_1_1MachineInstr.html#ab96f3235c18e659758517d0532d606c9">mayStore</a>()) {</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        setExpScore(&amp;Inst, <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, 0, CurrScore);</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SIInstrInfo.html#a6c4c2a9d09070e2709f9725a915575e4">SIInstrInfo::isAtomicRet</a>(Inst)) {</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        setExpScore(</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            &amp;Inst, <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>,</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            <a class="code" href="namespacellvm_1_1AMDGPU.html#a27efe1286cc31f5fc95355af30b0356c">AMDGPU::getNamedOperandIdx</a>(Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>(), AMDGPU::OpName::data),</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;            CurrScore);</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      }</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isLDSDIR(Inst)) {</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      <span class="comment">// LDSDIR instructions attach the score to the destination.</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      setExpScore(</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;          &amp;Inst, <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>,</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;          <a class="code" href="namespacellvm_1_1AMDGPU.html#a27efe1286cc31f5fc95355af30b0356c">AMDGPU::getNamedOperandIdx</a>(Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>(), AMDGPU::OpName::vdst),</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;          CurrScore);</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isEXP(Inst)) {</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        <span class="comment">// For export the destination registers are really temps that</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        <span class="comment">// can be used as the actual source after export patching, so</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        <span class="comment">// we need to treat them like sources and set the EXP_CNT</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        <span class="comment">// score.</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a432824f0975bb863478bf4ef3a5df258">getNumOperands</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;          <a class="code" href="classllvm_1_1MachineOperand.html">MachineOperand</a> &amp;DefMO = Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a3f7a45f6e10668a5f702e26bca80d18e">getOperand</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;          <span class="keywordflow">if</span> (DefMO.<a class="code" href="classllvm_1_1MachineOperand.html#a4c9594c955fec80c73ddd964b5efd554">isReg</a>() &amp;&amp; DefMO.<a class="code" href="classllvm_1_1MachineOperand.html#a75eb135014670ce946e78739cdc9b51b">isDef</a>() &amp;&amp;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;              <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;isVGPR(*<a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, DefMO.<a class="code" href="classllvm_1_1MachineOperand.html#ac0035d7c1c860501c877c20e6e93297b">getReg</a>())) {</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;            setRegScore(</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;<a class="code" href="classllvm_1_1MCRegisterInfo.html#a8ce9439c5f364d8b85930e0ee689bbb8">getEncodingValue</a>(<a class="code" href="namespacellvm_1_1AMDGPU.html#ab1b1fa0e6e5c1b25ef79b0f7c121a6c1">AMDGPU::getMCReg</a>(DefMO.<a class="code" href="classllvm_1_1MachineOperand.html#ac0035d7c1c860501c877c20e6e93297b">getReg</a>(), *<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>)),</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">EXP_CNT</a>, CurrScore);</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;          }</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        }</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      }</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a432824f0975bb863478bf4ef3a5df258">getNumOperands</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        <a class="code" href="classllvm_1_1MachineOperand.html">MachineOperand</a> &amp;MO = Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a3f7a45f6e10668a5f702e26bca80d18e">getOperand</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <span class="keywordflow">if</span> (MO.<a class="code" href="classllvm_1_1MachineOperand.html#a4c9594c955fec80c73ddd964b5efd554">isReg</a>() &amp;&amp; !MO.<a class="code" href="classllvm_1_1MachineOperand.html#a75eb135014670ce946e78739cdc9b51b">isDef</a>() &amp;&amp;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;            <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;isVectorRegister(*<a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, MO.<a class="code" href="classllvm_1_1MachineOperand.html#ac0035d7c1c860501c877c20e6e93297b">getReg</a>())) {</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;          setExpScore(&amp;Inst, <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, CurrScore);</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        }</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      }</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    }</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="preprocessor">#if 0 // TODO: check if this is handled by MUBUF code above.</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>() == AMDGPU::BUFFER_STORE_DWORD ||</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;       Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>() == AMDGPU::BUFFER_STORE_DWORDX2 ||</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;       Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>() == AMDGPU::BUFFER_STORE_DWORDX4) {</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <a class="code" href="classllvm_1_1MachineOperand.html">MachineOperand</a> *MO = <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getNamedOperand(Inst, AMDGPU::OpName::data);</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <span class="keywordtype">unsigned</span> OpNo;<span class="comment">//TODO: find the OpNo for this operand;</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    RegInterval <a class="code" href="classllvm_1_1Interval.html">Interval</a> = getRegInterval(&amp;Inst, <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, OpNo);</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> RegNo = <a class="code" href="classllvm_1_1Interval.html">Interval</a>.first; RegNo &lt; <a class="code" href="classllvm_1_1Interval.html">Interval</a>.second;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    ++RegNo) {</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      setRegScore(RegNo + NUM_ALL_VGPRS, <a class="code" href="README-SSE_8txt.html#a50fd53d9a3e55ae78555e11827355565">t</a>, CurrScore);</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    }</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="comment">// Match the score to the destination registers.</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a432824f0975bb863478bf4ef3a5df258">getNumOperands</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      <span class="keyword">auto</span> &amp;<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a3f7a45f6e10668a5f702e26bca80d18e">getOperand</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.isReg() || !<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.isDef())</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      RegInterval <a class="code" href="classllvm_1_1Interval.html">Interval</a> = getRegInterval(&amp;Inst, <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classT.html">T</a> == <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>) {</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Interval.html">Interval</a>.first &gt;= NUM_ALL_VGPRS)</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        <span class="keywordflow">if</span> (updateVMCntOnly(Inst)) {</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;          VmemType V = getVmemType(Inst);</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> RegNo = <a class="code" href="classllvm_1_1Interval.html">Interval</a>.first; RegNo &lt; <a class="code" href="classllvm_1_1Interval.html">Interval</a>.second; ++RegNo)</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            VgprVmemTypes[RegNo] |= 1 &lt;&lt; V;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        }</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      }</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> RegNo = <a class="code" href="classllvm_1_1Interval.html">Interval</a>.first; RegNo &lt; <a class="code" href="classllvm_1_1Interval.html">Interval</a>.second; ++RegNo) {</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        setRegScore(RegNo, <a class="code" href="classT.html">T</a>, CurrScore);</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      }</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    }</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keywordflow">if</span> (Inst.<a class="code" href="classllvm_1_1MachineInstr.html#ab96f3235c18e659758517d0532d606c9">mayStore</a>() &amp;&amp; (<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isDS(Inst) || <a class="code" href="SIInsertWaitcnts_8cpp.html#ab4827b9d3e3811c1e2f5cbe42b5174e3">mayWriteLDSThroughDMA</a>(Inst))) {</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      setRegScore(SQ_MAX_PGM_VGPRS + EXTRA_VGPR_LDS, <a class="code" href="classT.html">T</a>, CurrScore);</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    }</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  }</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;}</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160; </div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="keywordtype">void</span> <a class="code" href="ArchiveWriter_8cpp.html#aa9f638c7ae7fdd206a6c60e26bef9751">WaitcntBrackets::print</a>(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;<a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>) {</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;  <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="classT.html">T</a> : inst_counter_types()) {</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="keywordtype">unsigned</span> SR = getScoreRange(<a class="code" href="classT.html">T</a>);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160; </div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="classT.html">T</a>) {</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>:</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;      <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; <span class="stringliteral">&quot;    VM_CNT(&quot;</span> &lt;&lt; SR &lt;&lt; <span class="stringliteral">&quot;): &quot;</span>;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>:</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; <span class="stringliteral">&quot;    LGKM_CNT(&quot;</span> &lt;&lt; SR &lt;&lt; <span class="stringliteral">&quot;): &quot;</span>;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">EXP_CNT</a>:</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; <span class="stringliteral">&quot;    EXP_CNT(&quot;</span> &lt;&lt; SR &lt;&lt; <span class="stringliteral">&quot;): &quot;</span>;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <span class="keywordflow">case</span> VS_CNT:</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; <span class="stringliteral">&quot;    VS_CNT(&quot;</span> &lt;&lt; SR &lt;&lt; <span class="stringliteral">&quot;): &quot;</span>;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; <span class="stringliteral">&quot;    UNKNOWN(&quot;</span> &lt;&lt; SR &lt;&lt; <span class="stringliteral">&quot;): &quot;</span>;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    }</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160; </div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keywordflow">if</span> (SR != 0) {</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      <span class="comment">// Print vgpr scores.</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      <span class="keywordtype">unsigned</span> LB = getScoreLB(<a class="code" href="classT.html">T</a>);</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160; </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> J = 0; J &lt;= VgprUB; J++) {</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        <span class="keywordtype">unsigned</span> RegScore = getRegScore(J, <a class="code" href="classT.html">T</a>);</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        <span class="keywordflow">if</span> (RegScore &lt;= LB)</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        <span class="keywordtype">unsigned</span> RelScore = RegScore - LB - 1;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        <span class="keywordflow">if</span> (J &lt; SQ_MAX_PGM_VGPRS + EXTRA_VGPR_LDS) {</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;          <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; RelScore &lt;&lt; <span class="stringliteral">&quot;:v&quot;</span> &lt;&lt; J &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;          <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; RelScore &lt;&lt; <span class="stringliteral">&quot;:ds &quot;</span>;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        }</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      }</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      <span class="comment">// Also need to print sgpr scores for lgkm_cnt.</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classT.html">T</a> == <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>) {</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> J = 0; J &lt;= SgprUB; J++) {</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;          <span class="keywordtype">unsigned</span> RegScore = getRegScore(J + NUM_ALL_VGPRS, <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>);</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;          <span class="keywordflow">if</span> (RegScore &lt;= LB)</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;          <span class="keywordtype">unsigned</span> RelScore = RegScore - LB - 1;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;          <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; RelScore &lt;&lt; <span class="stringliteral">&quot;:s&quot;</span> &lt;&lt; J &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        }</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      }</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    }</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;  }</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;}</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="comment">/// Simplify the waitcnt, in the sense of removing redundant counts, and return</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="comment">/// whether a waitcnt instruction is needed at all.</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> WaitcntBrackets::simplifyWaitcnt(AMDGPU::Waitcnt &amp;<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  simplifyWaitcnt(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>, <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.VmCnt);</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  simplifyWaitcnt(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">EXP_CNT</a>, <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.ExpCnt);</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  simplifyWaitcnt(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>, <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.LgkmCnt);</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  simplifyWaitcnt(VS_CNT, <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.VsCnt);</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;}</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160; </div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="keywordtype">void</span> WaitcntBrackets::simplifyWaitcnt(InstCounterType <a class="code" href="classT.html">T</a>,</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                                      <span class="keywordtype">unsigned</span> &amp;Count)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  <span class="comment">// The number of outstanding events for this type, T, can be calculated</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  <span class="comment">// as (UB - LB). If the current Count is greater than or equal to the number</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  <span class="comment">// of outstanding events, then the wait for this counter is redundant.</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <span class="keywordflow">if</span> (Count &gt;= getScoreRange(<a class="code" href="classT.html">T</a>))</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    Count = ~0u;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;}</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160; </div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="keywordtype">void</span> WaitcntBrackets::determineWait(InstCounterType <a class="code" href="classT.html">T</a>, <span class="keywordtype">int</span> RegNo,</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;                                    AMDGPU::Waitcnt &amp;<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  <span class="keywordtype">unsigned</span> ScoreToWait = getRegScore(RegNo, <a class="code" href="classT.html">T</a>);</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160; </div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  <span class="comment">// If the score of src_operand falls within the bracket, we need an</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  <span class="comment">// s_waitcnt instruction.</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> LB = getScoreLB(<a class="code" href="classT.html">T</a>);</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> UB = getScoreUB(<a class="code" href="classT.html">T</a>);</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <span class="keywordflow">if</span> ((UB &gt;= ScoreToWait) &amp;&amp; (ScoreToWait &gt; LB)) {</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="classT.html">T</a> == <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a> || <a class="code" href="classT.html">T</a> == <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>) &amp;&amp;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        hasPendingFlat() &amp;&amp;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        !<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;hasFlatLgkmVMemCountInOrder()) {</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      <span class="comment">// If there is a pending FLAT operation, and this is a VMem or LGKM</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;      <span class="comment">// waitcnt and the target can report early completion, then we need</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;      <span class="comment">// to force a waitcnt 0.</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;      addWait(<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>, <a class="code" href="classT.html">T</a>, 0);</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (counterOutOfOrder(<a class="code" href="classT.html">T</a>)) {</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;      <span class="comment">// Counter can get decremented out-of-order when there</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;      <span class="comment">// are multiple types event in the bracket. Also emit an s_wait counter</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;      <span class="comment">// with a conservative value of 0 for the counter.</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;      addWait(<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>, <a class="code" href="classT.html">T</a>, 0);</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;      <span class="comment">// If a counter has been maxed out avoid overflow by waiting for</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;      <span class="comment">// MAX(CounterType) - 1 instead.</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;      <span class="keywordtype">unsigned</span> NeededWait = <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(UB - ScoreToWait, getWaitCountMax(<a class="code" href="classT.html">T</a>) - 1);</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;      addWait(<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>, <a class="code" href="classT.html">T</a>, NeededWait);</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    }</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  }</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;}</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160; </div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="keywordtype">void</span> WaitcntBrackets::applyWaitcnt(<span class="keyword">const</span> AMDGPU::Waitcnt &amp;<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>) {</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  applyWaitcnt(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>, <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.VmCnt);</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  applyWaitcnt(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">EXP_CNT</a>, <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.ExpCnt);</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  applyWaitcnt(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>, <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.LgkmCnt);</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  applyWaitcnt(VS_CNT, <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.VsCnt);</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;}</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160; </div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;<span class="keywordtype">void</span> WaitcntBrackets::applyWaitcnt(InstCounterType <a class="code" href="classT.html">T</a>, <span class="keywordtype">unsigned</span> Count) {</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> UB = getScoreUB(<a class="code" href="classT.html">T</a>);</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;  <span class="keywordflow">if</span> (Count &gt;= UB)</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  <span class="keywordflow">if</span> (Count != 0) {</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keywordflow">if</span> (counterOutOfOrder(<a class="code" href="classT.html">T</a>))</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    setScoreLB(<a class="code" href="classT.html">T</a>, <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(getScoreLB(<a class="code" href="classT.html">T</a>), UB - Count));</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    setScoreLB(<a class="code" href="classT.html">T</a>, UB);</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    PendingEvents &amp;= ~WaitEventMaskForInst[<a class="code" href="classT.html">T</a>];</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  }</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;}</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160; </div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="comment">// Where there are multiple types of event in the bracket of a counter,</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="comment">// the decrement may go out of order.</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="keywordtype">bool</span> WaitcntBrackets::counterOutOfOrder(InstCounterType <a class="code" href="classT.html">T</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  <span class="comment">// Scalar memory read always can go out of order.</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classT.html">T</a> == <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a> &amp;&amp; hasPendingEvent(SMEM_ACCESS))</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  <span class="keywordflow">return</span> hasMixedPendingEvents(<a class="code" href="classT.html">T</a>);</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;}</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160; </div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<a class="code" href="SIInsertWaitcnts_8cpp.html#a87d0ba229f3fffeaafd9aba7162ba52e">INITIALIZE_PASS_BEGIN</a>(SIInsertWaitcnts, <a class="code" href="SIInsertWaitcnts_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a>, <span class="stringliteral">&quot;SI Insert Waitcnts&quot;</span>, <span class="keyword">false</span>,</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;                      <span class="keyword">false</span>)</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<a class="code" href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1MachineLoopInfo.html">MachineLoopInfo</a>)</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<a class="code" href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1MachinePostDominatorTree.html">MachinePostDominatorTree</a>)</div>
<div class="line"><a name="l00843"></a><span class="lineno"><a class="line" href="SIInsertWaitcnts_8cpp.html#aec4edf4f2cb93125b6dce45fbecfc556">  843</a></span>&#160;<a class="code" href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a>(SIInsertWaitcnts, <a class="code" href="SIInsertWaitcnts_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a>, &quot;<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> Insert <a class="code" href="SIInsertWaitcnts_8cpp.html#aec4edf4f2cb93125b6dce45fbecfc556">Waitcnts</a>&quot;, <a class="code" href="namespacefalse.html">false</a>,</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;                    <a class="code" href="namespacefalse.html">false</a>)</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160; </div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="keywordtype">char</span> SIInsertWaitcnts::<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a> = 0;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160; </div>
<div class="line"><a name="l00848"></a><span class="lineno"><a class="line" href="namespacellvm.html#a5f92d578f7a7f3e9b454449bbcd0e52b">  848</a></span>&#160;<span class="keywordtype">char</span> &amp;<a class="code" href="namespacellvm.html">llvm</a>::<a class="code" href="namespacellvm.html#a5f92d578f7a7f3e9b454449bbcd0e52b">SIInsertWaitcntsID</a> = SIInsertWaitcnts::<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160; </div>
<div class="line"><a name="l00850"></a><span class="lineno"><a class="line" href="namespacellvm.html#ae1f1b566607514b37834c2667e016954">  850</a></span>&#160;<a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a> *<a class="code" href="namespacellvm.html">llvm</a>::<a class="code" href="namespacellvm.html#ae1f1b566607514b37834c2667e016954">createSIInsertWaitcntsPass</a>() {</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> SIInsertWaitcnts();</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;}</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160; </div>
<div class="line"><a name="l00854"></a><span class="lineno"><a class="line" href="SIInsertWaitcnts_8cpp.html#a76c206acce516598d664c520bf1223a9">  854</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SIInsertWaitcnts_8cpp.html#a76c206acce516598d664c520bf1223a9">updateOperandIfDifferent</a>(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a class="code" href="classuint16__t.html">uint16_t</a> <a class="code" href="namespaceOpName.html">OpName</a>,</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;                                     <span class="keywordtype">unsigned</span> NewEnc) {</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  <span class="keywordtype">int</span> OpIdx = <a class="code" href="namespacellvm_1_1AMDGPU.html#a27efe1286cc31f5fc95355af30b0356c">AMDGPU::getNamedOperandIdx</a>(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode(), <a class="code" href="namespaceOpName.html">OpName</a>);</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OpIdx &gt;= 0);</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160; </div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <a class="code" href="classllvm_1_1MachineOperand.html">MachineOperand</a> &amp;MO = <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOperand(OpIdx);</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160; </div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  <span class="keywordflow">if</span> (NewEnc == MO.<a class="code" href="classllvm_1_1MachineOperand.html#a38b28a85f818b49d8806c150b8a5b4f7">getImm</a>())</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160; </div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  MO.<a class="code" href="classllvm_1_1MachineOperand.html#a2feaa1c69335c6b9028076cd68c7a5f5">setImm</a>(NewEnc);</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;}</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;<span class="comment">/// Combine consecutive waitcnt instructions that precede \p It and follow</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="comment">/// \p OldWaitcntInstr and apply any extra wait from waitcnt that were added</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="comment">/// by previous passes. Currently this pass conservatively assumes that these</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="comment">/// preexisting waitcnt are required for correctness.</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> SIInsertWaitcnts::applyPreexistingWaitcnt(</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    WaitcntBrackets &amp;ScoreBrackets, <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;OldWaitcntInstr,</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    AMDGPU::Waitcnt &amp;<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>, <a class="code" href="classllvm_1_1ilist__iterator.html">MachineBasicBlock::instr_iterator</a> It)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *WaitcntInstr = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *WaitcntVsCntInstr = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160; </div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;II :</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;       <a class="code" href="namespacellvm.html#a8154638df88e4eaa568b67b23d463dac">make_early_inc_range</a>(<a class="code" href="namespacellvm.html#ad1a91b49e0c092818a0b82f6cc130a1b">make_range</a>(OldWaitcntInstr.<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>(), It))) {</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="keywordflow">if</span> (II.isMetaInstruction())</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160; </div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="keywordflow">if</span> (II.getOpcode() == AMDGPU::S_WAITCNT) {</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;      <span class="comment">// Conservatively update required wait if this waitcnt was added in an</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      <span class="comment">// earlier pass. In this case it will not exist in the tracked waitcnt</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      <span class="comment">// set.</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;      <span class="keywordflow">if</span> (!TrackedWaitcntSet.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#afe504aa31a6a354cec13f5b32d0b1d9d">count</a>(&amp;II)) {</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        <span class="keywordtype">unsigned</span> IEnc = II.<a class="code" href="classllvm_1_1MachineInstr.html#a3f7a45f6e10668a5f702e26bca80d18e">getOperand</a>(0).<a class="code" href="classllvm_1_1MachineOperand.html#a38b28a85f818b49d8806c150b8a5b4f7">getImm</a>();</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        AMDGPU::Waitcnt OldWait = <a class="code" href="namespacellvm_1_1AMDGPU.html#a0d3e0a75774a86f6c8302eee2dfe1326">AMDGPU::decodeWaitcnt</a>(<a class="code" href="blake3__impl_8h.html#a78823051d1dad34b9b3d8120112e674d">IV</a>, IEnc);</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a> = <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.combined(OldWait);</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;      }</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160; </div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;      <span class="comment">// Merge consecutive waitcnt of the same type by erasing multiples.</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;      <span class="keywordflow">if</span> (!WaitcntInstr) {</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;        WaitcntInstr = &amp;II;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        II.<a class="code" href="classllvm_1_1MachineInstr.html#ac2421adbb9996e1b15f03a8abb6c70a8">eraseFromParent</a>();</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      }</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160; </div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(II.getOpcode() == AMDGPU::S_WAITCNT_VSCNT);</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(II.getOperand(0).getReg() == AMDGPU::SGPR_NULL);</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;      <span class="keywordflow">if</span> (!TrackedWaitcntSet.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#afe504aa31a6a354cec13f5b32d0b1d9d">count</a>(&amp;II)) {</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        <span class="keywordtype">unsigned</span> OldVSCnt =</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;            <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getNamedOperand(II, AMDGPU::OpName::simm16)-&gt;getImm();</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.VsCnt = <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.VsCnt, OldVSCnt);</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;      }</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160; </div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;      <span class="keywordflow">if</span> (!WaitcntVsCntInstr) {</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        WaitcntVsCntInstr = &amp;II;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        II.<a class="code" href="classllvm_1_1MachineInstr.html#ac2421adbb9996e1b15f03a8abb6c70a8">eraseFromParent</a>();</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      }</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    }</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  }</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160; </div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  <span class="comment">// Updated encoding of merged waitcnt with the required wait.</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  <span class="keywordflow">if</span> (WaitcntInstr) {</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.hasWaitExceptVsCnt()) {</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> |=</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;          <a class="code" href="SIInsertWaitcnts_8cpp.html#a76c206acce516598d664c520bf1223a9">updateOperandIfDifferent</a>(*WaitcntInstr, AMDGPU::OpName::simm16,</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                                   <a class="code" href="namespacellvm_1_1AMDGPU.html#a538a5f491696e8b8ef0987e3aaedbb37">AMDGPU::encodeWaitcnt</a>(<a class="code" href="blake3__impl_8h.html#a78823051d1dad34b9b3d8120112e674d">IV</a>, <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>));</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      ScoreBrackets.applyWaitcnt(<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>);</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.VmCnt = ~0u;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.LgkmCnt = ~0u;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;      <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.ExpCnt = ~0u;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160; </div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(It == OldWaitcntInstr.<a class="code" href="classllvm_1_1MachineInstr.html#a002fd916e7206e01d512eeb06d405cf0">getParent</a>()-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#acbc921830578e2741be6549db716c0ce">end</a>()</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;                     ? <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;applyPreexistingWaitcnt\n&quot;</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;                              &lt;&lt; <span class="stringliteral">&quot;New Instr at block end: &quot;</span> &lt;&lt; *WaitcntInstr</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                              &lt;&lt; <span class="charliteral">&#39;\n&#39;</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                     : <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;applyPreexistingWaitcnt\n&quot;</span></div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                              &lt;&lt; <span class="stringliteral">&quot;Old Instr: &quot;</span> &lt;&lt; *It</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                              &lt;&lt; <span class="stringliteral">&quot;New Instr: &quot;</span> &lt;&lt; *WaitcntInstr &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160; </div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;      WaitcntInstr-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#ac2421adbb9996e1b15f03a8abb6c70a8">eraseFromParent</a>();</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;      <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    }</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  }</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160; </div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <span class="keywordflow">if</span> (WaitcntVsCntInstr) {</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.hasWaitVsCnt()) {</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;hasVscnt());</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;      <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> |= <a class="code" href="SIInsertWaitcnts_8cpp.html#a76c206acce516598d664c520bf1223a9">updateOperandIfDifferent</a>(*WaitcntVsCntInstr,</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;                                           AMDGPU::OpName::simm16, <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.VsCnt);</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;      ScoreBrackets.applyWaitcnt(<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>);</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;      <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.VsCnt = ~0u;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160; </div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(It == OldWaitcntInstr.<a class="code" href="classllvm_1_1MachineInstr.html#a002fd916e7206e01d512eeb06d405cf0">getParent</a>()-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#acbc921830578e2741be6549db716c0ce">end</a>()</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                     ? <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;applyPreexistingWaitcnt\n&quot;</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                              &lt;&lt; <span class="stringliteral">&quot;New Instr at block end: &quot;</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                              &lt;&lt; *WaitcntVsCntInstr &lt;&lt; <span class="charliteral">&#39;\n&#39;</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                     : <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;applyPreexistingWaitcnt\n&quot;</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                              &lt;&lt; <span class="stringliteral">&quot;Old Instr: &quot;</span> &lt;&lt; *It</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                              &lt;&lt; <span class="stringliteral">&quot;New Instr: &quot;</span> &lt;&lt; *WaitcntVsCntInstr &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;      WaitcntVsCntInstr-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#ac2421adbb9996e1b15f03a8abb6c70a8">eraseFromParent</a>();</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;      <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    }</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  }</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160; </div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;}</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160; </div>
<div class="line"><a name="l00969"></a><span class="lineno"><a class="line" href="SIInsertWaitcnts_8cpp.html#a94ceb20d45e28266a8e3c88177cd5433">  969</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SIInsertWaitcnts_8cpp.html#a94ceb20d45e28266a8e3c88177cd5433">readsVCCZ</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) {</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  <span class="keywordtype">unsigned</span> Opc = <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode();</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <span class="keywordflow">return</span> (Opc == AMDGPU::S_CBRANCH_VCCNZ || Opc == AMDGPU::S_CBRANCH_VCCZ) &amp;&amp;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;         !<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOperand(1).isUndef();</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;}</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="comment">/// \returns true if the callee inserts an s_waitcnt 0 on function entry.</span></div>
<div class="line"><a name="l00976"></a><span class="lineno"><a class="line" href="SIInsertWaitcnts_8cpp.html#a5afc28dc25e85e7b88c083ef9fc1e9d3">  976</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SIInsertWaitcnts_8cpp.html#a5afc28dc25e85e7b88c083ef9fc1e9d3">callWaitsOnFunctionEntry</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) {</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  <span class="comment">// Currently all conventions wait, but this may not always be the case.</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  <span class="comment">// TODO: If IPRA is enabled, and the callee is isSafeForNoCSROpt, it may make</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  <span class="comment">// senses to omit the wait and do it in the caller.</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;}</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="comment">/// \returns true if the callee is expected to wait for any outstanding waits</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="comment">/// before returning.</span></div>
<div class="line"><a name="l00986"></a><span class="lineno"><a class="line" href="SIInsertWaitcnts_8cpp.html#a12875f783295ef0f67d11ae574bdcfdd">  986</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SIInsertWaitcnts_8cpp.html#a12875f783295ef0f67d11ae574bdcfdd">callWaitsOnFunctionReturn</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) {</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;}</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="comment">///  Generate s_waitcnt instruction to be placed before cur_Inst.</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="comment">///  Instructions of a given type are returned in order,</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="comment">///  but instructions of different types can complete out of order.</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;<span class="comment">///  We rely on this in-order completion</span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="comment">///  and simply assign a score to the memory access instructions.</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;<span class="comment">///  We keep track of the active &quot;score bracket&quot; to determine</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="comment">///  if an access of a memory read requires an s_waitcnt</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;<span class="comment">///  and if so what the value of each counter is.</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="comment">///  The &quot;score bracket&quot; is bound by the lower bound and upper bound</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="comment">///  scores (*_score_LB and *_score_ub respectively).</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="comment">///  If FlushVmCnt is true, that means that we want to generate a s_waitcnt to</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="comment">///  flush the vmcnt counter here.</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> SIInsertWaitcnts::generateWaitcntInstBefore(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>,</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;                                                 WaitcntBrackets &amp;ScoreBrackets,</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;                                                 <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *OldWaitcntInstr,</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;                                                 <span class="keywordtype">bool</span> FlushVmCnt) {</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  setForceEmitWaitcnt();</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160; </div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isMetaInstruction())</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160; </div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  AMDGPU::Waitcnt <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160; </div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  <span class="comment">// FIXME: This should have already been handled by the memory legalizer.</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  <span class="comment">// Removing this currently doesn&#39;t affect any lit tests, but we need to</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  <span class="comment">// verify that nothing was relying on this. The number of buffer invalidates</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;  <span class="comment">// being handled here should not be expanded.</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == AMDGPU::BUFFER_WBINVL1 ||</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;      <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == AMDGPU::BUFFER_WBINVL1_SC ||</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;      <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == AMDGPU::BUFFER_WBINVL1_VOL ||</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;      <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == AMDGPU::BUFFER_GL0_INV ||</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == AMDGPU::BUFFER_GL1_INV) {</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.VmCnt = 0;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  }</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160; </div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  <span class="comment">// All waits must be resolved at call return.</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;  <span class="comment">// NOTE: this could be improved with knowledge of all call sites or</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  <span class="comment">//   with knowledge of the called routines.</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == AMDGPU::SI_RETURN_TO_EPILOG ||</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == AMDGPU::SI_RETURN ||</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;      <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == AMDGPU::S_SETPC_B64_return ||</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      (<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isReturn() &amp;&amp; <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isCall() &amp;&amp; !<a class="code" href="SIInsertWaitcnts_8cpp.html#a5afc28dc25e85e7b88c083ef9fc1e9d3">callWaitsOnFunctionEntry</a>(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>))) {</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a> = <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.combined(allZeroWaitcnt());</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  }</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  <span class="comment">// Resolve vm waits before gs-done.</span></div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == AMDGPU::S_SENDMSG ||</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;            <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == AMDGPU::S_SENDMSGHALT) &amp;&amp;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;           <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;hasLegacyGeometry() &amp;&amp;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;           ((<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOperand(0).getImm() &amp; <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a3a326b706ed4c9caaca05063b47c98dba2725a8fe1793af838f1f598cf482dd94">AMDGPU::SendMsg::ID_MASK_PreGFX11_</a>) ==</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;            <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a3a326b706ed4c9caaca05063b47c98dbac1f00b8c9ee08df6cb5378168b3e3353">AMDGPU::SendMsg::ID_GS_DONE_PreGFX11</a>)) {</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.VmCnt = 0;</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  }</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="preprocessor">#if 0 // TODO: the following blocks of logic when we have fence.</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == SC_FENCE) {</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> group_size =</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;      context-&gt;shader_info-&gt;GetMaxThreadGroupSize();</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    <span class="comment">// group_size == 0 means thread group size is unknown at compile time</span></div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> group_is_multi_wave =</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;      (group_size == 0 || group_size &gt; target_info-&gt;GetWaveFrontSize());</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> fence_is_global = !((SCInstInternalMisc*)Inst)-&gt;IsGroupFence();</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160; </div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; Inst-&gt;NumSrcOperands(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;      SCRegType src_type = Inst-&gt;GetSrcType(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;      <span class="keywordflow">switch</span> (src_type) {</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        <span class="keywordflow">case</span> SCMEM_LDS:</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;          <span class="keywordflow">if</span> (group_is_multi_wave ||</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;            context-&gt;OptFlagIsOn(OPT_R1100_LDSMEM_FENCE_CHICKEN_BIT)) {</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;            EmitWaitcnt |= ScoreBrackets-&gt;updateByWait(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>,</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;                               ScoreBrackets-&gt;getScoreUB(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>));</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;            <span class="comment">// LDS may have to wait for VM_CNT after buffer load to LDS</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;            <span class="keywordflow">if</span> (target_info-&gt;HasBufferLoadToLDS()) {</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;              EmitWaitcnt |= ScoreBrackets-&gt;updateByWait(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>,</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;                                 ScoreBrackets-&gt;getScoreUB(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>));</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;            }</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;          }</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160; </div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;        <span class="keywordflow">case</span> SCMEM_GDS:</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;          <span class="keywordflow">if</span> (group_is_multi_wave || fence_is_global) {</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;            EmitWaitcnt |= ScoreBrackets-&gt;updateByWait(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">EXP_CNT</a>,</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;              ScoreBrackets-&gt;getScoreUB(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">EXP_CNT</a>));</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;            EmitWaitcnt |= ScoreBrackets-&gt;updateByWait(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>,</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;              ScoreBrackets-&gt;getScoreUB(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>));</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;          }</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160; </div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        <span class="keywordflow">case</span> SCMEM_UAV:</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        <span class="keywordflow">case</span> SCMEM_TFBUF:</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        <span class="keywordflow">case</span> SCMEM_RING:</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;        <span class="keywordflow">case</span> SCMEM_SCATTER:</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;          <span class="keywordflow">if</span> (group_is_multi_wave || fence_is_global) {</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;            EmitWaitcnt |= ScoreBrackets-&gt;updateByWait(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">EXP_CNT</a>,</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;              ScoreBrackets-&gt;getScoreUB(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">EXP_CNT</a>));</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;            EmitWaitcnt |= ScoreBrackets-&gt;updateByWait(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>,</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;              ScoreBrackets-&gt;getScoreUB(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>));</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;          }</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160; </div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;        <span class="keywordflow">case</span> SCMEM_SCRATCH:</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;      }</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    }</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  }</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160; </div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;  <span class="comment">// Export &amp; GDS instructions do not read the EXEC mask until after the export</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  <span class="comment">// is granted (which can occur well after the instruction is issued).</span></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;  <span class="comment">// The shader program must flush all EXP operations on the export-count</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  <span class="comment">// before overwriting the EXEC mask.</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.modifiesRegister(AMDGPU::EXEC, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>)) {</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;      <span class="comment">// Export and GDS are tracked individually, either may trigger a waitcnt</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;      <span class="comment">// for EXEC.</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      <span class="keywordflow">if</span> (ScoreBrackets.hasPendingEvent(EXP_GPR_LOCK) ||</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;          ScoreBrackets.hasPendingEvent(EXP_PARAM_ACCESS) ||</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;          ScoreBrackets.hasPendingEvent(EXP_POS_ACCESS) ||</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;          ScoreBrackets.hasPendingEvent(GDS_GPR_LOCK)) {</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.ExpCnt = 0;</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      }</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    }</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160; </div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isCall() &amp;&amp; <a class="code" href="SIInsertWaitcnts_8cpp.html#a5afc28dc25e85e7b88c083ef9fc1e9d3">callWaitsOnFunctionEntry</a>(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>)) {</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;      <span class="comment">// The function is going to insert a wait on everything in its prolog.</span></div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      <span class="comment">// This still needs to be careful if the call target is a load (e.g. a GOT</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      <span class="comment">// load). We also need to check WAW dependency with saved PC.</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;      <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a> = AMDGPU::Waitcnt();</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160; </div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;      <span class="keywordtype">int</span> CallAddrOpIdx =</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;          <a class="code" href="namespacellvm_1_1AMDGPU.html#a27efe1286cc31f5fc95355af30b0356c">AMDGPU::getNamedOperandIdx</a>(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode(), AMDGPU::OpName::src0);</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160; </div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOperand(CallAddrOpIdx).isReg()) {</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;        RegInterval CallAddrOpInterval =</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;          ScoreBrackets.getRegInterval(&amp;<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, CallAddrOpIdx);</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160; </div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> RegNo = CallAddrOpInterval.first;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;             RegNo &lt; CallAddrOpInterval.second; ++RegNo)</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;          ScoreBrackets.determineWait(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>, RegNo, <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>);</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160; </div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;        <span class="keywordtype">int</span> RtnAddrOpIdx =</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;          <a class="code" href="namespacellvm_1_1AMDGPU.html#a27efe1286cc31f5fc95355af30b0356c">AMDGPU::getNamedOperandIdx</a>(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode(), AMDGPU::OpName::dst);</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;        <span class="keywordflow">if</span> (RtnAddrOpIdx != -1) {</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;          RegInterval RtnAddrOpInterval =</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;            ScoreBrackets.getRegInterval(&amp;<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, RtnAddrOpIdx);</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160; </div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> RegNo = RtnAddrOpInterval.first;</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;               RegNo &lt; RtnAddrOpInterval.second; ++RegNo)</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;            ScoreBrackets.determineWait(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>, RegNo, <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>);</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;        }</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;      }</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;      <span class="comment">// FIXME: Should not be relying on memoperands.</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;      <span class="comment">// Look at the source operands of every instruction to see if</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;      <span class="comment">// any of them results from a previous memory operation that affects</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;      <span class="comment">// its current usage. If so, an s_waitcnt instruction needs to be</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;      <span class="comment">// emitted.</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      <span class="comment">// If the source operand was defined by a load, add the s_waitcnt</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;      <span class="comment">// instruction.</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;      <span class="comment">// Two cases are handled for destination operands:</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;      <span class="comment">// 1) If the destination operand was defined by a load, add the s_waitcnt</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;      <span class="comment">// instruction to guarantee the right WAW order.</span></div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      <span class="comment">// 2) If a destination operand that was used by a recent export/store ins,</span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;      <span class="comment">// add s_waitcnt on exp_cnt to guarantee the WAR order.</span></div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineMemOperand.html">MachineMemOperand</a> *Memop : <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.memoperands()) {</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;        <span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = Memop-&gt;getValue();</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;        <span class="keywordflow">if</span> (Memop-&gt;isStore() &amp;&amp; SLoadAddresses.<a class="code" href="classllvm_1_1DenseMapBase.html#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>)) {</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;          addWait(<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>, <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>, 0);</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;          <span class="keywordflow">if</span> (PDT-&gt;<a class="code" href="classllvm_1_1MachinePostDominatorTree.html#a17ffb2f5742f992dd5e6562430918bce">dominates</a>(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getParent(), SLoadAddresses.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>)-&gt;second))</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;            SLoadAddresses.<a class="code" href="classllvm_1_1DenseMapBase.html#a1eb8504bab5f794778d82db6ac829923">erase</a>(<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        }</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;        <span class="keywordtype">unsigned</span> AS = Memop-&gt;getAddrSpace();</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;        <span class="keywordflow">if</span> (AS != <a class="code" href="namespacellvm_1_1AMDGPUAS.html#ab1843c6566c95d94d6e36a857b8d2b3fa77b1c964e2ff99057bf5e75140457abe">AMDGPUAS::LOCAL_ADDRESS</a> &amp;&amp; AS != <a class="code" href="namespacellvm_1_1AMDGPUAS.html#ab1843c6566c95d94d6e36a857b8d2b3faaa1e27e4fc68e5706a4b7bbaed447c14">AMDGPUAS::FLAT_ADDRESS</a>)</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;        <span class="comment">// No need to wait before load from VMEM to LDS.</span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="SIInsertWaitcnts_8cpp.html#ab4827b9d3e3811c1e2f5cbe42b5174e3">mayWriteLDSThroughDMA</a>(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>))</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;        <span class="keywordtype">unsigned</span> RegNo = SQ_MAX_PGM_VGPRS + EXTRA_VGPR_LDS;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;        <span class="comment">// VM_CNT is only relevant to vgpr or LDS.</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;        ScoreBrackets.determineWait(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>, RegNo, <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>);</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        <span class="keywordflow">if</span> (Memop-&gt;isStore()) {</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;          ScoreBrackets.determineWait(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">EXP_CNT</a>, RegNo, <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>);</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;        }</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;      }</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160; </div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;      <span class="comment">// Loop over use and def operands.</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getNumOperands(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;        <a class="code" href="classllvm_1_1MachineOperand.html">MachineOperand</a> &amp;<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOperand(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.isReg())</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160; </div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;        <span class="comment">// If the instruction does not read tied source, skip the operand.</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.isTied() &amp;&amp; <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.isUse() &amp;&amp; <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;doesNotReadTiedSource(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>))</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160; </div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;        RegInterval <a class="code" href="classllvm_1_1Interval.html">Interval</a> =</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;            ScoreBrackets.getRegInterval(&amp;<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160; </div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> IsVGPR = <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;isVectorRegister(*<a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.getReg());</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> RegNo = <a class="code" href="classllvm_1_1Interval.html">Interval</a>.first; RegNo &lt; <a class="code" href="classllvm_1_1Interval.html">Interval</a>.second; ++RegNo) {</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;          <span class="keywordflow">if</span> (IsVGPR) {</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;            <span class="comment">// RAW always needs an s_waitcnt. WAW needs an s_waitcnt unless the</span></div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;            <span class="comment">// previous write and this write are the same type of VMEM</span></div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;            <span class="comment">// instruction, in which case they&#39;re guaranteed to write their</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;            <span class="comment">// results in order anyway.</span></div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.isUse() || !updateVMCntOnly(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) ||</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;                ScoreBrackets.hasOtherPendingVmemTypes(RegNo,</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;                                                       getVmemType(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>))) {</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;              ScoreBrackets.determineWait(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>, RegNo, <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>);</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;              ScoreBrackets.clearVgprVmemTypes(RegNo);</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;            }</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.isDef() || ScoreBrackets.hasPendingEvent(EXP_LDS_ACCESS)) {</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;              ScoreBrackets.determineWait(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">EXP_CNT</a>, RegNo, <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>);</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;            }</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;          }</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;          ScoreBrackets.determineWait(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>, RegNo, <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>);</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        }</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;      }</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    }</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;  }</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160; </div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;  <span class="comment">// The subtarget may have an implicit S_WAITCNT 0 before barriers. If it does</span></div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;  <span class="comment">// not, we need to ensure the subtarget is capable of backing off barrier</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;  <span class="comment">// instructions in case there are any outstanding memory operations that may</span></div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;  <span class="comment">// cause an exception. Otherwise, insert an explicit S_WAITCNT 0 here.</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == AMDGPU::S_BARRIER &amp;&amp;</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;      !<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;hasAutoWaitcntBeforeBarrier() &amp;&amp; !<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;supportsBackOffBarrier()) {</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a> = <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.combined(allZeroWaitcnt());</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;  }</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160; </div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;  <span class="comment">// TODO: Remove this work-around, enable the assert for Bug 457939</span></div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  <span class="comment">//       after fixing the scheduler. Also, the Shader Compiler code is</span></div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  <span class="comment">//       independent of target.</span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SIInsertWaitcnts_8cpp.html#a94ceb20d45e28266a8e3c88177cd5433">readsVCCZ</a>(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) &amp;&amp; <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;hasReadVCCZBug()) {</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <span class="keywordflow">if</span> (ScoreBrackets.hasPendingEvent(SMEM_ACCESS)) {</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;      <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.LgkmCnt = 0;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    }</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;  }</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160; </div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;  <span class="comment">// Verify that the wait is actually needed.</span></div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  ScoreBrackets.simplifyWaitcnt(<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>);</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160; </div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;  <span class="keywordflow">if</span> (ForceEmitZeroWaitcnts)</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a> = allZeroWaitcnt();</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160; </div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;  <span class="keywordflow">if</span> (ForceEmitWaitcnt[<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>])</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.VmCnt = 0;</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;  <span class="keywordflow">if</span> (ForceEmitWaitcnt[<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">EXP_CNT</a>])</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.ExpCnt = 0;</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  <span class="keywordflow">if</span> (ForceEmitWaitcnt[<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>])</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.LgkmCnt = 0;</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;  <span class="keywordflow">if</span> (ForceEmitWaitcnt[VS_CNT])</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.VsCnt = 0;</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160; </div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  <span class="keywordflow">if</span> (FlushVmCnt) {</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    <span class="keywordflow">if</span> (ScoreBrackets.hasPendingEvent(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>))</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;      <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.VmCnt = 0;</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;  }</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160; </div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;  <span class="keywordflow">return</span> generateWaitcnt(<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>, <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getIterator(), *<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getParent(), ScoreBrackets,</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;                         OldWaitcntInstr);</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;}</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160; </div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="comment">// Add a waitcnt to flush the vmcnt counter at the end of the given block if</span></div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;<span class="comment">// needed.</span></div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="keywordtype">bool</span> SIInsertWaitcnts::generateWaitcntBlockEnd(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> &amp;Block,</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;                                               WaitcntBrackets &amp;ScoreBrackets,</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;                                               <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *OldWaitcntInstr) {</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  AMDGPU::Waitcnt <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>;</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160; </div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;  <span class="keywordflow">if</span> (!ScoreBrackets.hasPendingEvent(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>))</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160; </div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;  <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.VmCnt = 0;</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160; </div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;  <span class="keywordflow">return</span> generateWaitcnt(<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>, <a class="code" href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>.instr_end(), Block, ScoreBrackets,</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;                         OldWaitcntInstr);</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;}</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160; </div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;<span class="keywordtype">bool</span> SIInsertWaitcnts::generateWaitcnt(AMDGPU::Waitcnt <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>,</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;                                       <a class="code" href="classllvm_1_1ilist__iterator.html">MachineBasicBlock::instr_iterator</a> It,</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;                                       <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> &amp;Block,</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;                                       WaitcntBrackets &amp;ScoreBrackets,</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;                                       <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *OldWaitcntInstr) {</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DebugLoc.html">DebugLoc</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a class="code" href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>.findDebugLoc(It);</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160; </div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;  <span class="keywordflow">if</span> (OldWaitcntInstr)</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    <span class="comment">// Try to merge the required wait with preexisting waitcnt instructions.</span></div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    <span class="comment">// Also erase redundant waitcnt.</span></div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> =</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;        applyPreexistingWaitcnt(ScoreBrackets, *OldWaitcntInstr, <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>, It);</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    ScoreBrackets.applyWaitcnt(<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>);</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160; </div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;  <span class="comment">// ExpCnt can be merged into VINTERP.</span></div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.ExpCnt != ~0u &amp;&amp; It != <a class="code" href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>.instr_end() &amp;&amp;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;      <a class="code" href="classllvm_1_1SIInstrInfo.html#a85e762ca75d1db9247a7d659fbf77d2a">SIInstrInfo::isVINTERP</a>(*It)) {</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    <a class="code" href="classllvm_1_1MachineOperand.html">MachineOperand</a> *WaitExp =</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;        <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getNamedOperand(*It, AMDGPU::OpName::waitexp);</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.ExpCnt &lt; WaitExp-&gt;<a class="code" href="classllvm_1_1MachineOperand.html#a38b28a85f818b49d8806c150b8a5b4f7">getImm</a>()) {</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;      WaitExp-&gt;<a class="code" href="classllvm_1_1MachineOperand.html#a2feaa1c69335c6b9028076cd68c7a5f5">setImm</a>(<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.ExpCnt);</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;      <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    }</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.ExpCnt = ~0u;</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160; </div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;generateWaitcntInstBefore\n&quot;</span></div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;Update Instr: &quot;</span> &lt;&lt; *It);</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;  }</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160; </div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;  <span class="comment">// Build new waitcnt instructions unless no wait is needed or the old waitcnt</span></div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;  <span class="comment">// instruction was modified to handle the required wait.</span></div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.hasWaitExceptVsCnt()) {</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;    <span class="keywordtype">unsigned</span> Enc = <a class="code" href="namespacellvm_1_1AMDGPU.html#a538a5f491696e8b8ef0987e3aaedbb37">AMDGPU::encodeWaitcnt</a>(<a class="code" href="blake3__impl_8h.html#a78823051d1dad34b9b3d8120112e674d">IV</a>, <a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>);</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    <span class="keyword">auto</span> SWaitInst =</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;        <a class="code" href="namespacellvm.html#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(Block, It, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(AMDGPU::S_WAITCNT)).<a class="code" href="classllvm_1_1MachineInstrBuilder.html#a4f1ceb770fe3446bfb2b3fa26858098f">addImm</a>(Enc);</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    TrackedWaitcntSet.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a79eed48913651aeedda2eed25201ea84">insert</a>(SWaitInst);</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160; </div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;generateWaitcnt\n&quot;</span>;</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;               <span class="keywordflow">if</span> (It != <a class="code" href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>.instr_end()) <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Old Instr: &quot;</span> &lt;&lt; *It;</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;               <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;New Instr: &quot;</span> &lt;&lt; *SWaitInst &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;  }</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160; </div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.hasWaitVsCnt()) {</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;hasVscnt());</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160; </div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    <span class="keyword">auto</span> SWaitInst = <a class="code" href="namespacellvm.html#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(Block, It, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(AMDGPU::S_WAITCNT_VSCNT))</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;                         .<a class="code" href="classllvm_1_1MachineInstrBuilder.html#ad08ed580345a51c50d9477dec1e65818">addReg</a>(AMDGPU::SGPR_NULL, <a class="code" href="namespacellvm_1_1RegState.html#aef4cc0c855dc833e2a9d58a50703320dab502f975742e9bff6d6dd7b49439b806">RegState::Undef</a>)</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;                         .<a class="code" href="classllvm_1_1MachineInstrBuilder.html#a4f1ceb770fe3446bfb2b3fa26858098f">addImm</a>(<a class="code" href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">Wait</a>.VsCnt);</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    TrackedWaitcntSet.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a79eed48913651aeedda2eed25201ea84">insert</a>(SWaitInst);</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160; </div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;generateWaitcnt\n&quot;</span>;</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;               <span class="keywordflow">if</span> (It != <a class="code" href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>.instr_end()) <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Old Instr: &quot;</span> &lt;&lt; *It;</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;               <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;New Instr: &quot;</span> &lt;&lt; *SWaitInst &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;  }</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;}</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160; </div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;<span class="comment">// This is a flat memory operation. Check to see if it has memory tokens other</span></div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;<span class="comment">// than LDS. Other address spaces supported by flat memory operations involve</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="comment">// global memory.</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;<span class="keywordtype">bool</span> SIInsertWaitcnts::mayAccessVMEMThroughFlat(<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isFLAT(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>));</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160; </div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  <span class="comment">// All flat instructions use the VMEM counter.</span></div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;usesVM_CNT(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>));</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160; </div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;  <span class="comment">// If there are no memory operands then conservatively assume the flat</span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;  <span class="comment">// operation may access VMEM.</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.memoperands_empty())</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160; </div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;  <span class="comment">// See if any memory operand specifies an address space that involves VMEM.</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  <span class="comment">// Flat operations only supported FLAT, LOCAL (LDS), or address spaces</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;  <span class="comment">// involving VMEM such as GLOBAL, CONSTANT, PRIVATE (SCRATCH), etc. The REGION</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;  <span class="comment">// (GDS) address space is not supported by flat operations. Therefore, simply</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  <span class="comment">// return true unless only the LDS address space is found.</span></div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineMemOperand.html">MachineMemOperand</a> *Memop : <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.memoperands()) {</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    <span class="keywordtype">unsigned</span> AS = Memop-&gt;getAddrSpace();</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(AS != <a class="code" href="namespacellvm_1_1AMDGPUAS.html#ab1843c6566c95d94d6e36a857b8d2b3fa5b71ba6fa435ec288aba849e113721a7">AMDGPUAS::REGION_ADDRESS</a>);</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    <span class="keywordflow">if</span> (AS != <a class="code" href="namespacellvm_1_1AMDGPUAS.html#ab1843c6566c95d94d6e36a857b8d2b3fa77b1c964e2ff99057bf5e75140457abe">AMDGPUAS::LOCAL_ADDRESS</a>)</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;  }</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160; </div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;}</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160; </div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;<span class="comment">// This is a flat memory operation. Check to see if it has memory tokens for</span></div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="comment">// either LDS or FLAT.</span></div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="keywordtype">bool</span> SIInsertWaitcnts::mayAccessLDSThroughFlat(<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isFLAT(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>));</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160; </div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;  <span class="comment">// Flat instruction such as SCRATCH and GLOBAL do not use the lgkm counter.</span></div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;usesLGKM_CNT(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>))</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160; </div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;  <span class="comment">// If in tgsplit mode then there can be no use of LDS.</span></div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;isTgSplitEnabled())</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160; </div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;  <span class="comment">// If there are no memory operands then conservatively assume the flat</span></div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;  <span class="comment">// operation may access LDS.</span></div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.memoperands_empty())</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160; </div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;  <span class="comment">// See if any memory operand specifies an address space that involves LDS.</span></div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineMemOperand.html">MachineMemOperand</a> *Memop : <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.memoperands()) {</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    <span class="keywordtype">unsigned</span> AS = Memop-&gt;getAddrSpace();</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    <span class="keywordflow">if</span> (AS == <a class="code" href="namespacellvm_1_1AMDGPUAS.html#ab1843c6566c95d94d6e36a857b8d2b3fa77b1c964e2ff99057bf5e75140457abe">AMDGPUAS::LOCAL_ADDRESS</a> || AS == <a class="code" href="namespacellvm_1_1AMDGPUAS.html#ab1843c6566c95d94d6e36a857b8d2b3faaa1e27e4fc68e5706a4b7bbaed447c14">AMDGPUAS::FLAT_ADDRESS</a>)</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;  }</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160; </div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;}</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160; </div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="keywordtype">void</span> SIInsertWaitcnts::updateEventWaitcntAfter(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;Inst,</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;                                               WaitcntBrackets *ScoreBrackets) {</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;  <span class="comment">// Now look at the instruction opcode. If it is a memory access</span></div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;  <span class="comment">// instruction, update the upper-bound of the appropriate counter&#39;s</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;  <span class="comment">// bracket and the destination operand scores.</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;  <span class="comment">// TODO: Use the (TSFlags &amp; SIInstrFlags::LGKM_CNT) property everywhere.</span></div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isDS(Inst) &amp;&amp; <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;usesLGKM_CNT(Inst)) {</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isAlwaysGDS(Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>()) ||</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;        <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;hasModifiersSet(Inst, AMDGPU::OpName::gds)) {</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;      ScoreBrackets-&gt;updateByEvent(<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, GDS_ACCESS, Inst);</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;      ScoreBrackets-&gt;updateByEvent(<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, GDS_GPR_LOCK, Inst);</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;      ScoreBrackets-&gt;updateByEvent(<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, LDS_ACCESS, Inst);</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    }</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isFLAT(Inst)) {</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a17f5d15a7320dec2cfefb6617f711ab7">mayLoadOrStore</a>());</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160; </div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    <span class="keywordtype">int</span> FlatASCount = 0;</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160; </div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    <span class="keywordflow">if</span> (mayAccessVMEMThroughFlat(Inst)) {</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;      ++FlatASCount;</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;      ScoreBrackets-&gt;updateByEvent(<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, getVmemWaitEventType(Inst),</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;                                   Inst);</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    }</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160; </div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    <span class="keywordflow">if</span> (mayAccessLDSThroughFlat(Inst)) {</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;      ++FlatASCount;</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;      ScoreBrackets-&gt;updateByEvent(<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, LDS_ACCESS, Inst);</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    }</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160; </div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    <span class="comment">// A Flat memory operation must access at least one address space.</span></div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FlatASCount);</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160; </div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    <span class="comment">// This is a flat memory operation that access both VMEM and LDS, so note it</span></div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <span class="comment">// - it will require that both the VM and LGKM be flushed to zero if it is</span></div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    <span class="comment">// pending when a VM or LGKM dependency occurs.</span></div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    <span class="keywordflow">if</span> (FlatASCount &gt; 1)</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;      ScoreBrackets-&gt;setPendingFlat();</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SIInstrInfo.html#a08b830059090a1bb27b14e1e524fdb46">SIInstrInfo::isVMEM</a>(Inst) &amp;&amp;</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;             !<a class="code" href="namespacellvm_1_1AMDGPU.html#ad6c6b1894340016cee9e4b730ade8af6">llvm::AMDGPU::getMUBUFIsBufferInv</a>(Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>())) {</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;    ScoreBrackets-&gt;updateByEvent(<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, getVmemWaitEventType(Inst),</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;                                 Inst);</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160; </div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;vmemWriteNeedsExpWaitcnt() &amp;&amp;</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;        (Inst.<a class="code" href="classllvm_1_1MachineInstr.html#ab96f3235c18e659758517d0532d606c9">mayStore</a>() || <a class="code" href="classllvm_1_1SIInstrInfo.html#a6c4c2a9d09070e2709f9725a915575e4">SIInstrInfo::isAtomicRet</a>(Inst))) {</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;      ScoreBrackets-&gt;updateByEvent(<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, VMW_GPR_LOCK, Inst);</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    }</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isSMRD(Inst)) {</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    ScoreBrackets-&gt;updateByEvent(<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, SMEM_ACCESS, Inst);</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a30e7d619f3195fd890116da8b3ed6bab">isCall</a>()) {</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SIInsertWaitcnts_8cpp.html#a12875f783295ef0f67d11ae574bdcfdd">callWaitsOnFunctionReturn</a>(Inst)) {</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;      <span class="comment">// Act as a wait on everything</span></div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;      ScoreBrackets-&gt;applyWaitcnt(allZeroWaitcnt());</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;      <span class="comment">// May need to way wait for anything.</span></div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;      ScoreBrackets-&gt;applyWaitcnt(AMDGPU::Waitcnt());</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    }</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SIInstrInfo.html#a5b2aaf80981b29494436f2b18a604e1c">SIInstrInfo::isLDSDIR</a>(Inst)) {</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;    ScoreBrackets-&gt;updateByEvent(<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, EXP_LDS_ACCESS, Inst);</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isVINTERP(Inst)) {</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    int64_t <a class="code" href="namespacellvm_1_1RISCVMatInt.html#a3c9bceaea514f7c01e87dcb184d3c972a3b5b9d77cc1b7c08af3a3cdba0c6736c">Imm</a> = <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getNamedOperand(Inst, AMDGPU::OpName::waitexp)-&gt;getImm();</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    ScoreBrackets-&gt;applyWaitcnt(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">EXP_CNT</a>, <a class="code" href="namespacellvm_1_1RISCVMatInt.html#a3c9bceaea514f7c01e87dcb184d3c972a3b5b9d77cc1b7c08af3a3cdba0c6736c">Imm</a>);</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SIInstrInfo.html#a2d40ab246e329190bbf36cd93fd88e83">SIInstrInfo::isEXP</a>(Inst)) {</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1RISCVMatInt.html#a3c9bceaea514f7c01e87dcb184d3c972a3b5b9d77cc1b7c08af3a3cdba0c6736c">Imm</a> = <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getNamedOperand(Inst, AMDGPU::OpName::tgt)-&gt;getImm();</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1RISCVMatInt.html#a3c9bceaea514f7c01e87dcb184d3c972a3b5b9d77cc1b7c08af3a3cdba0c6736c">Imm</a> &gt;= <a class="code" href="namespacellvm_1_1AMDGPU_1_1Exp.html#af7592dc94276d1958420bcfb414b6998afe9e14fadada855231c900eecbea27f2">AMDGPU::Exp::ET_PARAM0</a> &amp;&amp; <a class="code" href="namespacellvm_1_1RISCVMatInt.html#a3c9bceaea514f7c01e87dcb184d3c972a3b5b9d77cc1b7c08af3a3cdba0c6736c">Imm</a> &lt;= <a class="code" href="namespacellvm_1_1AMDGPU_1_1Exp.html#af7592dc94276d1958420bcfb414b6998a6a774a598f798bc6a057d9a88a1427c0">AMDGPU::Exp::ET_PARAM31</a>)</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;      ScoreBrackets-&gt;updateByEvent(<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, EXP_PARAM_ACCESS, Inst);</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1RISCVMatInt.html#a3c9bceaea514f7c01e87dcb184d3c972a3b5b9d77cc1b7c08af3a3cdba0c6736c">Imm</a> &gt;= <a class="code" href="namespacellvm_1_1AMDGPU_1_1Exp.html#af7592dc94276d1958420bcfb414b6998a819e373068289857bb1cef7f5b320c11">AMDGPU::Exp::ET_POS0</a> &amp;&amp; <a class="code" href="namespacellvm_1_1RISCVMatInt.html#a3c9bceaea514f7c01e87dcb184d3c972a3b5b9d77cc1b7c08af3a3cdba0c6736c">Imm</a> &lt;= <a class="code" href="namespacellvm_1_1AMDGPU_1_1Exp.html#af7592dc94276d1958420bcfb414b6998ac84234e8abdfe7d1a85fef7297734e49">AMDGPU::Exp::ET_POS_LAST</a>)</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;      ScoreBrackets-&gt;updateByEvent(<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, EXP_POS_ACCESS, Inst);</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;      ScoreBrackets-&gt;updateByEvent(<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, EXP_GPR_LOCK, Inst);</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    <span class="keywordflow">switch</span> (Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>()) {</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    <span class="keywordflow">case</span> AMDGPU::S_SENDMSG:</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;    <span class="keywordflow">case</span> AMDGPU::S_SENDMSG_RTN_B32:</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    <span class="keywordflow">case</span> AMDGPU::S_SENDMSG_RTN_B64:</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    <span class="keywordflow">case</span> AMDGPU::S_SENDMSGHALT:</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;      ScoreBrackets-&gt;updateByEvent(<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, SQ_MESSAGE, Inst);</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    <span class="keywordflow">case</span> AMDGPU::S_MEMTIME:</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;    <span class="keywordflow">case</span> AMDGPU::S_MEMREALTIME:</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;      ScoreBrackets-&gt;updateByEvent(<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, SMEM_ACCESS, Inst);</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    }</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;  }</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;}</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160; </div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;<span class="keywordtype">bool</span> WaitcntBrackets::mergeScore(<span class="keyword">const</span> MergeInfo &amp;M, <span class="keywordtype">unsigned</span> &amp;Score,</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;                                 <span class="keywordtype">unsigned</span> OtherScore) {</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;  <span class="keywordtype">unsigned</span> MyShifted = Score &lt;= <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.OldLB ? 0 : Score + <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.MyShift;</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;  <span class="keywordtype">unsigned</span> OtherShifted =</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;      OtherScore &lt;= <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.OtherLB ? 0 : OtherScore + <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.OtherShift;</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;  Score = <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(MyShifted, OtherShifted);</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;  <span class="keywordflow">return</span> OtherShifted &gt; MyShifted;</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;}</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;<span class="comment">/// Merge the pending events and associater score brackets of \p Other into</span></div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;<span class="comment">/// this brackets status.</span></div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;<span class="comment">/// Returns whether the merge resulted in a change that requires tighter waits</span></div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;<span class="comment">/// (i.e. the merged brackets strictly dominate the original brackets).</span></div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> <a class="code" href="LoopDeletion_8cpp.html#a66a2592ace8a67bc796c72710d632bab">WaitcntBrackets::merge</a>(<span class="keyword">const</span> WaitcntBrackets &amp;Other) {</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;  <span class="keywordtype">bool</span> StrictDom = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160; </div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;  VgprUB = <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(VgprUB, <a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.VgprUB);</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;  SgprUB = <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(SgprUB, <a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.SgprUB);</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160; </div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="classT.html">T</a> : inst_counter_types()) {</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;    <span class="comment">// Merge event flags for this counter</span></div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> OldEvents = PendingEvents &amp; WaitEventMaskForInst[<a class="code" href="classT.html">T</a>];</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> OtherEvents = <a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.PendingEvents &amp; WaitEventMaskForInst[<a class="code" href="classT.html">T</a>];</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    <span class="keywordflow">if</span> (OtherEvents &amp; ~OldEvents)</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;      StrictDom = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    PendingEvents |= OtherEvents;</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160; </div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    <span class="comment">// Merge scores for this counter</span></div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> MyPending = ScoreUBs[<a class="code" href="classT.html">T</a>] - ScoreLBs[<a class="code" href="classT.html">T</a>];</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> OtherPending = <a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.ScoreUBs[<a class="code" href="classT.html">T</a>] - <a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.ScoreLBs[<a class="code" href="classT.html">T</a>];</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> NewUB = ScoreLBs[<a class="code" href="classT.html">T</a>] + <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(MyPending, OtherPending);</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;    <span class="keywordflow">if</span> (NewUB &lt; ScoreLBs[<a class="code" href="classT.html">T</a>])</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;      <a class="code" href="namespacellvm.html#a7f2a3d4dcfee70225988aec53ff1e173">report_fatal_error</a>(<span class="stringliteral">&quot;waitcnt score overflow&quot;</span>);</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160; </div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    MergeInfo <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>;</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.OldLB = ScoreLBs[<a class="code" href="classT.html">T</a>];</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.OtherLB = <a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.ScoreLBs[<a class="code" href="classT.html">T</a>];</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.MyShift = NewUB - ScoreUBs[<a class="code" href="classT.html">T</a>];</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.OtherShift = NewUB - <a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.ScoreUBs[<a class="code" href="classT.html">T</a>];</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160; </div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    ScoreUBs[<a class="code" href="classT.html">T</a>] = NewUB;</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160; </div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;    StrictDom |= mergeScore(M, LastFlat[<a class="code" href="classT.html">T</a>], <a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.LastFlat[<a class="code" href="classT.html">T</a>]);</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160; </div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> J = 0; J &lt;= VgprUB; J++)</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;      StrictDom |= mergeScore(M, VgprScores[<a class="code" href="classT.html">T</a>][J], <a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.VgprScores[<a class="code" href="classT.html">T</a>][J]);</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160; </div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classT.html">T</a> == <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">LGKM_CNT</a>) {</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> J = 0; J &lt;= SgprUB; J++)</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;        StrictDom |= mergeScore(M, SgprScores[J], <a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.SgprScores[J]);</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;    }</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;  }</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160; </div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> J = 0; J &lt;= VgprUB; J++) {</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> NewVmemTypes = VgprVmemTypes[J] | <a class="code" href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a>.VgprVmemTypes[J];</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    StrictDom |= NewVmemTypes != VgprVmemTypes[J];</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    VgprVmemTypes[J] = NewVmemTypes;</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;  }</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160; </div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;  <span class="keywordflow">return</span> StrictDom;</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;}</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160; </div>
<div class="line"><a name="l01536"></a><span class="lineno"><a class="line" href="SIInsertWaitcnts_8cpp.html#a80ca145710cb63f6d1484dacf37a8620"> 1536</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SIInsertWaitcnts_8cpp.html#a80ca145710cb63f6d1484dacf37a8620">isWaitInstr</a>(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;Inst) {</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;  <span class="keywordflow">return</span> Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>() == AMDGPU::S_WAITCNT ||</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;         (Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">getOpcode</a>() == AMDGPU::S_WAITCNT_VSCNT &amp;&amp;</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;          Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a3f7a45f6e10668a5f702e26bca80d18e">getOperand</a>(0).<a class="code" href="classllvm_1_1MachineOperand.html#a4c9594c955fec80c73ddd964b5efd554">isReg</a>() &amp;&amp;</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;          Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a3f7a45f6e10668a5f702e26bca80d18e">getOperand</a>(0).<a class="code" href="classllvm_1_1MachineOperand.html#ac0035d7c1c860501c877c20e6e93297b">getReg</a>() == AMDGPU::SGPR_NULL);</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;}</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160; </div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;<span class="comment">// Generate s_waitcnt instructions where needed.</span></div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;<span class="keywordtype">bool</span> SIInsertWaitcnts::insertWaitcntInBlock(<a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> &amp;MF,</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;                                            <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> &amp;Block,</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;                                            WaitcntBrackets &amp;ScoreBrackets) {</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160; </div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>({</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;*** Block&quot;</span> &lt;&lt; <a class="code" href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>.getNumber() &lt;&lt; <span class="stringliteral">&quot; ***&quot;</span>;</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    ScoreBrackets.dump();</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;  });</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160; </div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;  <span class="comment">// Track the correctness of vccz through this basic block. There are two</span></div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;  <span class="comment">// reasons why it might be incorrect; see ST-&gt;hasReadVCCZBug() and</span></div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;  <span class="comment">// ST-&gt;partialVCCWritesUpdateVCCZ().</span></div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;  <span class="keywordtype">bool</span> VCCZCorrect = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;hasReadVCCZBug()) {</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;    <span class="comment">// vccz could be incorrect at a basic block boundary if a predecessor wrote</span></div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;    <span class="comment">// to vcc and then issued an smem load.</span></div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;    VCCZCorrect = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;partialVCCWritesUpdateVCCZ()) {</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    <span class="comment">// vccz could be incorrect at a basic block boundary if a predecessor wrote</span></div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;    <span class="comment">// to vcc_lo or vcc_hi.</span></div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    VCCZCorrect = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;  }</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160; </div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;  <span class="comment">// Walk over the instructions.</span></div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *OldWaitcntInstr = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160; </div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">MachineBasicBlock::instr_iterator</a> Iter = <a class="code" href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>.instr_begin(),</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;                                         <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = <a class="code" href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>.instr_end();</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;       Iter != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>;) {</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;Inst = *Iter;</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160; </div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;    <span class="comment">// Track pre-existing waitcnts that were added in earlier iterations or by</span></div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    <span class="comment">// the memory legalizer.</span></div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SIInsertWaitcnts_8cpp.html#a80ca145710cb63f6d1484dacf37a8620">isWaitInstr</a>(Inst)) {</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;      <span class="keywordflow">if</span> (!OldWaitcntInstr)</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;        OldWaitcntInstr = &amp;Inst;</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;      ++Iter;</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;    }</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160; </div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;    <span class="keywordtype">bool</span> FlushVmCnt = <a class="code" href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>.getFirstTerminator() == Inst &amp;&amp;</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;                      isPreheaderToFlush(Block, ScoreBrackets);</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160; </div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    <span class="comment">// Generate an s_waitcnt instruction to be placed before Inst, if needed.</span></div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;    <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> |= generateWaitcntInstBefore(Inst, ScoreBrackets, OldWaitcntInstr,</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;                                          FlushVmCnt);</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;    OldWaitcntInstr = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160; </div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;    <span class="comment">// Restore vccz if it&#39;s not known to be correct already.</span></div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;    <span class="keywordtype">bool</span> RestoreVCCZ = !VCCZCorrect &amp;&amp; <a class="code" href="SIInsertWaitcnts_8cpp.html#a94ceb20d45e28266a8e3c88177cd5433">readsVCCZ</a>(Inst);</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160; </div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;    <span class="comment">// Don&#39;t examine operands unless we need to track vccz correctness.</span></div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;hasReadVCCZBug() || !<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;partialVCCWritesUpdateVCCZ()) {</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;      <span class="keywordflow">if</span> (Inst.<a class="code" href="classllvm_1_1MachineInstr.html#aabed741772b1be65069d9274446a914d">definesRegister</a>(AMDGPU::VCC_LO) ||</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;          Inst.<a class="code" href="classllvm_1_1MachineInstr.html#aabed741772b1be65069d9274446a914d">definesRegister</a>(AMDGPU::VCC_HI)) {</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;        <span class="comment">// Up to gfx9, writes to vcc_lo and vcc_hi don&#39;t update vccz.</span></div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;partialVCCWritesUpdateVCCZ())</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;          VCCZCorrect = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Inst.<a class="code" href="classllvm_1_1MachineInstr.html#aabed741772b1be65069d9274446a914d">definesRegister</a>(AMDGPU::VCC)) {</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;        <span class="comment">// There is a hardware bug on CI/SI where SMRD instruction may corrupt</span></div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;        <span class="comment">// vccz bit, so when we detect that an instruction may read from a</span></div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;        <span class="comment">// corrupt vccz bit, we need to:</span></div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;        <span class="comment">// 1. Insert s_waitcnt lgkm(0) to wait for all outstanding SMRD</span></div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;        <span class="comment">//    operations to complete.</span></div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;        <span class="comment">// 2. Restore the correct value of vccz by writing the current value</span></div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;        <span class="comment">//    of vcc back to vcc.</span></div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;hasReadVCCZBug() &amp;&amp;</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;            ScoreBrackets.hasPendingEvent(SMEM_ACCESS)) {</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;          <span class="comment">// Writes to vcc while there&#39;s an outstanding smem read may get</span></div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;          <span class="comment">// clobbered as soon as any read completes.</span></div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;          VCCZCorrect = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;          <span class="comment">// Writes to vcc will fix any incorrect value in vccz.</span></div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;          VCCZCorrect = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;        }</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;      }</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;    }</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160; </div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isSMRD(Inst)) {</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineMemOperand.html">MachineMemOperand</a> *Memop : Inst.<a class="code" href="classllvm_1_1MachineInstr.html#ae268a410689383a83e98b5e83296e38a">memoperands</a>()) {</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;        <span class="comment">// No need to handle invariant loads when avoiding WAR conflicts, as</span></div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;        <span class="comment">// there cannot be a vector store to the same memory location.</span></div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;        <span class="keywordflow">if</span> (!Memop-&gt;isInvariant()) {</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;          <span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = Memop-&gt;getValue();</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;          SLoadAddresses.<a class="code" href="classllvm_1_1DenseMapBase.html#a99f811d53704275b4158c62a2dd138d9">insert</a>(std::pair(<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, Inst.<a class="code" href="classllvm_1_1MachineInstr.html#a002fd916e7206e01d512eeb06d405cf0">getParent</a>()));</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;        }</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;      }</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;hasReadVCCZBug()) {</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;        <span class="comment">// This smem read could complete and clobber vccz at any time.</span></div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;        VCCZCorrect = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;      }</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    }</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160; </div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    updateEventWaitcntAfter(Inst, &amp;ScoreBrackets);</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160; </div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;<span class="preprocessor">#if 0 // TODO: implement resource type check controlled by options with ub = LB.</span></div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;    <span class="comment">// If this instruction generates a S_SETVSKIP because it is an</span></div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;    <span class="comment">// indexed resource, and we are on Tahiti, then it will also force</span></div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    <span class="comment">// an S_WAITCNT vmcnt(0)</span></div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    <span class="keywordflow">if</span> (RequireCheckResourceType(Inst, context)) {</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;      <span class="comment">// Force the score to as if an S_WAITCNT vmcnt(0) is emitted.</span></div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;      ScoreBrackets-&gt;setScoreLB(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>,</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;      ScoreBrackets-&gt;getScoreUB(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>));</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;    }</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160; </div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>({</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;      Inst.<a class="code" href="classllvm_1_1MachineInstr.html#ab419785650ef9728b5305d220179017c">print</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>());</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;      ScoreBrackets.dump();</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    });</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160; </div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    <span class="comment">// TODO: Remove this work-around after fixing the scheduler and enable the</span></div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    <span class="comment">// assert above.</span></div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;    <span class="keywordflow">if</span> (RestoreVCCZ) {</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;      <span class="comment">// Restore the vccz bit.  Any time a value is written to vcc, the vcc</span></div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;      <span class="comment">// bit is updated, so we can restore the bit by reading the value of</span></div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;      <span class="comment">// vcc and then writing it back to the register.</span></div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;      <a class="code" href="namespacellvm.html#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(Block, Inst, Inst.<a class="code" href="classllvm_1_1MachineInstr.html#ae8ff2acea4fe63e48e8fc6cf0620ff78">getDebugLoc</a>(),</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;              <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;isWave32() ? AMDGPU::S_MOV_B32 : AMDGPU::S_MOV_B64),</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;              <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;getVCC())</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;          .<a class="code" href="classllvm_1_1MachineInstrBuilder.html#ad08ed580345a51c50d9477dec1e65818">addReg</a>(<a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;getVCC());</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;      VCCZCorrect = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;      <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;    }</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160; </div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;    ++Iter;</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;  }</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160; </div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>.getFirstTerminator() == <a class="code" href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>.end() &amp;&amp;</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;      isPreheaderToFlush(Block, ScoreBrackets))</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;    <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> |= generateWaitcntBlockEnd(Block, ScoreBrackets, OldWaitcntInstr);</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160; </div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;}</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160; </div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;<span class="comment">// Return true if the given machine basic block is a preheader of a loop in</span></div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;<span class="comment">// which we want to flush the vmcnt counter, and false otherwise.</span></div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;<span class="keywordtype">bool</span> SIInsertWaitcnts::isPreheaderToFlush(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>,</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;                                          WaitcntBrackets &amp;ScoreBrackets) {</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;  <span class="keywordflow">if</span> (PreheadersToFlush.<a class="code" href="classllvm_1_1DenseMapBase.html#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(&amp;<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>))</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;    <span class="keywordflow">return</span> PreheadersToFlush[&amp;<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>];</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160; </div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;  <span class="keyword">auto</span> UpdateCache = [&amp;](<span class="keywordtype">bool</span> <a class="code" href="lib_2Target_2SystemZ_2README_8txt.html#accaf4e23f4ffc792355e64dcb9af2c96">val</a>) {</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;    PreheadersToFlush[&amp;<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>] = <a class="code" href="lib_2Target_2SystemZ_2README_8txt.html#accaf4e23f4ffc792355e64dcb9af2c96">val</a>;</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="lib_2Target_2SystemZ_2README_8txt.html#accaf4e23f4ffc792355e64dcb9af2c96">val</a>;</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;  };</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160; </div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *Succ = <a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>.<a class="code" href="classllvm_1_1MachineBasicBlock.html#aa0a5ac19256656534bea2daabdfb947b">getSingleSuccessor</a>();</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;  <span class="keywordflow">if</span> (!Succ)</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;    <span class="keywordflow">return</span> UpdateCache(<span class="keyword">false</span>);</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160; </div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;  <a class="code" href="classllvm_1_1MachineLoop.html">MachineLoop</a> *<a class="code" href="classllvm_1_1Loop.html">Loop</a> = MLI-&gt;<a class="code" href="classllvm_1_1MachineLoopInfo.html#aa62155b3e041c8a6c1742e1552c99649">getLoopFor</a>(Succ);</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classllvm_1_1Loop.html">Loop</a>)</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;    <span class="keywordflow">return</span> UpdateCache(<span class="keyword">false</span>);</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160; </div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Loop.html">Loop</a>-&gt;<a class="code" href="classllvm_1_1LoopBase.html#ac3280e7f76f955403fe17eacf126b90d">getLoopPreheader</a>() == &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a> &amp;&amp; shouldFlushVmCnt(<a class="code" href="classllvm_1_1Loop.html">Loop</a>, ScoreBrackets))</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    <span class="keywordflow">return</span> UpdateCache(<span class="keyword">true</span>);</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160; </div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;  <span class="keywordflow">return</span> UpdateCache(<span class="keyword">false</span>);</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;}</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160; </div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;<span class="comment">// Return true if it is better to flush the vmcnt counter in the preheader of</span></div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;<span class="comment">// the given loop. We currently decide to flush in two situations:</span></div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;<span class="comment">// 1. The loop contains vmem store(s), no vmem load and at least one use of a</span></div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;<span class="comment">//    vgpr containing a value that is loaded outside of the loop. (Only on</span></div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;<span class="comment">//    targets with no vscnt counter).</span></div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;<span class="comment">// 2. The loop contains vmem load(s), but the loaded values are not used in the</span></div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;<span class="comment">//    loop, and at least one use of a vgpr containing a value that is loaded</span></div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;<span class="comment">//    outside of the loop.</span></div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;<span class="keywordtype">bool</span> SIInsertWaitcnts::shouldFlushVmCnt(<a class="code" href="classllvm_1_1MachineLoop.html">MachineLoop</a> *ML,</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;                                        WaitcntBrackets &amp;Brackets) {</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;  <span class="keywordtype">bool</span> HasVMemLoad = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;  <span class="keywordtype">bool</span> HasVMemStore = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;  <span class="keywordtype">bool</span> UsesVgprLoadedOutside = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;  <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;Register&gt;</a> VgprUse;</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;  <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;Register&gt;</a> VgprDef;</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160; </div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a> : <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3ad01fd9b01e9dde8bd3dc247afbfb7218">ML</a>-&gt;blocks()) {</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : *<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>) {</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SIInstrInfo.html#a08b830059090a1bb27b14e1e524fdb46">SIInstrInfo::isVMEM</a>(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>)) {</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.mayLoad())</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;          HasVMemLoad = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.mayStore())</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;          HasVMemStore = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;      }</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getNumOperands(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) {</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;        <a class="code" href="classllvm_1_1MachineOperand.html">MachineOperand</a> &amp;<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOperand(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.isReg() || !<a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;isVectorRegister(*<a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.getReg()))</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;        RegInterval <a class="code" href="classllvm_1_1Interval.html">Interval</a> = Brackets.getRegInterval(&amp;<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>, <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;        <span class="comment">// Vgpr use</span></div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.isUse()) {</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> RegNo = <a class="code" href="classllvm_1_1Interval.html">Interval</a>.first; RegNo &lt; <a class="code" href="classllvm_1_1Interval.html">Interval</a>.second; ++RegNo) {</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;            <span class="comment">// If we find a register that is loaded inside the loop, 1. and 2.</span></div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;            <span class="comment">// are invalidated and we can exit.</span></div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;            <span class="keywordflow">if</span> (VgprDef.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(RegNo))</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;              <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;            VgprUse.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a79eed48913651aeedda2eed25201ea84">insert</a>(RegNo);</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;            <span class="comment">// If at least one of Op&#39;s registers is in the score brackets, the</span></div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;            <span class="comment">// value is likely loaded outside of the loop.</span></div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;            <span class="keywordflow">if</span> (Brackets.getRegScore(RegNo, <a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>) &gt; Brackets.getScoreLB(<a class="code" href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">VM_CNT</a>)) {</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;              UsesVgprLoadedOutside = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;              <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;            }</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;          }</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;        }</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;        <span class="comment">// VMem load vgpr def</span></div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SIInstrInfo.html#a08b830059090a1bb27b14e1e524fdb46">SIInstrInfo::isVMEM</a>(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) &amp;&amp; <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.mayLoad() &amp;&amp; <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.isDef())</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> RegNo = <a class="code" href="classllvm_1_1Interval.html">Interval</a>.first; RegNo &lt; <a class="code" href="classllvm_1_1Interval.html">Interval</a>.second; ++RegNo) {</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;            <span class="comment">// If we find a register that is loaded inside the loop, 1. and 2.</span></div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;            <span class="comment">// are invalidated and we can exit.</span></div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;            <span class="keywordflow">if</span> (VgprUse.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(RegNo))</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;              <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;            VgprDef.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a79eed48913651aeedda2eed25201ea84">insert</a>(RegNo);</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;          }</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;      }</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;    }</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;  }</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;hasVscnt() &amp;&amp; HasVMemStore &amp;&amp; !HasVMemLoad &amp;&amp; UsesVgprLoadedOutside)</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;  <span class="keywordflow">return</span> HasVMemLoad &amp;&amp; UsesVgprLoadedOutside;</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;}</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160; </div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;<span class="keywordtype">bool</span> SIInsertWaitcnts::runOnMachineFunction(<a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> &amp;MF) {</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;  <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a> = &amp;MF.<a class="code" href="classllvm_1_1MachineFunction.html#a325f6b611ef9ec06798d3b4eb9572093">getSubtarget</a>&lt;<a class="code" href="classllvm_1_1GCNSubtarget.html">GCNSubtarget</a>&gt;();</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;  <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a> = <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;getInstrInfo();</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;  <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a> = &amp;<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getRegisterInfo();</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;  <a class="code" href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a> = &amp;MF.<a class="code" href="classllvm_1_1MachineFunction.html#ab4a6ca428289b667dd691a00e9f7e334">getRegInfo</a>();</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;  <a class="code" href="blake3__impl_8h.html#a78823051d1dad34b9b3d8120112e674d">IV</a> = <a class="code" href="namespacellvm_1_1AMDGPU.html#a4c450943f424116a9b6b9a3db451af6c">AMDGPU::getIsaVersion</a>(<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;getCPU());</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SIMachineFunctionInfo.html">SIMachineFunctionInfo</a> *MFI = MF.<a class="code" href="classllvm_1_1MachineFunction.html#ac2dc0fa143c9f2127f0501734577a0a0">getInfo</a>&lt;<a class="code" href="classllvm_1_1SIMachineFunctionInfo.html">SIMachineFunctionInfo</a>&gt;();</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;  MLI = &amp;getAnalysis&lt;MachineLoopInfo&gt;();</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;  PDT = &amp;getAnalysis&lt;MachinePostDominatorTree&gt;();</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160; </div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;  ForceEmitZeroWaitcnts = <a class="code" href="SIInsertWaitcnts_8cpp.html#a6b9b0a85e71198a4aca6ffd4427fc38e">ForceEmitZeroFlag</a>;</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="classT.html">T</a> : inst_counter_types())</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;    ForceEmitWaitcnt[<a class="code" href="classT.html">T</a>] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160; </div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;  HardwareLimits Limits = {};</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;  Limits.VmcntMax = <a class="code" href="namespacellvm_1_1AMDGPU.html#a84f97b2884502eab6b0196da9e29e178">AMDGPU::getVmcntBitMask</a>(<a class="code" href="blake3__impl_8h.html#a78823051d1dad34b9b3d8120112e674d">IV</a>);</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;  Limits.ExpcntMax = <a class="code" href="namespacellvm_1_1AMDGPU.html#aa214c98bde27112b9cec6bc4e1dba715">AMDGPU::getExpcntBitMask</a>(<a class="code" href="blake3__impl_8h.html#a78823051d1dad34b9b3d8120112e674d">IV</a>);</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;  Limits.LgkmcntMax = <a class="code" href="namespacellvm_1_1AMDGPU.html#a906595c44094cbae6a0cca1b1a8b1304">AMDGPU::getLgkmcntBitMask</a>(<a class="code" href="blake3__impl_8h.html#a78823051d1dad34b9b3d8120112e674d">IV</a>);</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;  Limits.VscntMax = <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;hasVscnt() ? 63 : 0;</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160; </div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;  <span class="keywordtype">unsigned</span> NumVGPRsMax = <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;getAddressableNumVGPRs();</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;  <span class="keywordtype">unsigned</span> NumSGPRsMax = <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;getAddressableNumSGPRs();</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NumVGPRsMax &lt;= SQ_MAX_PGM_VGPRS);</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NumSGPRsMax &lt;= SQ_MAX_PGM_SGPRS);</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160; </div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;  RegisterEncoding Encoding = {};</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;  Encoding.VGPR0 = <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;<a class="code" href="classllvm_1_1MCRegisterInfo.html#a8ce9439c5f364d8b85930e0ee689bbb8">getEncodingValue</a>(AMDGPU::VGPR0);</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;  Encoding.VGPRL = Encoding.VGPR0 + NumVGPRsMax - 1;</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;  Encoding.SGPR0 = <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;<a class="code" href="classllvm_1_1MCRegisterInfo.html#a8ce9439c5f364d8b85930e0ee689bbb8">getEncodingValue</a>(AMDGPU::SGPR0);</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;  Encoding.SGPRL = Encoding.SGPR0 + NumSGPRsMax - 1;</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160; </div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;  TrackedWaitcntSet.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a1fbf4d66a9eeaa9ade03e8febee097ee">clear</a>();</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;  BlockInfos.<a class="code" href="classllvm_1_1MapVector.html#ae091b147039557cf8ce505740e7ff7ac">clear</a>();</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160; </div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;  <span class="keywordflow">if</span> (!MFI-&gt;<a class="code" href="classllvm_1_1AMDGPUMachineFunction.html#ab37f1839fd82f8b84b7a2ca87b289c46">isEntryFunction</a>()) {</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    <span class="comment">// Wait for any outstanding memory operations that the input registers may</span></div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;    <span class="comment">// depend on. We can&#39;t track them and it&#39;s better to do the wait after the</span></div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;    <span class="comment">// costly call sequence.</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160; </div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;    <span class="comment">// TODO: Could insert earlier and schedule more liberally with operations</span></div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;    <span class="comment">// that only use caller preserved registers.</span></div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> &amp;EntryBB = MF.<a class="code" href="classllvm_1_1MachineFunction.html#ab1063ce5e180c89490fae50511a46a29">front</a>();</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    <a class="code" href="classllvm_1_1MachineInstrBundleIterator.html">MachineBasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = EntryBB.<a class="code" href="classllvm_1_1MachineBasicBlock.html#ab2d91e7bec944efcbc39d8e30644f111">begin</a>();</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineInstrBundleIterator.html">MachineBasicBlock::iterator</a> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = EntryBB.<a class="code" href="classllvm_1_1MachineBasicBlock.html#acbc921830578e2741be6549db716c0ce">end</a>();</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;         <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> &amp;&amp; (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isPHI() || <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isMetaInstruction()); ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;      ;</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;    <a class="code" href="namespacellvm.html#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(EntryBB, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="classllvm_1_1DebugLoc.html">DebugLoc</a>(), <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(AMDGPU::S_WAITCNT)).<a class="code" href="classllvm_1_1MachineInstrBuilder.html#a4f1ceb770fe3446bfb2b3fa26858098f">addImm</a>(0);</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;hasVscnt())</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;      <a class="code" href="namespacellvm.html#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(EntryBB, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="classllvm_1_1DebugLoc.html">DebugLoc</a>(), <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(AMDGPU::S_WAITCNT_VSCNT))</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;          .<a class="code" href="classllvm_1_1MachineInstrBuilder.html#ad08ed580345a51c50d9477dec1e65818">addReg</a>(AMDGPU::SGPR_NULL, <a class="code" href="namespacellvm_1_1RegState.html#aef4cc0c855dc833e2a9d58a50703320dab502f975742e9bff6d6dd7b49439b806">RegState::Undef</a>)</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;          .<a class="code" href="classllvm_1_1MachineInstrBuilder.html#a4f1ceb770fe3446bfb2b3fa26858098f">addImm</a>(0);</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160; </div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;    <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;  }</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160; </div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;  <span class="comment">// Keep iterating over the blocks in reverse post order, inserting and</span></div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;  <span class="comment">// updating s_waitcnt where needed, until a fix point is reached.</span></div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a> : <a class="code" href="classllvm_1_1ReversePostOrderTraversal.html">ReversePostOrderTraversal&lt;MachineFunction *&gt;</a>(&amp;MF))</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;    BlockInfos.<a class="code" href="classllvm_1_1MapVector.html#a9318649185cfc66ba4b4eb66d5968e00">insert</a>({<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>, BlockInfo(<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>)});</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160; </div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;  std::unique_ptr&lt;WaitcntBrackets&gt; Brackets;</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;  <span class="keywordtype">bool</span> Repeat;</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;  <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;    Repeat = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160; </div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> BII = BlockInfos.<a class="code" href="classllvm_1_1MapVector.html#aa610cab7ee61e36a6d1d122fc252c278">begin</a>(), BIE = BlockInfos.<a class="code" href="classllvm_1_1MapVector.html#a0881334358ff6ff7ff8cea5562c7988e">end</a>(); BII != BIE;</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;         ++BII) {</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;      BlockInfo &amp;BI = BII-&gt;second;</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;      <span class="keywordflow">if</span> (!BI.Dirty)</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160; </div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;      <span class="keywordflow">if</span> (BI.Incoming) {</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;        <span class="keywordflow">if</span> (!Brackets)</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;          Brackets = std::make_unique&lt;WaitcntBrackets&gt;(*BI.Incoming);</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;          *Brackets = *BI.Incoming;</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;        <span class="keywordflow">if</span> (!Brackets)</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;          Brackets = std::make_unique&lt;WaitcntBrackets&gt;(<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>, Limits, Encoding);</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;          *Brackets = WaitcntBrackets(<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>, Limits, Encoding);</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;      }</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160; </div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;      <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> |= insertWaitcntInBlock(MF, *BI.MBB, *Brackets);</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;      BI.Dirty = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160; </div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;      <span class="keywordflow">if</span> (Brackets-&gt;hasPendingEvent()) {</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;        BlockInfo *MoveBracketsToSucc = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *Succ : BI.MBB-&gt;successors()) {</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;          <span class="keyword">auto</span> SuccBII = BlockInfos.<a class="code" href="classllvm_1_1MapVector.html#a6b0c3e15c351ba9682837c29b0a141b6">find</a>(Succ);</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;          BlockInfo &amp;SuccBI = SuccBII-&gt;second;</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;          <span class="keywordflow">if</span> (!SuccBI.Incoming) {</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;            SuccBI.Dirty = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;            <span class="keywordflow">if</span> (SuccBII &lt;= BII)</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;              Repeat = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;            <span class="keywordflow">if</span> (!MoveBracketsToSucc) {</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;              MoveBracketsToSucc = &amp;SuccBI;</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;              SuccBI.Incoming = std::make_unique&lt;WaitcntBrackets&gt;(*Brackets);</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;            }</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (SuccBI.Incoming-&gt;merge(*Brackets)) {</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;            SuccBI.Dirty = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;            <span class="keywordflow">if</span> (SuccBII &lt;= BII)</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;              Repeat = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;          }</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;        }</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;        <span class="keywordflow">if</span> (MoveBracketsToSucc)</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;          MoveBracketsToSucc-&gt;Incoming = <a class="code" href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">std::move</a>(Brackets);</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;      }</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    }</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;  } <span class="keywordflow">while</span> (Repeat);</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160; </div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;hasScalarStores()) {</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;MachineBasicBlock *, 4&gt;</a> EndPgmBlocks;</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;    <span class="keywordtype">bool</span> HaveScalarStores = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160; </div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a> : MF) {</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> &amp;<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : <a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>) {</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;        <span class="keywordflow">if</span> (!HaveScalarStores &amp;&amp; <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isScalarStore(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>))</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;          HaveScalarStores = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160; </div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == AMDGPU::S_ENDPGM ||</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;            <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == AMDGPU::SI_RETURN_TO_EPILOG)</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;          EndPgmBlocks.push_back(&amp;<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>);</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;      }</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;    }</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160; </div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;    <span class="keywordflow">if</span> (HaveScalarStores) {</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;      <span class="comment">// If scalar writes are used, the cache must be flushed or else the next</span></div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;      <span class="comment">// wave to reuse the same scratch memory can be clobbered.</span></div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;      <span class="comment">// Insert s_dcache_wb at wave termination points if there were any scalar</span></div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;      <span class="comment">// stores, and only if the cache hasn&#39;t already been flushed. This could</span></div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;      <span class="comment">// be improved by looking across blocks for flushes in postdominating</span></div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;      <span class="comment">// blocks from the stores but an explicitly requested flush is probably</span></div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;      <span class="comment">// very rare.</span></div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a> : EndPgmBlocks) {</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;        <span class="keywordtype">bool</span> SeenDCacheWB = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160; </div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineInstrBundleIterator.html">MachineBasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ab2d91e7bec944efcbc39d8e30644f111">begin</a>(), <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = <a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#acbc921830578e2741be6549db716c0ce">end</a>();</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;             <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == AMDGPU::S_DCACHE_WB)</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;            SeenDCacheWB = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isScalarStore(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;            SeenDCacheWB = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160; </div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;          <span class="comment">// FIXME: It would be better to insert this before a waitcnt if any.</span></div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;          <span class="keywordflow">if</span> ((<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == AMDGPU::S_ENDPGM ||</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;               <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == AMDGPU::SI_RETURN_TO_EPILOG) &amp;&amp;</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;              !SeenDCacheWB) {</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;            <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;            <a class="code" href="namespacellvm.html#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(*<a class="code" href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc(), <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(AMDGPU::S_DCACHE_WB));</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;          }</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;        }</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;      }</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;    }</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;  }</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160; </div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="anamespacellvm_1_1Check_html_a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396"><div class="ttname"><a href="namespacellvm_1_1Check.html#a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396">llvm::Check::Size</a></div><div class="ttdeci">@ Size</div><div class="ttdef"><b>Definition:</b> <a href="FileCheck_8h_source.html#l00077">FileCheck.h:77</a></div></div>
<div class="ttc" id="alib_2Target_2README_8txt_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2README_8txt_source.html#l00029">README.txt:29</a></div></div>
<div class="ttc" id="anamespacellvm_1_1RegState_html_aef4cc0c855dc833e2a9d58a50703320dab502f975742e9bff6d6dd7b49439b806"><div class="ttname"><a href="namespacellvm_1_1RegState.html#aef4cc0c855dc833e2a9d58a50703320dab502f975742e9bff6d6dd7b49439b806">llvm::RegState::Undef</a></div><div class="ttdeci">@ Undef</div><div class="ttdoc">Value of the register doesn't matter.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstrBuilder_8h_source.html#l00052">MachineInstrBuilder.h:52</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_html_ad6c6b1894340016cee9e4b730ade8af6"><div class="ttname"><a href="namespacellvm_1_1AMDGPU.html#ad6c6b1894340016cee9e4b730ade8af6">llvm::AMDGPU::getMUBUFIsBufferInv</a></div><div class="ttdeci">bool getMUBUFIsBufferInv(unsigned Opc)</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUBaseInfo_8cpp_source.html#l00411">AMDGPUBaseInfo.cpp:411</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_html_ab1b1fa0e6e5c1b25ef79b0f7c121a6c1"><div class="ttname"><a href="namespacellvm_1_1AMDGPU.html#ab1b1fa0e6e5c1b25ef79b0f7c121a6c1">llvm::AMDGPU::getMCReg</a></div><div class="ttdeci">unsigned getMCReg(unsigned Reg, const MCSubtargetInfo &amp;STI)</div><div class="ttdoc">If Reg is a pseudo reg, return the correct hardware register given STI otherwise return Reg.</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUBaseInfo_8cpp_source.html#l02113">AMDGPUBaseInfo.cpp:2113</a></div></div>
<div class="ttc" id="aclassllvm_1_1SIInstrInfo_html_a6c4c2a9d09070e2709f9725a915575e4"><div class="ttname"><a href="classllvm_1_1SIInstrInfo.html#a6c4c2a9d09070e2709f9725a915575e4">llvm::SIInstrInfo::isAtomicRet</a></div><div class="ttdeci">static bool isAtomicRet(const MachineInstr &amp;MI)</div><div class="ttdef"><b>Definition:</b> <a href="SIInstrInfo_8h_source.html#l00579">SIInstrInfo.h:579</a></div></div>
<div class="ttc" id="aSIInsertWaitcnts_8cpp_html_a94ceb20d45e28266a8e3c88177cd5433"><div class="ttname"><a href="SIInsertWaitcnts_8cpp.html#a94ceb20d45e28266a8e3c88177cd5433">readsVCCZ</a></div><div class="ttdeci">static bool readsVCCZ(const MachineInstr &amp;MI)</div><div class="ttdef"><b>Definition:</b> <a href="SIInsertWaitcnts_8cpp_source.html#l00969">SIInsertWaitcnts.cpp:969</a></div></div>
<div class="ttc" id="aIRTranslator_8cpp_html_abe44dfdea65b4f7e11e0a608ab708b76"><div class="ttname"><a href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a></div><div class="ttdeci">IRTranslator LLVM IR MI</div><div class="ttdef"><b>Definition:</b> <a href="IRTranslator_8cpp_source.html#l00109">IRTranslator.cpp:109</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstrBuilder_html_a4f1ceb770fe3446bfb2b3fa26858098f"><div class="ttname"><a href="classllvm_1_1MachineInstrBuilder.html#a4f1ceb770fe3446bfb2b3fa26858098f">llvm::MachineInstrBuilder::addImm</a></div><div class="ttdeci">const MachineInstrBuilder &amp; addImm(int64_t Val) const</div><div class="ttdoc">Add a new immediate operand.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstrBuilder_8h_source.html#l00131">MachineInstrBuilder.h:131</a></div></div>
<div class="ttc" id="anamespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">This is an optimization pass for GlobalISel generic memory operations.</div><div class="ttdef"><b>Definition:</b> <a href="AddressRanges_8h_source.html#l00018">AddressRanges.h:18</a></div></div>
<div class="ttc" id="alib_2Target_2X86_2README_8txt_html_ac88fe1d3a61b056a4f64fbbb156a62ff"><div class="ttname"><a href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a></div><div class="ttdeci">We currently emits eax Perhaps this is what we really should generate is Is imull three or four cycles eax eax The current instruction priority is based on pattern complexity The former is more complex because it folds a load so the latter will not be emitted Perhaps we should use AddedComplexity to give LEA32r a higher priority We should always try to match LEA first since the LEA matching code does some estimate to determine whether the match is profitable if we care more about code then imull is better It s two bytes shorter than movl leal On a Pentium M</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2X86_2README_8txt_source.html#l00252">README.txt:252</a></div></div>
<div class="ttc" id="anamespacellvm_html_ad1a91b49e0c092818a0b82f6cc130a1b"><div class="ttname"><a href="namespacellvm.html#ad1a91b49e0c092818a0b82f6cc130a1b">llvm::make_range</a></div><div class="ttdeci">iterator_range&lt; T &gt; make_range(T x, T y)</div><div class="ttdoc">Convenience function for iterating over sub-ranges.</div><div class="ttdef"><b>Definition:</b> <a href="iterator__range_8h_source.html#l00053">iterator_range.h:53</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineLoopInfo_html_aa62155b3e041c8a6c1742e1552c99649"><div class="ttname"><a href="classllvm_1_1MachineLoopInfo.html#aa62155b3e041c8a6c1742e1552c99649">llvm::MachineLoopInfo::getLoopFor</a></div><div class="ttdeci">MachineLoop * getLoopFor(const MachineBasicBlock *BB) const</div><div class="ttdoc">Return the innermost loop that BB lives in.</div><div class="ttdef"><b>Definition:</b> <a href="MachineLoopInfo_8h_source.html#l00126">MachineLoopInfo.h:126</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPUAS_html_ab1843c6566c95d94d6e36a857b8d2b3fa77b1c964e2ff99057bf5e75140457abe"><div class="ttname"><a href="namespacellvm_1_1AMDGPUAS.html#ab1843c6566c95d94d6e36a857b8d2b3fa77b1c964e2ff99057bf5e75140457abe">llvm::AMDGPUAS::LOCAL_ADDRESS</a></div><div class="ttdeci">@ LOCAL_ADDRESS</div><div class="ttdoc">Address space for local memory.</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPU_8h_source.html#l00377">AMDGPU.h:377</a></div></div>
<div class="ttc" id="aArchiveWriter_8cpp_html_aa9f638c7ae7fdd206a6c60e26bef9751"><div class="ttname"><a href="ArchiveWriter_8cpp.html#aa9f638c7ae7fdd206a6c60e26bef9751">print</a></div><div class="ttdeci">static void print(raw_ostream &amp;Out, object::Archive::Kind Kind, T Val)</div><div class="ttdef"><b>Definition:</b> <a href="ArchiveWriter_8cpp_source.html#l00189">ArchiveWriter.cpp:189</a></div></div>
<div class="ttc" id="aclassllvm_1_1SIInstrInfo_html_a85e762ca75d1db9247a7d659fbf77d2a"><div class="ttname"><a href="classllvm_1_1SIInstrInfo.html#a85e762ca75d1db9247a7d659fbf77d2a">llvm::SIInstrInfo::isVINTERP</a></div><div class="ttdeci">static bool isVINTERP(const MachineInstr &amp;MI)</div><div class="ttdef"><b>Definition:</b> <a href="SIInstrInfo_8h_source.html#l00702">SIInstrInfo.h:702</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_html_a4c450943f424116a9b6b9a3db451af6c"><div class="ttname"><a href="namespacellvm_1_1AMDGPU.html#a4c450943f424116a9b6b9a3db451af6c">llvm::AMDGPU::getIsaVersion</a></div><div class="ttdeci">IsaVersion getIsaVersion(StringRef GPU)</div><div class="ttdef"><b>Definition:</b> <a href="TargetParser_8cpp_source.html#l00193">TargetParser.cpp:193</a></div></div>
<div class="ttc" id="aSIMachineFunctionInfo_8h_html"><div class="ttname"><a href="SIMachineFunctionInfo_8h.html">SIMachineFunctionInfo.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineRegisterInfo_html"><div class="ttname"><a href="classllvm_1_1MachineRegisterInfo.html">llvm::MachineRegisterInfo</a></div><div class="ttdoc">MachineRegisterInfo - Keep track of information for virtual and physical registers,...</div><div class="ttdef"><b>Definition:</b> <a href="MachineRegisterInfo_8h_source.html#l00051">MachineRegisterInfo.h:51</a></div></div>
<div class="ttc" id="aclassT_html"><div class="ttname"><a href="classT.html">T</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstr_html_a17f5d15a7320dec2cfefb6617f711ab7"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a17f5d15a7320dec2cfefb6617f711ab7">llvm::MachineInstr::mayLoadOrStore</a></div><div class="ttdeci">bool mayLoadOrStore(QueryType Type=AnyInBundle) const</div><div class="ttdoc">Return true if this instruction could possibly read or modify memory.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l01079">MachineInstr.h:1079</a></div></div>
<div class="ttc" id="aclassllvm_1_1Loop_html"><div class="ttname"><a href="classllvm_1_1Loop.html">llvm::Loop</a></div><div class="ttdoc">Represents a single loop in the control flow graph.</div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l00547">LoopInfo.h:547</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstr_html_a682028ac4a06c9e3550fa8e6e1909fa9"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a682028ac4a06c9e3550fa8e6e1909fa9">llvm::MachineInstr::mayLoad</a></div><div class="ttdeci">bool mayLoad(QueryType Type=AnyInBundle) const</div><div class="ttdoc">Return true if this instruction could possibly read memory.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l01056">MachineInstr.h:1056</a></div></div>
<div class="ttc" id="aSIInsertWaitcnts_8cpp_html_aec4edf4f2cb93125b6dce45fbecfc556"><div class="ttname"><a href="SIInsertWaitcnts_8cpp.html#aec4edf4f2cb93125b6dce45fbecfc556">Waitcnts</a></div><div class="ttdeci">SI Insert Waitcnts</div><div class="ttdef"><b>Definition:</b> <a href="SIInsertWaitcnts_8cpp_source.html#l00843">SIInsertWaitcnts.cpp:843</a></div></div>
<div class="ttc" id="aclassllvm_1_1MapVector_html_ae091b147039557cf8ce505740e7ff7ac"><div class="ttname"><a href="classllvm_1_1MapVector.html#ae091b147039557cf8ce505740e7ff7ac">llvm::MapVector::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00089">MapVector.h:89</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector</a></div><div class="ttdoc">This is a 'vector' (really, a variable-sized array), optimized for the case when the array is small.</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l01199">SmallVector.h:1199</a></div></div>
<div class="ttc" id="aSIInsertWaitcnts_8cpp_html_a87d0ba229f3fffeaafd9aba7162ba52e"><div class="ttname"><a href="SIInsertWaitcnts_8cpp.html#a87d0ba229f3fffeaafd9aba7162ba52e">INITIALIZE_PASS_BEGIN</a></div><div class="ttdeci">INITIALIZE_PASS_BEGIN(SIInsertWaitcnts, DEBUG_TYPE, &quot;SI Insert Waitcnts&quot;, false, false) INITIALIZE_PASS_END(SIInsertWaitcnts</div></div>
<div class="ttc" id="aclassllvm_1_1TargetRegisterInfo_html_af2f8f83c931fa084058914c65af13984"><div class="ttname"><a href="classllvm_1_1TargetRegisterInfo.html#af2f8f83c931fa084058914c65af13984">llvm::TargetRegisterInfo::isInAllocatableClass</a></div><div class="ttdeci">bool isInAllocatableClass(MCRegister RegNo) const</div><div class="ttdoc">Return true if the register is in the allocation of any register class.</div><div class="ttdef"><b>Definition:</b> <a href="TargetRegisterInfo_8h_source.html#l00364">TargetRegisterInfo.h:364</a></div></div>
<div class="ttc" id="anamespacellvm_1_1X86Disassembler_html_a1e59b79e1d09149912cad9c0ef2809ad"><div class="ttname"><a href="namespacellvm_1_1X86Disassembler.html#a1e59b79e1d09149912cad9c0ef2809ad">llvm::X86Disassembler::Reg</a></div><div class="ttdeci">Reg</div><div class="ttdoc">All possible values of the reg field in the ModR/M byte.</div><div class="ttdef"><b>Definition:</b> <a href="X86DisassemblerDecoder_8h_source.html#l00462">X86DisassemblerDecoder.h:462</a></div></div>
<div class="ttc" id="aMapVector_8h_html"><div class="ttname"><a href="MapVector_8h.html">MapVector.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1SIInstrInfo_html_a2d40ab246e329190bbf36cd93fd88e83"><div class="ttname"><a href="classllvm_1_1SIInstrInfo.html#a2d40ab246e329190bbf36cd93fd88e83">llvm::SIInstrInfo::isEXP</a></div><div class="ttdeci">static bool isEXP(const MachineInstr &amp;MI)</div><div class="ttdef"><b>Definition:</b> <a href="SIInstrInfo_8h_source.html#l00555">SIInstrInfo.h:555</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineFunctionPass_html"><div class="ttname"><a href="classllvm_1_1MachineFunctionPass.html">llvm::MachineFunctionPass</a></div><div class="ttdoc">MachineFunctionPass - This class adapts the FunctionPass interface to allow convenient creation of pa...</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunctionPass_8h_source.html#l00030">MachineFunctionPass.h:30</a></div></div>
<div class="ttc" id="astructllvm_1_1enum__iteration__traits_html"><div class="ttname"><a href="structllvm_1_1enum__iteration__traits.html">llvm::enum_iteration_traits</a></div><div class="ttdef"><b>Definition:</b> <a href="Sequence_8h_source.html#l00099">Sequence.h:99</a></div></div>
<div class="ttc" id="anamespacellvm_1_1cl_html_a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6"><div class="ttname"><a href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">llvm::cl::Hidden</a></div><div class="ttdeci">@ Hidden</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00138">CommandLine.h:138</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a1eb8504bab5f794778d82db6ac829923"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a1eb8504bab5f794778d82db6ac829923">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::erase</a></div><div class="ttdeci">bool erase(const KeyT &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00302">DenseMap.h:302</a></div></div>
<div class="ttc" id="anamespacellvm_1_1sys_html_a7defb51d8d6a2eba7a428d1a22f08bad"><div class="ttname"><a href="namespacellvm_1_1sys.html#a7defb51d8d6a2eba7a428d1a22f08bad">llvm::sys::Wait</a></div><div class="ttdeci">ProcessInfo Wait(const ProcessInfo &amp;PI, std::optional&lt; unsigned &gt; SecondsToWait, std::string *ErrMsg=nullptr, std::optional&lt; ProcessStatistics &gt; *ProcStat=nullptr, bool Polling=false)</div><div class="ttdoc">This function waits for the process specified by PI to finish.</div></div>
<div class="ttc" id="aclassllvm_1_1MachineOperand_html_a2feaa1c69335c6b9028076cd68c7a5f5"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#a2feaa1c69335c6b9028076cd68c7a5f5">llvm::MachineOperand::setImm</a></div><div class="ttdeci">void setImm(int64_t immVal)</div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00684">MachineOperand.h:684</a></div></div>
<div class="ttc" id="aclassllvm_1_1MCRegisterInfo_html_a8ce9439c5f364d8b85930e0ee689bbb8"><div class="ttname"><a href="classllvm_1_1MCRegisterInfo.html#a8ce9439c5f364d8b85930e0ee689bbb8">llvm::MCRegisterInfo::getEncodingValue</a></div><div class="ttdeci">uint16_t getEncodingValue(MCRegister RegNo) const</div><div class="ttdoc">Returns the encoding for RegNo.</div><div class="ttdef"><b>Definition:</b> <a href="MCRegisterInfo_8h_source.html#l00553">MCRegisterInfo.h:553</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1Exp_html_af7592dc94276d1958420bcfb414b6998a819e373068289857bb1cef7f5b320c11"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1Exp.html#af7592dc94276d1958420bcfb414b6998a819e373068289857bb1cef7f5b320c11">llvm::AMDGPU::Exp::ET_POS0</a></div><div class="ttdeci">@ ET_POS0</div><div class="ttdef"><b>Definition:</b> <a href="SIDefines_8h_source.html#l00873">SIDefines.h:873</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineMemOperand_html"><div class="ttname"><a href="classllvm_1_1MachineMemOperand.html">llvm::MachineMemOperand</a></div><div class="ttdoc">A description of a memory reference used in the backend.</div><div class="ttdef"><b>Definition:</b> <a href="MachineMemOperand_8h_source.html#l00127">MachineMemOperand.h:127</a></div></div>
<div class="ttc" id="anamespacellvm_html_a5f92d578f7a7f3e9b454449bbcd0e52b"><div class="ttname"><a href="namespacellvm.html#a5f92d578f7a7f3e9b454449bbcd0e52b">llvm::SIInsertWaitcntsID</a></div><div class="ttdeci">char &amp; SIInsertWaitcntsID</div><div class="ttdef"><b>Definition:</b> <a href="SIInsertWaitcnts_8cpp_source.html#l00848">SIInsertWaitcnts.cpp:848</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a53408c95a7bfb5443b43fb2134c3eb23"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a53408c95a7bfb5443b43fb2134c3eb23">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::count</a></div><div class="ttdeci">size_type count(const_arg_type_t&lt; KeyT &gt; Val) const</div><div class="ttdoc">Return 1 if the specified key is in the map, 0 otherwise.</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00145">DenseMap.h:145</a></div></div>
<div class="ttc" id="aclassllvm_1_1MapVector_html"><div class="ttname"><a href="classllvm_1_1MapVector.html">llvm::MapVector</a></div><div class="ttdoc">This class implements a map that also provides access to all stored values in a deterministic order.</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00037">MapVector.h:37</a></div></div>
<div class="ttc" id="aclassllvm_1_1GCNSubtarget_html"><div class="ttname"><a href="classllvm_1_1GCNSubtarget.html">llvm::GCNSubtarget</a></div><div class="ttdef"><b>Definition:</b> <a href="GCNSubtarget_8h_source.html#l00032">GCNSubtarget.h:32</a></div></div>
<div class="ttc" id="anamespacellvm_html_ab4d4bc901fedd8857f647dcc2c0d71de"><div class="ttname"><a href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">llvm::max</a></div><div class="ttdeci">Expected&lt; ExpressionValue &gt; max(const ExpressionValue &amp;Lhs, const ExpressionValue &amp;Rhs)</div><div class="ttdef"><b>Definition:</b> <a href="FileCheck_8cpp_source.html#l00337">FileCheck.cpp:337</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_html_a84f97b2884502eab6b0196da9e29e178"><div class="ttname"><a href="namespacellvm_1_1AMDGPU.html#a84f97b2884502eab6b0196da9e29e178">llvm::AMDGPU::getVmcntBitMask</a></div><div class="ttdeci">unsigned getVmcntBitMask(const IsaVersion &amp;Version)</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUBaseInfo_8cpp_source.html#l01239">AMDGPUBaseInfo.cpp:1239</a></div></div>
<div class="ttc" id="anamespacellvm_html_a03503773241005f01b090b9862aad304"><div class="ttname"><a href="namespacellvm.html#a03503773241005f01b090b9862aad304">llvm::dump</a></div><div class="ttdeci">void dump(const SparseBitVector&lt; ElementSize &gt; &amp;LHS, raw_ostream &amp;out)</div><div class="ttdef"><b>Definition:</b> <a href="SparseBitVector_8h_source.html#l00877">SparseBitVector.h:877</a></div></div>
<div class="ttc" id="aTargetParser_8h_html"><div class="ttname"><a href="TargetParser_8h.html">TargetParser.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_html_a27efe1286cc31f5fc95355af30b0356c"><div class="ttname"><a href="namespacellvm_1_1AMDGPU.html#a27efe1286cc31f5fc95355af30b0356c">llvm::AMDGPU::getNamedOperandIdx</a></div><div class="ttdeci">LLVM_READONLY int16_t getNamedOperandIdx(uint16_t Opcode, uint16_t NamedIdx)</div></div>
<div class="ttc" id="aSIInsertWaitcnts_8cpp_html_abb5f557136c002ba27b210cd2b0ce543"><div class="ttname"><a href="SIInsertWaitcnts_8cpp.html#abb5f557136c002ba27b210cd2b0ce543">DEBUG_COUNTER</a></div><div class="ttdeci">DEBUG_COUNTER(ForceExpCounter, DEBUG_TYPE&quot;-forceexp&quot;, &quot;Force emit s_waitcnt expcnt(0) instrs&quot;)</div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1Exp_html_af7592dc94276d1958420bcfb414b6998afe9e14fadada855231c900eecbea27f2"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1Exp.html#af7592dc94276d1958420bcfb414b6998afe9e14fadada855231c900eecbea27f2">llvm::AMDGPU::Exp::ET_PARAM0</a></div><div class="ttdeci">@ ET_PARAM0</div><div class="ttdef"><b>Definition:</b> <a href="SIDefines_8h_source.html#l00880">SIDefines.h:880</a></div></div>
<div class="ttc" id="aSequence_8h_html"><div class="ttname"><a href="Sequence_8h.html">Sequence.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1detail_1_1DenseSetImpl_html_a79eed48913651aeedda2eed25201ea84"><div class="ttname"><a href="classllvm_1_1detail_1_1DenseSetImpl.html#a79eed48913651aeedda2eed25201ea84">llvm::detail::DenseSetImpl&lt; ValueT, DenseMap&lt; ValueT, detail::DenseSetEmpty, DenseMapInfo&lt; ValueT &gt;, detail::DenseSetPair&lt; ValueT &gt; &gt;, DenseMapInfo&lt; ValueT &gt; &gt;::insert</a></div><div class="ttdeci">std::pair&lt; iterator, bool &gt; insert(const ValueT &amp;V)</div><div class="ttdef"><b>Definition:</b> <a href="DenseSet_8h_source.html#l00206">DenseSet.h:206</a></div></div>
<div class="ttc" id="aclassllvm_1_1detail_1_1DenseSetImpl_html_afe504aa31a6a354cec13f5b32d0b1d9d"><div class="ttname"><a href="classllvm_1_1detail_1_1DenseSetImpl.html#afe504aa31a6a354cec13f5b32d0b1d9d">llvm::detail::DenseSetImpl&lt; ValueT, DenseMap&lt; ValueT, detail::DenseSetEmpty, DenseMapInfo&lt; ValueT &gt;, detail::DenseSetPair&lt; ValueT &gt; &gt;, DenseMapInfo&lt; ValueT &gt; &gt;::count</a></div><div class="ttdeci">size_type count(const_arg_type_t&lt; ValueT &gt; V) const</div><div class="ttdoc">Return 1 if the specified key is in the set, 0 otherwise.</div><div class="ttdef"><b>Definition:</b> <a href="DenseSet_8h_source.html#l00097">DenseSet.h:97</a></div></div>
<div class="ttc" id="aMachineSink_8cpp_html_a0f36ed1bc17fc1aa97fe291c439a0698"><div class="ttname"><a href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a></div><div class="ttdeci">unsigned const TargetRegisterInfo * TRI</div><div class="ttdef"><b>Definition:</b> <a href="MachineSink_8cpp_source.html#l01628">MachineSink.cpp:1628</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineFunctionPass_html_a864fd57b4304ef933b3281d0ef85a88e"><div class="ttname"><a href="classllvm_1_1MachineFunctionPass.html#a864fd57b4304ef933b3281d0ef85a88e">llvm::MachineFunctionPass::getAnalysisUsage</a></div><div class="ttdeci">void getAnalysisUsage(AnalysisUsage &amp;AU) const override</div><div class="ttdoc">getAnalysisUsage - Subclasses that override getAnalysisUsage must call this.</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunctionPass_8cpp_source.html#l00167">MachineFunctionPass.cpp:167</a></div></div>
<div class="ttc" id="aDebug_8h_html_a08efc68d15935eb8889400a46c3749ba"><div class="ttname"><a href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a></div><div class="ttdeci">#define LLVM_DEBUG(X)</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8h_source.html#l00101">Debug.h:101</a></div></div>
<div class="ttc" id="aclassllvm_1_1DebugCounter_html_a50989c336e006eb7f8c168f04dbb32a4"><div class="ttname"><a href="classllvm_1_1DebugCounter.html#a50989c336e006eb7f8c168f04dbb32a4">llvm::DebugCounter::isCounterSet</a></div><div class="ttdeci">static bool isCounterSet(unsigned ID)</div><div class="ttdef"><b>Definition:</b> <a href="DebugCounter_8h_source.html#l00100">DebugCounter.h:100</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineLoopInfo_html"><div class="ttname"><a href="classllvm_1_1MachineLoopInfo.html">llvm::MachineLoopInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineLoopInfo_8h_source.html#l00089">MachineLoopInfo.h:89</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1SendMsg_html_a3a326b706ed4c9caaca05063b47c98dba2725a8fe1793af838f1f598cf482dd94"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a3a326b706ed4c9caaca05063b47c98dba2725a8fe1793af838f1f598cf482dd94">llvm::AMDGPU::SendMsg::ID_MASK_PreGFX11_</a></div><div class="ttdeci">@ ID_MASK_PreGFX11_</div><div class="ttdef"><b>Definition:</b> <a href="SIDefines_8h_source.html#l00353">SIDefines.h:353</a></div></div>
<div class="ttc" id="anamespacellvm_1_1SIInstrFlags_html_ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7"><div class="ttname"><a href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daf5dfd8c9db8b07c80292e662aa96c6a7">llvm::SIInstrFlags::VM_CNT</a></div><div class="ttdeci">@ VM_CNT</div><div class="ttdef"><b>Definition:</b> <a href="SIDefines_8h_source.html#l00073">SIDefines.h:73</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7c46c742c31be54870e2038048e6b391"><div class="ttname"><a href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">llvm::dbgs</a></div><div class="ttdeci">raw_ostream &amp; dbgs()</div><div class="ttdoc">dbgs() - This returns a reference to a raw_ostream for debugging messages.</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8cpp_source.html#l00163">Debug.cpp:163</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_html_a8f27aa11689bf9b12f6fb0e436e367c7"><div class="ttname"><a href="namespacellvm_1_1AMDGPU.html#a8f27aa11689bf9b12f6fb0e436e367c7">llvm::AMDGPU::hasNamedOperand</a></div><div class="ttdeci">LLVM_READONLY bool hasNamedOperand(uint64_t Opcode, uint64_t NamedIdx)</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUBaseInfo_8h_source.html#l00336">AMDGPUBaseInfo.h:336</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineFunction_html_ab1063ce5e180c89490fae50511a46a29"><div class="ttname"><a href="classllvm_1_1MachineFunction.html#ab1063ce5e180c89490fae50511a46a29">llvm::MachineFunction::front</a></div><div class="ttdeci">const MachineBasicBlock &amp; front() const</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00882">MachineFunction.h:882</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineFunction_html_ab4a6ca428289b667dd691a00e9f7e334"><div class="ttname"><a href="classllvm_1_1MachineFunction.html#ab4a6ca428289b667dd691a00e9f7e334">llvm::MachineFunction::getRegInfo</a></div><div class="ttdeci">MachineRegisterInfo &amp; getRegInfo()</div><div class="ttdoc">getRegInfo - Return information about the registers currently in use.</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00682">MachineFunction.h:682</a></div></div>
<div class="ttc" id="aclassllvm_1_1MapVector_html_aa610cab7ee61e36a6d1d122fc252c278"><div class="ttname"><a href="classllvm_1_1MapVector.html#aa610cab7ee61e36a6d1d122fc252c278">llvm::MapVector::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00070">MapVector.h:70</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstr_html_a30e7d619f3195fd890116da8b3ed6bab"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a30e7d619f3195fd890116da8b3ed6bab">llvm::MachineInstr::isCall</a></div><div class="ttdeci">bool isCall(QueryType Type=AnyInBundle) const</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00872">MachineInstr.h:872</a></div></div>
<div class="ttc" id="aMachineLoopInfo_8h_html"><div class="ttname"><a href="MachineLoopInfo_8h.html">MachineLoopInfo.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1SIInstrInfo_html_abdcf600002fd489c76924f2ec4f4fc0f"><div class="ttname"><a href="classllvm_1_1SIInstrInfo.html#abdcf600002fd489c76924f2ec4f4fc0f">llvm::SIInstrInfo::isMIMG</a></div><div class="ttdeci">static bool isMIMG(const MachineInstr &amp;MI)</div><div class="ttdef"><b>Definition:</b> <a href="SIInstrInfo_8h_source.html#l00502">SIInstrInfo.h:502</a></div></div>
<div class="ttc" id="aGCNSubtarget_8h_html"><div class="ttname"><a href="GCNSubtarget_8h.html">GCNSubtarget.h</a></div></div>
<div class="ttc" id="aBuiltinGCs_8cpp_html_a6742d2e0a668baf1196ec69e158d5f15"><div class="ttname"><a href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a></div><div class="ttdeci">static GCRegistry::Add&lt; CoreCLRGC &gt; E(&quot;coreclr&quot;, &quot;CoreCLR-compatible GC&quot;)</div></div>
<div class="ttc" id="aclassllvm_1_1MachineOperand_html_a38b28a85f818b49d8806c150b8a5b4f7"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#a38b28a85f818b49d8806c150b8a5b4f7">llvm::MachineOperand::getImm</a></div><div class="ttdeci">int64_t getImm() const</div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00556">MachineOperand.h:556</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineFunction_html_ac2dc0fa143c9f2127f0501734577a0a0"><div class="ttname"><a href="classllvm_1_1MachineFunction.html#ac2dc0fa143c9f2127f0501734577a0a0">llvm::MachineFunction::getInfo</a></div><div class="ttdeci">Ty * getInfo()</div><div class="ttdoc">getInfo - Keep track of various per-function pieces of information for backends that would like to do...</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00770">MachineFunction.h:770</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstr_html_a3f7a45f6e10668a5f702e26bca80d18e"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a3f7a45f6e10668a5f702e26bca80d18e">llvm::MachineInstr::getOperand</a></div><div class="ttdeci">const MachineOperand &amp; getOperand(unsigned i) const</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00526">MachineInstr.h:526</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPUISD_html_a739d53294bc38cd6b0b23332f9994c0eabf84d249106fbef805c08aae16f19968"><div class="ttname"><a href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eabf84d249106fbef805c08aae16f19968">llvm::AMDGPUISD::DS_ORDERED_COUNT</a></div><div class="ttdeci">@ DS_ORDERED_COUNT</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUISelLowering_8h_source.html#l00514">AMDGPUISelLowering.h:514</a></div></div>
<div class="ttc" id="anamespacellvm_html_ae1f1b566607514b37834c2667e016954"><div class="ttname"><a href="namespacellvm.html#ae1f1b566607514b37834c2667e016954">llvm::createSIInsertWaitcntsPass</a></div><div class="ttdeci">FunctionPass * createSIInsertWaitcntsPass()</div><div class="ttdef"><b>Definition:</b> <a href="SIInsertWaitcnts_8cpp_source.html#l00850">SIInsertWaitcnts.cpp:850</a></div></div>
<div class="ttc" id="aSIInstrInfo_8cpp_html_a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791"><div class="ttname"><a href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a></div><div class="ttdeci">@ SI</div><div class="ttdef"><b>Definition:</b> <a href="SIInstrInfo_8cpp_source.html#l07993">SIInstrInfo.cpp:7993</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetRegisterClass_html"><div class="ttname"><a href="classllvm_1_1TargetRegisterClass.html">llvm::TargetRegisterClass</a></div><div class="ttdef"><b>Definition:</b> <a href="TargetRegisterInfo_8h_source.html#l00045">TargetRegisterInfo.h:45</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisUsage_html"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html">llvm::AnalysisUsage</a></div><div class="ttdoc">Represent the analysis usage information of a pass.</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00047">PassAnalysisSupport.h:47</a></div></div>
<div class="ttc" id="aREADME-SSE_8txt_html_a50fd53d9a3e55ae78555e11827355565"><div class="ttname"><a href="README-SSE_8txt.html#a50fd53d9a3e55ae78555e11827355565">t</a></div><div class="ttdeci">bitcast float %x to i32 %s=and i32 %t, 2147483647 %d=bitcast i32 %s to float ret float %d } declare float @fabsf(float %n) define float @bar(float %x) nounwind { %d=call float @fabsf(float %x) ret float %d } This IR(from PR6194):target datalayout=&quot;e-p:64:64:64-i1:8:8-i8:8:8-i16:16:16-i32:32:32-i64:64:64-f32:32:32-f64:64:64-v64:64:64-v128:128:128-a0:0:64-s0:64:64-f80:128:128-n8:16:32:64-S128&quot; target triple=&quot;x86_64-apple-darwin10.0.0&quot; %0=type { double, double } %struct.float3=type { float, float, float } define void @test(%0, %struct.float3 *nocapture %res) nounwind noinline ssp { entry:%tmp18=extractvalue %0 %0, 0 t</div><div class="ttdef"><b>Definition:</b> <a href="README-SSE_8txt_source.html#l00788">README-SSE.txt:788</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ms__demangle_html_afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e"><div class="ttname"><a href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">llvm::ms_demangle::QualifierMangleMode::Result</a></div><div class="ttdeci">@ Result</div></div>
<div class="ttc" id="anamespacefalse_html"><div class="ttname"><a href="namespacefalse.html">false</a></div><div class="ttdef"><b>Definition:</b> <a href="StackSlotColoring_8cpp_source.html#l00141">StackSlotColoring.cpp:141</a></div></div>
<div class="ttc" id="aHexagonCopyToCombine_8cpp_html_a1d40004718218dbdf06b496766299101"><div class="ttname"><a href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a></div><div class="ttdeci">const HexagonInstrInfo * TII</div><div class="ttdef"><b>Definition:</b> <a href="HexagonCopyToCombine_8cpp_source.html#l00125">HexagonCopyToCombine.cpp:125</a></div></div>
<div class="ttc" id="aLoopDeletion_8cpp_html_a66a2592ace8a67bc796c72710d632bab"><div class="ttname"><a href="LoopDeletion_8cpp.html#a66a2592ace8a67bc796c72710d632bab">merge</a></div><div class="ttdeci">static LoopDeletionResult merge(LoopDeletionResult A, LoopDeletionResult B)</div><div class="ttdef"><b>Definition:</b> <a href="LoopDeletion_8cpp_source.html#l00053">LoopDeletion.cpp:53</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineOperand_html"><div class="ttname"><a href="classllvm_1_1MachineOperand.html">llvm::MachineOperand</a></div><div class="ttdoc">MachineOperand class - Representation of each machine instruction operand.</div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00048">MachineOperand.h:48</a></div></div>
<div class="ttc" id="aclassllvm_1_1DebugCounter_html_a5aace8653ce3726ef07194dcf6bce2bf"><div class="ttname"><a href="classllvm_1_1DebugCounter.html#a5aace8653ce3726ef07194dcf6bce2bf">llvm::DebugCounter::shouldExecute</a></div><div class="ttdeci">static bool shouldExecute(unsigned CounterName)</div><div class="ttdef"><b>Definition:</b> <a href="DebugCounter_8h_source.html#l00072">DebugCounter.h:72</a></div></div>
<div class="ttc" id="anamespaceOpName_html"><div class="ttname"><a href="namespaceOpName.html">OpName</a></div><div class="ttdef"><b>Definition:</b> <a href="R600Defines_8h_source.html#l00062">R600Defines.h:62</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7f2a3d4dcfee70225988aec53ff1e173"><div class="ttname"><a href="namespacellvm.html#a7f2a3d4dcfee70225988aec53ff1e173">llvm::report_fatal_error</a></div><div class="ttdeci">void report_fatal_error(Error Err, bool gen_crash_diag=true)</div><div class="ttdoc">Report a serious error, calling any installed error handler.</div><div class="ttdef"><b>Definition:</b> <a href="Testing_2Support_2Error_8cpp_source.html#l00145">Error.cpp:145</a></div></div>
<div class="ttc" id="aclassllvm_1_1raw__ostream_html"><div class="ttname"><a href="classllvm_1_1raw__ostream.html">llvm::raw_ostream</a></div><div class="ttdoc">This class implements an extremely fast bulk output stream that can only output to a stream.</div><div class="ttdef"><b>Definition:</b> <a href="raw__ostream_8h_source.html#l00052">raw_ostream.h:52</a></div></div>
<div class="ttc" id="aLoopDeletion_8cpp_html_a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64"><div class="ttname"><a href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">LoopDeletionResult::Modified</a></div><div class="ttdeci">@ Modified</div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_html_a0d3e0a75774a86f6c8302eee2dfe1326"><div class="ttname"><a href="namespacellvm_1_1AMDGPU.html#a0d3e0a75774a86f6c8302eee2dfe1326">llvm::AMDGPU::decodeWaitcnt</a></div><div class="ttdeci">void decodeWaitcnt(const IsaVersion &amp;Version, unsigned Waitcnt, unsigned &amp;Vmcnt, unsigned &amp;Expcnt, unsigned &amp;Lgkmcnt)</div><div class="ttdoc">Decodes Vmcnt, Expcnt and Lgkmcnt from given Waitcnt for given isa Version, and writes decoded values...</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUBaseInfo_8cpp_source.html#l01283">AMDGPUBaseInfo.cpp:1283</a></div></div>
<div class="ttc" id="aCSEInfo_8cpp_html_a75f8a8519c2c9b30e7c06dc5e256fffa"><div class="ttname"><a href="CSEInfo_8cpp.html#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a></div><div class="ttdeci">Analysis containing CSE Info</div><div class="ttdef"><b>Definition:</b> <a href="CSEInfo_8cpp_source.html#l00027">CSEInfo.cpp:27</a></div></div>
<div class="ttc" id="aclassllvm_1_1SIRegisterInfo_html"><div class="ttname"><a href="classllvm_1_1SIRegisterInfo.html">llvm::SIRegisterInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="SIRegisterInfo_8h_source.html#l00030">SIRegisterInfo.h:30</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstr_html_aabed741772b1be65069d9274446a914d"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#aabed741772b1be65069d9274446a914d">llvm::MachineInstr::definesRegister</a></div><div class="ttdeci">bool definesRegister(Register Reg, const TargetRegisterInfo *TRI=nullptr) const</div><div class="ttdoc">Return true if the MachineInstr fully defines the specified register.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l01428">MachineInstr.h:1428</a></div></div>
<div class="ttc" id="anamespacellvm_1_1CallingConv_html_a188c0836f8c3528401f1c236fd93b977"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">llvm::CallingConv::ID</a></div><div class="ttdeci">unsigned ID</div><div class="ttdoc">LLVM IR allows to use arbitrary numbers as calling convention identifiers.</div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00024">CallingConv.h:24</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html">llvm::MachineBasicBlock</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00094">MachineBasicBlock.h:94</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1Exp_html_af7592dc94276d1958420bcfb414b6998ac84234e8abdfe7d1a85fef7297734e49"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1Exp.html#af7592dc94276d1958420bcfb414b6998ac84234e8abdfe7d1a85fef7297734e49">llvm::AMDGPU::Exp::ET_POS_LAST</a></div><div class="ttdeci">@ ET_POS_LAST</div><div class="ttdef"><b>Definition:</b> <a href="SIDefines_8h_source.html#l00876">SIDefines.h:876</a></div></div>
<div class="ttc" id="aPassSupport_8h_html_a74ce8276b89067e806f67c45a6d92575"><div class="ttname"><a href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a></div><div class="ttdeci">#define INITIALIZE_PASS_END(passName, arg, name, cfg, analysis)</div><div class="ttdef"><b>Definition:</b> <a href="PassSupport_8h_source.html#l00059">PassSupport.h:59</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseSet_html"><div class="ttname"><a href="classllvm_1_1DenseSet.html">llvm::DenseSet</a></div><div class="ttdoc">Implements a dense probed hash-table based set.</div><div class="ttdef"><b>Definition:</b> <a href="DenseSet_8h_source.html#l00268">DenseSet.h:268</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineFunction_html_a325f6b611ef9ec06798d3b4eb9572093"><div class="ttname"><a href="classllvm_1_1MachineFunction.html#a325f6b611ef9ec06798d3b4eb9572093">llvm::MachineFunction::getSubtarget</a></div><div class="ttdeci">const TargetSubtargetInfo &amp; getSubtarget() const</div><div class="ttdoc">getSubtarget - Return the subtarget for which this machine code is being compiled.</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00672">MachineFunction.h:672</a></div></div>
<div class="ttc" id="aclassllvm_1_1cl_1_1opt_html"><div class="ttname"><a href="classllvm_1_1cl_1_1opt.html">llvm::cl::opt&lt; bool &gt;</a></div></div>
<div class="ttc" id="alib_2Target_2SystemZ_2README_8txt_html_accaf4e23f4ffc792355e64dcb9af2c96"><div class="ttname"><a href="lib_2Target_2SystemZ_2README_8txt.html#accaf4e23f4ffc792355e64dcb9af2c96">val</a></div><div class="ttdeci">The initial backend is deliberately restricted to z10 We should add support for later architectures at some point If an asm ties an i32 r result to an i64 the input will be treated as an leaving the upper bits uninitialised For i64 store i32 val</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2SystemZ_2README_8txt_source.html#l00015">README.txt:15</a></div></div>
<div class="ttc" id="anamespacellvm_1_1SIInstrFlags_html_ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf"><div class="ttname"><a href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992da39d5973dbb8033fc504c01227f3eaecf">llvm::SIInstrFlags::EXP_CNT</a></div><div class="ttdeci">@ EXP_CNT</div><div class="ttdef"><b>Definition:</b> <a href="SIDefines_8h_source.html#l00074">SIDefines.h:74</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstr_html_ae8ff2acea4fe63e48e8fc6cf0620ff78"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#ae8ff2acea4fe63e48e8fc6cf0620ff78">llvm::MachineInstr::getDebugLoc</a></div><div class="ttdeci">const DebugLoc &amp; getDebugLoc() const</div><div class="ttdoc">Returns the debug location id of this MachineInstr.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00445">MachineInstr.h:445</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_html_aa214c98bde27112b9cec6bc4e1dba715"><div class="ttname"><a href="namespacellvm_1_1AMDGPU.html#aa214c98bde27112b9cec6bc4e1dba715">llvm::AMDGPU::getExpcntBitMask</a></div><div class="ttdeci">unsigned getExpcntBitMask(const IsaVersion &amp;Version)</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUBaseInfo_8cpp_source.html#l01245">AMDGPUBaseInfo.cpp:1245</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineLoop_html"><div class="ttname"><a href="classllvm_1_1MachineLoop.html">llvm::MachineLoop</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineLoopInfo_8h_source.html#l00044">MachineLoopInfo.h:44</a></div></div>
<div class="ttc" id="aAMDGPUMCTargetDesc_8h_html"><div class="ttname"><a href="AMDGPUMCTargetDesc_8h.html">AMDGPUMCTargetDesc.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1MapVector_html_a6b0c3e15c351ba9682837c29b0a141b6"><div class="ttname"><a href="classllvm_1_1MapVector.html#a6b0c3e15c351ba9682837c29b0a141b6">llvm::MapVector::find</a></div><div class="ttdeci">iterator find(const KeyT &amp;Key)</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00148">MapVector.h:148</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineOperand_html_a4c9594c955fec80c73ddd964b5efd554"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#a4c9594c955fec80c73ddd964b5efd554">llvm::MachineOperand::isReg</a></div><div class="ttdeci">bool isReg() const</div><div class="ttdoc">isReg - Tests if this is a MO_Register operand.</div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00329">MachineOperand.h:329</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstr_html"><div class="ttname"><a href="classllvm_1_1MachineInstr.html">llvm::MachineInstr</a></div><div class="ttdoc">Representation of each machine instruction.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00066">MachineInstr.h:66</a></div></div>
<div class="ttc" id="anamespacellvm_1_1SIInstrFlags_html_ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c"><div class="ttname"><a href="namespacellvm_1_1SIInstrFlags.html#ac8376ab01e1f2eb75e242eb464d3992daee110070224119e12075fafd4909dc9c">llvm::SIInstrFlags::LGKM_CNT</a></div><div class="ttdeci">@ LGKM_CNT</div><div class="ttdef"><b>Definition:</b> <a href="SIDefines_8h_source.html#l00075">SIDefines.h:75</a></div></div>
<div class="ttc" id="aSIInsertWaitcnts_8cpp_html_ad78e062f62e0d6e453941fb4ca843e4d"><div class="ttname"><a href="SIInsertWaitcnts_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a></div><div class="ttdeci">#define DEBUG_TYPE</div><div class="ttdef"><b>Definition:</b> <a href="SIInsertWaitcnts_8cpp_source.html#l00041">SIInsertWaitcnts.cpp:41</a></div></div>
<div class="ttc" id="aclassllvm_1_1Interval_html"><div class="ttname"><a href="classllvm_1_1Interval.html">llvm::Interval</a></div><div class="ttdoc">Interval Class - An Interval is a set of nodes defined such that every node in the interval has all o...</div><div class="ttdef"><b>Definition:</b> <a href="Interval_8h_source.html#l00036">Interval.h:36</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ARM__MB_html_ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2"><div class="ttname"><a href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">llvm::ARM_MB::ST</a></div><div class="ttdeci">@ ST</div><div class="ttdef"><b>Definition:</b> <a href="MCTargetDesc_2ARMBaseInfo_8h_source.html#l00073">ARMBaseInfo.h:73</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html_aa0a5ac19256656534bea2daabdfb947b"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#aa0a5ac19256656534bea2daabdfb947b">llvm::MachineBasicBlock::getSingleSuccessor</a></div><div class="ttdeci">const MachineBasicBlock * getSingleSuccessor() const</div><div class="ttdoc">Return the successor of this block if it has a single successor.</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8cpp_source.html#l00943">MachineBasicBlock.cpp:943</a></div></div>
<div class="ttc" id="aSVEIntrinsicOpts_8cpp_html_a2bb87eb1bcbc74783a83ae945eb8fa36"><div class="ttname"><a href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a></div><div class="ttdeci">INITIALIZE_PASS_DEPENDENCY(DominatorTreeWrapperPass)</div></div>
<div class="ttc" id="alib_2Target_2ARM_2README_8txt_html_ad3a99906764c35b2694ae90fa57744a5"><div class="ttname"><a href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">move</a></div><div class="ttdeci">compiles ldr LCPI1_0 ldr ldr mov lsr tst moveq r1 ldr LCPI1_1 and r0 bx lr It would be better to do something like to fold the shift into the conditional move</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2ARM_2README_8txt_source.html#l00546">README.txt:546</a></div></div>
<div class="ttc" id="aclassllvm_1_1SIInstrInfo_html_a13fdc38a01504ed9a44abd1c9018737d"><div class="ttname"><a href="classllvm_1_1SIInstrInfo.html#a13fdc38a01504ed9a44abd1c9018737d">llvm::SIInstrInfo::isFLATScratch</a></div><div class="ttdeci">static bool isFLATScratch(const MachineInstr &amp;MI)</div><div class="ttdef"><b>Definition:</b> <a href="SIInstrInfo_8h_source.html#l00542">SIInstrInfo.h:542</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMap_html"><div class="ttname"><a href="classllvm_1_1DenseMap.html">llvm::DenseMap</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00714">DenseMap.h:714</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00058">MD5.cpp:58</a></div></div>
<div class="ttc" id="aclassllvm_1_1AMDGPUMachineFunction_html_ab37f1839fd82f8b84b7a2ca87b289c46"><div class="ttname"><a href="classllvm_1_1AMDGPUMachineFunction.html#ab37f1839fd82f8b84b7a2ca87b289c46">llvm::AMDGPUMachineFunction::isEntryFunction</a></div><div class="ttdeci">bool isEntryFunction() const</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUMachineFunction_8h_source.html#l00082">AMDGPUMachineFunction.h:82</a></div></div>
<div class="ttc" id="anamespacellvm_1_1cl_html_a10a041239ae1870cfcc064bfaa79fb65"><div class="ttname"><a href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">llvm::cl::init</a></div><div class="ttdeci">initializer&lt; Ty &gt; init(const Ty &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00445">CommandLine.h:445</a></div></div>
<div class="ttc" id="anamespacellvm_html_a8154638df88e4eaa568b67b23d463dac"><div class="ttname"><a href="namespacellvm.html#a8154638df88e4eaa568b67b23d463dac">llvm::make_early_inc_range</a></div><div class="ttdeci">iterator_range&lt; early_inc_iterator_impl&lt; detail::IterOfRange&lt; RangeT &gt; &gt; &gt; make_early_inc_range(RangeT &amp;&amp;Range)</div><div class="ttdoc">Make a range that does early increment to allow mutation of the underlying range without disrupting i...</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00721">STLExtras.h:721</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoopBase_html_ac3280e7f76f955403fe17eacf126b90d"><div class="ttname"><a href="classllvm_1_1LoopBase.html#ac3280e7f76f955403fe17eacf126b90d">llvm::LoopBase::getLoopPreheader</a></div><div class="ttdeci">BlockT * getLoopPreheader() const</div><div class="ttdoc">If there is a preheader for this loop, return it.</div><div class="ttdef"><b>Definition:</b> <a href="LoopInfoImpl_8h_source.html#l00183">LoopInfoImpl.h:183</a></div></div>
<div class="ttc" id="aSIInsertWaitcnts_8cpp_html_a5afc28dc25e85e7b88c083ef9fc1e9d3"><div class="ttname"><a href="SIInsertWaitcnts_8cpp.html#a5afc28dc25e85e7b88c083ef9fc1e9d3">callWaitsOnFunctionEntry</a></div><div class="ttdeci">static bool callWaitsOnFunctionEntry(const MachineInstr &amp;MI)</div><div class="ttdef"><b>Definition:</b> <a href="SIInsertWaitcnts_8cpp_source.html#l00976">SIInsertWaitcnts.cpp:976</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a0c047f127ed4380a6f383d70bec4eb94"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::find</a></div><div class="ttdeci">iterator find(const_arg_type_t&lt; KeyT &gt; Val)</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00150">DenseMap.h:150</a></div></div>
<div class="ttc" id="aSILowerControlFlow_8cpp_html_a4868c5d81c5ccc98c47aeab6244346a0"><div class="ttname"><a href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a></div><div class="ttdeci">assert(ImpDefSCC.getReg()==AMDGPU::SCC &amp;&amp;ImpDefSCC.isDef())</div></div>
<div class="ttc" id="aTargetLibraryInfo_8cpp_html_aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053"><div class="ttname"><a href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a></div><div class="ttdeci">@ Ptr</div><div class="ttdef"><b>Definition:</b> <a href="TargetLibraryInfo_8cpp_source.html#l00062">TargetLibraryInfo.cpp:62</a></div></div>
<div class="ttc" id="aInlineOrder_8cpp_html_a7ee6f0cb51c3b9056199e9a0001fe8c3ad01fd9b01e9dde8bd3dc247afbfb7218"><div class="ttname"><a href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3ad01fd9b01e9dde8bd3dc247afbfb7218">InlinePriorityMode::ML</a></div><div class="ttdeci">@ ML</div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstrBuilder_html_ad08ed580345a51c50d9477dec1e65818"><div class="ttname"><a href="classllvm_1_1MachineInstrBuilder.html#ad08ed580345a51c50d9477dec1e65818">llvm::MachineInstrBuilder::addReg</a></div><div class="ttdeci">const MachineInstrBuilder &amp; addReg(Register RegNo, unsigned flags=0, unsigned SubReg=0) const</div><div class="ttdoc">Add a new virtual register operand.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstrBuilder_8h_source.html#l00097">MachineInstrBuilder.h:97</a></div></div>
<div class="ttc" id="aMachinePostDominators_8h_html"><div class="ttname"><a href="MachinePostDominators_8h.html">MachinePostDominators.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_html_a2fa58f3e19c6038d01bd699308237c14"><div class="ttname"><a href="namespacellvm_1_1AMDGPU.html#a2fa58f3e19c6038d01bd699308237c14">llvm::AMDGPU::getMIMGInfo</a></div><div class="ttdeci">const LLVM_READONLY MIMGInfo * getMIMGInfo(unsigned Opc)</div></div>
<div class="ttc" id="aclassllvm_1_1MachineOperand_html_ac0035d7c1c860501c877c20e6e93297b"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#ac0035d7c1c860501c877c20e6e93297b">llvm::MachineOperand::getReg</a></div><div class="ttdeci">Register getReg() const</div><div class="ttdoc">getReg - Returns the register number.</div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00369">MachineOperand.h:369</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineFunction_html"><div class="ttname"><a href="classllvm_1_1MachineFunction.html">llvm::MachineFunction</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00258">MachineFunction.h:258</a></div></div>
<div class="ttc" id="aclassllvm_1_1detail_1_1DenseSetImpl_html_a1fbf4d66a9eeaa9ade03e8febee097ee"><div class="ttname"><a href="classllvm_1_1detail_1_1DenseSetImpl.html#a1fbf4d66a9eeaa9ade03e8febee097ee">llvm::detail::DenseSetImpl&lt; ValueT, DenseMap&lt; ValueT, detail::DenseSetEmpty, DenseMapInfo&lt; ValueT &gt;, detail::DenseSetPair&lt; ValueT &gt; &gt;, DenseMapInfo&lt; ValueT &gt; &gt;::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="DenseSet_8h_source.html#l00092">DenseSet.h:92</a></div></div>
<div class="ttc" id="anamespacellvm_html_a67980a8ae101d2fda845eb750ffb1942"><div class="ttname"><a href="namespacellvm.html#a67980a8ae101d2fda845eb750ffb1942">llvm::print</a></div><div class="ttdeci">Printable print(const GCNRegPressure &amp;RP, const GCNSubtarget *ST=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="GCNRegPressure_8cpp_source.html#l00138">GCNRegPressure.cpp:138</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_html_a8adcca4377f5dfb320d2f81a84a9998e"><div class="ttname"><a href="namespacellvm_1_1AMDGPU.html#a8adcca4377f5dfb320d2f81a84a9998e">llvm::AMDGPU::getMIMGBaseOpcodeInfo</a></div><div class="ttdeci">const LLVM_READONLY MIMGBaseOpcodeInfo * getMIMGBaseOpcodeInfo(unsigned BaseOpcode)</div></div>
<div class="ttc" id="astructllvm_1_1enum__iteration__traits_html_a388dfbdc88932be20ae924a6e2942d6b"><div class="ttname"><a href="structllvm_1_1enum__iteration__traits.html#a388dfbdc88932be20ae924a6e2942d6b">llvm::enum_iteration_traits::is_iterable</a></div><div class="ttdeci">static constexpr bool is_iterable</div><div class="ttdef"><b>Definition:</b> <a href="Sequence_8h_source.html#l00100">Sequence.h:100</a></div></div>
<div class="ttc" id="aclassllvm_1_1MapVector_html_a9318649185cfc66ba4b4eb66d5968e00"><div class="ttname"><a href="classllvm_1_1MapVector.html#a9318649185cfc66ba4b4eb66d5968e00">llvm::MapVector::insert</a></div><div class="ttdeci">std::pair&lt; iterator, bool &gt; insert(const std::pair&lt; KeyT, ValueT &gt; &amp;KV)</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00118">MapVector.h:118</a></div></div>
<div class="ttc" id="anamespacellvm_html_a57f2ca0e57f4f7b13f56f9aa16af3e0d"><div class="ttname"><a href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">llvm::min</a></div><div class="ttdeci">Expected&lt; ExpressionValue &gt; min(const ExpressionValue &amp;Lhs, const ExpressionValue &amp;Rhs)</div><div class="ttdef"><b>Definition:</b> <a href="FileCheck_8cpp_source.html#l00357">FileCheck.cpp:357</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisUsage_html_af11a6ebf7ab3c388234cb6d5378439a3"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#af11a6ebf7ab3c388234cb6d5378439a3">llvm::AnalysisUsage::setPreservesCFG</a></div><div class="ttdeci">void setPreservesCFG()</div><div class="ttdoc">This function should be called by the pass, iff they do not:</div><div class="ttdef"><b>Definition:</b> <a href="Pass_8cpp_source.html#l00265">Pass.cpp:265</a></div></div>
<div class="ttc" id="aclassllvm_1_1StringRef_html"><div class="ttname"><a href="classllvm_1_1StringRef.html">llvm::StringRef</a></div><div class="ttdoc">StringRef - Represent a constant reference to a string, i.e.</div><div class="ttdef"><b>Definition:</b> <a href="StringRef_8h_source.html#l00050">StringRef.h:50</a></div></div>
<div class="ttc" id="aAMDGPU_8h_html"><div class="ttname"><a href="AMDGPU_8h.html">AMDGPU.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstr_html_a0363204b5fbab08a46f5a7cd7f376f78"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a0363204b5fbab08a46f5a7cd7f376f78">llvm::MachineInstr::getOpcode</a></div><div class="ttdeci">unsigned getOpcode() const</div><div class="ttdoc">Returns the opcode of this MachineInstr.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00516">MachineInstr.h:516</a></div></div>
<div class="ttc" id="aSupport_2ErrorHandling_8h_html_ace243f5c25697a1107cce46626b3dc94"><div class="ttname"><a href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a></div><div class="ttdeci">#define llvm_unreachable(msg)</div><div class="ttdoc">Marks that the current location is not supposed to be reachable.</div><div class="ttdef"><b>Definition:</b> <a href="Support_2ErrorHandling_8h_source.html#l00143">ErrorHandling.h:143</a></div></div>
<div class="ttc" id="aclassllvm_1_1detail_1_1DenseSetImpl_html_ad409c2de8502b94c8a0b1193307c63b6"><div class="ttname"><a href="classllvm_1_1detail_1_1DenseSetImpl.html#ad409c2de8502b94c8a0b1193307c63b6">llvm::detail::DenseSetImpl&lt; ValueT, DenseMap&lt; ValueT, detail::DenseSetEmpty, DenseMapInfo&lt; ValueT &gt;, detail::DenseSetPair&lt; ValueT &gt; &gt;, DenseMapInfo&lt; ValueT &gt; &gt;::contains</a></div><div class="ttdeci">bool contains(const_arg_type_t&lt; ValueT &gt; V) const</div><div class="ttdoc">Check if the set contains the given element.</div><div class="ttdef"><b>Definition:</b> <a href="DenseSet_8h_source.html#l00185">DenseSet.h:185</a></div></div>
<div class="ttc" id="aclassllvm_1_1ilist__node__impl_html_af719fc783be6589465137d997701a432"><div class="ttname"><a href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">llvm::ilist_node_impl::getIterator</a></div><div class="ttdeci">self_iterator getIterator()</div><div class="ttdef"><b>Definition:</b> <a href="ilist__node_8h_source.html#l00082">ilist_node.h:82</a></div></div>
<div class="ttc" id="aAArch64SLSHardening_8cpp_html_ad467c4ab9119043f9b7750ab986be61a"><div class="ttname"><a href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a></div><div class="ttdeci">MachineBasicBlock MachineBasicBlock::iterator DebugLoc DL</div><div class="ttdef"><b>Definition:</b> <a href="AArch64SLSHardening_8cpp_source.html#l00076">AArch64SLSHardening.cpp:76</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstr_html_ab419785650ef9728b5305d220179017c"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#ab419785650ef9728b5305d220179017c">llvm::MachineInstr::print</a></div><div class="ttdeci">void print(raw_ostream &amp;OS, bool IsStandalone=true, bool SkipOpers=false, bool SkipDebugLoc=false, bool AddNewLine=true, const TargetInstrInfo *TII=nullptr) const</div><div class="ttdoc">Print this MI to OS.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8cpp_source.html#l01576">MachineInstr.cpp:1576</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineOperand_html_a75eb135014670ce946e78739cdc9b51b"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#a75eb135014670ce946e78739cdc9b51b">llvm::MachineOperand::isDef</a></div><div class="ttdeci">bool isDef() const</div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00384">MachineOperand.h:384</a></div></div>
<div class="ttc" id="aclassllvm_1_1SIInstrInfo_html_a8616d2d8f4c04005569e89bcfe67e421"><div class="ttname"><a href="classllvm_1_1SIInstrInfo.html#a8616d2d8f4c04005569e89bcfe67e421">llvm::SIInstrInfo::isMUBUF</a></div><div class="ttdeci">static bool isMUBUF(const MachineInstr &amp;MI)</div><div class="ttdef"><b>Definition:</b> <a href="SIInstrInfo_8h_source.html#l00466">SIInstrInfo.h:466</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstr_html_a002fd916e7206e01d512eeb06d405cf0"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a002fd916e7206e01d512eeb06d405cf0">llvm::MachineInstr::getParent</a></div><div class="ttdeci">const MachineBasicBlock * getParent() const</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00313">MachineInstr.h:313</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a99f811d53704275b4158c62a2dd138d9"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a99f811d53704275b4158c62a2dd138d9">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::insert</a></div><div class="ttdeci">std::pair&lt; iterator, bool &gt; insert(const std::pair&lt; KeyT, ValueT &gt; &amp;KV)</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00207">DenseMap.h:207</a></div></div>
<div class="ttc" id="aSampleProfWriter_8cpp_html_ac5f3689931c7238da06ba00cf1002c62"><div class="ttname"><a href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a></div><div class="ttdeci">raw_pwrite_stream &amp; OS</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfWriter_8cpp_source.html#l00053">SampleProfWriter.cpp:53</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachinePostDominatorTree_html"><div class="ttname"><a href="classllvm_1_1MachinePostDominatorTree.html">llvm::MachinePostDominatorTree</a></div><div class="ttdoc">MachinePostDominatorTree - an analysis pass wrapper for DominatorTree used to compute the post-domina...</div><div class="ttdef"><b>Definition:</b> <a href="MachinePostDominators_8h_source.html#l00027">MachinePostDominators.h:27</a></div></div>
<div class="ttc" id="aAArch64AdvSIMDScalarPass_8cpp_html_aacd2ab195054a3e6a74bfbb9d5d571c8"><div class="ttname"><a href="AArch64AdvSIMDScalarPass_8cpp.html#aacd2ab195054a3e6a74bfbb9d5d571c8">MRI</a></div><div class="ttdeci">unsigned const MachineRegisterInfo * MRI</div><div class="ttdef"><b>Definition:</b> <a href="AArch64AdvSIMDScalarPass_8cpp_source.html#l00105">AArch64AdvSIMDScalarPass.cpp:105</a></div></div>
<div class="ttc" id="aclassllvm_1_1MapVector_html_a0881334358ff6ff7ff8cea5562c7988e"><div class="ttname"><a href="classllvm_1_1MapVector.html#a0881334358ff6ff7ff8cea5562c7988e">llvm::MapVector::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00072">MapVector.h:72</a></div></div>
<div class="ttc" id="aAArch64SLSHardening_8cpp_html_a5958512eae2979bd2eb383977996a600"><div class="ttname"><a href="AArch64SLSHardening_8cpp.html#a5958512eae2979bd2eb383977996a600">MBB</a></div><div class="ttdeci">MachineBasicBlock &amp; MBB</div><div class="ttdef"><b>Definition:</b> <a href="AArch64SLSHardening_8cpp_source.html#l00074">AArch64SLSHardening.cpp:74</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_html_a538a5f491696e8b8ef0987e3aaedbb37"><div class="ttname"><a href="namespacellvm_1_1AMDGPU.html#a538a5f491696e8b8ef0987e3aaedbb37">llvm::AMDGPU::encodeWaitcnt</a></div><div class="ttdeci">unsigned encodeWaitcnt(const IsaVersion &amp;Version, unsigned Vmcnt, unsigned Expcnt, unsigned Lgkmcnt)</div><div class="ttdoc">Encodes Vmcnt, Expcnt and Lgkmcnt into Waitcnt for given isa Version.</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUBaseInfo_8cpp_source.html#l01319">AMDGPUBaseInfo.cpp:1319</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachinePostDominatorTree_html_a17ffb2f5742f992dd5e6562430918bce"><div class="ttname"><a href="classllvm_1_1MachinePostDominatorTree.html#a17ffb2f5742f992dd5e6562430918bce">llvm::MachinePostDominatorTree::dominates</a></div><div class="ttdeci">bool dominates(const MachineDomTreeNode *A, const MachineDomTreeNode *B) const</div><div class="ttdef"><b>Definition:</b> <a href="MachinePostDominators_8h_source.html#l00054">MachinePostDominators.h:54</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetRegisterInfo_html_a251557179fe64bb09bd7e327c60c6b24"><div class="ttname"><a href="classllvm_1_1TargetRegisterInfo.html#a251557179fe64bb09bd7e327c60c6b24">llvm::TargetRegisterInfo::getRegSizeInBits</a></div><div class="ttdeci">unsigned getRegSizeInBits(const TargetRegisterClass &amp;RC) const</div><div class="ttdoc">Return the size in bits of a register from class RC.</div><div class="ttdef"><b>Definition:</b> <a href="TargetRegisterInfo_8h_source.html#l00279">TargetRegisterInfo.h:279</a></div></div>
<div class="ttc" id="aclassuint16__t_html"><div class="ttname"><a href="classuint16__t.html">uint16_t</a></div></div>
<div class="ttc" id="aSIInsertWaitcnts_8cpp_html_a6b9b0a85e71198a4aca6ffd4427fc38e"><div class="ttname"><a href="SIInsertWaitcnts_8cpp.html#a6b9b0a85e71198a4aca6ffd4427fc38e">ForceEmitZeroFlag</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; ForceEmitZeroFlag(&quot;amdgpu-waitcnt-forcezero&quot;, cl::desc(&quot;Force all waitcnt instrs to be emitted as s_waitcnt vmcnt(0) expcnt(0) lgkmcnt(0)&quot;), cl::init(false), cl::Hidden)</div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1SendMsg_html_a8594419a4ddfad2c9a79279c490e466d"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">llvm::AMDGPU::SendMsg::Op</a></div><div class="ttdeci">Op</div><div class="ttdef"><b>Definition:</b> <a href="SIDefines_8h_source.html#l00357">SIDefines.h:357</a></div></div>
<div class="ttc" id="aclassllvm_1_1ilist__iterator_html"><div class="ttname"><a href="classllvm_1_1ilist__iterator.html">llvm::ilist_iterator</a></div><div class="ttdoc">Iterator for intrusive lists based on ilist_node.</div><div class="ttdef"><b>Definition:</b> <a href="ilist__iterator_8h_source.html#l00057">ilist_iterator.h:57</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstr_html_ab96f3235c18e659758517d0532d606c9"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#ab96f3235c18e659758517d0532d606c9">llvm::MachineInstr::mayStore</a></div><div class="ttdeci">bool mayStore(QueryType Type=AnyInBundle) const</div><div class="ttdoc">Return true if this instruction could possibly modify memory.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l01069">MachineInstr.h:1069</a></div></div>
<div class="ttc" id="anamespacellvm_html_a1dbde216a4e94e36451ff3ae695d8405"><div class="ttname"><a href="namespacellvm.html#a1dbde216a4e94e36451ff3ae695d8405">llvm::enum_seq</a></div><div class="ttdeci">auto enum_seq(EnumT Begin, EnumT End)</div><div class="ttdoc">Iterate over an enum type from Begin up to - but not including - End.</div><div class="ttdef"><b>Definition:</b> <a href="Sequence_8h_source.html#l00327">Sequence.h:327</a></div></div>
<div class="ttc" id="aclassllvm_1_1SIInstrInfo_html_a08b830059090a1bb27b14e1e524fdb46"><div class="ttname"><a href="classllvm_1_1SIInstrInfo.html#a08b830059090a1bb27b14e1e524fdb46">llvm::SIInstrInfo::isVMEM</a></div><div class="ttdeci">static bool isVMEM(const MachineInstr &amp;MI)</div><div class="ttdef"><b>Definition:</b> <a href="SIInstrInfo_8h_source.html#l00370">SIInstrInfo.h:370</a></div></div>
<div class="ttc" id="aDebugCounter_8h_html"><div class="ttname"><a href="DebugCounter_8h.html">DebugCounter.h</a></div></div>
<div class="ttc" id="aSIInsertWaitcnts_8cpp_html_a80ca145710cb63f6d1484dacf37a8620"><div class="ttname"><a href="SIInsertWaitcnts_8cpp.html#a80ca145710cb63f6d1484dacf37a8620">isWaitInstr</a></div><div class="ttdeci">static bool isWaitInstr(MachineInstr &amp;Inst)</div><div class="ttdef"><b>Definition:</b> <a href="SIInsertWaitcnts_8cpp_source.html#l01536">SIInsertWaitcnts.cpp:1536</a></div></div>
<div class="ttc" id="aclassllvm_1_1ReversePostOrderTraversal_html"><div class="ttname"><a href="classllvm_1_1ReversePostOrderTraversal.html">llvm::ReversePostOrderTraversal</a></div><div class="ttdef"><b>Definition:</b> <a href="PostOrderIterator_8h_source.html#l00293">PostOrderIterator.h:293</a></div></div>
<div class="ttc" id="aSIInsertWaitcnts_8cpp_html_a76c206acce516598d664c520bf1223a9"><div class="ttname"><a href="SIInsertWaitcnts_8cpp.html#a76c206acce516598d664c520bf1223a9">updateOperandIfDifferent</a></div><div class="ttdeci">static bool updateOperandIfDifferent(MachineInstr &amp;MI, uint16_t OpName, unsigned NewEnc)</div><div class="ttdef"><b>Definition:</b> <a href="SIInsertWaitcnts_8cpp_source.html#l00854">SIInsertWaitcnts.cpp:854</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_html_a906595c44094cbae6a0cca1b1a8b1304"><div class="ttname"><a href="namespacellvm_1_1AMDGPU.html#a906595c44094cbae6a0cca1b1a8b1304">llvm::AMDGPU::getLgkmcntBitMask</a></div><div class="ttdeci">unsigned getLgkmcntBitMask(const IsaVersion &amp;Version)</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUBaseInfo_8cpp_source.html#l01249">AMDGPUBaseInfo.cpp:1249</a></div></div>
<div class="ttc" id="anamespacellvm_1_1RISCVMatInt_html_a3c9bceaea514f7c01e87dcb184d3c972a3b5b9d77cc1b7c08af3a3cdba0c6736c"><div class="ttname"><a href="namespacellvm_1_1RISCVMatInt.html#a3c9bceaea514f7c01e87dcb184d3c972a3b5b9d77cc1b7c08af3a3cdba0c6736c">llvm::RISCVMatInt::Imm</a></div><div class="ttdeci">@ Imm</div><div class="ttdef"><b>Definition:</b> <a href="RISCVMatInt_8h_source.html#l00023">RISCVMatInt.h:23</a></div></div>
<div class="ttc" id="aclassllvm_1_1SIInstrInfo_html"><div class="ttname"><a href="classllvm_1_1SIInstrInfo.html">llvm::SIInstrInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="SIInstrInfo_8h_source.html#l00044">SIInstrInfo.h:44</a></div></div>
<div class="ttc" id="aPostOrderIterator_8h_html"><div class="ttname"><a href="PostOrderIterator_8h.html">PostOrderIterator.h</a></div></div>
<div class="ttc" id="aSIInsertWaitcnts_8cpp_html_ab4827b9d3e3811c1e2f5cbe42b5174e3"><div class="ttname"><a href="SIInsertWaitcnts_8cpp.html#ab4827b9d3e3811c1e2f5cbe42b5174e3">mayWriteLDSThroughDMA</a></div><div class="ttdeci">static bool mayWriteLDSThroughDMA(const MachineInstr &amp;MI)</div><div class="ttdef"><b>Definition:</b> <a href="SIInsertWaitcnts_8cpp_source.html#l00543">SIInsertWaitcnts.cpp:543</a></div></div>
<div class="ttc" id="aELFYAML_8cpp_html_a941c34da9850676ce3380813c636cff2"><div class="ttname"><a href="ELFYAML_8cpp.html#a941c34da9850676ce3380813c636cff2">Other</a></div><div class="ttdeci">std::optional&lt; std::vector&lt; StOtherPiece &gt; &gt; Other</div><div class="ttdef"><b>Definition:</b> <a href="ELFYAML_8cpp_source.html#l01260">ELFYAML.cpp:1260</a></div></div>
<div class="ttc" id="aSIInsertWaitcnts_8cpp_html_a12875f783295ef0f67d11ae574bdcfdd"><div class="ttname"><a href="SIInsertWaitcnts_8cpp.html#a12875f783295ef0f67d11ae574bdcfdd">callWaitsOnFunctionReturn</a></div><div class="ttdeci">static bool callWaitsOnFunctionReturn(const MachineInstr &amp;MI)</div><div class="ttdef"><b>Definition:</b> <a href="SIInsertWaitcnts_8cpp_source.html#l00986">SIInsertWaitcnts.cpp:986</a></div></div>
<div class="ttc" id="anamespacellvm_html_a17e04afcf0c5efeb0eb6a9a45287b5e4"><div class="ttname"><a href="namespacellvm.html#a17e04afcf0c5efeb0eb6a9a45287b5e4">llvm::BuildMI</a></div><div class="ttdeci">MachineInstrBuilder BuildMI(MachineFunction &amp;MF, const MIMetadata &amp;MIMD, const MCInstrDesc &amp;MCID)</div><div class="ttdoc">Builder interface. Specify how to create the initial instruction itself.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstrBuilder_8h_source.html#l00357">MachineInstrBuilder.h:357</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPUAS_html_ab1843c6566c95d94d6e36a857b8d2b3fa5b71ba6fa435ec288aba849e113721a7"><div class="ttname"><a href="namespacellvm_1_1AMDGPUAS.html#ab1843c6566c95d94d6e36a857b8d2b3fa5b71ba6fa435ec288aba849e113721a7">llvm::AMDGPUAS::REGION_ADDRESS</a></div><div class="ttdeci">@ REGION_ADDRESS</div><div class="ttdoc">Address space for region memory. (GDS)</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPU_8h_source.html#l00374">AMDGPU.h:374</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html_ab2d91e7bec944efcbc39d8e30644f111"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#ab2d91e7bec944efcbc39d8e30644f111">llvm::MachineBasicBlock::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00309">MachineBasicBlock.h:309</a></div></div>
<div class="ttc" id="aclassllvm_1_1SIInstrInfo_html_a65dcf8264f3f411eed5734a4b1ad7efa"><div class="ttname"><a href="classllvm_1_1SIInstrInfo.html#a65dcf8264f3f411eed5734a4b1ad7efa">llvm::SIInstrInfo::isFLATGlobal</a></div><div class="ttdeci">static bool isFLATGlobal(const MachineInstr &amp;MI)</div><div class="ttdef"><b>Definition:</b> <a href="SIInstrInfo_8h_source.html#l00534">SIInstrInfo.h:534</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1SendMsg_html_a3a326b706ed4c9caaca05063b47c98dbac1f00b8c9ee08df6cb5378168b3e3353"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a3a326b706ed4c9caaca05063b47c98dbac1f00b8c9ee08df6cb5378168b3e3353">llvm::AMDGPU::SendMsg::ID_GS_DONE_PreGFX11</a></div><div class="ttdeci">@ ID_GS_DONE_PreGFX11</div><div class="ttdef"><b>Definition:</b> <a href="SIDefines_8h_source.html#l00331">SIDefines.h:331</a></div></div>
<div class="ttc" id="aclassllvm_1_1SIInstrInfo_html_ade8d533000b775c514d9ac189b66c3a5"><div class="ttname"><a href="classllvm_1_1SIInstrInfo.html#ade8d533000b775c514d9ac189b66c3a5">llvm::SIInstrInfo::isVALU</a></div><div class="ttdeci">static bool isVALU(const MachineInstr &amp;MI)</div><div class="ttdef"><b>Definition:</b> <a href="SIInstrInfo_8h_source.html#l00362">SIInstrInfo.h:362</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstr_html_a432824f0975bb863478bf4ef3a5df258"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a432824f0975bb863478bf4ef3a5df258">llvm::MachineInstr::getNumOperands</a></div><div class="ttdeci">unsigned getNumOperands() const</div><div class="ttdoc">Retuns the total number of operands.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00519">MachineInstr.h:519</a></div></div>
<div class="ttc" id="aclassllvm_1_1SIMachineFunctionInfo_html"><div class="ttname"><a href="classllvm_1_1SIMachineFunctionInfo.html">llvm::SIMachineFunctionInfo</a></div><div class="ttdoc">This class keeps track of the SPI_SP_INPUT_ADDR config register, which tells the hardware which inter...</div><div class="ttdef"><b>Definition:</b> <a href="SIMachineFunctionInfo_8h_source.html#l00358">SIMachineFunctionInfo.h:358</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPUAS_html_ab1843c6566c95d94d6e36a857b8d2b3faaa1e27e4fc68e5706a4b7bbaed447c14"><div class="ttname"><a href="namespacellvm_1_1AMDGPUAS.html#ab1843c6566c95d94d6e36a857b8d2b3faaa1e27e4fc68e5706a4b7bbaed447c14">llvm::AMDGPUAS::FLAT_ADDRESS</a></div><div class="ttdeci">@ FLAT_ADDRESS</div><div class="ttdoc">Address space for flat memory.</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPU_8h_source.html#l00372">AMDGPU.h:372</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstr_html_ae268a410689383a83e98b5e83296e38a"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#ae268a410689383a83e98b5e83296e38a">llvm::MachineInstr::memoperands</a></div><div class="ttdeci">ArrayRef&lt; MachineMemOperand * &gt; memoperands() const</div><div class="ttdoc">Access to memory operands of the instruction.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00713">MachineInstr.h:713</a></div></div>
<div class="ttc" id="ablake3__impl_8h_html_a78823051d1dad34b9b3d8120112e674d"><div class="ttname"><a href="blake3__impl_8h.html#a78823051d1dad34b9b3d8120112e674d">IV</a></div><div class="ttdeci">static const uint32_t IV[8]</div><div class="ttdef"><b>Definition:</b> <a href="blake3__impl_8h_source.html#l00077">blake3_impl.h:77</a></div></div>
<div class="ttc" id="aclassllvm_1_1FunctionPass_html"><div class="ttname"><a href="classllvm_1_1FunctionPass.html">llvm::FunctionPass</a></div><div class="ttdoc">FunctionPass class - This class is used to implement most global optimizations.</div><div class="ttdef"><b>Definition:</b> <a href="Pass_8h_source.html#l00308">Pass.h:308</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1Exp_html_af7592dc94276d1958420bcfb414b6998a6a774a598f798bc6a057d9a88a1427c0"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1Exp.html#af7592dc94276d1958420bcfb414b6998a6a774a598f798bc6a057d9a88a1427c0">llvm::AMDGPU::Exp::ET_PARAM31</a></div><div class="ttdeci">@ ET_PARAM31</div><div class="ttdef"><b>Definition:</b> <a href="SIDefines_8h_source.html#l00881">SIDefines.h:881</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisUsage_html_ae5c60fd282ee894c87ea02c3f0fcb6d0"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">llvm::AnalysisUsage::addRequired</a></div><div class="ttdeci">AnalysisUsage &amp; addRequired()</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00075">PassAnalysisSupport.h:75</a></div></div>
<div class="ttc" id="astructllvm_1_1AMDGPU_1_1Waitcnt_html_a679b4910131f57ac1d61dfa0a209df01"><div class="ttname"><a href="structllvm_1_1AMDGPU_1_1Waitcnt.html#a679b4910131f57ac1d61dfa0a209df01">llvm::AMDGPU::Waitcnt::allZero</a></div><div class="ttdeci">static Waitcnt allZero(bool HasVscnt)</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUBaseInfo_8h_source.html#l00850">AMDGPUBaseInfo.h:850</a></div></div>
<div class="ttc" id="aclassllvm_1_1DebugLoc_html"><div class="ttname"><a href="classllvm_1_1DebugLoc.html">llvm::DebugLoc</a></div><div class="ttdoc">A debug info location.</div><div class="ttdef"><b>Definition:</b> <a href="DebugLoc_8h_source.html#l00033">DebugLoc.h:33</a></div></div>
<div class="ttc" id="aclassllvm_1_1SIInstrInfo_html_adc3333d2d5974f4068df84f8706fc7d2"><div class="ttname"><a href="classllvm_1_1SIInstrInfo.html#adc3333d2d5974f4068df84f8706fc7d2">llvm::SIInstrInfo::isFLAT</a></div><div class="ttdeci">static bool isFLAT(const MachineInstr &amp;MI)</div><div class="ttdef"><b>Definition:</b> <a href="SIInstrInfo_8h_source.html#l00518">SIInstrInfo.h:518</a></div></div>
<div class="ttc" id="astructllvm_1_1cl_1_1desc_html"><div class="ttname"><a href="structllvm_1_1cl_1_1desc.html">llvm::cl::desc</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00411">CommandLine.h:411</a></div></div>
<div class="ttc" id="aclassllvm_1_1SIInstrInfo_html_a5b2aaf80981b29494436f2b18a604e1c"><div class="ttname"><a href="classllvm_1_1SIInstrInfo.html#a5b2aaf80981b29494436f2b18a604e1c">llvm::SIInstrInfo::isLDSDIR</a></div><div class="ttdeci">static bool isLDSDIR(const MachineInstr &amp;MI)</div><div class="ttdef"><b>Definition:</b> <a href="SIInstrInfo_8h_source.html#l00694">SIInstrInfo.h:694</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstr_html_ac2421adbb9996e1b15f03a8abb6c70a8"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#ac2421adbb9996e1b15f03a8abb6c70a8">llvm::MachineInstr::eraseFromParent</a></div><div class="ttdeci">void eraseFromParent()</div><div class="ttdoc">Unlink 'this' from the containing basic block and delete it.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8cpp_source.html#l00705">MachineInstr.cpp:705</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineInstrBundleIterator_html"><div class="ttname"><a href="classllvm_1_1MachineInstrBundleIterator.html">llvm::MachineInstrBundleIterator&lt; MachineInstr &gt;</a></div></div>
<div class="ttc" id="anamespacellvm_1_1pdb_html_a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2"><div class="ttname"><a href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2">llvm::pdb::PDB_SymType::Block</a></div><div class="ttdeci">@ Block</div></div>
<div class="ttc" id="aInitializePasses_8h_html"><div class="ttname"><a href="InitializePasses_8h.html">InitializePasses.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html"><div class="ttname"><a href="classllvm_1_1Value.html">llvm::Value</a></div><div class="ttdoc">LLVM Value Representation.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00074">Value.h:74</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html_acbc921830578e2741be6549db716c0ce"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#acbc921830578e2741be6549db716c0ce">llvm::MachineBasicBlock::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00311">MachineBasicBlock.h:311</a></div></div>
<div class="ttc" id="aAMDGPUBaseInfo_8h_html"><div class="ttname"><a href="AMDGPUBaseInfo_8h.html">AMDGPUBaseInfo.h</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 7 2023 10:10:13 for LLVM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
