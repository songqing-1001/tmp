<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: lib/CodeGen/CodeGenPrepare.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LLVM
   &#160;<span id="projectnumber">17.0.0git</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_1e8ad0574bd6e387992681ee57691a07.html">CodeGen</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">CodeGenPrepare.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="CodeGenPrepare_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- CodeGenPrepare.cpp - Prepare a function for code generation --------===//</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// See https://llvm.org/LICENSE.txt for license information.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// This pass munges the code in the input function to better prepare it for</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// SelectionDAG-based code generation. This works around limitations in it&#39;s</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// basic-block-at-a-time approach. It should eventually be removed.</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160; </div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="APInt_8h.html">llvm/ADT/APInt.h</a>&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ArrayRef_8h.html">llvm/ADT/ArrayRef.h</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DenseMap_8h.html">llvm/ADT/DenseMap.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MapVector_8h.html">llvm/ADT/MapVector.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="PointerIntPair_8h.html">llvm/ADT/PointerIntPair.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="STLExtras_8h.html">llvm/ADT/STLExtras.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallPtrSet_8h.html">llvm/ADT/SmallPtrSet.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallVector_8h.html">llvm/ADT/SmallVector.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Statistic_8h.html">llvm/ADT/Statistic.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BlockFrequencyInfo_8h.html">llvm/Analysis/BlockFrequencyInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BranchProbabilityInfo_8h.html">llvm/Analysis/BranchProbabilityInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InstructionSimplify_8h.html">llvm/Analysis/InstructionSimplify.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="LoopInfo_8h.html">llvm/Analysis/LoopInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ProfileSummaryInfo_8h.html">llvm/Analysis/ProfileSummaryInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetLibraryInfo_8h.html">llvm/Analysis/TargetLibraryInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetTransformInfo_8h.html">llvm/Analysis/TargetTransformInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ValueTracking_8h.html">llvm/Analysis/ValueTracking.h</a>&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="VectorUtils_8h.html">llvm/Analysis/VectorUtils.h</a>&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CodeGen_2Analysis_8h.html">llvm/CodeGen/Analysis.h</a>&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BasicBlockSectionsProfileReader_8h.html">llvm/CodeGen/BasicBlockSectionsProfileReader.h</a>&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ISDOpcodes_8h.html">llvm/CodeGen/ISDOpcodes.h</a>&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SelectionDAGNodes_8h.html">llvm/CodeGen/SelectionDAGNodes.h</a>&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetLowering_8h.html">llvm/CodeGen/TargetLowering.h</a>&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetPassConfig_8h.html">llvm/CodeGen/TargetPassConfig.h</a>&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetSubtargetInfo_8h.html">llvm/CodeGen/TargetSubtargetInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ValueTypes_8h.html">llvm/CodeGen/ValueTypes.h</a>&quot;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;llvm/Config/llvm-config.h&quot;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Argument_8h.html">llvm/IR/Argument.h</a>&quot;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Attributes_8h.html">llvm/IR/Attributes.h</a>&quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BasicBlock_8h.html">llvm/IR/BasicBlock.h</a>&quot;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constant_8h.html">llvm/IR/Constant.h</a>&quot;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constants_8h.html">llvm/IR/Constants.h</a>&quot;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DataLayout_8h.html">llvm/IR/DataLayout.h</a>&quot;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IR_2DebugInfo_8h.html">llvm/IR/DebugInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DerivedTypes_8h.html">llvm/IR/DerivedTypes.h</a>&quot;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Dominators_8h.html">llvm/IR/Dominators.h</a>&quot;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Function_8h.html">llvm/IR/Function.h</a>&quot;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="GetElementPtrTypeIterator_8h.html">llvm/IR/GetElementPtrTypeIterator.h</a>&quot;</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="GlobalValue_8h.html">llvm/IR/GlobalValue.h</a>&quot;</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="GlobalVariable_8h.html">llvm/IR/GlobalVariable.h</a>&quot;</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IRBuilder_8h.html">llvm/IR/IRBuilder.h</a>&quot;</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InlineAsm_8h.html">llvm/IR/InlineAsm.h</a>&quot;</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InstrTypes_8h.html">llvm/IR/InstrTypes.h</a>&quot;</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IR_2Instruction_8h.html">llvm/IR/Instruction.h</a>&quot;</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Instructions_8h.html">llvm/IR/Instructions.h</a>&quot;</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IntrinsicInst_8h.html">llvm/IR/IntrinsicInst.h</a>&quot;</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Intrinsics_8h.html">llvm/IR/Intrinsics.h</a>&quot;</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &quot;llvm/IR/IntrinsicsAArch64.h&quot;</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="LLVMContext_8h.html">llvm/IR/LLVMContext.h</a>&quot;</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MDBuilder_8h.html">llvm/IR/MDBuilder.h</a>&quot;</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Module_8h.html">llvm/IR/Module.h</a>&quot;</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Operator_8h.html">llvm/IR/Operator.h</a>&quot;</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="PatternMatch_8h.html">llvm/IR/PatternMatch.h</a>&quot;</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ProfDataUtils_8h.html">llvm/IR/ProfDataUtils.h</a>&quot;</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Statepoint_8h.html">llvm/IR/Statepoint.h</a>&quot;</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Type_8h.html">llvm/IR/Type.h</a>&quot;</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Use_8h.html">llvm/IR/Use.h</a>&quot;</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="User_8h.html">llvm/IR/User.h</a>&quot;</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Value_8h.html">llvm/IR/Value.h</a>&quot;</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ValueHandle_8h.html">llvm/IR/ValueHandle.h</a>&quot;</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ValueMap_8h.html">llvm/IR/ValueMap.h</a>&quot;</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InitializePasses_8h.html">llvm/InitializePasses.h</a>&quot;</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Pass_8h.html">llvm/Pass.h</a>&quot;</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BlockFrequency_8h.html">llvm/Support/BlockFrequency.h</a>&quot;</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BranchProbability_8h.html">llvm/Support/BranchProbability.h</a>&quot;</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Casting_8h.html">llvm/Support/Casting.h</a>&quot;</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CommandLine_8h.html">llvm/Support/CommandLine.h</a>&quot;</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Compiler_8h.html">llvm/Support/Compiler.h</a>&quot;</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Debug_8h.html">llvm/Support/Debug.h</a>&quot;</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Support_2ErrorHandling_8h.html">llvm/Support/ErrorHandling.h</a>&quot;</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineValueType_8h.html">llvm/Support/MachineValueType.h</a>&quot;</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MathExtras_8h.html">llvm/Support/MathExtras.h</a>&quot;</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="raw__ostream_8h.html">llvm/Support/raw_ostream.h</a>&quot;</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Target_2TargetMachine_8h.html">llvm/Target/TargetMachine.h</a>&quot;</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetOptions_8h.html">llvm/Target/TargetOptions.h</a>&quot;</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BasicBlockUtils_8h.html">llvm/Transforms/Utils/BasicBlockUtils.h</a>&quot;</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BypassSlowDivision_8h.html">llvm/Transforms/Utils/BypassSlowDivision.h</a>&quot;</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Transforms_2Utils_2Local_8h.html">llvm/Transforms/Utils/Local.h</a>&quot;</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SimplifyLibCalls_8h.html">llvm/Transforms/Utils/SimplifyLibCalls.h</a>&quot;</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SizeOpts_8h.html">llvm/Transforms/Utils/SizeOpts.h</a>&quot;</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="preprocessor">#include &lt;cstdint&gt;</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">#include &lt;iterator&gt;</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="preprocessor">#include &lt;limits&gt;</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="preprocessor">#include &lt;optional&gt;</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="preprocessor">#include &lt;utility&gt;</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm_1_1PatternMatch.html">llvm::PatternMatch</a>;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160; </div>
<div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">  108</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;codegenprepare&quot;</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160; </div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumBlocksElim, <span class="stringliteral">&quot;Number of blocks eliminated&quot;</span>);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumPHIsElim, <span class="stringliteral">&quot;Number of trivial PHIs eliminated&quot;</span>);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumGEPsElim, <span class="stringliteral">&quot;Number of GEPs converted to casts&quot;</span>);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumCmpUses, <span class="stringliteral">&quot;Number of uses of Cmp expressions replaced with uses of &quot;</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                      <span class="stringliteral">&quot;sunken Cmps&quot;</span>);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumCastUses, <span class="stringliteral">&quot;Number of uses of Cast expressions replaced with uses &quot;</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                       <span class="stringliteral">&quot;of sunken Casts&quot;</span>);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumMemoryInsts, <span class="stringliteral">&quot;Number of memory instructions whose address &quot;</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                          <span class="stringliteral">&quot;computations were sunk&quot;</span>);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumMemoryInstsPhiCreated,</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;          <span class="stringliteral">&quot;Number of phis created when address &quot;</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;          <span class="stringliteral">&quot;computations were sunk to memory instructions&quot;</span>);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumMemoryInstsSelectCreated,</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;          <span class="stringliteral">&quot;Number of select created when address &quot;</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;          <span class="stringliteral">&quot;computations were sunk to memory instructions&quot;</span>);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumExtsMoved, <span class="stringliteral">&quot;Number of [s|z]ext instructions combined with loads&quot;</span>);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumExtUses, <span class="stringliteral">&quot;Number of uses of [s|z]ext instructions optimized&quot;</span>);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumAndsAdded,</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;          <span class="stringliteral">&quot;Number of and mask instructions added to form ext loads&quot;</span>);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumAndUses, <span class="stringliteral">&quot;Number of uses of and mask instructions optimized&quot;</span>);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumRetsDup, <span class="stringliteral">&quot;Number of return instructions duplicated&quot;</span>);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumDbgValueMoved, <span class="stringliteral">&quot;Number of debug value instructions moved&quot;</span>);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumSelectsExpanded, <span class="stringliteral">&quot;Number of selects turned into branches&quot;</span>);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumStoreExtractExposed, <span class="stringliteral">&quot;Number of store(extractelement) exposed&quot;</span>);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160; </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="CodeGenPrepare_8cpp.html#ae51b73b67e301b063abfdd618fc6537e">DisableBranchOpts</a>(</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="stringliteral">&quot;disable-cgp-branch-opts&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Disable branch optimizations in CodeGenPrepare&quot;</span>));</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <a class="code" href="CodeGenPrepare_8cpp.html#a96b02d52f9489e0bca9760578509f491">DisableGCOpts</a>(<span class="stringliteral">&quot;disable-cgp-gc-opts&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                  <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Disable GC optimizations in CodeGenPrepare&quot;</span>));</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <a class="code" href="CodeGenPrepare_8cpp.html#a18ea06b4e195aedc9dbd091d60d74365">DisableSelectToBranch</a>(<span class="stringliteral">&quot;disable-cgp-select2branch&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                          <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                          <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Disable select to branch conversion.&quot;</span>));</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160; </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <a class="code" href="CodeGenPrepare_8cpp.html#a715438acc8712570460df3f9458dbaad">AddrSinkUsingGEPs</a>(<span class="stringliteral">&quot;addr-sink-using-gep&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>),</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                      <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Address sinking in CGP using GEPs.&quot;</span>));</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160; </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <a class="code" href="CodeGenPrepare_8cpp.html#ab578df6035c026da33776b9367923c61">EnableAndCmpSinking</a>(<span class="stringliteral">&quot;enable-andcmp-sinking&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>),</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                        <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Enable sinkinig and/cmp into branches.&quot;</span>));</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="CodeGenPrepare_8cpp.html#adf834c332066239424a2f713b2fd4a7f">DisableStoreExtract</a>(</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="stringliteral">&quot;disable-cgp-store-extract&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Disable store(extract) optimizations in CodeGenPrepare&quot;</span>));</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="CodeGenPrepare_8cpp.html#ad5b8edf88f1987d45851832bd84b53eb">StressStoreExtract</a>(</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="stringliteral">&quot;stress-cgp-store-extract&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Stress test store(extract) optimizations in CodeGenPrepare&quot;</span>));</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160; </div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="CodeGenPrepare_8cpp.html#a0e4302b3aa3294121137e2bb0e98a573">DisableExtLdPromotion</a>(</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="stringliteral">&quot;disable-cgp-ext-ld-promotion&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Disable ext(promotable(ld)) -&gt; promoted(ext(ld)) optimization in &quot;</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;             <span class="stringliteral">&quot;CodeGenPrepare&quot;</span>));</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160; </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="CodeGenPrepare_8cpp.html#abeca3461f7b80e8fac13a7757cc44453">StressExtLdPromotion</a>(</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="stringliteral">&quot;stress-cgp-ext-ld-promotion&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Stress test ext(promotable(ld)) -&gt; promoted(ext(ld)) &quot;</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;             <span class="stringliteral">&quot;optimization in CodeGenPrepare&quot;</span>));</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160; </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="CodeGenPrepare_8cpp.html#af6beea189959393ea5d461cf614e445e">DisablePreheaderProtect</a>(</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="stringliteral">&quot;disable-preheader-prot&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Disable protection against removing loop preheaders&quot;</span>));</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160; </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="CodeGenPrepare_8cpp.html#aa76e50d00e6b5c6de7a45f34396cc42b">ProfileGuidedSectionPrefix</a>(</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="stringliteral">&quot;profile-guided-section-prefix&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>),</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Use profile info to add section prefix for hot/cold functions&quot;</span>));</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160; </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="CodeGenPrepare_8cpp.html#ae7a9549676c2d27a72f1696f5911b1ce">ProfileUnknownInSpecialSection</a>(</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="stringliteral">&quot;profile-unknown-in-special-section&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;In profiling mode like sampleFDO, if a function doesn&#39;t have &quot;</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;             <span class="stringliteral">&quot;profile, we cannot tell the function is cold for sure because &quot;</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;             <span class="stringliteral">&quot;it may be a function newly added without ever being sampled. &quot;</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;             <span class="stringliteral">&quot;With the flag enabled, compiler can put such profile unknown &quot;</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;             <span class="stringliteral">&quot;functions into a special section, so runtime system can choose &quot;</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;             <span class="stringliteral">&quot;to handle it in a different way than .text section, to save &quot;</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;             <span class="stringliteral">&quot;RAM for example. &quot;</span>));</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160; </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="CodeGenPrepare_8cpp.html#a857270a0b6ecf873b6c96b80ecb08702">BBSectionsGuidedSectionPrefix</a>(</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="stringliteral">&quot;bbsections-guided-section-prefix&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>),</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Use the basic-block-sections profile to determine the text &quot;</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;             <span class="stringliteral">&quot;section prefix for hot functions. Functions with &quot;</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;             <span class="stringliteral">&quot;basic-block-sections profile will be placed in `.text.hot` &quot;</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;             <span class="stringliteral">&quot;regardless of their FDO profile info. Other functions won&#39;t be &quot;</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;             <span class="stringliteral">&quot;impacted, i.e., their prefixes will be decided by FDO/sampleFDO &quot;</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;             <span class="stringliteral">&quot;profiles.&quot;</span>));</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160; </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;unsigned&gt;</a> <a class="code" href="CodeGenPrepare_8cpp.html#a43c1d33c8ac8a552c4119db493f7a681">FreqRatioToSkipMerge</a>(</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="stringliteral">&quot;cgp-freq-ratio-to-skip-merge&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(2),</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Skip merging empty blocks if (frequency of empty block) / &quot;</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;             <span class="stringliteral">&quot;(frequency of destination block) is greater than this ratio&quot;</span>));</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="CodeGenPrepare_8cpp.html#a269866fa58b625676b6b8b53f8e55731">ForceSplitStore</a>(</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="stringliteral">&quot;force-split-store&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Force store splitting no matter what the target query says.&quot;</span>));</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160; </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="CodeGenPrepare_8cpp.html#a3c923449fda41268c1c9825047304eba">EnableTypePromotionMerge</a>(</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="stringliteral">&quot;cgp-type-promotion-merge&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Enable merging of redundant sexts when one is dominating&quot;</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;             <span class="stringliteral">&quot; the other.&quot;</span>),</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>));</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160; </div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="CodeGenPrepare_8cpp.html#a22496210b244839d09594b0a7ca909b5">DisableComplexAddrModes</a>(</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="stringliteral">&quot;disable-complex-addr-modes&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Disables combining addressing modes with different parts &quot;</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;             <span class="stringliteral">&quot;in optimizeMemoryInst.&quot;</span>));</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160; </div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <a class="code" href="CodeGenPrepare_8cpp.html#a9743916d4ba6931ccdd9500a52a31eca">AddrSinkNewPhis</a>(<span class="stringliteral">&quot;addr-sink-new-phis&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Allow creation of Phis in Address sinking.&quot;</span>));</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160; </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="CodeGenPrepare_8cpp.html#aabbaf3d93d626617b19c4b5cac455e3b">AddrSinkNewSelects</a>(</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="stringliteral">&quot;addr-sink-new-select&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>),</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Allow creation of selects in Address sinking.&quot;</span>));</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160; </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="CodeGenPrepare_8cpp.html#a091230f607eef4cbb3383be2caaf0bbc">AddrSinkCombineBaseReg</a>(</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="stringliteral">&quot;addr-sink-combine-base-reg&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>),</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Allow combining of BaseReg field in Address sinking.&quot;</span>));</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160; </div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="CodeGenPrepare_8cpp.html#a2c270937482046b153d9f2664a334472">AddrSinkCombineBaseGV</a>(</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="stringliteral">&quot;addr-sink-combine-base-gv&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>),</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Allow combining of BaseGV field in Address sinking.&quot;</span>));</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="CodeGenPrepare_8cpp.html#ae698328bd40b02d91f42a2d0cc2f4c27">AddrSinkCombineBaseOffs</a>(</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="stringliteral">&quot;addr-sink-combine-base-offs&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>),</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Allow combining of BaseOffs field in Address sinking.&quot;</span>));</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160; </div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="CodeGenPrepare_8cpp.html#a267b57299445dea412bcda05811ffc3d">AddrSinkCombineScaledReg</a>(</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="stringliteral">&quot;addr-sink-combine-scaled-reg&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>),</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Allow combining of ScaledReg field in Address sinking.&quot;</span>));</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <a class="code" href="CodeGenPrepare_8cpp.html#a1eeb4e7d9888038d9deef80f7d773ab7">EnableGEPOffsetSplit</a>(<span class="stringliteral">&quot;cgp-split-large-offset-gep&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                         <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>),</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                         <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Enable splitting large offset of GEP.&quot;</span>));</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160; </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="CodeGenPrepare_8cpp.html#aff1b7225e361646f1310cc578b2163c3">EnableICMP_EQToICMP_ST</a>(</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="stringliteral">&quot;cgp-icmp-eq2icmp-st&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Enable ICMP_EQ to ICMP_S(L|G)T conversion.&quot;</span>));</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160; </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <a class="code" href="CodeGenPrepare_8cpp.html#afece9241ceab1d00d94c2fcd422cf054">VerifyBFIUpdates</a>(<span class="stringliteral">&quot;cgp-verify-bfi-updates&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                     <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Enable BFI update verification for &quot;</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                              <span class="stringliteral">&quot;CodeGenPrepare.&quot;</span>));</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <a class="code" href="CodeGenPrepare_8cpp.html#a8df3f534fddc483247fee64ac7e0a0f9">OptimizePhiTypes</a>(<span class="stringliteral">&quot;cgp-optimize-phi-types&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">false</span>),</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                     <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Enable converting phi types in CodeGenPrepare&quot;</span>));</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;unsigned&gt;</a></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <a class="code" href="CodeGenPrepare_8cpp.html#a322205ba86118639511028b9577f3273">HugeFuncThresholdInCGPP</a>(<span class="stringliteral">&quot;cgpp-huge-func&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(10000), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                            <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Least BB number of huge function.&quot;</span>));</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160; </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160; </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="keyword">enum</span> ExtType {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  ZeroExtension, <span class="comment">// Zero extension has been seen.</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  SignExtension, <span class="comment">// Sign extension has been seen.</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  BothExtension  <span class="comment">// This extension type is used if we saw sext after</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                 <span class="comment">// ZeroExtension had been set, or if we saw zext after</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                 <span class="comment">// SignExtension had been set. It makes the type</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                 <span class="comment">// information of a promoted instruction invalid.</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;};</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160; </div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="keyword">enum</span> ModifyDT {</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  NotModifyDT, <span class="comment">// Not Modify any DT.</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  ModifyBBDT,  <span class="comment">// Modify the Basic Block Dominator Tree.</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  ModifyInstDT <span class="comment">// Modify the Instruction Dominator in a Basic Block,</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;               <span class="comment">// This usually means we move/delete/insert instruction</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;               <span class="comment">// in a Basic Block. So we should re-iterate instructions</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;               <span class="comment">// in such Basic Block.</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;};</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="keyword">using</span> SetOfInstrs = <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction *, 16&gt;</a>;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="keyword">using</span> TypeIsSExt = <a class="code" href="classllvm_1_1PointerIntPair.html">PointerIntPair&lt;Type *, 2, ExtType&gt;</a>;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="keyword">using</span> InstrToOrigTy = <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Instruction *, TypeIsSExt&gt;</a>;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="keyword">using</span> SExts = <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 16&gt;</a>;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="keyword">using</span> ValueToSExts = <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;Value *, SExts&gt;</a>;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="keyword">class </span>TypePromotionTransaction;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="keyword">class </span>CodeGenPrepare : <span class="keyword">public</span> <a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a> {</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetMachine.html">TargetMachine</a> *<a class="code" href="PassBuilderBindings_8cpp.html#ab76052bb166c65901edb603a3e1f03ab">TM</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetSubtargetInfo.html">TargetSubtargetInfo</a> *SubtargetInfo;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> *TLI = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetRegisterInfo.html">TargetRegisterInfo</a> *<a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> *<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1BasicBlockSectionsProfileReader.html">BasicBlockSectionsProfileReader</a> *BBSectionsProfileReader = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> *TLInfo;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1LoopInfo.html">LoopInfo</a> *LI;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  std::unique_ptr&lt;BlockFrequencyInfo&gt; <a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  std::unique_ptr&lt;BranchProbabilityInfo&gt; BPI;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <a class="code" href="classllvm_1_1ProfileSummaryInfo.html">ProfileSummaryInfo</a> *PSI;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">  /// As we scan instructions optimizing them, this is the next instruction</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">  /// to optimize. Transforms that can invalidate this should update it.</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> CurInstIterator;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">  /// Keeps track of non-local addresses that have been sunk into a block.</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">  /// This allows us to avoid inserting duplicate code for blocks with</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">  /// multiple load/stores of the same address. The usage of WeakTrackingVH</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">  /// enables SunkAddrs to be treated as a cache whose entries can be</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">  /// invalidated if a sunken address computation has been erased.</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1ValueMap.html">ValueMap&lt;Value *, WeakTrackingVH&gt;</a> SunkAddrs;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">  /// Keeps track of all instructions inserted for the current function.</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment"></span>  SetOfInstrs InsertedInsts;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">  /// Keeps track of the type of the related instruction before their</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">  /// promotion for the current function.</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment"></span>  InstrToOrigTy PromotedInsts;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">  /// Keep track of instructions removed during promotion.</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment"></span>  SetOfInstrs RemovedInsts;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">  /// Keep track of sext chains based on their initial value.</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, Instruction *&gt;</a> SeenChainsForSExt;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">  /// Keep track of GEPs accessing the same data structures such as structs or</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">  /// arrays that are candidates to be split later because of their large</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">  /// size.</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;AssertingVH&lt;Value&gt;</a>,</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;AssertingVH&lt;GetElementPtrInst&gt;</a>, int64_t&gt;, 32&gt;&gt;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      LargeOffsetGEPMap;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">  /// Keep track of new GEP base after splitting the GEPs having large offset.</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallSet.html">SmallSet&lt;AssertingVH&lt;Value&gt;</a>, 2&gt; NewGEPBases;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">  /// Map serial numbers to Large offset GEPs.</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;AssertingVH&lt;GetElementPtrInst&gt;</a>, <span class="keywordtype">int</span>&gt; LargeOffsetGEPID;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">  /// Keep track of SExt promoted.</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment"></span>  ValueToSExts ValToSExtendedUses;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">  /// True if the function has the OptSize attribute.</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> OptSize;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">  /// DataLayout for the Function being processed.</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment"></span>  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">  /// Building the dominator tree can be expensive, so we only build it</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">  /// lazily and update it when required.</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment"></span>  std::unique_ptr&lt;DominatorTree&gt; DT;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">  /// If encounter huge function, we need to limit the build time.</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> IsHugeFunc = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">  /// FreshBBs is like worklist, it collected the updated BBs which need</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">  /// to be optimized again.</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">  /// Note: Consider building time in this pass, when a BB updated, we need</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">  /// to insert such BB into FreshBBs for huge function.</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallSet.html">SmallSet&lt;BasicBlock *, 32&gt;</a> FreshBBs;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160; </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>; <span class="comment">// Pass identification, replacement for typeid</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160; </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  CodeGenPrepare() : <a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a>(<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>) {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <a class="code" href="namespacellvm.html#a8f1d94877a9c9ea068af41c5315f5117">initializeCodeGenPreparePass</a>(*<a class="code" href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  }</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160; </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="EntryExitInstrumenter_8cpp.html#a3985f1f39349428d17f0d2b81ebc6349">runOnFunction</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) <span class="keyword">override</span>;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160; </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> getPassName()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> <span class="stringliteral">&quot;CodeGen Prepare&quot;</span>; }</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160; </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <span class="keywordtype">void</span> getAnalysisUsage(<a class="code" href="classllvm_1_1AnalysisUsage.html">AnalysisUsage</a> &amp;AU)<span class="keyword"> const override </span>{</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="comment">// FIXME: When we can selectively preserve passes, preserve the domtree.</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1ProfileSummaryInfoWrapperPass.html">ProfileSummaryInfoWrapperPass</a>&gt;();</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1TargetLibraryInfoWrapperPass.html">TargetLibraryInfoWrapperPass</a>&gt;();</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1TargetPassConfig.html">TargetPassConfig</a>&gt;();</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1TargetTransformInfoWrapperPass.html">TargetTransformInfoWrapperPass</a>&gt;();</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1LoopInfoWrapperPass.html">LoopInfoWrapperPass</a>&gt;();</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#a316c141eb121e46a1de4c395af75eb60">addUsedIfAvailable</a>&lt;<a class="code" href="classllvm_1_1BasicBlockSectionsProfileReader.html">BasicBlockSectionsProfileReader</a>&gt;();</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  }</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160; </div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> F&gt;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="keywordtype">void</span> resetIteratorIfInvalidatedWhileCalling(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> <a class="code" href="include_2llvm_2Demangle_2README_8txt.html#a9d56f6c541a0ab888755f9bc198b8eca">f</a>) {</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="comment">// Substituting can cause recursive simplifications, which can invalidate</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="comment">// our iterator.  Use a WeakTrackingVH to hold onto it in case this</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="comment">// happens.</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *CurValue = &amp;*CurInstIterator;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <a class="code" href="classllvm_1_1WeakTrackingVH.html">WeakTrackingVH</a> IterHandle(CurValue);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160; </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <a class="code" href="include_2llvm_2Demangle_2README_8txt.html#a9d56f6c541a0ab888755f9bc198b8eca">f</a>();</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="comment">// If the iterator instruction was recursively deleted, start over at the</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="comment">// start of the block.</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordflow">if</span> (IterHandle != CurValue) {</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      CurInstIterator = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;begin();</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      SunkAddrs.<a class="code" href="classllvm_1_1ValueMap.html#a49dc44e6a66de10991ee34e1df0d8065">clear</a>();</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    }</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  }</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160; </div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <span class="comment">// Get the DominatorTree, building if necessary.</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;getDT(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keywordflow">if</span> (!DT)</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      DT = std::make_unique&lt;DominatorTree&gt;(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keywordflow">return</span> *DT;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  }</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160; </div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  <span class="keywordtype">void</span> removeAllAssertingVHReferences(<a class="code" href="classllvm_1_1Value.html">Value</a> *V);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keywordtype">bool</span> eliminateAssumptions(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <span class="keywordtype">bool</span> eliminateFallThrough(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="keywordtype">bool</span> eliminateMostlyEmptyBlocks(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *findDestBlockOfMergeableEmptyBlock(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="keywordtype">bool</span> canMergeBlocks(<span class="keyword">const</span> <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *DestBB) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="keywordtype">void</span> eliminateMostlyEmptyBlock(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="keywordtype">bool</span> isMergingEmptyBlockProfitable(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *DestBB,</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                                     <span class="keywordtype">bool</span> isPreheader);</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="keywordtype">bool</span> makeBitReverse(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="ScalarizeMaskedMemIntrin_8cpp.html#a8f3425131aae6ea2275a052284a7c2dc">optimizeBlock</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> &amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, ModifyDT &amp;ModifiedDT);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <span class="keywordtype">bool</span> optimizeInst(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, ModifyDT &amp;ModifiedDT);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="keywordtype">bool</span> optimizeMemoryInst(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *MemoryInst, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, <a class="code" href="classllvm_1_1Type.html">Type</a> *AccessTy,</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                          <span class="keywordtype">unsigned</span> AddrSpace);</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  <span class="keywordtype">bool</span> optimizeGatherScatterInst(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *MemoryInst, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="keywordtype">bool</span> optimizeInlineAsmInst(<a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CS);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="ScalarizeMaskedMemIntrin_8cpp.html#a8839065ea712711c22d6da68b2fb2d64">optimizeCallInst</a>(<a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI, ModifyDT &amp;ModifiedDT);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="keywordtype">bool</span> optimizeExt(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="keywordtype">bool</span> optimizeExtUses(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="keywordtype">bool</span> optimizeLoadExt(<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a>);</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <span class="keywordtype">bool</span> optimizeShiftInst(<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *BO);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="keywordtype">bool</span> optimizeFunnelShift(<a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *Fsh);</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  <span class="keywordtype">bool</span> optimizeSelectInst(<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="keywordtype">bool</span> optimizeShuffleVectorInst(<a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a> *SVI);</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  <span class="keywordtype">bool</span> optimizeSwitchType(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  <span class="keywordtype">bool</span> optimizeSwitchPhiConstants(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <span class="keywordtype">bool</span> optimizeSwitchInst(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  <span class="keywordtype">bool</span> optimizeExtractElementInst(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst);</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <span class="keywordtype">bool</span> dupRetToEnableTailCallOpts(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, ModifyDT &amp;ModifiedDT);</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="keywordtype">bool</span> fixupDbgValue(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <span class="keywordtype">bool</span> placeDbgValues(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  <span class="keywordtype">bool</span> placePseudoProbes(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="keywordtype">bool</span> canFormExtLd(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;MovedExts,</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                    <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *&amp;LI, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *&amp;Inst, <span class="keywordtype">bool</span> HasPromoted);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  <span class="keywordtype">bool</span> tryToPromoteExts(TypePromotionTransaction &amp;TPT,</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                        <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;Exts,</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                        <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;ProfitablyMovedExts,</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                        <span class="keywordtype">unsigned</span> CreatedInstsCost = 0);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="keywordtype">bool</span> mergeSExts(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="keywordtype">bool</span> splitLargeGEPOffsets();</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <span class="keywordtype">bool</span> optimizePhiType(<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *Inst, <a class="code" href="classllvm_1_1SmallPtrSetImpl.html">SmallPtrSetImpl&lt;PHINode *&gt;</a> &amp;Visited,</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                       <a class="code" href="classllvm_1_1SmallPtrSetImpl.html">SmallPtrSetImpl&lt;Instruction *&gt;</a> &amp;DeletedInstrs);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keywordtype">bool</span> optimizePhiTypes(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="keywordtype">bool</span> performAddressTypePromotion(</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *&amp;Inst, <span class="keywordtype">bool</span> AllowPromotionWithoutCommonHeader,</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      <span class="keywordtype">bool</span> HasPromoted, TypePromotionTransaction &amp;TPT,</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;SpeculativelyMovedExts);</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="keywordtype">bool</span> splitBranchCondition(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, ModifyDT &amp;ModifiedDT);</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="keywordtype">bool</span> simplifyOffsetableRelocate(<a class="code" href="classllvm_1_1GCStatepointInst.html">GCStatepointInst</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160; </div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <span class="keywordtype">bool</span> tryToSinkFreeOperands(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="keywordtype">bool</span> replaceMathCmpWithIntrinsic(<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *BO, <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg0, <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg1,</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                                   <a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a> *Cmp, <a class="code" href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IID);</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="keywordtype">bool</span> optimizeCmp(<a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a> *Cmp, ModifyDT &amp;ModifiedDT);</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="keywordtype">bool</span> combineToUSubWithOverflow(<a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a> *Cmp, ModifyDT &amp;ModifiedDT);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="keywordtype">bool</span> combineToUAddWithOverflow(<a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a> *Cmp, ModifyDT &amp;ModifiedDT);</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="keywordtype">void</span> verifyBFIUpdates(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;};</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160; </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46">CodeGenPrepare::ID</a> = 0;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160; </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<a class="code" href="CodeGenPrepare_8cpp.html#a701f96a344afd4a292262cf5e912731d">INITIALIZE_PASS_BEGIN</a>(CodeGenPrepare, <a class="code" href="CodeGenPrepare_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a>,</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                      <span class="stringliteral">&quot;Optimize for code generation&quot;</span>, <span class="keyword">false</span>, <span class="keyword">false</span>)</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<a class="code" href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1BasicBlockSectionsProfileReader.html">BasicBlockSectionsProfileReader</a>)</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<a class="code" href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1LoopInfoWrapperPass.html">LoopInfoWrapperPass</a>)</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<a class="code" href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1ProfileSummaryInfoWrapperPass.html">ProfileSummaryInfoWrapperPass</a>)</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<a class="code" href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1TargetLibraryInfoWrapperPass.html">TargetLibraryInfoWrapperPass</a>)</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<a class="code" href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1TargetPassConfig.html">TargetPassConfig</a>)</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<a class="code" href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1TargetTransformInfoWrapperPass.html">TargetTransformInfoWrapperPass</a>)</div>
<div class="line"><a name="l00485"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#a109eb00135035c7badb12cece015c58d">  485</a></span>&#160;<a class="code" href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a>(CodeGenPrepare, <a class="code" href="CodeGenPrepare_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a>, &quot;Optimize <a class="code" href="lib_2Target_2README_8txt.html#a7df6ed7588301267782c2bd4b7f6899d">for</a> <a class="code" href="README-Thumb_8txt.html#a5d98a8b5139e56ebf0d2ff4cbaa0dc5e">code</a> <a class="code" href="CodeGenPrepare_8cpp.html#a109eb00135035c7badb12cece015c58d">generation</a>&quot;,</div>
<div class="line"><a name="l00486"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#a82626751cd03ec5db2cc4939a10ad956">  486</a></span>&#160;                    <a class="code" href="namespacefalse.html">false</a>, <a class="code" href="namespacefalse.html">false</a>)</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160; </div>
<div class="line"><a name="l00488"></a><span class="lineno"><a class="line" href="namespacellvm.html#ad25a2d6c14dc8997a002861a768e0223">  488</a></span>&#160;<a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a> *<a class="code" href="namespacellvm.html">llvm</a>::<a class="code" href="namespacellvm.html#ad25a2d6c14dc8997a002861a768e0223">createCodeGenPreparePass</a>() { <span class="keywordflow">return</span> <span class="keyword">new</span> CodeGenPrepare(); }</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160; </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="EntryExitInstrumenter_8cpp.html#a3985f1f39349428d17f0d2b81ebc6349">CodeGenPrepare::runOnFunction</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="keywordflow">if</span> (skipFunction(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>))</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160; </div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a> = &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getParent()-&gt;getDataLayout();</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160; </div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <span class="keywordtype">bool</span> EverMadeChange = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="comment">// Clear per function information.</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  InsertedInsts.clear();</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  PromotedInsts.clear();</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  FreshBBs.<a class="code" href="classllvm_1_1SmallSet.html#a76b3fc7c102561fb5210d5151531e409">clear</a>();</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160; </div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <a class="code" href="PassBuilderBindings_8cpp.html#ab76052bb166c65901edb603a3e1f03ab">TM</a> = &amp;getAnalysis&lt;TargetPassConfig&gt;().getTM&lt;<a class="code" href="classllvm_1_1TargetMachine.html">TargetMachine</a>&gt;();</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  SubtargetInfo = <a class="code" href="PassBuilderBindings_8cpp.html#ab76052bb166c65901edb603a3e1f03ab">TM</a>-&gt;getSubtargetImpl(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  TLI = SubtargetInfo-&gt;getTargetLowering();</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a> = SubtargetInfo-&gt;getRegisterInfo();</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  TLInfo = &amp;getAnalysis&lt;TargetLibraryInfoWrapperPass&gt;().getTLI(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a> = &amp;getAnalysis&lt;TargetTransformInfoWrapperPass&gt;().getTTI(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  LI = &amp;getAnalysis&lt;LoopInfoWrapperPass&gt;().getLoopInfo();</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  BPI.reset(<span class="keyword">new</span> <a class="code" href="classllvm_1_1BranchProbabilityInfo.html">BranchProbabilityInfo</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, *LI));</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>.reset(<span class="keyword">new</span> <a class="code" href="classllvm_1_1BlockFrequencyInfo.html">BlockFrequencyInfo</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, *BPI, *LI));</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  PSI = &amp;getAnalysis&lt;ProfileSummaryInfoWrapperPass&gt;().getPSI();</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  BBSectionsProfileReader =</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      getAnalysisIfAvailable&lt;BasicBlockSectionsProfileReader&gt;();</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  OptSize = <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasOptSize();</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <span class="comment">// Use the basic-block-sections profile to promote hot functions to .text.hot</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <span class="comment">// if requested.</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="CodeGenPrepare_8cpp.html#a857270a0b6ecf873b6c96b80ecb08702">BBSectionsGuidedSectionPrefix</a> &amp;&amp; BBSectionsProfileReader &amp;&amp;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      BBSectionsProfileReader-&gt;<a class="code" href="classllvm_1_1BasicBlockSectionsProfileReader.html#a31414298cda30f1d52c965571b4efc75">isFunctionHot</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName())) {</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.setSectionPrefix(<span class="stringliteral">&quot;hot&quot;</span>);</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="CodeGenPrepare_8cpp.html#aa76e50d00e6b5c6de7a45f34396cc42b">ProfileGuidedSectionPrefix</a>) {</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="comment">// The hot attribute overwrites profile count based hotness while profile</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="comment">// counts based hotness overwrite the cold attribute.</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="comment">// This is a conservative behabvior.</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasFnAttribute(Attribute::Hot) ||</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        PSI-&gt;<a class="code" href="classllvm_1_1ProfileSummaryInfo.html#ab390be311440c287f10e3d58db0421b5">isFunctionHotInCallGraph</a>(&amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, *<a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>))</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.setSectionPrefix(<span class="stringliteral">&quot;hot&quot;</span>);</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="comment">// If PSI shows this function is not hot, we will placed the function</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="comment">// into unlikely section if (1) PSI shows this is a cold function, or</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="comment">// (2) the function has a attribute of cold.</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PSI-&gt;<a class="code" href="classllvm_1_1ProfileSummaryInfo.html#abd5d83a44a9a4a18b313168beffd124a">isFunctionColdInCallGraph</a>(&amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, *<a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>) ||</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;             <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasFnAttribute(<a class="code" href="namespacellvm_1_1CallingConv.html#a5b166ae228ebbfdb96736d6022f3feeda94ec9273479164e4aec1d5d91b71dc85">Attribute::Cold</a>))</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.setSectionPrefix(<span class="stringliteral">&quot;unlikely&quot;</span>);</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="CodeGenPrepare_8cpp.html#ae7a9549676c2d27a72f1696f5911b1ce">ProfileUnknownInSpecialSection</a> &amp;&amp; PSI-&gt;<a class="code" href="classllvm_1_1ProfileSummaryInfo.html#a9610274171a85158779e7ee6031d2376">hasPartialSampleProfile</a>() &amp;&amp;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;             PSI-&gt;<a class="code" href="classllvm_1_1ProfileSummaryInfo.html#a215c4f3e485345daeb8e9d68264f388a">isFunctionHotnessUnknown</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>))</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.setSectionPrefix(<span class="stringliteral">&quot;unknown&quot;</span>);</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  }</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment">  /// This optimization identifies DIV instructions that can be</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">  /// profitably bypassed and carried out with a shorter, faster divide.</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment"></span>  <span class="keywordflow">if</span> (!OptSize &amp;&amp; !PSI-&gt;<a class="code" href="classllvm_1_1ProfileSummaryInfo.html#ad7a8ced5ff54962319d57208f5d4a57e">hasHugeWorkingSetSize</a>() &amp;&amp; TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a6ade65d2ea72712ca307ed5d5876dba8">isSlowDivBypassed</a>()) {</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;unsigned int, unsigned int&gt;</a> &amp;BypassWidths =</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a8dd1fd9f6122f09ff0793bf0383d4d2b">getBypassSlowDivWidths</a>();</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = &amp;*<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.begin();</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      <span class="comment">// bypassSlowDivision may create new BBs, but we don&#39;t want to reapply the</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      <span class="comment">// optimization to those blocks.</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Next = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getNextNode();</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      <span class="comment">// F.hasOptSize is already checked in the outer if statement.</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#a3af72f14ea20f2c762c751d2d49e5ea3">llvm::shouldOptimizeForSize</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, PSI, <a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>.get()))</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        EverMadeChange |= <a class="code" href="namespacellvm.html#ac7a11b9f5656e9697ac700a0e57dbb04">bypassSlowDivision</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, BypassWidths);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = Next;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    }</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  }</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160; </div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <span class="comment">// Get rid of @llvm.assume builtins before attempting to eliminate empty</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  <span class="comment">// blocks, since there might be blocks that only contain @llvm.assume calls</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  <span class="comment">// (plus arguments that we can get rid of).</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  EverMadeChange |= eliminateAssumptions(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160; </div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <span class="comment">// Eliminate blocks that contain only PHI nodes and an</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="comment">// unconditional branch.</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  EverMadeChange |= eliminateMostlyEmptyBlocks(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160; </div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  ModifyDT ModifiedDT = ModifyDT::NotModifyDT;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="CodeGenPrepare_8cpp.html#ae51b73b67e301b063abfdd618fc6537e">DisableBranchOpts</a>)</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    EverMadeChange |= splitBranchCondition(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, ModifiedDT);</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160; </div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  <span class="comment">// Split some critical edges where one of the sources is an indirect branch,</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <span class="comment">// to help generate sane code for PHIs involving such edges.</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  EverMadeChange |=</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      <a class="code" href="namespacellvm.html#a502009030bffff8a6992f4e4eb9380f5">SplitIndirectBrCriticalEdges</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <span class="comment">/*IgnoreBlocksWithoutPHI=*/</span><span class="keyword">true</span>);</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160; </div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  <span class="comment">// If we are optimzing huge function, we need to consider the build time.</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  <span class="comment">// Because the basic algorithm&#39;s complex is near O(N!).</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  IsHugeFunc = <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.size() &gt; <a class="code" href="CodeGenPrepare_8cpp.html#a322205ba86118639511028b9577f3273">HugeFuncThresholdInCGPP</a>;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160; </div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <span class="keywordtype">bool</span> FuncIterated = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  <span class="keywordflow">while</span> (MadeChange) {</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    MadeChange = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    DT.reset();</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160; </div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> &amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> : <a class="code" href="namespacellvm.html#a8154638df88e4eaa568b67b23d463dac">llvm::make_early_inc_range</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)) {</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      <span class="keywordflow">if</span> (FuncIterated &amp;&amp; !FreshBBs.<a class="code" href="classllvm_1_1SmallSet.html#ae04ad615dfdd885e85cbddda146787c6">contains</a>(&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>))</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160; </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      ModifyDT ModifiedDTOnIteration = ModifyDT::NotModifyDT;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      <span class="keywordtype">bool</span> Changed = <a class="code" href="ScalarizeMaskedMemIntrin_8cpp.html#a8f3425131aae6ea2275a052284a7c2dc">optimizeBlock</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, ModifiedDTOnIteration);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160; </div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      MadeChange |= Changed;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      <span class="keywordflow">if</span> (IsHugeFunc) {</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <span class="comment">// If the BB is updated, it may still has chance to be optimized.</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        <span class="comment">// This usually happen at sink optimization.</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <span class="comment">// For example:</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        <span class="comment">// bb0：</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        <span class="comment">// %and = and i32 %a, 4</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="comment">// %cmp = icmp eq i32 %and, 0</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <span class="comment">// If the %cmp sink to other BB, the %and will has chance to sink.</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <span class="keywordflow">if</span> (Changed)</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;          FreshBBs.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (FuncIterated)</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;          FreshBBs.<a class="code" href="classllvm_1_1SmallSet.html#a75a2d2ad3b3dce6702750d570ee8f343">erase</a>(&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160; </div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <span class="keywordflow">if</span> (ModifiedDTOnIteration == ModifyDT::ModifyBBDT)</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;          DT.reset();</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <span class="comment">// For small/normal functions, we restart BB iteration if the dominator</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="comment">// tree of the Function was changed.</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        <span class="keywordflow">if</span> (ModifiedDTOnIteration != ModifyDT::NotModifyDT)</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      }</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    }</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="comment">// We have iterated all the BB in the (only work for huge) function.</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    FuncIterated = IsHugeFunc;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160; </div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="CodeGenPrepare_8cpp.html#a3c923449fda41268c1c9825047304eba">EnableTypePromotionMerge</a> &amp;&amp; !ValToSExtendedUses.empty())</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      MadeChange |= mergeSExts(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="keywordflow">if</span> (!LargeOffsetGEPMap.<a class="code" href="classllvm_1_1MapVector.html#a8da97c44f514ad1ae9ccf4518b0f88aa">empty</a>())</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      MadeChange |= splitLargeGEPOffsets();</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    MadeChange |= optimizePhiTypes(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160; </div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="keywordflow">if</span> (MadeChange)</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      eliminateFallThrough(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160; </div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <span class="comment">// Really free removed instructions during promotion.</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : RemovedInsts)</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;deleteValue();</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160; </div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    EverMadeChange |= MadeChange;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    SeenChainsForSExt.<a class="code" href="classllvm_1_1DenseMapBase.html#adf4e7878fc0b3b8dcde545178564190d">clear</a>();</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    ValToSExtendedUses.clear();</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    RemovedInsts.clear();</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    LargeOffsetGEPMap.<a class="code" href="classllvm_1_1MapVector.html#ae091b147039557cf8ce505740e7ff7ac">clear</a>();</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    LargeOffsetGEPID.<a class="code" href="classllvm_1_1DenseMapBase.html#adf4e7878fc0b3b8dcde545178564190d">clear</a>();</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  }</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160; </div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  NewGEPBases.<a class="code" href="classllvm_1_1SmallSet.html#a76b3fc7c102561fb5210d5151531e409">clear</a>();</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  SunkAddrs.<a class="code" href="classllvm_1_1ValueMap.html#a49dc44e6a66de10991ee34e1df0d8065">clear</a>();</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160; </div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="CodeGenPrepare_8cpp.html#ae51b73b67e301b063abfdd618fc6537e">DisableBranchOpts</a>) {</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    MadeChange = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="comment">// Use a set vector to get deterministic iteration order. The order the</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <span class="comment">// blocks are removed may affect whether or not PHI nodes in successors</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="comment">// are removed.</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;BasicBlock *, 8&gt;</a> WorkList;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> &amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> : <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BasicBlock *, 2&gt;</a> Successors(<a class="code" href="namespacellvm.html#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>));</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      MadeChange |= <a class="code" href="namespacellvm.html#a152d8c380cc937c9dceb402ceec943b6">ConstantFoldTerminator</a>(&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      <span class="keywordflow">if</span> (!MadeChange)</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160; </div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ : Successors)</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ad66c4759666aab78529658362b498c74">pred_empty</a>(Succ))</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;          WorkList.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(Succ);</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    }</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160; </div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <span class="comment">// Delete the dead blocks and any of their dead successors.</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    MadeChange |= !WorkList.<a class="code" href="classllvm_1_1SetVector.html#aaf9ee38b9973681c1720aaf03af3a069">empty</a>();</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <span class="keywordflow">while</span> (!WorkList.<a class="code" href="classllvm_1_1SetVector.html#aaf9ee38b9973681c1720aaf03af3a069">empty</a>()) {</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = WorkList.<a class="code" href="classllvm_1_1SetVector.html#a3499f6a24500afba2c318295ad2d2d05">pop_back_val</a>();</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BasicBlock *, 2&gt;</a> Successors(<a class="code" href="namespacellvm.html#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>));</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160; </div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      <a class="code" href="namespacellvm.html#a458b4709ebedccb846a179f1e422265b">DeleteDeadBlock</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160; </div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ : Successors)</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ad66c4759666aab78529658362b498c74">pred_empty</a>(Succ))</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;          WorkList.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(Succ);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    }</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160; </div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <span class="comment">// Merge pairs of basic blocks with unconditional branches, connected by</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="comment">// a single edge.</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <span class="keywordflow">if</span> (EverMadeChange || MadeChange)</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      MadeChange |= eliminateFallThrough(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160; </div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    EverMadeChange |= MadeChange;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  }</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160; </div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="CodeGenPrepare_8cpp.html#a96b02d52f9489e0bca9760578509f491">DisableGCOpts</a>) {</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;GCStatepointInst *, 2&gt;</a> Statepoints;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> &amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> : <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *SP = dyn_cast&lt;GCStatepointInst&gt;(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;          Statepoints.push_back(SP);</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Statepoints)</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      EverMadeChange |= simplifyOffsetableRelocate(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  }</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160; </div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  <span class="comment">// Do this last to clean up use-before-def scenarios introduced by other</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  <span class="comment">// preparatory transforms.</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  EverMadeChange |= placeDbgValues(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  EverMadeChange |= placePseudoProbes(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160; </div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="CodeGenPrepare_8cpp.html#afece9241ceab1d00d94c2fcd422cf054">VerifyBFIUpdates</a>)</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    verifyBFIUpdates(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160; </div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  <span class="keywordflow">return</span> EverMadeChange;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;}</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160; </div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="keywordtype">bool</span> CodeGenPrepare::eliminateAssumptions(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> &amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> : <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    CurInstIterator = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>.begin();</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="keywordflow">while</span> (CurInstIterator != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>.end()) {</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = &amp;*(CurInstIterator++);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Assume = dyn_cast&lt;AssumeInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *Operand = Assume-&gt;getOperand(0);</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        Assume-&gt;eraseFromParent();</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160; </div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        resetIteratorIfInvalidatedWhileCalling(&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, [&amp;]() {</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;          <a class="code" href="namespacellvm.html#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(Operand, TLInfo, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        });</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      }</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    }</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  }</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;}</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment">/// An instruction is about to be deleted, so remove all references to it in our</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="comment">/// GEP-tracking data strcutures.</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> CodeGenPrepare::removeAllAssertingVHReferences(<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  LargeOffsetGEPMap.<a class="code" href="classllvm_1_1MapVector.html#a3a8171298a7d19a309d599de01906703">erase</a>(V);</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  NewGEPBases.<a class="code" href="classllvm_1_1SmallSet.html#a75a2d2ad3b3dce6702750d570ee8f343">erase</a>(V);</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160; </div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <span class="keyword">auto</span> <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = dyn_cast&lt;GetElementPtrInst&gt;(V);</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>)</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160; </div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  LargeOffsetGEPID.<a class="code" href="classllvm_1_1DenseMapBase.html#a1eb8504bab5f794778d82db6ac829923">erase</a>(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>);</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160; </div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  <span class="keyword">auto</span> VecI = LargeOffsetGEPMap.<a class="code" href="classllvm_1_1MapVector.html#a6b0c3e15c351ba9682837c29b0a141b6">find</a>(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getPointerOperand());</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  <span class="keywordflow">if</span> (VecI == LargeOffsetGEPMap.<a class="code" href="classllvm_1_1MapVector.html#a0881334358ff6ff7ff8cea5562c7988e">end</a>())</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160; </div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;  <span class="keyword">auto</span> &amp;GEPVector = VecI-&gt;second;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  <a class="code" href="namespacellvm.html#ac9a7de5a04920954ac964059cfc428ad">llvm::erase_if</a>(GEPVector, [=](<span class="keyword">auto</span> &amp;Elt) { <span class="keywordflow">return</span> Elt.first == <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>; });</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160; </div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  <span class="keywordflow">if</span> (GEPVector.empty())</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    LargeOffsetGEPMap.<a class="code" href="classllvm_1_1MapVector.html#a3a8171298a7d19a309d599de01906703">erase</a>(VecI);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;}</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160; </div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="comment">// Verify BFI has been updated correctly by recomputing BFI and comparing them.</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="keywordtype">void</span> <a class="code" href="Compiler_8h.html#acc1c483f4b4ee2f17bb6643a3b353609">LLVM_ATTRIBUTE_UNUSED</a> CodeGenPrepare::verifyBFIUpdates(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> NewDT(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  <a class="code" href="classllvm_1_1LoopInfo.html">LoopInfo</a> NewLI(NewDT);</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  <a class="code" href="classllvm_1_1BranchProbabilityInfo.html">BranchProbabilityInfo</a> NewBPI(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, NewLI, TLInfo);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  <a class="code" href="classllvm_1_1BlockFrequencyInfo.html">BlockFrequencyInfo</a> NewBFI(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, NewBPI, NewLI);</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;  NewBFI.verifyMatch(*<a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>);</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;}</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="comment">/// Merge basic blocks which are connected by a single edge, where one of the</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="comment">/// basic blocks has a single successor pointing to the other basic block,</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="comment">/// which has a single predecessor.</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CodeGenPrepare::eliminateFallThrough(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  <span class="comment">// Scan all of the blocks in the function, except for the entry block.</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  <span class="comment">// Use a temporary array to avoid iterator being invalidated when</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  <span class="comment">// deleting blocks.</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;WeakTrackingVH, 16&gt;</a> Blocks;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Block : <a class="code" href="namespacellvm.html#a02981de53fb6ffd384d39addc4d25f37">llvm::drop_begin</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>))</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    Blocks.push_back(&amp;Block);</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160; </div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  <a class="code" href="classllvm_1_1SmallSet.html">SmallSet&lt;WeakTrackingVH, 16&gt;</a> Preds;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Block : Blocks) {</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="keyword">auto</span> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = cast_or_null&lt;BasicBlock&gt;(Block);</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <span class="comment">// If the destination block has a single pred, then this is a trivial</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <span class="comment">// edge, just collapse it.</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *SinglePred = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getSinglePredecessor();</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160; </div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="comment">// Don&#39;t merge if BB&#39;s address is taken.</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="keywordflow">if</span> (!SinglePred || SinglePred == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> || <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;hasAddressTaken())</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160; </div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *<a class="code" href="namespacellvm_1_1M68kBeads.html#a7eeab1fe8f39bf89dcd7929b816ebfcca27d0e059322508a76f918503800ef1bd">Term</a> = dyn_cast&lt;BranchInst&gt;(SinglePred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>());</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1M68kBeads.html#a7eeab1fe8f39bf89dcd7929b816ebfcca27d0e059322508a76f918503800ef1bd">Term</a> &amp;&amp; !<a class="code" href="namespacellvm_1_1M68kBeads.html#a7eeab1fe8f39bf89dcd7929b816ebfcca27d0e059322508a76f918503800ef1bd">Term</a>-&gt;isConditional()) {</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;To merge:\n&quot;</span> &lt;&lt; *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> &lt;&lt; <span class="stringliteral">&quot;\n\n\n&quot;</span>);</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160; </div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;      <span class="comment">// Merge BB into SinglePred and delete it.</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      <a class="code" href="namespacellvm.html#aa76a2cf19b821f320ab439d5659ef4b9">MergeBlockIntoPredecessor</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;      Preds.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(SinglePred);</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160; </div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;      <span class="keywordflow">if</span> (IsHugeFunc) {</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        <span class="comment">// Update FreshBBs to optimize the merged BB.</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        FreshBBs.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(SinglePred);</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        FreshBBs.<a class="code" href="classllvm_1_1SmallSet.html#a75a2d2ad3b3dce6702750d570ee8f343">erase</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;      }</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    }</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  }</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160; </div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  <span class="comment">// (Repeatedly) merging blocks into their predecessors can create redundant</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <span class="comment">// debug intrinsics.</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;Pred : Preds)</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = cast_or_null&lt;BasicBlock&gt;(Pred))</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;      <a class="code" href="namespacellvm.html#a08f3f942afc0ee9115a8f9fa87e9191d">RemoveRedundantDbgInstrs</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160; </div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;}</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;<span class="comment">/// Find a destination block from BB if BB is mergeable empty block.</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *CodeGenPrepare::findDestBlockOfMergeableEmptyBlock(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  <span class="comment">// If this block doesn&#39;t end with an uncond branch, ignore it.</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = dyn_cast&lt;BranchInst&gt;(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getTerminator());</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  <span class="keywordflow">if</span> (!BI || !BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad56f6a9b5cd05940017c4544df48bc30">isUnconditional</a>())</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160; </div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  <span class="comment">// If the instruction before the branch (skipping debug info) isn&#39;t a phi</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  <span class="comment">// node, then other stuff is happening here.</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> BBI = BI-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>();</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  <span class="keywordflow">if</span> (BBI != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;begin()) {</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    --BBI;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="keywordflow">while</span> (isa&lt;DbgInfoIntrinsic&gt;(BBI)) {</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      <span class="keywordflow">if</span> (BBI == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;begin())</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      --BBI;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    }</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <span class="keywordflow">if</span> (!isa&lt;DbgInfoIntrinsic&gt;(BBI) &amp;&amp; !isa&lt;PHINode&gt;(BBI))</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  }</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160; </div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  <span class="comment">// Do not break infinite loops.</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *DestBB = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0);</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  <span class="keywordflow">if</span> (DestBB == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160; </div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  <span class="keywordflow">if</span> (!canMergeBlocks(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, DestBB))</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    DestBB = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160; </div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  <span class="keywordflow">return</span> DestBB;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;}</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="comment">/// Eliminate blocks that contain only PHI nodes, debug info directives, and an</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="comment">/// unconditional branch. Passes before isel (e.g. LSR/loopsimplify) often split</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="comment">/// edges in ways that are non-optimal for isel. Start by eliminating these</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment">/// blocks so we can split them the way we want them.</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CodeGenPrepare::eliminateMostlyEmptyBlocks(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;BasicBlock *, 16&gt;</a> Preheaders;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Loop *, 16&gt;</a> LoopList(LI-&gt;<a class="code" href="classllvm_1_1LoopInfoBase.html#ab447b41b9c51151b5c6ef497a60689ae">begin</a>(), LI-&gt;<a class="code" href="classllvm_1_1LoopInfoBase.html#a4f728602e7d377829675f13446cf6647">end</a>());</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  <span class="keywordflow">while</span> (!LoopList.empty()) {</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <a class="code" href="classllvm_1_1Loop.html">Loop</a> *L = LoopList.pop_back_val();</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <a class="code" href="namespacellvm.html#a39d3d23a084c4544ee5903203db10e8a">llvm::append_range</a>(LoopList, *L);</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Preheader = L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#ac3280e7f76f955403fe17eacf126b90d">getLoopPreheader</a>())</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;      Preheaders.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(Preheader);</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  }</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160; </div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  <span class="comment">// Copy blocks into a temporary array to avoid iterator invalidation issues</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  <span class="comment">// as we remove them.</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  <span class="comment">// Note that this intentionally skips the entry block.</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;WeakTrackingVH, 16&gt;</a> Blocks;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Block : <a class="code" href="namespacellvm.html#a02981de53fb6ffd384d39addc4d25f37">llvm::drop_begin</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>))</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    Blocks.push_back(&amp;Block);</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160; </div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Block : Blocks) {</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = cast_or_null&lt;BasicBlock&gt;(Block);</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *DestBB = findDestBlockOfMergeableEmptyBlock(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <span class="keywordflow">if</span> (!DestBB ||</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        !isMergingEmptyBlockProfitable(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, DestBB, Preheaders.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)))</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160; </div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    eliminateMostlyEmptyBlock(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  }</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;}</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160; </div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="keywordtype">bool</span> CodeGenPrepare::isMergingEmptyBlockProfitable(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>,</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                                                   <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *DestBB,</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                                                   <span class="keywordtype">bool</span> isPreheader) {</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  <span class="comment">// Do not delete loop preheaders if doing so would create a critical edge.</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  <span class="comment">// Loop preheaders can be good locations to spill registers. If the</span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="comment">// preheader is deleted and we create a critical edge, registers may be</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  <span class="comment">// spilled in the loop body instead.</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="CodeGenPrepare_8cpp.html#af6beea189959393ea5d461cf614e445e">DisablePreheaderProtect</a> &amp;&amp; isPreheader &amp;&amp;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;      !(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getSinglePredecessor() &amp;&amp;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getSinglePredecessor()-&gt;getSingleSuccessor()))</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160; </div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  <span class="comment">// Skip merging if the block&#39;s successor is also a successor to any callbr</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <span class="comment">// that leads to this block.</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  <span class="comment">// FIXME: Is this really needed? Is this a correctness issue?</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred : <a class="code" href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">predecessors</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)) {</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *CBI = dyn_cast&lt;CallBrInst&gt;((Pred)-&gt;getTerminator()))</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = CBI-&gt;getNumSuccessors(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        <span class="keywordflow">if</span> (DestBB == CBI-&gt;getSuccessor(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>))</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  }</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160; </div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  <span class="comment">// Try to skip merging if the unique predecessor of BB is terminated by a</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  <span class="comment">// switch or indirect branch instruction, and BB is used as an incoming block</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  <span class="comment">// of PHIs in DestBB. In such case, merging BB and DestBB would cause ISel to</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  <span class="comment">// add COPY instructions in the predecessor of BB instead of BB (if it is not</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  <span class="comment">// merged). Note that the critical edge created by merging such blocks wont be</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  <span class="comment">// split in MachineSink because the jump table is not analyzable. By keeping</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  <span class="comment">// such empty block (BB), ISel will place COPY instructions in BB, not in the</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  <span class="comment">// predecessor of BB.</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getUniquePredecessor();</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  <span class="keywordflow">if</span> (!Pred || !(isa&lt;SwitchInst&gt;(Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>()) ||</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                 isa&lt;IndirectBrInst&gt;(Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>())))</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160; </div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getTerminator() != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getFirstNonPHIOrDbg())</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160; </div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <span class="comment">// We use a simple cost heuristic which determine skipping merging is</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  <span class="comment">// profitable if the cost of skipping merging is less than the cost of</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  <span class="comment">// merging : Cost(skipping merging) &lt; Cost(merging BB), where the</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  <span class="comment">// Cost(skipping merging) is Freq(BB) * (Cost(Copy) + Cost(Branch)), and</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  <span class="comment">// the Cost(merging BB) is Freq(Pred) * Cost(Copy).</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  <span class="comment">// Assuming Cost(Copy) == Cost(Branch), we could simplify it to :</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  <span class="comment">//   Freq(Pred) / Freq(BB) &gt; 2.</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  <span class="comment">// Note that if there are multiple empty blocks sharing the same incoming</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  <span class="comment">// value for the PHIs in the DestBB, we consider them together. In such</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  <span class="comment">// case, Cost(merging BB) will be the sum of their frequencies.</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160; </div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  <span class="keywordflow">if</span> (!isa&lt;PHINode&gt;(DestBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>()))</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160; </div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;BasicBlock *, 16&gt;</a> SameIncomingValueBBs;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160; </div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  <span class="comment">// Find all other incoming blocks from which incoming values of all PHIs in</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  <span class="comment">// DestBB are the same as the ones from BB.</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *DestBBPred : <a class="code" href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">predecessors</a>(DestBB)) {</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <span class="keywordflow">if</span> (DestBBPred == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160; </div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all_of</a>(DestBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a72516971c5734dc0f7546e64affca425">phis</a>(), [&amp;](<span class="keyword">const</span> <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> &amp;DestPN) {</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;          return DestPN.getIncomingValueForBlock(BB) ==</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                 DestPN.getIncomingValueForBlock(DestBBPred);</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        }))</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;      SameIncomingValueBBs.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(DestBBPred);</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  }</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160; </div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  <span class="comment">// See if all BB&#39;s incoming values are same as the value from Pred. In this</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  <span class="comment">// case, no reason to skip merging because COPYs are expected to be place in</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;  <span class="comment">// Pred already.</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <span class="keywordflow">if</span> (SameIncomingValueBBs.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(Pred))</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160; </div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> PredFreq = <a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;getBlockFreq(Pred);</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> BBFreq = <a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;getBlockFreq(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160; </div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *SameValueBB : SameIncomingValueBBs)</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <span class="keywordflow">if</span> (SameValueBB-&gt;getUniquePredecessor() == Pred &amp;&amp;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        DestBB == findDestBlockOfMergeableEmptyBlock(SameValueBB))</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;      BBFreq += <a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;getBlockFreq(SameValueBB);</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160; </div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  <span class="keywordflow">return</span> PredFreq.<a class="code" href="classllvm_1_1BlockFrequency.html#a8e9ed6b20c2503f66f1fd0725297aedc">getFrequency</a>() &lt;=</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;         BBFreq.<a class="code" href="classllvm_1_1BlockFrequency.html#a8e9ed6b20c2503f66f1fd0725297aedc">getFrequency</a>() * <a class="code" href="CodeGenPrepare_8cpp.html#a43c1d33c8ac8a552c4119db493f7a681">FreqRatioToSkipMerge</a>;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;}</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="comment">/// Return true if we can merge BB into DestBB if there is a single</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="comment">/// unconditional branch between them, and BB contains no other non-phi</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="comment">/// instructions.</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CodeGenPrepare::canMergeBlocks(<span class="keyword">const</span> <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>,</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                                    <span class="keyword">const</span> <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *DestBB)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <span class="comment">// We only want to eliminate blocks whose phi nodes are used by phi nodes in</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="comment">// the successor.  If there are more complex condition (e.g. preheaders),</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  <span class="comment">// don&#39;t mess around with them.</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> &amp;PN : <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;phis()) {</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1User.html">User</a> *U : PN.<a class="code" href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">users</a>()) {</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *UI = cast&lt;Instruction&gt;(U);</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;      <span class="keywordflow">if</span> (UI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() != DestBB || !isa&lt;PHINode&gt;(UI))</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      <span class="comment">// If User is inside DestBB block and it is a PHINode then check</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      <span class="comment">// incoming value. If incoming value is not from BB then this is</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      <span class="comment">// a complex condition (e.g. preheaders) we want to avoid here.</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      <span class="keywordflow">if</span> (UI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() == DestBB) {</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *UPN = dyn_cast&lt;PHINode&gt;(UI))</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = UPN-&gt;getNumIncomingValues(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;            <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="AArch64MIPeepholeOpt_8cpp.html#a96d5dc120196819fbfbc257cba09b2aa">Insn</a> = dyn_cast&lt;Instruction&gt;(UPN-&gt;getIncomingValue(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="AArch64MIPeepholeOpt_8cpp.html#a96d5dc120196819fbfbc257cba09b2aa">Insn</a> &amp;&amp; <a class="code" href="AArch64MIPeepholeOpt_8cpp.html#a96d5dc120196819fbfbc257cba09b2aa">Insn</a>-&gt;getParent() == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> &amp;&amp;</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;                <a class="code" href="AArch64MIPeepholeOpt_8cpp.html#a96d5dc120196819fbfbc257cba09b2aa">Insn</a>-&gt;getParent() != UPN-&gt;getIncomingBlock(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;              <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;          }</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;      }</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    }</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  }</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160; </div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;  <span class="comment">// If BB and DestBB contain any common predecessors, then the phi nodes in BB</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  <span class="comment">// and DestBB may have conflicting incoming values for the block.  If so, we</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  <span class="comment">// can&#39;t merge the block.</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *DestBBPN = dyn_cast&lt;PHINode&gt;(DestBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  <span class="keywordflow">if</span> (!DestBBPN)</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// no conflict.</span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160; </div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  <span class="comment">// Collect the preds of BB.</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const BasicBlock *, 16&gt;</a> BBPreds;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *BBPN = dyn_cast&lt;PHINode&gt;(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;begin())) {</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <span class="comment">// It is faster to get preds from a PHI than with pred_iterator.</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = BBPN-&gt;getNumIncomingValues(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;      BBPreds.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(BBPN-&gt;getIncomingBlock(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    BBPreds.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(<a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>), <a class="code" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>));</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  }</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160; </div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  <span class="comment">// Walk the preds of DestBB.</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = DestBBPN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred = DestBBPN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a8ce0c4746a1ec805e66409d20ae93922">getIncomingBlock</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    <span class="keywordflow">if</span> (BBPreds.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(Pred)) { <span class="comment">// Common predecessor?</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> &amp;PN : DestBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a72516971c5734dc0f7546e64affca425">phis</a>()) {</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;        <span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *V1 = PN.getIncomingValueForBlock(Pred);</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        <span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a> = PN.getIncomingValueForBlock(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160; </div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        <span class="comment">// If V2 is a phi node in BB, look up what the mapped value will be.</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *V2PN = dyn_cast&lt;PHINode&gt;(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>))</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;          <span class="keywordflow">if</span> (V2PN-&gt;getParent() == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;            <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a> = V2PN-&gt;getIncomingValueForBlock(Pred);</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160; </div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        <span class="comment">// If there is a conflict, bail out.</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        <span class="keywordflow">if</span> (V1 != <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>)</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      }</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    }</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  }</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160; </div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;}</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="comment">/// Replace all old uses with new ones, and push the updated BBs into FreshBBs.</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601"> 1029</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *Old, <a class="code" href="classllvm_1_1Value.html">Value</a> *New,</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                               <a class="code" href="classllvm_1_1SmallSet.html">SmallSet&lt;BasicBlock *, 32&gt;</a> &amp;FreshBBs,</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;                               <span class="keywordtype">bool</span> IsHuge) {</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  <span class="keyword">auto</span> *OldI = dyn_cast&lt;Instruction&gt;(Old);</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  <span class="keywordflow">if</span> (OldI) {</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html#acd2fbee42afeb868be98aaae56528636">Value::user_iterator</a> UI = OldI-&gt;<a class="code" href="classllvm_1_1Value.html#a158da2b6d3d938aaa15b6acd00150e2c">user_begin</a>(), <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = OldI-&gt;user_end();</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;         UI != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++UI) {</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1User.html">User</a> = cast&lt;Instruction&gt;(*UI);</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;      <span class="keywordflow">if</span> (IsHuge)</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        FreshBBs.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(<a class="code" href="classllvm_1_1User.html">User</a>-&gt;getParent());</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    }</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;  }</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  Old-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(New);</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;}</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="comment">/// Eliminate a basic block that has only phi&#39;s and an unconditional branch in</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="comment">/// it.</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> CodeGenPrepare::eliminateMostlyEmptyBlock(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = cast&lt;BranchInst&gt;(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getTerminator());</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *DestBB = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0);</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160; </div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;MERGING MOSTLY EMPTY BLOCKS - BEFORE:\n&quot;</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;                    &lt;&lt; *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> &lt;&lt; *DestBB);</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160; </div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;  <span class="comment">// If the destination block has a single pred, then this is a trivial edge,</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;  <span class="comment">// just collapse it.</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *SinglePred = DestBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>()) {</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    <span class="keywordflow">if</span> (SinglePred != DestBB) {</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SinglePred == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> &amp;&amp;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;             <span class="stringliteral">&quot;Single predecessor not the same as predecessor&quot;</span>);</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;      <span class="comment">// Merge DestBB into SinglePred/BB and delete it.</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      <a class="code" href="namespacellvm.html#aa76a2cf19b821f320ab439d5659ef4b9">MergeBlockIntoPredecessor</a>(DestBB);</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      <span class="comment">// Note: BB(=SinglePred) will not be deleted on this path.</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;      <span class="comment">// DestBB(=its single successor) is the one that was deleted.</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;AFTER:\n&quot;</span> &lt;&lt; *SinglePred &lt;&lt; <span class="stringliteral">&quot;\n\n\n&quot;</span>);</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160; </div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;      <span class="keywordflow">if</span> (IsHugeFunc) {</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;        <span class="comment">// Update FreshBBs to optimize the merged BB.</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;        FreshBBs.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(SinglePred);</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;        FreshBBs.<a class="code" href="classllvm_1_1SmallSet.html#a75a2d2ad3b3dce6702750d570ee8f343">erase</a>(DestBB);</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;      }</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    }</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  }</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160; </div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  <span class="comment">// Otherwise, we have multiple predecessors of BB.  Update the PHIs in DestBB</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  <span class="comment">// to handle the new incoming edges it is about to have.</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> &amp;PN : DestBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a72516971c5734dc0f7546e64affca425">phis</a>()) {</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    <span class="comment">// Remove the incoming value for BB, and remember it.</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *InVal = PN.removeIncomingValue(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160; </div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <span class="comment">// Two options: either the InVal is a phi node defined in BB or it is some</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <span class="comment">// value that dominates BB.</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *InValPhi = dyn_cast&lt;PHINode&gt;(InVal);</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <span class="keywordflow">if</span> (InValPhi &amp;&amp; InValPhi-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;      <span class="comment">// Add all of the input values of the input PHI as inputs of this phi.</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = InValPhi-&gt;<a class="code" href="classllvm_1_1PHINode.html#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;        PN.addIncoming(InValPhi-&gt;<a class="code" href="classllvm_1_1PHINode.html#a16c39eb6e60b42a40c399d8d65347bb6">getIncomingValue</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>),</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;                       InValPhi-&gt;<a class="code" href="classllvm_1_1PHINode.html#a8ce0c4746a1ec805e66409d20ae93922">getIncomingBlock</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;      <span class="comment">// Otherwise, add one instance of the dominating value for each edge that</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;      <span class="comment">// we will be adding.</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *BBPN = dyn_cast&lt;PHINode&gt;(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;begin())) {</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = BBPN-&gt;getNumIncomingValues(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;          PN.addIncoming(InVal, BBPN-&gt;getIncomingBlock(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred : <a class="code" href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">predecessors</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>))</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;          PN.addIncoming(InVal, Pred);</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;      }</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    }</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  }</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160; </div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  <span class="comment">// The PHIs are now updated, change everything that refers to BB to use</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;  <span class="comment">// DestBB and remove BB.</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;replaceAllUsesWith(DestBB);</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;  <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;  ++NumBlocksElim;</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160; </div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;AFTER:\n&quot;</span> &lt;&lt; *DestBB &lt;&lt; <span class="stringliteral">&quot;\n\n\n&quot;</span>);</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;}</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160; </div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="comment">// Computes a map of base pointer relocation instructions to corresponding</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="comment">// derived pointer relocation instructions given a vector of all relocate calls</span></div>
<div class="line"><a name="l01112"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#af6143789a859bfe7a105d97d7cc8757f"> 1112</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="CodeGenPrepare_8cpp.html#af6143789a859bfe7a105d97d7cc8757f">computeBaseDerivedRelocateMap</a>(</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;GCRelocateInst *&gt;</a> &amp;AllRelocateCalls,</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap</a>&lt;<a class="code" href="classllvm_1_1GCRelocateInst.html">GCRelocateInst</a> *, <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;GCRelocateInst *, 2&gt;</a>&gt;</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;        &amp;RelocateInstMap) {</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;  <span class="comment">// Collect information in two maps: one primarily for locating the base object</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;  <span class="comment">// while filling the second map; the second map is the final structure holding</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  <span class="comment">// a mapping between Base and corresponding Derived relocate calls</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;std::pair&lt;unsigned, unsigned&gt;</a>, <a class="code" href="classllvm_1_1GCRelocateInst.html">GCRelocateInst</a> *&gt; RelocateIdxMap;</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *ThisRelocate : AllRelocateCalls) {</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    <span class="keyword">auto</span> K = std::make_pair(ThisRelocate-&gt;getBasePtrIndex(),</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;                            ThisRelocate-&gt;getDerivedPtrIndex());</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    RelocateIdxMap.<a class="code" href="classllvm_1_1DenseMapBase.html#a99f811d53704275b4158c62a2dd138d9">insert</a>(std::make_pair(K, ThisRelocate));</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;  }</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Item : RelocateIdxMap) {</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    std::pair&lt;unsigned, unsigned&gt; <a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a> = Item.first;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>.first == <a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>.second)</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;      <span class="comment">// Base relocation: nothing to insert</span></div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160; </div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    <a class="code" href="classllvm_1_1GCRelocateInst.html">GCRelocateInst</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Item.second;</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    <span class="keyword">auto</span> BaseKey = std::make_pair(<a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>.first, <a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>.first);</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160; </div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    <span class="comment">// We&#39;re iterating over RelocateIdxMap so we cannot modify it.</span></div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <span class="keyword">auto</span> MaybeBase = RelocateIdxMap.find(BaseKey);</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    <span class="keywordflow">if</span> (MaybeBase == RelocateIdxMap.end())</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;      <span class="comment">// TODO: We might want to insert a new base object relocate and gep off</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;      <span class="comment">// that, if there are enough derived object relocates.</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160; </div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    RelocateInstMap[MaybeBase-&gt;second].push_back(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;  }</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;}</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160; </div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="comment">// Accepts a GEP and extracts the operands into a vector provided they&#39;re all</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="comment">// small integer constants</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#a0e431b29d5cd842ab00f85ec2cdab8b2"> 1147</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CodeGenPrepare_8cpp.html#a0e431b29d5cd842ab00f85ec2cdab8b2">getGEPSmallConstantIntOffsetV</a>(<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>,</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;                                          <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Value *&gt;</a> &amp;OffsetV) {</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getNumOperands(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <span class="comment">// Only accept small constant integer operands</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = dyn_cast&lt;ConstantInt&gt;(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getOperand(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> || <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>-&gt;getZExtValue() &gt; 20)</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;  }</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160; </div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getNumOperands(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    OffsetV.push_back(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getOperand(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;}</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160; </div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="comment">// Takes a RelocatedBase (base pointer relocation instruction) and Targets to</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;<span class="comment">// replace, computes a replacement, and affects it.</span></div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#a9364799319bac519aa565ec882986e6d"> 1164</a></span>&#160;<a class="code" href="CodeGenPrepare_8cpp.html#a9364799319bac519aa565ec882986e6d">simplifyRelocatesOffABase</a>(<a class="code" href="classllvm_1_1GCRelocateInst.html">GCRelocateInst</a> *RelocatedBase,</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;                          <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;GCRelocateInst *&gt;</a> &amp;Targets) {</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;  <span class="comment">// We must ensure the relocation of derived pointer is defined after</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;  <span class="comment">// relocation of base pointer. If we find a relocation corresponding to base</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  <span class="comment">// defined earlier than relocation of base then we move relocation of base</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  <span class="comment">// right before found relocation. We consider only relocation in the same</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  <span class="comment">// basic block as relocation of base. Relocations from other basic block will</span></div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;  <span class="comment">// be skipped by optimization and we do not care about them.</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> R = RelocatedBase-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;       &amp;*R != RelocatedBase; ++R)</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *RI = dyn_cast&lt;GCRelocateInst&gt;(R))</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;      <span class="keywordflow">if</span> (RI-&gt;getStatepoint() == RelocatedBase-&gt;<a class="code" href="classllvm_1_1GCProjectionInst.html#a6cffcfabac72ca61185ea24c1208b937">getStatepoint</a>())</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;        <span class="keywordflow">if</span> (RI-&gt;getBasePtrIndex() == RelocatedBase-&gt;<a class="code" href="classllvm_1_1GCRelocateInst.html#ae33641b6538b4ab4f3aa3dad2926860f">getBasePtrIndex</a>()) {</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;          RelocatedBase-&gt;<a class="code" href="classllvm_1_1Instruction.html#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(RI);</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;        }</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160; </div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1GCRelocateInst.html">GCRelocateInst</a> *ToReplace : Targets) {</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ToReplace-&gt;getBasePtrIndex() == RelocatedBase-&gt;<a class="code" href="classllvm_1_1GCRelocateInst.html#ae33641b6538b4ab4f3aa3dad2926860f">getBasePtrIndex</a>() &amp;&amp;</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;           <span class="stringliteral">&quot;Not relocating a derived object of the original base object&quot;</span>);</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="keywordflow">if</span> (ToReplace-&gt;getBasePtrIndex() == ToReplace-&gt;getDerivedPtrIndex()) {</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;      <span class="comment">// A duplicate relocate call. TODO: coalesce duplicates.</span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    }</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160; </div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <span class="keywordflow">if</span> (RelocatedBase-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() != ToReplace-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a38bee869ad41aebfef3de2641b12004c">getParent</a>()) {</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;      <span class="comment">// Base and derived relocates are in different basic blocks.</span></div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;      <span class="comment">// In this case transform is only valid when base dominates derived</span></div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;      <span class="comment">// relocate. However it would be too expensive to check dominance</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;      <span class="comment">// for each such relocate, so we skip the whole transformation.</span></div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    }</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160; </div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = ToReplace-&gt;getBasePtr();</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="keyword">auto</span> *Derived = dyn_cast&lt;GetElementPtrInst&gt;(ToReplace-&gt;getDerivedPtr());</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    <span class="keywordflow">if</span> (!Derived || Derived-&gt;getPointerOperand() != <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>)</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160; </div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 2&gt;</a> OffsetV;</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="CodeGenPrepare_8cpp.html#a0e431b29d5cd842ab00f85ec2cdab8b2">getGEPSmallConstantIntOffsetV</a>(Derived, OffsetV))</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160; </div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    <span class="comment">// Create a Builder and replace the target callsite with a gep</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(RelocatedBase-&gt;<a class="code" href="classllvm_1_1ilist__node__with__parent.html#a26708685cc8b94fe3d7092ee080dbb34">getNextNode</a>() &amp;&amp;</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;           <span class="stringliteral">&quot;Should always have one since it&#39;s not a terminator&quot;</span>);</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160; </div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    <span class="comment">// Insert after RelocatedBase</span></div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(RelocatedBase-&gt;<a class="code" href="classllvm_1_1ilist__node__with__parent.html#a26708685cc8b94fe3d7092ee080dbb34">getNextNode</a>());</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetCurrentDebugLocation(ToReplace-&gt;getDebugLoc());</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160; </div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    <span class="comment">// If gc_relocate does not match the actual type, cast it to the right type.</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    <span class="comment">// In theory, there must be a bitcast after gc_relocate if the type does not</span></div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    <span class="comment">// match, and we should reuse it to get the derived pointer. But it could be</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <span class="comment">// cases like this:</span></div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    <span class="comment">// bb1:</span></div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    <span class="comment">//  ...</span></div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    <span class="comment">//  %g1 = call coldcc i8 addrspace(1)*</span></div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    <span class="comment">//  @llvm.experimental.gc.relocate.p1i8(...) br label %merge</span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <span class="comment">// bb2:</span></div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    <span class="comment">//  ...</span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    <span class="comment">//  %g2 = call coldcc i8 addrspace(1)*</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    <span class="comment">//  @llvm.experimental.gc.relocate.p1i8(...) br label %merge</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    <span class="comment">// merge:</span></div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <span class="comment">//  %p1 = phi i8 addrspace(1)* [ %g1, %bb1 ], [ %g2, %bb2 ]</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    <span class="comment">//  %cast = bitcast i8 addrspace(1)* %p1 in to i32 addrspace(1)*</span></div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    <span class="comment">// In this case, we can not find the bitcast any more. So we insert a new</span></div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    <span class="comment">// bitcast no matter there is already one or not. In this way, we can handle</span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    <span class="comment">// all cases, and the extra bitcast should be optimized away in later</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    <span class="comment">// passes.</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *ActualRelocatedBase = RelocatedBase;</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    <span class="keywordflow">if</span> (RelocatedBase-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() != <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>-&gt;getType()) {</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;      ActualRelocatedBase =</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;          <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(RelocatedBase, <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>-&gt;getType());</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    }</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Replacement =</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateGEP(Derived-&gt;getSourceElementType(), ActualRelocatedBase,</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;                          <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef</a>(OffsetV));</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    Replacement-&gt;<a class="code" href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(ToReplace);</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    <span class="comment">// If the newly generated derived pointer&#39;s type does not match the original</span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    <span class="comment">// derived pointer&#39;s type, cast the new derived pointer to match it. Same</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    <span class="comment">// reasoning as above.</span></div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *ActualReplacement = Replacement;</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    <span class="keywordflow">if</span> (Replacement-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() != ToReplace-&gt;getType()) {</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;      ActualReplacement =</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;          <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(Replacement, ToReplace-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    }</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    ToReplace-&gt;replaceAllUsesWith(ActualReplacement);</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    ToReplace-&gt;eraseFromParent();</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160; </div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  }</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;}</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160; </div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;<span class="comment">// Turns this:</span></div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;<span class="comment">// %base = ...</span></div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;<span class="comment">// %ptr = gep %base + 15</span></div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;<span class="comment">// %tok = statepoint (%fun, i32 0, i32 0, i32 0, %base, %ptr)</span></div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;<span class="comment">// %base&#39; = relocate(%tok, i32 4, i32 4)</span></div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;<span class="comment">// %ptr&#39; = relocate(%tok, i32 4, i32 5)</span></div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;<span class="comment">// %val = load %ptr&#39;</span></div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;<span class="comment">// into this:</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;<span class="comment">// %base = ...</span></div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="comment">// %ptr = gep %base + 15</span></div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;<span class="comment">// %tok = statepoint (%fun, i32 0, i32 0, i32 0, %base, %ptr)</span></div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="comment">// %base&#39; = gc.relocate(%tok, i32 4, i32 4)</span></div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;<span class="comment">// %ptr&#39; = gep %base&#39; + 15</span></div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<span class="comment">// %val = load %ptr&#39;</span></div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;<span class="keywordtype">bool</span> CodeGenPrepare::simplifyOffsetableRelocate(<a class="code" href="classllvm_1_1GCStatepointInst.html">GCStatepointInst</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;GCRelocateInst *, 2&gt;</a> AllRelocateCalls;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *U : <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.users())</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GCRelocateInst.html">GCRelocateInst</a> *Relocate = dyn_cast&lt;GCRelocateInst&gt;(U))</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;      <span class="comment">// Collect all the relocate calls associated with a statepoint</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;      AllRelocateCalls.push_back(Relocate);</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160; </div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;  <span class="comment">// We need at least one base pointer relocation + one derived pointer</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  <span class="comment">// relocation to mangle</span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;  <span class="keywordflow">if</span> (AllRelocateCalls.size() &lt; 2)</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160; </div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;  <span class="comment">// RelocateInstMap is a mapping from the base relocate instruction to the</span></div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;  <span class="comment">// corresponding derived relocate instructions</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;GCRelocateInst *, SmallVector&lt;GCRelocateInst *, 2&gt;</a>&gt; RelocateInstMap;</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;  <a class="code" href="CodeGenPrepare_8cpp.html#af6143789a859bfe7a105d97d7cc8757f">computeBaseDerivedRelocateMap</a>(AllRelocateCalls, RelocateInstMap);</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;  <span class="keywordflow">if</span> (RelocateInstMap.<a class="code" href="classllvm_1_1DenseMapBase.html#a49c487a9395a6c384be8544cfb2cfccf">empty</a>())</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160; </div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Item : RelocateInstMap)</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    <span class="comment">// Item.first is the RelocatedBase to offset against</span></div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    <span class="comment">// Item.second is the vector of Targets to replace</span></div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;    MadeChange = <a class="code" href="CodeGenPrepare_8cpp.html#a9364799319bac519aa565ec882986e6d">simplifyRelocatesOffABase</a>(Item.first, Item.second);</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;}</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;<span class="comment">/// Sink the specified cast instruction into its user blocks.</span></div>
<div class="line"><a name="l01307"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#a3cc8a3a2506bf528398d0aef0850f31a"> 1307</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CodeGenPrepare_8cpp.html#a3cc8a3a2506bf528398d0aef0850f31a">SinkCast</a>(<a class="code" href="classllvm_1_1CastInst.html">CastInst</a> *CI) {</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *DefBB = CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="comment">  /// InsertedCasts - Only insert a cast in each block once.</span></div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;BasicBlock *, CastInst *&gt;</a> InsertedCasts;</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160; </div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html#acd2fbee42afeb868be98aaae56528636">Value::user_iterator</a> UI = CI-&gt;<a class="code" href="classllvm_1_1Value.html#a158da2b6d3d938aaa15b6acd00150e2c">user_begin</a>(), <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = CI-&gt;<a class="code" href="classllvm_1_1Value.html#aa22118b2b3f206bfda2ffab4cda94d64">user_end</a>();</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;       UI != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>;) {</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    <a class="code" href="classllvm_1_1Use.html">Use</a> &amp;TheUse = UI.getUse();</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1User.html">User</a> = cast&lt;Instruction&gt;(*UI);</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160; </div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    <span class="comment">// Figure out which BB this cast is used in.  For PHI&#39;s this is the</span></div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    <span class="comment">// appropriate predecessor block.</span></div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *UserBB = <a class="code" href="classllvm_1_1User.html">User</a>-&gt;getParent();</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = dyn_cast&lt;PHINode&gt;(<a class="code" href="classllvm_1_1User.html">User</a>)) {</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;      UserBB = PN-&gt;getIncomingBlock(TheUse);</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    }</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160; </div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    <span class="comment">// Preincrement use iterator so we don&#39;t invalidate it.</span></div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    ++UI;</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160; </div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    <span class="comment">// The first insertion point of a block containing an EH pad is after the</span></div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    <span class="comment">// pad.  If the pad is the user, we cannot sink the cast past the pad.</span></div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1User.html">User</a>-&gt;isEHPad())</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160; </div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    <span class="comment">// If the block selected to receive the cast is an EH pad that does not</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    <span class="comment">// allow non-PHI instructions before the terminator, we can&#39;t sink the</span></div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    <span class="comment">// cast.</span></div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    <span class="keywordflow">if</span> (UserBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>()-&gt;<a class="code" href="classllvm_1_1Instruction.html#a5d3d315f678bc76e43b27d18e5d72829">isEHPad</a>())</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160; </div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    <span class="comment">// If this user is in the same block as the cast, don&#39;t change the cast.</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    <span class="keywordflow">if</span> (UserBB == DefBB)</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160; </div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    <span class="comment">// If we have already inserted a cast into this block, use it.</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <a class="code" href="classllvm_1_1CastInst.html">CastInst</a> *&amp;InsertedCast = InsertedCasts[UserBB];</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160; </div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    <span class="keywordflow">if</span> (!InsertedCast) {</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPt = UserBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InsertPt != UserBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;      InsertedCast = <a class="code" href="classllvm_1_1CastInst.html#a643fe5a9e7042f032dae78109c2b1e72">CastInst::Create</a>(CI-&gt;<a class="code" href="classllvm_1_1CastInst.html#a3685b2128d8e6917000e4adc3b266ff6">getOpcode</a>(), CI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0),</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;                                      CI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), <span class="stringliteral">&quot;&quot;</span>, &amp;*InsertPt);</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;      InsertedCast-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4f3bf98b5054831b608852e33427814">getDebugLoc</a>());</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    }</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160; </div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    <span class="comment">// Replace a use of the cast with a use of the new cast.</span></div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    TheUse = InsertedCast;</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    ++NumCastUses;</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;  }</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160; </div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;  <span class="comment">// If we removed all uses, nuke the cast.</span></div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;  <span class="keywordflow">if</span> (CI-&gt;<a class="code" href="classllvm_1_1Value.html#a9d7de807ebdfe1819df3ff6cb0f16158">use_empty</a>()) {</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    <a class="code" href="namespacellvm.html#a26be1141b23850a2b4eb78021d99e862">salvageDebugInfo</a>(*CI);</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;  }</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160; </div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;}</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;<span class="comment">/// If the specified cast instruction is a noop copy (e.g. it&#39;s casting from</span></div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;<span class="comment">/// one pointer type to another, i32-&gt;i8 on PPC), sink it into user blocks to</span></div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;<span class="comment">/// reduce the number of virtual registers that must be created and coalesced.</span></div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="comment">/// Return true if any changes are made.</span></div>
<div class="line"><a name="l01376"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#a3b82cff474790446f1288f1a086c1cd6"> 1376</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CodeGenPrepare_8cpp.html#a3b82cff474790446f1288f1a086c1cd6">OptimizeNoopCopyExpression</a>(<a class="code" href="classllvm_1_1CastInst.html">CastInst</a> *CI, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI,</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;                                       <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>) {</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;  <span class="comment">// Sink only &quot;cheap&quot; (or nop) address-space casts.  This is a weaker condition</span></div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;  <span class="comment">// than sinking only nop casts, but is helpful on some platforms.</span></div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *ASC = dyn_cast&lt;AddrSpaceCastInst&gt;(CI)) {</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    <span class="keywordflow">if</span> (!TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#a8e1c8a5721df02cd26c1ffd04320b02c">isFreeAddrSpaceCast</a>(ASC-&gt;getSrcAddressSpace(),</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;                                 ASC-&gt;getDestAddressSpace()))</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;  }</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160; </div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;  <span class="comment">// If this is a noop copy,</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;  <a class="code" href="structllvm_1_1EVT.html">EVT</a> SrcVT = TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, CI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;  <a class="code" href="structllvm_1_1EVT.html">EVT</a> DstVT = TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, CI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160; </div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;  <span class="comment">// This is an fp&lt;-&gt;int conversion?</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;  <span class="keywordflow">if</span> (SrcVT.<a class="code" href="structllvm_1_1EVT.html#af975bf04c49cc895cfe38e7dc126a2f1">isInteger</a>() != DstVT.<a class="code" href="structllvm_1_1EVT.html#af975bf04c49cc895cfe38e7dc126a2f1">isInteger</a>())</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160; </div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;  <span class="comment">// If this is an extension, it will be a zero or sign extension, which</span></div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;  <span class="comment">// isn&#39;t a noop.</span></div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;  <span class="keywordflow">if</span> (SrcVT.<a class="code" href="structllvm_1_1EVT.html#a3bf257bfbd279ecfad670be03b00210e">bitsLT</a>(DstVT))</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160; </div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;  <span class="comment">// If these values will be promoted, find out what they will be promoted</span></div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;  <span class="comment">// to.  This helps us consider truncates on PPC as noop copies when they</span></div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;  <span class="comment">// are.</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;  <span class="keywordflow">if</span> (TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#ad859786d7e54bdc5c568ac20c69816e0">getTypeAction</a>(CI-&gt;<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), SrcVT) ==</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;      <a class="code" href="classllvm_1_1TargetLoweringBase.html#a35dc101b509721ffbfb58aba316de681a26f35604723482a1aee6514940c2987d">TargetLowering::TypePromoteInteger</a>)</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    SrcVT = TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#a77f7add8733417370a56154e8b560617">getTypeToTransformTo</a>(CI-&gt;<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), SrcVT);</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;  <span class="keywordflow">if</span> (TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#ad859786d7e54bdc5c568ac20c69816e0">getTypeAction</a>(CI-&gt;<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), DstVT) ==</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;      <a class="code" href="classllvm_1_1TargetLoweringBase.html#a35dc101b509721ffbfb58aba316de681a26f35604723482a1aee6514940c2987d">TargetLowering::TypePromoteInteger</a>)</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;    DstVT = TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#a77f7add8733417370a56154e8b560617">getTypeToTransformTo</a>(CI-&gt;<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), DstVT);</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160; </div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;  <span class="comment">// If, after promotion, these are the same types, this is a noop copy.</span></div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;  <span class="keywordflow">if</span> (SrcVT != DstVT)</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160; </div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="CodeGenPrepare_8cpp.html#a3cc8a3a2506bf528398d0aef0850f31a">SinkCast</a>(CI);</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;}</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160; </div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;<span class="comment">// Match a simple increment by constant operation.  Note that if a sub is</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;<span class="comment">// matched, the step is negated (as if the step had been canonicalized to</span></div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;<span class="comment">// an add, even though we leave the instruction alone.)</span></div>
<div class="line"><a name="l01419"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#a81d4c84610eb126b642d541e1d116bb3"> 1419</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="CodeGenPrepare_8cpp.html#a81d4c84610eb126b642d541e1d116bb3">matchIncrement</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *IVInc, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *&amp;<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>,</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;                    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *&amp;Step) {</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(IVInc, <a class="code" href="namespacellvm_1_1PatternMatch.html#a944c25ac9b73b02a17a20a08a25b9b21">m_Add</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a04353aa48874f9bda89ff9059cd1a5a6">m_Instruction</a>(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#aadd209ba7e1bfa8113a609e09a7fe62f">m_Constant</a>(Step))) ||</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;      <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(IVInc, m_ExtractValue&lt;0&gt;(m_Intrinsic&lt;Intrinsic::uadd_with_overflow&gt;(</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;                       <a class="code" href="namespacellvm_1_1PatternMatch.html#a04353aa48874f9bda89ff9059cd1a5a6">m_Instruction</a>(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#aadd209ba7e1bfa8113a609e09a7fe62f">m_Constant</a>(Step)))))</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(IVInc, <a class="code" href="namespacellvm_1_1PatternMatch.html#ac3ed5602889a22db44a16e1b97fac5b8">m_Sub</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a04353aa48874f9bda89ff9059cd1a5a6">m_Instruction</a>(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#aadd209ba7e1bfa8113a609e09a7fe62f">m_Constant</a>(Step))) ||</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;      <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(IVInc, m_ExtractValue&lt;0&gt;(m_Intrinsic&lt;Intrinsic::usub_with_overflow&gt;(</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;                       <a class="code" href="namespacellvm_1_1PatternMatch.html#a04353aa48874f9bda89ff9059cd1a5a6">m_Instruction</a>(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#aadd209ba7e1bfa8113a609e09a7fe62f">m_Constant</a>(Step))))) {</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    Step = <a class="code" href="classllvm_1_1ConstantExpr.html#afa29f0cd072ab9b3a2630681ffe5760f">ConstantExpr::getNeg</a>(Step);</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;  }</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;}</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;<span class="comment">/// If given \p PN is an inductive variable with value IVInc coming from the</span></div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;<span class="comment">/// backedge, and on each iteration it gets increased by Step, return pair</span></div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;<span class="comment">/// &lt;IVInc, Step&gt;. Otherwise, return std::nullopt.</span></div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;<span class="comment"></span><span class="keyword">static</span> std::optional&lt;std::pair&lt;Instruction *, Constant *&gt;&gt;</div>
<div class="line"><a name="l01438"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#a1279f0919bc0ef7841275eb05861ccb3"> 1438</a></span>&#160;<a class="code" href="CodeGenPrepare_8cpp.html#a1279f0919bc0ef7841275eb05861ccb3">getIVIncrement</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN, <span class="keyword">const</span> <a class="code" href="classllvm_1_1LoopInfo.html">LoopInfo</a> *LI) {</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1Loop.html">Loop</a> *L = LI-&gt;<a class="code" href="classllvm_1_1LoopInfoBase.html#a7a7c8e0e4f836c13c015b62e18f386bd">getLoopFor</a>(PN-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>());</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  <span class="keywordflow">if</span> (!L || L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#a58c5b170ea68b41e94ebb0019523a68f">getHeader</a>() != PN-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() || !L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#a1230fd674d2609b96527fe65eaf40b1b">getLoopLatch</a>())</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;  <span class="keyword">auto</span> *IVInc =</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;      dyn_cast&lt;Instruction&gt;(PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#adfb61ffe25c950c75c86310245b3ef39">getIncomingValueForBlock</a>(L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#a1230fd674d2609b96527fe65eaf40b1b">getLoopLatch</a>()));</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  <span class="keywordflow">if</span> (!IVInc || LI-&gt;<a class="code" href="classllvm_1_1LoopInfoBase.html#a7a7c8e0e4f836c13c015b62e18f386bd">getLoopFor</a>(IVInc-&gt;getParent()) != L)</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;    <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Step = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="CodeGenPrepare_8cpp.html#a81d4c84610eb126b642d541e1d116bb3">matchIncrement</a>(IVInc, <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, Step) &amp;&amp; <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> == PN)</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    <span class="keywordflow">return</span> std::make_pair(IVInc, Step);</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;  <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;}</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160; </div>
<div class="line"><a name="l01453"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#ab0f1e7b38e65d10c01900bd4d458a03b"> 1453</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CodeGenPrepare_8cpp.html#ab0f1e7b38e65d10c01900bd4d458a03b">isIVIncrement</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *V, <span class="keyword">const</span> <a class="code" href="classllvm_1_1LoopInfo.html">LoopInfo</a> *LI) {</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Step = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="CodeGenPrepare_8cpp.html#a81d4c84610eb126b642d541e1d116bb3">matchIncrement</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, Step))</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *PN = dyn_cast&lt;PHINode&gt;(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>))</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> IVInc = <a class="code" href="CodeGenPrepare_8cpp.html#a1279f0919bc0ef7841275eb05861ccb3">getIVIncrement</a>(PN, LI))</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;      <span class="keywordflow">return</span> IVInc-&gt;first == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;}</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160; </div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;<span class="keywordtype">bool</span> CodeGenPrepare::replaceMathCmpWithIntrinsic(<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *BO,</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;                                                 <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg0, <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg1,</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;                                                 <a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a> *Cmp,</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;                                                 <a class="code" href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IID) {</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;  <span class="keyword">auto</span> IsReplacableIVIncrement = [<span class="keyword">this</span>, &amp;<a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>](<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *BO) {</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="CodeGenPrepare_8cpp.html#ab0f1e7b38e65d10c01900bd4d458a03b">isIVIncrement</a>(BO, LI))</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1Loop.html">Loop</a> *L = LI-&gt;<a class="code" href="classllvm_1_1LoopInfoBase.html#a7a7c8e0e4f836c13c015b62e18f386bd">getLoopFor</a>(BO-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>());</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(L &amp;&amp; <span class="stringliteral">&quot;L should not be null after isIVIncrement()&quot;</span>);</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;    <span class="comment">// Do not risk on moving increment into a child loop.</span></div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;    <span class="keywordflow">if</span> (LI-&gt;<a class="code" href="classllvm_1_1LoopInfoBase.html#a7a7c8e0e4f836c13c015b62e18f386bd">getLoopFor</a>(<a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getParent()) != L)</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160; </div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    <span class="comment">// Finally, we need to ensure that the insert point will dominate all</span></div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    <span class="comment">// existing uses of the increment.</span></div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160; </div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    <span class="keyword">auto</span> &amp;DT = getDT(*BO-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a38bee869ad41aebfef3de2641b12004c">getParent</a>());</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    <span class="keywordflow">if</span> (DT.dominates(<a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getParent(), BO-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()))</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;      <span class="comment">// If we&#39;re moving up the dom tree, all uses are trivially dominated.</span></div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;      <span class="comment">// (This is the common case for code produced by LSR.)</span></div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160; </div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    <span class="comment">// Otherwise, special case the single use in the phi recurrence.</span></div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    <span class="keywordflow">return</span> BO-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; DT.dominates(<a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getParent(), L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#a1230fd674d2609b96527fe65eaf40b1b">getLoopLatch</a>());</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;  };</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;  <span class="keywordflow">if</span> (BO-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() != <a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getParent() &amp;&amp; !IsReplacableIVIncrement(BO)) {</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;    <span class="comment">// We used to use a dominator tree here to allow multi-block optimization.</span></div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;    <span class="comment">// But that was problematic because:</span></div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    <span class="comment">// 1. It could cause a perf regression by hoisting the math op into the</span></div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    <span class="comment">//    critical path.</span></div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    <span class="comment">// 2. It could cause a perf regression by creating a value that was live</span></div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    <span class="comment">//    across multiple blocks and increasing register pressure.</span></div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    <span class="comment">// 3. Use of a dominator tree could cause large compile-time regression.</span></div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    <span class="comment">//    This is because we recompute the DT on every change in the main CGP</span></div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    <span class="comment">//    run-loop. The recomputing is probably unnecessary in many cases, so if</span></div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    <span class="comment">//    that was fixed, using a DT here would be ok.</span></div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    <span class="comment">// There is one important particular case we still want to handle: if BO is</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;    <span class="comment">// the IV increment. Important properties that make it profitable:</span></div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    <span class="comment">// - We can speculate IV increment anywhere in the loop (as long as the</span></div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    <span class="comment">//   indvar Phi is its only user);</span></div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    <span class="comment">// - Upon computing Cmp, we effectively compute something equivalent to the</span></div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    <span class="comment">//   IV increment (despite it loops differently in the IR). So moving it up</span></div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    <span class="comment">//   to the cmp point does not really increase register pressure.</span></div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;  }</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160; </div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;  <span class="comment">// We allow matching the canonical IR (add X, C) back to (usubo X, -C).</span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;  <span class="keywordflow">if</span> (BO-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec">Instruction::Add</a> &amp;&amp;</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;      IID == Intrinsic::usub_with_overflow) {</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isa&lt;Constant&gt;(Arg1) &amp;&amp; <span class="stringliteral">&quot;Unexpected input for usubo&quot;</span>);</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;    Arg1 = <a class="code" href="classllvm_1_1ConstantExpr.html#afa29f0cd072ab9b3a2630681ffe5760f">ConstantExpr::getNeg</a>(cast&lt;Constant&gt;(Arg1));</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;  }</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160; </div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;  <span class="comment">// Insert at the first instruction of the pair.</span></div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *InsertPt = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;Iter : *<a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getParent()) {</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;    <span class="comment">// If BO is an XOR, it is not guaranteed that it comes after both inputs to</span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    <span class="comment">// the overflow intrinsic are defined.</span></div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    <span class="keywordflow">if</span> ((BO-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() != Instruction::Xor &amp;&amp; &amp;Iter == BO) || &amp;Iter == Cmp) {</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;      InsertPt = &amp;Iter;</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    }</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;  }</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InsertPt != <span class="keyword">nullptr</span> &amp;&amp; <span class="stringliteral">&quot;Parent block did not contain cmp or binop&quot;</span>);</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160; </div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(InsertPt);</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *MathOV = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBinaryIntrinsic(IID, Arg0, Arg1);</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;  <span class="keywordflow">if</span> (BO-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() != Instruction::Xor) {</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Math = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateExtractValue(MathOV, 0, <span class="stringliteral">&quot;math&quot;</span>);</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(BO, Math, FreshBBs, IsHugeFunc);</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;  } <span class="keywordflow">else</span></div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BO-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp;</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;           <span class="stringliteral">&quot;Patterns with XOr should use the BO only in the compare&quot;</span>);</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *OV = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateExtractValue(MathOV, 1, <span class="stringliteral">&quot;ov&quot;</span>);</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;  <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(Cmp, OV, FreshBBs, IsHugeFunc);</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;  <a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;  BO-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;}</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;<span class="comment">/// Match special-case patterns that check for unsigned add overflow.</span></div>
<div class="line"><a name="l01549"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#af23979229be4fb2286896bf920e3e235"> 1549</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CodeGenPrepare_8cpp.html#af23979229be4fb2286896bf920e3e235">matchUAddWithOverflowConstantEdgeCases</a>(<a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a> *Cmp,</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;                                                   <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *&amp;Add) {</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;  <span class="comment">// Add = add A, 1; Cmp = icmp eq A,-1 (overflow if A is max val)</span></div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;  <span class="comment">// Add = add A,-1; Cmp = icmp ne A, 0 (overflow if A is non-zero)</span></div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *A = Cmp-&gt;getOperand(0), *<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a> = Cmp-&gt;getOperand(1);</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160; </div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;  <span class="comment">// We are not expecting non-canonical/degenerate code. Just bail out.</span></div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;  <span class="keywordflow">if</span> (isa&lt;Constant&gt;(A))</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160; </div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;  <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> Pred = Cmp-&gt;getPredicate();</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;  <span class="keywordflow">if</span> (Pred == <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP_EQ</a> &amp;&amp; <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#aaea0d5ebb8b57ddde2095f80e2e94bb2">m_AllOnes</a>()))</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;    <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a> = <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>-&gt;getType(), 1);</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Pred == <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP_NE</a> &amp;&amp; <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#a874d53817a4923de8e58af6b278c09b0">m_ZeroInt</a>()))</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a> = <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>-&gt;getType(), -1);</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160; </div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;  <span class="comment">// Check the users of the variable operand of the compare looking for an add</span></div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;  <span class="comment">// with the adjusted constant.</span></div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1User.html">User</a> *U : A-&gt;users()) {</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(U, <a class="code" href="namespacellvm_1_1PatternMatch.html#a944c25ac9b73b02a17a20a08a25b9b21">m_Add</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">m_Specific</a>(A), <a class="code" href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">m_Specific</a>(<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>)))) {</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;      Add = cast&lt;BinaryOperator&gt;(U);</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    }</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;  }</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;}</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;<span class="comment">/// Try to combine the compare into a call to the llvm.uadd.with.overflow</span></div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;<span class="comment">/// intrinsic. Return true if any changes were made.</span></div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CodeGenPrepare::combineToUAddWithOverflow(<a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a> *Cmp,</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;                                               ModifyDT &amp;ModifiedDT) {</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>, *<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>;</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;  <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec">Add</a>;</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Cmp, <a class="code" href="namespacellvm_1_1PatternMatch.html#a435102a3ba336fd6223f84a475868e09">m_UAddWithOverflow</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(A), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#a43ac4fbaaf63a88eb5ac05f6d3e5649c">m_BinOp</a>(Add)))) {</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="CodeGenPrepare_8cpp.html#af23979229be4fb2286896bf920e3e235">matchUAddWithOverflowConstantEdgeCases</a>(Cmp, Add))</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;    <span class="comment">// Set A and B in case we match matchUAddWithOverflowConstantEdgeCases.</span></div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    <a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a> = <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec">Add</a>-&gt;getOperand(0);</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;    <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a> = <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec">Add</a>-&gt;getOperand(1);</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;  }</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160; </div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;  <span class="keywordflow">if</span> (!TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a1b6f74fbe8b15567434fa5d20a540c5c">shouldFormOverflowOp</a>(<a class="code" href="namespacellvm_1_1ISD.html#a22ea9cec080dd5f4f47ba234c2f59110a1ddf36330110b4abea43fe390bea9ef9">ISD::UADDO</a>,</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;                                 TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(*<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec">Add</a>-&gt;getType()),</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;                                 <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec">Add</a>-&gt;hasNUsesOrMore(2)))</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160; </div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;  <span class="comment">// We don&#39;t want to move around uses of condition values this late, so we</span></div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;  <span class="comment">// check if it is legal to create the call to the intrinsic in the basic</span></div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;  <span class="comment">// block containing the icmp.</span></div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec">Add</a>-&gt;getParent() != <a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getParent() &amp;&amp; !<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec">Add</a>-&gt;hasOneUse())</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160; </div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;  <span class="keywordflow">if</span> (!replaceMathCmpWithIntrinsic(Add, A, <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>, Cmp,</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;                                   Intrinsic::uadd_with_overflow))</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160; </div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;  <span class="comment">// Reset callers - do not crash by iterating over a dead instruction.</span></div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;  ModifiedDT = ModifyDT::ModifyInstDT;</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;}</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160; </div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;<span class="keywordtype">bool</span> CodeGenPrepare::combineToUSubWithOverflow(<a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a> *Cmp,</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;                                               ModifyDT &amp;ModifiedDT) {</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;  <span class="comment">// We are not expecting non-canonical/degenerate code. Just bail out.</span></div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a> = <a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getOperand(0), *<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a> = <a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getOperand(1);</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;  <span class="keywordflow">if</span> (isa&lt;Constant&gt;(A) &amp;&amp; isa&lt;Constant&gt;(<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>))</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160; </div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;  <span class="comment">// Convert (A u&gt; B) to (A u&lt; B) to simplify pattern matching.</span></div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;  <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> Pred = <a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getPredicate();</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;  <span class="keywordflow">if</span> (Pred == <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba607cecdc5172814382033e001ed11fad">ICmpInst::ICMP_UGT</a>) {</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;    <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(A, <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>);</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;    Pred = <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP_ULT</a>;</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;  }</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;  <span class="comment">// Convert special-case: (A == 0) is the same as (A u&lt; 1).</span></div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;  <span class="keywordflow">if</span> (Pred == <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP_EQ</a> &amp;&amp; <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#a874d53817a4923de8e58af6b278c09b0">m_ZeroInt</a>())) {</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a> = <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>-&gt;getType(), 1);</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;    Pred = <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP_ULT</a>;</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;  }</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;  <span class="comment">// Convert special-case: (A != 0) is the same as (0 u&lt; A).</span></div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;  <span class="keywordflow">if</span> (Pred == <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP_NE</a> &amp;&amp; <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#a874d53817a4923de8e58af6b278c09b0">m_ZeroInt</a>())) {</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(A, <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>);</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;    Pred = <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP_ULT</a>;</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;  }</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;  <span class="keywordflow">if</span> (Pred != <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP_ULT</a>)</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160; </div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;  <span class="comment">// Walk the users of a variable operand of a compare looking for a subtract or</span></div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;  <span class="comment">// add with that same operand. Also match the 2nd operand of the compare to</span></div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;  <span class="comment">// the add/sub, but that may be a negated constant operand of an add.</span></div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *CmpVariableOperand = isa&lt;Constant&gt;(A) ? <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a> : <a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>;</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;  <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *Sub = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1User.html">User</a> *U : CmpVariableOperand-&gt;<a class="code" href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">users</a>()) {</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    <span class="comment">// A - B, A u&lt; B --&gt; usubo(A, B)</span></div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(U, <a class="code" href="namespacellvm_1_1PatternMatch.html#ac3ed5602889a22db44a16e1b97fac5b8">m_Sub</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">m_Specific</a>(A), <a class="code" href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">m_Specific</a>(<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>)))) {</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;      Sub = cast&lt;BinaryOperator&gt;(U);</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;    }</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160; </div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;    <span class="comment">// A + (-C), A u&lt; C (canonicalized form of (sub A, C))</span></div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> *CmpC, *AddC;</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(U, <a class="code" href="namespacellvm_1_1PatternMatch.html#a944c25ac9b73b02a17a20a08a25b9b21">m_Add</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">m_Specific</a>(A), <a class="code" href="namespacellvm_1_1PatternMatch.html#aac9e78b3aa02ec087c4621358f506718">m_APInt</a>(AddC))) &amp;&amp;</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;        <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#aac9e78b3aa02ec087c4621358f506718">m_APInt</a>(CmpC)) &amp;&amp; *AddC == -(*CmpC)) {</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;      Sub = cast&lt;BinaryOperator&gt;(U);</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    }</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;  }</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;  <span class="keywordflow">if</span> (!Sub)</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160; </div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;  <span class="keywordflow">if</span> (!TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a1b6f74fbe8b15567434fa5d20a540c5c">shouldFormOverflowOp</a>(<a class="code" href="namespacellvm_1_1ISD.html#a22ea9cec080dd5f4f47ba234c2f59110a4ffc75d65231b55461c0ba4f36a3e500">ISD::USUBO</a>,</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;                                 TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(*<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, Sub-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()),</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;                                 Sub-&gt;<a class="code" href="classllvm_1_1Value.html#a72fb137716cff838d389e392b9729dc9">hasNUsesOrMore</a>(2)))</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160; </div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;  <span class="keywordflow">if</span> (!replaceMathCmpWithIntrinsic(Sub, Sub-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), Sub-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1),</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;                                   Cmp, Intrinsic::usub_with_overflow))</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160; </div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;  <span class="comment">// Reset callers - do not crash by iterating over a dead instruction.</span></div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;  ModifiedDT = ModifyDT::ModifyInstDT;</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;}</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;<span class="comment">/// Sink the given CmpInst into user blocks to reduce the number of virtual</span></div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;<span class="comment">/// registers that must be created and coalesced. This is a clear win except on</span></div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;<span class="comment">/// targets with multiple condition code registers (PowerPC), where it might</span></div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;<span class="comment">/// lose; some adjustment may be wanted there.</span></div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;<span class="comment">/// Return true if any changes are made.</span></div>
<div class="line"><a name="l01681"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#a24a3e4aad4cb2fdde7ce294a531cd52a"> 1681</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CodeGenPrepare_8cpp.html#a24a3e4aad4cb2fdde7ce294a531cd52a">sinkCmpExpression</a>(<a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a> *Cmp, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI) {</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;  <span class="keywordflow">if</span> (TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#aa00abc9ed22bfa32ebd68531b619b005">hasMultipleConditionRegisters</a>())</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160; </div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;  <span class="comment">// Avoid sinking soft-FP comparisons, since this can move them into a loop.</span></div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;  <span class="keywordflow">if</span> (TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#aca632fc83dfd8f23f3456ef50a49e31a">useSoftFloat</a>() &amp;&amp; isa&lt;FCmpInst&gt;(Cmp))</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160; </div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;  <span class="comment">// Only insert a cmp in each block once.</span></div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;BasicBlock *, CmpInst *&gt;</a> InsertedCmps;</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160; </div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html#acd2fbee42afeb868be98aaae56528636">Value::user_iterator</a> UI = Cmp-&gt;user_begin(), <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = Cmp-&gt;user_end();</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;       UI != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>;) {</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;    <a class="code" href="classllvm_1_1Use.html">Use</a> &amp;TheUse = UI.getUse();</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1User.html">User</a> = cast&lt;Instruction&gt;(*UI);</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160; </div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;    <span class="comment">// Preincrement use iterator so we don&#39;t invalidate it.</span></div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;    ++UI;</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160; </div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    <span class="comment">// Don&#39;t bother for PHI nodes.</span></div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;    <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(<a class="code" href="classllvm_1_1User.html">User</a>))</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160; </div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    <span class="comment">// Figure out which BB this cmp is used in.</span></div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *UserBB = <a class="code" href="classllvm_1_1User.html">User</a>-&gt;getParent();</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *DefBB = Cmp-&gt;getParent();</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160; </div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    <span class="comment">// If this user is in the same block as the cmp, don&#39;t change the cmp.</span></div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    <span class="keywordflow">if</span> (UserBB == DefBB)</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160; </div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    <span class="comment">// If we have already inserted a cmp into this block, use it.</span></div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    <a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a> *&amp;InsertedCmp = InsertedCmps[UserBB];</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160; </div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    <span class="keywordflow">if</span> (!InsertedCmp) {</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPt = UserBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InsertPt != UserBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;      InsertedCmp = <a class="code" href="classllvm_1_1CmpInst.html#a3b4a54b076454fec43b13554b28252a9">CmpInst::Create</a>(Cmp-&gt;getOpcode(), Cmp-&gt;getPredicate(),</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;                                    Cmp-&gt;getOperand(0), Cmp-&gt;getOperand(1), <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;                                    &amp;*InsertPt);</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;      <span class="comment">// Propagate the debug info.</span></div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;      InsertedCmp-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(Cmp-&gt;getDebugLoc());</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;    }</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160; </div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;    <span class="comment">// Replace a use of the cmp with a use of the new cmp.</span></div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;    TheUse = InsertedCmp;</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;    MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;    ++NumCmpUses;</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;  }</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160; </div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;  <span class="comment">// If we removed all uses, nuke the cmp.</span></div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;  <span class="keywordflow">if</span> (Cmp-&gt;use_empty()) {</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;    Cmp-&gt;eraseFromParent();</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;    MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;  }</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160; </div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;}</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;<span class="comment">/// For pattern like:</span></div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;<span class="comment">///   DomCond = icmp sgt/slt CmpOp0, CmpOp1 (might not be in DomBB)</span></div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;<span class="comment">///   ...</span></div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;<span class="comment">/// DomBB:</span></div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;<span class="comment">///   ...</span></div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;<span class="comment">///   br DomCond, TrueBB, CmpBB</span></div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;<span class="comment">/// CmpBB: (with DomBB being the single predecessor)</span></div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;<span class="comment">///   ...</span></div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;<span class="comment">///   Cmp = icmp eq CmpOp0, CmpOp1</span></div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;<span class="comment">///   ...</span></div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;<span class="comment">/// It would use two comparison on targets that lowering of icmp sgt/slt is</span></div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;<span class="comment">/// different from lowering of icmp eq (PowerPC). This function try to convert</span></div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;<span class="comment">/// &#39;Cmp = icmp eq CmpOp0, CmpOp1&#39; to &#39; Cmp = icmp slt/sgt CmpOp0, CmpOp1&#39;.</span></div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;<span class="comment">/// After that, DomCond and Cmp can use the same comparison so reduce one</span></div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;<span class="comment">/// comparison.</span></div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;<span class="comment">/// Return true if any changes are made.</span></div>
<div class="line"><a name="l01760"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#a98c59bcf49cb7343886e8f425d6d877b"> 1760</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CodeGenPrepare_8cpp.html#a98c59bcf49cb7343886e8f425d6d877b">foldICmpWithDominatingICmp</a>(<a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a> *Cmp,</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;                                       <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI) {</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="CodeGenPrepare_8cpp.html#aff1b7225e361646f1310cc578b2163c3">EnableICMP_EQToICMP_ST</a> &amp;&amp; TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#a18c621c39394892e502cf03313e04bf7">isEqualityCmpFoldedWithSignedCmp</a>())</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160; </div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;  <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> Pred = Cmp-&gt;getPredicate();</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;  <span class="keywordflow">if</span> (Pred != <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP_EQ</a>)</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160; </div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;  <span class="comment">// If icmp eq has users other than BranchInst and SelectInst, converting it to</span></div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;  <span class="comment">// icmp slt/sgt would introduce more redundant LLVM IR.</span></div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1User.html">User</a> *U : Cmp-&gt;users()) {</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;    <span class="keywordflow">if</span> (isa&lt;BranchInst&gt;(U))</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;    <span class="keywordflow">if</span> (isa&lt;SelectInst&gt;(U) &amp;&amp; cast&lt;SelectInst&gt;(U)-&gt;getCondition() == Cmp)</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;  }</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160; </div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;  <span class="comment">// This is a cheap/incomplete check for dominance - just match a single</span></div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;  <span class="comment">// predecessor with a conditional branch.</span></div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *CmpBB = Cmp-&gt;getParent();</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *DomBB = CmpBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;  <span class="keywordflow">if</span> (!DomBB)</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160; </div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;  <span class="comment">// We want to ensure that the only way control gets to the comparison of</span></div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;  <span class="comment">// interest is that a less/greater than comparison on the same operands is</span></div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;  <span class="comment">// false.</span></div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *DomCond;</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *TrueBB, *FalseBB;</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(DomBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a4fd27a44c5fd9958fdd9150622129cd3">m_Br</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(DomCond), TrueBB, FalseBB)))</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;  <span class="keywordflow">if</span> (CmpBB != FalseBB)</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160; </div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *CmpOp0 = Cmp-&gt;getOperand(0), *CmpOp1 = Cmp-&gt;getOperand(1);</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;  <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> DomPred;</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(DomCond, <a class="code" href="namespacellvm_1_1PatternMatch.html#a3fe9b3ddb71b9fb53d9fc74b3a0710bf">m_ICmp</a>(DomPred, <a class="code" href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">m_Specific</a>(CmpOp0), <a class="code" href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">m_Specific</a>(CmpOp1))))</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;  <span class="keywordflow">if</span> (DomPred != <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba720a42e85f7e981afd61e28473b0000a">ICmpInst::ICMP_SGT</a> &amp;&amp; DomPred != <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba15ae464950ac676919c2f0c7aafc706c">ICmpInst::ICMP_SLT</a>)</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160; </div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;  <span class="comment">// Convert the equality comparison to the opposite of the dominating</span></div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;  <span class="comment">// comparison and swap the direction for all branch/select users.</span></div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;  <span class="comment">// We have conceptually converted:</span></div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;  <span class="comment">// Res = (a &lt; b) ? &lt;LT_RES&gt; : (a == b) ? &lt;EQ_RES&gt; : &lt;GT_RES&gt;;</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;  <span class="comment">// to</span></div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;  <span class="comment">// Res = (a &lt; b) ? &lt;LT_RES&gt; : (a &gt; b)  ? &lt;GT_RES&gt; : &lt;EQ_RES&gt;;</span></div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;  <span class="comment">// And similarly for branches.</span></div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1User.html">User</a> *U : Cmp-&gt;users()) {</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *BI = dyn_cast&lt;BranchInst&gt;(U)) {</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() &amp;&amp; <span class="stringliteral">&quot;Must be conditional&quot;</span>);</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;      BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a6550fe5bd437c1c3c6e237d726e36b90">swapSuccessors</a>();</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;    }</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;SelectInst&gt;(U)) {</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;      <span class="comment">// Swap operands</span></div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;      <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;swapValues();</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;      <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;swapProfMetadata();</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;    }</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;    <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Must be a branch or a select&quot;</span>);</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;  }</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;  Cmp-&gt;setPredicate(<a class="code" href="classllvm_1_1CmpInst.html#a49a2d8f483ea08a3d6ea75f90c640d76">CmpInst::getSwappedPredicate</a>(DomPred));</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;}</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160; </div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;<span class="keywordtype">bool</span> CodeGenPrepare::optimizeCmp(<a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a> *Cmp, ModifyDT &amp;ModifiedDT) {</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="CodeGenPrepare_8cpp.html#a24a3e4aad4cb2fdde7ce294a531cd52a">sinkCmpExpression</a>(Cmp, *TLI))</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160; </div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;  <span class="keywordflow">if</span> (combineToUAddWithOverflow(Cmp, ModifiedDT))</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160; </div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;  <span class="keywordflow">if</span> (combineToUSubWithOverflow(Cmp, ModifiedDT))</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160; </div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="CodeGenPrepare_8cpp.html#a98c59bcf49cb7343886e8f425d6d877b">foldICmpWithDominatingICmp</a>(Cmp, *TLI))</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160; </div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;}</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;<span class="comment">/// Duplicate and sink the given &#39;and&#39; instruction into user blocks where it is</span></div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;<span class="comment">/// used in a compare to allow isel to generate better code for targets where</span></div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;<span class="comment">/// this operation can be combined.</span></div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;<span class="comment">/// Return true if any changes are made.</span></div>
<div class="line"><a name="l01849"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#a0049977ff1075a98e9f512bbf4d181a6"> 1849</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CodeGenPrepare_8cpp.html#a0049977ff1075a98e9f512bbf4d181a6">sinkAndCmp0Expression</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *AndI, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI,</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;                                  SetOfInstrs &amp;InsertedInsts) {</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;  <span class="comment">// Double-check that we&#39;re not trying to optimize an instruction that was</span></div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;  <span class="comment">// already optimized by some other part of this pass.</span></div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!InsertedInsts.count(AndI) &amp;&amp;</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;         <span class="stringliteral">&quot;Attempting to optimize already optimized and instruction&quot;</span>);</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;  (void)InsertedInsts;</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160; </div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;  <span class="comment">// Nothing to do for single use in same basic block.</span></div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;  <span class="keywordflow">if</span> (AndI-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp;</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;      AndI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() == cast&lt;Instruction&gt;(*AndI-&gt;<a class="code" href="classllvm_1_1Value.html#a158da2b6d3d938aaa15b6acd00150e2c">user_begin</a>())-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a38bee869ad41aebfef3de2641b12004c">getParent</a>())</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160; </div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;  <span class="comment">// Try to avoid cases where sinking/duplicating is likely to increase register</span></div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;  <span class="comment">// pressure.</span></div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;  <span class="keywordflow">if</span> (!isa&lt;ConstantInt&gt;(AndI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)) &amp;&amp;</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;      !isa&lt;ConstantInt&gt;(AndI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1)) &amp;&amp;</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;      AndI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; AndI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1)-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160; </div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *U : AndI-&gt;<a class="code" href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">users</a>()) {</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1User.html">User</a> = cast&lt;Instruction&gt;(U);</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160; </div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;    <span class="comment">// Only sink &#39;and&#39; feeding icmp with 0.</span></div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;    <span class="keywordflow">if</span> (!isa&lt;ICmpInst&gt;(<a class="code" href="classllvm_1_1User.html">User</a>))</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160; </div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    <span class="keyword">auto</span> *CmpC = dyn_cast&lt;ConstantInt&gt;(<a class="code" href="classllvm_1_1User.html">User</a>-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1));</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;    <span class="keywordflow">if</span> (!CmpC || !CmpC-&gt;<a class="code" href="classllvm_1_1APInt.html#a49cd5939942c6665aba4cae8c220dff1">isZero</a>())</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;  }</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160; </div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;  <span class="keywordflow">if</span> (!TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#a1f8d2859994eb10cdca39be26aa929bc">isMaskAndCmp0FoldingBeneficial</a>(*AndI))</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160; </div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;found &#39;and&#39; feeding only icmp 0;\n&quot;</span>);</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(AndI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#af7dca9a9e816ef69fd9e9467f64f72b4">dump</a>());</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160; </div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;  <span class="comment">// Push the &#39;and&#39; into the same block as the icmp 0.  There should only be</span></div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;  <span class="comment">// one (icmp (and, 0)) in each block, since CSE/GVN should have removed any</span></div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;  <span class="comment">// others, so we don&#39;t need to keep track of which BBs we insert into.</span></div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html#acd2fbee42afeb868be98aaae56528636">Value::user_iterator</a> UI = AndI-&gt;<a class="code" href="classllvm_1_1Value.html#a158da2b6d3d938aaa15b6acd00150e2c">user_begin</a>(), <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = AndI-&gt;<a class="code" href="classllvm_1_1Value.html#aa22118b2b3f206bfda2ffab4cda94d64">user_end</a>();</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;       UI != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>;) {</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;    <a class="code" href="classllvm_1_1Use.html">Use</a> &amp;TheUse = UI.getUse();</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1User.html">User</a> = cast&lt;Instruction&gt;(*UI);</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160; </div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;    <span class="comment">// Preincrement use iterator so we don&#39;t invalidate it.</span></div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;    ++UI;</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160; </div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;sinking &#39;and&#39; use: &quot;</span> &lt;&lt; *<a class="code" href="classllvm_1_1User.html">User</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160; </div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;    <span class="comment">// Keep the &#39;and&#39; in the same place if the use is already in the same block.</span></div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *InsertPt =</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;        <a class="code" href="classllvm_1_1User.html">User</a>-&gt;getParent() == AndI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() ? AndI : <a class="code" href="classllvm_1_1User.html">User</a>;</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *InsertedAnd =</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;        <a class="code" href="classllvm_1_1BinaryOperator.html#a02ce9966395063ac501ecbc1623deda4">BinaryOperator::Create</a>(Instruction::And, AndI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0),</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;                               AndI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1), <span class="stringliteral">&quot;&quot;</span>, InsertPt);</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;    <span class="comment">// Propagate the debug info.</span></div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;    InsertedAnd-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(AndI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4f3bf98b5054831b608852e33427814">getDebugLoc</a>());</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160; </div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;    <span class="comment">// Replace a use of the &#39;and&#39; with a use of the new &#39;and&#39;.</span></div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;    TheUse = InsertedAnd;</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;    ++NumAndUses;</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="classllvm_1_1User.html">User</a>-&gt;getParent()-&gt;<a class="code" href="classllvm_1_1Value.html#af7dca9a9e816ef69fd9e9467f64f72b4">dump</a>());</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;  }</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160; </div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;  <span class="comment">// We removed all uses, nuke the and.</span></div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;  AndI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;}</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;<span class="comment">/// Check if the candidates could be combined with a shift instruction, which</span></div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;<span class="comment">/// includes:</span></div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;<span class="comment">/// 1. Truncate instruction</span></div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;<span class="comment">/// 2. And instruction and the imm is a mask of the low bits:</span></div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;<span class="comment">/// imm &amp; (imm+1) == 0</span></div>
<div class="line"><a name="l01925"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#a19e2fd6fce422c4ab3cea555782abbb6"> 1925</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CodeGenPrepare_8cpp.html#a19e2fd6fce422c4ab3cea555782abbb6">isExtractBitsCandidateUse</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1User.html">User</a>) {</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;  <span class="keywordflow">if</span> (!isa&lt;TruncInst&gt;(<a class="code" href="classllvm_1_1User.html">User</a>)) {</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1User.html">User</a>-&gt;getOpcode() != Instruction::And ||</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;        !isa&lt;ConstantInt&gt;(<a class="code" href="classllvm_1_1User.html">User</a>-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1)))</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160; </div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;Cimm = cast&lt;ConstantInt&gt;(<a class="code" href="classllvm_1_1User.html">User</a>-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1))-&gt;getValue();</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160; </div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    <span class="keywordflow">if</span> ((Cimm &amp; (Cimm + 1)).getBoolValue())</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;  }</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;}</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;<span class="comment">/// Sink both shift and truncate instruction to the use of truncate&#39;s BB.</span></div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="line"><a name="l01941"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#a0327169186859791aafa580e4fb547e2"> 1941</a></span>&#160;<a class="code" href="CodeGenPrepare_8cpp.html#a0327169186859791aafa580e4fb547e2">SinkShiftAndTruncate</a>(<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *ShiftI, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1User.html">User</a>, <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CI,</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;                     <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;BasicBlock *, BinaryOperator *&gt;</a> &amp;InsertedShifts,</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;                     <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>) {</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *UserBB = <a class="code" href="classllvm_1_1User.html">User</a>-&gt;getParent();</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;BasicBlock *, CastInst *&gt;</a> InsertedTruncs;</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;  <span class="keyword">auto</span> *TruncI = cast&lt;TruncInst&gt;(<a class="code" href="classllvm_1_1User.html">User</a>);</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160; </div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html#acd2fbee42afeb868be98aaae56528636">Value::user_iterator</a> TruncUI = TruncI-&gt;user_begin(),</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;                            TruncE = TruncI-&gt;user_end();</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;       TruncUI != TruncE;) {</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160; </div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;    <a class="code" href="classllvm_1_1Use.html">Use</a> &amp;TruncTheUse = TruncUI.getUse();</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TruncUser = cast&lt;Instruction&gt;(*TruncUI);</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;    <span class="comment">// Preincrement use iterator so we don&#39;t invalidate it.</span></div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160; </div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;    ++TruncUI;</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160; </div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;    <span class="keywordtype">int</span> ISDOpcode = TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#a025e6664b2f55d2c217543c34eb1f64e">InstructionOpcodeToISD</a>(TruncUser-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>());</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;    <span class="keywordflow">if</span> (!ISDOpcode)</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160; </div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;    <span class="comment">// If the use is actually a legal node, there will not be an</span></div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;    <span class="comment">// implicit truncate.</span></div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;    <span class="comment">// FIXME: always querying the result type is just an</span></div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;    <span class="comment">// approximation; some nodes&#39; legality is determined by the</span></div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;    <span class="comment">// operand or other means. There&#39;s no good way to find out though.</span></div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;    <span class="keywordflow">if</span> (TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#aa93fbbc66d52a51d178af8ac4398ec05">isOperationLegalOrCustom</a>(</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;            ISDOpcode, TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, TruncUser-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), <span class="keyword">true</span>)))</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160; </div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;    <span class="comment">// Don&#39;t bother for PHI nodes.</span></div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;    <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(TruncUser))</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160; </div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *TruncUserBB = TruncUser-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160; </div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;    <span class="keywordflow">if</span> (UserBB == TruncUserBB)</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160; </div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;    <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *&amp;InsertedShift = InsertedShifts[TruncUserBB];</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;    <a class="code" href="classllvm_1_1CastInst.html">CastInst</a> *&amp;InsertedTrunc = InsertedTruncs[TruncUserBB];</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160; </div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;    <span class="keywordflow">if</span> (!InsertedShift &amp;&amp; !InsertedTrunc) {</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPt = TruncUserBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InsertPt != TruncUserBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;      <span class="comment">// Sink the shift</span></div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;      <span class="keywordflow">if</span> (ShiftI-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::AShr)</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;        InsertedShift = BinaryOperator::CreateAShr(ShiftI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), CI,</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;                                                   <span class="stringliteral">&quot;&quot;</span>, &amp;*InsertPt);</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;        InsertedShift = BinaryOperator::CreateLShr(ShiftI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), CI,</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;                                                   <span class="stringliteral">&quot;&quot;</span>, &amp;*InsertPt);</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;      InsertedShift-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(ShiftI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4f3bf98b5054831b608852e33427814">getDebugLoc</a>());</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160; </div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;      <span class="comment">// Sink the trunc</span></div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> TruncInsertPt = TruncUserBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;      TruncInsertPt++;</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TruncInsertPt != TruncUserBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160; </div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;      InsertedTrunc = <a class="code" href="classllvm_1_1CastInst.html#a643fe5a9e7042f032dae78109c2b1e72">CastInst::Create</a>(TruncI-&gt;getOpcode(), InsertedShift,</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;                                       TruncI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), <span class="stringliteral">&quot;&quot;</span>, &amp;*TruncInsertPt);</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;      InsertedTrunc-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(TruncI-&gt;getDebugLoc());</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160; </div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;      MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160; </div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;      TruncTheUse = InsertedTrunc;</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;    }</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;  }</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;}</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;<span class="comment">/// Sink the shift *right* instruction into user blocks if the uses could</span></div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;<span class="comment">/// potentially be combined with this shift instruction and generate BitExtract</span></div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;<span class="comment">/// instruction. It will only be applied if the architecture supports BitExtract</span></div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;<span class="comment">/// instruction. Here is an example:</span></div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;<span class="comment">/// BB1:</span></div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;<span class="comment">///   %x.extract.shift = lshr i64 %arg1, 32</span></div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;<span class="comment">/// BB2:</span></div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;<span class="comment">///   %x.extract.trunc = trunc i64 %x.extract.shift to i16</span></div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;<span class="comment">/// ==&gt;</span></div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;<span class="comment">/// BB2:</span></div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;<span class="comment">///   %x.extract.shift.1 = lshr i64 %arg1, 32</span></div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;<span class="comment">///   %x.extract.trunc = trunc i64 %x.extract.shift.1 to i16</span></div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;<span class="comment">/// CodeGen will recognize the pattern in BB2 and generate BitExtract</span></div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;<span class="comment">/// instruction.</span></div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;<span class="comment">/// Return true if any changes are made.</span></div>
<div class="line"><a name="l02030"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#a2c05548feac70b16d31caf0cfb225714"> 2030</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CodeGenPrepare_8cpp.html#a2c05548feac70b16d31caf0cfb225714">OptimizeExtractBits</a>(<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *ShiftI, <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CI,</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;                                <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI,</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;                                <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>) {</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *DefBB = ShiftI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;<span class="comment">  /// Only insert instructions in each block once.</span></div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;BasicBlock *, BinaryOperator *&gt;</a> InsertedShifts;</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160; </div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;  <span class="keywordtype">bool</span> shiftIsLegal = TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#a80b305b278aa0e04f80312e15b2b6d54">isTypeLegal</a>(TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, ShiftI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()));</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160; </div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html#acd2fbee42afeb868be98aaae56528636">Value::user_iterator</a> UI = ShiftI-&gt;<a class="code" href="classllvm_1_1Value.html#a158da2b6d3d938aaa15b6acd00150e2c">user_begin</a>(), <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = ShiftI-&gt;<a class="code" href="classllvm_1_1Value.html#aa22118b2b3f206bfda2ffab4cda94d64">user_end</a>();</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;       UI != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>;) {</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;    <a class="code" href="classllvm_1_1Use.html">Use</a> &amp;TheUse = UI.getUse();</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1User.html">User</a> = cast&lt;Instruction&gt;(*UI);</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;    <span class="comment">// Preincrement use iterator so we don&#39;t invalidate it.</span></div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;    ++UI;</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160; </div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;    <span class="comment">// Don&#39;t bother for PHI nodes.</span></div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;    <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(<a class="code" href="classllvm_1_1User.html">User</a>))</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160; </div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="CodeGenPrepare_8cpp.html#a19e2fd6fce422c4ab3cea555782abbb6">isExtractBitsCandidateUse</a>(<a class="code" href="classllvm_1_1User.html">User</a>))</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160; </div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *UserBB = <a class="code" href="classllvm_1_1User.html">User</a>-&gt;getParent();</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160; </div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;    <span class="keywordflow">if</span> (UserBB == DefBB) {</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;      <span class="comment">// If the shift and truncate instruction are in the same BB. The use of</span></div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;      <span class="comment">// the truncate(TruncUse) may still introduce another truncate if not</span></div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;      <span class="comment">// legal. In this case, we would like to sink both shift and truncate</span></div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;      <span class="comment">// instruction to the BB of TruncUse.</span></div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;      <span class="comment">// for example:</span></div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;      <span class="comment">// BB1:</span></div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;      <span class="comment">// i64 shift.result = lshr i64 opnd, imm</span></div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;      <span class="comment">// trunc.result = trunc shift.result to i16</span></div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;      <span class="comment">// BB2:</span></div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;      <span class="comment">//   ----&gt; We will have an implicit truncate here if the architecture does</span></div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;      <span class="comment">//   not have i16 compare.</span></div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;      <span class="comment">// cmp i16 trunc.result, opnd2</span></div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;      <span class="keywordflow">if</span> (isa&lt;TruncInst&gt;(<a class="code" href="classllvm_1_1User.html">User</a>) &amp;&amp;</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;          shiftIsLegal</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;          <span class="comment">// If the type of the truncate is legal, no truncate will be</span></div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;          <span class="comment">// introduced in other basic blocks.</span></div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;          &amp;&amp; (!TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#a80b305b278aa0e04f80312e15b2b6d54">isTypeLegal</a>(TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="classllvm_1_1User.html">User</a>-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()))))</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;        MadeChange =</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;            <a class="code" href="CodeGenPrepare_8cpp.html#a0327169186859791aafa580e4fb547e2">SinkShiftAndTruncate</a>(ShiftI, <a class="code" href="classllvm_1_1User.html">User</a>, CI, InsertedShifts, TLI, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160; </div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;    }</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;    <span class="comment">// If we have already inserted a shift into this block, use it.</span></div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;    <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *&amp;InsertedShift = InsertedShifts[UserBB];</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160; </div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;    <span class="keywordflow">if</span> (!InsertedShift) {</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPt = UserBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InsertPt != UserBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160; </div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;      <span class="keywordflow">if</span> (ShiftI-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::AShr)</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;        InsertedShift = BinaryOperator::CreateAShr(ShiftI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), CI,</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;                                                   <span class="stringliteral">&quot;&quot;</span>, &amp;*InsertPt);</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;        InsertedShift = BinaryOperator::CreateLShr(ShiftI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), CI,</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;                                                   <span class="stringliteral">&quot;&quot;</span>, &amp;*InsertPt);</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;      InsertedShift-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(ShiftI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4f3bf98b5054831b608852e33427814">getDebugLoc</a>());</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160; </div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;      MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;    }</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160; </div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;    <span class="comment">// Replace a use of the shift with a use of the new shift.</span></div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;    TheUse = InsertedShift;</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;  }</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160; </div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;  <span class="comment">// If we removed all uses, or there are none, nuke the shift.</span></div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;  <span class="keywordflow">if</span> (ShiftI-&gt;<a class="code" href="classllvm_1_1Value.html#a9d7de807ebdfe1819df3ff6cb0f16158">use_empty</a>()) {</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;    <a class="code" href="namespacellvm.html#a26be1141b23850a2b4eb78021d99e862">salvageDebugInfo</a>(*ShiftI);</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;    ShiftI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;    MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;  }</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160; </div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;}</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;<span class="comment">/// If counting leading or trailing zeros is an expensive operation and a zero</span></div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;<span class="comment">/// input is defined, add a check for zero to avoid calling the intrinsic.</span></div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;<span class="comment">/// We want to transform:</span></div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;<span class="comment">///     %z = call i64 @llvm.cttz.i64(i64 %A, i1 false)</span></div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;<span class="comment">/// into:</span></div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;<span class="comment">///   entry:</span></div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;<span class="comment">///     %cmpz = icmp eq i64 %A, 0</span></div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;<span class="comment">///     br i1 %cmpz, label %cond.end, label %cond.false</span></div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;<span class="comment">///   cond.false:</span></div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;<span class="comment">///     %z = call i64 @llvm.cttz.i64(i64 %A, i1 true)</span></div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;<span class="comment">///     br label %cond.end</span></div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;<span class="comment">///   cond.end:</span></div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;<span class="comment">///     %ctz = phi i64 [ 64, %entry ], [ %z, %cond.false ]</span></div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;<span class="comment">/// If the transform is performed, return true and set ModifiedDT to true.</span></div>
<div class="line"><a name="l02131"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#aa159b7d2631747735a5f57877991d26f"> 2131</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CodeGenPrepare_8cpp.html#aa159b7d2631747735a5f57877991d26f">despeculateCountZeros</a>(<a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *CountZeros,</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;                                  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> *TLI,</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;                                  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, ModifyDT &amp;ModifiedDT,</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;                                  <a class="code" href="classllvm_1_1SmallSet.html">SmallSet&lt;BasicBlock *, 32&gt;</a> &amp;FreshBBs,</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;                                  <span class="keywordtype">bool</span> IsHugeFunc) {</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;  <span class="comment">// If a zero input is undefined, it doesn&#39;t make sense to despeculate that.</span></div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(CountZeros-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1), <a class="code" href="namespacellvm_1_1PatternMatch.html#aebdb2700a77d10ae6f0ce115e23d9f77">m_One</a>()))</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160; </div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;  <span class="comment">// If it&#39;s cheap to speculate, there&#39;s nothing to do.</span></div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty = CountZeros-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;  <span class="keyword">auto</span> IntrinsicID = CountZeros-&gt;<a class="code" href="classllvm_1_1IntrinsicInst.html#a7ff64b3625b6f9020556ed05a5f72af4">getIntrinsicID</a>();</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;  <span class="keywordflow">if</span> ((IntrinsicID == Intrinsic::cttz &amp;&amp; TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a42e6689af9067a1afe64eac0267deb01">isCheapToSpeculateCttz</a>(Ty)) ||</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;      (IntrinsicID == Intrinsic::ctlz &amp;&amp; TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#abe9a0c5ce415f4e7498d75deb8de0896">isCheapToSpeculateCtlz</a>(Ty)))</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160; </div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;  <span class="comment">// Only handle legal scalar cases. Anything else requires too much work.</span></div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;  <span class="keywordtype">unsigned</span> SizeInBits = Ty-&gt;<a class="code" href="classllvm_1_1Type.html#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;  <span class="keywordflow">if</span> (Ty-&gt;<a class="code" href="classllvm_1_1Type.html#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() || SizeInBits &gt; <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getLargestLegalIntTypeSizeInBits())</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160; </div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;  <span class="comment">// Bail if the value is never zero.</span></div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;  <a class="code" href="classllvm_1_1Use.html">Use</a> &amp;<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = CountZeros-&gt;<a class="code" href="classllvm_1_1User.html#a53d4e14158c5056fd1ed8f7b3da82f8a">getOperandUse</a>(0);</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a07256e6859fcb3b9d5eb02ecea9e9a38">isKnownNonZero</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160; </div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;  <span class="comment">// The intrinsic will be sunk behind a compare against zero and branch.</span></div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *StartBlock = CountZeros-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *CallBlock = StartBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(CountZeros, <span class="stringliteral">&quot;cond.false&quot;</span>);</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;  <span class="keywordflow">if</span> (IsHugeFunc)</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;    FreshBBs.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(CallBlock);</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160; </div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;  <span class="comment">// Create another block after the count zero intrinsic. A PHI will be added</span></div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;  <span class="comment">// in this block to select the result of the intrinsic or the bit-width</span></div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;  <span class="comment">// constant if the input to the intrinsic is zero.</span></div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> SplitPt = ++(<a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a>(CountZeros));</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *EndBlock = CallBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(SplitPt, <span class="stringliteral">&quot;cond.end&quot;</span>);</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;  <span class="keywordflow">if</span> (IsHugeFunc)</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;    FreshBBs.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(EndBlock);</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160; </div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;  <span class="comment">// Set up a builder to create a compare, conditional branch, and PHI.</span></div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(CountZeros-&gt;<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(StartBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>());</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetCurrentDebugLocation(CountZeros-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4f3bf98b5054831b608852e33427814">getDebugLoc</a>());</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160; </div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;  <span class="comment">// Replace the unconditional branch that was created by the first split with</span></div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;  <span class="comment">// a compare against zero and a conditional branch.</span></div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Zero = <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Ty);</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;  <span class="comment">// Avoid introducing branch on poison. This also replaces the ctz operand.</span></div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#ab8a7ef433279aabf7f30fa5504a4d4ef">isGuaranteedNotToBeUndefOrPoison</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>))</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;    <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateFreeze(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>, <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>-&gt;getName() + <span class="stringliteral">&quot;.fr&quot;</span>);</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Cmp = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateICmpEQ(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>, Zero, <span class="stringliteral">&quot;cmpz&quot;</span>);</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCondBr(Cmp, EndBlock, CallBlock);</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;  StartBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>()-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160; </div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;  <span class="comment">// Create a PHI in the end block to select either the output of the intrinsic</span></div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;  <span class="comment">// or the bit width of the operand.</span></div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(&amp;EndBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#ab706e7ebb1969c5e34f28bfcf2ff719e">front</a>());</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;  <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePHI(Ty, 2, <span class="stringliteral">&quot;ctz&quot;</span>);</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;  <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(CountZeros, PN, FreshBBs, IsHugeFunc);</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt(<a class="code" href="classllvm_1_1APInt.html">APInt</a>(SizeInBits, SizeInBits));</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;  PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(<a class="code" href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>, StartBlock);</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;  PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(CountZeros, CallBlock);</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160; </div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;  <span class="comment">// We are explicitly handling the zero case, so we can set the intrinsic&#39;s</span></div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;  <span class="comment">// undefined zero argument to &#39;true&#39;. This will also prevent reprocessing the</span></div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;  <span class="comment">// intrinsic; we only despeculate when a zero input is defined.</span></div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;  CountZeros-&gt;<a class="code" href="classllvm_1_1CallBase.html#abc10b887caad109288ffceb230493a85">setArgOperand</a>(1, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getTrue());</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;  ModifiedDT = ModifyDT::ModifyBBDT;</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;}</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160; </div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="ScalarizeMaskedMemIntrin_8cpp.html#a8839065ea712711c22d6da68b2fb2d64">CodeGenPrepare::optimizeCallInst</a>(<a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI, ModifyDT &amp;ModifiedDT) {</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160; </div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;  <span class="comment">// Lower inline assembly if we can.</span></div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;  <span class="comment">// If we found an inline asm expession, and if the target knows how to</span></div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;  <span class="comment">// lower it to normal LLVM code, do so now.</span></div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;  <span class="keywordflow">if</span> (CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#a018f0394a375233d538109968b76a05a">isInlineAsm</a>()) {</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;    <span class="keywordflow">if</span> (TLI-&gt;<a class="code" href="classllvm_1_1TargetLowering.html#aa394506e609b72337e9c664ef264db8b">ExpandInlineAsm</a>(CI)) {</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;      <span class="comment">// Avoid invalidating the iterator.</span></div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;      CurInstIterator = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;begin();</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;      <span class="comment">// Avoid processing instructions out of order, which could cause</span></div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;      <span class="comment">// reuse before a value is defined.</span></div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;      SunkAddrs.<a class="code" href="classllvm_1_1ValueMap.html#a49dc44e6a66de10991ee34e1df0d8065">clear</a>();</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;    }</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;    <span class="comment">// Sink address computing for memory operands into the block.</span></div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;    <span class="keywordflow">if</span> (optimizeInlineAsmInst(CI))</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;  }</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160; </div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;  <span class="comment">// Align the pointer arguments to this call if the target thinks it&#39;s a good</span></div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;  <span class="comment">// idea</span></div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;  <span class="keywordtype">unsigned</span> MinSize;</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;  <a class="code" href="structllvm_1_1Align.html">Align</a> PrefAlign;</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;  <span class="keywordflow">if</span> (TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#ae4b84d0bc1e6fcb979dc8bb641b74ae9">shouldAlignPointerArgs</a>(CI, MinSize, PrefAlign)) {</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a> : CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#ac63dbb4994494c46f025715272cdb81e">args</a>()) {</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;      <span class="comment">// We want to align both objects whose address is used directly and</span></div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;      <span class="comment">// objects whose address is used in casts and GEPs, though it only makes</span></div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;      <span class="comment">// sense for GEPs if the offset is a multiple of the desired alignment and</span></div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;      <span class="comment">// if size - offset meets the size threshold.</span></div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a>-&gt;getType()-&gt;isPointerTy())</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;      <a class="code" href="classllvm_1_1APInt.html">APInt</a> <a class="code" href="namespacellvm_1_1AMDGPU_1_1Hwreg.html#a6110fc30bc7311a6cf99814530362e21">Offset</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getIndexSizeInBits(</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;                       cast&lt;PointerType&gt;(<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a>-&gt;getType())-&gt;getAddressSpace()),</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;                   0);</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Val = <a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a>-&gt;stripAndAccumulateInBoundsConstantOffsets(*<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, Offset);</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;      <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Offset2 = <a class="code" href="namespacellvm_1_1AMDGPU_1_1Hwreg.html#a6110fc30bc7311a6cf99814530362e21">Offset</a>.getLimitedValue();</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#a25f1d7ccf87af8d87fcb950f7ed758b5">isAligned</a>(PrefAlign, Offset2))</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;      <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI;</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;      <span class="keywordflow">if</span> ((AI = dyn_cast&lt;AllocaInst&gt;(Val)) &amp;&amp; AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a42438d0a43720a6571c9138224481754">getAlign</a>() &lt; PrefAlign &amp;&amp;</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;          <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getTypeAllocSize(AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a074617b3e2f9f98ee3a2ac208e8e7210">getAllocatedType</a>()) &gt;= MinSize + Offset2)</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;        AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#af3bb24b322533dbe8a63c84b18568fe1">setAlignment</a>(PrefAlign);</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;      <span class="comment">// Global variables can only be aligned if they are defined in this</span></div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;      <span class="comment">// object (i.e. they are uniquely initialized in this object), and</span></div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;      <span class="comment">// over-aligning global variables that have an explicit section is</span></div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;      <span class="comment">// forbidden.</span></div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;      <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV;</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;      <span class="keywordflow">if</span> ((GV = dyn_cast&lt;GlobalVariable&gt;(Val)) &amp;&amp; GV-&gt;<a class="code" href="classllvm_1_1GlobalObject.html#af3c010276b401e92a124e50fcef97fe1">canIncreaseAlignment</a>() &amp;&amp;</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;          GV-&gt;<a class="code" href="classllvm_1_1Value.html#a47f5c74e1b14ba4a61db057400644acc">getPointerAlignment</a>(*<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &lt; PrefAlign &amp;&amp;</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;          <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getTypeAllocSize(GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a29e0b1c558b350347e2652b35b26fea8">getValueType</a>()) &gt;= MinSize + Offset2)</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;        GV-&gt;<a class="code" href="classllvm_1_1GlobalObject.html#a49b398b1c83ef4d42c8f7756b443f61f">setAlignment</a>(PrefAlign);</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;    }</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;  }</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;  <span class="comment">// If this is a memcpy (or similar) then we may be able to improve the</span></div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;  <span class="comment">// alignment.</span></div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1MemIntrinsic.html">MemIntrinsic</a> *<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = dyn_cast&lt;MemIntrinsic&gt;(CI)) {</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;    <a class="code" href="structllvm_1_1Align.html">Align</a> DestAlign = <a class="code" href="namespacellvm.html#a607b7fac55adc5ea9ed40a78e48a5b00">getKnownAlignment</a>(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getDest(), *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;    <a class="code" href="structllvm_1_1MaybeAlign.html">MaybeAlign</a> MIDestAlign = <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getDestAlign();</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;    <span class="keywordflow">if</span> (!MIDestAlign || DestAlign &gt; *MIDestAlign)</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;      <a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;setDestAlignment(DestAlign);</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1MemTransferInst.html">MemTransferInst</a> *MTI = dyn_cast&lt;MemTransferInst&gt;(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>)) {</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;      <a class="code" href="structllvm_1_1MaybeAlign.html">MaybeAlign</a> MTISrcAlign = MTI-&gt;getSourceAlign();</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;      <a class="code" href="structllvm_1_1Align.html">Align</a> SrcAlign = <a class="code" href="namespacellvm.html#a607b7fac55adc5ea9ed40a78e48a5b00">getKnownAlignment</a>(MTI-&gt;getSource(), *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;      <span class="keywordflow">if</span> (!MTISrcAlign || SrcAlign &gt; *MTISrcAlign)</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;        MTI-&gt;setSourceAlignment(SrcAlign);</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;    }</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;  }</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160; </div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;  <span class="comment">// If we have a cold call site, try to sink addressing computation into the</span></div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;  <span class="comment">// cold block.  This interacts with our handling for loads and stores to</span></div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;  <span class="comment">// ensure that we can fold all uses of a potential addressing computation</span></div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;  <span class="comment">// into their uses.  TODO: generalize this to work over profiling data</span></div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;  <span class="keywordflow">if</span> (CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#a2fbfe5377a984518a7c03d8558df726d">hasFnAttr</a>(<a class="code" href="namespacellvm_1_1CallingConv.html#a5b166ae228ebbfdb96736d6022f3feeda94ec9273479164e4aec1d5d91b71dc85">Attribute::Cold</a>) &amp;&amp; !OptSize &amp;&amp;</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;      !<a class="code" href="namespacellvm.html#a3af72f14ea20f2c762c751d2d49e5ea3">llvm::shouldOptimizeForSize</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, PSI, <a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>.get()))</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a> : CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#ac63dbb4994494c46f025715272cdb81e">args</a>()) {</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a>-&gt;getType()-&gt;isPointerTy())</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;      <span class="keywordtype">unsigned</span> AS = <a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a>-&gt;getType()-&gt;getPointerAddressSpace();</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;      <span class="keywordflow">return</span> optimizeMemoryInst(CI, <a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a>, <a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a>-&gt;getType(), AS);</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;    }</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160; </div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;  <a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *II = dyn_cast&lt;IntrinsicInst&gt;(CI);</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;  <span class="keywordflow">if</span> (II) {</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;    <span class="keywordflow">switch</span> (II-&gt;<a class="code" href="classllvm_1_1IntrinsicInst.html#a7ff64b3625b6f9020556ed05a5f72af4">getIntrinsicID</a>()) {</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;    <span class="keywordflow">case</span> Intrinsic::assume:</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;      <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;llvm.assume should have been removed already&quot;</span>);</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;    <span class="keywordflow">case</span> Intrinsic::experimental_widenable_condition: {</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;      <span class="comment">// Give up on future widening oppurtunties so that we can fold away dead</span></div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;      <span class="comment">// paths and merge blocks before going into block-local instruction</span></div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;      <span class="comment">// selection.</span></div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;      <span class="keywordflow">if</span> (II-&gt;<a class="code" href="classllvm_1_1Value.html#a9d7de807ebdfe1819df3ff6cb0f16158">use_empty</a>()) {</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;        II-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;      }</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;      <a class="code" href="classllvm_1_1Constant.html">Constant</a> *RetVal = <a class="code" href="classllvm_1_1ConstantInt.html#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(II-&gt;<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;      resetIteratorIfInvalidatedWhileCalling(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, [&amp;]() {</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;        <a class="code" href="namespacellvm.html#a66a40e8dfb026aef2f90764d2e49a8f1">replaceAndRecursivelySimplify</a>(CI, RetVal, TLInfo, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;      });</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;    }</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;    <span class="keywordflow">case</span> Intrinsic::objectsize:</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;      <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;llvm.objectsize.* should have been lowered already&quot;</span>);</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;    <span class="keywordflow">case</span> Intrinsic::is_constant:</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;      <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;llvm.is.constant.* should have been lowered already&quot;</span>);</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;    <span class="keywordflow">case</span> Intrinsic::aarch64_stlxr:</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;    <span class="keywordflow">case</span> Intrinsic::aarch64_stxr: {</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;      <a class="code" href="classllvm_1_1ZExtInst.html">ZExtInst</a> *ExtVal = dyn_cast&lt;ZExtInst&gt;(CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(0));</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;      <span class="keywordflow">if</span> (!ExtVal || !ExtVal-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() ||</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;          ExtVal-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() == CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>())</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;      <span class="comment">// Sink a zext feeding stlxr/stxr before it, so it can be folded into it.</span></div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;      ExtVal-&gt;<a class="code" href="classllvm_1_1Instruction.html#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(CI);</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;      <span class="comment">// Mark this instruction as &quot;inserted by CGP&quot;, so that other</span></div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;      <span class="comment">// optimizations don&#39;t touch it.</span></div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;      InsertedInsts.insert(ExtVal);</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;    }</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160; </div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;    <span class="keywordflow">case</span> Intrinsic::launder_invariant_group:</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;    <span class="keywordflow">case</span> Intrinsic::strip_invariant_group: {</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *ArgVal = II-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(0);</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;      <span class="keyword">auto</span> <a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a> = LargeOffsetGEPMap.<a class="code" href="classllvm_1_1MapVector.html#a6b0c3e15c351ba9682837c29b0a141b6">find</a>(II);</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a> != LargeOffsetGEPMap.<a class="code" href="classllvm_1_1MapVector.html#a0881334358ff6ff7ff8cea5562c7988e">end</a>()) {</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;        <span class="comment">// Merge entries in LargeOffsetGEPMap to reflect the RAUW.</span></div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;        <span class="comment">// Make sure not to have to deal with iterator invalidation</span></div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;        <span class="comment">// after possibly adding ArgVal to LargeOffsetGEPMap.</span></div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;        <span class="keyword">auto</span> GEPs = <a class="code" href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">std::move</a>(<a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a>-&gt;second);</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;        LargeOffsetGEPMap[ArgVal].append(GEPs.begin(), GEPs.end());</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;        LargeOffsetGEPMap.<a class="code" href="classllvm_1_1MapVector.html#a3a8171298a7d19a309d599de01906703">erase</a>(II);</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;      }</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160; </div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;      <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(II, ArgVal, FreshBBs, IsHugeFunc);</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;      II-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;    }</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;    <span class="keywordflow">case</span> Intrinsic::cttz:</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;    <span class="keywordflow">case</span> Intrinsic::ctlz:</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;      <span class="comment">// If counting zeros is expensive, try to avoid it.</span></div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="CodeGenPrepare_8cpp.html#aa159b7d2631747735a5f57877991d26f">despeculateCountZeros</a>(II, TLI, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, ModifiedDT, FreshBBs,</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;                                   IsHugeFunc);</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;    <span class="keywordflow">case</span> Intrinsic::fshl:</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;    <span class="keywordflow">case</span> Intrinsic::fshr:</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;      <span class="keywordflow">return</span> optimizeFunnelShift(II);</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;    <span class="keywordflow">case</span> Intrinsic::dbg_assign:</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;    <span class="keywordflow">case</span> Intrinsic::dbg_value:</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;      <span class="keywordflow">return</span> fixupDbgValue(II);</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;    <span class="keywordflow">case</span> Intrinsic::vscale: {</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;      <span class="comment">// If datalayout has no special restrictions on vector data layout,</span></div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;      <span class="comment">// replace `llvm.vscale` by an equivalent constant expression</span></div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;      <span class="comment">// to benefit from cheap constant propagation.</span></div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *ScalableVectorTy =</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;          <a class="code" href="classllvm_1_1VectorType.html#a8c90e6c50e795b17466482a04947690e">VectorType::get</a>(<a class="code" href="classllvm_1_1Type.html#a7ba5de75f50bb4a4ba920698edf39b28">Type::getInt8Ty</a>(II-&gt;<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>()), 1, <span class="keyword">true</span>);</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getTypeAllocSize(ScalableVectorTy).getKnownMinValue() == 8) {</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;        <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1pdb.html#a5dbb1abfb6d3c14555304f9c56703234abbb93ef26e3c101ff11cdd21cab08a94">Null</a> = <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(ScalableVectorTy-&gt;<a class="code" href="classllvm_1_1Type.html#adc01a7457de85fc52a3bb860d7e1c6a4">getPointerTo</a>());</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;        <span class="keyword">auto</span> *One = <a class="code" href="classllvm_1_1ConstantInt.html#ad736fb9b585509388546c12617def38f">ConstantInt::getSigned</a>(II-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), 1);</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;        <span class="keyword">auto</span> *CGep =</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;            <a class="code" href="classllvm_1_1ConstantExpr.html#abae3f750ce4d2edcea30f08fe9e29721">ConstantExpr::getGetElementPtr</a>(ScalableVectorTy, Null, One);</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;        <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(II, <a class="code" href="classllvm_1_1ConstantExpr.html#a652380f28d1a7011e05d0787b6024d48">ConstantExpr::getPtrToInt</a>(CGep, II-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()),</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;                           FreshBBs, IsHugeFunc);</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;        II-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;      }</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;    }</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;    <span class="keywordflow">case</span> Intrinsic::masked_gather:</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;      <span class="keywordflow">return</span> optimizeGatherScatterInst(II, II-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(0));</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;    <span class="keywordflow">case</span> Intrinsic::masked_scatter:</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;      <span class="keywordflow">return</span> optimizeGatherScatterInst(II, II-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(1));</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;    }</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160; </div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 2&gt;</a> PtrOps;</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *AccessTy;</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;    <span class="keywordflow">if</span> (TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#aa4ab45481ecc1c8720e7a570b7c83be1">getAddrModeArguments</a>(II, PtrOps, AccessTy))</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;      <span class="keywordflow">while</span> (!PtrOps.empty()) {</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *PtrVal = PtrOps.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a0c8ffe664a36e30d49c84d0aded2fe08">pop_back_val</a>();</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;        <span class="keywordtype">unsigned</span> AS = PtrVal-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>();</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;        <span class="keywordflow">if</span> (optimizeMemoryInst(II, PtrVal, AccessTy, AS))</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;      }</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;  }</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160; </div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;  <span class="comment">// From here on out we&#39;re working with named functions.</span></div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;  <span class="keywordflow">if</span> (!CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#a83b8c9e572130f403445c0b0f69b837c">getCalledFunction</a>())</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160; </div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;  <span class="comment">// Lower all default uses of _chk calls.  This is very similar</span></div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;  <span class="comment">// to what InstCombineCalls does, but here we are only lowering calls</span></div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;  <span class="comment">// to fortified library functions (e.g. __memcpy_chk) that have the default</span></div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;  <span class="comment">// &quot;don&#39;t know&quot; as the objectsize.  Anything else should be left alone.</span></div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;  <a class="code" href="classllvm_1_1FortifiedLibCallSimplifier.html">FortifiedLibCallSimplifier</a> Simplifier(TLInfo, <span class="keyword">true</span>);</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(CI);</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V = Simplifier.optimizeCall(CI, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>)) {</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;    <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(CI, V, FreshBBs, IsHugeFunc);</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;    CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;  }</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160; </div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;}</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;<span class="comment">/// Look for opportunities to duplicate return instructions to the predecessor</span></div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;<span class="comment">/// to enable tail call optimizations. The case it is currently looking for is:</span></div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;<span class="comment">/// @code</span></div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;<span class="comment">/// bb0:</span></div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;<span class="comment">///   %tmp0 = tail call i32 @f0()</span></div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;<span class="comment">///   br label %return</span></div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;<span class="comment">/// bb1:</span></div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;<span class="comment">///   %tmp1 = tail call i32 @f1()</span></div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;<span class="comment">///   br label %return</span></div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;<span class="comment">/// bb2:</span></div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;<span class="comment">///   %tmp2 = tail call i32 @f2()</span></div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;<span class="comment">///   br label %return</span></div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;<span class="comment">/// return:</span></div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;<span class="comment">///   %retval = phi i32 [ %tmp0, %bb0 ], [ %tmp1, %bb1 ], [ %tmp2, %bb2 ]</span></div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;<span class="comment">///   ret i32 %retval</span></div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;<span class="comment">/// @endcode</span></div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;<span class="comment">/// =&gt;</span></div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;<span class="comment">/// @code</span></div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;<span class="comment">/// bb0:</span></div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;<span class="comment">///   %tmp0 = tail call i32 @f0()</span></div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;<span class="comment">///   ret i32 %tmp0</span></div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;<span class="comment">/// bb1:</span></div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;<span class="comment">///   %tmp1 = tail call i32 @f1()</span></div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;<span class="comment">///   ret i32 %tmp1</span></div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;<span class="comment">/// bb2:</span></div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;<span class="comment">///   %tmp2 = tail call i32 @f2()</span></div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;<span class="comment">///   ret i32 %tmp2</span></div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;<span class="comment">/// @endcode</span></div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CodeGenPrepare::dupRetToEnableTailCallOpts(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>,</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;                                                ModifyDT &amp;ModifiedDT) {</div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getTerminator())</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160; </div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;  <a class="code" href="classllvm_1_1ReturnInst.html">ReturnInst</a> *RetI = dyn_cast&lt;ReturnInst&gt;(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getTerminator());</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;  <span class="keywordflow">if</span> (!RetI)</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160; </div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;  <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;  <a class="code" href="classllvm_1_1ExtractValueInst.html">ExtractValueInst</a> *EVI = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;  <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *BCI = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *V = RetI-&gt;<a class="code" href="classllvm_1_1ReturnInst.html#a87e923648048258a6e8376d6cf4ce565">getReturnValue</a>();</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;  <span class="keywordflow">if</span> (V) {</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;    BCI = dyn_cast&lt;BitCastInst&gt;(V);</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;    <span class="keywordflow">if</span> (BCI)</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;      V = BCI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160; </div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;    EVI = dyn_cast&lt;ExtractValueInst&gt;(V);</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;    <span class="keywordflow">if</span> (EVI) {</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;      V = EVI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all_of</a>(EVI-&gt;<a class="code" href="classllvm_1_1ExtractValueInst.html#ae7f10273fba575e1cb0379621c5330ad">indices</a>(), [](<span class="keywordtype">unsigned</span> idx) { return idx == 0; }))</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;    }</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160; </div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;    PN = dyn_cast&lt;PHINode&gt;(V);</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;    <span class="keywordflow">if</span> (!PN)</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;  }</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160; </div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;  <span class="keywordflow">if</span> (PN &amp;&amp; PN-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160; </div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;  <span class="keyword">auto</span> isLifetimeEndOrBitCastFor = [](<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst) {</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *BC = dyn_cast&lt;BitCastInst&gt;(Inst);</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;    <span class="keywordflow">if</span> (BC &amp;&amp; BC-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;      Inst = BC-&gt;<a class="code" href="classllvm_1_1Instruction.html#a2fd1d2dc14e22227cfa8238778ab87b8">user_back</a>();</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160; </div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *II = dyn_cast&lt;IntrinsicInst&gt;(Inst))</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;      <span class="keywordflow">return</span> II-&gt;<a class="code" href="classllvm_1_1IntrinsicInst.html#a7ff64b3625b6f9020556ed05a5f72af4">getIntrinsicID</a>() == Intrinsic::lifetime_end;</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;  };</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160; </div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;  <span class="comment">// Make sure there are no instructions between the first instruction</span></div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;  <span class="comment">// and return.</span></div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *BI = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getFirstNonPHI();</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;  <span class="comment">// Skip over debug and the bitcast.</span></div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;  <span class="keywordflow">while</span> (isa&lt;DbgInfoIntrinsic&gt;(BI) || BI == BCI || BI == EVI ||</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;         isa&lt;PseudoProbeInst&gt;(BI) || isLifetimeEndOrBitCastFor(BI))</div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;    BI = BI-&gt;<a class="code" href="classllvm_1_1ilist__node__with__parent.html#a26708685cc8b94fe3d7092ee080dbb34">getNextNode</a>();</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;  <span class="keywordflow">if</span> (BI != RetI)</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;<span class="comment">  /// Only dup the ReturnInst if the CallInst is likely to be emitted as a tail</span></div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;<span class="comment">  /// call.</span></div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;<span class="comment"></span>  <span class="keyword">const</span> <a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getParent();</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BasicBlock *, 4&gt;</a> TailCallBBs;</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;  <span class="keywordflow">if</span> (PN) {</div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;      <span class="comment">// Look through bitcasts.</span></div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *IncomingVal = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a16c39eb6e60b42a40c399d8d65347bb6">getIncomingValue</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;<a class="code" href="classllvm_1_1Value.html#a966eb231e7d4e572874d2cb49b18faea">stripPointerCasts</a>();</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;      <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI = dyn_cast&lt;CallInst&gt;(IncomingVal);</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PredBB = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a8ce0c4746a1ec805e66409d20ae93922">getIncomingBlock</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;      <span class="comment">// Make sure the phi value is indeed produced by the tail call.</span></div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;      <span class="keywordflow">if</span> (CI &amp;&amp; CI-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() == PredBB &amp;&amp;</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;          TLI-&gt;<a class="code" href="classllvm_1_1TargetLowering.html#ae4502810d1edc3d8931681159af36d3b">mayBeEmittedAsTailCall</a>(CI) &amp;&amp;</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;          <a class="code" href="namespacellvm.html#a9f172ff9cc319871a4d4b30b1c442dba">attributesPermitTailCall</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, CI, RetI, *TLI))</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;        TailCallBBs.push_back(PredBB);</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;    }</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;BasicBlock *, 4&gt;</a> VisitedBBs;</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred : <a class="code" href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">predecessors</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)) {</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;      <span class="keywordflow">if</span> (!VisitedBBs.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(Pred).second)</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Pred-&gt;rbegin()-&gt;getPrevNonDebugInstruction(<span class="keyword">true</span>)) {</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;        <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI = dyn_cast&lt;CallInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;        <span class="keywordflow">if</span> (CI &amp;&amp; CI-&gt;<a class="code" href="classllvm_1_1Value.html#a9d7de807ebdfe1819df3ff6cb0f16158">use_empty</a>() &amp;&amp; TLI-&gt;<a class="code" href="classllvm_1_1TargetLowering.html#ae4502810d1edc3d8931681159af36d3b">mayBeEmittedAsTailCall</a>(CI) &amp;&amp;</div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;            <a class="code" href="namespacellvm.html#a9f172ff9cc319871a4d4b30b1c442dba">attributesPermitTailCall</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, CI, RetI, *TLI))</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;          TailCallBBs.push_back(Pred);</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;      }</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;    }</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;  }</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160; </div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span> &amp;TailCallBB : TailCallBBs) {</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;    <span class="comment">// Make sure the call instruction is followed by an unconditional branch to</span></div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;    <span class="comment">// the return block.</span></div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;    <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = dyn_cast&lt;BranchInst&gt;(TailCallBB-&gt;getTerminator());</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;    <span class="keywordflow">if</span> (!BI || !BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad56f6a9b5cd05940017c4544df48bc30">isUnconditional</a>() || BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">getSuccessor</a>(0) != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160; </div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;    <span class="comment">// Duplicate the return into TailCallBB.</span></div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;    (void)<a class="code" href="namespacellvm.html#a2e4b18daaf5f20f1ade3a9f66b86d843">FoldReturnIntoUncondBranch</a>(RetI, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, TailCallBB);</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a class="code" href="CodeGenPrepare_8cpp.html#afece9241ceab1d00d94c2fcd422cf054">VerifyBFIUpdates</a> ||</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;           <a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;getBlockFreq(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) &gt;= <a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;getBlockFreq(TailCallBB));</div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;    <a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;setBlockFreq(</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;        <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>,</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;        (<a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;getBlockFreq(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) - <a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;getBlockFreq(TailCallBB)).getFrequency());</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;    ModifiedDT = ModifyDT::ModifyBBDT;</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;    Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;    ++NumRetsDup;</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;  }</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160; </div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;  <span class="comment">// If we eliminated all predecessors of the block, delete the block now.</span></div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;  <span class="keywordflow">if</span> (Changed &amp;&amp; !<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;hasAddressTaken() &amp;&amp; <a class="code" href="namespacellvm.html#ad66c4759666aab78529658362b498c74">pred_empty</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>))</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;    <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160; </div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;}</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160; </div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;<span class="comment">// Memory Optimization</span></div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160; </div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;<span class="comment">/// This is an extended version of TargetLowering::AddrMode</span></div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;<span class="comment">/// which holds actual Value*&#39;s for register values.</span></div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;<span class="comment"></span><span class="keyword">struct </span><a class="code" href="structllvm_1_1ExtAddrMode.html">ExtAddrMode</a> : <span class="keyword">public</span> <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">TargetLowering::AddrMode</a> {</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *BaseReg = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ScaledReg = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *OriginalValue = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;  <span class="keywordtype">bool</span> InBounds = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160; </div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;  <span class="keyword">enum</span> FieldName {</div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;    NoField = 0x00,</div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;    BaseRegField = 0x01,</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;    BaseGVField = 0x02,</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;    BaseOffsField = 0x04,</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;    ScaledRegField = 0x08,</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;    ScaleField = 0x10,</div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;    MultipleFields = 0xff</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;  };</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160; </div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;  <a class="code" href="structllvm_1_1ExtAddrMode.html">ExtAddrMode</a>() = <span class="keywordflow">default</span>;</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160; </div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a67980a8ae101d2fda845eb750ffb1942">print</a>(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;<a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>) <span class="keyword">const</span>;</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a03503773241005f01b090b9862aad304">dump</a>() <span class="keyword">const</span>;</div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160; </div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;  FieldName <a class="code" href="namespacellvm_1_1ScaledNumbers.html#a0651aa0a52c69c4fe12cf730e7ed65ab">compare</a>(<span class="keyword">const</span> <a class="code" href="structllvm_1_1ExtAddrMode.html">ExtAddrMode</a> &amp;other) {</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;    <span class="comment">// First check that the types are the same on each field, as differing types</span></div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;    <span class="comment">// is something we can&#39;t cope with later on.</span></div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;    <span class="keywordflow">if</span> (BaseReg &amp;&amp; other.<a class="code" href="structllvm_1_1ExtAddrMode.html#a2404b5dd8b0a6746487c699291c54927">BaseReg</a> &amp;&amp;</div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;        BaseReg-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() != other.<a class="code" href="structllvm_1_1ExtAddrMode.html#a2404b5dd8b0a6746487c699291c54927">BaseReg</a>-&gt;getType())</div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;      <span class="keywordflow">return</span> MultipleFields;</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;    <span class="keywordflow">if</span> (BaseGV &amp;&amp; other.BaseGV &amp;&amp; BaseGV-&gt;getType() != other.BaseGV-&gt;getType())</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;      <span class="keywordflow">return</span> MultipleFields;</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;    <span class="keywordflow">if</span> (ScaledReg &amp;&amp; other.<a class="code" href="structllvm_1_1ExtAddrMode.html#a243a500ecf43f8be3648cd935b943165">ScaledReg</a> &amp;&amp;</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;        ScaledReg-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() != other.<a class="code" href="structllvm_1_1ExtAddrMode.html#a243a500ecf43f8be3648cd935b943165">ScaledReg</a>-&gt;getType())</div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;      <span class="keywordflow">return</span> MultipleFields;</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160; </div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;    <span class="comment">// Conservatively reject &#39;inbounds&#39; mismatches.</span></div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;    <span class="keywordflow">if</span> (InBounds != other.InBounds)</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;      <span class="keywordflow">return</span> MultipleFields;</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160; </div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;    <span class="comment">// Check each field to see if it differs.</span></div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;    <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = NoField;</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;    <span class="keywordflow">if</span> (BaseReg != other.<a class="code" href="structllvm_1_1ExtAddrMode.html#a2404b5dd8b0a6746487c699291c54927">BaseReg</a>)</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;      <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> |= BaseRegField;</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;    <span class="keywordflow">if</span> (BaseGV != other.BaseGV)</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;      <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> |= BaseGVField;</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;    <span class="keywordflow">if</span> (BaseOffs != other.BaseOffs)</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;      <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> |= BaseOffsField;</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;    <span class="keywordflow">if</span> (ScaledReg != other.<a class="code" href="structllvm_1_1ExtAddrMode.html#a243a500ecf43f8be3648cd935b943165">ScaledReg</a>)</div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;      <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> |= ScaledRegField;</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;    <span class="comment">// Don&#39;t count 0 as being a different scale, because that actually means</span></div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;    <span class="comment">// unscaled (which will already be counted by having no ScaledReg).</span></div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;    <span class="keywordflow">if</span> (Scale &amp;&amp; other.<a class="code" href="structllvm_1_1ExtAddrMode.html#ae20bc007be03337ee451abb60d74260b">Scale</a> &amp;&amp; Scale != other.<a class="code" href="structllvm_1_1ExtAddrMode.html#ae20bc007be03337ee451abb60d74260b">Scale</a>)</div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;      <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> |= ScaleField;</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160; </div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a0eea77e7bfa82e0219d2ec7b4efbc94f">llvm::popcount</a>(Result) &gt; 1)</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;      <span class="keywordflow">return</span> MultipleFields;</div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>FieldName<span class="keyword">&gt;</span>(<a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>);</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;  }</div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160; </div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;  <span class="comment">// An AddrMode is trivial if it involves no calculation i.e. it is just a base</span></div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;  <span class="comment">// with no offset.</span></div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;  <span class="keywordtype">bool</span> isTrivial() {</div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;    <span class="comment">// An AddrMode is (BaseGV + BaseReg + BaseOffs + ScaleReg * Scale) so it is</span></div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;    <span class="comment">// trivial if at most one of these terms is nonzero, except that BaseGV and</span></div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;    <span class="comment">// BaseReg both being zero actually means a null pointer value, which we</span></div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;    <span class="comment">// consider to be &#39;non-zero&#39; here.</span></div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;    <span class="keywordflow">return</span> !BaseOffs &amp;&amp; !Scale &amp;&amp; !(BaseGV &amp;&amp; BaseReg);</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;  }</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160; </div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *GetFieldAsValue(FieldName <a class="code" href="structllvm_1_1OptimizedStructLayoutField.html">Field</a>, <a class="code" href="classllvm_1_1Type.html">Type</a> *IntPtrTy) {</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="structllvm_1_1OptimizedStructLayoutField.html">Field</a>) {</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;    <span class="keywordflow">case</span> BaseRegField:</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;      <span class="keywordflow">return</span> BaseReg;</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;    <span class="keywordflow">case</span> BaseGVField:</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;      <span class="keywordflow">return</span> BaseGV;</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;    <span class="keywordflow">case</span> ScaledRegField:</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;      <span class="keywordflow">return</span> ScaledReg;</div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;    <span class="keywordflow">case</span> BaseOffsField:</div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(IntPtrTy, BaseOffs);</div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;    }</div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;  }</div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160; </div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;  <span class="keywordtype">void</span> SetCombinedField(FieldName <a class="code" href="structllvm_1_1OptimizedStructLayoutField.html">Field</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *V,</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;                        <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;ExtAddrMode&gt;</a> &amp;AddrModes) {</div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="structllvm_1_1OptimizedStructLayoutField.html">Field</a>) {</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;      <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Unhandled fields are expected to be rejected earlier&quot;</span>);</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;    <span class="keywordflow">case</span> ExtAddrMode::BaseRegField:</div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;      BaseReg = V;</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;    <span class="keywordflow">case</span> ExtAddrMode::BaseGVField:</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;      <span class="comment">// A combined BaseGV is an Instruction, not a GlobalValue, so it goes</span></div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;      <span class="comment">// in the BaseReg field.</span></div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BaseReg == <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;      BaseReg = V;</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;      BaseGV = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;    <span class="keywordflow">case</span> ExtAddrMode::ScaledRegField:</div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;      ScaledReg = V;</div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;      <span class="comment">// If we have a mix of scaled and unscaled addrmodes then we want scale</span></div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;      <span class="comment">// to be the scale and not zero.</span></div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;      <span class="keywordflow">if</span> (!Scale)</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="structllvm_1_1ExtAddrMode.html">ExtAddrMode</a> &amp;AM : AddrModes)</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;          <span class="keywordflow">if</span> (AM.Scale) {</div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;            Scale = AM.Scale;</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;          }</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;    <span class="keywordflow">case</span> ExtAddrMode::BaseOffsField:</div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;      <span class="comment">// The offset is no longer a constant, so it goes in ScaledReg with a</span></div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;      <span class="comment">// scale of 1.</span></div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ScaledReg == <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;      ScaledReg = V;</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;      Scale = 1;</div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;      BaseOffs = 0;</div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;    }</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;  }</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;};</div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160; </div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;<a class="code" href="namespacellvm.html#a5ee0a415cf089775fd277550b257f74e">operator&lt;&lt;</a>(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;<a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>, <span class="keyword">const</span> <a class="code" href="structllvm_1_1ExtAddrMode.html">ExtAddrMode</a> &amp;AM) {</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;  AM.print(<a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>);</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>;</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;}</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160; </div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;<span class="preprocessor">#if !defined(NDEBUG) || defined(LLVM_ENABLE_DUMP)</span></div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;<span class="keywordtype">void</span> <a class="code" href="ArchiveWriter_8cpp.html#aa9f638c7ae7fdd206a6c60e26bef9751">ExtAddrMode::print</a>(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;<a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;  <span class="keywordtype">bool</span> NeedPlus = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;  <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; <span class="stringliteral">&quot;[&quot;</span>;</div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;  <span class="keywordflow">if</span> (InBounds)</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;    <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; <span class="stringliteral">&quot;inbounds &quot;</span>;</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;  <span class="keywordflow">if</span> (BaseGV) {</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;    <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; (NeedPlus ? <span class="stringliteral">&quot; + &quot;</span> : <span class="stringliteral">&quot;&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;GV:&quot;</span>;</div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;    BaseGV-&gt;printAsOperand(<a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>, <span class="comment">/*PrintType=*/</span><span class="keyword">false</span>);</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;    NeedPlus = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;  }</div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160; </div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;  <span class="keywordflow">if</span> (BaseOffs) {</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;    <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; (NeedPlus ? <span class="stringliteral">&quot; + &quot;</span> : <span class="stringliteral">&quot;&quot;</span>) &lt;&lt; BaseOffs;</div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;    NeedPlus = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;  }</div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160; </div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;  <span class="keywordflow">if</span> (BaseReg) {</div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;    <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; (NeedPlus ? <span class="stringliteral">&quot; + &quot;</span> : <span class="stringliteral">&quot;&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Base:&quot;</span>;</div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;    BaseReg-&gt;<a class="code" href="classllvm_1_1Value.html#a62213d5211c9d944e5ede1f0059a6ae2">printAsOperand</a>(<a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>, <span class="comment">/*PrintType=*/</span><span class="keyword">false</span>);</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;    NeedPlus = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;  }</div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;  <span class="keywordflow">if</span> (Scale) {</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;    <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; (NeedPlus ? <span class="stringliteral">&quot; + &quot;</span> : <span class="stringliteral">&quot;&quot;</span>) &lt;&lt; Scale &lt;&lt; <span class="stringliteral">&quot;*&quot;</span>;</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;    ScaledReg-&gt;<a class="code" href="classllvm_1_1Value.html#a62213d5211c9d944e5ede1f0059a6ae2">printAsOperand</a>(<a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>, <span class="comment">/*PrintType=*/</span><span class="keyword">false</span>);</div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;  }</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160; </div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;  <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; <span class="charliteral">&#39;]&#39;</span>;</div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;}</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160; </div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;<a class="code" href="Compiler_8h.html#aa863693eef567397d9c292da5bf22d34">LLVM_DUMP_METHOD</a> <span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a03503773241005f01b090b9862aad304">ExtAddrMode::dump</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;  <a class="code" href="namespacellvm.html#a67980a8ae101d2fda845eb750ffb1942">print</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>());</div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;  <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;}</div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160; </div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160; </div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;<span class="comment">/// This class provides transaction based operation on the IR.</span></div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;<span class="comment">/// Every change made through this class is recorded in the internal state and</span></div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;<span class="comment">/// can be undone (rollback) until commit is called.</span></div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;<span class="comment">/// CGP does not check if instructions could be speculatively executed when</span></div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;<span class="comment">/// moved. Preserving the original location would pessimize the debugging</span></div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;<span class="comment">/// experience, as well as negatively impact the quality of sample PGO.</span></div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;<span class="comment"></span><span class="keyword">class </span>TypePromotionTransaction {<span class="comment"></span></div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;<span class="comment">  /// This represents the common interface of the individual transaction.</span></div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;<span class="comment">  /// Each class implements the logic for doing one specific modification on</span></div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;<span class="comment">  /// the IR via the TypePromotionTransaction.</span></div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;<span class="comment"></span>  <span class="keyword">class </span>TypePromotionAction {</div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;  <span class="keyword">protected</span>:<span class="comment"></span></div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;<span class="comment">    /// The Instruction modified.</span></div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst;</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160; </div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;  <span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;<span class="comment">    /// Constructor of the action.</span></div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;<span class="comment">    /// The constructor performs the related action on the IR.</span></div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;<span class="comment"></span>    TypePromotionAction(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst) : Inst(Inst) {}</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160; </div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;    <span class="keyword">virtual</span> ~TypePromotionAction() = <span class="keywordflow">default</span>;</div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;<span class="comment">    /// Undo the modification done by this action.</span></div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;<span class="comment">    /// When this method is called, the IR must be in the same state as it was</span></div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;<span class="comment">    /// before this action was applied.</span></div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;<span class="comment">    /// \pre Undoing the action works if and only if the IR is in the exact same</span></div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;<span class="comment">    /// state as it was directly after this action was applied.</span></div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;<span class="comment"></span>    <span class="keyword">virtual</span> <span class="keywordtype">void</span> undo() = 0;</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;<span class="comment">    /// Advocate every change made by this action.</span></div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;<span class="comment">    /// When the results on the IR of the action are to be kept, it is important</span></div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;<span class="comment">    /// to call this function, otherwise hidden information may be kept forever.</span></div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;<span class="comment"></span>    <span class="keyword">virtual</span> <span class="keywordtype">void</span> commit() {</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;      <span class="comment">// Nothing to be done, this action is not doing anything.</span></div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;    }</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;  };</div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;<span class="comment">  /// Utility to remember the position of an instruction.</span></div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;<span class="comment"></span>  <span class="keyword">class </span>InsertionHandler {<span class="comment"></span></div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;<span class="comment">    /// Position of an instruction.</span></div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;<span class="comment">    /// Either an instruction:</span></div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;<span class="comment">    /// - Is the first in a basic block: BB is used.</span></div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;<span class="comment">    /// - Has a previous instruction: PrevInst is used.</span></div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;<span class="comment"></span>    <span class="keyword">union </span>{</div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *PrevInst;</div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>;</div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;    } Point;</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;<span class="comment">    /// Remember whether or not the instruction had a previous instruction.</span></div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span> HasPrevInstruction;</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160; </div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;  <span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;<span class="comment">    /// Record the position of \p Inst.</span></div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;<span class="comment"></span>    InsertionHandler(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst) {</div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> It = Inst-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>();</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;      HasPrevInstruction = (It != (Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>()));</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;      <span class="keywordflow">if</span> (HasPrevInstruction)</div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;        Point.PrevInst = &amp;*--It;</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;        Point.BB = Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;    }</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;<span class="comment">    /// Insert \p Inst at the recorded position.</span></div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> insert(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst) {</div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;      <span class="keywordflow">if</span> (HasPrevInstruction) {</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;        <span class="keywordflow">if</span> (Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>())</div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;          Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a0fd53f63d349dc8a7c5fc0cdd7a94c8d">removeFromParent</a>();</div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;        Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#af09e4096de244d2fb345891328714a63">insertAfter</a>(Point.PrevInst);</div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;        <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Position = &amp;*Point.BB-&gt;getFirstInsertionPt();</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;        <span class="keywordflow">if</span> (Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>())</div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;          Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(Position);</div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;          Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(Position);</div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;      }</div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;    }</div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;  };</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;<span class="comment">  /// Move an instruction before another.</span></div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;<span class="comment"></span>  <span class="keyword">class </span>InstructionMoveBefore : <span class="keyword">public</span> TypePromotionAction {<span class="comment"></span></div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;<span class="comment">    /// Original position of the instruction.</span></div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;<span class="comment"></span>    InsertionHandler Position;</div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160; </div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;  <span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;<span class="comment">    /// Move \p Inst before \p Before.</span></div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;<span class="comment"></span>    InstructionMoveBefore(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Before)</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;        : TypePromotionAction(Inst), Position(Inst) {</div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Do: move: &quot;</span> &lt;&lt; *Inst &lt;&lt; <span class="stringliteral">&quot;\nbefore: &quot;</span> &lt;&lt; *Before</div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;      Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(Before);</div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;    }</div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;<span class="comment">    /// Move the instruction back to its original position.</span></div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> undo()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Undo: moveBefore: &quot;</span> &lt;&lt; *Inst &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;      Position.insert(Inst);</div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;    }</div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;  };</div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;<span class="comment">  /// Set the operand of an instruction with a new value.</span></div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;<span class="comment"></span>  <span class="keyword">class </span>OperandSetter : <span class="keyword">public</span> TypePromotionAction {<span class="comment"></span></div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;<span class="comment">    /// Original operand of the instruction.</span></div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1Value.html">Value</a> *Origin;</div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;<span class="comment">    /// Index of the modified instruction.</span></div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> Idx;</div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160; </div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;  <span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;<span class="comment">    /// Set \p Idx operand of \p Inst with \p NewVal.</span></div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;<span class="comment"></span>    OperandSetter(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst, <span class="keywordtype">unsigned</span> Idx, <a class="code" href="classllvm_1_1Value.html">Value</a> *NewVal)</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;        : TypePromotionAction(Inst), Idx(Idx) {</div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Do: setOperand: &quot;</span> &lt;&lt; Idx &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;for:&quot;</span> &lt;&lt; *Inst &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;with:&quot;</span> &lt;&lt; *NewVal &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;      Origin = Inst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(Idx);</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;      Inst-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(Idx, NewVal);</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;    }</div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;<span class="comment">    /// Restore the original value of the instruction.</span></div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> undo()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Undo: setOperand:&quot;</span> &lt;&lt; Idx &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;for: &quot;</span> &lt;&lt; *Inst &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;with: &quot;</span> &lt;&lt; *Origin &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;      Inst-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(Idx, Origin);</div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;    }</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;  };</div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;<span class="comment">  /// Hide the operands of an instruction.</span></div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;<span class="comment">  /// Do as if this instruction was not using any of its operands.</span></div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;<span class="comment"></span>  <span class="keyword">class </span>OperandsHider : <span class="keyword">public</span> TypePromotionAction {<span class="comment"></span></div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;<span class="comment">    /// The list of original operands.</span></div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 4&gt;</a> OriginalValues;</div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160; </div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;  <span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;<span class="comment">    /// Remove \p Inst from the uses of the operands of \p Inst.</span></div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;<span class="comment"></span>    OperandsHider(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst) : TypePromotionAction(Inst) {</div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Do: OperandsHider: &quot;</span> &lt;&lt; *Inst &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;      <span class="keywordtype">unsigned</span> NumOpnds = Inst-&gt;<a class="code" href="classllvm_1_1User.html#addec638786f763d967811b45cb662f1f">getNumOperands</a>();</div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;      OriginalValues.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(NumOpnds);</div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> It = 0; It &lt; NumOpnds; ++It) {</div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;        <span class="comment">// Save the current operand.</span></div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *Val = Inst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(It);</div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;        OriginalValues.push_back(Val);</div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;        <span class="comment">// Set a dummy one.</span></div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;        <span class="comment">// We could use OperandSetter here, but that would imply an overhead</span></div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;        <span class="comment">// that we are not willing to pay.</span></div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;        Inst-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(It, <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(Val-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()));</div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;      }</div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;    }</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;<span class="comment">    /// Restore the original list of uses.</span></div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> undo()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Undo: OperandsHider: &quot;</span> &lt;&lt; *Inst &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> It = 0, EndIt = OriginalValues.size(); It != EndIt; ++It)</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;        Inst-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(It, OriginalValues[It]);</div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;    }</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;  };</div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;<span class="comment">  /// Build a truncate instruction.</span></div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;<span class="comment"></span>  <span class="keyword">class </span>TruncBuilder : <span class="keyword">public</span> TypePromotionAction {</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Val;</div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160; </div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;  <span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;<span class="comment">    /// Build a truncate instruction of \p Opnd producing a \p Ty</span></div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;<span class="comment">    /// result.</span></div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;<span class="comment">    /// trunc Opnd to Ty.</span></div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;<span class="comment"></span>    TruncBuilder(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Opnd, <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty) : TypePromotionAction(Opnd) {</div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;      <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(Opnd);</div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetCurrentDebugLocation(<a class="code" href="classllvm_1_1DebugLoc.html">DebugLoc</a>());</div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;      Val = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateTrunc(Opnd, Ty, <span class="stringliteral">&quot;promoted&quot;</span>);</div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Do: TruncBuilder: &quot;</span> &lt;&lt; *Val &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;    }</div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;<span class="comment">    /// Get the built value.</span></div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1Value.html">Value</a> *getBuiltValue() { <span class="keywordflow">return</span> Val; }</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;<span class="comment">    /// Remove the built instruction.</span></div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> undo()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Undo: TruncBuilder: &quot;</span> &lt;&lt; *Val &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *IVal = dyn_cast&lt;Instruction&gt;(Val))</div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;        IVal-&gt;eraseFromParent();</div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;    }</div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;  };</div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;<span class="comment">  /// Build a sign extension instruction.</span></div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;<span class="comment"></span>  <span class="keyword">class </span>SExtBuilder : <span class="keyword">public</span> TypePromotionAction {</div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Val;</div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160; </div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;  <span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;<span class="comment">    /// Build a sign extension instruction of \p Opnd producing a \p Ty</span></div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;<span class="comment">    /// result.</span></div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;<span class="comment">    /// sext Opnd to Ty.</span></div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;<span class="comment"></span>    SExtBuilder(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *InsertPt, <a class="code" href="classllvm_1_1Value.html">Value</a> *Opnd, <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty)</div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;        : TypePromotionAction(InsertPt) {</div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;      <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(InsertPt);</div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;      Val = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSExt(Opnd, Ty, <span class="stringliteral">&quot;promoted&quot;</span>);</div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Do: SExtBuilder: &quot;</span> &lt;&lt; *Val &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;    }</div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;<span class="comment">    /// Get the built value.</span></div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1Value.html">Value</a> *getBuiltValue() { <span class="keywordflow">return</span> Val; }</div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;<span class="comment">    /// Remove the built instruction.</span></div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> undo()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Undo: SExtBuilder: &quot;</span> &lt;&lt; *Val &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *IVal = dyn_cast&lt;Instruction&gt;(Val))</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;        IVal-&gt;eraseFromParent();</div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;    }</div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;  };</div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;<span class="comment">  /// Build a zero extension instruction.</span></div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;<span class="comment"></span>  <span class="keyword">class </span>ZExtBuilder : <span class="keyword">public</span> TypePromotionAction {</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Val;</div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160; </div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;  <span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;<span class="comment">    /// Build a zero extension instruction of \p Opnd producing a \p Ty</span></div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;<span class="comment">    /// result.</span></div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;<span class="comment">    /// zext Opnd to Ty.</span></div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;<span class="comment"></span>    ZExtBuilder(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *InsertPt, <a class="code" href="classllvm_1_1Value.html">Value</a> *Opnd, <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty)</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;        : TypePromotionAction(InsertPt) {</div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;      <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(InsertPt);</div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetCurrentDebugLocation(<a class="code" href="classllvm_1_1DebugLoc.html">DebugLoc</a>());</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;      Val = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateZExt(Opnd, Ty, <span class="stringliteral">&quot;promoted&quot;</span>);</div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Do: ZExtBuilder: &quot;</span> &lt;&lt; *Val &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;    }</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;<span class="comment">    /// Get the built value.</span></div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1Value.html">Value</a> *getBuiltValue() { <span class="keywordflow">return</span> Val; }</div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;<span class="comment">    /// Remove the built instruction.</span></div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> undo()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Undo: ZExtBuilder: &quot;</span> &lt;&lt; *Val &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *IVal = dyn_cast&lt;Instruction&gt;(Val))</div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;        IVal-&gt;eraseFromParent();</div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;    }</div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;  };</div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;<span class="comment">  /// Mutate an instruction to another type.</span></div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;<span class="comment"></span>  <span class="keyword">class </span>TypeMutator : <span class="keyword">public</span> TypePromotionAction {<span class="comment"></span></div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;<span class="comment">    /// Record the original type.</span></div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1Type.html">Type</a> *OrigTy;</div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160; </div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;  <span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;<span class="comment">    /// Mutate the type of \p Inst into \p NewTy.</span></div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;<span class="comment"></span>    TypeMutator(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst, <a class="code" href="classllvm_1_1Type.html">Type</a> *NewTy)</div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;        : TypePromotionAction(Inst), OrigTy(Inst-&gt;<a class="code" href="M68kELFObjectWriter_8cpp.html#ae4a8bc3879d2282eefd72b16b12c2a37">getType</a>()) {</div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Do: MutateType: &quot;</span> &lt;&lt; *Inst &lt;&lt; <span class="stringliteral">&quot; with &quot;</span> &lt;&lt; *NewTy</div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;      Inst-&gt;<a class="code" href="classllvm_1_1Value.html#ac0f09c2c9951158f9eecfaf7068d7b20">mutateType</a>(NewTy);</div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;    }</div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;<span class="comment">    /// Mutate the instruction back to its original type.</span></div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> undo()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Undo: MutateType: &quot;</span> &lt;&lt; *Inst &lt;&lt; <span class="stringliteral">&quot; with &quot;</span> &lt;&lt; *OrigTy</div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;      Inst-&gt;<a class="code" href="classllvm_1_1Value.html#ac0f09c2c9951158f9eecfaf7068d7b20">mutateType</a>(OrigTy);</div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;    }</div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;  };</div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;<span class="comment">  /// Replace the uses of an instruction by another instruction.</span></div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;<span class="comment"></span>  <span class="keyword">class </span>UsesReplacer : <span class="keyword">public</span> TypePromotionAction {<span class="comment"></span></div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;<span class="comment">    /// Helper structure to keep track of the replaced uses.</span></div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;<span class="comment"></span>    <span class="keyword">struct </span>InstructionAndIdx {<span class="comment"></span></div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;<span class="comment">      /// The instruction using the instruction.</span></div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;<span class="comment"></span>      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst;</div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;<span class="comment">      /// The index where this instruction is used for Inst.</span></div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;<span class="comment"></span>      <span class="keywordtype">unsigned</span> Idx;</div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160; </div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;      InstructionAndIdx(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst, <span class="keywordtype">unsigned</span> Idx)</div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;          : Inst(Inst), Idx(Idx) {}</div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;    };</div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;<span class="comment">    /// Keep track of the original uses (pair Instruction, Index).</span></div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;InstructionAndIdx, 4&gt;</a> OriginalUses;<span class="comment"></span></div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;<span class="comment">    /// Keep track of the debug users.</span></div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;DbgValueInst *, 1&gt;</a> DbgValues;</div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;<span class="comment">    /// Keep track of the new value so that we can undo it by replacing</span></div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;<span class="comment">    /// instances of the new value with the original value.</span></div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1ms__demangle.html#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a>;</div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160; </div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;    <span class="keyword">using</span> use_iterator = <a class="code" href="classllvm_1_1SmallVectorImpl.html#ac5b936169badf0b703567eb960278648">SmallVectorImpl&lt;InstructionAndIdx&gt;::iterator</a>;</div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160; </div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;  <span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;<span class="comment">    /// Replace all the use of \p Inst by \p New.</span></div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;<span class="comment"></span>    UsesReplacer(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst, <a class="code" href="classllvm_1_1Value.html">Value</a> *New)</div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;        : TypePromotionAction(Inst), <a class="code" href="namespacellvm_1_1ms__demangle.html#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a>(<a class="code" href="namespacellvm_1_1ms__demangle.html#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a>) {</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Do: UsersReplacer: &quot;</span> &lt;&lt; *Inst &lt;&lt; <span class="stringliteral">&quot; with &quot;</span> &lt;&lt; *New</div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;      <span class="comment">// Record the original uses.</span></div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U : Inst-&gt;<a class="code" href="classllvm_1_1Value.html#aecb93439702247fe5353a9966f7cefcd">uses</a>()) {</div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;        <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *UserI = cast&lt;Instruction&gt;(U.getUser());</div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;        OriginalUses.push_back(InstructionAndIdx(UserI, U.getOperandNo()));</div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;      }</div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;      <span class="comment">// Record the debug uses separately. They are not in the instruction&#39;s</span></div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;      <span class="comment">// use list, but they are replaced by RAUW.</span></div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;      <a class="code" href="namespacellvm.html#a8813c8445d4429956ae5a3647f02fcfb">findDbgValues</a>(DbgValues, Inst);</div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160; </div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;      <span class="comment">// Now, we can replace the uses.</span></div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;      Inst-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(New);</div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;    }</div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;<span class="comment">    /// Reassign the original uses of Inst to Inst.</span></div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> undo()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Undo: UsersReplacer: &quot;</span> &lt;&lt; *Inst &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;      <span class="keywordflow">for</span> (InstructionAndIdx &amp;<a class="code" href="classllvm_1_1Use.html">Use</a> : OriginalUses)</div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;        <a class="code" href="classllvm_1_1Use.html">Use</a>.Inst-&gt;setOperand(<a class="code" href="classllvm_1_1Use.html">Use</a>.Idx, Inst);</div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;      <span class="comment">// RAUW has replaced all original uses with references to the new value,</span></div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;      <span class="comment">// including the debug uses. Since we are undoing the replacements,</span></div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;      <span class="comment">// the original debug uses must also be reinstated to maintain the</span></div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;      <span class="comment">// correctness and utility of debug value instructions.</span></div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *DVI : DbgValues)</div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;        DVI-&gt;replaceVariableLocationOp(New, Inst);</div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;    }</div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;  };</div>
<div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;<span class="comment">  /// Remove an instruction from the IR.</span></div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;<span class="comment"></span>  <span class="keyword">class </span>InstructionRemover : <span class="keyword">public</span> TypePromotionAction {<span class="comment"></span></div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;<span class="comment">    /// Original position of the instruction.</span></div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;<span class="comment"></span>    InsertionHandler Inserter;</div>
<div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;<span class="comment">    /// Helper structure to hide all the link to the instruction. In other</span></div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;<span class="comment">    /// words, this helps to do as if the instruction was removed.</span></div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;<span class="comment"></span>    OperandsHider Hider;</div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;<span class="comment">    /// Keep track of the uses replaced, if any.</span></div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;<span class="comment"></span>    UsesReplacer *Replacer = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;<span class="comment">    /// Keep track of instructions removed.</span></div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;<span class="comment"></span>    SetOfInstrs &amp;RemovedInsts;</div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160; </div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;  <span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;<span class="comment">    /// Remove all reference of \p Inst and optionally replace all its</span></div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;<span class="comment">    /// uses with New.</span></div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;<span class="comment">    /// \p RemovedInsts Keep track of the instructions removed by this Action.</span></div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;<span class="comment">    /// \pre If !Inst-&gt;use_empty(), then New != nullptr</span></div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;<span class="comment"></span>    InstructionRemover(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst, SetOfInstrs &amp;RemovedInsts,</div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;                       <a class="code" href="classllvm_1_1Value.html">Value</a> *New = <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;        : TypePromotionAction(Inst), Inserter(Inst), Hider(Inst),</div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;          RemovedInsts(RemovedInsts) {</div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;      <span class="keywordflow">if</span> (New)</div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;        Replacer = <span class="keyword">new</span> UsesReplacer(Inst, New);</div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Do: InstructionRemover: &quot;</span> &lt;&lt; *Inst &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;      RemovedInsts.insert(Inst);<span class="comment"></span></div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;<span class="comment">      /// The instructions removed here will be freed after completing</span></div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;<span class="comment">      /// optimizeBlock() for all blocks as we need to keep track of the</span></div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;<span class="comment">      /// removed instructions during promotion.</span></div>
<div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;<span class="comment"></span>      Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a0fd53f63d349dc8a7c5fc0cdd7a94c8d">removeFromParent</a>();</div>
<div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;    }</div>
<div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160; </div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;    ~InstructionRemover()<span class="keyword"> override </span>{ <span class="keyword">delete</span> Replacer; }</div>
<div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;<span class="comment">    /// Resurrect the instruction and reassign it to the proper uses if</span></div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;<span class="comment">    /// new value was provided when build this action.</span></div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> undo()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Undo: InstructionRemover: &quot;</span> &lt;&lt; *Inst &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;      Inserter.insert(Inst);</div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;      <span class="keywordflow">if</span> (Replacer)</div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;        Replacer-&gt;undo();</div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;      Hider.undo();</div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;      RemovedInsts.erase(Inst);</div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;    }</div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;  };</div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160; </div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;<span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;<span class="comment">  /// Restoration point.</span></div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;<span class="comment">  /// The restoration point is a pointer to an action instead of an iterator</span></div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;<span class="comment">  /// because the iterator may be invalidated but not the pointer.</span></div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;<span class="comment"></span>  <span class="keyword">using</span> ConstRestorationPt = <span class="keyword">const</span> TypePromotionAction *;</div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160; </div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;  TypePromotionTransaction(SetOfInstrs &amp;RemovedInsts)</div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;      : RemovedInsts(RemovedInsts) {}</div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;<span class="comment">  /// Advocate every changes made in that transaction. Return true if any change</span></div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;<span class="comment">  /// happen.</span></div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> commit();</div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;<span class="comment">  /// Undo all the changes made after the given point.</span></div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> rollback(ConstRestorationPt Point);</div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;<span class="comment">  /// Get the current restoration point.</span></div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;<span class="comment"></span>  ConstRestorationPt getRestorationPoint() <span class="keyword">const</span>;</div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;<span class="comment">  /// \name API for IR modification with state keeping to support rollback.</span></div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;<span class="comment">  /// @{</span></div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;<span class="comment">  /// Same as Instruction::setOperand.</span></div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> setOperand(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst, <span class="keywordtype">unsigned</span> Idx, <a class="code" href="classllvm_1_1Value.html">Value</a> *NewVal);</div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;<span class="comment">  /// Same as Instruction::eraseFromParent.</span></div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="LICM_8cpp.html#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst, <a class="code" href="classllvm_1_1Value.html">Value</a> *NewVal = <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;<span class="comment">  /// Same as Value::replaceAllUsesWith.</span></div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst, <a class="code" href="classllvm_1_1Value.html">Value</a> *New);</div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;<span class="comment">  /// Same as Value::mutateType.</span></div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> mutateType(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst, <a class="code" href="classllvm_1_1Type.html">Type</a> *NewTy);</div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;<span class="comment">  /// Same as IRBuilder::createTrunc.</span></div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Value.html">Value</a> *createTrunc(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Opnd, <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty);</div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;<span class="comment">  /// Same as IRBuilder::createSExt.</span></div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Value.html">Value</a> *createSExt(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst, <a class="code" href="classllvm_1_1Value.html">Value</a> *Opnd, <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty);</div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;<span class="comment">  /// Same as IRBuilder::createZExt.</span></div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Value.html">Value</a> *createZExt(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst, <a class="code" href="classllvm_1_1Value.html">Value</a> *Opnd, <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty);</div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;<span class="comment">  /// Same as Instruction::moveBefore.</span></div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> moveBefore(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Before);<span class="comment"></span></div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;<span class="comment">  /// @}</span></div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;<span class="keyword">private</span>:<span class="comment"></span></div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;<span class="comment">  /// The ordered list of actions made so far.</span></div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::unique_ptr&lt;TypePromotionAction&gt;</a>, 16&gt; Actions;</div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160; </div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;  <span class="keyword">using</span> CommitPt =</div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;      <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;std::unique_ptr&lt;TypePromotionAction&gt;</a>&gt;::iterator;</div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160; </div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;  SetOfInstrs &amp;RemovedInsts;</div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;};</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160; </div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160; </div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;<span class="keywordtype">void</span> TypePromotionTransaction::setOperand(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst, <span class="keywordtype">unsigned</span> Idx,</div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;                                          <a class="code" href="classllvm_1_1Value.html">Value</a> *NewVal) {</div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;  Actions.push_back(std::make_unique&lt;TypePromotionTransaction::OperandSetter&gt;(</div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;      Inst, Idx, NewVal));</div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;}</div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160; </div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;<span class="keywordtype">void</span> <a class="code" href="LICM_8cpp.html#ab0cfc793d55940eac67854827dd365e9">TypePromotionTransaction::eraseInstruction</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst,</div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;                                                <a class="code" href="classllvm_1_1Value.html">Value</a> *NewVal) {</div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;  Actions.push_back(</div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;      std::make_unique&lt;TypePromotionTransaction::InstructionRemover&gt;(</div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;          Inst, RemovedInsts, NewVal));</div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;}</div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160; </div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;<span class="keywordtype">void</span> <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">TypePromotionTransaction::replaceAllUsesWith</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst,</div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;                                                  <a class="code" href="classllvm_1_1Value.html">Value</a> *New) {</div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;  Actions.push_back(</div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;      std::make_unique&lt;TypePromotionTransaction::UsesReplacer&gt;(Inst, New));</div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;}</div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160; </div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;<span class="keywordtype">void</span> TypePromotionTransaction::mutateType(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst, <a class="code" href="classllvm_1_1Type.html">Type</a> *NewTy) {</div>
<div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;  Actions.push_back(</div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;      std::make_unique&lt;TypePromotionTransaction::TypeMutator&gt;(Inst, NewTy));</div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;}</div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160; </div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;<a class="code" href="classllvm_1_1Value.html">Value</a> *TypePromotionTransaction::createTrunc(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Opnd, <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty) {</div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;  std::unique_ptr&lt;TruncBuilder&gt; <a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>(<span class="keyword">new</span> TruncBuilder(Opnd, Ty));</div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Val = <a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getBuiltValue();</div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;  Actions.push_back(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">std::move</a>(<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>));</div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;  <span class="keywordflow">return</span> Val;</div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;}</div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160; </div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;<a class="code" href="classllvm_1_1Value.html">Value</a> *TypePromotionTransaction::createSExt(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst, <a class="code" href="classllvm_1_1Value.html">Value</a> *Opnd,</div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;                                            <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty) {</div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;  std::unique_ptr&lt;SExtBuilder&gt; <a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>(<span class="keyword">new</span> SExtBuilder(Inst, Opnd, Ty));</div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Val = <a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getBuiltValue();</div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;  Actions.push_back(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">std::move</a>(<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>));</div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;  <span class="keywordflow">return</span> Val;</div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;}</div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160; </div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;<a class="code" href="classllvm_1_1Value.html">Value</a> *TypePromotionTransaction::createZExt(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst, <a class="code" href="classllvm_1_1Value.html">Value</a> *Opnd,</div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;                                            <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty) {</div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;  std::unique_ptr&lt;ZExtBuilder&gt; <a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>(<span class="keyword">new</span> ZExtBuilder(Inst, Opnd, Ty));</div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Val = <a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getBuiltValue();</div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;  Actions.push_back(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">std::move</a>(<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>));</div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;  <span class="keywordflow">return</span> Val;</div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;}</div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160; </div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;<span class="keywordtype">void</span> TypePromotionTransaction::moveBefore(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst,</div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;                                          <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Before) {</div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;  Actions.push_back(</div>
<div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;      std::make_unique&lt;TypePromotionTransaction::InstructionMoveBefore&gt;(</div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;          Inst, Before));</div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;}</div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160; </div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;TypePromotionTransaction::ConstRestorationPt</div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;TypePromotionTransaction::getRestorationPoint()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;  <span class="keywordflow">return</span> !Actions.empty() ? Actions.back().get() : <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;}</div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160; </div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;<span class="keywordtype">bool</span> TypePromotionTransaction::commit() {</div>
<div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;  <span class="keywordflow">for</span> (std::unique_ptr&lt;TypePromotionAction&gt; &amp;Action : Actions)</div>
<div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;    Action-&gt;commit();</div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = !Actions.empty();</div>
<div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;  Actions.clear();</div>
<div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</div>
<div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;}</div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160; </div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;<span class="keywordtype">void</span> TypePromotionTransaction::rollback(</div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;    TypePromotionTransaction::ConstRestorationPt Point) {</div>
<div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;  <span class="keywordflow">while</span> (!Actions.empty() &amp;&amp; Point != Actions.back().get()) {</div>
<div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;    std::unique_ptr&lt;TypePromotionAction&gt; Curr = Actions.pop_back_val();</div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;    Curr-&gt;undo();</div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;  }</div>
<div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;}</div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160; </div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;<span class="comment">/// A helper class for matching addressing modes.</span></div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;<span class="comment">/// This encapsulates the logic for matching the target-legal addressing modes.</span></div>
<div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;<span class="comment"></span><span class="keyword">class </span>AddressingModeMatcher {</div>
<div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;  <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;AddrModeInsts;</div>
<div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI;</div>
<div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetRegisterInfo.html">TargetRegisterInfo</a> &amp;<a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>;</div>
<div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>;</div>
<div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1LoopInfo.html">LoopInfo</a> &amp;LI;</div>
<div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;  <span class="keyword">const</span> <a class="code" href="MemDepPrinter_8cpp.html#a470d8721ad7c3b718e9daeabdaeb4700">std::function</a>&lt;<span class="keyword">const</span> <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;()&gt; getDTFn;</div>
<div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;<span class="comment">  /// AccessTy/MemoryInst - This is the type for the access (e.g. double) and</span></div>
<div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;<span class="comment">  /// the memory instruction that we&#39;re computing this address for.</span></div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Type.html">Type</a> *AccessTy;</div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;  <span class="keywordtype">unsigned</span> AddrSpace;</div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *MemoryInst;</div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;<span class="comment">  /// This is the addressing mode that we&#39;re building up. This is</span></div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;<span class="comment">  /// part of the return value of this addressing mode matching stuff.</span></div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;<span class="comment"></span>  <a class="code" href="structllvm_1_1ExtAddrMode.html">ExtAddrMode</a> &amp;<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>;</div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;<span class="comment">  /// The instructions inserted by other CodeGenPrepare optimizations.</span></div>
<div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;<span class="comment"></span>  <span class="keyword">const</span> SetOfInstrs &amp;InsertedInsts;</div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;<span class="comment">  /// A map from the instructions to their type before promotion.</span></div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;<span class="comment"></span>  InstrToOrigTy &amp;PromotedInsts;</div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;<span class="comment">  /// The ongoing transaction where every action should be registered.</span></div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;<span class="comment"></span>  TypePromotionTransaction &amp;TPT;</div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160; </div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;  <span class="comment">// A GEP which has too large offset to be folded into the addressing mode.</span></div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;  std::pair&lt;AssertingVH&lt;GetElementPtrInst&gt;, int64_t&gt; &amp;LargeOffsetGEP;</div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;<span class="comment">  /// This is set to true when we should not do profitability checks.</span></div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;<span class="comment">  /// When true, IsProfitableToFoldIntoAddressingMode always returns true.</span></div>
<div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> IgnoreProfitability;</div>
<div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;<span class="comment">  /// True if we are optimizing for size.</span></div>
<div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> OptSize;</div>
<div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160; </div>
<div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;  <a class="code" href="classllvm_1_1ProfileSummaryInfo.html">ProfileSummaryInfo</a> *PSI;</div>
<div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;  <a class="code" href="classllvm_1_1BlockFrequencyInfo.html">BlockFrequencyInfo</a> *<a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>;</div>
<div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160; </div>
<div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;  AddressingModeMatcher(</div>
<div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;      <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;AMI, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI,</div>
<div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetRegisterInfo.html">TargetRegisterInfo</a> &amp;<a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1LoopInfo.html">LoopInfo</a> &amp;LI,</div>
<div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;      <span class="keyword">const</span> <a class="code" href="MemDepPrinter_8cpp.html#a470d8721ad7c3b718e9daeabdaeb4700">std::function</a>&lt;<span class="keyword">const</span> <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;()&gt; getDTFn, <a class="code" href="classllvm_1_1Type.html">Type</a> *AT,</div>
<div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;      <span class="keywordtype">unsigned</span> AS, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a class="code" href="structllvm_1_1ExtAddrMode.html">ExtAddrMode</a> &amp;AM,</div>
<div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;      <span class="keyword">const</span> SetOfInstrs &amp;InsertedInsts, InstrToOrigTy &amp;PromotedInsts,</div>
<div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;      TypePromotionTransaction &amp;TPT,</div>
<div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;      std::pair&lt;<a class="code" href="classllvm_1_1AssertingVH.html">AssertingVH&lt;GetElementPtrInst&gt;</a>, int64_t&gt; &amp;LargeOffsetGEP,</div>
<div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;      <span class="keywordtype">bool</span> OptSize, <a class="code" href="classllvm_1_1ProfileSummaryInfo.html">ProfileSummaryInfo</a> *PSI, <a class="code" href="classllvm_1_1BlockFrequencyInfo.html">BlockFrequencyInfo</a> *<a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>)</div>
<div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;      : AddrModeInsts(AMI), TLI(TLI), <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>(<a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>),</div>
<div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;        <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getModule()-&gt;getDataLayout()), LI(LI), getDTFn(getDTFn),</div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;        AccessTy(AT), AddrSpace(AS), MemoryInst(<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>), <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>(AM),</div>
<div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;        InsertedInsts(InsertedInsts), PromotedInsts(PromotedInsts), TPT(TPT),</div>
<div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;        LargeOffsetGEP(LargeOffsetGEP), OptSize(OptSize), PSI(PSI), <a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>(<a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>) {</div>
<div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;    IgnoreProfitability = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;  }</div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160; </div>
<div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;<span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;<span class="comment">  /// Find the maximal addressing mode that a load/store of V can fold,</span></div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;<span class="comment">  /// give an access type of AccessTy.  This returns a list of involved</span></div>
<div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;<span class="comment">  /// instructions in AddrModeInsts.</span></div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;<span class="comment">  /// \p InsertedInsts The instructions inserted by other CodeGenPrepare</span></div>
<div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;<span class="comment">  /// optimizations.</span></div>
<div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;<span class="comment">  /// \p PromotedInsts maps the instructions to their type before promotion.</span></div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;<span class="comment">  /// \p The ongoing transaction where every action should be registered.</span></div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> <a class="code" href="structllvm_1_1ExtAddrMode.html">ExtAddrMode</a></div>
<div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;  <a class="code" href="namespacellvm.html#a313a633eb3049b90e931206183e1251ea6da89265a9a8b0b28eb4946bb2ec0c6d">Match</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1Type.html">Type</a> *AccessTy, <span class="keywordtype">unsigned</span> AS, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *MemoryInst,</div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;        <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;AddrModeInsts,</div>
<div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;        <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI, <span class="keyword">const</span> <a class="code" href="classllvm_1_1LoopInfo.html">LoopInfo</a> &amp;LI,</div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;        <span class="keyword">const</span> <a class="code" href="MemDepPrinter_8cpp.html#a470d8721ad7c3b718e9daeabdaeb4700">std::function</a>&lt;<span class="keyword">const</span> <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;()&gt; getDTFn,</div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;        <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetRegisterInfo.html">TargetRegisterInfo</a> &amp;<a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <span class="keyword">const</span> SetOfInstrs &amp;InsertedInsts,</div>
<div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;        InstrToOrigTy &amp;PromotedInsts, TypePromotionTransaction &amp;TPT,</div>
<div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;        std::pair&lt;<a class="code" href="classllvm_1_1AssertingVH.html">AssertingVH&lt;GetElementPtrInst&gt;</a>, int64_t&gt; &amp;LargeOffsetGEP,</div>
<div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;        <span class="keywordtype">bool</span> OptSize, <a class="code" href="classllvm_1_1ProfileSummaryInfo.html">ProfileSummaryInfo</a> *PSI, <a class="code" href="classllvm_1_1BlockFrequencyInfo.html">BlockFrequencyInfo</a> *<a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>) {</div>
<div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;    <a class="code" href="structllvm_1_1ExtAddrMode.html">ExtAddrMode</a> <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>;</div>
<div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160; </div>
<div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a> = AddressingModeMatcher(AddrModeInsts, TLI, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, LI, getDTFn,</div>
<div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;                                         AccessTy, AS, MemoryInst, Result,</div>
<div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;                                         InsertedInsts, PromotedInsts, TPT,</div>
<div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;                                         LargeOffsetGEP, OptSize, PSI, <a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>)</div>
<div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;                       .matchAddr(V, 0);</div>
<div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;    (void)<a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a>;</div>
<div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a> &amp;&amp; <span class="stringliteral">&quot;Couldn&#39;t select *anything*?&quot;</span>);</div>
<div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>;</div>
<div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;  }</div>
<div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160; </div>
<div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;  <span class="keywordtype">bool</span> matchScaledValue(<a class="code" href="classllvm_1_1Value.html">Value</a> *ScaleReg, int64_t Scale, <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</div>
<div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;  <span class="keywordtype">bool</span> matchAddr(<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;  <span class="keywordtype">bool</span> matchOperationAddr(<a class="code" href="classllvm_1_1User.html">User</a> *AddrInst, <span class="keywordtype">unsigned</span> Opcode, <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>,</div>
<div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;                          <span class="keywordtype">bool</span> *MovedAway = <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;  <span class="keywordtype">bool</span> isProfitableToFoldIntoAddressingMode(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;                                            <a class="code" href="structllvm_1_1ExtAddrMode.html">ExtAddrMode</a> &amp;AMBefore,</div>
<div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;                                            <a class="code" href="structllvm_1_1ExtAddrMode.html">ExtAddrMode</a> &amp;AMAfter);</div>
<div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;  <span class="keywordtype">bool</span> valueAlreadyLiveAtInst(<a class="code" href="classllvm_1_1Value.html">Value</a> *Val, <a class="code" href="classllvm_1_1Value.html">Value</a> *KnownLive1, <a class="code" href="classllvm_1_1Value.html">Value</a> *KnownLive2);</div>
<div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;  <span class="keywordtype">bool</span> isPromotionProfitable(<span class="keywordtype">unsigned</span> NewCost, <span class="keywordtype">unsigned</span> OldCost,</div>
<div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;                             <a class="code" href="classllvm_1_1Value.html">Value</a> *PromotedOperand) <span class="keyword">const</span>;</div>
<div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;};</div>
<div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160; </div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;<span class="keyword">class </span>PhiNodeSet;</div>
<div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;<span class="comment">/// An iterator for PhiNodeSet.</span></div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;<span class="comment"></span><span class="keyword">class </span>PhiNodeSetIterator {</div>
<div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;  PhiNodeSet *<span class="keyword">const</span> Set;</div>
<div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;  <span class="keywordtype">size_t</span> CurrentIndex = 0;</div>
<div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160; </div>
<div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;<span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;<span class="comment">  /// The constructor. Start should point to either a valid element, or be equal</span></div>
<div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;<span class="comment">  /// to the size of the underlying SmallVector of the PhiNodeSet.</span></div>
<div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;<span class="comment"></span>  PhiNodeSetIterator(PhiNodeSet *<span class="keyword">const</span> Set, <span class="keywordtype">size_t</span> Start);</div>
<div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;  <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="namespacellvm.html#a2366b4a30c90d2207626fb717dfb778d">operator*</a>() <span class="keyword">const</span>;</div>
<div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;  PhiNodeSetIterator &amp;operator++();</div>
<div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#a4d812a2dd18aa186c164447e20e348e7">operator==</a>(<span class="keyword">const</span> PhiNodeSetIterator &amp;<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) <span class="keyword">const</span>;</div>
<div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#a2f883c895f4d244f4ed56ed8a8c160c1">operator!=</a>(<span class="keyword">const</span> PhiNodeSetIterator &amp;<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) <span class="keyword">const</span>;</div>
<div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;};</div>
<div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;<span class="comment">/// Keeps a set of PHINodes.</span></div>
<div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;<span class="comment">/// This is a minimal set implementation for a specific use case:</span></div>
<div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;<span class="comment">/// It is very fast when there are very few elements, but also provides good</span></div>
<div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;<span class="comment">/// performance when there are many. It is similar to SmallPtrSet, but also</span></div>
<div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;<span class="comment">/// provides iteration by insertion order, which is deterministic and stable</span></div>
<div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;<span class="comment">/// across runs. It is also similar to SmallSetVector, but provides removing</span></div>
<div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;<span class="comment">/// elements in O(1) time. This is achieved by not actually removing the element</span></div>
<div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;<span class="comment">/// from the underlying vector, so comes at the cost of using more memory, but</span></div>
<div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;<span class="comment">/// that is fine, since PhiNodeSets are used as short lived objects.</span></div>
<div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;<span class="comment"></span><span class="keyword">class </span>PhiNodeSet {</div>
<div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;  <span class="keyword">friend</span> <span class="keyword">class </span>PhiNodeSetIterator;</div>
<div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160; </div>
<div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;  <span class="keyword">using</span> MapType = <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;PHINode *, size_t, 32&gt;</a>;</div>
<div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;  <span class="keyword">using</span> iterator = PhiNodeSetIterator;</div>
<div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;<span class="comment">  /// Keeps the elements in the order of their insertion in the underlying</span></div>
<div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;<span class="comment">  /// vector. To achieve constant time removal, it never deletes any element.</span></div>
<div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;PHINode *, 32&gt;</a> <a class="code" href="namespacellvm_1_1rdf.html#adff32edf02469b3f29d410c0a4d68be3">NodeList</a>;</div>
<div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;<span class="comment">  /// Keeps the elements in the underlying set implementation. This (and not the</span></div>
<div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;<span class="comment">  /// NodeList defined above) is the source of truth on whether an element</span></div>
<div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;<span class="comment">  /// is actually in the collection.</span></div>
<div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;<span class="comment"></span>  MapType NodeMap;</div>
<div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;<span class="comment">  /// Points to the first valid (not deleted) element when the set is not empty</span></div>
<div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;<span class="comment">  /// and the value is not zero. Equals to the size of the underlying vector</span></div>
<div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;<span class="comment">  /// when the set is empty. When the value is 0, as in the beginning, the</span></div>
<div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;<span class="comment">  /// first element may or may not be valid.</span></div>
<div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;<span class="comment"></span>  <span class="keywordtype">size_t</span> FirstValidElement = 0;</div>
<div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160; </div>
<div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;<span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;<span class="comment">  /// Inserts a new element to the collection.</span></div>
<div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;<span class="comment">  /// \returns true if the element is actually added, i.e. was not in the</span></div>
<div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;<span class="comment">  /// collection before the operation.</span></div>
<div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> insert(<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>) {</div>
<div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;    <span class="keywordflow">if</span> (NodeMap.insert(std::make_pair(<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, <a class="code" href="structNodeList.html">NodeList</a>.size())).second) {</div>
<div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;      <a class="code" href="structNodeList.html">NodeList</a>.push_back(<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</div>
<div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;    }</div>
<div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;  }</div>
<div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;<span class="comment">  /// Removes the element from the collection.</span></div>
<div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;<span class="comment">  /// \returns whether the element is actually removed, i.e. was in the</span></div>
<div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;<span class="comment">  /// collection before the operation.</span></div>
<div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> erase(<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>) {</div>
<div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;    <span class="keywordflow">if</span> (NodeMap.erase(<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>)) {</div>
<div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;      SkipRemovedElements(FirstValidElement);</div>
<div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;    }</div>
<div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;  }</div>
<div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;<span class="comment">  /// Removes all elements and clears the collection.</span></div>
<div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="Coroutines_8cpp.html#ac781ce96aa25ba7f6fd38f72de665450">clear</a>() {</div>
<div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;    NodeMap.clear();</div>
<div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;    <a class="code" href="structNodeList.html">NodeList</a>.clear();</div>
<div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;    FirstValidElement = 0;</div>
<div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;  }</div>
<div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;<span class="comment">  /// \returns an iterator that will iterate the elements in the order of</span></div>
<div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;<span class="comment">  /// insertion.</span></div>
<div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;<span class="comment"></span>  iterator <a class="code" href="namespacellvm_1_1sys_1_1path.html#a00a76a729b319dc47beffbe07325565f">begin</a>() {</div>
<div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;    <span class="keywordflow">if</span> (FirstValidElement == 0)</div>
<div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;      SkipRemovedElements(FirstValidElement);</div>
<div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;    <span class="keywordflow">return</span> PhiNodeSetIterator(<span class="keyword">this</span>, FirstValidElement);</div>
<div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;  }</div>
<div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;<span class="comment">  /// \returns an iterator that points to the end of the collection.</span></div>
<div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;<span class="comment"></span>  iterator <a class="code" href="namespacellvm_1_1sys_1_1path.html#a214ec2f04ffd92636ed4bd2717607a1d">end</a>() { <span class="keywordflow">return</span> PhiNodeSetIterator(<span class="keyword">this</span>, <a class="code" href="structNodeList.html">NodeList</a>.size()); }</div>
<div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;<span class="comment">  /// Returns the number of elements in the collection.</span></div>
<div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;<span class="comment"></span>  <span class="keywordtype">size_t</span> <a class="code" href="namespacellvm.html#a10f3d955592ae2bc745f57e5b48ae115">size</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> NodeMap.size(); }</div>
<div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;<span class="comment">  /// \returns 1 if the given element is in the collection, and 0 if otherwise.</span></div>
<div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;<span class="comment"></span>  <span class="keywordtype">size_t</span> <a class="code" href="namespacellvm.html#ab1772fd431decccb7926d484ea223db7">count</a>(<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> NodeMap.count(<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>); }</div>
<div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160; </div>
<div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;<span class="keyword">private</span>:<span class="comment"></span></div>
<div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;<span class="comment">  /// Updates the CurrentIndex so that it will point to a valid element.</span></div>
<div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;<span class="comment">  ///</span></div>
<div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;<span class="comment">  /// If the element of NodeList at CurrentIndex is valid, it does not</span></div>
<div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;<span class="comment">  /// change it. If there are no more valid elements, it updates CurrentIndex</span></div>
<div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;<span class="comment">  /// to point to the end of the NodeList.</span></div>
<div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> SkipRemovedElements(<span class="keywordtype">size_t</span> &amp;CurrentIndex) {</div>
<div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;    <span class="keywordflow">while</span> (CurrentIndex &lt; <a class="code" href="structNodeList.html">NodeList</a>.size()) {</div>
<div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;      <span class="keyword">auto</span> <a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a> = NodeMap.find(<a class="code" href="structNodeList.html">NodeList</a>[CurrentIndex]);</div>
<div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;      <span class="comment">// If the element has been deleted and added again later, NodeMap will</span></div>
<div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;      <span class="comment">// point to a different index, so CurrentIndex will still be invalid.</span></div>
<div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a> != NodeMap.end() &amp;&amp; <a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a>-&gt;second == CurrentIndex)</div>
<div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;      ++CurrentIndex;</div>
<div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;    }</div>
<div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;  }</div>
<div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;};</div>
<div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160; </div>
<div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;PhiNodeSetIterator::PhiNodeSetIterator(PhiNodeSet *<span class="keyword">const</span> Set, <span class="keywordtype">size_t</span> Start)</div>
<div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;    : Set(Set), CurrentIndex(Start) {}</div>
<div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160; </div>
<div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="namespacellvm.html#a2366b4a30c90d2207626fb717dfb778d">PhiNodeSetIterator::operator*</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CurrentIndex &lt; Set-&gt;<a class="code" href="structNodeList.html">NodeList</a>.size() &amp;&amp;</div>
<div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;         <span class="stringliteral">&quot;PhiNodeSet access out of range&quot;</span>);</div>
<div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;  <span class="keywordflow">return</span> Set-&gt;NodeList[CurrentIndex];</div>
<div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;}</div>
<div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160; </div>
<div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;PhiNodeSetIterator &amp;PhiNodeSetIterator::operator++() {</div>
<div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CurrentIndex &lt; Set-&gt;<a class="code" href="structNodeList.html">NodeList</a>.size() &amp;&amp;</div>
<div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;         <span class="stringliteral">&quot;PhiNodeSet access out of range&quot;</span>);</div>
<div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;  ++CurrentIndex;</div>
<div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;  Set-&gt;SkipRemovedElements(CurrentIndex);</div>
<div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;  <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;}</div>
<div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160; </div>
<div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#a4d812a2dd18aa186c164447e20e348e7">PhiNodeSetIterator::operator==</a>(<span class="keyword">const</span> PhiNodeSetIterator &amp;<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;  <span class="keywordflow">return</span> CurrentIndex == <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>.CurrentIndex;</div>
<div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;}</div>
<div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160; </div>
<div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#a2f883c895f4d244f4ed56ed8a8c160c1">PhiNodeSetIterator::operator!=</a>(<span class="keyword">const</span> PhiNodeSetIterator &amp;<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;  <span class="keywordflow">return</span> !((*this) == <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</div>
<div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;}</div>
<div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;<span class="comment">/// Keep track of simplification of Phi nodes.</span></div>
<div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;<span class="comment">/// Accept the set of all phi nodes and erase phi node from this set</span></div>
<div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;<span class="comment">/// if it is simplified.</span></div>
<div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;<span class="comment"></span><span class="keyword">class </span>SimplificationTracker {</div>
<div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, Value *&gt;</a> Storage;</div>
<div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;  <span class="keyword">const</span> <a class="code" href="structllvm_1_1SimplifyQuery.html">SimplifyQuery</a> &amp;SQ;</div>
<div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;  <span class="comment">// Tracks newly created Phi nodes. The elements are iterated by insertion</span></div>
<div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;  <span class="comment">// order.</span></div>
<div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;  PhiNodeSet AllPhiNodes;</div>
<div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;  <span class="comment">// Tracks newly created Select nodes.</span></div>
<div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;SelectInst *, 32&gt;</a> AllSelectNodes;</div>
<div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160; </div>
<div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;  SimplificationTracker(<span class="keyword">const</span> <a class="code" href="structllvm_1_1SimplifyQuery.html">SimplifyQuery</a> &amp;sq) : SQ(sq) {}</div>
<div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160; </div>
<div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Get(<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;    <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;      <span class="keyword">auto</span> SV = Storage.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(V);</div>
<div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;      <span class="keywordflow">if</span> (SV == Storage.<a class="code" href="classllvm_1_1DenseMapBase.html#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</div>
<div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;        <span class="keywordflow">return</span> V;</div>
<div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;      V = SV-&gt;second;</div>
<div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;    } <span class="keywordflow">while</span> (<span class="keyword">true</span>);</div>
<div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;  }</div>
<div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160; </div>
<div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="AssumeBundleBuilder_8cpp.html#a709b7e6fb4fd58a430c97e27c45f6b31">Simplify</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *Val) {</div>
<div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 32&gt;</a> WorkList;</div>
<div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value *, 32&gt;</a> Visited;</div>
<div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;    WorkList.push_back(Val);</div>
<div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;    <span class="keywordflow">while</span> (!WorkList.empty()) {</div>
<div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> = WorkList.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a0c8ffe664a36e30d49c84d0aded2fe08">pop_back_val</a>();</div>
<div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;      <span class="keywordflow">if</span> (!Visited.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>).second)</div>
<div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *PI = dyn_cast&lt;Instruction&gt;(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>))</div>
<div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="namespacellvm.html#aab02db480f387fca92956ef1c9a01941">simplifyInstruction</a>(cast&lt;Instruction&gt;(PI), SQ)) {</div>
<div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;          <span class="keywordflow">for</span> (<span class="keyword">auto</span> *U : PI-&gt;users())</div>
<div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;            WorkList.push_back(cast&lt;Value&gt;(U));</div>
<div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;          Put(PI, V);</div>
<div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;          PI-&gt;replaceAllUsesWith(V);</div>
<div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = dyn_cast&lt;PHINode&gt;(PI))</div>
<div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;            AllPhiNodes.erase(<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>);</div>
<div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a> = dyn_cast&lt;SelectInst&gt;(PI))</div>
<div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;            AllSelectNodes.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a11045c7973ab24a8d6315b61fa337d4e">erase</a>(<a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a>);</div>
<div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;          PI-&gt;eraseFromParent();</div>
<div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;        }</div>
<div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;    }</div>
<div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;    <span class="keywordflow">return</span> Get(Val);</div>
<div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;  }</div>
<div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160; </div>
<div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;  <span class="keywordtype">void</span> Put(<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="BlockVerifier_8cpp.html#ae45c7d73c0ff5d177b59153ffae77f84">From</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *To) { Storage.<a class="code" href="classllvm_1_1DenseMapBase.html#a99f811d53704275b4158c62a2dd138d9">insert</a>({<a class="code" href="BlockVerifier_8cpp.html#ae45c7d73c0ff5d177b59153ffae77f84">From</a>, To}); }</div>
<div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160; </div>
<div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;  <span class="keywordtype">void</span> ReplacePhi(<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="BlockVerifier_8cpp.html#ae45c7d73c0ff5d177b59153ffae77f84">From</a>, <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *To) {</div>
<div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *OldReplacement = Get(<a class="code" href="BlockVerifier_8cpp.html#ae45c7d73c0ff5d177b59153ffae77f84">From</a>);</div>
<div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;    <span class="keywordflow">while</span> (OldReplacement != <a class="code" href="BlockVerifier_8cpp.html#ae45c7d73c0ff5d177b59153ffae77f84">From</a>) {</div>
<div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;      <a class="code" href="BlockVerifier_8cpp.html#ae45c7d73c0ff5d177b59153ffae77f84">From</a> = To;</div>
<div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;      To = dyn_cast&lt;PHINode&gt;(OldReplacement);</div>
<div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;      OldReplacement = Get(<a class="code" href="BlockVerifier_8cpp.html#ae45c7d73c0ff5d177b59153ffae77f84">From</a>);</div>
<div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;    }</div>
<div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(To &amp;&amp; Get(To) == To &amp;&amp; <span class="stringliteral">&quot;Replacement PHI node is already replaced.&quot;</span>);</div>
<div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;    Put(<a class="code" href="BlockVerifier_8cpp.html#ae45c7d73c0ff5d177b59153ffae77f84">From</a>, To);</div>
<div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;    <a class="code" href="BlockVerifier_8cpp.html#ae45c7d73c0ff5d177b59153ffae77f84">From</a>-&gt;replaceAllUsesWith(To);</div>
<div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;    AllPhiNodes.erase(<a class="code" href="BlockVerifier_8cpp.html#ae45c7d73c0ff5d177b59153ffae77f84">From</a>);</div>
<div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;    <a class="code" href="BlockVerifier_8cpp.html#ae45c7d73c0ff5d177b59153ffae77f84">From</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;  }</div>
<div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160; </div>
<div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;  PhiNodeSet &amp;newPhiNodes() { <span class="keywordflow">return</span> AllPhiNodes; }</div>
<div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160; </div>
<div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;  <span class="keywordtype">void</span> insertNewPhi(<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN) { AllPhiNodes.insert(PN); }</div>
<div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160; </div>
<div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;  <span class="keywordtype">void</span> insertNewSelect(<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>) { AllSelectNodes.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>); }</div>
<div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160; </div>
<div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;  <span class="keywordtype">unsigned</span> countNewPhiNodes()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> AllPhiNodes.size(); }</div>
<div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160; </div>
<div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;  <span class="keywordtype">unsigned</span> countNewSelectNodes()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> AllSelectNodes.<a class="code" href="classllvm_1_1SmallPtrSetImplBase.html#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>(); }</div>
<div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160; </div>
<div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;  <span class="keywordtype">void</span> destroyNewNodes(<a class="code" href="classllvm_1_1Type.html">Type</a> *CommonType) {</div>
<div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;    <span class="comment">// For safe erasing, replace the uses with dummy value first.</span></div>
<div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;    <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1NVPTXISD.html#ab995b6d422b079c863075e073b2eb96ba7cff9cc4a40fe2b19129ee8e9b0ec645">Dummy</a> = <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">PoisonValue::get</a>(CommonType);</div>
<div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : AllPhiNodes) {</div>
<div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceAllUsesWith(<a class="code" href="namespacellvm_1_1NVPTXISD.html#ab995b6d422b079c863075e073b2eb96ba7cff9cc4a40fe2b19129ee8e9b0ec645">Dummy</a>);</div>
<div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;    }</div>
<div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;    AllPhiNodes.clear();</div>
<div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : AllSelectNodes) {</div>
<div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceAllUsesWith(<a class="code" href="namespacellvm_1_1NVPTXISD.html#ab995b6d422b079c863075e073b2eb96ba7cff9cc4a40fe2b19129ee8e9b0ec645">Dummy</a>);</div>
<div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;    }</div>
<div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;    AllSelectNodes.clear();</div>
<div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;  }</div>
<div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;};</div>
<div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;<span class="comment">/// A helper class for combining addressing modes.</span></div>
<div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;<span class="comment"></span><span class="keyword">class </span>AddressingModeCombiner {</div>
<div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, Value *&gt;</a> FoldAddrToValueMapping;</div>
<div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;  <span class="keyword">typedef</span> std::pair&lt;PHINode *, PHINode *&gt; PHIPair;</div>
<div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160; </div>
<div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;<span class="keyword">private</span>:<span class="comment"></span></div>
<div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;<span class="comment">  /// The addressing modes we&#39;ve collected.</span></div>
<div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;ExtAddrMode, 16&gt;</a> AddrModes;</div>
<div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;<span class="comment">  /// The field in which the AddrModes differ, when we have more than one.</span></div>
<div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;<span class="comment"></span>  ExtAddrMode::FieldName DifferentField = ExtAddrMode::NoField;</div>
<div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;<span class="comment">  /// Are the AddrModes that we have all just equal to their original values?</span></div>
<div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> AllAddrModesTrivial = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;<span class="comment">  /// Common Type for all different fields in addressing modes.</span></div>
<div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Type.html">Type</a> *CommonType = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;<span class="comment">  /// SimplifyQuery for simplifyInstruction utility.</span></div>
<div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;<span class="comment"></span>  <span class="keyword">const</span> <a class="code" href="structllvm_1_1SimplifyQuery.html">SimplifyQuery</a> &amp;SQ;</div>
<div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;<span class="comment">  /// Original Address.</span></div>
<div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Value.html">Value</a> *Original;</div>
<div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160; </div>
<div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;  AddressingModeCombiner(<span class="keyword">const</span> <a class="code" href="structllvm_1_1SimplifyQuery.html">SimplifyQuery</a> &amp;_SQ, <a class="code" href="classllvm_1_1Value.html">Value</a> *OriginalValue)</div>
<div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;      : SQ(_SQ), Original(OriginalValue) {}</div>
<div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;<span class="comment">  /// Get the combined AddrMode</span></div>
<div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;<span class="comment"></span>  <span class="keyword">const</span> <a class="code" href="structllvm_1_1ExtAddrMode.html">ExtAddrMode</a> &amp;<a class="code" href="namespacellvm_1_1HexagonMCInstrInfo.html#a213afb2c8d115f7e8c72c298e7f54046">getAddrMode</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> AddrModes[0]; }</div>
<div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;<span class="comment">  /// Add a new AddrMode if it&#39;s compatible with the AddrModes we already</span></div>
<div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;<span class="comment">  /// have.</span></div>
<div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;<span class="comment">  /// \return True iff we succeeded in doing so.</span></div>
<div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> addNewAddrMode(<a class="code" href="structllvm_1_1ExtAddrMode.html">ExtAddrMode</a> &amp;NewAddrMode) {</div>
<div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;    <span class="comment">// Take note of if we have any non-trivial AddrModes, as we need to detect</span></div>
<div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;    <span class="comment">// when all AddrModes are trivial as then we would introduce a phi or select</span></div>
<div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;    <span class="comment">// which just duplicates what&#39;s already there.</span></div>
<div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;    AllAddrModesTrivial = AllAddrModesTrivial &amp;&amp; NewAddrMode.isTrivial();</div>
<div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160; </div>
<div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;    <span class="comment">// If this is the first addrmode then everything is fine.</span></div>
<div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;    <span class="keywordflow">if</span> (AddrModes.empty()) {</div>
<div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;      AddrModes.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>(NewAddrMode);</div>
<div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;    }</div>
<div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160; </div>
<div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;    <span class="comment">// Figure out how different this is from the other address modes, which we</span></div>
<div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;    <span class="comment">// can do just by comparing against the first one given that we only care</span></div>
<div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;    <span class="comment">// about the cumulative difference.</span></div>
<div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;    ExtAddrMode::FieldName ThisDifferentField =</div>
<div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;        AddrModes[0].compare(NewAddrMode);</div>
<div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;    <span class="keywordflow">if</span> (DifferentField == ExtAddrMode::NoField)</div>
<div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;      DifferentField = ThisDifferentField;</div>
<div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (DifferentField != ThisDifferentField)</div>
<div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;      DifferentField = ExtAddrMode::MultipleFields;</div>
<div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160; </div>
<div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;    <span class="comment">// If NewAddrMode differs in more than one dimension we cannot handle it.</span></div>
<div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;    <span class="keywordtype">bool</span> CanHandle = DifferentField != ExtAddrMode::MultipleFields;</div>
<div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160; </div>
<div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;    <span class="comment">// If Scale Field is different then we reject.</span></div>
<div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;    CanHandle = CanHandle &amp;&amp; DifferentField != ExtAddrMode::ScaleField;</div>
<div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160; </div>
<div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;    <span class="comment">// We also must reject the case when base offset is different and</span></div>
<div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;    <span class="comment">// scale reg is not null, we cannot handle this case due to merge of</span></div>
<div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;    <span class="comment">// different offsets will be used as ScaleReg.</span></div>
<div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;    CanHandle = CanHandle &amp;&amp; (DifferentField != ExtAddrMode::BaseOffsField ||</div>
<div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;                              !NewAddrMode.<a class="code" href="structllvm_1_1ExtAddrMode.html#a243a500ecf43f8be3648cd935b943165">ScaledReg</a>);</div>
<div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160; </div>
<div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;    <span class="comment">// We also must reject the case when GV is different and BaseReg installed</span></div>
<div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;    <span class="comment">// due to we want to use base reg as a merge of GV values.</span></div>
<div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;    CanHandle = CanHandle &amp;&amp; (DifferentField != ExtAddrMode::BaseGVField ||</div>
<div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;                              !NewAddrMode.HasBaseReg);</div>
<div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160; </div>
<div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;    <span class="comment">// Even if NewAddMode is the same we still need to collect it due to</span></div>
<div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;    <span class="comment">// original value is different. And later we will need all original values</span></div>
<div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;    <span class="comment">// as anchors during finding the common Phi node.</span></div>
<div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;    <span class="keywordflow">if</span> (CanHandle)</div>
<div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;      AddrModes.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>(NewAddrMode);</div>
<div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;      AddrModes.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div>
<div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160; </div>
<div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;    <span class="keywordflow">return</span> CanHandle;</div>
<div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;  }</div>
<div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;<span class="comment">  /// Combine the addressing modes we&#39;ve collected into a single</span></div>
<div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;<span class="comment">  /// addressing mode.</span></div>
<div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;<span class="comment">  /// \return True iff we successfully combined them or we only had one so</span></div>
<div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;<span class="comment">  /// didn&#39;t need to combine them anyway.</span></div>
<div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> combineAddrModes() {</div>
<div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;    <span class="comment">// If we have no AddrModes then they can&#39;t be combined.</span></div>
<div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;    <span class="keywordflow">if</span> (AddrModes.size() == 0)</div>
<div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160; </div>
<div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;    <span class="comment">// A single AddrMode can trivially be combined.</span></div>
<div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;    <span class="keywordflow">if</span> (AddrModes.size() == 1 || DifferentField == ExtAddrMode::NoField)</div>
<div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160; </div>
<div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;    <span class="comment">// If the AddrModes we collected are all just equal to the value they are</span></div>
<div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;    <span class="comment">// derived from then combining them wouldn&#39;t do anything useful.</span></div>
<div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;    <span class="keywordflow">if</span> (AllAddrModesTrivial)</div>
<div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160; </div>
<div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;    <span class="keywordflow">if</span> (!addrModeCombiningAllowed())</div>
<div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160; </div>
<div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;    <span class="comment">// Build a map between &lt;original value, basic block where we saw it&gt; to</span></div>
<div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;    <span class="comment">// value of base register.</span></div>
<div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;    <span class="comment">// Bail out if there is no common type.</span></div>
<div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;    FoldAddrToValueMapping <a class="code" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>;</div>
<div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;    <span class="keywordflow">if</span> (!initializeMap(Map))</div>
<div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160; </div>
<div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *CommonValue = findCommon(Map);</div>
<div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;    <span class="keywordflow">if</span> (CommonValue)</div>
<div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;      AddrModes[0].SetCombinedField(DifferentField, CommonValue, AddrModes);</div>
<div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;    <span class="keywordflow">return</span> CommonValue != <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;  }</div>
<div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160; </div>
<div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;<span class="keyword">private</span>:<span class="comment"></span></div>
<div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;<span class="comment">  /// Initialize Map with anchor values. For address seen</span></div>
<div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;<span class="comment">  /// we set the value of different field saw in this address.</span></div>
<div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;<span class="comment">  /// At the same time we find a common type for different field we will</span></div>
<div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;<span class="comment">  /// use to create new Phi/Select nodes. Keep it in CommonType field.</span></div>
<div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;<span class="comment">  /// Return false if there is no common type found.</span></div>
<div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> initializeMap(FoldAddrToValueMapping &amp;Map) {</div>
<div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;    <span class="comment">// Keep track of keys where the value is null. We will need to replace it</span></div>
<div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;    <span class="comment">// with constant null when we know the common type.</span></div>
<div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 2&gt;</a> NullValue;</div>
<div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *IntPtrTy = SQ.<a class="code" href="structllvm_1_1SimplifyQuery.html#a0ffb6d79f6befe2030328bd1d7110feb">DL</a>.<a class="code" href="classllvm_1_1DataLayout.html#a7a2619d0e489a4ba9c19a0d86a041d59">getIntPtrType</a>(AddrModes[0].OriginalValue-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;AM : AddrModes) {</div>
<div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *DV = AM.GetFieldAsValue(DifferentField, IntPtrTy);</div>
<div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;      <span class="keywordflow">if</span> (DV) {</div>
<div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;        <span class="keyword">auto</span> *<a class="code" href="classllvm_1_1Type.html">Type</a> = DV-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;        <span class="keywordflow">if</span> (CommonType &amp;&amp; CommonType != <a class="code" href="classllvm_1_1Type.html">Type</a>)</div>
<div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;        CommonType = <a class="code" href="ItaniumDemangle_8h.html#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a>;</div>
<div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;        <a class="code" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>[AM.OriginalValue] = DV;</div>
<div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;        NullValue.push_back(AM.OriginalValue);</div>
<div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;      }</div>
<div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;    }</div>
<div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CommonType &amp;&amp; <span class="stringliteral">&quot;At least one non-null value must be!&quot;</span>);</div>
<div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *V : NullValue)</div>
<div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;      <a class="code" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>[V] = Constant::getNullValue(CommonType);</div>
<div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;  }</div>
<div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;<span class="comment">  /// We have mapping between value A and other value B where B was a field in</span></div>
<div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;<span class="comment">  /// addressing mode represented by A. Also we have an original value C</span></div>
<div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;<span class="comment">  /// representing an address we start with. Traversing from C through phi and</span></div>
<div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;<span class="comment">  /// selects we ended up with A&#39;s in a map. This utility function tries to find</span></div>
<div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;<span class="comment">  /// a value V which is a field in addressing mode C and traversing through phi</span></div>
<div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;<span class="comment">  /// nodes and selects we will end up in corresponded values B in a map.</span></div>
<div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;<span class="comment">  /// The utility will create a new Phi/Selects if needed.</span></div>
<div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;<span class="comment"></span>  <span class="comment">// The simple example looks as follows:</span></div>
<div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;  <span class="comment">// BB1:</span></div>
<div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;  <span class="comment">//   p1 = b1 + 40</span></div>
<div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;  <span class="comment">//   br cond BB2, BB3</span></div>
<div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;  <span class="comment">// BB2:</span></div>
<div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;  <span class="comment">//   p2 = b2 + 40</span></div>
<div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;  <span class="comment">//   br BB3</span></div>
<div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;  <span class="comment">// BB3:</span></div>
<div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;  <span class="comment">//   p = phi [p1, BB1], [p2, BB2]</span></div>
<div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;  <span class="comment">//   v = load p</span></div>
<div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;  <span class="comment">// Map is</span></div>
<div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;  <span class="comment">//   p1 -&gt; b1</span></div>
<div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;  <span class="comment">//   p2 -&gt; b2</span></div>
<div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;  <span class="comment">// Request is</span></div>
<div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;  <span class="comment">//   p -&gt; ?</span></div>
<div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;  <span class="comment">// The function tries to find or build phi [b1, BB1], [b2, BB2] in BB3.</span></div>
<div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *findCommon(FoldAddrToValueMapping &amp;Map) {</div>
<div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;    <span class="comment">// Tracks the simplification of newly created phi nodes. The reason we use</span></div>
<div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;    <span class="comment">// this mapping is because we will add new created Phi nodes in AddrToBase.</span></div>
<div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;    <span class="comment">// Simplification of Phi nodes is recursive, so some Phi node may</span></div>
<div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;    <span class="comment">// be simplified after we added it to AddrToBase. In reality this</span></div>
<div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;    <span class="comment">// simplification is possible only if original phi/selects were not</span></div>
<div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;    <span class="comment">// simplified yet.</span></div>
<div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;    <span class="comment">// Using this mapping we can find the current value in AddrToBase.</span></div>
<div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;    SimplificationTracker <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>(SQ);</div>
<div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160; </div>
<div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;    <span class="comment">// First step, DFS to create PHI nodes for all intermediate blocks.</span></div>
<div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;    <span class="comment">// Also fill traverse order for the second step.</span></div>
<div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 32&gt;</a> TraverseOrder;</div>
<div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;    InsertPlaceholders(Map, TraverseOrder, <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>);</div>
<div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160; </div>
<div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;    <span class="comment">// Second Step, fill new nodes by merged values and simplify if possible.</span></div>
<div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;    FillPlaceholders(Map, TraverseOrder, <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>);</div>
<div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160; </div>
<div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="CodeGenPrepare_8cpp.html#aabbaf3d93d626617b19c4b5cac455e3b">AddrSinkNewSelects</a> &amp;&amp; <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.countNewSelectNodes() &gt; 0) {</div>
<div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;      <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.destroyNewNodes(CommonType);</div>
<div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;    }</div>
<div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160; </div>
<div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;    <span class="comment">// Now we&#39;d like to match New Phi nodes to existed ones.</span></div>
<div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;    <span class="keywordtype">unsigned</span> PhiNotMatchedCount = 0;</div>
<div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;    <span class="keywordflow">if</span> (!MatchPhiSet(<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>, <a class="code" href="CodeGenPrepare_8cpp.html#a9743916d4ba6931ccdd9500a52a31eca">AddrSinkNewPhis</a>, PhiNotMatchedCount)) {</div>
<div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;      <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.destroyNewNodes(CommonType);</div>
<div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;    }</div>
<div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160; </div>
<div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;    <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.Get(<a class="code" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>.find(Original)-&gt;second);</div>
<div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;    <span class="keywordflow">if</span> (Result) {</div>
<div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;      NumMemoryInstsPhiCreated += <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.countNewPhiNodes() + PhiNotMatchedCount;</div>
<div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;      NumMemoryInstsSelectCreated += <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.countNewSelectNodes();</div>
<div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;    }</div>
<div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>;</div>
<div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;  }</div>
<div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;<span class="comment">  /// Try to match PHI node to Candidate.</span></div>
<div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;<span class="comment">  /// Matcher tracks the matched Phi nodes.</span></div>
<div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> MatchPhiNode(<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *Candidate,</div>
<div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;                    <a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;PHIPair, 8&gt;</a> &amp;Matcher,</div>
<div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;                    PhiNodeSet &amp;PhiNodesToMatch) {</div>
<div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;PHIPair, 8&gt;</a> WorkList;</div>
<div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;    Matcher.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>({<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, Candidate});</div>
<div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;    <a class="code" href="classllvm_1_1SmallSet.html">SmallSet&lt;PHINode *, 8&gt;</a> MatchedPHIs;</div>
<div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;    MatchedPHIs.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>);</div>
<div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;    WorkList.push_back({<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, Candidate});</div>
<div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;    <a class="code" href="classllvm_1_1SmallSet.html">SmallSet&lt;PHIPair, 8&gt;</a> Visited;</div>
<div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;    <span class="keywordflow">while</span> (!WorkList.empty()) {</div>
<div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;      <span class="keyword">auto</span> Item = WorkList.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a0c8ffe664a36e30d49c84d0aded2fe08">pop_back_val</a>();</div>
<div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;      <span class="keywordflow">if</span> (!Visited.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(Item).second)</div>
<div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;      <span class="comment">// We iterate over all incoming values to Phi to compare them.</span></div>
<div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;      <span class="comment">// If values are different and both of them Phi and the first one is a</span></div>
<div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;      <span class="comment">// Phi we added (subject to match) and both of them is in the same basic</span></div>
<div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;      <span class="comment">// block then we can match our pair if values match. So we state that</span></div>
<div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;      <span class="comment">// these values match and add it to work list to verify that.</span></div>
<div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a> : Item.first-&gt;blocks()) {</div>
<div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *FirstValue = Item.first-&gt;getIncomingValueForBlock(<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>);</div>
<div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *SecondValue = Item.second-&gt;getIncomingValueForBlock(<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>);</div>
<div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;        <span class="keywordflow">if</span> (FirstValue == SecondValue)</div>
<div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160; </div>
<div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;        <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *FirstPhi = dyn_cast&lt;PHINode&gt;(FirstValue);</div>
<div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;        <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *SecondPhi = dyn_cast&lt;PHINode&gt;(SecondValue);</div>
<div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160; </div>
<div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;        <span class="comment">// One of them is not Phi or</span></div>
<div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;        <span class="comment">// The first one is not Phi node from the set we&#39;d like to match or</span></div>
<div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;        <span class="comment">// Phi nodes from different basic blocks then</span></div>
<div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;        <span class="comment">// we will not be able to match.</span></div>
<div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;        <span class="keywordflow">if</span> (!FirstPhi || !SecondPhi || !PhiNodesToMatch.count(FirstPhi) ||</div>
<div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;            FirstPhi-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() != SecondPhi-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>())</div>
<div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160; </div>
<div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;        <span class="comment">// If we already matched them then continue.</span></div>
<div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;        <span class="keywordflow">if</span> (Matcher.<a class="code" href="classllvm_1_1SetVector.html#a21c2c6ae5ec23004dc4020eacf83bbce">count</a>({FirstPhi, SecondPhi}))</div>
<div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;        <span class="comment">// So the values are different and does not match. So we need them to</span></div>
<div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;        <span class="comment">// match. (But we register no more than one match per PHI node, so that</span></div>
<div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;        <span class="comment">// we won&#39;t later try to replace them twice.)</span></div>
<div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;        <span class="keywordflow">if</span> (MatchedPHIs.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(FirstPhi).second)</div>
<div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;          Matcher.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>({FirstPhi, SecondPhi});</div>
<div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;        <span class="comment">// But me must check it.</span></div>
<div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;        WorkList.push_back({FirstPhi, SecondPhi});</div>
<div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;      }</div>
<div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;    }</div>
<div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;  }</div>
<div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;<span class="comment">  /// For the given set of PHI nodes (in the SimplificationTracker) try</span></div>
<div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;<span class="comment">  /// to find their equivalents.</span></div>
<div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;<span class="comment">  /// Returns false if this matching fails and creation of new Phi is disabled.</span></div>
<div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> MatchPhiSet(SimplificationTracker &amp;<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>, <span class="keywordtype">bool</span> AllowNewPhiNodes,</div>
<div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;                   <span class="keywordtype">unsigned</span> &amp;PhiNotMatchedCount) {</div>
<div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;    <span class="comment">// Matched and PhiNodesToMatch iterate their elements in a deterministic</span></div>
<div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;    <span class="comment">// order, so the replacements (ReplacePhi) are also done in a deterministic</span></div>
<div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;    <span class="comment">// order.</span></div>
<div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;    <a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;PHIPair, 8&gt;</a> Matched;</div>
<div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;PHINode *, 8&gt;</a> WillNotMatch;</div>
<div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;    PhiNodeSet &amp;PhiNodesToMatch = <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.newPhiNodes();</div>
<div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;    <span class="keywordflow">while</span> (PhiNodesToMatch.size()) {</div>
<div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;      <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = *PhiNodesToMatch.begin();</div>
<div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160; </div>
<div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;      <span class="comment">// Add us, if no Phi nodes in the basic block we do not match.</span></div>
<div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;      WillNotMatch.<a class="code" href="classllvm_1_1SmallPtrSetImplBase.html#a16413f1a88d8baca228d0a1b4cc0bfc6">clear</a>();</div>
<div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;      WillNotMatch.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>);</div>
<div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160; </div>
<div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;      <span class="comment">// Traverse all Phis until we found equivalent or fail to do that.</span></div>
<div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;      <span class="keywordtype">bool</span> IsMatched = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> : <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getParent()-&gt;phis()) {</div>
<div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;        <span class="comment">// Skip new Phi nodes.</span></div>
<div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;        <span class="keywordflow">if</span> (PhiNodesToMatch.count(&amp;<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>))</div>
<div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;        <span class="keywordflow">if</span> ((IsMatched = MatchPhiNode(<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, &amp;<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>, Matched, PhiNodesToMatch)))</div>
<div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;        <span class="comment">// If it does not match, collect all Phi nodes from matcher.</span></div>
<div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;        <span class="comment">// if we end up with no match, them all these Phi nodes will not match</span></div>
<div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;        <span class="comment">// later.</span></div>
<div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a> : Matched)</div>
<div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;          WillNotMatch.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.first);</div>
<div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;        Matched.clear();</div>
<div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;      }</div>
<div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;      <span class="keywordflow">if</span> (IsMatched) {</div>
<div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;        <span class="comment">// Replace all matched values and erase them.</span></div>
<div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> MV : Matched)</div>
<div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;          <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.ReplacePhi(MV.first, MV.second);</div>
<div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;        Matched.clear();</div>
<div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;      }</div>
<div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;      <span class="comment">// If we are not allowed to create new nodes then bail out.</span></div>
<div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;      <span class="keywordflow">if</span> (!AllowNewPhiNodes)</div>
<div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;      <span class="comment">// Just remove all seen values in matcher. They will not match anything.</span></div>
<div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;      PhiNotMatchedCount += WillNotMatch.<a class="code" href="classllvm_1_1SmallPtrSetImplBase.html#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>();</div>
<div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> : WillNotMatch)</div>
<div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;        PhiNodesToMatch.erase(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>);</div>
<div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;    }</div>
<div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;  }<span class="comment"></span></div>
<div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;<span class="comment">  /// Fill the placeholders with values from predecessors and simplify them.</span></div>
<div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> FillPlaceholders(FoldAddrToValueMapping &amp;Map,</div>
<div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;                        <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Value *&gt;</a> &amp;TraverseOrder,</div>
<div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;                        SimplificationTracker &amp;<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>) {</div>
<div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;    <span class="keywordflow">while</span> (!TraverseOrder.empty()) {</div>
<div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Current = TraverseOrder.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a0c8ffe664a36e30d49c84d0aded2fe08">pop_back_val</a>();</div>
<div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>.find(Current) != <a class="code" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>.end() &amp;&amp; <span class="stringliteral">&quot;No node to fill!!!&quot;</span>);</div>
<div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>[Current];</div>
<div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160; </div>
<div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a> = dyn_cast&lt;SelectInst&gt;(V)) {</div>
<div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;        <span class="comment">// CurrentValue also must be Select.</span></div>
<div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;        <span class="keyword">auto</span> *CurrentSelect = cast&lt;SelectInst&gt;(Current);</div>
<div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;        <span class="keyword">auto</span> *TrueValue = CurrentSelect-&gt;getTrueValue();</div>
<div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>.find(TrueValue) != <a class="code" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>.end() &amp;&amp; <span class="stringliteral">&quot;No True Value!&quot;</span>);</div>
<div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;        <a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a>-&gt;setTrueValue(<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.Get(Map[TrueValue]));</div>
<div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;        <span class="keyword">auto</span> *FalseValue = CurrentSelect-&gt;getFalseValue();</div>
<div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>.find(FalseValue) != <a class="code" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>.end() &amp;&amp; <span class="stringliteral">&quot;No False Value!&quot;</span>);</div>
<div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;        <a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a>-&gt;setFalseValue(<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.Get(Map[FalseValue]));</div>
<div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;        <span class="comment">// Must be a Phi node then.</span></div>
<div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;        <span class="keyword">auto</span> *<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = cast&lt;PHINode&gt;(V);</div>
<div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;        <span class="comment">// Fill the Phi node with values from predecessors.</span></div>
<div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a> : <a class="code" href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">predecessors</a>(<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getParent())) {</div>
<div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *PV = cast&lt;PHINode&gt;(Current)-&gt;getIncomingValueForBlock(<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>);</div>
<div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>.find(PV) != <a class="code" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>.end() &amp;&amp; <span class="stringliteral">&quot;No predecessor Value!&quot;</span>);</div>
<div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;          <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;addIncoming(<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.Get(Map[PV]), <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>);</div>
<div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;        }</div>
<div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;      }</div>
<div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;      <a class="code" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>[Current] = <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.Simplify(V);</div>
<div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;    }</div>
<div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;  }</div>
<div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;<span class="comment">  /// Starting from original value recursively iterates over def-use chain up to</span></div>
<div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;<span class="comment">  /// known ending values represented in a map. For each traversed phi/select</span></div>
<div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;<span class="comment">  /// inserts a placeholder Phi or Select.</span></div>
<div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;<span class="comment">  /// Reports all new created Phi/Select nodes by adding them to set.</span></div>
<div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;<span class="comment">  /// Also reports and order in what values have been traversed.</span></div>
<div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> InsertPlaceholders(FoldAddrToValueMapping &amp;Map,</div>
<div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;                          <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Value *&gt;</a> &amp;TraverseOrder,</div>
<div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;                          SimplificationTracker &amp;<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>) {</div>
<div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 32&gt;</a> Worklist;</div>
<div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((isa&lt;PHINode&gt;(Original) || isa&lt;SelectInst&gt;(Original)) &amp;&amp;</div>
<div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;           <span class="stringliteral">&quot;Address must be a Phi or Select node&quot;</span>);</div>
<div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;    <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1NVPTXISD.html#ab995b6d422b079c863075e073b2eb96ba7cff9cc4a40fe2b19129ee8e9b0ec645">Dummy</a> = <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">PoisonValue::get</a>(CommonType);</div>
<div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;    Worklist.push_back(Original);</div>
<div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;    <span class="keywordflow">while</span> (!Worklist.empty()) {</div>
<div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Current = Worklist.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a0c8ffe664a36e30d49c84d0aded2fe08">pop_back_val</a>();</div>
<div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;      <span class="comment">// if it is already visited or it is an ending value then skip it.</span></div>
<div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>.find(Current) != <a class="code" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>.end())</div>
<div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;      TraverseOrder.push_back(Current);</div>
<div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160; </div>
<div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;      <span class="comment">// CurrentValue must be a Phi node or select. All others must be covered</span></div>
<div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;      <span class="comment">// by anchors.</span></div>
<div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *CurrentSelect = dyn_cast&lt;SelectInst&gt;(Current)) {</div>
<div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;        <span class="comment">// Is it OK to get metadata from OrigSelect?!</span></div>
<div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;        <span class="comment">// Create a Select placeholder with dummy value.</span></div>
<div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;        <a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a> = SelectInst::Create(</div>
<div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;            CurrentSelect-&gt;getCondition(), <a class="code" href="namespacellvm_1_1NVPTXISD.html#ab995b6d422b079c863075e073b2eb96ba7cff9cc4a40fe2b19129ee8e9b0ec645">Dummy</a>, <a class="code" href="namespacellvm_1_1NVPTXISD.html#ab995b6d422b079c863075e073b2eb96ba7cff9cc4a40fe2b19129ee8e9b0ec645">Dummy</a>,</div>
<div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;            CurrentSelect-&gt;getName(), CurrentSelect, CurrentSelect);</div>
<div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;        <a class="code" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>[Current] = <a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a>;</div>
<div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;        <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.insertNewSelect(<a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a>);</div>
<div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;        <span class="comment">// We are interested in True and False values.</span></div>
<div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;        Worklist.push_back(CurrentSelect-&gt;getTrueValue());</div>
<div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;        Worklist.push_back(CurrentSelect-&gt;getFalseValue());</div>
<div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;        <span class="comment">// It must be a Phi node then.</span></div>
<div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;        <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *CurrentPhi = cast&lt;PHINode&gt;(Current);</div>
<div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;        <span class="keywordtype">unsigned</span> PredCount = CurrentPhi-&gt;<a class="code" href="classllvm_1_1PHINode.html#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>();</div>
<div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;        <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> =</div>
<div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;            PHINode::Create(CommonType, PredCount, <span class="stringliteral">&quot;sunk_phi&quot;</span>, CurrentPhi);</div>
<div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;        <a class="code" href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">Map</a>[Current] = <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>;</div>
<div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;        <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>.insertNewPhi(<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>);</div>
<div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;        <a class="code" href="namespacellvm.html#a39d3d23a084c4544ee5903203db10e8a">append_range</a>(Worklist, CurrentPhi-&gt;<a class="code" href="classllvm_1_1PHINode.html#a1f0ff79b64a40d383b891f1baba89c6b">incoming_values</a>());</div>
<div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;      }</div>
<div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;    }</div>
<div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;  }</div>
<div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160; </div>
<div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;  <span class="keywordtype">bool</span> addrModeCombiningAllowed() {</div>
<div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="CodeGenPrepare_8cpp.html#a22496210b244839d09594b0a7ca909b5">DisableComplexAddrModes</a>)</div>
<div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;    <span class="keywordflow">switch</span> (DifferentField) {</div>
<div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;    <span class="keywordflow">case</span> ExtAddrMode::BaseRegField:</div>
<div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="CodeGenPrepare_8cpp.html#a091230f607eef4cbb3383be2caaf0bbc">AddrSinkCombineBaseReg</a>;</div>
<div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;    <span class="keywordflow">case</span> ExtAddrMode::BaseGVField:</div>
<div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="CodeGenPrepare_8cpp.html#a2c270937482046b153d9f2664a334472">AddrSinkCombineBaseGV</a>;</div>
<div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;    <span class="keywordflow">case</span> ExtAddrMode::BaseOffsField:</div>
<div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="CodeGenPrepare_8cpp.html#ae698328bd40b02d91f42a2d0cc2f4c27">AddrSinkCombineBaseOffs</a>;</div>
<div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;    <span class="keywordflow">case</span> ExtAddrMode::ScaledRegField:</div>
<div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="CodeGenPrepare_8cpp.html#a267b57299445dea412bcda05811ffc3d">AddrSinkCombineScaledReg</a>;</div>
<div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;    }</div>
<div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;  }</div>
<div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;};</div>
<div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;<span class="comment">/// Try adding ScaleReg*Scale to the current addressing mode.</span></div>
<div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;<span class="comment">/// Return true and update AddrMode if this addr mode is legal for the target,</span></div>
<div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;<span class="comment">/// false if not.</span></div>
<div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> AddressingModeMatcher::matchScaledValue(<a class="code" href="classllvm_1_1Value.html">Value</a> *ScaleReg, int64_t Scale,</div>
<div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;                                             <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>) {</div>
<div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;  <span class="comment">// If Scale is 1, then this is the same as adding ScaleReg to the addressing</span></div>
<div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;  <span class="comment">// mode.  Just process that directly.</span></div>
<div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;  <span class="keywordflow">if</span> (Scale == 1)</div>
<div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;    <span class="keywordflow">return</span> matchAddr(ScaleReg, <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</div>
<div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160; </div>
<div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;  <span class="comment">// If the scale is 0, it takes nothing to add this.</span></div>
<div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;  <span class="keywordflow">if</span> (Scale == 0)</div>
<div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160; </div>
<div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;  <span class="comment">// If we already have a scale of this value, we can add to it, otherwise, we</span></div>
<div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;  <span class="comment">// need an available scale field.</span></div>
<div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale != 0 &amp;&amp; <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.ScaledReg != ScaleReg)</div>
<div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160; </div>
<div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;  <a class="code" href="structllvm_1_1ExtAddrMode.html">ExtAddrMode</a> TestAddrMode = <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>;</div>
<div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160; </div>
<div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;  <span class="comment">// Add scale to turn X*4+X*3 -&gt; X*7.  This could also do things like</span></div>
<div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;  <span class="comment">// [A+B + A*7] -&gt; [B+A*8].</span></div>
<div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;  TestAddrMode.<a class="code" href="structllvm_1_1ExtAddrMode.html#ae20bc007be03337ee451abb60d74260b">Scale</a> += Scale;</div>
<div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;  TestAddrMode.<a class="code" href="structllvm_1_1ExtAddrMode.html#a243a500ecf43f8be3648cd935b943165">ScaledReg</a> = ScaleReg;</div>
<div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160; </div>
<div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;  <span class="comment">// If the new address isn&#39;t legal, bail out.</span></div>
<div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;  <span class="keywordflow">if</span> (!TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#afa3aef362a1dcff57193d4e6a54f7044">isLegalAddressingMode</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, TestAddrMode, AccessTy, AddrSpace))</div>
<div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160; </div>
<div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;  <span class="comment">// It was legal, so commit it.</span></div>
<div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;  <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a> = TestAddrMode;</div>
<div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160; </div>
<div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;  <span class="comment">// Okay, we decided that we can add ScaleReg+Scale to AddrMode.  Check now</span></div>
<div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;  <span class="comment">// to see if ScaleReg is actually X+C.  If so, we can turn this into adding</span></div>
<div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;  <span class="comment">// X*Scale + C*Scale to addr mode. If we found available IV increment, do not</span></div>
<div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;  <span class="comment">// go any further: we can reuse it and cannot eliminate it.</span></div>
<div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CI = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *AddLHS = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;  <span class="keywordflow">if</span> (isa&lt;Instruction&gt;(ScaleReg) &amp;&amp; <span class="comment">// not a constant expr.</span></div>
<div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;      <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ScaleReg, <a class="code" href="namespacellvm_1_1PatternMatch.html#a944c25ac9b73b02a17a20a08a25b9b21">m_Add</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(AddLHS), <a class="code" href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">m_ConstantInt</a>(CI))) &amp;&amp;</div>
<div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;      !<a class="code" href="CodeGenPrepare_8cpp.html#ab0f1e7b38e65d10c01900bd4d458a03b">isIVIncrement</a>(ScaleReg, &amp;LI) &amp;&amp; CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>().<a class="code" href="classllvm_1_1APInt.html#a87d50d10274efe9688166584391ae489">isSignedIntN</a>(64)) {</div>
<div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;    TestAddrMode.InBounds = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;    TestAddrMode.<a class="code" href="structllvm_1_1ExtAddrMode.html#a243a500ecf43f8be3648cd935b943165">ScaledReg</a> = AddLHS;</div>
<div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;    TestAddrMode.BaseOffs += CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#aa8f4be0661aa64f5b1f20b15e93bb403">getSExtValue</a>() * TestAddrMode.<a class="code" href="structllvm_1_1ExtAddrMode.html#ae20bc007be03337ee451abb60d74260b">Scale</a>;</div>
<div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160; </div>
<div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;    <span class="comment">// If this addressing mode is legal, commit it and remember that we folded</span></div>
<div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;    <span class="comment">// this instruction.</span></div>
<div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;    <span class="keywordflow">if</span> (TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#afa3aef362a1dcff57193d4e6a54f7044">isLegalAddressingMode</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, TestAddrMode, AccessTy, AddrSpace)) {</div>
<div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;      AddrModeInsts.push_back(cast&lt;Instruction&gt;(ScaleReg));</div>
<div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;      <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a> = TestAddrMode;</div>
<div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;    }</div>
<div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;    <span class="comment">// Restore status quo.</span></div>
<div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;    TestAddrMode = <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>;</div>
<div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;  }</div>
<div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160; </div>
<div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;  <span class="comment">// If this is an add recurrence with a constant step, return the increment</span></div>
<div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;  <span class="comment">// instruction and the canonicalized step.</span></div>
<div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;  <span class="keyword">auto</span> GetConstantStep =</div>
<div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;      [<span class="keyword">this</span>](<span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *V) -&gt; std::optional&lt;std::pair&lt;Instruction *, APInt&gt;&gt; {</div>
<div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;    <span class="keyword">auto</span> *PN = dyn_cast&lt;PHINode&gt;(V);</div>
<div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;    <span class="keywordflow">if</span> (!PN)</div>
<div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;      <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;    <span class="keyword">auto</span> IVInc = <a class="code" href="CodeGenPrepare_8cpp.html#a1279f0919bc0ef7841275eb05861ccb3">getIVIncrement</a>(PN, &amp;LI);</div>
<div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;    <span class="keywordflow">if</span> (!IVInc)</div>
<div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;      <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;    <span class="comment">// TODO: The result of the intrinsics above is two-complement. However when</span></div>
<div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;    <span class="comment">// IV inc is expressed as add or sub, iv.next is potentially a poison value.</span></div>
<div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;    <span class="comment">// If it has nuw or nsw flags, we need to make sure that these flags are</span></div>
<div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;    <span class="comment">// inferrable at the point of memory instruction. Otherwise we are replacing</span></div>
<div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;    <span class="comment">// well-defined two-complement computation with poison. Currently, to avoid</span></div>
<div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;    <span class="comment">// potentially complex analysis needed to prove this, we reject such cases.</span></div>
<div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *OIVInc = dyn_cast&lt;OverflowingBinaryOperator&gt;(IVInc-&gt;first))</div>
<div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;      <span class="keywordflow">if</span> (OIVInc-&gt;hasNoSignedWrap() || OIVInc-&gt;hasNoUnsignedWrap())</div>
<div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;        <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *ConstantStep = dyn_cast&lt;ConstantInt&gt;(IVInc-&gt;second))</div>
<div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;      <span class="keywordflow">return</span> std::make_pair(IVInc-&gt;first, ConstantStep-&gt;getValue());</div>
<div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;    <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;  };</div>
<div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160; </div>
<div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;  <span class="comment">// Try to account for the following special case:</span></div>
<div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;  <span class="comment">// 1. ScaleReg is an inductive variable;</span></div>
<div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;  <span class="comment">// 2. We use it with non-zero offset;</span></div>
<div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;  <span class="comment">// 3. IV&#39;s increment is available at the point of memory instruction.</span></div>
<div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;  <span class="comment">// In this case, we may reuse the IV increment instead of the IV Phi to</span></div>
<div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;  <span class="comment">// achieve the following advantages:</span></div>
<div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;  <span class="comment">// 1. If IV step matches the offset, we will have no need in the offset;</span></div>
<div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;  <span class="comment">// 2. Even if they don&#39;t match, we will reduce the overlap of living IV</span></div>
<div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;  <span class="comment">//    and IV increment, that will potentially lead to better register</span></div>
<div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;  <span class="comment">//    assignment.</span></div>
<div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseOffs) {</div>
<div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> IVStep = GetConstantStep(ScaleReg)) {</div>
<div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *IVInc = IVStep-&gt;first;</div>
<div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;      <span class="comment">// The following assert is important to ensure a lack of infinite loops.</span></div>
<div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;      <span class="comment">// This transforms is (intentionally) the inverse of the one just above.</span></div>
<div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;      <span class="comment">// If they don&#39;t agree on the definition of an increment, we&#39;d alternate</span></div>
<div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;      <span class="comment">// back and forth indefinitely.</span></div>
<div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="CodeGenPrepare_8cpp.html#ab0f1e7b38e65d10c01900bd4d458a03b">isIVIncrement</a>(IVInc, &amp;LI) &amp;&amp; <span class="stringliteral">&quot;implied by GetConstantStep&quot;</span>);</div>
<div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;      <a class="code" href="classllvm_1_1APInt.html">APInt</a> Step = IVStep-&gt;second;</div>
<div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;      <a class="code" href="classllvm_1_1APInt.html">APInt</a> <a class="code" href="ELFObjHandler_8cpp.html#a250e66aa31a03567cc345ca1bc463b8c">Offset</a> = Step * <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale;</div>
<div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="ELFObjHandler_8cpp.html#a250e66aa31a03567cc345ca1bc463b8c">Offset</a>.isSignedIntN(64)) {</div>
<div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;        TestAddrMode.InBounds = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;        TestAddrMode.<a class="code" href="structllvm_1_1ExtAddrMode.html#a243a500ecf43f8be3648cd935b943165">ScaledReg</a> = IVInc;</div>
<div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;        TestAddrMode.BaseOffs -= <a class="code" href="ELFObjHandler_8cpp.html#a250e66aa31a03567cc345ca1bc463b8c">Offset</a>.getLimitedValue();</div>
<div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;        <span class="comment">// If this addressing mode is legal, commit it..</span></div>
<div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;        <span class="comment">// (Note that we defer the (expensive) domtree base legality check</span></div>
<div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;        <span class="comment">// to the very last possible point.)</span></div>
<div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;        <span class="keywordflow">if</span> (TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#afa3aef362a1dcff57193d4e6a54f7044">isLegalAddressingMode</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, TestAddrMode, AccessTy, AddrSpace) &amp;&amp;</div>
<div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;            getDTFn().<a class="code" href="RegAllocFast_8cpp.html#a0eda39ffaf32662a7ae6f4dbe998711b">dominates</a>(IVInc, MemoryInst)) {</div>
<div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;          AddrModeInsts.push_back(cast&lt;Instruction&gt;(IVInc));</div>
<div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;          <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a> = TestAddrMode;</div>
<div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;        }</div>
<div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;        <span class="comment">// Restore status quo.</span></div>
<div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;        TestAddrMode = <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>;</div>
<div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;      }</div>
<div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;    }</div>
<div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;  }</div>
<div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160; </div>
<div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;  <span class="comment">// Otherwise, just return what we have.</span></div>
<div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;}</div>
<div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;<span class="comment">/// This is a little filter, which returns true if an addressing computation</span></div>
<div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;<span class="comment">/// involving I might be folded into a load/store accessing it.</span></div>
<div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;<span class="comment">/// This doesn&#39;t need to be perfect, but needs to accept at least</span></div>
<div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;<span class="comment">/// the set of instructions that MatchOperationAddr can.</span></div>
<div class="line"><a name="l04089"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#a9d0372d5a469c089a4f2a299dd679558"> 4089</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CodeGenPrepare_8cpp.html#a9d0372d5a469c089a4f2a299dd679558">MightBeFoldableInst</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;  <span class="keywordflow">switch</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) {</div>
<div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;  <span class="keywordflow">case</span> Instruction::BitCast:</div>
<div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;  <span class="keywordflow">case</span> Instruction::AddrSpaceCast:</div>
<div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;    <span class="comment">// Don&#39;t touch identity bitcasts.</span></div>
<div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType() == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0)-&gt;getType())</div>
<div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()-&gt;isIntOrPtrTy();</div>
<div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;  <span class="keywordflow">case</span> Instruction::PtrToInt:</div>
<div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;    <span class="comment">// PtrToInt is always a noop, as we know that the int type is pointer sized.</span></div>
<div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;  <span class="keywordflow">case</span> Instruction::IntToPtr:</div>
<div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;    <span class="comment">// We know the input is intptr_t, so this is foldable.</span></div>
<div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec">Instruction::Add</a>:</div>
<div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="X86PartialReduction_8cpp.html#ae0f503db91504a3f3440ab81260e4134">Instruction::Mul</a>:</div>
<div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;  <span class="keywordflow">case</span> Instruction::Shl:</div>
<div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;    <span class="comment">// Can only handle X*C and X &lt;&lt; C.</span></div>
<div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;    <span class="keywordflow">return</span> isa&lt;ConstantInt&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1));</div>
<div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;  <span class="keywordflow">case</span> Instruction::GetElementPtr:</div>
<div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;  <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;  }</div>
<div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;}</div>
<div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;<span class="comment">/// Check whether or not \p Val is a legal instruction for \p TLI.</span></div>
<div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;<span class="comment">/// \note \p Val is assumed to be the product of some type promotion.</span></div>
<div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;<span class="comment">/// Therefore if \p Val has an undefined state in \p TLI, this is assumed</span></div>
<div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;<span class="comment">/// to be legal, as the non-promoted value would have had the same state.</span></div>
<div class="line"><a name="l04120"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#aca87c42e8556b7f2e73454d63efa87f2"> 4120</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CodeGenPrepare_8cpp.html#aca87c42e8556b7f2e73454d63efa87f2">isPromotedInstructionLegal</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI,</div>
<div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;                                       <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *Val) {</div>
<div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *PromotedInst = dyn_cast&lt;Instruction&gt;(Val);</div>
<div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;  <span class="keywordflow">if</span> (!PromotedInst)</div>
<div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;  <span class="keywordtype">int</span> ISDOpcode = TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#a025e6664b2f55d2c217543c34eb1f64e">InstructionOpcodeToISD</a>(PromotedInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>());</div>
<div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;  <span class="comment">// If the ISDOpcode is undefined, it was undefined before the promotion.</span></div>
<div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;  <span class="keywordflow">if</span> (!ISDOpcode)</div>
<div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;  <span class="comment">// Otherwise, check if the promoted instruction is legal or not.</span></div>
<div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;  <span class="keywordflow">return</span> TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#aa93fbbc66d52a51d178af8ac4398ec05">isOperationLegalOrCustom</a>(</div>
<div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;      ISDOpcode, TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, PromotedInst-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()));</div>
<div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;}</div>
<div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160; </div>
<div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;<span class="comment">/// Hepler class to perform type promotion.</span></div>
<div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;<span class="comment"></span><span class="keyword">class </span>TypePromotionHelper {<span class="comment"></span></div>
<div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;<span class="comment">  /// Utility function to add a promoted instruction \p ExtOpnd to</span></div>
<div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;<span class="comment">  /// \p PromotedInsts and record the type of extension we have seen.</span></div>
<div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> <span class="keywordtype">void</span> addPromotedInst(InstrToOrigTy &amp;PromotedInsts,</div>
<div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;                              <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ExtOpnd, <span class="keywordtype">bool</span> IsSExt) {</div>
<div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;    ExtType ExtTy = IsSExt ? SignExtension : ZeroExtension;</div>
<div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;    InstrToOrigTy::iterator It = PromotedInsts.find(ExtOpnd);</div>
<div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;    <span class="keywordflow">if</span> (It != PromotedInsts.end()) {</div>
<div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;      <span class="comment">// If the new extension is same as original, the information in</span></div>
<div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;      <span class="comment">// PromotedInsts[ExtOpnd] is still correct.</span></div>
<div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;      <span class="keywordflow">if</span> (It-&gt;second.getInt() == ExtTy)</div>
<div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160; </div>
<div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;      <span class="comment">// Now the new extension is different from old extension, we make</span></div>
<div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;      <span class="comment">// the type information invalid by setting extension type to</span></div>
<div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;      <span class="comment">// BothExtension.</span></div>
<div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;      ExtTy = BothExtension;</div>
<div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;    }</div>
<div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;    PromotedInsts[ExtOpnd] = TypeIsSExt(ExtOpnd-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), ExtTy);</div>
<div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;  }</div>
<div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;<span class="comment">  /// Utility function to query the original type of instruction \p Opnd</span></div>
<div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;<span class="comment">  /// with a matched extension type. If the extension doesn&#39;t match, we</span></div>
<div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;<span class="comment">  /// cannot use the information we had on the original type.</span></div>
<div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;<span class="comment">  /// BothExtension doesn&#39;t match any extension type.</span></div>
<div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classllvm_1_1Type.html">Type</a> *getOrigType(<span class="keyword">const</span> InstrToOrigTy &amp;PromotedInsts,</div>
<div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;                                 <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Opnd, <span class="keywordtype">bool</span> IsSExt) {</div>
<div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;    ExtType ExtTy = IsSExt ? SignExtension : ZeroExtension;</div>
<div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;    InstrToOrigTy::const_iterator It = PromotedInsts.find(Opnd);</div>
<div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;    <span class="keywordflow">if</span> (It != PromotedInsts.end() &amp;&amp; It-&gt;second.getInt() == ExtTy)</div>
<div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;      <span class="keywordflow">return</span> It-&gt;second.getPointer();</div>
<div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;  }</div>
<div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;<span class="comment">  /// Utility function to check whether or not a sign or zero extension</span></div>
<div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;<span class="comment">  /// of \p Inst with \p ConsideredExtType can be moved through \p Inst by</span></div>
<div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;<span class="comment">  /// either using the operands of \p Inst or promoting \p Inst.</span></div>
<div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;<span class="comment">  /// The type of the extension is defined by \p IsSExt.</span></div>
<div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;<span class="comment">  /// In other words, check if:</span></div>
<div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;<span class="comment">  /// ext (Ty Inst opnd1 opnd2 ... opndN) to ConsideredExtType.</span></div>
<div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;<span class="comment">  /// #1 Promotion applies:</span></div>
<div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;<span class="comment">  /// ConsideredExtType Inst (ext opnd1 to ConsideredExtType, ...).</span></div>
<div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;<span class="comment">  /// #2 Operand reuses:</span></div>
<div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;<span class="comment">  /// ext opnd1 to ConsideredExtType.</span></div>
<div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;<span class="comment">  /// \p PromotedInsts maps the instructions to their type before promotion.</span></div>
<div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> <span class="keywordtype">bool</span> canGetThrough(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst, <a class="code" href="classllvm_1_1Type.html">Type</a> *ConsideredExtType,</div>
<div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;                            <span class="keyword">const</span> InstrToOrigTy &amp;PromotedInsts, <span class="keywordtype">bool</span> IsSExt);</div>
<div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;<span class="comment">  /// Utility function to determine if \p OpIdx should be promoted when</span></div>
<div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;<span class="comment">  /// promoting \p Inst.</span></div>
<div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> <span class="keywordtype">bool</span> shouldExtOperand(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst, <span class="keywordtype">int</span> OpIdx) {</div>
<div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;    <span class="keywordflow">return</span> !(isa&lt;SelectInst&gt;(Inst) &amp;&amp; OpIdx == 0);</div>
<div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;  }</div>
<div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;<span class="comment">  /// Utility function to promote the operand of \p Ext when this</span></div>
<div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;<span class="comment">  /// operand is a promotable trunc or sext or zext.</span></div>
<div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;<span class="comment">  /// \p PromotedInsts maps the instructions to their type before promotion.</span></div>
<div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;<span class="comment">  /// \p CreatedInstsCost[out] contains the cost of all instructions</span></div>
<div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;<span class="comment">  /// created to promote the operand of Ext.</span></div>
<div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;<span class="comment">  /// Newly added extensions are inserted in \p Exts.</span></div>
<div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;<span class="comment">  /// Newly added truncates are inserted in \p Truncs.</span></div>
<div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;<span class="comment">  /// Should never be called directly.</span></div>
<div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;<span class="comment">  /// \return The promoted value which is used instead of Ext.</span></div>
<div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *promoteOperandForTruncAndAnyExt(</div>
<div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>, TypePromotionTransaction &amp;TPT,</div>
<div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;      InstrToOrigTy &amp;PromotedInsts, <span class="keywordtype">unsigned</span> &amp;CreatedInstsCost,</div>
<div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;      <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> *Exts,</div>
<div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;      <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> *Truncs, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI);</div>
<div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;<span class="comment">  /// Utility function to promote the operand of \p Ext when this</span></div>
<div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;<span class="comment">  /// operand is promotable and is not a supported trunc or sext.</span></div>
<div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;<span class="comment">  /// \p PromotedInsts maps the instructions to their type before promotion.</span></div>
<div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;<span class="comment">  /// \p CreatedInstsCost[out] contains the cost of all the instructions</span></div>
<div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;<span class="comment">  /// created to promote the operand of Ext.</span></div>
<div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;<span class="comment">  /// Newly added extensions are inserted in \p Exts.</span></div>
<div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;<span class="comment">  /// Newly added truncates are inserted in \p Truncs.</span></div>
<div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;<span class="comment">  /// Should never be called directly.</span></div>
<div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;<span class="comment">  /// \return The promoted value which is used instead of Ext.</span></div>
<div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *promoteOperandForOther(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>,</div>
<div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;                                       TypePromotionTransaction &amp;TPT,</div>
<div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;                                       InstrToOrigTy &amp;PromotedInsts,</div>
<div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;                                       <span class="keywordtype">unsigned</span> &amp;CreatedInstsCost,</div>
<div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;                                       <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> *Exts,</div>
<div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;                                       <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> *Truncs,</div>
<div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;                                       <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI, <span class="keywordtype">bool</span> IsSExt);</div>
<div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;<span class="comment">  /// \see promoteOperandForOther.</span></div>
<div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *signExtendOperandForOther(</div>
<div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>, TypePromotionTransaction &amp;TPT,</div>
<div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;      InstrToOrigTy &amp;PromotedInsts, <span class="keywordtype">unsigned</span> &amp;CreatedInstsCost,</div>
<div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;      <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> *Exts,</div>
<div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;      <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> *Truncs, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI) {</div>
<div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;    <span class="keywordflow">return</span> promoteOperandForOther(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>, TPT, PromotedInsts, CreatedInstsCost,</div>
<div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;                                  Exts, Truncs, TLI, <span class="keyword">true</span>);</div>
<div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;  }</div>
<div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;<span class="comment">  /// \see promoteOperandForOther.</span></div>
<div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *zeroExtendOperandForOther(</div>
<div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>, TypePromotionTransaction &amp;TPT,</div>
<div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;      InstrToOrigTy &amp;PromotedInsts, <span class="keywordtype">unsigned</span> &amp;CreatedInstsCost,</div>
<div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;      <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> *Exts,</div>
<div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;      <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> *Truncs, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI) {</div>
<div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;    <span class="keywordflow">return</span> promoteOperandForOther(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>, TPT, PromotedInsts, CreatedInstsCost,</div>
<div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;                                  Exts, Truncs, TLI, <span class="keyword">false</span>);</div>
<div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;  }</div>
<div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160; </div>
<div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;<span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;<span class="comment">  /// Type for the utility function that promotes the operand of Ext.</span></div>
<div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;<span class="comment"></span>  <span class="keyword">using</span> Action = <a class="code" href="classllvm_1_1Value.html">Value</a> *(*)(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>, TypePromotionTransaction &amp;TPT,</div>
<div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;                            InstrToOrigTy &amp;PromotedInsts,</div>
<div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;                            <span class="keywordtype">unsigned</span> &amp;CreatedInstsCost,</div>
<div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;                            <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> *Exts,</div>
<div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;                            <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> *Truncs,</div>
<div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;                            <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI);</div>
<div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;<span class="comment">  /// Given a sign/zero extend instruction \p Ext, return the appropriate</span></div>
<div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;<span class="comment">  /// action to promote the operand of \p Ext instead of using Ext.</span></div>
<div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;<span class="comment">  /// \return NULL if no promotable action is possible with the current</span></div>
<div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;<span class="comment">  /// sign extension.</span></div>
<div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;<span class="comment">  /// \p InsertedInsts keeps track of all the instructions inserted by the</span></div>
<div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;<span class="comment">  /// other CodeGenPrepare optimizations. This information is important</span></div>
<div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;<span class="comment">  /// because we do not want to promote these instructions as CodeGenPrepare</span></div>
<div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;<span class="comment">  /// will reinsert them later. Thus creating an infinite loop: create/remove.</span></div>
<div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;<span class="comment">  /// \p PromotedInsts maps the instructions to their type before promotion.</span></div>
<div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> Action getAction(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>, <span class="keyword">const</span> SetOfInstrs &amp;InsertedInsts,</div>
<div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;                          <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI,</div>
<div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;                          <span class="keyword">const</span> InstrToOrigTy &amp;PromotedInsts);</div>
<div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;};</div>
<div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160; </div>
<div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160; </div>
<div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;<span class="keywordtype">bool</span> TypePromotionHelper::canGetThrough(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst,</div>
<div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;                                        <a class="code" href="classllvm_1_1Type.html">Type</a> *ConsideredExtType,</div>
<div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;                                        <span class="keyword">const</span> InstrToOrigTy &amp;PromotedInsts,</div>
<div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;                                        <span class="keywordtype">bool</span> IsSExt) {</div>
<div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;  <span class="comment">// The promotion helper does not know how to deal with vector types yet.</span></div>
<div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;  <span class="comment">// To be able to fix that, we would need to fix the places where we</span></div>
<div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;  <span class="comment">// statically extend, e.g., constants and such.</span></div>
<div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;  <span class="keywordflow">if</span> (Inst-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>())</div>
<div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160; </div>
<div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;  <span class="comment">// We can always get through zext.</span></div>
<div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;  <span class="keywordflow">if</span> (isa&lt;ZExtInst&gt;(Inst))</div>
<div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160; </div>
<div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;  <span class="comment">// sext(sext) is ok too.</span></div>
<div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;  <span class="keywordflow">if</span> (IsSExt &amp;&amp; isa&lt;SExtInst&gt;(Inst))</div>
<div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160; </div>
<div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;  <span class="comment">// We can get through binary operator, if it is legal. In other words, the</span></div>
<div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;  <span class="comment">// binary operator must have a nuw or nsw flag.</span></div>
<div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> *BinOp = dyn_cast&lt;BinaryOperator&gt;(Inst))</div>
<div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;    <span class="keywordflow">if</span> (isa&lt;OverflowingBinaryOperator&gt;(BinOp) &amp;&amp;</div>
<div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;        ((!IsSExt &amp;&amp; BinOp-&gt;hasNoUnsignedWrap()) ||</div>
<div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;         (IsSExt &amp;&amp; BinOp-&gt;hasNoSignedWrap())))</div>
<div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160; </div>
<div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;  <span class="comment">// ext(and(opnd, cst)) --&gt; and(ext(opnd), ext(cst))</span></div>
<div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;  <span class="keywordflow">if</span> ((Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::And ||</div>
<div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;       Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::Or))</div>
<div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160; </div>
<div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;  <span class="comment">// ext(xor(opnd, cst)) --&gt; xor(ext(opnd), ext(cst))</span></div>
<div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;  <span class="keywordflow">if</span> (Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::Xor) {</div>
<div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;    <span class="comment">// Make sure it is not a NOT.</span></div>
<div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> *Cst = dyn_cast&lt;ConstantInt&gt;(Inst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1)))</div>
<div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;      <span class="keywordflow">if</span> (!Cst-&gt;getValue().isAllOnes())</div>
<div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;  }</div>
<div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160; </div>
<div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;  <span class="comment">// zext(shrl(opnd, cst)) --&gt; shrl(zext(opnd), zext(cst))</span></div>
<div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;  <span class="comment">// It may change a poisoned value into a regular value, like</span></div>
<div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;  <span class="comment">//     zext i32 (shrl i8 %val, 12)  --&gt;  shrl i32 (zext i8 %val), 12</span></div>
<div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;  <span class="comment">//          poisoned value                    regular value</span></div>
<div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;  <span class="comment">// It should be OK since undef covers valid value.</span></div>
<div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;  <span class="keywordflow">if</span> (Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::LShr &amp;&amp; !IsSExt)</div>
<div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160; </div>
<div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;  <span class="comment">// and(ext(shl(opnd, cst)), cst) --&gt; and(shl(ext(opnd), ext(cst)), cst)</span></div>
<div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;  <span class="comment">// It may change a poisoned value into a regular value, like</span></div>
<div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;  <span class="comment">//     zext i32 (shl i8 %val, 12)  --&gt;  shl i32 (zext i8 %val), 12</span></div>
<div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;  <span class="comment">//          poisoned value                    regular value</span></div>
<div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;  <span class="comment">// It should be OK since undef covers valid value.</span></div>
<div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;  <span class="keywordflow">if</span> (Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::Shl &amp;&amp; Inst-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>()) {</div>
<div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> *ExtInst = cast&lt;const Instruction&gt;(*Inst-&gt;<a class="code" href="classllvm_1_1Value.html#a158da2b6d3d938aaa15b6acd00150e2c">user_begin</a>());</div>
<div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;    <span class="keywordflow">if</span> (ExtInst-&gt;hasOneUse()) {</div>
<div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> *AndInst = dyn_cast&lt;const Instruction&gt;(*ExtInst-&gt;user_begin());</div>
<div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;      <span class="keywordflow">if</span> (AndInst &amp;&amp; AndInst-&gt;getOpcode() == Instruction::And) {</div>
<div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> *Cst = dyn_cast&lt;ConstantInt&gt;(AndInst-&gt;getOperand(1));</div>
<div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;        <span class="keywordflow">if</span> (Cst &amp;&amp;</div>
<div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;            Cst-&gt;getValue().isIntN(Inst-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>()))</div>
<div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;      }</div>
<div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;    }</div>
<div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;  }</div>
<div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160; </div>
<div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;  <span class="comment">// Check if we can do the following simplification.</span></div>
<div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;  <span class="comment">// ext(trunc(opnd)) --&gt; ext(opnd)</span></div>
<div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;  <span class="keywordflow">if</span> (!isa&lt;TruncInst&gt;(Inst))</div>
<div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160; </div>
<div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *OpndVal = Inst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;  <span class="comment">// Check if we can use this operand in the extension.</span></div>
<div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;  <span class="comment">// If the type is larger than the result type of the extension, we cannot.</span></div>
<div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;  <span class="keywordflow">if</span> (!OpndVal-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() ||</div>
<div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;      OpndVal-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>() &gt;</div>
<div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;          ConsideredExtType-&gt;<a class="code" href="classllvm_1_1Type.html#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>())</div>
<div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160; </div>
<div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;  <span class="comment">// If the operand of the truncate is not an instruction, we will not have</span></div>
<div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;  <span class="comment">// any information on the dropped bits.</span></div>
<div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;  <span class="comment">// (Actually we could for constant but it is not worth the extra logic).</span></div>
<div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Opnd = dyn_cast&lt;Instruction&gt;(OpndVal);</div>
<div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;  <span class="keywordflow">if</span> (!Opnd)</div>
<div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160; </div>
<div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;  <span class="comment">// Check if the source of the type is narrow enough.</span></div>
<div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;  <span class="comment">// I.e., check that trunc just drops extended bits of the same kind of</span></div>
<div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;  <span class="comment">// the extension.</span></div>
<div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;  <span class="comment">// #1 get the type of the operand and check the kind of the extended bits.</span></div>
<div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1Type.html">Type</a> *OpndType = getOrigType(PromotedInsts, Opnd, IsSExt);</div>
<div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;  <span class="keywordflow">if</span> (OpndType)</div>
<div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;    ;</div>
<div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((IsSExt &amp;&amp; isa&lt;SExtInst&gt;(Opnd)) || (!IsSExt &amp;&amp; isa&lt;ZExtInst&gt;(Opnd)))</div>
<div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;    OpndType = Opnd-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160; </div>
<div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;  <span class="comment">// #2 check that the truncate just drops extended bits.</span></div>
<div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;  <span class="keywordflow">return</span> Inst-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>() &gt;=</div>
<div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;         OpndType-&gt;<a class="code" href="classllvm_1_1Type.html#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>();</div>
<div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;}</div>
<div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160; </div>
<div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;TypePromotionHelper::Action TypePromotionHelper::getAction(</div>
<div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>, <span class="keyword">const</span> SetOfInstrs &amp;InsertedInsts,</div>
<div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI, <span class="keyword">const</span> InstrToOrigTy &amp;PromotedInsts) {</div>
<div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((isa&lt;SExtInst&gt;(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>) || isa&lt;ZExtInst&gt;(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>)) &amp;&amp;</div>
<div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;         <span class="stringliteral">&quot;Unexpected instruction type&quot;</span>);</div>
<div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ExtOpnd = dyn_cast&lt;Instruction&gt;(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getOperand(0));</div>
<div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *ExtTy = <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType();</div>
<div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;  <span class="keywordtype">bool</span> IsSExt = isa&lt;SExtInst&gt;(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>);</div>
<div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;  <span class="comment">// If the operand of the extension is not an instruction, we cannot</span></div>
<div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;  <span class="comment">// get through.</span></div>
<div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;  <span class="comment">// If it, check we can get through.</span></div>
<div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;  <span class="keywordflow">if</span> (!ExtOpnd || !canGetThrough(ExtOpnd, ExtTy, PromotedInsts, IsSExt))</div>
<div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160; </div>
<div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;  <span class="comment">// Do not promote if the operand has been added by codegenprepare.</span></div>
<div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;  <span class="comment">// Otherwise, it means we are undoing an optimization that is likely to be</span></div>
<div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;  <span class="comment">// redone, thus causing potential infinite loop.</span></div>
<div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;  <span class="keywordflow">if</span> (isa&lt;TruncInst&gt;(ExtOpnd) &amp;&amp; InsertedInsts.count(ExtOpnd))</div>
<div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160; </div>
<div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;  <span class="comment">// SExt or Trunc instructions.</span></div>
<div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;  <span class="comment">// Return the related handler.</span></div>
<div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;  <span class="keywordflow">if</span> (isa&lt;SExtInst&gt;(ExtOpnd) || isa&lt;TruncInst&gt;(ExtOpnd) ||</div>
<div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;      isa&lt;ZExtInst&gt;(ExtOpnd))</div>
<div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;    <span class="keywordflow">return</span> promoteOperandForTruncAndAnyExt;</div>
<div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160; </div>
<div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;  <span class="comment">// Regular instruction.</span></div>
<div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;  <span class="comment">// Abort early if we will have to insert non-free instructions.</span></div>
<div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;  <span class="keywordflow">if</span> (!ExtOpnd-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; !TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#a6f992bc4ca89f1b5f0b34f5b29978c31">isTruncateFree</a>(ExtTy, ExtOpnd-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()))</div>
<div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;  <span class="keywordflow">return</span> IsSExt ? signExtendOperandForOther : zeroExtendOperandForOther;</div>
<div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;}</div>
<div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160; </div>
<div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;<a class="code" href="classllvm_1_1Value.html">Value</a> *TypePromotionHelper::promoteOperandForTruncAndAnyExt(</div>
<div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *SExt, TypePromotionTransaction &amp;TPT,</div>
<div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;    InstrToOrigTy &amp;PromotedInsts, <span class="keywordtype">unsigned</span> &amp;CreatedInstsCost,</div>
<div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;    <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> *Exts,</div>
<div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;    <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> *Truncs, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI) {</div>
<div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;  <span class="comment">// By construction, the operand of SExt is an instruction. Otherwise we cannot</span></div>
<div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;  <span class="comment">// get through it and this method should not be called.</span></div>
<div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *SExtOpnd = cast&lt;Instruction&gt;(SExt-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0));</div>
<div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ExtVal = SExt;</div>
<div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;  <span class="keywordtype">bool</span> HasMergedNonFreeExt = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;  <span class="keywordflow">if</span> (isa&lt;ZExtInst&gt;(SExtOpnd)) {</div>
<div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;    <span class="comment">// Replace s|zext(zext(opnd))</span></div>
<div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;    <span class="comment">// =&gt; zext(opnd).</span></div>
<div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;    HasMergedNonFreeExt = !TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#aa262bd68fe6b244861c0a5d249d68c30">isExtFree</a>(SExtOpnd);</div>
<div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *ZExt =</div>
<div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;        TPT.createZExt(SExt, SExtOpnd-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), SExt-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;    TPT.replaceAllUsesWith(SExt, ZExt);</div>
<div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;    TPT.eraseInstruction(SExt);</div>
<div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160;    ExtVal = ZExt;</div>
<div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;    <span class="comment">// Replace z|sext(trunc(opnd)) or sext(sext(opnd))</span></div>
<div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;    <span class="comment">// =&gt; z|sext(opnd).</span></div>
<div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;    TPT.setOperand(SExt, 0, SExtOpnd-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0));</div>
<div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;  }</div>
<div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;  CreatedInstsCost = 0;</div>
<div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160; </div>
<div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;  <span class="comment">// Remove dead code.</span></div>
<div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;  <span class="keywordflow">if</span> (SExtOpnd-&gt;<a class="code" href="classllvm_1_1Value.html#a9d7de807ebdfe1819df3ff6cb0f16158">use_empty</a>())</div>
<div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;    TPT.eraseInstruction(SExtOpnd);</div>
<div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160; </div>
<div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;  <span class="comment">// Check if the extension is still needed.</span></div>
<div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ExtInst = dyn_cast&lt;Instruction&gt;(ExtVal);</div>
<div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;  <span class="keywordflow">if</span> (!ExtInst || ExtInst-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() != ExtInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()) {</div>
<div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;    <span class="keywordflow">if</span> (ExtInst) {</div>
<div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;      <span class="keywordflow">if</span> (Exts)</div>
<div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;        Exts-&gt;push_back(ExtInst);</div>
<div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;      CreatedInstsCost = !TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#aa262bd68fe6b244861c0a5d249d68c30">isExtFree</a>(ExtInst) &amp;&amp; !HasMergedNonFreeExt;</div>
<div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;    }</div>
<div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;    <span class="keywordflow">return</span> ExtVal;</div>
<div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;  }</div>
<div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160; </div>
<div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;  <span class="comment">// At this point we have: ext ty opnd to ty.</span></div>
<div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;  <span class="comment">// Reassign the uses of ExtInst to the opnd and remove ExtInst.</span></div>
<div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NextVal = ExtInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;  TPT.eraseInstruction(ExtInst, NextVal);</div>
<div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;  <span class="keywordflow">return</span> NextVal;</div>
<div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;}</div>
<div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160; </div>
<div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;<a class="code" href="classllvm_1_1Value.html">Value</a> *TypePromotionHelper::promoteOperandForOther(</div>
<div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>, TypePromotionTransaction &amp;TPT,</div>
<div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;    InstrToOrigTy &amp;PromotedInsts, <span class="keywordtype">unsigned</span> &amp;CreatedInstsCost,</div>
<div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;    <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> *Exts,</div>
<div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;    <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> *Truncs, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI,</div>
<div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;    <span class="keywordtype">bool</span> IsSExt) {</div>
<div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;  <span class="comment">// By construction, the operand of Ext is an instruction. Otherwise we cannot</span></div>
<div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;  <span class="comment">// get through it and this method should not be called.</span></div>
<div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ExtOpnd = cast&lt;Instruction&gt;(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getOperand(0));</div>
<div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;  CreatedInstsCost = 0;</div>
<div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;  <span class="keywordflow">if</span> (!ExtOpnd-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>()) {</div>
<div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;    <span class="comment">// ExtOpnd will be promoted.</span></div>
<div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;    <span class="comment">// All its uses, but Ext, will need to use a truncated value of the</span></div>
<div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;    <span class="comment">// promoted version.</span></div>
<div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;    <span class="comment">// Create the truncate now.</span></div>
<div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Trunc = TPT.createTrunc(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>, ExtOpnd-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ITrunc = dyn_cast&lt;Instruction&gt;(Trunc)) {</div>
<div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;      <span class="comment">// Insert it just after the definition.</span></div>
<div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;      ITrunc-&gt;moveAfter(ExtOpnd);</div>
<div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;      <span class="keywordflow">if</span> (Truncs)</div>
<div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;        Truncs-&gt;push_back(ITrunc);</div>
<div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;    }</div>
<div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160; </div>
<div class="line"><a name="l04474"></a><span class="lineno"> 4474</span>&#160;    TPT.replaceAllUsesWith(ExtOpnd, Trunc);</div>
<div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;    <span class="comment">// Restore the operand of Ext (which has been replaced by the previous call</span></div>
<div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;    <span class="comment">// to replaceAllUsesWith) to avoid creating a cycle trunc &lt;-&gt; sext.</span></div>
<div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;    TPT.setOperand(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>, 0, ExtOpnd);</div>
<div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;  }</div>
<div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160; </div>
<div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;  <span class="comment">// Get through the Instruction:</span></div>
<div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;  <span class="comment">// 1. Update its type.</span></div>
<div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;  <span class="comment">// 2. Replace the uses of Ext by Inst.</span></div>
<div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;  <span class="comment">// 3. Extend each operand that needs to be extended.</span></div>
<div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160; </div>
<div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;  <span class="comment">// Remember the original type of the instruction before promotion.</span></div>
<div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;  <span class="comment">// This is useful to know that the high bits are sign extended bits.</span></div>
<div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;  addPromotedInst(PromotedInsts, ExtOpnd, IsSExt);</div>
<div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;  <span class="comment">// Step #1.</span></div>
<div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;  TPT.mutateType(ExtOpnd, <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType());</div>
<div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;  <span class="comment">// Step #2.</span></div>
<div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;  TPT.replaceAllUsesWith(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>, ExtOpnd);</div>
<div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;  <span class="comment">// Step #3.</span></div>
<div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ExtForOpnd = <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>;</div>
<div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160; </div>
<div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Propagate Ext to operands\n&quot;</span>);</div>
<div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> OpIdx = 0, EndOpIdx = ExtOpnd-&gt;<a class="code" href="classllvm_1_1User.html#addec638786f763d967811b45cb662f1f">getNumOperands</a>(); OpIdx != EndOpIdx;</div>
<div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;       ++OpIdx) {</div>
<div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Operand:\n&quot;</span> &lt;&lt; *(ExtOpnd-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(OpIdx)) &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;    <span class="keywordflow">if</span> (ExtOpnd-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(OpIdx)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() == <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType() ||</div>
<div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;        !shouldExtOperand(ExtOpnd, OpIdx)) {</div>
<div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;No need to propagate\n&quot;</span>);</div>
<div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;    }</div>
<div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;    <span class="comment">// Check if we can statically extend the operand.</span></div>
<div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Opnd = ExtOpnd-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(OpIdx);</div>
<div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *Cst = dyn_cast&lt;ConstantInt&gt;(Opnd)) {</div>
<div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Statically extend\n&quot;</span>);</div>
<div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType()-&gt;getIntegerBitWidth();</div>
<div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;      <a class="code" href="classllvm_1_1APInt.html">APInt</a> CstVal = IsSExt ? Cst-&gt;getValue().<a class="code" href="classllvm_1_1APInt.html#aca8fce65eb69a82aa10a635e2e79877a">sext</a>(<a class="code" href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>)</div>
<div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;                            : Cst-&gt;getValue().<a class="code" href="classllvm_1_1APInt.html#a1dc76cc8bf703e6ada68bededcbb9573">zext</a>(<a class="code" href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>);</div>
<div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;      TPT.setOperand(ExtOpnd, OpIdx, <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantInt::get</a>(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType(), CstVal));</div>
<div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;    }</div>
<div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;    <span class="comment">// UndefValue are typed, so we have to statically sign extend them.</span></div>
<div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;    <span class="keywordflow">if</span> (isa&lt;UndefValue&gt;(Opnd)) {</div>
<div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Statically extend\n&quot;</span>);</div>
<div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;      TPT.setOperand(ExtOpnd, OpIdx, <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">UndefValue::get</a>(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType()));</div>
<div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;    }</div>
<div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160; </div>
<div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;    <span class="comment">// Otherwise we have to explicitly sign extend the operand.</span></div>
<div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;    <span class="comment">// Check if Ext was reused to extend an operand.</span></div>
<div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;    <span class="keywordflow">if</span> (!ExtForOpnd) {</div>
<div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;      <span class="comment">// If yes, create a new one.</span></div>
<div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;More operands to ext\n&quot;</span>);</div>
<div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *ValForExtOpnd = IsSExt ? TPT.createSExt(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>, Opnd, <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType())</div>
<div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;                                    : TPT.createZExt(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>, Opnd, <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType());</div>
<div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;      <span class="keywordflow">if</span> (!isa&lt;Instruction&gt;(ValForExtOpnd)) {</div>
<div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;        TPT.setOperand(ExtOpnd, OpIdx, ValForExtOpnd);</div>
<div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;      }</div>
<div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;      ExtForOpnd = cast&lt;Instruction&gt;(ValForExtOpnd);</div>
<div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;    }</div>
<div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;    <span class="keywordflow">if</span> (Exts)</div>
<div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;      Exts-&gt;push_back(ExtForOpnd);</div>
<div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;    TPT.setOperand(ExtForOpnd, 0, Opnd);</div>
<div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160; </div>
<div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;    <span class="comment">// Move the sign extension before the insertion point.</span></div>
<div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;    TPT.moveBefore(ExtForOpnd, ExtOpnd);</div>
<div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;    TPT.setOperand(ExtOpnd, OpIdx, ExtForOpnd);</div>
<div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;    CreatedInstsCost += !TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#aa262bd68fe6b244861c0a5d249d68c30">isExtFree</a>(ExtForOpnd);</div>
<div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;    <span class="comment">// If more sext are required, new instructions will have to be created.</span></div>
<div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;    ExtForOpnd = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;  }</div>
<div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;  <span class="keywordflow">if</span> (ExtForOpnd == <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>) {</div>
<div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Extension is useless now\n&quot;</span>);</div>
<div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;    TPT.eraseInstruction(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>);</div>
<div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;  }</div>
<div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;  <span class="keywordflow">return</span> ExtOpnd;</div>
<div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;}</div>
<div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;<span class="comment">/// Check whether or not promoting an instruction to a wider type is profitable.</span></div>
<div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;<span class="comment">/// \p NewCost gives the cost of extension instructions created by the</span></div>
<div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;<span class="comment">/// promotion.</span></div>
<div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;<span class="comment">/// \p OldCost gives the cost of extension instructions before the promotion</span></div>
<div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;<span class="comment">/// plus the number of instructions that have been</span></div>
<div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;<span class="comment">/// matched in the addressing mode the promotion.</span></div>
<div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;<span class="comment">/// \p PromotedOperand is the value that has been promoted.</span></div>
<div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;<span class="comment">/// \return True if the promotion is profitable, false otherwise.</span></div>
<div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> AddressingModeMatcher::isPromotionProfitable(</div>
<div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;    <span class="keywordtype">unsigned</span> NewCost, <span class="keywordtype">unsigned</span> OldCost, <a class="code" href="classllvm_1_1Value.html">Value</a> *PromotedOperand)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;OldCost: &quot;</span> &lt;&lt; OldCost &lt;&lt; <span class="stringliteral">&quot;\tNewCost: &quot;</span> &lt;&lt; NewCost</div>
<div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;                    &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;  <span class="comment">// The cost of the new extensions is greater than the cost of the</span></div>
<div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;  <span class="comment">// old extension plus what we folded.</span></div>
<div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;  <span class="comment">// This is not profitable.</span></div>
<div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;  <span class="keywordflow">if</span> (NewCost &gt; OldCost)</div>
<div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;  <span class="keywordflow">if</span> (NewCost &lt; OldCost)</div>
<div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;  <span class="comment">// The promotion is neutral but it may help folding the sign extension in</span></div>
<div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;  <span class="comment">// loads for instance.</span></div>
<div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;  <span class="comment">// Check that we did not create an illegal instruction.</span></div>
<div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="CodeGenPrepare_8cpp.html#aca87c42e8556b7f2e73454d63efa87f2">isPromotedInstructionLegal</a>(TLI, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, PromotedOperand);</div>
<div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;}</div>
<div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;<span class="comment">/// Given an instruction or constant expr, see if we can fold the operation</span></div>
<div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;<span class="comment">/// into the addressing mode. If so, update the addressing mode and return</span></div>
<div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;<span class="comment">/// true, otherwise return false without modifying AddrMode.</span></div>
<div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;<span class="comment">/// If \p MovedAway is not NULL, it contains the information of whether or</span></div>
<div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160;<span class="comment">/// not AddrInst has to be folded into the addressing mode on success.</span></div>
<div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;<span class="comment">/// If \p MovedAway == true, \p AddrInst will not be part of the addressing</span></div>
<div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;<span class="comment">/// because it has been moved away.</span></div>
<div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;<span class="comment">/// Thus AddrInst must not be added in the matched instructions.</span></div>
<div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;<span class="comment">/// This state can happen when AddrInst is a sext, since it may be moved away.</span></div>
<div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;<span class="comment">/// Therefore, AddrInst may not be valid when MovedAway is true and it must</span></div>
<div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;<span class="comment">/// not be referenced anymore.</span></div>
<div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> AddressingModeMatcher::matchOperationAddr(<a class="code" href="classllvm_1_1User.html">User</a> *AddrInst, <span class="keywordtype">unsigned</span> Opcode,</div>
<div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;                                               <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>,</div>
<div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;                                               <span class="keywordtype">bool</span> *MovedAway) {</div>
<div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;  <span class="comment">// Avoid exponential behavior on extremely deep expression trees.</span></div>
<div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> &gt;= 5)</div>
<div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160; </div>
<div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;  <span class="comment">// By default, all matched instructions stay in place.</span></div>
<div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;  <span class="keywordflow">if</span> (MovedAway)</div>
<div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;    *MovedAway = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160; </div>
<div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;  <span class="keywordflow">switch</span> (Opcode) {</div>
<div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;  <span class="keywordflow">case</span> Instruction::PtrToInt:</div>
<div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;    <span class="comment">// PtrToInt is always a noop, as we know that the int type is pointer sized.</span></div>
<div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;    <span class="keywordflow">return</span> matchAddr(AddrInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</div>
<div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;  <span class="keywordflow">case</span> Instruction::IntToPtr: {</div>
<div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;    <span class="keyword">auto</span> AS = AddrInst-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>();</div>
<div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;    <span class="keyword">auto</span> PtrTy = MVT::getIntegerVT(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getPointerSizeInBits(AS));</div>
<div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;    <span class="comment">// This inttoptr is a no-op if the integer type is pointer sized.</span></div>
<div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;    <span class="keywordflow">if</span> (TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, AddrInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()) == PtrTy)</div>
<div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;      <span class="keywordflow">return</span> matchAddr(AddrInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</div>
<div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;  }</div>
<div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;  <span class="keywordflow">case</span> Instruction::BitCast:</div>
<div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;    <span class="comment">// BitCast is always a noop, and we can handle it as long as it is</span></div>
<div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;    <span class="comment">// int-&gt;int or pointer-&gt;pointer (we don&#39;t want int&lt;-&gt;fp or something).</span></div>
<div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;    <span class="keywordflow">if</span> (AddrInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#abf313eff420b7c6c8e322a2e9c53cd90">isIntOrPtrTy</a>() &amp;&amp;</div>
<div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;        <span class="comment">// Don&#39;t touch identity bitcasts.  These were probably put here by LSR,</span></div>
<div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;        <span class="comment">// and we don&#39;t want to mess around with them.  Assume it knows what it</span></div>
<div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;        <span class="comment">// is doing.</span></div>
<div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;        AddrInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() != AddrInst-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())</div>
<div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;      <span class="keywordflow">return</span> matchAddr(AddrInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</div>
<div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;  <span class="keywordflow">case</span> Instruction::AddrSpaceCast: {</div>
<div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;    <span class="keywordtype">unsigned</span> SrcAS =</div>
<div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;        AddrInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>();</div>
<div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;    <span class="keywordtype">unsigned</span> DestAS = AddrInst-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>();</div>
<div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;    <span class="keywordflow">if</span> (TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#a1ae2ee148379ed3d041b4bce586f7f99">getTargetMachine</a>().<a class="code" href="classllvm_1_1TargetMachine.html#a321fbc5faf6c190cd1f90c19c3101cb4">isNoopAddrSpaceCast</a>(SrcAS, DestAS))</div>
<div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;      <span class="keywordflow">return</span> matchAddr(AddrInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</div>
<div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;  }</div>
<div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec">Instruction::Add</a>: {</div>
<div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;    <span class="comment">// Check to see if we can merge in the RHS then the LHS.  If so, we win.</span></div>
<div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;    <a class="code" href="structllvm_1_1ExtAddrMode.html">ExtAddrMode</a> BackupAddrMode = <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>;</div>
<div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;    <span class="keywordtype">unsigned</span> OldSize = AddrModeInsts.size();</div>
<div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;    <span class="comment">// Start a transaction at this point.</span></div>
<div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;    <span class="comment">// The LHS may match but not the RHS.</span></div>
<div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;    <span class="comment">// Therefore, we need a higher level restoration point to undo partially</span></div>
<div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;    <span class="comment">// matched operation.</span></div>
<div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;    TypePromotionTransaction::ConstRestorationPt LastKnownGood =</div>
<div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;        TPT.getRestorationPoint();</div>
<div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160; </div>
<div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;    <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.InBounds = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;    <span class="keywordflow">if</span> (matchAddr(AddrInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1), <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1) &amp;&amp;</div>
<div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;        matchAddr(AddrInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1))</div>
<div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160; </div>
<div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;    <span class="comment">// Restore the old addr mode info.</span></div>
<div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;    <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a> = BackupAddrMode;</div>
<div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;    AddrModeInsts.<a class="code" href="classllvm_1_1SmallVectorImpl.html#ad0b3d8447f88377b62d9c019f3c4e118">resize</a>(OldSize);</div>
<div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;    TPT.rollback(LastKnownGood);</div>
<div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160; </div>
<div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;    <span class="comment">// Otherwise this was over-aggressive.  Try merging in the LHS then the RHS.</span></div>
<div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;    <span class="keywordflow">if</span> (matchAddr(AddrInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1) &amp;&amp;</div>
<div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;        matchAddr(AddrInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1), <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1))</div>
<div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160; </div>
<div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;    <span class="comment">// Otherwise we definitely can&#39;t merge the ADD in.</span></div>
<div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;    <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a> = BackupAddrMode;</div>
<div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;    AddrModeInsts.<a class="code" href="classllvm_1_1SmallVectorImpl.html#ad0b3d8447f88377b62d9c019f3c4e118">resize</a>(OldSize);</div>
<div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;    TPT.rollback(LastKnownGood);</div>
<div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;  }</div>
<div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;  <span class="comment">// case Instruction::Or:</span></div>
<div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;  <span class="comment">//  TODO: We can handle &quot;Or Val, Imm&quot; iff this OR is equivalent to an ADD.</span></div>
<div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;  <span class="comment">// break;</span></div>
<div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="X86PartialReduction_8cpp.html#ae0f503db91504a3f3440ab81260e4134">Instruction::Mul</a>:</div>
<div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;  <span class="keywordflow">case</span> Instruction::Shl: {</div>
<div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;    <span class="comment">// Can only handle X*C and X &lt;&lt; C.</span></div>
<div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;    <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.InBounds = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = dyn_cast&lt;ConstantInt&gt;(AddrInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1));</div>
<div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> || <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getBitWidth() &gt; 64)</div>
<div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;    int64_t Scale = Opcode == Instruction::Shl</div>
<div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;                        ? 1LL &lt;&lt; <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getLimitedValue(<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getBitWidth() - 1)</div>
<div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;                        : <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getSExtValue();</div>
<div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160; </div>
<div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;    <span class="keywordflow">return</span> matchScaledValue(AddrInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), Scale, <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</div>
<div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;  }</div>
<div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;  <span class="keywordflow">case</span> Instruction::GetElementPtr: {</div>
<div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;    <span class="comment">// Scan the GEP.  We check it if it contains constant offsets and at most</span></div>
<div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;    <span class="comment">// one variable offset.</span></div>
<div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;    <span class="keywordtype">int</span> VariableOperand = -1;</div>
<div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;    <span class="keywordtype">unsigned</span> VariableScale = 0;</div>
<div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160; </div>
<div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;    int64_t ConstantOffset = 0;</div>
<div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;    <a class="code" href="classllvm_1_1generic__gep__type__iterator.html">gep_type_iterator</a> GTI = <a class="code" href="namespacellvm.html#ac828b9b52935f87659a4adf237f820a3">gep_type_begin</a>(AddrInst);</div>
<div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = AddrInst-&gt;<a class="code" href="classllvm_1_1User.html#addec638786f763d967811b45cb662f1f">getNumOperands</a>(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>, ++GTI) {</div>
<div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StructType.html">StructType</a> *STy = GTI.<a class="code" href="classllvm_1_1generic__gep__type__iterator.html#a85d7503cec5ee995092c137a7c0516a8">getStructTypeOrNull</a>()) {</div>
<div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;        <span class="keyword">const</span> <a class="code" href="classllvm_1_1StructLayout.html">StructLayout</a> *SL = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getStructLayout(STy);</div>
<div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160;        <span class="keywordtype">unsigned</span> Idx =</div>
<div class="line"><a name="l04689"></a><span class="lineno"> 4689</span>&#160;            cast&lt;ConstantInt&gt;(AddrInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>))-&gt;getZExtValue();</div>
<div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160;        ConstantOffset += SL-&gt;<a class="code" href="classllvm_1_1StructLayout.html#a9b53bc4ade993c638837c1344465c1f8">getElementOffset</a>(Idx);</div>
<div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;        <a class="code" href="classllvm_1_1TypeSize.html">TypeSize</a> TS = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(GTI.<a class="code" href="classllvm_1_1generic__gep__type__iterator.html#aeb7ef34c0b96c3130c0029e648e2bd08">getIndexedType</a>());</div>
<div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;        <span class="keywordflow">if</span> (TS.<a class="code" href="classllvm_1_1details_1_1FixedOrScalableQuantity.html#a5cafb166cf7c4937f5647a084c4eaee2">isNonZero</a>()) {</div>
<div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;          <span class="comment">// The optimisations below currently only work for fixed offsets.</span></div>
<div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;          <span class="keywordflow">if</span> (TS.<a class="code" href="classllvm_1_1details_1_1FixedOrScalableQuantity.html#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>())</div>
<div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;          int64_t <a class="code" href="classllvm_1_1TypeSize.html">TypeSize</a> = TS.<a class="code" href="classllvm_1_1details_1_1FixedOrScalableQuantity.html#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>();</div>
<div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CI =</div>
<div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;                  dyn_cast&lt;ConstantInt&gt;(AddrInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>))) {</div>
<div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;            <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;CVal = CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>();</div>
<div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;            <span class="keywordflow">if</span> (CVal.<a class="code" href="classllvm_1_1APInt.html#a1c9300bfa022ac28948bd4336376e3c1">getMinSignedBits</a>() &lt;= 64) {</div>
<div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;              ConstantOffset += CVal.<a class="code" href="classllvm_1_1APInt.html#af2daa0ee117afefed4c82eee55bf97b7">getSExtValue</a>() * <a class="code" href="classllvm_1_1TypeSize.html">TypeSize</a>;</div>
<div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;              <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;            }</div>
<div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;          }</div>
<div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;          <span class="comment">// We only allow one variable index at the moment.</span></div>
<div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;          <span class="keywordflow">if</span> (VariableOperand != -1)</div>
<div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160; </div>
<div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;          <span class="comment">// Remember the variable index.</span></div>
<div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;          VariableOperand = <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l04712"></a><span class="lineno"> 4712</span>&#160;          VariableScale = <a class="code" href="classllvm_1_1TypeSize.html">TypeSize</a>;</div>
<div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160;        }</div>
<div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;      }</div>
<div class="line"><a name="l04715"></a><span class="lineno"> 4715</span>&#160;    }</div>
<div class="line"><a name="l04716"></a><span class="lineno"> 4716</span>&#160; </div>
<div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160;    <span class="comment">// A common case is for the GEP to only do a constant offset.  In this case,</span></div>
<div class="line"><a name="l04718"></a><span class="lineno"> 4718</span>&#160;    <span class="comment">// just add it to the disp field and check validity.</span></div>
<div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;    <span class="keywordflow">if</span> (VariableOperand == -1) {</div>
<div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;      <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseOffs += ConstantOffset;</div>
<div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;      <span class="keywordflow">if</span> (ConstantOffset == 0 ||</div>
<div class="line"><a name="l04722"></a><span class="lineno"> 4722</span>&#160;          TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#afa3aef362a1dcff57193d4e6a54f7044">isLegalAddressingMode</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>, AccessTy, AddrSpace)) {</div>
<div class="line"><a name="l04723"></a><span class="lineno"> 4723</span>&#160;        <span class="comment">// Check to see if we can fold the base pointer in too.</span></div>
<div class="line"><a name="l04724"></a><span class="lineno"> 4724</span>&#160;        <span class="keywordflow">if</span> (matchAddr(AddrInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1)) {</div>
<div class="line"><a name="l04725"></a><span class="lineno"> 4725</span>&#160;          <span class="keywordflow">if</span> (!cast&lt;GEPOperator&gt;(AddrInst)-&gt;isInBounds())</div>
<div class="line"><a name="l04726"></a><span class="lineno"> 4726</span>&#160;            <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.InBounds = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04728"></a><span class="lineno"> 4728</span>&#160;        }</div>
<div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="CodeGenPrepare_8cpp.html#a1eeb4e7d9888038d9deef80f7d773ab7">EnableGEPOffsetSplit</a> &amp;&amp; isa&lt;GetElementPtrInst&gt;(AddrInst) &amp;&amp;</div>
<div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160;                 TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#a9506719826e5449066b6a74d2d21d012">shouldConsiderGEPOffsetSplit</a>() &amp;&amp; <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> == 0 &amp;&amp;</div>
<div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;                 ConstantOffset &gt; 0) {</div>
<div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;        <span class="comment">// Record GEPs with non-zero offsets as candidates for splitting in the</span></div>
<div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;        <span class="comment">// event that the offset cannot fit into the r+i addressing mode.</span></div>
<div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;        <span class="comment">// Simple and common case that only one GEP is used in calculating the</span></div>
<div class="line"><a name="l04735"></a><span class="lineno"> 4735</span>&#160;        <span class="comment">// address for the memory access.</span></div>
<div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = AddrInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;        <span class="keyword">auto</span> *BaseI = dyn_cast&lt;Instruction&gt;(<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>);</div>
<div class="line"><a name="l04738"></a><span class="lineno"> 4738</span>&#160;        <span class="keyword">auto</span> *<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = cast&lt;GetElementPtrInst&gt;(AddrInst);</div>
<div class="line"><a name="l04739"></a><span class="lineno"> 4739</span>&#160;        <span class="keywordflow">if</span> (isa&lt;Argument&gt;(<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>) || isa&lt;GlobalValue&gt;(<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>) ||</div>
<div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160;            (BaseI &amp;&amp; !isa&lt;CastInst&gt;(BaseI) &amp;&amp;</div>
<div class="line"><a name="l04741"></a><span class="lineno"> 4741</span>&#160;             !isa&lt;GetElementPtrInst&gt;(BaseI))) {</div>
<div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160;          <span class="comment">// Make sure the parent block allows inserting non-PHI instructions</span></div>
<div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;          <span class="comment">// before the terminator.</span></div>
<div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160;          <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Parent =</div>
<div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160;              BaseI ? BaseI-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a38bee869ad41aebfef3de2641b12004c">getParent</a>() : &amp;<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getFunction()-&gt;getEntryBlock();</div>
<div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160;          <span class="keywordflow">if</span> (!Parent-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>()-&gt;<a class="code" href="classllvm_1_1Instruction.html#a5d3d315f678bc76e43b27d18e5d72829">isEHPad</a>())</div>
<div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;            LargeOffsetGEP = std::make_pair(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, ConstantOffset);</div>
<div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;        }</div>
<div class="line"><a name="l04749"></a><span class="lineno"> 4749</span>&#160;      }</div>
<div class="line"><a name="l04750"></a><span class="lineno"> 4750</span>&#160;      <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseOffs -= ConstantOffset;</div>
<div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04752"></a><span class="lineno"> 4752</span>&#160;    }</div>
<div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160; </div>
<div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;    <span class="comment">// Save the valid addressing mode in case we can&#39;t match.</span></div>
<div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;    <a class="code" href="structllvm_1_1ExtAddrMode.html">ExtAddrMode</a> BackupAddrMode = <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>;</div>
<div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160;    <span class="keywordtype">unsigned</span> OldSize = AddrModeInsts.size();</div>
<div class="line"><a name="l04757"></a><span class="lineno"> 4757</span>&#160; </div>
<div class="line"><a name="l04758"></a><span class="lineno"> 4758</span>&#160;    <span class="comment">// See if the scale and offset amount is valid for this target.</span></div>
<div class="line"><a name="l04759"></a><span class="lineno"> 4759</span>&#160;    <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseOffs += ConstantOffset;</div>
<div class="line"><a name="l04760"></a><span class="lineno"> 4760</span>&#160;    <span class="keywordflow">if</span> (!cast&lt;GEPOperator&gt;(AddrInst)-&gt;isInBounds())</div>
<div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160;      <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.InBounds = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160; </div>
<div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160;    <span class="comment">// Match the base operand of the GEP.</span></div>
<div class="line"><a name="l04764"></a><span class="lineno"> 4764</span>&#160;    <span class="keywordflow">if</span> (!matchAddr(AddrInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1)) {</div>
<div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;      <span class="comment">// If it couldn&#39;t be matched, just stuff the value in a register.</span></div>
<div class="line"><a name="l04766"></a><span class="lineno"> 4766</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.HasBaseReg) {</div>
<div class="line"><a name="l04767"></a><span class="lineno"> 4767</span>&#160;        <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a> = BackupAddrMode;</div>
<div class="line"><a name="l04768"></a><span class="lineno"> 4768</span>&#160;        AddrModeInsts.<a class="code" href="classllvm_1_1SmallVectorImpl.html#ad0b3d8447f88377b62d9c019f3c4e118">resize</a>(OldSize);</div>
<div class="line"><a name="l04769"></a><span class="lineno"> 4769</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04770"></a><span class="lineno"> 4770</span>&#160;      }</div>
<div class="line"><a name="l04771"></a><span class="lineno"> 4771</span>&#160;      <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.HasBaseReg = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;      <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg = AddrInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;    }</div>
<div class="line"><a name="l04774"></a><span class="lineno"> 4774</span>&#160; </div>
<div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160;    <span class="comment">// Match the remaining variable portion of the GEP.</span></div>
<div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;    <span class="keywordflow">if</span> (!matchScaledValue(AddrInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(VariableOperand), VariableScale,</div>
<div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;                          <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>)) {</div>
<div class="line"><a name="l04778"></a><span class="lineno"> 4778</span>&#160;      <span class="comment">// If it couldn&#39;t be matched, try stuffing the base into a register</span></div>
<div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160;      <span class="comment">// instead of matching it, and retrying the match of the scale.</span></div>
<div class="line"><a name="l04780"></a><span class="lineno"> 4780</span>&#160;      <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a> = BackupAddrMode;</div>
<div class="line"><a name="l04781"></a><span class="lineno"> 4781</span>&#160;      AddrModeInsts.<a class="code" href="classllvm_1_1SmallVectorImpl.html#ad0b3d8447f88377b62d9c019f3c4e118">resize</a>(OldSize);</div>
<div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.HasBaseReg)</div>
<div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04784"></a><span class="lineno"> 4784</span>&#160;      <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.HasBaseReg = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160;      <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg = AddrInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;      <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseOffs += ConstantOffset;</div>
<div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;      <span class="keywordflow">if</span> (!matchScaledValue(AddrInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(VariableOperand),</div>
<div class="line"><a name="l04788"></a><span class="lineno"> 4788</span>&#160;                            VariableScale, <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>)) {</div>
<div class="line"><a name="l04789"></a><span class="lineno"> 4789</span>&#160;        <span class="comment">// If even that didn&#39;t work, bail.</span></div>
<div class="line"><a name="l04790"></a><span class="lineno"> 4790</span>&#160;        <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a> = BackupAddrMode;</div>
<div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;        AddrModeInsts.<a class="code" href="classllvm_1_1SmallVectorImpl.html#ad0b3d8447f88377b62d9c019f3c4e118">resize</a>(OldSize);</div>
<div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160;      }</div>
<div class="line"><a name="l04794"></a><span class="lineno"> 4794</span>&#160;    }</div>
<div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160; </div>
<div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;  }</div>
<div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;  <span class="keywordflow">case</span> Instruction::SExt:</div>
<div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;  <span class="keywordflow">case</span> Instruction::ZExt: {</div>
<div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a> = dyn_cast&lt;Instruction&gt;(AddrInst);</div>
<div class="line"><a name="l04801"></a><span class="lineno"> 4801</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>)</div>
<div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160; </div>
<div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160;    <span class="comment">// Try to move this ext out of the way of the addressing mode.</span></div>
<div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;    <span class="comment">// Ask for a method for doing so.</span></div>
<div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;    TypePromotionHelper::Action TPH =</div>
<div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;        TypePromotionHelper::getAction(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>, InsertedInsts, TLI, PromotedInsts);</div>
<div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160;    <span class="keywordflow">if</span> (!TPH)</div>
<div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04810"></a><span class="lineno"> 4810</span>&#160; </div>
<div class="line"><a name="l04811"></a><span class="lineno"> 4811</span>&#160;    TypePromotionTransaction::ConstRestorationPt LastKnownGood =</div>
<div class="line"><a name="l04812"></a><span class="lineno"> 4812</span>&#160;        TPT.getRestorationPoint();</div>
<div class="line"><a name="l04813"></a><span class="lineno"> 4813</span>&#160;    <span class="keywordtype">unsigned</span> CreatedInstsCost = 0;</div>
<div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160;    <span class="keywordtype">unsigned</span> ExtCost = !TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#aa262bd68fe6b244861c0a5d249d68c30">isExtFree</a>(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>);</div>
<div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *PromotedOperand =</div>
<div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160;        TPH(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>, TPT, PromotedInsts, CreatedInstsCost, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>, TLI);</div>
<div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160;    <span class="comment">// SExt has been moved away.</span></div>
<div class="line"><a name="l04818"></a><span class="lineno"> 4818</span>&#160;    <span class="comment">// Thus either it will be rematched later in the recursive calls or it is</span></div>
<div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160;    <span class="comment">// gone. Anyway, we must not fold it into the addressing mode at this point.</span></div>
<div class="line"><a name="l04820"></a><span class="lineno"> 4820</span>&#160;    <span class="comment">// E.g.,</span></div>
<div class="line"><a name="l04821"></a><span class="lineno"> 4821</span>&#160;    <span class="comment">// op = add opnd, 1</span></div>
<div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160;    <span class="comment">// idx = ext op</span></div>
<div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;    <span class="comment">// addr = gep base, idx</span></div>
<div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;    <span class="comment">// is now:</span></div>
<div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;    <span class="comment">// promotedOpnd = ext opnd            &lt;- no match here</span></div>
<div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;    <span class="comment">// op = promoted_add promotedOpnd, 1  &lt;- match (later in recursive calls)</span></div>
<div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;    <span class="comment">// addr = gep base, op                &lt;- match</span></div>
<div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;    <span class="keywordflow">if</span> (MovedAway)</div>
<div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160;      *MovedAway = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04830"></a><span class="lineno"> 4830</span>&#160; </div>
<div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PromotedOperand &amp;&amp;</div>
<div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;           <span class="stringliteral">&quot;TypePromotionHelper should have filtered out those cases&quot;</span>);</div>
<div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160; </div>
<div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;    <a class="code" href="structllvm_1_1ExtAddrMode.html">ExtAddrMode</a> BackupAddrMode = <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>;</div>
<div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;    <span class="keywordtype">unsigned</span> OldSize = AddrModeInsts.size();</div>
<div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160; </div>
<div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;    <span class="keywordflow">if</span> (!matchAddr(PromotedOperand, <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>) ||</div>
<div class="line"><a name="l04838"></a><span class="lineno"> 4838</span>&#160;        <span class="comment">// The total of the new cost is equal to the cost of the created</span></div>
<div class="line"><a name="l04839"></a><span class="lineno"> 4839</span>&#160;        <span class="comment">// instructions.</span></div>
<div class="line"><a name="l04840"></a><span class="lineno"> 4840</span>&#160;        <span class="comment">// The total of the old cost is equal to the cost of the extension plus</span></div>
<div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;        <span class="comment">// what we have saved in the addressing mode.</span></div>
<div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160;        !isPromotionProfitable(CreatedInstsCost,</div>
<div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;                               ExtCost + (AddrModeInsts.size() - OldSize),</div>
<div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;                               PromotedOperand)) {</div>
<div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;      <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a> = BackupAddrMode;</div>
<div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;      AddrModeInsts.<a class="code" href="classllvm_1_1SmallVectorImpl.html#ad0b3d8447f88377b62d9c019f3c4e118">resize</a>(OldSize);</div>
<div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Sign extension does not pay off: rollback\n&quot;</span>);</div>
<div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;      TPT.rollback(LastKnownGood);</div>
<div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160;    }</div>
<div class="line"><a name="l04851"></a><span class="lineno"> 4851</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;  }</div>
<div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160;  }</div>
<div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;}</div>
<div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l04857"></a><span class="lineno"> 4857</span>&#160;<span class="comment">/// If we can, try to add the value of &#39;Addr&#39; into the current addressing mode.</span></div>
<div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;<span class="comment">/// If Addr can&#39;t be added to AddrMode this returns false and leaves AddrMode</span></div>
<div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160;<span class="comment">/// unmodified. This assumes that Addr is either a pointer type or intptr_t</span></div>
<div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;<span class="comment">/// for the target.</span></div>
<div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> AddressingModeMatcher::matchAddr(<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>) {</div>
<div class="line"><a name="l04863"></a><span class="lineno"> 4863</span>&#160;  <span class="comment">// Start a transaction at this point that we will rollback if the matching</span></div>
<div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160;  <span class="comment">// fails.</span></div>
<div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;  TypePromotionTransaction::ConstRestorationPt LastKnownGood =</div>
<div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160;      TPT.getRestorationPoint();</div>
<div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CI = dyn_cast&lt;ConstantInt&gt;(<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>)) {</div>
<div class="line"><a name="l04868"></a><span class="lineno"> 4868</span>&#160;    <span class="keywordflow">if</span> (CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>().<a class="code" href="classllvm_1_1APInt.html#a87d50d10274efe9688166584391ae489">isSignedIntN</a>(64)) {</div>
<div class="line"><a name="l04869"></a><span class="lineno"> 4869</span>&#160;      <span class="comment">// Fold in immediates if legal for the target.</span></div>
<div class="line"><a name="l04870"></a><span class="lineno"> 4870</span>&#160;      <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseOffs += CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#aa8f4be0661aa64f5b1f20b15e93bb403">getSExtValue</a>();</div>
<div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;      <span class="keywordflow">if</span> (TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#afa3aef362a1dcff57193d4e6a54f7044">isLegalAddressingMode</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>, AccessTy, AddrSpace))</div>
<div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;      <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseOffs -= CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#aa8f4be0661aa64f5b1f20b15e93bb403">getSExtValue</a>();</div>
<div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160;    }</div>
<div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GlobalValue.html">GlobalValue</a> *GV = dyn_cast&lt;GlobalValue&gt;(<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>)) {</div>
<div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160;    <span class="comment">// If this is a global variable, try to fold it into the addressing mode.</span></div>
<div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseGV) {</div>
<div class="line"><a name="l04878"></a><span class="lineno"> 4878</span>&#160;      <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseGV = GV;</div>
<div class="line"><a name="l04879"></a><span class="lineno"> 4879</span>&#160;      <span class="keywordflow">if</span> (TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#afa3aef362a1dcff57193d4e6a54f7044">isLegalAddressingMode</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>, AccessTy, AddrSpace))</div>
<div class="line"><a name="l04880"></a><span class="lineno"> 4880</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04881"></a><span class="lineno"> 4881</span>&#160;      <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseGV = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04882"></a><span class="lineno"> 4882</span>&#160;    }</div>
<div class="line"><a name="l04883"></a><span class="lineno"> 4883</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>)) {</div>
<div class="line"><a name="l04884"></a><span class="lineno"> 4884</span>&#160;    <a class="code" href="structllvm_1_1ExtAddrMode.html">ExtAddrMode</a> BackupAddrMode = <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>;</div>
<div class="line"><a name="l04885"></a><span class="lineno"> 4885</span>&#160;    <span class="keywordtype">unsigned</span> OldSize = AddrModeInsts.size();</div>
<div class="line"><a name="l04886"></a><span class="lineno"> 4886</span>&#160; </div>
<div class="line"><a name="l04887"></a><span class="lineno"> 4887</span>&#160;    <span class="comment">// Check to see if it is possible to fold this operation.</span></div>
<div class="line"><a name="l04888"></a><span class="lineno"> 4888</span>&#160;    <span class="keywordtype">bool</span> MovedAway = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04889"></a><span class="lineno"> 4889</span>&#160;    <span class="keywordflow">if</span> (matchOperationAddr(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>, &amp;MovedAway)) {</div>
<div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;      <span class="comment">// This instruction may have been moved away. If so, there is nothing</span></div>
<div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;      <span class="comment">// to check here.</span></div>
<div class="line"><a name="l04892"></a><span class="lineno"> 4892</span>&#160;      <span class="keywordflow">if</span> (MovedAway)</div>
<div class="line"><a name="l04893"></a><span class="lineno"> 4893</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04894"></a><span class="lineno"> 4894</span>&#160;      <span class="comment">// Okay, it&#39;s possible to fold this.  Check to see if it is actually</span></div>
<div class="line"><a name="l04895"></a><span class="lineno"> 4895</span>&#160;      <span class="comment">// *profitable* to do so.  We use a simple cost model to avoid increasing</span></div>
<div class="line"><a name="l04896"></a><span class="lineno"> 4896</span>&#160;      <span class="comment">// register pressure too much.</span></div>
<div class="line"><a name="l04897"></a><span class="lineno"> 4897</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUse() ||</div>
<div class="line"><a name="l04898"></a><span class="lineno"> 4898</span>&#160;          isProfitableToFoldIntoAddressingMode(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, BackupAddrMode, <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>)) {</div>
<div class="line"><a name="l04899"></a><span class="lineno"> 4899</span>&#160;        AddrModeInsts.push_back(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l04900"></a><span class="lineno"> 4900</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04901"></a><span class="lineno"> 4901</span>&#160;      }</div>
<div class="line"><a name="l04902"></a><span class="lineno"> 4902</span>&#160; </div>
<div class="line"><a name="l04903"></a><span class="lineno"> 4903</span>&#160;      <span class="comment">// It isn&#39;t profitable to do this, roll back.</span></div>
<div class="line"><a name="l04904"></a><span class="lineno"> 4904</span>&#160;      <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a> = BackupAddrMode;</div>
<div class="line"><a name="l04905"></a><span class="lineno"> 4905</span>&#160;      AddrModeInsts.<a class="code" href="classllvm_1_1SmallVectorImpl.html#ad0b3d8447f88377b62d9c019f3c4e118">resize</a>(OldSize);</div>
<div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;      TPT.rollback(LastKnownGood);</div>
<div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160;    }</div>
<div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *CE = dyn_cast&lt;ConstantExpr&gt;(<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>)) {</div>
<div class="line"><a name="l04909"></a><span class="lineno"> 4909</span>&#160;    <span class="keywordflow">if</span> (matchOperationAddr(CE, <a class="code" href="namespacellvm_1_1WinEH.html#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">CE</a>-&gt;getOpcode(), <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>))</div>
<div class="line"><a name="l04910"></a><span class="lineno"> 4910</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160;    TPT.rollback(LastKnownGood);</div>
<div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;ConstantPointerNull&gt;(<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>)) {</div>
<div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;    <span class="comment">// Null pointer gets folded without affecting the addressing mode.</span></div>
<div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;  }</div>
<div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160; </div>
<div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160;  <span class="comment">// Worse case, the target should support [reg] addressing modes. :)</span></div>
<div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.HasBaseReg) {</div>
<div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160;    <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.HasBaseReg = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04920"></a><span class="lineno"> 4920</span>&#160;    <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg = <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>;</div>
<div class="line"><a name="l04921"></a><span class="lineno"> 4921</span>&#160;    <span class="comment">// Still check for legality in case the target supports [imm] but not [i+r].</span></div>
<div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160;    <span class="keywordflow">if</span> (TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#afa3aef362a1dcff57193d4e6a54f7044">isLegalAddressingMode</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>, AccessTy, AddrSpace))</div>
<div class="line"><a name="l04923"></a><span class="lineno"> 4923</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;    <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.HasBaseReg = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04925"></a><span class="lineno"> 4925</span>&#160;    <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;  }</div>
<div class="line"><a name="l04927"></a><span class="lineno"> 4927</span>&#160; </div>
<div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160;  <span class="comment">// If the base register is already taken, see if we can do [r+r].</span></div>
<div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale == 0) {</div>
<div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;    <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale = 1;</div>
<div class="line"><a name="l04931"></a><span class="lineno"> 4931</span>&#160;    <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.ScaledReg = <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>;</div>
<div class="line"><a name="l04932"></a><span class="lineno"> 4932</span>&#160;    <span class="keywordflow">if</span> (TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#afa3aef362a1dcff57193d4e6a54f7044">isLegalAddressingMode</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>, AccessTy, AddrSpace))</div>
<div class="line"><a name="l04933"></a><span class="lineno"> 4933</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04934"></a><span class="lineno"> 4934</span>&#160;    <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale = 0;</div>
<div class="line"><a name="l04935"></a><span class="lineno"> 4935</span>&#160;    <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.ScaledReg = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04936"></a><span class="lineno"> 4936</span>&#160;  }</div>
<div class="line"><a name="l04937"></a><span class="lineno"> 4937</span>&#160;  <span class="comment">// Couldn&#39;t match.</span></div>
<div class="line"><a name="l04938"></a><span class="lineno"> 4938</span>&#160;  TPT.rollback(LastKnownGood);</div>
<div class="line"><a name="l04939"></a><span class="lineno"> 4939</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04940"></a><span class="lineno"> 4940</span>&#160;}</div>
<div class="line"><a name="l04941"></a><span class="lineno"> 4941</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l04942"></a><span class="lineno"> 4942</span>&#160;<span class="comment">/// Check to see if all uses of OpVal by the specified inline asm call are due</span></div>
<div class="line"><a name="l04943"></a><span class="lineno"> 4943</span>&#160;<span class="comment">/// to memory operands. If so, return true, otherwise return false.</span></div>
<div class="line"><a name="l04944"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#a86026627b644e50527898aad0747b3e5"> 4944</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CodeGenPrepare_8cpp.html#a86026627b644e50527898aad0747b3e5">IsOperandAMemoryOperand</a>(<a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI, <a class="code" href="classllvm_1_1InlineAsm.html">InlineAsm</a> *<a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46aaf2ff1a10f3f3b211d7781a33e4c1e05">IA</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *OpVal,</div>
<div class="line"><a name="l04945"></a><span class="lineno"> 4945</span>&#160;                                    <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI,</div>
<div class="line"><a name="l04946"></a><span class="lineno"> 4946</span>&#160;                                    <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetRegisterInfo.html">TargetRegisterInfo</a> &amp;<a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>) {</div>
<div class="line"><a name="l04947"></a><span class="lineno"> 4947</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>();</div>
<div class="line"><a name="l04948"></a><span class="lineno"> 4948</span>&#160;  <a class="code" href="classllvm_1_1TargetLowering.html#a3db162658a7687e8a5df34f5a6aaa840">TargetLowering::AsmOperandInfoVector</a> TargetConstraints =</div>
<div class="line"><a name="l04949"></a><span class="lineno"> 4949</span>&#160;      TLI.<a class="code" href="classllvm_1_1TargetLowering.html#ab37c33cd1796e553461f26aefbf498fa">ParseConstraints</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getParent()-&gt;getDataLayout(), &amp;<a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, *CI);</div>
<div class="line"><a name="l04950"></a><span class="lineno"> 4950</span>&#160; </div>
<div class="line"><a name="l04951"></a><span class="lineno"> 4951</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="structllvm_1_1TargetLowering_1_1AsmOperandInfo.html">TargetLowering::AsmOperandInfo</a> &amp;OpInfo : TargetConstraints) {</div>
<div class="line"><a name="l04952"></a><span class="lineno"> 4952</span>&#160;    <span class="comment">// Compute the constraint code and ConstraintType to use.</span></div>
<div class="line"><a name="l04953"></a><span class="lineno"> 4953</span>&#160;    TLI.<a class="code" href="classllvm_1_1TargetLowering.html#acb82500e7e47e76d087ce8606ae8e625">ComputeConstraintToUse</a>(OpInfo, <a class="code" href="classllvm_1_1SDValue.html">SDValue</a>());</div>
<div class="line"><a name="l04954"></a><span class="lineno"> 4954</span>&#160; </div>
<div class="line"><a name="l04955"></a><span class="lineno"> 4955</span>&#160;    <span class="comment">// If this asm operand is our Value*, and if it isn&#39;t an indirect memory</span></div>
<div class="line"><a name="l04956"></a><span class="lineno"> 4956</span>&#160;    <span class="comment">// operand, we can&#39;t fold it!  TODO: Also handle C_Address?</span></div>
<div class="line"><a name="l04957"></a><span class="lineno"> 4957</span>&#160;    <span class="keywordflow">if</span> (OpInfo.CallOperandVal == OpVal &amp;&amp;</div>
<div class="line"><a name="l04958"></a><span class="lineno"> 4958</span>&#160;        (OpInfo.ConstraintType != TargetLowering::C_Memory ||</div>
<div class="line"><a name="l04959"></a><span class="lineno"> 4959</span>&#160;         !OpInfo.isIndirect))</div>
<div class="line"><a name="l04960"></a><span class="lineno"> 4960</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04961"></a><span class="lineno"> 4961</span>&#160;  }</div>
<div class="line"><a name="l04962"></a><span class="lineno"> 4962</span>&#160; </div>
<div class="line"><a name="l04963"></a><span class="lineno"> 4963</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04964"></a><span class="lineno"> 4964</span>&#160;}</div>
<div class="line"><a name="l04965"></a><span class="lineno"> 4965</span>&#160; </div>
<div class="line"><a name="l04966"></a><span class="lineno"> 4966</span>&#160;<span class="comment">// Max number of memory uses to look at before aborting the search to conserve</span></div>
<div class="line"><a name="l04967"></a><span class="lineno"> 4967</span>&#160;<span class="comment">// compile time.</span></div>
<div class="line"><a name="l04968"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#abc3a06deec19e97d921adc67d7828492"> 4968</a></span>&#160;<span class="keyword">static</span> constexpr <span class="keywordtype">int</span> <a class="code" href="CodeGenPrepare_8cpp.html#abc3a06deec19e97d921adc67d7828492">MaxMemoryUsesToScan</a> = 20;</div>
<div class="line"><a name="l04969"></a><span class="lineno"> 4969</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l04970"></a><span class="lineno"> 4970</span>&#160;<span class="comment">/// Recursively walk all the uses of I until we find a memory use.</span></div>
<div class="line"><a name="l04971"></a><span class="lineno"> 4971</span>&#160;<span class="comment">/// If we find an obviously non-foldable instruction, return true.</span></div>
<div class="line"><a name="l04972"></a><span class="lineno"> 4972</span>&#160;<span class="comment">/// Add accessed addresses and types to MemoryUses.</span></div>
<div class="line"><a name="l04973"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#a12a2c968fb364b21a905ce603f335440"> 4973</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CodeGenPrepare_8cpp.html#a12a2c968fb364b21a905ce603f335440">FindAllMemoryUses</a>(</div>
<div class="line"><a name="l04974"></a><span class="lineno"> 4974</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl</a>&lt;std::pair&lt;Value *, Type *&gt;&gt; &amp;MemoryUses,</div>
<div class="line"><a name="l04975"></a><span class="lineno"> 4975</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSetImpl.html">SmallPtrSetImpl&lt;Instruction *&gt;</a> &amp;ConsideredInsts, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI,</div>
<div class="line"><a name="l04976"></a><span class="lineno"> 4976</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetRegisterInfo.html">TargetRegisterInfo</a> &amp;<a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <span class="keywordtype">bool</span> OptSize, <a class="code" href="classllvm_1_1ProfileSummaryInfo.html">ProfileSummaryInfo</a> *PSI,</div>
<div class="line"><a name="l04977"></a><span class="lineno"> 4977</span>&#160;    <a class="code" href="classllvm_1_1BlockFrequencyInfo.html">BlockFrequencyInfo</a> *<a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>, <span class="keywordtype">int</span> SeenInsts = 0) {</div>
<div class="line"><a name="l04978"></a><span class="lineno"> 4978</span>&#160;  <span class="comment">// If we already considered this instruction, we&#39;re done.</span></div>
<div class="line"><a name="l04979"></a><span class="lineno"> 4979</span>&#160;  <span class="keywordflow">if</span> (!ConsideredInsts.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>).second)</div>
<div class="line"><a name="l04980"></a><span class="lineno"> 4980</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04981"></a><span class="lineno"> 4981</span>&#160; </div>
<div class="line"><a name="l04982"></a><span class="lineno"> 4982</span>&#160;  <span class="comment">// If this is an obviously unfoldable instruction, bail out.</span></div>
<div class="line"><a name="l04983"></a><span class="lineno"> 4983</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="CodeGenPrepare_8cpp.html#a9d0372d5a469c089a4f2a299dd679558">MightBeFoldableInst</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l04984"></a><span class="lineno"> 4984</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04985"></a><span class="lineno"> 4985</span>&#160; </div>
<div class="line"><a name="l04986"></a><span class="lineno"> 4986</span>&#160;  <span class="comment">// Loop over all the uses, recursively processing them.</span></div>
<div class="line"><a name="l04987"></a><span class="lineno"> 4987</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U : <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;uses()) {</div>
<div class="line"><a name="l04988"></a><span class="lineno"> 4988</span>&#160;    <span class="comment">// Conservatively return true if we&#39;re seeing a large number or a deep chain</span></div>
<div class="line"><a name="l04989"></a><span class="lineno"> 4989</span>&#160;    <span class="comment">// of users. This avoids excessive compilation times in pathological cases.</span></div>
<div class="line"><a name="l04990"></a><span class="lineno"> 4990</span>&#160;    <span class="keywordflow">if</span> (SeenInsts++ &gt;= <a class="code" href="CodeGenPrepare_8cpp.html#abc3a06deec19e97d921adc67d7828492">MaxMemoryUsesToScan</a>)</div>
<div class="line"><a name="l04991"></a><span class="lineno"> 4991</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160; </div>
<div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *UserI = cast&lt;Instruction&gt;(U.getUser());</div>
<div class="line"><a name="l04994"></a><span class="lineno"> 4994</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(UserI)) {</div>
<div class="line"><a name="l04995"></a><span class="lineno"> 4995</span>&#160;      MemoryUses.push_back({U.get(), LI-&gt;getType()});</div>
<div class="line"><a name="l04996"></a><span class="lineno"> 4996</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160;    }</div>
<div class="line"><a name="l04998"></a><span class="lineno"> 4998</span>&#160; </div>
<div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;StoreInst&gt;(UserI)) {</div>
<div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160;      <span class="keywordflow">if</span> (U.getOperandNo() != <a class="code" href="HWAddressSanitizer_8cpp.html#ad5c3fea3e9699b6299cc037334eeb83e">StoreInst::getPointerOperandIndex</a>())</div>
<div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// Storing addr, not into addr.</span></div>
<div class="line"><a name="l05002"></a><span class="lineno"> 5002</span>&#160;      MemoryUses.push_back({U.get(), <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getValueOperand()-&gt;getType()});</div>
<div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05004"></a><span class="lineno"> 5004</span>&#160;    }</div>
<div class="line"><a name="l05005"></a><span class="lineno"> 5005</span>&#160; </div>
<div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *RMW = dyn_cast&lt;AtomicRMWInst&gt;(UserI)) {</div>
<div class="line"><a name="l05007"></a><span class="lineno"> 5007</span>&#160;      <span class="keywordflow">if</span> (U.getOperandNo() != <a class="code" href="HWAddressSanitizer_8cpp.html#ad5c3fea3e9699b6299cc037334eeb83e">AtomicRMWInst::getPointerOperandIndex</a>())</div>
<div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// Storing addr, not into addr.</span></div>
<div class="line"><a name="l05009"></a><span class="lineno"> 5009</span>&#160;      MemoryUses.push_back({U.get(), RMW-&gt;getValOperand()-&gt;getType()});</div>
<div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160;    }</div>
<div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160; </div>
<div class="line"><a name="l05013"></a><span class="lineno"> 5013</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html">AtomicCmpXchgInst</a> *CmpX = dyn_cast&lt;AtomicCmpXchgInst&gt;(UserI)) {</div>
<div class="line"><a name="l05014"></a><span class="lineno"> 5014</span>&#160;      <span class="keywordflow">if</span> (U.getOperandNo() != <a class="code" href="HWAddressSanitizer_8cpp.html#ad5c3fea3e9699b6299cc037334eeb83e">AtomicCmpXchgInst::getPointerOperandIndex</a>())</div>
<div class="line"><a name="l05015"></a><span class="lineno"> 5015</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// Storing addr, not into addr.</span></div>
<div class="line"><a name="l05016"></a><span class="lineno"> 5016</span>&#160;      MemoryUses.push_back({U.get(), CmpX-&gt;getCompareOperand()-&gt;getType()});</div>
<div class="line"><a name="l05017"></a><span class="lineno"> 5017</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160;    }</div>
<div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160; </div>
<div class="line"><a name="l05020"></a><span class="lineno"> 5020</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI = dyn_cast&lt;CallInst&gt;(UserI)) {</div>
<div class="line"><a name="l05021"></a><span class="lineno"> 5021</span>&#160;      <span class="keywordflow">if</span> (CI-&gt;hasFnAttr(<a class="code" href="namespacellvm_1_1CallingConv.html#a5b166ae228ebbfdb96736d6022f3feeda94ec9273479164e4aec1d5d91b71dc85">Attribute::Cold</a>)) {</div>
<div class="line"><a name="l05022"></a><span class="lineno"> 5022</span>&#160;        <span class="comment">// If this is a cold call, we can sink the addressing calculation into</span></div>
<div class="line"><a name="l05023"></a><span class="lineno"> 5023</span>&#160;        <span class="comment">// the cold path.  See optimizeCallInst</span></div>
<div class="line"><a name="l05024"></a><span class="lineno"> 5024</span>&#160;        <span class="keywordtype">bool</span> OptForSize =</div>
<div class="line"><a name="l05025"></a><span class="lineno"> 5025</span>&#160;            OptSize || <a class="code" href="namespacellvm.html#a3af72f14ea20f2c762c751d2d49e5ea3">llvm::shouldOptimizeForSize</a>(CI-&gt;getParent(), PSI, <a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>);</div>
<div class="line"><a name="l05026"></a><span class="lineno"> 5026</span>&#160;        <span class="keywordflow">if</span> (!OptForSize)</div>
<div class="line"><a name="l05027"></a><span class="lineno"> 5027</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05028"></a><span class="lineno"> 5028</span>&#160;      }</div>
<div class="line"><a name="l05029"></a><span class="lineno"> 5029</span>&#160; </div>
<div class="line"><a name="l05030"></a><span class="lineno"> 5030</span>&#160;      <a class="code" href="classllvm_1_1InlineAsm.html">InlineAsm</a> *<a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46aaf2ff1a10f3f3b211d7781a33e4c1e05">IA</a> = dyn_cast&lt;InlineAsm&gt;(CI-&gt;getCalledOperand());</div>
<div class="line"><a name="l05031"></a><span class="lineno"> 5031</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46aaf2ff1a10f3f3b211d7781a33e4c1e05">IA</a>)</div>
<div class="line"><a name="l05032"></a><span class="lineno"> 5032</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05033"></a><span class="lineno"> 5033</span>&#160; </div>
<div class="line"><a name="l05034"></a><span class="lineno"> 5034</span>&#160;      <span class="comment">// If this is a memory operand, we&#39;re cool, otherwise bail out.</span></div>
<div class="line"><a name="l05035"></a><span class="lineno"> 5035</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="CodeGenPrepare_8cpp.html#a86026627b644e50527898aad0747b3e5">IsOperandAMemoryOperand</a>(CI, <a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46aaf2ff1a10f3f3b211d7781a33e4c1e05">IA</a>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, TLI, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>))</div>
<div class="line"><a name="l05036"></a><span class="lineno"> 5036</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05037"></a><span class="lineno"> 5037</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05038"></a><span class="lineno"> 5038</span>&#160;    }</div>
<div class="line"><a name="l05039"></a><span class="lineno"> 5039</span>&#160; </div>
<div class="line"><a name="l05040"></a><span class="lineno"> 5040</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="CodeGenPrepare_8cpp.html#a12a2c968fb364b21a905ce603f335440">FindAllMemoryUses</a>(UserI, MemoryUses, ConsideredInsts, TLI, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, OptSize,</div>
<div class="line"><a name="l05041"></a><span class="lineno"> 5041</span>&#160;                          PSI, <a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>, SeenInsts))</div>
<div class="line"><a name="l05042"></a><span class="lineno"> 5042</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05043"></a><span class="lineno"> 5043</span>&#160;  }</div>
<div class="line"><a name="l05044"></a><span class="lineno"> 5044</span>&#160; </div>
<div class="line"><a name="l05045"></a><span class="lineno"> 5045</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05046"></a><span class="lineno"> 5046</span>&#160;}</div>
<div class="line"><a name="l05047"></a><span class="lineno"> 5047</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l05048"></a><span class="lineno"> 5048</span>&#160;<span class="comment">/// Return true if Val is already known to be live at the use site that we&#39;re</span></div>
<div class="line"><a name="l05049"></a><span class="lineno"> 5049</span>&#160;<span class="comment">/// folding it into. If so, there is no cost to include it in the addressing</span></div>
<div class="line"><a name="l05050"></a><span class="lineno"> 5050</span>&#160;<span class="comment">/// mode. KnownLive1 and KnownLive2 are two values that we know are live at the</span></div>
<div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160;<span class="comment">/// instruction already.</span></div>
<div class="line"><a name="l05052"></a><span class="lineno"> 5052</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> AddressingModeMatcher::valueAlreadyLiveAtInst(<a class="code" href="classllvm_1_1Value.html">Value</a> *Val,</div>
<div class="line"><a name="l05053"></a><span class="lineno"> 5053</span>&#160;                                                   <a class="code" href="classllvm_1_1Value.html">Value</a> *KnownLive1,</div>
<div class="line"><a name="l05054"></a><span class="lineno"> 5054</span>&#160;                                                   <a class="code" href="classllvm_1_1Value.html">Value</a> *KnownLive2) {</div>
<div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160;  <span class="comment">// If Val is either of the known-live values, we know it is live!</span></div>
<div class="line"><a name="l05056"></a><span class="lineno"> 5056</span>&#160;  <span class="keywordflow">if</span> (Val == <span class="keyword">nullptr</span> || Val == KnownLive1 || Val == KnownLive2)</div>
<div class="line"><a name="l05057"></a><span class="lineno"> 5057</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05058"></a><span class="lineno"> 5058</span>&#160; </div>
<div class="line"><a name="l05059"></a><span class="lineno"> 5059</span>&#160;  <span class="comment">// All values other than instructions and arguments (e.g. constants) are live.</span></div>
<div class="line"><a name="l05060"></a><span class="lineno"> 5060</span>&#160;  <span class="keywordflow">if</span> (!isa&lt;Instruction&gt;(Val) &amp;&amp; !isa&lt;Argument&gt;(Val))</div>
<div class="line"><a name="l05061"></a><span class="lineno"> 5061</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05062"></a><span class="lineno"> 5062</span>&#160; </div>
<div class="line"><a name="l05063"></a><span class="lineno"> 5063</span>&#160;  <span class="comment">// If Val is a constant sized alloca in the entry block, it is live, this is</span></div>
<div class="line"><a name="l05064"></a><span class="lineno"> 5064</span>&#160;  <span class="comment">// true because it is just a reference to the stack/frame pointer, which is</span></div>
<div class="line"><a name="l05065"></a><span class="lineno"> 5065</span>&#160;  <span class="comment">// live for the whole function.</span></div>
<div class="line"><a name="l05066"></a><span class="lineno"> 5066</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI = dyn_cast&lt;AllocaInst&gt;(Val))</div>
<div class="line"><a name="l05067"></a><span class="lineno"> 5067</span>&#160;    <span class="keywordflow">if</span> (AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a36e31f42170be95fc392dad696d9ba19">isStaticAlloca</a>())</div>
<div class="line"><a name="l05068"></a><span class="lineno"> 5068</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05069"></a><span class="lineno"> 5069</span>&#160; </div>
<div class="line"><a name="l05070"></a><span class="lineno"> 5070</span>&#160;  <span class="comment">// Check to see if this value is already used in the memory instruction&#39;s</span></div>
<div class="line"><a name="l05071"></a><span class="lineno"> 5071</span>&#160;  <span class="comment">// block.  If so, it&#39;s already live into the block at the very least, so we</span></div>
<div class="line"><a name="l05072"></a><span class="lineno"> 5072</span>&#160;  <span class="comment">// can reasonably fold it.</span></div>
<div class="line"><a name="l05073"></a><span class="lineno"> 5073</span>&#160;  <span class="keywordflow">return</span> Val-&gt;<a class="code" href="classllvm_1_1Value.html#a55bba6bcd9b098e1c227011e6cd66300">isUsedInBasicBlock</a>(MemoryInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>());</div>
<div class="line"><a name="l05074"></a><span class="lineno"> 5074</span>&#160;}</div>
<div class="line"><a name="l05075"></a><span class="lineno"> 5075</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l05076"></a><span class="lineno"> 5076</span>&#160;<span class="comment">/// It is possible for the addressing mode of the machine to fold the specified</span></div>
<div class="line"><a name="l05077"></a><span class="lineno"> 5077</span>&#160;<span class="comment">/// instruction into a load or store that ultimately uses it.</span></div>
<div class="line"><a name="l05078"></a><span class="lineno"> 5078</span>&#160;<span class="comment">/// However, the specified instruction has multiple uses.</span></div>
<div class="line"><a name="l05079"></a><span class="lineno"> 5079</span>&#160;<span class="comment">/// Given this, it may actually increase register pressure to fold it</span></div>
<div class="line"><a name="l05080"></a><span class="lineno"> 5080</span>&#160;<span class="comment">/// into the load. For example, consider this code:</span></div>
<div class="line"><a name="l05081"></a><span class="lineno"> 5081</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l05082"></a><span class="lineno"> 5082</span>&#160;<span class="comment">///     X = ...</span></div>
<div class="line"><a name="l05083"></a><span class="lineno"> 5083</span>&#160;<span class="comment">///     Y = X+1</span></div>
<div class="line"><a name="l05084"></a><span class="lineno"> 5084</span>&#160;<span class="comment">///     use(Y)   -&gt; nonload/store</span></div>
<div class="line"><a name="l05085"></a><span class="lineno"> 5085</span>&#160;<span class="comment">///     Z = Y+1</span></div>
<div class="line"><a name="l05086"></a><span class="lineno"> 5086</span>&#160;<span class="comment">///     load Z</span></div>
<div class="line"><a name="l05087"></a><span class="lineno"> 5087</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l05088"></a><span class="lineno"> 5088</span>&#160;<span class="comment">/// In this case, Y has multiple uses, and can be folded into the load of Z</span></div>
<div class="line"><a name="l05089"></a><span class="lineno"> 5089</span>&#160;<span class="comment">/// (yielding load [X+2]).  However, doing this will cause both &quot;X&quot; and &quot;X+1&quot; to</span></div>
<div class="line"><a name="l05090"></a><span class="lineno"> 5090</span>&#160;<span class="comment">/// be live at the use(Y) line.  If we don&#39;t fold Y into load Z, we use one</span></div>
<div class="line"><a name="l05091"></a><span class="lineno"> 5091</span>&#160;<span class="comment">/// fewer register.  Since Y can&#39;t be folded into &quot;use(Y)&quot; we don&#39;t increase the</span></div>
<div class="line"><a name="l05092"></a><span class="lineno"> 5092</span>&#160;<span class="comment">/// number of computations either.</span></div>
<div class="line"><a name="l05093"></a><span class="lineno"> 5093</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l05094"></a><span class="lineno"> 5094</span>&#160;<span class="comment">/// Note that this (like most of CodeGenPrepare) is just a rough heuristic.  If</span></div>
<div class="line"><a name="l05095"></a><span class="lineno"> 5095</span>&#160;<span class="comment">/// X was live across &#39;load Z&#39; for other reasons, we actually *would* want to</span></div>
<div class="line"><a name="l05096"></a><span class="lineno"> 5096</span>&#160;<span class="comment">/// fold the addressing mode in the Z case.  This would make Y die earlier.</span></div>
<div class="line"><a name="l05097"></a><span class="lineno"> 5097</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> AddressingModeMatcher::isProfitableToFoldIntoAddressingMode(</div>
<div class="line"><a name="l05098"></a><span class="lineno"> 5098</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="structllvm_1_1ExtAddrMode.html">ExtAddrMode</a> &amp;AMBefore, <a class="code" href="structllvm_1_1ExtAddrMode.html">ExtAddrMode</a> &amp;AMAfter) {</div>
<div class="line"><a name="l05099"></a><span class="lineno"> 5099</span>&#160;  <span class="keywordflow">if</span> (IgnoreProfitability)</div>
<div class="line"><a name="l05100"></a><span class="lineno"> 5100</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05101"></a><span class="lineno"> 5101</span>&#160; </div>
<div class="line"><a name="l05102"></a><span class="lineno"> 5102</span>&#160;  <span class="comment">// AMBefore is the addressing mode before this instruction was folded into it,</span></div>
<div class="line"><a name="l05103"></a><span class="lineno"> 5103</span>&#160;  <span class="comment">// and AMAfter is the addressing mode after the instruction was folded.  Get</span></div>
<div class="line"><a name="l05104"></a><span class="lineno"> 5104</span>&#160;  <span class="comment">// the set of registers referenced by AMAfter and subtract out those</span></div>
<div class="line"><a name="l05105"></a><span class="lineno"> 5105</span>&#160;  <span class="comment">// referenced by AMBefore: this is the set of values which folding in this</span></div>
<div class="line"><a name="l05106"></a><span class="lineno"> 5106</span>&#160;  <span class="comment">// address extends the lifetime of.</span></div>
<div class="line"><a name="l05107"></a><span class="lineno"> 5107</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l05108"></a><span class="lineno"> 5108</span>&#160;  <span class="comment">// Note that there are only two potential values being referenced here,</span></div>
<div class="line"><a name="l05109"></a><span class="lineno"> 5109</span>&#160;  <span class="comment">// BaseReg and ScaleReg (global addresses are always available, as are any</span></div>
<div class="line"><a name="l05110"></a><span class="lineno"> 5110</span>&#160;  <span class="comment">// folded immediates).</span></div>
<div class="line"><a name="l05111"></a><span class="lineno"> 5111</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *BaseReg = AMAfter.<a class="code" href="structllvm_1_1ExtAddrMode.html#a2404b5dd8b0a6746487c699291c54927">BaseReg</a>, *ScaledReg = AMAfter.<a class="code" href="structllvm_1_1ExtAddrMode.html#a243a500ecf43f8be3648cd935b943165">ScaledReg</a>;</div>
<div class="line"><a name="l05112"></a><span class="lineno"> 5112</span>&#160; </div>
<div class="line"><a name="l05113"></a><span class="lineno"> 5113</span>&#160;  <span class="comment">// If the BaseReg or ScaledReg was referenced by the previous addrmode, their</span></div>
<div class="line"><a name="l05114"></a><span class="lineno"> 5114</span>&#160;  <span class="comment">// lifetime wasn&#39;t extended by adding this instruction.</span></div>
<div class="line"><a name="l05115"></a><span class="lineno"> 5115</span>&#160;  <span class="keywordflow">if</span> (valueAlreadyLiveAtInst(BaseReg, AMBefore.<a class="code" href="structllvm_1_1ExtAddrMode.html#a2404b5dd8b0a6746487c699291c54927">BaseReg</a>, AMBefore.<a class="code" href="structllvm_1_1ExtAddrMode.html#a243a500ecf43f8be3648cd935b943165">ScaledReg</a>))</div>
<div class="line"><a name="l05116"></a><span class="lineno"> 5116</span>&#160;    BaseReg = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05117"></a><span class="lineno"> 5117</span>&#160;  <span class="keywordflow">if</span> (valueAlreadyLiveAtInst(ScaledReg, AMBefore.<a class="code" href="structllvm_1_1ExtAddrMode.html#a2404b5dd8b0a6746487c699291c54927">BaseReg</a>, AMBefore.<a class="code" href="structllvm_1_1ExtAddrMode.html#a243a500ecf43f8be3648cd935b943165">ScaledReg</a>))</div>
<div class="line"><a name="l05118"></a><span class="lineno"> 5118</span>&#160;    ScaledReg = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05119"></a><span class="lineno"> 5119</span>&#160; </div>
<div class="line"><a name="l05120"></a><span class="lineno"> 5120</span>&#160;  <span class="comment">// If folding this instruction (and it&#39;s subexprs) didn&#39;t extend any live</span></div>
<div class="line"><a name="l05121"></a><span class="lineno"> 5121</span>&#160;  <span class="comment">// ranges, we&#39;re ok with it.</span></div>
<div class="line"><a name="l05122"></a><span class="lineno"> 5122</span>&#160;  <span class="keywordflow">if</span> (!BaseReg &amp;&amp; !ScaledReg)</div>
<div class="line"><a name="l05123"></a><span class="lineno"> 5123</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05124"></a><span class="lineno"> 5124</span>&#160; </div>
<div class="line"><a name="l05125"></a><span class="lineno"> 5125</span>&#160;  <span class="comment">// If all uses of this instruction can have the address mode sunk into them,</span></div>
<div class="line"><a name="l05126"></a><span class="lineno"> 5126</span>&#160;  <span class="comment">// we can remove the addressing mode and effectively trade one live register</span></div>
<div class="line"><a name="l05127"></a><span class="lineno"> 5127</span>&#160;  <span class="comment">// for another (at worst.)  In this context, folding an addressing mode into</span></div>
<div class="line"><a name="l05128"></a><span class="lineno"> 5128</span>&#160;  <span class="comment">// the use is just a particularly nice way of sinking it.</span></div>
<div class="line"><a name="l05129"></a><span class="lineno"> 5129</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;Value *, Type *&gt;</a>, 16&gt; MemoryUses;</div>
<div class="line"><a name="l05130"></a><span class="lineno"> 5130</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction *, 16&gt;</a> ConsideredInsts;</div>
<div class="line"><a name="l05131"></a><span class="lineno"> 5131</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="CodeGenPrepare_8cpp.html#a12a2c968fb364b21a905ce603f335440">FindAllMemoryUses</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, MemoryUses, ConsideredInsts, TLI, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, OptSize, PSI,</div>
<div class="line"><a name="l05132"></a><span class="lineno"> 5132</span>&#160;                        <a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>))</div>
<div class="line"><a name="l05133"></a><span class="lineno"> 5133</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Has a non-memory, non-foldable use!</span></div>
<div class="line"><a name="l05134"></a><span class="lineno"> 5134</span>&#160; </div>
<div class="line"><a name="l05135"></a><span class="lineno"> 5135</span>&#160;  <span class="comment">// Now that we know that all uses of this instruction are part of a chain of</span></div>
<div class="line"><a name="l05136"></a><span class="lineno"> 5136</span>&#160;  <span class="comment">// computation involving only operations that could theoretically be folded</span></div>
<div class="line"><a name="l05137"></a><span class="lineno"> 5137</span>&#160;  <span class="comment">// into a memory use, loop over each of these memory operation uses and see</span></div>
<div class="line"><a name="l05138"></a><span class="lineno"> 5138</span>&#160;  <span class="comment">// if they could  *actually* fold the instruction.  The assumption is that</span></div>
<div class="line"><a name="l05139"></a><span class="lineno"> 5139</span>&#160;  <span class="comment">// addressing modes are cheap and that duplicating the computation involved</span></div>
<div class="line"><a name="l05140"></a><span class="lineno"> 5140</span>&#160;  <span class="comment">// many times is worthwhile, even on a fastpath. For sinking candidates</span></div>
<div class="line"><a name="l05141"></a><span class="lineno"> 5141</span>&#160;  <span class="comment">// (i.e. cold call sites), this serves as a way to prevent excessive code</span></div>
<div class="line"><a name="l05142"></a><span class="lineno"> 5142</span>&#160;  <span class="comment">// growth since most architectures have some reasonable small and fast way to</span></div>
<div class="line"><a name="l05143"></a><span class="lineno"> 5143</span>&#160;  <span class="comment">// compute an effective address.  (i.e LEA on x86)</span></div>
<div class="line"><a name="l05144"></a><span class="lineno"> 5144</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 32&gt;</a> MatchedAddrModeInsts;</div>
<div class="line"><a name="l05145"></a><span class="lineno"> 5145</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> std::pair&lt;Value *, Type *&gt; &amp;Pair : MemoryUses) {</div>
<div class="line"><a name="l05146"></a><span class="lineno"> 5146</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1pdb.html#ac10322dc19a928c2dbb83ec9689dc23cadd7bf230fde8d4836917806aff6a6b27">Address</a> = Pair.first;</div>
<div class="line"><a name="l05147"></a><span class="lineno"> 5147</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *AddressAccessTy = Pair.second;</div>
<div class="line"><a name="l05148"></a><span class="lineno"> 5148</span>&#160;    <span class="keywordtype">unsigned</span> AS = <a class="code" href="namespacellvm_1_1pdb.html#ac10322dc19a928c2dbb83ec9689dc23cadd7bf230fde8d4836917806aff6a6b27">Address</a>-&gt;getType()-&gt;getPointerAddressSpace();</div>
<div class="line"><a name="l05149"></a><span class="lineno"> 5149</span>&#160; </div>
<div class="line"><a name="l05150"></a><span class="lineno"> 5150</span>&#160;    <span class="comment">// Do a match against the root of this address, ignoring profitability. This</span></div>
<div class="line"><a name="l05151"></a><span class="lineno"> 5151</span>&#160;    <span class="comment">// will tell us if the addressing mode for the memory operation will</span></div>
<div class="line"><a name="l05152"></a><span class="lineno"> 5152</span>&#160;    <span class="comment">// *actually* cover the shared instruction.</span></div>
<div class="line"><a name="l05153"></a><span class="lineno"> 5153</span>&#160;    <a class="code" href="structllvm_1_1ExtAddrMode.html">ExtAddrMode</a> <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>;</div>
<div class="line"><a name="l05154"></a><span class="lineno"> 5154</span>&#160;    std::pair&lt;AssertingVH&lt;GetElementPtrInst&gt;, int64_t&gt; LargeOffsetGEP(<span class="keyword">nullptr</span>,</div>
<div class="line"><a name="l05155"></a><span class="lineno"> 5155</span>&#160;                                                                      0);</div>
<div class="line"><a name="l05156"></a><span class="lineno"> 5156</span>&#160;    TypePromotionTransaction::ConstRestorationPt LastKnownGood =</div>
<div class="line"><a name="l05157"></a><span class="lineno"> 5157</span>&#160;        TPT.getRestorationPoint();</div>
<div class="line"><a name="l05158"></a><span class="lineno"> 5158</span>&#160;    AddressingModeMatcher Matcher(MatchedAddrModeInsts, TLI, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, LI, getDTFn,</div>
<div class="line"><a name="l05159"></a><span class="lineno"> 5159</span>&#160;                                  AddressAccessTy, AS, MemoryInst, Result,</div>
<div class="line"><a name="l05160"></a><span class="lineno"> 5160</span>&#160;                                  InsertedInsts, PromotedInsts, TPT,</div>
<div class="line"><a name="l05161"></a><span class="lineno"> 5161</span>&#160;                                  LargeOffsetGEP, OptSize, PSI, <a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>);</div>
<div class="line"><a name="l05162"></a><span class="lineno"> 5162</span>&#160;    Matcher.IgnoreProfitability = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05163"></a><span class="lineno"> 5163</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a> = Matcher.matchAddr(Address, 0);</div>
<div class="line"><a name="l05164"></a><span class="lineno"> 5164</span>&#160;    (void)<a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a>;</div>
<div class="line"><a name="l05165"></a><span class="lineno"> 5165</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a> &amp;&amp; <span class="stringliteral">&quot;Couldn&#39;t select *anything*?&quot;</span>);</div>
<div class="line"><a name="l05166"></a><span class="lineno"> 5166</span>&#160; </div>
<div class="line"><a name="l05167"></a><span class="lineno"> 5167</span>&#160;    <span class="comment">// The match was to check the profitability, the changes made are not</span></div>
<div class="line"><a name="l05168"></a><span class="lineno"> 5168</span>&#160;    <span class="comment">// part of the original matcher. Therefore, they should be dropped</span></div>
<div class="line"><a name="l05169"></a><span class="lineno"> 5169</span>&#160;    <span class="comment">// otherwise the original matcher will not present the right state.</span></div>
<div class="line"><a name="l05170"></a><span class="lineno"> 5170</span>&#160;    TPT.rollback(LastKnownGood);</div>
<div class="line"><a name="l05171"></a><span class="lineno"> 5171</span>&#160; </div>
<div class="line"><a name="l05172"></a><span class="lineno"> 5172</span>&#160;    <span class="comment">// If the match didn&#39;t cover I, then it won&#39;t be shared by it.</span></div>
<div class="line"><a name="l05173"></a><span class="lineno"> 5173</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">is_contained</a>(MatchedAddrModeInsts, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l05174"></a><span class="lineno"> 5174</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05175"></a><span class="lineno"> 5175</span>&#160; </div>
<div class="line"><a name="l05176"></a><span class="lineno"> 5176</span>&#160;    MatchedAddrModeInsts.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div>
<div class="line"><a name="l05177"></a><span class="lineno"> 5177</span>&#160;  }</div>
<div class="line"><a name="l05178"></a><span class="lineno"> 5178</span>&#160; </div>
<div class="line"><a name="l05179"></a><span class="lineno"> 5179</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05180"></a><span class="lineno"> 5180</span>&#160;}</div>
<div class="line"><a name="l05181"></a><span class="lineno"> 5181</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l05182"></a><span class="lineno"> 5182</span>&#160;<span class="comment">/// Return true if the specified values are defined in a</span></div>
<div class="line"><a name="l05183"></a><span class="lineno"> 5183</span>&#160;<span class="comment">/// different basic block than BB.</span></div>
<div class="line"><a name="l05184"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#ad897d4beb50aa8f0d4d2eaa08ac0987d"> 5184</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CodeGenPrepare_8cpp.html#ad897d4beb50aa8f0d4d2eaa08ac0987d">IsNonLocalValue</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l05185"></a><span class="lineno"> 5185</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V))</div>
<div class="line"><a name="l05186"></a><span class="lineno"> 5186</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>;</div>
<div class="line"><a name="l05187"></a><span class="lineno"> 5187</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05188"></a><span class="lineno"> 5188</span>&#160;}</div>
<div class="line"><a name="l05189"></a><span class="lineno"> 5189</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l05190"></a><span class="lineno"> 5190</span>&#160;<span class="comment">/// Sink addressing mode computation immediate before MemoryInst if doing so</span></div>
<div class="line"><a name="l05191"></a><span class="lineno"> 5191</span>&#160;<span class="comment">/// can be done without increasing register pressure.  The need for the</span></div>
<div class="line"><a name="l05192"></a><span class="lineno"> 5192</span>&#160;<span class="comment">/// register pressure constraint means this can end up being an all or nothing</span></div>
<div class="line"><a name="l05193"></a><span class="lineno"> 5193</span>&#160;<span class="comment">/// decision for all uses of the same addressing computation.</span></div>
<div class="line"><a name="l05194"></a><span class="lineno"> 5194</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l05195"></a><span class="lineno"> 5195</span>&#160;<span class="comment">/// Load and Store Instructions often have addressing modes that can do</span></div>
<div class="line"><a name="l05196"></a><span class="lineno"> 5196</span>&#160;<span class="comment">/// significant amounts of computation. As such, instruction selection will try</span></div>
<div class="line"><a name="l05197"></a><span class="lineno"> 5197</span>&#160;<span class="comment">/// to get the load or store to do as much computation as possible for the</span></div>
<div class="line"><a name="l05198"></a><span class="lineno"> 5198</span>&#160;<span class="comment">/// program. The problem is that isel can only see within a single block. As</span></div>
<div class="line"><a name="l05199"></a><span class="lineno"> 5199</span>&#160;<span class="comment">/// such, we sink as much legal addressing mode work into the block as possible.</span></div>
<div class="line"><a name="l05200"></a><span class="lineno"> 5200</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l05201"></a><span class="lineno"> 5201</span>&#160;<span class="comment">/// This method is used to optimize both load/store and inline asms with memory</span></div>
<div class="line"><a name="l05202"></a><span class="lineno"> 5202</span>&#160;<span class="comment">/// operands.  It&#39;s also used to sink addressing computations feeding into cold</span></div>
<div class="line"><a name="l05203"></a><span class="lineno"> 5203</span>&#160;<span class="comment">/// call sites into their (cold) basic block.</span></div>
<div class="line"><a name="l05204"></a><span class="lineno"> 5204</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l05205"></a><span class="lineno"> 5205</span>&#160;<span class="comment">/// The motivation for handling sinking into cold blocks is that doing so can</span></div>
<div class="line"><a name="l05206"></a><span class="lineno"> 5206</span>&#160;<span class="comment">/// both enable other address mode sinking (by satisfying the register pressure</span></div>
<div class="line"><a name="l05207"></a><span class="lineno"> 5207</span>&#160;<span class="comment">/// constraint above), and reduce register pressure globally (by removing the</span></div>
<div class="line"><a name="l05208"></a><span class="lineno"> 5208</span>&#160;<span class="comment">/// addressing mode computation from the fast path entirely.).</span></div>
<div class="line"><a name="l05209"></a><span class="lineno"> 5209</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CodeGenPrepare::optimizeMemoryInst(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *MemoryInst, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>,</div>
<div class="line"><a name="l05210"></a><span class="lineno"> 5210</span>&#160;                                        <a class="code" href="classllvm_1_1Type.html">Type</a> *AccessTy, <span class="keywordtype">unsigned</span> AddrSpace) {</div>
<div class="line"><a name="l05211"></a><span class="lineno"> 5211</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Repl = <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>;</div>
<div class="line"><a name="l05212"></a><span class="lineno"> 5212</span>&#160; </div>
<div class="line"><a name="l05213"></a><span class="lineno"> 5213</span>&#160;  <span class="comment">// Try to collapse single-value PHI nodes.  This is necessary to undo</span></div>
<div class="line"><a name="l05214"></a><span class="lineno"> 5214</span>&#160;  <span class="comment">// unprofitable PRE transformations.</span></div>
<div class="line"><a name="l05215"></a><span class="lineno"> 5215</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 8&gt;</a> worklist;</div>
<div class="line"><a name="l05216"></a><span class="lineno"> 5216</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value *, 16&gt;</a> Visited;</div>
<div class="line"><a name="l05217"></a><span class="lineno"> 5217</span>&#160;  worklist.push_back(<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>);</div>
<div class="line"><a name="l05218"></a><span class="lineno"> 5218</span>&#160; </div>
<div class="line"><a name="l05219"></a><span class="lineno"> 5219</span>&#160;  <span class="comment">// Use a worklist to iteratively look through PHI and select nodes, and</span></div>
<div class="line"><a name="l05220"></a><span class="lineno"> 5220</span>&#160;  <span class="comment">// ensure that the addressing mode obtained from the non-PHI/select roots of</span></div>
<div class="line"><a name="l05221"></a><span class="lineno"> 5221</span>&#160;  <span class="comment">// the graph are compatible.</span></div>
<div class="line"><a name="l05222"></a><span class="lineno"> 5222</span>&#160;  <span class="keywordtype">bool</span> PhiOrSelectSeen = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05223"></a><span class="lineno"> 5223</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 16&gt;</a> AddrModeInsts;</div>
<div class="line"><a name="l05224"></a><span class="lineno"> 5224</span>&#160;  <span class="keyword">const</span> <a class="code" href="structllvm_1_1SimplifyQuery.html">SimplifyQuery</a> SQ(*<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, TLInfo);</div>
<div class="line"><a name="l05225"></a><span class="lineno"> 5225</span>&#160;  AddressingModeCombiner AddrModes(SQ, <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>);</div>
<div class="line"><a name="l05226"></a><span class="lineno"> 5226</span>&#160;  TypePromotionTransaction TPT(RemovedInsts);</div>
<div class="line"><a name="l05227"></a><span class="lineno"> 5227</span>&#160;  TypePromotionTransaction::ConstRestorationPt LastKnownGood =</div>
<div class="line"><a name="l05228"></a><span class="lineno"> 5228</span>&#160;      TPT.getRestorationPoint();</div>
<div class="line"><a name="l05229"></a><span class="lineno"> 5229</span>&#160;  <span class="keywordflow">while</span> (!worklist.empty()) {</div>
<div class="line"><a name="l05230"></a><span class="lineno"> 5230</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V = worklist.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a0c8ffe664a36e30d49c84d0aded2fe08">pop_back_val</a>();</div>
<div class="line"><a name="l05231"></a><span class="lineno"> 5231</span>&#160; </div>
<div class="line"><a name="l05232"></a><span class="lineno"> 5232</span>&#160;    <span class="comment">// We allow traversing cyclic Phi nodes.</span></div>
<div class="line"><a name="l05233"></a><span class="lineno"> 5233</span>&#160;    <span class="comment">// In case of success after this loop we ensure that traversing through</span></div>
<div class="line"><a name="l05234"></a><span class="lineno"> 5234</span>&#160;    <span class="comment">// Phi nodes ends up with all cases to compute address of the form</span></div>
<div class="line"><a name="l05235"></a><span class="lineno"> 5235</span>&#160;    <span class="comment">//    BaseGV + Base + Scale * Index + Offset</span></div>
<div class="line"><a name="l05236"></a><span class="lineno"> 5236</span>&#160;    <span class="comment">// where Scale and Offset are constans and BaseGV, Base and Index</span></div>
<div class="line"><a name="l05237"></a><span class="lineno"> 5237</span>&#160;    <span class="comment">// are exactly the same Values in all cases.</span></div>
<div class="line"><a name="l05238"></a><span class="lineno"> 5238</span>&#160;    <span class="comment">// It means that BaseGV, Scale and Offset dominate our memory instruction</span></div>
<div class="line"><a name="l05239"></a><span class="lineno"> 5239</span>&#160;    <span class="comment">// and have the same value as they had in address computation represented</span></div>
<div class="line"><a name="l05240"></a><span class="lineno"> 5240</span>&#160;    <span class="comment">// as Phi. So we can safely sink address computation to memory instruction.</span></div>
<div class="line"><a name="l05241"></a><span class="lineno"> 5241</span>&#160;    <span class="keywordflow">if</span> (!Visited.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(V).second)</div>
<div class="line"><a name="l05242"></a><span class="lineno"> 5242</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05243"></a><span class="lineno"> 5243</span>&#160; </div>
<div class="line"><a name="l05244"></a><span class="lineno"> 5244</span>&#160;    <span class="comment">// For a PHI node, push all of its incoming values.</span></div>
<div class="line"><a name="l05245"></a><span class="lineno"> 5245</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> = dyn_cast&lt;PHINode&gt;(V)) {</div>
<div class="line"><a name="l05246"></a><span class="lineno"> 5246</span>&#160;      <a class="code" href="namespacellvm.html#a39d3d23a084c4544ee5903203db10e8a">append_range</a>(worklist, <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>-&gt;incoming_values());</div>
<div class="line"><a name="l05247"></a><span class="lineno"> 5247</span>&#160;      PhiOrSelectSeen = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05248"></a><span class="lineno"> 5248</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05249"></a><span class="lineno"> 5249</span>&#160;    }</div>
<div class="line"><a name="l05250"></a><span class="lineno"> 5250</span>&#160;    <span class="comment">// Similar for select.</span></div>
<div class="line"><a name="l05251"></a><span class="lineno"> 5251</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;SelectInst&gt;(V)) {</div>
<div class="line"><a name="l05252"></a><span class="lineno"> 5252</span>&#160;      worklist.push_back(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getFalseValue());</div>
<div class="line"><a name="l05253"></a><span class="lineno"> 5253</span>&#160;      worklist.push_back(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getTrueValue());</div>
<div class="line"><a name="l05254"></a><span class="lineno"> 5254</span>&#160;      PhiOrSelectSeen = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05255"></a><span class="lineno"> 5255</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05256"></a><span class="lineno"> 5256</span>&#160;    }</div>
<div class="line"><a name="l05257"></a><span class="lineno"> 5257</span>&#160; </div>
<div class="line"><a name="l05258"></a><span class="lineno"> 5258</span>&#160;    <span class="comment">// For non-PHIs, determine the addressing mode being computed.  Note that</span></div>
<div class="line"><a name="l05259"></a><span class="lineno"> 5259</span>&#160;    <span class="comment">// the result may differ depending on what other uses our candidate</span></div>
<div class="line"><a name="l05260"></a><span class="lineno"> 5260</span>&#160;    <span class="comment">// addressing instructions might have.</span></div>
<div class="line"><a name="l05261"></a><span class="lineno"> 5261</span>&#160;    AddrModeInsts.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div>
<div class="line"><a name="l05262"></a><span class="lineno"> 5262</span>&#160;    std::pair&lt;AssertingVH&lt;GetElementPtrInst&gt;, int64_t&gt; LargeOffsetGEP(<span class="keyword">nullptr</span>,</div>
<div class="line"><a name="l05263"></a><span class="lineno"> 5263</span>&#160;                                                                      0);</div>
<div class="line"><a name="l05264"></a><span class="lineno"> 5264</span>&#160;    <span class="comment">// Defer the query (and possible computation of) the dom tree to point of</span></div>
<div class="line"><a name="l05265"></a><span class="lineno"> 5265</span>&#160;    <span class="comment">// actual use.  It&#39;s expected that most address matches don&#39;t actually need</span></div>
<div class="line"><a name="l05266"></a><span class="lineno"> 5266</span>&#160;    <span class="comment">// the domtree.</span></div>
<div class="line"><a name="l05267"></a><span class="lineno"> 5267</span>&#160;    <span class="keyword">auto</span> getDTFn = [MemoryInst, <span class="keyword">this</span>]() -&gt; <span class="keyword">const</span> <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp; {</div>
<div class="line"><a name="l05268"></a><span class="lineno"> 5268</span>&#160;      <a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = MemoryInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a38bee869ad41aebfef3de2641b12004c">getParent</a>();</div>
<div class="line"><a name="l05269"></a><span class="lineno"> 5269</span>&#160;      <span class="keywordflow">return</span> this-&gt;getDT(*<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l05270"></a><span class="lineno"> 5270</span>&#160;    };</div>
<div class="line"><a name="l05271"></a><span class="lineno"> 5271</span>&#160;    <a class="code" href="structllvm_1_1ExtAddrMode.html">ExtAddrMode</a> NewAddrMode = AddressingModeMatcher::Match(</div>
<div class="line"><a name="l05272"></a><span class="lineno"> 5272</span>&#160;        V, AccessTy, AddrSpace, MemoryInst, AddrModeInsts, *TLI, *LI, getDTFn,</div>
<div class="line"><a name="l05273"></a><span class="lineno"> 5273</span>&#160;        *<a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, InsertedInsts, PromotedInsts, TPT, LargeOffsetGEP, OptSize, PSI,</div>
<div class="line"><a name="l05274"></a><span class="lineno"> 5274</span>&#160;        <a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>.get());</div>
<div class="line"><a name="l05275"></a><span class="lineno"> 5275</span>&#160; </div>
<div class="line"><a name="l05276"></a><span class="lineno"> 5276</span>&#160;    <a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = LargeOffsetGEP.first;</div>
<div class="line"><a name="l05277"></a><span class="lineno"> 5277</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a> &amp;&amp; !NewGEPBases.<a class="code" href="classllvm_1_1SmallSet.html#a2a98f19750ba941ce791b75ca6d77e48">count</a>(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>)) {</div>
<div class="line"><a name="l05278"></a><span class="lineno"> 5278</span>&#160;      <span class="comment">// If splitting the underlying data structure can reduce the offset of a</span></div>
<div class="line"><a name="l05279"></a><span class="lineno"> 5279</span>&#160;      <span class="comment">// GEP, collect the GEP.  Skip the GEPs that are the new bases of</span></div>
<div class="line"><a name="l05280"></a><span class="lineno"> 5280</span>&#160;      <span class="comment">// previously split data structures.</span></div>
<div class="line"><a name="l05281"></a><span class="lineno"> 5281</span>&#160;      LargeOffsetGEPMap[<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getPointerOperand()].push_back(LargeOffsetGEP);</div>
<div class="line"><a name="l05282"></a><span class="lineno"> 5282</span>&#160;      LargeOffsetGEPID.<a class="code" href="classllvm_1_1DenseMapBase.html#a99f811d53704275b4158c62a2dd138d9">insert</a>(std::make_pair(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, LargeOffsetGEPID.<a class="code" href="classllvm_1_1DenseMapBase.html#a3d95cc2d359b8d9ed5bd9504b44930b5">size</a>()));</div>
<div class="line"><a name="l05283"></a><span class="lineno"> 5283</span>&#160;    }</div>
<div class="line"><a name="l05284"></a><span class="lineno"> 5284</span>&#160; </div>
<div class="line"><a name="l05285"></a><span class="lineno"> 5285</span>&#160;    NewAddrMode.OriginalValue = V;</div>
<div class="line"><a name="l05286"></a><span class="lineno"> 5286</span>&#160;    <span class="keywordflow">if</span> (!AddrModes.addNewAddrMode(NewAddrMode))</div>
<div class="line"><a name="l05287"></a><span class="lineno"> 5287</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l05288"></a><span class="lineno"> 5288</span>&#160;  }</div>
<div class="line"><a name="l05289"></a><span class="lineno"> 5289</span>&#160; </div>
<div class="line"><a name="l05290"></a><span class="lineno"> 5290</span>&#160;  <span class="comment">// Try to combine the AddrModes we&#39;ve collected. If we couldn&#39;t collect any,</span></div>
<div class="line"><a name="l05291"></a><span class="lineno"> 5291</span>&#160;  <span class="comment">// or we have multiple but either couldn&#39;t combine them or combining them</span></div>
<div class="line"><a name="l05292"></a><span class="lineno"> 5292</span>&#160;  <span class="comment">// wouldn&#39;t do anything useful, bail out now.</span></div>
<div class="line"><a name="l05293"></a><span class="lineno"> 5293</span>&#160;  <span class="keywordflow">if</span> (!AddrModes.combineAddrModes()) {</div>
<div class="line"><a name="l05294"></a><span class="lineno"> 5294</span>&#160;    TPT.rollback(LastKnownGood);</div>
<div class="line"><a name="l05295"></a><span class="lineno"> 5295</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05296"></a><span class="lineno"> 5296</span>&#160;  }</div>
<div class="line"><a name="l05297"></a><span class="lineno"> 5297</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = TPT.commit();</div>
<div class="line"><a name="l05298"></a><span class="lineno"> 5298</span>&#160; </div>
<div class="line"><a name="l05299"></a><span class="lineno"> 5299</span>&#160;  <span class="comment">// Get the combined AddrMode (or the only AddrMode, if we only had one).</span></div>
<div class="line"><a name="l05300"></a><span class="lineno"> 5300</span>&#160;  <a class="code" href="structllvm_1_1ExtAddrMode.html">ExtAddrMode</a> <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a> = AddrModes.getAddrMode();</div>
<div class="line"><a name="l05301"></a><span class="lineno"> 5301</span>&#160; </div>
<div class="line"><a name="l05302"></a><span class="lineno"> 5302</span>&#160;  <span class="comment">// If all the instructions matched are already in this BB, don&#39;t do anything.</span></div>
<div class="line"><a name="l05303"></a><span class="lineno"> 5303</span>&#160;  <span class="comment">// If we saw a Phi node then it is not local definitely, and if we saw a</span></div>
<div class="line"><a name="l05304"></a><span class="lineno"> 5304</span>&#160;  <span class="comment">// select then we want to push the address calculation past it even if it&#39;s</span></div>
<div class="line"><a name="l05305"></a><span class="lineno"> 5305</span>&#160;  <span class="comment">// already in this BB.</span></div>
<div class="line"><a name="l05306"></a><span class="lineno"> 5306</span>&#160;  <span class="keywordflow">if</span> (!PhiOrSelectSeen &amp;&amp; <a class="code" href="namespacellvm.html#a7dc3069afa2ce5ea62ac2eb183e51c00">none_of</a>(AddrModeInsts, [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l05307"></a><span class="lineno"> 5307</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="CodeGenPrepare_8cpp.html#ad897d4beb50aa8f0d4d2eaa08ac0987d">IsNonLocalValue</a>(V, MemoryInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>());</div>
<div class="line"><a name="l05308"></a><span class="lineno"> 5308</span>&#160;      })) {</div>
<div class="line"><a name="l05309"></a><span class="lineno"> 5309</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;CGP: Found      local addrmode: &quot;</span> &lt;&lt; <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a></div>
<div class="line"><a name="l05310"></a><span class="lineno"> 5310</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l05311"></a><span class="lineno"> 5311</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</div>
<div class="line"><a name="l05312"></a><span class="lineno"> 5312</span>&#160;  }</div>
<div class="line"><a name="l05313"></a><span class="lineno"> 5313</span>&#160; </div>
<div class="line"><a name="l05314"></a><span class="lineno"> 5314</span>&#160;  <span class="comment">// Insert this computation right after this user.  Since our caller is</span></div>
<div class="line"><a name="l05315"></a><span class="lineno"> 5315</span>&#160;  <span class="comment">// scanning from the top of the BB to the bottom, reuse of the expr are</span></div>
<div class="line"><a name="l05316"></a><span class="lineno"> 5316</span>&#160;  <span class="comment">// guaranteed to happen later.</span></div>
<div class="line"><a name="l05317"></a><span class="lineno"> 5317</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(MemoryInst);</div>
<div class="line"><a name="l05318"></a><span class="lineno"> 5318</span>&#160; </div>
<div class="line"><a name="l05319"></a><span class="lineno"> 5319</span>&#160;  <span class="comment">// Now that we determined the addressing expression we want to use and know</span></div>
<div class="line"><a name="l05320"></a><span class="lineno"> 5320</span>&#160;  <span class="comment">// that we have to sink it into this block.  Check to see if we have already</span></div>
<div class="line"><a name="l05321"></a><span class="lineno"> 5321</span>&#160;  <span class="comment">// done this for some other load/store instr in this block.  If so, reuse</span></div>
<div class="line"><a name="l05322"></a><span class="lineno"> 5322</span>&#160;  <span class="comment">// the computation.  Before attempting reuse, check if the address is valid</span></div>
<div class="line"><a name="l05323"></a><span class="lineno"> 5323</span>&#160;  <span class="comment">// as it may have been erased.</span></div>
<div class="line"><a name="l05324"></a><span class="lineno"> 5324</span>&#160; </div>
<div class="line"><a name="l05325"></a><span class="lineno"> 5325</span>&#160;  <a class="code" href="classllvm_1_1WeakTrackingVH.html">WeakTrackingVH</a> SunkAddrVH = SunkAddrs[<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>];</div>
<div class="line"><a name="l05326"></a><span class="lineno"> 5326</span>&#160; </div>
<div class="line"><a name="l05327"></a><span class="lineno"> 5327</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *SunkAddr = SunkAddrVH.<a class="code" href="classllvm_1_1WeakTrackingVH.html#aed2f94ba7ecd4983f2c811f0d01f1398">pointsToAliveValue</a>() ? SunkAddrVH : <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05328"></a><span class="lineno"> 5328</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *IntPtrTy = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getIntPtrType(<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>-&gt;getType());</div>
<div class="line"><a name="l05329"></a><span class="lineno"> 5329</span>&#160;  <span class="keywordflow">if</span> (SunkAddr) {</div>
<div class="line"><a name="l05330"></a><span class="lineno"> 5330</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;CGP: Reusing nonlocal addrmode: &quot;</span> &lt;&lt; <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a></div>
<div class="line"><a name="l05331"></a><span class="lineno"> 5331</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot; for &quot;</span> &lt;&lt; *MemoryInst &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l05332"></a><span class="lineno"> 5332</span>&#160;    <span class="keywordflow">if</span> (SunkAddr-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() != <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>-&gt;getType()) {</div>
<div class="line"><a name="l05333"></a><span class="lineno"> 5333</span>&#160;      <span class="keywordflow">if</span> (SunkAddr-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>() !=</div>
<div class="line"><a name="l05334"></a><span class="lineno"> 5334</span>&#160;              <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>-&gt;getType()-&gt;getPointerAddressSpace() &amp;&amp;</div>
<div class="line"><a name="l05335"></a><span class="lineno"> 5335</span>&#160;          !<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;isNonIntegralPointerType(<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>-&gt;getType())) {</div>
<div class="line"><a name="l05336"></a><span class="lineno"> 5336</span>&#160;        <span class="comment">// There are two reasons the address spaces might not match: a no-op</span></div>
<div class="line"><a name="l05337"></a><span class="lineno"> 5337</span>&#160;        <span class="comment">// addrspacecast, or a ptrtoint/inttoptr pair. Either way, we emit a</span></div>
<div class="line"><a name="l05338"></a><span class="lineno"> 5338</span>&#160;        <span class="comment">// ptrtoint/inttoptr pair to ensure we match the original semantics.</span></div>
<div class="line"><a name="l05339"></a><span class="lineno"> 5339</span>&#160;        <span class="comment">// TODO: allow bitcast between different address space pointers with the</span></div>
<div class="line"><a name="l05340"></a><span class="lineno"> 5340</span>&#160;        <span class="comment">// same size.</span></div>
<div class="line"><a name="l05341"></a><span class="lineno"> 5341</span>&#160;        SunkAddr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePtrToInt(SunkAddr, IntPtrTy, <span class="stringliteral">&quot;sunkaddr&quot;</span>);</div>
<div class="line"><a name="l05342"></a><span class="lineno"> 5342</span>&#160;        SunkAddr =</div>
<div class="line"><a name="l05343"></a><span class="lineno"> 5343</span>&#160;            <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntToPtr(SunkAddr, <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>-&gt;getType(), <span class="stringliteral">&quot;sunkaddr&quot;</span>);</div>
<div class="line"><a name="l05344"></a><span class="lineno"> 5344</span>&#160;      } <span class="keywordflow">else</span></div>
<div class="line"><a name="l05345"></a><span class="lineno"> 5345</span>&#160;        SunkAddr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePointerCast(SunkAddr, <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>-&gt;getType());</div>
<div class="line"><a name="l05346"></a><span class="lineno"> 5346</span>&#160;    }</div>
<div class="line"><a name="l05347"></a><span class="lineno"> 5347</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="CodeGenPrepare_8cpp.html#a715438acc8712570460df3f9458dbaad">AddrSinkUsingGEPs</a> || (!<a class="code" href="CodeGenPrepare_8cpp.html#a715438acc8712570460df3f9458dbaad">AddrSinkUsingGEPs</a>.<a class="code" href="classllvm_1_1cl_1_1Option.html#a2dc75fafb68e7669e776e19da7857cdf">getNumOccurrences</a>() &amp;&amp;</div>
<div class="line"><a name="l05348"></a><span class="lineno"> 5348</span>&#160;                                   SubtargetInfo-&gt;addrSinkUsingGEPs())) {</div>
<div class="line"><a name="l05349"></a><span class="lineno"> 5349</span>&#160;    <span class="comment">// By default, we use the GEP-based method when AA is used later. This</span></div>
<div class="line"><a name="l05350"></a><span class="lineno"> 5350</span>&#160;    <span class="comment">// prevents new inttoptr/ptrtoint pairs from degrading AA capabilities.</span></div>
<div class="line"><a name="l05351"></a><span class="lineno"> 5351</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;CGP: SINKING nonlocal addrmode: &quot;</span> &lt;&lt; <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a></div>
<div class="line"><a name="l05352"></a><span class="lineno"> 5352</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot; for &quot;</span> &lt;&lt; *MemoryInst &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l05353"></a><span class="lineno"> 5353</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *ResultPtr = <span class="keyword">nullptr</span>, *ResultIndex = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05354"></a><span class="lineno"> 5354</span>&#160; </div>
<div class="line"><a name="l05355"></a><span class="lineno"> 5355</span>&#160;    <span class="comment">// First, find the pointer.</span></div>
<div class="line"><a name="l05356"></a><span class="lineno"> 5356</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg &amp;&amp; <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg-&gt;getType()-&gt;isPointerTy()) {</div>
<div class="line"><a name="l05357"></a><span class="lineno"> 5357</span>&#160;      ResultPtr = <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg;</div>
<div class="line"><a name="l05358"></a><span class="lineno"> 5358</span>&#160;      <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05359"></a><span class="lineno"> 5359</span>&#160;    }</div>
<div class="line"><a name="l05360"></a><span class="lineno"> 5360</span>&#160; </div>
<div class="line"><a name="l05361"></a><span class="lineno"> 5361</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale &amp;&amp; <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.ScaledReg-&gt;getType()-&gt;isPointerTy()) {</div>
<div class="line"><a name="l05362"></a><span class="lineno"> 5362</span>&#160;      <span class="comment">// We can&#39;t add more than one pointer together, nor can we scale a</span></div>
<div class="line"><a name="l05363"></a><span class="lineno"> 5363</span>&#160;      <span class="comment">// pointer (both of which seem meaningless).</span></div>
<div class="line"><a name="l05364"></a><span class="lineno"> 5364</span>&#160;      <span class="keywordflow">if</span> (ResultPtr || <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale != 1)</div>
<div class="line"><a name="l05365"></a><span class="lineno"> 5365</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</div>
<div class="line"><a name="l05366"></a><span class="lineno"> 5366</span>&#160; </div>
<div class="line"><a name="l05367"></a><span class="lineno"> 5367</span>&#160;      ResultPtr = <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.ScaledReg;</div>
<div class="line"><a name="l05368"></a><span class="lineno"> 5368</span>&#160;      <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale = 0;</div>
<div class="line"><a name="l05369"></a><span class="lineno"> 5369</span>&#160;    }</div>
<div class="line"><a name="l05370"></a><span class="lineno"> 5370</span>&#160; </div>
<div class="line"><a name="l05371"></a><span class="lineno"> 5371</span>&#160;    <span class="comment">// It is only safe to sign extend the BaseReg if we know that the math</span></div>
<div class="line"><a name="l05372"></a><span class="lineno"> 5372</span>&#160;    <span class="comment">// required to create it did not overflow before we extend it. Since</span></div>
<div class="line"><a name="l05373"></a><span class="lineno"> 5373</span>&#160;    <span class="comment">// the original IR value was tossed in favor of a constant back when</span></div>
<div class="line"><a name="l05374"></a><span class="lineno"> 5374</span>&#160;    <span class="comment">// the AddrMode was created we need to bail out gracefully if widths</span></div>
<div class="line"><a name="l05375"></a><span class="lineno"> 5375</span>&#160;    <span class="comment">// do not match instead of extending it.</span></div>
<div class="line"><a name="l05376"></a><span class="lineno"> 5376</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l05377"></a><span class="lineno"> 5377</span>&#160;    <span class="comment">// (See below for code to add the scale.)</span></div>
<div class="line"><a name="l05378"></a><span class="lineno"> 5378</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale) {</div>
<div class="line"><a name="l05379"></a><span class="lineno"> 5379</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *ScaledRegTy = <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.ScaledReg-&gt;getType();</div>
<div class="line"><a name="l05380"></a><span class="lineno"> 5380</span>&#160;      <span class="keywordflow">if</span> (cast&lt;IntegerType&gt;(IntPtrTy)-&gt;<a class="code" href="ValueTracking_8cpp.html#a2cb59ea8f9e8543986d40c48acfd24a3">getBitWidth</a>() &gt;</div>
<div class="line"><a name="l05381"></a><span class="lineno"> 5381</span>&#160;          cast&lt;IntegerType&gt;(ScaledRegTy)-&gt;<a class="code" href="ValueTracking_8cpp.html#a2cb59ea8f9e8543986d40c48acfd24a3">getBitWidth</a>())</div>
<div class="line"><a name="l05382"></a><span class="lineno"> 5382</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</div>
<div class="line"><a name="l05383"></a><span class="lineno"> 5383</span>&#160;    }</div>
<div class="line"><a name="l05384"></a><span class="lineno"> 5384</span>&#160; </div>
<div class="line"><a name="l05385"></a><span class="lineno"> 5385</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseGV) {</div>
<div class="line"><a name="l05386"></a><span class="lineno"> 5386</span>&#160;      <span class="keywordflow">if</span> (ResultPtr)</div>
<div class="line"><a name="l05387"></a><span class="lineno"> 5387</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</div>
<div class="line"><a name="l05388"></a><span class="lineno"> 5388</span>&#160; </div>
<div class="line"><a name="l05389"></a><span class="lineno"> 5389</span>&#160;      ResultPtr = <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseGV;</div>
<div class="line"><a name="l05390"></a><span class="lineno"> 5390</span>&#160;    }</div>
<div class="line"><a name="l05391"></a><span class="lineno"> 5391</span>&#160; </div>
<div class="line"><a name="l05392"></a><span class="lineno"> 5392</span>&#160;    <span class="comment">// If the real base value actually came from an inttoptr, then the matcher</span></div>
<div class="line"><a name="l05393"></a><span class="lineno"> 5393</span>&#160;    <span class="comment">// will look through it and provide only the integer value. In that case,</span></div>
<div class="line"><a name="l05394"></a><span class="lineno"> 5394</span>&#160;    <span class="comment">// use it here.</span></div>
<div class="line"><a name="l05395"></a><span class="lineno"> 5395</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;isNonIntegralPointerType(<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>-&gt;getType())) {</div>
<div class="line"><a name="l05396"></a><span class="lineno"> 5396</span>&#160;      <span class="keywordflow">if</span> (!ResultPtr &amp;&amp; <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg) {</div>
<div class="line"><a name="l05397"></a><span class="lineno"> 5397</span>&#160;        ResultPtr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntToPtr(<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg, <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>-&gt;getType(),</div>
<div class="line"><a name="l05398"></a><span class="lineno"> 5398</span>&#160;                                           <span class="stringliteral">&quot;sunkaddr&quot;</span>);</div>
<div class="line"><a name="l05399"></a><span class="lineno"> 5399</span>&#160;        <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05400"></a><span class="lineno"> 5400</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!ResultPtr &amp;&amp; <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale == 1) {</div>
<div class="line"><a name="l05401"></a><span class="lineno"> 5401</span>&#160;        ResultPtr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntToPtr(<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.ScaledReg, <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>-&gt;getType(),</div>
<div class="line"><a name="l05402"></a><span class="lineno"> 5402</span>&#160;                                           <span class="stringliteral">&quot;sunkaddr&quot;</span>);</div>
<div class="line"><a name="l05403"></a><span class="lineno"> 5403</span>&#160;        <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale = 0;</div>
<div class="line"><a name="l05404"></a><span class="lineno"> 5404</span>&#160;      }</div>
<div class="line"><a name="l05405"></a><span class="lineno"> 5405</span>&#160;    }</div>
<div class="line"><a name="l05406"></a><span class="lineno"> 5406</span>&#160; </div>
<div class="line"><a name="l05407"></a><span class="lineno"> 5407</span>&#160;    <span class="keywordflow">if</span> (!ResultPtr &amp;&amp; !<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg &amp;&amp; !<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale &amp;&amp;</div>
<div class="line"><a name="l05408"></a><span class="lineno"> 5408</span>&#160;        !<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseOffs) {</div>
<div class="line"><a name="l05409"></a><span class="lineno"> 5409</span>&#160;      SunkAddr = Constant::getNullValue(<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>-&gt;getType());</div>
<div class="line"><a name="l05410"></a><span class="lineno"> 5410</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!ResultPtr) {</div>
<div class="line"><a name="l05411"></a><span class="lineno"> 5411</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</div>
<div class="line"><a name="l05412"></a><span class="lineno"> 5412</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05413"></a><span class="lineno"> 5413</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *I8PtrTy =</div>
<div class="line"><a name="l05414"></a><span class="lineno"> 5414</span>&#160;          <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt8PtrTy(<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>-&gt;getType()-&gt;getPointerAddressSpace());</div>
<div class="line"><a name="l05415"></a><span class="lineno"> 5415</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *I8Ty = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt8Ty();</div>
<div class="line"><a name="l05416"></a><span class="lineno"> 5416</span>&#160; </div>
<div class="line"><a name="l05417"></a><span class="lineno"> 5417</span>&#160;      <span class="comment">// Start with the base register. Do this first so that subsequent address</span></div>
<div class="line"><a name="l05418"></a><span class="lineno"> 5418</span>&#160;      <span class="comment">// matching finds it last, which will prevent it from trying to match it</span></div>
<div class="line"><a name="l05419"></a><span class="lineno"> 5419</span>&#160;      <span class="comment">// as the scaled value in case it happens to be a mul. That would be</span></div>
<div class="line"><a name="l05420"></a><span class="lineno"> 5420</span>&#160;      <span class="comment">// problematic if we&#39;ve sunk a different mul for the scale, because then</span></div>
<div class="line"><a name="l05421"></a><span class="lineno"> 5421</span>&#160;      <span class="comment">// we&#39;d end up sinking both muls.</span></div>
<div class="line"><a name="l05422"></a><span class="lineno"> 5422</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg) {</div>
<div class="line"><a name="l05423"></a><span class="lineno"> 5423</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg;</div>
<div class="line"><a name="l05424"></a><span class="lineno"> 5424</span>&#160;        <span class="keywordflow">if</span> (V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() != IntPtrTy)</div>
<div class="line"><a name="l05425"></a><span class="lineno"> 5425</span>&#160;          V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntCast(V, IntPtrTy, <span class="comment">/*isSigned=*/</span><span class="keyword">true</span>, <span class="stringliteral">&quot;sunkaddr&quot;</span>);</div>
<div class="line"><a name="l05426"></a><span class="lineno"> 5426</span>&#160; </div>
<div class="line"><a name="l05427"></a><span class="lineno"> 5427</span>&#160;        ResultIndex = V;</div>
<div class="line"><a name="l05428"></a><span class="lineno"> 5428</span>&#160;      }</div>
<div class="line"><a name="l05429"></a><span class="lineno"> 5429</span>&#160; </div>
<div class="line"><a name="l05430"></a><span class="lineno"> 5430</span>&#160;      <span class="comment">// Add the scale value.</span></div>
<div class="line"><a name="l05431"></a><span class="lineno"> 5431</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale) {</div>
<div class="line"><a name="l05432"></a><span class="lineno"> 5432</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.ScaledReg;</div>
<div class="line"><a name="l05433"></a><span class="lineno"> 5433</span>&#160;        <span class="keywordflow">if</span> (V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() == IntPtrTy) {</div>
<div class="line"><a name="l05434"></a><span class="lineno"> 5434</span>&#160;          <span class="comment">// done.</span></div>
<div class="line"><a name="l05435"></a><span class="lineno"> 5435</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05436"></a><span class="lineno"> 5436</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(cast&lt;IntegerType&gt;(IntPtrTy)-&gt;<a class="code" href="ValueTracking_8cpp.html#a2cb59ea8f9e8543986d40c48acfd24a3">getBitWidth</a>() &lt;</div>
<div class="line"><a name="l05437"></a><span class="lineno"> 5437</span>&#160;                     cast&lt;IntegerType&gt;(V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getBitWidth() &amp;&amp;</div>
<div class="line"><a name="l05438"></a><span class="lineno"> 5438</span>&#160;                 <span class="stringliteral">&quot;We can&#39;t transform if ScaledReg is too narrow&quot;</span>);</div>
<div class="line"><a name="l05439"></a><span class="lineno"> 5439</span>&#160;          V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateTrunc(V, IntPtrTy, <span class="stringliteral">&quot;sunkaddr&quot;</span>);</div>
<div class="line"><a name="l05440"></a><span class="lineno"> 5440</span>&#160;        }</div>
<div class="line"><a name="l05441"></a><span class="lineno"> 5441</span>&#160; </div>
<div class="line"><a name="l05442"></a><span class="lineno"> 5442</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale != 1)</div>
<div class="line"><a name="l05443"></a><span class="lineno"> 5443</span>&#160;          V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateMul(V, <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantInt::get</a>(IntPtrTy, <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale),</div>
<div class="line"><a name="l05444"></a><span class="lineno"> 5444</span>&#160;                                <span class="stringliteral">&quot;sunkaddr&quot;</span>);</div>
<div class="line"><a name="l05445"></a><span class="lineno"> 5445</span>&#160;        <span class="keywordflow">if</span> (ResultIndex)</div>
<div class="line"><a name="l05446"></a><span class="lineno"> 5446</span>&#160;          ResultIndex = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAdd(ResultIndex, V, <span class="stringliteral">&quot;sunkaddr&quot;</span>);</div>
<div class="line"><a name="l05447"></a><span class="lineno"> 5447</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l05448"></a><span class="lineno"> 5448</span>&#160;          ResultIndex = V;</div>
<div class="line"><a name="l05449"></a><span class="lineno"> 5449</span>&#160;      }</div>
<div class="line"><a name="l05450"></a><span class="lineno"> 5450</span>&#160; </div>
<div class="line"><a name="l05451"></a><span class="lineno"> 5451</span>&#160;      <span class="comment">// Add in the Base Offset if present.</span></div>
<div class="line"><a name="l05452"></a><span class="lineno"> 5452</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseOffs) {</div>
<div class="line"><a name="l05453"></a><span class="lineno"> 5453</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantInt::get</a>(IntPtrTy, <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseOffs);</div>
<div class="line"><a name="l05454"></a><span class="lineno"> 5454</span>&#160;        <span class="keywordflow">if</span> (ResultIndex) {</div>
<div class="line"><a name="l05455"></a><span class="lineno"> 5455</span>&#160;          <span class="comment">// We need to add this separately from the scale above to help with</span></div>
<div class="line"><a name="l05456"></a><span class="lineno"> 5456</span>&#160;          <span class="comment">// SDAG consecutive load/store merging.</span></div>
<div class="line"><a name="l05457"></a><span class="lineno"> 5457</span>&#160;          <span class="keywordflow">if</span> (ResultPtr-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() != I8PtrTy)</div>
<div class="line"><a name="l05458"></a><span class="lineno"> 5458</span>&#160;            ResultPtr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePointerCast(ResultPtr, I8PtrTy);</div>
<div class="line"><a name="l05459"></a><span class="lineno"> 5459</span>&#160;          ResultPtr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateGEP(I8Ty, ResultPtr, ResultIndex,</div>
<div class="line"><a name="l05460"></a><span class="lineno"> 5460</span>&#160;                                        <span class="stringliteral">&quot;sunkaddr&quot;</span>, <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.InBounds);</div>
<div class="line"><a name="l05461"></a><span class="lineno"> 5461</span>&#160;        }</div>
<div class="line"><a name="l05462"></a><span class="lineno"> 5462</span>&#160; </div>
<div class="line"><a name="l05463"></a><span class="lineno"> 5463</span>&#160;        ResultIndex = V;</div>
<div class="line"><a name="l05464"></a><span class="lineno"> 5464</span>&#160;      }</div>
<div class="line"><a name="l05465"></a><span class="lineno"> 5465</span>&#160; </div>
<div class="line"><a name="l05466"></a><span class="lineno"> 5466</span>&#160;      <span class="keywordflow">if</span> (!ResultIndex) {</div>
<div class="line"><a name="l05467"></a><span class="lineno"> 5467</span>&#160;        SunkAddr = ResultPtr;</div>
<div class="line"><a name="l05468"></a><span class="lineno"> 5468</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05469"></a><span class="lineno"> 5469</span>&#160;        <span class="keywordflow">if</span> (ResultPtr-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() != I8PtrTy)</div>
<div class="line"><a name="l05470"></a><span class="lineno"> 5470</span>&#160;          ResultPtr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePointerCast(ResultPtr, I8PtrTy);</div>
<div class="line"><a name="l05471"></a><span class="lineno"> 5471</span>&#160;        SunkAddr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateGEP(I8Ty, ResultPtr, ResultIndex, <span class="stringliteral">&quot;sunkaddr&quot;</span>,</div>
<div class="line"><a name="l05472"></a><span class="lineno"> 5472</span>&#160;                                     <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.InBounds);</div>
<div class="line"><a name="l05473"></a><span class="lineno"> 5473</span>&#160;      }</div>
<div class="line"><a name="l05474"></a><span class="lineno"> 5474</span>&#160; </div>
<div class="line"><a name="l05475"></a><span class="lineno"> 5475</span>&#160;      <span class="keywordflow">if</span> (SunkAddr-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() != <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>-&gt;getType()) {</div>
<div class="line"><a name="l05476"></a><span class="lineno"> 5476</span>&#160;        <span class="keywordflow">if</span> (SunkAddr-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>() !=</div>
<div class="line"><a name="l05477"></a><span class="lineno"> 5477</span>&#160;                <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>-&gt;getType()-&gt;getPointerAddressSpace() &amp;&amp;</div>
<div class="line"><a name="l05478"></a><span class="lineno"> 5478</span>&#160;            !<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;isNonIntegralPointerType(<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>-&gt;getType())) {</div>
<div class="line"><a name="l05479"></a><span class="lineno"> 5479</span>&#160;          <span class="comment">// There are two reasons the address spaces might not match: a no-op</span></div>
<div class="line"><a name="l05480"></a><span class="lineno"> 5480</span>&#160;          <span class="comment">// addrspacecast, or a ptrtoint/inttoptr pair. Either way, we emit a</span></div>
<div class="line"><a name="l05481"></a><span class="lineno"> 5481</span>&#160;          <span class="comment">// ptrtoint/inttoptr pair to ensure we match the original semantics.</span></div>
<div class="line"><a name="l05482"></a><span class="lineno"> 5482</span>&#160;          <span class="comment">// TODO: allow bitcast between different address space pointers with</span></div>
<div class="line"><a name="l05483"></a><span class="lineno"> 5483</span>&#160;          <span class="comment">// the same size.</span></div>
<div class="line"><a name="l05484"></a><span class="lineno"> 5484</span>&#160;          SunkAddr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePtrToInt(SunkAddr, IntPtrTy, <span class="stringliteral">&quot;sunkaddr&quot;</span>);</div>
<div class="line"><a name="l05485"></a><span class="lineno"> 5485</span>&#160;          SunkAddr =</div>
<div class="line"><a name="l05486"></a><span class="lineno"> 5486</span>&#160;              <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntToPtr(SunkAddr, <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>-&gt;getType(), <span class="stringliteral">&quot;sunkaddr&quot;</span>);</div>
<div class="line"><a name="l05487"></a><span class="lineno"> 5487</span>&#160;        } <span class="keywordflow">else</span></div>
<div class="line"><a name="l05488"></a><span class="lineno"> 5488</span>&#160;          SunkAddr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePointerCast(SunkAddr, <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>-&gt;getType());</div>
<div class="line"><a name="l05489"></a><span class="lineno"> 5489</span>&#160;      }</div>
<div class="line"><a name="l05490"></a><span class="lineno"> 5490</span>&#160;    }</div>
<div class="line"><a name="l05491"></a><span class="lineno"> 5491</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05492"></a><span class="lineno"> 5492</span>&#160;    <span class="comment">// We&#39;d require a ptrtoint/inttoptr down the line, which we can&#39;t do for</span></div>
<div class="line"><a name="l05493"></a><span class="lineno"> 5493</span>&#160;    <span class="comment">// non-integral pointers, so in that case bail out now.</span></div>
<div class="line"><a name="l05494"></a><span class="lineno"> 5494</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *BaseTy = <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg ? <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg-&gt;getType() : <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05495"></a><span class="lineno"> 5495</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *ScaleTy = <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale ? <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.ScaledReg-&gt;getType() : <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05496"></a><span class="lineno"> 5496</span>&#160;    <a class="code" href="classllvm_1_1PointerType.html">PointerType</a> *BasePtrTy = dyn_cast_or_null&lt;PointerType&gt;(BaseTy);</div>
<div class="line"><a name="l05497"></a><span class="lineno"> 5497</span>&#160;    <a class="code" href="classllvm_1_1PointerType.html">PointerType</a> *ScalePtrTy = dyn_cast_or_null&lt;PointerType&gt;(ScaleTy);</div>
<div class="line"><a name="l05498"></a><span class="lineno"> 5498</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;isNonIntegralPointerType(<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>-&gt;getType()) ||</div>
<div class="line"><a name="l05499"></a><span class="lineno"> 5499</span>&#160;        (BasePtrTy &amp;&amp; <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;isNonIntegralPointerType(BasePtrTy)) ||</div>
<div class="line"><a name="l05500"></a><span class="lineno"> 5500</span>&#160;        (ScalePtrTy &amp;&amp; <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;isNonIntegralPointerType(ScalePtrTy)) ||</div>
<div class="line"><a name="l05501"></a><span class="lineno"> 5501</span>&#160;        (<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseGV &amp;&amp;</div>
<div class="line"><a name="l05502"></a><span class="lineno"> 5502</span>&#160;         <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;isNonIntegralPointerType(<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseGV-&gt;getType())))</div>
<div class="line"><a name="l05503"></a><span class="lineno"> 5503</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</div>
<div class="line"><a name="l05504"></a><span class="lineno"> 5504</span>&#160; </div>
<div class="line"><a name="l05505"></a><span class="lineno"> 5505</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;CGP: SINKING nonlocal addrmode: &quot;</span> &lt;&lt; <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a></div>
<div class="line"><a name="l05506"></a><span class="lineno"> 5506</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot; for &quot;</span> &lt;&lt; *MemoryInst &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l05507"></a><span class="lineno"> 5507</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *IntPtrTy = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getIntPtrType(<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>-&gt;getType());</div>
<div class="line"><a name="l05508"></a><span class="lineno"> 5508</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05509"></a><span class="lineno"> 5509</span>&#160; </div>
<div class="line"><a name="l05510"></a><span class="lineno"> 5510</span>&#160;    <span class="comment">// Start with the base register. Do this first so that subsequent address</span></div>
<div class="line"><a name="l05511"></a><span class="lineno"> 5511</span>&#160;    <span class="comment">// matching finds it last, which will prevent it from trying to match it</span></div>
<div class="line"><a name="l05512"></a><span class="lineno"> 5512</span>&#160;    <span class="comment">// as the scaled value in case it happens to be a mul. That would be</span></div>
<div class="line"><a name="l05513"></a><span class="lineno"> 5513</span>&#160;    <span class="comment">// problematic if we&#39;ve sunk a different mul for the scale, because then</span></div>
<div class="line"><a name="l05514"></a><span class="lineno"> 5514</span>&#160;    <span class="comment">// we&#39;d end up sinking both muls.</span></div>
<div class="line"><a name="l05515"></a><span class="lineno"> 5515</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg) {</div>
<div class="line"><a name="l05516"></a><span class="lineno"> 5516</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg;</div>
<div class="line"><a name="l05517"></a><span class="lineno"> 5517</span>&#160;      <span class="keywordflow">if</span> (V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>())</div>
<div class="line"><a name="l05518"></a><span class="lineno"> 5518</span>&#160;        V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePtrToInt(V, IntPtrTy, <span class="stringliteral">&quot;sunkaddr&quot;</span>);</div>
<div class="line"><a name="l05519"></a><span class="lineno"> 5519</span>&#160;      <span class="keywordflow">if</span> (V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() != IntPtrTy)</div>
<div class="line"><a name="l05520"></a><span class="lineno"> 5520</span>&#160;        V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntCast(V, IntPtrTy, <span class="comment">/*isSigned=*/</span><span class="keyword">true</span>, <span class="stringliteral">&quot;sunkaddr&quot;</span>);</div>
<div class="line"><a name="l05521"></a><span class="lineno"> 5521</span>&#160;      <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = V;</div>
<div class="line"><a name="l05522"></a><span class="lineno"> 5522</span>&#160;    }</div>
<div class="line"><a name="l05523"></a><span class="lineno"> 5523</span>&#160; </div>
<div class="line"><a name="l05524"></a><span class="lineno"> 5524</span>&#160;    <span class="comment">// Add the scale value.</span></div>
<div class="line"><a name="l05525"></a><span class="lineno"> 5525</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale) {</div>
<div class="line"><a name="l05526"></a><span class="lineno"> 5526</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.ScaledReg;</div>
<div class="line"><a name="l05527"></a><span class="lineno"> 5527</span>&#160;      <span class="keywordflow">if</span> (V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() == IntPtrTy) {</div>
<div class="line"><a name="l05528"></a><span class="lineno"> 5528</span>&#160;        <span class="comment">// done.</span></div>
<div class="line"><a name="l05529"></a><span class="lineno"> 5529</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>()) {</div>
<div class="line"><a name="l05530"></a><span class="lineno"> 5530</span>&#160;        V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePtrToInt(V, IntPtrTy, <span class="stringliteral">&quot;sunkaddr&quot;</span>);</div>
<div class="line"><a name="l05531"></a><span class="lineno"> 5531</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cast&lt;IntegerType&gt;(IntPtrTy)-&gt;<a class="code" href="ValueTracking_8cpp.html#a2cb59ea8f9e8543986d40c48acfd24a3">getBitWidth</a>() &lt;</div>
<div class="line"><a name="l05532"></a><span class="lineno"> 5532</span>&#160;                 cast&lt;IntegerType&gt;(V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getBitWidth()) {</div>
<div class="line"><a name="l05533"></a><span class="lineno"> 5533</span>&#160;        V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateTrunc(V, IntPtrTy, <span class="stringliteral">&quot;sunkaddr&quot;</span>);</div>
<div class="line"><a name="l05534"></a><span class="lineno"> 5534</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05535"></a><span class="lineno"> 5535</span>&#160;        <span class="comment">// It is only safe to sign extend the BaseReg if we know that the math</span></div>
<div class="line"><a name="l05536"></a><span class="lineno"> 5536</span>&#160;        <span class="comment">// required to create it did not overflow before we extend it. Since</span></div>
<div class="line"><a name="l05537"></a><span class="lineno"> 5537</span>&#160;        <span class="comment">// the original IR value was tossed in favor of a constant back when</span></div>
<div class="line"><a name="l05538"></a><span class="lineno"> 5538</span>&#160;        <span class="comment">// the AddrMode was created we need to bail out gracefully if widths</span></div>
<div class="line"><a name="l05539"></a><span class="lineno"> 5539</span>&#160;        <span class="comment">// do not match instead of extending it.</span></div>
<div class="line"><a name="l05540"></a><span class="lineno"> 5540</span>&#160;        <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast_or_null&lt;Instruction&gt;(Result);</div>
<div class="line"><a name="l05541"></a><span class="lineno"> 5541</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp; (Result != <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseReg))</div>
<div class="line"><a name="l05542"></a><span class="lineno"> 5542</span>&#160;          <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l05543"></a><span class="lineno"> 5543</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</div>
<div class="line"><a name="l05544"></a><span class="lineno"> 5544</span>&#160;      }</div>
<div class="line"><a name="l05545"></a><span class="lineno"> 5545</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale != 1)</div>
<div class="line"><a name="l05546"></a><span class="lineno"> 5546</span>&#160;        V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateMul(V, <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantInt::get</a>(IntPtrTy, <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.Scale),</div>
<div class="line"><a name="l05547"></a><span class="lineno"> 5547</span>&#160;                              <span class="stringliteral">&quot;sunkaddr&quot;</span>);</div>
<div class="line"><a name="l05548"></a><span class="lineno"> 5548</span>&#160;      <span class="keywordflow">if</span> (Result)</div>
<div class="line"><a name="l05549"></a><span class="lineno"> 5549</span>&#160;        <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAdd(Result, V, <span class="stringliteral">&quot;sunkaddr&quot;</span>);</div>
<div class="line"><a name="l05550"></a><span class="lineno"> 5550</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l05551"></a><span class="lineno"> 5551</span>&#160;        <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = V;</div>
<div class="line"><a name="l05552"></a><span class="lineno"> 5552</span>&#160;    }</div>
<div class="line"><a name="l05553"></a><span class="lineno"> 5553</span>&#160; </div>
<div class="line"><a name="l05554"></a><span class="lineno"> 5554</span>&#160;    <span class="comment">// Add in the BaseGV if present.</span></div>
<div class="line"><a name="l05555"></a><span class="lineno"> 5555</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseGV) {</div>
<div class="line"><a name="l05556"></a><span class="lineno"> 5556</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePtrToInt(<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseGV, IntPtrTy, <span class="stringliteral">&quot;sunkaddr&quot;</span>);</div>
<div class="line"><a name="l05557"></a><span class="lineno"> 5557</span>&#160;      <span class="keywordflow">if</span> (Result)</div>
<div class="line"><a name="l05558"></a><span class="lineno"> 5558</span>&#160;        <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAdd(Result, V, <span class="stringliteral">&quot;sunkaddr&quot;</span>);</div>
<div class="line"><a name="l05559"></a><span class="lineno"> 5559</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l05560"></a><span class="lineno"> 5560</span>&#160;        <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = V;</div>
<div class="line"><a name="l05561"></a><span class="lineno"> 5561</span>&#160;    }</div>
<div class="line"><a name="l05562"></a><span class="lineno"> 5562</span>&#160; </div>
<div class="line"><a name="l05563"></a><span class="lineno"> 5563</span>&#160;    <span class="comment">// Add in the Base Offset if present.</span></div>
<div class="line"><a name="l05564"></a><span class="lineno"> 5564</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseOffs) {</div>
<div class="line"><a name="l05565"></a><span class="lineno"> 5565</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantInt::get</a>(IntPtrTy, <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseOffs);</div>
<div class="line"><a name="l05566"></a><span class="lineno"> 5566</span>&#160;      <span class="keywordflow">if</span> (Result)</div>
<div class="line"><a name="l05567"></a><span class="lineno"> 5567</span>&#160;        <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAdd(Result, V, <span class="stringliteral">&quot;sunkaddr&quot;</span>);</div>
<div class="line"><a name="l05568"></a><span class="lineno"> 5568</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l05569"></a><span class="lineno"> 5569</span>&#160;        <a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = V;</div>
<div class="line"><a name="l05570"></a><span class="lineno"> 5570</span>&#160;    }</div>
<div class="line"><a name="l05571"></a><span class="lineno"> 5571</span>&#160; </div>
<div class="line"><a name="l05572"></a><span class="lineno"> 5572</span>&#160;    <span class="keywordflow">if</span> (!Result)</div>
<div class="line"><a name="l05573"></a><span class="lineno"> 5573</span>&#160;      SunkAddr = Constant::getNullValue(<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>-&gt;getType());</div>
<div class="line"><a name="l05574"></a><span class="lineno"> 5574</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l05575"></a><span class="lineno"> 5575</span>&#160;      SunkAddr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntToPtr(Result, <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>-&gt;getType(), <span class="stringliteral">&quot;sunkaddr&quot;</span>);</div>
<div class="line"><a name="l05576"></a><span class="lineno"> 5576</span>&#160;  }</div>
<div class="line"><a name="l05577"></a><span class="lineno"> 5577</span>&#160; </div>
<div class="line"><a name="l05578"></a><span class="lineno"> 5578</span>&#160;  MemoryInst-&gt;<a class="code" href="classllvm_1_1User.html#a1600c7959045cb6b6a5f5a1d427ec67e">replaceUsesOfWith</a>(Repl, SunkAddr);</div>
<div class="line"><a name="l05579"></a><span class="lineno"> 5579</span>&#160;  <span class="comment">// Store the newly computed address into the cache. In the case we reused a</span></div>
<div class="line"><a name="l05580"></a><span class="lineno"> 5580</span>&#160;  <span class="comment">// value, this should be idempotent.</span></div>
<div class="line"><a name="l05581"></a><span class="lineno"> 5581</span>&#160;  SunkAddrs[<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>] = <a class="code" href="classllvm_1_1WeakTrackingVH.html">WeakTrackingVH</a>(SunkAddr);</div>
<div class="line"><a name="l05582"></a><span class="lineno"> 5582</span>&#160; </div>
<div class="line"><a name="l05583"></a><span class="lineno"> 5583</span>&#160;  <span class="comment">// If we have no uses, recursively delete the value and all dead instructions</span></div>
<div class="line"><a name="l05584"></a><span class="lineno"> 5584</span>&#160;  <span class="comment">// using it.</span></div>
<div class="line"><a name="l05585"></a><span class="lineno"> 5585</span>&#160;  <span class="keywordflow">if</span> (Repl-&gt;<a class="code" href="classllvm_1_1Value.html#a9d7de807ebdfe1819df3ff6cb0f16158">use_empty</a>()) {</div>
<div class="line"><a name="l05586"></a><span class="lineno"> 5586</span>&#160;    resetIteratorIfInvalidatedWhileCalling(CurInstIterator-&gt;getParent(), [&amp;]() {</div>
<div class="line"><a name="l05587"></a><span class="lineno"> 5587</span>&#160;      RecursivelyDeleteTriviallyDeadInstructions(</div>
<div class="line"><a name="l05588"></a><span class="lineno"> 5588</span>&#160;          Repl, TLInfo, nullptr,</div>
<div class="line"><a name="l05589"></a><span class="lineno"> 5589</span>&#160;          [&amp;](Value *V) { removeAllAssertingVHReferences(V); });</div>
<div class="line"><a name="l05590"></a><span class="lineno"> 5590</span>&#160;    });</div>
<div class="line"><a name="l05591"></a><span class="lineno"> 5591</span>&#160;  }</div>
<div class="line"><a name="l05592"></a><span class="lineno"> 5592</span>&#160;  ++NumMemoryInsts;</div>
<div class="line"><a name="l05593"></a><span class="lineno"> 5593</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05594"></a><span class="lineno"> 5594</span>&#160;}</div>
<div class="line"><a name="l05595"></a><span class="lineno"> 5595</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l05596"></a><span class="lineno"> 5596</span>&#160;<span class="comment">/// Rewrite GEP input to gather/scatter to enable SelectionDAGBuilder to find</span></div>
<div class="line"><a name="l05597"></a><span class="lineno"> 5597</span>&#160;<span class="comment">/// a uniform base to use for ISD::MGATHER/MSCATTER. SelectionDAGBuilder can</span></div>
<div class="line"><a name="l05598"></a><span class="lineno"> 5598</span>&#160;<span class="comment">/// only handle a 2 operand GEP in the same basic block or a splat constant</span></div>
<div class="line"><a name="l05599"></a><span class="lineno"> 5599</span>&#160;<span class="comment">/// vector. The 2 operands to the GEP must have a scalar pointer and a vector</span></div>
<div class="line"><a name="l05600"></a><span class="lineno"> 5600</span>&#160;<span class="comment">/// index.</span></div>
<div class="line"><a name="l05601"></a><span class="lineno"> 5601</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l05602"></a><span class="lineno"> 5602</span>&#160;<span class="comment">/// If the existing GEP has a vector base pointer that is splat, we can look</span></div>
<div class="line"><a name="l05603"></a><span class="lineno"> 5603</span>&#160;<span class="comment">/// through the splat to find the scalar pointer. If we can&#39;t find a scalar</span></div>
<div class="line"><a name="l05604"></a><span class="lineno"> 5604</span>&#160;<span class="comment">/// pointer there&#39;s nothing we can do.</span></div>
<div class="line"><a name="l05605"></a><span class="lineno"> 5605</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l05606"></a><span class="lineno"> 5606</span>&#160;<span class="comment">/// If we have a GEP with more than 2 indices where the middle indices are all</span></div>
<div class="line"><a name="l05607"></a><span class="lineno"> 5607</span>&#160;<span class="comment">/// zeroes, we can replace it with 2 GEPs where the second has 2 operands.</span></div>
<div class="line"><a name="l05608"></a><span class="lineno"> 5608</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l05609"></a><span class="lineno"> 5609</span>&#160;<span class="comment">/// If the final index isn&#39;t a vector or is a splat, we can emit a scalar GEP</span></div>
<div class="line"><a name="l05610"></a><span class="lineno"> 5610</span>&#160;<span class="comment">/// followed by a GEP with an all zeroes vector index. This will enable</span></div>
<div class="line"><a name="l05611"></a><span class="lineno"> 5611</span>&#160;<span class="comment">/// SelectionDAGBuilder to use the scalar GEP as the uniform base and have a</span></div>
<div class="line"><a name="l05612"></a><span class="lineno"> 5612</span>&#160;<span class="comment">/// zero index.</span></div>
<div class="line"><a name="l05613"></a><span class="lineno"> 5613</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CodeGenPrepare::optimizeGatherScatterInst(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *MemoryInst,</div>
<div class="line"><a name="l05614"></a><span class="lineno"> 5614</span>&#160;                                               <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>) {</div>
<div class="line"><a name="l05615"></a><span class="lineno"> 5615</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewAddr;</div>
<div class="line"><a name="l05616"></a><span class="lineno"> 5616</span>&#160; </div>
<div class="line"><a name="l05617"></a><span class="lineno"> 5617</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> *<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = dyn_cast&lt;GetElementPtrInst&gt;(<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>)) {</div>
<div class="line"><a name="l05618"></a><span class="lineno"> 5618</span>&#160;    <span class="comment">// Don&#39;t optimize GEPs that don&#39;t have indices.</span></div>
<div class="line"><a name="l05619"></a><span class="lineno"> 5619</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;hasIndices())</div>
<div class="line"><a name="l05620"></a><span class="lineno"> 5620</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05621"></a><span class="lineno"> 5621</span>&#160; </div>
<div class="line"><a name="l05622"></a><span class="lineno"> 5622</span>&#160;    <span class="comment">// If the GEP and the gather/scatter aren&#39;t in the same BB, don&#39;t optimize.</span></div>
<div class="line"><a name="l05623"></a><span class="lineno"> 5623</span>&#160;    <span class="comment">// FIXME: We should support this by sinking the GEP.</span></div>
<div class="line"><a name="l05624"></a><span class="lineno"> 5624</span>&#160;    <span class="keywordflow">if</span> (MemoryInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() != <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getParent())</div>
<div class="line"><a name="l05625"></a><span class="lineno"> 5625</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05626"></a><span class="lineno"> 5626</span>&#160; </div>
<div class="line"><a name="l05627"></a><span class="lineno"> 5627</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 2&gt;</a> Ops(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;operands());</div>
<div class="line"><a name="l05628"></a><span class="lineno"> 5628</span>&#160; </div>
<div class="line"><a name="l05629"></a><span class="lineno"> 5629</span>&#160;    <span class="keywordtype">bool</span> RewriteGEP = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05630"></a><span class="lineno"> 5630</span>&#160; </div>
<div class="line"><a name="l05631"></a><span class="lineno"> 5631</span>&#160;    <span class="keywordflow">if</span> (Ops[0]-&gt;<a class="code" href="M68kELFObjectWriter_8cpp.html#ae4a8bc3879d2282eefd72b16b12c2a37">getType</a>()-&gt;isVectorTy()) {</div>
<div class="line"><a name="l05632"></a><span class="lineno"> 5632</span>&#160;      Ops[0] = <a class="code" href="VEISelLowering_8cpp.html#a07226cd9aa78324951d9be41f6083c3e">getSplatValue</a>(Ops[0]);</div>
<div class="line"><a name="l05633"></a><span class="lineno"> 5633</span>&#160;      <span class="keywordflow">if</span> (!Ops[0])</div>
<div class="line"><a name="l05634"></a><span class="lineno"> 5634</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05635"></a><span class="lineno"> 5635</span>&#160;      RewriteGEP = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05636"></a><span class="lineno"> 5636</span>&#160;    }</div>
<div class="line"><a name="l05637"></a><span class="lineno"> 5637</span>&#160; </div>
<div class="line"><a name="l05638"></a><span class="lineno"> 5638</span>&#160;    <span class="keywordtype">unsigned</span> FinalIndex = Ops.size() - 1;</div>
<div class="line"><a name="l05639"></a><span class="lineno"> 5639</span>&#160; </div>
<div class="line"><a name="l05640"></a><span class="lineno"> 5640</span>&#160;    <span class="comment">// Ensure all but the last index is 0.</span></div>
<div class="line"><a name="l05641"></a><span class="lineno"> 5641</span>&#160;    <span class="comment">// FIXME: This isn&#39;t strictly required. All that&#39;s required is that they are</span></div>
<div class="line"><a name="l05642"></a><span class="lineno"> 5642</span>&#160;    <span class="comment">// all scalars or splats.</span></div>
<div class="line"><a name="l05643"></a><span class="lineno"> 5643</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; FinalIndex; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l05644"></a><span class="lineno"> 5644</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;Constant&gt;(Ops[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l05645"></a><span class="lineno"> 5645</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>)</div>
<div class="line"><a name="l05646"></a><span class="lineno"> 5646</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05647"></a><span class="lineno"> 5647</span>&#160;      <span class="keywordflow">if</span> (isa&lt;VectorType&gt;(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getType()))</div>
<div class="line"><a name="l05648"></a><span class="lineno"> 5648</span>&#160;        <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getSplatValue();</div>
<div class="line"><a name="l05649"></a><span class="lineno"> 5649</span>&#160;      <span class="keyword">auto</span> *CI = dyn_cast_or_null&lt;ConstantInt&gt;(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>);</div>
<div class="line"><a name="l05650"></a><span class="lineno"> 5650</span>&#160;      <span class="keywordflow">if</span> (!CI || !CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a882d55a6aa2028e1a5ad708b275334e0">isZero</a>())</div>
<div class="line"><a name="l05651"></a><span class="lineno"> 5651</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05652"></a><span class="lineno"> 5652</span>&#160;      <span class="comment">// Scalarize the index if needed.</span></div>
<div class="line"><a name="l05653"></a><span class="lineno"> 5653</span>&#160;      Ops[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] = CI;</div>
<div class="line"><a name="l05654"></a><span class="lineno"> 5654</span>&#160;    }</div>
<div class="line"><a name="l05655"></a><span class="lineno"> 5655</span>&#160; </div>
<div class="line"><a name="l05656"></a><span class="lineno"> 5656</span>&#160;    <span class="comment">// Try to scalarize the final index.</span></div>
<div class="line"><a name="l05657"></a><span class="lineno"> 5657</span>&#160;    <span class="keywordflow">if</span> (Ops[FinalIndex]-&gt;<a class="code" href="M68kELFObjectWriter_8cpp.html#ae4a8bc3879d2282eefd72b16b12c2a37">getType</a>()-&gt;isVectorTy()) {</div>
<div class="line"><a name="l05658"></a><span class="lineno"> 5658</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="VEISelLowering_8cpp.html#a07226cd9aa78324951d9be41f6083c3e">getSplatValue</a>(Ops[FinalIndex])) {</div>
<div class="line"><a name="l05659"></a><span class="lineno"> 5659</span>&#160;        <span class="keyword">auto</span> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;ConstantInt&gt;(V);</div>
<div class="line"><a name="l05660"></a><span class="lineno"> 5660</span>&#160;        <span class="comment">// Don&#39;t scalarize all zeros vector.</span></div>
<div class="line"><a name="l05661"></a><span class="lineno"> 5661</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> || !<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;isZero()) {</div>
<div class="line"><a name="l05662"></a><span class="lineno"> 5662</span>&#160;          Ops[FinalIndex] = V;</div>
<div class="line"><a name="l05663"></a><span class="lineno"> 5663</span>&#160;          RewriteGEP = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05664"></a><span class="lineno"> 5664</span>&#160;        }</div>
<div class="line"><a name="l05665"></a><span class="lineno"> 5665</span>&#160;      }</div>
<div class="line"><a name="l05666"></a><span class="lineno"> 5666</span>&#160;    }</div>
<div class="line"><a name="l05667"></a><span class="lineno"> 5667</span>&#160; </div>
<div class="line"><a name="l05668"></a><span class="lineno"> 5668</span>&#160;    <span class="comment">// If we made any changes or the we have extra operands, we need to generate</span></div>
<div class="line"><a name="l05669"></a><span class="lineno"> 5669</span>&#160;    <span class="comment">// new instructions.</span></div>
<div class="line"><a name="l05670"></a><span class="lineno"> 5670</span>&#160;    <span class="keywordflow">if</span> (!RewriteGEP &amp;&amp; Ops.size() == 2)</div>
<div class="line"><a name="l05671"></a><span class="lineno"> 5671</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05672"></a><span class="lineno"> 5672</span>&#160; </div>
<div class="line"><a name="l05673"></a><span class="lineno"> 5673</span>&#160;    <span class="keyword">auto</span> NumElts = cast&lt;VectorType&gt;(<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getType())-&gt;getElementCount();</div>
<div class="line"><a name="l05674"></a><span class="lineno"> 5674</span>&#160; </div>
<div class="line"><a name="l05675"></a><span class="lineno"> 5675</span>&#160;    <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(MemoryInst);</div>
<div class="line"><a name="l05676"></a><span class="lineno"> 5676</span>&#160; </div>
<div class="line"><a name="l05677"></a><span class="lineno"> 5677</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *SourceTy = <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getSourceElementType();</div>
<div class="line"><a name="l05678"></a><span class="lineno"> 5678</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *ScalarIndexTy = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getIndexType(Ops[0]-&gt;<a class="code" href="M68kELFObjectWriter_8cpp.html#ae4a8bc3879d2282eefd72b16b12c2a37">getType</a>()-&gt;getScalarType());</div>
<div class="line"><a name="l05679"></a><span class="lineno"> 5679</span>&#160; </div>
<div class="line"><a name="l05680"></a><span class="lineno"> 5680</span>&#160;    <span class="comment">// If the final index isn&#39;t a vector, emit a scalar GEP containing all ops</span></div>
<div class="line"><a name="l05681"></a><span class="lineno"> 5681</span>&#160;    <span class="comment">// and a vector GEP with all zeroes final index.</span></div>
<div class="line"><a name="l05682"></a><span class="lineno"> 5682</span>&#160;    <span class="keywordflow">if</span> (!Ops[FinalIndex]-&gt;<a class="code" href="M68kELFObjectWriter_8cpp.html#ae4a8bc3879d2282eefd72b16b12c2a37">getType</a>()-&gt;isVectorTy()) {</div>
<div class="line"><a name="l05683"></a><span class="lineno"> 5683</span>&#160;      NewAddr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateGEP(SourceTy, Ops[0], <a class="code" href="namespacellvm.html#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(Ops).drop_front());</div>
<div class="line"><a name="l05684"></a><span class="lineno"> 5684</span>&#160;      <span class="keyword">auto</span> *IndexTy = <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">VectorType::get</a>(ScalarIndexTy, NumElts);</div>
<div class="line"><a name="l05685"></a><span class="lineno"> 5685</span>&#160;      <span class="keyword">auto</span> *SecondTy = GetElementPtrInst::getIndexedType(</div>
<div class="line"><a name="l05686"></a><span class="lineno"> 5686</span>&#160;          SourceTy, <a class="code" href="namespacellvm.html#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(Ops).drop_front());</div>
<div class="line"><a name="l05687"></a><span class="lineno"> 5687</span>&#160;      NewAddr =</div>
<div class="line"><a name="l05688"></a><span class="lineno"> 5688</span>&#160;          <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateGEP(SecondTy, NewAddr, Constant::getNullValue(IndexTy));</div>
<div class="line"><a name="l05689"></a><span class="lineno"> 5689</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05690"></a><span class="lineno"> 5690</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = Ops[0];</div>
<div class="line"><a name="l05691"></a><span class="lineno"> 5691</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a> = Ops[FinalIndex];</div>
<div class="line"><a name="l05692"></a><span class="lineno"> 5692</span>&#160; </div>
<div class="line"><a name="l05693"></a><span class="lineno"> 5693</span>&#160;      <span class="comment">// Create a scalar GEP if there are more than 2 operands.</span></div>
<div class="line"><a name="l05694"></a><span class="lineno"> 5694</span>&#160;      <span class="keywordflow">if</span> (Ops.size() != 2) {</div>
<div class="line"><a name="l05695"></a><span class="lineno"> 5695</span>&#160;        <span class="comment">// Replace the last index with 0.</span></div>
<div class="line"><a name="l05696"></a><span class="lineno"> 5696</span>&#160;        Ops[FinalIndex] = Constant::getNullValue(ScalarIndexTy);</div>
<div class="line"><a name="l05697"></a><span class="lineno"> 5697</span>&#160;        <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateGEP(SourceTy, <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, <a class="code" href="namespacellvm.html#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(Ops).drop_front());</div>
<div class="line"><a name="l05698"></a><span class="lineno"> 5698</span>&#160;        SourceTy = GetElementPtrInst::getIndexedType(</div>
<div class="line"><a name="l05699"></a><span class="lineno"> 5699</span>&#160;            SourceTy, <a class="code" href="namespacellvm.html#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(Ops).drop_front());</div>
<div class="line"><a name="l05700"></a><span class="lineno"> 5700</span>&#160;      }</div>
<div class="line"><a name="l05701"></a><span class="lineno"> 5701</span>&#160; </div>
<div class="line"><a name="l05702"></a><span class="lineno"> 5702</span>&#160;      <span class="comment">// Now create the GEP with scalar pointer and vector index.</span></div>
<div class="line"><a name="l05703"></a><span class="lineno"> 5703</span>&#160;      NewAddr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateGEP(SourceTy, <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>);</div>
<div class="line"><a name="l05704"></a><span class="lineno"> 5704</span>&#160;    }</div>
<div class="line"><a name="l05705"></a><span class="lineno"> 5705</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!isa&lt;Constant&gt;(<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>)) {</div>
<div class="line"><a name="l05706"></a><span class="lineno"> 5706</span>&#160;    <span class="comment">// Not a GEP, maybe its a splat and we can create a GEP to enable</span></div>
<div class="line"><a name="l05707"></a><span class="lineno"> 5707</span>&#160;    <span class="comment">// SelectionDAGBuilder to use it as a uniform base.</span></div>
<div class="line"><a name="l05708"></a><span class="lineno"> 5708</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="VEISelLowering_8cpp.html#a07226cd9aa78324951d9be41f6083c3e">getSplatValue</a>(<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</div>
<div class="line"><a name="l05709"></a><span class="lineno"> 5709</span>&#160;    <span class="keywordflow">if</span> (!V)</div>
<div class="line"><a name="l05710"></a><span class="lineno"> 5710</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05711"></a><span class="lineno"> 5711</span>&#160; </div>
<div class="line"><a name="l05712"></a><span class="lineno"> 5712</span>&#160;    <span class="keyword">auto</span> NumElts = cast&lt;VectorType&gt;(<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getType())-&gt;getElementCount();</div>
<div class="line"><a name="l05713"></a><span class="lineno"> 5713</span>&#160; </div>
<div class="line"><a name="l05714"></a><span class="lineno"> 5714</span>&#160;    <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(MemoryInst);</div>
<div class="line"><a name="l05715"></a><span class="lineno"> 5715</span>&#160; </div>
<div class="line"><a name="l05716"></a><span class="lineno"> 5716</span>&#160;    <span class="comment">// Emit a vector GEP with a scalar pointer and all 0s vector index.</span></div>
<div class="line"><a name="l05717"></a><span class="lineno"> 5717</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *ScalarIndexTy = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getIndexType(V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a4abb39a66573f61fda80469faa5d861d">getScalarType</a>());</div>
<div class="line"><a name="l05718"></a><span class="lineno"> 5718</span>&#160;    <span class="keyword">auto</span> *IndexTy = <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">VectorType::get</a>(ScalarIndexTy, NumElts);</div>
<div class="line"><a name="l05719"></a><span class="lineno"> 5719</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *ScalarTy;</div>
<div class="line"><a name="l05720"></a><span class="lineno"> 5720</span>&#160;    <span class="keywordflow">if</span> (cast&lt;IntrinsicInst&gt;(MemoryInst)-&gt;<a class="code" href="AArch64ISelLowering_8cpp.html#a62766c75f88612ffa652342472e755f6">getIntrinsicID</a>() ==</div>
<div class="line"><a name="l05721"></a><span class="lineno"> 5721</span>&#160;        Intrinsic::masked_gather) {</div>
<div class="line"><a name="l05722"></a><span class="lineno"> 5722</span>&#160;      ScalarTy = MemoryInst-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a4abb39a66573f61fda80469faa5d861d">getScalarType</a>();</div>
<div class="line"><a name="l05723"></a><span class="lineno"> 5723</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05724"></a><span class="lineno"> 5724</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(cast&lt;IntrinsicInst&gt;(MemoryInst)-&gt;<a class="code" href="AArch64ISelLowering_8cpp.html#a62766c75f88612ffa652342472e755f6">getIntrinsicID</a>() ==</div>
<div class="line"><a name="l05725"></a><span class="lineno"> 5725</span>&#160;             Intrinsic::masked_scatter);</div>
<div class="line"><a name="l05726"></a><span class="lineno"> 5726</span>&#160;      ScalarTy = MemoryInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a4abb39a66573f61fda80469faa5d861d">getScalarType</a>();</div>
<div class="line"><a name="l05727"></a><span class="lineno"> 5727</span>&#160;    }</div>
<div class="line"><a name="l05728"></a><span class="lineno"> 5728</span>&#160;    NewAddr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateGEP(ScalarTy, V, Constant::getNullValue(IndexTy));</div>
<div class="line"><a name="l05729"></a><span class="lineno"> 5729</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05730"></a><span class="lineno"> 5730</span>&#160;    <span class="comment">// Constant, SelectionDAGBuilder knows to check if its a splat.</span></div>
<div class="line"><a name="l05731"></a><span class="lineno"> 5731</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05732"></a><span class="lineno"> 5732</span>&#160;  }</div>
<div class="line"><a name="l05733"></a><span class="lineno"> 5733</span>&#160; </div>
<div class="line"><a name="l05734"></a><span class="lineno"> 5734</span>&#160;  MemoryInst-&gt;<a class="code" href="classllvm_1_1User.html#a1600c7959045cb6b6a5f5a1d427ec67e">replaceUsesOfWith</a>(<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, NewAddr);</div>
<div class="line"><a name="l05735"></a><span class="lineno"> 5735</span>&#160; </div>
<div class="line"><a name="l05736"></a><span class="lineno"> 5736</span>&#160;  <span class="comment">// If we have no uses, recursively delete the value and all dead instructions</span></div>
<div class="line"><a name="l05737"></a><span class="lineno"> 5737</span>&#160;  <span class="comment">// using it.</span></div>
<div class="line"><a name="l05738"></a><span class="lineno"> 5738</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;use_empty())</div>
<div class="line"><a name="l05739"></a><span class="lineno"> 5739</span>&#160;    <a class="code" href="namespacellvm.html#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(</div>
<div class="line"><a name="l05740"></a><span class="lineno"> 5740</span>&#160;        <a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, TLInfo, <span class="keyword">nullptr</span>,</div>
<div class="line"><a name="l05741"></a><span class="lineno"> 5741</span>&#160;        [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) { removeAllAssertingVHReferences(V); });</div>
<div class="line"><a name="l05742"></a><span class="lineno"> 5742</span>&#160; </div>
<div class="line"><a name="l05743"></a><span class="lineno"> 5743</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05744"></a><span class="lineno"> 5744</span>&#160;}</div>
<div class="line"><a name="l05745"></a><span class="lineno"> 5745</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l05746"></a><span class="lineno"> 5746</span>&#160;<span class="comment">/// If there are any memory operands, use OptimizeMemoryInst to sink their</span></div>
<div class="line"><a name="l05747"></a><span class="lineno"> 5747</span>&#160;<span class="comment">/// address computing into the block when possible / profitable.</span></div>
<div class="line"><a name="l05748"></a><span class="lineno"> 5748</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CodeGenPrepare::optimizeInlineAsmInst(<a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CS) {</div>
<div class="line"><a name="l05749"></a><span class="lineno"> 5749</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05750"></a><span class="lineno"> 5750</span>&#160; </div>
<div class="line"><a name="l05751"></a><span class="lineno"> 5751</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetRegisterInfo.html">TargetRegisterInfo</a> *<a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a> =</div>
<div class="line"><a name="l05752"></a><span class="lineno"> 5752</span>&#160;      <a class="code" href="PassBuilderBindings_8cpp.html#ab76052bb166c65901edb603a3e1f03ab">TM</a>-&gt;getSubtargetImpl(*CS-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>())-&gt;getRegisterInfo();</div>
<div class="line"><a name="l05753"></a><span class="lineno"> 5753</span>&#160;  <a class="code" href="classllvm_1_1TargetLowering.html#a3db162658a7687e8a5df34f5a6aaa840">TargetLowering::AsmOperandInfoVector</a> TargetConstraints =</div>
<div class="line"><a name="l05754"></a><span class="lineno"> 5754</span>&#160;      TLI-&gt;<a class="code" href="classllvm_1_1TargetLowering.html#ab37c33cd1796e553461f26aefbf498fa">ParseConstraints</a>(*<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, *CS);</div>
<div class="line"><a name="l05755"></a><span class="lineno"> 5755</span>&#160;  <span class="keywordtype">unsigned</span> ArgNo = 0;</div>
<div class="line"><a name="l05756"></a><span class="lineno"> 5756</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="structllvm_1_1TargetLowering_1_1AsmOperandInfo.html">TargetLowering::AsmOperandInfo</a> &amp;OpInfo : TargetConstraints) {</div>
<div class="line"><a name="l05757"></a><span class="lineno"> 5757</span>&#160;    <span class="comment">// Compute the constraint code and ConstraintType to use.</span></div>
<div class="line"><a name="l05758"></a><span class="lineno"> 5758</span>&#160;    TLI-&gt;<a class="code" href="classllvm_1_1TargetLowering.html#acb82500e7e47e76d087ce8606ae8e625">ComputeConstraintToUse</a>(OpInfo, <a class="code" href="classllvm_1_1SDValue.html">SDValue</a>());</div>
<div class="line"><a name="l05759"></a><span class="lineno"> 5759</span>&#160; </div>
<div class="line"><a name="l05760"></a><span class="lineno"> 5760</span>&#160;    <span class="comment">// TODO: Also handle C_Address?</span></div>
<div class="line"><a name="l05761"></a><span class="lineno"> 5761</span>&#160;    <span class="keywordflow">if</span> (OpInfo.ConstraintType == TargetLowering::C_Memory &amp;&amp;</div>
<div class="line"><a name="l05762"></a><span class="lineno"> 5762</span>&#160;        OpInfo.isIndirect) {</div>
<div class="line"><a name="l05763"></a><span class="lineno"> 5763</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *OpVal = CS-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(ArgNo++);</div>
<div class="line"><a name="l05764"></a><span class="lineno"> 5764</span>&#160;      MadeChange |= optimizeMemoryInst(CS, OpVal, OpVal-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), ~0u);</div>
<div class="line"><a name="l05765"></a><span class="lineno"> 5765</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (OpInfo.Type == <a class="code" href="OptTable_8cpp.html#aa3eeff7d11fd437d92b11bc4840d1d2e">InlineAsm::isInput</a>)</div>
<div class="line"><a name="l05766"></a><span class="lineno"> 5766</span>&#160;      ArgNo++;</div>
<div class="line"><a name="l05767"></a><span class="lineno"> 5767</span>&#160;  }</div>
<div class="line"><a name="l05768"></a><span class="lineno"> 5768</span>&#160; </div>
<div class="line"><a name="l05769"></a><span class="lineno"> 5769</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div>
<div class="line"><a name="l05770"></a><span class="lineno"> 5770</span>&#160;}</div>
<div class="line"><a name="l05771"></a><span class="lineno"> 5771</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l05772"></a><span class="lineno"> 5772</span>&#160;<span class="comment">/// Check if all the uses of \p Val are equivalent (or free) zero or</span></div>
<div class="line"><a name="l05773"></a><span class="lineno"> 5773</span>&#160;<span class="comment">/// sign extensions.</span></div>
<div class="line"><a name="l05774"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#ae965d93aa46ad834c21718eba4b5b78e"> 5774</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CodeGenPrepare_8cpp.html#ae965d93aa46ad834c21718eba4b5b78e">hasSameExtUse</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *Val, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI) {</div>
<div class="line"><a name="l05775"></a><span class="lineno"> 5775</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!Val-&gt;<a class="code" href="classllvm_1_1Value.html#a9d7de807ebdfe1819df3ff6cb0f16158">use_empty</a>() &amp;&amp; <span class="stringliteral">&quot;Input must have at least one use&quot;</span>);</div>
<div class="line"><a name="l05776"></a><span class="lineno"> 5776</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *FirstUser = cast&lt;Instruction&gt;(*Val-&gt;<a class="code" href="classllvm_1_1Value.html#a158da2b6d3d938aaa15b6acd00150e2c">user_begin</a>());</div>
<div class="line"><a name="l05777"></a><span class="lineno"> 5777</span>&#160;  <span class="keywordtype">bool</span> IsSExt = isa&lt;SExtInst&gt;(FirstUser);</div>
<div class="line"><a name="l05778"></a><span class="lineno"> 5778</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *ExtTy = FirstUser-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l05779"></a><span class="lineno"> 5779</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1User.html">User</a> *U : Val-&gt;<a class="code" href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">users</a>()) {</div>
<div class="line"><a name="l05780"></a><span class="lineno"> 5780</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *UI = cast&lt;Instruction&gt;(U);</div>
<div class="line"><a name="l05781"></a><span class="lineno"> 5781</span>&#160;    <span class="keywordflow">if</span> ((IsSExt &amp;&amp; !isa&lt;SExtInst&gt;(UI)) || (!IsSExt &amp;&amp; !isa&lt;ZExtInst&gt;(UI)))</div>
<div class="line"><a name="l05782"></a><span class="lineno"> 5782</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05783"></a><span class="lineno"> 5783</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *CurTy = UI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l05784"></a><span class="lineno"> 5784</span>&#160;    <span class="comment">// Same input and output types: Same instruction after CSE.</span></div>
<div class="line"><a name="l05785"></a><span class="lineno"> 5785</span>&#160;    <span class="keywordflow">if</span> (CurTy == ExtTy)</div>
<div class="line"><a name="l05786"></a><span class="lineno"> 5786</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05787"></a><span class="lineno"> 5787</span>&#160; </div>
<div class="line"><a name="l05788"></a><span class="lineno"> 5788</span>&#160;    <span class="comment">// If IsSExt is true, we are in this situation:</span></div>
<div class="line"><a name="l05789"></a><span class="lineno"> 5789</span>&#160;    <span class="comment">// a = Val</span></div>
<div class="line"><a name="l05790"></a><span class="lineno"> 5790</span>&#160;    <span class="comment">// b = sext ty1 a to ty2</span></div>
<div class="line"><a name="l05791"></a><span class="lineno"> 5791</span>&#160;    <span class="comment">// c = sext ty1 a to ty3</span></div>
<div class="line"><a name="l05792"></a><span class="lineno"> 5792</span>&#160;    <span class="comment">// Assuming ty2 is shorter than ty3, this could be turned into:</span></div>
<div class="line"><a name="l05793"></a><span class="lineno"> 5793</span>&#160;    <span class="comment">// a = Val</span></div>
<div class="line"><a name="l05794"></a><span class="lineno"> 5794</span>&#160;    <span class="comment">// b = sext ty1 a to ty2</span></div>
<div class="line"><a name="l05795"></a><span class="lineno"> 5795</span>&#160;    <span class="comment">// c = sext ty2 b to ty3</span></div>
<div class="line"><a name="l05796"></a><span class="lineno"> 5796</span>&#160;    <span class="comment">// However, the last sext is not free.</span></div>
<div class="line"><a name="l05797"></a><span class="lineno"> 5797</span>&#160;    <span class="keywordflow">if</span> (IsSExt)</div>
<div class="line"><a name="l05798"></a><span class="lineno"> 5798</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05799"></a><span class="lineno"> 5799</span>&#160; </div>
<div class="line"><a name="l05800"></a><span class="lineno"> 5800</span>&#160;    <span class="comment">// This is a ZExt, maybe this is free to extend from one type to another.</span></div>
<div class="line"><a name="l05801"></a><span class="lineno"> 5801</span>&#160;    <span class="comment">// In that case, we would not account for a different use.</span></div>
<div class="line"><a name="l05802"></a><span class="lineno"> 5802</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *NarrowTy;</div>
<div class="line"><a name="l05803"></a><span class="lineno"> 5803</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *LargeTy;</div>
<div class="line"><a name="l05804"></a><span class="lineno"> 5804</span>&#160;    <span class="keywordflow">if</span> (ExtTy-&gt;<a class="code" href="classllvm_1_1Type.html#a4abb39a66573f61fda80469faa5d861d">getScalarType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>() &gt;</div>
<div class="line"><a name="l05805"></a><span class="lineno"> 5805</span>&#160;        CurTy-&gt;<a class="code" href="classllvm_1_1Type.html#a4abb39a66573f61fda80469faa5d861d">getScalarType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>()) {</div>
<div class="line"><a name="l05806"></a><span class="lineno"> 5806</span>&#160;      NarrowTy = CurTy;</div>
<div class="line"><a name="l05807"></a><span class="lineno"> 5807</span>&#160;      LargeTy = ExtTy;</div>
<div class="line"><a name="l05808"></a><span class="lineno"> 5808</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05809"></a><span class="lineno"> 5809</span>&#160;      NarrowTy = ExtTy;</div>
<div class="line"><a name="l05810"></a><span class="lineno"> 5810</span>&#160;      LargeTy = CurTy;</div>
<div class="line"><a name="l05811"></a><span class="lineno"> 5811</span>&#160;    }</div>
<div class="line"><a name="l05812"></a><span class="lineno"> 5812</span>&#160; </div>
<div class="line"><a name="l05813"></a><span class="lineno"> 5813</span>&#160;    <span class="keywordflow">if</span> (!TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#a342be90695496b88a8854a775dfd030f">isZExtFree</a>(NarrowTy, LargeTy))</div>
<div class="line"><a name="l05814"></a><span class="lineno"> 5814</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05815"></a><span class="lineno"> 5815</span>&#160;  }</div>
<div class="line"><a name="l05816"></a><span class="lineno"> 5816</span>&#160;  <span class="comment">// All uses are the same or can be derived from one another for free.</span></div>
<div class="line"><a name="l05817"></a><span class="lineno"> 5817</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05818"></a><span class="lineno"> 5818</span>&#160;}</div>
<div class="line"><a name="l05819"></a><span class="lineno"> 5819</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l05820"></a><span class="lineno"> 5820</span>&#160;<span class="comment">/// Try to speculatively promote extensions in \p Exts and continue</span></div>
<div class="line"><a name="l05821"></a><span class="lineno"> 5821</span>&#160;<span class="comment">/// promoting through newly promoted operands recursively as far as doing so is</span></div>
<div class="line"><a name="l05822"></a><span class="lineno"> 5822</span>&#160;<span class="comment">/// profitable. Save extensions profitably moved up, in \p ProfitablyMovedExts.</span></div>
<div class="line"><a name="l05823"></a><span class="lineno"> 5823</span>&#160;<span class="comment">/// When some promotion happened, \p TPT contains the proper state to revert</span></div>
<div class="line"><a name="l05824"></a><span class="lineno"> 5824</span>&#160;<span class="comment">/// them.</span></div>
<div class="line"><a name="l05825"></a><span class="lineno"> 5825</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l05826"></a><span class="lineno"> 5826</span>&#160;<span class="comment">/// \return true if some promotion happened, false otherwise.</span></div>
<div class="line"><a name="l05827"></a><span class="lineno"> 5827</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CodeGenPrepare::tryToPromoteExts(</div>
<div class="line"><a name="l05828"></a><span class="lineno"> 5828</span>&#160;    TypePromotionTransaction &amp;TPT, <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;Exts,</div>
<div class="line"><a name="l05829"></a><span class="lineno"> 5829</span>&#160;    <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;ProfitablyMovedExts,</div>
<div class="line"><a name="l05830"></a><span class="lineno"> 5830</span>&#160;    <span class="keywordtype">unsigned</span> CreatedInstsCost) {</div>
<div class="line"><a name="l05831"></a><span class="lineno"> 5831</span>&#160;  <span class="keywordtype">bool</span> Promoted = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05832"></a><span class="lineno"> 5832</span>&#160; </div>
<div class="line"><a name="l05833"></a><span class="lineno"> 5833</span>&#160;  <span class="comment">// Iterate over all the extensions to try to promote them.</span></div>
<div class="line"><a name="l05834"></a><span class="lineno"> 5834</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Exts) {</div>
<div class="line"><a name="l05835"></a><span class="lineno"> 5835</span>&#160;    <span class="comment">// Early check if we directly have ext(load).</span></div>
<div class="line"><a name="l05836"></a><span class="lineno"> 5836</span>&#160;    <span class="keywordflow">if</span> (isa&lt;LoadInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0))) {</div>
<div class="line"><a name="l05837"></a><span class="lineno"> 5837</span>&#160;      ProfitablyMovedExts.push_back(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l05838"></a><span class="lineno"> 5838</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05839"></a><span class="lineno"> 5839</span>&#160;    }</div>
<div class="line"><a name="l05840"></a><span class="lineno"> 5840</span>&#160; </div>
<div class="line"><a name="l05841"></a><span class="lineno"> 5841</span>&#160;    <span class="comment">// Check whether or not we want to do any promotion.  The reason we have</span></div>
<div class="line"><a name="l05842"></a><span class="lineno"> 5842</span>&#160;    <span class="comment">// this check inside the for loop is to catch the case where an extension</span></div>
<div class="line"><a name="l05843"></a><span class="lineno"> 5843</span>&#160;    <span class="comment">// is directly fed by a load because in such case the extension can be moved</span></div>
<div class="line"><a name="l05844"></a><span class="lineno"> 5844</span>&#160;    <span class="comment">// up without any promotion on its operands.</span></div>
<div class="line"><a name="l05845"></a><span class="lineno"> 5845</span>&#160;    <span class="keywordflow">if</span> (!TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a399726540ec6435b4c7237b298239741">enableExtLdPromotion</a>() || <a class="code" href="CodeGenPrepare_8cpp.html#a0e4302b3aa3294121137e2bb0e98a573">DisableExtLdPromotion</a>)</div>
<div class="line"><a name="l05846"></a><span class="lineno"> 5846</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05847"></a><span class="lineno"> 5847</span>&#160; </div>
<div class="line"><a name="l05848"></a><span class="lineno"> 5848</span>&#160;    <span class="comment">// Get the action to perform the promotion.</span></div>
<div class="line"><a name="l05849"></a><span class="lineno"> 5849</span>&#160;    TypePromotionHelper::Action TPH =</div>
<div class="line"><a name="l05850"></a><span class="lineno"> 5850</span>&#160;        TypePromotionHelper::getAction(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, InsertedInsts, *TLI, PromotedInsts);</div>
<div class="line"><a name="l05851"></a><span class="lineno"> 5851</span>&#160;    <span class="comment">// Check if we can promote.</span></div>
<div class="line"><a name="l05852"></a><span class="lineno"> 5852</span>&#160;    <span class="keywordflow">if</span> (!TPH) {</div>
<div class="line"><a name="l05853"></a><span class="lineno"> 5853</span>&#160;      <span class="comment">// Save the current extension as we cannot move up through its operand.</span></div>
<div class="line"><a name="l05854"></a><span class="lineno"> 5854</span>&#160;      ProfitablyMovedExts.push_back(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l05855"></a><span class="lineno"> 5855</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05856"></a><span class="lineno"> 5856</span>&#160;    }</div>
<div class="line"><a name="l05857"></a><span class="lineno"> 5857</span>&#160; </div>
<div class="line"><a name="l05858"></a><span class="lineno"> 5858</span>&#160;    <span class="comment">// Save the current state.</span></div>
<div class="line"><a name="l05859"></a><span class="lineno"> 5859</span>&#160;    TypePromotionTransaction::ConstRestorationPt LastKnownGood =</div>
<div class="line"><a name="l05860"></a><span class="lineno"> 5860</span>&#160;        TPT.getRestorationPoint();</div>
<div class="line"><a name="l05861"></a><span class="lineno"> 5861</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 4&gt;</a> NewExts;</div>
<div class="line"><a name="l05862"></a><span class="lineno"> 5862</span>&#160;    <span class="keywordtype">unsigned</span> NewCreatedInstsCost = 0;</div>
<div class="line"><a name="l05863"></a><span class="lineno"> 5863</span>&#160;    <span class="keywordtype">unsigned</span> ExtCost = !TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#aa262bd68fe6b244861c0a5d249d68c30">isExtFree</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l05864"></a><span class="lineno"> 5864</span>&#160;    <span class="comment">// Promote.</span></div>
<div class="line"><a name="l05865"></a><span class="lineno"> 5865</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *PromotedVal = TPH(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, TPT, PromotedInsts, NewCreatedInstsCost,</div>
<div class="line"><a name="l05866"></a><span class="lineno"> 5866</span>&#160;                             &amp;NewExts, <span class="keyword">nullptr</span>, *TLI);</div>
<div class="line"><a name="l05867"></a><span class="lineno"> 5867</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PromotedVal &amp;&amp;</div>
<div class="line"><a name="l05868"></a><span class="lineno"> 5868</span>&#160;           <span class="stringliteral">&quot;TypePromotionHelper should have filtered out those cases&quot;</span>);</div>
<div class="line"><a name="l05869"></a><span class="lineno"> 5869</span>&#160; </div>
<div class="line"><a name="l05870"></a><span class="lineno"> 5870</span>&#160;    <span class="comment">// We would be able to merge only one extension in a load.</span></div>
<div class="line"><a name="l05871"></a><span class="lineno"> 5871</span>&#160;    <span class="comment">// Therefore, if we have more than 1 new extension we heuristically</span></div>
<div class="line"><a name="l05872"></a><span class="lineno"> 5872</span>&#160;    <span class="comment">// cut this search path, because it means we degrade the code quality.</span></div>
<div class="line"><a name="l05873"></a><span class="lineno"> 5873</span>&#160;    <span class="comment">// With exactly 2, the transformation is neutral, because we will merge</span></div>
<div class="line"><a name="l05874"></a><span class="lineno"> 5874</span>&#160;    <span class="comment">// one extension but leave one. However, we optimistically keep going,</span></div>
<div class="line"><a name="l05875"></a><span class="lineno"> 5875</span>&#160;    <span class="comment">// because the new extension may be removed too.</span></div>
<div class="line"><a name="l05876"></a><span class="lineno"> 5876</span>&#160;    <span class="keywordtype">long</span> <span class="keywordtype">long</span> TotalCreatedInstsCost = CreatedInstsCost + NewCreatedInstsCost;</div>
<div class="line"><a name="l05877"></a><span class="lineno"> 5877</span>&#160;    <span class="comment">// FIXME: It would be possible to propagate a negative value instead of</span></div>
<div class="line"><a name="l05878"></a><span class="lineno"> 5878</span>&#160;    <span class="comment">// conservatively ceiling it to 0.</span></div>
<div class="line"><a name="l05879"></a><span class="lineno"> 5879</span>&#160;    TotalCreatedInstsCost =</div>
<div class="line"><a name="l05880"></a><span class="lineno"> 5880</span>&#160;        <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>((<span class="keywordtype">long</span> <span class="keywordtype">long</span>)0, (TotalCreatedInstsCost - ExtCost));</div>
<div class="line"><a name="l05881"></a><span class="lineno"> 5881</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="CodeGenPrepare_8cpp.html#abeca3461f7b80e8fac13a7757cc44453">StressExtLdPromotion</a> &amp;&amp;</div>
<div class="line"><a name="l05882"></a><span class="lineno"> 5882</span>&#160;        (TotalCreatedInstsCost &gt; 1 ||</div>
<div class="line"><a name="l05883"></a><span class="lineno"> 5883</span>&#160;         !<a class="code" href="CodeGenPrepare_8cpp.html#aca87c42e8556b7f2e73454d63efa87f2">isPromotedInstructionLegal</a>(*TLI, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, PromotedVal))) {</div>
<div class="line"><a name="l05884"></a><span class="lineno"> 5884</span>&#160;      <span class="comment">// This promotion is not profitable, rollback to the previous state, and</span></div>
<div class="line"><a name="l05885"></a><span class="lineno"> 5885</span>&#160;      <span class="comment">// save the current extension in ProfitablyMovedExts as the latest</span></div>
<div class="line"><a name="l05886"></a><span class="lineno"> 5886</span>&#160;      <span class="comment">// speculative promotion turned out to be unprofitable.</span></div>
<div class="line"><a name="l05887"></a><span class="lineno"> 5887</span>&#160;      TPT.rollback(LastKnownGood);</div>
<div class="line"><a name="l05888"></a><span class="lineno"> 5888</span>&#160;      ProfitablyMovedExts.push_back(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l05889"></a><span class="lineno"> 5889</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05890"></a><span class="lineno"> 5890</span>&#160;    }</div>
<div class="line"><a name="l05891"></a><span class="lineno"> 5891</span>&#160;    <span class="comment">// Continue promoting NewExts as far as doing so is profitable.</span></div>
<div class="line"><a name="l05892"></a><span class="lineno"> 5892</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 2&gt;</a> NewlyMovedExts;</div>
<div class="line"><a name="l05893"></a><span class="lineno"> 5893</span>&#160;    (void)tryToPromoteExts(TPT, NewExts, NewlyMovedExts, TotalCreatedInstsCost);</div>
<div class="line"><a name="l05894"></a><span class="lineno"> 5894</span>&#160;    <span class="keywordtype">bool</span> NewPromoted = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05895"></a><span class="lineno"> 5895</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *ExtInst : NewlyMovedExts) {</div>
<div class="line"><a name="l05896"></a><span class="lineno"> 5896</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *MovedExt = cast&lt;Instruction&gt;(ExtInst);</div>
<div class="line"><a name="l05897"></a><span class="lineno"> 5897</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *ExtOperand = MovedExt-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l05898"></a><span class="lineno"> 5898</span>&#160;      <span class="comment">// If we have reached to a load, we need this extra profitability check</span></div>
<div class="line"><a name="l05899"></a><span class="lineno"> 5899</span>&#160;      <span class="comment">// as it could potentially be merged into an ext(load).</span></div>
<div class="line"><a name="l05900"></a><span class="lineno"> 5900</span>&#160;      <span class="keywordflow">if</span> (isa&lt;LoadInst&gt;(ExtOperand) &amp;&amp;</div>
<div class="line"><a name="l05901"></a><span class="lineno"> 5901</span>&#160;          !(<a class="code" href="CodeGenPrepare_8cpp.html#abeca3461f7b80e8fac13a7757cc44453">StressExtLdPromotion</a> || NewCreatedInstsCost &lt;= ExtCost ||</div>
<div class="line"><a name="l05902"></a><span class="lineno"> 5902</span>&#160;            (ExtOperand-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() || <a class="code" href="CodeGenPrepare_8cpp.html#ae965d93aa46ad834c21718eba4b5b78e">hasSameExtUse</a>(ExtOperand, *TLI))))</div>
<div class="line"><a name="l05903"></a><span class="lineno"> 5903</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05904"></a><span class="lineno"> 5904</span>&#160; </div>
<div class="line"><a name="l05905"></a><span class="lineno"> 5905</span>&#160;      ProfitablyMovedExts.push_back(MovedExt);</div>
<div class="line"><a name="l05906"></a><span class="lineno"> 5906</span>&#160;      NewPromoted = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05907"></a><span class="lineno"> 5907</span>&#160;    }</div>
<div class="line"><a name="l05908"></a><span class="lineno"> 5908</span>&#160; </div>
<div class="line"><a name="l05909"></a><span class="lineno"> 5909</span>&#160;    <span class="comment">// If none of speculative promotions for NewExts is profitable, rollback</span></div>
<div class="line"><a name="l05910"></a><span class="lineno"> 5910</span>&#160;    <span class="comment">// and save the current extension (I) as the last profitable extension.</span></div>
<div class="line"><a name="l05911"></a><span class="lineno"> 5911</span>&#160;    <span class="keywordflow">if</span> (!NewPromoted) {</div>
<div class="line"><a name="l05912"></a><span class="lineno"> 5912</span>&#160;      TPT.rollback(LastKnownGood);</div>
<div class="line"><a name="l05913"></a><span class="lineno"> 5913</span>&#160;      ProfitablyMovedExts.push_back(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l05914"></a><span class="lineno"> 5914</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05915"></a><span class="lineno"> 5915</span>&#160;    }</div>
<div class="line"><a name="l05916"></a><span class="lineno"> 5916</span>&#160;    <span class="comment">// The promotion is profitable.</span></div>
<div class="line"><a name="l05917"></a><span class="lineno"> 5917</span>&#160;    Promoted = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05918"></a><span class="lineno"> 5918</span>&#160;  }</div>
<div class="line"><a name="l05919"></a><span class="lineno"> 5919</span>&#160;  <span class="keywordflow">return</span> Promoted;</div>
<div class="line"><a name="l05920"></a><span class="lineno"> 5920</span>&#160;}</div>
<div class="line"><a name="l05921"></a><span class="lineno"> 5921</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l05922"></a><span class="lineno"> 5922</span>&#160;<span class="comment">/// Merging redundant sexts when one is dominating the other.</span></div>
<div class="line"><a name="l05923"></a><span class="lineno"> 5923</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CodeGenPrepare::mergeSExts(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l05924"></a><span class="lineno"> 5924</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05925"></a><span class="lineno"> 5925</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Entry : ValToSExtendedUses) {</div>
<div class="line"><a name="l05926"></a><span class="lineno"> 5926</span>&#160;    SExts &amp;Insts = Entry.second;</div>
<div class="line"><a name="l05927"></a><span class="lineno"> 5927</span>&#160;    SExts CurPts;</div>
<div class="line"><a name="l05928"></a><span class="lineno"> 5928</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst : Insts) {</div>
<div class="line"><a name="l05929"></a><span class="lineno"> 5929</span>&#160;      <span class="keywordflow">if</span> (RemovedInsts.count(Inst) || !isa&lt;SExtInst&gt;(Inst) ||</div>
<div class="line"><a name="l05930"></a><span class="lineno"> 5930</span>&#160;          Inst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0) != Entry.first)</div>
<div class="line"><a name="l05931"></a><span class="lineno"> 5931</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05932"></a><span class="lineno"> 5932</span>&#160;      <span class="keywordtype">bool</span> inserted = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05933"></a><span class="lineno"> 5933</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Pt : CurPts) {</div>
<div class="line"><a name="l05934"></a><span class="lineno"> 5934</span>&#160;        <span class="keywordflow">if</span> (getDT(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>).<a class="code" href="RegAllocFast_8cpp.html#a0eda39ffaf32662a7ae6f4dbe998711b">dominates</a>(Inst, Pt)) {</div>
<div class="line"><a name="l05935"></a><span class="lineno"> 5935</span>&#160;          <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(Pt, Inst, FreshBBs, IsHugeFunc);</div>
<div class="line"><a name="l05936"></a><span class="lineno"> 5936</span>&#160;          RemovedInsts.insert(Pt);</div>
<div class="line"><a name="l05937"></a><span class="lineno"> 5937</span>&#160;          Pt-&gt;removeFromParent();</div>
<div class="line"><a name="l05938"></a><span class="lineno"> 5938</span>&#160;          Pt = Inst;</div>
<div class="line"><a name="l05939"></a><span class="lineno"> 5939</span>&#160;          inserted = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05940"></a><span class="lineno"> 5940</span>&#160;          Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05941"></a><span class="lineno"> 5941</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l05942"></a><span class="lineno"> 5942</span>&#160;        }</div>
<div class="line"><a name="l05943"></a><span class="lineno"> 5943</span>&#160;        <span class="keywordflow">if</span> (!getDT(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>).<a class="code" href="RegAllocFast_8cpp.html#a0eda39ffaf32662a7ae6f4dbe998711b">dominates</a>(Pt, Inst))</div>
<div class="line"><a name="l05944"></a><span class="lineno"> 5944</span>&#160;          <span class="comment">// Give up if we need to merge in a common dominator as the</span></div>
<div class="line"><a name="l05945"></a><span class="lineno"> 5945</span>&#160;          <span class="comment">// experiments show it is not profitable.</span></div>
<div class="line"><a name="l05946"></a><span class="lineno"> 5946</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05947"></a><span class="lineno"> 5947</span>&#160;        <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(Inst, Pt, FreshBBs, IsHugeFunc);</div>
<div class="line"><a name="l05948"></a><span class="lineno"> 5948</span>&#160;        RemovedInsts.insert(Inst);</div>
<div class="line"><a name="l05949"></a><span class="lineno"> 5949</span>&#160;        Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a0fd53f63d349dc8a7c5fc0cdd7a94c8d">removeFromParent</a>();</div>
<div class="line"><a name="l05950"></a><span class="lineno"> 5950</span>&#160;        inserted = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05951"></a><span class="lineno"> 5951</span>&#160;        Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05952"></a><span class="lineno"> 5952</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l05953"></a><span class="lineno"> 5953</span>&#160;      }</div>
<div class="line"><a name="l05954"></a><span class="lineno"> 5954</span>&#160;      <span class="keywordflow">if</span> (!inserted)</div>
<div class="line"><a name="l05955"></a><span class="lineno"> 5955</span>&#160;        CurPts.push_back(Inst);</div>
<div class="line"><a name="l05956"></a><span class="lineno"> 5956</span>&#160;    }</div>
<div class="line"><a name="l05957"></a><span class="lineno"> 5957</span>&#160;  }</div>
<div class="line"><a name="l05958"></a><span class="lineno"> 5958</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l05959"></a><span class="lineno"> 5959</span>&#160;}</div>
<div class="line"><a name="l05960"></a><span class="lineno"> 5960</span>&#160; </div>
<div class="line"><a name="l05961"></a><span class="lineno"> 5961</span>&#160;<span class="comment">// Splitting large data structures so that the GEPs accessing them can have</span></div>
<div class="line"><a name="l05962"></a><span class="lineno"> 5962</span>&#160;<span class="comment">// smaller offsets so that they can be sunk to the same blocks as their users.</span></div>
<div class="line"><a name="l05963"></a><span class="lineno"> 5963</span>&#160;<span class="comment">// For example, a large struct starting from %base is split into two parts</span></div>
<div class="line"><a name="l05964"></a><span class="lineno"> 5964</span>&#160;<span class="comment">// where the second part starts from %new_base.</span></div>
<div class="line"><a name="l05965"></a><span class="lineno"> 5965</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l05966"></a><span class="lineno"> 5966</span>&#160;<span class="comment">// Before:</span></div>
<div class="line"><a name="l05967"></a><span class="lineno"> 5967</span>&#160;<span class="comment">// BB0:</span></div>
<div class="line"><a name="l05968"></a><span class="lineno"> 5968</span>&#160;<span class="comment">//   %base     =</span></div>
<div class="line"><a name="l05969"></a><span class="lineno"> 5969</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l05970"></a><span class="lineno"> 5970</span>&#160;<span class="comment">// BB1:</span></div>
<div class="line"><a name="l05971"></a><span class="lineno"> 5971</span>&#160;<span class="comment">//   %gep0     = gep %base, off0</span></div>
<div class="line"><a name="l05972"></a><span class="lineno"> 5972</span>&#160;<span class="comment">//   %gep1     = gep %base, off1</span></div>
<div class="line"><a name="l05973"></a><span class="lineno"> 5973</span>&#160;<span class="comment">//   %gep2     = gep %base, off2</span></div>
<div class="line"><a name="l05974"></a><span class="lineno"> 5974</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l05975"></a><span class="lineno"> 5975</span>&#160;<span class="comment">// BB2:</span></div>
<div class="line"><a name="l05976"></a><span class="lineno"> 5976</span>&#160;<span class="comment">//   %load1    = load %gep0</span></div>
<div class="line"><a name="l05977"></a><span class="lineno"> 5977</span>&#160;<span class="comment">//   %load2    = load %gep1</span></div>
<div class="line"><a name="l05978"></a><span class="lineno"> 5978</span>&#160;<span class="comment">//   %load3    = load %gep2</span></div>
<div class="line"><a name="l05979"></a><span class="lineno"> 5979</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l05980"></a><span class="lineno"> 5980</span>&#160;<span class="comment">// After:</span></div>
<div class="line"><a name="l05981"></a><span class="lineno"> 5981</span>&#160;<span class="comment">// BB0:</span></div>
<div class="line"><a name="l05982"></a><span class="lineno"> 5982</span>&#160;<span class="comment">//   %base     =</span></div>
<div class="line"><a name="l05983"></a><span class="lineno"> 5983</span>&#160;<span class="comment">//   %new_base = gep %base, off0</span></div>
<div class="line"><a name="l05984"></a><span class="lineno"> 5984</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l05985"></a><span class="lineno"> 5985</span>&#160;<span class="comment">// BB1:</span></div>
<div class="line"><a name="l05986"></a><span class="lineno"> 5986</span>&#160;<span class="comment">//   %new_gep0 = %new_base</span></div>
<div class="line"><a name="l05987"></a><span class="lineno"> 5987</span>&#160;<span class="comment">//   %new_gep1 = gep %new_base, off1 - off0</span></div>
<div class="line"><a name="l05988"></a><span class="lineno"> 5988</span>&#160;<span class="comment">//   %new_gep2 = gep %new_base, off2 - off0</span></div>
<div class="line"><a name="l05989"></a><span class="lineno"> 5989</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l05990"></a><span class="lineno"> 5990</span>&#160;<span class="comment">// BB2:</span></div>
<div class="line"><a name="l05991"></a><span class="lineno"> 5991</span>&#160;<span class="comment">//   %load1    = load i32, i32* %new_gep0</span></div>
<div class="line"><a name="l05992"></a><span class="lineno"> 5992</span>&#160;<span class="comment">//   %load2    = load i32, i32* %new_gep1</span></div>
<div class="line"><a name="l05993"></a><span class="lineno"> 5993</span>&#160;<span class="comment">//   %load3    = load i32, i32* %new_gep2</span></div>
<div class="line"><a name="l05994"></a><span class="lineno"> 5994</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l05995"></a><span class="lineno"> 5995</span>&#160;<span class="comment">// %new_gep1 and %new_gep2 can be sunk to BB2 now after the splitting because</span></div>
<div class="line"><a name="l05996"></a><span class="lineno"> 5996</span>&#160;<span class="comment">// their offsets are smaller enough to fit into the addressing mode.</span></div>
<div class="line"><a name="l05997"></a><span class="lineno"> 5997</span>&#160;<span class="keywordtype">bool</span> CodeGenPrepare::splitLargeGEPOffsets() {</div>
<div class="line"><a name="l05998"></a><span class="lineno"> 5998</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05999"></a><span class="lineno"> 5999</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Entry : LargeOffsetGEPMap) {</div>
<div class="line"><a name="l06000"></a><span class="lineno"> 6000</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *OldBase = Entry.first;</div>
<div class="line"><a name="l06001"></a><span class="lineno"> 6001</span>&#160;    <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;std::pair&lt;AssertingVH&lt;GetElementPtrInst&gt;</a>, int64_t&gt;&gt;</div>
<div class="line"><a name="l06002"></a><span class="lineno"> 6002</span>&#160;        &amp;LargeOffsetGEPs = Entry.second;</div>
<div class="line"><a name="l06003"></a><span class="lineno"> 6003</span>&#160;    <span class="keyword">auto</span> compareGEPOffset =</div>
<div class="line"><a name="l06004"></a><span class="lineno"> 6004</span>&#160;        [&amp;](<span class="keyword">const</span> std::pair&lt;GetElementPtrInst *, int64_t&gt; &amp;<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>,</div>
<div class="line"><a name="l06005"></a><span class="lineno"> 6005</span>&#160;            <span class="keyword">const</span> std::pair&lt;GetElementPtrInst *, int64_t&gt; &amp;<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) {</div>
<div class="line"><a name="l06006"></a><span class="lineno"> 6006</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>.first == <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>.first)</div>
<div class="line"><a name="l06007"></a><span class="lineno"> 6007</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06008"></a><span class="lineno"> 6008</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>.second != <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>.second)</div>
<div class="line"><a name="l06009"></a><span class="lineno"> 6009</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>.second &lt; <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>.second;</div>
<div class="line"><a name="l06010"></a><span class="lineno"> 6010</span>&#160;          <span class="keywordflow">return</span> LargeOffsetGEPID[<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>.first] &lt; LargeOffsetGEPID[<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>.first];</div>
<div class="line"><a name="l06011"></a><span class="lineno"> 6011</span>&#160;        };</div>
<div class="line"><a name="l06012"></a><span class="lineno"> 6012</span>&#160;    <span class="comment">// Sorting all the GEPs of the same data structures based on the offsets.</span></div>
<div class="line"><a name="l06013"></a><span class="lineno"> 6013</span>&#160;    <a class="code" href="namespacellvm.html#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a>(LargeOffsetGEPs, compareGEPOffset);</div>
<div class="line"><a name="l06014"></a><span class="lineno"> 6014</span>&#160;    LargeOffsetGEPs.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a563ffc2ff61c499b3be2e00100cb72fa">erase</a>(</div>
<div class="line"><a name="l06015"></a><span class="lineno"> 6015</span>&#160;        <a class="code" href="namespacellvm.html#a92be87f8a371f277f7260fb99592d5f4">std::unique</a>(LargeOffsetGEPs.begin(), LargeOffsetGEPs.end()),</div>
<div class="line"><a name="l06016"></a><span class="lineno"> 6016</span>&#160;        LargeOffsetGEPs.end());</div>
<div class="line"><a name="l06017"></a><span class="lineno"> 6017</span>&#160;    <span class="comment">// Skip if all the GEPs have the same offsets.</span></div>
<div class="line"><a name="l06018"></a><span class="lineno"> 6018</span>&#160;    <span class="keywordflow">if</span> (LargeOffsetGEPs.front().second == LargeOffsetGEPs.back().second)</div>
<div class="line"><a name="l06019"></a><span class="lineno"> 6019</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06020"></a><span class="lineno"> 6020</span>&#160;    <a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *BaseGEP = LargeOffsetGEPs.begin()-&gt;first;</div>
<div class="line"><a name="l06021"></a><span class="lineno"> 6021</span>&#160;    int64_t BaseOffset = LargeOffsetGEPs.begin()-&gt;second;</div>
<div class="line"><a name="l06022"></a><span class="lineno"> 6022</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *NewBaseGEP = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06023"></a><span class="lineno"> 6023</span>&#160; </div>
<div class="line"><a name="l06024"></a><span class="lineno"> 6024</span>&#160;    <span class="keyword">auto</span> *LargeOffsetGEP = LargeOffsetGEPs.begin();</div>
<div class="line"><a name="l06025"></a><span class="lineno"> 6025</span>&#160;    <span class="keywordflow">while</span> (LargeOffsetGEP != LargeOffsetGEPs.end()) {</div>
<div class="line"><a name="l06026"></a><span class="lineno"> 6026</span>&#160;      <a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = LargeOffsetGEP-&gt;first;</div>
<div class="line"><a name="l06027"></a><span class="lineno"> 6027</span>&#160;      int64_t <a class="code" href="ELFObjHandler_8cpp.html#a250e66aa31a03567cc345ca1bc463b8c">Offset</a> = LargeOffsetGEP-&gt;second;</div>
<div class="line"><a name="l06028"></a><span class="lineno"> 6028</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="ELFObjHandler_8cpp.html#a250e66aa31a03567cc345ca1bc463b8c">Offset</a> != BaseOffset) {</div>
<div class="line"><a name="l06029"></a><span class="lineno"> 6029</span>&#160;        <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">TargetLowering::AddrMode</a> <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>;</div>
<div class="line"><a name="l06030"></a><span class="lineno"> 6030</span>&#160;        <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>.BaseOffs = <a class="code" href="ELFObjHandler_8cpp.html#a250e66aa31a03567cc345ca1bc463b8c">Offset</a> - BaseOffset;</div>
<div class="line"><a name="l06031"></a><span class="lineno"> 6031</span>&#160;        <span class="comment">// The result type of the GEP might not be the type of the memory</span></div>
<div class="line"><a name="l06032"></a><span class="lineno"> 6032</span>&#160;        <span class="comment">// access.</span></div>
<div class="line"><a name="l06033"></a><span class="lineno"> 6033</span>&#160;        <span class="keywordflow">if</span> (!TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#afa3aef362a1dcff57193d4e6a54f7044">isLegalAddressingMode</a>(*<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a>,</div>
<div class="line"><a name="l06034"></a><span class="lineno"> 6034</span>&#160;                                        <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getResultElementType(),</div>
<div class="line"><a name="l06035"></a><span class="lineno"> 6035</span>&#160;                                        <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getAddressSpace())) {</div>
<div class="line"><a name="l06036"></a><span class="lineno"> 6036</span>&#160;          <span class="comment">// We need to create a new base if the offset to the current base is</span></div>
<div class="line"><a name="l06037"></a><span class="lineno"> 6037</span>&#160;          <span class="comment">// too large to fit into the addressing mode. So, a very large struct</span></div>
<div class="line"><a name="l06038"></a><span class="lineno"> 6038</span>&#160;          <span class="comment">// may be split into several parts.</span></div>
<div class="line"><a name="l06039"></a><span class="lineno"> 6039</span>&#160;          BaseGEP = <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>;</div>
<div class="line"><a name="l06040"></a><span class="lineno"> 6040</span>&#160;          BaseOffset = <a class="code" href="ELFObjHandler_8cpp.html#a250e66aa31a03567cc345ca1bc463b8c">Offset</a>;</div>
<div class="line"><a name="l06041"></a><span class="lineno"> 6041</span>&#160;          NewBaseGEP = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06042"></a><span class="lineno"> 6042</span>&#160;        }</div>
<div class="line"><a name="l06043"></a><span class="lineno"> 6043</span>&#160;      }</div>
<div class="line"><a name="l06044"></a><span class="lineno"> 6044</span>&#160; </div>
<div class="line"><a name="l06045"></a><span class="lineno"> 6045</span>&#160;      <span class="comment">// Generate a new GEP to replace the current one.</span></div>
<div class="line"><a name="l06046"></a><span class="lineno"> 6046</span>&#160;      <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx = <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getContext();</div>
<div class="line"><a name="l06047"></a><span class="lineno"> 6047</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *IntPtrTy = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getIntPtrType(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getType());</div>
<div class="line"><a name="l06048"></a><span class="lineno"> 6048</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *I8PtrTy =</div>
<div class="line"><a name="l06049"></a><span class="lineno"> 6049</span>&#160;          Type::getInt8PtrTy(Ctx, <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getType()-&gt;getPointerAddressSpace());</div>
<div class="line"><a name="l06050"></a><span class="lineno"> 6050</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *I8Ty = Type::getInt8Ty(Ctx);</div>
<div class="line"><a name="l06051"></a><span class="lineno"> 6051</span>&#160; </div>
<div class="line"><a name="l06052"></a><span class="lineno"> 6052</span>&#160;      <span class="keywordflow">if</span> (!NewBaseGEP) {</div>
<div class="line"><a name="l06053"></a><span class="lineno"> 6053</span>&#160;        <span class="comment">// Create a new base if we don&#39;t have one yet.  Find the insertion</span></div>
<div class="line"><a name="l06054"></a><span class="lineno"> 6054</span>&#160;        <span class="comment">// pointer for the new base first.</span></div>
<div class="line"><a name="l06055"></a><span class="lineno"> 6055</span>&#160;        <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> NewBaseInsertPt;</div>
<div class="line"><a name="l06056"></a><span class="lineno"> 6056</span>&#160;        <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *NewBaseInsertBB;</div>
<div class="line"><a name="l06057"></a><span class="lineno"> 6057</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *BaseI = dyn_cast&lt;Instruction&gt;(OldBase)) {</div>
<div class="line"><a name="l06058"></a><span class="lineno"> 6058</span>&#160;          <span class="comment">// If the base of the struct is an instruction, the new base will be</span></div>
<div class="line"><a name="l06059"></a><span class="lineno"> 6059</span>&#160;          <span class="comment">// inserted close to it.</span></div>
<div class="line"><a name="l06060"></a><span class="lineno"> 6060</span>&#160;          NewBaseInsertBB = BaseI-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a38bee869ad41aebfef3de2641b12004c">getParent</a>();</div>
<div class="line"><a name="l06061"></a><span class="lineno"> 6061</span>&#160;          <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(BaseI))</div>
<div class="line"><a name="l06062"></a><span class="lineno"> 6062</span>&#160;            NewBaseInsertPt = NewBaseInsertBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</div>
<div class="line"><a name="l06063"></a><span class="lineno"> 6063</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *Invoke = dyn_cast&lt;InvokeInst&gt;(BaseI)) {</div>
<div class="line"><a name="l06064"></a><span class="lineno"> 6064</span>&#160;            NewBaseInsertBB =</div>
<div class="line"><a name="l06065"></a><span class="lineno"> 6065</span>&#160;                <a class="code" href="namespacellvm.html#adf83581f514774264d616eef5706cf6e">SplitEdge</a>(NewBaseInsertBB, Invoke-&gt;getNormalDest());</div>
<div class="line"><a name="l06066"></a><span class="lineno"> 6066</span>&#160;            NewBaseInsertPt = NewBaseInsertBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</div>
<div class="line"><a name="l06067"></a><span class="lineno"> 6067</span>&#160;          } <span class="keywordflow">else</span></div>
<div class="line"><a name="l06068"></a><span class="lineno"> 6068</span>&#160;            NewBaseInsertPt = std::next(BaseI-&gt;getIterator());</div>
<div class="line"><a name="l06069"></a><span class="lineno"> 6069</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06070"></a><span class="lineno"> 6070</span>&#160;          <span class="comment">// If the current base is an argument or global value, the new base</span></div>
<div class="line"><a name="l06071"></a><span class="lineno"> 6071</span>&#160;          <span class="comment">// will be inserted to the entry block.</span></div>
<div class="line"><a name="l06072"></a><span class="lineno"> 6072</span>&#160;          NewBaseInsertBB = &amp;BaseGEP-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>()-&gt;<a class="code" href="classllvm_1_1Function.html#ae6a4da5f41fc6a36735cc1704c01ce60">getEntryBlock</a>();</div>
<div class="line"><a name="l06073"></a><span class="lineno"> 6073</span>&#160;          NewBaseInsertPt = NewBaseInsertBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</div>
<div class="line"><a name="l06074"></a><span class="lineno"> 6074</span>&#160;        }</div>
<div class="line"><a name="l06075"></a><span class="lineno"> 6075</span>&#160;        <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> NewBaseBuilder(NewBaseInsertBB, NewBaseInsertPt);</div>
<div class="line"><a name="l06076"></a><span class="lineno"> 6076</span>&#160;        <span class="comment">// Create a new base.</span></div>
<div class="line"><a name="l06077"></a><span class="lineno"> 6077</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *BaseIndex = <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantInt::get</a>(IntPtrTy, BaseOffset);</div>
<div class="line"><a name="l06078"></a><span class="lineno"> 6078</span>&#160;        NewBaseGEP = OldBase;</div>
<div class="line"><a name="l06079"></a><span class="lineno"> 6079</span>&#160;        <span class="keywordflow">if</span> (NewBaseGEP-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() != I8PtrTy)</div>
<div class="line"><a name="l06080"></a><span class="lineno"> 6080</span>&#160;          NewBaseGEP = NewBaseBuilder.CreatePointerCast(NewBaseGEP, I8PtrTy);</div>
<div class="line"><a name="l06081"></a><span class="lineno"> 6081</span>&#160;        NewBaseGEP =</div>
<div class="line"><a name="l06082"></a><span class="lineno"> 6082</span>&#160;            NewBaseBuilder.CreateGEP(I8Ty, NewBaseGEP, BaseIndex, <span class="stringliteral">&quot;splitgep&quot;</span>);</div>
<div class="line"><a name="l06083"></a><span class="lineno"> 6083</span>&#160;        NewGEPBases.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(NewBaseGEP);</div>
<div class="line"><a name="l06084"></a><span class="lineno"> 6084</span>&#160;      }</div>
<div class="line"><a name="l06085"></a><span class="lineno"> 6085</span>&#160; </div>
<div class="line"><a name="l06086"></a><span class="lineno"> 6086</span>&#160;      <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>);</div>
<div class="line"><a name="l06087"></a><span class="lineno"> 6087</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *NewGEP = NewBaseGEP;</div>
<div class="line"><a name="l06088"></a><span class="lineno"> 6088</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="ELFObjHandler_8cpp.html#a250e66aa31a03567cc345ca1bc463b8c">Offset</a> == BaseOffset) {</div>
<div class="line"><a name="l06089"></a><span class="lineno"> 6089</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getType() != I8PtrTy)</div>
<div class="line"><a name="l06090"></a><span class="lineno"> 6090</span>&#160;          NewGEP = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePointerCast(NewGEP, <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getType());</div>
<div class="line"><a name="l06091"></a><span class="lineno"> 6091</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06092"></a><span class="lineno"> 6092</span>&#160;        <span class="comment">// Calculate the new offset for the new GEP.</span></div>
<div class="line"><a name="l06093"></a><span class="lineno"> 6093</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a> = <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantInt::get</a>(IntPtrTy, <a class="code" href="ELFObjHandler_8cpp.html#a250e66aa31a03567cc345ca1bc463b8c">Offset</a> - BaseOffset);</div>
<div class="line"><a name="l06094"></a><span class="lineno"> 6094</span>&#160;        NewGEP = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateGEP(I8Ty, NewBaseGEP, <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>);</div>
<div class="line"><a name="l06095"></a><span class="lineno"> 6095</span>&#160; </div>
<div class="line"><a name="l06096"></a><span class="lineno"> 6096</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getType() != I8PtrTy)</div>
<div class="line"><a name="l06097"></a><span class="lineno"> 6097</span>&#160;          NewGEP = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePointerCast(NewGEP, <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getType());</div>
<div class="line"><a name="l06098"></a><span class="lineno"> 6098</span>&#160;      }</div>
<div class="line"><a name="l06099"></a><span class="lineno"> 6099</span>&#160;      <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, NewGEP, FreshBBs, IsHugeFunc);</div>
<div class="line"><a name="l06100"></a><span class="lineno"> 6100</span>&#160;      LargeOffsetGEPID.<a class="code" href="classllvm_1_1DenseMapBase.html#a1eb8504bab5f794778d82db6ac829923">erase</a>(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>);</div>
<div class="line"><a name="l06101"></a><span class="lineno"> 6101</span>&#160;      LargeOffsetGEP = LargeOffsetGEPs.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a563ffc2ff61c499b3be2e00100cb72fa">erase</a>(LargeOffsetGEP);</div>
<div class="line"><a name="l06102"></a><span class="lineno"> 6102</span>&#160;      <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l06103"></a><span class="lineno"> 6103</span>&#160;      Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06104"></a><span class="lineno"> 6104</span>&#160;    }</div>
<div class="line"><a name="l06105"></a><span class="lineno"> 6105</span>&#160;  }</div>
<div class="line"><a name="l06106"></a><span class="lineno"> 6106</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l06107"></a><span class="lineno"> 6107</span>&#160;}</div>
<div class="line"><a name="l06108"></a><span class="lineno"> 6108</span>&#160; </div>
<div class="line"><a name="l06109"></a><span class="lineno"> 6109</span>&#160;<span class="keywordtype">bool</span> CodeGenPrepare::optimizePhiType(</div>
<div class="line"><a name="l06110"></a><span class="lineno"> 6110</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="classllvm_1_1SmallPtrSetImpl.html">SmallPtrSetImpl&lt;PHINode *&gt;</a> &amp;Visited,</div>
<div class="line"><a name="l06111"></a><span class="lineno"> 6111</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSetImpl.html">SmallPtrSetImpl&lt;Instruction *&gt;</a> &amp;DeletedInstrs) {</div>
<div class="line"><a name="l06112"></a><span class="lineno"> 6112</span>&#160;  <span class="comment">// We are looking for a collection on interconnected phi nodes that together</span></div>
<div class="line"><a name="l06113"></a><span class="lineno"> 6113</span>&#160;  <span class="comment">// only use loads/bitcasts and are used by stores/bitcasts, and the bitcasts</span></div>
<div class="line"><a name="l06114"></a><span class="lineno"> 6114</span>&#160;  <span class="comment">// are of the same type. Convert the whole set of nodes to the type of the</span></div>
<div class="line"><a name="l06115"></a><span class="lineno"> 6115</span>&#160;  <span class="comment">// bitcast.</span></div>
<div class="line"><a name="l06116"></a><span class="lineno"> 6116</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *PhiTy = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType();</div>
<div class="line"><a name="l06117"></a><span class="lineno"> 6117</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *ConvertTy = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06118"></a><span class="lineno"> 6118</span>&#160;  <span class="keywordflow">if</span> (Visited.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</div>
<div class="line"><a name="l06119"></a><span class="lineno"> 6119</span>&#160;      (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()-&gt;isIntegerTy() &amp;&amp; !<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()-&gt;isFloatingPointTy()))</div>
<div class="line"><a name="l06120"></a><span class="lineno"> 6120</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06121"></a><span class="lineno"> 6121</span>&#160; </div>
<div class="line"><a name="l06122"></a><span class="lineno"> 6122</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 4&gt;</a> Worklist;</div>
<div class="line"><a name="l06123"></a><span class="lineno"> 6123</span>&#160;  Worklist.push_back(cast&lt;Instruction&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</div>
<div class="line"><a name="l06124"></a><span class="lineno"> 6124</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;PHINode *, 4&gt;</a> PhiNodes;</div>
<div class="line"><a name="l06125"></a><span class="lineno"> 6125</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;ConstantData *, 4&gt;</a> <a class="code" href="namespacellvm_1_1dwarf.html#ab4fde659cfd2ad21ef1920dca7f22255">Constants</a>;</div>
<div class="line"><a name="l06126"></a><span class="lineno"> 6126</span>&#160;  PhiNodes.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l06127"></a><span class="lineno"> 6127</span>&#160;  Visited.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l06128"></a><span class="lineno"> 6128</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction *, 4&gt;</a> Defs;</div>
<div class="line"><a name="l06129"></a><span class="lineno"> 6129</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction *, 4&gt;</a> <a class="code" href="ARMLowOverheadLoops_8cpp.html#a0a0971d62011c35b29ff4a2325d45e93">Uses</a>;</div>
<div class="line"><a name="l06130"></a><span class="lineno"> 6130</span>&#160;  <span class="comment">// This works by adding extra bitcasts between load/stores and removing</span></div>
<div class="line"><a name="l06131"></a><span class="lineno"> 6131</span>&#160;  <span class="comment">// existing bicasts. If we have a phi(bitcast(load)) or a store(bitcast(phi))</span></div>
<div class="line"><a name="l06132"></a><span class="lineno"> 6132</span>&#160;  <span class="comment">// we can get in the situation where we remove a bitcast in one iteration</span></div>
<div class="line"><a name="l06133"></a><span class="lineno"> 6133</span>&#160;  <span class="comment">// just to add it again in the next. We need to ensure that at least one</span></div>
<div class="line"><a name="l06134"></a><span class="lineno"> 6134</span>&#160;  <span class="comment">// bitcast we remove are anchored to something that will not change back.</span></div>
<div class="line"><a name="l06135"></a><span class="lineno"> 6135</span>&#160;  <span class="keywordtype">bool</span> AnyAnchored = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06136"></a><span class="lineno"> 6136</span>&#160; </div>
<div class="line"><a name="l06137"></a><span class="lineno"> 6137</span>&#160;  <span class="keywordflow">while</span> (!Worklist.empty()) {</div>
<div class="line"><a name="l06138"></a><span class="lineno"> 6138</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *II = Worklist.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a0c8ffe664a36e30d49c84d0aded2fe08">pop_back_val</a>();</div>
<div class="line"><a name="l06139"></a><span class="lineno"> 6139</span>&#160; </div>
<div class="line"><a name="l06140"></a><span class="lineno"> 6140</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Phi = dyn_cast&lt;PHINode&gt;(II)) {</div>
<div class="line"><a name="l06141"></a><span class="lineno"> 6141</span>&#160;      <span class="comment">// Handle Defs, which might also be PHI&#39;s</span></div>
<div class="line"><a name="l06142"></a><span class="lineno"> 6142</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : Phi-&gt;incoming_values()) {</div>
<div class="line"><a name="l06143"></a><span class="lineno"> 6143</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *OpPhi = dyn_cast&lt;PHINode&gt;(V)) {</div>
<div class="line"><a name="l06144"></a><span class="lineno"> 6144</span>&#160;          <span class="keywordflow">if</span> (!PhiNodes.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(OpPhi)) {</div>
<div class="line"><a name="l06145"></a><span class="lineno"> 6145</span>&#160;            <span class="keywordflow">if</span> (!Visited.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(OpPhi).second)</div>
<div class="line"><a name="l06146"></a><span class="lineno"> 6146</span>&#160;              <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06147"></a><span class="lineno"> 6147</span>&#160;            PhiNodes.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(OpPhi);</div>
<div class="line"><a name="l06148"></a><span class="lineno"> 6148</span>&#160;            Worklist.push_back(OpPhi);</div>
<div class="line"><a name="l06149"></a><span class="lineno"> 6149</span>&#160;          }</div>
<div class="line"><a name="l06150"></a><span class="lineno"> 6150</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *OpLoad = dyn_cast&lt;LoadInst&gt;(V)) {</div>
<div class="line"><a name="l06151"></a><span class="lineno"> 6151</span>&#160;          <span class="keywordflow">if</span> (!OpLoad-&gt;isSimple())</div>
<div class="line"><a name="l06152"></a><span class="lineno"> 6152</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06153"></a><span class="lineno"> 6153</span>&#160;          <span class="keywordflow">if</span> (Defs.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(OpLoad).second)</div>
<div class="line"><a name="l06154"></a><span class="lineno"> 6154</span>&#160;            Worklist.push_back(OpLoad);</div>
<div class="line"><a name="l06155"></a><span class="lineno"> 6155</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *OpEx = dyn_cast&lt;ExtractElementInst&gt;(V)) {</div>
<div class="line"><a name="l06156"></a><span class="lineno"> 6156</span>&#160;          <span class="keywordflow">if</span> (Defs.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(OpEx).second)</div>
<div class="line"><a name="l06157"></a><span class="lineno"> 6157</span>&#160;            Worklist.push_back(OpEx);</div>
<div class="line"><a name="l06158"></a><span class="lineno"> 6158</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *OpBC = dyn_cast&lt;BitCastInst&gt;(V)) {</div>
<div class="line"><a name="l06159"></a><span class="lineno"> 6159</span>&#160;          <span class="keywordflow">if</span> (!ConvertTy)</div>
<div class="line"><a name="l06160"></a><span class="lineno"> 6160</span>&#160;            ConvertTy = OpBC-&gt;getOperand(0)-&gt;getType();</div>
<div class="line"><a name="l06161"></a><span class="lineno"> 6161</span>&#160;          <span class="keywordflow">if</span> (OpBC-&gt;getOperand(0)-&gt;getType() != ConvertTy)</div>
<div class="line"><a name="l06162"></a><span class="lineno"> 6162</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06163"></a><span class="lineno"> 6163</span>&#160;          <span class="keywordflow">if</span> (Defs.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(OpBC).second) {</div>
<div class="line"><a name="l06164"></a><span class="lineno"> 6164</span>&#160;            Worklist.push_back(OpBC);</div>
<div class="line"><a name="l06165"></a><span class="lineno"> 6165</span>&#160;            AnyAnchored |= !isa&lt;LoadInst&gt;(OpBC-&gt;getOperand(0)) &amp;&amp;</div>
<div class="line"><a name="l06166"></a><span class="lineno"> 6166</span>&#160;                           !isa&lt;ExtractElementInst&gt;(OpBC-&gt;getOperand(0));</div>
<div class="line"><a name="l06167"></a><span class="lineno"> 6167</span>&#160;          }</div>
<div class="line"><a name="l06168"></a><span class="lineno"> 6168</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *OpC = dyn_cast&lt;ConstantData&gt;(V))</div>
<div class="line"><a name="l06169"></a><span class="lineno"> 6169</span>&#160;          <a class="code" href="namespacellvm_1_1dwarf.html#ab4fde659cfd2ad21ef1920dca7f22255">Constants</a>.insert(OpC);</div>
<div class="line"><a name="l06170"></a><span class="lineno"> 6170</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l06171"></a><span class="lineno"> 6171</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06172"></a><span class="lineno"> 6172</span>&#160;      }</div>
<div class="line"><a name="l06173"></a><span class="lineno"> 6173</span>&#160;    }</div>
<div class="line"><a name="l06174"></a><span class="lineno"> 6174</span>&#160; </div>
<div class="line"><a name="l06175"></a><span class="lineno"> 6175</span>&#160;    <span class="comment">// Handle uses which might also be phi&#39;s</span></div>
<div class="line"><a name="l06176"></a><span class="lineno"> 6176</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1User.html">User</a> *V : II-&gt;<a class="code" href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">users</a>()) {</div>
<div class="line"><a name="l06177"></a><span class="lineno"> 6177</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *OpPhi = dyn_cast&lt;PHINode&gt;(V)) {</div>
<div class="line"><a name="l06178"></a><span class="lineno"> 6178</span>&#160;        <span class="keywordflow">if</span> (!PhiNodes.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(OpPhi)) {</div>
<div class="line"><a name="l06179"></a><span class="lineno"> 6179</span>&#160;          <span class="keywordflow">if</span> (Visited.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(OpPhi))</div>
<div class="line"><a name="l06180"></a><span class="lineno"> 6180</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06181"></a><span class="lineno"> 6181</span>&#160;          PhiNodes.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(OpPhi);</div>
<div class="line"><a name="l06182"></a><span class="lineno"> 6182</span>&#160;          Visited.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(OpPhi);</div>
<div class="line"><a name="l06183"></a><span class="lineno"> 6183</span>&#160;          Worklist.push_back(OpPhi);</div>
<div class="line"><a name="l06184"></a><span class="lineno"> 6184</span>&#160;        }</div>
<div class="line"><a name="l06185"></a><span class="lineno"> 6185</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *OpStore = dyn_cast&lt;StoreInst&gt;(V)) {</div>
<div class="line"><a name="l06186"></a><span class="lineno"> 6186</span>&#160;        <span class="keywordflow">if</span> (!OpStore-&gt;isSimple() || OpStore-&gt;getOperand(0) != II)</div>
<div class="line"><a name="l06187"></a><span class="lineno"> 6187</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06188"></a><span class="lineno"> 6188</span>&#160;        <a class="code" href="ARMLowOverheadLoops_8cpp.html#a0a0971d62011c35b29ff4a2325d45e93">Uses</a>.insert(OpStore);</div>
<div class="line"><a name="l06189"></a><span class="lineno"> 6189</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *OpBC = dyn_cast&lt;BitCastInst&gt;(V)) {</div>
<div class="line"><a name="l06190"></a><span class="lineno"> 6190</span>&#160;        <span class="keywordflow">if</span> (!ConvertTy)</div>
<div class="line"><a name="l06191"></a><span class="lineno"> 6191</span>&#160;          ConvertTy = OpBC-&gt;getType();</div>
<div class="line"><a name="l06192"></a><span class="lineno"> 6192</span>&#160;        <span class="keywordflow">if</span> (OpBC-&gt;getType() != ConvertTy)</div>
<div class="line"><a name="l06193"></a><span class="lineno"> 6193</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06194"></a><span class="lineno"> 6194</span>&#160;        <a class="code" href="ARMLowOverheadLoops_8cpp.html#a0a0971d62011c35b29ff4a2325d45e93">Uses</a>.insert(OpBC);</div>
<div class="line"><a name="l06195"></a><span class="lineno"> 6195</span>&#160;        AnyAnchored |=</div>
<div class="line"><a name="l06196"></a><span class="lineno"> 6196</span>&#160;            <a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(OpBC-&gt;users(), [](<a class="code" href="classllvm_1_1User.html">User</a> *U) { return !isa&lt;StoreInst&gt;(U); });</div>
<div class="line"><a name="l06197"></a><span class="lineno"> 6197</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06198"></a><span class="lineno"> 6198</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06199"></a><span class="lineno"> 6199</span>&#160;      }</div>
<div class="line"><a name="l06200"></a><span class="lineno"> 6200</span>&#160;    }</div>
<div class="line"><a name="l06201"></a><span class="lineno"> 6201</span>&#160;  }</div>
<div class="line"><a name="l06202"></a><span class="lineno"> 6202</span>&#160; </div>
<div class="line"><a name="l06203"></a><span class="lineno"> 6203</span>&#160;  <span class="keywordflow">if</span> (!ConvertTy || !AnyAnchored ||</div>
<div class="line"><a name="l06204"></a><span class="lineno"> 6204</span>&#160;      !TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#af40372fc6c2f0c6fea698d32c6730166">shouldConvertPhiType</a>(PhiTy, ConvertTy))</div>
<div class="line"><a name="l06205"></a><span class="lineno"> 6205</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06206"></a><span class="lineno"> 6206</span>&#160; </div>
<div class="line"><a name="l06207"></a><span class="lineno"> 6207</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Converting &quot;</span> &lt;&lt; *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; <span class="stringliteral">&quot;\n  and connected nodes to &quot;</span></div>
<div class="line"><a name="l06208"></a><span class="lineno"> 6208</span>&#160;                    &lt;&lt; *ConvertTy &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l06209"></a><span class="lineno"> 6209</span>&#160; </div>
<div class="line"><a name="l06210"></a><span class="lineno"> 6210</span>&#160;  <span class="comment">// Create all the new phi nodes of the new type, and bitcast any loads to the</span></div>
<div class="line"><a name="l06211"></a><span class="lineno"> 6211</span>&#160;  <span class="comment">// correct type.</span></div>
<div class="line"><a name="l06212"></a><span class="lineno"> 6212</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">ValueToValueMap</a> ValMap;</div>
<div class="line"><a name="l06213"></a><span class="lineno"> 6213</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ConstantData.html">ConstantData</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> : <a class="code" href="namespacellvm_1_1dwarf.html#ab4fde659cfd2ad21ef1920dca7f22255">Constants</a>)</div>
<div class="line"><a name="l06214"></a><span class="lineno"> 6214</span>&#160;    ValMap[<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>] = ConstantExpr::getCast(Instruction::BitCast, <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>, ConvertTy);</div>
<div class="line"><a name="l06215"></a><span class="lineno"> 6215</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a> : Defs) {</div>
<div class="line"><a name="l06216"></a><span class="lineno"> 6216</span>&#160;    <span class="keywordflow">if</span> (isa&lt;BitCastInst&gt;(<a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>)) {</div>
<div class="line"><a name="l06217"></a><span class="lineno"> 6217</span>&#160;      ValMap[<a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>] = <a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>-&gt;getOperand(0);</div>
<div class="line"><a name="l06218"></a><span class="lineno"> 6218</span>&#160;      DeletedInstrs.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(<a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>);</div>
<div class="line"><a name="l06219"></a><span class="lineno"> 6219</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06220"></a><span class="lineno"> 6220</span>&#160;      ValMap[<a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>] =</div>
<div class="line"><a name="l06221"></a><span class="lineno"> 6221</span>&#160;          <span class="keyword">new</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a>(<a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>, ConvertTy, <a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>-&gt;getName() + <span class="stringliteral">&quot;.bc&quot;</span>, <a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>-&gt;getNextNode());</div>
<div class="line"><a name="l06222"></a><span class="lineno"> 6222</span>&#160;    }</div>
<div class="line"><a name="l06223"></a><span class="lineno"> 6223</span>&#160;  }</div>
<div class="line"><a name="l06224"></a><span class="lineno"> 6224</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *Phi : PhiNodes)</div>
<div class="line"><a name="l06225"></a><span class="lineno"> 6225</span>&#160;    ValMap[Phi] = PHINode::Create(ConvertTy, Phi-&gt;getNumIncomingValues(),</div>
<div class="line"><a name="l06226"></a><span class="lineno"> 6226</span>&#160;                                  Phi-&gt;getName() + <span class="stringliteral">&quot;.tc&quot;</span>, Phi);</div>
<div class="line"><a name="l06227"></a><span class="lineno"> 6227</span>&#160;  <span class="comment">// Pipe together all the PhiNodes.</span></div>
<div class="line"><a name="l06228"></a><span class="lineno"> 6228</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *Phi : PhiNodes) {</div>
<div class="line"><a name="l06229"></a><span class="lineno"> 6229</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *NewPhi = cast&lt;PHINode&gt;(ValMap[Phi]);</div>
<div class="line"><a name="l06230"></a><span class="lineno"> 6230</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = Phi-&gt;getNumIncomingValues(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l06231"></a><span class="lineno"> 6231</span>&#160;      NewPhi-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(ValMap[Phi-&gt;getIncomingValue(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)],</div>
<div class="line"><a name="l06232"></a><span class="lineno"> 6232</span>&#160;                          Phi-&gt;getIncomingBlock(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div>
<div class="line"><a name="l06233"></a><span class="lineno"> 6233</span>&#160;    Visited.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(NewPhi);</div>
<div class="line"><a name="l06234"></a><span class="lineno"> 6234</span>&#160;  }</div>
<div class="line"><a name="l06235"></a><span class="lineno"> 6235</span>&#160;  <span class="comment">// And finally pipe up the stores and bitcasts</span></div>
<div class="line"><a name="l06236"></a><span class="lineno"> 6236</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *U : <a class="code" href="ARMLowOverheadLoops_8cpp.html#a0a0971d62011c35b29ff4a2325d45e93">Uses</a>) {</div>
<div class="line"><a name="l06237"></a><span class="lineno"> 6237</span>&#160;    <span class="keywordflow">if</span> (isa&lt;BitCastInst&gt;(U)) {</div>
<div class="line"><a name="l06238"></a><span class="lineno"> 6238</span>&#160;      DeletedInstrs.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(U);</div>
<div class="line"><a name="l06239"></a><span class="lineno"> 6239</span>&#160;      <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(U, ValMap[U-&gt;getOperand(0)], FreshBBs, IsHugeFunc);</div>
<div class="line"><a name="l06240"></a><span class="lineno"> 6240</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06241"></a><span class="lineno"> 6241</span>&#160;      U-&gt;setOperand(0,</div>
<div class="line"><a name="l06242"></a><span class="lineno"> 6242</span>&#160;                    <span class="keyword">new</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a>(ValMap[U-&gt;getOperand(0)], PhiTy, <span class="stringliteral">&quot;bc&quot;</span>, U));</div>
<div class="line"><a name="l06243"></a><span class="lineno"> 6243</span>&#160;    }</div>
<div class="line"><a name="l06244"></a><span class="lineno"> 6244</span>&#160;  }</div>
<div class="line"><a name="l06245"></a><span class="lineno"> 6245</span>&#160; </div>
<div class="line"><a name="l06246"></a><span class="lineno"> 6246</span>&#160;  <span class="comment">// Save the removed phis to be deleted later.</span></div>
<div class="line"><a name="l06247"></a><span class="lineno"> 6247</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *Phi : PhiNodes)</div>
<div class="line"><a name="l06248"></a><span class="lineno"> 6248</span>&#160;    DeletedInstrs.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(Phi);</div>
<div class="line"><a name="l06249"></a><span class="lineno"> 6249</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l06250"></a><span class="lineno"> 6250</span>&#160;}</div>
<div class="line"><a name="l06251"></a><span class="lineno"> 6251</span>&#160; </div>
<div class="line"><a name="l06252"></a><span class="lineno"> 6252</span>&#160;<span class="keywordtype">bool</span> CodeGenPrepare::optimizePhiTypes(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l06253"></a><span class="lineno"> 6253</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="CodeGenPrepare_8cpp.html#a8df3f534fddc483247fee64ac7e0a0f9">OptimizePhiTypes</a>)</div>
<div class="line"><a name="l06254"></a><span class="lineno"> 6254</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06255"></a><span class="lineno"> 6255</span>&#160; </div>
<div class="line"><a name="l06256"></a><span class="lineno"> 6256</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06257"></a><span class="lineno"> 6257</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;PHINode *, 4&gt;</a> Visited;</div>
<div class="line"><a name="l06258"></a><span class="lineno"> 6258</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction *, 4&gt;</a> DeletedInstrs;</div>
<div class="line"><a name="l06259"></a><span class="lineno"> 6259</span>&#160; </div>
<div class="line"><a name="l06260"></a><span class="lineno"> 6260</span>&#160;  <span class="comment">// Attempt to optimize all the phis in the functions to the correct type.</span></div>
<div class="line"><a name="l06261"></a><span class="lineno"> 6261</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> : <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</div>
<div class="line"><a name="l06262"></a><span class="lineno"> 6262</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Phi : <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>.phis())</div>
<div class="line"><a name="l06263"></a><span class="lineno"> 6263</span>&#160;      Changed |= optimizePhiType(&amp;Phi, Visited, DeletedInstrs);</div>
<div class="line"><a name="l06264"></a><span class="lineno"> 6264</span>&#160; </div>
<div class="line"><a name="l06265"></a><span class="lineno"> 6265</span>&#160;  <span class="comment">// Remove any old phi&#39;s that have been converted.</span></div>
<div class="line"><a name="l06266"></a><span class="lineno"> 6266</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : DeletedInstrs) {</div>
<div class="line"><a name="l06267"></a><span class="lineno"> 6267</span>&#160;    <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">PoisonValue::get</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()), FreshBBs, IsHugeFunc);</div>
<div class="line"><a name="l06268"></a><span class="lineno"> 6268</span>&#160;    <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l06269"></a><span class="lineno"> 6269</span>&#160;  }</div>
<div class="line"><a name="l06270"></a><span class="lineno"> 6270</span>&#160; </div>
<div class="line"><a name="l06271"></a><span class="lineno"> 6271</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l06272"></a><span class="lineno"> 6272</span>&#160;}</div>
<div class="line"><a name="l06273"></a><span class="lineno"> 6273</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l06274"></a><span class="lineno"> 6274</span>&#160;<span class="comment">/// Return true, if an ext(load) can be formed from an extension in</span></div>
<div class="line"><a name="l06275"></a><span class="lineno"> 6275</span>&#160;<span class="comment">/// \p MovedExts.</span></div>
<div class="line"><a name="l06276"></a><span class="lineno"> 6276</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CodeGenPrepare::canFormExtLd(</div>
<div class="line"><a name="l06277"></a><span class="lineno"> 6277</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;MovedExts, <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *&amp;LI,</div>
<div class="line"><a name="l06278"></a><span class="lineno"> 6278</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *&amp;Inst, <span class="keywordtype">bool</span> HasPromoted) {</div>
<div class="line"><a name="l06279"></a><span class="lineno"> 6279</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *MovedExtInst : MovedExts) {</div>
<div class="line"><a name="l06280"></a><span class="lineno"> 6280</span>&#160;    <span class="keywordflow">if</span> (isa&lt;LoadInst&gt;(MovedExtInst-&gt;getOperand(0))) {</div>
<div class="line"><a name="l06281"></a><span class="lineno"> 6281</span>&#160;      LI = cast&lt;LoadInst&gt;(MovedExtInst-&gt;getOperand(0));</div>
<div class="line"><a name="l06282"></a><span class="lineno"> 6282</span>&#160;      Inst = MovedExtInst;</div>
<div class="line"><a name="l06283"></a><span class="lineno"> 6283</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06284"></a><span class="lineno"> 6284</span>&#160;    }</div>
<div class="line"><a name="l06285"></a><span class="lineno"> 6285</span>&#160;  }</div>
<div class="line"><a name="l06286"></a><span class="lineno"> 6286</span>&#160;  <span class="keywordflow">if</span> (!LI)</div>
<div class="line"><a name="l06287"></a><span class="lineno"> 6287</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06288"></a><span class="lineno"> 6288</span>&#160; </div>
<div class="line"><a name="l06289"></a><span class="lineno"> 6289</span>&#160;  <span class="comment">// If they&#39;re already in the same block, there&#39;s nothing to do.</span></div>
<div class="line"><a name="l06290"></a><span class="lineno"> 6290</span>&#160;  <span class="comment">// Make the cheap checks first if we did not promote.</span></div>
<div class="line"><a name="l06291"></a><span class="lineno"> 6291</span>&#160;  <span class="comment">// If we promoted, we need to check if it is indeed profitable.</span></div>
<div class="line"><a name="l06292"></a><span class="lineno"> 6292</span>&#160;  <span class="keywordflow">if</span> (!HasPromoted &amp;&amp; LI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() == Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>())</div>
<div class="line"><a name="l06293"></a><span class="lineno"> 6293</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06294"></a><span class="lineno"> 6294</span>&#160; </div>
<div class="line"><a name="l06295"></a><span class="lineno"> 6295</span>&#160;  <span class="keywordflow">return</span> TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a25aa6029f4af7a3baadbd476d76fcaff">isExtLoad</a>(LI, Inst, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l06296"></a><span class="lineno"> 6296</span>&#160;}</div>
<div class="line"><a name="l06297"></a><span class="lineno"> 6297</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l06298"></a><span class="lineno"> 6298</span>&#160;<span class="comment">/// Move a zext or sext fed by a load into the same basic block as the load,</span></div>
<div class="line"><a name="l06299"></a><span class="lineno"> 6299</span>&#160;<span class="comment">/// unless conditions are unfavorable. This allows SelectionDAG to fold the</span></div>
<div class="line"><a name="l06300"></a><span class="lineno"> 6300</span>&#160;<span class="comment">/// extend into the load.</span></div>
<div class="line"><a name="l06301"></a><span class="lineno"> 6301</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l06302"></a><span class="lineno"> 6302</span>&#160;<span class="comment">/// E.g.,</span></div>
<div class="line"><a name="l06303"></a><span class="lineno"> 6303</span>&#160;<span class="comment">/// \code</span></div>
<div class="line"><a name="l06304"></a><span class="lineno"> 6304</span>&#160;<span class="comment">/// %ld = load i32* %addr</span></div>
<div class="line"><a name="l06305"></a><span class="lineno"> 6305</span>&#160;<span class="comment">/// %add = add nuw i32 %ld, 4</span></div>
<div class="line"><a name="l06306"></a><span class="lineno"> 6306</span>&#160;<span class="comment">/// %zext = zext i32 %add to i64</span></div>
<div class="line"><a name="l06307"></a><span class="lineno"> 6307</span>&#160;<span class="comment"></span><span class="comment">// \endcode</span><span class="comment"></span></div>
<div class="line"><a name="l06308"></a><span class="lineno"> 6308</span>&#160;<span class="comment">/// =&gt;</span></div>
<div class="line"><a name="l06309"></a><span class="lineno"> 6309</span>&#160;<span class="comment">/// \code</span></div>
<div class="line"><a name="l06310"></a><span class="lineno"> 6310</span>&#160;<span class="comment">/// %ld = load i32* %addr</span></div>
<div class="line"><a name="l06311"></a><span class="lineno"> 6311</span>&#160;<span class="comment">/// %zext = zext i32 %ld to i64</span></div>
<div class="line"><a name="l06312"></a><span class="lineno"> 6312</span>&#160;<span class="comment">/// %add = add nuw i64 %zext, 4</span></div>
<div class="line"><a name="l06313"></a><span class="lineno"> 6313</span>&#160;<span class="comment">/// \encode</span></div>
<div class="line"><a name="l06314"></a><span class="lineno"> 6314</span>&#160;<span class="comment">/// Note that the promotion in %add to i64 is done in tryToPromoteExts(), which</span></div>
<div class="line"><a name="l06315"></a><span class="lineno"> 6315</span>&#160;<span class="comment">/// allow us to match zext(load i32*) to i64.</span></div>
<div class="line"><a name="l06316"></a><span class="lineno"> 6316</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l06317"></a><span class="lineno"> 6317</span>&#160;<span class="comment">/// Also, try to promote the computations used to obtain a sign extended</span></div>
<div class="line"><a name="l06318"></a><span class="lineno"> 6318</span>&#160;<span class="comment">/// value used into memory accesses.</span></div>
<div class="line"><a name="l06319"></a><span class="lineno"> 6319</span>&#160;<span class="comment">/// E.g.,</span></div>
<div class="line"><a name="l06320"></a><span class="lineno"> 6320</span>&#160;<span class="comment">/// \code</span></div>
<div class="line"><a name="l06321"></a><span class="lineno"> 6321</span>&#160;<span class="comment">/// a = add nsw i32 b, 3</span></div>
<div class="line"><a name="l06322"></a><span class="lineno"> 6322</span>&#160;<span class="comment">/// d = sext i32 a to i64</span></div>
<div class="line"><a name="l06323"></a><span class="lineno"> 6323</span>&#160;<span class="comment">/// e = getelementptr ..., i64 d</span></div>
<div class="line"><a name="l06324"></a><span class="lineno"> 6324</span>&#160;<span class="comment">/// \endcode</span></div>
<div class="line"><a name="l06325"></a><span class="lineno"> 6325</span>&#160;<span class="comment">/// =&gt;</span></div>
<div class="line"><a name="l06326"></a><span class="lineno"> 6326</span>&#160;<span class="comment">/// \code</span></div>
<div class="line"><a name="l06327"></a><span class="lineno"> 6327</span>&#160;<span class="comment">/// f = sext i32 b to i64</span></div>
<div class="line"><a name="l06328"></a><span class="lineno"> 6328</span>&#160;<span class="comment">/// a = add nsw i64 f, 3</span></div>
<div class="line"><a name="l06329"></a><span class="lineno"> 6329</span>&#160;<span class="comment">/// e = getelementptr ..., i64 a</span></div>
<div class="line"><a name="l06330"></a><span class="lineno"> 6330</span>&#160;<span class="comment">/// \endcode</span></div>
<div class="line"><a name="l06331"></a><span class="lineno"> 6331</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l06332"></a><span class="lineno"> 6332</span>&#160;<span class="comment">/// \p Inst[in/out] the extension may be modified during the process if some</span></div>
<div class="line"><a name="l06333"></a><span class="lineno"> 6333</span>&#160;<span class="comment">/// promotions apply.</span></div>
<div class="line"><a name="l06334"></a><span class="lineno"> 6334</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CodeGenPrepare::optimizeExt(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *&amp;Inst) {</div>
<div class="line"><a name="l06335"></a><span class="lineno"> 6335</span>&#160;  <span class="keywordtype">bool</span> AllowPromotionWithoutCommonHeader = <span class="keyword">false</span>;<span class="comment"></span></div>
<div class="line"><a name="l06336"></a><span class="lineno"> 6336</span>&#160;<span class="comment">  /// See if it is an interesting sext operations for the address type</span></div>
<div class="line"><a name="l06337"></a><span class="lineno"> 6337</span>&#160;<span class="comment">  /// promotion before trying to promote it, e.g., the ones with the right</span></div>
<div class="line"><a name="l06338"></a><span class="lineno"> 6338</span>&#160;<span class="comment">  /// type and used in memory accesses.</span></div>
<div class="line"><a name="l06339"></a><span class="lineno"> 6339</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> ATPConsiderable = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a9880b7512930d879440db073b536d362">shouldConsiderAddressTypePromotion</a>(</div>
<div class="line"><a name="l06340"></a><span class="lineno"> 6340</span>&#160;      *Inst, AllowPromotionWithoutCommonHeader);</div>
<div class="line"><a name="l06341"></a><span class="lineno"> 6341</span>&#160;  TypePromotionTransaction TPT(RemovedInsts);</div>
<div class="line"><a name="l06342"></a><span class="lineno"> 6342</span>&#160;  TypePromotionTransaction::ConstRestorationPt LastKnownGood =</div>
<div class="line"><a name="l06343"></a><span class="lineno"> 6343</span>&#160;      TPT.getRestorationPoint();</div>
<div class="line"><a name="l06344"></a><span class="lineno"> 6344</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 1&gt;</a> Exts;</div>
<div class="line"><a name="l06345"></a><span class="lineno"> 6345</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 2&gt;</a> SpeculativelyMovedExts;</div>
<div class="line"><a name="l06346"></a><span class="lineno"> 6346</span>&#160;  Exts.push_back(Inst);</div>
<div class="line"><a name="l06347"></a><span class="lineno"> 6347</span>&#160; </div>
<div class="line"><a name="l06348"></a><span class="lineno"> 6348</span>&#160;  <span class="keywordtype">bool</span> HasPromoted = tryToPromoteExts(TPT, Exts, SpeculativelyMovedExts);</div>
<div class="line"><a name="l06349"></a><span class="lineno"> 6349</span>&#160; </div>
<div class="line"><a name="l06350"></a><span class="lineno"> 6350</span>&#160;  <span class="comment">// Look for a load being extended.</span></div>
<div class="line"><a name="l06351"></a><span class="lineno"> 6351</span>&#160;  <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06352"></a><span class="lineno"> 6352</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ExtFedByLoad;</div>
<div class="line"><a name="l06353"></a><span class="lineno"> 6353</span>&#160; </div>
<div class="line"><a name="l06354"></a><span class="lineno"> 6354</span>&#160;  <span class="comment">// Try to promote a chain of computation if it allows to form an extended</span></div>
<div class="line"><a name="l06355"></a><span class="lineno"> 6355</span>&#160;  <span class="comment">// load.</span></div>
<div class="line"><a name="l06356"></a><span class="lineno"> 6356</span>&#160;  <span class="keywordflow">if</span> (canFormExtLd(SpeculativelyMovedExts, LI, ExtFedByLoad, HasPromoted)) {</div>
<div class="line"><a name="l06357"></a><span class="lineno"> 6357</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LI &amp;&amp; ExtFedByLoad &amp;&amp; <span class="stringliteral">&quot;Expect a valid load and extension&quot;</span>);</div>
<div class="line"><a name="l06358"></a><span class="lineno"> 6358</span>&#160;    TPT.commit();</div>
<div class="line"><a name="l06359"></a><span class="lineno"> 6359</span>&#160;    <span class="comment">// Move the extend into the same block as the load.</span></div>
<div class="line"><a name="l06360"></a><span class="lineno"> 6360</span>&#160;    ExtFedByLoad-&gt;<a class="code" href="classllvm_1_1Instruction.html#a54507f01d7d06127068ee0663233511d">moveAfter</a>(LI);</div>
<div class="line"><a name="l06361"></a><span class="lineno"> 6361</span>&#160;    ++NumExtsMoved;</div>
<div class="line"><a name="l06362"></a><span class="lineno"> 6362</span>&#160;    Inst = ExtFedByLoad;</div>
<div class="line"><a name="l06363"></a><span class="lineno"> 6363</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l06364"></a><span class="lineno"> 6364</span>&#160;  }</div>
<div class="line"><a name="l06365"></a><span class="lineno"> 6365</span>&#160; </div>
<div class="line"><a name="l06366"></a><span class="lineno"> 6366</span>&#160;  <span class="comment">// Continue promoting SExts if known as considerable depending on targets.</span></div>
<div class="line"><a name="l06367"></a><span class="lineno"> 6367</span>&#160;  <span class="keywordflow">if</span> (ATPConsiderable &amp;&amp;</div>
<div class="line"><a name="l06368"></a><span class="lineno"> 6368</span>&#160;      performAddressTypePromotion(Inst, AllowPromotionWithoutCommonHeader,</div>
<div class="line"><a name="l06369"></a><span class="lineno"> 6369</span>&#160;                                  HasPromoted, TPT, SpeculativelyMovedExts))</div>
<div class="line"><a name="l06370"></a><span class="lineno"> 6370</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l06371"></a><span class="lineno"> 6371</span>&#160; </div>
<div class="line"><a name="l06372"></a><span class="lineno"> 6372</span>&#160;  TPT.rollback(LastKnownGood);</div>
<div class="line"><a name="l06373"></a><span class="lineno"> 6373</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06374"></a><span class="lineno"> 6374</span>&#160;}</div>
<div class="line"><a name="l06375"></a><span class="lineno"> 6375</span>&#160; </div>
<div class="line"><a name="l06376"></a><span class="lineno"> 6376</span>&#160;<span class="comment">// Perform address type promotion if doing so is profitable.</span></div>
<div class="line"><a name="l06377"></a><span class="lineno"> 6377</span>&#160;<span class="comment">// If AllowPromotionWithoutCommonHeader == false, we should find other sext</span></div>
<div class="line"><a name="l06378"></a><span class="lineno"> 6378</span>&#160;<span class="comment">// instructions that sign extended the same initial value. However, if</span></div>
<div class="line"><a name="l06379"></a><span class="lineno"> 6379</span>&#160;<span class="comment">// AllowPromotionWithoutCommonHeader == true, we expect promoting the</span></div>
<div class="line"><a name="l06380"></a><span class="lineno"> 6380</span>&#160;<span class="comment">// extension is just profitable.</span></div>
<div class="line"><a name="l06381"></a><span class="lineno"> 6381</span>&#160;<span class="keywordtype">bool</span> CodeGenPrepare::performAddressTypePromotion(</div>
<div class="line"><a name="l06382"></a><span class="lineno"> 6382</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *&amp;Inst, <span class="keywordtype">bool</span> AllowPromotionWithoutCommonHeader,</div>
<div class="line"><a name="l06383"></a><span class="lineno"> 6383</span>&#160;    <span class="keywordtype">bool</span> HasPromoted, TypePromotionTransaction &amp;TPT,</div>
<div class="line"><a name="l06384"></a><span class="lineno"> 6384</span>&#160;    <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;SpeculativelyMovedExts) {</div>
<div class="line"><a name="l06385"></a><span class="lineno"> 6385</span>&#160;  <span class="keywordtype">bool</span> Promoted = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06386"></a><span class="lineno"> 6386</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction *, 1&gt;</a> UnhandledExts;</div>
<div class="line"><a name="l06387"></a><span class="lineno"> 6387</span>&#160;  <span class="keywordtype">bool</span> AllSeenFirst = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06388"></a><span class="lineno"> 6388</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : SpeculativelyMovedExts) {</div>
<div class="line"><a name="l06389"></a><span class="lineno"> 6389</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *HeadOfChain = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0);</div>
<div class="line"><a name="l06390"></a><span class="lineno"> 6390</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, Instruction *&gt;::iterator</a> AlreadySeen =</div>
<div class="line"><a name="l06391"></a><span class="lineno"> 6391</span>&#160;        SeenChainsForSExt.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(HeadOfChain);</div>
<div class="line"><a name="l06392"></a><span class="lineno"> 6392</span>&#160;    <span class="comment">// If there is an unhandled SExt which has the same header, try to promote</span></div>
<div class="line"><a name="l06393"></a><span class="lineno"> 6393</span>&#160;    <span class="comment">// it as well.</span></div>
<div class="line"><a name="l06394"></a><span class="lineno"> 6394</span>&#160;    <span class="keywordflow">if</span> (AlreadySeen != SeenChainsForSExt.<a class="code" href="classllvm_1_1DenseMapBase.html#a65520b9c67759099e313d0f4e7b5ff9e">end</a>()) {</div>
<div class="line"><a name="l06395"></a><span class="lineno"> 6395</span>&#160;      <span class="keywordflow">if</span> (AlreadySeen-&gt;second != <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l06396"></a><span class="lineno"> 6396</span>&#160;        UnhandledExts.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(AlreadySeen-&gt;second);</div>
<div class="line"><a name="l06397"></a><span class="lineno"> 6397</span>&#160;      AllSeenFirst = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06398"></a><span class="lineno"> 6398</span>&#160;    }</div>
<div class="line"><a name="l06399"></a><span class="lineno"> 6399</span>&#160;  }</div>
<div class="line"><a name="l06400"></a><span class="lineno"> 6400</span>&#160; </div>
<div class="line"><a name="l06401"></a><span class="lineno"> 6401</span>&#160;  <span class="keywordflow">if</span> (!AllSeenFirst || (AllowPromotionWithoutCommonHeader &amp;&amp;</div>
<div class="line"><a name="l06402"></a><span class="lineno"> 6402</span>&#160;                        SpeculativelyMovedExts.size() == 1)) {</div>
<div class="line"><a name="l06403"></a><span class="lineno"> 6403</span>&#160;    TPT.commit();</div>
<div class="line"><a name="l06404"></a><span class="lineno"> 6404</span>&#160;    <span class="keywordflow">if</span> (HasPromoted)</div>
<div class="line"><a name="l06405"></a><span class="lineno"> 6405</span>&#160;      Promoted = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06406"></a><span class="lineno"> 6406</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : SpeculativelyMovedExts) {</div>
<div class="line"><a name="l06407"></a><span class="lineno"> 6407</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *HeadOfChain = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0);</div>
<div class="line"><a name="l06408"></a><span class="lineno"> 6408</span>&#160;      SeenChainsForSExt[HeadOfChain] = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06409"></a><span class="lineno"> 6409</span>&#160;      ValToSExtendedUses[HeadOfChain].push_back(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l06410"></a><span class="lineno"> 6410</span>&#160;    }</div>
<div class="line"><a name="l06411"></a><span class="lineno"> 6411</span>&#160;    <span class="comment">// Update Inst as promotion happen.</span></div>
<div class="line"><a name="l06412"></a><span class="lineno"> 6412</span>&#160;    Inst = SpeculativelyMovedExts.pop_back_val();</div>
<div class="line"><a name="l06413"></a><span class="lineno"> 6413</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06414"></a><span class="lineno"> 6414</span>&#160;    <span class="comment">// This is the first chain visited from the header, keep the current chain</span></div>
<div class="line"><a name="l06415"></a><span class="lineno"> 6415</span>&#160;    <span class="comment">// as unhandled. Defer to promote this until we encounter another SExt</span></div>
<div class="line"><a name="l06416"></a><span class="lineno"> 6416</span>&#160;    <span class="comment">// chain derived from the same header.</span></div>
<div class="line"><a name="l06417"></a><span class="lineno"> 6417</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : SpeculativelyMovedExts) {</div>
<div class="line"><a name="l06418"></a><span class="lineno"> 6418</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *HeadOfChain = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0);</div>
<div class="line"><a name="l06419"></a><span class="lineno"> 6419</span>&#160;      SeenChainsForSExt[HeadOfChain] = Inst;</div>
<div class="line"><a name="l06420"></a><span class="lineno"> 6420</span>&#160;    }</div>
<div class="line"><a name="l06421"></a><span class="lineno"> 6421</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06422"></a><span class="lineno"> 6422</span>&#160;  }</div>
<div class="line"><a name="l06423"></a><span class="lineno"> 6423</span>&#160; </div>
<div class="line"><a name="l06424"></a><span class="lineno"> 6424</span>&#160;  <span class="keywordflow">if</span> (!AllSeenFirst &amp;&amp; !UnhandledExts.<a class="code" href="classllvm_1_1SmallPtrSetImplBase.html#af8a50544090e81ac83601aff8f4b0142">empty</a>())</div>
<div class="line"><a name="l06425"></a><span class="lineno"> 6425</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *VisitedSExt : UnhandledExts) {</div>
<div class="line"><a name="l06426"></a><span class="lineno"> 6426</span>&#160;      <span class="keywordflow">if</span> (RemovedInsts.count(VisitedSExt))</div>
<div class="line"><a name="l06427"></a><span class="lineno"> 6427</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06428"></a><span class="lineno"> 6428</span>&#160;      TypePromotionTransaction TPT(RemovedInsts);</div>
<div class="line"><a name="l06429"></a><span class="lineno"> 6429</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 1&gt;</a> Exts;</div>
<div class="line"><a name="l06430"></a><span class="lineno"> 6430</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 2&gt;</a> Chains;</div>
<div class="line"><a name="l06431"></a><span class="lineno"> 6431</span>&#160;      Exts.push_back(VisitedSExt);</div>
<div class="line"><a name="l06432"></a><span class="lineno"> 6432</span>&#160;      <span class="keywordtype">bool</span> HasPromoted = tryToPromoteExts(TPT, Exts, Chains);</div>
<div class="line"><a name="l06433"></a><span class="lineno"> 6433</span>&#160;      TPT.commit();</div>
<div class="line"><a name="l06434"></a><span class="lineno"> 6434</span>&#160;      <span class="keywordflow">if</span> (HasPromoted)</div>
<div class="line"><a name="l06435"></a><span class="lineno"> 6435</span>&#160;        Promoted = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06436"></a><span class="lineno"> 6436</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Chains) {</div>
<div class="line"><a name="l06437"></a><span class="lineno"> 6437</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *HeadOfChain = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0);</div>
<div class="line"><a name="l06438"></a><span class="lineno"> 6438</span>&#160;        <span class="comment">// Mark this as handled.</span></div>
<div class="line"><a name="l06439"></a><span class="lineno"> 6439</span>&#160;        SeenChainsForSExt[HeadOfChain] = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06440"></a><span class="lineno"> 6440</span>&#160;        ValToSExtendedUses[HeadOfChain].push_back(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l06441"></a><span class="lineno"> 6441</span>&#160;      }</div>
<div class="line"><a name="l06442"></a><span class="lineno"> 6442</span>&#160;    }</div>
<div class="line"><a name="l06443"></a><span class="lineno"> 6443</span>&#160;  <span class="keywordflow">return</span> Promoted;</div>
<div class="line"><a name="l06444"></a><span class="lineno"> 6444</span>&#160;}</div>
<div class="line"><a name="l06445"></a><span class="lineno"> 6445</span>&#160; </div>
<div class="line"><a name="l06446"></a><span class="lineno"> 6446</span>&#160;<span class="keywordtype">bool</span> CodeGenPrepare::optimizeExtUses(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l06447"></a><span class="lineno"> 6447</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *DefBB = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</div>
<div class="line"><a name="l06448"></a><span class="lineno"> 6448</span>&#160; </div>
<div class="line"><a name="l06449"></a><span class="lineno"> 6449</span>&#160;  <span class="comment">// If the result of a {s|z}ext and its source are both live out, rewrite all</span></div>
<div class="line"><a name="l06450"></a><span class="lineno"> 6450</span>&#160;  <span class="comment">// other uses of the source with result of extension.</span></div>
<div class="line"><a name="l06451"></a><span class="lineno"> 6451</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Src = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0);</div>
<div class="line"><a name="l06452"></a><span class="lineno"> 6452</span>&#160;  <span class="keywordflow">if</span> (Src-&gt;hasOneUse())</div>
<div class="line"><a name="l06453"></a><span class="lineno"> 6453</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06454"></a><span class="lineno"> 6454</span>&#160; </div>
<div class="line"><a name="l06455"></a><span class="lineno"> 6455</span>&#160;  <span class="comment">// Only do this xform if truncating is free.</span></div>
<div class="line"><a name="l06456"></a><span class="lineno"> 6456</span>&#160;  <span class="keywordflow">if</span> (!TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a6f992bc4ca89f1b5f0b34f5b29978c31">isTruncateFree</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType(), Src-&gt;getType()))</div>
<div class="line"><a name="l06457"></a><span class="lineno"> 6457</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06458"></a><span class="lineno"> 6458</span>&#160; </div>
<div class="line"><a name="l06459"></a><span class="lineno"> 6459</span>&#160;  <span class="comment">// Only safe to perform the optimization if the source is also defined in</span></div>
<div class="line"><a name="l06460"></a><span class="lineno"> 6460</span>&#160;  <span class="comment">// this block.</span></div>
<div class="line"><a name="l06461"></a><span class="lineno"> 6461</span>&#160;  <span class="keywordflow">if</span> (!isa&lt;Instruction&gt;(Src) || DefBB != cast&lt;Instruction&gt;(Src)-&gt;<a class="code" href="BasicAliasAnalysis_8cpp.html#a2675de1d8479c7b00387979714da43f7">getParent</a>())</div>
<div class="line"><a name="l06462"></a><span class="lineno"> 6462</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06463"></a><span class="lineno"> 6463</span>&#160; </div>
<div class="line"><a name="l06464"></a><span class="lineno"> 6464</span>&#160;  <span class="keywordtype">bool</span> DefIsLiveOut = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06465"></a><span class="lineno"> 6465</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1User.html">User</a> *U : <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;users()) {</div>
<div class="line"><a name="l06466"></a><span class="lineno"> 6466</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *UI = cast&lt;Instruction&gt;(U);</div>
<div class="line"><a name="l06467"></a><span class="lineno"> 6467</span>&#160; </div>
<div class="line"><a name="l06468"></a><span class="lineno"> 6468</span>&#160;    <span class="comment">// Figure out which BB this ext is used in.</span></div>
<div class="line"><a name="l06469"></a><span class="lineno"> 6469</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *UserBB = UI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l06470"></a><span class="lineno"> 6470</span>&#160;    <span class="keywordflow">if</span> (UserBB == DefBB)</div>
<div class="line"><a name="l06471"></a><span class="lineno"> 6471</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06472"></a><span class="lineno"> 6472</span>&#160;    DefIsLiveOut = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06473"></a><span class="lineno"> 6473</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06474"></a><span class="lineno"> 6474</span>&#160;  }</div>
<div class="line"><a name="l06475"></a><span class="lineno"> 6475</span>&#160;  <span class="keywordflow">if</span> (!DefIsLiveOut)</div>
<div class="line"><a name="l06476"></a><span class="lineno"> 6476</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06477"></a><span class="lineno"> 6477</span>&#160; </div>
<div class="line"><a name="l06478"></a><span class="lineno"> 6478</span>&#160;  <span class="comment">// Make sure none of the uses are PHI nodes.</span></div>
<div class="line"><a name="l06479"></a><span class="lineno"> 6479</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1User.html">User</a> *U : Src-&gt;users()) {</div>
<div class="line"><a name="l06480"></a><span class="lineno"> 6480</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *UI = cast&lt;Instruction&gt;(U);</div>
<div class="line"><a name="l06481"></a><span class="lineno"> 6481</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *UserBB = UI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l06482"></a><span class="lineno"> 6482</span>&#160;    <span class="keywordflow">if</span> (UserBB == DefBB)</div>
<div class="line"><a name="l06483"></a><span class="lineno"> 6483</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06484"></a><span class="lineno"> 6484</span>&#160;    <span class="comment">// Be conservative. We don&#39;t want this xform to end up introducing</span></div>
<div class="line"><a name="l06485"></a><span class="lineno"> 6485</span>&#160;    <span class="comment">// reloads just before load / store instructions.</span></div>
<div class="line"><a name="l06486"></a><span class="lineno"> 6486</span>&#160;    <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(UI) || isa&lt;LoadInst&gt;(UI) || isa&lt;StoreInst&gt;(UI))</div>
<div class="line"><a name="l06487"></a><span class="lineno"> 6487</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06488"></a><span class="lineno"> 6488</span>&#160;  }</div>
<div class="line"><a name="l06489"></a><span class="lineno"> 6489</span>&#160; </div>
<div class="line"><a name="l06490"></a><span class="lineno"> 6490</span>&#160;  <span class="comment">// InsertedTruncs - Only insert one trunc in each block once.</span></div>
<div class="line"><a name="l06491"></a><span class="lineno"> 6491</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;BasicBlock *, Instruction *&gt;</a> InsertedTruncs;</div>
<div class="line"><a name="l06492"></a><span class="lineno"> 6492</span>&#160; </div>
<div class="line"><a name="l06493"></a><span class="lineno"> 6493</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06494"></a><span class="lineno"> 6494</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U : Src-&gt;uses()) {</div>
<div class="line"><a name="l06495"></a><span class="lineno"> 6495</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1User.html">User</a> = cast&lt;Instruction&gt;(U.getUser());</div>
<div class="line"><a name="l06496"></a><span class="lineno"> 6496</span>&#160; </div>
<div class="line"><a name="l06497"></a><span class="lineno"> 6497</span>&#160;    <span class="comment">// Figure out which BB this ext is used in.</span></div>
<div class="line"><a name="l06498"></a><span class="lineno"> 6498</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *UserBB = <a class="code" href="classllvm_1_1User.html">User</a>-&gt;getParent();</div>
<div class="line"><a name="l06499"></a><span class="lineno"> 6499</span>&#160;    <span class="keywordflow">if</span> (UserBB == DefBB)</div>
<div class="line"><a name="l06500"></a><span class="lineno"> 6500</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06501"></a><span class="lineno"> 6501</span>&#160; </div>
<div class="line"><a name="l06502"></a><span class="lineno"> 6502</span>&#160;    <span class="comment">// Both src and def are live in this block. Rewrite the use.</span></div>
<div class="line"><a name="l06503"></a><span class="lineno"> 6503</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *&amp;InsertedTrunc = InsertedTruncs[UserBB];</div>
<div class="line"><a name="l06504"></a><span class="lineno"> 6504</span>&#160; </div>
<div class="line"><a name="l06505"></a><span class="lineno"> 6505</span>&#160;    <span class="keywordflow">if</span> (!InsertedTrunc) {</div>
<div class="line"><a name="l06506"></a><span class="lineno"> 6506</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPt = UserBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</div>
<div class="line"><a name="l06507"></a><span class="lineno"> 6507</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InsertPt != UserBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</div>
<div class="line"><a name="l06508"></a><span class="lineno"> 6508</span>&#160;      InsertedTrunc = <span class="keyword">new</span> <a class="code" href="classllvm_1_1TruncInst.html">TruncInst</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Src-&gt;getType(), <span class="stringliteral">&quot;&quot;</span>, &amp;*InsertPt);</div>
<div class="line"><a name="l06509"></a><span class="lineno"> 6509</span>&#160;      InsertedInsts.insert(InsertedTrunc);</div>
<div class="line"><a name="l06510"></a><span class="lineno"> 6510</span>&#160;    }</div>
<div class="line"><a name="l06511"></a><span class="lineno"> 6511</span>&#160; </div>
<div class="line"><a name="l06512"></a><span class="lineno"> 6512</span>&#160;    <span class="comment">// Replace a use of the {s|z}ext source with a use of the result.</span></div>
<div class="line"><a name="l06513"></a><span class="lineno"> 6513</span>&#160;    U = InsertedTrunc;</div>
<div class="line"><a name="l06514"></a><span class="lineno"> 6514</span>&#160;    ++NumExtUses;</div>
<div class="line"><a name="l06515"></a><span class="lineno"> 6515</span>&#160;    MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06516"></a><span class="lineno"> 6516</span>&#160;  }</div>
<div class="line"><a name="l06517"></a><span class="lineno"> 6517</span>&#160; </div>
<div class="line"><a name="l06518"></a><span class="lineno"> 6518</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div>
<div class="line"><a name="l06519"></a><span class="lineno"> 6519</span>&#160;}</div>
<div class="line"><a name="l06520"></a><span class="lineno"> 6520</span>&#160; </div>
<div class="line"><a name="l06521"></a><span class="lineno"> 6521</span>&#160;<span class="comment">// Find loads whose uses only use some of the loaded value&#39;s bits.  Add an &quot;and&quot;</span></div>
<div class="line"><a name="l06522"></a><span class="lineno"> 6522</span>&#160;<span class="comment">// just after the load if the target can fold this into one extload instruction,</span></div>
<div class="line"><a name="l06523"></a><span class="lineno"> 6523</span>&#160;<span class="comment">// with the hope of eliminating some of the other later &quot;and&quot; instructions using</span></div>
<div class="line"><a name="l06524"></a><span class="lineno"> 6524</span>&#160;<span class="comment">// the loaded value.  &quot;and&quot;s that are made trivially redundant by the insertion</span></div>
<div class="line"><a name="l06525"></a><span class="lineno"> 6525</span>&#160;<span class="comment">// of the new &quot;and&quot; are removed by this function, while others (e.g. those whose</span></div>
<div class="line"><a name="l06526"></a><span class="lineno"> 6526</span>&#160;<span class="comment">// path from the load goes through a phi) are left for isel to potentially</span></div>
<div class="line"><a name="l06527"></a><span class="lineno"> 6527</span>&#160;<span class="comment">// remove.</span></div>
<div class="line"><a name="l06528"></a><span class="lineno"> 6528</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l06529"></a><span class="lineno"> 6529</span>&#160;<span class="comment">// For example:</span></div>
<div class="line"><a name="l06530"></a><span class="lineno"> 6530</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l06531"></a><span class="lineno"> 6531</span>&#160;<span class="comment">// b0:</span></div>
<div class="line"><a name="l06532"></a><span class="lineno"> 6532</span>&#160;<span class="comment">//   x = load i32</span></div>
<div class="line"><a name="l06533"></a><span class="lineno"> 6533</span>&#160;<span class="comment">//   ...</span></div>
<div class="line"><a name="l06534"></a><span class="lineno"> 6534</span>&#160;<span class="comment">// b1:</span></div>
<div class="line"><a name="l06535"></a><span class="lineno"> 6535</span>&#160;<span class="comment">//   y = and x, 0xff</span></div>
<div class="line"><a name="l06536"></a><span class="lineno"> 6536</span>&#160;<span class="comment">//   z = use y</span></div>
<div class="line"><a name="l06537"></a><span class="lineno"> 6537</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l06538"></a><span class="lineno"> 6538</span>&#160;<span class="comment">// becomes:</span></div>
<div class="line"><a name="l06539"></a><span class="lineno"> 6539</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l06540"></a><span class="lineno"> 6540</span>&#160;<span class="comment">// b0:</span></div>
<div class="line"><a name="l06541"></a><span class="lineno"> 6541</span>&#160;<span class="comment">//   x = load i32</span></div>
<div class="line"><a name="l06542"></a><span class="lineno"> 6542</span>&#160;<span class="comment">//   x&#39; = and x, 0xff</span></div>
<div class="line"><a name="l06543"></a><span class="lineno"> 6543</span>&#160;<span class="comment">//   ...</span></div>
<div class="line"><a name="l06544"></a><span class="lineno"> 6544</span>&#160;<span class="comment">// b1:</span></div>
<div class="line"><a name="l06545"></a><span class="lineno"> 6545</span>&#160;<span class="comment">//   z = use x&#39;</span></div>
<div class="line"><a name="l06546"></a><span class="lineno"> 6546</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l06547"></a><span class="lineno"> 6547</span>&#160;<span class="comment">// whereas:</span></div>
<div class="line"><a name="l06548"></a><span class="lineno"> 6548</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l06549"></a><span class="lineno"> 6549</span>&#160;<span class="comment">// b0:</span></div>
<div class="line"><a name="l06550"></a><span class="lineno"> 6550</span>&#160;<span class="comment">//   x1 = load i32</span></div>
<div class="line"><a name="l06551"></a><span class="lineno"> 6551</span>&#160;<span class="comment">//   ...</span></div>
<div class="line"><a name="l06552"></a><span class="lineno"> 6552</span>&#160;<span class="comment">// b1:</span></div>
<div class="line"><a name="l06553"></a><span class="lineno"> 6553</span>&#160;<span class="comment">//   x2 = load i32</span></div>
<div class="line"><a name="l06554"></a><span class="lineno"> 6554</span>&#160;<span class="comment">//   ...</span></div>
<div class="line"><a name="l06555"></a><span class="lineno"> 6555</span>&#160;<span class="comment">// b2:</span></div>
<div class="line"><a name="l06556"></a><span class="lineno"> 6556</span>&#160;<span class="comment">//   x = phi x1, x2</span></div>
<div class="line"><a name="l06557"></a><span class="lineno"> 6557</span>&#160;<span class="comment">//   y = and x, 0xff</span></div>
<div class="line"><a name="l06558"></a><span class="lineno"> 6558</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l06559"></a><span class="lineno"> 6559</span>&#160;<span class="comment">// becomes (after a call to optimizeLoadExt for each load):</span></div>
<div class="line"><a name="l06560"></a><span class="lineno"> 6560</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l06561"></a><span class="lineno"> 6561</span>&#160;<span class="comment">// b0:</span></div>
<div class="line"><a name="l06562"></a><span class="lineno"> 6562</span>&#160;<span class="comment">//   x1 = load i32</span></div>
<div class="line"><a name="l06563"></a><span class="lineno"> 6563</span>&#160;<span class="comment">//   x1&#39; = and x1, 0xff</span></div>
<div class="line"><a name="l06564"></a><span class="lineno"> 6564</span>&#160;<span class="comment">//   ...</span></div>
<div class="line"><a name="l06565"></a><span class="lineno"> 6565</span>&#160;<span class="comment">// b1:</span></div>
<div class="line"><a name="l06566"></a><span class="lineno"> 6566</span>&#160;<span class="comment">//   x2 = load i32</span></div>
<div class="line"><a name="l06567"></a><span class="lineno"> 6567</span>&#160;<span class="comment">//   x2&#39; = and x2, 0xff</span></div>
<div class="line"><a name="l06568"></a><span class="lineno"> 6568</span>&#160;<span class="comment">//   ...</span></div>
<div class="line"><a name="l06569"></a><span class="lineno"> 6569</span>&#160;<span class="comment">// b2:</span></div>
<div class="line"><a name="l06570"></a><span class="lineno"> 6570</span>&#160;<span class="comment">//   x = phi x1&#39;, x2&#39;</span></div>
<div class="line"><a name="l06571"></a><span class="lineno"> 6571</span>&#160;<span class="comment">//   y = and x, 0xff</span></div>
<div class="line"><a name="l06572"></a><span class="lineno"> 6572</span>&#160;<span class="keywordtype">bool</span> CodeGenPrepare::optimizeLoadExt(<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a>) {</div>
<div class="line"><a name="l06573"></a><span class="lineno"> 6573</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;isSimple() || !<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;getType()-&gt;isIntOrPtrTy())</div>
<div class="line"><a name="l06574"></a><span class="lineno"> 6574</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06575"></a><span class="lineno"> 6575</span>&#160; </div>
<div class="line"><a name="l06576"></a><span class="lineno"> 6576</span>&#160;  <span class="comment">// Skip loads we&#39;ve already transformed.</span></div>
<div class="line"><a name="l06577"></a><span class="lineno"> 6577</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;hasOneUse() &amp;&amp;</div>
<div class="line"><a name="l06578"></a><span class="lineno"> 6578</span>&#160;      InsertedInsts.count(cast&lt;Instruction&gt;(*<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;user_begin())))</div>
<div class="line"><a name="l06579"></a><span class="lineno"> 6579</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06580"></a><span class="lineno"> 6580</span>&#160; </div>
<div class="line"><a name="l06581"></a><span class="lineno"> 6581</span>&#160;  <span class="comment">// Look at all uses of Load, looking through phis, to determine how many bits</span></div>
<div class="line"><a name="l06582"></a><span class="lineno"> 6582</span>&#160;  <span class="comment">// of the loaded value are needed.</span></div>
<div class="line"><a name="l06583"></a><span class="lineno"> 6583</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 8&gt;</a> WorkList;</div>
<div class="line"><a name="l06584"></a><span class="lineno"> 6584</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction *, 16&gt;</a> Visited;</div>
<div class="line"><a name="l06585"></a><span class="lineno"> 6585</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 8&gt;</a> AndsToMaybeRemove;</div>
<div class="line"><a name="l06586"></a><span class="lineno"> 6586</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *U : <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;users())</div>
<div class="line"><a name="l06587"></a><span class="lineno"> 6587</span>&#160;    WorkList.push_back(cast&lt;Instruction&gt;(U));</div>
<div class="line"><a name="l06588"></a><span class="lineno"> 6588</span>&#160; </div>
<div class="line"><a name="l06589"></a><span class="lineno"> 6589</span>&#160;  <a class="code" href="structllvm_1_1EVT.html">EVT</a> LoadResultVT = TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(*<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;getType());</div>
<div class="line"><a name="l06590"></a><span class="lineno"> 6590</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = LoadResultVT.<a class="code" href="structllvm_1_1EVT.html#a45e76d44a189e456d52e37ba3dda0fce">getSizeInBits</a>();</div>
<div class="line"><a name="l06591"></a><span class="lineno"> 6591</span>&#160;  <span class="comment">// If the BitWidth is 0, do not try to optimize the type</span></div>
<div class="line"><a name="l06592"></a><span class="lineno"> 6592</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> == 0)</div>
<div class="line"><a name="l06593"></a><span class="lineno"> 6593</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06594"></a><span class="lineno"> 6594</span>&#160; </div>
<div class="line"><a name="l06595"></a><span class="lineno"> 6595</span>&#160;  <a class="code" href="classllvm_1_1APInt.html">APInt</a> DemandBits(<a class="code" href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>, 0);</div>
<div class="line"><a name="l06596"></a><span class="lineno"> 6596</span>&#160;  <a class="code" href="classllvm_1_1APInt.html">APInt</a> WidestAndBits(<a class="code" href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>, 0);</div>
<div class="line"><a name="l06597"></a><span class="lineno"> 6597</span>&#160; </div>
<div class="line"><a name="l06598"></a><span class="lineno"> 6598</span>&#160;  <span class="keywordflow">while</span> (!WorkList.empty()) {</div>
<div class="line"><a name="l06599"></a><span class="lineno"> 6599</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = WorkList.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a0c8ffe664a36e30d49c84d0aded2fe08">pop_back_val</a>();</div>
<div class="line"><a name="l06600"></a><span class="lineno"> 6600</span>&#160; </div>
<div class="line"><a name="l06601"></a><span class="lineno"> 6601</span>&#160;    <span class="comment">// Break use-def graph loops.</span></div>
<div class="line"><a name="l06602"></a><span class="lineno"> 6602</span>&#160;    <span class="keywordflow">if</span> (!Visited.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>).second)</div>
<div class="line"><a name="l06603"></a><span class="lineno"> 6603</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06604"></a><span class="lineno"> 6604</span>&#160; </div>
<div class="line"><a name="l06605"></a><span class="lineno"> 6605</span>&#160;    <span class="comment">// For a PHI node, push all of its users.</span></div>
<div class="line"><a name="l06606"></a><span class="lineno"> 6606</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Phi = dyn_cast&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l06607"></a><span class="lineno"> 6607</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *U : Phi-&gt;users())</div>
<div class="line"><a name="l06608"></a><span class="lineno"> 6608</span>&#160;        WorkList.push_back(cast&lt;Instruction&gt;(U));</div>
<div class="line"><a name="l06609"></a><span class="lineno"> 6609</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06610"></a><span class="lineno"> 6610</span>&#160;    }</div>
<div class="line"><a name="l06611"></a><span class="lineno"> 6611</span>&#160; </div>
<div class="line"><a name="l06612"></a><span class="lineno"> 6612</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) {</div>
<div class="line"><a name="l06613"></a><span class="lineno"> 6613</span>&#160;    <span class="keywordflow">case</span> Instruction::And: {</div>
<div class="line"><a name="l06614"></a><span class="lineno"> 6614</span>&#160;      <span class="keyword">auto</span> *AndC = dyn_cast&lt;ConstantInt&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1));</div>
<div class="line"><a name="l06615"></a><span class="lineno"> 6615</span>&#160;      <span class="keywordflow">if</span> (!AndC)</div>
<div class="line"><a name="l06616"></a><span class="lineno"> 6616</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06617"></a><span class="lineno"> 6617</span>&#160;      <a class="code" href="classllvm_1_1APInt.html">APInt</a> AndBits = AndC-&gt;getValue();</div>
<div class="line"><a name="l06618"></a><span class="lineno"> 6618</span>&#160;      DemandBits |= AndBits;</div>
<div class="line"><a name="l06619"></a><span class="lineno"> 6619</span>&#160;      <span class="comment">// Keep track of the widest and mask we see.</span></div>
<div class="line"><a name="l06620"></a><span class="lineno"> 6620</span>&#160;      <span class="keywordflow">if</span> (AndBits.<a class="code" href="classllvm_1_1APInt.html#a46a7cbf3724080a5f4f4c7e7a4551e26">ugt</a>(WidestAndBits))</div>
<div class="line"><a name="l06621"></a><span class="lineno"> 6621</span>&#160;        WidestAndBits = AndBits;</div>
<div class="line"><a name="l06622"></a><span class="lineno"> 6622</span>&#160;      <span class="keywordflow">if</span> (AndBits == WidestAndBits &amp;&amp; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0) == <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a>)</div>
<div class="line"><a name="l06623"></a><span class="lineno"> 6623</span>&#160;        AndsToMaybeRemove.push_back(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l06624"></a><span class="lineno"> 6624</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06625"></a><span class="lineno"> 6625</span>&#160;    }</div>
<div class="line"><a name="l06626"></a><span class="lineno"> 6626</span>&#160; </div>
<div class="line"><a name="l06627"></a><span class="lineno"> 6627</span>&#160;    <span class="keywordflow">case</span> Instruction::Shl: {</div>
<div class="line"><a name="l06628"></a><span class="lineno"> 6628</span>&#160;      <span class="keyword">auto</span> *ShlC = dyn_cast&lt;ConstantInt&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1));</div>
<div class="line"><a name="l06629"></a><span class="lineno"> 6629</span>&#160;      <span class="keywordflow">if</span> (!ShlC)</div>
<div class="line"><a name="l06630"></a><span class="lineno"> 6630</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06631"></a><span class="lineno"> 6631</span>&#160;      <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> ShiftAmt = ShlC-&gt;<a class="code" href="classllvm_1_1APInt.html#ab01d8694a759a934e01f1c558c3ce862">getLimitedValue</a>(<a class="code" href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> - 1);</div>
<div class="line"><a name="l06632"></a><span class="lineno"> 6632</span>&#160;      DemandBits.setLowBits(<a class="code" href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> - ShiftAmt);</div>
<div class="line"><a name="l06633"></a><span class="lineno"> 6633</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06634"></a><span class="lineno"> 6634</span>&#160;    }</div>
<div class="line"><a name="l06635"></a><span class="lineno"> 6635</span>&#160; </div>
<div class="line"><a name="l06636"></a><span class="lineno"> 6636</span>&#160;    <span class="keywordflow">case</span> Instruction::Trunc: {</div>
<div class="line"><a name="l06637"></a><span class="lineno"> 6637</span>&#160;      <a class="code" href="structllvm_1_1EVT.html">EVT</a> TruncVT = TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(*<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType());</div>
<div class="line"><a name="l06638"></a><span class="lineno"> 6638</span>&#160;      <span class="keywordtype">unsigned</span> TruncBitWidth = TruncVT.<a class="code" href="structllvm_1_1EVT.html#a45e76d44a189e456d52e37ba3dda0fce">getSizeInBits</a>();</div>
<div class="line"><a name="l06639"></a><span class="lineno"> 6639</span>&#160;      DemandBits.setLowBits(TruncBitWidth);</div>
<div class="line"><a name="l06640"></a><span class="lineno"> 6640</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06641"></a><span class="lineno"> 6641</span>&#160;    }</div>
<div class="line"><a name="l06642"></a><span class="lineno"> 6642</span>&#160; </div>
<div class="line"><a name="l06643"></a><span class="lineno"> 6643</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l06644"></a><span class="lineno"> 6644</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06645"></a><span class="lineno"> 6645</span>&#160;    }</div>
<div class="line"><a name="l06646"></a><span class="lineno"> 6646</span>&#160;  }</div>
<div class="line"><a name="l06647"></a><span class="lineno"> 6647</span>&#160; </div>
<div class="line"><a name="l06648"></a><span class="lineno"> 6648</span>&#160;  <a class="code" href="classuint32__t.html">uint32_t</a> ActiveBits = DemandBits.getActiveBits();</div>
<div class="line"><a name="l06649"></a><span class="lineno"> 6649</span>&#160;  <span class="comment">// Avoid hoisting (and (load x) 1) since it is unlikely to be folded by the</span></div>
<div class="line"><a name="l06650"></a><span class="lineno"> 6650</span>&#160;  <span class="comment">// target even if isLoadExtLegal says an i1 EXTLOAD is valid.  For example,</span></div>
<div class="line"><a name="l06651"></a><span class="lineno"> 6651</span>&#160;  <span class="comment">// for the AArch64 target isLoadExtLegal(ZEXTLOAD, i32, i1) returns true, but</span></div>
<div class="line"><a name="l06652"></a><span class="lineno"> 6652</span>&#160;  <span class="comment">// (and (load x) 1) is not matched as a single instruction, rather as a LDR</span></div>
<div class="line"><a name="l06653"></a><span class="lineno"> 6653</span>&#160;  <span class="comment">// followed by an AND.</span></div>
<div class="line"><a name="l06654"></a><span class="lineno"> 6654</span>&#160;  <span class="comment">// TODO: Look into removing this restriction by fixing backends to either</span></div>
<div class="line"><a name="l06655"></a><span class="lineno"> 6655</span>&#160;  <span class="comment">// return false for isLoadExtLegal for i1 or have them select this pattern to</span></div>
<div class="line"><a name="l06656"></a><span class="lineno"> 6656</span>&#160;  <span class="comment">// a single instruction.</span></div>
<div class="line"><a name="l06657"></a><span class="lineno"> 6657</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l06658"></a><span class="lineno"> 6658</span>&#160;  <span class="comment">// Also avoid hoisting if we didn&#39;t see any ands with the exact DemandBits</span></div>
<div class="line"><a name="l06659"></a><span class="lineno"> 6659</span>&#160;  <span class="comment">// mask, since these are the only ands that will be removed by isel.</span></div>
<div class="line"><a name="l06660"></a><span class="lineno"> 6660</span>&#160;  <span class="keywordflow">if</span> (ActiveBits &lt;= 1 || !DemandBits.isMask(ActiveBits) ||</div>
<div class="line"><a name="l06661"></a><span class="lineno"> 6661</span>&#160;      WidestAndBits != DemandBits)</div>
<div class="line"><a name="l06662"></a><span class="lineno"> 6662</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06663"></a><span class="lineno"> 6663</span>&#160; </div>
<div class="line"><a name="l06664"></a><span class="lineno"> 6664</span>&#160;  <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx = <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;getType()-&gt;getContext();</div>
<div class="line"><a name="l06665"></a><span class="lineno"> 6665</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *TruncTy = Type::getIntNTy(Ctx, ActiveBits);</div>
<div class="line"><a name="l06666"></a><span class="lineno"> 6666</span>&#160;  <a class="code" href="structllvm_1_1EVT.html">EVT</a> TruncVT = TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(*<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, TruncTy);</div>
<div class="line"><a name="l06667"></a><span class="lineno"> 6667</span>&#160; </div>
<div class="line"><a name="l06668"></a><span class="lineno"> 6668</span>&#160;  <span class="comment">// Reject cases that won&#39;t be matched as extloads.</span></div>
<div class="line"><a name="l06669"></a><span class="lineno"> 6669</span>&#160;  <span class="keywordflow">if</span> (!LoadResultVT.<a class="code" href="structllvm_1_1EVT.html#a3ad406477784397709a339d5a2957b43">bitsGT</a>(TruncVT) || !TruncVT.<a class="code" href="structllvm_1_1EVT.html#ab41e50273c70287914ded0ae668bc507">isRound</a>() ||</div>
<div class="line"><a name="l06670"></a><span class="lineno"> 6670</span>&#160;      !TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#ab9933809d64070af5fc4400df7e38d58">isLoadExtLegal</a>(<a class="code" href="namespacellvm_1_1ISD.html#ad4d48171b87ca51ff54c10a436bac4d7a8d89c7da4444d9ec11667aa369abc5f7">ISD::ZEXTLOAD</a>, LoadResultVT, TruncVT))</div>
<div class="line"><a name="l06671"></a><span class="lineno"> 6671</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06672"></a><span class="lineno"> 6672</span>&#160; </div>
<div class="line"><a name="l06673"></a><span class="lineno"> 6673</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;getNextNode());</div>
<div class="line"><a name="l06674"></a><span class="lineno"> 6674</span>&#160;  <span class="keyword">auto</span> *NewAnd = cast&lt;Instruction&gt;(</div>
<div class="line"><a name="l06675"></a><span class="lineno"> 6675</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAnd(<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a>, <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantInt::get</a>(Ctx, DemandBits)));</div>
<div class="line"><a name="l06676"></a><span class="lineno"> 6676</span>&#160;  <span class="comment">// Mark this instruction as &quot;inserted by CGP&quot;, so that other</span></div>
<div class="line"><a name="l06677"></a><span class="lineno"> 6677</span>&#160;  <span class="comment">// optimizations don&#39;t touch it.</span></div>
<div class="line"><a name="l06678"></a><span class="lineno"> 6678</span>&#160;  InsertedInsts.insert(NewAnd);</div>
<div class="line"><a name="l06679"></a><span class="lineno"> 6679</span>&#160; </div>
<div class="line"><a name="l06680"></a><span class="lineno"> 6680</span>&#160;  <span class="comment">// Replace all uses of load with new and (except for the use of load in the</span></div>
<div class="line"><a name="l06681"></a><span class="lineno"> 6681</span>&#160;  <span class="comment">// new and itself).</span></div>
<div class="line"><a name="l06682"></a><span class="lineno"> 6682</span>&#160;  <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a>, NewAnd, FreshBBs, IsHugeFunc);</div>
<div class="line"><a name="l06683"></a><span class="lineno"> 6683</span>&#160;  NewAnd-&gt;setOperand(0, <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a>);</div>
<div class="line"><a name="l06684"></a><span class="lineno"> 6684</span>&#160; </div>
<div class="line"><a name="l06685"></a><span class="lineno"> 6685</span>&#160;  <span class="comment">// Remove any and instructions that are now redundant.</span></div>
<div class="line"><a name="l06686"></a><span class="lineno"> 6686</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *And : AndsToMaybeRemove)</div>
<div class="line"><a name="l06687"></a><span class="lineno"> 6687</span>&#160;    <span class="comment">// Check that the and mask is the same as the one we decided to put on the</span></div>
<div class="line"><a name="l06688"></a><span class="lineno"> 6688</span>&#160;    <span class="comment">// new and.</span></div>
<div class="line"><a name="l06689"></a><span class="lineno"> 6689</span>&#160;    <span class="keywordflow">if</span> (cast&lt;ConstantInt&gt;(<a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>-&gt;getOperand(1))-&gt;getValue() == DemandBits) {</div>
<div class="line"><a name="l06690"></a><span class="lineno"> 6690</span>&#160;      <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(And, NewAnd, FreshBBs, IsHugeFunc);</div>
<div class="line"><a name="l06691"></a><span class="lineno"> 6691</span>&#160;      <span class="keywordflow">if</span> (&amp;*CurInstIterator == And)</div>
<div class="line"><a name="l06692"></a><span class="lineno"> 6692</span>&#160;        CurInstIterator = std::next(<a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>-&gt;getIterator());</div>
<div class="line"><a name="l06693"></a><span class="lineno"> 6693</span>&#160;      <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l06694"></a><span class="lineno"> 6694</span>&#160;      ++NumAndUses;</div>
<div class="line"><a name="l06695"></a><span class="lineno"> 6695</span>&#160;    }</div>
<div class="line"><a name="l06696"></a><span class="lineno"> 6696</span>&#160; </div>
<div class="line"><a name="l06697"></a><span class="lineno"> 6697</span>&#160;  ++NumAndsAdded;</div>
<div class="line"><a name="l06698"></a><span class="lineno"> 6698</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l06699"></a><span class="lineno"> 6699</span>&#160;}</div>
<div class="line"><a name="l06700"></a><span class="lineno"> 6700</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l06701"></a><span class="lineno"> 6701</span>&#160;<span class="comment">/// Check if V (an operand of a select instruction) is an expensive instruction</span></div>
<div class="line"><a name="l06702"></a><span class="lineno"> 6702</span>&#160;<span class="comment">/// that is only used once.</span></div>
<div class="line"><a name="l06703"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#a10ece31d94cdd66e58cef49d73f2263f"> 6703</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CodeGenPrepare_8cpp.html#a10ece31d94cdd66e58cef49d73f2263f">sinkSelectOperand</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> *<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l06704"></a><span class="lineno"> 6704</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l06705"></a><span class="lineno"> 6705</span>&#160;  <span class="comment">// If it&#39;s safe to speculatively execute, then it should not have side</span></div>
<div class="line"><a name="l06706"></a><span class="lineno"> 6706</span>&#160;  <span class="comment">// effects; therefore, it&#39;s safe to sink and possibly *not* execute.</span></div>
<div class="line"><a name="l06707"></a><span class="lineno"> 6707</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUse() &amp;&amp; <a class="code" href="namespacellvm.html#abe76d72cda6b2b4562c72accb510040b">isSafeToSpeculativelyExecute</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</div>
<div class="line"><a name="l06708"></a><span class="lineno"> 6708</span>&#160;         <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a30646d63c1f1ca132d37dff17cf5daae">isExpensiveToSpeculativelyExecute</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l06709"></a><span class="lineno"> 6709</span>&#160;}</div>
<div class="line"><a name="l06710"></a><span class="lineno"> 6710</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l06711"></a><span class="lineno"> 6711</span>&#160;<span class="comment">/// Returns true if a SelectInst should be turned into an explicit branch.</span></div>
<div class="line"><a name="l06712"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#a4bde686b6506cc9e63919272711713f4"> 6712</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CodeGenPrepare_8cpp.html#a4bde686b6506cc9e63919272711713f4">isFormingBranchFromSelectProfitable</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> *<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>,</div>
<div class="line"><a name="l06713"></a><span class="lineno"> 6713</span>&#160;                                                <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> *TLI,</div>
<div class="line"><a name="l06714"></a><span class="lineno"> 6714</span>&#160;                                                <a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>) {</div>
<div class="line"><a name="l06715"></a><span class="lineno"> 6715</span>&#160;  <span class="comment">// If even a predictable select is cheap, then a branch can&#39;t be cheaper.</span></div>
<div class="line"><a name="l06716"></a><span class="lineno"> 6716</span>&#160;  <span class="keywordflow">if</span> (!TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#aa9f4cbd152c2c5d84007f3ad710ee895">isPredictableSelectExpensive</a>())</div>
<div class="line"><a name="l06717"></a><span class="lineno"> 6717</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06718"></a><span class="lineno"> 6718</span>&#160; </div>
<div class="line"><a name="l06719"></a><span class="lineno"> 6719</span>&#160;  <span class="comment">// FIXME: This should use the same heuristics as IfConversion to determine</span></div>
<div class="line"><a name="l06720"></a><span class="lineno"> 6720</span>&#160;  <span class="comment">// whether a select is better represented as a branch.</span></div>
<div class="line"><a name="l06721"></a><span class="lineno"> 6721</span>&#160; </div>
<div class="line"><a name="l06722"></a><span class="lineno"> 6722</span>&#160;  <span class="comment">// If metadata tells us that the select condition is obviously predictable,</span></div>
<div class="line"><a name="l06723"></a><span class="lineno"> 6723</span>&#160;  <span class="comment">// then we want to replace the select with a branch.</span></div>
<div class="line"><a name="l06724"></a><span class="lineno"> 6724</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> TrueWeight, FalseWeight;</div>
<div class="line"><a name="l06725"></a><span class="lineno"> 6725</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(*<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, TrueWeight, FalseWeight)) {</div>
<div class="line"><a name="l06726"></a><span class="lineno"> 6726</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Max = <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(TrueWeight, FalseWeight);</div>
<div class="line"><a name="l06727"></a><span class="lineno"> 6727</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Sum = TrueWeight + FalseWeight;</div>
<div class="line"><a name="l06728"></a><span class="lineno"> 6728</span>&#160;    <span class="keywordflow">if</span> (Sum != 0) {</div>
<div class="line"><a name="l06729"></a><span class="lineno"> 6729</span>&#160;      <span class="keyword">auto</span> Probability = BranchProbability::getBranchProbability(Max, Sum);</div>
<div class="line"><a name="l06730"></a><span class="lineno"> 6730</span>&#160;      <span class="keywordflow">if</span> (Probability &gt; <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a99b320fd35acaf648a0a7826a0bdd777">getPredictableBranchThreshold</a>())</div>
<div class="line"><a name="l06731"></a><span class="lineno"> 6731</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l06732"></a><span class="lineno"> 6732</span>&#160;    }</div>
<div class="line"><a name="l06733"></a><span class="lineno"> 6733</span>&#160;  }</div>
<div class="line"><a name="l06734"></a><span class="lineno"> 6734</span>&#160; </div>
<div class="line"><a name="l06735"></a><span class="lineno"> 6735</span>&#160;  <a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a> *Cmp = dyn_cast&lt;CmpInst&gt;(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getCondition());</div>
<div class="line"><a name="l06736"></a><span class="lineno"> 6736</span>&#160; </div>
<div class="line"><a name="l06737"></a><span class="lineno"> 6737</span>&#160;  <span class="comment">// If a branch is predictable, an out-of-order CPU can avoid blocking on its</span></div>
<div class="line"><a name="l06738"></a><span class="lineno"> 6738</span>&#160;  <span class="comment">// comparison condition. If the compare has more than one use, there&#39;s</span></div>
<div class="line"><a name="l06739"></a><span class="lineno"> 6739</span>&#160;  <span class="comment">// probably another cmov or setcc around, so it&#39;s not worth emitting a branch.</span></div>
<div class="line"><a name="l06740"></a><span class="lineno"> 6740</span>&#160;  <span class="keywordflow">if</span> (!Cmp || !Cmp-&gt;hasOneUse())</div>
<div class="line"><a name="l06741"></a><span class="lineno"> 6741</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06742"></a><span class="lineno"> 6742</span>&#160; </div>
<div class="line"><a name="l06743"></a><span class="lineno"> 6743</span>&#160;  <span class="comment">// If either operand of the select is expensive and only needed on one side</span></div>
<div class="line"><a name="l06744"></a><span class="lineno"> 6744</span>&#160;  <span class="comment">// of the select, we should form a branch.</span></div>
<div class="line"><a name="l06745"></a><span class="lineno"> 6745</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="CodeGenPrepare_8cpp.html#a10ece31d94cdd66e58cef49d73f2263f">sinkSelectOperand</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getTrueValue()) ||</div>
<div class="line"><a name="l06746"></a><span class="lineno"> 6746</span>&#160;      <a class="code" href="CodeGenPrepare_8cpp.html#a10ece31d94cdd66e58cef49d73f2263f">sinkSelectOperand</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getFalseValue()))</div>
<div class="line"><a name="l06747"></a><span class="lineno"> 6747</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l06748"></a><span class="lineno"> 6748</span>&#160; </div>
<div class="line"><a name="l06749"></a><span class="lineno"> 6749</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06750"></a><span class="lineno"> 6750</span>&#160;}</div>
<div class="line"><a name="l06751"></a><span class="lineno"> 6751</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l06752"></a><span class="lineno"> 6752</span>&#160;<span class="comment">/// If \p isTrue is true, return the true value of \p SI, otherwise return</span></div>
<div class="line"><a name="l06753"></a><span class="lineno"> 6753</span>&#160;<span class="comment">/// false value of \p SI. If the true/false value of \p SI is defined by any</span></div>
<div class="line"><a name="l06754"></a><span class="lineno"> 6754</span>&#160;<span class="comment">/// select instructions in \p Selects, look through the defining select</span></div>
<div class="line"><a name="l06755"></a><span class="lineno"> 6755</span>&#160;<span class="comment">/// instruction until the true/false value is not defined in \p Selects.</span></div>
<div class="line"><a name="l06756"></a><span class="lineno"> 6756</span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *</div>
<div class="line"><a name="l06757"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#a8dd1128758268fa3aa05eeba358baf3f"> 6757</a></span>&#160;<a class="code" href="CodeGenPrepare_8cpp.html#a8dd1128758268fa3aa05eeba358baf3f">getTrueOrFalseValue</a>(<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <span class="keywordtype">bool</span> isTrue,</div>
<div class="line"><a name="l06758"></a><span class="lineno"> 6758</span>&#160;                    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const Instruction *, 2&gt;</a> &amp;Selects) {</div>
<div class="line"><a name="l06759"></a><span class="lineno"> 6759</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06760"></a><span class="lineno"> 6760</span>&#160; </div>
<div class="line"><a name="l06761"></a><span class="lineno"> 6761</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *DefSI = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>; DefSI != <span class="keyword">nullptr</span> &amp;&amp; Selects.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(DefSI);</div>
<div class="line"><a name="l06762"></a><span class="lineno"> 6762</span>&#160;       DefSI = dyn_cast&lt;SelectInst&gt;(V)) {</div>
<div class="line"><a name="l06763"></a><span class="lineno"> 6763</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DefSI-&gt;getCondition() == <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getCondition() &amp;&amp;</div>
<div class="line"><a name="l06764"></a><span class="lineno"> 6764</span>&#160;           <span class="stringliteral">&quot;The condition of DefSI does not match with SI&quot;</span>);</div>
<div class="line"><a name="l06765"></a><span class="lineno"> 6765</span>&#160;    V = (isTrue ? DefSI-&gt;getTrueValue() : DefSI-&gt;getFalseValue());</div>
<div class="line"><a name="l06766"></a><span class="lineno"> 6766</span>&#160;  }</div>
<div class="line"><a name="l06767"></a><span class="lineno"> 6767</span>&#160; </div>
<div class="line"><a name="l06768"></a><span class="lineno"> 6768</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(V &amp;&amp; <span class="stringliteral">&quot;Failed to get select true/false value&quot;</span>);</div>
<div class="line"><a name="l06769"></a><span class="lineno"> 6769</span>&#160;  <span class="keywordflow">return</span> V;</div>
<div class="line"><a name="l06770"></a><span class="lineno"> 6770</span>&#160;}</div>
<div class="line"><a name="l06771"></a><span class="lineno"> 6771</span>&#160; </div>
<div class="line"><a name="l06772"></a><span class="lineno"> 6772</span>&#160;<span class="keywordtype">bool</span> CodeGenPrepare::optimizeShiftInst(<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *<a class="code" href="lib_2Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a>) {</div>
<div class="line"><a name="l06773"></a><span class="lineno"> 6773</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="lib_2Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a>-&gt;isShift() &amp;&amp; <span class="stringliteral">&quot;Expected a shift&quot;</span>);</div>
<div class="line"><a name="l06774"></a><span class="lineno"> 6774</span>&#160; </div>
<div class="line"><a name="l06775"></a><span class="lineno"> 6775</span>&#160;  <span class="comment">// If this is (1) a vector shift, (2) shifts by scalars are cheaper than</span></div>
<div class="line"><a name="l06776"></a><span class="lineno"> 6776</span>&#160;  <span class="comment">// general vector shifts, and (3) the shift amount is a select-of-splatted</span></div>
<div class="line"><a name="l06777"></a><span class="lineno"> 6777</span>&#160;  <span class="comment">// values, hoist the shifts before the select:</span></div>
<div class="line"><a name="l06778"></a><span class="lineno"> 6778</span>&#160;  <span class="comment">//   shift Op0, (select Cond, TVal, FVal) --&gt;</span></div>
<div class="line"><a name="l06779"></a><span class="lineno"> 6779</span>&#160;  <span class="comment">//   select Cond, (shift Op0, TVal), (shift Op0, FVal)</span></div>
<div class="line"><a name="l06780"></a><span class="lineno"> 6780</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l06781"></a><span class="lineno"> 6781</span>&#160;  <span class="comment">// This is inverting a generic IR transform when we know that the cost of a</span></div>
<div class="line"><a name="l06782"></a><span class="lineno"> 6782</span>&#160;  <span class="comment">// general vector shift is more than the cost of 2 shift-by-scalars.</span></div>
<div class="line"><a name="l06783"></a><span class="lineno"> 6783</span>&#160;  <span class="comment">// We can&#39;t do this effectively in SDAG because we may not be able to</span></div>
<div class="line"><a name="l06784"></a><span class="lineno"> 6784</span>&#160;  <span class="comment">// determine if the select operands are splats from within a basic block.</span></div>
<div class="line"><a name="l06785"></a><span class="lineno"> 6785</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty = <a class="code" href="lib_2Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a>-&gt;getType();</div>
<div class="line"><a name="l06786"></a><span class="lineno"> 6786</span>&#160;  <span class="keywordflow">if</span> (!Ty-&gt;<a class="code" href="classllvm_1_1Type.html#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() || !TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a0791d03936abf005dfeef844f2d23fc6">isVectorShiftByScalarCheap</a>(Ty))</div>
<div class="line"><a name="l06787"></a><span class="lineno"> 6787</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06788"></a><span class="lineno"> 6788</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>, *TVal, *FVal;</div>
<div class="line"><a name="l06789"></a><span class="lineno"> 6789</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="lib_2Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a>-&gt;getOperand(1),</div>
<div class="line"><a name="l06790"></a><span class="lineno"> 6790</span>&#160;             <a class="code" href="namespacellvm_1_1MIPatternMatch.html#adaaea0309983a4c327ced82a739cf1c4">m_OneUse</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#addb87fe3f509b7803d3f5933ee24b560">m_Select</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(TVal), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(FVal)))))</div>
<div class="line"><a name="l06791"></a><span class="lineno"> 6791</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06792"></a><span class="lineno"> 6792</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#a6339f2ad6701dc229c34ca4305596d3a">isSplatValue</a>(TVal) || !<a class="code" href="namespacellvm.html#a6339f2ad6701dc229c34ca4305596d3a">isSplatValue</a>(FVal))</div>
<div class="line"><a name="l06793"></a><span class="lineno"> 6793</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06794"></a><span class="lineno"> 6794</span>&#160; </div>
<div class="line"><a name="l06795"></a><span class="lineno"> 6795</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(<a class="code" href="lib_2Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a>);</div>
<div class="line"><a name="l06796"></a><span class="lineno"> 6796</span>&#160;  BinaryOperator::BinaryOps Opcode = <a class="code" href="lib_2Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a>-&gt;getOpcode();</div>
<div class="line"><a name="l06797"></a><span class="lineno"> 6797</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewTVal = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBinOp(Opcode, <a class="code" href="lib_2Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a>-&gt;getOperand(0), TVal);</div>
<div class="line"><a name="l06798"></a><span class="lineno"> 6798</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewFVal = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBinOp(Opcode, <a class="code" href="lib_2Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a>-&gt;getOperand(0), FVal);</div>
<div class="line"><a name="l06799"></a><span class="lineno"> 6799</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewSel = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSelect(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>, NewTVal, NewFVal);</div>
<div class="line"><a name="l06800"></a><span class="lineno"> 6800</span>&#160;  <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(<a class="code" href="lib_2Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a>, NewSel, FreshBBs, IsHugeFunc);</div>
<div class="line"><a name="l06801"></a><span class="lineno"> 6801</span>&#160;  <a class="code" href="lib_2Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l06802"></a><span class="lineno"> 6802</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l06803"></a><span class="lineno"> 6803</span>&#160;}</div>
<div class="line"><a name="l06804"></a><span class="lineno"> 6804</span>&#160; </div>
<div class="line"><a name="l06805"></a><span class="lineno"> 6805</span>&#160;<span class="keywordtype">bool</span> CodeGenPrepare::optimizeFunnelShift(<a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *Fsh) {</div>
<div class="line"><a name="l06806"></a><span class="lineno"> 6806</span>&#160;  <a class="code" href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> Opcode = Fsh-&gt;<a class="code" href="classllvm_1_1IntrinsicInst.html#a7ff64b3625b6f9020556ed05a5f72af4">getIntrinsicID</a>();</div>
<div class="line"><a name="l06807"></a><span class="lineno"> 6807</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((Opcode == Intrinsic::fshl || Opcode == Intrinsic::fshr) &amp;&amp;</div>
<div class="line"><a name="l06808"></a><span class="lineno"> 6808</span>&#160;         <span class="stringliteral">&quot;Expected a funnel shift&quot;</span>);</div>
<div class="line"><a name="l06809"></a><span class="lineno"> 6809</span>&#160; </div>
<div class="line"><a name="l06810"></a><span class="lineno"> 6810</span>&#160;  <span class="comment">// If this is (1) a vector funnel shift, (2) shifts by scalars are cheaper</span></div>
<div class="line"><a name="l06811"></a><span class="lineno"> 6811</span>&#160;  <span class="comment">// than general vector shifts, and (3) the shift amount is select-of-splatted</span></div>
<div class="line"><a name="l06812"></a><span class="lineno"> 6812</span>&#160;  <span class="comment">// values, hoist the funnel shifts before the select:</span></div>
<div class="line"><a name="l06813"></a><span class="lineno"> 6813</span>&#160;  <span class="comment">//   fsh Op0, Op1, (select Cond, TVal, FVal) --&gt;</span></div>
<div class="line"><a name="l06814"></a><span class="lineno"> 6814</span>&#160;  <span class="comment">//   select Cond, (fsh Op0, Op1, TVal), (fsh Op0, Op1, FVal)</span></div>
<div class="line"><a name="l06815"></a><span class="lineno"> 6815</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l06816"></a><span class="lineno"> 6816</span>&#160;  <span class="comment">// This is inverting a generic IR transform when we know that the cost of a</span></div>
<div class="line"><a name="l06817"></a><span class="lineno"> 6817</span>&#160;  <span class="comment">// general vector shift is more than the cost of 2 shift-by-scalars.</span></div>
<div class="line"><a name="l06818"></a><span class="lineno"> 6818</span>&#160;  <span class="comment">// We can&#39;t do this effectively in SDAG because we may not be able to</span></div>
<div class="line"><a name="l06819"></a><span class="lineno"> 6819</span>&#160;  <span class="comment">// determine if the select operands are splats from within a basic block.</span></div>
<div class="line"><a name="l06820"></a><span class="lineno"> 6820</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty = Fsh-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l06821"></a><span class="lineno"> 6821</span>&#160;  <span class="keywordflow">if</span> (!Ty-&gt;<a class="code" href="classllvm_1_1Type.html#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() || !TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a0791d03936abf005dfeef844f2d23fc6">isVectorShiftByScalarCheap</a>(Ty))</div>
<div class="line"><a name="l06822"></a><span class="lineno"> 6822</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06823"></a><span class="lineno"> 6823</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>, *TVal, *FVal;</div>
<div class="line"><a name="l06824"></a><span class="lineno"> 6824</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Fsh-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(2),</div>
<div class="line"><a name="l06825"></a><span class="lineno"> 6825</span>&#160;             <a class="code" href="namespacellvm_1_1MIPatternMatch.html#adaaea0309983a4c327ced82a739cf1c4">m_OneUse</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#addb87fe3f509b7803d3f5933ee24b560">m_Select</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(TVal), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(FVal)))))</div>
<div class="line"><a name="l06826"></a><span class="lineno"> 6826</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06827"></a><span class="lineno"> 6827</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#a6339f2ad6701dc229c34ca4305596d3a">isSplatValue</a>(TVal) || !<a class="code" href="namespacellvm.html#a6339f2ad6701dc229c34ca4305596d3a">isSplatValue</a>(FVal))</div>
<div class="line"><a name="l06828"></a><span class="lineno"> 6828</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06829"></a><span class="lineno"> 6829</span>&#160; </div>
<div class="line"><a name="l06830"></a><span class="lineno"> 6830</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(Fsh);</div>
<div class="line"><a name="l06831"></a><span class="lineno"> 6831</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a> = Fsh-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), *<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a> = Fsh-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1);</div>
<div class="line"><a name="l06832"></a><span class="lineno"> 6832</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewTVal = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntrinsic(Opcode, Ty, {<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, <a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>, TVal});</div>
<div class="line"><a name="l06833"></a><span class="lineno"> 6833</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewFVal = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntrinsic(Opcode, Ty, {<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, <a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>, FVal});</div>
<div class="line"><a name="l06834"></a><span class="lineno"> 6834</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewSel = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSelect(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>, NewTVal, NewFVal);</div>
<div class="line"><a name="l06835"></a><span class="lineno"> 6835</span>&#160;  <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(Fsh, NewSel, FreshBBs, IsHugeFunc);</div>
<div class="line"><a name="l06836"></a><span class="lineno"> 6836</span>&#160;  Fsh-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l06837"></a><span class="lineno"> 6837</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l06838"></a><span class="lineno"> 6838</span>&#160;}</div>
<div class="line"><a name="l06839"></a><span class="lineno"> 6839</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l06840"></a><span class="lineno"> 6840</span>&#160;<span class="comment">/// If we have a SelectInst that will likely profit from branch prediction,</span></div>
<div class="line"><a name="l06841"></a><span class="lineno"> 6841</span>&#160;<span class="comment">/// turn it into a branch.</span></div>
<div class="line"><a name="l06842"></a><span class="lineno"> 6842</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CodeGenPrepare::optimizeSelectInst(<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>) {</div>
<div class="line"><a name="l06843"></a><span class="lineno"> 6843</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="CodeGenPrepare_8cpp.html#a18ea06b4e195aedc9dbd091d60d74365">DisableSelectToBranch</a>)</div>
<div class="line"><a name="l06844"></a><span class="lineno"> 6844</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06845"></a><span class="lineno"> 6845</span>&#160; </div>
<div class="line"><a name="l06846"></a><span class="lineno"> 6846</span>&#160;  <span class="comment">// If the SelectOptimize pass is enabled, selects have already been optimized.</span></div>
<div class="line"><a name="l06847"></a><span class="lineno"> 6847</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#aff30786f1ea13c3ea475acce504571e4">getCGPassBuilderOption</a>().<a class="code" href="TargetPassConfig_8cpp.html#ac7494f88e19e6f277cec14fa17737ec2">DisableSelectOptimize</a>)</div>
<div class="line"><a name="l06848"></a><span class="lineno"> 6848</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06849"></a><span class="lineno"> 6849</span>&#160; </div>
<div class="line"><a name="l06850"></a><span class="lineno"> 6850</span>&#160;  <span class="comment">// Find all consecutive select instructions that share the same condition.</span></div>
<div class="line"><a name="l06851"></a><span class="lineno"> 6851</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;SelectInst *, 2&gt;</a> ASI;</div>
<div class="line"><a name="l06852"></a><span class="lineno"> 6852</span>&#160;  ASI.push_back(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l06853"></a><span class="lineno"> 6853</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> It = ++<a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l06854"></a><span class="lineno"> 6854</span>&#160;       It != <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getParent()-&gt;<a class="code" href="namespacellvm_1_1sys_1_1path.html#a214ec2f04ffd92636ed4bd2717607a1d">end</a>(); ++It) {</div>
<div class="line"><a name="l06855"></a><span class="lineno"> 6855</span>&#160;    <a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;SelectInst&gt;(&amp;*It);</div>
<div class="line"><a name="l06856"></a><span class="lineno"> 6856</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp; <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getCondition() == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getCondition()) {</div>
<div class="line"><a name="l06857"></a><span class="lineno"> 6857</span>&#160;      ASI.push_back(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l06858"></a><span class="lineno"> 6858</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06859"></a><span class="lineno"> 6859</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06860"></a><span class="lineno"> 6860</span>&#160;    }</div>
<div class="line"><a name="l06861"></a><span class="lineno"> 6861</span>&#160;  }</div>
<div class="line"><a name="l06862"></a><span class="lineno"> 6862</span>&#160; </div>
<div class="line"><a name="l06863"></a><span class="lineno"> 6863</span>&#160;  <a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *LastSI = ASI.back();</div>
<div class="line"><a name="l06864"></a><span class="lineno"> 6864</span>&#160;  <span class="comment">// Increment the current iterator to skip all the rest of select instructions</span></div>
<div class="line"><a name="l06865"></a><span class="lineno"> 6865</span>&#160;  <span class="comment">// because they will be either &quot;not lowered&quot; or &quot;all lowered&quot; to branch.</span></div>
<div class="line"><a name="l06866"></a><span class="lineno"> 6866</span>&#160;  CurInstIterator = std::next(LastSI-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>());</div>
<div class="line"><a name="l06867"></a><span class="lineno"> 6867</span>&#160; </div>
<div class="line"><a name="l06868"></a><span class="lineno"> 6868</span>&#160;  <span class="keywordtype">bool</span> VectorCond = !<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getCondition()-&gt;getType()-&gt;isIntegerTy(1);</div>
<div class="line"><a name="l06869"></a><span class="lineno"> 6869</span>&#160; </div>
<div class="line"><a name="l06870"></a><span class="lineno"> 6870</span>&#160;  <span class="comment">// Can we convert the &#39;select&#39; to CF ?</span></div>
<div class="line"><a name="l06871"></a><span class="lineno"> 6871</span>&#160;  <span class="keywordflow">if</span> (VectorCond || <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getMetadata(LLVMContext::MD_unpredictable))</div>
<div class="line"><a name="l06872"></a><span class="lineno"> 6872</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06873"></a><span class="lineno"> 6873</span>&#160; </div>
<div class="line"><a name="l06874"></a><span class="lineno"> 6874</span>&#160;  TargetLowering::SelectSupportKind SelectKind;</div>
<div class="line"><a name="l06875"></a><span class="lineno"> 6875</span>&#160;  <span class="keywordflow">if</span> (VectorCond)</div>
<div class="line"><a name="l06876"></a><span class="lineno"> 6876</span>&#160;    SelectKind = TargetLowering::VectorMaskSelect;</div>
<div class="line"><a name="l06877"></a><span class="lineno"> 6877</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getType()-&gt;isVectorTy())</div>
<div class="line"><a name="l06878"></a><span class="lineno"> 6878</span>&#160;    SelectKind = TargetLowering::ScalarCondVectorVal;</div>
<div class="line"><a name="l06879"></a><span class="lineno"> 6879</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l06880"></a><span class="lineno"> 6880</span>&#160;    SelectKind = TargetLowering::ScalarValSelect;</div>
<div class="line"><a name="l06881"></a><span class="lineno"> 6881</span>&#160; </div>
<div class="line"><a name="l06882"></a><span class="lineno"> 6882</span>&#160;  <span class="keywordflow">if</span> (TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a161843eda8a79a43aebb063c9268a96c">isSelectSupported</a>(SelectKind) &amp;&amp;</div>
<div class="line"><a name="l06883"></a><span class="lineno"> 6883</span>&#160;      (!<a class="code" href="CodeGenPrepare_8cpp.html#a4bde686b6506cc9e63919272711713f4">isFormingBranchFromSelectProfitable</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, TLI, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>) || OptSize ||</div>
<div class="line"><a name="l06884"></a><span class="lineno"> 6884</span>&#160;       <a class="code" href="namespacellvm.html#a3af72f14ea20f2c762c751d2d49e5ea3">llvm::shouldOptimizeForSize</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getParent(), PSI, <a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>.get())))</div>
<div class="line"><a name="l06885"></a><span class="lineno"> 6885</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06886"></a><span class="lineno"> 6886</span>&#160; </div>
<div class="line"><a name="l06887"></a><span class="lineno"> 6887</span>&#160;  <span class="comment">// The DominatorTree needs to be rebuilt by any consumers after this</span></div>
<div class="line"><a name="l06888"></a><span class="lineno"> 6888</span>&#160;  <span class="comment">// transformation. We simply reset here rather than setting the ModifiedDT</span></div>
<div class="line"><a name="l06889"></a><span class="lineno"> 6889</span>&#160;  <span class="comment">// flag to avoid restarting the function walk in runOnFunction for each</span></div>
<div class="line"><a name="l06890"></a><span class="lineno"> 6890</span>&#160;  <span class="comment">// select optimized.</span></div>
<div class="line"><a name="l06891"></a><span class="lineno"> 6891</span>&#160;  DT.reset();</div>
<div class="line"><a name="l06892"></a><span class="lineno"> 6892</span>&#160; </div>
<div class="line"><a name="l06893"></a><span class="lineno"> 6893</span>&#160;  <span class="comment">// Transform a sequence like this:</span></div>
<div class="line"><a name="l06894"></a><span class="lineno"> 6894</span>&#160;  <span class="comment">//    start:</span></div>
<div class="line"><a name="l06895"></a><span class="lineno"> 6895</span>&#160;  <span class="comment">//       %cmp = cmp uge i32 %a, %b</span></div>
<div class="line"><a name="l06896"></a><span class="lineno"> 6896</span>&#160;  <span class="comment">//       %sel = select i1 %cmp, i32 %c, i32 %d</span></div>
<div class="line"><a name="l06897"></a><span class="lineno"> 6897</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l06898"></a><span class="lineno"> 6898</span>&#160;  <span class="comment">// Into:</span></div>
<div class="line"><a name="l06899"></a><span class="lineno"> 6899</span>&#160;  <span class="comment">//    start:</span></div>
<div class="line"><a name="l06900"></a><span class="lineno"> 6900</span>&#160;  <span class="comment">//       %cmp = cmp uge i32 %a, %b</span></div>
<div class="line"><a name="l06901"></a><span class="lineno"> 6901</span>&#160;  <span class="comment">//       %cmp.frozen = freeze %cmp</span></div>
<div class="line"><a name="l06902"></a><span class="lineno"> 6902</span>&#160;  <span class="comment">//       br i1 %cmp.frozen, label %select.true, label %select.false</span></div>
<div class="line"><a name="l06903"></a><span class="lineno"> 6903</span>&#160;  <span class="comment">//    select.true:</span></div>
<div class="line"><a name="l06904"></a><span class="lineno"> 6904</span>&#160;  <span class="comment">//       br label %select.end</span></div>
<div class="line"><a name="l06905"></a><span class="lineno"> 6905</span>&#160;  <span class="comment">//    select.false:</span></div>
<div class="line"><a name="l06906"></a><span class="lineno"> 6906</span>&#160;  <span class="comment">//       br label %select.end</span></div>
<div class="line"><a name="l06907"></a><span class="lineno"> 6907</span>&#160;  <span class="comment">//    select.end:</span></div>
<div class="line"><a name="l06908"></a><span class="lineno"> 6908</span>&#160;  <span class="comment">//       %sel = phi i32 [ %c, %select.true ], [ %d, %select.false ]</span></div>
<div class="line"><a name="l06909"></a><span class="lineno"> 6909</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l06910"></a><span class="lineno"> 6910</span>&#160;  <span class="comment">// %cmp should be frozen, otherwise it may introduce undefined behavior.</span></div>
<div class="line"><a name="l06911"></a><span class="lineno"> 6911</span>&#160;  <span class="comment">// In addition, we may sink instructions that produce %c or %d from</span></div>
<div class="line"><a name="l06912"></a><span class="lineno"> 6912</span>&#160;  <span class="comment">// the entry block into the destination(s) of the new branch.</span></div>
<div class="line"><a name="l06913"></a><span class="lineno"> 6913</span>&#160;  <span class="comment">// If the true or false blocks do not contain a sunken instruction, that</span></div>
<div class="line"><a name="l06914"></a><span class="lineno"> 6914</span>&#160;  <span class="comment">// block and its branch may be optimized away. In that case, one side of the</span></div>
<div class="line"><a name="l06915"></a><span class="lineno"> 6915</span>&#160;  <span class="comment">// first branch will point directly to select.end, and the corresponding PHI</span></div>
<div class="line"><a name="l06916"></a><span class="lineno"> 6916</span>&#160;  <span class="comment">// predecessor block will be the start block.</span></div>
<div class="line"><a name="l06917"></a><span class="lineno"> 6917</span>&#160; </div>
<div class="line"><a name="l06918"></a><span class="lineno"> 6918</span>&#160;  <span class="comment">// First, we split the block containing the select into 2 blocks.</span></div>
<div class="line"><a name="l06919"></a><span class="lineno"> 6919</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *StartBlock = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getParent();</div>
<div class="line"><a name="l06920"></a><span class="lineno"> 6920</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> SplitPt = ++(<a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a>(LastSI));</div>
<div class="line"><a name="l06921"></a><span class="lineno"> 6921</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *EndBlock = StartBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(SplitPt, <span class="stringliteral">&quot;select.end&quot;</span>);</div>
<div class="line"><a name="l06922"></a><span class="lineno"> 6922</span>&#160;  <span class="keywordflow">if</span> (IsHugeFunc)</div>
<div class="line"><a name="l06923"></a><span class="lineno"> 6923</span>&#160;    FreshBBs.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(EndBlock);</div>
<div class="line"><a name="l06924"></a><span class="lineno"> 6924</span>&#160;  <a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;setBlockFreq(EndBlock, <a class="code" href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">BFI</a>-&gt;getBlockFreq(StartBlock).getFrequency());</div>
<div class="line"><a name="l06925"></a><span class="lineno"> 6925</span>&#160; </div>
<div class="line"><a name="l06926"></a><span class="lineno"> 6926</span>&#160;  <span class="comment">// Delete the unconditional branch that was just created by the split.</span></div>
<div class="line"><a name="l06927"></a><span class="lineno"> 6927</span>&#160;  StartBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>()-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l06928"></a><span class="lineno"> 6928</span>&#160; </div>
<div class="line"><a name="l06929"></a><span class="lineno"> 6929</span>&#160;  <span class="comment">// These are the new basic blocks for the conditional branch.</span></div>
<div class="line"><a name="l06930"></a><span class="lineno"> 6930</span>&#160;  <span class="comment">// At least one will become an actual new basic block.</span></div>
<div class="line"><a name="l06931"></a><span class="lineno"> 6931</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *TrueBlock = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06932"></a><span class="lineno"> 6932</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *FalseBlock = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06933"></a><span class="lineno"> 6933</span>&#160;  <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *TrueBranch = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06934"></a><span class="lineno"> 6934</span>&#160;  <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *FalseBranch = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06935"></a><span class="lineno"> 6935</span>&#160; </div>
<div class="line"><a name="l06936"></a><span class="lineno"> 6936</span>&#160;  <span class="comment">// Sink expensive instructions into the conditional blocks to avoid executing</span></div>
<div class="line"><a name="l06937"></a><span class="lineno"> 6937</span>&#160;  <span class="comment">// them speculatively.</span></div>
<div class="line"><a name="l06938"></a><span class="lineno"> 6938</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> : ASI) {</div>
<div class="line"><a name="l06939"></a><span class="lineno"> 6939</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="CodeGenPrepare_8cpp.html#a10ece31d94cdd66e58cef49d73f2263f">sinkSelectOperand</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getTrueValue())) {</div>
<div class="line"><a name="l06940"></a><span class="lineno"> 6940</span>&#160;      <span class="keywordflow">if</span> (TrueBlock == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l06941"></a><span class="lineno"> 6941</span>&#160;        TrueBlock = BasicBlock::Create(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getContext(), <span class="stringliteral">&quot;select.true.sink&quot;</span>,</div>
<div class="line"><a name="l06942"></a><span class="lineno"> 6942</span>&#160;                                       EndBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a38bee869ad41aebfef3de2641b12004c">getParent</a>(), EndBlock);</div>
<div class="line"><a name="l06943"></a><span class="lineno"> 6943</span>&#160;        TrueBranch = BranchInst::Create(EndBlock, TrueBlock);</div>
<div class="line"><a name="l06944"></a><span class="lineno"> 6944</span>&#160;        <span class="keywordflow">if</span> (IsHugeFunc)</div>
<div class="line"><a name="l06945"></a><span class="lineno"> 6945</span>&#160;          FreshBBs.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(TrueBlock);</div>
<div class="line"><a name="l06946"></a><span class="lineno"> 6946</span>&#160;        TrueBranch-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDebugLoc());</div>
<div class="line"><a name="l06947"></a><span class="lineno"> 6947</span>&#160;      }</div>
<div class="line"><a name="l06948"></a><span class="lineno"> 6948</span>&#160;      <span class="keyword">auto</span> *TrueInst = cast&lt;Instruction&gt;(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getTrueValue());</div>
<div class="line"><a name="l06949"></a><span class="lineno"> 6949</span>&#160;      TrueInst-&gt;moveBefore(TrueBranch);</div>
<div class="line"><a name="l06950"></a><span class="lineno"> 6950</span>&#160;    }</div>
<div class="line"><a name="l06951"></a><span class="lineno"> 6951</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="CodeGenPrepare_8cpp.html#a10ece31d94cdd66e58cef49d73f2263f">sinkSelectOperand</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getFalseValue())) {</div>
<div class="line"><a name="l06952"></a><span class="lineno"> 6952</span>&#160;      <span class="keywordflow">if</span> (FalseBlock == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l06953"></a><span class="lineno"> 6953</span>&#160;        FalseBlock = BasicBlock::Create(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getContext(), <span class="stringliteral">&quot;select.false.sink&quot;</span>,</div>
<div class="line"><a name="l06954"></a><span class="lineno"> 6954</span>&#160;                                        EndBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a38bee869ad41aebfef3de2641b12004c">getParent</a>(), EndBlock);</div>
<div class="line"><a name="l06955"></a><span class="lineno"> 6955</span>&#160;        <span class="keywordflow">if</span> (IsHugeFunc)</div>
<div class="line"><a name="l06956"></a><span class="lineno"> 6956</span>&#160;          FreshBBs.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(FalseBlock);</div>
<div class="line"><a name="l06957"></a><span class="lineno"> 6957</span>&#160;        FalseBranch = BranchInst::Create(EndBlock, FalseBlock);</div>
<div class="line"><a name="l06958"></a><span class="lineno"> 6958</span>&#160;        FalseBranch-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDebugLoc());</div>
<div class="line"><a name="l06959"></a><span class="lineno"> 6959</span>&#160;      }</div>
<div class="line"><a name="l06960"></a><span class="lineno"> 6960</span>&#160;      <span class="keyword">auto</span> *FalseInst = cast&lt;Instruction&gt;(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getFalseValue());</div>
<div class="line"><a name="l06961"></a><span class="lineno"> 6961</span>&#160;      FalseInst-&gt;moveBefore(FalseBranch);</div>
<div class="line"><a name="l06962"></a><span class="lineno"> 6962</span>&#160;    }</div>
<div class="line"><a name="l06963"></a><span class="lineno"> 6963</span>&#160;  }</div>
<div class="line"><a name="l06964"></a><span class="lineno"> 6964</span>&#160; </div>
<div class="line"><a name="l06965"></a><span class="lineno"> 6965</span>&#160;  <span class="comment">// If there was nothing to sink, then arbitrarily choose the &#39;false&#39; side</span></div>
<div class="line"><a name="l06966"></a><span class="lineno"> 6966</span>&#160;  <span class="comment">// for a new input value to the PHI.</span></div>
<div class="line"><a name="l06967"></a><span class="lineno"> 6967</span>&#160;  <span class="keywordflow">if</span> (TrueBlock == FalseBlock) {</div>
<div class="line"><a name="l06968"></a><span class="lineno"> 6968</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TrueBlock == <span class="keyword">nullptr</span> &amp;&amp;</div>
<div class="line"><a name="l06969"></a><span class="lineno"> 6969</span>&#160;           <span class="stringliteral">&quot;Unexpected basic block transform while optimizing select&quot;</span>);</div>
<div class="line"><a name="l06970"></a><span class="lineno"> 6970</span>&#160; </div>
<div class="line"><a name="l06971"></a><span class="lineno"> 6971</span>&#160;    FalseBlock = BasicBlock::Create(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getContext(), <span class="stringliteral">&quot;select.false&quot;</span>,</div>
<div class="line"><a name="l06972"></a><span class="lineno"> 6972</span>&#160;                                    EndBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a38bee869ad41aebfef3de2641b12004c">getParent</a>(), EndBlock);</div>
<div class="line"><a name="l06973"></a><span class="lineno"> 6973</span>&#160;    <span class="keywordflow">if</span> (IsHugeFunc)</div>
<div class="line"><a name="l06974"></a><span class="lineno"> 6974</span>&#160;      FreshBBs.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(FalseBlock);</div>
<div class="line"><a name="l06975"></a><span class="lineno"> 6975</span>&#160;    <span class="keyword">auto</span> *FalseBranch = BranchInst::Create(EndBlock, FalseBlock);</div>
<div class="line"><a name="l06976"></a><span class="lineno"> 6976</span>&#160;    FalseBranch-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDebugLoc());</div>
<div class="line"><a name="l06977"></a><span class="lineno"> 6977</span>&#160;  }</div>
<div class="line"><a name="l06978"></a><span class="lineno"> 6978</span>&#160; </div>
<div class="line"><a name="l06979"></a><span class="lineno"> 6979</span>&#160;  <span class="comment">// Insert the real conditional branch based on the original condition.</span></div>
<div class="line"><a name="l06980"></a><span class="lineno"> 6980</span>&#160;  <span class="comment">// If we did not create a new block for one of the &#39;true&#39; or &#39;false&#39; paths</span></div>
<div class="line"><a name="l06981"></a><span class="lineno"> 6981</span>&#160;  <span class="comment">// of the condition, it means that side of the branch goes to the end block</span></div>
<div class="line"><a name="l06982"></a><span class="lineno"> 6982</span>&#160;  <span class="comment">// directly and the path originates from the start block from the point of</span></div>
<div class="line"><a name="l06983"></a><span class="lineno"> 6983</span>&#160;  <span class="comment">// view of the new PHI.</span></div>
<div class="line"><a name="l06984"></a><span class="lineno"> 6984</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341adf1f3edb9115acb0a1e04209b7a9937b">TT</a>, *FT;</div>
<div class="line"><a name="l06985"></a><span class="lineno"> 6985</span>&#160;  <span class="keywordflow">if</span> (TrueBlock == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l06986"></a><span class="lineno"> 6986</span>&#160;    <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341adf1f3edb9115acb0a1e04209b7a9937b">TT</a> = EndBlock;</div>
<div class="line"><a name="l06987"></a><span class="lineno"> 6987</span>&#160;    FT = FalseBlock;</div>
<div class="line"><a name="l06988"></a><span class="lineno"> 6988</span>&#160;    TrueBlock = StartBlock;</div>
<div class="line"><a name="l06989"></a><span class="lineno"> 6989</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (FalseBlock == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l06990"></a><span class="lineno"> 6990</span>&#160;    <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341adf1f3edb9115acb0a1e04209b7a9937b">TT</a> = TrueBlock;</div>
<div class="line"><a name="l06991"></a><span class="lineno"> 6991</span>&#160;    FT = EndBlock;</div>
<div class="line"><a name="l06992"></a><span class="lineno"> 6992</span>&#160;    FalseBlock = StartBlock;</div>
<div class="line"><a name="l06993"></a><span class="lineno"> 6993</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06994"></a><span class="lineno"> 6994</span>&#160;    <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341adf1f3edb9115acb0a1e04209b7a9937b">TT</a> = TrueBlock;</div>
<div class="line"><a name="l06995"></a><span class="lineno"> 6995</span>&#160;    FT = FalseBlock;</div>
<div class="line"><a name="l06996"></a><span class="lineno"> 6996</span>&#160;  }</div>
<div class="line"><a name="l06997"></a><span class="lineno"> 6997</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46a438dbcc76b79fb10acb447ec5d141287">IB</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l06998"></a><span class="lineno"> 6998</span>&#160;  <span class="keyword">auto</span> *CondFr = <a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46a438dbcc76b79fb10acb447ec5d141287">IB</a>.CreateFreeze(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getCondition(), <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getName() + <span class="stringliteral">&quot;.frozen&quot;</span>);</div>
<div class="line"><a name="l06999"></a><span class="lineno"> 6999</span>&#160;  <a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46a438dbcc76b79fb10acb447ec5d141287">IB</a>.CreateCondBr(CondFr, TT, FT, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l07000"></a><span class="lineno"> 7000</span>&#160; </div>
<div class="line"><a name="l07001"></a><span class="lineno"> 7001</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const Instruction *, 2&gt;</a> INS;</div>
<div class="line"><a name="l07002"></a><span class="lineno"> 7002</span>&#160;  INS.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(ASI.begin(), ASI.end());</div>
<div class="line"><a name="l07003"></a><span class="lineno"> 7003</span>&#160;  <span class="comment">// Use reverse iterator because later select may use the value of the</span></div>
<div class="line"><a name="l07004"></a><span class="lineno"> 7004</span>&#160;  <span class="comment">// earlier select, and we need to propagate value through earlier select</span></div>
<div class="line"><a name="l07005"></a><span class="lineno"> 7005</span>&#160;  <span class="comment">// to get the PHI operand.</span></div>
<div class="line"><a name="l07006"></a><span class="lineno"> 7006</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> : <a class="code" href="namespacellvm.html#a6b0ac1fa4f05de76413c5e0ca6334035">llvm::reverse</a>(ASI)) {</div>
<div class="line"><a name="l07007"></a><span class="lineno"> 7007</span>&#160;    <span class="comment">// The select itself is replaced with a PHI Node.</span></div>
<div class="line"><a name="l07008"></a><span class="lineno"> 7008</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = PHINode::Create(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getType(), 2, <span class="stringliteral">&quot;&quot;</span>, &amp;EndBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#ab706e7ebb1969c5e34f28bfcf2ff719e">front</a>());</div>
<div class="line"><a name="l07009"></a><span class="lineno"> 7009</span>&#160;    PN-&gt;<a class="code" href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l07010"></a><span class="lineno"> 7010</span>&#160;    PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(<a class="code" href="CodeGenPrepare_8cpp.html#a8dd1128758268fa3aa05eeba358baf3f">getTrueOrFalseValue</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <span class="keyword">true</span>, INS), TrueBlock);</div>
<div class="line"><a name="l07011"></a><span class="lineno"> 7011</span>&#160;    PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(<a class="code" href="CodeGenPrepare_8cpp.html#a8dd1128758268fa3aa05eeba358baf3f">getTrueOrFalseValue</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <span class="keyword">false</span>, INS), FalseBlock);</div>
<div class="line"><a name="l07012"></a><span class="lineno"> 7012</span>&#160;    PN-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDebugLoc());</div>
<div class="line"><a name="l07013"></a><span class="lineno"> 7013</span>&#160; </div>
<div class="line"><a name="l07014"></a><span class="lineno"> 7014</span>&#160;    <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, PN, FreshBBs, IsHugeFunc);</div>
<div class="line"><a name="l07015"></a><span class="lineno"> 7015</span>&#160;    <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l07016"></a><span class="lineno"> 7016</span>&#160;    INS.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a11045c7973ab24a8d6315b61fa337d4e">erase</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l07017"></a><span class="lineno"> 7017</span>&#160;    ++NumSelectsExpanded;</div>
<div class="line"><a name="l07018"></a><span class="lineno"> 7018</span>&#160;  }</div>
<div class="line"><a name="l07019"></a><span class="lineno"> 7019</span>&#160; </div>
<div class="line"><a name="l07020"></a><span class="lineno"> 7020</span>&#160;  <span class="comment">// Instruct OptimizeBlock to skip to the next block.</span></div>
<div class="line"><a name="l07021"></a><span class="lineno"> 7021</span>&#160;  CurInstIterator = StartBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>();</div>
<div class="line"><a name="l07022"></a><span class="lineno"> 7022</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07023"></a><span class="lineno"> 7023</span>&#160;}</div>
<div class="line"><a name="l07024"></a><span class="lineno"> 7024</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07025"></a><span class="lineno"> 7025</span>&#160;<span class="comment">/// Some targets only accept certain types for splat inputs. For example a VDUP</span></div>
<div class="line"><a name="l07026"></a><span class="lineno"> 7026</span>&#160;<span class="comment">/// in MVE takes a GPR (integer) register, and the instruction that incorporate</span></div>
<div class="line"><a name="l07027"></a><span class="lineno"> 7027</span>&#160;<span class="comment">/// a VDUP (such as a VADD qd, qm, rm) also require a gpr register.</span></div>
<div class="line"><a name="l07028"></a><span class="lineno"> 7028</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CodeGenPrepare::optimizeShuffleVectorInst(<a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a> *SVI) {</div>
<div class="line"><a name="l07029"></a><span class="lineno"> 7029</span>&#160;  <span class="comment">// Accept shuf(insertelem(undef/poison, val, 0), undef/poison, &lt;0,0,..&gt;) only</span></div>
<div class="line"><a name="l07030"></a><span class="lineno"> 7030</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(SVI, <a class="code" href="namespacellvm_1_1PatternMatch.html#afd3e8a6706810fef8cdbaf1f9f40dfbd">m_Shuffle</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a9cae528bdb66086aa6c06da36fc6fa24">m_InsertElt</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1MIPatternMatch.html#a42b1e7334c8da7ebef6e192f085eb563">m_ZeroInt</a>()),</div>
<div class="line"><a name="l07031"></a><span class="lineno"> 7031</span>&#160;                            <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>(), <a class="code" href="structllvm_1_1PatternMatch_1_1m__ZeroMask.html">m_ZeroMask</a>())))</div>
<div class="line"><a name="l07032"></a><span class="lineno"> 7032</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07033"></a><span class="lineno"> 7033</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *NewType = TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#ade4c57b9c2851617c61a9fd30174f07b">shouldConvertSplatType</a>(SVI);</div>
<div class="line"><a name="l07034"></a><span class="lineno"> 7034</span>&#160;  <span class="keywordflow">if</span> (!NewType)</div>
<div class="line"><a name="l07035"></a><span class="lineno"> 7035</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07036"></a><span class="lineno"> 7036</span>&#160; </div>
<div class="line"><a name="l07037"></a><span class="lineno"> 7037</span>&#160;  <span class="keyword">auto</span> *SVIVecType = cast&lt;FixedVectorType&gt;(SVI-&gt;<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a50fe6a61ea745fb71fa8403af6e7deed">getType</a>());</div>
<div class="line"><a name="l07038"></a><span class="lineno"> 7038</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!NewType-&gt;<a class="code" href="classllvm_1_1Type.html#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() &amp;&amp; <span class="stringliteral">&quot;Expected a scalar type!&quot;</span>);</div>
<div class="line"><a name="l07039"></a><span class="lineno"> 7039</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewType-&gt;<a class="code" href="classllvm_1_1Type.html#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() == SVIVecType-&gt;getScalarSizeInBits() &amp;&amp;</div>
<div class="line"><a name="l07040"></a><span class="lineno"> 7040</span>&#160;         <span class="stringliteral">&quot;Expected a type of the same size!&quot;</span>);</div>
<div class="line"><a name="l07041"></a><span class="lineno"> 7041</span>&#160;  <span class="keyword">auto</span> *NewVecType =</div>
<div class="line"><a name="l07042"></a><span class="lineno"> 7042</span>&#160;      <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">FixedVectorType::get</a>(NewType, SVIVecType-&gt;getNumElements());</div>
<div class="line"><a name="l07043"></a><span class="lineno"> 7043</span>&#160; </div>
<div class="line"><a name="l07044"></a><span class="lineno"> 7044</span>&#160;  <span class="comment">// Create a bitcast (shuffle (insert (bitcast(..))))</span></div>
<div class="line"><a name="l07045"></a><span class="lineno"> 7045</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(SVI-&gt;<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</div>
<div class="line"><a name="l07046"></a><span class="lineno"> 7046</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(SVI);</div>
<div class="line"><a name="l07047"></a><span class="lineno"> 7047</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *BC1 = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(</div>
<div class="line"><a name="l07048"></a><span class="lineno"> 7048</span>&#160;      cast&lt;Instruction&gt;(SVI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0))-&gt;getOperand(1), NewType);</div>
<div class="line"><a name="l07049"></a><span class="lineno"> 7049</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm.html#a766456df1dd21e804cd4596304e10764ae8b4b40ec3622e371789b790caabc083">Shuffle</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateVectorSplat(NewVecType-&gt;getNumElements(), BC1);</div>
<div class="line"><a name="l07050"></a><span class="lineno"> 7050</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *BC2 = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(Shuffle, SVIVecType);</div>
<div class="line"><a name="l07051"></a><span class="lineno"> 7051</span>&#160; </div>
<div class="line"><a name="l07052"></a><span class="lineno"> 7052</span>&#160;  <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(SVI, BC2, FreshBBs, IsHugeFunc);</div>
<div class="line"><a name="l07053"></a><span class="lineno"> 7053</span>&#160;  <a class="code" href="namespacellvm.html#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(</div>
<div class="line"><a name="l07054"></a><span class="lineno"> 7054</span>&#160;      SVI, TLInfo, <span class="keyword">nullptr</span>,</div>
<div class="line"><a name="l07055"></a><span class="lineno"> 7055</span>&#160;      [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) { removeAllAssertingVHReferences(V); });</div>
<div class="line"><a name="l07056"></a><span class="lineno"> 7056</span>&#160; </div>
<div class="line"><a name="l07057"></a><span class="lineno"> 7057</span>&#160;  <span class="comment">// Also hoist the bitcast up to its operand if it they are not in the same</span></div>
<div class="line"><a name="l07058"></a><span class="lineno"> 7058</span>&#160;  <span class="comment">// block.</span></div>
<div class="line"><a name="l07059"></a><span class="lineno"> 7059</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *BCI = dyn_cast&lt;Instruction&gt;(BC1))</div>
<div class="line"><a name="l07060"></a><span class="lineno"> 7060</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = dyn_cast&lt;Instruction&gt;(BCI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)))</div>
<div class="line"><a name="l07061"></a><span class="lineno"> 7061</span>&#160;      <span class="keywordflow">if</span> (BCI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() != <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>-&gt;getParent() &amp;&amp; !isa&lt;PHINode&gt;(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>) &amp;&amp;</div>
<div class="line"><a name="l07062"></a><span class="lineno"> 7062</span>&#160;          !<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>-&gt;isTerminator() &amp;&amp; !<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>-&gt;isEHPad())</div>
<div class="line"><a name="l07063"></a><span class="lineno"> 7063</span>&#160;        BCI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a54507f01d7d06127068ee0663233511d">moveAfter</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>);</div>
<div class="line"><a name="l07064"></a><span class="lineno"> 7064</span>&#160; </div>
<div class="line"><a name="l07065"></a><span class="lineno"> 7065</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07066"></a><span class="lineno"> 7066</span>&#160;}</div>
<div class="line"><a name="l07067"></a><span class="lineno"> 7067</span>&#160; </div>
<div class="line"><a name="l07068"></a><span class="lineno"> 7068</span>&#160;<span class="keywordtype">bool</span> CodeGenPrepare::tryToSinkFreeOperands(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l07069"></a><span class="lineno"> 7069</span>&#160;  <span class="comment">// If the operands of I can be folded into a target instruction together with</span></div>
<div class="line"><a name="l07070"></a><span class="lineno"> 7070</span>&#160;  <span class="comment">// I, duplicate and sink them.</span></div>
<div class="line"><a name="l07071"></a><span class="lineno"> 7071</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Use *, 4&gt;</a> OpsToSink;</div>
<div class="line"><a name="l07072"></a><span class="lineno"> 7072</span>&#160;  <span class="keywordflow">if</span> (!TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#af90354c692164edd2fe302104aa1ae86">shouldSinkOperands</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, OpsToSink))</div>
<div class="line"><a name="l07073"></a><span class="lineno"> 7073</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07074"></a><span class="lineno"> 7074</span>&#160; </div>
<div class="line"><a name="l07075"></a><span class="lineno"> 7075</span>&#160;  <span class="comment">// OpsToSink can contain multiple uses in a use chain (e.g.</span></div>
<div class="line"><a name="l07076"></a><span class="lineno"> 7076</span>&#160;  <span class="comment">// (%u1 with %u1 = shufflevector), (%u2 with %u2 = zext %u1)). The dominating</span></div>
<div class="line"><a name="l07077"></a><span class="lineno"> 7077</span>&#160;  <span class="comment">// uses must come first, so we process the ops in reverse order so as to not</span></div>
<div class="line"><a name="l07078"></a><span class="lineno"> 7078</span>&#160;  <span class="comment">// create invalid IR.</span></div>
<div class="line"><a name="l07079"></a><span class="lineno"> 7079</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *TargetBB = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</div>
<div class="line"><a name="l07080"></a><span class="lineno"> 7080</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l07081"></a><span class="lineno"> 7081</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Use *, 4&gt;</a> ToReplace;</div>
<div class="line"><a name="l07082"></a><span class="lineno"> 7082</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *InsertPoint = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l07083"></a><span class="lineno"> 7083</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const Instruction *, unsigned long&gt;</a> InstOrdering;</div>
<div class="line"><a name="l07084"></a><span class="lineno"> 7084</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> InstNumber = 0;</div>
<div class="line"><a name="l07085"></a><span class="lineno"> 7085</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : *TargetBB)</div>
<div class="line"><a name="l07086"></a><span class="lineno"> 7086</span>&#160;    InstOrdering[&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = InstNumber++;</div>
<div class="line"><a name="l07087"></a><span class="lineno"> 7087</span>&#160; </div>
<div class="line"><a name="l07088"></a><span class="lineno"> 7088</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">Use</a> *U : <a class="code" href="namespacellvm.html#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(OpsToSink)) {</div>
<div class="line"><a name="l07089"></a><span class="lineno"> 7089</span>&#160;    <span class="keyword">auto</span> *UI = cast&lt;Instruction&gt;(U-&gt;get());</div>
<div class="line"><a name="l07090"></a><span class="lineno"> 7090</span>&#160;    <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(UI))</div>
<div class="line"><a name="l07091"></a><span class="lineno"> 7091</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l07092"></a><span class="lineno"> 7092</span>&#160;    <span class="keywordflow">if</span> (UI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() == TargetBB) {</div>
<div class="line"><a name="l07093"></a><span class="lineno"> 7093</span>&#160;      <span class="keywordflow">if</span> (InstOrdering[UI] &lt; InstOrdering[InsertPoint])</div>
<div class="line"><a name="l07094"></a><span class="lineno"> 7094</span>&#160;        InsertPoint = UI;</div>
<div class="line"><a name="l07095"></a><span class="lineno"> 7095</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l07096"></a><span class="lineno"> 7096</span>&#160;    }</div>
<div class="line"><a name="l07097"></a><span class="lineno"> 7097</span>&#160;    ToReplace.push_back(U);</div>
<div class="line"><a name="l07098"></a><span class="lineno"> 7098</span>&#160;  }</div>
<div class="line"><a name="l07099"></a><span class="lineno"> 7099</span>&#160; </div>
<div class="line"><a name="l07100"></a><span class="lineno"> 7100</span>&#160;  <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;Instruction *&gt;</a> MaybeDead;</div>
<div class="line"><a name="l07101"></a><span class="lineno"> 7101</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Instruction *, Instruction *&gt;</a> NewInstructions;</div>
<div class="line"><a name="l07102"></a><span class="lineno"> 7102</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">Use</a> *U : ToReplace) {</div>
<div class="line"><a name="l07103"></a><span class="lineno"> 7103</span>&#160;    <span class="keyword">auto</span> *UI = cast&lt;Instruction&gt;(U-&gt;get());</div>
<div class="line"><a name="l07104"></a><span class="lineno"> 7104</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NI = UI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a0a4d51e372293abe5e5f6dac133e80a6">clone</a>();</div>
<div class="line"><a name="l07105"></a><span class="lineno"> 7105</span>&#160; </div>
<div class="line"><a name="l07106"></a><span class="lineno"> 7106</span>&#160;    <span class="keywordflow">if</span> (IsHugeFunc) {</div>
<div class="line"><a name="l07107"></a><span class="lineno"> 7107</span>&#160;      <span class="comment">// Now we clone an instruction, its operands&#39; defs may sink to this BB</span></div>
<div class="line"><a name="l07108"></a><span class="lineno"> 7108</span>&#160;      <span class="comment">// now. So we put the operands defs&#39; BBs into FreshBBs to do optmization.</span></div>
<div class="line"><a name="l07109"></a><span class="lineno"> 7109</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NI-&gt;<a class="code" href="classllvm_1_1User.html#addec638786f763d967811b45cb662f1f">getNumOperands</a>(); ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l07110"></a><span class="lineno"> 7110</span>&#160;        <span class="keyword">auto</span> *OpDef = dyn_cast&lt;Instruction&gt;(NI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</div>
<div class="line"><a name="l07111"></a><span class="lineno"> 7111</span>&#160;        <span class="keywordflow">if</span> (!OpDef)</div>
<div class="line"><a name="l07112"></a><span class="lineno"> 7112</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l07113"></a><span class="lineno"> 7113</span>&#160;        FreshBBs.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(OpDef-&gt;getParent());</div>
<div class="line"><a name="l07114"></a><span class="lineno"> 7114</span>&#160;      }</div>
<div class="line"><a name="l07115"></a><span class="lineno"> 7115</span>&#160;    }</div>
<div class="line"><a name="l07116"></a><span class="lineno"> 7116</span>&#160; </div>
<div class="line"><a name="l07117"></a><span class="lineno"> 7117</span>&#160;    NewInstructions[UI] = NI;</div>
<div class="line"><a name="l07118"></a><span class="lineno"> 7118</span>&#160;    MaybeDead.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(UI);</div>
<div class="line"><a name="l07119"></a><span class="lineno"> 7119</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Sinking &quot;</span> &lt;&lt; *UI &lt;&lt; <span class="stringliteral">&quot; to user &quot;</span> &lt;&lt; *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l07120"></a><span class="lineno"> 7120</span>&#160;    NI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(InsertPoint);</div>
<div class="line"><a name="l07121"></a><span class="lineno"> 7121</span>&#160;    InsertPoint = NI;</div>
<div class="line"><a name="l07122"></a><span class="lineno"> 7122</span>&#160;    InsertedInsts.insert(NI);</div>
<div class="line"><a name="l07123"></a><span class="lineno"> 7123</span>&#160; </div>
<div class="line"><a name="l07124"></a><span class="lineno"> 7124</span>&#160;    <span class="comment">// Update the use for the new instruction, making sure that we update the</span></div>
<div class="line"><a name="l07125"></a><span class="lineno"> 7125</span>&#160;    <span class="comment">// sunk instruction uses, if it is part of a chain that has already been</span></div>
<div class="line"><a name="l07126"></a><span class="lineno"> 7126</span>&#160;    <span class="comment">// sunk.</span></div>
<div class="line"><a name="l07127"></a><span class="lineno"> 7127</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *OldI = cast&lt;Instruction&gt;(U-&gt;getUser());</div>
<div class="line"><a name="l07128"></a><span class="lineno"> 7128</span>&#160;    <span class="keywordflow">if</span> (NewInstructions.<a class="code" href="classllvm_1_1DenseMapBase.html#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(OldI))</div>
<div class="line"><a name="l07129"></a><span class="lineno"> 7129</span>&#160;      NewInstructions[OldI]-&gt;setOperand(U-&gt;getOperandNo(), NI);</div>
<div class="line"><a name="l07130"></a><span class="lineno"> 7130</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l07131"></a><span class="lineno"> 7131</span>&#160;      U-&gt;set(NI);</div>
<div class="line"><a name="l07132"></a><span class="lineno"> 7132</span>&#160;    Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l07133"></a><span class="lineno"> 7133</span>&#160;  }</div>
<div class="line"><a name="l07134"></a><span class="lineno"> 7134</span>&#160; </div>
<div class="line"><a name="l07135"></a><span class="lineno"> 7135</span>&#160;  <span class="comment">// Remove instructions that are dead after sinking.</span></div>
<div class="line"><a name="l07136"></a><span class="lineno"> 7136</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : MaybeDead) {</div>
<div class="line"><a name="l07137"></a><span class="lineno"> 7137</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasNUsesOrMore(1)) {</div>
<div class="line"><a name="l07138"></a><span class="lineno"> 7138</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Removing dead instruction: &quot;</span> &lt;&lt; *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l07139"></a><span class="lineno"> 7139</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l07140"></a><span class="lineno"> 7140</span>&#160;    }</div>
<div class="line"><a name="l07141"></a><span class="lineno"> 7141</span>&#160;  }</div>
<div class="line"><a name="l07142"></a><span class="lineno"> 7142</span>&#160; </div>
<div class="line"><a name="l07143"></a><span class="lineno"> 7143</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l07144"></a><span class="lineno"> 7144</span>&#160;}</div>
<div class="line"><a name="l07145"></a><span class="lineno"> 7145</span>&#160; </div>
<div class="line"><a name="l07146"></a><span class="lineno"> 7146</span>&#160;<span class="keywordtype">bool</span> CodeGenPrepare::optimizeSwitchType(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>) {</div>
<div class="line"><a name="l07147"></a><span class="lineno"> 7147</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a> = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getCondition();</div>
<div class="line"><a name="l07148"></a><span class="lineno"> 7148</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *OldType = <a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>-&gt;getType();</div>
<div class="line"><a name="l07149"></a><span class="lineno"> 7149</span>&#160;  <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;<a class="code" href="NVVMIntrRange_8cpp.html#afad351d7bf10ac0446b64e7827634e94">Context</a> = <a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>-&gt;getContext();</div>
<div class="line"><a name="l07150"></a><span class="lineno"> 7150</span>&#160;  <a class="code" href="structllvm_1_1EVT.html">EVT</a> OldVT = TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(*<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, OldType);</div>
<div class="line"><a name="l07151"></a><span class="lineno"> 7151</span>&#160;  <a class="code" href="classllvm_1_1MVT.html">MVT</a> RegType = TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a79ca0cc68830eccfb4d7e2f4bdfd9857">getPreferredSwitchConditionType</a>(<a class="code" href="NVVMIntrRange_8cpp.html#afad351d7bf10ac0446b64e7827634e94">Context</a>, OldVT);</div>
<div class="line"><a name="l07152"></a><span class="lineno"> 7152</span>&#160;  <span class="keywordtype">unsigned</span> RegWidth = RegType.<a class="code" href="classllvm_1_1MVT.html#a7be7c6dd92efc0d6f866d4a3b433eed0">getSizeInBits</a>();</div>
<div class="line"><a name="l07153"></a><span class="lineno"> 7153</span>&#160; </div>
<div class="line"><a name="l07154"></a><span class="lineno"> 7154</span>&#160;  <span class="keywordflow">if</span> (RegWidth &lt;= cast&lt;IntegerType&gt;(OldType)-&gt;<a class="code" href="ValueTracking_8cpp.html#a2cb59ea8f9e8543986d40c48acfd24a3">getBitWidth</a>())</div>
<div class="line"><a name="l07155"></a><span class="lineno"> 7155</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07156"></a><span class="lineno"> 7156</span>&#160; </div>
<div class="line"><a name="l07157"></a><span class="lineno"> 7157</span>&#160;  <span class="comment">// If the register width is greater than the type width, expand the condition</span></div>
<div class="line"><a name="l07158"></a><span class="lineno"> 7158</span>&#160;  <span class="comment">// of the switch instruction and each case constant to the width of the</span></div>
<div class="line"><a name="l07159"></a><span class="lineno"> 7159</span>&#160;  <span class="comment">// register. By widening the type of the switch condition, subsequent</span></div>
<div class="line"><a name="l07160"></a><span class="lineno"> 7160</span>&#160;  <span class="comment">// comparisons (for case comparisons) will not need to be extended to the</span></div>
<div class="line"><a name="l07161"></a><span class="lineno"> 7161</span>&#160;  <span class="comment">// preferred register width, so we will potentially eliminate N-1 extends,</span></div>
<div class="line"><a name="l07162"></a><span class="lineno"> 7162</span>&#160;  <span class="comment">// where N is the number of cases in the switch.</span></div>
<div class="line"><a name="l07163"></a><span class="lineno"> 7163</span>&#160;  <span class="keyword">auto</span> *NewType = Type::getIntNTy(<a class="code" href="NVVMIntrRange_8cpp.html#afad351d7bf10ac0446b64e7827634e94">Context</a>, RegWidth);</div>
<div class="line"><a name="l07164"></a><span class="lineno"> 7164</span>&#160; </div>
<div class="line"><a name="l07165"></a><span class="lineno"> 7165</span>&#160;  <span class="comment">// Extend the switch condition and case constants using the target preferred</span></div>
<div class="line"><a name="l07166"></a><span class="lineno"> 7166</span>&#160;  <span class="comment">// extend unless the switch condition is a function argument with an extend</span></div>
<div class="line"><a name="l07167"></a><span class="lineno"> 7167</span>&#160;  <span class="comment">// attribute. In that case, we can avoid an unnecessary mask/extension by</span></div>
<div class="line"><a name="l07168"></a><span class="lineno"> 7168</span>&#160;  <span class="comment">// matching the argument extension instead.</span></div>
<div class="line"><a name="l07169"></a><span class="lineno"> 7169</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html#afa0b2fa29ba074f2b6ec9ac11163f2d9">Instruction::CastOps</a> ExtType = Instruction::ZExt;</div>
<div class="line"><a name="l07170"></a><span class="lineno"> 7170</span>&#160;  <span class="comment">// Some targets prefer SExt over ZExt.</span></div>
<div class="line"><a name="l07171"></a><span class="lineno"> 7171</span>&#160;  <span class="keywordflow">if</span> (TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a29366507d51536f380af3c2184bfe374">isSExtCheaperThanZExt</a>(OldVT, RegType))</div>
<div class="line"><a name="l07172"></a><span class="lineno"> 7172</span>&#160;    ExtType = Instruction::SExt;</div>
<div class="line"><a name="l07173"></a><span class="lineno"> 7173</span>&#160; </div>
<div class="line"><a name="l07174"></a><span class="lineno"> 7174</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a> = dyn_cast&lt;Argument&gt;(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>)) {</div>
<div class="line"><a name="l07175"></a><span class="lineno"> 7175</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a>-&gt;hasSExtAttr())</div>
<div class="line"><a name="l07176"></a><span class="lineno"> 7176</span>&#160;      ExtType = Instruction::SExt;</div>
<div class="line"><a name="l07177"></a><span class="lineno"> 7177</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a>-&gt;hasZExtAttr())</div>
<div class="line"><a name="l07178"></a><span class="lineno"> 7178</span>&#160;      ExtType = Instruction::ZExt;</div>
<div class="line"><a name="l07179"></a><span class="lineno"> 7179</span>&#160;  }</div>
<div class="line"><a name="l07180"></a><span class="lineno"> 7180</span>&#160; </div>
<div class="line"><a name="l07181"></a><span class="lineno"> 7181</span>&#160;  <span class="keyword">auto</span> *ExtInst = CastInst::Create(ExtType, <a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>, NewType);</div>
<div class="line"><a name="l07182"></a><span class="lineno"> 7182</span>&#160;  ExtInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l07183"></a><span class="lineno"> 7183</span>&#160;  ExtInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getDebugLoc());</div>
<div class="line"><a name="l07184"></a><span class="lineno"> 7184</span>&#160;  <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;setCondition(ExtInst);</div>
<div class="line"><a name="l07185"></a><span class="lineno"> 7185</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> Case : <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;cases()) {</div>
<div class="line"><a name="l07186"></a><span class="lineno"> 7186</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;NarrowConst = Case.getCaseValue()-&gt;getValue();</div>
<div class="line"><a name="l07187"></a><span class="lineno"> 7187</span>&#160;    <a class="code" href="classllvm_1_1APInt.html">APInt</a> WideConst = (ExtType == Instruction::ZExt)</div>
<div class="line"><a name="l07188"></a><span class="lineno"> 7188</span>&#160;                          ? NarrowConst.<a class="code" href="classllvm_1_1APInt.html#a1dc76cc8bf703e6ada68bededcbb9573">zext</a>(RegWidth)</div>
<div class="line"><a name="l07189"></a><span class="lineno"> 7189</span>&#160;                          : NarrowConst.<a class="code" href="classllvm_1_1APInt.html#aca8fce65eb69a82aa10a635e2e79877a">sext</a>(RegWidth);</div>
<div class="line"><a name="l07190"></a><span class="lineno"> 7190</span>&#160;    Case.setValue(<a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantInt::get</a>(<a class="code" href="NVVMIntrRange_8cpp.html#afad351d7bf10ac0446b64e7827634e94">Context</a>, WideConst));</div>
<div class="line"><a name="l07191"></a><span class="lineno"> 7191</span>&#160;  }</div>
<div class="line"><a name="l07192"></a><span class="lineno"> 7192</span>&#160; </div>
<div class="line"><a name="l07193"></a><span class="lineno"> 7193</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07194"></a><span class="lineno"> 7194</span>&#160;}</div>
<div class="line"><a name="l07195"></a><span class="lineno"> 7195</span>&#160; </div>
<div class="line"><a name="l07196"></a><span class="lineno"> 7196</span>&#160;<span class="keywordtype">bool</span> CodeGenPrepare::optimizeSwitchPhiConstants(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>) {</div>
<div class="line"><a name="l07197"></a><span class="lineno"> 7197</span>&#160;  <span class="comment">// The SCCP optimization tends to produce code like this:</span></div>
<div class="line"><a name="l07198"></a><span class="lineno"> 7198</span>&#160;  <span class="comment">//   switch(x) { case 42: phi(42, ...) }</span></div>
<div class="line"><a name="l07199"></a><span class="lineno"> 7199</span>&#160;  <span class="comment">// Materializing the constant for the phi-argument needs instructions; So we</span></div>
<div class="line"><a name="l07200"></a><span class="lineno"> 7200</span>&#160;  <span class="comment">// change the code to:</span></div>
<div class="line"><a name="l07201"></a><span class="lineno"> 7201</span>&#160;  <span class="comment">//   switch(x) { case 42: phi(x, ...) }</span></div>
<div class="line"><a name="l07202"></a><span class="lineno"> 7202</span>&#160; </div>
<div class="line"><a name="l07203"></a><span class="lineno"> 7203</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Condition = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getCondition();</div>
<div class="line"><a name="l07204"></a><span class="lineno"> 7204</span>&#160;  <span class="comment">// Avoid endless loop in degenerate case.</span></div>
<div class="line"><a name="l07205"></a><span class="lineno"> 7205</span>&#160;  <span class="keywordflow">if</span> (isa&lt;ConstantInt&gt;(*Condition))</div>
<div class="line"><a name="l07206"></a><span class="lineno"> 7206</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07207"></a><span class="lineno"> 7207</span>&#160; </div>
<div class="line"><a name="l07208"></a><span class="lineno"> 7208</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l07209"></a><span class="lineno"> 7209</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *SwitchBB = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getParent();</div>
<div class="line"><a name="l07210"></a><span class="lineno"> 7210</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *ConditionType = Condition-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l07211"></a><span class="lineno"> 7211</span>&#160; </div>
<div class="line"><a name="l07212"></a><span class="lineno"> 7212</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SwitchInst_1_1CaseHandle.html">SwitchInst::CaseHandle</a> &amp;Case : <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;cases()) {</div>
<div class="line"><a name="l07213"></a><span class="lineno"> 7213</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CaseValue = Case.getCaseValue();</div>
<div class="line"><a name="l07214"></a><span class="lineno"> 7214</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *CaseBB = Case.getCaseSuccessor();</div>
<div class="line"><a name="l07215"></a><span class="lineno"> 7215</span>&#160;    <span class="comment">// Set to true if we previously checked that `CaseBB` is only reached by</span></div>
<div class="line"><a name="l07216"></a><span class="lineno"> 7216</span>&#160;    <span class="comment">// a single case from this switch.</span></div>
<div class="line"><a name="l07217"></a><span class="lineno"> 7217</span>&#160;    <span class="keywordtype">bool</span> CheckedForSinglePred = <span class="keyword">false</span>;</div>
<div class="line"><a name="l07218"></a><span class="lineno"> 7218</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> &amp;<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> : CaseBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a72516971c5734dc0f7546e64affca425">phis</a>()) {</div>
<div class="line"><a name="l07219"></a><span class="lineno"> 7219</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *PHIType = <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getType();</div>
<div class="line"><a name="l07220"></a><span class="lineno"> 7220</span>&#160;      <span class="comment">// If ZExt is free then we can also catch patterns like this:</span></div>
<div class="line"><a name="l07221"></a><span class="lineno"> 7221</span>&#160;      <span class="comment">//   switch((i32)x) { case 42: phi((i64)42, ...); }</span></div>
<div class="line"><a name="l07222"></a><span class="lineno"> 7222</span>&#160;      <span class="comment">// and replace `(i64)42` with `zext i32 %x to i64`.</span></div>
<div class="line"><a name="l07223"></a><span class="lineno"> 7223</span>&#160;      <span class="keywordtype">bool</span> TryZExt =</div>
<div class="line"><a name="l07224"></a><span class="lineno"> 7224</span>&#160;          PHIType-&gt;<a class="code" href="classllvm_1_1Type.html#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp;</div>
<div class="line"><a name="l07225"></a><span class="lineno"> 7225</span>&#160;          PHIType-&gt;<a class="code" href="classllvm_1_1Type.html#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>() &gt; ConditionType-&gt;<a class="code" href="classllvm_1_1Type.html#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>() &amp;&amp;</div>
<div class="line"><a name="l07226"></a><span class="lineno"> 7226</span>&#160;          TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a342be90695496b88a8854a775dfd030f">isZExtFree</a>(ConditionType, PHIType);</div>
<div class="line"><a name="l07227"></a><span class="lineno"> 7227</span>&#160;      <span class="keywordflow">if</span> (PHIType == ConditionType || TryZExt) {</div>
<div class="line"><a name="l07228"></a><span class="lineno"> 7228</span>&#160;        <span class="comment">// Set to true to skip this case because of multiple preds.</span></div>
<div class="line"><a name="l07229"></a><span class="lineno"> 7229</span>&#160;        <span class="keywordtype">bool</span> SkipCase = <span class="keyword">false</span>;</div>
<div class="line"><a name="l07230"></a><span class="lineno"> 7230</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *Replacement = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l07231"></a><span class="lineno"> 7231</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getNumIncomingValues(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) {</div>
<div class="line"><a name="l07232"></a><span class="lineno"> 7232</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *PHIValue = <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getIncomingValue(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l07233"></a><span class="lineno"> 7233</span>&#160;          <span class="keywordflow">if</span> (PHIValue != CaseValue) {</div>
<div class="line"><a name="l07234"></a><span class="lineno"> 7234</span>&#160;            <span class="keywordflow">if</span> (!TryZExt)</div>
<div class="line"><a name="l07235"></a><span class="lineno"> 7235</span>&#160;              <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l07236"></a><span class="lineno"> 7236</span>&#160;            <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *PHIValueInt = dyn_cast&lt;ConstantInt&gt;(PHIValue);</div>
<div class="line"><a name="l07237"></a><span class="lineno"> 7237</span>&#160;            <span class="keywordflow">if</span> (!PHIValueInt ||</div>
<div class="line"><a name="l07238"></a><span class="lineno"> 7238</span>&#160;                PHIValueInt-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>() !=</div>
<div class="line"><a name="l07239"></a><span class="lineno"> 7239</span>&#160;                    CaseValue-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>().<a class="code" href="classllvm_1_1APInt.html#a1dc76cc8bf703e6ada68bededcbb9573">zext</a>(PHIType-&gt;<a class="code" href="classllvm_1_1Type.html#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>()))</div>
<div class="line"><a name="l07240"></a><span class="lineno"> 7240</span>&#160;              <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l07241"></a><span class="lineno"> 7241</span>&#160;          }</div>
<div class="line"><a name="l07242"></a><span class="lineno"> 7242</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getIncomingBlock(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) != SwitchBB)</div>
<div class="line"><a name="l07243"></a><span class="lineno"> 7243</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l07244"></a><span class="lineno"> 7244</span>&#160;          <span class="comment">// We cannot optimize if there are multiple case labels jumping to</span></div>
<div class="line"><a name="l07245"></a><span class="lineno"> 7245</span>&#160;          <span class="comment">// this block.  This check may get expensive when there are many</span></div>
<div class="line"><a name="l07246"></a><span class="lineno"> 7246</span>&#160;          <span class="comment">// case labels so we test for it last.</span></div>
<div class="line"><a name="l07247"></a><span class="lineno"> 7247</span>&#160;          <span class="keywordflow">if</span> (!CheckedForSinglePred) {</div>
<div class="line"><a name="l07248"></a><span class="lineno"> 7248</span>&#160;            CheckedForSinglePred = <span class="keyword">true</span>;</div>
<div class="line"><a name="l07249"></a><span class="lineno"> 7249</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;findCaseDest(CaseBB) == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l07250"></a><span class="lineno"> 7250</span>&#160;              SkipCase = <span class="keyword">true</span>;</div>
<div class="line"><a name="l07251"></a><span class="lineno"> 7251</span>&#160;              <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l07252"></a><span class="lineno"> 7252</span>&#160;            }</div>
<div class="line"><a name="l07253"></a><span class="lineno"> 7253</span>&#160;          }</div>
<div class="line"><a name="l07254"></a><span class="lineno"> 7254</span>&#160; </div>
<div class="line"><a name="l07255"></a><span class="lineno"> 7255</span>&#160;          <span class="keywordflow">if</span> (Replacement == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l07256"></a><span class="lineno"> 7256</span>&#160;            <span class="keywordflow">if</span> (PHIValue == CaseValue) {</div>
<div class="line"><a name="l07257"></a><span class="lineno"> 7257</span>&#160;              Replacement = Condition;</div>
<div class="line"><a name="l07258"></a><span class="lineno"> 7258</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l07259"></a><span class="lineno"> 7259</span>&#160;              <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l07260"></a><span class="lineno"> 7260</span>&#160;              Replacement = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateZExt(Condition, PHIType);</div>
<div class="line"><a name="l07261"></a><span class="lineno"> 7261</span>&#160;            }</div>
<div class="line"><a name="l07262"></a><span class="lineno"> 7262</span>&#160;          }</div>
<div class="line"><a name="l07263"></a><span class="lineno"> 7263</span>&#160;          <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.setIncomingValue(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Replacement);</div>
<div class="line"><a name="l07264"></a><span class="lineno"> 7264</span>&#160;          Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l07265"></a><span class="lineno"> 7265</span>&#160;        }</div>
<div class="line"><a name="l07266"></a><span class="lineno"> 7266</span>&#160;        <span class="keywordflow">if</span> (SkipCase)</div>
<div class="line"><a name="l07267"></a><span class="lineno"> 7267</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l07268"></a><span class="lineno"> 7268</span>&#160;      }</div>
<div class="line"><a name="l07269"></a><span class="lineno"> 7269</span>&#160;    }</div>
<div class="line"><a name="l07270"></a><span class="lineno"> 7270</span>&#160;  }</div>
<div class="line"><a name="l07271"></a><span class="lineno"> 7271</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l07272"></a><span class="lineno"> 7272</span>&#160;}</div>
<div class="line"><a name="l07273"></a><span class="lineno"> 7273</span>&#160; </div>
<div class="line"><a name="l07274"></a><span class="lineno"> 7274</span>&#160;<span class="keywordtype">bool</span> CodeGenPrepare::optimizeSwitchInst(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>) {</div>
<div class="line"><a name="l07275"></a><span class="lineno"> 7275</span>&#160;  <span class="keywordtype">bool</span> Changed = optimizeSwitchType(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l07276"></a><span class="lineno"> 7276</span>&#160;  Changed |= optimizeSwitchPhiConstants(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l07277"></a><span class="lineno"> 7277</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l07278"></a><span class="lineno"> 7278</span>&#160;}</div>
<div class="line"><a name="l07279"></a><span class="lineno"> 7279</span>&#160; </div>
<div class="line"><a name="l07280"></a><span class="lineno"> 7280</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l07281"></a><span class="lineno"> 7281</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07282"></a><span class="lineno"> 7282</span>&#160;<span class="comment">/// Helper class to promote a scalar operation to a vector one.</span></div>
<div class="line"><a name="l07283"></a><span class="lineno"> 7283</span>&#160;<span class="comment">/// This class is used to move downward extractelement transition.</span></div>
<div class="line"><a name="l07284"></a><span class="lineno"> 7284</span>&#160;<span class="comment">/// E.g.,</span></div>
<div class="line"><a name="l07285"></a><span class="lineno"> 7285</span>&#160;<span class="comment">/// a = vector_op &lt;2 x i32&gt;</span></div>
<div class="line"><a name="l07286"></a><span class="lineno"> 7286</span>&#160;<span class="comment">/// b = extractelement &lt;2 x i32&gt; a, i32 0</span></div>
<div class="line"><a name="l07287"></a><span class="lineno"> 7287</span>&#160;<span class="comment">/// c = scalar_op b</span></div>
<div class="line"><a name="l07288"></a><span class="lineno"> 7288</span>&#160;<span class="comment">/// store c</span></div>
<div class="line"><a name="l07289"></a><span class="lineno"> 7289</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l07290"></a><span class="lineno"> 7290</span>&#160;<span class="comment">/// =&gt;</span></div>
<div class="line"><a name="l07291"></a><span class="lineno"> 7291</span>&#160;<span class="comment">/// a = vector_op &lt;2 x i32&gt;</span></div>
<div class="line"><a name="l07292"></a><span class="lineno"> 7292</span>&#160;<span class="comment">/// c = vector_op a (equivalent to scalar_op on the related lane)</span></div>
<div class="line"><a name="l07293"></a><span class="lineno"> 7293</span>&#160;<span class="comment">/// * d = extractelement &lt;2 x i32&gt; c, i32 0</span></div>
<div class="line"><a name="l07294"></a><span class="lineno"> 7294</span>&#160;<span class="comment">/// * store d</span></div>
<div class="line"><a name="l07295"></a><span class="lineno"> 7295</span>&#160;<span class="comment">/// Assuming both extractelement and store can be combine, we get rid of the</span></div>
<div class="line"><a name="l07296"></a><span class="lineno"> 7296</span>&#160;<span class="comment">/// transition.</span></div>
<div class="line"><a name="l07297"></a><span class="lineno"> 7297</span>&#160;<span class="comment"></span><span class="keyword">class </span>VectorPromoteHelper {<span class="comment"></span></div>
<div class="line"><a name="l07298"></a><span class="lineno"> 7298</span>&#160;<span class="comment">  /// DataLayout associated with the current module.</span></div>
<div class="line"><a name="l07299"></a><span class="lineno"> 7299</span>&#160;<span class="comment"></span>  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>;</div>
<div class="line"><a name="l07300"></a><span class="lineno"> 7300</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07301"></a><span class="lineno"> 7301</span>&#160;<span class="comment">  /// Used to perform some checks on the legality of vector operations.</span></div>
<div class="line"><a name="l07302"></a><span class="lineno"> 7302</span>&#160;<span class="comment"></span>  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI;</div>
<div class="line"><a name="l07303"></a><span class="lineno"> 7303</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07304"></a><span class="lineno"> 7304</span>&#160;<span class="comment">  /// Used to estimated the cost of the promoted chain.</span></div>
<div class="line"><a name="l07305"></a><span class="lineno"> 7305</span>&#160;<span class="comment"></span>  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="namespacellvm.html#aa0d69e81725c10fa5407f0bf34462068">TTI</a>;</div>
<div class="line"><a name="l07306"></a><span class="lineno"> 7306</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07307"></a><span class="lineno"> 7307</span>&#160;<span class="comment">  /// The transition being moved downwards.</span></div>
<div class="line"><a name="l07308"></a><span class="lineno"> 7308</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Transition;</div>
<div class="line"><a name="l07309"></a><span class="lineno"> 7309</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07310"></a><span class="lineno"> 7310</span>&#160;<span class="comment">  /// The sequence of instructions to be promoted.</span></div>
<div class="line"><a name="l07311"></a><span class="lineno"> 7311</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 4&gt;</a> InstsToBePromoted;</div>
<div class="line"><a name="l07312"></a><span class="lineno"> 7312</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07313"></a><span class="lineno"> 7313</span>&#160;<span class="comment">  /// Cost of combining a store and an extract.</span></div>
<div class="line"><a name="l07314"></a><span class="lineno"> 7314</span>&#160;<span class="comment"></span>  <span class="keywordtype">unsigned</span> StoreExtractCombineCost;</div>
<div class="line"><a name="l07315"></a><span class="lineno"> 7315</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07316"></a><span class="lineno"> 7316</span>&#160;<span class="comment">  /// Instruction that will be combined with the transition.</span></div>
<div class="line"><a name="l07317"></a><span class="lineno"> 7317</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *CombineInst = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l07318"></a><span class="lineno"> 7318</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07319"></a><span class="lineno"> 7319</span>&#160;<span class="comment">  /// The instruction that represents the current end of the transition.</span></div>
<div class="line"><a name="l07320"></a><span class="lineno"> 7320</span>&#160;<span class="comment">  /// Since we are faking the promotion until we reach the end of the chain</span></div>
<div class="line"><a name="l07321"></a><span class="lineno"> 7321</span>&#160;<span class="comment">  /// of computation, we need a way to get the current end of the transition.</span></div>
<div class="line"><a name="l07322"></a><span class="lineno"> 7322</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *getEndOfTransition()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l07323"></a><span class="lineno"> 7323</span>&#160;    <span class="keywordflow">if</span> (InstsToBePromoted.empty())</div>
<div class="line"><a name="l07324"></a><span class="lineno"> 7324</span>&#160;      <span class="keywordflow">return</span> Transition;</div>
<div class="line"><a name="l07325"></a><span class="lineno"> 7325</span>&#160;    <span class="keywordflow">return</span> InstsToBePromoted.back();</div>
<div class="line"><a name="l07326"></a><span class="lineno"> 7326</span>&#160;  }</div>
<div class="line"><a name="l07327"></a><span class="lineno"> 7327</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07328"></a><span class="lineno"> 7328</span>&#160;<span class="comment">  /// Return the index of the original value in the transition.</span></div>
<div class="line"><a name="l07329"></a><span class="lineno"> 7329</span>&#160;<span class="comment">  /// E.g., for &quot;extractelement &lt;2 x i32&gt; c, i32 1&quot; the original value,</span></div>
<div class="line"><a name="l07330"></a><span class="lineno"> 7330</span>&#160;<span class="comment">  /// c, is at index 0.</span></div>
<div class="line"><a name="l07331"></a><span class="lineno"> 7331</span>&#160;<span class="comment"></span>  <span class="keywordtype">unsigned</span> getTransitionOriginalValueIdx()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l07332"></a><span class="lineno"> 7332</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isa&lt;ExtractElementInst&gt;(Transition) &amp;&amp;</div>
<div class="line"><a name="l07333"></a><span class="lineno"> 7333</span>&#160;           <span class="stringliteral">&quot;Other kind of transitions are not supported yet&quot;</span>);</div>
<div class="line"><a name="l07334"></a><span class="lineno"> 7334</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l07335"></a><span class="lineno"> 7335</span>&#160;  }</div>
<div class="line"><a name="l07336"></a><span class="lineno"> 7336</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07337"></a><span class="lineno"> 7337</span>&#160;<span class="comment">  /// Return the index of the index in the transition.</span></div>
<div class="line"><a name="l07338"></a><span class="lineno"> 7338</span>&#160;<span class="comment">  /// E.g., for &quot;extractelement &lt;2 x i32&gt; c, i32 0&quot; the index</span></div>
<div class="line"><a name="l07339"></a><span class="lineno"> 7339</span>&#160;<span class="comment">  /// is at index 1.</span></div>
<div class="line"><a name="l07340"></a><span class="lineno"> 7340</span>&#160;<span class="comment"></span>  <span class="keywordtype">unsigned</span> getTransitionIdx()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l07341"></a><span class="lineno"> 7341</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isa&lt;ExtractElementInst&gt;(Transition) &amp;&amp;</div>
<div class="line"><a name="l07342"></a><span class="lineno"> 7342</span>&#160;           <span class="stringliteral">&quot;Other kind of transitions are not supported yet&quot;</span>);</div>
<div class="line"><a name="l07343"></a><span class="lineno"> 7343</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l07344"></a><span class="lineno"> 7344</span>&#160;  }</div>
<div class="line"><a name="l07345"></a><span class="lineno"> 7345</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07346"></a><span class="lineno"> 7346</span>&#160;<span class="comment">  /// Get the type of the transition.</span></div>
<div class="line"><a name="l07347"></a><span class="lineno"> 7347</span>&#160;<span class="comment">  /// This is the type of the original value.</span></div>
<div class="line"><a name="l07348"></a><span class="lineno"> 7348</span>&#160;<span class="comment">  /// E.g., for &quot;extractelement &lt;2 x i32&gt; c, i32 1&quot; the type of the</span></div>
<div class="line"><a name="l07349"></a><span class="lineno"> 7349</span>&#160;<span class="comment">  /// transition is &lt;2 x i32&gt;.</span></div>
<div class="line"><a name="l07350"></a><span class="lineno"> 7350</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Type.html">Type</a> *getTransitionType()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l07351"></a><span class="lineno"> 7351</span>&#160;    <span class="keywordflow">return</span> Transition-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(getTransitionOriginalValueIdx())-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l07352"></a><span class="lineno"> 7352</span>&#160;  }</div>
<div class="line"><a name="l07353"></a><span class="lineno"> 7353</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07354"></a><span class="lineno"> 7354</span>&#160;<span class="comment">  /// Promote \p ToBePromoted by moving \p Def downward through.</span></div>
<div class="line"><a name="l07355"></a><span class="lineno"> 7355</span>&#160;<span class="comment">  /// I.e., we have the following sequence:</span></div>
<div class="line"><a name="l07356"></a><span class="lineno"> 7356</span>&#160;<span class="comment">  /// Def = Transition &lt;ty1&gt; a to &lt;ty2&gt;</span></div>
<div class="line"><a name="l07357"></a><span class="lineno"> 7357</span>&#160;<span class="comment">  /// b = ToBePromoted &lt;ty2&gt; Def, ...</span></div>
<div class="line"><a name="l07358"></a><span class="lineno"> 7358</span>&#160;<span class="comment">  /// =&gt;</span></div>
<div class="line"><a name="l07359"></a><span class="lineno"> 7359</span>&#160;<span class="comment">  /// b = ToBePromoted &lt;ty1&gt; a, ...</span></div>
<div class="line"><a name="l07360"></a><span class="lineno"> 7360</span>&#160;<span class="comment">  /// Def = Transition &lt;ty1&gt; ToBePromoted to &lt;ty2&gt;</span></div>
<div class="line"><a name="l07361"></a><span class="lineno"> 7361</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> promoteImpl(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ToBePromoted);</div>
<div class="line"><a name="l07362"></a><span class="lineno"> 7362</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07363"></a><span class="lineno"> 7363</span>&#160;<span class="comment">  /// Check whether or not it is profitable to promote all the</span></div>
<div class="line"><a name="l07364"></a><span class="lineno"> 7364</span>&#160;<span class="comment">  /// instructions enqueued to be promoted.</span></div>
<div class="line"><a name="l07365"></a><span class="lineno"> 7365</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> isProfitableToPromote() {</div>
<div class="line"><a name="l07366"></a><span class="lineno"> 7366</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *ValIdx = Transition-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(getTransitionOriginalValueIdx());</div>
<div class="line"><a name="l07367"></a><span class="lineno"> 7367</span>&#160;    <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a> = isa&lt;ConstantInt&gt;(ValIdx)</div>
<div class="line"><a name="l07368"></a><span class="lineno"> 7368</span>&#160;                         ? cast&lt;ConstantInt&gt;(ValIdx)-&gt;getZExtValue()</div>
<div class="line"><a name="l07369"></a><span class="lineno"> 7369</span>&#160;                         : -1;</div>
<div class="line"><a name="l07370"></a><span class="lineno"> 7370</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *PromotedType = getTransitionType();</div>
<div class="line"><a name="l07371"></a><span class="lineno"> 7371</span>&#160; </div>
<div class="line"><a name="l07372"></a><span class="lineno"> 7372</span>&#160;    <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a> = cast&lt;StoreInst&gt;(CombineInst);</div>
<div class="line"><a name="l07373"></a><span class="lineno"> 7373</span>&#160;    <span class="keywordtype">unsigned</span> AS = <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;getPointerAddressSpace();</div>
<div class="line"><a name="l07374"></a><span class="lineno"> 7374</span>&#160;    <span class="comment">// Check if this store is supported.</span></div>
<div class="line"><a name="l07375"></a><span class="lineno"> 7375</span>&#160;    <span class="keywordflow">if</span> (!TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#a63b5343b9da17f8bcc83ec545022f5c7">allowsMisalignedMemoryAccesses</a>(</div>
<div class="line"><a name="l07376"></a><span class="lineno"> 7376</span>&#160;            TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;getValueOperand()-&gt;getType()), AS,</div>
<div class="line"><a name="l07377"></a><span class="lineno"> 7377</span>&#160;            <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;getAlign())) {</div>
<div class="line"><a name="l07378"></a><span class="lineno"> 7378</span>&#160;      <span class="comment">// If this is not supported, there is no way we can combine</span></div>
<div class="line"><a name="l07379"></a><span class="lineno"> 7379</span>&#160;      <span class="comment">// the extract with the store.</span></div>
<div class="line"><a name="l07380"></a><span class="lineno"> 7380</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07381"></a><span class="lineno"> 7381</span>&#160;    }</div>
<div class="line"><a name="l07382"></a><span class="lineno"> 7382</span>&#160; </div>
<div class="line"><a name="l07383"></a><span class="lineno"> 7383</span>&#160;    <span class="comment">// The scalar chain of computation has to pay for the transition</span></div>
<div class="line"><a name="l07384"></a><span class="lineno"> 7384</span>&#160;    <span class="comment">// scalar to vector.</span></div>
<div class="line"><a name="l07385"></a><span class="lineno"> 7385</span>&#160;    <span class="comment">// The vector chain has to account for the combining cost.</span></div>
<div class="line"><a name="l07386"></a><span class="lineno"> 7386</span>&#160;    <span class="keyword">enum</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html#a706f223f760b55668fbae74202b816bb">TargetTransformInfo::TargetCostKind</a> <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a> =</div>
<div class="line"><a name="l07387"></a><span class="lineno"> 7387</span>&#160;        TargetTransformInfo::TCK_RecipThroughput;</div>
<div class="line"><a name="l07388"></a><span class="lineno"> 7388</span>&#160;    <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> ScalarCost =</div>
<div class="line"><a name="l07389"></a><span class="lineno"> 7389</span>&#160;        <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>.<a class="code" href="classllvm_1_1TargetTransformInfo.html#af37b2842424eb63440bdcacca0af9820">getVectorInstrCost</a>(*Transition, PromotedType, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>, <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>);</div>
<div class="line"><a name="l07390"></a><span class="lineno"> 7390</span>&#160;    <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> VectorCost = StoreExtractCombineCost;</div>
<div class="line"><a name="l07391"></a><span class="lineno"> 7391</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;Inst : InstsToBePromoted) {</div>
<div class="line"><a name="l07392"></a><span class="lineno"> 7392</span>&#160;      <span class="comment">// Compute the cost.</span></div>
<div class="line"><a name="l07393"></a><span class="lineno"> 7393</span>&#160;      <span class="comment">// By construction, all instructions being promoted are arithmetic ones.</span></div>
<div class="line"><a name="l07394"></a><span class="lineno"> 7394</span>&#160;      <span class="comment">// Moreover, one argument is a constant that can be viewed as a splat</span></div>
<div class="line"><a name="l07395"></a><span class="lineno"> 7395</span>&#160;      <span class="comment">// constant.</span></div>
<div class="line"><a name="l07396"></a><span class="lineno"> 7396</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg0 = Inst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l07397"></a><span class="lineno"> 7397</span>&#160;      <span class="keywordtype">bool</span> IsArg0Constant = isa&lt;UndefValue&gt;(Arg0) || isa&lt;ConstantInt&gt;(Arg0) ||</div>
<div class="line"><a name="l07398"></a><span class="lineno"> 7398</span>&#160;                            isa&lt;ConstantFP&gt;(Arg0);</div>
<div class="line"><a name="l07399"></a><span class="lineno"> 7399</span>&#160;      <a class="code" href="structllvm_1_1TargetTransformInfo_1_1OperandValueInfo.html">TargetTransformInfo::OperandValueInfo</a> Arg0Info, Arg1Info;</div>
<div class="line"><a name="l07400"></a><span class="lineno"> 7400</span>&#160;      <span class="keywordflow">if</span> (IsArg0Constant)</div>
<div class="line"><a name="l07401"></a><span class="lineno"> 7401</span>&#160;        Arg0Info.<a class="code" href="structllvm_1_1TargetTransformInfo_1_1OperandValueInfo.html#a930b0b2be537d928348aa0946f61dcd6">Kind</a> = TargetTransformInfo::OK_UniformConstantValue;</div>
<div class="line"><a name="l07402"></a><span class="lineno"> 7402</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l07403"></a><span class="lineno"> 7403</span>&#160;        Arg1Info.<a class="code" href="structllvm_1_1TargetTransformInfo_1_1OperandValueInfo.html#a930b0b2be537d928348aa0946f61dcd6">Kind</a> = TargetTransformInfo::OK_UniformConstantValue;</div>
<div class="line"><a name="l07404"></a><span class="lineno"> 7404</span>&#160; </div>
<div class="line"><a name="l07405"></a><span class="lineno"> 7405</span>&#160;      ScalarCost += <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>.<a class="code" href="classllvm_1_1TargetTransformInfo.html#a9679969ae87f8a08d5f6948be6cf7210">getArithmeticInstrCost</a>(</div>
<div class="line"><a name="l07406"></a><span class="lineno"> 7406</span>&#160;          Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>(), Inst-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>, Arg0Info, Arg1Info);</div>
<div class="line"><a name="l07407"></a><span class="lineno"> 7407</span>&#160;      VectorCost += <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>.<a class="code" href="classllvm_1_1TargetTransformInfo.html#a9679969ae87f8a08d5f6948be6cf7210">getArithmeticInstrCost</a>(Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>(), PromotedType,</div>
<div class="line"><a name="l07408"></a><span class="lineno"> 7408</span>&#160;                                               <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>, Arg0Info, Arg1Info);</div>
<div class="line"><a name="l07409"></a><span class="lineno"> 7409</span>&#160;    }</div>
<div class="line"><a name="l07410"></a><span class="lineno"> 7410</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(</div>
<div class="line"><a name="l07411"></a><span class="lineno"> 7411</span>&#160;        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Estimated cost of computation to be promoted:\nScalar: &quot;</span></div>
<div class="line"><a name="l07412"></a><span class="lineno"> 7412</span>&#160;               &lt;&lt; ScalarCost &lt;&lt; <span class="stringliteral">&quot;\nVector: &quot;</span> &lt;&lt; VectorCost &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l07413"></a><span class="lineno"> 7413</span>&#160;    <span class="keywordflow">return</span> ScalarCost &gt; VectorCost;</div>
<div class="line"><a name="l07414"></a><span class="lineno"> 7414</span>&#160;  }</div>
<div class="line"><a name="l07415"></a><span class="lineno"> 7415</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07416"></a><span class="lineno"> 7416</span>&#160;<span class="comment">  /// Generate a constant vector with \p Val with the same</span></div>
<div class="line"><a name="l07417"></a><span class="lineno"> 7417</span>&#160;<span class="comment">  /// number of elements as the transition.</span></div>
<div class="line"><a name="l07418"></a><span class="lineno"> 7418</span>&#160;<span class="comment">  /// \p UseSplat defines whether or not \p Val should be replicated</span></div>
<div class="line"><a name="l07419"></a><span class="lineno"> 7419</span>&#160;<span class="comment">  /// across the whole vector.</span></div>
<div class="line"><a name="l07420"></a><span class="lineno"> 7420</span>&#160;<span class="comment">  /// In other words, if UseSplat == true, we generate &lt;Val, Val, ..., Val&gt;,</span></div>
<div class="line"><a name="l07421"></a><span class="lineno"> 7421</span>&#160;<span class="comment">  /// otherwise we generate a vector with as many undef as possible:</span></div>
<div class="line"><a name="l07422"></a><span class="lineno"> 7422</span>&#160;<span class="comment">  /// &lt;undef, ..., undef, Val, undef, ..., undef&gt; where \p Val is only</span></div>
<div class="line"><a name="l07423"></a><span class="lineno"> 7423</span>&#160;<span class="comment">  /// used at the index of the extract.</span></div>
<div class="line"><a name="l07424"></a><span class="lineno"> 7424</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86ISelLowering_8cpp.html#aa1cc6f0bf5007ecac3fbaccc032a4317">getConstantVector</a>(<a class="code" href="classllvm_1_1Constant.html">Constant</a> *Val, <span class="keywordtype">bool</span> UseSplat)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l07425"></a><span class="lineno"> 7425</span>&#160;    <span class="keywordtype">unsigned</span> ExtractIdx = <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::numeric_limits&lt;unsigned&gt;::max</a>();</div>
<div class="line"><a name="l07426"></a><span class="lineno"> 7426</span>&#160;    <span class="keywordflow">if</span> (!UseSplat) {</div>
<div class="line"><a name="l07427"></a><span class="lineno"> 7427</span>&#160;      <span class="comment">// If we cannot determine where the constant must be, we have to</span></div>
<div class="line"><a name="l07428"></a><span class="lineno"> 7428</span>&#160;      <span class="comment">// use a splat constant.</span></div>
<div class="line"><a name="l07429"></a><span class="lineno"> 7429</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *ValExtractIdx = Transition-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(getTransitionIdx());</div>
<div class="line"><a name="l07430"></a><span class="lineno"> 7430</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CstVal = dyn_cast&lt;ConstantInt&gt;(ValExtractIdx))</div>
<div class="line"><a name="l07431"></a><span class="lineno"> 7431</span>&#160;        ExtractIdx = CstVal-&gt;<a class="code" href="classllvm_1_1APInt.html#af2daa0ee117afefed4c82eee55bf97b7">getSExtValue</a>();</div>
<div class="line"><a name="l07432"></a><span class="lineno"> 7432</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l07433"></a><span class="lineno"> 7433</span>&#160;        UseSplat = <span class="keyword">true</span>;</div>
<div class="line"><a name="l07434"></a><span class="lineno"> 7434</span>&#160;    }</div>
<div class="line"><a name="l07435"></a><span class="lineno"> 7435</span>&#160; </div>
<div class="line"><a name="l07436"></a><span class="lineno"> 7436</span>&#160;    <a class="code" href="classllvm_1_1ElementCount.html">ElementCount</a> <a class="code" href="namespacellvm_1_1codeview.html#a2e1cbb0e2bd7a35ed99c31853dc45374a3fd6b696867d70225deda7868308679b">EC</a> = cast&lt;VectorType&gt;(getTransitionType())-&gt;getElementCount();</div>
<div class="line"><a name="l07437"></a><span class="lineno"> 7437</span>&#160;    <span class="keywordflow">if</span> (UseSplat)</div>
<div class="line"><a name="l07438"></a><span class="lineno"> 7438</span>&#160;      <span class="keywordflow">return</span> ConstantVector::getSplat(EC, Val);</div>
<div class="line"><a name="l07439"></a><span class="lineno"> 7439</span>&#160; </div>
<div class="line"><a name="l07440"></a><span class="lineno"> 7440</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1codeview.html#a2e1cbb0e2bd7a35ed99c31853dc45374a3fd6b696867d70225deda7868308679b">EC</a>.isScalable()) {</div>
<div class="line"><a name="l07441"></a><span class="lineno"> 7441</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Constant *, 4&gt;</a> ConstVec;</div>
<div class="line"><a name="l07442"></a><span class="lineno"> 7442</span>&#160;      <a class="code" href="classllvm_1_1UndefValue.html">UndefValue</a> *UndefVal = <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">UndefValue::get</a>(Val-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l07443"></a><span class="lineno"> 7443</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Idx = 0; Idx != <a class="code" href="namespacellvm_1_1codeview.html#a2e1cbb0e2bd7a35ed99c31853dc45374a3fd6b696867d70225deda7868308679b">EC</a>.getKnownMinValue(); ++Idx) {</div>
<div class="line"><a name="l07444"></a><span class="lineno"> 7444</span>&#160;        <span class="keywordflow">if</span> (Idx == ExtractIdx)</div>
<div class="line"><a name="l07445"></a><span class="lineno"> 7445</span>&#160;          ConstVec.push_back(Val);</div>
<div class="line"><a name="l07446"></a><span class="lineno"> 7446</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l07447"></a><span class="lineno"> 7447</span>&#160;          ConstVec.push_back(UndefVal);</div>
<div class="line"><a name="l07448"></a><span class="lineno"> 7448</span>&#160;      }</div>
<div class="line"><a name="l07449"></a><span class="lineno"> 7449</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantVector::get</a>(ConstVec);</div>
<div class="line"><a name="l07450"></a><span class="lineno"> 7450</span>&#160;    } <span class="keywordflow">else</span></div>
<div class="line"><a name="l07451"></a><span class="lineno"> 7451</span>&#160;      <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(</div>
<div class="line"><a name="l07452"></a><span class="lineno"> 7452</span>&#160;          <span class="stringliteral">&quot;Generate scalable vector for non-splat is unimplemented&quot;</span>);</div>
<div class="line"><a name="l07453"></a><span class="lineno"> 7453</span>&#160;  }</div>
<div class="line"><a name="l07454"></a><span class="lineno"> 7454</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07455"></a><span class="lineno"> 7455</span>&#160;<span class="comment">  /// Check if promoting to a vector type an operand at \p OperandIdx</span></div>
<div class="line"><a name="l07456"></a><span class="lineno"> 7456</span>&#160;<span class="comment">  /// in \p Use can trigger undefined behavior.</span></div>
<div class="line"><a name="l07457"></a><span class="lineno"> 7457</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> <span class="keywordtype">bool</span> canCauseUndefinedBehavior(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1Use.html">Use</a>,</div>
<div class="line"><a name="l07458"></a><span class="lineno"> 7458</span>&#160;                                        <span class="keywordtype">unsigned</span> OperandIdx) {</div>
<div class="line"><a name="l07459"></a><span class="lineno"> 7459</span>&#160;    <span class="comment">// This is not safe to introduce undef when the operand is on</span></div>
<div class="line"><a name="l07460"></a><span class="lineno"> 7460</span>&#160;    <span class="comment">// the right hand side of a division-like instruction.</span></div>
<div class="line"><a name="l07461"></a><span class="lineno"> 7461</span>&#160;    <span class="keywordflow">if</span> (OperandIdx != 1)</div>
<div class="line"><a name="l07462"></a><span class="lineno"> 7462</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07463"></a><span class="lineno"> 7463</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="classllvm_1_1Use.html">Use</a>-&gt;getOpcode()) {</div>
<div class="line"><a name="l07464"></a><span class="lineno"> 7464</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l07465"></a><span class="lineno"> 7465</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07466"></a><span class="lineno"> 7466</span>&#160;    <span class="keywordflow">case</span> Instruction::SDiv:</div>
<div class="line"><a name="l07467"></a><span class="lineno"> 7467</span>&#160;    <span class="keywordflow">case</span> Instruction::UDiv:</div>
<div class="line"><a name="l07468"></a><span class="lineno"> 7468</span>&#160;    <span class="keywordflow">case</span> Instruction::SRem:</div>
<div class="line"><a name="l07469"></a><span class="lineno"> 7469</span>&#160;    <span class="keywordflow">case</span> Instruction::URem:</div>
<div class="line"><a name="l07470"></a><span class="lineno"> 7470</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07471"></a><span class="lineno"> 7471</span>&#160;    <span class="keywordflow">case</span> Instruction::FDiv:</div>
<div class="line"><a name="l07472"></a><span class="lineno"> 7472</span>&#160;    <span class="keywordflow">case</span> Instruction::FRem:</div>
<div class="line"><a name="l07473"></a><span class="lineno"> 7473</span>&#160;      <span class="keywordflow">return</span> !<a class="code" href="classllvm_1_1Use.html">Use</a>-&gt;hasNoNaNs();</div>
<div class="line"><a name="l07474"></a><span class="lineno"> 7474</span>&#160;    }</div>
<div class="line"><a name="l07475"></a><span class="lineno"> 7475</span>&#160;    <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l07476"></a><span class="lineno"> 7476</span>&#160;  }</div>
<div class="line"><a name="l07477"></a><span class="lineno"> 7477</span>&#160; </div>
<div class="line"><a name="l07478"></a><span class="lineno"> 7478</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l07479"></a><span class="lineno"> 7479</span>&#160;  VectorPromoteHelper(<span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI,</div>
<div class="line"><a name="l07480"></a><span class="lineno"> 7480</span>&#160;                      <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Transition,</div>
<div class="line"><a name="l07481"></a><span class="lineno"> 7481</span>&#160;                      <span class="keywordtype">unsigned</span> CombineCost)</div>
<div class="line"><a name="l07482"></a><span class="lineno"> 7482</span>&#160;      : <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>), TLI(TLI), <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>), Transition(Transition),</div>
<div class="line"><a name="l07483"></a><span class="lineno"> 7483</span>&#160;        StoreExtractCombineCost(CombineCost) {</div>
<div class="line"><a name="l07484"></a><span class="lineno"> 7484</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Transition &amp;&amp; <span class="stringliteral">&quot;Do not know how to promote null&quot;</span>);</div>
<div class="line"><a name="l07485"></a><span class="lineno"> 7485</span>&#160;  }</div>
<div class="line"><a name="l07486"></a><span class="lineno"> 7486</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07487"></a><span class="lineno"> 7487</span>&#160;<span class="comment">  /// Check if we can promote \p ToBePromoted to \p Type.</span></div>
<div class="line"><a name="l07488"></a><span class="lineno"> 7488</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> canPromote(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ToBePromoted)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l07489"></a><span class="lineno"> 7489</span>&#160;    <span class="comment">// We could support CastInst too.</span></div>
<div class="line"><a name="l07490"></a><span class="lineno"> 7490</span>&#160;    <span class="keywordflow">return</span> isa&lt;BinaryOperator&gt;(ToBePromoted);</div>
<div class="line"><a name="l07491"></a><span class="lineno"> 7491</span>&#160;  }</div>
<div class="line"><a name="l07492"></a><span class="lineno"> 7492</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07493"></a><span class="lineno"> 7493</span>&#160;<span class="comment">  /// Check if it is profitable to promote \p ToBePromoted</span></div>
<div class="line"><a name="l07494"></a><span class="lineno"> 7494</span>&#160;<span class="comment">  /// by moving downward the transition through.</span></div>
<div class="line"><a name="l07495"></a><span class="lineno"> 7495</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> shouldPromote(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ToBePromoted)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l07496"></a><span class="lineno"> 7496</span>&#160;    <span class="comment">// Promote only if all the operands can be statically expanded.</span></div>
<div class="line"><a name="l07497"></a><span class="lineno"> 7497</span>&#160;    <span class="comment">// Indeed, we do not want to introduce any new kind of transitions.</span></div>
<div class="line"><a name="l07498"></a><span class="lineno"> 7498</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U : ToBePromoted-&gt;<a class="code" href="classllvm_1_1User.html#a0b931781aa589c6ebe64a76c1447e5b2">operands</a>()) {</div>
<div class="line"><a name="l07499"></a><span class="lineno"> 7499</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *Val = U.get();</div>
<div class="line"><a name="l07500"></a><span class="lineno"> 7500</span>&#160;      <span class="keywordflow">if</span> (Val == getEndOfTransition()) {</div>
<div class="line"><a name="l07501"></a><span class="lineno"> 7501</span>&#160;        <span class="comment">// If the use is a division and the transition is on the rhs,</span></div>
<div class="line"><a name="l07502"></a><span class="lineno"> 7502</span>&#160;        <span class="comment">// we cannot promote the operation, otherwise we may create a</span></div>
<div class="line"><a name="l07503"></a><span class="lineno"> 7503</span>&#160;        <span class="comment">// division by zero.</span></div>
<div class="line"><a name="l07504"></a><span class="lineno"> 7504</span>&#160;        <span class="keywordflow">if</span> (canCauseUndefinedBehavior(ToBePromoted, U.getOperandNo()))</div>
<div class="line"><a name="l07505"></a><span class="lineno"> 7505</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07506"></a><span class="lineno"> 7506</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l07507"></a><span class="lineno"> 7507</span>&#160;      }</div>
<div class="line"><a name="l07508"></a><span class="lineno"> 7508</span>&#160;      <span class="keywordflow">if</span> (!isa&lt;ConstantInt&gt;(Val) &amp;&amp; !isa&lt;UndefValue&gt;(Val) &amp;&amp;</div>
<div class="line"><a name="l07509"></a><span class="lineno"> 7509</span>&#160;          !isa&lt;ConstantFP&gt;(Val))</div>
<div class="line"><a name="l07510"></a><span class="lineno"> 7510</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07511"></a><span class="lineno"> 7511</span>&#160;    }</div>
<div class="line"><a name="l07512"></a><span class="lineno"> 7512</span>&#160;    <span class="comment">// Check that the resulting operation is legal.</span></div>
<div class="line"><a name="l07513"></a><span class="lineno"> 7513</span>&#160;    <span class="keywordtype">int</span> ISDOpcode = TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#a025e6664b2f55d2c217543c34eb1f64e">InstructionOpcodeToISD</a>(ToBePromoted-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>());</div>
<div class="line"><a name="l07514"></a><span class="lineno"> 7514</span>&#160;    <span class="keywordflow">if</span> (!ISDOpcode)</div>
<div class="line"><a name="l07515"></a><span class="lineno"> 7515</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07516"></a><span class="lineno"> 7516</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="CodeGenPrepare_8cpp.html#ad5b8edf88f1987d45851832bd84b53eb">StressStoreExtract</a> ||</div>
<div class="line"><a name="l07517"></a><span class="lineno"> 7517</span>&#160;           TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#aa93fbbc66d52a51d178af8ac4398ec05">isOperationLegalOrCustom</a>(</div>
<div class="line"><a name="l07518"></a><span class="lineno"> 7518</span>&#160;               ISDOpcode, TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, getTransitionType(), <span class="keyword">true</span>));</div>
<div class="line"><a name="l07519"></a><span class="lineno"> 7519</span>&#160;  }</div>
<div class="line"><a name="l07520"></a><span class="lineno"> 7520</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07521"></a><span class="lineno"> 7521</span>&#160;<span class="comment">  /// Check whether or not \p Use can be combined</span></div>
<div class="line"><a name="l07522"></a><span class="lineno"> 7522</span>&#160;<span class="comment">  /// with the transition.</span></div>
<div class="line"><a name="l07523"></a><span class="lineno"> 7523</span>&#160;<span class="comment">  /// I.e., is it possible to do Use(Transition) =&gt; AnotherUse?</span></div>
<div class="line"><a name="l07524"></a><span class="lineno"> 7524</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="AArch64InstrInfo_8cpp.html#a8a77823ca1d474b22f9b923674749a14">canCombine</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1Use.html">Use</a>) { <span class="keywordflow">return</span> isa&lt;StoreInst&gt;(<a class="code" href="classllvm_1_1Use.html">Use</a>); }</div>
<div class="line"><a name="l07525"></a><span class="lineno"> 7525</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07526"></a><span class="lineno"> 7526</span>&#160;<span class="comment">  /// Record \p ToBePromoted as part of the chain to be promoted.</span></div>
<div class="line"><a name="l07527"></a><span class="lineno"> 7527</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> enqueueForPromotion(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ToBePromoted) {</div>
<div class="line"><a name="l07528"></a><span class="lineno"> 7528</span>&#160;    InstsToBePromoted.push_back(ToBePromoted);</div>
<div class="line"><a name="l07529"></a><span class="lineno"> 7529</span>&#160;  }</div>
<div class="line"><a name="l07530"></a><span class="lineno"> 7530</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07531"></a><span class="lineno"> 7531</span>&#160;<span class="comment">  /// Set the instruction that will be combined with the transition.</span></div>
<div class="line"><a name="l07532"></a><span class="lineno"> 7532</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> recordCombineInstruction(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ToBeCombined) {</div>
<div class="line"><a name="l07533"></a><span class="lineno"> 7533</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="AArch64InstrInfo_8cpp.html#a8a77823ca1d474b22f9b923674749a14">canCombine</a>(ToBeCombined) &amp;&amp; <span class="stringliteral">&quot;Unsupported instruction to combine&quot;</span>);</div>
<div class="line"><a name="l07534"></a><span class="lineno"> 7534</span>&#160;    CombineInst = ToBeCombined;</div>
<div class="line"><a name="l07535"></a><span class="lineno"> 7535</span>&#160;  }</div>
<div class="line"><a name="l07536"></a><span class="lineno"> 7536</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07537"></a><span class="lineno"> 7537</span>&#160;<span class="comment">  /// Promote all the instructions enqueued for promotion if it is</span></div>
<div class="line"><a name="l07538"></a><span class="lineno"> 7538</span>&#160;<span class="comment">  /// is profitable.</span></div>
<div class="line"><a name="l07539"></a><span class="lineno"> 7539</span>&#160;<span class="comment">  /// \return True if the promotion happened, false otherwise.</span></div>
<div class="line"><a name="l07540"></a><span class="lineno"> 7540</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> promote() {</div>
<div class="line"><a name="l07541"></a><span class="lineno"> 7541</span>&#160;    <span class="comment">// Check if there is something to promote.</span></div>
<div class="line"><a name="l07542"></a><span class="lineno"> 7542</span>&#160;    <span class="comment">// Right now, if we do not have anything to combine with,</span></div>
<div class="line"><a name="l07543"></a><span class="lineno"> 7543</span>&#160;    <span class="comment">// we assume the promotion is not profitable.</span></div>
<div class="line"><a name="l07544"></a><span class="lineno"> 7544</span>&#160;    <span class="keywordflow">if</span> (InstsToBePromoted.empty() || !CombineInst)</div>
<div class="line"><a name="l07545"></a><span class="lineno"> 7545</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07546"></a><span class="lineno"> 7546</span>&#160; </div>
<div class="line"><a name="l07547"></a><span class="lineno"> 7547</span>&#160;    <span class="comment">// Check cost.</span></div>
<div class="line"><a name="l07548"></a><span class="lineno"> 7548</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="CodeGenPrepare_8cpp.html#ad5b8edf88f1987d45851832bd84b53eb">StressStoreExtract</a> &amp;&amp; !isProfitableToPromote())</div>
<div class="line"><a name="l07549"></a><span class="lineno"> 7549</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07550"></a><span class="lineno"> 7550</span>&#160; </div>
<div class="line"><a name="l07551"></a><span class="lineno"> 7551</span>&#160;    <span class="comment">// Promote.</span></div>
<div class="line"><a name="l07552"></a><span class="lineno"> 7552</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;ToBePromoted : InstsToBePromoted)</div>
<div class="line"><a name="l07553"></a><span class="lineno"> 7553</span>&#160;      promoteImpl(ToBePromoted);</div>
<div class="line"><a name="l07554"></a><span class="lineno"> 7554</span>&#160;    InstsToBePromoted.clear();</div>
<div class="line"><a name="l07555"></a><span class="lineno"> 7555</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07556"></a><span class="lineno"> 7556</span>&#160;  }</div>
<div class="line"><a name="l07557"></a><span class="lineno"> 7557</span>&#160;};</div>
<div class="line"><a name="l07558"></a><span class="lineno"> 7558</span>&#160; </div>
<div class="line"><a name="l07559"></a><span class="lineno"> 7559</span>&#160;} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a name="l07560"></a><span class="lineno"> 7560</span>&#160; </div>
<div class="line"><a name="l07561"></a><span class="lineno"> 7561</span>&#160;<span class="keywordtype">void</span> VectorPromoteHelper::promoteImpl(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ToBePromoted) {</div>
<div class="line"><a name="l07562"></a><span class="lineno"> 7562</span>&#160;  <span class="comment">// At this point, we know that all the operands of ToBePromoted but Def</span></div>
<div class="line"><a name="l07563"></a><span class="lineno"> 7563</span>&#160;  <span class="comment">// can be statically promoted.</span></div>
<div class="line"><a name="l07564"></a><span class="lineno"> 7564</span>&#160;  <span class="comment">// For Def, we need to use its parameter in ToBePromoted:</span></div>
<div class="line"><a name="l07565"></a><span class="lineno"> 7565</span>&#160;  <span class="comment">// b = ToBePromoted ty1 a</span></div>
<div class="line"><a name="l07566"></a><span class="lineno"> 7566</span>&#160;  <span class="comment">// Def = Transition ty1 b to ty2</span></div>
<div class="line"><a name="l07567"></a><span class="lineno"> 7567</span>&#160;  <span class="comment">// Move the transition down.</span></div>
<div class="line"><a name="l07568"></a><span class="lineno"> 7568</span>&#160;  <span class="comment">// 1. Replace all uses of the promoted operation by the transition.</span></div>
<div class="line"><a name="l07569"></a><span class="lineno"> 7569</span>&#160;  <span class="comment">// = ... b =&gt; = ... Def.</span></div>
<div class="line"><a name="l07570"></a><span class="lineno"> 7570</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ToBePromoted-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() == Transition-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() &amp;&amp;</div>
<div class="line"><a name="l07571"></a><span class="lineno"> 7571</span>&#160;         <span class="stringliteral">&quot;The type of the result of the transition does not match &quot;</span></div>
<div class="line"><a name="l07572"></a><span class="lineno"> 7572</span>&#160;         <span class="stringliteral">&quot;the final type&quot;</span>);</div>
<div class="line"><a name="l07573"></a><span class="lineno"> 7573</span>&#160;  ToBePromoted-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Transition);</div>
<div class="line"><a name="l07574"></a><span class="lineno"> 7574</span>&#160;  <span class="comment">// 2. Update the type of the uses.</span></div>
<div class="line"><a name="l07575"></a><span class="lineno"> 7575</span>&#160;  <span class="comment">// b = ToBePromoted ty2 Def =&gt; b = ToBePromoted ty1 Def.</span></div>
<div class="line"><a name="l07576"></a><span class="lineno"> 7576</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *TransitionTy = getTransitionType();</div>
<div class="line"><a name="l07577"></a><span class="lineno"> 7577</span>&#160;  ToBePromoted-&gt;<a class="code" href="classllvm_1_1Value.html#ac0f09c2c9951158f9eecfaf7068d7b20">mutateType</a>(TransitionTy);</div>
<div class="line"><a name="l07578"></a><span class="lineno"> 7578</span>&#160;  <span class="comment">// 3. Update all the operands of the promoted operation with promoted</span></div>
<div class="line"><a name="l07579"></a><span class="lineno"> 7579</span>&#160;  <span class="comment">// operands.</span></div>
<div class="line"><a name="l07580"></a><span class="lineno"> 7580</span>&#160;  <span class="comment">// b = ToBePromoted ty1 Def =&gt; b = ToBePromoted ty1 a.</span></div>
<div class="line"><a name="l07581"></a><span class="lineno"> 7581</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U : ToBePromoted-&gt;<a class="code" href="classllvm_1_1User.html#a0b931781aa589c6ebe64a76c1447e5b2">operands</a>()) {</div>
<div class="line"><a name="l07582"></a><span class="lineno"> 7582</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Val = U.get();</div>
<div class="line"><a name="l07583"></a><span class="lineno"> 7583</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *NewVal = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l07584"></a><span class="lineno"> 7584</span>&#160;    <span class="keywordflow">if</span> (Val == Transition)</div>
<div class="line"><a name="l07585"></a><span class="lineno"> 7585</span>&#160;      NewVal = Transition-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(getTransitionOriginalValueIdx());</div>
<div class="line"><a name="l07586"></a><span class="lineno"> 7586</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;UndefValue&gt;(Val) || isa&lt;ConstantInt&gt;(Val) ||</div>
<div class="line"><a name="l07587"></a><span class="lineno"> 7587</span>&#160;             isa&lt;ConstantFP&gt;(Val)) {</div>
<div class="line"><a name="l07588"></a><span class="lineno"> 7588</span>&#160;      <span class="comment">// Use a splat constant if it is not safe to use undef.</span></div>
<div class="line"><a name="l07589"></a><span class="lineno"> 7589</span>&#160;      NewVal = <a class="code" href="X86ISelLowering_8cpp.html#aa1cc6f0bf5007ecac3fbaccc032a4317">getConstantVector</a>(</div>
<div class="line"><a name="l07590"></a><span class="lineno"> 7590</span>&#160;          cast&lt;Constant&gt;(Val),</div>
<div class="line"><a name="l07591"></a><span class="lineno"> 7591</span>&#160;          isa&lt;UndefValue&gt;(Val) ||</div>
<div class="line"><a name="l07592"></a><span class="lineno"> 7592</span>&#160;              canCauseUndefinedBehavior(ToBePromoted, U.getOperandNo()));</div>
<div class="line"><a name="l07593"></a><span class="lineno"> 7593</span>&#160;    } <span class="keywordflow">else</span></div>
<div class="line"><a name="l07594"></a><span class="lineno"> 7594</span>&#160;      <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Did you modified shouldPromote and forgot to update &quot;</span></div>
<div class="line"><a name="l07595"></a><span class="lineno"> 7595</span>&#160;                       <span class="stringliteral">&quot;this?&quot;</span>);</div>
<div class="line"><a name="l07596"></a><span class="lineno"> 7596</span>&#160;    ToBePromoted-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(U.getOperandNo(), NewVal);</div>
<div class="line"><a name="l07597"></a><span class="lineno"> 7597</span>&#160;  }</div>
<div class="line"><a name="l07598"></a><span class="lineno"> 7598</span>&#160;  Transition-&gt;<a class="code" href="classllvm_1_1Instruction.html#a54507f01d7d06127068ee0663233511d">moveAfter</a>(ToBePromoted);</div>
<div class="line"><a name="l07599"></a><span class="lineno"> 7599</span>&#160;  Transition-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(getTransitionOriginalValueIdx(), ToBePromoted);</div>
<div class="line"><a name="l07600"></a><span class="lineno"> 7600</span>&#160;}</div>
<div class="line"><a name="l07601"></a><span class="lineno"> 7601</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07602"></a><span class="lineno"> 7602</span>&#160;<span class="comment">/// Some targets can do store(extractelement) with one instruction.</span></div>
<div class="line"><a name="l07603"></a><span class="lineno"> 7603</span>&#160;<span class="comment">/// Try to push the extractelement towards the stores when the target</span></div>
<div class="line"><a name="l07604"></a><span class="lineno"> 7604</span>&#160;<span class="comment">/// has this feature and this is profitable.</span></div>
<div class="line"><a name="l07605"></a><span class="lineno"> 7605</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CodeGenPrepare::optimizeExtractElementInst(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst) {</div>
<div class="line"><a name="l07606"></a><span class="lineno"> 7606</span>&#160;  <span class="keywordtype">unsigned</span> CombineCost = <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::numeric_limits&lt;unsigned&gt;::max</a>();</div>
<div class="line"><a name="l07607"></a><span class="lineno"> 7607</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="CodeGenPrepare_8cpp.html#adf834c332066239424a2f713b2fd4a7f">DisableStoreExtract</a> ||</div>
<div class="line"><a name="l07608"></a><span class="lineno"> 7608</span>&#160;      (!<a class="code" href="CodeGenPrepare_8cpp.html#ad5b8edf88f1987d45851832bd84b53eb">StressStoreExtract</a> &amp;&amp;</div>
<div class="line"><a name="l07609"></a><span class="lineno"> 7609</span>&#160;       !TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a80725805c0e5e9fe87b7d6f3e147c1c1">canCombineStoreAndExtract</a>(Inst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(),</div>
<div class="line"><a name="l07610"></a><span class="lineno"> 7610</span>&#160;                                       Inst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1), CombineCost)))</div>
<div class="line"><a name="l07611"></a><span class="lineno"> 7611</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07612"></a><span class="lineno"> 7612</span>&#160; </div>
<div class="line"><a name="l07613"></a><span class="lineno"> 7613</span>&#160;  <span class="comment">// At this point we know that Inst is a vector to scalar transition.</span></div>
<div class="line"><a name="l07614"></a><span class="lineno"> 7614</span>&#160;  <span class="comment">// Try to move it down the def-use chain, until:</span></div>
<div class="line"><a name="l07615"></a><span class="lineno"> 7615</span>&#160;  <span class="comment">// - We can combine the transition with its single use</span></div>
<div class="line"><a name="l07616"></a><span class="lineno"> 7616</span>&#160;  <span class="comment">//   =&gt; we got rid of the transition.</span></div>
<div class="line"><a name="l07617"></a><span class="lineno"> 7617</span>&#160;  <span class="comment">// - We escape the current basic block</span></div>
<div class="line"><a name="l07618"></a><span class="lineno"> 7618</span>&#160;  <span class="comment">//   =&gt; we would need to check that we are moving it at a cheaper place and</span></div>
<div class="line"><a name="l07619"></a><span class="lineno"> 7619</span>&#160;  <span class="comment">//      we do not do that for now.</span></div>
<div class="line"><a name="l07620"></a><span class="lineno"> 7620</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Parent = Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l07621"></a><span class="lineno"> 7621</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Found an interesting transition: &quot;</span> &lt;&lt; *Inst &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l07622"></a><span class="lineno"> 7622</span>&#160;  VectorPromoteHelper VPH(*<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, *TLI, *<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, Inst, CombineCost);</div>
<div class="line"><a name="l07623"></a><span class="lineno"> 7623</span>&#160;  <span class="comment">// If the transition has more than one use, assume this is not going to be</span></div>
<div class="line"><a name="l07624"></a><span class="lineno"> 7624</span>&#160;  <span class="comment">// beneficial.</span></div>
<div class="line"><a name="l07625"></a><span class="lineno"> 7625</span>&#160;  <span class="keywordflow">while</span> (Inst-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>()) {</div>
<div class="line"><a name="l07626"></a><span class="lineno"> 7626</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ToBePromoted = cast&lt;Instruction&gt;(*Inst-&gt;<a class="code" href="classllvm_1_1Value.html#a158da2b6d3d938aaa15b6acd00150e2c">user_begin</a>());</div>
<div class="line"><a name="l07627"></a><span class="lineno"> 7627</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Use: &quot;</span> &lt;&lt; *ToBePromoted &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l07628"></a><span class="lineno"> 7628</span>&#160; </div>
<div class="line"><a name="l07629"></a><span class="lineno"> 7629</span>&#160;    <span class="keywordflow">if</span> (ToBePromoted-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() != Parent) {</div>
<div class="line"><a name="l07630"></a><span class="lineno"> 7630</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Instruction to promote is in a different block (&quot;</span></div>
<div class="line"><a name="l07631"></a><span class="lineno"> 7631</span>&#160;                        &lt;&lt; ToBePromoted-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</div>
<div class="line"><a name="l07632"></a><span class="lineno"> 7632</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;) than the transition (&quot;</span> &lt;&lt; Parent-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</div>
<div class="line"><a name="l07633"></a><span class="lineno"> 7633</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;).\n&quot;</span>);</div>
<div class="line"><a name="l07634"></a><span class="lineno"> 7634</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07635"></a><span class="lineno"> 7635</span>&#160;    }</div>
<div class="line"><a name="l07636"></a><span class="lineno"> 7636</span>&#160; </div>
<div class="line"><a name="l07637"></a><span class="lineno"> 7637</span>&#160;    <span class="keywordflow">if</span> (VPH.canCombine(ToBePromoted)) {</div>
<div class="line"><a name="l07638"></a><span class="lineno"> 7638</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Assume &quot;</span> &lt;&lt; *Inst &lt;&lt; <span class="charliteral">&#39;\n&#39;</span></div>
<div class="line"><a name="l07639"></a><span class="lineno"> 7639</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;will be combined with: &quot;</span> &lt;&lt; *ToBePromoted &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l07640"></a><span class="lineno"> 7640</span>&#160;      VPH.recordCombineInstruction(ToBePromoted);</div>
<div class="line"><a name="l07641"></a><span class="lineno"> 7641</span>&#160;      <span class="keywordtype">bool</span> Changed = VPH.promote();</div>
<div class="line"><a name="l07642"></a><span class="lineno"> 7642</span>&#160;      NumStoreExtractExposed += Changed;</div>
<div class="line"><a name="l07643"></a><span class="lineno"> 7643</span>&#160;      <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l07644"></a><span class="lineno"> 7644</span>&#160;    }</div>
<div class="line"><a name="l07645"></a><span class="lineno"> 7645</span>&#160; </div>
<div class="line"><a name="l07646"></a><span class="lineno"> 7646</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Try promoting.\n&quot;</span>);</div>
<div class="line"><a name="l07647"></a><span class="lineno"> 7647</span>&#160;    <span class="keywordflow">if</span> (!VPH.canPromote(ToBePromoted) || !VPH.shouldPromote(ToBePromoted))</div>
<div class="line"><a name="l07648"></a><span class="lineno"> 7648</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07649"></a><span class="lineno"> 7649</span>&#160; </div>
<div class="line"><a name="l07650"></a><span class="lineno"> 7650</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Promoting is possible... Enqueue for promotion!\n&quot;</span>);</div>
<div class="line"><a name="l07651"></a><span class="lineno"> 7651</span>&#160; </div>
<div class="line"><a name="l07652"></a><span class="lineno"> 7652</span>&#160;    VPH.enqueueForPromotion(ToBePromoted);</div>
<div class="line"><a name="l07653"></a><span class="lineno"> 7653</span>&#160;    Inst = ToBePromoted;</div>
<div class="line"><a name="l07654"></a><span class="lineno"> 7654</span>&#160;  }</div>
<div class="line"><a name="l07655"></a><span class="lineno"> 7655</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07656"></a><span class="lineno"> 7656</span>&#160;}</div>
<div class="line"><a name="l07657"></a><span class="lineno"> 7657</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07658"></a><span class="lineno"> 7658</span>&#160;<span class="comment">/// For the instruction sequence of store below, F and I values</span></div>
<div class="line"><a name="l07659"></a><span class="lineno"> 7659</span>&#160;<span class="comment">/// are bundled together as an i64 value before being stored into memory.</span></div>
<div class="line"><a name="l07660"></a><span class="lineno"> 7660</span>&#160;<span class="comment">/// Sometimes it is more efficient to generate separate stores for F and I,</span></div>
<div class="line"><a name="l07661"></a><span class="lineno"> 7661</span>&#160;<span class="comment">/// which can remove the bitwise instructions or sink them to colder places.</span></div>
<div class="line"><a name="l07662"></a><span class="lineno"> 7662</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l07663"></a><span class="lineno"> 7663</span>&#160;<span class="comment">///   (store (or (zext (bitcast F to i32) to i64),</span></div>
<div class="line"><a name="l07664"></a><span class="lineno"> 7664</span>&#160;<span class="comment">///              (shl (zext I to i64), 32)), addr)  --&gt;</span></div>
<div class="line"><a name="l07665"></a><span class="lineno"> 7665</span>&#160;<span class="comment">///   (store F, addr) and (store I, addr+4)</span></div>
<div class="line"><a name="l07666"></a><span class="lineno"> 7666</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l07667"></a><span class="lineno"> 7667</span>&#160;<span class="comment">/// Similarly, splitting for other merged store can also be beneficial, like:</span></div>
<div class="line"><a name="l07668"></a><span class="lineno"> 7668</span>&#160;<span class="comment">/// For pair of {i32, i32}, i64 store --&gt; two i32 stores.</span></div>
<div class="line"><a name="l07669"></a><span class="lineno"> 7669</span>&#160;<span class="comment">/// For pair of {i32, i16}, i64 store --&gt; two i32 stores.</span></div>
<div class="line"><a name="l07670"></a><span class="lineno"> 7670</span>&#160;<span class="comment">/// For pair of {i16, i16}, i32 store --&gt; two i16 stores.</span></div>
<div class="line"><a name="l07671"></a><span class="lineno"> 7671</span>&#160;<span class="comment">/// For pair of {i16, i8},  i32 store --&gt; two i16 stores.</span></div>
<div class="line"><a name="l07672"></a><span class="lineno"> 7672</span>&#160;<span class="comment">/// For pair of {i8, i8},   i16 store --&gt; two i8 stores.</span></div>
<div class="line"><a name="l07673"></a><span class="lineno"> 7673</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l07674"></a><span class="lineno"> 7674</span>&#160;<span class="comment">/// We allow each target to determine specifically which kind of splitting is</span></div>
<div class="line"><a name="l07675"></a><span class="lineno"> 7675</span>&#160;<span class="comment">/// supported.</span></div>
<div class="line"><a name="l07676"></a><span class="lineno"> 7676</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l07677"></a><span class="lineno"> 7677</span>&#160;<span class="comment">/// The store patterns are commonly seen from the simple code snippet below</span></div>
<div class="line"><a name="l07678"></a><span class="lineno"> 7678</span>&#160;<span class="comment">/// if only std::make_pair(...) is sroa transformed before inlined into hoo.</span></div>
<div class="line"><a name="l07679"></a><span class="lineno"> 7679</span>&#160;<span class="comment">///   void goo(const std::pair&lt;int, float&gt; &amp;);</span></div>
<div class="line"><a name="l07680"></a><span class="lineno"> 7680</span>&#160;<span class="comment">///   hoo() {</span></div>
<div class="line"><a name="l07681"></a><span class="lineno"> 7681</span>&#160;<span class="comment">///     ...</span></div>
<div class="line"><a name="l07682"></a><span class="lineno"> 7682</span>&#160;<span class="comment">///     goo(std::make_pair(tmp, ftmp));</span></div>
<div class="line"><a name="l07683"></a><span class="lineno"> 7683</span>&#160;<span class="comment">///     ...</span></div>
<div class="line"><a name="l07684"></a><span class="lineno"> 7684</span>&#160;<span class="comment">///   }</span></div>
<div class="line"><a name="l07685"></a><span class="lineno"> 7685</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l07686"></a><span class="lineno"> 7686</span>&#160;<span class="comment">/// Although we already have similar splitting in DAG Combine, we duplicate</span></div>
<div class="line"><a name="l07687"></a><span class="lineno"> 7687</span>&#160;<span class="comment">/// it in CodeGenPrepare to catch the case in which pattern is across</span></div>
<div class="line"><a name="l07688"></a><span class="lineno"> 7688</span>&#160;<span class="comment">/// multiple BBs. The logic in DAG Combine is kept to catch case generated</span></div>
<div class="line"><a name="l07689"></a><span class="lineno"> 7689</span>&#160;<span class="comment">/// during code expansion.</span></div>
<div class="line"><a name="l07690"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#a3c7e1486d1d466b3be981adcb21a6359"> 7690</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CodeGenPrepare_8cpp.html#a3c7e1486d1d466b3be981adcb21a6359">splitMergedValStore</a>(<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> &amp;<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</div>
<div class="line"><a name="l07691"></a><span class="lineno"> 7691</span>&#160;                                <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI) {</div>
<div class="line"><a name="l07692"></a><span class="lineno"> 7692</span>&#160;  <span class="comment">// Handle simple but common cases only.</span></div>
<div class="line"><a name="l07693"></a><span class="lineno"> 7693</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *StoreType = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>.getValueOperand()-&gt;getType();</div>
<div class="line"><a name="l07694"></a><span class="lineno"> 7694</span>&#160; </div>
<div class="line"><a name="l07695"></a><span class="lineno"> 7695</span>&#160;  <span class="comment">// The code below assumes shifting a value by &lt;number of bits&gt;,</span></div>
<div class="line"><a name="l07696"></a><span class="lineno"> 7696</span>&#160;  <span class="comment">// whereas scalable vectors would have to be shifted by</span></div>
<div class="line"><a name="l07697"></a><span class="lineno"> 7697</span>&#160;  <span class="comment">// &lt;2log(vscale) + number of bits&gt; in order to store the</span></div>
<div class="line"><a name="l07698"></a><span class="lineno"> 7698</span>&#160;  <span class="comment">// low/high parts. Bailing out for now.</span></div>
<div class="line"><a name="l07699"></a><span class="lineno"> 7699</span>&#160;  <span class="keywordflow">if</span> (isa&lt;ScalableVectorType&gt;(StoreType))</div>
<div class="line"><a name="l07700"></a><span class="lineno"> 7700</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07701"></a><span class="lineno"> 7701</span>&#160; </div>
<div class="line"><a name="l07702"></a><span class="lineno"> 7702</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.typeSizeEqualsStoreSize(StoreType) ||</div>
<div class="line"><a name="l07703"></a><span class="lineno"> 7703</span>&#160;      <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(StoreType) == 0)</div>
<div class="line"><a name="l07704"></a><span class="lineno"> 7704</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07705"></a><span class="lineno"> 7705</span>&#160; </div>
<div class="line"><a name="l07706"></a><span class="lineno"> 7706</span>&#160;  <span class="keywordtype">unsigned</span> HalfValBitSize = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(StoreType) / 2;</div>
<div class="line"><a name="l07707"></a><span class="lineno"> 7707</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *SplitStoreType = Type::getIntNTy(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>.getContext(), HalfValBitSize);</div>
<div class="line"><a name="l07708"></a><span class="lineno"> 7708</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.typeSizeEqualsStoreSize(SplitStoreType))</div>
<div class="line"><a name="l07709"></a><span class="lineno"> 7709</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07710"></a><span class="lineno"> 7710</span>&#160; </div>
<div class="line"><a name="l07711"></a><span class="lineno"> 7711</span>&#160;  <span class="comment">// Don&#39;t split the store if it is volatile.</span></div>
<div class="line"><a name="l07712"></a><span class="lineno"> 7712</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>.isVolatile())</div>
<div class="line"><a name="l07713"></a><span class="lineno"> 7713</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07714"></a><span class="lineno"> 7714</span>&#160; </div>
<div class="line"><a name="l07715"></a><span class="lineno"> 7715</span>&#160;  <span class="comment">// Match the following patterns:</span></div>
<div class="line"><a name="l07716"></a><span class="lineno"> 7716</span>&#160;  <span class="comment">// (store (or (zext LValue to i64),</span></div>
<div class="line"><a name="l07717"></a><span class="lineno"> 7717</span>&#160;  <span class="comment">//            (shl (zext HValue to i64), 32)), HalfValBitSize)</span></div>
<div class="line"><a name="l07718"></a><span class="lineno"> 7718</span>&#160;  <span class="comment">//  or</span></div>
<div class="line"><a name="l07719"></a><span class="lineno"> 7719</span>&#160;  <span class="comment">// (store (or (shl (zext HValue to i64), 32)), HalfValBitSize)</span></div>
<div class="line"><a name="l07720"></a><span class="lineno"> 7720</span>&#160;  <span class="comment">//            (zext LValue to i64),</span></div>
<div class="line"><a name="l07721"></a><span class="lineno"> 7721</span>&#160;  <span class="comment">// Expect both operands of OR and the first operand of SHL have only</span></div>
<div class="line"><a name="l07722"></a><span class="lineno"> 7722</span>&#160;  <span class="comment">// one use.</span></div>
<div class="line"><a name="l07723"></a><span class="lineno"> 7723</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ItaniumDemangle_8h.html#ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c">LValue</a>, *HValue;</div>
<div class="line"><a name="l07724"></a><span class="lineno"> 7724</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>.getValueOperand(),</div>
<div class="line"><a name="l07725"></a><span class="lineno"> 7725</span>&#160;             <a class="code" href="namespacellvm_1_1PatternMatch.html#a7af604b3a6b3a44113d4c54c5c04d031">m_c_Or</a>(<a class="code" href="namespacellvm_1_1MIPatternMatch.html#adaaea0309983a4c327ced82a739cf1c4">m_OneUse</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a2cbdca7c8267aac6914d674f8e81841b">m_ZExt</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ItaniumDemangle_8h.html#ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c">LValue</a>))),</div>
<div class="line"><a name="l07726"></a><span class="lineno"> 7726</span>&#160;                    <a class="code" href="namespacellvm_1_1MIPatternMatch.html#adaaea0309983a4c327ced82a739cf1c4">m_OneUse</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a37668d9884c78ac77254cf9fb8a4276a">m_Shl</a>(<a class="code" href="namespacellvm_1_1MIPatternMatch.html#adaaea0309983a4c327ced82a739cf1c4">m_OneUse</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a2cbdca7c8267aac6914d674f8e81841b">m_ZExt</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(HValue))),</div>
<div class="line"><a name="l07727"></a><span class="lineno"> 7727</span>&#160;                                   <a class="code" href="namespacellvm_1_1PatternMatch.html#a3acbd0be97863e3e03e3b85641254018">m_SpecificInt</a>(HalfValBitSize))))))</div>
<div class="line"><a name="l07728"></a><span class="lineno"> 7728</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07729"></a><span class="lineno"> 7729</span>&#160; </div>
<div class="line"><a name="l07730"></a><span class="lineno"> 7730</span>&#160;  <span class="comment">// Check LValue and HValue are int with size less or equal than 32.</span></div>
<div class="line"><a name="l07731"></a><span class="lineno"> 7731</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="ItaniumDemangle_8h.html#ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c">LValue</a>-&gt;getType()-&gt;isIntegerTy() ||</div>
<div class="line"><a name="l07732"></a><span class="lineno"> 7732</span>&#160;      <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(<a class="code" href="ItaniumDemangle_8h.html#ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c">LValue</a>-&gt;getType()) &gt; HalfValBitSize ||</div>
<div class="line"><a name="l07733"></a><span class="lineno"> 7733</span>&#160;      !HValue-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() ||</div>
<div class="line"><a name="l07734"></a><span class="lineno"> 7734</span>&#160;      <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(HValue-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()) &gt; HalfValBitSize)</div>
<div class="line"><a name="l07735"></a><span class="lineno"> 7735</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07736"></a><span class="lineno"> 7736</span>&#160; </div>
<div class="line"><a name="l07737"></a><span class="lineno"> 7737</span>&#160;  <span class="comment">// If LValue/HValue is a bitcast instruction, use the EVT before bitcast</span></div>
<div class="line"><a name="l07738"></a><span class="lineno"> 7738</span>&#160;  <span class="comment">// as the input of target query.</span></div>
<div class="line"><a name="l07739"></a><span class="lineno"> 7739</span>&#160;  <span class="keyword">auto</span> *LBC = dyn_cast&lt;BitCastInst&gt;(<a class="code" href="ItaniumDemangle_8h.html#ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c">LValue</a>);</div>
<div class="line"><a name="l07740"></a><span class="lineno"> 7740</span>&#160;  <span class="keyword">auto</span> *HBC = dyn_cast&lt;BitCastInst&gt;(HValue);</div>
<div class="line"><a name="l07741"></a><span class="lineno"> 7741</span>&#160;  <a class="code" href="structllvm_1_1EVT.html">EVT</a> LowTy = LBC ? EVT::getEVT(LBC-&gt;getOperand(0)-&gt;getType())</div>
<div class="line"><a name="l07742"></a><span class="lineno"> 7742</span>&#160;                  : EVT::getEVT(<a class="code" href="ItaniumDemangle_8h.html#ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c">LValue</a>-&gt;getType());</div>
<div class="line"><a name="l07743"></a><span class="lineno"> 7743</span>&#160;  <a class="code" href="structllvm_1_1EVT.html">EVT</a> HighTy = HBC ? EVT::getEVT(HBC-&gt;getOperand(0)-&gt;getType())</div>
<div class="line"><a name="l07744"></a><span class="lineno"> 7744</span>&#160;                   : EVT::getEVT(HValue-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l07745"></a><span class="lineno"> 7745</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="CodeGenPrepare_8cpp.html#a269866fa58b625676b6b8b53f8e55731">ForceSplitStore</a> &amp;&amp; !TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#ab068741575ed8c7f6bd4fe059edabd14">isMultiStoresCheaperThanBitsMerge</a>(LowTy, HighTy))</div>
<div class="line"><a name="l07746"></a><span class="lineno"> 7746</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07747"></a><span class="lineno"> 7747</span>&#160; </div>
<div class="line"><a name="l07748"></a><span class="lineno"> 7748</span>&#160;  <span class="comment">// Start to split store.</span></div>
<div class="line"><a name="l07749"></a><span class="lineno"> 7749</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>.getContext());</div>
<div class="line"><a name="l07750"></a><span class="lineno"> 7750</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(&amp;<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l07751"></a><span class="lineno"> 7751</span>&#160; </div>
<div class="line"><a name="l07752"></a><span class="lineno"> 7752</span>&#160;  <span class="comment">// If LValue/HValue is a bitcast in another BB, create a new one in current</span></div>
<div class="line"><a name="l07753"></a><span class="lineno"> 7753</span>&#160;  <span class="comment">// BB so it may be merged with the splitted stores by dag combiner.</span></div>
<div class="line"><a name="l07754"></a><span class="lineno"> 7754</span>&#160;  <span class="keywordflow">if</span> (LBC &amp;&amp; LBC-&gt;getParent() != <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>.getParent())</div>
<div class="line"><a name="l07755"></a><span class="lineno"> 7755</span>&#160;    <a class="code" href="ItaniumDemangle_8h.html#ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c">LValue</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(LBC-&gt;getOperand(0), LBC-&gt;getType());</div>
<div class="line"><a name="l07756"></a><span class="lineno"> 7756</span>&#160;  <span class="keywordflow">if</span> (HBC &amp;&amp; HBC-&gt;getParent() != <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>.getParent())</div>
<div class="line"><a name="l07757"></a><span class="lineno"> 7757</span>&#160;    HValue = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(HBC-&gt;getOperand(0), HBC-&gt;getType());</div>
<div class="line"><a name="l07758"></a><span class="lineno"> 7758</span>&#160; </div>
<div class="line"><a name="l07759"></a><span class="lineno"> 7759</span>&#160;  <span class="keywordtype">bool</span> IsLE = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>.getModule()-&gt;getDataLayout().isLittleEndian();</div>
<div class="line"><a name="l07760"></a><span class="lineno"> 7760</span>&#160;  <span class="keyword">auto</span> CreateSplitStore = [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#a6893db19648a2dba0912d181aaa57ec0a19de5b94f7b83900d4b296d9fa491aec">Upper</a>) {</div>
<div class="line"><a name="l07761"></a><span class="lineno"> 7761</span>&#160;    V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateZExtOrBitCast(V, SplitStoreType);</div>
<div class="line"><a name="l07762"></a><span class="lineno"> 7762</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(</div>
<div class="line"><a name="l07763"></a><span class="lineno"> 7763</span>&#160;        <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>.getOperand(1),</div>
<div class="line"><a name="l07764"></a><span class="lineno"> 7764</span>&#160;        SplitStoreType-&gt;<a class="code" href="classllvm_1_1Type.html#adc01a7457de85fc52a3bb860d7e1c6a4">getPointerTo</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>.getPointerAddressSpace()));</div>
<div class="line"><a name="l07765"></a><span class="lineno"> 7765</span>&#160;    <a class="code" href="structllvm_1_1Align.html">Align</a> Alignment = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>.getAlign();</div>
<div class="line"><a name="l07766"></a><span class="lineno"> 7766</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> IsOffsetStore = (IsLE &amp;&amp; <a class="code" href="namespacellvm.html#a6893db19648a2dba0912d181aaa57ec0a19de5b94f7b83900d4b296d9fa491aec">Upper</a>) || (!IsLE &amp;&amp; !<a class="code" href="namespacellvm.html#a6893db19648a2dba0912d181aaa57ec0a19de5b94f7b83900d4b296d9fa491aec">Upper</a>);</div>
<div class="line"><a name="l07767"></a><span class="lineno"> 7767</span>&#160;    <span class="keywordflow">if</span> (IsOffsetStore) {</div>
<div class="line"><a name="l07768"></a><span class="lineno"> 7768</span>&#160;      <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateGEP(</div>
<div class="line"><a name="l07769"></a><span class="lineno"> 7769</span>&#160;          SplitStoreType, <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>,</div>
<div class="line"><a name="l07770"></a><span class="lineno"> 7770</span>&#160;          <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantInt::get</a>(Type::getInt32Ty(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>.getContext()), 1));</div>
<div class="line"><a name="l07771"></a><span class="lineno"> 7771</span>&#160; </div>
<div class="line"><a name="l07772"></a><span class="lineno"> 7772</span>&#160;      <span class="comment">// When splitting the store in half, naturally one half will retain the</span></div>
<div class="line"><a name="l07773"></a><span class="lineno"> 7773</span>&#160;      <span class="comment">// alignment of the original wider store, regardless of whether it was</span></div>
<div class="line"><a name="l07774"></a><span class="lineno"> 7774</span>&#160;      <span class="comment">// over-aligned or not, while the other will require adjustment.</span></div>
<div class="line"><a name="l07775"></a><span class="lineno"> 7775</span>&#160;      Alignment = <a class="code" href="namespacellvm.html#acd6aa057934751aaac54e5c18bcc18eb">commonAlignment</a>(Alignment, HalfValBitSize / 8);</div>
<div class="line"><a name="l07776"></a><span class="lineno"> 7776</span>&#160;    }</div>
<div class="line"><a name="l07777"></a><span class="lineno"> 7777</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAlignedStore(V, <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, Alignment);</div>
<div class="line"><a name="l07778"></a><span class="lineno"> 7778</span>&#160;  };</div>
<div class="line"><a name="l07779"></a><span class="lineno"> 7779</span>&#160; </div>
<div class="line"><a name="l07780"></a><span class="lineno"> 7780</span>&#160;  CreateSplitStore(<a class="code" href="ItaniumDemangle_8h.html#ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c">LValue</a>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l07781"></a><span class="lineno"> 7781</span>&#160;  CreateSplitStore(HValue, <span class="keyword">true</span>);</div>
<div class="line"><a name="l07782"></a><span class="lineno"> 7782</span>&#160; </div>
<div class="line"><a name="l07783"></a><span class="lineno"> 7783</span>&#160;  <span class="comment">// Delete the old store.</span></div>
<div class="line"><a name="l07784"></a><span class="lineno"> 7784</span>&#160;  <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>.eraseFromParent();</div>
<div class="line"><a name="l07785"></a><span class="lineno"> 7785</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07786"></a><span class="lineno"> 7786</span>&#160;}</div>
<div class="line"><a name="l07787"></a><span class="lineno"> 7787</span>&#160; </div>
<div class="line"><a name="l07788"></a><span class="lineno"> 7788</span>&#160;<span class="comment">// Return true if the GEP has two operands, the first operand is of a sequential</span></div>
<div class="line"><a name="l07789"></a><span class="lineno"> 7789</span>&#160;<span class="comment">// type, and the second operand is a constant.</span></div>
<div class="line"><a name="l07790"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#ac3e586008202db1f802e906a489d7574"> 7790</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CodeGenPrepare_8cpp.html#ac3e586008202db1f802e906a489d7574">GEPSequentialConstIndexed</a>(<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>) {</div>
<div class="line"><a name="l07791"></a><span class="lineno"> 7791</span>&#160;  <a class="code" href="classllvm_1_1generic__gep__type__iterator.html">gep_type_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="namespacellvm.html#ac828b9b52935f87659a4adf237f820a3">gep_type_begin</a>(*<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>);</div>
<div class="line"><a name="l07792"></a><span class="lineno"> 7792</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getNumOperands() == 2 &amp;&amp; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isSequential() &amp;&amp;</div>
<div class="line"><a name="l07793"></a><span class="lineno"> 7793</span>&#160;         isa&lt;ConstantInt&gt;(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getOperand(1));</div>
<div class="line"><a name="l07794"></a><span class="lineno"> 7794</span>&#160;}</div>
<div class="line"><a name="l07795"></a><span class="lineno"> 7795</span>&#160; </div>
<div class="line"><a name="l07796"></a><span class="lineno"> 7796</span>&#160;<span class="comment">// Try unmerging GEPs to reduce liveness interference (register pressure) across</span></div>
<div class="line"><a name="l07797"></a><span class="lineno"> 7797</span>&#160;<span class="comment">// IndirectBr edges. Since IndirectBr edges tend to touch on many blocks,</span></div>
<div class="line"><a name="l07798"></a><span class="lineno"> 7798</span>&#160;<span class="comment">// reducing liveness interference across those edges benefits global register</span></div>
<div class="line"><a name="l07799"></a><span class="lineno"> 7799</span>&#160;<span class="comment">// allocation. Currently handles only certain cases.</span></div>
<div class="line"><a name="l07800"></a><span class="lineno"> 7800</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l07801"></a><span class="lineno"> 7801</span>&#160;<span class="comment">// For example, unmerge %GEPI and %UGEPI as below.</span></div>
<div class="line"><a name="l07802"></a><span class="lineno"> 7802</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l07803"></a><span class="lineno"> 7803</span>&#160;<span class="comment">// ---------- BEFORE ----------</span></div>
<div class="line"><a name="l07804"></a><span class="lineno"> 7804</span>&#160;<span class="comment">// SrcBlock:</span></div>
<div class="line"><a name="l07805"></a><span class="lineno"> 7805</span>&#160;<span class="comment">//   ...</span></div>
<div class="line"><a name="l07806"></a><span class="lineno"> 7806</span>&#160;<span class="comment">//   %GEPIOp = ...</span></div>
<div class="line"><a name="l07807"></a><span class="lineno"> 7807</span>&#160;<span class="comment">//   ...</span></div>
<div class="line"><a name="l07808"></a><span class="lineno"> 7808</span>&#160;<span class="comment">//   %GEPI = gep %GEPIOp, Idx</span></div>
<div class="line"><a name="l07809"></a><span class="lineno"> 7809</span>&#160;<span class="comment">//   ...</span></div>
<div class="line"><a name="l07810"></a><span class="lineno"> 7810</span>&#160;<span class="comment">//   indirectbr ... [ label %DstB0, label %DstB1, ... label %DstBi ... ]</span></div>
<div class="line"><a name="l07811"></a><span class="lineno"> 7811</span>&#160;<span class="comment">//   (* %GEPI is alive on the indirectbr edges due to other uses ahead)</span></div>
<div class="line"><a name="l07812"></a><span class="lineno"> 7812</span>&#160;<span class="comment">//   (* %GEPIOp is alive on the indirectbr edges only because of it&#39;s used by</span></div>
<div class="line"><a name="l07813"></a><span class="lineno"> 7813</span>&#160;<span class="comment">//   %UGEPI)</span></div>
<div class="line"><a name="l07814"></a><span class="lineno"> 7814</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l07815"></a><span class="lineno"> 7815</span>&#160;<span class="comment">// DstB0: ... (there may be a gep similar to %UGEPI to be unmerged)</span></div>
<div class="line"><a name="l07816"></a><span class="lineno"> 7816</span>&#160;<span class="comment">// DstB1: ... (there may be a gep similar to %UGEPI to be unmerged)</span></div>
<div class="line"><a name="l07817"></a><span class="lineno"> 7817</span>&#160;<span class="comment">// ...</span></div>
<div class="line"><a name="l07818"></a><span class="lineno"> 7818</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l07819"></a><span class="lineno"> 7819</span>&#160;<span class="comment">// DstBi:</span></div>
<div class="line"><a name="l07820"></a><span class="lineno"> 7820</span>&#160;<span class="comment">//   ...</span></div>
<div class="line"><a name="l07821"></a><span class="lineno"> 7821</span>&#160;<span class="comment">//   %UGEPI = gep %GEPIOp, UIdx</span></div>
<div class="line"><a name="l07822"></a><span class="lineno"> 7822</span>&#160;<span class="comment">// ...</span></div>
<div class="line"><a name="l07823"></a><span class="lineno"> 7823</span>&#160;<span class="comment">// ---------------------------</span></div>
<div class="line"><a name="l07824"></a><span class="lineno"> 7824</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l07825"></a><span class="lineno"> 7825</span>&#160;<span class="comment">// ---------- AFTER ----------</span></div>
<div class="line"><a name="l07826"></a><span class="lineno"> 7826</span>&#160;<span class="comment">// SrcBlock:</span></div>
<div class="line"><a name="l07827"></a><span class="lineno"> 7827</span>&#160;<span class="comment">//   ... (same as above)</span></div>
<div class="line"><a name="l07828"></a><span class="lineno"> 7828</span>&#160;<span class="comment">//    (* %GEPI is still alive on the indirectbr edges)</span></div>
<div class="line"><a name="l07829"></a><span class="lineno"> 7829</span>&#160;<span class="comment">//    (* %GEPIOp is no longer alive on the indirectbr edges as a result of the</span></div>
<div class="line"><a name="l07830"></a><span class="lineno"> 7830</span>&#160;<span class="comment">//    unmerging)</span></div>
<div class="line"><a name="l07831"></a><span class="lineno"> 7831</span>&#160;<span class="comment">// ...</span></div>
<div class="line"><a name="l07832"></a><span class="lineno"> 7832</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l07833"></a><span class="lineno"> 7833</span>&#160;<span class="comment">// DstBi:</span></div>
<div class="line"><a name="l07834"></a><span class="lineno"> 7834</span>&#160;<span class="comment">//   ...</span></div>
<div class="line"><a name="l07835"></a><span class="lineno"> 7835</span>&#160;<span class="comment">//   %UGEPI = gep %GEPI, (UIdx-Idx)</span></div>
<div class="line"><a name="l07836"></a><span class="lineno"> 7836</span>&#160;<span class="comment">//   ...</span></div>
<div class="line"><a name="l07837"></a><span class="lineno"> 7837</span>&#160;<span class="comment">// ---------------------------</span></div>
<div class="line"><a name="l07838"></a><span class="lineno"> 7838</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l07839"></a><span class="lineno"> 7839</span>&#160;<span class="comment">// The register pressure on the IndirectBr edges is reduced because %GEPIOp is</span></div>
<div class="line"><a name="l07840"></a><span class="lineno"> 7840</span>&#160;<span class="comment">// no longer alive on them.</span></div>
<div class="line"><a name="l07841"></a><span class="lineno"> 7841</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l07842"></a><span class="lineno"> 7842</span>&#160;<span class="comment">// We try to unmerge GEPs here in CodGenPrepare, as opposed to limiting merging</span></div>
<div class="line"><a name="l07843"></a><span class="lineno"> 7843</span>&#160;<span class="comment">// of GEPs in the first place in InstCombiner::visitGetElementPtrInst() so as</span></div>
<div class="line"><a name="l07844"></a><span class="lineno"> 7844</span>&#160;<span class="comment">// not to disable further simplications and optimizations as a result of GEP</span></div>
<div class="line"><a name="l07845"></a><span class="lineno"> 7845</span>&#160;<span class="comment">// merging.</span></div>
<div class="line"><a name="l07846"></a><span class="lineno"> 7846</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l07847"></a><span class="lineno"> 7847</span>&#160;<span class="comment">// Note this unmerging may increase the length of the data flow critical path</span></div>
<div class="line"><a name="l07848"></a><span class="lineno"> 7848</span>&#160;<span class="comment">// (the path from %GEPIOp to %UGEPI would go through %GEPI), which is a tradeoff</span></div>
<div class="line"><a name="l07849"></a><span class="lineno"> 7849</span>&#160;<span class="comment">// between the register pressure and the length of data-flow critical</span></div>
<div class="line"><a name="l07850"></a><span class="lineno"> 7850</span>&#160;<span class="comment">// path. Restricting this to the uncommon IndirectBr case would minimize the</span></div>
<div class="line"><a name="l07851"></a><span class="lineno"> 7851</span>&#160;<span class="comment">// impact of potentially longer critical path, if any, and the impact on compile</span></div>
<div class="line"><a name="l07852"></a><span class="lineno"> 7852</span>&#160;<span class="comment">// time.</span></div>
<div class="line"><a name="l07853"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#a8528dea79f0940669c4fcb751940ca94"> 7853</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CodeGenPrepare_8cpp.html#a8528dea79f0940669c4fcb751940ca94">tryUnmergingGEPsAcrossIndirectBr</a>(<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *GEPI,</div>
<div class="line"><a name="l07854"></a><span class="lineno"> 7854</span>&#160;                                             <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> *<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) {</div>
<div class="line"><a name="l07855"></a><span class="lineno"> 7855</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *SrcBlock = GEPI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l07856"></a><span class="lineno"> 7856</span>&#160;  <span class="comment">// Check that SrcBlock ends with an IndirectBr. If not, give up. The common</span></div>
<div class="line"><a name="l07857"></a><span class="lineno"> 7857</span>&#160;  <span class="comment">// (non-IndirectBr) cases exit early here.</span></div>
<div class="line"><a name="l07858"></a><span class="lineno"> 7858</span>&#160;  <span class="keywordflow">if</span> (!isa&lt;IndirectBrInst&gt;(SrcBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>()))</div>
<div class="line"><a name="l07859"></a><span class="lineno"> 7859</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07860"></a><span class="lineno"> 7860</span>&#160;  <span class="comment">// Check that GEPI is a simple gep with a single constant index.</span></div>
<div class="line"><a name="l07861"></a><span class="lineno"> 7861</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="CodeGenPrepare_8cpp.html#ac3e586008202db1f802e906a489d7574">GEPSequentialConstIndexed</a>(GEPI))</div>
<div class="line"><a name="l07862"></a><span class="lineno"> 7862</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07863"></a><span class="lineno"> 7863</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *GEPIIdx = cast&lt;ConstantInt&gt;(GEPI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1));</div>
<div class="line"><a name="l07864"></a><span class="lineno"> 7864</span>&#160;  <span class="comment">// Check that GEPI is a cheap one.</span></div>
<div class="line"><a name="l07865"></a><span class="lineno"> 7865</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a8f708e28c4cf4fcdbbe363849b779a00">getIntImmCost</a>(GEPIIdx-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>(), GEPIIdx-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#afe3ce7fc89f36474eb0369cbb792c05a">getType</a>(),</div>
<div class="line"><a name="l07866"></a><span class="lineno"> 7866</span>&#160;                         TargetTransformInfo::TCK_SizeAndLatency) &gt;</div>
<div class="line"><a name="l07867"></a><span class="lineno"> 7867</span>&#160;      TargetTransformInfo::TCC_Basic)</div>
<div class="line"><a name="l07868"></a><span class="lineno"> 7868</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07869"></a><span class="lineno"> 7869</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *GEPIOp = GEPI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l07870"></a><span class="lineno"> 7870</span>&#160;  <span class="comment">// Check that GEPIOp is an instruction that&#39;s also defined in SrcBlock.</span></div>
<div class="line"><a name="l07871"></a><span class="lineno"> 7871</span>&#160;  <span class="keywordflow">if</span> (!isa&lt;Instruction&gt;(GEPIOp))</div>
<div class="line"><a name="l07872"></a><span class="lineno"> 7872</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07873"></a><span class="lineno"> 7873</span>&#160;  <span class="keyword">auto</span> *GEPIOpI = cast&lt;Instruction&gt;(GEPIOp);</div>
<div class="line"><a name="l07874"></a><span class="lineno"> 7874</span>&#160;  <span class="keywordflow">if</span> (GEPIOpI-&gt;getParent() != SrcBlock)</div>
<div class="line"><a name="l07875"></a><span class="lineno"> 7875</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07876"></a><span class="lineno"> 7876</span>&#160;  <span class="comment">// Check that GEP is used outside the block, meaning it&#39;s alive on the</span></div>
<div class="line"><a name="l07877"></a><span class="lineno"> 7877</span>&#160;  <span class="comment">// IndirectBr edge(s).</span></div>
<div class="line"><a name="l07878"></a><span class="lineno"> 7878</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a7dc3069afa2ce5ea62ac2eb183e51c00">llvm::none_of</a>(GEPI-&gt;<a class="code" href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">users</a>(), [&amp;](<a class="code" href="classllvm_1_1User.html">User</a> *Usr) {</div>
<div class="line"><a name="l07879"></a><span class="lineno"> 7879</span>&#160;        if (auto *I = dyn_cast&lt;Instruction&gt;(Usr)) {</div>
<div class="line"><a name="l07880"></a><span class="lineno"> 7880</span>&#160;          if (I-&gt;getParent() != SrcBlock) {</div>
<div class="line"><a name="l07881"></a><span class="lineno"> 7881</span>&#160;            return true;</div>
<div class="line"><a name="l07882"></a><span class="lineno"> 7882</span>&#160;          }</div>
<div class="line"><a name="l07883"></a><span class="lineno"> 7883</span>&#160;        }</div>
<div class="line"><a name="l07884"></a><span class="lineno"> 7884</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07885"></a><span class="lineno"> 7885</span>&#160;      }))</div>
<div class="line"><a name="l07886"></a><span class="lineno"> 7886</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07887"></a><span class="lineno"> 7887</span>&#160;  <span class="comment">// The second elements of the GEP chains to be unmerged.</span></div>
<div class="line"><a name="l07888"></a><span class="lineno"> 7888</span>&#160;  std::vector&lt;GetElementPtrInst *&gt; UGEPIs;</div>
<div class="line"><a name="l07889"></a><span class="lineno"> 7889</span>&#160;  <span class="comment">// Check each user of GEPIOp to check if unmerging would make GEPIOp not alive</span></div>
<div class="line"><a name="l07890"></a><span class="lineno"> 7890</span>&#160;  <span class="comment">// on IndirectBr edges.</span></div>
<div class="line"><a name="l07891"></a><span class="lineno"> 7891</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1User.html">User</a> *Usr : GEPIOp-&gt;<a class="code" href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">users</a>()) {</div>
<div class="line"><a name="l07892"></a><span class="lineno"> 7892</span>&#160;    <span class="keywordflow">if</span> (Usr == GEPI)</div>
<div class="line"><a name="l07893"></a><span class="lineno"> 7893</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l07894"></a><span class="lineno"> 7894</span>&#160;    <span class="comment">// Check if Usr is an Instruction. If not, give up.</span></div>
<div class="line"><a name="l07895"></a><span class="lineno"> 7895</span>&#160;    <span class="keywordflow">if</span> (!isa&lt;Instruction&gt;(Usr))</div>
<div class="line"><a name="l07896"></a><span class="lineno"> 7896</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07897"></a><span class="lineno"> 7897</span>&#160;    <span class="keyword">auto</span> *UI = cast&lt;Instruction&gt;(Usr);</div>
<div class="line"><a name="l07898"></a><span class="lineno"> 7898</span>&#160;    <span class="comment">// Check if Usr in the same block as GEPIOp, which is fine, skip.</span></div>
<div class="line"><a name="l07899"></a><span class="lineno"> 7899</span>&#160;    <span class="keywordflow">if</span> (UI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() == SrcBlock)</div>
<div class="line"><a name="l07900"></a><span class="lineno"> 7900</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l07901"></a><span class="lineno"> 7901</span>&#160;    <span class="comment">// Check if Usr is a GEP. If not, give up.</span></div>
<div class="line"><a name="l07902"></a><span class="lineno"> 7902</span>&#160;    <span class="keywordflow">if</span> (!isa&lt;GetElementPtrInst&gt;(Usr))</div>
<div class="line"><a name="l07903"></a><span class="lineno"> 7903</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07904"></a><span class="lineno"> 7904</span>&#160;    <span class="keyword">auto</span> *UGEPI = cast&lt;GetElementPtrInst&gt;(Usr);</div>
<div class="line"><a name="l07905"></a><span class="lineno"> 7905</span>&#160;    <span class="comment">// Check if UGEPI is a simple gep with a single constant index and GEPIOp is</span></div>
<div class="line"><a name="l07906"></a><span class="lineno"> 7906</span>&#160;    <span class="comment">// the pointer operand to it. If so, record it in the vector. If not, give</span></div>
<div class="line"><a name="l07907"></a><span class="lineno"> 7907</span>&#160;    <span class="comment">// up.</span></div>
<div class="line"><a name="l07908"></a><span class="lineno"> 7908</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="CodeGenPrepare_8cpp.html#ac3e586008202db1f802e906a489d7574">GEPSequentialConstIndexed</a>(UGEPI))</div>
<div class="line"><a name="l07909"></a><span class="lineno"> 7909</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07910"></a><span class="lineno"> 7910</span>&#160;    <span class="keywordflow">if</span> (UGEPI-&gt;getOperand(0) != GEPIOp)</div>
<div class="line"><a name="l07911"></a><span class="lineno"> 7911</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07912"></a><span class="lineno"> 7912</span>&#160;    <span class="keywordflow">if</span> (GEPIIdx-&gt;getType() !=</div>
<div class="line"><a name="l07913"></a><span class="lineno"> 7913</span>&#160;        cast&lt;ConstantInt&gt;(UGEPI-&gt;getOperand(1))-&gt;getType())</div>
<div class="line"><a name="l07914"></a><span class="lineno"> 7914</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07915"></a><span class="lineno"> 7915</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *UGEPIIdx = cast&lt;ConstantInt&gt;(UGEPI-&gt;getOperand(1));</div>
<div class="line"><a name="l07916"></a><span class="lineno"> 7916</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a8f708e28c4cf4fcdbbe363849b779a00">getIntImmCost</a>(UGEPIIdx-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>(), UGEPIIdx-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#afe3ce7fc89f36474eb0369cbb792c05a">getType</a>(),</div>
<div class="line"><a name="l07917"></a><span class="lineno"> 7917</span>&#160;                           TargetTransformInfo::TCK_SizeAndLatency) &gt;</div>
<div class="line"><a name="l07918"></a><span class="lineno"> 7918</span>&#160;        TargetTransformInfo::TCC_Basic)</div>
<div class="line"><a name="l07919"></a><span class="lineno"> 7919</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07920"></a><span class="lineno"> 7920</span>&#160;    UGEPIs.push_back(UGEPI);</div>
<div class="line"><a name="l07921"></a><span class="lineno"> 7921</span>&#160;  }</div>
<div class="line"><a name="l07922"></a><span class="lineno"> 7922</span>&#160;  <span class="keywordflow">if</span> (UGEPIs.size() == 0)</div>
<div class="line"><a name="l07923"></a><span class="lineno"> 7923</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07924"></a><span class="lineno"> 7924</span>&#160;  <span class="comment">// Check the materializing cost of (Uidx-Idx).</span></div>
<div class="line"><a name="l07925"></a><span class="lineno"> 7925</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *UGEPI : UGEPIs) {</div>
<div class="line"><a name="l07926"></a><span class="lineno"> 7926</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *UGEPIIdx = cast&lt;ConstantInt&gt;(UGEPI-&gt;getOperand(1));</div>
<div class="line"><a name="l07927"></a><span class="lineno"> 7927</span>&#160;    <a class="code" href="classllvm_1_1APInt.html">APInt</a> NewIdx = UGEPIIdx-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>() - GEPIIdx-&gt;getValue();</div>
<div class="line"><a name="l07928"></a><span class="lineno"> 7928</span>&#160;    <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> ImmCost = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a8f708e28c4cf4fcdbbe363849b779a00">getIntImmCost</a>(</div>
<div class="line"><a name="l07929"></a><span class="lineno"> 7929</span>&#160;        NewIdx, GEPIIdx-&gt;getType(), TargetTransformInfo::TCK_SizeAndLatency);</div>
<div class="line"><a name="l07930"></a><span class="lineno"> 7930</span>&#160;    <span class="keywordflow">if</span> (ImmCost &gt; TargetTransformInfo::TCC_Basic)</div>
<div class="line"><a name="l07931"></a><span class="lineno"> 7931</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07932"></a><span class="lineno"> 7932</span>&#160;  }</div>
<div class="line"><a name="l07933"></a><span class="lineno"> 7933</span>&#160;  <span class="comment">// Now unmerge between GEPI and UGEPIs.</span></div>
<div class="line"><a name="l07934"></a><span class="lineno"> 7934</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *UGEPI : UGEPIs) {</div>
<div class="line"><a name="l07935"></a><span class="lineno"> 7935</span>&#160;    UGEPI-&gt;setOperand(0, GEPI);</div>
<div class="line"><a name="l07936"></a><span class="lineno"> 7936</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *UGEPIIdx = cast&lt;ConstantInt&gt;(UGEPI-&gt;getOperand(1));</div>
<div class="line"><a name="l07937"></a><span class="lineno"> 7937</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *NewUGEPIIdx = <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantInt::get</a>(</div>
<div class="line"><a name="l07938"></a><span class="lineno"> 7938</span>&#160;        GEPIIdx-&gt;getType(), UGEPIIdx-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>() - GEPIIdx-&gt;getValue());</div>
<div class="line"><a name="l07939"></a><span class="lineno"> 7939</span>&#160;    UGEPI-&gt;setOperand(1, NewUGEPIIdx);</div>
<div class="line"><a name="l07940"></a><span class="lineno"> 7940</span>&#160;    <span class="comment">// If GEPI is not inbounds but UGEPI is inbounds, change UGEPI to not</span></div>
<div class="line"><a name="l07941"></a><span class="lineno"> 7941</span>&#160;    <span class="comment">// inbounds to avoid UB.</span></div>
<div class="line"><a name="l07942"></a><span class="lineno"> 7942</span>&#160;    <span class="keywordflow">if</span> (!GEPI-&gt;isInBounds()) {</div>
<div class="line"><a name="l07943"></a><span class="lineno"> 7943</span>&#160;      UGEPI-&gt;setIsInBounds(<span class="keyword">false</span>);</div>
<div class="line"><a name="l07944"></a><span class="lineno"> 7944</span>&#160;    }</div>
<div class="line"><a name="l07945"></a><span class="lineno"> 7945</span>&#160;  }</div>
<div class="line"><a name="l07946"></a><span class="lineno"> 7946</span>&#160;  <span class="comment">// After unmerging, verify that GEPIOp is actually only used in SrcBlock (not</span></div>
<div class="line"><a name="l07947"></a><span class="lineno"> 7947</span>&#160;  <span class="comment">// alive on IndirectBr edges).</span></div>
<div class="line"><a name="l07948"></a><span class="lineno"> 7948</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm.html#a7dc3069afa2ce5ea62ac2eb183e51c00">llvm::none_of</a>(GEPIOp-&gt;users(),</div>
<div class="line"><a name="l07949"></a><span class="lineno"> 7949</span>&#160;                       [&amp;](<a class="code" href="classllvm_1_1User.html">User</a> *Usr) {</div>
<div class="line"><a name="l07950"></a><span class="lineno"> 7950</span>&#160;                         return cast&lt;Instruction&gt;(Usr)-&gt;getParent() != SrcBlock;</div>
<div class="line"><a name="l07951"></a><span class="lineno"> 7951</span>&#160;                       }) &amp;&amp;</div>
<div class="line"><a name="l07952"></a><span class="lineno"> 7952</span>&#160;         <span class="stringliteral">&quot;GEPIOp is used outside SrcBlock&quot;</span>);</div>
<div class="line"><a name="l07953"></a><span class="lineno"> 7953</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07954"></a><span class="lineno"> 7954</span>&#160;}</div>
<div class="line"><a name="l07955"></a><span class="lineno"> 7955</span>&#160; </div>
<div class="line"><a name="l07956"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#ad2bfc3e2f7b1661868517e662ac7496c"> 7956</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="CodeGenPrepare_8cpp.html#ad2bfc3e2f7b1661868517e662ac7496c">optimizeBranch</a>(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">Branch</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> &amp;TLI,</div>
<div class="line"><a name="l07957"></a><span class="lineno"> 7957</span>&#160;                           <a class="code" href="classllvm_1_1SmallSet.html">SmallSet&lt;BasicBlock *, 32&gt;</a> &amp;FreshBBs,</div>
<div class="line"><a name="l07958"></a><span class="lineno"> 7958</span>&#160;                           <span class="keywordtype">bool</span> IsHugeFunc) {</div>
<div class="line"><a name="l07959"></a><span class="lineno"> 7959</span>&#160;  <span class="comment">// Try and convert</span></div>
<div class="line"><a name="l07960"></a><span class="lineno"> 7960</span>&#160;  <span class="comment">//  %c = icmp ult %x, 8</span></div>
<div class="line"><a name="l07961"></a><span class="lineno"> 7961</span>&#160;  <span class="comment">//  br %c, bla, blb</span></div>
<div class="line"><a name="l07962"></a><span class="lineno"> 7962</span>&#160;  <span class="comment">//  %tc = lshr %x, 3</span></div>
<div class="line"><a name="l07963"></a><span class="lineno"> 7963</span>&#160;  <span class="comment">// to</span></div>
<div class="line"><a name="l07964"></a><span class="lineno"> 7964</span>&#160;  <span class="comment">//  %tc = lshr %x, 3</span></div>
<div class="line"><a name="l07965"></a><span class="lineno"> 7965</span>&#160;  <span class="comment">//  %c = icmp eq %tc, 0</span></div>
<div class="line"><a name="l07966"></a><span class="lineno"> 7966</span>&#160;  <span class="comment">//  br %c, bla, blb</span></div>
<div class="line"><a name="l07967"></a><span class="lineno"> 7967</span>&#160;  <span class="comment">// Creating the cmp to zero can be better for the backend, especially if the</span></div>
<div class="line"><a name="l07968"></a><span class="lineno"> 7968</span>&#160;  <span class="comment">// lshr produces flags that can be used automatically.</span></div>
<div class="line"><a name="l07969"></a><span class="lineno"> 7969</span>&#160;  <span class="keywordflow">if</span> (!TLI.<a class="code" href="classllvm_1_1TargetLoweringBase.html#af7763c45db027300e49b43037e5a1a60">preferZeroCompareBranch</a>() || !<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">Branch</a>-&gt;isConditional())</div>
<div class="line"><a name="l07970"></a><span class="lineno"> 7970</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07971"></a><span class="lineno"> 7971</span>&#160; </div>
<div class="line"><a name="l07972"></a><span class="lineno"> 7972</span>&#160;  <a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *Cmp = dyn_cast&lt;ICmpInst&gt;(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">Branch</a>-&gt;getCondition());</div>
<div class="line"><a name="l07973"></a><span class="lineno"> 7973</span>&#160;  <span class="keywordflow">if</span> (!Cmp || !isa&lt;ConstantInt&gt;(Cmp-&gt;getOperand(1)) || !Cmp-&gt;hasOneUse())</div>
<div class="line"><a name="l07974"></a><span class="lineno"> 7974</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07975"></a><span class="lineno"> 7975</span>&#160; </div>
<div class="line"><a name="l07976"></a><span class="lineno"> 7976</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a> = Cmp-&gt;getOperand(0);</div>
<div class="line"><a name="l07977"></a><span class="lineno"> 7977</span>&#160;  <a class="code" href="classllvm_1_1APInt.html">APInt</a> CmpC = cast&lt;ConstantInt&gt;(Cmp-&gt;getOperand(1))-&gt;getValue();</div>
<div class="line"><a name="l07978"></a><span class="lineno"> 7978</span>&#160; </div>
<div class="line"><a name="l07979"></a><span class="lineno"> 7979</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *U : <a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>-&gt;users()) {</div>
<div class="line"><a name="l07980"></a><span class="lineno"> 7980</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *UI = dyn_cast&lt;Instruction&gt;(U);</div>
<div class="line"><a name="l07981"></a><span class="lineno"> 7981</span>&#160;    <span class="comment">// A quick dominance check</span></div>
<div class="line"><a name="l07982"></a><span class="lineno"> 7982</span>&#160;    <span class="keywordflow">if</span> (!UI ||</div>
<div class="line"><a name="l07983"></a><span class="lineno"> 7983</span>&#160;        (UI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() != <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">Branch</a>-&gt;getParent() &amp;&amp;</div>
<div class="line"><a name="l07984"></a><span class="lineno"> 7984</span>&#160;         UI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() != <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">Branch</a>-&gt;getSuccessor(0) &amp;&amp;</div>
<div class="line"><a name="l07985"></a><span class="lineno"> 7985</span>&#160;         UI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() != <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">Branch</a>-&gt;getSuccessor(1)) ||</div>
<div class="line"><a name="l07986"></a><span class="lineno"> 7986</span>&#160;        (UI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() != <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">Branch</a>-&gt;getParent() &amp;&amp;</div>
<div class="line"><a name="l07987"></a><span class="lineno"> 7987</span>&#160;         !UI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>()))</div>
<div class="line"><a name="l07988"></a><span class="lineno"> 7988</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l07989"></a><span class="lineno"> 7989</span>&#160; </div>
<div class="line"><a name="l07990"></a><span class="lineno"> 7990</span>&#160;    <span class="keywordflow">if</span> (CmpC.<a class="code" href="classllvm_1_1APInt.html#ad1b0513de876d1c85cf6268ca21b2c86">isPowerOf2</a>() &amp;&amp; Cmp-&gt;getPredicate() == ICmpInst::ICMP_ULT &amp;&amp;</div>
<div class="line"><a name="l07991"></a><span class="lineno"> 7991</span>&#160;        <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(UI, <a class="code" href="namespacellvm_1_1PatternMatch.html#aa41636955199b88164376e06e5914855">m_Shr</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">m_Specific</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#a3acbd0be97863e3e03e3b85641254018">m_SpecificInt</a>(CmpC.<a class="code" href="classllvm_1_1APInt.html#aae3b959a0a2981340fd03c29f528f2f0">logBase2</a>())))) {</div>
<div class="line"><a name="l07992"></a><span class="lineno"> 7992</span>&#160;      <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">Branch</a>);</div>
<div class="line"><a name="l07993"></a><span class="lineno"> 7993</span>&#160;      <span class="keywordflow">if</span> (UI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() != <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">Branch</a>-&gt;getParent())</div>
<div class="line"><a name="l07994"></a><span class="lineno"> 7994</span>&#160;        UI-&gt;<a class="code" href="classllvm_1_1Instruction.html#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">Branch</a>);</div>
<div class="line"><a name="l07995"></a><span class="lineno"> 7995</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *NewCmp = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCmp(ICmpInst::ICMP_EQ, UI,</div>
<div class="line"><a name="l07996"></a><span class="lineno"> 7996</span>&#160;                                        <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantInt::get</a>(UI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), 0));</div>
<div class="line"><a name="l07997"></a><span class="lineno"> 7997</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Converting &quot;</span> &lt;&lt; *Cmp &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l07998"></a><span class="lineno"> 7998</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot; to compare on zero: &quot;</span> &lt;&lt; *NewCmp &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l07999"></a><span class="lineno"> 7999</span>&#160;      <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(Cmp, NewCmp, FreshBBs, IsHugeFunc);</div>
<div class="line"><a name="l08000"></a><span class="lineno"> 8000</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l08001"></a><span class="lineno"> 8001</span>&#160;    }</div>
<div class="line"><a name="l08002"></a><span class="lineno"> 8002</span>&#160;    <span class="keywordflow">if</span> (Cmp-&gt;isEquality() &amp;&amp;</div>
<div class="line"><a name="l08003"></a><span class="lineno"> 8003</span>&#160;        (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(UI, <a class="code" href="namespacellvm_1_1PatternMatch.html#a944c25ac9b73b02a17a20a08a25b9b21">m_Add</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">m_Specific</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#a3acbd0be97863e3e03e3b85641254018">m_SpecificInt</a>(-CmpC))) ||</div>
<div class="line"><a name="l08004"></a><span class="lineno"> 8004</span>&#160;         <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(UI, <a class="code" href="namespacellvm_1_1PatternMatch.html#ac3ed5602889a22db44a16e1b97fac5b8">m_Sub</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">m_Specific</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#a3acbd0be97863e3e03e3b85641254018">m_SpecificInt</a>(CmpC))))) {</div>
<div class="line"><a name="l08005"></a><span class="lineno"> 8005</span>&#160;      <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">Branch</a>);</div>
<div class="line"><a name="l08006"></a><span class="lineno"> 8006</span>&#160;      <span class="keywordflow">if</span> (UI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() != <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">Branch</a>-&gt;getParent())</div>
<div class="line"><a name="l08007"></a><span class="lineno"> 8007</span>&#160;        UI-&gt;<a class="code" href="classllvm_1_1Instruction.html#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">Branch</a>);</div>
<div class="line"><a name="l08008"></a><span class="lineno"> 8008</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *NewCmp = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCmp(Cmp-&gt;getPredicate(), UI,</div>
<div class="line"><a name="l08009"></a><span class="lineno"> 8009</span>&#160;                                        <a class="code" href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">ConstantInt::get</a>(UI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), 0));</div>
<div class="line"><a name="l08010"></a><span class="lineno"> 8010</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Converting &quot;</span> &lt;&lt; *Cmp &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l08011"></a><span class="lineno"> 8011</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot; to compare on zero: &quot;</span> &lt;&lt; *NewCmp &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l08012"></a><span class="lineno"> 8012</span>&#160;      <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(Cmp, NewCmp, FreshBBs, IsHugeFunc);</div>
<div class="line"><a name="l08013"></a><span class="lineno"> 8013</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l08014"></a><span class="lineno"> 8014</span>&#160;    }</div>
<div class="line"><a name="l08015"></a><span class="lineno"> 8015</span>&#160;  }</div>
<div class="line"><a name="l08016"></a><span class="lineno"> 8016</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l08017"></a><span class="lineno"> 8017</span>&#160;}</div>
<div class="line"><a name="l08018"></a><span class="lineno"> 8018</span>&#160; </div>
<div class="line"><a name="l08019"></a><span class="lineno"> 8019</span>&#160;<span class="keywordtype">bool</span> CodeGenPrepare::optimizeInst(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, ModifyDT &amp;ModifiedDT) {</div>
<div class="line"><a name="l08020"></a><span class="lineno"> 8020</span>&#160;  <span class="comment">// Bail out if we inserted the instruction to prevent optimizations from</span></div>
<div class="line"><a name="l08021"></a><span class="lineno"> 8021</span>&#160;  <span class="comment">// stepping on each other&#39;s toes.</span></div>
<div class="line"><a name="l08022"></a><span class="lineno"> 8022</span>&#160;  <span class="keywordflow">if</span> (InsertedInsts.count(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l08023"></a><span class="lineno"> 8023</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l08024"></a><span class="lineno"> 8024</span>&#160; </div>
<div class="line"><a name="l08025"></a><span class="lineno"> 8025</span>&#160;  <span class="comment">// TODO: Move into the switch on opcode below here.</span></div>
<div class="line"><a name="l08026"></a><span class="lineno"> 8026</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> = dyn_cast&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l08027"></a><span class="lineno"> 8027</span>&#160;    <span class="comment">// It is possible for very late stage optimizations (such as SimplifyCFG)</span></div>
<div class="line"><a name="l08028"></a><span class="lineno"> 8028</span>&#160;    <span class="comment">// to introduce PHI nodes too late to be cleaned up.  If we detect such a</span></div>
<div class="line"><a name="l08029"></a><span class="lineno"> 8029</span>&#160;    <span class="comment">// trivial PHI, go ahead and zap it here.</span></div>
<div class="line"><a name="l08030"></a><span class="lineno"> 8030</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="namespacellvm.html#aab02db480f387fca92956ef1c9a01941">simplifyInstruction</a>(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>, {*<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, TLInfo})) {</div>
<div class="line"><a name="l08031"></a><span class="lineno"> 8031</span>&#160;      LargeOffsetGEPMap.erase(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>);</div>
<div class="line"><a name="l08032"></a><span class="lineno"> 8032</span>&#160;      <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>, V, FreshBBs, IsHugeFunc);</div>
<div class="line"><a name="l08033"></a><span class="lineno"> 8033</span>&#160;      <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l08034"></a><span class="lineno"> 8034</span>&#160;      ++NumPHIsElim;</div>
<div class="line"><a name="l08035"></a><span class="lineno"> 8035</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l08036"></a><span class="lineno"> 8036</span>&#160;    }</div>
<div class="line"><a name="l08037"></a><span class="lineno"> 8037</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l08038"></a><span class="lineno"> 8038</span>&#160;  }</div>
<div class="line"><a name="l08039"></a><span class="lineno"> 8039</span>&#160; </div>
<div class="line"><a name="l08040"></a><span class="lineno"> 8040</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1CastInst.html">CastInst</a> *CI = dyn_cast&lt;CastInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l08041"></a><span class="lineno"> 8041</span>&#160;    <span class="comment">// If the source of the cast is a constant, then this should have</span></div>
<div class="line"><a name="l08042"></a><span class="lineno"> 8042</span>&#160;    <span class="comment">// already been constant folded.  The only reason NOT to constant fold</span></div>
<div class="line"><a name="l08043"></a><span class="lineno"> 8043</span>&#160;    <span class="comment">// it is if something (e.g. LSR) was careful to place the constant</span></div>
<div class="line"><a name="l08044"></a><span class="lineno"> 8044</span>&#160;    <span class="comment">// evaluation in a block other than then one that uses it (e.g. to hoist</span></div>
<div class="line"><a name="l08045"></a><span class="lineno"> 8045</span>&#160;    <span class="comment">// the address of globals out of a loop).  If this is the case, we don&#39;t</span></div>
<div class="line"><a name="l08046"></a><span class="lineno"> 8046</span>&#160;    <span class="comment">// want to forward-subst the cast.</span></div>
<div class="line"><a name="l08047"></a><span class="lineno"> 8047</span>&#160;    <span class="keywordflow">if</span> (isa&lt;Constant&gt;(CI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)))</div>
<div class="line"><a name="l08048"></a><span class="lineno"> 8048</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l08049"></a><span class="lineno"> 8049</span>&#160; </div>
<div class="line"><a name="l08050"></a><span class="lineno"> 8050</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="CodeGenPrepare_8cpp.html#a3b82cff474790446f1288f1a086c1cd6">OptimizeNoopCopyExpression</a>(CI, *TLI, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</div>
<div class="line"><a name="l08051"></a><span class="lineno"> 8051</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l08052"></a><span class="lineno"> 8052</span>&#160; </div>
<div class="line"><a name="l08053"></a><span class="lineno"> 8053</span>&#160;    <span class="keywordflow">if</span> ((isa&lt;UIToFPInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || isa&lt;FPToUIInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || isa&lt;TruncInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</div>
<div class="line"><a name="l08054"></a><span class="lineno"> 8054</span>&#160;        TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a75c56e6018bb081bdcbed08b95ca00f3">optimizeExtendOrTruncateConversion</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</div>
<div class="line"><a name="l08055"></a><span class="lineno"> 8055</span>&#160;                                                LI-&gt;getLoopFor(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent())))</div>
<div class="line"><a name="l08056"></a><span class="lineno"> 8056</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l08057"></a><span class="lineno"> 8057</span>&#160; </div>
<div class="line"><a name="l08058"></a><span class="lineno"> 8058</span>&#160;    <span class="keywordflow">if</span> (isa&lt;ZExtInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || isa&lt;SExtInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {<span class="comment"></span></div>
<div class="line"><a name="l08059"></a><span class="lineno"> 8059</span>&#160;<span class="comment">      /// Sink a zext or sext into its user blocks if the target type doesn&#39;t</span></div>
<div class="line"><a name="l08060"></a><span class="lineno"> 8060</span>&#160;<span class="comment">      /// fit in one register</span></div>
<div class="line"><a name="l08061"></a><span class="lineno"> 8061</span>&#160;<span class="comment"></span>      <span class="keywordflow">if</span> (TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#ad859786d7e54bdc5c568ac20c69816e0">getTypeAction</a>(CI-&gt;<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(),</div>
<div class="line"><a name="l08062"></a><span class="lineno"> 8062</span>&#160;                             TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(*<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#afe3ce7fc89f36474eb0369cbb792c05a">getType</a>())) ==</div>
<div class="line"><a name="l08063"></a><span class="lineno"> 8063</span>&#160;          TargetLowering::TypeExpandInteger) {</div>
<div class="line"><a name="l08064"></a><span class="lineno"> 8064</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="CodeGenPrepare_8cpp.html#a3cc8a3a2506bf528398d0aef0850f31a">SinkCast</a>(CI);</div>
<div class="line"><a name="l08065"></a><span class="lineno"> 8065</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l08066"></a><span class="lineno"> 8066</span>&#160;        <span class="keywordflow">if</span> (TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a75c56e6018bb081bdcbed08b95ca00f3">optimizeExtendOrTruncateConversion</a>(</div>
<div class="line"><a name="l08067"></a><span class="lineno"> 8067</span>&#160;                <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, LI-&gt;getLoopFor(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent())))</div>
<div class="line"><a name="l08068"></a><span class="lineno"> 8068</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l08069"></a><span class="lineno"> 8069</span>&#160; </div>
<div class="line"><a name="l08070"></a><span class="lineno"> 8070</span>&#160;        <span class="keywordtype">bool</span> MadeChange = optimizeExt(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l08071"></a><span class="lineno"> 8071</span>&#160;        <span class="keywordflow">return</span> MadeChange | optimizeExtUses(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l08072"></a><span class="lineno"> 8072</span>&#160;      }</div>
<div class="line"><a name="l08073"></a><span class="lineno"> 8073</span>&#160;    }</div>
<div class="line"><a name="l08074"></a><span class="lineno"> 8074</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l08075"></a><span class="lineno"> 8075</span>&#160;  }</div>
<div class="line"><a name="l08076"></a><span class="lineno"> 8076</span>&#160; </div>
<div class="line"><a name="l08077"></a><span class="lineno"> 8077</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Cmp = dyn_cast&lt;CmpInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l08078"></a><span class="lineno"> 8078</span>&#160;    <span class="keywordflow">if</span> (optimizeCmp(Cmp, ModifiedDT))</div>
<div class="line"><a name="l08079"></a><span class="lineno"> 8079</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l08080"></a><span class="lineno"> 8080</span>&#160; </div>
<div class="line"><a name="l08081"></a><span class="lineno"> 8081</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l08082"></a><span class="lineno"> 8082</span>&#160;    LI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(LLVMContext::MD_invariant_group, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l08083"></a><span class="lineno"> 8083</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> = optimizeLoadExt(LI);</div>
<div class="line"><a name="l08084"></a><span class="lineno"> 8084</span>&#160;    <span class="keywordtype">unsigned</span> AS = LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#a161c2db145827f4e181e7fe662b53a81">getPointerAddressSpace</a>();</div>
<div class="line"><a name="l08085"></a><span class="lineno"> 8085</span>&#160;    <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a> |= optimizeMemoryInst(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), LI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), AS);</div>
<div class="line"><a name="l08086"></a><span class="lineno"> 8086</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">Modified</a>;</div>
<div class="line"><a name="l08087"></a><span class="lineno"> 8087</span>&#160;  }</div>
<div class="line"><a name="l08088"></a><span class="lineno"> 8088</span>&#160; </div>
<div class="line"><a name="l08089"></a><span class="lineno"> 8089</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;StoreInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l08090"></a><span class="lineno"> 8090</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="CodeGenPrepare_8cpp.html#a3c7e1486d1d466b3be981adcb21a6359">splitMergedValStore</a>(*<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, *TLI))</div>
<div class="line"><a name="l08091"></a><span class="lineno"> 8091</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l08092"></a><span class="lineno"> 8092</span>&#160;    <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;setMetadata(LLVMContext::MD_invariant_group, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l08093"></a><span class="lineno"> 8093</span>&#160;    <span class="keywordtype">unsigned</span> AS = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getPointerAddressSpace();</div>
<div class="line"><a name="l08094"></a><span class="lineno"> 8094</span>&#160;    <span class="keywordflow">return</span> optimizeMemoryInst(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getOperand(1),</div>
<div class="line"><a name="l08095"></a><span class="lineno"> 8095</span>&#160;                              <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getOperand(0)-&gt;getType(), AS);</div>
<div class="line"><a name="l08096"></a><span class="lineno"> 8096</span>&#160;  }</div>
<div class="line"><a name="l08097"></a><span class="lineno"> 8097</span>&#160; </div>
<div class="line"><a name="l08098"></a><span class="lineno"> 8098</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *RMW = dyn_cast&lt;AtomicRMWInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l08099"></a><span class="lineno"> 8099</span>&#160;    <span class="keywordtype">unsigned</span> AS = RMW-&gt;getPointerAddressSpace();</div>
<div class="line"><a name="l08100"></a><span class="lineno"> 8100</span>&#160;    <span class="keywordflow">return</span> optimizeMemoryInst(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, RMW-&gt;getPointerOperand(), RMW-&gt;getType(), AS);</div>
<div class="line"><a name="l08101"></a><span class="lineno"> 8101</span>&#160;  }</div>
<div class="line"><a name="l08102"></a><span class="lineno"> 8102</span>&#160; </div>
<div class="line"><a name="l08103"></a><span class="lineno"> 8103</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html">AtomicCmpXchgInst</a> *CmpX = dyn_cast&lt;AtomicCmpXchgInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l08104"></a><span class="lineno"> 8104</span>&#160;    <span class="keywordtype">unsigned</span> AS = CmpX-&gt;getPointerAddressSpace();</div>
<div class="line"><a name="l08105"></a><span class="lineno"> 8105</span>&#160;    <span class="keywordflow">return</span> optimizeMemoryInst(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, CmpX-&gt;getPointerOperand(),</div>
<div class="line"><a name="l08106"></a><span class="lineno"> 8106</span>&#160;                              CmpX-&gt;getCompareOperand()-&gt;getType(), AS);</div>
<div class="line"><a name="l08107"></a><span class="lineno"> 8107</span>&#160;  }</div>
<div class="line"><a name="l08108"></a><span class="lineno"> 8108</span>&#160; </div>
<div class="line"><a name="l08109"></a><span class="lineno"> 8109</span>&#160;  <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *BinOp = dyn_cast&lt;BinaryOperator&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l08110"></a><span class="lineno"> 8110</span>&#160; </div>
<div class="line"><a name="l08111"></a><span class="lineno"> 8111</span>&#160;  <span class="keywordflow">if</span> (BinOp &amp;&amp; BinOp-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::And &amp;&amp; <a class="code" href="CodeGenPrepare_8cpp.html#ab578df6035c026da33776b9367923c61">EnableAndCmpSinking</a> &amp;&amp;</div>
<div class="line"><a name="l08112"></a><span class="lineno"> 8112</span>&#160;      <a class="code" href="CodeGenPrepare_8cpp.html#a0049977ff1075a98e9f512bbf4d181a6">sinkAndCmp0Expression</a>(BinOp, *TLI, InsertedInsts))</div>
<div class="line"><a name="l08113"></a><span class="lineno"> 8113</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l08114"></a><span class="lineno"> 8114</span>&#160; </div>
<div class="line"><a name="l08115"></a><span class="lineno"> 8115</span>&#160;  <span class="comment">// TODO: Move this into the switch on opcode - it handles shifts already.</span></div>
<div class="line"><a name="l08116"></a><span class="lineno"> 8116</span>&#160;  <span class="keywordflow">if</span> (BinOp &amp;&amp; (BinOp-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::AShr ||</div>
<div class="line"><a name="l08117"></a><span class="lineno"> 8117</span>&#160;                BinOp-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::LShr)) {</div>
<div class="line"><a name="l08118"></a><span class="lineno"> 8118</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CI = dyn_cast&lt;ConstantInt&gt;(BinOp-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1));</div>
<div class="line"><a name="l08119"></a><span class="lineno"> 8119</span>&#160;    <span class="keywordflow">if</span> (CI &amp;&amp; TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a4574a60531dbf7cd8027141baa30c09a">hasExtractBitsInsn</a>())</div>
<div class="line"><a name="l08120"></a><span class="lineno"> 8120</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="CodeGenPrepare_8cpp.html#a2c05548feac70b16d31caf0cfb225714">OptimizeExtractBits</a>(BinOp, CI, *TLI, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</div>
<div class="line"><a name="l08121"></a><span class="lineno"> 8121</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l08122"></a><span class="lineno"> 8122</span>&#160;  }</div>
<div class="line"><a name="l08123"></a><span class="lineno"> 8123</span>&#160; </div>
<div class="line"><a name="l08124"></a><span class="lineno"> 8124</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *GEPI = dyn_cast&lt;GetElementPtrInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l08125"></a><span class="lineno"> 8125</span>&#160;    <span class="keywordflow">if</span> (GEPI-&gt;hasAllZeroIndices()) {<span class="comment"></span></div>
<div class="line"><a name="l08126"></a><span class="lineno"> 8126</span>&#160;<span class="comment">      /// The GEP operand must be a pointer, so must its result -&gt; BitCast</span></div>
<div class="line"><a name="l08127"></a><span class="lineno"> 8127</span>&#160;<span class="comment"></span>      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="regutils_8h.html#a1fa2460e32327ade49189c95740bc1b5">NC</a> = <span class="keyword">new</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a>(GEPI-&gt;getOperand(0), GEPI-&gt;getType(),</div>
<div class="line"><a name="l08128"></a><span class="lineno"> 8128</span>&#160;                                        GEPI-&gt;getName(), GEPI);</div>
<div class="line"><a name="l08129"></a><span class="lineno"> 8129</span>&#160;      <a class="code" href="regutils_8h.html#a1fa2460e32327ade49189c95740bc1b5">NC</a>-&gt;setDebugLoc(GEPI-&gt;getDebugLoc());</div>
<div class="line"><a name="l08130"></a><span class="lineno"> 8130</span>&#160;      <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(GEPI, <a class="code" href="regutils_8h.html#a1fa2460e32327ade49189c95740bc1b5">NC</a>, FreshBBs, IsHugeFunc);</div>
<div class="line"><a name="l08131"></a><span class="lineno"> 8131</span>&#160;      GEPI-&gt;eraseFromParent();</div>
<div class="line"><a name="l08132"></a><span class="lineno"> 8132</span>&#160;      ++NumGEPsElim;</div>
<div class="line"><a name="l08133"></a><span class="lineno"> 8133</span>&#160;      optimizeInst(<a class="code" href="regutils_8h.html#a1fa2460e32327ade49189c95740bc1b5">NC</a>, ModifiedDT);</div>
<div class="line"><a name="l08134"></a><span class="lineno"> 8134</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l08135"></a><span class="lineno"> 8135</span>&#160;    }</div>
<div class="line"><a name="l08136"></a><span class="lineno"> 8136</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="CodeGenPrepare_8cpp.html#a8528dea79f0940669c4fcb751940ca94">tryUnmergingGEPsAcrossIndirectBr</a>(GEPI, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>)) {</div>
<div class="line"><a name="l08137"></a><span class="lineno"> 8137</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l08138"></a><span class="lineno"> 8138</span>&#160;    }</div>
<div class="line"><a name="l08139"></a><span class="lineno"> 8139</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l08140"></a><span class="lineno"> 8140</span>&#160;  }</div>
<div class="line"><a name="l08141"></a><span class="lineno"> 8141</span>&#160; </div>
<div class="line"><a name="l08142"></a><span class="lineno"> 8142</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1FreezeInst.html">FreezeInst</a> *FI = dyn_cast&lt;FreezeInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l08143"></a><span class="lineno"> 8143</span>&#160;    <span class="comment">// freeze(icmp a, const)) -&gt; icmp (freeze a), const</span></div>
<div class="line"><a name="l08144"></a><span class="lineno"> 8144</span>&#160;    <span class="comment">// This helps generate efficient conditional jumps.</span></div>
<div class="line"><a name="l08145"></a><span class="lineno"> 8145</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *CmpI = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l08146"></a><span class="lineno"> 8146</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *II = dyn_cast&lt;ICmpInst&gt;(FI-&gt;getOperand(0)))</div>
<div class="line"><a name="l08147"></a><span class="lineno"> 8147</span>&#160;      CmpI = II;</div>
<div class="line"><a name="l08148"></a><span class="lineno"> 8148</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1FCmpInst.html">FCmpInst</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = dyn_cast&lt;FCmpInst&gt;(FI-&gt;getOperand(0)))</div>
<div class="line"><a name="l08149"></a><span class="lineno"> 8149</span>&#160;      CmpI = <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFastMathFlags().none() ? <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l08150"></a><span class="lineno"> 8150</span>&#160; </div>
<div class="line"><a name="l08151"></a><span class="lineno"> 8151</span>&#160;    <span class="keywordflow">if</span> (CmpI &amp;&amp; CmpI-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>()) {</div>
<div class="line"><a name="l08152"></a><span class="lineno"> 8152</span>&#160;      <span class="keyword">auto</span> Op0 = CmpI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), Op1 = CmpI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1);</div>
<div class="line"><a name="l08153"></a><span class="lineno"> 8153</span>&#160;      <span class="keywordtype">bool</span> Const0 = isa&lt;ConstantInt&gt;(Op0) || isa&lt;ConstantFP&gt;(Op0) ||</div>
<div class="line"><a name="l08154"></a><span class="lineno"> 8154</span>&#160;                    isa&lt;ConstantPointerNull&gt;(Op0);</div>
<div class="line"><a name="l08155"></a><span class="lineno"> 8155</span>&#160;      <span class="keywordtype">bool</span> Const1 = isa&lt;ConstantInt&gt;(Op1) || isa&lt;ConstantFP&gt;(Op1) ||</div>
<div class="line"><a name="l08156"></a><span class="lineno"> 8156</span>&#160;                    isa&lt;ConstantPointerNull&gt;(Op1);</div>
<div class="line"><a name="l08157"></a><span class="lineno"> 8157</span>&#160;      <span class="keywordflow">if</span> (Const0 || Const1) {</div>
<div class="line"><a name="l08158"></a><span class="lineno"> 8158</span>&#160;        <span class="keywordflow">if</span> (!Const0 || !Const1) {</div>
<div class="line"><a name="l08159"></a><span class="lineno"> 8159</span>&#160;          <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <span class="keyword">new</span> <a class="code" href="classllvm_1_1FreezeInst.html">FreezeInst</a>(Const0 ? Op1 : Op0, <span class="stringliteral">&quot;&quot;</span>, CmpI);</div>
<div class="line"><a name="l08160"></a><span class="lineno"> 8160</span>&#160;          <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;takeName(FI);</div>
<div class="line"><a name="l08161"></a><span class="lineno"> 8161</span>&#160;          CmpI-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(Const0 ? 1 : 0, <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l08162"></a><span class="lineno"> 8162</span>&#160;        }</div>
<div class="line"><a name="l08163"></a><span class="lineno"> 8163</span>&#160;        <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(FI, CmpI, FreshBBs, IsHugeFunc);</div>
<div class="line"><a name="l08164"></a><span class="lineno"> 8164</span>&#160;        FI-&gt;eraseFromParent();</div>
<div class="line"><a name="l08165"></a><span class="lineno"> 8165</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l08166"></a><span class="lineno"> 8166</span>&#160;      }</div>
<div class="line"><a name="l08167"></a><span class="lineno"> 8167</span>&#160;    }</div>
<div class="line"><a name="l08168"></a><span class="lineno"> 8168</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l08169"></a><span class="lineno"> 8169</span>&#160;  }</div>
<div class="line"><a name="l08170"></a><span class="lineno"> 8170</span>&#160; </div>
<div class="line"><a name="l08171"></a><span class="lineno"> 8171</span>&#160;  <span class="keywordflow">if</span> (tryToSinkFreeOperands(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l08172"></a><span class="lineno"> 8172</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l08173"></a><span class="lineno"> 8173</span>&#160; </div>
<div class="line"><a name="l08174"></a><span class="lineno"> 8174</span>&#160;  <span class="keywordflow">switch</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) {</div>
<div class="line"><a name="l08175"></a><span class="lineno"> 8175</span>&#160;  <span class="keywordflow">case</span> Instruction::Shl:</div>
<div class="line"><a name="l08176"></a><span class="lineno"> 8176</span>&#160;  <span class="keywordflow">case</span> Instruction::LShr:</div>
<div class="line"><a name="l08177"></a><span class="lineno"> 8177</span>&#160;  <span class="keywordflow">case</span> Instruction::AShr:</div>
<div class="line"><a name="l08178"></a><span class="lineno"> 8178</span>&#160;    <span class="keywordflow">return</span> optimizeShiftInst(cast&lt;BinaryOperator&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</div>
<div class="line"><a name="l08179"></a><span class="lineno"> 8179</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Instruction::Call</a>:</div>
<div class="line"><a name="l08180"></a><span class="lineno"> 8180</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="ScalarizeMaskedMemIntrin_8cpp.html#a8839065ea712711c22d6da68b2fb2d64">optimizeCallInst</a>(cast&lt;CallInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>), ModifiedDT);</div>
<div class="line"><a name="l08181"></a><span class="lineno"> 8181</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Instruction::Select</a>:</div>
<div class="line"><a name="l08182"></a><span class="lineno"> 8182</span>&#160;    <span class="keywordflow">return</span> optimizeSelectInst(cast&lt;SelectInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</div>
<div class="line"><a name="l08183"></a><span class="lineno"> 8183</span>&#160;  <span class="keywordflow">case</span> Instruction::ShuffleVector:</div>
<div class="line"><a name="l08184"></a><span class="lineno"> 8184</span>&#160;    <span class="keywordflow">return</span> optimizeShuffleVectorInst(cast&lt;ShuffleVectorInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</div>
<div class="line"><a name="l08185"></a><span class="lineno"> 8185</span>&#160;  <span class="keywordflow">case</span> Instruction::Switch:</div>
<div class="line"><a name="l08186"></a><span class="lineno"> 8186</span>&#160;    <span class="keywordflow">return</span> optimizeSwitchInst(cast&lt;SwitchInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</div>
<div class="line"><a name="l08187"></a><span class="lineno"> 8187</span>&#160;  <span class="keywordflow">case</span> Instruction::ExtractElement:</div>
<div class="line"><a name="l08188"></a><span class="lineno"> 8188</span>&#160;    <span class="keywordflow">return</span> optimizeExtractElementInst(cast&lt;ExtractElementInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</div>
<div class="line"><a name="l08189"></a><span class="lineno"> 8189</span>&#160;  <span class="keywordflow">case</span> Instruction::Br:</div>
<div class="line"><a name="l08190"></a><span class="lineno"> 8190</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="CodeGenPrepare_8cpp.html#ad2bfc3e2f7b1661868517e662ac7496c">optimizeBranch</a>(cast&lt;BranchInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>), *TLI, FreshBBs, IsHugeFunc);</div>
<div class="line"><a name="l08191"></a><span class="lineno"> 8191</span>&#160;  }</div>
<div class="line"><a name="l08192"></a><span class="lineno"> 8192</span>&#160; </div>
<div class="line"><a name="l08193"></a><span class="lineno"> 8193</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l08194"></a><span class="lineno"> 8194</span>&#160;}</div>
<div class="line"><a name="l08195"></a><span class="lineno"> 8195</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l08196"></a><span class="lineno"> 8196</span>&#160;<span class="comment">/// Given an OR instruction, check to see if this is a bitreverse</span></div>
<div class="line"><a name="l08197"></a><span class="lineno"> 8197</span>&#160;<span class="comment">/// idiom. If so, insert the new intrinsic and return true.</span></div>
<div class="line"><a name="l08198"></a><span class="lineno"> 8198</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CodeGenPrepare::makeBitReverse(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l08199"></a><span class="lineno"> 8199</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType()-&gt;isIntegerTy() ||</div>
<div class="line"><a name="l08200"></a><span class="lineno"> 8200</span>&#160;      !TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#aa93fbbc66d52a51d178af8ac4398ec05">isOperationLegalOrCustom</a>(<a class="code" href="namespacellvm_1_1ISD.html#a22ea9cec080dd5f4f47ba234c2f59110aeea401cc0b7fa5aa6f4d3a0612140e1d">ISD::BITREVERSE</a>,</div>
<div class="line"><a name="l08201"></a><span class="lineno"> 8201</span>&#160;                                     TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a126c61d55fb4d2e509537ce68e8b6400">getValueType</a>(*<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType(), <span class="keyword">true</span>)))</div>
<div class="line"><a name="l08202"></a><span class="lineno"> 8202</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l08203"></a><span class="lineno"> 8203</span>&#160; </div>
<div class="line"><a name="l08204"></a><span class="lineno"> 8204</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 4&gt;</a> Insts;</div>
<div class="line"><a name="l08205"></a><span class="lineno"> 8205</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#a6c402f49fa595af618c5ad1500565d92">recognizeBSwapOrBitReverseIdiom</a>(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="keyword">false</span>, <span class="keyword">true</span>, Insts))</div>
<div class="line"><a name="l08206"></a><span class="lineno"> 8206</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l08207"></a><span class="lineno"> 8207</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *LastInst = Insts.back();</div>
<div class="line"><a name="l08208"></a><span class="lineno"> 8208</span>&#160;  <a class="code" href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a>(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, LastInst, FreshBBs, IsHugeFunc);</div>
<div class="line"><a name="l08209"></a><span class="lineno"> 8209</span>&#160;  <a class="code" href="namespacellvm.html#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(</div>
<div class="line"><a name="l08210"></a><span class="lineno"> 8210</span>&#160;      &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, TLInfo, <span class="keyword">nullptr</span>,</div>
<div class="line"><a name="l08211"></a><span class="lineno"> 8211</span>&#160;      [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) { removeAllAssertingVHReferences(V); });</div>
<div class="line"><a name="l08212"></a><span class="lineno"> 8212</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l08213"></a><span class="lineno"> 8213</span>&#160;}</div>
<div class="line"><a name="l08214"></a><span class="lineno"> 8214</span>&#160; </div>
<div class="line"><a name="l08215"></a><span class="lineno"> 8215</span>&#160;<span class="comment">// In this pass we look for GEP and cast instructions that are used</span></div>
<div class="line"><a name="l08216"></a><span class="lineno"> 8216</span>&#160;<span class="comment">// across basic blocks and rewrite them to improve basic-block-at-a-time</span></div>
<div class="line"><a name="l08217"></a><span class="lineno"> 8217</span>&#160;<span class="comment">// selection.</span></div>
<div class="line"><a name="l08218"></a><span class="lineno"> 8218</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="ScalarizeMaskedMemIntrin_8cpp.html#a8f3425131aae6ea2275a052284a7c2dc">CodeGenPrepare::optimizeBlock</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> &amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, ModifyDT &amp;ModifiedDT) {</div>
<div class="line"><a name="l08219"></a><span class="lineno"> 8219</span>&#160;  SunkAddrs.<a class="code" href="classllvm_1_1ValueMap.html#a49dc44e6a66de10991ee34e1df0d8065">clear</a>();</div>
<div class="line"><a name="l08220"></a><span class="lineno"> 8220</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div>
<div class="line"><a name="l08221"></a><span class="lineno"> 8221</span>&#160; </div>
<div class="line"><a name="l08222"></a><span class="lineno"> 8222</span>&#160;  <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l08223"></a><span class="lineno"> 8223</span>&#160;    CurInstIterator = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>.begin();</div>
<div class="line"><a name="l08224"></a><span class="lineno"> 8224</span>&#160;    ModifiedDT = ModifyDT::NotModifyDT;</div>
<div class="line"><a name="l08225"></a><span class="lineno"> 8225</span>&#160;    <span class="keywordflow">while</span> (CurInstIterator != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>.end()) {</div>
<div class="line"><a name="l08226"></a><span class="lineno"> 8226</span>&#160;      MadeChange |= optimizeInst(&amp;*CurInstIterator++, ModifiedDT);</div>
<div class="line"><a name="l08227"></a><span class="lineno"> 8227</span>&#160;      <span class="keywordflow">if</span> (ModifiedDT != ModifyDT::NotModifyDT) {</div>
<div class="line"><a name="l08228"></a><span class="lineno"> 8228</span>&#160;        <span class="comment">// For huge function we tend to quickly go though the inner optmization</span></div>
<div class="line"><a name="l08229"></a><span class="lineno"> 8229</span>&#160;        <span class="comment">// opportunities in the BB. So we go back to the BB head to re-optimize</span></div>
<div class="line"><a name="l08230"></a><span class="lineno"> 8230</span>&#160;        <span class="comment">// each instruction instead of go back to the function head.</span></div>
<div class="line"><a name="l08231"></a><span class="lineno"> 8231</span>&#160;        <span class="keywordflow">if</span> (IsHugeFunc) {</div>
<div class="line"><a name="l08232"></a><span class="lineno"> 8232</span>&#160;          DT.reset();</div>
<div class="line"><a name="l08233"></a><span class="lineno"> 8233</span>&#160;          getDT(*<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>.getParent());</div>
<div class="line"><a name="l08234"></a><span class="lineno"> 8234</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l08235"></a><span class="lineno"> 8235</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l08236"></a><span class="lineno"> 8236</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l08237"></a><span class="lineno"> 8237</span>&#160;        }</div>
<div class="line"><a name="l08238"></a><span class="lineno"> 8238</span>&#160;      }</div>
<div class="line"><a name="l08239"></a><span class="lineno"> 8239</span>&#160;    }</div>
<div class="line"><a name="l08240"></a><span class="lineno"> 8240</span>&#160;  } <span class="keywordflow">while</span> (ModifiedDT == ModifyDT::ModifyInstDT);</div>
<div class="line"><a name="l08241"></a><span class="lineno"> 8241</span>&#160; </div>
<div class="line"><a name="l08242"></a><span class="lineno"> 8242</span>&#160;  <span class="keywordtype">bool</span> MadeBitReverse = <span class="keyword">true</span>;</div>
<div class="line"><a name="l08243"></a><span class="lineno"> 8243</span>&#160;  <span class="keywordflow">while</span> (MadeBitReverse) {</div>
<div class="line"><a name="l08244"></a><span class="lineno"> 8244</span>&#160;    MadeBitReverse = <span class="keyword">false</span>;</div>
<div class="line"><a name="l08245"></a><span class="lineno"> 8245</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="namespacellvm.html#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)) {</div>
<div class="line"><a name="l08246"></a><span class="lineno"> 8246</span>&#160;      <span class="keywordflow">if</span> (makeBitReverse(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l08247"></a><span class="lineno"> 8247</span>&#160;        MadeBitReverse = MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l08248"></a><span class="lineno"> 8248</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l08249"></a><span class="lineno"> 8249</span>&#160;      }</div>
<div class="line"><a name="l08250"></a><span class="lineno"> 8250</span>&#160;    }</div>
<div class="line"><a name="l08251"></a><span class="lineno"> 8251</span>&#160;  }</div>
<div class="line"><a name="l08252"></a><span class="lineno"> 8252</span>&#160;  MadeChange |= dupRetToEnableTailCallOpts(&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, ModifiedDT);</div>
<div class="line"><a name="l08253"></a><span class="lineno"> 8253</span>&#160; </div>
<div class="line"><a name="l08254"></a><span class="lineno"> 8254</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div>
<div class="line"><a name="l08255"></a><span class="lineno"> 8255</span>&#160;}</div>
<div class="line"><a name="l08256"></a><span class="lineno"> 8256</span>&#160; </div>
<div class="line"><a name="l08257"></a><span class="lineno"> 8257</span>&#160;<span class="comment">// Some CGP optimizations may move or alter what&#39;s computed in a block. Check</span></div>
<div class="line"><a name="l08258"></a><span class="lineno"> 8258</span>&#160;<span class="comment">// whether a dbg.value intrinsic could be pointed at a more appropriate operand.</span></div>
<div class="line"><a name="l08259"></a><span class="lineno"> 8259</span>&#160;<span class="keywordtype">bool</span> CodeGenPrepare::fixupDbgValue(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l08260"></a><span class="lineno"> 8260</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isa&lt;DbgValueInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</div>
<div class="line"><a name="l08261"></a><span class="lineno"> 8261</span>&#160;  <a class="code" href="classllvm_1_1DbgValueInst.html">DbgValueInst</a> &amp;DVI = *cast&lt;DbgValueInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l08262"></a><span class="lineno"> 8262</span>&#160; </div>
<div class="line"><a name="l08263"></a><span class="lineno"> 8263</span>&#160;  <span class="comment">// Does this dbg.value refer to a sunk address calculation?</span></div>
<div class="line"><a name="l08264"></a><span class="lineno"> 8264</span>&#160;  <span class="keywordtype">bool</span> AnyChange = <span class="keyword">false</span>;</div>
<div class="line"><a name="l08265"></a><span class="lineno"> 8265</span>&#160;  <a class="code" href="classllvm_1_1SmallDenseSet.html">SmallDenseSet&lt;Value *&gt;</a> LocationOps(DVI.<a class="code" href="classllvm_1_1DbgVariableIntrinsic.html#a948d39166dc97e354adf799ec62a218a">location_ops</a>().begin(),</div>
<div class="line"><a name="l08266"></a><span class="lineno"> 8266</span>&#160;                                     DVI.<a class="code" href="classllvm_1_1DbgVariableIntrinsic.html#a948d39166dc97e354adf799ec62a218a">location_ops</a>().end());</div>
<div class="line"><a name="l08267"></a><span class="lineno"> 8267</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *Location : LocationOps) {</div>
<div class="line"><a name="l08268"></a><span class="lineno"> 8268</span>&#160;    <a class="code" href="classllvm_1_1WeakTrackingVH.html">WeakTrackingVH</a> SunkAddrVH = SunkAddrs[<a class="code" href="namespacellvm_1_1logicalview.html#a9696bc411b0a7022c2cc78bff5173ceface5bf551379459c1c61d2a204061c455">Location</a>];</div>
<div class="line"><a name="l08269"></a><span class="lineno"> 8269</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *SunkAddr = SunkAddrVH.<a class="code" href="classllvm_1_1WeakTrackingVH.html#aed2f94ba7ecd4983f2c811f0d01f1398">pointsToAliveValue</a>() ? SunkAddrVH : <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l08270"></a><span class="lineno"> 8270</span>&#160;    <span class="keywordflow">if</span> (SunkAddr) {</div>
<div class="line"><a name="l08271"></a><span class="lineno"> 8271</span>&#160;      <span class="comment">// Point dbg.value at locally computed address, which should give the best</span></div>
<div class="line"><a name="l08272"></a><span class="lineno"> 8272</span>&#160;      <span class="comment">// opportunity to be accurately lowered. This update may change the type</span></div>
<div class="line"><a name="l08273"></a><span class="lineno"> 8273</span>&#160;      <span class="comment">// of pointer being referred to; however this makes no difference to</span></div>
<div class="line"><a name="l08274"></a><span class="lineno"> 8274</span>&#160;      <span class="comment">// debugging information, and we can&#39;t generate bitcasts that may affect</span></div>
<div class="line"><a name="l08275"></a><span class="lineno"> 8275</span>&#160;      <span class="comment">// codegen.</span></div>
<div class="line"><a name="l08276"></a><span class="lineno"> 8276</span>&#160;      DVI.<a class="code" href="classllvm_1_1DbgVariableIntrinsic.html#a212fcbee3e65ec41eebed2525fc15207">replaceVariableLocationOp</a>(Location, SunkAddr);</div>
<div class="line"><a name="l08277"></a><span class="lineno"> 8277</span>&#160;      AnyChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l08278"></a><span class="lineno"> 8278</span>&#160;    }</div>
<div class="line"><a name="l08279"></a><span class="lineno"> 8279</span>&#160;  }</div>
<div class="line"><a name="l08280"></a><span class="lineno"> 8280</span>&#160;  <span class="keywordflow">return</span> AnyChange;</div>
<div class="line"><a name="l08281"></a><span class="lineno"> 8281</span>&#160;}</div>
<div class="line"><a name="l08282"></a><span class="lineno"> 8282</span>&#160; </div>
<div class="line"><a name="l08283"></a><span class="lineno"> 8283</span>&#160;<span class="comment">// A llvm.dbg.value may be using a value before its definition, due to</span></div>
<div class="line"><a name="l08284"></a><span class="lineno"> 8284</span>&#160;<span class="comment">// optimizations in this pass and others. Scan for such dbg.values, and rescue</span></div>
<div class="line"><a name="l08285"></a><span class="lineno"> 8285</span>&#160;<span class="comment">// them by moving the dbg.value to immediately after the value definition.</span></div>
<div class="line"><a name="l08286"></a><span class="lineno"> 8286</span>&#160;<span class="comment">// FIXME: Ideally this should never be necessary, and this has the potential</span></div>
<div class="line"><a name="l08287"></a><span class="lineno"> 8287</span>&#160;<span class="comment">// to re-order dbg.value intrinsics.</span></div>
<div class="line"><a name="l08288"></a><span class="lineno"> 8288</span>&#160;<span class="keywordtype">bool</span> CodeGenPrepare::placeDbgValues(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l08289"></a><span class="lineno"> 8289</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div>
<div class="line"><a name="l08290"></a><span class="lineno"> 8290</span>&#160;  <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> DT(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l08291"></a><span class="lineno"> 8291</span>&#160; </div>
<div class="line"><a name="l08292"></a><span class="lineno"> 8292</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> &amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> : <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l08293"></a><span class="lineno"> 8293</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="AArch64MIPeepholeOpt_8cpp.html#a96d5dc120196819fbfbc257cba09b2aa">Insn</a> : <a class="code" href="namespacellvm.html#a8154638df88e4eaa568b67b23d463dac">llvm::make_early_inc_range</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)) {</div>
<div class="line"><a name="l08294"></a><span class="lineno"> 8294</span>&#160;      <a class="code" href="classllvm_1_1DbgValueInst.html">DbgValueInst</a> *DVI = dyn_cast&lt;DbgValueInst&gt;(&amp;<a class="code" href="AArch64MIPeepholeOpt_8cpp.html#a96d5dc120196819fbfbc257cba09b2aa">Insn</a>);</div>
<div class="line"><a name="l08295"></a><span class="lineno"> 8295</span>&#160;      <span class="keywordflow">if</span> (!DVI)</div>
<div class="line"><a name="l08296"></a><span class="lineno"> 8296</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08297"></a><span class="lineno"> 8297</span>&#160; </div>
<div class="line"><a name="l08298"></a><span class="lineno"> 8298</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 4&gt;</a> VIs;</div>
<div class="line"><a name="l08299"></a><span class="lineno"> 8299</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : DVI-&gt;<a class="code" href="classllvm_1_1DbgValueInst.html#a40b1c4efd724f09e373c07ea2d2991c1">getValues</a>())</div>
<div class="line"><a name="l08300"></a><span class="lineno"> 8300</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a> = dyn_cast_or_null&lt;Instruction&gt;(V))</div>
<div class="line"><a name="l08301"></a><span class="lineno"> 8301</span>&#160;          VIs.push_back(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>);</div>
<div class="line"><a name="l08302"></a><span class="lineno"> 8302</span>&#160; </div>
<div class="line"><a name="l08303"></a><span class="lineno"> 8303</span>&#160;      <span class="comment">// This DVI may depend on multiple instructions, complicating any</span></div>
<div class="line"><a name="l08304"></a><span class="lineno"> 8304</span>&#160;      <span class="comment">// potential sink. This block takes the defensive approach, opting to</span></div>
<div class="line"><a name="l08305"></a><span class="lineno"> 8305</span>&#160;      <span class="comment">// &quot;undef&quot; the DVI if it has more than one instruction and any of them do</span></div>
<div class="line"><a name="l08306"></a><span class="lineno"> 8306</span>&#160;      <span class="comment">// not dominate DVI.</span></div>
<div class="line"><a name="l08307"></a><span class="lineno"> 8307</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a> : VIs) {</div>
<div class="line"><a name="l08308"></a><span class="lineno"> 8308</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>-&gt;isTerminator())</div>
<div class="line"><a name="l08309"></a><span class="lineno"> 8309</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08310"></a><span class="lineno"> 8310</span>&#160; </div>
<div class="line"><a name="l08311"></a><span class="lineno"> 8311</span>&#160;        <span class="comment">// If VI is a phi in a block with an EHPad terminator, we can&#39;t insert</span></div>
<div class="line"><a name="l08312"></a><span class="lineno"> 8312</span>&#160;        <span class="comment">// after it.</span></div>
<div class="line"><a name="l08313"></a><span class="lineno"> 8313</span>&#160;        <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>) &amp;&amp; <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>-&gt;getParent()-&gt;getTerminator()-&gt;isEHPad())</div>
<div class="line"><a name="l08314"></a><span class="lineno"> 8314</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08315"></a><span class="lineno"> 8315</span>&#160; </div>
<div class="line"><a name="l08316"></a><span class="lineno"> 8316</span>&#160;        <span class="comment">// If the defining instruction dominates the dbg.value, we do not need</span></div>
<div class="line"><a name="l08317"></a><span class="lineno"> 8317</span>&#160;        <span class="comment">// to move the dbg.value.</span></div>
<div class="line"><a name="l08318"></a><span class="lineno"> 8318</span>&#160;        <span class="keywordflow">if</span> (DT.dominates(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>, DVI))</div>
<div class="line"><a name="l08319"></a><span class="lineno"> 8319</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08320"></a><span class="lineno"> 8320</span>&#160; </div>
<div class="line"><a name="l08321"></a><span class="lineno"> 8321</span>&#160;        <span class="comment">// If we depend on multiple instructions and any of them doesn&#39;t</span></div>
<div class="line"><a name="l08322"></a><span class="lineno"> 8322</span>&#160;        <span class="comment">// dominate this DVI, we probably can&#39;t salvage it: moving it to</span></div>
<div class="line"><a name="l08323"></a><span class="lineno"> 8323</span>&#160;        <span class="comment">// after any of the instructions could cause us to lose the others.</span></div>
<div class="line"><a name="l08324"></a><span class="lineno"> 8324</span>&#160;        <span class="keywordflow">if</span> (VIs.size() &gt; 1) {</div>
<div class="line"><a name="l08325"></a><span class="lineno"> 8325</span>&#160;          <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(</div>
<div class="line"><a name="l08326"></a><span class="lineno"> 8326</span>&#160;              <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</div>
<div class="line"><a name="l08327"></a><span class="lineno"> 8327</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;Unable to find valid location for Debug Value, undefing:\n&quot;</span></div>
<div class="line"><a name="l08328"></a><span class="lineno"> 8328</span>&#160;              &lt;&lt; *DVI);</div>
<div class="line"><a name="l08329"></a><span class="lineno"> 8329</span>&#160;          DVI-&gt;<a class="code" href="classllvm_1_1DbgVariableIntrinsic.html#aaf2539583fcfa83b3ecdfc1fea52cff6">setKillLocation</a>();</div>
<div class="line"><a name="l08330"></a><span class="lineno"> 8330</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l08331"></a><span class="lineno"> 8331</span>&#160;        }</div>
<div class="line"><a name="l08332"></a><span class="lineno"> 8332</span>&#160; </div>
<div class="line"><a name="l08333"></a><span class="lineno"> 8333</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Moving Debug Value before :\n&quot;</span></div>
<div class="line"><a name="l08334"></a><span class="lineno"> 8334</span>&#160;                          &lt;&lt; *DVI &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>);</div>
<div class="line"><a name="l08335"></a><span class="lineno"> 8335</span>&#160;        DVI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a0fd53f63d349dc8a7c5fc0cdd7a94c8d">removeFromParent</a>();</div>
<div class="line"><a name="l08336"></a><span class="lineno"> 8336</span>&#160;        <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>))</div>
<div class="line"><a name="l08337"></a><span class="lineno"> 8337</span>&#160;          DVI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(&amp;*<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>-&gt;getParent()-&gt;getFirstInsertionPt());</div>
<div class="line"><a name="l08338"></a><span class="lineno"> 8338</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l08339"></a><span class="lineno"> 8339</span>&#160;          DVI-&gt;<a class="code" href="classllvm_1_1Instruction.html#af09e4096de244d2fb345891328714a63">insertAfter</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>);</div>
<div class="line"><a name="l08340"></a><span class="lineno"> 8340</span>&#160;        MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l08341"></a><span class="lineno"> 8341</span>&#160;        ++NumDbgValueMoved;</div>
<div class="line"><a name="l08342"></a><span class="lineno"> 8342</span>&#160;      }</div>
<div class="line"><a name="l08343"></a><span class="lineno"> 8343</span>&#160;    }</div>
<div class="line"><a name="l08344"></a><span class="lineno"> 8344</span>&#160;  }</div>
<div class="line"><a name="l08345"></a><span class="lineno"> 8345</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div>
<div class="line"><a name="l08346"></a><span class="lineno"> 8346</span>&#160;}</div>
<div class="line"><a name="l08347"></a><span class="lineno"> 8347</span>&#160; </div>
<div class="line"><a name="l08348"></a><span class="lineno"> 8348</span>&#160;<span class="comment">// Group scattered pseudo probes in a block to favor SelectionDAG. Scattered</span></div>
<div class="line"><a name="l08349"></a><span class="lineno"> 8349</span>&#160;<span class="comment">// probes can be chained dependencies of other regular DAG nodes and block DAG</span></div>
<div class="line"><a name="l08350"></a><span class="lineno"> 8350</span>&#160;<span class="comment">// combine optimizations.</span></div>
<div class="line"><a name="l08351"></a><span class="lineno"> 8351</span>&#160;<span class="keywordtype">bool</span> CodeGenPrepare::placePseudoProbes(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l08352"></a><span class="lineno"> 8352</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div>
<div class="line"><a name="l08353"></a><span class="lineno"> 8353</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Block : <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l08354"></a><span class="lineno"> 8354</span>&#160;    <span class="comment">// Move the rest probes to the beginning of the block.</span></div>
<div class="line"><a name="l08355"></a><span class="lineno"> 8355</span>&#160;    <span class="keyword">auto</span> FirstInst = <a class="code" href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>.getFirstInsertionPt();</div>
<div class="line"><a name="l08356"></a><span class="lineno"> 8356</span>&#160;    <span class="keywordflow">while</span> (FirstInst != <a class="code" href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>.end() &amp;&amp; FirstInst-&gt;isDebugOrPseudoInst())</div>
<div class="line"><a name="l08357"></a><span class="lineno"> 8357</span>&#160;      ++FirstInst;</div>
<div class="line"><a name="l08358"></a><span class="lineno"> 8358</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>(FirstInst);</div>
<div class="line"><a name="l08359"></a><span class="lineno"> 8359</span>&#160;    <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++;</div>
<div class="line"><a name="l08360"></a><span class="lineno"> 8360</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>.end()) {</div>
<div class="line"><a name="l08361"></a><span class="lineno"> 8361</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *II = dyn_cast&lt;PseudoProbeInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++)) {</div>
<div class="line"><a name="l08362"></a><span class="lineno"> 8362</span>&#160;        II-&gt;<a class="code" href="classllvm_1_1Instruction.html#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(&amp;*FirstInst);</div>
<div class="line"><a name="l08363"></a><span class="lineno"> 8363</span>&#160;        MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l08364"></a><span class="lineno"> 8364</span>&#160;      }</div>
<div class="line"><a name="l08365"></a><span class="lineno"> 8365</span>&#160;    }</div>
<div class="line"><a name="l08366"></a><span class="lineno"> 8366</span>&#160;  }</div>
<div class="line"><a name="l08367"></a><span class="lineno"> 8367</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div>
<div class="line"><a name="l08368"></a><span class="lineno"> 8368</span>&#160;}</div>
<div class="line"><a name="l08369"></a><span class="lineno"> 8369</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l08370"></a><span class="lineno"> 8370</span>&#160;<span class="comment">/// Scale down both weights to fit into uint32_t.</span></div>
<div class="line"><a name="l08371"></a><span class="lineno"><a class="line" href="CodeGenPrepare_8cpp.html#a25c5d0cb41bbb1777e779a8da35e7bd4"> 8371</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="CodeGenPrepare_8cpp.html#a25c5d0cb41bbb1777e779a8da35e7bd4">scaleWeights</a>(<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> &amp;NewTrue, <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> &amp;NewFalse) {</div>
<div class="line"><a name="l08372"></a><span class="lineno"> 8372</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> NewMax = (NewTrue &gt; NewFalse) ? NewTrue : NewFalse;</div>
<div class="line"><a name="l08373"></a><span class="lineno"> 8373</span>&#160;  <a class="code" href="classuint32__t.html">uint32_t</a> Scale = (NewMax / <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::numeric_limits&lt;uint32_t&gt;::max</a>()) + 1;</div>
<div class="line"><a name="l08374"></a><span class="lineno"> 8374</span>&#160;  NewTrue = NewTrue / Scale;</div>
<div class="line"><a name="l08375"></a><span class="lineno"> 8375</span>&#160;  NewFalse = NewFalse / Scale;</div>
<div class="line"><a name="l08376"></a><span class="lineno"> 8376</span>&#160;}</div>
<div class="line"><a name="l08377"></a><span class="lineno"> 8377</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l08378"></a><span class="lineno"> 8378</span>&#160;<span class="comment">/// Some targets prefer to split a conditional branch like:</span></div>
<div class="line"><a name="l08379"></a><span class="lineno"> 8379</span>&#160;<span class="comment">/// \code</span></div>
<div class="line"><a name="l08380"></a><span class="lineno"> 8380</span>&#160;<span class="comment">///   %0 = icmp ne i32 %a, 0</span></div>
<div class="line"><a name="l08381"></a><span class="lineno"> 8381</span>&#160;<span class="comment">///   %1 = icmp ne i32 %b, 0</span></div>
<div class="line"><a name="l08382"></a><span class="lineno"> 8382</span>&#160;<span class="comment">///   %or.cond = or i1 %0, %1</span></div>
<div class="line"><a name="l08383"></a><span class="lineno"> 8383</span>&#160;<span class="comment">///   br i1 %or.cond, label %TrueBB, label %FalseBB</span></div>
<div class="line"><a name="l08384"></a><span class="lineno"> 8384</span>&#160;<span class="comment">/// \endcode</span></div>
<div class="line"><a name="l08385"></a><span class="lineno"> 8385</span>&#160;<span class="comment">/// into multiple branch instructions like:</span></div>
<div class="line"><a name="l08386"></a><span class="lineno"> 8386</span>&#160;<span class="comment">/// \code</span></div>
<div class="line"><a name="l08387"></a><span class="lineno"> 8387</span>&#160;<span class="comment">///   bb1:</span></div>
<div class="line"><a name="l08388"></a><span class="lineno"> 8388</span>&#160;<span class="comment">///     %0 = icmp ne i32 %a, 0</span></div>
<div class="line"><a name="l08389"></a><span class="lineno"> 8389</span>&#160;<span class="comment">///     br i1 %0, label %TrueBB, label %bb2</span></div>
<div class="line"><a name="l08390"></a><span class="lineno"> 8390</span>&#160;<span class="comment">///   bb2:</span></div>
<div class="line"><a name="l08391"></a><span class="lineno"> 8391</span>&#160;<span class="comment">///     %1 = icmp ne i32 %b, 0</span></div>
<div class="line"><a name="l08392"></a><span class="lineno"> 8392</span>&#160;<span class="comment">///     br i1 %1, label %TrueBB, label %FalseBB</span></div>
<div class="line"><a name="l08393"></a><span class="lineno"> 8393</span>&#160;<span class="comment">/// \endcode</span></div>
<div class="line"><a name="l08394"></a><span class="lineno"> 8394</span>&#160;<span class="comment">/// This usually allows instruction selection to do even further optimizations</span></div>
<div class="line"><a name="l08395"></a><span class="lineno"> 8395</span>&#160;<span class="comment">/// and combine the compare with the branch instruction. Currently this is</span></div>
<div class="line"><a name="l08396"></a><span class="lineno"> 8396</span>&#160;<span class="comment">/// applied for targets which have &quot;cheap&quot; jump instructions.</span></div>
<div class="line"><a name="l08397"></a><span class="lineno"> 8397</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l08398"></a><span class="lineno"> 8398</span>&#160;<span class="comment">/// FIXME: Remove the (equivalent?) implementation in SelectionDAG.</span></div>
<div class="line"><a name="l08399"></a><span class="lineno"> 8399</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l08400"></a><span class="lineno"> 8400</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> CodeGenPrepare::splitBranchCondition(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, ModifyDT &amp;ModifiedDT) {</div>
<div class="line"><a name="l08401"></a><span class="lineno"> 8401</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="PassBuilderBindings_8cpp.html#ab76052bb166c65901edb603a3e1f03ab">TM</a>-&gt;Options.EnableFastISel || TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#a43ab2c6c81d610b0225c3d301dd4bd4c">isJumpExpensive</a>())</div>
<div class="line"><a name="l08402"></a><span class="lineno"> 8402</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l08403"></a><span class="lineno"> 8403</span>&#160; </div>
<div class="line"><a name="l08404"></a><span class="lineno"> 8404</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div>
<div class="line"><a name="l08405"></a><span class="lineno"> 8405</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> : <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l08406"></a><span class="lineno"> 8406</span>&#160;    <span class="comment">// Does this BB end with the following?</span></div>
<div class="line"><a name="l08407"></a><span class="lineno"> 8407</span>&#160;    <span class="comment">//   %cond1 = icmp|fcmp|binary instruction ...</span></div>
<div class="line"><a name="l08408"></a><span class="lineno"> 8408</span>&#160;    <span class="comment">//   %cond2 = icmp|fcmp|binary instruction ...</span></div>
<div class="line"><a name="l08409"></a><span class="lineno"> 8409</span>&#160;    <span class="comment">//   %cond.or = or|and i1 %cond1, cond2</span></div>
<div class="line"><a name="l08410"></a><span class="lineno"> 8410</span>&#160;    <span class="comment">//   br i1 %cond.or label %dest1, label %dest2&quot;</span></div>
<div class="line"><a name="l08411"></a><span class="lineno"> 8411</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *LogicOp;</div>
<div class="line"><a name="l08412"></a><span class="lineno"> 8412</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="RISCVRedundantCopyElimination_8cpp.html#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, *FBB;</div>
<div class="line"><a name="l08413"></a><span class="lineno"> 8413</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>.getTerminator(),</div>
<div class="line"><a name="l08414"></a><span class="lineno"> 8414</span>&#160;               <a class="code" href="namespacellvm_1_1PatternMatch.html#a4fd27a44c5fd9958fdd9150622129cd3">m_Br</a>(<a class="code" href="namespacellvm_1_1MIPatternMatch.html#adaaea0309983a4c327ced82a739cf1c4">m_OneUse</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a04353aa48874f9bda89ff9059cd1a5a6">m_Instruction</a>(LogicOp)), <a class="code" href="RISCVRedundantCopyElimination_8cpp.html#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, FBB)))</div>
<div class="line"><a name="l08415"></a><span class="lineno"> 8415</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08416"></a><span class="lineno"> 8416</span>&#160; </div>
<div class="line"><a name="l08417"></a><span class="lineno"> 8417</span>&#160;    <span class="keyword">auto</span> *Br1 = cast&lt;BranchInst&gt;(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>.getTerminator());</div>
<div class="line"><a name="l08418"></a><span class="lineno"> 8418</span>&#160;    <span class="keywordflow">if</span> (Br1-&gt;getMetadata(LLVMContext::MD_unpredictable))</div>
<div class="line"><a name="l08419"></a><span class="lineno"> 8419</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08420"></a><span class="lineno"> 8420</span>&#160; </div>
<div class="line"><a name="l08421"></a><span class="lineno"> 8421</span>&#160;    <span class="comment">// The merging of mostly empty BB can cause a degenerate branch.</span></div>
<div class="line"><a name="l08422"></a><span class="lineno"> 8422</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="RISCVRedundantCopyElimination_8cpp.html#a1441f79530bc7f3a89118bb8067eac69">TBB</a> == FBB)</div>
<div class="line"><a name="l08423"></a><span class="lineno"> 8423</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08424"></a><span class="lineno"> 8424</span>&#160; </div>
<div class="line"><a name="l08425"></a><span class="lineno"> 8425</span>&#160;    <span class="keywordtype">unsigned</span> Opc;</div>
<div class="line"><a name="l08426"></a><span class="lineno"> 8426</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Cond1, *Cond2;</div>
<div class="line"><a name="l08427"></a><span class="lineno"> 8427</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(LogicOp,</div>
<div class="line"><a name="l08428"></a><span class="lineno"> 8428</span>&#160;              <a class="code" href="namespacellvm_1_1PatternMatch.html#a213e6c0ca6e838157373b9a6018c0769">m_LogicalAnd</a>(<a class="code" href="namespacellvm_1_1MIPatternMatch.html#adaaea0309983a4c327ced82a739cf1c4">m_OneUse</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(Cond1)), <a class="code" href="namespacellvm_1_1MIPatternMatch.html#adaaea0309983a4c327ced82a739cf1c4">m_OneUse</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(Cond2)))))</div>
<div class="line"><a name="l08429"></a><span class="lineno"> 8429</span>&#160;      Opc = Instruction::And;</div>
<div class="line"><a name="l08430"></a><span class="lineno"> 8430</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(LogicOp, <a class="code" href="namespacellvm_1_1PatternMatch.html#a1a06b1cff93069d7403ea03e6150e386">m_LogicalOr</a>(<a class="code" href="namespacellvm_1_1MIPatternMatch.html#adaaea0309983a4c327ced82a739cf1c4">m_OneUse</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(Cond1)),</div>
<div class="line"><a name="l08431"></a><span class="lineno"> 8431</span>&#160;                                        <a class="code" href="namespacellvm_1_1MIPatternMatch.html#adaaea0309983a4c327ced82a739cf1c4">m_OneUse</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(Cond2)))))</div>
<div class="line"><a name="l08432"></a><span class="lineno"> 8432</span>&#160;      Opc = Instruction::Or;</div>
<div class="line"><a name="l08433"></a><span class="lineno"> 8433</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l08434"></a><span class="lineno"> 8434</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08435"></a><span class="lineno"> 8435</span>&#160; </div>
<div class="line"><a name="l08436"></a><span class="lineno"> 8436</span>&#160;    <span class="keyword">auto</span> IsGoodCond = [](<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>) {</div>
<div class="line"><a name="l08437"></a><span class="lineno"> 8437</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(</div>
<div class="line"><a name="l08438"></a><span class="lineno"> 8438</span>&#160;          <a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>,</div>
<div class="line"><a name="l08439"></a><span class="lineno"> 8439</span>&#160;          <a class="code" href="namespacellvm_1_1PatternMatch.html#af4feec45578e32fe65d8efc59112bc8e">m_CombineOr</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a753e1338645ec04d045211b8a46d968d">m_Cmp</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#af4feec45578e32fe65d8efc59112bc8e">m_CombineOr</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a213e6c0ca6e838157373b9a6018c0769">m_LogicalAnd</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>()),</div>
<div class="line"><a name="l08440"></a><span class="lineno"> 8440</span>&#160;                                           <a class="code" href="namespacellvm_1_1PatternMatch.html#a1a06b1cff93069d7403ea03e6150e386">m_LogicalOr</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>()))));</div>
<div class="line"><a name="l08441"></a><span class="lineno"> 8441</span>&#160;    };</div>
<div class="line"><a name="l08442"></a><span class="lineno"> 8442</span>&#160;    <span class="keywordflow">if</span> (!IsGoodCond(Cond1) || !IsGoodCond(Cond2))</div>
<div class="line"><a name="l08443"></a><span class="lineno"> 8443</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08444"></a><span class="lineno"> 8444</span>&#160; </div>
<div class="line"><a name="l08445"></a><span class="lineno"> 8445</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Before branch condition splitting\n&quot;</span>; <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>.dump());</div>
<div class="line"><a name="l08446"></a><span class="lineno"> 8446</span>&#160; </div>
<div class="line"><a name="l08447"></a><span class="lineno"> 8447</span>&#160;    <span class="comment">// Create a new BB.</span></div>
<div class="line"><a name="l08448"></a><span class="lineno"> 8448</span>&#160;    <span class="keyword">auto</span> *TmpBB =</div>
<div class="line"><a name="l08449"></a><span class="lineno"> 8449</span>&#160;        BasicBlock::Create(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>.getContext(), <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>.getName() + <span class="stringliteral">&quot;.cond.split&quot;</span>,</div>
<div class="line"><a name="l08450"></a><span class="lineno"> 8450</span>&#160;                           <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>.getParent(), <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>.getNextNode());</div>
<div class="line"><a name="l08451"></a><span class="lineno"> 8451</span>&#160;    <span class="keywordflow">if</span> (IsHugeFunc)</div>
<div class="line"><a name="l08452"></a><span class="lineno"> 8452</span>&#160;      FreshBBs.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(TmpBB);</div>
<div class="line"><a name="l08453"></a><span class="lineno"> 8453</span>&#160; </div>
<div class="line"><a name="l08454"></a><span class="lineno"> 8454</span>&#160;    <span class="comment">// Update original basic block by using the first condition directly by the</span></div>
<div class="line"><a name="l08455"></a><span class="lineno"> 8455</span>&#160;    <span class="comment">// branch instruction and removing the no longer needed and/or instruction.</span></div>
<div class="line"><a name="l08456"></a><span class="lineno"> 8456</span>&#160;    Br1-&gt;setCondition(Cond1);</div>
<div class="line"><a name="l08457"></a><span class="lineno"> 8457</span>&#160;    LogicOp-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l08458"></a><span class="lineno"> 8458</span>&#160; </div>
<div class="line"><a name="l08459"></a><span class="lineno"> 8459</span>&#160;    <span class="comment">// Depending on the condition we have to either replace the true or the</span></div>
<div class="line"><a name="l08460"></a><span class="lineno"> 8460</span>&#160;    <span class="comment">// false successor of the original branch instruction.</span></div>
<div class="line"><a name="l08461"></a><span class="lineno"> 8461</span>&#160;    <span class="keywordflow">if</span> (Opc == Instruction::And)</div>
<div class="line"><a name="l08462"></a><span class="lineno"> 8462</span>&#160;      Br1-&gt;setSuccessor(0, TmpBB);</div>
<div class="line"><a name="l08463"></a><span class="lineno"> 8463</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l08464"></a><span class="lineno"> 8464</span>&#160;      Br1-&gt;setSuccessor(1, TmpBB);</div>
<div class="line"><a name="l08465"></a><span class="lineno"> 8465</span>&#160; </div>
<div class="line"><a name="l08466"></a><span class="lineno"> 8466</span>&#160;    <span class="comment">// Fill in the new basic block.</span></div>
<div class="line"><a name="l08467"></a><span class="lineno"> 8467</span>&#160;    <span class="keyword">auto</span> *Br2 = <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a>(TmpBB).<a class="code" href="classllvm_1_1IRBuilderBase.html#a8e9aa4e5a6d9f4480322e154153bec2b">CreateCondBr</a>(Cond2, <a class="code" href="RISCVRedundantCopyElimination_8cpp.html#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, FBB);</div>
<div class="line"><a name="l08468"></a><span class="lineno"> 8468</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(Cond2)) {</div>
<div class="line"><a name="l08469"></a><span class="lineno"> 8469</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;removeFromParent();</div>
<div class="line"><a name="l08470"></a><span class="lineno"> 8470</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;insertBefore(Br2);</div>
<div class="line"><a name="l08471"></a><span class="lineno"> 8471</span>&#160;    }</div>
<div class="line"><a name="l08472"></a><span class="lineno"> 8472</span>&#160; </div>
<div class="line"><a name="l08473"></a><span class="lineno"> 8473</span>&#160;    <span class="comment">// Update PHI nodes in both successors. The original BB needs to be</span></div>
<div class="line"><a name="l08474"></a><span class="lineno"> 8474</span>&#160;    <span class="comment">// replaced in one successor&#39;s PHI nodes, because the branch comes now from</span></div>
<div class="line"><a name="l08475"></a><span class="lineno"> 8475</span>&#160;    <span class="comment">// the newly generated BB (NewBB). In the other successor we need to add one</span></div>
<div class="line"><a name="l08476"></a><span class="lineno"> 8476</span>&#160;    <span class="comment">// incoming edge to the PHI nodes, because both branch instructions target</span></div>
<div class="line"><a name="l08477"></a><span class="lineno"> 8477</span>&#160;    <span class="comment">// now the same successor. Depending on the original branch condition</span></div>
<div class="line"><a name="l08478"></a><span class="lineno"> 8478</span>&#160;    <span class="comment">// (and/or) we have to swap the successors (TrueDest, FalseDest), so that</span></div>
<div class="line"><a name="l08479"></a><span class="lineno"> 8479</span>&#160;    <span class="comment">// we perform the correct update for the PHI nodes.</span></div>
<div class="line"><a name="l08480"></a><span class="lineno"> 8480</span>&#160;    <span class="comment">// This doesn&#39;t change the successor order of the just created branch</span></div>
<div class="line"><a name="l08481"></a><span class="lineno"> 8481</span>&#160;    <span class="comment">// instruction (or any other instruction).</span></div>
<div class="line"><a name="l08482"></a><span class="lineno"> 8482</span>&#160;    <span class="keywordflow">if</span> (Opc == Instruction::Or)</div>
<div class="line"><a name="l08483"></a><span class="lineno"> 8483</span>&#160;      <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a class="code" href="RISCVRedundantCopyElimination_8cpp.html#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, FBB);</div>
<div class="line"><a name="l08484"></a><span class="lineno"> 8484</span>&#160; </div>
<div class="line"><a name="l08485"></a><span class="lineno"> 8485</span>&#160;    <span class="comment">// Replace the old BB with the new BB.</span></div>
<div class="line"><a name="l08486"></a><span class="lineno"> 8486</span>&#160;    <a class="code" href="RISCVRedundantCopyElimination_8cpp.html#a1441f79530bc7f3a89118bb8067eac69">TBB</a>-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a134a21189d056b81b80d0cdf01ef8c46">replacePhiUsesWith</a>(&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, TmpBB);</div>
<div class="line"><a name="l08487"></a><span class="lineno"> 8487</span>&#160; </div>
<div class="line"><a name="l08488"></a><span class="lineno"> 8488</span>&#160;    <span class="comment">// Add another incoming edge from the new BB.</span></div>
<div class="line"><a name="l08489"></a><span class="lineno"> 8489</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> &amp;PN : FBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a72516971c5734dc0f7546e64affca425">phis</a>()) {</div>
<div class="line"><a name="l08490"></a><span class="lineno"> 8490</span>&#160;      <span class="keyword">auto</span> *Val = PN.<a class="code" href="classllvm_1_1PHINode.html#adfb61ffe25c950c75c86310245b3ef39">getIncomingValueForBlock</a>(&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l08491"></a><span class="lineno"> 8491</span>&#160;      PN.<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(Val, TmpBB);</div>
<div class="line"><a name="l08492"></a><span class="lineno"> 8492</span>&#160;    }</div>
<div class="line"><a name="l08493"></a><span class="lineno"> 8493</span>&#160; </div>
<div class="line"><a name="l08494"></a><span class="lineno"> 8494</span>&#160;    <span class="comment">// Update the branch weights (from SelectionDAGBuilder::</span></div>
<div class="line"><a name="l08495"></a><span class="lineno"> 8495</span>&#160;    <span class="comment">// FindMergedConditions).</span></div>
<div class="line"><a name="l08496"></a><span class="lineno"> 8496</span>&#160;    <span class="keywordflow">if</span> (Opc == Instruction::Or) {</div>
<div class="line"><a name="l08497"></a><span class="lineno"> 8497</span>&#160;      <span class="comment">// Codegen X | Y as:</span></div>
<div class="line"><a name="l08498"></a><span class="lineno"> 8498</span>&#160;      <span class="comment">// BB1:</span></div>
<div class="line"><a name="l08499"></a><span class="lineno"> 8499</span>&#160;      <span class="comment">//   jmp_if_X TBB</span></div>
<div class="line"><a name="l08500"></a><span class="lineno"> 8500</span>&#160;      <span class="comment">//   jmp TmpBB</span></div>
<div class="line"><a name="l08501"></a><span class="lineno"> 8501</span>&#160;      <span class="comment">// TmpBB:</span></div>
<div class="line"><a name="l08502"></a><span class="lineno"> 8502</span>&#160;      <span class="comment">//   jmp_if_Y TBB</span></div>
<div class="line"><a name="l08503"></a><span class="lineno"> 8503</span>&#160;      <span class="comment">//   jmp FBB</span></div>
<div class="line"><a name="l08504"></a><span class="lineno"> 8504</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l08505"></a><span class="lineno"> 8505</span>&#160; </div>
<div class="line"><a name="l08506"></a><span class="lineno"> 8506</span>&#160;      <span class="comment">// We have flexibility in setting Prob for BB1 and Prob for NewBB.</span></div>
<div class="line"><a name="l08507"></a><span class="lineno"> 8507</span>&#160;      <span class="comment">// The requirement is that</span></div>
<div class="line"><a name="l08508"></a><span class="lineno"> 8508</span>&#160;      <span class="comment">//   TrueProb for BB1 + (FalseProb for BB1 * TrueProb for TmpBB)</span></div>
<div class="line"><a name="l08509"></a><span class="lineno"> 8509</span>&#160;      <span class="comment">//     = TrueProb for original BB.</span></div>
<div class="line"><a name="l08510"></a><span class="lineno"> 8510</span>&#160;      <span class="comment">// Assuming the original weights are A and B, one choice is to set BB1&#39;s</span></div>
<div class="line"><a name="l08511"></a><span class="lineno"> 8511</span>&#160;      <span class="comment">// weights to A and A+2B, and set TmpBB&#39;s weights to A and 2B. This choice</span></div>
<div class="line"><a name="l08512"></a><span class="lineno"> 8512</span>&#160;      <span class="comment">// assumes that</span></div>
<div class="line"><a name="l08513"></a><span class="lineno"> 8513</span>&#160;      <span class="comment">//   TrueProb for BB1 == FalseProb for BB1 * TrueProb for TmpBB.</span></div>
<div class="line"><a name="l08514"></a><span class="lineno"> 8514</span>&#160;      <span class="comment">// Another choice is to assume TrueProb for BB1 equals to TrueProb for</span></div>
<div class="line"><a name="l08515"></a><span class="lineno"> 8515</span>&#160;      <span class="comment">// TmpBB, but the math is more complicated.</span></div>
<div class="line"><a name="l08516"></a><span class="lineno"> 8516</span>&#160;      <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> TrueWeight, FalseWeight;</div>
<div class="line"><a name="l08517"></a><span class="lineno"> 8517</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(*Br1, TrueWeight, FalseWeight)) {</div>
<div class="line"><a name="l08518"></a><span class="lineno"> 8518</span>&#160;        <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> NewTrueWeight = TrueWeight;</div>
<div class="line"><a name="l08519"></a><span class="lineno"> 8519</span>&#160;        <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> NewFalseWeight = TrueWeight + 2 * FalseWeight;</div>
<div class="line"><a name="l08520"></a><span class="lineno"> 8520</span>&#160;        <a class="code" href="CodeGenPrepare_8cpp.html#a25c5d0cb41bbb1777e779a8da35e7bd4">scaleWeights</a>(NewTrueWeight, NewFalseWeight);</div>
<div class="line"><a name="l08521"></a><span class="lineno"> 8521</span>&#160;        Br1-&gt;setMetadata(LLVMContext::MD_prof,</div>
<div class="line"><a name="l08522"></a><span class="lineno"> 8522</span>&#160;                         <a class="code" href="classllvm_1_1MDBuilder.html">MDBuilder</a>(Br1-&gt;getContext())</div>
<div class="line"><a name="l08523"></a><span class="lineno"> 8523</span>&#160;                             .<a class="code" href="classllvm_1_1MDBuilder.html#ad910125a9cfd76aaad7f69469df22f66">createBranchWeights</a>(TrueWeight, FalseWeight));</div>
<div class="line"><a name="l08524"></a><span class="lineno"> 8524</span>&#160; </div>
<div class="line"><a name="l08525"></a><span class="lineno"> 8525</span>&#160;        NewTrueWeight = TrueWeight;</div>
<div class="line"><a name="l08526"></a><span class="lineno"> 8526</span>&#160;        NewFalseWeight = 2 * FalseWeight;</div>
<div class="line"><a name="l08527"></a><span class="lineno"> 8527</span>&#160;        <a class="code" href="CodeGenPrepare_8cpp.html#a25c5d0cb41bbb1777e779a8da35e7bd4">scaleWeights</a>(NewTrueWeight, NewFalseWeight);</div>
<div class="line"><a name="l08528"></a><span class="lineno"> 8528</span>&#160;        Br2-&gt;setMetadata(LLVMContext::MD_prof,</div>
<div class="line"><a name="l08529"></a><span class="lineno"> 8529</span>&#160;                         <a class="code" href="classllvm_1_1MDBuilder.html">MDBuilder</a>(Br2-&gt;getContext())</div>
<div class="line"><a name="l08530"></a><span class="lineno"> 8530</span>&#160;                             .<a class="code" href="classllvm_1_1MDBuilder.html#ad910125a9cfd76aaad7f69469df22f66">createBranchWeights</a>(TrueWeight, FalseWeight));</div>
<div class="line"><a name="l08531"></a><span class="lineno"> 8531</span>&#160;      }</div>
<div class="line"><a name="l08532"></a><span class="lineno"> 8532</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l08533"></a><span class="lineno"> 8533</span>&#160;      <span class="comment">// Codegen X &amp; Y as:</span></div>
<div class="line"><a name="l08534"></a><span class="lineno"> 8534</span>&#160;      <span class="comment">// BB1:</span></div>
<div class="line"><a name="l08535"></a><span class="lineno"> 8535</span>&#160;      <span class="comment">//   jmp_if_X TmpBB</span></div>
<div class="line"><a name="l08536"></a><span class="lineno"> 8536</span>&#160;      <span class="comment">//   jmp FBB</span></div>
<div class="line"><a name="l08537"></a><span class="lineno"> 8537</span>&#160;      <span class="comment">// TmpBB:</span></div>
<div class="line"><a name="l08538"></a><span class="lineno"> 8538</span>&#160;      <span class="comment">//   jmp_if_Y TBB</span></div>
<div class="line"><a name="l08539"></a><span class="lineno"> 8539</span>&#160;      <span class="comment">//   jmp FBB</span></div>
<div class="line"><a name="l08540"></a><span class="lineno"> 8540</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l08541"></a><span class="lineno"> 8541</span>&#160;      <span class="comment">//  This requires creation of TmpBB after CurBB.</span></div>
<div class="line"><a name="l08542"></a><span class="lineno"> 8542</span>&#160; </div>
<div class="line"><a name="l08543"></a><span class="lineno"> 8543</span>&#160;      <span class="comment">// We have flexibility in setting Prob for BB1 and Prob for TmpBB.</span></div>
<div class="line"><a name="l08544"></a><span class="lineno"> 8544</span>&#160;      <span class="comment">// The requirement is that</span></div>
<div class="line"><a name="l08545"></a><span class="lineno"> 8545</span>&#160;      <span class="comment">//   FalseProb for BB1 + (TrueProb for BB1 * FalseProb for TmpBB)</span></div>
<div class="line"><a name="l08546"></a><span class="lineno"> 8546</span>&#160;      <span class="comment">//     = FalseProb for original BB.</span></div>
<div class="line"><a name="l08547"></a><span class="lineno"> 8547</span>&#160;      <span class="comment">// Assuming the original weights are A and B, one choice is to set BB1&#39;s</span></div>
<div class="line"><a name="l08548"></a><span class="lineno"> 8548</span>&#160;      <span class="comment">// weights to 2A+B and B, and set TmpBB&#39;s weights to 2A and B. This choice</span></div>
<div class="line"><a name="l08549"></a><span class="lineno"> 8549</span>&#160;      <span class="comment">// assumes that</span></div>
<div class="line"><a name="l08550"></a><span class="lineno"> 8550</span>&#160;      <span class="comment">//   FalseProb for BB1 == TrueProb for BB1 * FalseProb for TmpBB.</span></div>
<div class="line"><a name="l08551"></a><span class="lineno"> 8551</span>&#160;      <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> TrueWeight, FalseWeight;</div>
<div class="line"><a name="l08552"></a><span class="lineno"> 8552</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(*Br1, TrueWeight, FalseWeight)) {</div>
<div class="line"><a name="l08553"></a><span class="lineno"> 8553</span>&#160;        <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> NewTrueWeight = 2 * TrueWeight + FalseWeight;</div>
<div class="line"><a name="l08554"></a><span class="lineno"> 8554</span>&#160;        <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> NewFalseWeight = FalseWeight;</div>
<div class="line"><a name="l08555"></a><span class="lineno"> 8555</span>&#160;        <a class="code" href="CodeGenPrepare_8cpp.html#a25c5d0cb41bbb1777e779a8da35e7bd4">scaleWeights</a>(NewTrueWeight, NewFalseWeight);</div>
<div class="line"><a name="l08556"></a><span class="lineno"> 8556</span>&#160;        Br1-&gt;setMetadata(LLVMContext::MD_prof,</div>
<div class="line"><a name="l08557"></a><span class="lineno"> 8557</span>&#160;                         <a class="code" href="classllvm_1_1MDBuilder.html">MDBuilder</a>(Br1-&gt;getContext())</div>
<div class="line"><a name="l08558"></a><span class="lineno"> 8558</span>&#160;                             .<a class="code" href="classllvm_1_1MDBuilder.html#ad910125a9cfd76aaad7f69469df22f66">createBranchWeights</a>(TrueWeight, FalseWeight));</div>
<div class="line"><a name="l08559"></a><span class="lineno"> 8559</span>&#160; </div>
<div class="line"><a name="l08560"></a><span class="lineno"> 8560</span>&#160;        NewTrueWeight = 2 * TrueWeight;</div>
<div class="line"><a name="l08561"></a><span class="lineno"> 8561</span>&#160;        NewFalseWeight = FalseWeight;</div>
<div class="line"><a name="l08562"></a><span class="lineno"> 8562</span>&#160;        <a class="code" href="CodeGenPrepare_8cpp.html#a25c5d0cb41bbb1777e779a8da35e7bd4">scaleWeights</a>(NewTrueWeight, NewFalseWeight);</div>
<div class="line"><a name="l08563"></a><span class="lineno"> 8563</span>&#160;        Br2-&gt;setMetadata(LLVMContext::MD_prof,</div>
<div class="line"><a name="l08564"></a><span class="lineno"> 8564</span>&#160;                         <a class="code" href="classllvm_1_1MDBuilder.html">MDBuilder</a>(Br2-&gt;getContext())</div>
<div class="line"><a name="l08565"></a><span class="lineno"> 8565</span>&#160;                             .<a class="code" href="classllvm_1_1MDBuilder.html#ad910125a9cfd76aaad7f69469df22f66">createBranchWeights</a>(TrueWeight, FalseWeight));</div>
<div class="line"><a name="l08566"></a><span class="lineno"> 8566</span>&#160;      }</div>
<div class="line"><a name="l08567"></a><span class="lineno"> 8567</span>&#160;    }</div>
<div class="line"><a name="l08568"></a><span class="lineno"> 8568</span>&#160; </div>
<div class="line"><a name="l08569"></a><span class="lineno"> 8569</span>&#160;    ModifiedDT = ModifyDT::ModifyBBDT;</div>
<div class="line"><a name="l08570"></a><span class="lineno"> 8570</span>&#160;    MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l08571"></a><span class="lineno"> 8571</span>&#160; </div>
<div class="line"><a name="l08572"></a><span class="lineno"> 8572</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;After branch condition splitting\n&quot;</span>; <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>.dump();</div>
<div class="line"><a name="l08573"></a><span class="lineno"> 8573</span>&#160;               TmpBB-&gt;dump());</div>
<div class="line"><a name="l08574"></a><span class="lineno"> 8574</span>&#160;  }</div>
<div class="line"><a name="l08575"></a><span class="lineno"> 8575</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div>
<div class="line"><a name="l08576"></a><span class="lineno"> 8576</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="alib_2Target_2README_8txt_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2README_8txt_source.html#l00029">README.txt:29</a></div></div>
<div class="ttc" id="aclassllvm_1_1InstructionCost_html"><div class="ttname"><a href="classllvm_1_1InstructionCost.html">llvm::InstructionCost</a></div><div class="ttdef"><b>Definition:</b> <a href="InstructionCost_8h_source.html#l00029">InstructionCost.h:29</a></div></div>
<div class="ttc" id="aValueTypes_8h_html"><div class="ttname"><a href="ValueTypes_8h.html">ValueTypes.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_a1106b8a15061e8494873e10bb8a364e5"><div class="ttname"><a href="namespacellvm.html#a1106b8a15061e8494873e10bb8a364e5">llvm::RecursivelyDeleteTriviallyDeadInstructions</a></div><div class="ttdeci">bool RecursivelyDeleteTriviallyDeadInstructions(Value *V, const TargetLibraryInfo *TLI=nullptr, MemorySSAUpdater *MSSAU=nullptr, std::function&lt; void(Value *)&gt; AboutToDeleteCallback=std::function&lt; void(Value *)&gt;())</div><div class="ttdoc">If the specified value is a trivially dead instruction, delete it.</div><div class="ttdef"><b>Definition:</b> <a href="Transforms_2Utils_2Local_8cpp_source.html#l00537">Local.cpp:537</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a19e092ecf7889abf7277f13824e0c601"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a19e092ecf7889abf7277f13824e0c601">replaceAllUsesWith</a></div><div class="ttdeci">static void replaceAllUsesWith(Value *Old, Value *New, SmallSet&lt; BasicBlock *, 32 &gt; &amp;FreshBBs, bool IsHuge)</div><div class="ttdoc">Replace all old uses with new ones, and push the updated BBs into FreshBBs.</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l01029">CodeGenPrepare.cpp:1029</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a0b4e7bee9b8575cc7db73329f1a561bd"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">llvm::BasicBlock::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00316">BasicBlock.h:316</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a267b57299445dea412bcda05811ffc3d"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a267b57299445dea412bcda05811ffc3d">AddrSinkCombineScaledReg</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; AddrSinkCombineScaledReg(&quot;addr-sink-combine-scaled-reg&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Allow combining of ScaledReg field in Address sinking.&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a706f223f760b55668fbae74202b816bb"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a706f223f760b55668fbae74202b816bb">llvm::TargetTransformInfo::TargetCostKind</a></div><div class="ttdeci">TargetCostKind</div><div class="ttdoc">The kind of cost model.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00241">TargetTransformInfo.h:241</a></div></div>
<div class="ttc" id="anamespacellvm_html_ac7a11b9f5656e9697ac700a0e57dbb04"><div class="ttname"><a href="namespacellvm.html#ac7a11b9f5656e9697ac700a0e57dbb04">llvm::bypassSlowDivision</a></div><div class="ttdeci">bool bypassSlowDivision(BasicBlock *BB, const DenseMap&lt; unsigned int, unsigned int &gt; &amp;BypassWidth)</div><div class="ttdoc">This optimization identifies DIV instructions in a BB that can be profitably bypassed and carried out...</div></div>
<div class="ttc" id="anamespacellvm_html_a25f1d7ccf87af8d87fcb950f7ed758b5"><div class="ttname"><a href="namespacellvm.html#a25f1d7ccf87af8d87fcb950f7ed758b5">llvm::isAligned</a></div><div class="ttdeci">bool isAligned(Align Lhs, uint64_t SizeInBytes)</div><div class="ttdoc">Checks that SizeInBytes is a multiple of the alignment.</div><div class="ttdef"><b>Definition:</b> <a href="Alignment_8h_source.html#l00145">Alignment.h:145</a></div></div>
<div class="ttc" id="aIRTranslator_8cpp_html_abe44dfdea65b4f7e11e0a608ab708b76"><div class="ttname"><a href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a></div><div class="ttdeci">IRTranslator LLVM IR MI</div><div class="ttdef"><b>Definition:</b> <a href="IRTranslator_8cpp_source.html#l00109">IRTranslator.cpp:109</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a49a2d8f483ea08a3d6ea75f90c640d76"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a49a2d8f483ea08a3d6ea75f90c640d76">llvm::CmpInst::getSwappedPredicate</a></div><div class="ttdeci">Predicate getSwappedPredicate() const</div><div class="ttdoc">For example, EQ-&gt;EQ, SLE-&gt;SGE, ULT-&gt;UGT, OEQ-&gt;OEQ, ULE-&gt;UGE, OLT-&gt;OGT, etc.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00859">InstrTypes.h:859</a></div></div>
<div class="ttc" id="aCompiler_8h_html_aa863693eef567397d9c292da5bf22d34"><div class="ttname"><a href="Compiler_8h.html#aa863693eef567397d9c292da5bf22d34">LLVM_DUMP_METHOD</a></div><div class="ttdeci">#define LLVM_DUMP_METHOD</div><div class="ttdoc">Mark debug helper function definitions like dump() that should not be stripped from debug builds.</div><div class="ttdef"><b>Definition:</b> <a href="Compiler_8h_source.html#l00492">Compiler.h:492</a></div></div>
<div class="ttc" id="aMathExtras_8h_html"><div class="ttname"><a href="MathExtras_8h.html">MathExtras.h</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_af23979229be4fb2286896bf920e3e235"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#af23979229be4fb2286896bf920e3e235">matchUAddWithOverflowConstantEdgeCases</a></div><div class="ttdeci">static bool matchUAddWithOverflowConstantEdgeCases(CmpInst *Cmp, BinaryOperator *&amp;Add)</div><div class="ttdoc">Match special-case patterns that check for unsigned add overflow.</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l01549">CodeGenPrepare.cpp:1549</a></div></div>
<div class="ttc" id="anamespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">This is an optimization pass for GlobalISel generic memory operations.</div><div class="ttdef"><b>Definition:</b> <a href="AddressRanges_8h_source.html#l00018">AddressRanges.h:18</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_a563ffc2ff61c499b3be2e00100cb72fa"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a563ffc2ff61c499b3be2e00100cb72fa">llvm::SmallVectorImpl::erase</a></div><div class="ttdeci">iterator erase(const_iterator CI)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00741">SmallVector.h:741</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a55bba6bcd9b098e1c227011e6cd66300"><div class="ttname"><a href="classllvm_1_1Value.html#a55bba6bcd9b098e1c227011e6cd66300">llvm::Value::isUsedInBasicBlock</a></div><div class="ttdeci">bool isUsedInBasicBlock(const BasicBlock *BB) const</div><div class="ttdoc">Check if this value is used in the specified basic block.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00233">Value.cpp:233</a></div></div>
<div class="ttc" id="anamespacellvm_1_1dwarf_html_ab4fde659cfd2ad21ef1920dca7f22255"><div class="ttname"><a href="namespacellvm_1_1dwarf.html#ab4fde659cfd2ad21ef1920dca7f22255">llvm::dwarf::Constants</a></div><div class="ttdeci">Constants</div><div class="ttdef"><b>Definition:</b> <a href="Dwarf_8h_source.html#l00510">Dwarf.h:510</a></div></div>
<div class="ttc" id="alib_2Target_2X86_2README_8txt_html_ac88fe1d3a61b056a4f64fbbb156a62ff"><div class="ttname"><a href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a></div><div class="ttdeci">We currently emits eax Perhaps this is what we really should generate is Is imull three or four cycles eax eax The current instruction priority is based on pattern complexity The former is more complex because it folds a load so the latter will not be emitted Perhaps we should use AddedComplexity to give LEA32r a higher priority We should always try to match LEA first since the LEA matching code does some estimate to determine whether the match is profitable if we care more about code then imull is better It s two bytes shorter than movl leal On a Pentium M</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2X86_2README_8txt_source.html#l00252">README.txt:252</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">llvm::CmpInst::ICMP_EQ</a></div><div class="ttdeci">@ ICMP_EQ</div><div class="ttdoc">equal</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00739">InstrTypes.h:739</a></div></div>
<div class="ttc" id="aREADME-SSE_8txt_html_abb4ce3bc3096a12d4b93460bf78bcf95"><div class="ttname"><a href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a></div><div class="ttdeci">into xmm2 addss xmm2 xmm1 xmm3 addss xmm3 movaps xmm0 unpcklps xmm0 ret seems silly when it could just be one addps Expand libm rounding functions main should enable SSE DAZ mode and other fast SSE modes Think about doing i64 math in SSE regs on x86 This testcase should have no SSE instructions in it</div><div class="ttdef"><b>Definition:</b> <a href="README-SSE_8txt_source.html#l00081">README-SSE.txt:81</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a47f5c74e1b14ba4a61db057400644acc"><div class="ttname"><a href="classllvm_1_1Value.html#a47f5c74e1b14ba4a61db057400644acc">llvm::Value::getPointerAlignment</a></div><div class="ttdeci">Align getPointerAlignment(const DataLayout &amp;DL) const</div><div class="ttdoc">Returns an alignment of the pointer value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00918">Value.cpp:918</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7dc3069afa2ce5ea62ac2eb183e51c00"><div class="ttname"><a href="namespacellvm.html#a7dc3069afa2ce5ea62ac2eb183e51c00">llvm::none_of</a></div><div class="ttdeci">bool none_of(R &amp;&amp;Range, UnaryPredicate P)</div><div class="ttdoc">Provide wrappers to std::none_of which take ranges instead of having to pass begin/end explicitly.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01749">STLExtras.h:1749</a></div></div>
<div class="ttc" id="anamespacellvm_html_a02981de53fb6ffd384d39addc4d25f37"><div class="ttname"><a href="namespacellvm.html#a02981de53fb6ffd384d39addc4d25f37">llvm::drop_begin</a></div><div class="ttdeci">auto drop_begin(T &amp;&amp;RangeOrContainer, size_t N=1)</div><div class="ttdoc">Return a range covering RangeOrContainer with the first N elements excluded.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00386">STLExtras.h:386</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_abe9a0c5ce415f4e7498d75deb8de0896"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#abe9a0c5ce415f4e7498d75deb8de0896">llvm::TargetLoweringBase::isCheapToSpeculateCtlz</a></div><div class="ttdeci">virtual bool isCheapToSpeculateCtlz(Type *Ty) const</div><div class="ttdoc">Return true if it is cheap to speculate a call to intrinsic ctlz.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l00632">TargetLowering.h:632</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a18ea06b4e195aedc9dbd091d60d74365"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a18ea06b4e195aedc9dbd091d60d74365">DisableSelectToBranch</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; DisableSelectToBranch(&quot;disable-cgp-select2branch&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Disable select to branch conversion.&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1ReturnInst_html"><div class="ttname"><a href="classllvm_1_1ReturnInst.html">llvm::ReturnInst</a></div><div class="ttdoc">Return a value (possibly void), from a function.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03057">Instructions.h:3057</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLowering_html_aa394506e609b72337e9c664ef264db8b"><div class="ttname"><a href="classllvm_1_1TargetLowering.html#aa394506e609b72337e9c664ef264db8b">llvm::TargetLowering::ExpandInlineAsm</a></div><div class="ttdeci">virtual bool ExpandInlineAsm(CallInst *) const</div><div class="ttdoc">This hook allows the target to expand an inline asm call to be explicit llvm code if it wants to.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l04616">TargetLowering.h:4616</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImpl_html_a11045c7973ab24a8d6315b61fa337d4e"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html#a11045c7973ab24a8d6315b61fa337d4e">llvm::SmallPtrSetImpl::erase</a></div><div class="ttdeci">bool erase(PtrType Ptr)</div><div class="ttdoc">erase - If the set contains the specified pointer, remove it and return true, otherwise return false.</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00379">SmallPtrSet.h:379</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a79ca0cc68830eccfb4d7e2f4bdfd9857"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a79ca0cc68830eccfb4d7e2f4bdfd9857">llvm::TargetLoweringBase::getPreferredSwitchConditionType</a></div><div class="ttdeci">virtual MVT getPreferredSwitchConditionType(LLVMContext &amp;Context, EVT ConditionVT) const</div><div class="ttdoc">Returns preferred type for switch condition.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLoweringBase_8cpp_source.html#l01661">TargetLoweringBase.cpp:1661</a></div></div>
<div class="ttc" id="aclassllvm_1_1WeakTrackingVH_html"><div class="ttname"><a href="classllvm_1_1WeakTrackingVH.html">llvm::WeakTrackingVH</a></div><div class="ttdoc">Value handle that is nullable, but tries to track the Value.</div><div class="ttdef"><b>Definition:</b> <a href="ValueHandle_8h_source.html#l00204">ValueHandle.h:204</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_a1f0ff79b64a40d383b891f1baba89c6b"><div class="ttname"><a href="classllvm_1_1PHINode.html#a1f0ff79b64a40d383b891f1baba89c6b">llvm::PHINode::incoming_values</a></div><div class="ttdeci">op_range incoming_values()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02784">Instructions.h:2784</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ARM_html_a5667e0461a51d2c4887056c3f684c341adf1f3edb9115acb0a1e04209b7a9937b"><div class="ttname"><a href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341adf1f3edb9115acb0a1e04209b7a9937b">llvm::ARM::PredBlockMask::TT</a></div><div class="ttdeci">@ TT</div></div>
<div class="ttc" id="anamespacellvm_html_a6893db19648a2dba0912d181aaa57ec0a19de5b94f7b83900d4b296d9fa491aec"><div class="ttname"><a href="namespacellvm.html#a6893db19648a2dba0912d181aaa57ec0a19de5b94f7b83900d4b296d9fa491aec">llvm::HexPrintStyle::Upper</a></div><div class="ttdeci">@ Upper</div></div>
<div class="ttc" id="aclassllvm_1_1DataLayout_html"><div class="ttname"><a href="classllvm_1_1DataLayout.html">llvm::DataLayout</a></div><div class="ttdoc">A parsed version of the target data layout string in and methods for querying it.</div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00110">DataLayout.h:110</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AArch64PACKey_html_abf4394f452bde3f544999858d71e4b46"><div class="ttname"><a href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46">llvm::AArch64PACKey::ID</a></div><div class="ttdeci">ID</div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00790">AArch64BaseInfo.h:790</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a3a402430a1bbe70a9282dcb0e0b6a2cd"><div class="ttname"><a href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">llvm::Value::hasOneUse</a></div><div class="ttdeci">bool hasOneUse() const</div><div class="ttdoc">Return true if there is exactly one use of this value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00434">Value.h:434</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a435102a3ba336fd6223f84a475868e09"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a435102a3ba336fd6223f84a475868e09">llvm::PatternMatch::m_UAddWithOverflow</a></div><div class="ttdeci">UAddWithOverflow_match&lt; LHS_t, RHS_t, Sum_t &gt; m_UAddWithOverflow(const LHS_t &amp;L, const RHS_t &amp;R, const Sum_t &amp;S)</div><div class="ttdoc">Match an icmp instruction checking for unsigned overflow on addition.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l02017">PatternMatch.h:2017</a></div></div>
<div class="ttc" id="aclassllvm_1_1generic__gep__type__iterator_html"><div class="ttname"><a href="classllvm_1_1generic__gep__type__iterator.html">llvm::generic_gep_type_iterator</a></div><div class="ttdef"><b>Definition:</b> <a href="GetElementPtrTypeIterator_8h_source.html#l00031">GetElementPtrTypeIterator.h:31</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_aa159b7d2631747735a5f57877991d26f"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#aa159b7d2631747735a5f57877991d26f">despeculateCountZeros</a></div><div class="ttdeci">static bool despeculateCountZeros(IntrinsicInst *CountZeros, const TargetLowering *TLI, const DataLayout *DL, ModifyDT &amp;ModifiedDT, SmallSet&lt; BasicBlock *, 32 &gt; &amp;FreshBBs, bool IsHugeFunc)</div><div class="ttdoc">If counting leading or trailing zeros is an expensive operation and a zero input is defined,...</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l02131">CodeGenPrepare.cpp:2131</a></div></div>
<div class="ttc" id="aArchiveWriter_8cpp_html_aa9f638c7ae7fdd206a6c60e26bef9751"><div class="ttname"><a href="ArchiveWriter_8cpp.html#aa9f638c7ae7fdd206a6c60e26bef9751">print</a></div><div class="ttdeci">static void print(raw_ostream &amp;Out, object::Archive::Kind Kind, T Val)</div><div class="ttdef"><b>Definition:</b> <a href="ArchiveWriter_8cpp_source.html#l00189">ArchiveWriter.cpp:189</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a2be3583dac92a031fa1458d4d992c78b"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">llvm::CmpInst::Predicate</a></div><div class="ttdeci">Predicate</div><div class="ttdoc">This enumeration lists the possible predicates for CmpInst subclasses.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00718">InstrTypes.h:718</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html_a0b931781aa589c6ebe64a76c1447e5b2"><div class="ttname"><a href="classllvm_1_1User.html#a0b931781aa589c6ebe64a76c1447e5b2">llvm::User::operands</a></div><div class="ttdeci">op_range operands()</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00242">User.h:242</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a98c0a84a5dfa8bce341c829709f171e5"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">llvm::BasicBlock::iterator</a></div><div class="ttdeci">InstListType::iterator iterator</div><div class="ttdoc">Instruction iterators...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00087">BasicBlock.h:87</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_afe3ce7fc89f36474eb0369cbb792c05a"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#afe3ce7fc89f36474eb0369cbb792c05a">llvm::ConstantInt::getType</a></div><div class="ttdeci">IntegerType * getType() const</div><div class="ttdoc">getType - Specialize the getType() method to always return an IntegerType, which reduces the amount o...</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00172">Constants.h:172</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a77f7add8733417370a56154e8b560617"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a77f7add8733417370a56154e8b560617">llvm::TargetLoweringBase::getTypeToTransformTo</a></div><div class="ttdeci">virtual EVT getTypeToTransformTo(LLVMContext &amp;Context, EVT VT) const</div><div class="ttdoc">For types supported by the target, this is an identity function.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l01005">TargetLowering.h:1005</a></div></div>
<div class="ttc" id="aAMDGPURewriteUndefForPHI_8cpp_html_a2e83cb1bc3f5e8986cbd14575755a134"><div class="ttname"><a href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a></div><div class="ttdeci">Rewrite undef for PHI</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPURewriteUndefForPHI_8cpp_source.html#l00101">AMDGPURewriteUndefForPHI.cpp:101</a></div></div>
<div class="ttc" id="aclassllvm_1_1AllocaInst_html_a42438d0a43720a6571c9138224481754"><div class="ttname"><a href="classllvm_1_1AllocaInst.html#a42438d0a43720a6571c9138224481754">llvm::AllocaInst::getAlign</a></div><div class="ttdeci">Align getAlign() const</div><div class="ttdoc">Return the alignment of the memory that is being allocated by the instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00125">Instructions.h:125</a></div></div>
<div class="ttc" id="aclassllvm_1_1ProfileSummaryInfo_html_a9610274171a85158779e7ee6031d2376"><div class="ttname"><a href="classllvm_1_1ProfileSummaryInfo.html#a9610274171a85158779e7ee6031d2376">llvm::ProfileSummaryInfo::hasPartialSampleProfile</a></div><div class="ttdeci">bool hasPartialSampleProfile() const</div><div class="ttdoc">Returns true if module M has partial-profile sample profile.</div><div class="ttdef"><b>Definition:</b> <a href="ProfileSummaryInfo_8cpp_source.html#l00377">ProfileSummaryInfo.cpp:377</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a38bee869ad41aebfef3de2641b12004c"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a38bee869ad41aebfef3de2641b12004c">llvm::BasicBlock::getParent</a></div><div class="ttdeci">const Function * getParent() const</div><div class="ttdoc">Return the enclosing method, or null if none.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00112">BasicBlock.h:112</a></div></div>
<div class="ttc" id="aIntrinsicInst_8h_html"><div class="ttname"><a href="IntrinsicInst_8h.html">IntrinsicInst.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a3b996fbf8458aafffc86cb98a68d0a47"><div class="ttname"><a href="classllvm_1_1Type.html#a3b996fbf8458aafffc86cb98a68d0a47">llvm::Type::isPointerTy</a></div><div class="ttdeci">bool isPointerTy() const</div><div class="ttdoc">True if this is an instance of PointerType.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00249">Type.h:249</a></div></div>
<div class="ttc" id="astructllvm_1_1SimplifyQuery_html"><div class="ttname"><a href="structllvm_1_1SimplifyQuery.html">llvm::SimplifyQuery</a></div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8h_source.html#l00093">InstructionSimplify.h:93</a></div></div>
<div class="ttc" id="aclassllvm_1_1ElementCount_html"><div class="ttname"><a href="classllvm_1_1ElementCount.html">llvm::ElementCount</a></div><div class="ttdef"><b>Definition:</b> <a href="TypeSize_8h_source.html#l00279">TypeSize.h:279</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a87d50d10274efe9688166584391ae489"><div class="ttname"><a href="classllvm_1_1APInt.html#a87d50d10274efe9688166584391ae489">llvm::APInt::isSignedIntN</a></div><div class="ttdeci">bool isSignedIntN(unsigned N) const</div><div class="ttdoc">Check if this APInt has an N-bits signed integer value.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00427">APInt.h:427</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_ab578df6035c026da33776b9367923c61"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#ab578df6035c026da33776b9367923c61">EnableAndCmpSinking</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; EnableAndCmpSinking(&quot;enable-andcmp-sinking&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Enable sinkinig and/cmp into branches.&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1MemTransferInst_html"><div class="ttname"><a href="classllvm_1_1MemTransferInst.html">llvm::MemTransferInst</a></div><div class="ttdoc">This class wraps the llvm.memcpy/memmove intrinsics.</div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l01113">IntrinsicInst.h:1113</a></div></div>
<div class="ttc" id="aclassllvm_1_1Function_html"><div class="ttname"><a href="classllvm_1_1Function.html">llvm::Function</a></div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00059">Function.h:59</a></div></div>
<div class="ttc" id="aclassllvm_1_1Loop_html"><div class="ttname"><a href="classllvm_1_1Loop.html">llvm::Loop</a></div><div class="ttdoc">Represents a single loop in the control flow graph.</div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l00547">LoopInfo.h:547</a></div></div>
<div class="ttc" id="aOptTable_8cpp_html_aa3eeff7d11fd437d92b11bc4840d1d2e"><div class="ttname"><a href="OptTable_8cpp.html#aa3eeff7d11fd437d92b11bc4840d1d2e">isInput</a></div><div class="ttdeci">static bool isInput(const ArrayRef&lt; StringLiteral &gt; &amp;Prefixes, StringRef Arg)</div><div class="ttdef"><b>Definition:</b> <a href="OptTable_8cpp_source.html#l00151">OptTable.cpp:151</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_af7dca9a9e816ef69fd9e9467f64f72b4"><div class="ttname"><a href="classllvm_1_1Value.html#af7dca9a9e816ef69fd9e9467f64f72b4">llvm::Value::dump</a></div><div class="ttdeci">void dump() const</div><div class="ttdoc">Support for debugging, callable in GDB: V-&gt;dump()</div><div class="ttdef"><b>Definition:</b> <a href="AsmWriter_8cpp_source.html#l04942">AsmWriter.cpp:4942</a></div></div>
<div class="ttc" id="aREADME-SSE_8txt_html_a63d206a063eefcdf8c318ded97b65020"><div class="ttname"><a href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a></div><div class="ttdeci">This currently compiles esp xmm0 movsd esp eax eax esp ret We should use not the dag combiner This is because dagcombine2 needs to be able to see through the X86ISD::Wrapper which DAGCombine can t really do The code for turning x load into a single vector load is target independent and should be moved to the dag combiner The code for turning x load into a vector load can only handle a direct load from a global or a direct load from the stack It should be generalized to handle any load from P</div><div class="ttdef"><b>Definition:</b> <a href="README-SSE_8txt_source.html#l00411">README-SSE.txt:411</a></div></div>
<div class="ttc" id="aPass_8h_html"><div class="ttname"><a href="Pass_8h.html">Pass.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ISD_html_a22ea9cec080dd5f4f47ba234c2f59110a1ddf36330110b4abea43fe390bea9ef9"><div class="ttname"><a href="namespacellvm_1_1ISD.html#a22ea9cec080dd5f4f47ba234c2f59110a1ddf36330110b4abea43fe390bea9ef9">llvm::ISD::UADDO</a></div><div class="ttdeci">@ UADDO</div><div class="ttdef"><b>Definition:</b> <a href="ISDOpcodes_8h_source.html#l00324">ISDOpcodes.h:324</a></div></div>
<div class="ttc" id="aclassllvm_1_1IntrinsicInst_html_a7ff64b3625b6f9020556ed05a5f72af4"><div class="ttname"><a href="classllvm_1_1IntrinsicInst.html#a7ff64b3625b6f9020556ed05a5f72af4">llvm::IntrinsicInst::getIntrinsicID</a></div><div class="ttdeci">Intrinsic::ID getIntrinsicID() const</div><div class="ttdoc">Return the intrinsic ID of this intrinsic.</div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00054">IntrinsicInst.h:54</a></div></div>
<div class="ttc" id="aclassllvm_1_1details_1_1FixedOrScalableQuantity_html_a9188f84e1dd67530330dcab9cae787d7"><div class="ttname"><a href="classllvm_1_1details_1_1FixedOrScalableQuantity.html#a9188f84e1dd67530330dcab9cae787d7">llvm::details::FixedOrScalableQuantity::isScalable</a></div><div class="ttdeci">constexpr bool isScalable() const</div><div class="ttdoc">Returns whether the quantity is scaled by a runtime quantity (vscale).</div><div class="ttdef"><b>Definition:</b> <a href="TypeSize_8h_source.html#l00166">TypeSize.h:166</a></div></div>
<div class="ttc" id="aTargetPassConfig_8cpp_html_ac7494f88e19e6f277cec14fa17737ec2"><div class="ttname"><a href="TargetPassConfig_8cpp.html#ac7494f88e19e6f277cec14fa17737ec2">DisableSelectOptimize</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; DisableSelectOptimize(&quot;disable-select-optimize&quot;, cl::init(true), cl::Hidden, cl::desc(&quot;Disable the select-optimization pass from running&quot;))</div><div class="ttdoc">Disable the select optimization pass.</div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_adf834c332066239424a2f713b2fd4a7f"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#adf834c332066239424a2f713b2fd4a7f">DisableStoreExtract</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; DisableStoreExtract(&quot;disable-cgp-store-extract&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Disable store(extract) optimizations in CodeGenPrepare&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_ad1b0513de876d1c85cf6268ca21b2c86"><div class="ttname"><a href="classllvm_1_1APInt.html#ad1b0513de876d1c85cf6268ca21b2c86">llvm::APInt::isPowerOf2</a></div><div class="ttdeci">bool isPowerOf2() const</div><div class="ttdoc">Check if this APInt's value is a power of two greater than zero.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00432">APInt.h:432</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a25aa6029f4af7a3baadbd476d76fcaff"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a25aa6029f4af7a3baadbd476d76fcaff">llvm::TargetLoweringBase::isExtLoad</a></div><div class="ttdeci">bool isExtLoad(const LoadInst *Load, const Instruction *Ext, const DataLayout &amp;DL) const</div><div class="ttdoc">Return true if Load and Ext can form an ExtLoad.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l02795">TargetLowering.h:2795</a></div></div>
<div class="ttc" id="aclassllvm_1_1BitCastInst_html"><div class="ttname"><a href="classllvm_1_1BitCastInst.html">llvm::BitCastInst</a></div><div class="ttdoc">This class represents a no-op cast from one type to another.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l05258">Instructions.h:5258</a></div></div>
<div class="ttc" id="aGetElementPtrTypeIterator_8h_html"><div class="ttname"><a href="GetElementPtrTypeIterator_8h.html">GetElementPtrTypeIterator.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a1c9300bfa022ac28948bd4336376e3c1"><div class="ttname"><a href="classllvm_1_1APInt.html#a1c9300bfa022ac28948bd4336376e3c1">llvm::APInt::getMinSignedBits</a></div><div class="ttdeci">unsigned getMinSignedBits() const</div><div class="ttdoc">NOTE: This is soft-deprecated. Please use getSignificantBits() instead.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01487">APInt.h:1487</a></div></div>
<div class="ttc" id="anamespacellvm_html_ab8a7ef433279aabf7f30fa5504a4d4ef"><div class="ttname"><a href="namespacellvm.html#ab8a7ef433279aabf7f30fa5504a4d4ef">llvm::isGuaranteedNotToBeUndefOrPoison</a></div><div class="ttdeci">bool isGuaranteedNotToBeUndefOrPoison(const Value *V, AssumptionCache *AC=nullptr, const Instruction *CtxI=nullptr, const DominatorTree *DT=nullptr, unsigned Depth=0)</div><div class="ttdoc">Return true if this function can prove that V does not have undef bits and is never poison.</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l05581">ValueTracking.cpp:5581</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a4abb39a66573f61fda80469faa5d861d"><div class="ttname"><a href="classllvm_1_1Type.html#a4abb39a66573f61fda80469faa5d861d">llvm::Type::getScalarType</a></div><div class="ttdeci">Type * getScalarType() const</div><div class="ttdoc">If this is a vector type, return the element type, otherwise return 'this'.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00341">Type.h:341</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a9cae528bdb66086aa6c06da36fc6fa24"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a9cae528bdb66086aa6c06da36fc6fa24">llvm::PatternMatch::m_InsertElt</a></div><div class="ttdeci">ThreeOps_match&lt; Val_t, Elt_t, Idx_t, Instruction::InsertElement &gt; m_InsertElt(const Val_t &amp;Val, const Elt_t &amp;Elt, const Idx_t &amp;Idx)</div><div class="ttdoc">Matches InsertElementInst.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01484">PatternMatch.h:1484</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_a4b001d9b458035fbbfc154d52d354ee9"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">llvm::ConstantInt::getValue</a></div><div class="ttdeci">const APInt &amp; getValue() const</div><div class="ttdoc">Return the constant as an APInt value reference.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00132">Constants.h:132</a></div></div>
<div class="ttc" id="anamespacellvm_html_a26e2a938b431eaa6eca2beaa96410c9d"><div class="ttname"><a href="namespacellvm.html#a26e2a938b431eaa6eca2beaa96410c9d">llvm::successors</a></div><div class="ttdeci">auto successors(const MachineBasicBlock *BB)</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l01265">MachineBasicBlock.h:1265</a></div></div>
<div class="ttc" id="aclassllvm_1_1ReturnInst_html_a87e923648048258a6e8376d6cf4ce565"><div class="ttname"><a href="classllvm_1_1ReturnInst.html#a87e923648048258a6e8376d6cf4ce565">llvm::ReturnInst::getReturnValue</a></div><div class="ttdeci">Value * getReturnValue() const</div><div class="ttdoc">Convenience accessor. Returns null if there is no return value.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03102">Instructions.h:3102</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a86026627b644e50527898aad0747b3e5"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a86026627b644e50527898aad0747b3e5">IsOperandAMemoryOperand</a></div><div class="ttdeci">static bool IsOperandAMemoryOperand(CallInst *CI, InlineAsm *IA, Value *OpVal, const TargetLowering &amp;TLI, const TargetRegisterInfo &amp;TRI)</div><div class="ttdoc">Check to see if all uses of OpVal by the specified inline asm call are due to memory operands.</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l04944">CodeGenPrepare.cpp:4944</a></div></div>
<div class="ttc" id="aclassllvm_1_1ilist__node__with__parent_html_a26708685cc8b94fe3d7092ee080dbb34"><div class="ttname"><a href="classllvm_1_1ilist__node__with__parent.html#a26708685cc8b94fe3d7092ee080dbb34">llvm::ilist_node_with_parent::getNextNode</a></div><div class="ttdeci">NodeTy * getNextNode()</div><div class="ttdoc">Get the next node, or nullptr for the list tail.</div><div class="ttdef"><b>Definition:</b> <a href="ilist__node_8h_source.html#l00289">ilist_node.h:289</a></div></div>
<div class="ttc" id="aclassllvm_1_1MapVector_html_ae091b147039557cf8ce505740e7ff7ac"><div class="ttname"><a href="classllvm_1_1MapVector.html#ae091b147039557cf8ce505740e7ff7ac">llvm::MapVector::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00089">MapVector.h:89</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector</a></div><div class="ttdoc">This is a 'vector' (really, a variable-sized array), optimized for the case when the array is small.</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l01199">SmallVector.h:1199</a></div></div>
<div class="ttc" id="aStatistic_8h_html"><div class="ttname"><a href="Statistic_8h.html">Statistic.h</a></div></div>
<div class="ttc" id="aInlineAsm_8h_html"><div class="ttname"><a href="InlineAsm_8h.html">InlineAsm.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a944c25ac9b73b02a17a20a08a25b9b21"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a944c25ac9b73b02a17a20a08a25b9b21">llvm::PatternMatch::m_Add</a></div><div class="ttdeci">BinaryOp_match&lt; LHS, RHS, Instruction::Add &gt; m_Add(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00979">PatternMatch.h:979</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a1279f0919bc0ef7841275eb05861ccb3"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a1279f0919bc0ef7841275eb05861ccb3">getIVIncrement</a></div><div class="ttdeci">static std::optional&lt; std::pair&lt; Instruction *, Constant * &gt; &gt; getIVIncrement(const PHINode *PN, const LoopInfo *LI)</div><div class="ttdoc">If given PN is an inductive variable with value IVInc coming from the backedge, and on each iteration...</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l01438">CodeGenPrepare.cpp:1438</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_a018f0394a375233d538109968b76a05a"><div class="ttname"><a href="classllvm_1_1CallBase.html#a018f0394a375233d538109968b76a05a">llvm::CallBase::isInlineAsm</a></div><div class="ttdeci">bool isInlineAsm() const</div><div class="ttdoc">Check if this call is an inline asm statement.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01474">InstrTypes.h:1474</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_af2daa0ee117afefed4c82eee55bf97b7"><div class="ttname"><a href="classllvm_1_1APInt.html#af2daa0ee117afefed4c82eee55bf97b7">llvm::APInt::getSExtValue</a></div><div class="ttdeci">int64_t getSExtValue() const</div><div class="ttdoc">Get sign extended value.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01516">APInt.h:1516</a></div></div>
<div class="ttc" id="aSizeOpts_8h_html"><div class="ttname"><a href="SizeOpts_8h.html">SizeOpts.h</a></div></div>
<div class="ttc" id="aSupport_2ErrorHandling_8h_html"><div class="ttname"><a href="Support_2ErrorHandling_8h.html">ErrorHandling.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_af4feec45578e32fe65d8efc59112bc8e"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#af4feec45578e32fe65d8efc59112bc8e">llvm::PatternMatch::m_CombineOr</a></div><div class="ttdeci">match_combine_or&lt; LTy, RTy &gt; m_CombineOr(const LTy &amp;L, const RTy &amp;R)</div><div class="ttdoc">Combine two pattern matchers matching L || R.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00218">PatternMatch.h:218</a></div></div>
<div class="ttc" id="aAArch64InstrInfo_8cpp_html_a8a77823ca1d474b22f9b923674749a14"><div class="ttname"><a href="AArch64InstrInfo_8cpp.html#a8a77823ca1d474b22f9b923674749a14">canCombine</a></div><div class="ttdeci">static bool canCombine(MachineBasicBlock &amp;MBB, MachineOperand &amp;MO, unsigned CombineOpc, unsigned ZeroReg=0, bool CheckZeroReg=false)</div><div class="ttdef"><b>Definition:</b> <a href="AArch64InstrInfo_8cpp_source.html#l04898">AArch64InstrInfo.cpp:4898</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html">llvm::TargetTransformInfo</a></div><div class="ttdoc">This pass provides access to the codegen interfaces that are needed for IR-level transformations.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00196">TargetTransformInfo.h:196</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantExpr_html_abae3f750ce4d2edcea30f08fe9e29721"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#abae3f750ce4d2edcea30f08fe9e29721">llvm::ConstantExpr::getGetElementPtr</a></div><div class="ttdeci">static Constant * getGetElementPtr(Type *Ty, Constant *C, ArrayRef&lt; Constant * &gt; IdxList, bool InBounds=false, std::optional&lt; unsigned &gt; InRangeIndex=std::nullopt, Type *OnlyIfReducedTy=nullptr)</div><div class="ttdoc">Getelementptr form.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l01245">Constants.h:1245</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a5ab2d0b0f0b8ceec3b907184e7567197"><div class="ttname"><a href="classllvm_1_1Type.html#a5ab2d0b0f0b8ceec3b907184e7567197">llvm::Type::getPointerAddressSpace</a></div><div class="ttdeci">unsigned getPointerAddressSpace() const</div><div class="ttdoc">Get the address space of this pointer or pointer vector type.</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00729">DerivedTypes.h:729</a></div></div>
<div class="ttc" id="aclassllvm_1_1Function_html_ae6a4da5f41fc6a36735cc1704c01ce60"><div class="ttname"><a href="classllvm_1_1Function.html#ae6a4da5f41fc6a36735cc1704c01ce60">llvm::Function::getEntryBlock</a></div><div class="ttdeci">const BasicBlock &amp; getEntryBlock() const</div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00735">Function.h:735</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallDenseSet_html"><div class="ttname"><a href="classllvm_1_1SmallDenseSet.html">llvm::SmallDenseSet</a></div><div class="ttdoc">Implements a dense probed hash-table based set with some number of buckets stored inline.</div><div class="ttdef"><b>Definition:</b> <a href="DenseSet_8h_source.html#l00286">DenseSet.h:286</a></div></div>
<div class="ttc" id="aclassllvm_1_1IRBuilder_html"><div class="ttname"><a href="classllvm_1_1IRBuilder.html">llvm::IRBuilder&lt;&gt;</a></div></div>
<div class="ttc" id="aMapVector_8h_html"><div class="ttname"><a href="MapVector_8h.html">MapVector.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1GlobalVariable_html"><div class="ttname"><a href="classllvm_1_1GlobalVariable.html">llvm::GlobalVariable</a></div><div class="ttdef"><b>Definition:</b> <a href="GlobalVariable_8h_source.html#l00039">GlobalVariable.h:39</a></div></div>
<div class="ttc" id="aclassllvm_1_1CastInst_html_a643fe5a9e7042f032dae78109c2b1e72"><div class="ttname"><a href="classllvm_1_1CastInst.html#a643fe5a9e7042f032dae78109c2b1e72">llvm::CastInst::Create</a></div><div class="ttdeci">static CastInst * Create(Instruction::CastOps, Value *S, Type *Ty, const Twine &amp;Name=&quot;&quot;, Instruction *InsertBefore=nullptr)</div><div class="ttdoc">Provides a way to construct any of the CastInst subclasses using an opcode instead of the subclass's ...</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l03354">Instructions.cpp:3354</a></div></div>
<div class="ttc" id="anamespacellvm_html_ac9a7de5a04920954ac964059cfc428ad"><div class="ttname"><a href="namespacellvm.html#ac9a7de5a04920954ac964059cfc428ad">llvm::erase_if</a></div><div class="ttdeci">void erase_if(Container &amp;C, UnaryPredicate P)</div><div class="ttdoc">Provide a container algorithm similar to C++ Library Fundamentals v2's erase_if which is equivalent t...</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01998">STLExtras.h:1998</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallDenseMap_html"><div class="ttname"><a href="classllvm_1_1SmallDenseMap.html">llvm::SmallDenseMap</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00880">DenseMap.h:880</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">llvm::CmpInst::ICMP_NE</a></div><div class="ttdeci">@ ICMP_NE</div><div class="ttdoc">not equal</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00740">InstrTypes.h:740</a></div></div>
<div class="ttc" id="aLICM_8cpp_html_ab0cfc793d55940eac67854827dd365e9"><div class="ttname"><a href="LICM_8cpp.html#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a></div><div class="ttdeci">static void eraseInstruction(Instruction &amp;I, ICFLoopSafetyInfo &amp;SafetyInfo, MemorySSAUpdater &amp;MSSAU)</div><div class="ttdef"><b>Definition:</b> <a href="LICM_8cpp_source.html#l01475">LICM.cpp:1475</a></div></div>
<div class="ttc" id="aAArch64ISelLowering_8cpp_html_a62766c75f88612ffa652342472e755f6"><div class="ttname"><a href="AArch64ISelLowering_8cpp.html#a62766c75f88612ffa652342472e755f6">getIntrinsicID</a></div><div class="ttdeci">static unsigned getIntrinsicID(const SDNode *N)</div><div class="ttdef"><b>Definition:</b> <a href="AArch64ISelLowering_8cpp_source.html#l06202">AArch64ISelLowering.cpp:6202</a></div></div>
<div class="ttc" id="aValueTracking_8h_html"><div class="ttname"><a href="ValueTracking_8h.html">ValueTracking.h</a></div></div>
<div class="ttc" id="aTransforms_2Utils_2Local_8h_html"><div class="ttname"><a href="Transforms_2Utils_2Local_8h.html">Local.h</a></div></div>
<div class="ttc" id="aVEISelLowering_8cpp_html_a07226cd9aa78324951d9be41f6083c3e"><div class="ttname"><a href="VEISelLowering_8cpp.html#a07226cd9aa78324951d9be41f6083c3e">getSplatValue</a></div><div class="ttdeci">static SDValue getSplatValue(SDNode *N)</div><div class="ttdef"><b>Definition:</b> <a href="VEISelLowering_8cpp_source.html#l01824">VEISelLowering.cpp:1824</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a482498a1c760122fd33c7fc8190dd277"><div class="ttname"><a href="classllvm_1_1Instruction.html#a482498a1c760122fd33c7fc8190dd277">llvm::Instruction::insertBefore</a></div><div class="ttdeci">void insertBefore(Instruction *InsertPos)</div><div class="ttdoc">Insert an unlinked instruction into a basic block immediately before the specified instruction.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00088">Instruction.cpp:88</a></div></div>
<div class="ttc" id="aclassllvm_1_1DbgVariableIntrinsic_html_a212fcbee3e65ec41eebed2525fc15207"><div class="ttname"><a href="classllvm_1_1DbgVariableIntrinsic.html#a212fcbee3e65ec41eebed2525fc15207">llvm::DbgVariableIntrinsic::replaceVariableLocationOp</a></div><div class="ttdeci">void replaceVariableLocationOp(Value *OldValue, Value *NewValue)</div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8cpp_source.html#l00114">IntrinsicInst.cpp:114</a></div></div>
<div class="ttc" id="aclassllvm_1_1DominatorTree_html"><div class="ttname"><a href="classllvm_1_1DominatorTree.html">llvm::DominatorTree</a></div><div class="ttdoc">Concrete subclass of DominatorTreeBase that is used to compute a normal dominator tree.</div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00166">Dominators.h:166</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_a2fbfe5377a984518a7c03d8558df726d"><div class="ttname"><a href="classllvm_1_1CallBase.html#a2fbfe5377a984518a7c03d8558df726d">llvm::CallBase::hasFnAttr</a></div><div class="ttdeci">bool hasFnAttr(Attribute::AttrKind Kind) const</div><div class="ttdoc">Determine whether this call has the given attribute.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01493">InstrTypes.h:1493</a></div></div>
<div class="ttc" id="anamespacellvm_1_1cl_html_a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6"><div class="ttname"><a href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">llvm::cl::Hidden</a></div><div class="ttdeci">@ Hidden</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00138">CommandLine.h:138</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a4fd27a44c5fd9958fdd9150622129cd3"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a4fd27a44c5fd9958fdd9150622129cd3">llvm::PatternMatch::m_Br</a></div><div class="ttdeci">brc_match&lt; Cond_t, bind_ty&lt; BasicBlock &gt;, bind_ty&lt; BasicBlock &gt; &gt; m_Br(const Cond_t &amp;C, BasicBlock *&amp;T, BasicBlock *&amp;F)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01731">PatternMatch.h:1731</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a1eb8504bab5f794778d82db6ac829923"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a1eb8504bab5f794778d82db6ac829923">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::erase</a></div><div class="ttdeci">bool erase(const KeyT &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00302">DenseMap.h:302</a></div></div>
<div class="ttc" id="anamespacellvm_html_a07256e6859fcb3b9d5eb02ecea9e9a38"><div class="ttname"><a href="namespacellvm.html#a07256e6859fcb3b9d5eb02ecea9e9a38">llvm::isKnownNonZero</a></div><div class="ttdeci">bool isKnownNonZero(const Value *V, const DataLayout &amp;DL, unsigned Depth=0, AssumptionCache *AC=nullptr, const Instruction *CxtI=nullptr, const DominatorTree *DT=nullptr, bool UseInstrInfo=true)</div><div class="ttdoc">Return true if the given value is known to be non-zero when defined.</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l00313">ValueTracking.cpp:313</a></div></div>
<div class="ttc" id="aAPInt_8h_html"><div class="ttname"><a href="APInt_8h.html">APInt.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetRegisterInfo_html"><div class="ttname"><a href="classllvm_1_1TargetRegisterInfo.html">llvm::TargetRegisterInfo</a></div><div class="ttdoc">TargetRegisterInfo base class - We assume that the target defines a static array of TargetRegisterDes...</div><div class="ttdef"><b>Definition:</b> <a href="TargetRegisterInfo_8h_source.html#l00236">TargetRegisterInfo.h:236</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a22496210b244839d09594b0a7ca909b5"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a22496210b244839d09594b0a7ca909b5">DisableComplexAddrModes</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; DisableComplexAddrModes(&quot;disable-complex-addr-modes&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Disables combining addressing modes with different parts &quot; &quot;in optimizeMemoryInst.&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_af37b2842424eb63440bdcacca0af9820"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#af37b2842424eb63440bdcacca0af9820">llvm::TargetTransformInfo::getVectorInstrCost</a></div><div class="ttdeci">InstructionCost getVectorInstrCost(unsigned Opcode, Type *Val, TTI::TargetCostKind CostKind, unsigned Index=-1, Value *Op0=nullptr, Value *Op1=nullptr) const</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00908">TargetTransformInfo.cpp:908</a></div></div>
<div class="ttc" id="anamespacellvm_html_a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639"><div class="ttname"><a href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">llvm::Depth</a></div><div class="ttdeci">@ Depth</div><div class="ttdef"><b>Definition:</b> <a href="SIMachineScheduler_8h_source.html#l00036">SIMachineScheduler.h:36</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a2be3583dac92a031fa1458d4d992c78ba720a42e85f7e981afd61e28473b0000a"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba720a42e85f7e981afd61e28473b0000a">llvm::CmpInst::ICMP_SGT</a></div><div class="ttdeci">@ ICMP_SGT</div><div class="ttdoc">signed greater than</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00745">InstrTypes.h:745</a></div></div>
<div class="ttc" id="aclassllvm_1_1details_1_1FixedOrScalableQuantity_html_a5cafb166cf7c4937f5647a084c4eaee2"><div class="ttname"><a href="classllvm_1_1details_1_1FixedOrScalableQuantity.html#a5cafb166cf7c4937f5647a084c4eaee2">llvm::details::FixedOrScalableQuantity::isNonZero</a></div><div class="ttdeci">constexpr bool isNonZero() const</div><div class="ttdef"><b>Definition:</b> <a href="TypeSize_8h_source.html#l00153">TypeSize.h:153</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a25c5d0cb41bbb1777e779a8da35e7bd4"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a25c5d0cb41bbb1777e779a8da35e7bd4">scaleWeights</a></div><div class="ttdeci">static void scaleWeights(uint64_t &amp;NewTrue, uint64_t &amp;NewFalse)</div><div class="ttdoc">Scale down both weights to fit into uint32_t.</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l08371">CodeGenPrepare.cpp:8371</a></div></div>
<div class="ttc" id="alib_2Target_2README_8txt_html_a8db36c82f32d6f6a4d35a00e55be03a8"><div class="ttname"><a href="lib_2Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a></div><div class="ttdeci">bool Shift</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2README_8txt_source.html#l00468">README.txt:468</a></div></div>
<div class="ttc" id="aBlockFrequency_8h_html"><div class="ttname"><a href="BlockFrequency_8h.html">BlockFrequency.h</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_ae7a9549676c2d27a72f1696f5911b1ce"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#ae7a9549676c2d27a72f1696f5911b1ce">ProfileUnknownInSpecialSection</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; ProfileUnknownInSpecialSection(&quot;profile-unknown-in-special-section&quot;, cl::Hidden, cl::desc(&quot;In profiling mode like sampleFDO, if a function doesn't have &quot; &quot;profile, we cannot tell the function is cold for sure because &quot; &quot;it may be a function newly added without ever being sampled. &quot; &quot;With the flag enabled, compiler can put such profile unknown &quot; &quot;functions into a special section, so runtime system can choose &quot; &quot;to handle it in a different way than .text section, to save &quot; &quot;RAM for example. &quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1Type_html"><div class="ttname"><a href="classllvm_1_1Type.html">llvm::Type</a></div><div class="ttdoc">The instances of the Type class are immutable: once they are created, they are never changed.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00045">Type.h:45</a></div></div>
<div class="ttc" id="aDenseMap_8h_html"><div class="ttname"><a href="DenseMap_8h.html">DenseMap.h</a></div></div>
<div class="ttc" id="aModule_8h_html"><div class="ttname"><a href="Module_8h.html">Module.h</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a2c05548feac70b16d31caf0cfb225714"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a2c05548feac70b16d31caf0cfb225714">OptimizeExtractBits</a></div><div class="ttdeci">static bool OptimizeExtractBits(BinaryOperator *ShiftI, ConstantInt *CI, const TargetLowering &amp;TLI, const DataLayout &amp;DL)</div><div class="ttdoc">Sink the shift right instruction into user blocks if the uses could potentially be combined with this...</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l02030">CodeGenPrepare.cpp:2030</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a857270a0b6ecf873b6c96b80ecb08702"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a857270a0b6ecf873b6c96b80ecb08702">BBSectionsGuidedSectionPrefix</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; BBSectionsGuidedSectionPrefix(&quot;bbsections-guided-section-prefix&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Use the basic-block-sections profile to determine the text &quot; &quot;section prefix for hot functions. Functions with &quot; &quot;basic-block-sections profile will be placed in `.text.hot` &quot; &quot;regardless of their FDO profile info. Other functions won't be &quot; &quot;impacted, i.e., their prefixes will be decided by FDO/sampleFDO &quot; &quot;profiles.&quot;))</div></div>
<div class="ttc" id="anamespacellvm_1_1sys_1_1path_html_a214ec2f04ffd92636ed4bd2717607a1d"><div class="ttname"><a href="namespacellvm_1_1sys_1_1path.html#a214ec2f04ffd92636ed4bd2717607a1d">llvm::sys::path::end</a></div><div class="ttdeci">const_iterator end(StringRef path)</div><div class="ttdoc">Get end iterator over path.</div><div class="ttdef"><b>Definition:</b> <a href="Path_8cpp_source.html#l00235">Path.cpp:235</a></div></div>
<div class="ttc" id="anamespacellvm_1_1sys_1_1path_html_a00a76a729b319dc47beffbe07325565f"><div class="ttname"><a href="namespacellvm_1_1sys_1_1path.html#a00a76a729b319dc47beffbe07325565f">llvm::sys::path::begin</a></div><div class="ttdeci">const_iterator begin(StringRef path, Style style=Style::native)</div><div class="ttdoc">Get begin iterator over path.</div><div class="ttdef"><b>Definition:</b> <a href="Path_8cpp_source.html#l00226">Path.cpp:226</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoopInfoWrapperPass_html"><div class="ttname"><a href="classllvm_1_1LoopInfoWrapperPass.html">llvm::LoopInfoWrapperPass</a></div><div class="ttdoc">The legacy pass manager's analysis pass to compute loop information.</div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l01293">LoopInfo.h:1293</a></div></div>
<div class="ttc" id="anamespacellvm_html_a2e4b18daaf5f20f1ade3a9f66b86d843"><div class="ttname"><a href="namespacellvm.html#a2e4b18daaf5f20f1ade3a9f66b86d843">llvm::FoldReturnIntoUncondBranch</a></div><div class="ttdeci">ReturnInst * FoldReturnIntoUncondBranch(ReturnInst *RI, BasicBlock *BB, BasicBlock *Pred, DomTreeUpdater *DTU=nullptr)</div><div class="ttdoc">This method duplicates the specified return instruction into a predecessor which ends in an unconditi...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockUtils_8cpp_source.html#l01415">BasicBlockUtils.cpp:1415</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallSet_html"><div class="ttname"><a href="classllvm_1_1SmallSet.html">llvm::SmallSet</a></div><div class="ttdoc">SmallSet - This maintains a set of unique values, optimizing for the case when the set is small (less...</div><div class="ttdef"><b>Definition:</b> <a href="SmallSet_8h_source.html#l00135">SmallSet.h:135</a></div></div>
<div class="ttc" id="anamespacellvm_1_1rdf_html_adff32edf02469b3f29d410c0a4d68be3"><div class="ttname"><a href="namespacellvm_1_1rdf.html#adff32edf02469b3f29d410c0a4d68be3">llvm::rdf::NodeList</a></div><div class="ttdeci">SmallVector&lt; NodeAddr&lt; NodeBase * &gt;, 4 &gt; NodeList</div><div class="ttdef"><b>Definition:</b> <a href="RDFGraph_8h_source.html#l00513">RDFGraph.h:513</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a52c990590792c91dd20b6d45acebe359"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a52c990590792c91dd20b6d45acebe359">llvm::BasicBlock::splitBasicBlock</a></div><div class="ttdeci">BasicBlock * splitBasicBlock(iterator I, const Twine &amp;BBName=&quot;&quot;, bool Before=false)</div><div class="ttdoc">Split the basic block into two basic blocks at the specified instruction.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00401">BasicBlock.cpp:401</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a43ab2c6c81d610b0225c3d301dd4bd4c"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a43ab2c6c81d610b0225c3d301dd4bd4c">llvm::TargetLoweringBase::isJumpExpensive</a></div><div class="ttdeci">bool isJumpExpensive() const</div><div class="ttdoc">Return true if Flow Control is an expensive operation that should be avoided.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l00573">TargetLowering.h:573</a></div></div>
<div class="ttc" id="aclassllvm_1_1GCRelocateInst_html_ae33641b6538b4ab4f3aa3dad2926860f"><div class="ttname"><a href="classllvm_1_1GCRelocateInst.html#ae33641b6538b4ab4f3aa3dad2926860f">llvm::GCRelocateInst::getBasePtrIndex</a></div><div class="ttdeci">unsigned getBasePtrIndex() const</div><div class="ttdoc">The index into the associate statepoint's argument list which contains the base pointer of the pointe...</div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l01490">IntrinsicInst.h:1490</a></div></div>
<div class="ttc" id="aclassllvm_1_1ExtractValueInst_html_ae7f10273fba575e1cb0379621c5330ad"><div class="ttname"><a href="classllvm_1_1ExtractValueInst.html#ae7f10273fba575e1cb0379621c5330ad">llvm::ExtractValueInst::indices</a></div><div class="ttdeci">iterator_range&lt; idx_iterator &gt; indices() const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02506">Instructions.h:2506</a></div></div>
<div class="ttc" id="anamespacellvm_html_a2f883c895f4d244f4ed56ed8a8c160c1"><div class="ttname"><a href="namespacellvm.html#a2f883c895f4d244f4ed56ed8a8c160c1">llvm::operator!=</a></div><div class="ttdeci">bool operator!=(uint64_t V1, const APInt &amp;V2)</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l02040">APInt.h:2040</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a46a7cbf3724080a5f4f4c7e7a4551e26"><div class="ttname"><a href="classllvm_1_1APInt.html#a46a7cbf3724080a5f4f4c7e7a4551e26">llvm::APInt::ugt</a></div><div class="ttdeci">bool ugt(const APInt &amp;RHS) const</div><div class="ttdoc">Unsigned greater than comparison.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01160">APInt.h:1160</a></div></div>
<div class="ttc" id="aclassllvm_1_1MemIntrinsic_html"><div class="ttname"><a href="classllvm_1_1MemIntrinsic.html">llvm::MemIntrinsic</a></div><div class="ttdoc">This is the common base class for memset/memcpy/memmove.</div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l01048">IntrinsicInst.h:1048</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a53408c95a7bfb5443b43fb2134c3eb23"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a53408c95a7bfb5443b43fb2134c3eb23">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::count</a></div><div class="ttdeci">size_type count(const_arg_type_t&lt; KeyT &gt; Val) const</div><div class="ttdoc">Return 1 if the specified key is in the map, 0 otherwise.</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00145">DenseMap.h:145</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a43ac4fbaaf63a88eb5ac05f6d3e5649c"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a43ac4fbaaf63a88eb5ac05f6d3e5649c">llvm::PatternMatch::m_BinOp</a></div><div class="ttdeci">class_match&lt; BinaryOperator &gt; m_BinOp()</div><div class="ttdoc">Match an arbitrary binary operation and ignore it.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00084">PatternMatch.h:84</a></div></div>
<div class="ttc" id="astructllvm_1_1ExtAddrMode_html_a243a500ecf43f8be3648cd935b943165"><div class="ttname"><a href="structllvm_1_1ExtAddrMode.html#a243a500ecf43f8be3648cd935b943165">llvm::ExtAddrMode::ScaledReg</a></div><div class="ttdeci">Register ScaledReg</div><div class="ttdef"><b>Definition:</b> <a href="TargetInstrInfo_8h_source.html#l00089">TargetInstrInfo.h:89</a></div></div>
<div class="ttc" id="aELFObjHandler_8cpp_html_a250e66aa31a03567cc345ca1bc463b8c"><div class="ttname"><a href="ELFObjHandler_8cpp.html#a250e66aa31a03567cc345ca1bc463b8c">Offset</a></div><div class="ttdeci">uint64_t Offset</div><div class="ttdef"><b>Definition:</b> <a href="ELFObjHandler_8cpp_source.html#l00080">ELFObjHandler.cpp:80</a></div></div>
<div class="ttc" id="aclassllvm_1_1MapVector_html"><div class="ttname"><a href="classllvm_1_1MapVector.html">llvm::MapVector</a></div><div class="ttdoc">This class implements a map that also provides access to all stored values in a deterministic order.</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00037">MapVector.h:37</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSet_html"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html">llvm::SmallPtrSet</a></div><div class="ttdoc">SmallPtrSet - This class implements a set which is optimized for holding SmallSize or less elements.</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00450">SmallPtrSet.h:450</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a99b320fd35acaf648a0a7826a0bdd777"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a99b320fd35acaf648a0a7826a0bdd777">llvm::TargetTransformInfo::getPredictableBranchThreshold</a></div><div class="ttdeci">BranchProbability getPredictableBranchThreshold() const</div><div class="ttdoc">If a branch or a select condition is skewed in one direction by more than this factor,...</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00239">TargetTransformInfo.cpp:239</a></div></div>
<div class="ttc" id="aOperator_8h_html"><div class="ttname"><a href="Operator_8h.html">Operator.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a158da2b6d3d938aaa15b6acd00150e2c"><div class="ttname"><a href="classllvm_1_1Value.html#a158da2b6d3d938aaa15b6acd00150e2c">llvm::Value::user_begin</a></div><div class="ttdeci">user_iterator user_begin()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00397">Value.h:397</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLowering_html_acb82500e7e47e76d087ce8606ae8e625"><div class="ttname"><a href="classllvm_1_1TargetLowering.html#acb82500e7e47e76d087ce8606ae8e625">llvm::TargetLowering::ComputeConstraintToUse</a></div><div class="ttdeci">virtual void ComputeConstraintToUse(AsmOperandInfo &amp;OpInfo, SDValue Op, SelectionDAG *DAG=nullptr) const</div><div class="ttdoc">Determines the constraint code and constraint type to use for the specific AsmOperandInfo,...</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8cpp_source.html#l05726">TargetLowering.cpp:5726</a></div></div>
<div class="ttc" id="aValueTracking_8cpp_html_a2cb59ea8f9e8543986d40c48acfd24a3"><div class="ttname"><a href="ValueTracking_8cpp.html#a2cb59ea8f9e8543986d40c48acfd24a3">getBitWidth</a></div><div class="ttdeci">static unsigned getBitWidth(Type *Ty, const DataLayout &amp;DL)</div><div class="ttdoc">Returns the bitwidth of the given scalar or pointer type.</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l00089">ValueTracking.cpp:89</a></div></div>
<div class="ttc" id="anamespacellvm_html_ab4d4bc901fedd8857f647dcc2c0d71de"><div class="ttname"><a href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">llvm::max</a></div><div class="ttdeci">Expected&lt; ExpressionValue &gt; max(const ExpressionValue &amp;Lhs, const ExpressionValue &amp;Rhs)</div><div class="ttdef"><b>Definition:</b> <a href="FileCheck_8cpp_source.html#l00337">FileCheck.cpp:337</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a81d4c84610eb126b642d541e1d116bb3"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a81d4c84610eb126b642d541e1d116bb3">matchIncrement</a></div><div class="ttdeci">bool matchIncrement(const Instruction *IVInc, Instruction *&amp;LHS, Constant *&amp;Step)</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l01419">CodeGenPrepare.cpp:1419</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_ad78e062f62e0d6e453941fb4ca843e4d"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a></div><div class="ttdeci">#define DEBUG_TYPE</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l00108">CodeGenPrepare.cpp:108</a></div></div>
<div class="ttc" id="anamespacellvm_html_a03503773241005f01b090b9862aad304"><div class="ttname"><a href="namespacellvm.html#a03503773241005f01b090b9862aad304">llvm::dump</a></div><div class="ttdeci">void dump(const SparseBitVector&lt; ElementSize &gt; &amp;LHS, raw_ostream &amp;out)</div><div class="ttdef"><b>Definition:</b> <a href="SparseBitVector_8h_source.html#l00877">SparseBitVector.h:877</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a59fb91d1691350f7d1b8e8a114e3f2a4"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a59fb91d1691350f7d1b8e8a114e3f2a4">llvm::BasicBlock::getSinglePredecessor</a></div><div class="ttdeci">const BasicBlock * getSinglePredecessor() const</div><div class="ttdoc">Return the predecessor of this block if it has a single predecessor block.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00284">BasicBlock.cpp:284</a></div></div>
<div class="ttc" id="aAMDGPURegBankSelect_8cpp_html_a14e0c000ed52e5fc187d4a885914cc1a"><div class="ttname"><a href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a></div><div class="ttdeci">amdgpu AMDGPU Register Bank Select</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPURegBankSelect_8cpp_source.html#l00045">AMDGPURegBankSelect.cpp:45</a></div></div>
<div class="ttc" id="aSTLExtras_8h_html"><div class="ttname"><a href="STLExtras_8h.html">STLExtras.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_a313a633eb3049b90e931206183e1251ea6da89265a9a8b0b28eb4946bb2ec0c6d"><div class="ttname"><a href="namespacellvm.html#a313a633eb3049b90e931206183e1251ea6da89265a9a8b0b28eb4946bb2ec0c6d">llvm::DiagnosticPredicateTy::Match</a></div><div class="ttdeci">@ Match</div></div>
<div class="ttc" id="aX86PartialReduction_8cpp_html_a87b8bfbbe9d8f7146d7f20a5fb42efd0"><div class="ttname"><a href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a></div><div class="ttdeci">Value * RHS</div><div class="ttdef"><b>Definition:</b> <a href="X86PartialReduction_8cpp_source.html#l00076">X86PartialReduction.cpp:76</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a715438acc8712570460df3f9458dbaad"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a715438acc8712570460df3f9458dbaad">AddrSinkUsingGEPs</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; AddrSinkUsingGEPs(&quot;addr-sink-using-gep&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Address sinking in CGP using GEPs.&quot;))</div></div>
<div class="ttc" id="anamespacellvm_html_ac828b9b52935f87659a4adf237f820a3"><div class="ttname"><a href="namespacellvm.html#ac828b9b52935f87659a4adf237f820a3">llvm::gep_type_begin</a></div><div class="ttdeci">gep_type_iterator gep_type_begin(const User *GEP)</div><div class="ttdef"><b>Definition:</b> <a href="GetElementPtrTypeIterator_8h_source.html#l00123">GetElementPtrTypeIterator.h:123</a></div></div>
<div class="ttc" id="aCompiler_8h_html_acc1c483f4b4ee2f17bb6643a3b353609"><div class="ttname"><a href="Compiler_8h.html#acc1c483f4b4ee2f17bb6643a3b353609">LLVM_ATTRIBUTE_UNUSED</a></div><div class="ttdeci">#define LLVM_ATTRIBUTE_UNUSED</div><div class="ttdef"><b>Definition:</b> <a href="Compiler_8h_source.html#l00172">Compiler.h:172</a></div></div>
<div class="ttc" id="astructllvm_1_1TargetTransformInfo_1_1OperandValueInfo_html"><div class="ttname"><a href="structllvm_1_1TargetTransformInfo_1_1OperandValueInfo.html">llvm::TargetTransformInfo::OperandValueInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00947">TargetTransformInfo.h:947</a></div></div>
<div class="ttc" id="anamespacellvm_1_1SPII_html_a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f"><div class="ttname"><a href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">llvm::SPII::Load</a></div><div class="ttdeci">@ Load</div><div class="ttdef"><b>Definition:</b> <a href="SparcInstrInfo_8h_source.html#l00032">SparcInstrInfo.h:32</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a7ba5de75f50bb4a4ba920698edf39b28"><div class="ttname"><a href="classllvm_1_1Type.html#a7ba5de75f50bb4a4ba920698edf39b28">llvm::Type::getInt8Ty</a></div><div class="ttdeci">static IntegerType * getInt8Ty(LLVMContext &amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00239">Type.cpp:239</a></div></div>
<div class="ttc" id="aMachineSink_8cpp_html_a0f36ed1bc17fc1aa97fe291c439a0698"><div class="ttname"><a href="MachineSink_8cpp.html#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a></div><div class="ttdeci">unsigned const TargetRegisterInfo * TRI</div><div class="ttdef"><b>Definition:</b> <a href="MachineSink_8cpp_source.html#l01628">MachineSink.cpp:1628</a></div></div>
<div class="ttc" id="aUse_8h_html"><div class="ttname"><a href="Use_8h.html">Use.h</a></div></div>
<div class="ttc" id="aItaniumDemangle_8h_html_ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c"><div class="ttname"><a href="ItaniumDemangle_8h.html#ab67ef02b75c3226cfe0b2791e2b48b06a74accfde3d3f8e8a27c326eba229d16c">ReferenceKind::LValue</a></div><div class="ttdeci">@ LValue</div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a1eeb4e7d9888038d9deef80f7d773ab7"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a1eeb4e7d9888038d9deef80f7d773ab7">EnableGEPOffsetSplit</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; EnableGEPOffsetSplit(&quot;cgp-split-large-offset-gep&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Enable splitting large offset of GEP.&quot;))</div></div>
<div class="ttc" id="aDebug_8h_html_a08efc68d15935eb8889400a46c3749ba"><div class="ttname"><a href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a></div><div class="ttdeci">#define LLVM_DEBUG(X)</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8h_source.html#l00101">Debug.h:101</a></div></div>
<div class="ttc" id="aclassllvm_1_1BranchInst_html_a6550fe5bd437c1c3c6e237d726e36b90"><div class="ttname"><a href="classllvm_1_1BranchInst.html#a6550fe5bd437c1c3c6e237d726e36b90">llvm::BranchInst::swapSuccessors</a></div><div class="ttdeci">void swapSuccessors()</div><div class="ttdoc">Swap the successors of this branch instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l01427">Instructions.cpp:1427</a></div></div>
<div class="ttc" id="anamespacellvm_html_acd6aa057934751aaac54e5c18bcc18eb"><div class="ttname"><a href="namespacellvm.html#acd6aa057934751aaac54e5c18bcc18eb">llvm::commonAlignment</a></div><div class="ttdeci">Align commonAlignment(Align A, uint64_t Offset)</div><div class="ttdoc">Returns the alignment that satisfies both alignments.</div><div class="ttdef"><b>Definition:</b> <a href="Alignment_8h_source.html#l00212">Alignment.h:212</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_a96d73bbd7af15cb1fc38c3f4a3bd82e9"><div class="ttname"><a href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a></div><div class="ttdeci">#define F(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00055">MD5.cpp:55</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a9247a212ea89acc9573fa7e7f557eaba"><div class="ttname"><a href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">llvm::Instruction::setMetadata</a></div><div class="ttdeci">void setMetadata(unsigned KindID, MDNode *Node)</div><div class="ttdoc">Set the metadata of the specified kind to the specified node.</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8cpp_source.html#l01455">Metadata.cpp:1455</a></div></div>
<div class="ttc" id="astructllvm_1_1ExtAddrMode_html"><div class="ttname"><a href="structllvm_1_1ExtAddrMode.html">llvm::ExtAddrMode</a></div><div class="ttdoc">Used to describe addressing mode similar to ExtAddrMode in CodeGenPrepare.</div><div class="ttdef"><b>Definition:</b> <a href="TargetInstrInfo_8h_source.html#l00087">TargetInstrInfo.h:87</a></div></div>
<div class="ttc" id="aARMLowOverheadLoops_8cpp_html_a0a0971d62011c35b29ff4a2325d45e93"><div class="ttname"><a href="ARMLowOverheadLoops_8cpp.html#a0a0971d62011c35b29ff4a2325d45e93">Uses</a></div><div class="ttdeci">SmallPtrSet&lt; MachineInstr *, 2 &gt; Uses</div><div class="ttdef"><b>Definition:</b> <a href="ARMLowOverheadLoops_8cpp_source.html#l00590">ARMLowOverheadLoops.cpp:590</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html"><div class="ttname"><a href="classllvm_1_1BasicBlock.html">llvm::BasicBlock</a></div><div class="ttdoc">LLVM Basic Block Representation.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00055">BasicBlock.h:55</a></div></div>
<div class="ttc" id="aMachineValueType_8h_html"><div class="ttname"><a href="MachineValueType_8h.html">MachineValueType.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a9506719826e5449066b6a74d2d21d012"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a9506719826e5449066b6a74d2d21d012">llvm::TargetLoweringBase::shouldConsiderGEPOffsetSplit</a></div><div class="ttdeci">virtual bool shouldConsiderGEPOffsetSplit() const</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l03125">TargetLowering.h:3125</a></div></div>
<div class="ttc" id="aPointerIntPair_8h_html"><div class="ttname"><a href="PointerIntPair_8h.html">PointerIntPair.h</a></div></div>
<div class="ttc" id="aNVVMIntrRange_8cpp_html_afad351d7bf10ac0446b64e7827634e94"><div class="ttname"><a href="NVVMIntrRange_8cpp.html#afad351d7bf10ac0446b64e7827634e94">Context</a></div><div class="ttdeci">LLVMContext &amp; Context</div><div class="ttdef"><b>Definition:</b> <a href="NVVMIntrRange_8cpp_source.html#l00066">NVVMIntrRange.cpp:66</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7c46c742c31be54870e2038048e6b391"><div class="ttname"><a href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">llvm::dbgs</a></div><div class="ttdeci">raw_ostream &amp; dbgs()</div><div class="ttdoc">dbgs() - This returns a reference to a raw_ostream for debugging messages.</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8cpp_source.html#l00163">Debug.cpp:163</a></div></div>
<div class="ttc" id="aCoroutines_8cpp_html_ac781ce96aa25ba7f6fd38f72de665450"><div class="ttname"><a href="Coroutines_8cpp.html#ac781ce96aa25ba7f6fd38f72de665450">clear</a></div><div class="ttdeci">static void clear(coro::Shape &amp;Shape)</div><div class="ttdef"><b>Definition:</b> <a href="Coroutines_8cpp_source.html#l00149">Coroutines.cpp:149</a></div></div>
<div class="ttc" id="aclassllvm_1_1GCStatepointInst_html"><div class="ttname"><a href="classllvm_1_1GCStatepointInst.html">llvm::GCStatepointInst</a></div><div class="ttdoc">Represents a gc.statepoint intrinsic call.</div><div class="ttdef"><b>Definition:</b> <a href="Statepoint_8h_source.html#l00061">Statepoint.h:61</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantData_html"><div class="ttname"><a href="classllvm_1_1ConstantData.html">llvm::ConstantData</a></div><div class="ttdoc">Base class for constants with no operands.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00050">Constants.h:50</a></div></div>
<div class="ttc" id="anamespacellvm_html_aa76a2cf19b821f320ab439d5659ef4b9"><div class="ttname"><a href="namespacellvm.html#aa76a2cf19b821f320ab439d5659ef4b9">llvm::MergeBlockIntoPredecessor</a></div><div class="ttdeci">bool MergeBlockIntoPredecessor(BasicBlock *BB, DomTreeUpdater *DTU=nullptr, LoopInfo *LI=nullptr, MemorySSAUpdater *MSSAU=nullptr, MemoryDependenceResults *MemDep=nullptr, bool PredecessorWithTwoSuccessors=false, DominatorTree *DT=nullptr)</div><div class="ttdoc">Attempts to merge a block into its predecessor, if possible.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockUtils_8cpp_source.html#l00179">BasicBlockUtils.cpp:179</a></div></div>
<div class="ttc" id="aAMDGPULibCalls_8cpp_html_afecf1cc1292b07f57d343c0f4d682044"><div class="ttname"><a href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a></div><div class="ttdeci">amdgpu Simplify well known AMD library false FunctionCallee Value * Arg</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPULibCalls_8cpp_source.html#l00187">AMDGPULibCalls.cpp:187</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_afece9241ceab1d00d94c2fcd422cf054"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#afece9241ceab1d00d94c2fcd422cf054">VerifyBFIUpdates</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; VerifyBFIUpdates(&quot;cgp-verify-bfi-updates&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Enable BFI update verification for &quot; &quot;CodeGenPrepare.&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1User_html_a53d4e14158c5056fd1ed8f7b3da82f8a"><div class="ttname"><a href="classllvm_1_1User.html#a53d4e14158c5056fd1ed8f7b3da82f8a">llvm::User::getOperandUse</a></div><div class="ttdeci">const Use &amp; getOperandUse(unsigned i) const</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00182">User.h:182</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a8dd1fd9f6122f09ff0793bf0383d4d2b"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a8dd1fd9f6122f09ff0793bf0383d4d2b">llvm::TargetLoweringBase::getBypassSlowDivWidths</a></div><div class="ttdeci">const DenseMap&lt; unsigned int, unsigned int &gt; &amp; getBypassSlowDivWidths() const</div><div class="ttdoc">Returns map of slow types for division or remainder with corresponding fast types.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l00564">TargetLowering.h:564</a></div></div>
<div class="ttc" id="aIR_2Instruction_8h_html"><div class="ttname"><a href="IR_2Instruction_8h.html">Instruction.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_aac9e78b3aa02ec087c4621358f506718"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#aac9e78b3aa02ec087c4621358f506718">llvm::PatternMatch::m_APInt</a></div><div class="ttdeci">apint_match m_APInt(const APInt *&amp;Res)</div><div class="ttdoc">Match a ConstantInt or splatted ConstantVector, binding the specified pointer to the contained APInt.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00278">PatternMatch.h:278</a></div></div>
<div class="ttc" id="aCommandLine_8h_html"><div class="ttname"><a href="CommandLine_8h.html">CommandLine.h</a></div></div>
<div class="ttc" id="aX86PartialReduction_8cpp_html_a9e1483f7215664a2315c53c3558d9a8d"><div class="ttname"><a href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a></div><div class="ttdeci">Value * LHS</div><div class="ttdef"><b>Definition:</b> <a href="X86PartialReduction_8cpp_source.html#l00075">X86PartialReduction.cpp:75</a></div></div>
<div class="ttc" id="aTargetLowering_8h_html"><div class="ttname"><a href="TargetLowering_8h.html">TargetLowering.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_aa262bd68fe6b244861c0a5d249d68c30"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#aa262bd68fe6b244861c0a5d249d68c30">llvm::TargetLoweringBase::isExtFree</a></div><div class="ttdeci">bool isExtFree(const Instruction *I) const</div><div class="ttdoc">Return true if the extension represented by I is free.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l02770">TargetLowering.h:2770</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html"><div class="ttname"><a href="classllvm_1_1ConstantInt.html">llvm::ConstantInt</a></div><div class="ttdoc">This is the shared class of boolean and integer constants.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00078">Constants.h:78</a></div></div>
<div class="ttc" id="aclassllvm_1_1AllocaInst_html_a36e31f42170be95fc392dad696d9ba19"><div class="ttname"><a href="classllvm_1_1AllocaInst.html#a36e31f42170be95fc392dad696d9ba19">llvm::AllocaInst::isStaticAlloca</a></div><div class="ttdeci">bool isStaticAlloca() const</div><div class="ttdoc">Return true if this alloca is in the entry block of the function and is a constant size.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l01517">Instructions.cpp:1517</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_af09e4096de244d2fb345891328714a63"><div class="ttname"><a href="classllvm_1_1Instruction.html#af09e4096de244d2fb345891328714a63">llvm::Instruction::insertAfter</a></div><div class="ttdeci">void insertAfter(Instruction *InsertPos)</div><div class="ttdoc">Insert an unlinked instruction into a basic block immediately after the specified instruction.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00094">Instruction.cpp:94</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_ab4e05d690df389b8b1477c90387b575f"><div class="ttname"><a href="classllvm_1_1Instruction.html#ab4e05d690df389b8b1477c90387b575f">llvm::Instruction::getOpcode</a></div><div class="ttdeci">unsigned getOpcode() const</div><div class="ttdoc">Returns a member of one of the enums like Instruction::Add.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00168">Instruction.h:168</a></div></div>
<div class="ttc" id="anamespacellvm_html_a0d10fe510ced2849a8074fe81e5d04ce"><div class="ttname"><a href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all_of</a></div><div class="ttdeci">bool all_of(R &amp;&amp;range, UnaryPredicate P)</div><div class="ttdoc">Provide wrappers to std::all_of which take ranges instead of having to pass begin/end explicitly.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01735">STLExtras.h:1735</a></div></div>
<div class="ttc" id="aclassllvm_1_1ProfileSummaryInfo_html_ab390be311440c287f10e3d58db0421b5"><div class="ttname"><a href="classllvm_1_1ProfileSummaryInfo.html#ab390be311440c287f10e3d58db0421b5">llvm::ProfileSummaryInfo::isFunctionHotInCallGraph</a></div><div class="ttdeci">bool isFunctionHotInCallGraph(const Function *F, BlockFrequencyInfo &amp;BFI) const</div><div class="ttdoc">Returns true if F contains hot code.</div><div class="ttdef"><b>Definition:</b> <a href="ProfileSummaryInfo_8cpp_source.html#l00116">ProfileSummaryInfo.cpp:116</a></div></div>
<div class="ttc" id="aclassllvm_1_1BlockFrequencyInfo_html"><div class="ttname"><a href="classllvm_1_1BlockFrequencyInfo.html">llvm::BlockFrequencyInfo</a></div><div class="ttdoc">BlockFrequencyInfo pass uses BlockFrequencyInfoImpl implementation to estimate IR basic block frequen...</div><div class="ttdef"><b>Definition:</b> <a href="BlockFrequencyInfo_8h_source.html#l00037">BlockFrequencyInfo.h:37</a></div></div>
<div class="ttc" id="anamespacellvm_html_a3af72f14ea20f2c762c751d2d49e5ea3"><div class="ttname"><a href="namespacellvm.html#a3af72f14ea20f2c762c751d2d49e5ea3">llvm::shouldOptimizeForSize</a></div><div class="ttdeci">bool shouldOptimizeForSize(const MachineFunction *MF, ProfileSummaryInfo *PSI, const MachineBlockFrequencyInfo *BFI, PGSOQueryType QueryType=PGSOQueryType::Other)</div><div class="ttdoc">Returns true if machine function MF is suggested to be size-optimized based on the profile.</div><div class="ttdef"><b>Definition:</b> <a href="MachineSizeOpts_8cpp_source.html#l00183">MachineSizeOpts.cpp:183</a></div></div>
<div class="ttc" id="anamespacellvm_html_a6339f2ad6701dc229c34ca4305596d3a"><div class="ttname"><a href="namespacellvm.html#a6339f2ad6701dc229c34ca4305596d3a">llvm::isSplatValue</a></div><div class="ttdeci">bool isSplatValue(const Value *V, int Index=-1, unsigned Depth=0)</div><div class="ttdoc">Return true if each element of the vector value V is poisoned or equal to every other non-poisoned el...</div><div class="ttdef"><b>Definition:</b> <a href="VectorUtils_8cpp_source.html#l00386">VectorUtils.cpp:386</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_af7763c45db027300e49b43037e5a1a60"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#af7763c45db027300e49b43037e5a1a60">llvm::TargetLoweringBase::preferZeroCompareBranch</a></div><div class="ttdeci">virtual bool preferZeroCompareBranch() const</div><div class="ttdoc">Return true if the heuristic to prefer icmp eq zero should be used in code gen prepare.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l00653">TargetLowering.h:653</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_aa93fbbc66d52a51d178af8ac4398ec05"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#aa93fbbc66d52a51d178af8ac4398ec05">llvm::TargetLoweringBase::isOperationLegalOrCustom</a></div><div class="ttdeci">bool isOperationLegalOrCustom(unsigned Op, EVT VT, bool LegalOnly=false) const</div><div class="ttdoc">Return true if the specified operation is legal on this target or can be made legal with custom lower...</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l01187">TargetLowering.h:1187</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a63b5343b9da17f8bcc83ec545022f5c7"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a63b5343b9da17f8bcc83ec545022f5c7">llvm::TargetLoweringBase::allowsMisalignedMemoryAccesses</a></div><div class="ttdeci">virtual bool allowsMisalignedMemoryAccesses(EVT, unsigned AddrSpace=0, Align Alignment=Align(1), MachineMemOperand::Flags Flags=MachineMemOperand::MONone, unsigned *=nullptr) const</div><div class="ttdoc">Determine if the target supports unaligned memory accesses.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l01730">TargetLowering.h:1730</a></div></div>
<div class="ttc" id="aGlobalValue_8h_html"><div class="ttname"><a href="GlobalValue_8h.html">GlobalValue.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a9679969ae87f8a08d5f6948be6cf7210"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a9679969ae87f8a08d5f6948be6cf7210">llvm::TargetTransformInfo::getArithmeticInstrCost</a></div><div class="ttdeci">InstructionCost getArithmeticInstrCost(unsigned Opcode, Type *Ty, TTI::TargetCostKind CostKind=TTI::TCK_RecipThroughput, TTI::OperandValueInfo Opd1Info={TTI::OK_AnyValue, TTI::OP_None}, TTI::OperandValueInfo Opd2Info={TTI::OK_AnyValue, TTI::OP_None}, ArrayRef&lt; const Value * &gt; Args=ArrayRef&lt; const Value * &gt;(), const Instruction *CxtI=nullptr) const</div><div class="ttdoc">This is an approximation of reciprocal throughput of a math/logic op.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00803">TargetTransformInfo.cpp:803</a></div></div>
<div class="ttc" id="anamespacellvm_html_aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b"><div class="ttname"><a href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">llvm::RecurKind::And</a></div><div class="ttdeci">@ And</div><div class="ttdoc">Bitwise or logical AND of integers.</div></div>
<div class="ttc" id="anamespacellvm_1_1pdb_html_a5dbb1abfb6d3c14555304f9c56703234abbb93ef26e3c101ff11cdd21cab08a94"><div class="ttname"><a href="namespacellvm_1_1pdb.html#a5dbb1abfb6d3c14555304f9c56703234abbb93ef26e3c101ff11cdd21cab08a94">llvm::pdb::PDB_LocType::Null</a></div><div class="ttdeci">@ Null</div></div>
<div class="ttc" id="aTarget_2TargetMachine_8h_html"><div class="ttname"><a href="Target_2TargetMachine_8h.html">TargetMachine.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1PassRegistry_html_a05a729900b76c89e808c6c3094921b2f"><div class="ttname"><a href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">llvm::PassRegistry::getPassRegistry</a></div><div class="ttdeci">static PassRegistry * getPassRegistry()</div><div class="ttdoc">getPassRegistry - Access the global registry object, which is automatically initialized at applicatio...</div><div class="ttdef"><b>Definition:</b> <a href="PassRegistry_8cpp_source.html#l00024">PassRegistry.cpp:24</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_addb87fe3f509b7803d3f5933ee24b560"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#addb87fe3f509b7803d3f5933ee24b560">llvm::PatternMatch::m_Select</a></div><div class="ttdeci">ThreeOps_match&lt; Cond, LHS, RHS, Instruction::Select &gt; m_Select(const Cond &amp;C, const LHS &amp;L, const RHS &amp;R)</div><div class="ttdoc">Matches SelectInst.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01462">PatternMatch.h:1462</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_aa9f4cbd152c2c5d84007f3ad710ee895"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#aa9f4cbd152c2c5d84007f3ad710ee895">llvm::TargetLoweringBase::isPredictableSelectExpensive</a></div><div class="ttdeci">bool isPredictableSelectExpensive() const</div><div class="ttdoc">Return true if selects are only cheaper than branches if the branch is unlikely to be predicted right...</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l00577">TargetLowering.h:577</a></div></div>
<div class="ttc" id="aSelectionDAGNodes_8h_html"><div class="ttname"><a href="SelectionDAGNodes_8h.html">SelectionDAGNodes.h</a></div></div>
<div class="ttc" id="aConstants_8h_html"><div class="ttname"><a href="Constants_8h.html">Constants.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a25d956d9e0beadd47ce4bc255dfa811d"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">llvm::PatternMatch::match</a></div><div class="ttdeci">bool match(Val *V, const Pattern &amp;P)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00049">PatternMatch.h:49</a></div></div>
<div class="ttc" id="anamespacellvm_1_1msgpack_html_afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c"><div class="ttname"><a href="namespacellvm_1_1msgpack.html#afdae9da66bac09f4b2bfc0fd9f0559e6a46f3ea056caa3126b91f3f70beea068c">llvm::msgpack::Type::Map</a></div><div class="ttdeci">@ Map</div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_a16c39eb6e60b42a40c399d8d65347bb6"><div class="ttname"><a href="classllvm_1_1PHINode.html#a16c39eb6e60b42a40c399d8d65347bb6">llvm::PHINode::getIncomingValue</a></div><div class="ttdeci">Value * getIncomingValue(unsigned i) const</div><div class="ttdoc">Return incoming value number x.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02794">Instructions.h:2794</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a8df3f534fddc483247fee64ac7e0a0f9"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a8df3f534fddc483247fee64ac7e0a0f9">OptimizePhiTypes</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; OptimizePhiTypes(&quot;cgp-optimize-phi-types&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Enable converting phi types in CodeGenPrepare&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1DbgValueInst_html"><div class="ttname"><a href="classllvm_1_1DbgValueInst.html">llvm::DbgValueInst</a></div><div class="ttdoc">This represents the llvm.dbg.value instruction.</div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00388">IntrinsicInst.h:388</a></div></div>
<div class="ttc" id="aclassllvm_1_1AllocaInst_html_a074617b3e2f9f98ee3a2ac208e8e7210"><div class="ttname"><a href="classllvm_1_1AllocaInst.html#a074617b3e2f9f98ee3a2ac208e8e7210">llvm::AllocaInst::getAllocatedType</a></div><div class="ttdeci">Type * getAllocatedType() const</div><div class="ttdoc">Return the type that is being allocated by the instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00118">Instructions.h:118</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a49cd5939942c6665aba4cae8c220dff1"><div class="ttname"><a href="classllvm_1_1APInt.html#a49cd5939942c6665aba4cae8c220dff1">llvm::APInt::isZero</a></div><div class="ttdeci">bool isZero() const</div><div class="ttdoc">Determine if this value is zero, i.e. all bits are clear.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00366">APInt.h:366</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a2c270937482046b153d9f2664a334472"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a2c270937482046b153d9f2664a334472">AddrSinkCombineBaseGV</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; AddrSinkCombineBaseGV(&quot;addr-sink-combine-base-gv&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Allow combining of BaseGV field in Address sinking.&quot;))</div></div>
<div class="ttc" id="ainclude_2llvm_2Demangle_2README_8txt_html_a9d56f6c541a0ab888755f9bc198b8eca"><div class="ttname"><a href="include_2llvm_2Demangle_2README_8txt.html#a9d56f6c541a0ab888755f9bc198b8eca">f</a></div><div class="ttdeci">Itanium Name Demangler i e convert the string _Z1fv into f()&quot;. You can also use the CRTP base ManglingParser to perform some simple analysis on the mangled name</div></div>
<div class="ttc" id="aBuiltinGCs_8cpp_html_a6742d2e0a668baf1196ec69e158d5f15"><div class="ttname"><a href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a></div><div class="ttdeci">static GCRegistry::Add&lt; CoreCLRGC &gt; E(&quot;coreclr&quot;, &quot;CoreCLR-compatible GC&quot;)</div></div>
<div class="ttc" id="aclassllvm_1_1User_html"><div class="ttname"><a href="classllvm_1_1User.html">llvm::User</a></div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00044">User.h:44</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_af90354c692164edd2fe302104aa1ae86"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#af90354c692164edd2fe302104aa1ae86">llvm::TargetLoweringBase::shouldSinkOperands</a></div><div class="ttdeci">virtual bool shouldSinkOperands(Instruction *I, SmallVectorImpl&lt; Use * &gt; &amp;Ops) const</div><div class="ttdoc">Return true if sinking I's operands to the same basic block as I is profitable, e....</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l02854">TargetLowering.h:2854</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a8528dea79f0940669c4fcb751940ca94"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a8528dea79f0940669c4fcb751940ca94">tryUnmergingGEPsAcrossIndirectBr</a></div><div class="ttdeci">static bool tryUnmergingGEPsAcrossIndirectBr(GetElementPtrInst *GEPI, const TargetTransformInfo *TTI)</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l07853">CodeGenPrepare.cpp:7853</a></div></div>
<div class="ttc" id="astructllvm_1_1EVT_html"><div class="ttname"><a href="structllvm_1_1EVT.html">llvm::EVT</a></div><div class="ttdoc">Extended Value Type.</div><div class="ttdef"><b>Definition:</b> <a href="ValueTypes_8h_source.html#l00034">ValueTypes.h:34</a></div></div>
<div class="ttc" id="anamespacellvm_html_a607b7fac55adc5ea9ed40a78e48a5b00"><div class="ttname"><a href="namespacellvm.html#a607b7fac55adc5ea9ed40a78e48a5b00">llvm::getKnownAlignment</a></div><div class="ttdeci">Align getKnownAlignment(Value *V, const DataLayout &amp;DL, const Instruction *CxtI=nullptr, AssumptionCache *AC=nullptr, const DominatorTree *DT=nullptr)</div><div class="ttdoc">Try to infer an alignment for the specified pointer.</div><div class="ttdef"><b>Definition:</b> <a href="Transforms_2Utils_2Local_8h_source.html#l00222">Local.h:222</a></div></div>
<div class="ttc" id="aIntrinsics_8h_html"><div class="ttname"><a href="Intrinsics_8h.html">Intrinsics.h</a></div></div>
<div class="ttc" id="aREADME__ALTIVEC_8txt_html_a9aacd9146afe44bf656cd664e2a88c8c"><div class="ttname"><a href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a></div><div class="ttdeci">(vector float) vec_cmpeq(*A, *B) C</div><div class="ttdef"><b>Definition:</b> <a href="README__ALTIVEC_8txt_source.html#l00086">README_ALTIVEC.txt:86</a></div></div>
<div class="ttc" id="anamespacellvm_html_a0eea77e7bfa82e0219d2ec7b4efbc94f"><div class="ttname"><a href="namespacellvm.html#a0eea77e7bfa82e0219d2ec7b4efbc94f">llvm::popcount</a></div><div class="ttdeci">int popcount(T Value) noexcept</div><div class="ttdoc">Count the number of set bits in a value.</div><div class="ttdef"><b>Definition:</b> <a href="bit_8h_source.html#l00349">bit.h:349</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ARM__PROC_html_aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5"><div class="ttname"><a href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">llvm::ARM_PROC::A</a></div><div class="ttdeci">@ A</div><div class="ttdef"><b>Definition:</b> <a href="MCTargetDesc_2ARMBaseInfo_8h_source.html#l00034">ARMBaseInfo.h:34</a></div></div>
<div class="ttc" id="aInstrTypes_8h_html"><div class="ttname"><a href="InstrTypes_8h.html">InstrTypes.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_a83b8c9e572130f403445c0b0f69b837c"><div class="ttname"><a href="classllvm_1_1CallBase.html#a83b8c9e572130f403445c0b0f69b837c">llvm::CallBase::getCalledFunction</a></div><div class="ttdeci">Function * getCalledFunction() const</div><div class="ttdoc">Returns the function called, or null if this is an indirect function invocation or the function signa...</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01406">InstrTypes.h:1406</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLowering_html"><div class="ttname"><a href="classllvm_1_1TargetLowering.html">llvm::TargetLowering</a></div><div class="ttdoc">This class defines information used to lower LLVM code to legal SelectionDAG operators that the targe...</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l03515">TargetLowering.h:3515</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a0ed5f3ab3c2e4196ee0cffffa080c062"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">llvm::BasicBlock::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdoc">Instruction iterator methods.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00314">BasicBlock.h:314</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a1f8d2859994eb10cdca39be26aa929bc"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a1f8d2859994eb10cdca39be26aa929bc">llvm::TargetLoweringBase::isMaskAndCmp0FoldingBeneficial</a></div><div class="ttdeci">virtual bool isMaskAndCmp0FoldingBeneficial(const Instruction &amp;AndI) const</div><div class="ttdoc">Return if the target supports combining a chain like:</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l00671">TargetLowering.h:671</a></div></div>
<div class="ttc" id="aclassllvm_1_1FCmpInst_html"><div class="ttname"><a href="classllvm_1_1FCmpInst.html">llvm::FCmpInst</a></div><div class="ttdoc">This instruction compares its operands according to the predicate given to the constructor.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01371">Instructions.h:1371</a></div></div>
<div class="ttc" id="aclassllvm_1_1BranchProbabilityInfo_html"><div class="ttname"><a href="classllvm_1_1BranchProbabilityInfo.html">llvm::BranchProbabilityInfo</a></div><div class="ttdoc">Analysis providing branch probability information.</div><div class="ttdef"><b>Definition:</b> <a href="BranchProbabilityInfo_8h_source.html#l00113">BranchProbabilityInfo.h:113</a></div></div>
<div class="ttc" id="aOcamlGCPrinter_8cpp_html_afcf2f797ed287a723263583c9b1c1bce"><div class="ttname"><a href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a></div><div class="ttdeci">static GCMetadataPrinterRegistry::Add&lt; OcamlGCMetadataPrinter &gt; Y(&quot;ocaml&quot;, &quot;ocaml 3.10-compatible collector&quot;)</div></div>
<div class="ttc" id="aclassllvm_1_1MDBuilder_html_ad910125a9cfd76aaad7f69469df22f66"><div class="ttname"><a href="classllvm_1_1MDBuilder.html#ad910125a9cfd76aaad7f69469df22f66">llvm::MDBuilder::createBranchWeights</a></div><div class="ttdeci">MDNode * createBranchWeights(uint32_t TrueWeight, uint32_t FalseWeight)</div><div class="ttdoc">Return metadata containing two branch weights.</div><div class="ttdef"><b>Definition:</b> <a href="MDBuilder_8cpp_source.html#l00037">MDBuilder.cpp:37</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_ad2bfc3e2f7b1661868517e662ac7496c"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#ad2bfc3e2f7b1661868517e662ac7496c">optimizeBranch</a></div><div class="ttdeci">static bool optimizeBranch(BranchInst *Branch, const TargetLowering &amp;TLI, SmallSet&lt; BasicBlock *, 32 &gt; &amp;FreshBBs, bool IsHugeFunc)</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l07956">CodeGenPrepare.cpp:7956</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a8f708e28c4cf4fcdbbe363849b779a00"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a8f708e28c4cf4fcdbbe363849b779a00">llvm::TargetTransformInfo::getIntImmCost</a></div><div class="ttdeci">InstructionCost getIntImmCost(const APInt &amp;Imm, Type *Ty, TargetCostKind CostKind) const</div><div class="ttdoc">Return the expected cost of materializing for the given integer immediate of the specified type.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00618">TargetTransformInfo.cpp:618</a></div></div>
<div class="ttc" id="aSIInstrInfo_8cpp_html_a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791"><div class="ttname"><a href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a></div><div class="ttdeci">@ SI</div><div class="ttdef"><b>Definition:</b> <a href="SIInstrInfo_8cpp_source.html#l07993">SIInstrInfo.cpp:7993</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisUsage_html"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html">llvm::AnalysisUsage</a></div><div class="ttdoc">Represent the analysis usage information of a pass.</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00047">PassAnalysisSupport.h:47</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantExpr_html_a652380f28d1a7011e05d0787b6024d48"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#a652380f28d1a7011e05d0787b6024d48">llvm::ConstantExpr::getPtrToInt</a></div><div class="ttdeci">static Constant * getPtrToInt(Constant *C, Type *Ty, bool OnlyIfReduced=false)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l02201">Constants.cpp:2201</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ms__demangle_html_afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e"><div class="ttname"><a href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">llvm::ms_demangle::QualifierMangleMode::Result</a></div><div class="ttdeci">@ Result</div></div>
<div class="ttc" id="aRISCVRedundantCopyElimination_8cpp_html_a1441f79530bc7f3a89118bb8067eac69"><div class="ttname"><a href="RISCVRedundantCopyElimination_8cpp.html#a1441f79530bc7f3a89118bb8067eac69">TBB</a></div><div class="ttdeci">const SmallVectorImpl&lt; MachineOperand &gt; MachineBasicBlock * TBB</div><div class="ttdef"><b>Definition:</b> <a href="RISCVRedundantCopyElimination_8cpp_source.html#l00076">RISCVRedundantCopyElimination.cpp:76</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1PALMD_html_af892c75285b0f64d58ca76cb73059adf"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">llvm::AMDGPU::PALMD::Key</a></div><div class="ttdeci">Key</div><div class="ttdoc">PAL metadata keys.</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUMetadata_8h_source.html#l00486">AMDGPUMetadata.h:486</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_ab01d8694a759a934e01f1c558c3ce862"><div class="ttname"><a href="classllvm_1_1APInt.html#ab01d8694a759a934e01f1c558c3ce862">llvm::APInt::getLimitedValue</a></div><div class="ttdeci">uint64_t getLimitedValue(uint64_t Limit=UINT64_MAX) const</div><div class="ttdoc">If this value is smaller than the specified limit, return it, otherwise return the limit value.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00463">APInt.h:463</a></div></div>
<div class="ttc" id="aTargetLibraryInfo_8h_html"><div class="ttname"><a href="TargetLibraryInfo_8h.html">TargetLibraryInfo.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a1bc022868b23918efa44df511f4d5b61"><div class="ttname"><a href="classllvm_1_1Type.html#a1bc022868b23918efa44df511f4d5b61">llvm::Type::isVectorTy</a></div><div class="ttdeci">bool isVectorTy() const</div><div class="ttdoc">True if this is an instance of VectorType.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00258">Type.h:258</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a80725805c0e5e9fe87b7d6f3e147c1c1"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a80725805c0e5e9fe87b7d6f3e147c1c1">llvm::TargetLoweringBase::canCombineStoreAndExtract</a></div><div class="ttdeci">virtual bool canCombineStoreAndExtract(Type *VectorTy, Value *Idx, unsigned &amp;Cost) const</div><div class="ttdoc">Return true if the target can combine store(extractelement VectorTy, Idx).</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l00809">TargetLowering.h:809</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a04353aa48874f9bda89ff9059cd1a5a6"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a04353aa48874f9bda89ff9059cd1a5a6">llvm::PatternMatch::m_Instruction</a></div><div class="ttdeci">bind_ty&lt; Instruction &gt; m_Instruction(Instruction *&amp;I)</div><div class="ttdoc">Match an instruction, capturing it if we match.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00716">PatternMatch.h:716</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_aecb93439702247fe5353a9966f7cefcd"><div class="ttname"><a href="classllvm_1_1Value.html#aecb93439702247fe5353a9966f7cefcd">llvm::Value::uses</a></div><div class="ttdeci">iterator_range&lt; use_iterator &gt; uses()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00376">Value.h:376</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_aff1b7225e361646f1310cc578b2163c3"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#aff1b7225e361646f1310cc578b2163c3">EnableICMP_EQToICMP_ST</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; EnableICMP_EQToICMP_ST(&quot;cgp-icmp-eq2icmp-st&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Enable ICMP_EQ to ICMP_S(L|G)T conversion.&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a161fd4e9fa5367f64c2a4c9e921c3ad3"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a161fd4e9fa5367f64c2a4c9e921c3ad3">llvm::BasicBlock::getFirstInsertionPt</a></div><div class="ttdeci">const_iterator getFirstInsertionPt() const</div><div class="ttdoc">Returns an iterator to the first instruction in this block that is suitable for inserting a non-PHI i...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00245">BasicBlock.cpp:245</a></div></div>
<div class="ttc" id="astructllvm_1_1SimplifyQuery_html_a0ffb6d79f6befe2030328bd1d7110feb"><div class="ttname"><a href="structllvm_1_1SimplifyQuery.html#a0ffb6d79f6befe2030328bd1d7110feb">llvm::SimplifyQuery::DL</a></div><div class="ttdeci">const DataLayout &amp; DL</div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8h_source.html#l00094">InstructionSimplify.h:94</a></div></div>
<div class="ttc" id="anamespacefalse_html"><div class="ttname"><a href="namespacefalse.html">false</a></div><div class="ttdef"><b>Definition:</b> <a href="StackSlotColoring_8cpp_source.html#l00141">StackSlotColoring.cpp:141</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_abc3a06deec19e97d921adc67d7828492"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#abc3a06deec19e97d921adc67d7828492">MaxMemoryUsesToScan</a></div><div class="ttdeci">static constexpr int MaxMemoryUsesToScan</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l04968">CodeGenPrepare.cpp:4968</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a161843eda8a79a43aebb063c9268a96c"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a161843eda8a79a43aebb063c9268a96c">llvm::TargetLoweringBase::isSelectSupported</a></div><div class="ttdeci">virtual bool isSelectSupported(SelectSupportKind) const</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l00445">TargetLowering.h:445</a></div></div>
<div class="ttc" id="anamespacellvm_1_1dwarf_html_a5d3c920b66ea797d6adb243862fdf47a"><div class="ttname"><a href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">llvm::dwarf::Index</a></div><div class="ttdeci">Index</div><div class="ttdef"><b>Definition:</b> <a href="Dwarf_8h_source.html#l00550">Dwarf.h:550</a></div></div>
<div class="ttc" id="astructllvm_1_1MaybeAlign_html"><div class="ttname"><a href="structllvm_1_1MaybeAlign.html">llvm::MaybeAlign</a></div><div class="ttdoc">This struct is a compact representation of a valid (power of two) or undefined (0) alignment.</div><div class="ttdef"><b>Definition:</b> <a href="Alignment_8h_source.html#l00117">Alignment.h:117</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a2cbdca7c8267aac6914d674f8e81841b"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a2cbdca7c8267aac6914d674f8e81841b">llvm::PatternMatch::m_ZExt</a></div><div class="ttdeci">CastClass_match&lt; OpTy, Instruction::ZExt &gt; m_ZExt(const OpTy &amp;Op)</div><div class="ttdoc">Matches ZExt.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01629">PatternMatch.h:1629</a></div></div>
<div class="ttc" id="aBuiltinGCs_8cpp_html_a7abf5fb4071cb25dbce06dfb5ee3c937"><div class="ttname"><a href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a></div><div class="ttdeci">static GCRegistry::Add&lt; OcamlGC &gt; B(&quot;ocaml&quot;, &quot;ocaml 3.10-compatible GC&quot;)</div></div>
<div class="ttc" id="anamespacellvm_1_1MIPatternMatch_html_a42b1e7334c8da7ebef6e192f085eb563"><div class="ttname"><a href="namespacellvm_1_1MIPatternMatch.html#a42b1e7334c8da7ebef6e192f085eb563">llvm::MIPatternMatch::m_ZeroInt</a></div><div class="ttdeci">SpecificConstantMatch m_ZeroInt()</div><div class="ttdoc">{ Convenience matchers for specific integer values.</div><div class="ttdef"><b>Definition:</b> <a href="MIPatternMatch_8h_source.html#l00238">MIPatternMatch.h:238</a></div></div>
<div class="ttc" id="astructNodeList_html"><div class="ttname"><a href="structNodeList.html">NodeList</a></div><div class="ttdef"><b>Definition:</b> <a href="MicrosoftDemangle_8cpp_source.html#l00037">MicrosoftDemangle.cpp:37</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_adfb61ffe25c950c75c86310245b3ef39"><div class="ttname"><a href="classllvm_1_1PHINode.html#adfb61ffe25c950c75c86310245b3ef39">llvm::PHINode::getIncomingValueForBlock</a></div><div class="ttdeci">Value * getIncomingValueForBlock(const BasicBlock *BB) const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02889">Instructions.h:2889</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_afa0b2fa29ba074f2b6ec9ac11163f2d9"><div class="ttname"><a href="classllvm_1_1Instruction.html#afa0b2fa29ba074f2b6ec9ac11163f2d9">llvm::Instruction::CastOps</a></div><div class="ttdeci">CastOps</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00823">Instruction.h:823</a></div></div>
<div class="ttc" id="aclassllvm_1_1BinaryOperator_html_a31bf07f3f61525486633bc1d0bbaf029"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html#a31bf07f3f61525486633bc1d0bbaf029">llvm::BinaryOperator::getOpcode</a></div><div class="ttdeci">BinaryOps getOpcode() const</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00391">InstrTypes.h:391</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a677ac8d99ff3c2d32a95c21de9ed372c"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">llvm::PatternMatch::m_ConstantInt</a></div><div class="ttdeci">class_match&lt; ConstantInt &gt; m_ConstantInt()</div><div class="ttdoc">Match an arbitrary ConstantInt and ignore it.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00147">PatternMatch.h:147</a></div></div>
<div class="ttc" id="astructllvm_1_1EVT_html_af975bf04c49cc895cfe38e7dc126a2f1"><div class="ttname"><a href="structllvm_1_1EVT.html#af975bf04c49cc895cfe38e7dc126a2f1">llvm::EVT::isInteger</a></div><div class="ttdeci">bool isInteger() const</div><div class="ttdoc">Return true if this is an integer or a vector integer type.</div><div class="ttdef"><b>Definition:</b> <a href="ValueTypes_8h_source.html#l00144">ValueTypes.h:144</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html"><div class="ttname"><a href="classllvm_1_1Instruction.html">llvm::Instruction</a></div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00041">Instruction.h:41</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a9f382207d841377156d4c7868b66b9a5"><div class="ttname"><a href="classllvm_1_1Type.html#a9f382207d841377156d4c7868b66b9a5">llvm::Type::getScalarSizeInBits</a></div><div class="ttdeci">unsigned getScalarSizeInBits() const LLVM_READONLY</div><div class="ttdoc">If this is a vector type, return the getPrimitiveSizeInBits value for the element type.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00188">Type.cpp:188</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_afa3aef362a1dcff57193d4e6a54f7044"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#afa3aef362a1dcff57193d4e6a54f7044">llvm::TargetLoweringBase::isLegalAddressingMode</a></div><div class="ttdeci">virtual bool isLegalAddressingMode(const DataLayout &amp;DL, const AddrMode &amp;AM, Type *Ty, unsigned AddrSpace, Instruction *I=nullptr) const</div><div class="ttdoc">Return true if the addressing mode represented by AM is legal for this target, for a load/store of th...</div><div class="ttdef"><b>Definition:</b> <a href="TargetLoweringBase_8cpp_source.html#l01916">TargetLoweringBase.cpp:1916</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a7af604b3a6b3a44113d4c54c5c04d031"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a7af604b3a6b3a44113d4c54c5c04d031">llvm::PatternMatch::m_c_Or</a></div><div class="ttdeci">BinaryOp_match&lt; LHS, RHS, Instruction::Or, true &gt; m_c_Or(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdoc">Matches an Or with LHS and RHS in either order.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l02269">PatternMatch.h:2269</a></div></div>
<div class="ttc" id="aMDBuilder_8h_html"><div class="ttname"><a href="MDBuilder_8h.html">MDBuilder.h</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a3cc8a3a2506bf528398d0aef0850f31a"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a3cc8a3a2506bf528398d0aef0850f31a">SinkCast</a></div><div class="ttdeci">static bool SinkCast(CastInst *CI)</div><div class="ttdoc">Sink the specified cast instruction into its user blocks.</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l01307">CodeGenPrepare.cpp:1307</a></div></div>
<div class="ttc" id="anamespacellvm_html_a26be1141b23850a2b4eb78021d99e862"><div class="ttname"><a href="namespacellvm.html#a26be1141b23850a2b4eb78021d99e862">llvm::salvageDebugInfo</a></div><div class="ttdeci">void salvageDebugInfo(const MachineRegisterInfo &amp;MRI, MachineInstr &amp;MI)</div><div class="ttdoc">Assuming the instruction MI is going to be deleted, attempt to salvage debug users of MI by writing t...</div><div class="ttdef"><b>Definition:</b> <a href="CodeGen_2GlobalISel_2Utils_8cpp_source.html#l01367">Utils.cpp:1367</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a72516971c5734dc0f7546e64affca425"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a72516971c5734dc0f7546e64affca425">llvm::BasicBlock::phis</a></div><div class="ttdeci">iterator_range&lt; const_phi_iterator &gt; phis() const</div><div class="ttdoc">Returns a range that iterates over the phis in the basic block.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00372">BasicBlock.h:372</a></div></div>
<div class="ttc" id="anamespacellvm_html_a0bf75467957937ad23ad7be19f489934"><div class="ttname"><a href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">llvm::STATISTIC</a></div><div class="ttdeci">STATISTIC(NumFunctions, &quot;Total number of functions&quot;)</div></div>
<div class="ttc" id="aclassllvm_1_1raw__ostream_html"><div class="ttname"><a href="classllvm_1_1raw__ostream.html">llvm::raw_ostream</a></div><div class="ttdoc">This class implements an extremely fast bulk output stream that can only output to a stream.</div><div class="ttdef"><b>Definition:</b> <a href="raw__ostream_8h_source.html#l00052">raw_ostream.h:52</a></div></div>
<div class="ttc" id="aLoopDeletion_8cpp_html_a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64"><div class="ttname"><a href="LoopDeletion_8cpp.html#a0f1c83c3d08d80b12c424962a5e94ce8a35e0c8c0b180c95d4e122e55ed62cc64">LoopDeletionResult::Modified</a></div><div class="ttdeci">@ Modified</div></div>
<div class="ttc" id="aRegAllocFast_8cpp_html_a0eda39ffaf32662a7ae6f4dbe998711b"><div class="ttname"><a href="RegAllocFast_8cpp.html#a0eda39ffaf32662a7ae6f4dbe998711b">dominates</a></div><div class="ttdeci">static bool dominates(MachineBasicBlock &amp;MBB, MachineBasicBlock::const_iterator A, MachineBasicBlock::const_iterator B)</div><div class="ttdef"><b>Definition:</b> <a href="RegAllocFast_8cpp_source.html#l00343">RegAllocFast.cpp:343</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_ad0b3d8447f88377b62d9c019f3c4e118"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#ad0b3d8447f88377b62d9c019f3c4e118">llvm::SmallVectorImpl::resize</a></div><div class="ttdeci">void resize(size_type N)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00642">SmallVector.h:642</a></div></div>
<div class="ttc" id="anamespacellvm_html_a5ee0a415cf089775fd277550b257f74e"><div class="ttname"><a href="namespacellvm.html#a5ee0a415cf089775fd277550b257f74e">llvm::operator&lt;&lt;</a></div><div class="ttdeci">raw_ostream &amp; operator&lt;&lt;(raw_ostream &amp;OS, const APFixedPoint &amp;FX)</div><div class="ttdef"><b>Definition:</b> <a href="APFixedPoint_8h_source.html#l00292">APFixedPoint.h:292</a></div></div>
<div class="ttc" id="aclassllvm_1_1UndefValue_html_a4ae5ff22b700a42bcc5d889233721335"><div class="ttname"><a href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">llvm::UndefValue::get</a></div><div class="ttdeci">static UndefValue * get(Type *T)</div><div class="ttdoc">Static factory methods - Return an 'undef' object of the specified type.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01740">Constants.cpp:1740</a></div></div>
<div class="ttc" id="aclassllvm_1_1cl_1_1Option_html_a2dc75fafb68e7669e776e19da7857cdf"><div class="ttname"><a href="classllvm_1_1cl_1_1Option.html#a2dc75fafb68e7669e776e19da7857cdf">llvm::cl::Option::getNumOccurrences</a></div><div class="ttdeci">int getNumOccurrences() const</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00401">CommandLine.h:401</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_a969709dd49c28865a482d8b870f87c46"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">llvm::ConstantInt::get</a></div><div class="ttdeci">static Constant * get(Type *Ty, uint64_t V, bool IsSigned=false)</div><div class="ttdoc">If Ty is a vector type, return a Constant with a splat of the given value.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00887">Constants.cpp:887</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AArch64PACKey_html_abf4394f452bde3f544999858d71e4b46aaf2ff1a10f3f3b211d7781a33e4c1e05"><div class="ttname"><a href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46aaf2ff1a10f3f3b211d7781a33e4c1e05">llvm::AArch64PACKey::IA</a></div><div class="ttdeci">@ IA</div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00791">AArch64BaseInfo.h:791</a></div></div>
<div class="ttc" id="aSmallPtrSet_8h_html"><div class="ttname"><a href="SmallPtrSet_8h.html">SmallPtrSet.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a0fd53f63d349dc8a7c5fc0cdd7a94c8d"><div class="ttname"><a href="classllvm_1_1Instruction.html#a0fd53f63d349dc8a7c5fc0cdd7a94c8d">llvm::Instruction::removeFromParent</a></div><div class="ttdeci">void removeFromParent()</div><div class="ttdoc">This method unlinks 'this' from the containing basic block, but does not delete it.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00078">Instruction.cpp:78</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a0049977ff1075a98e9f512bbf4d181a6"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a0049977ff1075a98e9f512bbf4d181a6">sinkAndCmp0Expression</a></div><div class="ttdeci">static bool sinkAndCmp0Expression(Instruction *AndI, const TargetLowering &amp;TLI, SetOfInstrs &amp;InsertedInsts)</div><div class="ttdoc">Duplicate and sink the given 'and' instruction into user blocks where it is used in a compare to allo...</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l01849">CodeGenPrepare.cpp:1849</a></div></div>
<div class="ttc" id="aPatternMatch_8h_html"><div class="ttname"><a href="PatternMatch_8h.html">PatternMatch.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_a08f3f942afc0ee9115a8f9fa87e9191d"><div class="ttname"><a href="namespacellvm.html#a08f3f942afc0ee9115a8f9fa87e9191d">llvm::RemoveRedundantDbgInstrs</a></div><div class="ttdeci">bool RemoveRedundantDbgInstrs(BasicBlock *BB)</div><div class="ttdoc">Try to remove redundant dbg.value instructions from given basic block.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockUtils_8cpp_source.html#l00538">BasicBlockUtils.cpp:538</a></div></div>
<div class="ttc" id="astructllvm_1_1TargetTransformInfo_1_1OperandValueInfo_html_a930b0b2be537d928348aa0946f61dcd6"><div class="ttname"><a href="structllvm_1_1TargetTransformInfo_1_1OperandValueInfo.html#a930b0b2be537d928348aa0946f61dcd6">llvm::TargetTransformInfo::OperandValueInfo::Kind</a></div><div class="ttdeci">OperandValueKind Kind</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00948">TargetTransformInfo.h:948</a></div></div>
<div class="ttc" id="astructllvm_1_1Align_html"><div class="ttname"><a href="structllvm_1_1Align.html">llvm::Align</a></div><div class="ttdoc">This struct is a compact representation of a valid (non-zero power of two) alignment.</div><div class="ttdef"><b>Definition:</b> <a href="Alignment_8h_source.html#l00039">Alignment.h:39</a></div></div>
<div class="ttc" id="anamespacellvm_1_1MCID_html_ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f"><div class="ttname"><a href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">llvm::MCID::Call</a></div><div class="ttdeci">@ Call</div><div class="ttdef"><b>Definition:</b> <a href="MCInstrDesc_8h_source.html#l00156">MCInstrDesc.h:156</a></div></div>
<div class="ttc" id="aclassllvm_1_1generic__gep__type__iterator_html_a85d7503cec5ee995092c137a7c0516a8"><div class="ttname"><a href="classllvm_1_1generic__gep__type__iterator.html#a85d7503cec5ee995092c137a7c0516a8">llvm::generic_gep_type_iterator::getStructTypeOrNull</a></div><div class="ttdeci">StructType * getStructTypeOrNull() const</div><div class="ttdef"><b>Definition:</b> <a href="GetElementPtrTypeIterator_8h_source.html#l00116">GetElementPtrTypeIterator.h:116</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a18c621c39394892e502cf03313e04bf7"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a18c621c39394892e502cf03313e04bf7">llvm::TargetLoweringBase::isEqualityCmpFoldedWithSignedCmp</a></div><div class="ttdeci">virtual bool isEqualityCmpFoldedWithSignedCmp() const</div><div class="ttdoc">Return true if instruction generated for equality comparison is folded with instruction generated for...</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l00649">TargetLowering.h:649</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html_aaf9ee38b9973681c1720aaf03af3a069"><div class="ttname"><a href="classllvm_1_1SetVector.html#aaf9ee38b9973681c1720aaf03af3a069">llvm::SetVector&lt; T, SmallVector&lt; T, N &gt;, SmallDenseSet&lt; T, N &gt; &gt;::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdoc">Determine if the SetVector is empty or not.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00072">SetVector.h:72</a></div></div>
<div class="ttc" id="astructllvm_1_1EVT_html_a3bf257bfbd279ecfad670be03b00210e"><div class="ttname"><a href="structllvm_1_1EVT.html#a3bf257bfbd279ecfad670be03b00210e">llvm::EVT::bitsLT</a></div><div class="ttdeci">bool bitsLT(EVT VT) const</div><div class="ttdoc">Return true if this has less bits than VT.</div><div class="ttdef"><b>Definition:</b> <a href="ValueTypes_8h_source.html#l00272">ValueTypes.h:272</a></div></div>
<div class="ttc" id="aclassllvm_1_1GCProjectionInst_html_a6cffcfabac72ca61185ea24c1208b937"><div class="ttname"><a href="classllvm_1_1GCProjectionInst.html#a6cffcfabac72ca61185ea24c1208b937">llvm::GCProjectionInst::getStatepoint</a></div><div class="ttdeci">const Value * getStatepoint() const</div><div class="ttdoc">The statepoint with which this gc.relocate is associated.</div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8cpp_source.html#l00792">IntrinsicInst.cpp:792</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_aef51af4b490af6b3bf2dfbc8737a8f9f"><div class="ttname"><a href="classllvm_1_1PHINode.html#aef51af4b490af6b3bf2dfbc8737a8f9f">llvm::PHINode::getNumIncomingValues</a></div><div class="ttdeci">unsigned getNumIncomingValues() const</div><div class="ttdoc">Return the number of incoming edges.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02790">Instructions.h:2790</a></div></div>
<div class="ttc" id="aclassllvm_1_1ValueMap_html_a49dc44e6a66de10991ee34e1df0d8065"><div class="ttname"><a href="classllvm_1_1ValueMap.html#a49dc44e6a66de10991ee34e1df0d8065">llvm::ValueMap::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="ValueMap_8h_source.html#l00145">ValueMap.h:145</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ISD_html_a22ea9cec080dd5f4f47ba234c2f59110a4ffc75d65231b55461c0ba4f36a3e500"><div class="ttname"><a href="namespacellvm_1_1ISD.html#a22ea9cec080dd5f4f47ba234c2f59110a4ffc75d65231b55461c0ba4f36a3e500">llvm::ISD::USUBO</a></div><div class="ttdeci">@ USUBO</div><div class="ttdef"><b>Definition:</b> <a href="ISDOpcodes_8h_source.html#l00328">ISDOpcodes.h:328</a></div></div>
<div class="ttc" id="aStatepoint_8h_html"><div class="ttname"><a href="Statepoint_8h.html">Statepoint.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a13e877ef779ba7a0688081079f4f9b03"><div class="ttname"><a href="classllvm_1_1Type.html#a13e877ef779ba7a0688081079f4f9b03">llvm::Type::getIntegerBitWidth</a></div><div class="ttdeci">unsigned getIntegerBitWidth() const</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00097">DerivedTypes.h:97</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a9d7de807ebdfe1819df3ff6cb0f16158"><div class="ttname"><a href="classllvm_1_1Value.html#a9d7de807ebdfe1819df3ff6cb0f16158">llvm::Value::use_empty</a></div><div class="ttdeci">bool use_empty() const</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00344">Value.h:344</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_ae51b73b67e301b063abfdd618fc6537e"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#ae51b73b67e301b063abfdd618fc6537e">DisableBranchOpts</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; DisableBranchOpts(&quot;disable-cgp-branch-opts&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Disable branch optimizations in CodeGenPrepare&quot;))</div></div>
<div class="ttc" id="anamespacellvm_1_1CallingConv_html_a188c0836f8c3528401f1c236fd93b977"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">llvm::CallingConv::ID</a></div><div class="ttdeci">unsigned ID</div><div class="ttdoc">LLVM IR allows to use arbitrary numbers as calling convention identifiers.</div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00024">CallingConv.h:24</a></div></div>
<div class="ttc" id="aclassllvm_1_1ShuffleVectorInst_html_a50fe6a61ea745fb71fa8403af6e7deed"><div class="ttname"><a href="classllvm_1_1ShuffleVectorInst.html#a50fe6a61ea745fb71fa8403af6e7deed">llvm::ShuffleVectorInst::getType</a></div><div class="ttdeci">VectorType * getType() const</div><div class="ttdoc">Overload to return most specific vector type.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02063">Instructions.h:2063</a></div></div>
<div class="ttc" id="aType_8h_html"><div class="ttname"><a href="Type_8h.html">Type.h</a></div></div>
<div class="ttc" id="aErlangGCPrinter_8cpp_html_a74b474c0616ab55c1d9487f11fd31d26"><div class="ttname"><a href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a></div><div class="ttdeci">static GCMetadataPrinterRegistry::Add&lt; ErlangGCPrinter &gt; X(&quot;erlang&quot;, &quot;erlang-compatible garbage collector&quot;)</div></div>
<div class="ttc" id="aBranchProbability_8h_html"><div class="ttname"><a href="BranchProbability_8h.html">BranchProbability.h</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a3b82cff474790446f1288f1a086c1cd6"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a3b82cff474790446f1288f1a086c1cd6">OptimizeNoopCopyExpression</a></div><div class="ttdeci">static bool OptimizeNoopCopyExpression(CastInst *CI, const TargetLowering &amp;TLI, const DataLayout &amp;DL)</div><div class="ttdoc">If the specified cast instruction is a noop copy (e.g.</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l01376">CodeGenPrepare.cpp:1376</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_aebdb2700a77d10ae6f0ce115e23d9f77"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#aebdb2700a77d10ae6f0ce115e23d9f77">llvm::PatternMatch::m_One</a></div><div class="ttdeci">cst_pred_ty&lt; is_one &gt; m_One()</div><div class="ttdoc">Match an integer 1 or a vector with all elements equal to 1.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00517">PatternMatch.h:517</a></div></div>
<div class="ttc" id="aPassSupport_8h_html_a74ce8276b89067e806f67c45a6d92575"><div class="ttname"><a href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a></div><div class="ttdeci">#define INITIALIZE_PASS_END(passName, arg, name, cfg, analysis)</div><div class="ttdef"><b>Definition:</b> <a href="PassSupport_8h_source.html#l00059">PassSupport.h:59</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_ae698328bd40b02d91f42a2d0cc2f4c27"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#ae698328bd40b02d91f42a2d0cc2f4c27">AddrSinkCombineBaseOffs</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; AddrSinkCombineBaseOffs(&quot;addr-sink-combine-base-offs&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Allow combining of BaseOffs field in Address sinking.&quot;))</div></div>
<div class="ttc" id="aLoopInfo_8h_html"><div class="ttname"><a href="LoopInfo_8h.html">LoopInfo.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1ProfileSummaryInfo_html"><div class="ttname"><a href="classllvm_1_1ProfileSummaryInfo.html">llvm::ProfileSummaryInfo</a></div><div class="ttdoc">Analysis providing profile information.</div><div class="ttdef"><b>Definition:</b> <a href="ProfileSummaryInfo_8h_source.html#l00040">ProfileSummaryInfo.h:40</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlockSectionsProfileReader_html_a31414298cda30f1d52c965571b4efc75"><div class="ttname"><a href="classllvm_1_1BasicBlockSectionsProfileReader.html#a31414298cda30f1d52c965571b4efc75">llvm::BasicBlockSectionsProfileReader::isFunctionHot</a></div><div class="ttdeci">bool isFunctionHot(StringRef FuncName) const</div></div>
<div class="ttc" id="aADT_2tmp_8txt_html_a07ed0bfaa124c15897944fe3eaa971ab"><div class="ttname"><a href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a></div><div class="ttdeci">Class for arbitrary precision integers APInt is a functional replacement for common case unsigned integer type like unsigned long or uint64_t</div><div class="ttdef"><b>Definition:</b> <a href="ADT_2tmp_8txt_source.html#l00001">tmp.txt:1</a></div></div>
<div class="ttc" id="aclassllvm_1_1InvokeInst_html"><div class="ttname"><a href="classllvm_1_1InvokeInst.html">llvm::InvokeInst</a></div><div class="ttdoc">Invoke instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03814">Instructions.h:3814</a></div></div>
<div class="ttc" id="anamespacellvm_html_acb22fb04083152eee862457e42e8dc31"><div class="ttname"><a href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">llvm::predecessors</a></div><div class="ttdeci">auto predecessors(const MachineBasicBlock *BB)</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l01266">MachineBasicBlock.h:1266</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html"><div class="ttname"><a href="classllvm_1_1CmpInst.html">llvm::CmpInst</a></div><div class="ttdoc">This class is the base class for the comparison instructions.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00708">InstrTypes.h:708</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_ac6d28a9b11139182134a9618028a0d07"><div class="ttname"><a href="classllvm_1_1Type.html#ac6d28a9b11139182134a9618028a0d07">llvm::Type::isIntegerTy</a></div><div class="ttdeci">bool isIntegerTy() const</div><div class="ttdoc">True if this is an instance of IntegerType.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00222">Type.h:222</a></div></div>
<div class="ttc" id="anamespacellvm_html_a74cdbd1e4f731e7d7cd83461b8b1de0b"><div class="ttname"><a href="namespacellvm.html#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a></div><div class="ttdeci">void sort(IteratorTy Start, IteratorTy End)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01683">STLExtras.h:1683</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_aa22118b2b3f206bfda2ffab4cda94d64"><div class="ttname"><a href="classllvm_1_1Value.html#aa22118b2b3f206bfda2ffab4cda94d64">llvm::Value::user_end</a></div><div class="ttdeci">user_iterator user_end()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00405">Value.h:405</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetPassConfig_html"><div class="ttname"><a href="classllvm_1_1TargetPassConfig.html">llvm::TargetPassConfig</a></div><div class="ttdoc">Target-Independent Code Generator Pass Configuration Options.</div><div class="ttdef"><b>Definition:</b> <a href="TargetPassConfig_8h_source.html#l00084">TargetPassConfig.h:84</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_aa41636955199b88164376e06e5914855"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#aa41636955199b88164376e06e5914855">llvm::PatternMatch::m_Shr</a></div><div class="ttdeci">BinOpPred_match&lt; LHS, RHS, is_right_shift_op &gt; m_Shr(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdoc">Matches logical shift operations.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01303">PatternMatch.h:1303</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a42e6689af9067a1afe64eac0267deb01"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a42e6689af9067a1afe64eac0267deb01">llvm::TargetLoweringBase::isCheapToSpeculateCttz</a></div><div class="ttdeci">virtual bool isCheapToSpeculateCttz(Type *Ty) const</div><div class="ttdoc">Return true if it is cheap to speculate a call to intrinsic cttz.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l00627">TargetLowering.h:627</a></div></div>
<div class="ttc" id="aclassllvm_1_1InlineAsm_html"><div class="ttname"><a href="classllvm_1_1InlineAsm.html">llvm::InlineAsm</a></div><div class="ttdef"><b>Definition:</b> <a href="InlineAsm_8h_source.html#l00033">InlineAsm.h:33</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImplBase_html_af8a50544090e81ac83601aff8f4b0142"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImplBase.html#af8a50544090e81ac83601aff8f4b0142">llvm::SmallPtrSetImplBase::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00092">SmallPtrSet.h:92</a></div></div>
<div class="ttc" id="aVectorUtils_8h_html"><div class="ttname"><a href="VectorUtils_8h.html">VectorUtils.h</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a9743916d4ba6931ccdd9500a52a31eca"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a9743916d4ba6931ccdd9500a52a31eca">AddrSinkNewPhis</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; AddrSinkNewPhis(&quot;addr-sink-new-phis&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Allow creation of Phis in Address sinking.&quot;))</div></div>
<div class="ttc" id="aBasicBlock_8h_html"><div class="ttname"><a href="BasicBlock_8h.html">BasicBlock.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1cl_1_1opt_html"><div class="ttname"><a href="classllvm_1_1cl_1_1opt.html">llvm::cl::opt&lt; bool &gt;</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoadInst_html_a161c2db145827f4e181e7fe662b53a81"><div class="ttname"><a href="classllvm_1_1LoadInst.html#a161c2db145827f4e181e7fe662b53a81">llvm::LoadInst::getPointerAddressSpace</a></div><div class="ttdeci">unsigned getPointerAddressSpace() const</div><div class="ttdoc">Returns the address space of the pointer operand.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00270">Instructions.h:270</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a109eb00135035c7badb12cece015c58d"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a109eb00135035c7badb12cece015c58d">generation</a></div><div class="ttdeci">Optimize for code generation</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l00485">CodeGenPrepare.cpp:485</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_aa4ab45481ecc1c8720e7a570b7c83be1"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#aa4ab45481ecc1c8720e7a570b7c83be1">llvm::TargetLoweringBase::getAddrModeArguments</a></div><div class="ttdeci">virtual bool getAddrModeArguments(IntrinsicInst *, SmallVectorImpl&lt; Value * &gt; &amp;, Type *&amp;) const</div><div class="ttdoc">CodeGenPrepare sinks address calculations into the same BB as Load/Store instructions reading the add...</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l02582">TargetLowering.h:2582</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_af6beea189959393ea5d461cf614e445e"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#af6beea189959393ea5d461cf614e445e">DisablePreheaderProtect</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; DisablePreheaderProtect(&quot;disable-preheader-prot&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Disable protection against removing loop preheaders&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1StoreInst_html"><div class="ttname"><a href="classllvm_1_1StoreInst.html">llvm::StoreInst</a></div><div class="ttdoc">An instruction for storing to memory.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00301">Instructions.h:301</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_ad897d4beb50aa8f0d4d2eaa08ac0987d"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#ad897d4beb50aa8f0d4d2eaa08ac0987d">IsNonLocalValue</a></div><div class="ttdeci">static bool IsNonLocalValue(Value *V, BasicBlock *BB)</div><div class="ttdoc">Return true if the specified values are defined in a different basic block than BB.</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l05184">CodeGenPrepare.cpp:5184</a></div></div>
<div class="ttc" id="aclassllvm_1_1GlobalValue_html"><div class="ttname"><a href="classllvm_1_1GlobalValue.html">llvm::GlobalValue</a></div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00044">GlobalValue.h:44</a></div></div>
<div class="ttc" id="anamespacellvm_1_1MipsISD_html_a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913"><div class="ttname"><a href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">llvm::MipsISD::Ext</a></div><div class="ttdeci">@ Ext</div><div class="ttdef"><b>Definition:</b> <a href="MipsISelLowering_8h_source.html#l00159">MipsISelLowering.h:159</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a322205ba86118639511028b9577f3273"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a322205ba86118639511028b9577f3273">HugeFuncThresholdInCGPP</a></div><div class="ttdeci">static cl::opt&lt; unsigned &gt; HugeFuncThresholdInCGPP(&quot;cgpp-huge-func&quot;, cl::init(10000), cl::Hidden, cl::desc(&quot;Least BB number of huge function.&quot;))</div></div>
<div class="ttc" id="aSIInstrInfo_8cpp_html_a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd"><div class="ttname"><a href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a></div><div class="ttdeci">@ VI</div><div class="ttdef"><b>Definition:</b> <a href="SIInstrInfo_8cpp_source.html#l07994">SIInstrInfo.cpp:7994</a></div></div>
<div class="ttc" id="aclassllvm_1_1BlockFrequency_html"><div class="ttname"><a href="classllvm_1_1BlockFrequency.html">llvm::BlockFrequency</a></div><div class="ttdef"><b>Definition:</b> <a href="BlockFrequency_8h_source.html#l00023">BlockFrequency.h:23</a></div></div>
<div class="ttc" id="aclassllvm_1_1Constant_html"><div class="ttname"><a href="classllvm_1_1Constant.html">llvm::Constant</a></div><div class="ttdoc">This is an important base class in LLVM.</div><div class="ttdef"><b>Definition:</b> <a href="Constant_8h_source.html#l00041">Constant.h:41</a></div></div>
<div class="ttc" id="anamespacellvm_1_1pdb_html_ac10322dc19a928c2dbb83ec9689dc23cadd7bf230fde8d4836917806aff6a6b27"><div class="ttname"><a href="namespacellvm_1_1pdb.html#ac10322dc19a928c2dbb83ec9689dc23cadd7bf230fde8d4836917806aff6a6b27">llvm::pdb::PDB_ColorItem::Address</a></div><div class="ttdeci">@ Address</div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_ac0f09c2c9951158f9eecfaf7068d7b20"><div class="ttname"><a href="classllvm_1_1Value.html#ac0f09c2c9951158f9eecfaf7068d7b20">llvm::Value::mutateType</a></div><div class="ttdeci">void mutateType(Type *Ty)</div><div class="ttdoc">Mutate the type of this Value to be of the specified type.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00798">Value.h:798</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallSet_html_a2a98f19750ba941ce791b75ca6d77e48"><div class="ttname"><a href="classllvm_1_1SmallSet.html#a2a98f19750ba941ce791b75ca6d77e48">llvm::SmallSet::count</a></div><div class="ttdeci">size_type count(const T &amp;V) const</div><div class="ttdoc">count - Return 1 if the element is in the set, 0 otherwise.</div><div class="ttdef"><b>Definition:</b> <a href="SmallSet_8h_source.html#l00164">SmallSet.h:164</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetMachine_html_a321fbc5faf6c190cd1f90c19c3101cb4"><div class="ttname"><a href="classllvm_1_1TargetMachine.html#a321fbc5faf6c190cd1f90c19c3101cb4">llvm::TargetMachine::isNoopAddrSpaceCast</a></div><div class="ttdeci">virtual bool isNoopAddrSpaceCast(unsigned SrcAS, unsigned DestAS) const</div><div class="ttdoc">Returns true if a cast between SrcAS and DestAS is a noop.</div><div class="ttdef"><b>Definition:</b> <a href="Target_2TargetMachine_8h_source.html#l00318">TargetMachine.h:318</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_ab0f1e7b38e65d10c01900bd4d458a03b"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#ab0f1e7b38e65d10c01900bd4d458a03b">isIVIncrement</a></div><div class="ttdeci">static bool isIVIncrement(const Value *V, const LoopInfo *LI)</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l01453">CodeGenPrepare.cpp:1453</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_ae6b978645b8ac72d1a35e1298ffdd4f0"><div class="ttname"><a href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">llvm::Instruction::eraseFromParent</a></div><div class="ttdeci">SymbolTableList&lt; Instruction &gt;::iterator eraseFromParent()</div><div class="ttdoc">This method unlinks 'this' from the containing basic block and deletes it.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00082">Instruction.cpp:82</a></div></div>
<div class="ttc" id="aBranchProbabilityInfo_8h_html"><div class="ttname"><a href="BranchProbabilityInfo_8h.html">BranchProbabilityInfo.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1GCRelocateInst_html"><div class="ttname"><a href="classllvm_1_1GCRelocateInst.html">llvm::GCRelocateInst</a></div><div class="ttdoc">Represents calls to the gc.relocate intrinsic.</div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l01477">IntrinsicInst.h:1477</a></div></div>
<div class="ttc" id="astructllvm_1_1EVT_html_a45e76d44a189e456d52e37ba3dda0fce"><div class="ttname"><a href="structllvm_1_1EVT.html#a45e76d44a189e456d52e37ba3dda0fce">llvm::EVT::getSizeInBits</a></div><div class="ttdeci">TypeSize getSizeInBits() const</div><div class="ttdoc">Return the size of the specified value type in bits.</div><div class="ttdef"><b>Definition:</b> <a href="ValueTypes_8h_source.html#l00340">ValueTypes.h:340</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1Hwreg_html_a6110fc30bc7311a6cf99814530362e21"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1Hwreg.html#a6110fc30bc7311a6cf99814530362e21">llvm::AMDGPU::Hwreg::Offset</a></div><div class="ttdeci">Offset</div><div class="ttdef"><b>Definition:</b> <a href="SIDefines_8h_source.html#l00432">SIDefines.h:432</a></div></div>
<div class="ttc" id="aclassllvm_1_1MapVector_html_a6b0c3e15c351ba9682837c29b0a141b6"><div class="ttname"><a href="classllvm_1_1MapVector.html#a6b0c3e15c351ba9682837c29b0a141b6">llvm::MapVector::find</a></div><div class="ttdeci">iterator find(const KeyT &amp;Key)</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00148">MapVector.h:148</a></div></div>
<div class="ttc" id="aclassllvm_1_1GlobalObject_html_af3c010276b401e92a124e50fcef97fe1"><div class="ttname"><a href="classllvm_1_1GlobalObject.html#af3c010276b401e92a124e50fcef97fe1">llvm::GlobalObject::canIncreaseAlignment</a></div><div class="ttdeci">bool canIncreaseAlignment() const</div><div class="ttdoc">Returns true if the alignment of the value can be unilaterally increased.</div><div class="ttdef"><b>Definition:</b> <a href="Globals_8cpp_source.html#l00289">Globals.cpp:289</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_adf4e7878fc0b3b8dcde545178564190d"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#adf4e7878fc0b3b8dcde545178564190d">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00110">DenseMap.h:110</a></div></div>
<div class="ttc" id="aclassllvm_1_1ICmpInst_html"><div class="ttname"><a href="classllvm_1_1ICmpInst.html">llvm::ICmpInst</a></div><div class="ttdoc">This instruction compares its operands according to the predicate given to the constructor.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01197">Instructions.h:1197</a></div></div>
<div class="ttc" id="anamespacellvm_html_ab1772fd431decccb7926d484ea223db7"><div class="ttname"><a href="namespacellvm.html#ab1772fd431decccb7926d484ea223db7">llvm::count</a></div><div class="ttdeci">auto count(R &amp;&amp;Range, const E &amp;Element)</div><div class="ttdoc">Wrapper function around std::count to count the number of times an element Element occurs in the give...</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01896">STLExtras.h:1896</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLibraryInfoWrapperPass_html"><div class="ttname"><a href="classllvm_1_1TargetLibraryInfoWrapperPass.html">llvm::TargetLibraryInfoWrapperPass</a></div><div class="ttdef"><b>Definition:</b> <a href="TargetLibraryInfo_8h_source.html#l00565">TargetLibraryInfo.h:565</a></div></div>
<div class="ttc" id="aclassllvm_1_1StructLayout_html"><div class="ttname"><a href="classllvm_1_1StructLayout.html">llvm::StructLayout</a></div><div class="ttdoc">Used to lazily calculate structure layout information for a target machine, based on the DataLayout s...</div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00618">DataLayout.h:618</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_aca87c42e8556b7f2e73454d63efa87f2"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#aca87c42e8556b7f2e73454d63efa87f2">isPromotedInstructionLegal</a></div><div class="ttdeci">static bool isPromotedInstructionLegal(const TargetLowering &amp;TLI, const DataLayout &amp;DL, Value *Val)</div><div class="ttdoc">Check whether or not Val is a legal instruction for TLI.</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l04120">CodeGenPrepare.cpp:4120</a></div></div>
<div class="ttc" id="aProfileSummaryInfo_8h_html"><div class="ttname"><a href="ProfileSummaryInfo_8h.html">ProfileSummaryInfo.h</a></div></div>
<div class="ttc" id="aBypassSlowDivision_8h_html"><div class="ttname"><a href="BypassSlowDivision_8h.html">BypassSlowDivision.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_ab9933809d64070af5fc4400df7e38d58"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#ab9933809d64070af5fc4400df7e38d58">llvm::TargetLoweringBase::isLoadExtLegal</a></div><div class="ttdeci">bool isLoadExtLegal(unsigned ExtType, EVT ValVT, EVT MemVT) const</div><div class="ttdoc">Return true if the specified load with extension is legal on this target.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l01315">TargetLowering.h:1315</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfoWrapperPass_html"><div class="ttname"><a href="classllvm_1_1TargetTransformInfoWrapperPass.html">llvm::TargetTransformInfoWrapperPass</a></div><div class="ttdoc">Wrapper pass for TargetTransformInfo.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l02682">TargetTransformInfo.h:2682</a></div></div>
<div class="ttc" id="aBuiltinGCs_8cpp_html_a9bf617fd3367180fb96cebccfaae8dfa"><div class="ttname"><a href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a></div><div class="ttdeci">static GCRegistry::Add&lt; StatepointGC &gt; D(&quot;statepoint-example&quot;, &quot;an example strategy for statepoint&quot;)</div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a1a06b1cff93069d7403ea03e6150e386"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a1a06b1cff93069d7403ea03e6150e386">llvm::PatternMatch::m_LogicalOr</a></div><div class="ttdeci">LogicalOp_match&lt; LHS, RHS, Instruction::Or &gt; m_LogicalOr(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdoc">Matches L || R either in the form of L | R or L ? true : R.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l02574">PatternMatch.h:2574</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a80b305b278aa0e04f80312e15b2b6d54"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a80b305b278aa0e04f80312e15b2b6d54">llvm::TargetLoweringBase::isTypeLegal</a></div><div class="ttdeci">bool isTypeLegal(EVT VT) const</div><div class="ttdoc">Return true if the target has native support for the specified value type.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l00942">TargetLowering.h:942</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_ac3e586008202db1f802e906a489d7574"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#ac3e586008202db1f802e906a489d7574">GEPSequentialConstIndexed</a></div><div class="ttdeci">static bool GEPSequentialConstIndexed(GetElementPtrInst *GEP)</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l07790">CodeGenPrepare.cpp:7790</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ARM__MB_html_ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2"><div class="ttname"><a href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">llvm::ARM_MB::ST</a></div><div class="ttdeci">@ ST</div><div class="ttdef"><b>Definition:</b> <a href="MCTargetDesc_2ARMBaseInfo_8h_source.html#l00073">ARMBaseInfo.h:73</a></div></div>
<div class="ttc" id="aELFObjHandler_8cpp_html_a9df82a8be2f17e80535a8937bf23e022"><div class="ttname"><a href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a></div><div class="ttdeci">uint64_t Addr</div><div class="ttdef"><b>Definition:</b> <a href="ELFObjHandler_8cpp_source.html#l00079">ELFObjHandler.cpp:79</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a2fd1d2dc14e22227cfa8238778ab87b8"><div class="ttname"><a href="classllvm_1_1Instruction.html#a2fd1d2dc14e22227cfa8238778ab87b8">llvm::Instruction::user_back</a></div><div class="ttdeci">Instruction * user_back()</div><div class="ttdoc">Specialize the methods defined in Value, as we know that an instruction can only be used by other ins...</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00087">Instruction.h:87</a></div></div>
<div class="ttc" id="aclassllvm_1_1TruncInst_html"><div class="ttname"><a href="classllvm_1_1TruncInst.html">llvm::TruncInst</a></div><div class="ttdoc">This class represents a truncation of integer types.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l04813">Instructions.h:4813</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a35dc101b509721ffbfb58aba316de681a26f35604723482a1aee6514940c2987d"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a35dc101b509721ffbfb58aba316de681a26f35604723482a1aee6514940c2987d">llvm::TargetLoweringBase::TypePromoteInteger</a></div><div class="ttdeci">@ TypePromoteInteger</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l00208">TargetLowering.h:208</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_abf313eff420b7c6c8e322a2e9c53cd90"><div class="ttname"><a href="classllvm_1_1Type.html#abf313eff420b7c6c8e322a2e9c53cd90">llvm::Type::isIntOrPtrTy</a></div><div class="ttdeci">bool isIntOrPtrTy() const</div><div class="ttdoc">Return true if this is an integer type or a pointer type.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00237">Type.h:237</a></div></div>
<div class="ttc" id="astructllvm_1_1ExtAddrMode_html_a2404b5dd8b0a6746487c699291c54927"><div class="ttname"><a href="structllvm_1_1ExtAddrMode.html#a2404b5dd8b0a6746487c699291c54927">llvm::ExtAddrMode::BaseReg</a></div><div class="ttdeci">Register BaseReg</div><div class="ttdef"><b>Definition:</b> <a href="TargetInstrInfo_8h_source.html#l00088">TargetInstrInfo.h:88</a></div></div>
<div class="ttc" id="aSVEIntrinsicOpts_8cpp_html_a2bb87eb1bcbc74783a83ae945eb8fa36"><div class="ttname"><a href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a></div><div class="ttdeci">INITIALIZE_PASS_DEPENDENCY(DominatorTreeWrapperPass)</div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_aae3b959a0a2981340fd03c29f528f2f0"><div class="ttname"><a href="classllvm_1_1APInt.html#aae3b959a0a2981340fd03c29f528f2f0">llvm::APInt::logBase2</a></div><div class="ttdeci">unsigned logBase2() const</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01700">APInt.h:1700</a></div></div>
<div class="ttc" id="aclassllvm_1_1WeakTrackingVH_html_aed2f94ba7ecd4983f2c811f0d01f1398"><div class="ttname"><a href="classllvm_1_1WeakTrackingVH.html#aed2f94ba7ecd4983f2c811f0d01f1398">llvm::WeakTrackingVH::pointsToAliveValue</a></div><div class="ttdeci">bool pointsToAliveValue() const</div><div class="ttdef"><b>Definition:</b> <a href="ValueHandle_8h_source.html#l00224">ValueHandle.h:224</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_a089cccb6f231efee72abc76d0f9c695f"><div class="ttname"><a href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">llvm::PHINode::addIncoming</a></div><div class="ttdeci">void addIncoming(Value *V, BasicBlock *BB)</div><div class="ttdoc">Add an incoming value to the end of the PHI list.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02854">Instructions.h:2854</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_aaea0d5ebb8b57ddde2095f80e2e94bb2"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#aaea0d5ebb8b57ddde2095f80e2e94bb2">llvm::PatternMatch::m_AllOnes</a></div><div class="ttdeci">cst_pred_ty&lt; is_all_ones &gt; m_AllOnes()</div><div class="ttdoc">Match an integer or vector with all bits set.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00453">PatternMatch.h:453</a></div></div>
<div class="ttc" id="alib_2Target_2ARM_2README_8txt_html_ad3a99906764c35b2694ae90fa57744a5"><div class="ttname"><a href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">move</a></div><div class="ttdeci">compiles ldr LCPI1_0 ldr ldr mov lsr tst moveq r1 ldr LCPI1_1 and r0 bx lr It would be better to do something like to fold the shift into the conditional move</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2ARM_2README_8txt_source.html#l00546">README.txt:546</a></div></div>
<div class="ttc" id="aProfDataUtils_8h_html"><div class="ttname"><a href="ProfDataUtils_8h.html">ProfDataUtils.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1LLVMContext_html"><div class="ttname"><a href="classllvm_1_1LLVMContext.html">llvm::LLVMContext</a></div><div class="ttdoc">This is an important class for using LLVM in a threaded context.</div><div class="ttdef"><b>Definition:</b> <a href="LLVMContext_8h_source.html#l00067">LLVMContext.h:67</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a72fb137716cff838d389e392b9729dc9"><div class="ttname"><a href="classllvm_1_1Value.html#a72fb137716cff838d389e392b9729dc9">llvm::Value::hasNUsesOrMore</a></div><div class="ttdeci">bool hasNUsesOrMore(unsigned N) const</div><div class="ttdoc">Return true if this value has N uses or more.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00152">Value.cpp:152</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a54507f01d7d06127068ee0663233511d"><div class="ttname"><a href="classllvm_1_1Instruction.html#a54507f01d7d06127068ee0663233511d">llvm::Instruction::moveAfter</a></div><div class="ttdeci">void moveAfter(Instruction *MovePos)</div><div class="ttdoc">Unlink this instruction from its current basic block and insert it into the basic block that MovePos ...</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00112">Instruction.cpp:112</a></div></div>
<div class="ttc" id="anamespacellvm_1_1numbers_html_a92f4283d4e0e2ea1776894b3ae93640f"><div class="ttname"><a href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">llvm::numbers::e</a></div><div class="ttdeci">constexpr double e</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00031">MathExtras.h:31</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLowering_html_ab37c33cd1796e553461f26aefbf498fa"><div class="ttname"><a href="classllvm_1_1TargetLowering.html#ab37c33cd1796e553461f26aefbf498fa">llvm::TargetLowering::ParseConstraints</a></div><div class="ttdeci">virtual AsmOperandInfoVector ParseConstraints(const DataLayout &amp;DL, const TargetRegisterInfo *TRI, const CallBase &amp;Call) const</div><div class="ttdoc">Split up the constraint string from the inline assembly value into the specific constraints and their...</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8cpp_source.html#l05377">TargetLowering.cpp:5377</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMap_html"><div class="ttname"><a href="classllvm_1_1DenseMap.html">llvm::DenseMap</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00714">DenseMap.h:714</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_af6143789a859bfe7a105d97d7cc8757f"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#af6143789a859bfe7a105d97d7cc8757f">computeBaseDerivedRelocateMap</a></div><div class="ttdeci">static void computeBaseDerivedRelocateMap(const SmallVectorImpl&lt; GCRelocateInst * &gt; &amp;AllRelocateCalls, DenseMap&lt; GCRelocateInst *, SmallVector&lt; GCRelocateInst *, 2 &gt;&gt; &amp;RelocateInstMap)</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l01112">CodeGenPrepare.cpp:1112</a></div></div>
<div class="ttc" id="aIR_2DebugInfo_8h_html"><div class="ttname"><a href="IR_2DebugInfo_8h.html">DebugInfo.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoopInfoBase_html_a7a7c8e0e4f836c13c015b62e18f386bd"><div class="ttname"><a href="classllvm_1_1LoopInfoBase.html#a7a7c8e0e4f836c13c015b62e18f386bd">llvm::LoopInfoBase::getLoopFor</a></div><div class="ttdeci">LoopT * getLoopFor(const BlockT *BB) const</div><div class="ttdoc">Return the inner most loop that BB lives in.</div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l00992">LoopInfo.h:992</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00058">MD5.cpp:58</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a1b6f74fbe8b15567434fa5d20a540c5c"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a1b6f74fbe8b15567434fa5d20a540c5c">llvm::TargetLoweringBase::shouldFormOverflowOp</a></div><div class="ttdeci">virtual bool shouldFormOverflowOp(unsigned Opcode, EVT VT, bool MathUsed) const</div><div class="ttdoc">Try to convert math with an overflow comparison into the corresponding DAG node operation.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l03099">TargetLowering.h:3099</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlockSectionsProfileReader_html"><div class="ttname"><a href="classllvm_1_1BasicBlockSectionsProfileReader.html">llvm::BasicBlockSectionsProfileReader</a></div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockSectionsProfileReader_8h_source.html#l00044">BasicBlockSectionsProfileReader.h:44</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AArch64PACKey_html_abf4394f452bde3f544999858d71e4b46a438dbcc76b79fb10acb447ec5d141287"><div class="ttname"><a href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46a438dbcc76b79fb10acb447ec5d141287">llvm::AArch64PACKey::IB</a></div><div class="ttdeci">@ IB</div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00792">AArch64BaseInfo.h:792</a></div></div>
<div class="ttc" id="aCodeGen_2Analysis_8h_html"><div class="ttname"><a href="CodeGen_2Analysis_8h.html">Analysis.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1UndefValue_html"><div class="ttname"><a href="classllvm_1_1UndefValue.html">llvm::UndefValue</a></div><div class="ttdoc">'undef' values are things that do not have specified contents.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l01382">Constants.h:1382</a></div></div>
<div class="ttc" id="aclassllvm_1_1BlockFrequency_html_a8e9ed6b20c2503f66f1fd0725297aedc"><div class="ttname"><a href="classllvm_1_1BlockFrequency.html#a8e9ed6b20c2503f66f1fd0725297aedc">llvm::BlockFrequency::getFrequency</a></div><div class="ttdeci">uint64_t getFrequency() const</div><div class="ttdoc">Returns the frequency as a fixpoint number scaled by the entry frequency.</div><div class="ttdef"><b>Definition:</b> <a href="BlockFrequency_8h_source.html#l00034">BlockFrequency.h:34</a></div></div>
<div class="ttc" id="aclassllvm_1_1GetElementPtrInst_html"><div class="ttname"><a href="classllvm_1_1GetElementPtrInst.html">llvm::GetElementPtrInst</a></div><div class="ttdoc">an instruction for type-safe pointer arithmetic to access elements of arrays and structs</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00940">Instructions.h:940</a></div></div>
<div class="ttc" id="anamespacellvm_1_1cl_html_a10a041239ae1870cfcc064bfaa79fb65"><div class="ttname"><a href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">llvm::cl::init</a></div><div class="ttdeci">initializer&lt; Ty &gt; init(const Ty &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00445">CommandLine.h:445</a></div></div>
<div class="ttc" id="anamespacellvm_html_a8154638df88e4eaa568b67b23d463dac"><div class="ttname"><a href="namespacellvm.html#a8154638df88e4eaa568b67b23d463dac">llvm::make_early_inc_range</a></div><div class="ttdeci">iterator_range&lt; early_inc_iterator_impl&lt; detail::IterOfRange&lt; RangeT &gt; &gt; &gt; make_early_inc_range(RangeT &amp;&amp;Range)</div><div class="ttdoc">Make a range that does early increment to allow mutation of the underlying range without disrupting i...</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00721">STLExtras.h:721</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a9880b7512930d879440db073b536d362"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a9880b7512930d879440db073b536d362">llvm::TargetTransformInfo::shouldConsiderAddressTypePromotion</a></div><div class="ttdeci">bool shouldConsiderAddressTypePromotion(const Instruction &amp;I, bool &amp;AllowPromotionWithoutCommonHeader) const</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00694">TargetTransformInfo.cpp:694</a></div></div>
<div class="ttc" id="astructllvm_1_1TargetLowering_1_1AsmOperandInfo_html"><div class="ttname"><a href="structllvm_1_1TargetLowering_1_1AsmOperandInfo.html">llvm::TargetLowering::AsmOperandInfo</a></div><div class="ttdoc">This contains information for each constraint that we are lowering.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l04647">TargetLowering.h:4647</a></div></div>
<div class="ttc" id="aclassllvm_1_1ProfileSummaryInfoWrapperPass_html"><div class="ttname"><a href="classllvm_1_1ProfileSummaryInfoWrapperPass.html">llvm::ProfileSummaryInfoWrapperPass</a></div><div class="ttdoc">An analysis pass based on legacy pass manager to deliver ProfileSummaryInfo.</div><div class="ttdef"><b>Definition:</b> <a href="ProfileSummaryInfo_8h_source.html#l00194">ProfileSummaryInfo.h:194</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoopBase_html_ac3280e7f76f955403fe17eacf126b90d"><div class="ttname"><a href="classllvm_1_1LoopBase.html#ac3280e7f76f955403fe17eacf126b90d">llvm::LoopBase::getLoopPreheader</a></div><div class="ttdeci">BlockT * getLoopPreheader() const</div><div class="ttdoc">If there is a preheader for this loop, return it.</div><div class="ttdef"><b>Definition:</b> <a href="LoopInfoImpl_8h_source.html#l00183">LoopInfoImpl.h:183</a></div></div>
<div class="ttc" id="aclassllvm_1_1PointerType_html"><div class="ttname"><a href="classllvm_1_1PointerType.html">llvm::PointerType</a></div><div class="ttdoc">Class to represent pointers.</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00632">DerivedTypes.h:632</a></div></div>
<div class="ttc" id="anamespacellvm_html_acd1cd968cb420c82d70926920fcdc7d7"><div class="ttname"><a href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">llvm::is_contained</a></div><div class="ttdeci">bool is_contained(R &amp;&amp;Range, const E &amp;Element)</div><div class="ttdoc">Wrapper function around std::find to detect if an element exists in a container.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01869">STLExtras.h:1869</a></div></div>
<div class="ttc" id="anamespacellvm_html_a8813c8445d4429956ae5a3647f02fcfb"><div class="ttname"><a href="namespacellvm.html#a8813c8445d4429956ae5a3647f02fcfb">llvm::findDbgValues</a></div><div class="ttdeci">void findDbgValues(SmallVectorImpl&lt; DbgValueInst * &gt; &amp;DbgValues, Value *V)</div><div class="ttdoc">Finds the llvm.dbg.value intrinsics describing a value.</div><div class="ttdef"><b>Definition:</b> <a href="DebugInfo_8cpp_source.html#l00079">DebugInfo.cpp:79</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_aca632fc83dfd8f23f3456ef50a49e31a"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#aca632fc83dfd8f23f3456ef50a49e31a">llvm::TargetLoweringBase::useSoftFloat</a></div><div class="ttdeci">virtual bool useSoftFloat() const</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l00360">TargetLowering.h:360</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a3c923449fda41268c1c9825047304eba"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a3c923449fda41268c1c9825047304eba">EnableTypePromotionMerge</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; EnableTypePromotionMerge(&quot;cgp-type-promotion-merge&quot;, cl::Hidden, cl::desc(&quot;Enable merging of redundant sexts when one is dominating&quot; &quot; the other.&quot;), cl::init(true))</div></div>
<div class="ttc" id="anamespacellvm_html_aab02db480f387fca92956ef1c9a01941"><div class="ttname"><a href="namespacellvm.html#aab02db480f387fca92956ef1c9a01941">llvm::simplifyInstruction</a></div><div class="ttdeci">Value * simplifyInstruction(Instruction *I, const SimplifyQuery &amp;Q, OptimizationRemarkEmitter *ORE=nullptr)</div><div class="ttdoc">See if we can compute a simplified version of this instruction.</div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8cpp_source.html#l06731">InstructionSimplify.cpp:6731</a></div></div>
<div class="ttc" id="aArrayRef_8h_html"><div class="ttname"><a href="ArrayRef_8h.html">ArrayRef.h</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a43c1d33c8ac8a552c4119db493f7a681"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a43c1d33c8ac8a552c4119db493f7a681">FreqRatioToSkipMerge</a></div><div class="ttdeci">static cl::opt&lt; unsigned &gt; FreqRatioToSkipMerge(&quot;cgp-freq-ratio-to-skip-merge&quot;, cl::Hidden, cl::init(2), cl::desc(&quot;Skip merging empty blocks if (frequency of empty block) / &quot; &quot;(frequency of destination block) is greater than this ratio&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_ae8f5bf5cc06f696b52c709677df00fbf"><div class="ttname"><a href="classllvm_1_1Instruction.html#ae8f5bf5cc06f696b52c709677df00fbf">llvm::Instruction::setDebugLoc</a></div><div class="ttdeci">void setDebugLoc(DebugLoc Loc)</div><div class="ttdoc">Set the debug location information for this instruction.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00355">Instruction.h:355</a></div></div>
<div class="ttc" id="aTargetPassConfig_8h_html"><div class="ttname"><a href="TargetPassConfig_8h.html">TargetPassConfig.h</a></div></div>
<div class="ttc" id="aItaniumDemangle_8h_html_a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508"><div class="ttname"><a href="ItaniumDemangle_8h.html#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">TemplateParamKind::Type</a></div><div class="ttdeci">@ Type</div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a30646d63c1f1ca132d37dff17cf5daae"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a30646d63c1f1ca132d37dff17cf5daae">llvm::TargetTransformInfo::isExpensiveToSpeculativelyExecute</a></div><div class="ttdeci">bool isExpensiveToSpeculativelyExecute(const Instruction *I) const</div><div class="ttdoc">Return true if the cost of the instruction is too high to speculatively execute and should be kept be...</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00593">TargetTransformInfo.cpp:593</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoopBase_html_a1230fd674d2609b96527fe65eaf40b1b"><div class="ttname"><a href="classllvm_1_1LoopBase.html#a1230fd674d2609b96527fe65eaf40b1b">llvm::LoopBase::getLoopLatch</a></div><div class="ttdeci">BlockT * getLoopLatch() const</div><div class="ttdoc">If there is a single latch block for this loop, return it.</div><div class="ttdef"><b>Definition:</b> <a href="LoopInfoImpl_8h_source.html#l00232">LoopInfoImpl.h:232</a></div></div>
<div class="ttc" id="aclassllvm_1_1details_1_1FixedOrScalableQuantity_html_a33880aaca0ad05e5f1557f079305bde5"><div class="ttname"><a href="classllvm_1_1details_1_1FixedOrScalableQuantity.html#a33880aaca0ad05e5f1557f079305bde5">llvm::details::FixedOrScalableQuantity::getFixedValue</a></div><div class="ttdeci">constexpr ScalarTy getFixedValue() const</div><div class="ttdef"><b>Definition:</b> <a href="TypeSize_8h_source.html#l00182">TypeSize.h:182</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a0c047f127ed4380a6f383d70bec4eb94"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::find</a></div><div class="ttdeci">iterator find(const_arg_type_t&lt; KeyT &gt; Val)</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00150">DenseMap.h:150</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ISD_html_ad4d48171b87ca51ff54c10a436bac4d7a8d89c7da4444d9ec11667aa369abc5f7"><div class="ttname"><a href="namespacellvm_1_1ISD.html#ad4d48171b87ca51ff54c10a436bac4d7a8d89c7da4444d9ec11667aa369abc5f7">llvm::ISD::ZEXTLOAD</a></div><div class="ttdeci">@ ZEXTLOAD</div><div class="ttdef"><b>Definition:</b> <a href="ISDOpcodes_8h_source.html#l01414">ISDOpcodes.h:1414</a></div></div>
<div class="ttc" id="anamespacellvm_html_a66a40e8dfb026aef2f90764d2e49a8f1"><div class="ttname"><a href="namespacellvm.html#a66a40e8dfb026aef2f90764d2e49a8f1">llvm::replaceAndRecursivelySimplify</a></div><div class="ttdeci">bool replaceAndRecursivelySimplify(Instruction *I, Value *SimpleV, const TargetLibraryInfo *TLI=nullptr, const DominatorTree *DT=nullptr, AssumptionCache *AC=nullptr, SmallSetVector&lt; Instruction *, 8 &gt; *UnsimplifiedUsers=nullptr)</div><div class="ttdoc">Replace all uses of 'I' with 'SimpleV' and simplify the uses recursively.</div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8cpp_source.html#l06814">InstructionSimplify.cpp:6814</a></div></div>
<div class="ttc" id="aIRBuilder_8h_html"><div class="ttname"><a href="IRBuilder_8h.html">IRBuilder.h</a></div></div>
<div class="ttc" id="aSILowerControlFlow_8cpp_html_a4868c5d81c5ccc98c47aeab6244346a0"><div class="ttname"><a href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a></div><div class="ttdeci">assert(ImpDefSCC.getReg()==AMDGPU::SCC &amp;&amp;ImpDefSCC.isDef())</div></div>
<div class="ttc" id="aclassllvm_1_1TargetMachine_html"><div class="ttname"><a href="classllvm_1_1TargetMachine.html">llvm::TargetMachine</a></div><div class="ttdoc">Primary interface to the complete machine description for the target machine.</div><div class="ttdef"><b>Definition:</b> <a href="Target_2TargetMachine_8h_source.html#l00078">TargetMachine.h:78</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_ac3ed5602889a22db44a16e1b97fac5b8"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#ac3ed5602889a22db44a16e1b97fac5b8">llvm::PatternMatch::m_Sub</a></div><div class="ttdeci">BinaryOp_match&lt; LHS, RHS, Instruction::Sub &gt; m_Sub(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00991">PatternMatch.h:991</a></div></div>
<div class="ttc" id="aclassllvm_1_1MVT_html_a7be7c6dd92efc0d6f866d4a3b433eed0"><div class="ttname"><a href="classllvm_1_1MVT.html#a7be7c6dd92efc0d6f866d4a3b433eed0">llvm::MVT::getSizeInBits</a></div><div class="ttdeci">TypeSize getSizeInBits() const</div><div class="ttdoc">Returns the size of the specified MVT in bits.</div><div class="ttdef"><b>Definition:</b> <a href="MachineValueType_8h_source.html#l00925">MachineValueType.h:925</a></div></div>
<div class="ttc" id="anamespacestd_html_ab8424022895aee3e366fb9a32f2883cb"><div class="ttname"><a href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a></div><div class="ttdeci">void swap(llvm::BitVector &amp;LHS, llvm::BitVector &amp;RHS)</div><div class="ttdoc">Implement std::swap in terms of BitVector swap.</div><div class="ttdef"><b>Definition:</b> <a href="BitVector_8h_source.html#l00853">BitVector.h:853</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_aa00abc9ed22bfa32ebd68531b619b005"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#aa00abc9ed22bfa32ebd68531b619b005">llvm::TargetLoweringBase::hasMultipleConditionRegisters</a></div><div class="ttdeci">bool hasMultipleConditionRegisters() const</div><div class="ttdoc">Return true if multiple condition registers are available.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l00470">TargetLowering.h:470</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ScaledNumbers_html_a0651aa0a52c69c4fe12cf730e7ed65ab"><div class="ttname"><a href="namespacellvm_1_1ScaledNumbers.html#a0651aa0a52c69c4fe12cf730e7ed65ab">llvm::ScaledNumbers::compare</a></div><div class="ttdeci">int compare(DigitsT LDigits, int16_t LScale, DigitsT RDigits, int16_t RScale)</div><div class="ttdoc">Compare two scaled numbers.</div><div class="ttdef"><b>Definition:</b> <a href="ScaledNumber_8h_source.html#l00252">ScaledNumber.h:252</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a24a3e4aad4cb2fdde7ce294a531cd52a"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a24a3e4aad4cb2fdde7ce294a531cd52a">sinkCmpExpression</a></div><div class="ttdeci">static bool sinkCmpExpression(CmpInst *Cmp, const TargetLowering &amp;TLI)</div><div class="ttdoc">Sink the given CmpInst into user blocks to reduce the number of virtual registers that must be create...</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l01681">CodeGenPrepare.cpp:1681</a></div></div>
<div class="ttc" id="aclassllvm_1_1generic__gep__type__iterator_html_aeb7ef34c0b96c3130c0029e648e2bd08"><div class="ttname"><a href="classllvm_1_1generic__gep__type__iterator.html#aeb7ef34c0b96c3130c0029e648e2bd08">llvm::generic_gep_type_iterator::getIndexedType</a></div><div class="ttdeci">Type * getIndexedType() const</div><div class="ttdef"><b>Definition:</b> <a href="GetElementPtrTypeIterator_8h_source.html#l00070">GetElementPtrTypeIterator.h:70</a></div></div>
<div class="ttc" id="anamespacellvm_html_a502009030bffff8a6992f4e4eb9380f5"><div class="ttname"><a href="namespacellvm.html#a502009030bffff8a6992f4e4eb9380f5">llvm::SplitIndirectBrCriticalEdges</a></div><div class="ttdeci">bool SplitIndirectBrCriticalEdges(Function &amp;F, bool IgnoreBlocksWithoutPHI, BranchProbabilityInfo *BPI=nullptr, BlockFrequencyInfo *BFI=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="BreakCriticalEdges_8cpp_source.html#l00338">BreakCriticalEdges.cpp:338</a></div></div>
<div class="ttc" id="anamespacellvm_1_1codeview_html_a2e1cbb0e2bd7a35ed99c31853dc45374a3fd6b696867d70225deda7868308679b"><div class="ttname"><a href="namespacellvm_1_1codeview.html#a2e1cbb0e2bd7a35ed99c31853dc45374a3fd6b696867d70225deda7868308679b">llvm::codeview::CompileSym2Flags::EC</a></div><div class="ttdeci">@ EC</div></div>
<div class="ttc" id="aTargetLibraryInfo_8cpp_html_aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053"><div class="ttname"><a href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a></div><div class="ttdeci">@ Ptr</div><div class="ttdef"><b>Definition:</b> <a href="TargetLibraryInfo_8cpp_source.html#l00062">TargetLibraryInfo.cpp:62</a></div></div>
<div class="ttc" id="aclassllvm_1_1SelectInst_html"><div class="ttname"><a href="classllvm_1_1SelectInst.html">llvm::SelectInst</a></div><div class="ttdoc">This class represents the LLVM 'select' instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01746">Instructions.h:1746</a></div></div>
<div class="ttc" id="astructllvm_1_1PatternMatch_1_1m__ZeroMask_html"><div class="ttname"><a href="structllvm_1_1PatternMatch_1_1m__ZeroMask.html">llvm::PatternMatch::m_ZeroMask</a></div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01523">PatternMatch.h:1523</a></div></div>
<div class="ttc" id="anamespacellvm_html_aa0d69e81725c10fa5407f0bf34462068"><div class="ttname"><a href="namespacellvm.html#aa0d69e81725c10fa5407f0bf34462068">llvm::TTI</a></div><div class="ttdeci">TargetTransformInfo TTI</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00191">TargetTransformInfo.h:191</a></div></div>
<div class="ttc" id="aMemDepPrinter_8cpp_html_a470d8721ad7c3b718e9daeabdaeb4700"><div class="ttname"><a href="MemDepPrinter_8cpp.html#a470d8721ad7c3b718e9daeabdaeb4700">function</a></div><div class="ttdeci">print Print MemDeps of function</div><div class="ttdef"><b>Definition:</b> <a href="MemDepPrinter_8cpp_source.html#l00082">MemDepPrinter.cpp:82</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a12a2c968fb364b21a905ce603f335440"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a12a2c968fb364b21a905ce603f335440">FindAllMemoryUses</a></div><div class="ttdeci">static bool FindAllMemoryUses(Instruction *I, SmallVectorImpl&lt; std::pair&lt; Value *, Type * &gt;&gt; &amp;MemoryUses, SmallPtrSetImpl&lt; Instruction * &gt; &amp;ConsideredInsts, const TargetLowering &amp;TLI, const TargetRegisterInfo &amp;TRI, bool OptSize, ProfileSummaryInfo *PSI, BlockFrequencyInfo *BFI, int SeenInsts=0)</div><div class="ttdoc">Recursively walk all the uses of I until we find a memory use.</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l04973">CodeGenPrepare.cpp:4973</a></div></div>
<div class="ttc" id="anamespacellvm_1_1WinEH_html_a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa"><div class="ttname"><a href="namespacellvm_1_1WinEH.html#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">llvm::WinEH::EncodingType::CE</a></div><div class="ttdeci">@ CE</div><div class="ttdoc">Windows NT (Windows on ARM)</div></div>
<div class="ttc" id="aclassllvm_1_1MVT_html"><div class="ttname"><a href="classllvm_1_1MVT.html">llvm::MVT</a></div><div class="ttdoc">Machine Value Type.</div><div class="ttdef"><b>Definition:</b> <a href="MachineValueType_8h_source.html#l00031">MachineValueType.h:31</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoopInfoBase_html_ab447b41b9c51151b5c6ef497a60689ae"><div class="ttname"><a href="classllvm_1_1LoopInfoBase.html#ab447b41b9c51151b5c6ef497a60689ae">llvm::LoopInfoBase::begin</a></div><div class="ttdeci">iterator begin() const</div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l00967">LoopInfo.h:967</a></div></div>
<div class="ttc" id="anamespacellvm_html_a9f172ff9cc319871a4d4b30b1c442dba"><div class="ttname"><a href="namespacellvm.html#a9f172ff9cc319871a4d4b30b1c442dba">llvm::attributesPermitTailCall</a></div><div class="ttdeci">bool attributesPermitTailCall(const Function *F, const Instruction *I, const ReturnInst *Ret, const TargetLoweringBase &amp;TLI, bool *AllowDifferingSizes=nullptr)</div><div class="ttdoc">Test if given that the input instruction is in the tail call position, if there is an attribute misma...</div><div class="ttdef"><b>Definition:</b> <a href="CodeGen_2Analysis_8cpp_source.html#l00569">Analysis.cpp:569</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a49c487a9395a6c384be8544cfb2cfccf"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a49c487a9395a6c384be8544cfb2cfccf">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00098">DenseMap.h:98</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_aadd209ba7e1bfa8113a609e09a7fe62f"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#aadd209ba7e1bfa8113a609e09a7fe62f">llvm::PatternMatch::m_Constant</a></div><div class="ttdeci">class_match&lt; Constant &gt; m_Constant()</div><div class="ttdoc">Match an arbitrary Constant and ignore it.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00144">PatternMatch.h:144</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_aabbaf3d93d626617b19c4b5cac455e3b"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#aabbaf3d93d626617b19c4b5cac455e3b">AddrSinkNewSelects</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; AddrSinkNewSelects(&quot;addr-sink-new-select&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Allow creation of selects in Address sinking.&quot;))</div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a8dd1128758268fa3aa05eeba358baf3f"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a8dd1128758268fa3aa05eeba358baf3f">getTrueOrFalseValue</a></div><div class="ttdeci">static Value * getTrueOrFalseValue(SelectInst *SI, bool isTrue, const SmallPtrSet&lt; const Instruction *, 2 &gt; &amp;Selects)</div><div class="ttdoc">If isTrue is true, return the true value of SI, otherwise return false value of SI.</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l06757">CodeGenPrepare.cpp:6757</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a701f96a344afd4a292262cf5e912731d"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a701f96a344afd4a292262cf5e912731d">INITIALIZE_PASS_BEGIN</a></div><div class="ttdeci">INITIALIZE_PASS_BEGIN(CodeGenPrepare, DEBUG_TYPE, &quot;Optimize for code generation&quot;, false, false) INITIALIZE_PASS_END(CodeGenPrepare</div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImpl_html_a1f475b0df44ebd7169e720fa1bf9169e"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html#a1f475b0df44ebd7169e720fa1bf9169e">llvm::SmallPtrSetImpl::count</a></div><div class="ttdeci">size_type count(ConstPtrType Ptr) const</div><div class="ttdoc">count - Return 1 if the specified pointer is in the set, 0 otherwise.</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00383">SmallPtrSet.h:383</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallSet_html_a75a2d2ad3b3dce6702750d570ee8f343"><div class="ttname"><a href="classllvm_1_1SmallSet.html#a75a2d2ad3b3dce6702750d570ee8f343">llvm::SmallSet::erase</a></div><div class="ttdeci">bool erase(const T &amp;V)</div><div class="ttdef"><b>Definition:</b> <a href="SmallSet_8h_source.html#l00205">SmallSet.h:205</a></div></div>
<div class="ttc" id="aAssumeBundleBuilder_8cpp_html_afb136e0532bcaed86521b462e6538d62"><div class="ttname"><a href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a></div><div class="ttdeci">assume Assume Builder</div><div class="ttdef"><b>Definition:</b> <a href="AssumeBundleBuilder_8cpp_source.html#l00651">AssumeBundleBuilder.cpp:651</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a62213d5211c9d944e5ede1f0059a6ae2"><div class="ttname"><a href="classllvm_1_1Value.html#a62213d5211c9d944e5ede1f0059a6ae2">llvm::Value::printAsOperand</a></div><div class="ttdeci">void printAsOperand(raw_ostream &amp;O, bool PrintType=true, const Module *M=nullptr) const</div><div class="ttdoc">Print the name of this Value out to the specified raw_ostream.</div><div class="ttdef"><b>Definition:</b> <a href="AsmWriter_8cpp_source.html#l04782">AsmWriter.cpp:4782</a></div></div>
<div class="ttc" id="aclassllvm_1_1BranchInst_html_ad56f6a9b5cd05940017c4544df48bc30"><div class="ttname"><a href="classllvm_1_1BranchInst.html#ad56f6a9b5cd05940017c4544df48bc30">llvm::BranchInst::isUnconditional</a></div><div class="ttdeci">bool isUnconditional() const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03217">Instructions.h:3217</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a24bca8838396aa81b87de8e7ac774b19"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">llvm::PatternMatch::m_Value</a></div><div class="ttdeci">class_match&lt; Value &gt; m_Value()</div><div class="ttdoc">Match an arbitrary value and ignore it.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00076">PatternMatch.h:76</a></div></div>
<div class="ttc" id="anamespacellvm_html_a4d812a2dd18aa186c164447e20e348e7"><div class="ttname"><a href="namespacellvm.html#a4d812a2dd18aa186c164447e20e348e7">llvm::operator==</a></div><div class="ttdeci">bool operator==(const AddressRangeValuePair &amp;LHS, const AddressRangeValuePair &amp;RHS)</div><div class="ttdef"><b>Definition:</b> <a href="AddressRanges_8h_source.html#l00153">AddressRanges.h:153</a></div></div>
<div class="ttc" id="aclassllvm_1_1ZExtInst_html"><div class="ttname"><a href="classllvm_1_1ZExtInst.html">llvm::ZExtInst</a></div><div class="ttdoc">This class represents zero extension of integer types.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l04852">Instructions.h:4852</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html"><div class="ttname"><a href="classllvm_1_1APInt.html">llvm::APInt</a></div><div class="ttdoc">Class for arbitrary precision integers.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00075">APInt.h:75</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html_a5fa9b8e1842b354f64c1ba6be0a4a17f"><div class="ttname"><a href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">llvm::User::setOperand</a></div><div class="ttdeci">void setOperand(unsigned i, Value *Val)</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00174">User.h:174</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html_a72d928b7fc2c5f2d56c6ac0265fd9c6e"><div class="ttname"><a href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">llvm::SetVector&lt; T, SmallVector&lt; T, N &gt;, SmallDenseSet&lt; T, N &gt; &gt;::insert</a></div><div class="ttdeci">bool insert(const value_type &amp;X)</div><div class="ttdoc">Insert a new element into the SetVector.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00141">SetVector.h:141</a></div></div>
<div class="ttc" id="aM68kELFObjectWriter_8cpp_html_ae4a8bc3879d2282eefd72b16b12c2a37"><div class="ttname"><a href="M68kELFObjectWriter_8cpp.html#ae4a8bc3879d2282eefd72b16b12c2a37">getType</a></div><div class="ttdeci">static M68kRelType getType(unsigned Kind, MCSymbolRefExpr::VariantKind &amp;Modifier, bool &amp;IsPCRel)</div><div class="ttdef"><b>Definition:</b> <a href="M68kELFObjectWriter_8cpp_source.html#l00048">M68kELFObjectWriter.cpp:48</a></div></div>
<div class="ttc" id="anamespacellvm_html_a67980a8ae101d2fda845eb750ffb1942"><div class="ttname"><a href="namespacellvm.html#a67980a8ae101d2fda845eb750ffb1942">llvm::print</a></div><div class="ttdeci">Printable print(const GCNRegPressure &amp;RP, const GCNSubtarget *ST=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="GCNRegPressure_8cpp_source.html#l00138">GCNRegPressure.cpp:138</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a2be3583dac92a031fa1458d4d992c78ba15ae464950ac676919c2f0c7aafc706c"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba15ae464950ac676919c2f0c7aafc706c">llvm::CmpInst::ICMP_SLT</a></div><div class="ttdeci">@ ICMP_SLT</div><div class="ttdoc">signed less than</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00747">InstrTypes.h:747</a></div></div>
<div class="ttc" id="anamespacellvm_html_a10f3d955592ae2bc745f57e5b48ae115"><div class="ttname"><a href="namespacellvm.html#a10f3d955592ae2bc745f57e5b48ae115">llvm::size</a></div><div class="ttdeci">auto size(R &amp;&amp;Range, std::enable_if_t&lt; std::is_base_of&lt; std::random_access_iterator_tag, typename std::iterator_traits&lt; decltype(Range.begin())&gt;::iterator_category &gt;::value, void &gt; *=nullptr)</div><div class="ttdoc">Get the size of a range.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01716">STLExtras.h:1716</a></div></div>
<div class="ttc" id="anamespacellvm_1_1logicalview_html_a9696bc411b0a7022c2cc78bff5173ceface5bf551379459c1c61d2a204061c455"><div class="ttname"><a href="namespacellvm_1_1logicalview.html#a9696bc411b0a7022c2cc78bff5173ceface5bf551379459c1c61d2a204061c455">llvm::logicalview::LVAttributeKind::Location</a></div><div class="ttdeci">@ Location</div></div>
<div class="ttc" id="aTargetOptions_8h_html"><div class="ttname"><a href="TargetOptions_8h.html">TargetOptions.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a0a4d51e372293abe5e5f6dac133e80a6"><div class="ttname"><a href="classllvm_1_1Instruction.html#a0a4d51e372293abe5e5f6dac133e80a6">llvm::Instruction::clone</a></div><div class="ttdeci">Instruction * clone() const</div><div class="ttdoc">Create a copy of 'this' instruction that is identical in all ways except the following:</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00903">Instruction.cpp:903</a></div></div>
<div class="ttc" id="anamespacellvm_1_1NVPTXISD_html_ab995b6d422b079c863075e073b2eb96ba7cff9cc4a40fe2b19129ee8e9b0ec645"><div class="ttname"><a href="namespacellvm_1_1NVPTXISD.html#ab995b6d422b079c863075e073b2eb96ba7cff9cc4a40fe2b19129ee8e9b0ec645">llvm::NVPTXISD::Dummy</a></div><div class="ttdeci">@ Dummy</div><div class="ttdef"><b>Definition:</b> <a href="NVPTXISelLowering_8h_source.html#l00060">NVPTXISelLowering.h:60</a></div></div>
<div class="ttc" id="anamespacellvm_html_a2366b4a30c90d2207626fb717dfb778d"><div class="ttname"><a href="namespacellvm.html#a2366b4a30c90d2207626fb717dfb778d">llvm::operator*</a></div><div class="ttdeci">APInt operator*(APInt a, uint64_t RHS)</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l02162">APInt.h:2162</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImplBase_html_a16413f1a88d8baca228d0a1b4cc0bfc6"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImplBase.html#a16413f1a88d8baca228d0a1b4cc0bfc6">llvm::SmallPtrSetImplBase::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00095">SmallPtrSet.h:95</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a3acbd0be97863e3e03e3b85641254018"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a3acbd0be97863e3e03e3b85641254018">llvm::PatternMatch::m_SpecificInt</a></div><div class="ttdeci">specific_intval&lt; false &gt; m_SpecificInt(APInt V)</div><div class="ttdoc">Match a specific integer value or vector with all elements equal to the value.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00854">PatternMatch.h:854</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a0327169186859791aafa580e4fb547e2"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a0327169186859791aafa580e4fb547e2">SinkShiftAndTruncate</a></div><div class="ttdeci">static bool SinkShiftAndTruncate(BinaryOperator *ShiftI, Instruction *User, ConstantInt *CI, DenseMap&lt; BasicBlock *, BinaryOperator * &gt; &amp;InsertedShifts, const TargetLowering &amp;TLI, const DataLayout &amp;DL)</div><div class="ttdoc">Sink both shift and truncate instruction to the use of truncate's BB.</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l01941">CodeGenPrepare.cpp:1941</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html"><div class="ttname"><a href="classllvm_1_1ArrayRef.html">llvm::ArrayRef</a></div><div class="ttdoc">ArrayRef - Represent a constant reference to an array (0 or more elements consecutively in memory),...</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00033">APInt.h:33</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoopInfo_html"><div class="ttname"><a href="classllvm_1_1LoopInfo.html">llvm::LoopInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l01108">LoopInfo.h:1108</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_ae4b84d0bc1e6fcb979dc8bb641b74ae9"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#ae4b84d0bc1e6fcb979dc8bb641b74ae9">llvm::TargetLoweringBase::shouldAlignPointerArgs</a></div><div class="ttdeci">virtual bool shouldAlignPointerArgs(CallInst *, unsigned &amp;, Align &amp;) const</div><div class="ttdoc">Return true if the pointer arguments to CI should be aligned by aligning the object whose address is ...</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l01932">TargetLowering.h:1932</a></div></div>
<div class="ttc" id="aclassllvm_1_1BinaryOperator_html"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html">llvm::BinaryOperator</a></div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00187">InstrTypes.h:187</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a4574a60531dbf7cd8027141baa30c09a"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a4574a60531dbf7cd8027141baa30c09a">llvm::TargetLoweringBase::hasExtractBitsInsn</a></div><div class="ttdeci">bool hasExtractBitsInsn() const</div><div class="ttdoc">Return true if the target has BitExtract instructions.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l00475">TargetLowering.h:475</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html_a3499f6a24500afba2c318295ad2d2d05"><div class="ttname"><a href="classllvm_1_1SetVector.html#a3499f6a24500afba2c318295ad2d2d05">llvm::SetVector&lt; T, SmallVector&lt; T, N &gt;, SmallDenseSet&lt; T, N &gt; &gt;::pop_back_val</a></div><div class="ttdeci">T pop_back_val()</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00225">SetVector.h:225</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_af40372fc6c2f0c6fea698d32c6730166"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#af40372fc6c2f0c6fea698d32c6730166">llvm::TargetLoweringBase::shouldConvertPhiType</a></div><div class="ttdeci">virtual bool shouldConvertPhiType(Type *From, Type *To) const</div><div class="ttdoc">Given a set in interconnected phis of type 'From' that are loaded/stored or bitcast to type 'To',...</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l02660">TargetLowering.h:2660</a></div></div>
<div class="ttc" id="aX86PartialReduction_8cpp_html_ae0f503db91504a3f3440ab81260e4134"><div class="ttname"><a href="X86PartialReduction_8cpp.html#ae0f503db91504a3f3440ab81260e4134">Mul</a></div><div class="ttdeci">BinaryOperator * Mul</div><div class="ttdef"><b>Definition:</b> <a href="X86PartialReduction_8cpp_source.html#l00070">X86PartialReduction.cpp:70</a></div></div>
<div class="ttc" id="anamespacellvm_html_a61d13d6824ec46c31260a4fd0997eda0"><div class="ttname"><a href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">llvm::any_of</a></div><div class="ttdeci">bool any_of(R &amp;&amp;range, UnaryPredicate P)</div><div class="ttdoc">Provide wrappers to std::any_of which take ranges instead of having to pass begin/end explicitly.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01742">STLExtras.h:1742</a></div></div>
<div class="ttc" id="aDataLayout_8h_html"><div class="ttname"><a href="DataLayout_8h.html">DataLayout.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1StructType_html"><div class="ttname"><a href="classllvm_1_1StructType.html">llvm::StructType</a></div><div class="ttdoc">Class to represent struct types.</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00213">DerivedTypes.h:213</a></div></div>
<div class="ttc" id="aBasicBlockSections_8cpp_html_a5fd0741d696f28faf65b33f6c6af8fda"><div class="ttname"><a href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a></div><div class="ttdeci">SmallVector&lt; MachineOperand, 4 &gt; Cond</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockSections_8cpp_source.html#l00137">BasicBlockSections.cpp:137</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a96b02d52f9489e0bca9760578509f491"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a96b02d52f9489e0bca9760578509f491">DisableGCOpts</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; DisableGCOpts(&quot;disable-cgp-gc-opts&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Disable GC optimizations in CodeGenPrepare&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1ProfileSummaryInfo_html_a215c4f3e485345daeb8e9d68264f388a"><div class="ttname"><a href="classllvm_1_1ProfileSummaryInfo.html#a215c4f3e485345daeb8e9d68264f388a">llvm::ProfileSummaryInfo::isFunctionHotnessUnknown</a></div><div class="ttdeci">bool isFunctionHotnessUnknown(const Function &amp;F) const</div><div class="ttdoc">Returns true if the hotness of F is unknown.</div><div class="ttdef"><b>Definition:</b> <a href="ProfileSummaryInfo_8cpp_source.html#l00169">ProfileSummaryInfo.cpp:169</a></div></div>
<div class="ttc" id="aclassllvm_1_1StringRef_html"><div class="ttname"><a href="classllvm_1_1StringRef.html">llvm::StringRef</a></div><div class="ttdoc">StringRef - Represent a constant reference to a string, i.e.</div><div class="ttdef"><b>Definition:</b> <a href="StringRef_8h_source.html#l00050">StringRef.h:50</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_adea6dc2e42baa345b97be48b0370313d"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">llvm::PatternMatch::m_Undef</a></div><div class="ttdeci">auto m_Undef()</div><div class="ttdoc">Match an arbitrary undef constant.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00136">PatternMatch.h:136</a></div></div>
<div class="ttc" id="aAssumeBundleBuilder_8cpp_html_a709b7e6fb4fd58a430c97e27c45f6b31"><div class="ttname"><a href="AssumeBundleBuilder_8cpp.html#a709b7e6fb4fd58a430c97e27c45f6b31">Simplify</a></div><div class="ttdeci">assume Assume Simplify</div><div class="ttdef"><b>Definition:</b> <a href="AssumeBundleBuilder_8cpp_source.html#l00604">AssumeBundleBuilder.cpp:604</a></div></div>
<div class="ttc" id="aSimplifyLibCalls_8h_html"><div class="ttname"><a href="SimplifyLibCalls_8h.html">SimplifyLibCalls.h</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a091230f607eef4cbb3383be2caaf0bbc"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a091230f607eef4cbb3383be2caaf0bbc">AddrSinkCombineBaseReg</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; AddrSinkCombineBaseReg(&quot;addr-sink-combine-base-reg&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Allow combining of BaseReg field in Address sinking.&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">llvm::CmpInst::ICMP_ULT</a></div><div class="ttdeci">@ ICMP_ULT</div><div class="ttdoc">unsigned less than</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00743">InstrTypes.h:743</a></div></div>
<div class="ttc" id="aSupport_2ErrorHandling_8h_html_ace243f5c25697a1107cce46626b3dc94"><div class="ttname"><a href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a></div><div class="ttdeci">#define llvm_unreachable(msg)</div><div class="ttdoc">Marks that the current location is not supposed to be reachable.</div><div class="ttdef"><b>Definition:</b> <a href="Support_2ErrorHandling_8h_source.html#l00143">ErrorHandling.h:143</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a6393a2d4fe7e10b28a0dcc35f881567b"><div class="ttname"><a href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">llvm::Value::getType</a></div><div class="ttdeci">Type * getType() const</div><div class="ttdoc">All values are typed, get the type of this value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00255">Value.h:255</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_a882d55a6aa2028e1a5ad708b275334e0"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a882d55a6aa2028e1a5ad708b275334e0">llvm::ConstantInt::isZero</a></div><div class="ttdeci">bool isZero() const</div><div class="ttdoc">This is just a convenience method to make client code smaller for a common code.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00193">Constants.h:193</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a6a66ebb3aa12757479a3c88de77d78f8"><div class="ttname"><a href="classllvm_1_1Instruction.html#a6a66ebb3aa12757479a3c88de77d78f8">llvm::Instruction::getFunction</a></div><div class="ttdeci">const Function * getFunction() const</div><div class="ttdoc">Return the function this instruction belongs to.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00074">Instruction.cpp:74</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_afd3e8a6706810fef8cdbaf1f9f40dfbd"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#afd3e8a6706810fef8cdbaf1f9f40dfbd">llvm::PatternMatch::m_Shuffle</a></div><div class="ttdeci">TwoOps_match&lt; V1_t, V2_t, Instruction::ShuffleVector &gt; m_Shuffle(const V1_t &amp;v1, const V2_t &amp;v2)</div><div class="ttdoc">Matches ShuffleVectorInst independently of mask value.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01551">PatternMatch.h:1551</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a3ab5fc45117b450e8bb04e564cb6e5f2"><div class="ttname"><a href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">llvm::Value::replaceAllUsesWith</a></div><div class="ttdeci">void replaceAllUsesWith(Value *V)</div><div class="ttdoc">Change all uses of this to point to a new Value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00532">Value.cpp:532</a></div></div>
<div class="ttc" id="aCostModel_8cpp_html_a263d4048026a7c0a91393b998181f16e"><div class="ttname"><a href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a></div><div class="ttdeci">static cl::opt&lt; TargetTransformInfo::TargetCostKind &gt; CostKind(&quot;cost-kind&quot;, cl::desc(&quot;Target cost kind&quot;), cl::init(TargetTransformInfo::TCK_RecipThroughput), cl::values(clEnumValN(TargetTransformInfo::TCK_RecipThroughput, &quot;throughput&quot;, &quot;Reciprocal throughput&quot;), clEnumValN(TargetTransformInfo::TCK_Latency, &quot;latency&quot;, &quot;Instruction latency&quot;), clEnumValN(TargetTransformInfo::TCK_CodeSize, &quot;code-size&quot;, &quot;Code size&quot;), clEnumValN(TargetTransformInfo::TCK_SizeAndLatency, &quot;size-latency&quot;, &quot;Code size and latency&quot;)))</div></div>
<div class="ttc" id="aBasicAliasAnalysis_8cpp_html_a2675de1d8479c7b00387979714da43f7"><div class="ttname"><a href="BasicAliasAnalysis_8cpp.html#a2675de1d8479c7b00387979714da43f7">getParent</a></div><div class="ttdeci">static const Function * getParent(const Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="BasicAliasAnalysis_8cpp_source.html#l00806">BasicAliasAnalysis.cpp:806</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ms__demangle_html_a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e"><div class="ttname"><a href="namespacellvm_1_1ms__demangle.html#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">llvm::ms_demangle::IntrinsicFunctionKind::New</a></div><div class="ttdeci">@ New</div></div>
<div class="ttc" id="aclassuint32__t_html"><div class="ttname"><a href="classuint32__t.html">uint32_t</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLowering_html_ae4502810d1edc3d8931681159af36d3b"><div class="ttname"><a href="classllvm_1_1TargetLowering.html#ae4502810d1edc3d8931681159af36d3b">llvm::TargetLowering::mayBeEmittedAsTailCall</a></div><div class="ttdeci">virtual bool mayBeEmittedAsTailCall(const CallInst *) const</div><div class="ttdoc">Return true if the target may be able emit the call instruction as a tail call.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l04464">TargetLowering.h:4464</a></div></div>
<div class="ttc" id="aCompiler_8h_html"><div class="ttname"><a href="Compiler_8h.html">Compiler.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_a39d3d23a084c4544ee5903203db10e8a"><div class="ttname"><a href="namespacellvm.html#a39d3d23a084c4544ee5903203db10e8a">llvm::append_range</a></div><div class="ttdeci">void append_range(Container &amp;C, Range &amp;&amp;R)</div><div class="ttdoc">Wrapper function to append a range to a container.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l02014">STLExtras.h:2014</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_ab3fc0225d8aaf8434026c3573f961f2c"><div class="ttname"><a href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">llvm::Value::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const</div><div class="ttdoc">All values hold a context through their type.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00994">Value.cpp:994</a></div></div>
<div class="ttc" id="aclassllvm_1_1ilist__node__impl_html_af719fc783be6589465137d997701a432"><div class="ttname"><a href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">llvm::ilist_node_impl::getIterator</a></div><div class="ttdeci">self_iterator getIterator()</div><div class="ttdef"><b>Definition:</b> <a href="ilist__node_8h_source.html#l00082">ilist_node.h:82</a></div></div>
<div class="ttc" id="aTargetSubtargetInfo_8h_html"><div class="ttname"><a href="TargetSubtargetInfo_8h.html">TargetSubtargetInfo.h</a></div></div>
<div class="ttc" id="aAArch64SLSHardening_8cpp_html_ad467c4ab9119043f9b7750ab986be61a"><div class="ttname"><a href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a></div><div class="ttdeci">MachineBasicBlock MachineBasicBlock::iterator DebugLoc DL</div><div class="ttdef"><b>Definition:</b> <a href="AArch64SLSHardening_8cpp_source.html#l00076">AArch64SLSHardening.cpp:76</a></div></div>
<div class="ttc" id="anamespacellvm_html_a6c402f49fa595af618c5ad1500565d92"><div class="ttname"><a href="namespacellvm.html#a6c402f49fa595af618c5ad1500565d92">llvm::recognizeBSwapOrBitReverseIdiom</a></div><div class="ttdeci">bool recognizeBSwapOrBitReverseIdiom(Instruction *I, bool MatchBSwaps, bool MatchBitReversals, SmallVectorImpl&lt; Instruction * &gt; &amp;InsertedInsts)</div><div class="ttdoc">Try to match a bswap or bitreverse idiom.</div><div class="ttdef"><b>Definition:</b> <a href="Transforms_2Utils_2Local_8cpp_source.html#l03299">Local.cpp:3299</a></div></div>
<div class="ttc" id="aMSP430Disassembler_8cpp_html_abf132b4ad93f3557cd3956577592ba68"><div class="ttname"><a href="MSP430Disassembler_8cpp.html#abf132b4ad93f3557cd3956577592ba68">AddrMode</a></div><div class="ttdeci">AddrMode</div><div class="ttdef"><b>Definition:</b> <a href="MSP430Disassembler_8cpp_source.html#l00142">MSP430Disassembler.cpp:142</a></div></div>
<div class="ttc" id="anamespacellvm_html_a92be87f8a371f277f7260fb99592d5f4"><div class="ttname"><a href="namespacellvm.html#a92be87f8a371f277f7260fb99592d5f4">llvm::unique</a></div><div class="ttdeci">auto unique(Range &amp;&amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="GenericUniformityImpl_8h_source.html#l00056">GenericUniformityImpl.h:56</a></div></div>
<div class="ttc" id="anamespacellvm_html_ad66c4759666aab78529658362b498c74"><div class="ttname"><a href="namespacellvm.html#ad66c4759666aab78529658362b498c74">llvm::pred_empty</a></div><div class="ttdeci">bool pred_empty(const BasicBlock *BB)</div><div class="ttdef"><b>Definition:</b> <a href="IR_2CFG_8h_source.html#l00118">CFG.h:118</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a025e6664b2f55d2c217543c34eb1f64e"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a025e6664b2f55d2c217543c34eb1f64e">llvm::TargetLoweringBase::InstructionOpcodeToISD</a></div><div class="ttdeci">int InstructionOpcodeToISD(unsigned Opcode) const</div><div class="ttdoc">Get the ISD node that corresponds to the Instruction class opcode.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLoweringBase_8cpp_source.html#l01784">TargetLoweringBase.cpp:1784</a></div></div>
<div class="ttc" id="aclassllvm_1_1CastInst_html"><div class="ttname"><a href="classllvm_1_1CastInst.html">llvm::CastInst</a></div><div class="ttdoc">This is the base class for all instructions that perform data casts.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00428">InstrTypes.h:428</a></div></div>
<div class="ttc" id="anamespacellvm_html_aff30786f1ea13c3ea475acce504571e4"><div class="ttname"><a href="namespacellvm.html#aff30786f1ea13c3ea475acce504571e4">llvm::getCGPassBuilderOption</a></div><div class="ttdeci">CGPassBuilderOption getCGPassBuilderOption()</div><div class="ttdef"><b>Definition:</b> <a href="TargetPassConfig_8cpp_source.html#l00462">TargetPassConfig.cpp:462</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_aa8f4be0661aa64f5b1f20b15e93bb403"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#aa8f4be0661aa64f5b1f20b15e93bb403">llvm::ConstantInt::getSExtValue</a></div><div class="ttdeci">int64_t getSExtValue() const</div><div class="ttdoc">Return the constant as a 64-bit integer value after it has been sign extended as appropriate for the ...</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00147">Constants.h:147</a></div></div>
<div class="ttc" id="aBlockFrequencyInfo_8h_html"><div class="ttname"><a href="BlockFrequencyInfo_8h.html">BlockFrequencyInfo.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPUISD_html_a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996"><div class="ttname"><a href="namespacellvm_1_1AMDGPUISD.html#a739d53294bc38cd6b0b23332f9994c0eafbca76f7875e080d97cee761de04d996">llvm::AMDGPUISD::BFI</a></div><div class="ttdeci">@ BFI</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUISelLowering_8h_source.html#l00441">AMDGPUISelLowering.h:441</a></div></div>
<div class="ttc" id="aclassllvm_1_1IRBuilderBase_html_a8e9aa4e5a6d9f4480322e154153bec2b"><div class="ttname"><a href="classllvm_1_1IRBuilderBase.html#a8e9aa4e5a6d9f4480322e154153bec2b">llvm::IRBuilderBase::CreateCondBr</a></div><div class="ttdeci">BranchInst * CreateCondBr(Value *Cond, BasicBlock *True, BasicBlock *False, MDNode *BranchWeights=nullptr, MDNode *Unpredictable=nullptr)</div><div class="ttdoc">Create a conditional 'br Cond, TrueDest, FalseDest' instruction.</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l01035">IRBuilder.h:1035</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_adb5c319f5905c1d3ca9eb5df546388c5"><div class="ttname"><a href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">llvm::Value::getName</a></div><div class="ttdeci">StringRef getName() const</div><div class="ttdoc">Return a constant reference to the value's name.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00308">Value.cpp:308</a></div></div>
<div class="ttc" id="aclassllvm_1_1ValueMap_html"><div class="ttname"><a href="classllvm_1_1ValueMap.html">llvm::ValueMap</a></div><div class="ttdoc">See the file comment.</div><div class="ttdef"><b>Definition:</b> <a href="ValueMap_8h_source.html#l00084">ValueMap.h:84</a></div></div>
<div class="ttc" id="alib_2Target_2README_8txt_html_a7df6ed7588301267782c2bd4b7f6899d"><div class="ttname"><a href="lib_2Target_2README_8txt.html#a7df6ed7588301267782c2bd4b7f6899d">for</a></div><div class="ttdeci">this could be done in SelectionDAGISel along with other special for</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2README_8txt_source.html#l00104">README.txt:104</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoadInst_html"><div class="ttname"><a href="classllvm_1_1LoadInst.html">llvm::LoadInst</a></div><div class="ttdoc">An instruction for reading from memory.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00177">Instructions.h:177</a></div></div>
<div class="ttc" id="aValueHandle_8h_html"><div class="ttname"><a href="ValueHandle_8h.html">ValueHandle.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a99f811d53704275b4158c62a2dd138d9"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a99f811d53704275b4158c62a2dd138d9">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::insert</a></div><div class="ttdeci">std::pair&lt; iterator, bool &gt; insert(const std::pair&lt; KeyT, ValueT &gt; &amp;KV)</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00207">DenseMap.h:207</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetSubtargetInfo_html"><div class="ttname"><a href="classllvm_1_1TargetSubtargetInfo.html">llvm::TargetSubtargetInfo</a></div><div class="ttdoc">TargetSubtargetInfo - Generic base class for all target subtargets.</div><div class="ttdef"><b>Definition:</b> <a href="TargetSubtargetInfo_8h_source.html#l00062">TargetSubtargetInfo.h:62</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_abc10b887caad109288ffceb230493a85"><div class="ttname"><a href="classllvm_1_1CallBase.html#abc10b887caad109288ffceb230493a85">llvm::CallBase::setArgOperand</a></div><div class="ttdeci">void setArgOperand(unsigned i, Value *v)</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01356">InstrTypes.h:1356</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html_a1600c7959045cb6b6a5f5a1d427ec67e"><div class="ttname"><a href="classllvm_1_1User.html#a1600c7959045cb6b6a5f5a1d427ec67e">llvm::User::replaceUsesOfWith</a></div><div class="ttdeci">bool replaceUsesOfWith(Value *From, Value *To)</div><div class="ttdoc">Replace uses of one Value with another.</div><div class="ttdef"><b>Definition:</b> <a href="User_8cpp_source.html#l00021">User.cpp:21</a></div></div>
<div class="ttc" id="anamespacellvm_1_1HexagonMCInstrInfo_html_a213afb2c8d115f7e8c72c298e7f54046"><div class="ttname"><a href="namespacellvm_1_1HexagonMCInstrInfo.html#a213afb2c8d115f7e8c72c298e7f54046">llvm::HexagonMCInstrInfo::getAddrMode</a></div><div class="ttdeci">unsigned getAddrMode(MCInstrInfo const &amp;MCII, MCInst const &amp;MCI)</div><div class="ttdef"><b>Definition:</b> <a href="HexagonMCInstrInfo_8cpp_source.html#l00248">HexagonMCInstrInfo.cpp:248</a></div></div>
<div class="ttc" id="aValueMap_8h_html"><div class="ttname"><a href="ValueMap_8h.html">ValueMap.h</a></div></div>
<div class="ttc" id="aSampleProfWriter_8cpp_html_ac5f3689931c7238da06ba00cf1002c62"><div class="ttname"><a href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a></div><div class="ttdeci">raw_pwrite_stream &amp; OS</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfWriter_8cpp_source.html#l00053">SampleProfWriter.cpp:53</a></div></div>
<div class="ttc" id="anamespacellvm_html_a766456df1dd21e804cd4596304e10764ae8b4b40ec3622e371789b790caabc083"><div class="ttname"><a href="namespacellvm.html#a766456df1dd21e804cd4596304e10764ae8b4b40ec3622e371789b790caabc083">llvm::ComplexDeinterleavingOperation::Shuffle</a></div><div class="ttdeci">@ Shuffle</div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html">llvm::AtomicRMWInst</a></div><div class="ttdoc">an instruction that atomically reads a memory location, combines it with another value,...</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00718">Instructions.h:718</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a966eb231e7d4e572874d2cb49b18faea"><div class="ttname"><a href="classllvm_1_1Value.html#a966eb231e7d4e572874d2cb49b18faea">llvm::Value::stripPointerCasts</a></div><div class="ttdeci">const Value * stripPointerCasts() const</div><div class="ttdoc">Strip off pointer casts, all-zero GEPs and address space casts.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00685">Value.cpp:685</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImplBase_html_a0e1c3175b0ac22fe3853651c28e1ecb8"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImplBase.html#a0e1c3175b0ac22fe3853651c28e1ecb8">llvm::SmallPtrSetImplBase::size</a></div><div class="ttdeci">size_type size() const</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00093">SmallPtrSet.h:93</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a19e2fd6fce422c4ab3cea555782abbb6"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a19e2fd6fce422c4ab3cea555782abbb6">isExtractBitsCandidateUse</a></div><div class="ttdeci">static bool isExtractBitsCandidateUse(Instruction *User)</div><div class="ttdoc">Check if the candidates could be combined with a shift instruction, which includes:</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l01925">CodeGenPrepare.cpp:1925</a></div></div>
<div class="ttc" id="aclassllvm_1_1MapVector_html_a0881334358ff6ff7ff8cea5562c7988e"><div class="ttname"><a href="classllvm_1_1MapVector.html#a0881334358ff6ff7ff8cea5562c7988e">llvm::MapVector::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00072">MapVector.h:72</a></div></div>
<div class="ttc" id="aArgument_8h_html"><div class="ttname"><a href="Argument_8h.html">Argument.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_ab706e7ebb1969c5e34f28bfcf2ff719e"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#ab706e7ebb1969c5e34f28bfcf2ff719e">llvm::BasicBlock::front</a></div><div class="ttdeci">const Instruction &amp; front() const</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00326">BasicBlock.h:326</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a1dc76cc8bf703e6ada68bededcbb9573"><div class="ttname"><a href="classllvm_1_1APInt.html#a1dc76cc8bf703e6ada68bededcbb9573">llvm::APInt::zext</a></div><div class="ttdeci">APInt zext(unsigned width) const</div><div class="ttdoc">Zero extend to a new width.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8cpp_source.html#l00973">APInt.cpp:973</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a8e1c8a5721df02cd26c1ffd04320b02c"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a8e1c8a5721df02cd26c1ffd04320b02c">llvm::TargetLoweringBase::isFreeAddrSpaceCast</a></div><div class="ttdeci">virtual bool isFreeAddrSpaceCast(unsigned SrcAS, unsigned DestAS) const</div><div class="ttdoc">Returns true if a cast from SrcAS to DestAS is &quot;cheap&quot;, such that e.g.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLoweringBase_8cpp_source.html#l00946">TargetLoweringBase.cpp:946</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a1ae2ee148379ed3d041b4bce586f7f99"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a1ae2ee148379ed3d041b4bce586f7f99">llvm::TargetLoweringBase::getTargetMachine</a></div><div class="ttdeci">const TargetMachine &amp; getTargetMachine() const</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l00358">TargetLowering.h:358</a></div></div>
<div class="ttc" id="aAttributes_8h_html"><div class="ttname"><a href="Attributes_8h.html">Attributes.h</a></div></div>
<div class="ttc" id="aEntryExitInstrumenter_8cpp_html_a3985f1f39349428d17f0d2b81ebc6349"><div class="ttname"><a href="EntryExitInstrumenter_8cpp.html#a3985f1f39349428d17f0d2b81ebc6349">runOnFunction</a></div><div class="ttdeci">static bool runOnFunction(Function &amp;F, bool PostInlining)</div><div class="ttdef"><b>Definition:</b> <a href="EntryExitInstrumenter_8cpp_source.html#l00085">EntryExitInstrumenter.cpp:85</a></div></div>
<div class="ttc" id="aclassllvm_1_1MapVector_html_a8da97c44f514ad1ae9ccf4518b0f88aa"><div class="ttname"><a href="classllvm_1_1MapVector.html#a8da97c44f514ad1ae9ccf4518b0f88aa">llvm::MapVector::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00080">MapVector.h:80</a></div></div>
<div class="ttc" id="aclassllvm_1_1ProfileSummaryInfo_html_ad7a8ced5ff54962319d57208f5d4a57e"><div class="ttname"><a href="classllvm_1_1ProfileSummaryInfo.html#ad7a8ced5ff54962319d57208f5d4a57e">llvm::ProfileSummaryInfo::hasHugeWorkingSetSize</a></div><div class="ttdeci">bool hasHugeWorkingSetSize() const</div><div class="ttdoc">Returns true if the working set size of the code is considered huge.</div><div class="ttdef"><b>Definition:</b> <a href="ProfileSummaryInfo_8cpp_source.html#l00284">ProfileSummaryInfo.cpp:284</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a10ece31d94cdd66e58cef49d73f2263f"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a10ece31d94cdd66e58cef49d73f2263f">sinkSelectOperand</a></div><div class="ttdeci">static bool sinkSelectOperand(const TargetTransformInfo *TTI, Value *V)</div><div class="ttdoc">Check if V (an operand of a select instruction) is an expensive instruction that is only used once.</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l06703">CodeGenPrepare.cpp:6703</a></div></div>
<div class="ttc" id="aclassllvm_1_1DataLayout_html_a7a2619d0e489a4ba9c19a0d86a041d59"><div class="ttname"><a href="classllvm_1_1DataLayout.html#a7a2619d0e489a4ba9c19a0d86a041d59">llvm::DataLayout::getIntPtrType</a></div><div class="ttdeci">IntegerType * getIntPtrType(LLVMContext &amp;C, unsigned AddressSpace=0) const</div><div class="ttdoc">Returns an integer type with size at least as big as that of a pointer in the given address space.</div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8cpp_source.html#l00861">DataLayout.cpp:861</a></div></div>
<div class="ttc" id="aConstant_8h_html"><div class="ttname"><a href="Constant_8h.html">Constant.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1NVPTX_1_1PTXLdStInstCode_html_a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4"><div class="ttname"><a href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">llvm::NVPTX::PTXLdStInstCode::V2</a></div><div class="ttdeci">@ V2</div><div class="ttdef"><b>Definition:</b> <a href="NVPTX_8h_source.html#l00124">NVPTX.h:124</a></div></div>
<div class="ttc" id="anamespacellvm_html_adf83581f514774264d616eef5706cf6e"><div class="ttname"><a href="namespacellvm.html#adf83581f514774264d616eef5706cf6e">llvm::SplitEdge</a></div><div class="ttdeci">BasicBlock * SplitEdge(BasicBlock *From, BasicBlock *To, DominatorTree *DT=nullptr, LoopInfo *LI=nullptr, MemorySSAUpdater *MSSAU=nullptr, const Twine &amp;BBName=&quot;&quot;)</div><div class="ttdoc">Split the edge connecting the specified blocks, and return the newly created basic block between From...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockUtils_8cpp_source.html#l00615">BasicBlockUtils.cpp:615</a></div></div>
<div class="ttc" id="anamespacellvm_html_a152d8c380cc937c9dceb402ceec943b6"><div class="ttname"><a href="namespacellvm.html#a152d8c380cc937c9dceb402ceec943b6">llvm::ConstantFoldTerminator</a></div><div class="ttdeci">bool ConstantFoldTerminator(BasicBlock *BB, bool DeleteDeadConditions=false, const TargetLibraryInfo *TLI=nullptr, DomTreeUpdater *DTU=nullptr)</div><div class="ttdoc">If a terminator instruction is predicated on a constant value, convert it into an unconditional branc...</div><div class="ttdef"><b>Definition:</b> <a href="Transforms_2Utils_2Local_8cpp_source.html#l00126">Local.cpp:126</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantExpr_html"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html">llvm::ConstantExpr</a></div><div class="ttdoc">A constant value that is initialized with an expression using other constant values.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00998">Constants.h:998</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_a82dbbd8e3688b0bc1eedb338864d0d0c"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a82dbbd8e3688b0bc1eedb338864d0d0c">llvm::ConstantInt::getTrue</a></div><div class="ttdeci">static ConstantInt * getTrue(LLVMContext &amp;Context)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00835">Constants.cpp:835</a></div></div>
<div class="ttc" id="aAArch64MIPeepholeOpt_8cpp_html_a96d5dc120196819fbfbc257cba09b2aa"><div class="ttname"><a href="AArch64MIPeepholeOpt_8cpp.html#a96d5dc120196819fbfbc257cba09b2aa">Insn</a></div><div class="ttdeci">SmallVector&lt; AArch64_IMM::ImmInsnModel, 4 &gt; Insn</div><div class="ttdef"><b>Definition:</b> <a href="AArch64MIPeepholeOpt_8cpp_source.html#l00129">AArch64MIPeepholeOpt.cpp:129</a></div></div>
<div class="ttc" id="aHWAddressSanitizer_8cpp_html_ad5c3fea3e9699b6299cc037334eeb83e"><div class="ttname"><a href="HWAddressSanitizer_8cpp.html#ad5c3fea3e9699b6299cc037334eeb83e">getPointerOperandIndex</a></div><div class="ttdeci">static unsigned getPointerOperandIndex(Instruction *I)</div><div class="ttdef"><b>Definition:</b> <a href="HWAddressSanitizer_8cpp_source.html#l00777">HWAddressSanitizer.cpp:777</a></div></div>
<div class="ttc" id="aclassllvm_1_1Constant_html_aa6574d526b3e38a28f688a7bb4325c2c"><div class="ttname"><a href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">llvm::Constant::getNullValue</a></div><div class="ttdeci">static Constant * getNullValue(Type *Ty)</div><div class="ttdoc">Constructor to create a '0' constant of arbitrary type.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00356">Constants.cpp:356</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachineBasicBlock_html_a134a21189d056b81b80d0cdf01ef8c46"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a134a21189d056b81b80d0cdf01ef8c46">llvm::MachineBasicBlock::replacePhiUsesWith</a></div><div class="ttdeci">void replacePhiUsesWith(MachineBasicBlock *Old, MachineBasicBlock *New)</div><div class="ttdoc">Update all phi nodes in this basic block to refer to basic block New instead of basic block Old.</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8cpp_source.html#l01384">MachineBasicBlock.cpp:1384</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_acd2fbee42afeb868be98aaae56528636"><div class="ttname"><a href="classllvm_1_1Value.html#acd2fbee42afeb868be98aaae56528636">llvm::Value::user_iterator</a></div><div class="ttdeci">user_iterator_impl&lt; User &gt; user_iterator</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00390">Value.h:390</a></div></div>
<div class="ttc" id="aclassllvm_1_1ProfileSummaryInfo_html_abd5d83a44a9a4a18b313168beffd124a"><div class="ttname"><a href="classllvm_1_1ProfileSummaryInfo.html#abd5d83a44a9a4a18b313168beffd124a">llvm::ProfileSummaryInfo::isFunctionColdInCallGraph</a></div><div class="ttdeci">bool isFunctionColdInCallGraph(const Function *F, BlockFrequencyInfo &amp;BFI) const</div><div class="ttdoc">Returns true if F contains only cold code.</div><div class="ttdef"><b>Definition:</b> <a href="ProfileSummaryInfo_8cpp_source.html#l00145">ProfileSummaryInfo.cpp:145</a></div></div>
<div class="ttc" id="aREADME-Thumb_8txt_html_a5d98a8b5139e56ebf0d2ff4cbaa0dc5e"><div class="ttname"><a href="README-Thumb_8txt.html#a5d98a8b5139e56ebf0d2ff4cbaa0dc5e">code</a></div><div class="ttdeci">*Add support for compiling functions in both ARM and Thumb then taking the smallest *Add support for compiling individual basic blocks in thumb when in a larger ARM function This can be used for presumed cold code</div><div class="ttdef"><b>Definition:</b> <a href="README-Thumb_8txt_source.html#l00009">README-Thumb.txt:9</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantExpr_html_afa29f0cd072ab9b3a2630681ffe5760f"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#afa29f0cd072ab9b3a2630681ffe5760f">llvm::ConstantExpr::getNeg</a></div><div class="ttdeci">static Constant * getNeg(Constant *C, bool HasNUW=false, bool HasNSW=false)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l02644">Constants.cpp:2644</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a0e4302b3aa3294121137e2bb0e98a573"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a0e4302b3aa3294121137e2bb0e98a573">DisableExtLdPromotion</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; DisableExtLdPromotion(&quot;disable-cgp-ext-ld-promotion&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Disable ext(promotable(ld)) -&gt; promoted(ext(ld)) optimization in &quot; &quot;CodeGenPrepare&quot;))</div></div>
<div class="ttc" id="alib_2Target_2PowerPC_2README_8txt_html_aa91241c8c54738377749dc47ee489e0d"><div class="ttname"><a href="lib_2Target_2PowerPC_2README_8txt.html#aa91241c8c54738377749dc47ee489e0d">get</a></div><div class="ttdeci">Should compile to something r4 addze r3 instead we get</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2PowerPC_2README_8txt_source.html#l00024">README.txt:24</a></div></div>
<div class="ttc" id="aregutils_8h_html_a1fa2460e32327ade49189c95740bc1b5"><div class="ttname"><a href="regutils_8h.html#a1fa2460e32327ade49189c95740bc1b5">NC</a></div><div class="ttdeci">#define NC</div><div class="ttdef"><b>Definition:</b> <a href="regutils_8h_source.html#l00042">regutils.h:42</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a65520b9c67759099e313d0f4e7b5ff9e"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a65520b9c67759099e313d0f4e7b5ff9e">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00084">DenseMap.h:84</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1SendMsg_html_a8594419a4ddfad2c9a79279c490e466d"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">llvm::AMDGPU::SendMsg::Op</a></div><div class="ttdeci">Op</div><div class="ttdef"><b>Definition:</b> <a href="SIDefines_8h_source.html#l00357">SIDefines.h:357</a></div></div>
<div class="ttc" id="aclassllvm_1_1StructLayout_html_a9b53bc4ade993c638837c1344465c1f8"><div class="ttname"><a href="classllvm_1_1StructLayout.html#a9b53bc4ade993c638837c1344465c1f8">llvm::StructLayout::getElementOffset</a></div><div class="ttdeci">uint64_t getElementOffset(unsigned Idx) const</div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00648">DataLayout.h:648</a></div></div>
<div class="ttc" id="anamespacellvm_1_1X86_html_a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e"><div class="ttname"><a href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">llvm::X86::FirstMacroFusionInstKind::Cmp</a></div><div class="ttdeci">@ Cmp</div></div>
<div class="ttc" id="aBasicBlockSectionsProfileReader_8h_html"><div class="ttname"><a href="BasicBlockSectionsProfileReader_8h.html">BasicBlockSectionsProfileReader.h</a></div></div>
<div class="ttc" id="aGlobalVariable_8h_html"><div class="ttname"><a href="GlobalVariable_8h.html">GlobalVariable.h</a></div></div>
<div class="ttc" id="aScalarizeMaskedMemIntrin_8cpp_html_a8f3425131aae6ea2275a052284a7c2dc"><div class="ttname"><a href="ScalarizeMaskedMemIntrin_8cpp.html#a8f3425131aae6ea2275a052284a7c2dc">optimizeBlock</a></div><div class="ttdeci">static bool optimizeBlock(BasicBlock &amp;BB, bool &amp;ModifiedDT, const TargetTransformInfo &amp;TTI, const DataLayout &amp;DL, DomTreeUpdater *DTU)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarizeMaskedMemIntrin_8cpp_source.html#l00909">ScalarizeMaskedMemIntrin.cpp:909</a></div></div>
<div class="ttc" id="anamespacellvm_html_a5eeaf08e96168c2cac8960f87f0ef360"><div class="ttname"><a href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">llvm::pred_end</a></div><div class="ttdeci">Interval::pred_iterator pred_end(Interval *I)</div><div class="ttdef"><b>Definition:</b> <a href="Interval_8h_source.html#l00112">Interval.h:112</a></div></div>
<div class="ttc" id="aclassllvm_1_1ExtractValueInst_html"><div class="ttname"><a href="classllvm_1_1ExtractValueInst.html">llvm::ExtractValueInst</a></div><div class="ttdoc">This instruction extracts a struct member or array element value from an aggregate value.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02455">Instructions.h:2455</a></div></div>
<div class="ttc" id="aISDOpcodes_8h_html"><div class="ttname"><a href="ISDOpcodes_8h.html">ISDOpcodes.h</a></div></div>
<div class="ttc" id="aAArch64Disassembler_8cpp_html_abdb086b34295fb7aa09493c62d798465"><div class="ttname"><a href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a></div><div class="ttdeci">#define Success</div><div class="ttdef"><b>Definition:</b> <a href="AArch64Disassembler_8cpp_source.html#l00300">AArch64Disassembler.cpp:300</a></div></div>
<div class="ttc" id="aclassllvm_1_1TypeSize_html"><div class="ttname"><a href="classllvm_1_1TypeSize.html">llvm::TypeSize</a></div><div class="ttdef"><b>Definition:</b> <a href="TypeSize_8h_source.html#l00314">TypeSize.h:314</a></div></div>
<div class="ttc" id="anamespacellvm_1_1MCID_html_ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c"><div class="ttname"><a href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">llvm::MCID::Branch</a></div><div class="ttdeci">@ Branch</div><div class="ttdef"><b>Definition:</b> <a href="MCInstrDesc_8h_source.html#l00159">MCInstrDesc.h:159</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_ad736fb9b585509388546c12617def38f"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#ad736fb9b585509388546c12617def38f">llvm::ConstantInt::getSigned</a></div><div class="ttdeci">static ConstantInt * getSigned(IntegerType *Ty, int64_t V)</div><div class="ttdoc">Return a ConstantInt with the specified value for the specified type.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00901">Constants.cpp:901</a></div></div>
<div class="ttc" id="aCasting_8h_html"><div class="ttname"><a href="Casting_8h.html">Casting.h</a></div></div>
<div class="ttc" id="aFunction_8h_html"><div class="ttname"><a href="Function_8h.html">Function.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_abee0df5f7f703bb4462aba260ba0a60f"><div class="ttname"><a href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">llvm::BitWidth</a></div><div class="ttdeci">constexpr unsigned BitWidth</div><div class="ttdef"><b>Definition:</b> <a href="BitmaskEnum_8h_source.html#l00147">BitmaskEnum.h:147</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoopBase_html_a58c5b170ea68b41e94ebb0019523a68f"><div class="ttname"><a href="classllvm_1_1LoopBase.html#a58c5b170ea68b41e94ebb0019523a68f">llvm::LoopBase::getHeader</a></div><div class="ttdeci">BlockT * getHeader() const</div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l00105">LoopInfo.h:105</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a3d95cc2d359b8d9ed5bd9504b44930b5"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a3d95cc2d359b8d9ed5bd9504b44930b5">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::size</a></div><div class="ttdeci">unsigned size() const</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00099">DenseMap.h:99</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html_a21c2c6ae5ec23004dc4020eacf83bbce"><div class="ttname"><a href="classllvm_1_1SetVector.html#a21c2c6ae5ec23004dc4020eacf83bbce">llvm::SetVector&lt; T, SmallVector&lt; T, N &gt;, SmallDenseSet&lt; T, N &gt; &gt;::count</a></div><div class="ttdeci">size_type count(const key_type &amp;key) const</div><div class="ttdoc">Count the number of elements of a given key in the SetVector.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00208">SetVector.h:208</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_adc01a7457de85fc52a3bb860d7e1c6a4"><div class="ttname"><a href="classllvm_1_1Type.html#adc01a7457de85fc52a3bb860d7e1c6a4">llvm::Type::getPointerTo</a></div><div class="ttdeci">PointerType * getPointerTo(unsigned AddrSpace=0) const</div><div class="ttdoc">Return a pointer to the current type.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00776">Type.cpp:776</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLibraryInfo_html"><div class="ttname"><a href="classllvm_1_1TargetLibraryInfo.html">llvm::TargetLibraryInfo</a></div><div class="ttdoc">Provides information about what library functions are available for the current target.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLibraryInfo_8h_source.html#l00234">TargetLibraryInfo.h:234</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a0e431b29d5cd842ab00f85ec2cdab8b2"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a0e431b29d5cd842ab00f85ec2cdab8b2">getGEPSmallConstantIntOffsetV</a></div><div class="ttdeci">static bool getGEPSmallConstantIntOffsetV(GetElementPtrInst *GEP, SmallVectorImpl&lt; Value * &gt; &amp;OffsetV)</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l01147">CodeGenPrepare.cpp:1147</a></div></div>
<div class="ttc" id="aclassllvm_1_1SDValue_html"><div class="ttname"><a href="classllvm_1_1SDValue.html">llvm::SDValue</a></div><div class="ttdoc">Unlike LLVM values, Selection DAG nodes may return multiple values as the result of a computation.</div><div class="ttdef"><b>Definition:</b> <a href="SelectionDAGNodes_8h_source.html#l00145">SelectionDAGNodes.h:145</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a29366507d51536f380af3c2184bfe374"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a29366507d51536f380af3c2184bfe374">llvm::TargetLoweringBase::isSExtCheaperThanZExt</a></div><div class="ttdeci">virtual bool isSExtCheaperThanZExt(EVT FromTy, EVT ToTy) const</div><div class="ttdoc">Return true if sign-extension from FromTy to ToTy is cheaper than zero-extension.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l02841">TargetLowering.h:2841</a></div></div>
<div class="ttc" id="astructllvm_1_1ExtAddrMode_html_ae20bc007be03337ee451abb60d74260b"><div class="ttname"><a href="structllvm_1_1ExtAddrMode.html#ae20bc007be03337ee451abb60d74260b">llvm::ExtAddrMode::Scale</a></div><div class="ttdeci">int64_t Scale</div><div class="ttdef"><b>Definition:</b> <a href="TargetInstrInfo_8h_source.html#l00090">TargetInstrInfo.h:90</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a5d3d315f678bc76e43b27d18e5d72829"><div class="ttname"><a href="classllvm_1_1Instruction.html#a5d3d315f678bc76e43b27d18e5d72829">llvm::Instruction::isEHPad</a></div><div class="ttdeci">bool isEHPad() const</div><div class="ttdoc">Return true if the instruction is a variety of EH-block.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00685">Instruction.h:685</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_aac0ea55010b7b1a301e65a0baea057aa"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">llvm::SmallVectorImpl::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00614">SmallVector.h:614</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a874d53817a4923de8e58af6b278c09b0"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a874d53817a4923de8e58af6b278c09b0">llvm::PatternMatch::m_ZeroInt</a></div><div class="ttdeci">cst_pred_ty&lt; is_zero_int &gt; m_ZeroInt()</div><div class="ttdoc">Match an integer 0 or a vector with all elements equal to 0.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00524">PatternMatch.h:524</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a9d0372d5a469c089a4f2a299dd679558"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a9d0372d5a469c089a4f2a299dd679558">MightBeFoldableInst</a></div><div class="ttdeci">static bool MightBeFoldableInst(Instruction *I)</div><div class="ttdoc">This is a little filter, which returns true if an addressing computation involving I might be folded ...</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l04089">CodeGenPrepare.cpp:4089</a></div></div>
<div class="ttc" id="anamespacellvm_1_1MCID_html_ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec"><div class="ttname"><a href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec">llvm::MCID::Add</a></div><div class="ttdeci">@ Add</div><div class="ttdef"><b>Definition:</b> <a href="MCInstrDesc_8h_source.html#l00186">MCInstrDesc.h:186</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallSet_html_a1679469af9bb8ccfbe98441fb8228c79"><div class="ttname"><a href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">llvm::SmallSet::insert</a></div><div class="ttdeci">std::pair&lt; const_iterator, bool &gt; insert(const T &amp;V)</div><div class="ttdoc">insert - Insert an element into the set if it isn't already there.</div><div class="ttdef"><b>Definition:</b> <a href="SmallSet_8h_source.html#l00177">SmallSet.h:177</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_ab068741575ed8c7f6bd4fe059edabd14"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#ab068741575ed8c7f6bd4fe059edabd14">llvm::TargetLoweringBase::isMultiStoresCheaperThanBitsMerge</a></div><div class="ttdeci">virtual bool isMultiStoresCheaperThanBitsMerge(EVT LTy, EVT HTy) const</div><div class="ttdoc">Return true if it is cheaper to split the store of a merged int val from a pair of smaller values int...</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l00657">TargetLowering.h:657</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a75c56e6018bb081bdcbed08b95ca00f3"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a75c56e6018bb081bdcbed08b95ca00f3">llvm::TargetLoweringBase::optimizeExtendOrTruncateConversion</a></div><div class="ttdeci">virtual bool optimizeExtendOrTruncateConversion(Instruction *I, Loop *L) const</div><div class="ttdoc">Try to optimize extending or truncating conversion instructions (like zext, trunc,...</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l02861">TargetLowering.h:2861</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_aca8fce65eb69a82aa10a635e2e79877a"><div class="ttname"><a href="classllvm_1_1APInt.html#aca8fce65eb69a82aa10a635e2e79877a">llvm::APInt::sext</a></div><div class="ttdeci">APInt sext(unsigned width) const</div><div class="ttdoc">Sign extend to a new width.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8cpp_source.html#l00946">APInt.cpp:946</a></div></div>
<div class="ttc" id="aclassllvm_1_1IntrinsicInst_html"><div class="ttname"><a href="classllvm_1_1IntrinsicInst.html">llvm::IntrinsicInst</a></div><div class="ttdoc">A wrapper class for inspecting calls to intrinsic functions.</div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00047">IntrinsicInst.h:47</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a3b4a54b076454fec43b13554b28252a9"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a3b4a54b076454fec43b13554b28252a9">llvm::CmpInst::Create</a></div><div class="ttdeci">static CmpInst * Create(OtherOps Op, Predicate predicate, Value *S1, Value *S2, const Twine &amp;Name=&quot;&quot;, Instruction *InsertBefore=nullptr)</div><div class="ttdoc">Construct a compare instruction, given the opcode, the predicate and the two operands.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l04025">Instructions.cpp:4025</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_ae965d93aa46ad834c21718eba4b5b78e"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#ae965d93aa46ad834c21718eba4b5b78e">hasSameExtUse</a></div><div class="ttdeci">static bool hasSameExtUse(Value *Val, const TargetLowering &amp;TLI)</div><div class="ttdoc">Check if all the uses of Val are equivalent (or free) zero or sign extensions.</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l05774">CodeGenPrepare.cpp:5774</a></div></div>
<div class="ttc" id="aclassllvm_1_1MDBuilder_html"><div class="ttname"><a href="classllvm_1_1MDBuilder.html">llvm::MDBuilder</a></div><div class="ttdef"><b>Definition:</b> <a href="MDBuilder_8h_source.html#l00036">MDBuilder.h:36</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a3c7e1486d1d466b3be981adcb21a6359"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a3c7e1486d1d466b3be981adcb21a6359">splitMergedValStore</a></div><div class="ttdeci">static bool splitMergedValStore(StoreInst &amp;SI, const DataLayout &amp;DL, const TargetLowering &amp;TLI)</div><div class="ttdoc">For the instruction sequence of store below, F and I values are bundled together as an i64 value befo...</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l07690">CodeGenPrepare.cpp:7690</a></div></div>
<div class="ttc" id="aclassllvm_1_1AllocaInst_html_af3bb24b322533dbe8a63c84b18568fe1"><div class="ttname"><a href="classllvm_1_1AllocaInst.html#af3bb24b322533dbe8a63c84b18568fe1">llvm::AllocaInst::setAlignment</a></div><div class="ttdeci">void setAlignment(Align Align)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00129">Instructions.h:129</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a6f992bc4ca89f1b5f0b34f5b29978c31"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a6f992bc4ca89f1b5f0b34f5b29978c31">llvm::TargetLoweringBase::isTruncateFree</a></div><div class="ttdeci">virtual bool isTruncateFree(Type *FromTy, Type *ToTy) const</div><div class="ttdoc">Return true if it's free to truncate a value of type FromTy to type ToTy.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l02739">TargetLowering.h:2739</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a269866fa58b625676b6b8b53f8e55731"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a269866fa58b625676b6b8b53f8e55731">ForceSplitStore</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; ForceSplitStore(&quot;force-split-store&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Force store splitting no matter what the target query says.&quot;))</div></div>
<div class="ttc" id="anamespacellvm_html_a7e108932dc3da5294aed99a353aac9c4"><div class="ttname"><a href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">llvm::pred_begin</a></div><div class="ttdeci">Interval::pred_iterator pred_begin(Interval *I)</div><div class="ttdoc">pred_begin/pred_end - define methods so that Intervals may be used just like BasicBlocks can with the...</div><div class="ttdef"><b>Definition:</b> <a href="Interval_8h_source.html#l00109">Interval.h:109</a></div></div>
<div class="ttc" id="aScalarizeMaskedMemIntrin_8cpp_html_a8839065ea712711c22d6da68b2fb2d64"><div class="ttname"><a href="ScalarizeMaskedMemIntrin_8cpp.html#a8839065ea712711c22d6da68b2fb2d64">optimizeCallInst</a></div><div class="ttdeci">static bool optimizeCallInst(CallInst *CI, bool &amp;ModifiedDT, const TargetTransformInfo &amp;TTI, const DataLayout &amp;DL, DomTreeUpdater *DTU)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarizeMaskedMemIntrin_8cpp_source.html#l00925">ScalarizeMaskedMemIntrin.cpp:925</a></div></div>
<div class="ttc" id="aclassllvm_1_1ShuffleVectorInst_html"><div class="ttname"><a href="classllvm_1_1ShuffleVectorInst.html">llvm::ShuffleVectorInst</a></div><div class="ttdoc">This instruction constructs a fixed permutation of two input vectors.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02017">Instructions.h:2017</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoopInfoBase_html_a4f728602e7d377829675f13446cf6647"><div class="ttname"><a href="classllvm_1_1LoopInfoBase.html#a4f728602e7d377829675f13446cf6647">llvm::LoopInfoBase::end</a></div><div class="ttdeci">iterator end() const</div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l00968">LoopInfo.h:968</a></div></div>
<div class="ttc" id="aInstructions_8h_html"><div class="ttname"><a href="Instructions_8h.html">Instructions.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html_addec638786f763d967811b45cb662f1f"><div class="ttname"><a href="classllvm_1_1User.html#addec638786f763d967811b45cb662f1f">llvm::User::getNumOperands</a></div><div class="ttdeci">unsigned getNumOperands() const</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00191">User.h:191</a></div></div>
<div class="ttc" id="aclassllvm_1_1PointerIntPair_html"><div class="ttname"><a href="classllvm_1_1PointerIntPair.html">llvm::PointerIntPair</a></div><div class="ttdoc">PointerIntPair - This class implements a pair of a pointer and small integer.</div><div class="ttdef"><b>Definition:</b> <a href="PointerIntPair_8h_source.html#l00046">PointerIntPair.h:46</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a399726540ec6435b4c7237b298239741"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a399726540ec6435b4c7237b298239741">llvm::TargetLoweringBase::enableExtLdPromotion</a></div><div class="ttdeci">bool enableExtLdPromotion() const</div><div class="ttdoc">Return true if the target wants to use the optimization that turns ext(promotableInst1(....</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l00804">TargetLowering.h:804</a></div></div>
<div class="ttc" id="aSmallVector_8h_html"><div class="ttname"><a href="SmallVector_8h.html">SmallVector.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a2d9861feadd3a09792967a012559e7b2"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">llvm::PatternMatch::m_Specific</a></div><div class="ttdeci">specificval_ty m_Specific(const Value *V)</div><div class="ttdoc">Match if we have a specific specified value.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00772">PatternMatch.h:772</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_ab4f3bf98b5054831b608852e33427814"><div class="ttname"><a href="classllvm_1_1Instruction.html#ab4f3bf98b5054831b608852e33427814">llvm::Instruction::getDebugLoc</a></div><div class="ttdeci">const DebugLoc &amp; getDebugLoc() const</div><div class="ttdoc">Return the debug location for this node as a DebugLoc.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00358">Instruction.h:358</a></div></div>
<div class="ttc" id="aUser_8h_html"><div class="ttname"><a href="User_8h.html">User.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1DbgVariableIntrinsic_html_aaf2539583fcfa83b3ecdfc1fea52cff6"><div class="ttname"><a href="classllvm_1_1DbgVariableIntrinsic.html#aaf2539583fcfa83b3ecdfc1fea52cff6">llvm::DbgVariableIntrinsic::setKillLocation</a></div><div class="ttdeci">void setKillLocation()</div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00270">IntrinsicInst.h:270</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a3fe9b3ddb71b9fb53d9fc74b3a0710bf"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a3fe9b3ddb71b9fb53d9fc74b3a0710bf">llvm::PatternMatch::m_ICmp</a></div><div class="ttdeci">CmpClass_match&lt; LHS, RHS, ICmpInst, ICmpInst::Predicate &gt; m_ICmp(ICmpInst::Predicate &amp;Pred, const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01394">PatternMatch.h:1394</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a2be3583dac92a031fa1458d4d992c78ba607cecdc5172814382033e001ed11fad"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba607cecdc5172814382033e001ed11fad">llvm::CmpInst::ICMP_UGT</a></div><div class="ttdeci">@ ICMP_UGT</div><div class="ttdoc">unsigned greater than</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00741">InstrTypes.h:741</a></div></div>
<div class="ttc" id="aDominators_8h_html"><div class="ttname"><a href="Dominators_8h.html">Dominators.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_a8f1d94877a9c9ea068af41c5315f5117"><div class="ttname"><a href="namespacellvm.html#a8f1d94877a9c9ea068af41c5315f5117">llvm::initializeCodeGenPreparePass</a></div><div class="ttdeci">void initializeCodeGenPreparePass(PassRegistry &amp;)</div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_ac5b936169badf0b703567eb960278648"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#ac5b936169badf0b703567eb960278648">llvm::SmallVectorImpl::iterator</a></div><div class="ttdeci">typename SuperClass::iterator iterator</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00581">SmallVector.h:581</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_ab2caa29167597390ab2fc3cf30d70389"><div class="ttname"><a href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">llvm::CallBase::getArgOperand</a></div><div class="ttdeci">Value * getArgOperand(unsigned i) const</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01351">InstrTypes.h:1351</a></div></div>
<div class="ttc" id="aclassllvm_1_1FreezeInst_html"><div class="ttname"><a href="classllvm_1_1FreezeInst.html">llvm::FreezeInst</a></div><div class="ttdoc">This class represents a freeze function that returns random concrete value if an operand is either a ...</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l05440">Instructions.h:5440</a></div></div>
<div class="ttc" id="aclassllvm_1_1AssertingVH_html"><div class="ttname"><a href="classllvm_1_1AssertingVH.html">llvm::AssertingVH</a></div><div class="ttdoc">Value handle that asserts if the Value is deleted.</div><div class="ttdef"><b>Definition:</b> <a href="ValueHandle_8h_source.html#l00260">ValueHandle.h:260</a></div></div>
<div class="ttc" id="aclassllvm_1_1CastInst_html_a3685b2128d8e6917000e4adc3b266ff6"><div class="ttname"><a href="classllvm_1_1CastInst.html#a3685b2128d8e6917000e4adc3b266ff6">llvm::CastInst::getOpcode</a></div><div class="ttdeci">Instruction::CastOps getOpcode() const</div><div class="ttdoc">Return the opcode of this CastInst.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00675">InstrTypes.h:675</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ISD_html_a22ea9cec080dd5f4f47ba234c2f59110aeea401cc0b7fa5aa6f4d3a0612140e1d"><div class="ttname"><a href="namespacellvm_1_1ISD.html#a22ea9cec080dd5f4f47ba234c2f59110aeea401cc0b7fa5aa6f4d3a0612140e1d">llvm::ISD::BITREVERSE</a></div><div class="ttdeci">@ BITREVERSE</div><div class="ttdef"><b>Definition:</b> <a href="ISDOpcodes_8h_source.html#l00704">ISDOpcodes.h:704</a></div></div>
<div class="ttc" id="aclassllvm_1_1DbgVariableIntrinsic_html_a948d39166dc97e354adf799ec62a218a"><div class="ttname"><a href="classllvm_1_1DbgVariableIntrinsic.html#a948d39166dc97e354adf799ec62a218a">llvm::DbgVariableIntrinsic::location_ops</a></div><div class="ttdeci">iterator_range&lt; location_op_iterator &gt; location_ops() const</div><div class="ttdoc">Get the locations corresponding to the variable referenced by the debug info intrinsic.</div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8cpp_source.html#l00075">IntrinsicInst.cpp:75</a></div></div>
<div class="ttc" id="aclassllvm_1_1SwitchInst_1_1CaseHandle_html"><div class="ttname"><a href="classllvm_1_1SwitchInst_1_1CaseHandle.html">llvm::SwitchInst::CaseHandle</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03383">Instructions.h:3383</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a1a7f07aaef6a3bee130bf0e0f0536802"><div class="ttname"><a href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">llvm::Instruction::getParent</a></div><div class="ttdeci">const BasicBlock * getParent() const</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00090">Instruction.h:90</a></div></div>
<div class="ttc" id="aInstructionSimplify_8h_html"><div class="ttname"><a href="InstructionSimplify_8h.html">InstructionSimplify.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_a0c8ffe664a36e30d49c84d0aded2fe08"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a0c8ffe664a36e30d49c84d0aded2fe08">llvm::SmallVectorImpl::pop_back_val</a></div><div class="ttdeci">T pop_back_val()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00677">SmallVector.h:677</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_aa76e50d00e6b5c6de7a45f34396cc42b"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#aa76e50d00e6b5c6de7a45f34396cc42b">ProfileGuidedSectionPrefix</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; ProfileGuidedSectionPrefix(&quot;profile-guided-section-prefix&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Use profile info to add section prefix for hot/cold functions&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_a8ce0c4746a1ec805e66409d20ae93922"><div class="ttname"><a href="classllvm_1_1PHINode.html#a8ce0c4746a1ec805e66409d20ae93922">llvm::PHINode::getIncomingBlock</a></div><div class="ttdeci">BasicBlock * getIncomingBlock(unsigned i) const</div><div class="ttdoc">Return incoming basic block number i.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02814">Instructions.h:2814</a></div></div>
<div class="ttc" id="aTargetTransformInfo_8h_html"><div class="ttname"><a href="TargetTransformInfo_8h.html">TargetTransformInfo.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallSet_html_a76b3fc7c102561fb5210d5151531e409"><div class="ttname"><a href="classllvm_1_1SmallSet.html#a76b3fc7c102561fb5210d5151531e409">llvm::SmallSet::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="SmallSet_8h_source.html#l00216">SmallSet.h:216</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html"><div class="ttname"><a href="classllvm_1_1PHINode.html">llvm::PHINode</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02708">Instructions.h:2708</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a8de021e28a3c04c9216ad8decf104f02"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">llvm::BasicBlock::getTerminator</a></div><div class="ttdeci">const Instruction * getTerminator() const LLVM_READONLY</div><div class="ttdoc">Returns the terminator instruction if the block is well formed or null if the block is not well forme...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00127">BasicBlock.h:127</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html">llvm::PatternMatch</a></div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00047">PatternMatch.h:47</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_ad5b8edf88f1987d45851832bd84b53eb"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#ad5b8edf88f1987d45851832bd84b53eb">StressStoreExtract</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; StressStoreExtract(&quot;stress-cgp-store-extract&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Stress test store(extract) optimizations in CodeGenPrepare&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a342be90695496b88a8854a775dfd030f"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a342be90695496b88a8854a775dfd030f">llvm::TargetLoweringBase::isZExtFree</a></div><div class="ttdeci">virtual bool isZExtFree(Type *FromTy, Type *ToTy) const</div><div class="ttdoc">Return true if any actual instruction that defines a value of type FromTy implicitly zero-extends the...</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l02828">TargetLowering.h:2828</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_abeca3461f7b80e8fac13a7757cc44453"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#abeca3461f7b80e8fac13a7757cc44453">StressExtLdPromotion</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; StressExtLdPromotion(&quot;stress-cgp-ext-ld-promotion&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Stress test ext(promotable(ld)) -&gt; promoted(ext(ld)) &quot; &quot;optimization in CodeGenPrepare&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html">llvm::SmallVectorImpl&lt; Instruction * &gt;</a></div></div>
<div class="ttc" id="anamespacellvm_html_a6b0ac1fa4f05de76413c5e0ca6334035"><div class="ttname"><a href="namespacellvm.html#a6b0ac1fa4f05de76413c5e0ca6334035">llvm::reverse</a></div><div class="ttdeci">auto reverse(ContainerTy &amp;&amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00484">STLExtras.h:484</a></div></div>
<div class="ttc" id="anamespacellvm_html_ab9c6b351507d3c0730f4290919d43a12"><div class="ttname"><a href="namespacellvm.html#ab9c6b351507d3c0730f4290919d43a12">llvm::ArrayRef</a></div><div class="ttdeci">ArrayRef(const T &amp;OneElt) -&gt; ArrayRef&lt; T &gt;</div></div>
<div class="ttc" id="anamespacellvm_html_a458b4709ebedccb846a179f1e422265b"><div class="ttname"><a href="namespacellvm.html#a458b4709ebedccb846a179f1e422265b">llvm::DeleteDeadBlock</a></div><div class="ttdeci">void DeleteDeadBlock(BasicBlock *BB, DomTreeUpdater *DTU=nullptr, bool KeepOneInputPHIs=false)</div><div class="ttdoc">Delete the specified block, which must have no predecessors.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockUtils_8cpp_source.html#l00095">BasicBlockUtils.cpp:95</a></div></div>
<div class="ttc" id="aDerivedTypes_8h_html"><div class="ttname"><a href="DerivedTypes_8h.html">DerivedTypes.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImpl_html"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html">llvm::SmallPtrSetImpl</a></div><div class="ttdoc">A templated base class for SmallPtrSet which provides the typesafe interface that is common across al...</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00344">SmallPtrSet.h:344</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallSetVector_html"><div class="ttname"><a href="classllvm_1_1SmallSetVector.html">llvm::SmallSetVector</a></div><div class="ttdoc">A SetVector that performs no allocations if smaller than a certain size.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00300">SetVector.h:300</a></div></div>
<div class="ttc" id="aclassllvm_1_1GlobalValue_html_a29e0b1c558b350347e2652b35b26fea8"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#a29e0b1c558b350347e2652b35b26fea8">llvm::GlobalValue::getValueType</a></div><div class="ttdeci">Type * getValueType() const</div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00292">GlobalValue.h:292</a></div></div>
<div class="ttc" id="aPassBuilderBindings_8cpp_html_ab76052bb166c65901edb603a3e1f03ab"><div class="ttname"><a href="PassBuilderBindings_8cpp.html#ab76052bb166c65901edb603a3e1f03ab">TM</a></div><div class="ttdeci">const char LLVMTargetMachineRef TM</div><div class="ttdef"><b>Definition:</b> <a href="PassBuilderBindings_8cpp_source.html#l00047">PassBuilderBindings.cpp:47</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisUsage_html_a316c141eb121e46a1de4c395af75eb60"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#a316c141eb121e46a1de4c395af75eb60">llvm::AnalysisUsage::addUsedIfAvailable</a></div><div class="ttdeci">AnalysisUsage &amp; addUsedIfAvailable()</div><div class="ttdoc">Add the specified Pass class to the set of analyses used by this pass.</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00117">PassAnalysisSupport.h:117</a></div></div>
<div class="ttc" id="astructllvm_1_1EVT_html_a3ad406477784397709a339d5a2957b43"><div class="ttname"><a href="structllvm_1_1EVT.html#a3ad406477784397709a339d5a2957b43">llvm::EVT::bitsGT</a></div><div class="ttdeci">bool bitsGT(EVT VT) const</div><div class="ttdoc">Return true if this has more bits than VT.</div><div class="ttdef"><b>Definition:</b> <a href="ValueTypes_8h_source.html#l00256">ValueTypes.h:256</a></div></div>
<div class="ttc" id="aclassllvm_1_1FunctionPass_html"><div class="ttname"><a href="classllvm_1_1FunctionPass.html">llvm::FunctionPass</a></div><div class="ttdoc">FunctionPass class - This class is used to implement most global optimizations.</div><div class="ttdef"><b>Definition:</b> <a href="Pass_8h_source.html#l00308">Pass.h:308</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallInst_html"><div class="ttname"><a href="classllvm_1_1CallInst.html">llvm::CallInst</a></div><div class="ttdoc">This class represents a function call, abstracting a target machine's calling convention.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01485">Instructions.h:1485</a></div></div>
<div class="ttc" id="astructllvm_1_1EVT_html_ab41e50273c70287914ded0ae668bc507"><div class="ttname"><a href="structllvm_1_1EVT.html#ab41e50273c70287914ded0ae668bc507">llvm::EVT::isRound</a></div><div class="ttdeci">bool isRound() const</div><div class="ttdoc">Return true if the size is a power-of-two number of bytes.</div><div class="ttdef"><b>Definition:</b> <a href="ValueTypes_8h_source.html#l00220">ValueTypes.h:220</a></div></div>
<div class="ttc" id="anamespacellvm_html_ac19cbbc4935a23e1d44f65e1eaba6b1d"><div class="ttname"><a href="namespacellvm.html#ac19cbbc4935a23e1d44f65e1eaba6b1d">llvm::extractBranchWeights</a></div><div class="ttdeci">bool extractBranchWeights(const MDNode *ProfileData, SmallVectorImpl&lt; uint32_t &gt; &amp;Weights)</div><div class="ttdoc">Extract branch weights from MD_prof metadata.</div><div class="ttdef"><b>Definition:</b> <a href="ProfDataUtils_8cpp_source.html#l00122">ProfDataUtils.cpp:122</a></div></div>
<div class="ttc" id="alib_2CodeGen_2README_8txt_html_a09776db24cf586ec9f1e18f3bae14099"><div class="ttname"><a href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a></div><div class="ttdeci">Common register allocation spilling lr str ldr sxth r3 ldr mla r4 can lr mov lr str ldr sxth r3 mla r4 and then merge mul and lr str ldr sxth r3 mla r4 It also increase the likelihood the store may become dead bb27 Successors according to LLVM BB</div><div class="ttdef"><b>Definition:</b> <a href="lib_2CodeGen_2README_8txt_source.html#l00039">README.txt:39</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a9364799319bac519aa565ec882986e6d"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a9364799319bac519aa565ec882986e6d">simplifyRelocatesOffABase</a></div><div class="ttdeci">static bool simplifyRelocatesOffABase(GCRelocateInst *RelocatedBase, const SmallVectorImpl&lt; GCRelocateInst * &gt; &amp;Targets)</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l01164">CodeGenPrepare.cpp:1164</a></div></div>
<div class="ttc" id="aHexagonCommonGEP_8cpp_html_ad532e8710e50302e0a376b61c91fa91d"><div class="ttname"><a href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a></div><div class="ttdeci">Hexagon Common GEP</div><div class="ttdef"><b>Definition:</b> <a href="HexagonCommonGEP_8cpp_source.html#l00171">HexagonCommonGEP.cpp:171</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisUsage_html_ae5c60fd282ee894c87ea02c3f0fcb6d0"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">llvm::AnalysisUsage::addRequired</a></div><div class="ttdeci">AnalysisUsage &amp; addRequired()</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00075">PassAnalysisSupport.h:75</a></div></div>
<div class="ttc" id="aclassllvm_1_1FortifiedLibCallSimplifier_html"><div class="ttname"><a href="classllvm_1_1FortifiedLibCallSimplifier.html">llvm::FortifiedLibCallSimplifier</a></div><div class="ttdoc">This class implements simplifications for calls to fortified library functions (__st*cpy_chk,...</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyLibCalls_8h_source.html#l00038">SimplifyLibCalls.h:38</a></div></div>
<div class="ttc" id="aLLVMContext_8h_html"><div class="ttname"><a href="LLVMContext_8h.html">LLVMContext.h</a></div></div>
<div class="ttc" id="aBlockVerifier_8cpp_html_ae45c7d73c0ff5d177b59153ffae77f84"><div class="ttname"><a href="BlockVerifier_8cpp.html#ae45c7d73c0ff5d177b59153ffae77f84">From</a></div><div class="ttdeci">BlockVerifier::State From</div><div class="ttdef"><b>Definition:</b> <a href="BlockVerifier_8cpp_source.html#l00055">BlockVerifier.cpp:55</a></div></div>
<div class="ttc" id="aclassllvm_1_1SwitchInst_html"><div class="ttname"><a href="classllvm_1_1SwitchInst.html">llvm::SwitchInst</a></div><div class="ttdoc">Multiway switch.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03283">Instructions.h:3283</a></div></div>
<div class="ttc" id="astructllvm_1_1OptimizedStructLayoutField_html"><div class="ttname"><a href="structllvm_1_1OptimizedStructLayoutField.html">llvm::OptimizedStructLayoutField</a></div><div class="ttdoc">A field in a structure.</div><div class="ttdef"><b>Definition:</b> <a href="OptimizedStructLayout_8h_source.html#l00045">OptimizedStructLayout.h:45</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_ae855357b6c5e6e7ed1869272708a3a84"><div class="ttname"><a href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">llvm::Value::takeName</a></div><div class="ttdeci">void takeName(Value *V)</div><div class="ttdoc">Transfer the name from V to this value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00381">Value.cpp:381</a></div></div>
<div class="ttc" id="aclassllvm_1_1DebugLoc_html"><div class="ttname"><a href="classllvm_1_1DebugLoc.html">llvm::DebugLoc</a></div><div class="ttdoc">A debug info location.</div><div class="ttdef"><b>Definition:</b> <a href="DebugLoc_8h_source.html#l00033">DebugLoc.h:33</a></div></div>
<div class="ttc" id="aclassllvm_1_1GlobalObject_html_a49b398b1c83ef4d42c8f7756b443f61f"><div class="ttname"><a href="classllvm_1_1GlobalObject.html#a49b398b1c83ef4d42c8f7756b443f61f">llvm::GlobalObject::setAlignment</a></div><div class="ttdeci">void setAlignment(Align Align)</div><div class="ttdoc">Sets the alignment attribute of the GlobalObject.</div><div class="ttdef"><b>Definition:</b> <a href="Globals_8cpp_source.html#l00130">Globals.cpp:130</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a6ade65d2ea72712ca307ed5d5876dba8"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a6ade65d2ea72712ca307ed5d5876dba8">llvm::TargetLoweringBase::isSlowDivBypassed</a></div><div class="ttdeci">bool isSlowDivBypassed() const</div><div class="ttdoc">Returns true if target has indicated at least one type should be bypassed.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l00560">TargetLowering.h:560</a></div></div>
<div class="ttc" id="aclassllvm_1_1AllocaInst_html"><div class="ttname"><a href="classllvm_1_1AllocaInst.html">llvm::AllocaInst</a></div><div class="ttdoc">an instruction to allocate memory on the stack</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00058">Instructions.h:58</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html_abe1de1520a21f77ac57cc210bf0fb0b4"><div class="ttname"><a href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">llvm::User::getOperand</a></div><div class="ttdeci">Value * getOperand(unsigned i) const</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00169">User.h:169</a></div></div>
<div class="ttc" id="astructllvm_1_1cl_1_1desc_html"><div class="ttname"><a href="structllvm_1_1cl_1_1desc.html">llvm::cl::desc</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00411">CommandLine.h:411</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a126c61d55fb4d2e509537ce68e8b6400"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a126c61d55fb4d2e509537ce68e8b6400">llvm::TargetLoweringBase::getValueType</a></div><div class="ttdeci">EVT getValueType(const DataLayout &amp;DL, Type *Ty, bool AllowUnknown=false) const</div><div class="ttdoc">Return the EVT corresponding to this LLVM type.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l01500">TargetLowering.h:1500</a></div></div>
<div class="ttc" id="aclassllvm_1_1BranchInst_html"><div class="ttname"><a href="classllvm_1_1BranchInst.html">llvm::BranchInst</a></div><div class="ttdoc">Conditional or Unconditional Branch instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03139">Instructions.h:3139</a></div></div>
<div class="ttc" id="anamespacellvm_1_1M68kBeads_html_a7eeab1fe8f39bf89dcd7929b816ebfcca27d0e059322508a76f918503800ef1bd"><div class="ttname"><a href="namespacellvm_1_1M68kBeads.html#a7eeab1fe8f39bf89dcd7929b816ebfcca27d0e059322508a76f918503800ef1bd">llvm::M68kBeads::Term</a></div><div class="ttdeci">@ Term</div><div class="ttdef"><b>Definition:</b> <a href="M68kBaseInfo_8h_source.html#l00090">M68kBaseInfo.h:90</a></div></div>
<div class="ttc" id="araw__ostream_8h_html"><div class="ttname"><a href="raw__ostream_8h.html">raw_ostream.h</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a4bde686b6506cc9e63919272711713f4"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a4bde686b6506cc9e63919272711713f4">isFormingBranchFromSelectProfitable</a></div><div class="ttdeci">static bool isFormingBranchFromSelectProfitable(const TargetTransformInfo *TTI, const TargetLowering *TLI, SelectInst *SI)</div><div class="ttdoc">Returns true if a SelectInst should be turned into an explicit branch.</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l06712">CodeGenPrepare.cpp:6712</a></div></div>
<div class="ttc" id="aX86ISelLowering_8cpp_html_aa1cc6f0bf5007ecac3fbaccc032a4317"><div class="ttname"><a href="X86ISelLowering_8cpp.html#aa1cc6f0bf5007ecac3fbaccc032a4317">getConstantVector</a></div><div class="ttdeci">static Constant * getConstantVector(MVT VT, const APInt &amp;SplatValue, unsigned SplatBitSize, LLVMContext &amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="X86ISelLowering_8cpp_source.html#l09656">X86ISelLowering.cpp:9656</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html"><div class="ttname"><a href="classllvm_1_1SetVector.html">llvm::SetVector&lt; Instruction * &gt;</a></div></div>
<div class="ttc" id="anamespacellvm_1_1CallingConv_html_a5b166ae228ebbfdb96736d6022f3feeda94ec9273479164e4aec1d5d91b71dc85"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a5b166ae228ebbfdb96736d6022f3feeda94ec9273479164e4aec1d5d91b71dc85">llvm::CallingConv::Cold</a></div><div class="ttdeci">@ Cold</div><div class="ttdoc">Attempts to make code in the caller as efficient as possible under the assumption that the call is no...</div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00047">CallingConv.h:47</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_a499ea32ca1b8d16cedfe01d1e5b08f29"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a499ea32ca1b8d16cedfe01d1e5b08f29">llvm::SmallVectorImpl::reserve</a></div><div class="ttdeci">void reserve(size_type N)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00667">SmallVector.h:667</a></div></div>
<div class="ttc" id="aclassllvm_1_1BinaryOperator_html_a02ce9966395063ac501ecbc1623deda4"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html#a02ce9966395063ac501ecbc1623deda4">llvm::BinaryOperator::Create</a></div><div class="ttdeci">static BinaryOperator * Create(BinaryOps Op, Value *S1, Value *S2, const Twine &amp;Name=Twine(), Instruction *InsertBefore=nullptr)</div><div class="ttdoc">Construct a binary instruction, given the opcode and the two operands.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l02950">Instructions.cpp:2950</a></div></div>
<div class="ttc" id="aBasicBlockUtils_8h_html"><div class="ttname"><a href="BasicBlockUtils_8h.html">BasicBlockUtils.h</a></div></div>
<div class="ttc" id="aCodeGenPrepare_8cpp_html_a98c59bcf49cb7343886e8f425d6d877b"><div class="ttname"><a href="CodeGenPrepare_8cpp.html#a98c59bcf49cb7343886e8f425d6d877b">foldICmpWithDominatingICmp</a></div><div class="ttdeci">static bool foldICmpWithDominatingICmp(CmpInst *Cmp, const TargetLowering &amp;TLI)</div><div class="ttdoc">For pattern like:</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l01760">CodeGenPrepare.cpp:1760</a></div></div>
<div class="ttc" id="aValue_8h_html"><div class="ttname"><a href="Value_8h.html">Value.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1pdb_html_a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2"><div class="ttname"><a href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2">llvm::pdb::PDB_SymType::Block</a></div><div class="ttdeci">@ Block</div></div>
<div class="ttc" id="anamespacellvm_1_1MIPatternMatch_html_adaaea0309983a4c327ced82a739cf1c4"><div class="ttname"><a href="namespacellvm_1_1MIPatternMatch.html#adaaea0309983a4c327ced82a739cf1c4">llvm::MIPatternMatch::m_OneUse</a></div><div class="ttdeci">OneUse_match&lt; SubPat &gt; m_OneUse(const SubPat &amp;SP)</div><div class="ttdef"><b>Definition:</b> <a href="MIPatternMatch_8h_source.html#l00047">MIPatternMatch.h:47</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_ade4c57b9c2851617c61a9fd30174f07b"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#ade4c57b9c2851617c61a9fd30174f07b">llvm::TargetLoweringBase::shouldConvertSplatType</a></div><div class="ttdeci">virtual Type * shouldConvertSplatType(ShuffleVectorInst *SVI) const</div><div class="ttdoc">Given a shuffle vector SVI representing a vector splat, return a new scalar type of size equal to SVI...</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l02653">TargetLowering.h:2653</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a753e1338645ec04d045211b8a46d968d"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a753e1338645ec04d045211b8a46d968d">llvm::PatternMatch::m_Cmp</a></div><div class="ttdeci">class_match&lt; CmpInst &gt; m_Cmp()</div><div class="ttdoc">Matches any compare instruction and ignore it.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00089">PatternMatch.h:89</a></div></div>
<div class="ttc" id="aInitializePasses_8h_html"><div class="ttname"><a href="InitializePasses_8h.html">InitializePasses.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_abe76d72cda6b2b4562c72accb510040b"><div class="ttname"><a href="namespacellvm.html#abe76d72cda6b2b4562c72accb510040b">llvm::isSafeToSpeculativelyExecute</a></div><div class="ttdeci">bool isSafeToSpeculativelyExecute(const Instruction *I, const Instruction *CtxI=nullptr, AssumptionCache *AC=nullptr, const DominatorTree *DT=nullptr, const TargetLibraryInfo *TLI=nullptr)</div><div class="ttdoc">Return true if the instruction does not have any effects besides calculating the result and does not ...</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l04799">ValueTracking.cpp:4799</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html"><div class="ttname"><a href="classllvm_1_1Value.html">llvm::Value</a></div><div class="ttdoc">LLVM Value Representation.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00074">Value.h:74</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicCmpXchgInst_html"><div class="ttname"><a href="classllvm_1_1AtomicCmpXchgInst.html">llvm::AtomicCmpXchgInst</a></div><div class="ttdoc">An instruction that atomically checks whether a specified value is in a memory location,...</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00513">Instructions.h:513</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a37668d9884c78ac77254cf9fb8a4276a"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a37668d9884c78ac77254cf9fb8a4276a">llvm::PatternMatch::m_Shl</a></div><div class="ttdeci">BinaryOp_match&lt; LHS, RHS, Instruction::Shl &gt; m_Shl(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01111">PatternMatch.h:1111</a></div></div>
<div class="ttc" id="aDebug_8h_html"><div class="ttname"><a href="Debug_8h.html">Debug.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1VectorType_html_a8c90e6c50e795b17466482a04947690e"><div class="ttname"><a href="classllvm_1_1VectorType.html#a8c90e6c50e795b17466482a04947690e">llvm::VectorType::get</a></div><div class="ttdeci">static VectorType * get(Type *ElementType, ElementCount EC)</div><div class="ttdoc">This static method is the primary way to construct an VectorType.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00670">Type.cpp:670</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_ab4e0512c7e1c7adaa56677e3155685f1"><div class="ttname"><a href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">llvm::Value::users</a></div><div class="ttdeci">iterator_range&lt; user_iterator &gt; users()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00421">Value.h:421</a></div></div>
<div class="ttc" id="aclassllvm_1_1MapVector_html_a3a8171298a7d19a309d599de01906703"><div class="ttname"><a href="classllvm_1_1MapVector.html#a3a8171298a7d19a309d599de01906703">llvm::MapVector::erase</a></div><div class="ttdeci">VectorType::iterator erase(typename VectorType::iterator Iterator)</div><div class="ttdoc">Remove the element given by Iterator.</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00174">MapVector.h:174</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_a0791d03936abf005dfeef844f2d23fc6"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#a0791d03936abf005dfeef844f2d23fc6">llvm::TargetLoweringBase::isVectorShiftByScalarCheap</a></div><div class="ttdeci">virtual bool isVectorShiftByScalarCheap(Type *Ty) const</div><div class="ttdoc">Return true if it's significantly cheaper to shift a vector by a uniform scalar than by an amount whi...</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l02644">TargetLowering.h:2644</a></div></div>
<div class="ttc" id="aclassllvm_1_1BranchInst_html_a7e4be8b16fbd68c9045a388904044e01"><div class="ttname"><a href="classllvm_1_1BranchInst.html#a7e4be8b16fbd68c9045a388904044e01">llvm::BranchInst::isConditional</a></div><div class="ttdeci">bool isConditional() const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03218">Instructions.h:3218</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a213e6c0ca6e838157373b9a6018c0769"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a213e6c0ca6e838157373b9a6018c0769">llvm::PatternMatch::m_LogicalAnd</a></div><div class="ttdeci">LogicalOp_match&lt; LHS, RHS, Instruction::And &gt; m_LogicalAnd(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdoc">Matches L &amp;&amp; R either in the form of L &amp; R or L ? R : false.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l02556">PatternMatch.h:2556</a></div></div>
<div class="ttc" id="aclassllvm_1_1DbgValueInst_html_a40b1c4efd724f09e373c07ea2d2991c1"><div class="ttname"><a href="classllvm_1_1DbgValueInst.html#a40b1c4efd724f09e373c07ea2d2991c1">llvm::DbgValueInst::getValues</a></div><div class="ttdeci">iterator_range&lt; location_op_iterator &gt; getValues() const</div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00395">IntrinsicInst.h:395</a></div></div>
<div class="ttc" id="anamespacellvm_html_ad25a2d6c14dc8997a002861a768e0223"><div class="ttname"><a href="namespacellvm.html#ad25a2d6c14dc8997a002861a768e0223">llvm::createCodeGenPreparePass</a></div><div class="ttdeci">FunctionPass * createCodeGenPreparePass()</div><div class="ttdoc">createCodeGenPreparePass - Transform the code to expose more pattern matching during instruction sele...</div><div class="ttdef"><b>Definition:</b> <a href="CodeGenPrepare_8cpp_source.html#l00488">CodeGenPrepare.cpp:488</a></div></div>
<div class="ttc" id="aclassllvm_1_1BranchInst_html_ad97f2e60cf22f15e0cf617af52309031"><div class="ttname"><a href="classllvm_1_1BranchInst.html#ad97f2e60cf22f15e0cf617af52309031">llvm::BranchInst::getSuccessor</a></div><div class="ttdeci">BasicBlock * getSuccessor(unsigned i) const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03232">Instructions.h:3232</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_ac63dbb4994494c46f025715272cdb81e"><div class="ttname"><a href="classllvm_1_1CallBase.html#ac63dbb4994494c46f025715272cdb81e">llvm::CallBase::args</a></div><div class="ttdeci">iterator_range&lt; User::op_iterator &gt; args()</div><div class="ttdoc">Iteration adapter for range-for loops.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01342">InstrTypes.h:1342</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallSet_html_ae04ad615dfdd885e85cbddda146787c6"><div class="ttname"><a href="classllvm_1_1SmallSet.html#ae04ad615dfdd885e85cbddda146787c6">llvm::SmallSet::contains</a></div><div class="ttdeci">bool contains(const T &amp;V) const</div><div class="ttdoc">Check if the SmallSet contains the given element.</div><div class="ttdef"><b>Definition:</b> <a href="SmallSet_8h_source.html#l00234">SmallSet.h:234</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLowering_html_a3db162658a7687e8a5df34f5a6aaa840"><div class="ttname"><a href="classllvm_1_1TargetLowering.html#a3db162658a7687e8a5df34f5a6aaa840">llvm::TargetLowering::AsmOperandInfoVector</a></div><div class="ttdeci">std::vector&lt; AsmOperandInfo &gt; AsmOperandInfoVector</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l04678">TargetLowering.h:4678</a></div></div>
<div class="ttc" id="anamespacellvm_1_1sampleprof_html_a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41"><div class="ttname"><a href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">llvm::sampleprof::Base</a></div><div class="ttdeci">@ Base</div><div class="ttdef"><b>Definition:</b> <a href="Discriminator_8h_source.html#l00058">Discriminator.h:58</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_ad859786d7e54bdc5c568ac20c69816e0"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#ad859786d7e54bdc5c568ac20c69816e0">llvm::TargetLoweringBase::getTypeAction</a></div><div class="ttdeci">LegalizeTypeAction getTypeAction(LLVMContext &amp;Context, EVT VT) const</div><div class="ttdoc">Return how we should legalize values of this type, either it is already legal (return 'Legal') or we ...</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l00992">TargetLowering.h:992</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_af67d1f3a518964d80a109bb3d9d5cf1e"><div class="ttname"><a href="classllvm_1_1Instruction.html#af67d1f3a518964d80a109bb3d9d5cf1e">llvm::Instruction::moveBefore</a></div><div class="ttdeci">void moveBefore(Instruction *MovePos)</div><div class="ttdoc">Unlink this instruction from its current basic block and insert it into the basic block that MovePos ...</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00108">Instruction.cpp:108</a></div></div>
<div class="ttc" id="aclassllvm_1_1Use_html"><div class="ttname"><a href="classllvm_1_1Use.html">llvm::Use</a></div><div class="ttdoc">A Use represents the edge between a Value definition and its users.</div><div class="ttdef"><b>Definition:</b> <a href="Use_8h_source.html#l00043">Use.h:43</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_a396fcfee6914c76974b73c3d203da6a5"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">llvm::SmallVectorImpl::emplace_back</a></div><div class="ttdeci">reference emplace_back(ArgTypes &amp;&amp;... Args)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00941">SmallVector.h:941</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImpl_html_a6bc6fb89fe2e91c25559a8631f56e27e"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">llvm::SmallPtrSetImpl::insert</a></div><div class="ttdeci">std::pair&lt; iterator, bool &gt; insert(PtrType Ptr)</div><div class="ttdoc">Inserts Ptr if and only if there is no element in the container equal to Ptr.</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00365">SmallPtrSet.h:365</a></div></div>
<div class="ttc" id="anamespacellvm_1_1Intrinsic_html_a80add6b3b1cdaec560907995127adc16"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">llvm::Intrinsic::ID</a></div><div class="ttdeci">unsigned ID</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00039">TargetTransformInfo.h:39</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 7 2023 09:51:57 for LLVM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
