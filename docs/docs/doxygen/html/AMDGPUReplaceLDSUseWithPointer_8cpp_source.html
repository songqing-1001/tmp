<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: lib/Target/AMDGPU/AMDGPUReplaceLDSUseWithPointer.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LLVM
   &#160;<span id="projectnumber">17.0.0git</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_794e483eb1cc7921d35fd149d9cc325b.html">Target</a></li><li class="navelem"><a class="el" href="dir_447ce995d6e35417de5ec3060e97c93e.html">AMDGPU</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">AMDGPUReplaceLDSUseWithPointer.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="AMDGPUReplaceLDSUseWithPointer_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===-- AMDGPUReplaceLDSUseWithPointer.cpp --------------------------------===//</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// See https://llvm.org/LICENSE.txt for license information.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// This pass replaces all the uses of LDS within non-kernel functions by</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// corresponding pointer counter-parts.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// The main motivation behind this pass is - to *avoid* subsequent LDS lowering</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// pass from directly packing LDS (assume large LDS) into a struct type which</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">// would otherwise cause allocating huge memory for struct instance within every</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">// kernel.</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">// Brief sketch of the algorithm implemented in this pass is as below:</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">//   1. Collect all the LDS defined in the module which qualify for pointer</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">//      replacement, say it is, LDSGlobals set.</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">//   2. Collect all the reachable callees for each kernel defined in the module,</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">//      say it is, KernelToCallees map.</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">//   3. FOR (each global GV from LDSGlobals set) DO</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">//        LDSUsedNonKernels = Collect all non-kernel functions which use GV.</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">//        FOR (each kernel K in KernelToCallees map) DO</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">//           ReachableCallees = KernelToCallees[K]</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">//           ReachableAndLDSUsedCallees =</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">//              SetIntersect(LDSUsedNonKernels, ReachableCallees)</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">//           IF (ReachableAndLDSUsedCallees is not empty) THEN</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">//             Pointer = Create a pointer to point-to GV if not created.</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">//             Initialize Pointer to point-to GV within kernel K.</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">//           ENDIF</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">//        ENDFOR</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">//        Replace all uses of GV within non kernel functions by Pointer.</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">//      ENFOR</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">// LLVM IR example:</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">//    Input IR:</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">//    @lds = internal addrspace(3) global [4 x i32] undef, align 16</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">//    define internal void @f0() {</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">//    entry:</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">//      %gep = getelementptr inbounds [4 x i32], [4 x i32] addrspace(3)* @lds,</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">//             i32 0, i32 0</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">//      ret void</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">//    }</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">//    define protected amdgpu_kernel void @k0() {</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">//    entry:</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">//      call void @f0()</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">//      ret void</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">//    }</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">//    Output IR:</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">//    @lds = internal addrspace(3) global [4 x i32] undef, align 16</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">//    @lds.ptr = internal unnamed_addr addrspace(3) global i16 undef, align 2</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">//    define internal void @f0() {</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">//    entry:</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">//      %0 = load i16, i16 addrspace(3)* @lds.ptr, align 2</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">//      %1 = getelementptr i8, i8 addrspace(3)* null, i16 %0</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">//      %2 = bitcast i8 addrspace(3)* %1 to [4 x i32] addrspace(3)*</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">//      %gep = getelementptr inbounds [4 x i32], [4 x i32] addrspace(3)* %2,</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">//             i32 0, i32 0</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">//      ret void</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">//    }</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">//    define protected amdgpu_kernel void @k0() {</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">//    entry:</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">//      store i16 ptrtoint ([4 x i32] addrspace(3)* @lds to i16),</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">//            i16 addrspace(3)* @lds.ptr, align 2</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">//      call void @f0()</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">//      ret void</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">//    }</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AMDGPU_8h.html">AMDGPU.h</a>&quot;</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="GCNSubtarget_8h.html">GCNSubtarget.h</a>&quot;</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AMDGPUBaseInfo_8h.html">Utils/AMDGPUBaseInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AMDGPUMemoryUtils_8h.html">Utils/AMDGPUMemoryUtils.h</a>&quot;</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DenseMap_8h.html">llvm/ADT/DenseMap.h</a>&quot;</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="STLExtras_8h.html">llvm/ADT/STLExtras.h</a>&quot;</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SetOperations_8h.html">llvm/ADT/SetOperations.h</a>&quot;</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CallGraph_8h.html">llvm/Analysis/CallGraph.h</a>&quot;</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetPassConfig_8h.html">llvm/CodeGen/TargetPassConfig.h</a>&quot;</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constants_8h.html">llvm/IR/Constants.h</a>&quot;</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DerivedTypes_8h.html">llvm/IR/DerivedTypes.h</a>&quot;</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IRBuilder_8h.html">llvm/IR/IRBuilder.h</a>&quot;</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InlineAsm_8h.html">llvm/IR/InlineAsm.h</a>&quot;</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Instructions_8h.html">llvm/IR/Instructions.h</a>&quot;</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="preprocessor">#include &quot;llvm/IR/IntrinsicsAMDGPU.h&quot;</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ReplaceConstant_8h.html">llvm/IR/ReplaceConstant.h</a>&quot;</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InitializePasses_8h.html">llvm/InitializePasses.h</a>&quot;</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Pass_8h.html">llvm/Pass.h</a>&quot;</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Debug_8h.html">llvm/Support/Debug.h</a>&quot;</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Target_2TargetMachine_8h.html">llvm/Target/TargetMachine.h</a>&quot;</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BasicBlockUtils_8h.html">llvm/Transforms/Utils/BasicBlockUtils.h</a>&quot;</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ModuleUtils_8h.html">llvm/Transforms/Utils/ModuleUtils.h</a>&quot;</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160; </div>
<div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="AMDGPUReplaceLDSUseWithPointer_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">  108</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;amdgpu-replace-lds-use-with-pointer&quot;</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160; </div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160; </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; </div>
<div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="namespaceAMDGPU.html">  114</a></span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceAMDGPU.html">AMDGPU</a> {<span class="comment"></span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">/// Collect all the instructions where user \p U belongs to. \p U could be</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">/// instruction itself or it could be a constant expression which is used within</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">/// an instruction. If \p CollectKernelInsts is true, collect instructions only</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">/// from kernels, otherwise collect instructions only from non-kernel functions.</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Function *, SmallPtrSet&lt;Instruction *, 8&gt;</a>&gt;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;getFunctionToInstsMap(<a class="code" href="classllvm_1_1User.html">User</a> *U, <span class="keywordtype">bool</span> CollectKernelInsts);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Function *, 8&gt;</a> collectNonKernelAccessorsOfLDS(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;} <span class="comment">// namespace AMDGPU</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="keyword">class </span>ReplaceLDSUseImpl {</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *LDSMemBaseAddr;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160; </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;GlobalVariable *, GlobalVariable *&gt;</a> LDSToPointer;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;GlobalVariable *, SmallPtrSet&lt;Function *, 8&gt;</a>&gt; LDSToNonKernels;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Function *, SmallPtrSet&lt;Function *, 8&gt;</a>&gt; KernelToCallees;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Function *, SmallPtrSet&lt;GlobalVariable *, 8&gt;</a>&gt; KernelToLDSPointers;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Function *, BasicBlock *&gt;</a> KernelToInitBB;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Function *, DenseMap&lt;GlobalVariable *, Value *&gt;</a>&gt;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      FunctionToLDSToReplaceInst;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160; </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="comment">// Collect LDS which requires their uses to be replaced by pointer.</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  std::vector&lt;GlobalVariable *&gt; collectLDSRequiringPointerReplace() {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">// Collect LDS which requires module lowering.</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    std::vector&lt;GlobalVariable *&gt; LDSGlobals =</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <a class="code" href="namespacellvm_1_1AMDGPU.html#a0afddd933a4ef113f2aa3448fc822388">llvm::AMDGPU::findLDSVariablesToLower</a>(M, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160; </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="comment">// Remove LDS which don&#39;t qualify for replacement.</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <a class="code" href="namespacellvm.html#ac9a7de5a04920954ac964059cfc428ad">llvm::erase_if</a>(LDSGlobals, [&amp;](<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV) {</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <span class="keywordflow">return</span> shouldIgnorePointerReplacement(GV);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    });</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160; </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordflow">return</span> LDSGlobals;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  }</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="comment">// Returns true if uses of given LDS global within non-kernel functions should</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="comment">// be keep as it is without pointer replacement.</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="keywordtype">bool</span> shouldIgnorePointerReplacement(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV) {</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="comment">// LDS whose size is very small and doesn&#39;t exceed pointer size is not worth</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="comment">// replacing.</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a29e0b1c558b350347e2652b35b26fea8">getValueType</a>()) &lt;= 2)</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="comment">// LDS which is not used from non-kernel function scope or it is used from</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">// global scope does not qualify for replacement.</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    LDSToNonKernels[GV] = AMDGPU::collectNonKernelAccessorsOfLDS(GV);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordflow">return</span> LDSToNonKernels[GV].<a class="code" href="classllvm_1_1DenseMapBase.html#a49c487a9395a6c384be8544cfb2cfccf">empty</a>();</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160; </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">// FIXME: When GV is used within all (or within most of the kernels), then</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">// it does not make sense to create a pointer for it.</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  }</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160; </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="comment">// Insert new global LDS pointer which points to LDS.</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *createLDSPointer(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV) {</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="comment">// LDS pointer which points to LDS is already created? Return it.</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keyword">auto</span> PointerEntry = LDSToPointer.<a class="code" href="classllvm_1_1DenseMapBase.html#a99f811d53704275b4158c62a2dd138d9">insert</a>(std::pair(GV, <span class="keyword">nullptr</span>));</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keywordflow">if</span> (!PointerEntry.second)</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      <span class="keywordflow">return</span> PointerEntry.first-&gt;second;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160; </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="comment">// We need to create new LDS pointer which points to LDS.</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="comment">// Each CU owns at max 64K of LDS memory, so LDS address ranges from 0 to</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="comment">// 2^16 - 1. Hence 16 bit pointer is enough to hold the LDS address.</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keyword">auto</span> *I16Ty = <a class="code" href="classllvm_1_1Type.html#a87f56db834c58ca630624956ecf6972f">Type::getInt16Ty</a>(Ctx);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *LDSPointer = <span class="keyword">new</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a>(</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        M, I16Ty, <span class="keyword">false</span>, <a class="code" href="classllvm_1_1GlobalValue.html#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>, <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(I16Ty),</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        GV-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + <a class="code" href="classllvm_1_1Twine.html">Twine</a>(<span class="stringliteral">&quot;.ptr&quot;</span>), <span class="keyword">nullptr</span>, <a class="code" href="classllvm_1_1GlobalValue.html#a05c6b3b9372b56d130e005db4837da62a7483b56cbb22b39c485b4648ea3374b0">GlobalVariable::NotThreadLocal</a>,</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <a class="code" href="namespacellvm_1_1AMDGPUAS.html#ab1843c6566c95d94d6e36a857b8d2b3fa77b1c964e2ff99057bf5e75140457abe">AMDGPUAS::LOCAL_ADDRESS</a>);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160; </div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    LDSPointer-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a38c97622dccff7ae31fe0be3b21c9b3d">setUnnamedAddr</a>(<a class="code" href="classllvm_1_1GlobalValue.html#ae8df4be75bfc50b1eadd74e85c25fa45a4cc6684df7b4a92b1dec6fce3264fac8">GlobalValue::UnnamedAddr::Global</a>);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    LDSPointer-&gt;<a class="code" href="classllvm_1_1GlobalObject.html#a49b398b1c83ef4d42c8f7756b443f61f">setAlignment</a>(<a class="code" href="namespacellvm_1_1AMDGPU.html#a4f422b014bb0d10d7e6e07d06035a77c">llvm::AMDGPU::getAlign</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, LDSPointer));</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160; </div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">// Mark that an associated LDS pointer is created for LDS.</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    LDSToPointer[GV] = LDSPointer;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160; </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">return</span> LDSPointer;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  }</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160; </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="comment">// Split entry basic block in such a way that only lane 0 of each wave does</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <span class="comment">// the LDS pointer initialization, and return newly created basic block.</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *activateLaneZero(<a class="code" href="classllvm_1_1Function.html">Function</a> *K) {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment">// If the entry basic block of kernel K is already split, then return</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment">// newly created basic block.</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keyword">auto</span> BasicBlockEntry = KernelToInitBB.<a class="code" href="classllvm_1_1DenseMapBase.html#a99f811d53704275b4158c62a2dd138d9">insert</a>(std::pair(K, <span class="keyword">nullptr</span>));</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">if</span> (!BasicBlockEntry.second)</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      <span class="keywordflow">return</span> BasicBlockEntry.first-&gt;second;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="comment">// Split entry basic block of kernel K.</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keyword">auto</span> *EI = &amp;(*(K-&gt;<a class="code" href="classllvm_1_1Function.html#ae6a4da5f41fc6a36735cc1704c01ce60">getEntryBlock</a>().<a class="code" href="classllvm_1_1BasicBlock.html#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>()));</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(EI);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160; </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Mbcnt =</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntrinsic(Intrinsic::amdgcn_mbcnt_lo, {},</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                                {<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt32(-1), <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt32(0)});</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateICmpEQ(Mbcnt, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt32(0));</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *WB = cast&lt;Instruction&gt;(</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntrinsic(Intrinsic::amdgcn_wave_barrier, {}, {}));</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160; </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *NBB = <a class="code" href="namespacellvm.html#ae2aea60aed775d05692317bf4855c291">SplitBlockAndInsertIfThen</a>(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>, WB, <span class="keyword">false</span>)-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160; </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="comment">// Mark that the entry basic block of kernel K is split.</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    KernelToInitBB[K] = NBB;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordflow">return</span> NBB;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  }</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160; </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="comment">// Within given kernel, initialize given LDS pointer to point to given LDS.</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <span class="keywordtype">void</span> initializeLDSPointer(<a class="code" href="classllvm_1_1Function.html">Function</a> *K, <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV,</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                            <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *LDSPointer) {</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="comment">// If LDS pointer is already initialized within K, then nothing to do.</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keyword">auto</span> PointerEntry = KernelToLDSPointers.<a class="code" href="classllvm_1_1DenseMapBase.html#a99f811d53704275b4158c62a2dd138d9">insert</a>(</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        std::pair(K, <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;GlobalVariable *, 8&gt;</a>()));</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordflow">if</span> (!PointerEntry.second)</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      <span class="keywordflow">if</span> (PointerEntry.first-&gt;second.contains(LDSPointer))</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160; </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="comment">// Insert instructions at EI which initialize LDS pointer to point-to LDS</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="comment">// within kernel K.</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="comment">// That is, convert pointer type of GV to i16, and then store this converted</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="comment">// i16 value within LDSPointer which is of type i16*.</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keyword">auto</span> *EI = &amp;(*(activateLaneZero(K)-&gt;getFirstInsertionPt()));</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(EI);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateStore(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePtrToInt(GV, <a class="code" href="classllvm_1_1Type.html#a87f56db834c58ca630624956ecf6972f">Type::getInt16Ty</a>(Ctx)),</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                        LDSPointer);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="comment">// Mark that LDS pointer is initialized within kernel K.</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    KernelToLDSPointers[K].<a class="code" href="classllvm_1_1DenseMapBase.html#a99f811d53704275b4158c62a2dd138d9">insert</a>(LDSPointer);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  }</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160; </div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="comment">// We have created an LDS pointer for LDS, and initialized it to point-to LDS</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  <span class="comment">// within all relevant kernels. Now replace all the uses of LDS within</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <span class="comment">// non-kernel functions by LDS pointer.</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="keywordtype">void</span> replaceLDSUseByPointer(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV, <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *LDSPointer) {</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;User *, 8&gt;</a> LDSUsers(GV-&gt;<a class="code" href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">users</a>());</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *U : LDSUsers) {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="comment">// When `U` is a constant expression, it is possible that same constant</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      <span class="comment">// expression exists within multiple instructions, and within multiple</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      <span class="comment">// non-kernel functions. Collect all those non-kernel functions and all</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      <span class="comment">// those instructions within which `U` exist.</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      <span class="keyword">auto</span> FunctionToInsts =</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;          AMDGPU::getFunctionToInstsMap(U, <span class="keyword">false</span> <span class="comment">/*=CollectKernelInsts*/</span>);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160; </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;FunctionToInst : FunctionToInsts) {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = FunctionToInst.first;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="keyword">auto</span> &amp;Insts = FunctionToInst.second;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Insts) {</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;          <span class="comment">// If `U` is a constant expression, then we need to break the</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;          <span class="comment">// associated instruction into a set of separate instructions by</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;          <span class="comment">// converting constant expressions into instructions.</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;          <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction *, 8&gt;</a> UserInsts;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160; </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;          <span class="keywordflow">if</span> (U == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            <span class="comment">// `U` is an instruction, conversion from constant expression to</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            <span class="comment">// set of instructions is *not* required.</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            UserInsts.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            <span class="comment">// `U` is a constant expression, convert it into corresponding set</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            <span class="comment">// of instructions.</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1WinEH.html#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">CE</a> = cast&lt;ConstantExpr&gt;(U);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            <a class="code" href="namespacellvm.html#ac39b90c86cac049a5492702f21a13176">convertConstantExprsToInstructions</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, CE, &amp;UserInsts);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;          }</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160; </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;          <span class="comment">// Go through all the user instructions, if LDS exist within them as</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;          <span class="comment">// an operand, then replace it by replace instruction.</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;          <span class="keywordflow">for</span> (<span class="keyword">auto</span> *II : UserInsts) {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            <span class="keyword">auto</span> *ReplaceInst = getReplacementInst(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, GV, LDSPointer);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            II-&gt;replaceUsesOfWith(GV, ReplaceInst);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;          }</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        }</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    }</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  }</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="comment">// Create a set of replacement instructions which together replace LDS within</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="comment">// non-kernel function F by accessing LDS indirectly using LDS pointer.</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *getReplacementInst(<a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV,</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                            <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *LDSPointer) {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="comment">// If the instruction which replaces LDS within F is already created, then</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="comment">// return it.</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keyword">auto</span> LDSEntry = FunctionToLDSToReplaceInst.<a class="code" href="classllvm_1_1DenseMapBase.html#a99f811d53704275b4158c62a2dd138d9">insert</a>(</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        std::pair(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;GlobalVariable *, Value *&gt;</a>()));</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordflow">if</span> (!LDSEntry.second) {</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      <span class="keyword">auto</span> ReplaceInstEntry =</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;          LDSEntry.first-&gt;second.insert(std::pair(GV, <span class="keyword">nullptr</span>));</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      <span class="keywordflow">if</span> (!ReplaceInstEntry.second)</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <span class="keywordflow">return</span> ReplaceInstEntry.first-&gt;second;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    }</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160; </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="comment">// Get the instruction insertion point within the beginning of the entry</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="comment">// block of current non-kernel function.</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keyword">auto</span> *EI = &amp;(*(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getEntryBlock().getFirstInsertionPt()));</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(EI);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; </div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="comment">// Insert required set of instructions which replace LDS within F.</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keyword">auto</span> *V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateGEP(</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt8Ty(), LDSMemBaseAddr,</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateLoad(LDSPointer-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a29e0b1c558b350347e2652b35b26fea8">getValueType</a>(), LDSPointer)),</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a92041fc7f781ba4fe708eec99139b72f">getType</a>());</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160; </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="comment">// Mark that the replacement instruction which replace LDS within F is</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="comment">// created.</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    FunctionToLDSToReplaceInst[<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>][GV] = V;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160; </div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="keywordflow">return</span> V;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160; </div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  ReplaceLDSUseImpl(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M)</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      : <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>), Ctx(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.getContext()), <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.getDataLayout()) {</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    LDSMemBaseAddr = <a class="code" href="classllvm_1_1Constant.html#a0154da1d06b29a1d5649607ae2dfc389">Constant::getIntegerValue</a>(</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <a class="code" href="classllvm_1_1PointerType.html#a050a395d1656e546679d8b144d951bb2">PointerType::get</a>(<a class="code" href="classllvm_1_1Type.html#a7ba5de75f50bb4a4ba920698edf39b28">Type::getInt8Ty</a>(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.getContext()),</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                         <a class="code" href="namespacellvm_1_1AMDGPUAS.html#ab1843c6566c95d94d6e36a857b8d2b3fa77b1c964e2ff99057bf5e75140457abe">AMDGPUAS::LOCAL_ADDRESS</a>),</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <a class="code" href="classllvm_1_1APInt.html">APInt</a>(32, 0));</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  }</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160; </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="comment">// Entry-point function which interface ReplaceLDSUseImpl with outside of the</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <span class="comment">// class.</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="keywordtype">bool</span> replaceLDSUse();</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160; </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="comment">// For a given LDS from collected LDS globals set, replace its non-kernel</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <span class="comment">// function scope uses by pointer.</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="keywordtype">bool</span> replaceLDSUse(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;};</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160; </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">// For given LDS from collected LDS globals set, replace its non-kernel function</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">// scope uses by pointer.</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="keywordtype">bool</span> ReplaceLDSUseImpl::replaceLDSUse(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV) {</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="comment">// Holds all those non-kernel functions within which LDS is being accessed.</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Function *, 8&gt;</a> &amp;LDSAccessors = LDSToNonKernels[GV];</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160; </div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="comment">// The LDS pointer which points to LDS and replaces all the uses of LDS.</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *LDSPointer = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160; </div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="comment">// Traverse through each kernel K, check and if required, initialize the</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="comment">// LDS pointer to point to LDS within K.</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;KernelToCallee : KernelToCallees) {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <a class="code" href="classllvm_1_1Function.html">Function</a> *K = KernelToCallee.first;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Function *, 8&gt;</a> Callees = KernelToCallee.second;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160; </div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="comment">// Compute reachable and LDS used callees for kernel K.</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <a class="code" href="namespacellvm.html#a2162d123f222998300d308bdefdb38b9">set_intersect</a>(Callees, LDSAccessors);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160; </div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="comment">// None of the LDS accessing non-kernel functions are reachable from</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="comment">// kernel K. Hence, no need to initialize LDS pointer within kernel K.</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">if</span> (Callees.<a class="code" href="classllvm_1_1SmallPtrSetImplBase.html#af8a50544090e81ac83601aff8f4b0142">empty</a>())</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160; </div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="comment">// We have found reachable and LDS used callees for kernel K, and we need to</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="comment">// initialize LDS pointer within kernel K, and we need to replace LDS use</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="comment">// within those callees by LDS pointer.</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="comment">// But, first check if LDS pointer is already created, if not create one.</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    LDSPointer = createLDSPointer(GV);</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160; </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="comment">// Initialize LDS pointer to point to LDS within kernel K.</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    initializeLDSPointer(K, GV, LDSPointer);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  }</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160; </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="comment">// We have not found reachable and LDS used callees for any of the kernels,</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="comment">// and hence we have not created LDS pointer.</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="keywordflow">if</span> (!LDSPointer)</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160; </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="comment">// We have created an LDS pointer for LDS, and initialized it to point-to LDS</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="comment">// within all relevant kernels. Now replace all the uses of LDS within</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="comment">// non-kernel functions by LDS pointer.</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  replaceLDSUseByPointer(GV, LDSPointer);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160; </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;}</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160; </div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceAMDGPU.html">AMDGPU</a> {</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160; </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">// An helper class for collecting all reachable callees for each kernel defined</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">// within the module.</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="keyword">class </span>CollectReachableCallees {</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <a class="code" href="classllvm_1_1CallGraph.html">CallGraph</a> CG;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;CallGraphNode *, 8&gt;</a> AddressTakenFunctions;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160; </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  <span class="comment">// Collect all address taken functions within the module.</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <span class="keywordtype">void</span> collectAddressTakenFunctions() {</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keyword">auto</span> *ECNode = CG.<a class="code" href="classllvm_1_1CallGraph.html#ad465a8cadbe012420c658efdcb900705">getExternalCallingNode</a>();</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160; </div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;GI : *ECNode) {</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      <span class="keyword">auto</span> *CGN = GI.second;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = CGN-&gt;getFunction();</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> || <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;isDeclaration() || <a class="code" href="namespacellvm_1_1AMDGPU.html#a8b4a057c775e3d1c3d1f3d32abb1f648">llvm::AMDGPU::isKernelCC</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>))</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;      AddressTakenFunctions.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(CGN);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    }</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  }</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160; </div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="comment">// For given kernel, collect all its reachable non-kernel functions.</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Function *, 8&gt;</a> collectReachableCallees(<a class="code" href="classllvm_1_1Function.html">Function</a> *K) {</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Function *, 8&gt;</a> ReachableCallees;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160; </div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="comment">// Call graph node which represents this kernel.</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="keyword">auto</span> *KCGN = CG[K];</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160; </div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="comment">// Go through all call graph nodes reachable from the node representing this</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="comment">// kernel, visit all their call sites, if the call site is direct, add</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="comment">// corresponding callee to reachable callee set, if it is indirect, resolve</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="comment">// the indirect call site to potential reachable callees, add them to</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="comment">// reachable callee set, and repeat the process for the newly added</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="comment">// potential callee nodes.</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="comment">// FIXME: Need to handle bit-casted function pointers.</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;CallGraphNode *, 8&gt;</a> CGNStack(<a class="code" href="namespacellvm.html#add49d9f7abebe402adf1a57c762abeef">depth_first</a>(KCGN));</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;CallGraphNode *, 8&gt;</a> VisitedCGNodes;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keywordflow">while</span> (!CGNStack.empty()) {</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      <span class="keyword">auto</span> *CGN = CGNStack.pop_back_val();</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160; </div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      <span class="keywordflow">if</span> (!VisitedCGNodes.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(CGN).second)</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160; </div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      <span class="comment">// Ignore call graph node which does not have associated function or</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      <span class="comment">// associated function is not a definition.</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      <span class="keywordflow">if</span> (!CGN-&gt;getFunction() || CGN-&gt;getFunction()-&gt;isDeclaration())</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160; </div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;GI : *CGN) {</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <span class="keyword">auto</span> *RCB = cast&lt;CallBase&gt;(*GI.first);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="keyword">auto</span> *RCGN = GI.second;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160; </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *DCallee = RCGN-&gt;getFunction()) {</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;          ReachableCallees.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(DCallee);</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (RCB-&gt;isIndirectCall()) {</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;          <span class="keyword">auto</span> *RCBFTy = RCB-&gt;getFunctionType();</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;          <span class="keywordflow">for</span> (<span class="keyword">auto</span> *ACGN : AddressTakenFunctions) {</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            <span class="keyword">auto</span> *ACallee = ACGN-&gt;getFunction();</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            <span class="keywordflow">if</span> (ACallee-&gt;getFunctionType() == RCBFTy) {</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;              ReachableCallees.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(ACallee);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;              CGNStack.append(<a class="code" href="namespacellvm.html#afb9c37d2aea316c81a0b2b63c6b480e7">df_begin</a>(ACGN), <a class="code" href="namespacellvm.html#a849b445fe6bce862c395ea6b97c1f658">df_end</a>(ACGN));</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            }</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;          }</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        }</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      }</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    }</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160; </div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keywordflow">return</span> ReachableCallees;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  }</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160; </div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="keyword">explicit</span> CollectReachableCallees(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M) : <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>), CG(<a class="code" href="classllvm_1_1CallGraph.html">CallGraph</a>(<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>)) {</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="comment">// Collect address taken functions.</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    collectAddressTakenFunctions();</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  }</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160; </div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  <span class="keywordtype">void</span> collectReachableCallees(</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      <a class="code" href="classllvm_1_1DenseMap.html">DenseMap</a>&lt;<a class="code" href="classllvm_1_1Function.html">Function</a> *, <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Function *, 8&gt;</a>&gt; &amp;KernelToCallees) {</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="comment">// Collect reachable callee set for each kernel defined in the module.</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>.functions()) {</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1AMDGPU.html#a8b4a057c775e3d1c3d1f3d32abb1f648">llvm::AMDGPU::isKernelCC</a>(&amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>))</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      <a class="code" href="classllvm_1_1Function.html">Function</a> *K = &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      KernelToCallees[K] = collectReachableCallees(K);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    }</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  }</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;};</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment">/// Collect reachable callees for each kernel defined in the module \p M and</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment">/// return collected callees at \p KernelToCallees.</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> collectReachableCallees(</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M,</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap</a>&lt;<a class="code" href="classllvm_1_1Function.html">Function</a> *, <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Function *, 8&gt;</a>&gt; &amp;KernelToCallees) {</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  CollectReachableCallees CRC{<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>};</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  CRC.collectReachableCallees(KernelToCallees);</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;}</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment">/// For the given LDS global \p GV, visit all its users and collect all</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">/// non-kernel functions within which \p GV is used and return collected list of</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">/// such non-kernel functions.</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Function *, 8&gt;</a> collectNonKernelAccessorsOfLDS(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV) {</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Function *, 8&gt;</a> LDSAccessors;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;User *, 8&gt;</a> UserStack(GV-&gt;<a class="code" href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">users</a>());</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;User *, 8&gt;</a> VisitedUsers;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160; </div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="keywordflow">while</span> (!UserStack.empty()) {</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="keyword">auto</span> *U = UserStack.pop_back_val();</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160; </div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="comment">// `U` is already visited? continue to next one.</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="keywordflow">if</span> (!VisitedUsers.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(U).second)</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="comment">// `U` is a global variable which is initialized with LDS. Ignore LDS.</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keywordflow">if</span> (isa&lt;GlobalValue&gt;(U))</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Function *, 8&gt;</a>();</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160; </div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="comment">// Recursively explore constant users.</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keywordflow">if</span> (isa&lt;Constant&gt;(U)) {</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      <a class="code" href="namespacellvm.html#a39d3d23a084c4544ee5903203db10e8a">append_range</a>(UserStack, U-&gt;users());</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    }</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160; </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="comment">// `U` should be an instruction, if it belongs to a non-kernel function F,</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="comment">// then collect F.</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = cast&lt;Instruction&gt;(U)-&gt;getFunction();</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1AMDGPU.html#a8b4a057c775e3d1c3d1f3d32abb1f648">llvm::AMDGPU::isKernelCC</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>))</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      LDSAccessors.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  }</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160; </div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="keywordflow">return</span> LDSAccessors;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;}</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160; </div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Function *, SmallPtrSet&lt;Instruction *, 8&gt;</a>&gt;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;getFunctionToInstsMap(<a class="code" href="classllvm_1_1User.html">User</a> *U, <span class="keywordtype">bool</span> CollectKernelInsts) {</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Function *, SmallPtrSet&lt;Instruction *, 8&gt;</a>&gt; FunctionToInsts;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;User *, 8&gt;</a> UserStack;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;User *, 8&gt;</a> VisitedUsers;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160; </div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  UserStack.push_back(U);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160; </div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  <span class="keywordflow">while</span> (!UserStack.empty()) {</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="keyword">auto</span> *UU = UserStack.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a0c8ffe664a36e30d49c84d0aded2fe08">pop_back_val</a>();</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160; </div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="keywordflow">if</span> (!VisitedUsers.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(UU).second)</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160; </div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keywordflow">if</span> (isa&lt;GlobalValue&gt;(UU))</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160; </div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="keywordflow">if</span> (isa&lt;Constant&gt;(UU)) {</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      <a class="code" href="namespacellvm.html#a39d3d23a084c4544ee5903203db10e8a">append_range</a>(UserStack, UU-&gt;users());</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    }</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160; </div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = cast&lt;Instruction&gt;(UU);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getFunction();</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">if</span> (CollectKernelInsts) {</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1AMDGPU.html#a8b4a057c775e3d1c3d1f3d32abb1f648">llvm::AMDGPU::isKernelCC</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)) {</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      }</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1AMDGPU.html#a8b4a057c775e3d1c3d1f3d32abb1f648">llvm::AMDGPU::isKernelCC</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)) {</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;      }</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    }</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160; </div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    FunctionToInsts.<a class="code" href="classllvm_1_1DenseMapBase.html#a99f811d53704275b4158c62a2dd138d9">insert</a>(std::pair(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction *, 8&gt;</a>()));</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    FunctionToInsts[<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>].<a class="code" href="classllvm_1_1DenseMapBase.html#a99f811d53704275b4158c62a2dd138d9">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  }</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160; </div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="keywordflow">return</span> FunctionToInsts;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;}</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160; </div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;} <span class="comment">// namespace AMDGPU</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160; </div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment">// Entry-point function which interface ReplaceLDSUseImpl with outside of the</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment">// class.</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="keywordtype">bool</span> ReplaceLDSUseImpl::replaceLDSUse() {</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  <span class="comment">// Collect LDS which requires their uses to be replaced by pointer.</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  std::vector&lt;GlobalVariable *&gt; LDSGlobals =</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      collectLDSRequiringPointerReplace();</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160; </div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <span class="comment">// No LDS to pointer-replace. Nothing to do.</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  <span class="keywordflow">if</span> (LDSGlobals.empty())</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160; </div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  <span class="comment">// Collect reachable callee set for each kernel defined in the module.</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  AMDGPU::collectReachableCallees(M, KernelToCallees);</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160; </div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  <span class="keywordflow">if</span> (KernelToCallees.empty()) {</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="comment">// Either module does not have any kernel definitions, or none of the kernel</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="comment">// has a call to non-kernel functions, or we could not resolve any of the</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="comment">// call sites to proper non-kernel functions, because of the situations like</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="comment">// inline asm calls. Nothing to replace.</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  }</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160; </div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  <span class="comment">// For every LDS from collected LDS globals set, replace its non-kernel</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  <span class="comment">// function scope use by pointer.</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *GV : LDSGlobals)</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    Changed |= replaceLDSUse(GV);</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160; </div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;}</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160; </div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="keyword">class </span>AMDGPUReplaceLDSUseWithPointer : <span class="keyword">public</span> <a class="code" href="classllvm_1_1ModulePass.html">ModulePass</a> {</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160; </div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  AMDGPUReplaceLDSUseWithPointer() : <a class="code" href="classllvm_1_1ModulePass.html">ModulePass</a>(<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>) {</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <a class="code" href="namespacellvm.html#a75387643c242f39c955e59f580a9e7d0">initializeAMDGPUReplaceLDSUseWithPointerPass</a>(</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        *<a class="code" href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  }</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160; </div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  <span class="keywordtype">bool</span> runOnModule(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M) <span class="keyword">override</span>;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160; </div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <span class="keywordtype">void</span> getAnalysisUsage(<a class="code" href="classllvm_1_1AnalysisUsage.html">AnalysisUsage</a> &amp;AU)<span class="keyword"> const override </span>{</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1TargetPassConfig.html">TargetPassConfig</a>&gt;();</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  }</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;};</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160; </div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;} <span class="comment">// namespace</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160; </div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46">AMDGPUReplaceLDSUseWithPointer::ID</a> = 0;</div>
<div class="line"><a name="l00621"></a><span class="lineno"><a class="line" href="namespacellvm.html#a608eb8bdafe0bf0ebd5c035a398535a7">  621</a></span>&#160;<span class="keywordtype">char</span> &amp;<a class="code" href="namespacellvm.html#a608eb8bdafe0bf0ebd5c035a398535a7">llvm::AMDGPUReplaceLDSUseWithPointerID</a> =</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46">AMDGPUReplaceLDSUseWithPointer::ID</a>;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160; </div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<a class="code" href="AMDGPUReplaceLDSUseWithPointer_8cpp.html#a45561d0e42bdd98c61a47f4984b1ad96">INITIALIZE_PASS_BEGIN</a>(</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    AMDGPUReplaceLDSUseWithPointer, <a class="code" href="AMDGPUReplaceLDSUseWithPointer_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a>,</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="stringliteral">&quot;Replace within non-kernel function use of LDS with pointer&quot;</span>,</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <span class="keyword">false</span> <span class="comment">/*only look at the cfg*/</span>, <span class="keyword">false</span> <span class="comment">/*analysis pass*/</span>)</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<a class="code" href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1TargetPassConfig.html">TargetPassConfig</a>)</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<a class="code" href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a>(</div>
<div class="line"><a name="l00630"></a><span class="lineno"><a class="line" href="AMDGPUReplaceLDSUseWithPointer_8cpp.html#a030569d5a541b6110f2ae1b6a3413a58">  630</a></span>&#160;    AMDGPUReplaceLDSUseWithPointer, <a class="code" href="AMDGPUReplaceLDSUseWithPointer_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a>,</div>
<div class="line"><a name="l00631"></a><span class="lineno"><a class="line" href="AMDGPUReplaceLDSUseWithPointer_8cpp.html#a9c3943160b95cc42ca8f6e04e6d4e9b6">  631</a></span>&#160;    &quot;Replace within non-kernel <a class="code" href="MemDepPrinter_8cpp.html#a470d8721ad7c3b718e9daeabdaeb4700">function</a> <a class="code" href="Localizer_8cpp.html#a428090a453f41a199ef67fc3f2179fbc">use</a> <a class="code" href="lib_2Target_2README_8txt.html#ace6b37d5eaf50e6fd3465513bc022e93">of</a> LDS with <a class="code" href="AMDGPUReplaceLDSUseWithPointer_8cpp.html#a9c3943160b95cc42ca8f6e04e6d4e9b6">pointer</a>&quot;,</div>
<div class="line"><a name="l00632"></a><span class="lineno"><a class="line" href="AMDGPUReplaceLDSUseWithPointer_8cpp.html#ad2c4a1e4dd7e912dc3076fa24881e277">  632</a></span>&#160;    <a class="code" href="namespacefalse.html">false</a> <span class="comment">/*only look at the cfg*/</span>, <a class="code" href="namespacefalse.html">false</a> <span class="comment">/*analysis pass*/</span>)</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160; </div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="keywordtype">bool</span> AMDGPUReplaceLDSUseWithPointer::runOnModule(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M) {</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  ReplaceLDSUseImpl LDSUseReplacer{<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>};</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  <span class="keywordflow">return</span> LDSUseReplacer.replaceLDSUse();</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;}</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160; </div>
<div class="line"><a name="l00639"></a><span class="lineno"><a class="line" href="namespacellvm.html#a9617bf872c240895b446eb98d0aa27db">  639</a></span>&#160;<a class="code" href="classllvm_1_1ModulePass.html">ModulePass</a> *<a class="code" href="namespacellvm.html#a9617bf872c240895b446eb98d0aa27db">llvm::createAMDGPUReplaceLDSUseWithPointerPass</a>() {</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> AMDGPUReplaceLDSUseWithPointer();</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;}</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160; </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<a class="code" href="classllvm_1_1PreservedAnalyses.html">PreservedAnalyses</a></div>
<div class="line"><a name="l00644"></a><span class="lineno"><a class="line" href="structllvm_1_1AMDGPUReplaceLDSUseWithPointerPass.html#a00e5fe4bcc67a809269d669a5851514b">  644</a></span>&#160;<a class="code" href="structllvm_1_1AMDGPUReplaceLDSUseWithPointerPass.html#a00e5fe4bcc67a809269d669a5851514b">AMDGPUReplaceLDSUseWithPointerPass::run</a>(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M, <a class="code" href="classllvm_1_1AnalysisManager.html">ModuleAnalysisManager</a> &amp;AM) {</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  ReplaceLDSUseImpl LDSUseReplacer{<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>};</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  LDSUseReplacer.replaceLDSUse();</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1PreservedAnalyses.html#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="aLocalizer_8cpp_html_a428090a453f41a199ef67fc3f2179fbc"><div class="ttname"><a href="Localizer_8cpp.html#a428090a453f41a199ef67fc3f2179fbc">use</a></div><div class="ttdeci">Move duplicate certain instructions close to their use</div><div class="ttdef"><b>Definition:</b> <a href="Localizer_8cpp_source.html#l00032">Localizer.cpp:32</a></div></div>
<div class="ttc" id="aclassllvm_1_1PreservedAnalyses_html"><div class="ttname"><a href="classllvm_1_1PreservedAnalyses.html">llvm::PreservedAnalyses</a></div><div class="ttdoc">A set of analyses that are preserved following a run of a transformation pass.</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00152">PassManager.h:152</a></div></div>
<div class="ttc" id="anamespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">This is an optimization pass for GlobalISel generic memory operations.</div><div class="ttdef"><b>Definition:</b> <a href="AddressRanges_8h_source.html#l00018">AddressRanges.h:18</a></div></div>
<div class="ttc" id="alib_2Target_2X86_2README_8txt_html_ac88fe1d3a61b056a4f64fbbb156a62ff"><div class="ttname"><a href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a></div><div class="ttdeci">We currently emits eax Perhaps this is what we really should generate is Is imull three or four cycles eax eax The current instruction priority is based on pattern complexity The former is more complex because it folds a load so the latter will not be emitted Perhaps we should use AddedComplexity to give LEA32r a higher priority We should always try to match LEA first since the LEA matching code does some estimate to determine whether the match is profitable if we care more about code then imull is better It s two bytes shorter than movl leal On a Pentium M</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2X86_2README_8txt_source.html#l00252">README.txt:252</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallGraph_html_ad465a8cadbe012420c658efdcb900705"><div class="ttname"><a href="classllvm_1_1CallGraph.html#ad465a8cadbe012420c658efdcb900705">llvm::CallGraph::getExternalCallingNode</a></div><div class="ttdeci">CallGraphNode * getExternalCallingNode() const</div><div class="ttdoc">Returns the CallGraphNode which is used to represent undetermined calls into the callgraph.</div><div class="ttdef"><b>Definition:</b> <a href="CallGraph_8h_source.html#l00127">CallGraph.h:127</a></div></div>
<div class="ttc" id="aclassllvm_1_1DataLayout_html"><div class="ttname"><a href="classllvm_1_1DataLayout.html">llvm::DataLayout</a></div><div class="ttdoc">A parsed version of the target data layout string in and methods for querying it.</div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00110">DataLayout.h:110</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AArch64PACKey_html_abf4394f452bde3f544999858d71e4b46"><div class="ttname"><a href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46">llvm::AArch64PACKey::ID</a></div><div class="ttdeci">ID</div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00790">AArch64BaseInfo.h:790</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPUAS_html_ab1843c6566c95d94d6e36a857b8d2b3fa77b1c964e2ff99057bf5e75140457abe"><div class="ttname"><a href="namespacellvm_1_1AMDGPUAS.html#ab1843c6566c95d94d6e36a857b8d2b3fa77b1c964e2ff99057bf5e75140457abe">llvm::AMDGPUAS::LOCAL_ADDRESS</a></div><div class="ttdeci">@ LOCAL_ADDRESS</div><div class="ttdoc">Address space for local memory.</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPU_8h_source.html#l00377">AMDGPU.h:377</a></div></div>
<div class="ttc" id="aclassllvm_1_1ModulePass_html"><div class="ttname"><a href="classllvm_1_1ModulePass.html">llvm::ModulePass</a></div><div class="ttdoc">ModulePass class - This class is used to implement unstructured interprocedural optimizations and ana...</div><div class="ttdef"><b>Definition:</b> <a href="Pass_8h_source.html#l00248">Pass.h:248</a></div></div>
<div class="ttc" id="aSetOperations_8h_html"><div class="ttname"><a href="SetOperations_8h.html">SetOperations.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Function_html"><div class="ttname"><a href="classllvm_1_1Function.html">llvm::Function</a></div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00059">Function.h:59</a></div></div>
<div class="ttc" id="aAMDGPUReplaceLDSUseWithPointer_8cpp_html_a9c3943160b95cc42ca8f6e04e6d4e9b6"><div class="ttname"><a href="AMDGPUReplaceLDSUseWithPointer_8cpp.html#a9c3943160b95cc42ca8f6e04e6d4e9b6">pointer</a></div><div class="ttdeci">Replace within non kernel function use of LDS with pointer</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUReplaceLDSUseWithPointer_8cpp_source.html#l00631">AMDGPUReplaceLDSUseWithPointer.cpp:631</a></div></div>
<div class="ttc" id="aPass_8h_html"><div class="ttname"><a href="Pass_8h.html">Pass.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1PointerType_html_a050a395d1656e546679d8b144d951bb2"><div class="ttname"><a href="classllvm_1_1PointerType.html#a050a395d1656e546679d8b144d951bb2">llvm::PointerType::get</a></div><div class="ttdeci">static PointerType * get(Type *ElementType, unsigned AddressSpace)</div><div class="ttdoc">This constructs a pointer to an object of the specified type in a numbered address space.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00729">Type.cpp:729</a></div></div>
<div class="ttc" id="aclassllvm_1_1GlobalValue_html_a05c6b3b9372b56d130e005db4837da62a7483b56cbb22b39c485b4648ea3374b0"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#a05c6b3b9372b56d130e005db4837da62a7483b56cbb22b39c485b4648ea3374b0">llvm::GlobalValue::NotThreadLocal</a></div><div class="ttdeci">@ NotThreadLocal</div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00192">GlobalValue.h:192</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector</a></div><div class="ttdoc">This is a 'vector' (really, a variable-sized array), optimized for the case when the array is small.</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l01199">SmallVector.h:1199</a></div></div>
<div class="ttc" id="anamespacellvm_html_a608eb8bdafe0bf0ebd5c035a398535a7"><div class="ttname"><a href="namespacellvm.html#a608eb8bdafe0bf0ebd5c035a398535a7">llvm::AMDGPUReplaceLDSUseWithPointerID</a></div><div class="ttdeci">char &amp; AMDGPUReplaceLDSUseWithPointerID</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUReplaceLDSUseWithPointer_8cpp_source.html#l00621">AMDGPUReplaceLDSUseWithPointer.cpp:621</a></div></div>
<div class="ttc" id="aInlineAsm_8h_html"><div class="ttname"><a href="InlineAsm_8h.html">InlineAsm.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Function_html_ae6a4da5f41fc6a36735cc1704c01ce60"><div class="ttname"><a href="classllvm_1_1Function.html#ae6a4da5f41fc6a36735cc1704c01ce60">llvm::Function::getEntryBlock</a></div><div class="ttdeci">const BasicBlock &amp; getEntryBlock() const</div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00735">Function.h:735</a></div></div>
<div class="ttc" id="aclassllvm_1_1IRBuilder_html"><div class="ttname"><a href="classllvm_1_1IRBuilder.html">llvm::IRBuilder&lt;&gt;</a></div></div>
<div class="ttc" id="aclassllvm_1_1GlobalVariable_html"><div class="ttname"><a href="classllvm_1_1GlobalVariable.html">llvm::GlobalVariable</a></div><div class="ttdef"><b>Definition:</b> <a href="GlobalVariable_8h_source.html#l00039">GlobalVariable.h:39</a></div></div>
<div class="ttc" id="anamespacellvm_html_ac9a7de5a04920954ac964059cfc428ad"><div class="ttname"><a href="namespacellvm.html#ac9a7de5a04920954ac964059cfc428ad">llvm::erase_if</a></div><div class="ttdeci">void erase_if(Container &amp;C, UnaryPredicate P)</div><div class="ttdoc">Provide a container algorithm similar to C++ Library Fundamentals v2's erase_if which is equivalent t...</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01998">STLExtras.h:1998</a></div></div>
<div class="ttc" id="anamespacellvm_html_a849b445fe6bce862c395ea6b97c1f658"><div class="ttname"><a href="namespacellvm.html#a849b445fe6bce862c395ea6b97c1f658">llvm::df_end</a></div><div class="ttdeci">df_iterator&lt; T &gt; df_end(const T &amp;G)</div><div class="ttdef"><b>Definition:</b> <a href="DepthFirstIterator_8h_source.html#l00223">DepthFirstIterator.h:223</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallGraph_html"><div class="ttname"><a href="classllvm_1_1CallGraph.html">llvm::CallGraph</a></div><div class="ttdoc">The basic data container for the call graph of a Module of IR.</div><div class="ttdef"><b>Definition:</b> <a href="CallGraph_8h_source.html#l00072">CallGraph.h:72</a></div></div>
<div class="ttc" id="aDenseMap_8h_html"><div class="ttname"><a href="DenseMap_8h.html">DenseMap.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1GlobalValue_html_ae8df4be75bfc50b1eadd74e85c25fa45a4cc6684df7b4a92b1dec6fce3264fac8"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#ae8df4be75bfc50b1eadd74e85c25fa45a4cc6684df7b4a92b1dec6fce3264fac8">llvm::GlobalValue::UnnamedAddr::Global</a></div><div class="ttdeci">@ Global</div></div>
<div class="ttc" id="aAMDGPUReplaceLDSUseWithPointer_8cpp_html_a45561d0e42bdd98c61a47f4984b1ad96"><div class="ttname"><a href="AMDGPUReplaceLDSUseWithPointer_8cpp.html#a45561d0e42bdd98c61a47f4984b1ad96">INITIALIZE_PASS_BEGIN</a></div><div class="ttdeci">INITIALIZE_PASS_BEGIN(AMDGPUReplaceLDSUseWithPointer, DEBUG_TYPE, &quot;Replace within non-kernel function use of LDS with pointer&quot;, false, false) INITIALIZE_PASS_END(AMDGPUReplaceLDSUseWithPointer</div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSet_html"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html">llvm::SmallPtrSet</a></div><div class="ttdoc">SmallPtrSet - This class implements a set which is optimized for holding SmallSize or less elements.</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00450">SmallPtrSet.h:450</a></div></div>
<div class="ttc" id="aSTLExtras_8h_html"><div class="ttname"><a href="STLExtras_8h.html">STLExtras.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1GlobalValue_html_a38c97622dccff7ae31fe0be3b21c9b3d"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#a38c97622dccff7ae31fe0be3b21c9b3d">llvm::GlobalValue::setUnnamedAddr</a></div><div class="ttdeci">void setUnnamedAddr(UnnamedAddr Val)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00227">GlobalValue.h:227</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a7ba5de75f50bb4a4ba920698edf39b28"><div class="ttname"><a href="classllvm_1_1Type.html#a7ba5de75f50bb4a4ba920698edf39b28">llvm::Type::getInt8Ty</a></div><div class="ttdeci">static IntegerType * getInt8Ty(LLVMContext &amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00239">Type.cpp:239</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_a96d73bbd7af15cb1fc38c3f4a3bd82e9"><div class="ttname"><a href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a></div><div class="ttdeci">#define F(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00055">MD5.cpp:55</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html"><div class="ttname"><a href="classllvm_1_1BasicBlock.html">llvm::BasicBlock</a></div><div class="ttdoc">LLVM Basic Block Representation.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00055">BasicBlock.h:55</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_html_a0afddd933a4ef113f2aa3448fc822388"><div class="ttname"><a href="namespacellvm_1_1AMDGPU.html#a0afddd933a4ef113f2aa3448fc822388">llvm::AMDGPU::findLDSVariablesToLower</a></div><div class="ttdeci">std::vector&lt; GlobalVariable * &gt; findLDSVariablesToLower(Module &amp;M, const Function *F)</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUMemoryUtils_8cpp_source.html#l00103">AMDGPUMemoryUtils.cpp:103</a></div></div>
<div class="ttc" id="aAMDGPUMemoryUtils_8h_html"><div class="ttname"><a href="AMDGPUMemoryUtils_8h.html">AMDGPUMemoryUtils.h</a></div></div>
<div class="ttc" id="aTarget_2TargetMachine_8h_html"><div class="ttname"><a href="Target_2TargetMachine_8h.html">TargetMachine.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1PassRegistry_html_a05a729900b76c89e808c6c3094921b2f"><div class="ttname"><a href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">llvm::PassRegistry::getPassRegistry</a></div><div class="ttdeci">static PassRegistry * getPassRegistry()</div><div class="ttdoc">getPassRegistry - Access the global registry object, which is automatically initialized at applicatio...</div><div class="ttdef"><b>Definition:</b> <a href="PassRegistry_8cpp_source.html#l00024">PassRegistry.cpp:24</a></div></div>
<div class="ttc" id="aConstants_8h_html"><div class="ttname"><a href="Constants_8h.html">Constants.h</a></div></div>
<div class="ttc" id="aGCNSubtarget_8h_html"><div class="ttname"><a href="GCNSubtarget_8h.html">GCNSubtarget.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html"><div class="ttname"><a href="classllvm_1_1User.html">llvm::User</a></div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00044">User.h:44</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisUsage_html"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html">llvm::AnalysisUsage</a></div><div class="ttdoc">Represent the analysis usage information of a pass.</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00047">PassAnalysisSupport.h:47</a></div></div>
<div class="ttc" id="anamespacellvm_html_ac39b90c86cac049a5492702f21a13176"><div class="ttname"><a href="namespacellvm.html#ac39b90c86cac049a5492702f21a13176">llvm::convertConstantExprsToInstructions</a></div><div class="ttdeci">void convertConstantExprsToInstructions(Instruction *I, ConstantExpr *CE, SmallPtrSetImpl&lt; Instruction * &gt; *Insts=nullptr)</div><div class="ttdoc">The given instruction I contains given constant expression CE as one of its operands,...</div><div class="ttdef"><b>Definition:</b> <a href="ReplaceConstant_8cpp_source.html#l00022">ReplaceConstant.cpp:22</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a161fd4e9fa5367f64c2a4c9e921c3ad3"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a161fd4e9fa5367f64c2a4c9e921c3ad3">llvm::BasicBlock::getFirstInsertionPt</a></div><div class="ttdeci">const_iterator getFirstInsertionPt() const</div><div class="ttdoc">Returns an iterator to the first instruction in this block that is suitable for inserting a non-PHI i...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00245">BasicBlock.cpp:245</a></div></div>
<div class="ttc" id="anamespacefalse_html"><div class="ttname"><a href="namespacefalse.html">false</a></div><div class="ttdef"><b>Definition:</b> <a href="StackSlotColoring_8cpp_source.html#l00141">StackSlotColoring.cpp:141</a></div></div>
<div class="ttc" id="anamespaceAMDGPU_html"><div class="ttname"><a href="namespaceAMDGPU.html">AMDGPU</a></div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUReplaceLDSUseWithPointer_8cpp_source.html#l00114">AMDGPUReplaceLDSUseWithPointer.cpp:114</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html"><div class="ttname"><a href="classllvm_1_1Instruction.html">llvm::Instruction</a></div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00041">Instruction.h:41</a></div></div>
<div class="ttc" id="aclassllvm_1_1UndefValue_html_a4ae5ff22b700a42bcc5d889233721335"><div class="ttname"><a href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">llvm::UndefValue::get</a></div><div class="ttdeci">static UndefValue * get(Type *T)</div><div class="ttdoc">Static factory methods - Return an 'undef' object of the specified type.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01740">Constants.cpp:1740</a></div></div>
<div class="ttc" id="anamespacellvm_html_a75387643c242f39c955e59f580a9e7d0"><div class="ttname"><a href="namespacellvm.html#a75387643c242f39c955e59f580a9e7d0">llvm::initializeAMDGPUReplaceLDSUseWithPointerPass</a></div><div class="ttdeci">void initializeAMDGPUReplaceLDSUseWithPointerPass(PassRegistry &amp;)</div></div>
<div class="ttc" id="astructllvm_1_1AMDGPUReplaceLDSUseWithPointerPass_html_a00e5fe4bcc67a809269d669a5851514b"><div class="ttname"><a href="structllvm_1_1AMDGPUReplaceLDSUseWithPointerPass.html#a00e5fe4bcc67a809269d669a5851514b">llvm::AMDGPUReplaceLDSUseWithPointerPass::run</a></div><div class="ttdeci">PreservedAnalyses run(Module &amp;M, ModuleAnalysisManager &amp;AM)</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUReplaceLDSUseWithPointer_8cpp_source.html#l00644">AMDGPUReplaceLDSUseWithPointer.cpp:644</a></div></div>
<div class="ttc" id="aclassllvm_1_1GlobalValue_html_aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">llvm::GlobalValue::InternalLinkage</a></div><div class="ttdeci">@ InternalLinkage</div><div class="ttdoc">Rename collisions when linking (static functions).</div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00055">GlobalValue.h:55</a></div></div>
<div class="ttc" id="anamespacellvm_1_1CallingConv_html_a188c0836f8c3528401f1c236fd93b977"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">llvm::CallingConv::ID</a></div><div class="ttdeci">unsigned ID</div><div class="ttdoc">LLVM IR allows to use arbitrary numbers as calling convention identifiers.</div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00024">CallingConv.h:24</a></div></div>
<div class="ttc" id="aPassSupport_8h_html_a74ce8276b89067e806f67c45a6d92575"><div class="ttname"><a href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a></div><div class="ttdeci">#define INITIALIZE_PASS_END(passName, arg, name, cfg, analysis)</div><div class="ttdef"><b>Definition:</b> <a href="PassSupport_8h_source.html#l00059">PassSupport.h:59</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetPassConfig_html"><div class="ttname"><a href="classllvm_1_1TargetPassConfig.html">llvm::TargetPassConfig</a></div><div class="ttdoc">Target-Independent Code Generator Pass Configuration Options.</div><div class="ttdef"><b>Definition:</b> <a href="TargetPassConfig_8h_source.html#l00084">TargetPassConfig.h:84</a></div></div>
<div class="ttc" id="aAMDGPUReplaceLDSUseWithPointer_8cpp_html_ad78e062f62e0d6e453941fb4ca843e4d"><div class="ttname"><a href="AMDGPUReplaceLDSUseWithPointer_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a></div><div class="ttdeci">#define DEBUG_TYPE</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUReplaceLDSUseWithPointer_8cpp_source.html#l00108">AMDGPUReplaceLDSUseWithPointer.cpp:108</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImplBase_html_af8a50544090e81ac83601aff8f4b0142"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImplBase.html#af8a50544090e81ac83601aff8f4b0142">llvm::SmallPtrSetImplBase::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00092">SmallPtrSet.h:92</a></div></div>
<div class="ttc" id="aclassllvm_1_1Constant_html"><div class="ttname"><a href="classllvm_1_1Constant.html">llvm::Constant</a></div><div class="ttdoc">This is an important base class in LLVM.</div><div class="ttdef"><b>Definition:</b> <a href="Constant_8h_source.html#l00041">Constant.h:41</a></div></div>
<div class="ttc" id="aSVEIntrinsicOpts_8cpp_html_a2bb87eb1bcbc74783a83ae945eb8fa36"><div class="ttname"><a href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a></div><div class="ttdeci">INITIALIZE_PASS_DEPENDENCY(DominatorTreeWrapperPass)</div></div>
<div class="ttc" id="aclassllvm_1_1LLVMContext_html"><div class="ttname"><a href="classllvm_1_1LLVMContext.html">llvm::LLVMContext</a></div><div class="ttdoc">This is an important class for using LLVM in a threaded context.</div><div class="ttdef"><b>Definition:</b> <a href="LLVMContext_8h_source.html#l00067">LLVMContext.h:67</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMap_html"><div class="ttname"><a href="classllvm_1_1DenseMap.html">llvm::DenseMap</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00714">DenseMap.h:714</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00058">MD5.cpp:58</a></div></div>
<div class="ttc" id="aTargetPassConfig_8h_html"><div class="ttname"><a href="TargetPassConfig_8h.html">TargetPassConfig.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_afb9c37d2aea316c81a0b2b63c6b480e7"><div class="ttname"><a href="namespacellvm.html#afb9c37d2aea316c81a0b2b63c6b480e7">llvm::df_begin</a></div><div class="ttdeci">df_iterator&lt; T &gt; df_begin(const T &amp;G)</div><div class="ttdef"><b>Definition:</b> <a href="DepthFirstIterator_8h_source.html#l00218">DepthFirstIterator.h:218</a></div></div>
<div class="ttc" id="aIRBuilder_8h_html"><div class="ttname"><a href="IRBuilder_8h.html">IRBuilder.h</a></div></div>
<div class="ttc" id="aMemDepPrinter_8cpp_html_a470d8721ad7c3b718e9daeabdaeb4700"><div class="ttname"><a href="MemDepPrinter_8cpp.html#a470d8721ad7c3b718e9daeabdaeb4700">function</a></div><div class="ttdeci">print Print MemDeps of function</div><div class="ttdef"><b>Definition:</b> <a href="MemDepPrinter_8cpp_source.html#l00082">MemDepPrinter.cpp:82</a></div></div>
<div class="ttc" id="anamespacellvm_1_1WinEH_html_a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa"><div class="ttname"><a href="namespacellvm_1_1WinEH.html#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">llvm::WinEH::EncodingType::CE</a></div><div class="ttdeci">@ CE</div><div class="ttdoc">Windows NT (Windows on ARM)</div></div>
<div class="ttc" id="aclassllvm_1_1Module_html"><div class="ttname"><a href="classllvm_1_1Module.html">llvm::Module</a></div><div class="ttdoc">A Module instance is used to store all the information related to an LLVM module.</div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00065">Module.h:65</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a49c487a9395a6c384be8544cfb2cfccf"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a49c487a9395a6c384be8544cfb2cfccf">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00098">DenseMap.h:98</a></div></div>
<div class="ttc" id="aAssumeBundleBuilder_8cpp_html_afb136e0532bcaed86521b462e6538d62"><div class="ttname"><a href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a></div><div class="ttdeci">assume Assume Builder</div><div class="ttdef"><b>Definition:</b> <a href="AssumeBundleBuilder_8cpp_source.html#l00651">AssumeBundleBuilder.cpp:651</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html"><div class="ttname"><a href="classllvm_1_1APInt.html">llvm::APInt</a></div><div class="ttdoc">Class for arbitrary precision integers.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00075">APInt.h:75</a></div></div>
<div class="ttc" id="aBasicBlockSections_8cpp_html_a5fd0741d696f28faf65b33f6c6af8fda"><div class="ttname"><a href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a></div><div class="ttdeci">SmallVector&lt; MachineOperand, 4 &gt; Cond</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockSections_8cpp_source.html#l00137">BasicBlockSections.cpp:137</a></div></div>
<div class="ttc" id="aAMDGPU_8h_html"><div class="ttname"><a href="AMDGPU_8h.html">AMDGPU.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_a39d3d23a084c4544ee5903203db10e8a"><div class="ttname"><a href="namespacellvm.html#a39d3d23a084c4544ee5903203db10e8a">llvm::append_range</a></div><div class="ttdeci">void append_range(Container &amp;C, Range &amp;&amp;R)</div><div class="ttdoc">Wrapper function to append a range to a container.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l02014">STLExtras.h:2014</a></div></div>
<div class="ttc" id="aAArch64SLSHardening_8cpp_html_ad467c4ab9119043f9b7750ab986be61a"><div class="ttname"><a href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a></div><div class="ttdeci">MachineBasicBlock MachineBasicBlock::iterator DebugLoc DL</div><div class="ttdef"><b>Definition:</b> <a href="AArch64SLSHardening_8cpp_source.html#l00076">AArch64SLSHardening.cpp:76</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_adb5c319f5905c1d3ca9eb5df546388c5"><div class="ttname"><a href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">llvm::Value::getName</a></div><div class="ttdeci">StringRef getName() const</div><div class="ttdoc">Return a constant reference to the value's name.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00308">Value.cpp:308</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a99f811d53704275b4158c62a2dd138d9"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a99f811d53704275b4158c62a2dd138d9">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::insert</a></div><div class="ttdeci">std::pair&lt; iterator, bool &gt; insert(const std::pair&lt; KeyT, ValueT &gt; &amp;KV)</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00207">DenseMap.h:207</a></div></div>
<div class="ttc" id="anamespacellvm_html_add49d9f7abebe402adf1a57c762abeef"><div class="ttname"><a href="namespacellvm.html#add49d9f7abebe402adf1a57c762abeef">llvm::depth_first</a></div><div class="ttdeci">iterator_range&lt; df_iterator&lt; T &gt; &gt; depth_first(const T &amp;G)</div><div class="ttdef"><b>Definition:</b> <a href="DepthFirstIterator_8h_source.html#l00229">DepthFirstIterator.h:229</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_html_a4f422b014bb0d10d7e6e07d06035a77c"><div class="ttname"><a href="namespacellvm_1_1AMDGPU.html#a4f422b014bb0d10d7e6e07d06035a77c">llvm::AMDGPU::getAlign</a></div><div class="ttdeci">Align getAlign(DataLayout const &amp;DL, const GlobalVariable *GV)</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUMemoryUtils_8cpp_source.html#l00029">AMDGPUMemoryUtils.cpp:29</a></div></div>
<div class="ttc" id="aclassllvm_1_1Twine_html"><div class="ttname"><a href="classllvm_1_1Twine.html">llvm::Twine</a></div><div class="ttdoc">Twine - A lightweight data structure for efficiently representing the concatenation of temporary valu...</div><div class="ttdef"><b>Definition:</b> <a href="Twine_8h_source.html#l00081">Twine.h:81</a></div></div>
<div class="ttc" id="aclassllvm_1_1PreservedAnalyses_html_a1258a1ff55557c27684010ebd7283712"><div class="ttname"><a href="classllvm_1_1PreservedAnalyses.html#a1258a1ff55557c27684010ebd7283712">llvm::PreservedAnalyses::all</a></div><div class="ttdeci">static PreservedAnalyses all()</div><div class="ttdoc">Construct a special preserved set that preserves all passes.</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00158">PassManager.h:158</a></div></div>
<div class="ttc" id="anamespacellvm_html_a9617bf872c240895b446eb98d0aa27db"><div class="ttname"><a href="namespacellvm.html#a9617bf872c240895b446eb98d0aa27db">llvm::createAMDGPUReplaceLDSUseWithPointerPass</a></div><div class="ttdeci">ModulePass * createAMDGPUReplaceLDSUseWithPointerPass()</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUReplaceLDSUseWithPointer_8cpp_source.html#l00639">AMDGPUReplaceLDSUseWithPointer.cpp:639</a></div></div>
<div class="ttc" id="aCallGraph_8h_html"><div class="ttname"><a href="CallGraph_8h.html">CallGraph.h</a></div></div>
<div class="ttc" id="aInstructions_8h_html"><div class="ttname"><a href="Instructions_8h.html">Instructions.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Constant_html_a0154da1d06b29a1d5649607ae2dfc389"><div class="ttname"><a href="classllvm_1_1Constant.html#a0154da1d06b29a1d5649607ae2dfc389">llvm::Constant::getIntegerValue</a></div><div class="ttdeci">static Constant * getIntegerValue(Type *Ty, const APInt &amp;V)</div><div class="ttdoc">Return the value for an integer or pointer constant, or a vector thereof, with the given scalar value...</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00386">Constants.cpp:386</a></div></div>
<div class="ttc" id="aModuleUtils_8h_html"><div class="ttname"><a href="ModuleUtils_8h.html">ModuleUtils.h</a></div></div>
<div class="ttc" id="aReplaceConstant_8h_html"><div class="ttname"><a href="ReplaceConstant_8h.html">ReplaceConstant.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a1a7f07aaef6a3bee130bf0e0f0536802"><div class="ttname"><a href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">llvm::Instruction::getParent</a></div><div class="ttdeci">const BasicBlock * getParent() const</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00090">Instruction.h:90</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_a0c8ffe664a36e30d49c84d0aded2fe08"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a0c8ffe664a36e30d49c84d0aded2fe08">llvm::SmallVectorImpl::pop_back_val</a></div><div class="ttdeci">T pop_back_val()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00677">SmallVector.h:677</a></div></div>
<div class="ttc" id="anamespacellvm_html_a2162d123f222998300d308bdefdb38b9"><div class="ttname"><a href="namespacellvm.html#a2162d123f222998300d308bdefdb38b9">llvm::set_intersect</a></div><div class="ttdeci">void set_intersect(S1Ty &amp;S1, const S2Ty &amp;S2)</div><div class="ttdoc">set_intersect(A, B) - Compute A := A ^ B Identical to set_intersection, except that it works on set&lt;&gt;...</div><div class="ttdef"><b>Definition:</b> <a href="SetOperations_8h_source.html#l00040">SetOperations.h:40</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a87f56db834c58ca630624956ecf6972f"><div class="ttname"><a href="classllvm_1_1Type.html#a87f56db834c58ca630624956ecf6972f">llvm::Type::getInt16Ty</a></div><div class="ttdeci">static IntegerType * getInt16Ty(LLVMContext &amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00240">Type.cpp:240</a></div></div>
<div class="ttc" id="aclassllvm_1_1GlobalValue_html_a92041fc7f781ba4fe708eec99139b72f"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#a92041fc7f781ba4fe708eec99139b72f">llvm::GlobalValue::getType</a></div><div class="ttdeci">PointerType * getType() const</div><div class="ttdoc">Global values are always pointers.</div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00290">GlobalValue.h:290</a></div></div>
<div class="ttc" id="aDerivedTypes_8h_html"><div class="ttname"><a href="DerivedTypes_8h.html">DerivedTypes.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisManager_html"><div class="ttname"><a href="classllvm_1_1AnalysisManager.html">llvm::AnalysisManager</a></div><div class="ttdoc">A container for analyses that lazily runs them and caches their results.</div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8h_source.html#l00042">InstructionSimplify.h:42</a></div></div>
<div class="ttc" id="aclassllvm_1_1GlobalValue_html_a29e0b1c558b350347e2652b35b26fea8"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#a29e0b1c558b350347e2652b35b26fea8">llvm::GlobalValue::getValueType</a></div><div class="ttdeci">Type * getValueType() const</div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00292">GlobalValue.h:292</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisUsage_html_ae5c60fd282ee894c87ea02c3f0fcb6d0"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">llvm::AnalysisUsage::addRequired</a></div><div class="ttdeci">AnalysisUsage &amp; addRequired()</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00075">PassAnalysisSupport.h:75</a></div></div>
<div class="ttc" id="anamespacellvm_html_ae2aea60aed775d05692317bf4855c291"><div class="ttname"><a href="namespacellvm.html#ae2aea60aed775d05692317bf4855c291">llvm::SplitBlockAndInsertIfThen</a></div><div class="ttdeci">Instruction * SplitBlockAndInsertIfThen(Value *Cond, Instruction *SplitBefore, bool Unreachable, MDNode *BranchWeights, DominatorTree *DT, LoopInfo *LI=nullptr, BasicBlock *ThenBlock=nullptr)</div><div class="ttdoc">Split the containing block at the specified instruction - everything before SplitBefore stays in the ...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockUtils_8cpp_source.html#l01542">BasicBlockUtils.cpp:1542</a></div></div>
<div class="ttc" id="aclassllvm_1_1GlobalObject_html_a49b398b1c83ef4d42c8f7756b443f61f"><div class="ttname"><a href="classllvm_1_1GlobalObject.html#a49b398b1c83ef4d42c8f7756b443f61f">llvm::GlobalObject::setAlignment</a></div><div class="ttdeci">void setAlignment(Align Align)</div><div class="ttdoc">Sets the alignment attribute of the GlobalObject.</div><div class="ttdef"><b>Definition:</b> <a href="Globals_8cpp_source.html#l00130">Globals.cpp:130</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_html_a8b4a057c775e3d1c3d1f3d32abb1f648"><div class="ttname"><a href="namespacellvm_1_1AMDGPU.html#a8b4a057c775e3d1c3d1f3d32abb1f648">llvm::AMDGPU::isKernelCC</a></div><div class="ttdeci">bool isKernelCC(const Function *Func)</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUBaseInfo_8cpp_source.html#l01917">AMDGPUBaseInfo.cpp:1917</a></div></div>
<div class="ttc" id="aBasicBlockUtils_8h_html"><div class="ttname"><a href="BasicBlockUtils_8h.html">BasicBlockUtils.h</a></div></div>
<div class="ttc" id="aInitializePasses_8h_html"><div class="ttname"><a href="InitializePasses_8h.html">InitializePasses.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html"><div class="ttname"><a href="classllvm_1_1Value.html">llvm::Value</a></div><div class="ttdoc">LLVM Value Representation.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00074">Value.h:74</a></div></div>
<div class="ttc" id="aDebug_8h_html"><div class="ttname"><a href="Debug_8h.html">Debug.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_ab4e0512c7e1c7adaa56677e3155685f1"><div class="ttname"><a href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">llvm::Value::users</a></div><div class="ttdeci">iterator_range&lt; user_iterator &gt; users()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00421">Value.h:421</a></div></div>
<div class="ttc" id="alib_2Target_2README_8txt_html_ace6b37d5eaf50e6fd3465513bc022e93"><div class="ttname"><a href="lib_2Target_2README_8txt.html#ace6b37d5eaf50e6fd3465513bc022e93">of</a></div><div class="ttdeci">Add support for conditional and other related patterns Instead of</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2README_8txt_source.html#l00134">README.txt:134</a></div></div>
<div class="ttc" id="aAMDGPUBaseInfo_8h_html"><div class="ttname"><a href="AMDGPUBaseInfo_8h.html">AMDGPUBaseInfo.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImpl_html_a6bc6fb89fe2e91c25559a8631f56e27e"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">llvm::SmallPtrSetImpl::insert</a></div><div class="ttdeci">std::pair&lt; iterator, bool &gt; insert(PtrType Ptr)</div><div class="ttdoc">Inserts Ptr if and only if there is no element in the container equal to Ptr.</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00365">SmallPtrSet.h:365</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 7 2023 10:09:15 for LLVM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
