<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: include/llvm/CodeGen/MachORelocation.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LLVM
   &#160;<span id="projectnumber">17.0.0git</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="dir_dcde91663b8816e1e2311938ccd8f690.html">llvm</a></li><li class="navelem"><a class="el" href="dir_19e251b771363806b5435ead42278477.html">CodeGen</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">MachORelocation.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="MachORelocation_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//=== MachORelocation.h - Mach-O Relocation Info ----------------*- C++ -*-===//</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// See https://llvm.org/LICENSE.txt for license information.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// This file defines the MachORelocation class.</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160; </div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160; </div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#ifndef LLVM_CODEGEN_MACHORELOCATION_H</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#define LLVM_CODEGEN_MACHORELOCATION_H</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160; </div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Support_2DataTypes_8h.html">llvm/Support/DataTypes.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160; </div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacellvm.html">llvm</a> {</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">  /// MachORelocation - This struct contains information about each relocation</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">  /// that needs to be emitted to the file.</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">  /// see &lt;mach-o/reloc.h&gt;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno"><a class="line" href="classllvm_1_1MachORelocation.html">   24</a></span>&#160;<span class="comment"></span>  <span class="keyword">class </span><a class="code" href="classllvm_1_1MachORelocation.html">MachORelocation</a> {</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <a class="code" href="classuint32__t.html">uint32_t</a> r_address;   <span class="comment">// offset in the section to what is being  relocated</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <a class="code" href="classuint32__t.html">uint32_t</a> r_symbolnum; <span class="comment">// symbol index if r_extern == 1 else section index</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="keywordtype">bool</span>     r_pcrel;     <span class="comment">// was relocated pc-relative already</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    uint8_t  r_length;    <span class="comment">// length = 2 ^ r_length</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="keywordtype">bool</span>     r_extern;    <span class="comment">//</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    uint8_t  r_type;      <span class="comment">// if not 0, machine-specific relocation type.</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keywordtype">bool</span>     r_scattered; <span class="comment">// 1 = scattered, 0 = non-scattered</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    int32_t  r_value;     <span class="comment">// the value the item to be relocated is referring</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;                          <span class="comment">// to.</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keyword">public</span>:</div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="classllvm_1_1MachORelocation.html#a1dd86c48c3bf4b42e5ed314d37d60938">   35</a></span>&#160;    <a class="code" href="classuint32__t.html">uint32_t</a> <a class="code" href="classllvm_1_1MachORelocation.html#a1dd86c48c3bf4b42e5ed314d37d60938">getPackedFields</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;      <span class="keywordflow">if</span> (r_scattered)</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        <span class="keywordflow">return</span> (1 &lt;&lt; 31) | (r_pcrel &lt;&lt; 30) | ((r_length &amp; 3) &lt;&lt; 28) |</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;          ((r_type &amp; 15) &lt;&lt; 24) | (r_address &amp; 0x00FFFFFF);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        <span class="keywordflow">return</span> (r_symbolnum &lt;&lt; 8) | (r_pcrel &lt;&lt; 7) | ((r_length &amp; 3) &lt;&lt; 5) |</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;          (r_extern &lt;&lt; 4) | (r_type &amp; 15);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    }</div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="classllvm_1_1MachORelocation.html#a24415068326d774c1ed8facb31fcf4b0">   43</a></span>&#160;    <a class="code" href="classuint32__t.html">uint32_t</a> <a class="code" href="classllvm_1_1MachORelocation.html#a24415068326d774c1ed8facb31fcf4b0">getAddress</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> r_scattered ? r_value : r_address; }</div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="classllvm_1_1MachORelocation.html#a39b151b36c7d0af1337131b3e8c1e06e">   44</a></span>&#160;    <a class="code" href="classuint32__t.html">uint32_t</a> <a class="code" href="classllvm_1_1MachORelocation.html#a39b151b36c7d0af1337131b3e8c1e06e">getRawAddress</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> r_address; }</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; </div>
<div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="classllvm_1_1MachORelocation.html#ac7156d378838a604d1625ef7ab472ef1">   46</a></span>&#160;    <a class="code" href="classllvm_1_1MachORelocation.html#ac7156d378838a604d1625ef7ab472ef1">MachORelocation</a>(<a class="code" href="classuint32__t.html">uint32_t</a> addr, <a class="code" href="classuint32__t.html">uint32_t</a> <a class="code" href="README__ALTIVEC_8txt.html#a98586ea01a32ff5046b0868b036a1849">index</a>, <span class="keywordtype">bool</span> pcrel, uint8_t len,</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                    <span class="keywordtype">bool</span> ext, uint8_t <a class="code" href="README-X86-64_8txt.html#aac3add0badd5c39bebc02df0b5d9bdcf">type</a>, <span class="keywordtype">bool</span> scattered = <span class="keyword">false</span>,</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                    int32_t value = 0) :</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;      r_address(addr), r_symbolnum(<a class="code" href="README__ALTIVEC_8txt.html#a98586ea01a32ff5046b0868b036a1849">index</a>), r_pcrel(pcrel), r_length(len),</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;      r_extern(ext), r_type(<a class="code" href="README-X86-64_8txt.html#aac3add0badd5c39bebc02df0b5d9bdcf">type</a>), r_scattered(scattered), r_value(value) {}</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  };</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160; </div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;} <span class="comment">// end llvm namespace</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#endif // LLVM_CODEGEN_MACHORELOCATION_H</span></div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="anamespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">This is an optimization pass for GlobalISel generic memory operations.</div><div class="ttdef"><b>Definition:</b> <a href="AddressRanges_8h_source.html#l00018">AddressRanges.h:18</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachORelocation_html_a24415068326d774c1ed8facb31fcf4b0"><div class="ttname"><a href="classllvm_1_1MachORelocation.html#a24415068326d774c1ed8facb31fcf4b0">llvm::MachORelocation::getAddress</a></div><div class="ttdeci">uint32_t getAddress() const</div><div class="ttdef"><b>Definition:</b> <a href="MachORelocation_8h_source.html#l00043">MachORelocation.h:43</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachORelocation_html_ac7156d378838a604d1625ef7ab472ef1"><div class="ttname"><a href="classllvm_1_1MachORelocation.html#ac7156d378838a604d1625ef7ab472ef1">llvm::MachORelocation::MachORelocation</a></div><div class="ttdeci">MachORelocation(uint32_t addr, uint32_t index, bool pcrel, uint8_t len, bool ext, uint8_t type, bool scattered=false, int32_t value=0)</div><div class="ttdef"><b>Definition:</b> <a href="MachORelocation_8h_source.html#l00046">MachORelocation.h:46</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachORelocation_html_a1dd86c48c3bf4b42e5ed314d37d60938"><div class="ttname"><a href="classllvm_1_1MachORelocation.html#a1dd86c48c3bf4b42e5ed314d37d60938">llvm::MachORelocation::getPackedFields</a></div><div class="ttdeci">uint32_t getPackedFields() const</div><div class="ttdef"><b>Definition:</b> <a href="MachORelocation_8h_source.html#l00035">MachORelocation.h:35</a></div></div>
<div class="ttc" id="aREADME-X86-64_8txt_html_aac3add0badd5c39bebc02df0b5d9bdcf"><div class="ttname"><a href="README-X86-64_8txt.html#aac3add0badd5c39bebc02df0b5d9bdcf">type</a></div><div class="ttdeci">AMD64 Optimization Manual has some nice information about optimizing integer multiplication by a constant How much of it applies to Intel s X86 implementation There are definite trade offs to xmm0 cvttss2siq rdx jb L3 subss xmm0 rax cvttss2siq rdx xorq rdx rax ret instead of xmm1 cvttss2siq rcx movaps xmm2 subss xmm2 cvttss2siq rax rdx xorq rax ucomiss xmm0 cmovb rax ret Seems like the jb branch has high likelihood of being taken It would have saved a few instructions It s not possible to reference and DH registers in an instruction requiring REX prefix divb and mulb both produce results in AH If isel emits a CopyFromReg which gets turned into a movb and that can be allocated a r8b r15b To get around isel emits a CopyFromReg from AX and then right shift it down by and truncate it It s not pretty but it works We need some register allocation magic to make the hack go which would often require a callee saved register Callees usually need to keep this value live for most of their body so it doesn t add a significant burden on them We currently implement this in however this is suboptimal because it means that it would be quite awkward to implement the optimization for callers A better implementation would be to relax the LLVM IR rules for sret arguments to allow a function with an sret argument to have a non void return type</div><div class="ttdef"><b>Definition:</b> <a href="README-X86-64_8txt_source.html#l00070">README-X86-64.txt:70</a></div></div>
<div class="ttc" id="aREADME__ALTIVEC_8txt_html_a98586ea01a32ff5046b0868b036a1849"><div class="ttname"><a href="README__ALTIVEC_8txt.html#a98586ea01a32ff5046b0868b036a1849">index</a></div><div class="ttdeci">splat index</div><div class="ttdef"><b>Definition:</b> <a href="README__ALTIVEC_8txt_source.html#l00181">README_ALTIVEC.txt:181</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachORelocation_html"><div class="ttname"><a href="classllvm_1_1MachORelocation.html">llvm::MachORelocation</a></div><div class="ttdoc">MachORelocation - This struct contains information about each relocation that needs to be emitted to ...</div><div class="ttdef"><b>Definition:</b> <a href="MachORelocation_8h_source.html#l00024">MachORelocation.h:24</a></div></div>
<div class="ttc" id="aclassuint32__t_html"><div class="ttname"><a href="classuint32__t.html">uint32_t</a></div></div>
<div class="ttc" id="aclassllvm_1_1MachORelocation_html_a39b151b36c7d0af1337131b3e8c1e06e"><div class="ttname"><a href="classllvm_1_1MachORelocation.html#a39b151b36c7d0af1337131b3e8c1e06e">llvm::MachORelocation::getRawAddress</a></div><div class="ttdeci">uint32_t getRawAddress() const</div><div class="ttdef"><b>Definition:</b> <a href="MachORelocation_8h_source.html#l00044">MachORelocation.h:44</a></div></div>
<div class="ttc" id="aSupport_2DataTypes_8h_html"><div class="ttname"><a href="Support_2DataTypes_8h.html">DataTypes.h</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 7 2023 09:44:37 for LLVM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
