<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: lib/Transforms/Vectorize/SLPVectorizer.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LLVM
   &#160;<span id="projectnumber">17.0.0git</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_a72932e0778af28115095468f6286ff8.html">Transforms</a></li><li class="navelem"><a class="el" href="dir_acb975f027bc8cf760392318543d920a.html">Vectorize</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">SLPVectorizer.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="SLPVectorizer_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- SLPVectorizer.cpp - A bottom up SLP Vectorizer ---------------------===//</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// See https://llvm.org/LICENSE.txt for license information.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// This pass implements the Bottom Up SLP vectorizer. It detects consecutive</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// stores that can be put together into vector-stores. Next, it attempts to</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// construct vectorizable tree using the use-def chains. If a profitable tree</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// was found, the SLP vectorizer performs vectorization on the tree.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">// The pass is inspired by the work described in the paper:</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">//  &quot;Loop-Aware SLP in GCC&quot; by Ira Rosen, Dorit Nuzman, Ayal Zaks.</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160; </div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SLPVectorizer_8h.html">llvm/Transforms/Vectorize/SLPVectorizer.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DenseMap_8h.html">llvm/ADT/DenseMap.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DenseSet_8h.html">llvm/ADT/DenseSet.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="PostOrderIterator_8h.html">llvm/ADT/PostOrderIterator.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="PriorityQueue_8h.html">llvm/ADT/PriorityQueue.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="STLExtras_8h.html">llvm/ADT/STLExtras.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SetOperations_8h.html">llvm/ADT/SetOperations.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SetVector_8h.html">llvm/ADT/SetVector.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallBitVector_8h.html">llvm/ADT/SmallBitVector.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallPtrSet_8h.html">llvm/ADT/SmallPtrSet.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallSet_8h.html">llvm/ADT/SmallSet.h</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallString_8h.html">llvm/ADT/SmallString.h</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Statistic_8h.html">llvm/ADT/Statistic.h</a>&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="iterator_8h.html">llvm/ADT/iterator.h</a>&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="iterator__range_8h.html">llvm/ADT/iterator_range.h</a>&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AliasAnalysis_8h.html">llvm/Analysis/AliasAnalysis.h</a>&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AssumptionCache_8h.html">llvm/Analysis/AssumptionCache.h</a>&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CodeMetrics_8h.html">llvm/Analysis/CodeMetrics.h</a>&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DemandedBits_8h.html">llvm/Analysis/DemandedBits.h</a>&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="GlobalsModRef_8h.html">llvm/Analysis/GlobalsModRef.h</a>&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IVDescriptors_8h.html">llvm/Analysis/IVDescriptors.h</a>&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="LoopAccessAnalysis_8h.html">llvm/Analysis/LoopAccessAnalysis.h</a>&quot;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="LoopInfo_8h.html">llvm/Analysis/LoopInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MemoryLocation_8h.html">llvm/Analysis/MemoryLocation.h</a>&quot;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="OptimizationRemarkEmitter_8h.html">llvm/Analysis/OptimizationRemarkEmitter.h</a>&quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ScalarEvolution_8h.html">llvm/Analysis/ScalarEvolution.h</a>&quot;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ScalarEvolutionExpressions_8h.html">llvm/Analysis/ScalarEvolutionExpressions.h</a>&quot;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetLibraryInfo_8h.html">llvm/Analysis/TargetLibraryInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetTransformInfo_8h.html">llvm/Analysis/TargetTransformInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ValueTracking_8h.html">llvm/Analysis/ValueTracking.h</a>&quot;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="VectorUtils_8h.html">llvm/Analysis/VectorUtils.h</a>&quot;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Attributes_8h.html">llvm/IR/Attributes.h</a>&quot;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BasicBlock_8h.html">llvm/IR/BasicBlock.h</a>&quot;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constant_8h.html">llvm/IR/Constant.h</a>&quot;</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constants_8h.html">llvm/IR/Constants.h</a>&quot;</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DataLayout_8h.html">llvm/IR/DataLayout.h</a>&quot;</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DerivedTypes_8h.html">llvm/IR/DerivedTypes.h</a>&quot;</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Dominators_8h.html">llvm/IR/Dominators.h</a>&quot;</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Function_8h.html">llvm/IR/Function.h</a>&quot;</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IRBuilder_8h.html">llvm/IR/IRBuilder.h</a>&quot;</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InstrTypes_8h.html">llvm/IR/InstrTypes.h</a>&quot;</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IR_2Instruction_8h.html">llvm/IR/Instruction.h</a>&quot;</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Instructions_8h.html">llvm/IR/Instructions.h</a>&quot;</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IntrinsicInst_8h.html">llvm/IR/IntrinsicInst.h</a>&quot;</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Intrinsics_8h.html">llvm/IR/Intrinsics.h</a>&quot;</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Module_8h.html">llvm/IR/Module.h</a>&quot;</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Operator_8h.html">llvm/IR/Operator.h</a>&quot;</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="PatternMatch_8h.html">llvm/IR/PatternMatch.h</a>&quot;</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Type_8h.html">llvm/IR/Type.h</a>&quot;</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Use_8h.html">llvm/IR/Use.h</a>&quot;</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="User_8h.html">llvm/IR/User.h</a>&quot;</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Value_8h.html">llvm/IR/Value.h</a>&quot;</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ValueHandle_8h.html">llvm/IR/ValueHandle.h</a>&quot;</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#ifdef EXPENSIVE_CHECKS</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Verifier_8h.html">llvm/IR/Verifier.h</a>&quot;</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Pass_8h.html">llvm/Pass.h</a>&quot;</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Casting_8h.html">llvm/Support/Casting.h</a>&quot;</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CommandLine_8h.html">llvm/Support/CommandLine.h</a>&quot;</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Compiler_8h.html">llvm/Support/Compiler.h</a>&quot;</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DOTGraphTraits_8h.html">llvm/Support/DOTGraphTraits.h</a>&quot;</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Debug_8h.html">llvm/Support/Debug.h</a>&quot;</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Support_2ErrorHandling_8h.html">llvm/Support/ErrorHandling.h</a>&quot;</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="GraphWriter_8h.html">llvm/Support/GraphWriter.h</a>&quot;</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InstructionCost_8h.html">llvm/Support/InstructionCost.h</a>&quot;</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="KnownBits_8h.html">llvm/Support/KnownBits.h</a>&quot;</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MathExtras_8h.html">llvm/Support/MathExtras.h</a>&quot;</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="raw__ostream_8h.html">llvm/Support/raw_ostream.h</a>&quot;</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InjectTLIMappings_8h.html">llvm/Transforms/Utils/InjectTLIMappings.h</a>&quot;</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Transforms_2Utils_2Local_8h.html">llvm/Transforms/Utils/Local.h</a>&quot;</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="LoopUtils_8h.html">llvm/Transforms/Utils/LoopUtils.h</a>&quot;</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Transforms_2Vectorize_8h.html">llvm/Transforms/Vectorize.h</a>&quot;</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="preprocessor">#include &lt;cstdint&gt;</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="preprocessor">#include &lt;iterator&gt;</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="preprocessor">#include &lt;optional&gt;</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="preprocessor">#include &lt;set&gt;</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="preprocessor">#include &lt;tuple&gt;</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="preprocessor">#include &lt;utility&gt;</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160; </div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm_1_1PatternMatch.html">llvm::PatternMatch</a>;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="keyword">using namespace </span>slpvectorizer;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a274654b7f5932cae6a71a113322481be">  107</a></span>&#160;<span class="preprocessor">#define SV_NAME &quot;slp-vectorizer&quot;</span></div>
<div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">  108</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;SLP&quot;</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160; </div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumVectorInstructions, <span class="stringliteral">&quot;Number of vector instructions generated&quot;</span>);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160; </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="SLPVectorizer_8cpp.html#ada54fa869a50e6744d9e149b542efdb1">RunSLPVectorization</a>(<span class="stringliteral">&quot;vectorize-slp&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                                  <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Run the SLP vectorization passes&quot;</span>));</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160; </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;int&gt;</a></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <a class="code" href="SLPVectorizer_8cpp.html#ae3295545af0d12ee89d3102df3d45b06">SLPCostThreshold</a>(<span class="stringliteral">&quot;slp-threshold&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(0), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                     <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Only vectorize if you gain more than this &quot;</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                              <span class="stringliteral">&quot;number &quot;</span>));</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160; </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<a class="code" href="SLPVectorizer_8cpp.html#ae44dffe81e5d4e6584fc647153353e3c">ShouldVectorizeHor</a>(<span class="stringliteral">&quot;slp-vectorize-hor&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                   <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Attempt to vectorize horizontal reductions&quot;</span>));</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="SLPVectorizer_8cpp.html#aa96c1a4a5e83e1e1c4bd56981a3d0773">ShouldStartVectorizeHorAtStore</a>(</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="stringliteral">&quot;slp-vectorize-hor-store&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">false</span>), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="stringliteral">&quot;Attempt to vectorize horizontal reductions feeding into a store&quot;</span>));</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160; </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;int&gt;</a></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<a class="code" href="SLPVectorizer_8cpp.html#a4062d42b1e96fb8e1936cd8a3c0c086d">MaxVectorRegSizeOption</a>(<span class="stringliteral">&quot;slp-max-reg-size&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(128), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Attempt to vectorize for this register size in bits&quot;</span>));</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;unsigned&gt;</a></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<a class="code" href="SLPVectorizer_8cpp.html#a6355b64ef621c21a21f5d3b41808dfa1">MaxVFOption</a>(<span class="stringliteral">&quot;slp-max-vf&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(0), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Maximum SLP vectorization factor (0=unlimited)&quot;</span>));</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160; </div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;int&gt;</a></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<a class="code" href="SLPVectorizer_8cpp.html#a417e088fc2533a49543b5e26feb58d32">MaxStoreLookup</a>(<span class="stringliteral">&quot;slp-max-store-lookup&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(32), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Maximum depth of the lookup for consecutive stores.&quot;</span>));</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">/// Limits the size of scheduling regions in a block.</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">/// It avoid long compile times for _very_ large blocks where vector</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">/// instructions are spread over a wide range.</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">/// This limit is way higher than needed by real-world functions.</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;int&gt;</a></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<a class="code" href="SLPVectorizer_8cpp.html#adb9592b867016414cf26ca6bad0dc544">ScheduleRegionSizeBudget</a>(<span class="stringliteral">&quot;slp-schedule-budget&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(100000), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Limit the size of the SLP scheduling region per block&quot;</span>));</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160; </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;int&gt;</a> <a class="code" href="SLPVectorizer_8cpp.html#a4aec7f237669d6c66b2386501edefa88">MinVectorRegSizeOption</a>(</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="stringliteral">&quot;slp-min-reg-size&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(128), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Attempt to vectorize for this register size in bits&quot;</span>));</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160; </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;unsigned&gt;</a> <a class="code" href="SLPVectorizer_8cpp.html#a70927cb83bb008a2a60a657d651909aa">RecursionMaxDepth</a>(</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="stringliteral">&quot;slp-recursion-max-depth&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(12), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Limit the recursion depth when building a vectorizable tree&quot;</span>));</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160; </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;unsigned&gt;</a> <a class="code" href="SLPVectorizer_8cpp.html#a29dc6da1b32ad914af533bee9c23afda">MinTreeSize</a>(</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="stringliteral">&quot;slp-min-tree-size&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(3), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Only vectorize small trees if they are fully vectorizable&quot;</span>));</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160; </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">// The maximum depth that the look-ahead score heuristic will explore.</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">// The higher this value, the higher the compilation time overhead.</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;int&gt;</a> <a class="code" href="SLPVectorizer_8cpp.html#ab7c8670d4d4589e06bedd21c48405060">LookAheadMaxDepth</a>(</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="stringliteral">&quot;slp-max-look-ahead-depth&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(2), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;The maximum look-ahead depth for operand reordering scores&quot;</span>));</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160; </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">// The maximum depth that the look-ahead score heuristic will explore</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">// when it probing among candidates for vectorization tree roots.</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">// The higher this value, the higher the compilation time overhead but unlike</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">// similar limit for operands ordering this is less frequently used, hence</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">// impact of higher value is less noticeable.</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;int&gt;</a> <a class="code" href="SLPVectorizer_8cpp.html#a4a37b37137fe1d0888e796e0429d3dc7">RootLookAheadMaxDepth</a>(</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="stringliteral">&quot;slp-max-root-look-ahead-depth&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(2), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;The maximum look-ahead depth for searching best rooting option&quot;</span>));</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160; </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <a class="code" href="SLPVectorizer_8cpp.html#a2bbbb8fefbe682386c09baafff9a7cf1">ViewSLPTree</a>(<span class="stringliteral">&quot;view-slp-tree&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Display the SLP trees with Graphviz&quot;</span>));</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160; </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">// Limit the number of alias checks. The limit is chosen so that</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">// it has no negative effect on the llvm benchmarks.</span></div>
<div class="line"><a name="l00182"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a9d624115133c3a9ac3109be4be89a32f">  182</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <a class="code" href="SLPVectorizer_8cpp.html#a9d624115133c3a9ac3109be4be89a32f">AliasedCheckLimit</a> = 10;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160; </div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">// Another limit for the alias checks: The maximum distance between load/store</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">// instructions where alias checks are done.</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">// This limit is useful for very large basic blocks.</span></div>
<div class="line"><a name="l00187"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a4ce8fdf40e75ddf217650e2b1b15b5e6">  187</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <a class="code" href="SLPVectorizer_8cpp.html#a4ce8fdf40e75ddf217650e2b1b15b5e6">MaxMemDepDistance</a> = 160;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">/// If the ScheduleRegionSizeBudget is exhausted, we allow small scheduling</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">/// regions to be handled.</span></div>
<div class="line"><a name="l00191"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a3d78104bfada8d17dad04e588b7d9a17">  191</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="SLPVectorizer_8cpp.html#a3d78104bfada8d17dad04e588b7d9a17">MinScheduleRegionSize</a> = 16;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">/// Predicate for the element types that the SLP vectorizer supports.</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">/// The most important thing to filter here are types which are invalid in LLVM</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">/// vectors. We also filter target specific types which have absolutely no</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">/// meaningful vectorization path such as x86_fp80 and ppc_f128. This just</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">/// avoids spending time checking the cost model and realizing that they will</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">/// be inevitably scalarized.</span></div>
<div class="line"><a name="l00200"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#aa3ea54a95743867473d32853d3c65603">  200</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#aa3ea54a95743867473d32853d3c65603">isValidElementType</a>(<a class="code" href="classllvm_1_1Type.html">Type</a> *Ty) {</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1VectorType.html#a071e25c5c6eae5299b1cdc3350c6d55c">VectorType::isValidElementType</a>(Ty) &amp;&amp; !Ty-&gt;<a class="code" href="classllvm_1_1Type.html#a1f68c27188f1836737bf22a62c558354">isX86_FP80Ty</a>() &amp;&amp;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;         !Ty-&gt;<a class="code" href="classllvm_1_1Type.html#a670980c63f2e5ca39022baf96173eb9c">isPPC_FP128Ty</a>();</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;}</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">/// \returns True if the value is a constant (but not globals/constant</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">/// expressions).</span></div>
<div class="line"><a name="l00207"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a6848b7e929178610d01e1b2b5052af86">  207</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#a6848b7e929178610d01e1b2b5052af86">isConstant</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="keywordflow">return</span> isa&lt;Constant&gt;(V) &amp;&amp; !isa&lt;ConstantExpr, GlobalValue&gt;(V);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;}</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">/// Checks if \p V is one of vector-like instructions, i.e. undef,</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">/// insertelement/extractelement with constant indices for fixed vector type or</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">/// extractvalue instruction.</span></div>
<div class="line"><a name="l00214"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a06a9edb69d0ed6fda201d59948acfd89">  214</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#a06a9edb69d0ed6fda201d59948acfd89">isVectorLikeInstWithConstOps</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="keywordflow">if</span> (!isa&lt;InsertElementInst, ExtractElementInst&gt;(V) &amp;&amp;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      !isa&lt;ExtractValueInst, UndefValue&gt;(V))</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> || isa&lt;ExtractValueInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="keywordflow">if</span> (!isa&lt;FixedVectorType&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0)-&gt;getType()))</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="keywordflow">if</span> (isa&lt;ExtractElementInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="SLPVectorizer_8cpp.html#a6848b7e929178610d01e1b2b5052af86">isConstant</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1));</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isa&lt;InsertElementInst&gt;(V) &amp;&amp; <span class="stringliteral">&quot;Expected only insertelement.&quot;</span>);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="SLPVectorizer_8cpp.html#a6848b7e929178610d01e1b2b5052af86">isConstant</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(2));</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;}</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">/// \returns true if all of the instructions in \p VL are in the same block or</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">/// false otherwise.</span></div>
<div class="line"><a name="l00231"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#abd5114d6b451e9ca85a36fc3f19f76c4">  231</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#abd5114d6b451e9ca85a36fc3f19f76c4">allSameBlock</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL) {</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I0 = dyn_cast&lt;Instruction&gt;(VL[0]);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keywordflow">if</span> (!I0)</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(VL, <a class="code" href="SLPVectorizer_8cpp.html#a06a9edb69d0ed6fda201d59948acfd89">isVectorLikeInstWithConstOps</a>))</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = I0-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 1, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) {</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keyword">auto</span> *II = dyn_cast&lt;Instruction&gt;(VL[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]);</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">if</span> (!II)</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> != II-&gt;getParent())</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;}</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">/// \returns True if all of the values in \p VL are constants (but not</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">/// globals/constant expressions).</span></div>
<div class="line"><a name="l00252"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a7568c08b526dbf7f7b5402f3eb605b55">  252</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#a7568c08b526dbf7f7b5402f3eb605b55">allConstant</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL) {</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="comment">// Constant expressions and globals can&#39;t be vectorized like normal integer/FP</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="comment">// constants.</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(VL, <a class="code" href="SLPVectorizer_8cpp.html#a6848b7e929178610d01e1b2b5052af86">isConstant</a>);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;}</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">/// \returns True if all of the values in \p VL are identical or some of them</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">/// are UndefValue.</span></div>
<div class="line"><a name="l00260"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a6ef5b86735d738868e5fb00a18643b1c">  260</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#a6ef5b86735d738868e5fb00a18643b1c">isSplat</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL) {</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *FirstNonUndef = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordflow">if</span> (isa&lt;UndefValue&gt;(V))</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">if</span> (!FirstNonUndef) {</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      FirstNonUndef = V;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    }</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">if</span> (V != FirstNonUndef)</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  }</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keywordflow">return</span> FirstNonUndef != <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;}</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">/// \returns True if \p I is commutative, handles CmpInst and BinaryOperator.</span></div>
<div class="line"><a name="l00276"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#ab0da56db6da27340e5a7151a4676106a">  276</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#ab0da56db6da27340e5a7151a4676106a">isCommutative</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Cmp = dyn_cast&lt;CmpInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="keywordflow">return</span> Cmp-&gt;isCommutative();</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *BO = dyn_cast&lt;BinaryOperator&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keywordflow">return</span> BO-&gt;isCommutative();</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="comment">// TODO: This should check for generic Instruction::isCommutative(), but</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="comment">//       we need to confirm that the caller code correctly handles Intrinsics</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="comment">//       for example (does not have 2 operands).</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;}</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">/// \returns inserting index of InsertElement or InsertValue instruction,</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">/// using Offset as base offset for index.</span></div>
<div class="line"><a name="l00289"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">  289</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> std::optional&lt;unsigned&gt; <a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *InsertInst,</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                                         <span class="keywordtype">unsigned</span> Offset = 0) {</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a> = Offset;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a> = dyn_cast&lt;InsertElementInst&gt;(InsertInst)) {</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> *VT = dyn_cast&lt;FixedVectorType&gt;(<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>-&gt;getType());</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordflow">if</span> (!VT)</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> *CI = dyn_cast&lt;ConstantInt&gt;(<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>-&gt;getOperand(2));</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keywordflow">if</span> (!CI)</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordflow">if</span> (CI-&gt;getValue().uge(VT-&gt;getNumElements()))</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a> *= VT-&gt;getNumElements();</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a> += CI-&gt;getZExtValue();</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="ELFObjHandler_8cpp.html#aef61945034b9431b804748fc317c5548">Index</a>;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  }</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160; </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> *<a class="code" href="blake3__impl_8h.html#a78823051d1dad34b9b3d8120112e674d">IV</a> = cast&lt;InsertValueInst&gt;(InsertInst);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *CurrentType = <a class="code" href="blake3__impl_8h.html#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;getType();</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="blake3__impl_8h.html#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;indices()) {</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a> = dyn_cast&lt;StructType&gt;(CurrentType)) {</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a> *= <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;getNumElements();</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      CurrentType = <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;getElementType(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> *AT = dyn_cast&lt;ArrayType&gt;(CurrentType)) {</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a> *= AT-&gt;getNumElements();</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      CurrentType = AT-&gt;getElementType();</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    }</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a> += <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  }</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="ELFObjHandler_8cpp.html#aef61945034b9431b804748fc317c5548">Index</a>;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;}</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">/// Specifies the way the mask should be analyzed for undefs/poisonous elements</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">/// in the shuffle mask.</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment"></span><span class="keyword">enum class</span> UseMask {</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  FirstArg, <span class="comment">///&lt; The mask is expected to be for permutation of 1-2 vectors,</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment"></span><span class="comment">            ///&lt; check for the mask elements for the first argument (mask</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment"></span><span class="comment">            ///&lt; indices are in range [0:VF)).</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment"></span>  SecondArg, <span class="comment">///&lt; The mask is expected to be for permutation of 2 vectors, check</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment"></span><span class="comment">             ///&lt; for the mask elements for the second argument (mask indices</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment"></span><span class="comment">             ///&lt; are in range [VF:2*VF))</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment"></span>  UndefsAsMask <span class="comment">///&lt; Consider undef mask elements (-1) as placeholders for</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment"></span><span class="comment">               ///&lt; future shuffle elements and mark them as ones as being used</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment"></span><span class="comment">               ///&lt; in future. Non-undef elements are considered as unused since</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment"></span><span class="comment">               ///&lt; they&#39;re already marked as used in the mask.</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment"></span>};</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;} <span class="comment">// namespace</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">/// Prepares a use bitset for the given mask either for the first argument or</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">/// for the second.</span></div>
<div class="line"><a name="l00342"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a2fd40bb67aec98438b791520159fb146">  342</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> <a class="code" href="SLPVectorizer_8cpp.html#a2fd40bb67aec98438b791520159fb146">buildUseMask</a>(<span class="keywordtype">int</span> VF, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>,</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                                   UseMask MaskArg) {</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> UseMask(VF, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> : <a class="code" href="namespacellvm.html#a7b2175e18ff52174fad26b6b68818564">enumerate</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>)) {</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>.value() == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>) {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      <span class="keywordflow">if</span> (MaskArg == UseMask::UndefsAsMask)</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        UseMask.reset(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>.index());</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    }</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordflow">if</span> (MaskArg == UseMask::FirstArg &amp;&amp; <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>.value() &lt; VF)</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      UseMask.reset(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>.value());</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (MaskArg == UseMask::SecondArg &amp;&amp; <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>.value() &gt;= VF)</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      UseMask.reset(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>.value() - VF);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  }</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="keywordflow">return</span> UseMask;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;}</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">/// Checks if the given value is actually an undefined constant vector.</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">/// Also, if the \p UseMask is not empty, tries to check if the non-masked</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">/// elements actually mask the insertelement buildvector, if any.</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment"></span><span class="keyword">template</span> &lt;<span class="keywordtype">bool</span> IsPoisonOnly = false&gt;</div>
<div class="line"><a name="l00363"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#ac396bb87eb4db1dd3ce315e4d91ee2de">  363</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> <a class="code" href="SLPVectorizer_8cpp.html#ac396bb87eb4db1dd3ce315e4d91ee2de">isUndefVector</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *V,</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                                    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> &amp;UseMask = {}) {</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> Res(UseMask.empty() ? 1 : UseMask.size(), <span class="keyword">true</span>);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keyword">using</span> <a class="code" href="classT.html">T</a> = std::conditional_t&lt;IsPoisonOnly, PoisonValue, UndefValue&gt;;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="keywordflow">if</span> (isa&lt;T&gt;(V))</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordflow">return</span> Res;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <span class="keyword">auto</span> *VecTy = dyn_cast&lt;FixedVectorType&gt;(V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <span class="keywordflow">if</span> (!VecTy)</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="keywordflow">return</span> Res.reset();</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;Constant&gt;(V);</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>) {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordflow">if</span> (!UseMask.empty()) {</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = V;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      <span class="keywordflow">while</span> (<span class="keyword">auto</span> *II = dyn_cast&lt;InsertElementInst&gt;(Base)) {</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <span class="keywordflow">if</span> (isa&lt;T&gt;(II-&gt;getOperand(1)))</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = II-&gt;getOperand(0);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        std::optional&lt;unsigned&gt; Idx = <a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(II);</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        <span class="keywordflow">if</span> (!Idx)</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        <span class="keywordflow">if</span> (*Idx &lt; UseMask.size() &amp;&amp; !UseMask.test(*Idx))</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;          Res.reset(*Idx);</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      }</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <span class="comment">// TODO: Add analysis for shuffles here too.</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <span class="keywordflow">if</span> (V == Base) {</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        Res.reset();</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> SubMask(UseMask.size(), <span class="keyword">false</span>);</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        Res &amp;= isUndefVector&lt;IsPoisonOnly&gt;(Base, SubMask);</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      }</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      Res.reset();</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    }</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordflow">return</span> Res;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  }</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = VecTy-&gt;getNumElements(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Constant.html">Constant</a> *Elem = <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;<a class="code" href="classllvm_1_1Constant.html#acd530d0571f320d47d37e7ae51cf70ff">getAggregateElement</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      <span class="keywordflow">if</span> (!isa&lt;T&gt;(Elem) &amp;&amp;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;          (UseMask.empty() || (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; UseMask.size() &amp;&amp; !UseMask.test(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))))</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        Res.reset(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  }</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <span class="keywordflow">return</span> Res;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;}</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">/// Checks if the vector of instructions can be represented as a shuffle, like:</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">/// %x0 = extractelement &lt;4 x i8&gt; %x, i32 0</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">/// %x3 = extractelement &lt;4 x i8&gt; %x, i32 3</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">/// %y1 = extractelement &lt;4 x i8&gt; %y, i32 1</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">/// %y2 = extractelement &lt;4 x i8&gt; %y, i32 2</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">/// %x0x0 = mul i8 %x0, %x0</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">/// %x3x3 = mul i8 %x3, %x3</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">/// %y1y1 = mul i8 %y1, %y1</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">/// %y2y2 = mul i8 %y2, %y2</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">/// %ins1 = insertelement &lt;4 x i8&gt; poison, i8 %x0x0, i32 0</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">/// %ins2 = insertelement &lt;4 x i8&gt; %ins1, i8 %x3x3, i32 1</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">/// %ins3 = insertelement &lt;4 x i8&gt; %ins2, i8 %y1y1, i32 2</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">/// %ins4 = insertelement &lt;4 x i8&gt; %ins3, i8 %y2y2, i32 3</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">/// ret &lt;4 x i8&gt; %ins4</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">/// can be transformed into:</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">/// %1 = shufflevector &lt;4 x i8&gt; %x, &lt;4 x i8&gt; %y, &lt;4 x i32&gt; &lt;i32 0, i32 3, i32 5,</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">///                                                         i32 6&gt;</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">/// %2 = mul &lt;4 x i8&gt; %1, %1</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">/// ret &lt;4 x i8&gt; %2</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">/// We convert this initially to something like:</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">/// %x0 = extractelement &lt;4 x i8&gt; %x, i32 0</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">/// %x3 = extractelement &lt;4 x i8&gt; %x, i32 3</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">/// %y1 = extractelement &lt;4 x i8&gt; %y, i32 1</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">/// %y2 = extractelement &lt;4 x i8&gt; %y, i32 2</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">/// %1 = insertelement &lt;4 x i8&gt; poison, i8 %x0, i32 0</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">/// %2 = insertelement &lt;4 x i8&gt; %1, i8 %x3, i32 1</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">/// %3 = insertelement &lt;4 x i8&gt; %2, i8 %y1, i32 2</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">/// %4 = insertelement &lt;4 x i8&gt; %3, i8 %y2, i32 3</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">/// %5 = mul &lt;4 x i8&gt; %4, %4</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">/// %6 = extractelement &lt;4 x i8&gt; %5, i32 0</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">/// %ins1 = insertelement &lt;4 x i8&gt; poison, i8 %6, i32 0</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">/// %7 = extractelement &lt;4 x i8&gt; %5, i32 1</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">/// %ins2 = insertelement &lt;4 x i8&gt; %ins1, i8 %7, i32 1</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">/// %8 = extractelement &lt;4 x i8&gt; %5, i32 2</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">/// %ins3 = insertelement &lt;4 x i8&gt; %ins2, i8 %8, i32 2</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">/// %9 = extractelement &lt;4 x i8&gt; %5, i32 3</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">/// %ins4 = insertelement &lt;4 x i8&gt; %ins3, i8 %9, i32 3</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">/// ret &lt;4 x i8&gt; %ins4</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment">/// InstCombiner transforms this into a shuffle and vector mul</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment">/// Mask will return the Shuffle Mask equivalent to the extracted elements.</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment">/// TODO: Can we split off and reuse the shuffle mask detection from</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">/// ShuffleVectorInst/getShuffleCost?</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment"></span><span class="keyword">static</span> std::optional&lt;TargetTransformInfo::ShuffleKind&gt;</div>
<div class="line"><a name="l00450"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a8b409af081b7132c139c0bdc22c5cefd">  450</a></span>&#160;<a class="code" href="SLPVectorizer_8cpp.html#a8b409af081b7132c139c0bdc22c5cefd">isFixedVectorShuffle</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL, <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;int&gt;</a> &amp;<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>) {</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> *It =</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      <a class="code" href="namespacellvm.html#ac78c09ae232b2ce188ff590d51e3c268">find_if</a>(VL, [](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) { <span class="keywordflow">return</span> isa&lt;ExtractElementInst&gt;(V); });</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="keywordflow">if</span> (It == VL.<a class="code" href="classllvm_1_1ArrayRef.html#a7ca5197533a9c1fb8a2bd30587fcec6b">end</a>())</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="keyword">auto</span> *EI0 = cast&lt;ExtractElementInst&gt;(*It);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keywordflow">if</span> (isa&lt;ScalableVectorType&gt;(EI0-&gt;getVectorOperandType()))</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="keywordtype">unsigned</span> Size =</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      cast&lt;FixedVectorType&gt;(EI0-&gt;getVectorOperandType())-&gt;getNumElements();</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Vec1 = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Vec2 = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="keyword">enum</span> ShuffleMode { Unknown, <a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a>, Permute };</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  ShuffleMode CommonShuffleMode = Unknown;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.assign(VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(), <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="comment">// Undef can be represented as an undef element in a vector.</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="keywordflow">if</span> (isa&lt;UndefValue&gt;(VL[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]))</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keyword">auto</span> *EI = cast&lt;ExtractElementInst&gt;(VL[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]);</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordflow">if</span> (isa&lt;ScalableVectorType&gt;(EI-&gt;getVectorOperandType()))</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keyword">auto</span> *Vec = EI-&gt;getVectorOperand();</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="comment">// We can extractelement from undef or poison vector.</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#ac396bb87eb4db1dd3ce315e4d91ee2de">isUndefVector</a>(Vec).<a class="code" href="namespacellvm_1_1LegalityPredicates.html#ad7ac7032baa62cc00002886633b9f281">all</a>())</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="comment">// All vector operands must have the same number of vector elements.</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">if</span> (cast&lt;FixedVectorType&gt;(Vec-&gt;getType())-&gt;getNumElements() != Size)</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordflow">if</span> (isa&lt;UndefValue&gt;(EI-&gt;getIndexOperand()))</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keyword">auto</span> *Idx = dyn_cast&lt;ConstantInt&gt;(EI-&gt;getIndexOperand());</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordflow">if</span> (!Idx)</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="comment">// Undefined behavior if Idx is negative or &gt;= Size.</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="keywordflow">if</span> (Idx-&gt;getValue().uge(Size))</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keywordtype">unsigned</span> IntIdx = Idx-&gt;getValue().getZExtValue();</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = IntIdx;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="comment">// For correct shuffling we have to have at most 2 different vector operands</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="comment">// in all extractelement instructions.</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="keywordflow">if</span> (!Vec1 || Vec1 == Vec) {</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      Vec1 = Vec;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!Vec2 || Vec2 == Vec) {</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      Vec2 = Vec;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] += Size;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    }</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordflow">if</span> (CommonShuffleMode == Permute)</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="comment">// If the extract index is not the same as the operation number, it is a</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="comment">// permutation.</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keywordflow">if</span> (IntIdx != <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      CommonShuffleMode = Permute;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    }</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    CommonShuffleMode = <a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a>;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  }</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  <span class="comment">// If we&#39;re not crossing lanes in different vectors, consider it as blending.</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <span class="keywordflow">if</span> (CommonShuffleMode == <a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a> &amp;&amp; Vec2)</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53eca64d439485545faa793c20de7fbfd274c">TargetTransformInfo::SK_Select</a>;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  <span class="comment">// If Vec2 was never used, we have a permutation of a single vector, otherwise</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="comment">// we have permutation of 2 vectors.</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <span class="keywordflow">return</span> Vec2 ? <a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53ecab4616961a3bfdaec42aedc4fc426ccfe">TargetTransformInfo::SK_PermuteTwoSrc</a></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;              : <a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53eca7beec9815d0197f2d31fac9968e9205b">TargetTransformInfo::SK_PermuteSingleSrc</a>;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;}</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">/// \returns True if Extract{Value,Element} instruction extracts element Idx.</span></div>
<div class="line"><a name="l00519"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#abe11501239b82a4ba1730e12be769bc6">  519</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> std::optional&lt;unsigned&gt; <a class="code" href="SLPVectorizer_8cpp.html#abe11501239b82a4ba1730e12be769bc6">getExtractIndex</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>) {</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <span class="keywordtype">unsigned</span> Opcode = <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode();</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((Opcode == Instruction::ExtractElement ||</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;          Opcode == Instruction::ExtractValue) &amp;&amp;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;         <span class="stringliteral">&quot;Expected extractelement or extractvalue instruction.&quot;</span>);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <span class="keywordflow">if</span> (Opcode == Instruction::ExtractElement) {</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keyword">auto</span> *CI = dyn_cast&lt;ConstantInt&gt;(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOperand(1));</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="keywordflow">if</span> (!CI)</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordflow">return</span> CI-&gt;getZExtValue();</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  }</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="keyword">auto</span> *EI = cast&lt;ExtractValueInst&gt;(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <span class="keywordflow">if</span> (EI-&gt;getNumIndices() != 1)</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="keywordflow">return</span> *EI-&gt;idx_begin();</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;}</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160; </div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment">/// Main data required for vectorization of instructions.</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment"></span><span class="keyword">struct </span>InstructionsState {<span class="comment"></span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment">  /// The very first instruction in the list with the main opcode.</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Value.html">Value</a> *OpValue = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">  /// The main/alternate instruction.</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *MainOp = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *AltOp = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">  /// The main/alternate opcodes for the list of instructions.</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment"></span>  <span class="keywordtype">unsigned</span> <a class="code" href="VPlanSLP_8cpp.html#af04704e906a9654777e92a4612c58c13">getOpcode</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keywordflow">return</span> MainOp ? MainOp-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() : 0;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  }</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160; </div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <span class="keywordtype">unsigned</span> getAltOpcode()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keywordflow">return</span> AltOp ? AltOp-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() : 0;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  }</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment">  /// Some of the instructions in the list have alternate opcodes.</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> isAltShuffle()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> AltOp != MainOp; }</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160; </div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <span class="keywordtype">bool</span> isOpcodeOrAlt(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="keywordtype">unsigned</span> CheckedOpcode = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode();</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="VPlanSLP_8cpp.html#af04704e906a9654777e92a4612c58c13">getOpcode</a>() == CheckedOpcode || getAltOpcode() == CheckedOpcode;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  }</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160; </div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  InstructionsState() = <span class="keyword">delete</span>;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  InstructionsState(<a class="code" href="classllvm_1_1Value.html">Value</a> *OpValue, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *MainOp, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *AltOp)</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;      : OpValue(OpValue), MainOp(MainOp), AltOp(AltOp) {}</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;};</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160; </div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment">/// Chooses the correct key for scheduling data. If \p Op has the same (or</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment">/// alternate) opcode as \p OpValue, the key is \p Op. Otherwise the key is \p</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="comment">/// OpValue.</span></div>
<div class="line"><a name="l00574"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a2207681d736278c6968f548195f1f90c">  574</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="SLPVectorizer_8cpp.html#a2207681d736278c6968f548195f1f90c">isOneOf</a>(<span class="keyword">const</span> InstructionsState &amp;<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>) {</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>);</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp; <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.isOpcodeOrAlt(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.OpValue;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;}</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment">/// \returns true if \p Opcode is allowed as part of of the main/alternate</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">/// instruction for SLP vectorization.</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment">/// Example of unsupported opcode is SDIV that can potentially cause UB if the</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">/// &quot;shuffled out&quot; lane would result in division by zero.</span></div>
<div class="line"><a name="l00586"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a8f3292dcaad99569501ace7909f2ccf0">  586</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#a8f3292dcaad99569501ace7909f2ccf0">isValidForAlternation</a>(<span class="keywordtype">unsigned</span> Opcode) {</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html#af9c2825ab53adf1bf8c9fa19ec89d986">Instruction::isIntDivRem</a>(Opcode))</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160; </div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;}</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160; </div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="keyword">static</span> InstructionsState <a class="code" href="SLPVectorizer_8cpp.html#ae37b3a41d982a793664ab021d9b9b325">getSameOpcode</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL,</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                                       <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> &amp;TLI,</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                                       <span class="keywordtype">unsigned</span> BaseIndex = 0);</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment">/// Checks if the provided operands of 2 cmp instructions are compatible, i.e.</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">/// compatible instructions or constants, or just some other regular values.</span></div>
<div class="line"><a name="l00599"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a321240b67a372a24d41687f6a2e96877">  599</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#a321240b67a372a24d41687f6a2e96877">areCompatibleCmpOps</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *BaseOp0, <a class="code" href="classllvm_1_1Value.html">Value</a> *BaseOp1, <a class="code" href="classllvm_1_1Value.html">Value</a> *Op0,</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                                <a class="code" href="classllvm_1_1Value.html">Value</a> *Op1, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> &amp;TLI) {</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  <span class="keywordflow">return</span> (<a class="code" href="SLPVectorizer_8cpp.html#a6848b7e929178610d01e1b2b5052af86">isConstant</a>(BaseOp0) &amp;&amp; <a class="code" href="SLPVectorizer_8cpp.html#a6848b7e929178610d01e1b2b5052af86">isConstant</a>(Op0)) ||</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;         (<a class="code" href="SLPVectorizer_8cpp.html#a6848b7e929178610d01e1b2b5052af86">isConstant</a>(BaseOp1) &amp;&amp; <a class="code" href="SLPVectorizer_8cpp.html#a6848b7e929178610d01e1b2b5052af86">isConstant</a>(Op1)) ||</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;         (!isa&lt;Instruction&gt;(BaseOp0) &amp;&amp; !isa&lt;Instruction&gt;(Op0) &amp;&amp;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;          !isa&lt;Instruction&gt;(BaseOp1) &amp;&amp; !isa&lt;Instruction&gt;(Op1)) ||</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;         BaseOp0 == Op0 || BaseOp1 == Op1 ||</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;         <a class="code" href="SLPVectorizer_8cpp.html#ae37b3a41d982a793664ab021d9b9b325">getSameOpcode</a>({BaseOp0, Op0}, TLI).<a class="code" href="VPlanSLP_8cpp.html#af04704e906a9654777e92a4612c58c13">getOpcode</a>() ||</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;         <a class="code" href="SLPVectorizer_8cpp.html#ae37b3a41d982a793664ab021d9b9b325">getSameOpcode</a>({BaseOp1, Op1}, TLI).<a class="code" href="VPlanSLP_8cpp.html#af04704e906a9654777e92a4612c58c13">getOpcode</a>();</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;}</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment">/// \returns true if a compare instruction \p CI has similar &quot;look&quot; and</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment">/// same predicate as \p BaseCI, &quot;as is&quot; or with its operands and predicate</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="comment">/// swapped, false otherwise.</span></div>
<div class="line"><a name="l00613"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a807bb3d2ecc2999993a91d499bd26543">  613</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#a807bb3d2ecc2999993a91d499bd26543">isCmpSameOrSwapped</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a> *BaseCI, <span class="keyword">const</span> <a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a> *CI,</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                               <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> &amp;TLI) {</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BaseCI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() == CI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() &amp;&amp;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;         <span class="stringliteral">&quot;Assessing comparisons of different types?&quot;</span>);</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> BasePred = BaseCI-&gt;<a class="code" href="classllvm_1_1CmpInst.html#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>();</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> Pred = CI-&gt;<a class="code" href="classllvm_1_1CmpInst.html#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>();</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> SwappedPred = <a class="code" href="classllvm_1_1CmpInst.html#a49a2d8f483ea08a3d6ea75f90c640d76">CmpInst::getSwappedPredicate</a>(Pred);</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160; </div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *BaseOp0 = BaseCI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *BaseOp1 = BaseCI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1);</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Op0 = CI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Op1 = CI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1);</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160; </div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <span class="keywordflow">return</span> (BasePred == Pred &amp;&amp;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;          <a class="code" href="SLPVectorizer_8cpp.html#a321240b67a372a24d41687f6a2e96877">areCompatibleCmpOps</a>(BaseOp0, BaseOp1, Op0, Op1, TLI)) ||</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;         (BasePred == SwappedPred &amp;&amp;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;          <a class="code" href="SLPVectorizer_8cpp.html#a321240b67a372a24d41687f6a2e96877">areCompatibleCmpOps</a>(BaseOp0, BaseOp1, Op1, Op0, TLI));</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;}</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="comment">/// \returns analysis of the Instructions in \p VL described in</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="comment">/// InstructionsState, the Opcode that we suppose the whole list</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment">/// could be vectorized even if its structure is diverse.</span></div>
<div class="line"><a name="l00635"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#ae37b3a41d982a793664ab021d9b9b325">  635</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> InstructionsState <a class="code" href="SLPVectorizer_8cpp.html#ae37b3a41d982a793664ab021d9b9b325">getSameOpcode</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL,</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                                       <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> &amp;TLI,</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                                       <span class="keywordtype">unsigned</span> BaseIndex) {</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <span class="comment">// Make sure these are all Instructions.</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">llvm::any_of</a>(VL, [](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) { <span class="keywordflow">return</span> !isa&lt;Instruction&gt;(V); }))</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="keywordflow">return</span> InstructionsState(VL[BaseIndex], <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160; </div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  <span class="keywordtype">bool</span> IsCastOp = isa&lt;CastInst&gt;(VL[BaseIndex]);</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  <span class="keywordtype">bool</span> IsBinOp = isa&lt;BinaryOperator&gt;(VL[BaseIndex]);</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  <span class="keywordtype">bool</span> IsCmpOp = isa&lt;CmpInst&gt;(VL[BaseIndex]);</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> BasePred =</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      IsCmpOp ? cast&lt;CmpInst&gt;(VL[BaseIndex])-&gt;getPredicate()</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;              : <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba07aee43ffb66908a25c55c77ce4c0d05">CmpInst::BAD_ICMP_PREDICATE</a>;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  <span class="keywordtype">unsigned</span> Opcode = cast&lt;Instruction&gt;(VL[BaseIndex])-&gt;getOpcode();</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  <span class="keywordtype">unsigned</span> AltOpcode = Opcode;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  <span class="keywordtype">unsigned</span> AltIndex = BaseIndex;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160; </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  <span class="comment">// Check for one alternate opcode from another BinaryOperator.</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <span class="comment">// TODO - generalize to support all operators (types, calls etc.).</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  <span class="keyword">auto</span> *IBase = cast&lt;Instruction&gt;(VL[BaseIndex]);</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  <a class="code" href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> BaseID = 0;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;VFInfo&gt;</a> BaseMappings;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="classllvm_1_1CallBase.html">CallBase</a> = dyn_cast&lt;CallInst&gt;(IBase)) {</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    BaseID = <a class="code" href="namespacellvm.html#a11c66d01880f53332fc7ad53f565b039">getVectorIntrinsicIDForCall</a>(<a class="code" href="classllvm_1_1CallBase.html">CallBase</a>, &amp;TLI);</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    BaseMappings = <a class="code" href="classllvm_1_1VFDatabase.html">VFDatabase</a>(*CallBase).<a class="code" href="classllvm_1_1VFDatabase.html#af9abb14ef675e9dee8dd14bd4dd43aac">getMappings</a>(*<a class="code" href="classllvm_1_1CallBase.html">CallBase</a>);</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#aeb65ce026673a69aac75e5a7a26007b3">isTriviallyVectorizable</a>(BaseID) &amp;&amp; BaseMappings.empty())</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      <span class="keywordflow">return</span> InstructionsState(VL[BaseIndex], <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  }</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> Cnt = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(); Cnt &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; Cnt++) {</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = cast&lt;Instruction&gt;(VL[Cnt]);</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="keywordtype">unsigned</span> InstOpcode = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode();</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keywordflow">if</span> (IsBinOp &amp;&amp; isa&lt;BinaryOperator&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      <span class="keywordflow">if</span> (InstOpcode == Opcode || InstOpcode == AltOpcode)</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      <span class="keywordflow">if</span> (Opcode == AltOpcode &amp;&amp; <a class="code" href="SLPVectorizer_8cpp.html#a8f3292dcaad99569501ace7909f2ccf0">isValidForAlternation</a>(InstOpcode) &amp;&amp;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;          <a class="code" href="SLPVectorizer_8cpp.html#a8f3292dcaad99569501ace7909f2ccf0">isValidForAlternation</a>(Opcode)) {</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        AltOpcode = InstOpcode;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        AltIndex = Cnt;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      }</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (IsCastOp &amp;&amp; isa&lt;CastInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Op0 = IBase-&gt;getOperand(0);</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty0 = Op0-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Op1 = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0);</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty1 = Op1-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      <span class="keywordflow">if</span> (Ty0 == Ty1) {</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        <span class="keywordflow">if</span> (InstOpcode == Opcode || InstOpcode == AltOpcode)</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        <span class="keywordflow">if</span> (Opcode == AltOpcode) {</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="SLPVectorizer_8cpp.html#a8f3292dcaad99569501ace7909f2ccf0">isValidForAlternation</a>(Opcode) &amp;&amp;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                 <a class="code" href="SLPVectorizer_8cpp.html#a8f3292dcaad99569501ace7909f2ccf0">isValidForAlternation</a>(InstOpcode) &amp;&amp;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                 <span class="stringliteral">&quot;Cast isn&#39;t safe for alternation, logic needs to be updated!&quot;</span>);</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;          AltOpcode = InstOpcode;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;          AltIndex = Cnt;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        }</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      }</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Inst = dyn_cast&lt;CmpInst&gt;(VL[Cnt]); Inst &amp;&amp; IsCmpOp) {</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      <span class="keyword">auto</span> *BaseInst = cast&lt;CmpInst&gt;(VL[BaseIndex]);</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty0 = BaseInst-&gt;getOperand(0)-&gt;getType();</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty1 = Inst-&gt;getOperand(0)-&gt;getType();</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      <span class="keywordflow">if</span> (Ty0 == Ty1) {</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InstOpcode == Opcode &amp;&amp; <span class="stringliteral">&quot;Expected same CmpInst opcode.&quot;</span>);</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        <span class="comment">// Check for compatible operands. If the corresponding operands are not</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        <span class="comment">// compatible - need to perform alternate vectorization.</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> CurrentPred = Inst-&gt;getPredicate();</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> SwappedCurrentPred =</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;            <a class="code" href="classllvm_1_1CmpInst.html#a49a2d8f483ea08a3d6ea75f90c640d76">CmpInst::getSwappedPredicate</a>(CurrentPred);</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160; </div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> == 2 &amp;&amp;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            (BasePred == CurrentPred || BasePred == SwappedCurrentPred))</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160; </div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#a807bb3d2ecc2999993a91d499bd26543">isCmpSameOrSwapped</a>(BaseInst, Inst, TLI))</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        <span class="keyword">auto</span> *AltInst = cast&lt;CmpInst&gt;(VL[AltIndex]);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        <span class="keywordflow">if</span> (AltIndex != BaseIndex) {</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#a807bb3d2ecc2999993a91d499bd26543">isCmpSameOrSwapped</a>(AltInst, Inst, TLI))</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (BasePred != CurrentPred) {</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;              <a class="code" href="SLPVectorizer_8cpp.html#a8f3292dcaad99569501ace7909f2ccf0">isValidForAlternation</a>(InstOpcode) &amp;&amp;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;              <span class="stringliteral">&quot;CmpInst isn&#39;t safe for alternation, logic needs to be updated!&quot;</span>);</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;          AltIndex = Cnt;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        }</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> AltPred = AltInst-&gt;getPredicate();</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <span class="keywordflow">if</span> (BasePred == CurrentPred || BasePred == SwappedCurrentPred ||</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            AltPred == CurrentPred || AltPred == SwappedCurrentPred)</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      }</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (InstOpcode == Opcode || InstOpcode == AltOpcode) {</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Gep = dyn_cast&lt;GetElementPtrInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        <span class="keywordflow">if</span> (Gep-&gt;getNumOperands() != 2 ||</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;            Gep-&gt;getOperand(0)-&gt;getType() != IBase-&gt;getOperand(0)-&gt;getType())</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;          <span class="keywordflow">return</span> InstructionsState(VL[BaseIndex], <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *EI = dyn_cast&lt;ExtractElementInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="SLPVectorizer_8cpp.html#a06a9edb69d0ed6fda201d59948acfd89">isVectorLikeInstWithConstOps</a>(EI))</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;          <span class="keywordflow">return</span> InstructionsState(VL[BaseIndex], <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *LI = dyn_cast&lt;LoadInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        <span class="keyword">auto</span> *BaseLI = cast&lt;LoadInst&gt;(IBase);</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        <span class="keywordflow">if</span> (!LI-&gt;isSimple() || !BaseLI-&gt;isSimple())</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;          <span class="keywordflow">return</span> InstructionsState(VL[BaseIndex], <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Call = dyn_cast&lt;CallInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        <span class="keyword">auto</span> *<a class="code" href="classllvm_1_1CallBase.html">CallBase</a> = cast&lt;CallInst&gt;(IBase);</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        <span class="keywordflow">if</span> (Call-&gt;getCalledFunction() != <a class="code" href="classllvm_1_1CallBase.html">CallBase</a>-&gt;<a class="code" href="classllvm_1_1CallBase.html#a83b8c9e572130f403445c0b0f69b837c">getCalledFunction</a>())</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;          <span class="keywordflow">return</span> InstructionsState(VL[BaseIndex], <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        <span class="keywordflow">if</span> (Call-&gt;hasOperandBundles() &amp;&amp;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;            !<a class="code" href="namespacellvm_1_1lltok.html#af353621f14cb4b4b3af5ffaff84076b1abf5ba3ee47e95dae362eb24b6d4f48e5">std::equal</a>(Call-&gt;op_begin() + Call-&gt;getBundleOperandsStartIndex(),</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                        Call-&gt;op_begin() + Call-&gt;getBundleOperandsEndIndex(),</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                        <a class="code" href="classllvm_1_1CallBase.html">CallBase</a>-&gt;<a class="code" href="classllvm_1_1User.html#a2eeb1c7ed1cfe403f2ae0470e36c07e2">op_begin</a>() +</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                            <a class="code" href="classllvm_1_1CallBase.html">CallBase</a>-&gt;<a class="code" href="classllvm_1_1CallBase.html#a7a21e7face454c8ea6c4b9e12b506e40">getBundleOperandsStartIndex</a>()))</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;          <span class="keywordflow">return</span> InstructionsState(VL[BaseIndex], <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        <a class="code" href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> <a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a> = <a class="code" href="namespacellvm.html#a11c66d01880f53332fc7ad53f565b039">getVectorIntrinsicIDForCall</a>(Call, &amp;TLI);</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a> != BaseID)</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;          <span class="keywordflow">return</span> InstructionsState(VL[BaseIndex], <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>) {</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;          <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;VFInfo&gt;</a> <a class="code" href="InjectTLIMappings_8cpp.html#a3d23fb8c590cd607d4b25a05e31c69f5">Mappings</a> = <a class="code" href="classllvm_1_1VFDatabase.html">VFDatabase</a>(*Call).<a class="code" href="classllvm_1_1VFDatabase.html#af9abb14ef675e9dee8dd14bd4dd43aac">getMappings</a>(*Call);</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="InjectTLIMappings_8cpp.html#a3d23fb8c590cd607d4b25a05e31c69f5">Mappings</a>.size() != BaseMappings.size() ||</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;              <a class="code" href="InjectTLIMappings_8cpp.html#a3d23fb8c590cd607d4b25a05e31c69f5">Mappings</a>.front().ISA != BaseMappings.front().ISA ||</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;              <a class="code" href="InjectTLIMappings_8cpp.html#a3d23fb8c590cd607d4b25a05e31c69f5">Mappings</a>.front().ScalarName != BaseMappings.front().ScalarName ||</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;              <a class="code" href="InjectTLIMappings_8cpp.html#a3d23fb8c590cd607d4b25a05e31c69f5">Mappings</a>.front().VectorName != BaseMappings.front().VectorName ||</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;              <a class="code" href="InjectTLIMappings_8cpp.html#a3d23fb8c590cd607d4b25a05e31c69f5">Mappings</a>.front().Shape.VF != BaseMappings.front().Shape.VF ||</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;              <a class="code" href="InjectTLIMappings_8cpp.html#a3d23fb8c590cd607d4b25a05e31c69f5">Mappings</a>.front().Shape.Parameters !=</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;                  BaseMappings.front().Shape.Parameters)</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            <span class="keywordflow">return</span> InstructionsState(VL[BaseIndex], <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        }</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;      }</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    }</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="keywordflow">return</span> InstructionsState(VL[BaseIndex], <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  }</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160; </div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  <span class="keywordflow">return</span> InstructionsState(VL[BaseIndex], cast&lt;Instruction&gt;(VL[BaseIndex]),</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                           cast&lt;Instruction&gt;(VL[AltIndex]));</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;}</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="comment">/// \returns true if all of the values in \p VL have the same type or false</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="comment">/// otherwise.</span></div>
<div class="line"><a name="l00774"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#aabfbce373feafd33ca9e104d8b164ece">  774</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#aabfbce373feafd33ca9e104d8b164ece">allSameType</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL) {</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty = VL[0]-&gt;getType();</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="keywordflow">if</span> (VL[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;<a class="code" href="M68kELFObjectWriter_8cpp.html#ae4a8bc3879d2282eefd72b16b12c2a37">getType</a>() != Ty)</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160; </div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;}</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="comment">/// \returns True if in-tree use also needs extract. This refers to</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="comment">/// possible scalar operand in vectorized instruction.</span></div>
<div class="line"><a name="l00785"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#afebd06edd5d7c956687d26be5c6040c1">  785</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#afebd06edd5d7c956687d26be5c6040c1">InTreeUserNeedToExtract</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *Scalar, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *UserInst,</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                                    <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> *TLI) {</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <span class="keywordtype">unsigned</span> Opcode = UserInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>();</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  <span class="keywordflow">switch</span> (Opcode) {</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Instruction::Load</a>: {</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = cast&lt;LoadInst&gt;(UserInst);</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keywordflow">return</span> (LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad47eefa1d094f60494b6b927061ca001">getPointerOperand</a>() == Scalar);</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  }</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Instruction::Store</a>: {</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = cast&lt;StoreInst&gt;(UserInst);</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getPointerOperand() == Scalar);</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  }</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Instruction::Call</a>: {</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI = cast&lt;CallInst&gt;(UserInst);</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <a class="code" href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> <a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a> = <a class="code" href="namespacellvm.html#a11c66d01880f53332fc7ad53f565b039">getVectorIntrinsicIDForCall</a>(CI, TLI);</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#adde2ea00dd2613ee41bfe91908e4e68e">arg_size</a>(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ad5f1403d57d5cc4301785b181caa5f1b">isVectorIntrinsicWithScalarOpAtArg</a>(<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>, <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>))</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        <span class="keywordflow">return</span> (CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) == Scalar);</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    }</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    [[fallthrough]];</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  }</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  }</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;}</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;<span class="comment">/// \returns the AA location that is being access by the instruction.</span></div>
<div class="line"><a name="l00812"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#aae9f536130472bd3fbdd23c3d4486b3b">  812</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1MemoryLocation.html">MemoryLocation</a> <a class="code" href="SLPVectorizer_8cpp.html#aae9f536130472bd3fbdd23c3d4486b3b">getLocation</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;StoreInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1MemoryLocation.html#a18e5a3f1d71ba10a624f2a8e5121cf1f">MemoryLocation::get</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1MemoryLocation.html#a18e5a3f1d71ba10a624f2a8e5121cf1f">MemoryLocation::get</a>(LI);</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1MemoryLocation.html">MemoryLocation</a>();</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;}</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="comment">/// \returns True if the instruction is not a volatile or atomic load/store.</span></div>
<div class="line"><a name="l00821"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a3ca9742688618517cc4690fb947fb609">  821</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#a3ca9742688618517cc4690fb947fb609">isSimple</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <span class="keywordflow">return</span> LI-&gt;isSimple();</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;StoreInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;isSimple();</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1MemIntrinsic.html">MemIntrinsic</a> *<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = dyn_cast&lt;MemIntrinsic&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="keywordflow">return</span> !<a class="code" href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;isVolatile();</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;}</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="comment">/// Shuffles \p Mask in accordance with the given \p SubMask.</span></div>
<div class="line"><a name="l00832"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#aff62592a7901b27bdb120c2e64cd86d0">  832</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="SLPVectorizer_8cpp.html#aff62592a7901b27bdb120c2e64cd86d0">addMask</a>(<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;int&gt;</a> &amp;<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> SubMask) {</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  <span class="keywordflow">if</span> (SubMask.<a class="code" href="classllvm_1_1ArrayRef.html#ac835b8735b1b2faec0efdca236e37d94">empty</a>())</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.empty()) {</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.append(SubMask.<a class="code" href="classllvm_1_1ArrayRef.html#aab36927882fbfdcbb860d87fd9c30da8">begin</a>(), SubMask.<a class="code" href="classllvm_1_1ArrayRef.html#a7ca5197533a9c1fb8a2bd30587fcec6b">end</a>());</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  }</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> NewMask(SubMask.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(), <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;  <span class="keywordtype">int</span> TermValue = <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size(), SubMask.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = SubMask.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <span class="keywordflow">if</span> (SubMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] &gt;= TermValue || SubMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a> ||</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[SubMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]] &gt;= TermValue)</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    NewMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[SubMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]];</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  }</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.swap(NewMask);</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;}</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="comment">/// Order may have elements assigned special value (size) which is out of</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="comment">/// bounds. Such indices only appear on places which correspond to undef values</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="comment">/// (see canReuseExtract for details) and used in order to avoid undef values</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="comment">/// have effect on operands ordering.</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="comment">/// The first loop below simply finds all unused indices and then the next loop</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="comment">/// nest assigns these indices for undef values positions.</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="comment">/// As an example below Order has two undef positions and they have assigned</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="comment">/// values 3 and 7 respectively:</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="comment">/// before:  6 9 5 4 9 2 1 0</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="comment">/// after:   6 3 5 4 7 2 1 0</span></div>
<div class="line"><a name="l00860"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#acd356293c4520fc1fb4a83de901e5bb7">  860</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="SLPVectorizer_8cpp.html#acd356293c4520fc1fb4a83de901e5bb7">fixupOrderingIndices</a>(<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;unsigned&gt;</a> &amp;Order) {</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> Sz = Order.size();</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> UnusedIndices(Sz, <span class="comment">/*t=*/</span><span class="keyword">true</span>);</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> MaskedIndices(Sz);</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; Sz; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <span class="keywordflow">if</span> (Order[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] &lt; Sz)</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      UnusedIndices.<a class="code" href="classllvm_1_1SmallBitVector.html#a0f5b9402c10ba28ee972fe80522b3281">reset</a>(Order[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]);</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;      MaskedIndices.<a class="code" href="classllvm_1_1SmallBitVector.html#a0ff6951070195d0a7e0e31ffe47daaf1">set</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  }</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  <span class="keywordflow">if</span> (MaskedIndices.<a class="code" href="classllvm_1_1SmallBitVector.html#af66ea412504abedf84eebd3a5c744bd8">none</a>())</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(UnusedIndices.<a class="code" href="classllvm_1_1SmallBitVector.html#ae0307ad5c950df7f6fb56dc8326184ce">count</a>() == MaskedIndices.<a class="code" href="classllvm_1_1SmallBitVector.html#ae0307ad5c950df7f6fb56dc8326184ce">count</a>() &amp;&amp;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;         <span class="stringliteral">&quot;Non-synced masked/available indices.&quot;</span>);</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  <span class="keywordtype">int</span> Idx = UnusedIndices.<a class="code" href="classllvm_1_1SmallBitVector.html#a12297e7775aa1fc62fbea882aef623fc">find_first</a>();</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  <span class="keywordtype">int</span> MIdx = MaskedIndices.<a class="code" href="classllvm_1_1SmallBitVector.html#a12297e7775aa1fc62fbea882aef623fc">find_first</a>();</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <span class="keywordflow">while</span> (MIdx &gt;= 0) {</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Idx &gt;= 0 &amp;&amp; <span class="stringliteral">&quot;Indices must be synced.&quot;</span>);</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    Order[MIdx] = Idx;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    Idx = UnusedIndices.<a class="code" href="classllvm_1_1SmallBitVector.html#a823f7f9343d9bb1e02104ae3b2d3edb9">find_next</a>(Idx);</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    MIdx = MaskedIndices.<a class="code" href="classllvm_1_1SmallBitVector.html#a823f7f9343d9bb1e02104ae3b2d3edb9">find_next</a>(MIdx);</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  }</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;}</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160; </div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacellvm.html">llvm</a> {</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160; </div>
<div class="line"><a name="l00886"></a><span class="lineno"><a class="line" href="namespacellvm.html#a6f0917bf2ae18fac81fea6bf7e887115">  886</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a6f0917bf2ae18fac81fea6bf7e887115">inversePermutation</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;unsigned&gt;</a> Indices,</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;                               <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;int&gt;</a> &amp;<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>) {</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.clear();</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = Indices.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>();</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.resize(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[Indices[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;}</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="comment">/// Reorders the list of scalars in accordance with the given \p Mask.</span></div>
<div class="line"><a name="l00896"></a><span class="lineno"><a class="line" href="namespacellvm.html#a14c12bda1f5a9beed612b00f3f98b888">  896</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a14c12bda1f5a9beed612b00f3f98b888">reorderScalars</a>(<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Value *&gt;</a> &amp;Scalars,</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;                           <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>) {</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.empty() &amp;&amp; <span class="stringliteral">&quot;Expected non-empty mask.&quot;</span>);</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *&gt;</a> Prev(Scalars.size(),</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;                            <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(Scalars.front()-&gt;getType()));</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  Prev.<a class="code" href="classllvm_1_1SmallVectorImpl.html#abd962b7b01f49ce61ea41ee10c49e313">swap</a>(Scalars);</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = Prev.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] != <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      Scalars[<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]] = Prev[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;}</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="comment">/// Checks if the provided value does not require scheduling. It does not</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;<span class="comment">/// require scheduling if this is not an instruction or it is an instruction</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;<span class="comment">/// that does not read/write memory and all operands are either not instructions</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;<span class="comment">/// or phi nodes or instructions from different blocks.</span></div>
<div class="line"><a name="l00911"></a><span class="lineno"><a class="line" href="namespacellvm.html#aaf26535d65109ed3d13a21f1b66665a0">  911</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#aaf26535d65109ed3d13a21f1b66665a0">areAllOperandsNonInsts</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  <span class="keywordflow">return</span> !<a class="code" href="namespacellvm.html#aea9b36512640e798bb1a7ac08dc2124d">mayHaveNonDefUseDependency</a>(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands(), [<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      auto *IO = dyn_cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      if (!IO)</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        return true;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      return isa&lt;PHINode&gt;(IO) || IO-&gt;getParent() != I-&gt;getParent();</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    });</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;}</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="comment">/// Checks if the provided value does not require scheduling. It does not</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="comment">/// require scheduling if this is not an instruction or it is an instruction</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="comment">/// that does not read/write memory and all users are phi nodes or instructions</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="comment">/// from the different blocks.</span></div>
<div class="line"><a name="l00928"></a><span class="lineno"><a class="line" href="namespacellvm.html#a3097c66d0a4a009897e2ea77298a37f1">  928</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#a3097c66d0a4a009897e2ea77298a37f1">isUsedOutsideBlock</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  <span class="comment">// Limits the number of uses to save compile time.</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  constexpr <span class="keywordtype">int</span> UsesLimit = 8;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  <span class="keywordflow">return</span> !<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayReadOrWriteMemory() &amp;&amp; !<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasNUsesOrMore(UsesLimit) &amp;&amp;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;         <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;users(), [<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>](<a class="code" href="classllvm_1_1User.html">User</a> *U) {</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;           auto *IU = dyn_cast&lt;Instruction&gt;(U);</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;           if (!IU)</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;             return true;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;           return IU-&gt;getParent() != I-&gt;getParent() || isa&lt;PHINode&gt;(IU);</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;         });</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;}</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="comment">/// Checks if the specified value does not require scheduling. It does not</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="comment">/// require scheduling if all operands and all users do not need to be scheduled</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="comment">/// in the current basic block.</span></div>
<div class="line"><a name="l00946"></a><span class="lineno"><a class="line" href="namespacellvm.html#a05a7412bf10f2226fb69f2876b76e9cd">  946</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#a05a7412bf10f2226fb69f2876b76e9cd">doesNotNeedToBeScheduled</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aaf26535d65109ed3d13a21f1b66665a0">areAllOperandsNonInsts</a>(V) &amp;&amp; <a class="code" href="namespacellvm.html#a3097c66d0a4a009897e2ea77298a37f1">isUsedOutsideBlock</a>(V);</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;}</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="comment">/// Checks if the specified array of instructions does not require scheduling.</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="comment">/// It is so if all either instructions have operands that do not require</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="comment">/// scheduling or their users do not require scheduling since they are phis or</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="comment">/// in other basic blocks.</span></div>
<div class="line"><a name="l00954"></a><span class="lineno"><a class="line" href="namespacellvm.html#abed730d9d5b8f4c70f4fbe1094a0157f">  954</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#abed730d9d5b8f4c70f4fbe1094a0157f">doesNotNeedToSchedule</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL) {</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  <span class="keywordflow">return</span> !VL.<a class="code" href="classllvm_1_1ArrayRef.html#ac835b8735b1b2faec0efdca236e37d94">empty</a>() &amp;&amp;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;         (<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(VL, <a class="code" href="namespacellvm.html#a3097c66d0a4a009897e2ea77298a37f1">isUsedOutsideBlock</a>) || <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(VL, <a class="code" href="namespacellvm.html#aaf26535d65109ed3d13a21f1b66665a0">areAllOperandsNonInsts</a>));</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;}</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160; </div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="keyword">namespace </span>slpvectorizer {</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="comment">/// Bottom Up SLP Vectorizer.</span></div>
<div class="line"><a name="l00962"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html">  962</a></span>&#160;<span class="comment"></span><span class="keyword">class </span><a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> {</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  <span class="keyword">struct </span>TreeEntry;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  <span class="keyword">struct </span>ScheduleData;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <span class="keyword">class </span>ShuffleInstructionBuilder;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160; </div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00968"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#acd60c5f9dd5f4fba7d7fd87f922d3dff">  968</a></span>&#160;  <span class="keyword">using</span> <a class="code" href="classllvm_1_1SmallVector.html">ValueList</a> = <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 8&gt;</a>;</div>
<div class="line"><a name="l00969"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a583379aade2a5a99809751051dbbb986">  969</a></span>&#160;  <span class="keyword">using</span> <a class="code" href="classllvm_1_1SmallVector.html">InstrList</a> = <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 16&gt;</a>;</div>
<div class="line"><a name="l00970"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a7d1ab05a47620f16e5d70d395b9541a0">  970</a></span>&#160;  <span class="keyword">using</span> <a class="code" href="classllvm_1_1SmallPtrSet.html">ValueSet</a> = <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value *, 16&gt;</a>;</div>
<div class="line"><a name="l00971"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a361126e112f3b523319d3cbc4bfc3814">  971</a></span>&#160;  <span class="keyword">using</span> <a class="code" href="classllvm_1_1SmallVector.html">StoreList</a> = <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;StoreInst *, 8&gt;</a>;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  <span class="keyword">using</span> <a class="code" href="classllvm_1_1MapVector.html">ExtraValueToDebugLocsMap</a> =</div>
<div class="line"><a name="l00973"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a744d7dbfcace6f286751ffeff973893c">  973</a></span>&#160;      <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;Value *, SmallVector&lt;Instruction *, 2&gt;</a>&gt;;</div>
<div class="line"><a name="l00974"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a056d3cd46ef12f648e431fe9776451a1">  974</a></span>&#160;  <span class="keyword">using</span> <a class="code" href="classllvm_1_1SmallVector.html">OrdersType</a> = <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;unsigned, 4&gt;</a>;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160; </div>
<div class="line"><a name="l00976"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a8f40b270f64be7a9b63bc9cfb3b2977a">  976</a></span>&#160;  <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a8f40b270f64be7a9b63bc9cfb3b2977a">BoUpSLP</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> *Func, <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> *Se, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> *Tti,</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;          <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> *TLi, <a class="code" href="classllvm_1_1AAResults.html">AAResults</a> *Aa, <a class="code" href="classllvm_1_1LoopInfo.html">LoopInfo</a> *Li,</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;          <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> *Dt, <a class="code" href="classllvm_1_1AssumptionCache.html">AssumptionCache</a> *AC, <a class="code" href="classllvm_1_1DemandedBits.html">DemandedBits</a> *<a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46a8a67c950f093761829058d45fbc3f522">DB</a>,</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;          <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="classllvm_1_1OptimizationRemarkEmitter.html">OptimizationRemarkEmitter</a> *ORE)</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;      : BatchAA(*Aa), <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>(Func), SE(Se), <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>(Tti), TLI(TLi), LI(Li),</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        DT(Dt), AC(AC), <a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46a8a67c950f093761829058d45fbc3f522">DB</a>(<a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46a8a67c950f093761829058d45fbc3f522">DB</a>), <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>), ORE(ORE), <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(Se-&gt;getContext()) {</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <a class="code" href="structllvm_1_1CodeMetrics.html#a7e174506b52ad46ea1f746a7f727d999">CodeMetrics::collectEphemeralValues</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, AC, EphValues);</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    <span class="comment">// Use the vector register size specified by the target unless overridden</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <span class="comment">// by a command-line option.</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    <span class="comment">// TODO: It would be better to limit the vectorization factor based on</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="comment">//       data type rather than just register size. For example, x86 AVX has</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <span class="comment">//       256-bit registers, but it does not support integer operations</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="comment">//       at that width (that requires AVX2).</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#a4062d42b1e96fb8e1936cd8a3c0c086d">MaxVectorRegSizeOption</a>.getNumOccurrences())</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;      MaxVecRegSize = <a class="code" href="SLPVectorizer_8cpp.html#a4062d42b1e96fb8e1936cd8a3c0c086d">MaxVectorRegSizeOption</a>;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;      MaxVecRegSize =</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;          <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a2d30dd50c6b2d64ca3bc2826ca229fdb">getRegisterBitWidth</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html#a8bb3b1ccf19b8c85429b777dfa4a0166a183020fbea95c99db23f6d3594f4c4af">TargetTransformInfo::RGK_FixedWidthVector</a>)</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;              .<a class="code" href="classllvm_1_1details_1_1FixedOrScalableQuantity.html#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>();</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160; </div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#a4aec7f237669d6c66b2386501edefa88">MinVectorRegSizeOption</a>.getNumOccurrences())</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;      MinVecRegSize = <a class="code" href="SLPVectorizer_8cpp.html#a4aec7f237669d6c66b2386501edefa88">MinVectorRegSizeOption</a>;</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;      MinVecRegSize = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a8fa8b3631e74e836453f972aac6b4b65">getMinVectorRegisterBitWidth</a>();</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  }</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="comment">  /// Vectorize the tree that starts with the elements in \p VL.</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="comment">  /// Returns the vectorized root.</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Value.html">Value</a> *vectorizeTree();</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="comment">  /// Vectorize the tree but with the list of externally used values \p</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="comment">  /// ExternallyUsedValues. Values in this MapVector can be replaced but the</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="comment">  /// generated extractvalue instructions.</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Value.html">Value</a> *vectorizeTree(ExtraValueToDebugLocsMap &amp;ExternallyUsedValues,</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;                       <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ReductionRoot = <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="comment">  /// \returns the cost incurred by unwanted spills and fills, caused by</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="comment">  /// holding live values over call sites.</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> getSpillCost() <span class="keyword">const</span>;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="comment">  /// \returns the vectorization cost of the subtree that starts at \p VL.</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="comment">  /// A negative number means that this is profitable.</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> getTreeCost(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VectorizedVals = std::nullopt);</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="comment">  /// Construct a vectorizable tree that starts at \p Roots, ignoring users for</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="comment">  /// the purpose of scheduling and extraction in the \p UserIgnoreLst.</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> buildTree(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> Roots,</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                 <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallDenseSet.html">SmallDenseSet&lt;Value *&gt;</a> &amp;UserIgnoreLst);</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="comment">  /// Construct a vectorizable tree that starts at \p Roots.</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> buildTree(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> Roots);</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="comment">  /// Checks if the very first tree node is going to be vectorized.</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a0c8459111fa90ca87265908605c4c9fe"> 1029</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a0c8459111fa90ca87265908605c4c9fe">isVectorizedFirstNode</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    <span class="keywordflow">return</span> !VectorizableTree.empty() &amp;&amp;</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;           VectorizableTree.front()-&gt;State == TreeEntry::Vectorize;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  }</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="comment">  /// Returns the main instruction for the very first node.</span></div>
<div class="line"><a name="l01035"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a8be50e44f28ca2f65e01a0babc1a1720"> 1035</a></span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a8be50e44f28ca2f65e01a0babc1a1720">getFirstNodeMainOp</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!VectorizableTree.empty() &amp;&amp; <span class="stringliteral">&quot;No tree to get the first node from&quot;</span>);</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    <span class="keywordflow">return</span> VectorizableTree.front()-&gt;getMainOp();</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  }</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="comment">  /// Returns whether the root node has in-tree uses.</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#abeef90aa6ca3783373fedb682df96b6e"> 1041</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#abeef90aa6ca3783373fedb682df96b6e">doesRootHaveInTreeUses</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    <span class="keywordflow">return</span> !VectorizableTree.empty() &amp;&amp;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;           !VectorizableTree.front()-&gt;UserTreeIndices.empty();</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  }</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="comment">  /// Builds external uses of the vectorized scalars, i.e. the list of</span></div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="comment">  /// vectorized scalars to be extracted, their lanes and their scalar users. \p</span></div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="comment">  /// ExternallyUsedValues contains additional list of external uses to handle</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="comment">  /// vectorization of reductions.</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;  buildExternalUses(<span class="keyword">const</span> ExtraValueToDebugLocsMap &amp;ExternallyUsedValues = {});</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment">  /// Clear the internal data structures that are created by &#39;buildTree&#39;.</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a70aa6f9a0441a7a9449cb206bd77bad2"> 1054</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a70aa6f9a0441a7a9449cb206bd77bad2">deleteTree</a>() {</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    VectorizableTree.clear();</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    ScalarToTreeEntry.clear();</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    MustGather.clear();</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    EntryToLastInstruction.clear();</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    ExternalUses.clear();</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Iter : BlocksSchedules) {</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      BlockScheduling *BS = Iter.second.get();</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;      BS-&gt;clear();</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    }</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    MinBWs.clear();</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    InstrElementSize.clear();</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    UserIgnoreList = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;  }</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160; </div>
<div class="line"><a name="l01069"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a3a11daf8d89c135162dd6623f5bd164f"> 1069</a></span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a3a11daf8d89c135162dd6623f5bd164f">getTreeSize</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> VectorizableTree.size(); }</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="comment">  /// Perform LICM and CSE on the newly generated gather sequences.</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> optimizeGatherSequence();</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="comment">  /// Checks if the specified gather tree entry \p TE can be represented as a</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="comment">  /// shuffled vector entry + (possibly) permutation with other gathers. It</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="comment">  /// implements the checks only for possibly ordered scalars (Loads,</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="comment">  /// ExtractElement, ExtractValue), which can be part of the graph.</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="comment"></span>  std::optional&lt;OrdersType&gt; findReusedOrderedScalars(<span class="keyword">const</span> TreeEntry &amp;TE);</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="comment">  /// Sort loads into increasing pointers offsets to allow greater clustering.</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="comment"></span>  std::optional&lt;OrdersType&gt; findPartiallyOrderedLoads(<span class="keyword">const</span> TreeEntry &amp;TE);</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="comment">  /// Gets reordering data for the given tree entry. If the entry is vectorized</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="comment">  /// - just return ReorderIndices, otherwise check if the scalars can be</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="comment">  /// reordered and return the most optimal order.</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="comment">  /// \param TopToBottom If true, include the order of vectorized stores and</span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="comment">  /// insertelement nodes, otherwise skip them.</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="comment"></span>  std::optional&lt;OrdersType&gt; getReorderingData(<span class="keyword">const</span> TreeEntry &amp;TE, <span class="keywordtype">bool</span> TopToBottom);</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;<span class="comment">  /// Reorders the current graph to the most profitable order starting from the</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="comment">  /// root node to the leaf nodes. The best order is chosen only from the nodes</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="comment">  /// of the same size (vectorization factor). Smaller nodes are considered</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="comment">  /// parts of subgraph with smaller VF and they are reordered independently. We</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="comment">  /// can make it because we still need to extend smaller nodes to the wider VF</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="comment">  /// and we can merge reordering shuffles with the widening shuffles.</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> reorderTopToBottom();</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;<span class="comment">  /// Reorders the current graph to the most profitable order starting from</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;<span class="comment">  /// leaves to the root. It allows to rotate small subgraphs and reduce the</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="comment">  /// number of reshuffles if the leaf nodes use the same order. In this case we</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;<span class="comment">  /// can merge the orders and just shuffle user node instead of shuffling its</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;<span class="comment">  /// operands. Plus, even the leaf nodes have different orders, it allows to</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;<span class="comment">  /// sink reordering in the graph closer to the root node and merge it later</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="comment">  /// during analysis.</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> reorderBottomToTop(<span class="keywordtype">bool</span> IgnoreReorder = <span class="keyword">false</span>);</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;<span class="comment">  /// \return The vector element size in bits to use when vectorizing the</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<span class="comment">  /// expression tree ending at \p V. If V is a store, the size is the width of</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="comment">  /// the stored value. Otherwise, the size is the width of the largest loaded</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="comment">  /// value reaching V. This method is used by the vectorizer to calculate</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="comment">  /// vectorization factors.</span></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="comment"></span>  <span class="keywordtype">unsigned</span> getVectorElementSize(<a class="code" href="classllvm_1_1Value.html">Value</a> *V);</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;<span class="comment">  /// Compute the minimum type sizes required to represent the entries in a</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="comment">  /// vectorizable tree.</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#af7b6ae12af3578f7a20ccc11a4458f9f">computeMinimumValueSizes</a>();</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160; </div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  <span class="comment">// \returns maximum vector register size as set by TTI or overridden by cl::opt.</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#adc72e9ea7ec5e94d10e2a9a4fdaa3fc2"> 1119</a></span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#adc72e9ea7ec5e94d10e2a9a4fdaa3fc2">getMaxVecRegSize</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <span class="keywordflow">return</span> MaxVecRegSize;</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  }</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160; </div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;  <span class="comment">// \returns minimum vector register size as set by cl::opt.</span></div>
<div class="line"><a name="l01124"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#aef776c88ca6591ad28a6f21f216f1ef7"> 1124</a></span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#aef776c88ca6591ad28a6f21f216f1ef7">getMinVecRegSize</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    <span class="keywordflow">return</span> MinVecRegSize;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;  }</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160; </div>
<div class="line"><a name="l01128"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#aacc65a747c158a620f90f612a673a506"> 1128</a></span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#aacc65a747c158a620f90f612a673a506">getMinVF</a>(<span class="keywordtype">unsigned</span> Sz)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(2U, getMinVecRegSize() / Sz);</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;  }</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160; </div>
<div class="line"><a name="l01132"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a782cc6906561f01e563f30e50833235d"> 1132</a></span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a782cc6906561f01e563f30e50833235d">getMaximumVF</a>(<span class="keywordtype">unsigned</span> ElemWidth, <span class="keywordtype">unsigned</span> Opcode)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    <span class="keywordtype">unsigned</span> MaxVF = <a class="code" href="SLPVectorizer_8cpp.html#a6355b64ef621c21a21f5d3b41808dfa1">MaxVFOption</a>.getNumOccurrences() ?</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;      <a class="code" href="SLPVectorizer_8cpp.html#a6355b64ef621c21a21f5d3b41808dfa1">MaxVFOption</a> : <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a785bcc5cab17bd5d96f800247dad0649">getMaximumVF</a>(ElemWidth, Opcode);</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <span class="keywordflow">return</span> MaxVF ? MaxVF : UINT_MAX;</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  }</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="comment">  /// Check if homogeneous aggregate is isomorphic to some VectorType.</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="comment">  /// Accepts homogeneous multidimensional aggregate of scalars/vectors like</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="comment">  /// {[4 x i16], [4 x i16]}, { &lt;2 x float&gt;, &lt;2 x float&gt; },</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;<span class="comment">  /// {{{i16, i16}, {i16, i16}}, {{i16, i16}, {i16, i16}}} and so on.</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;<span class="comment">  ///</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;<span class="comment">  /// \returns number of elements in vector if isomorphism exists, 0 otherwise.</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="comment"></span>  <span class="keywordtype">unsigned</span> canMapToVector(<a class="code" href="classllvm_1_1Type.html">Type</a> *<a class="code" href="classT.html">T</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>) <span class="keyword">const</span>;</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="comment">  /// \returns True if the VectorizableTree is both tiny and not fully</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;<span class="comment">  /// vectorizable. We do not vectorize such trees.</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> isTreeTinyAndNotFullyVectorizable(<span class="keywordtype">bool</span> ForReduction = <span class="keyword">false</span>) <span class="keyword">const</span>;</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="comment">  /// Assume that a legal-sized &#39;or&#39;-reduction of shifted/zexted loaded values</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="comment">  /// can be load combined in the backend. Load combining may not be allowed in</span></div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;<span class="comment">  /// the IR optimizer, so we do not want to alter the pattern. For example,</span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<span class="comment">  /// partially transforming a scalar bswap() pattern into vector code is</span></div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;<span class="comment">  /// effectively impossible for the backend to undo.</span></div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;<span class="comment">  /// TODO: If load combining is allowed in the IR optimizer, this analysis</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="comment">  ///       may not be necessary.</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> isLoadCombineReductionCandidate(<a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830e">RecurKind</a> RdxKind) <span class="keyword">const</span>;</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;<span class="comment">  /// Assume that a vector of stores of bitwise-or/shifted/zexted loaded values</span></div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="comment">  /// can be load combined in the backend. Load combining may not be allowed in</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="comment">  /// the IR optimizer, so we do not want to alter the pattern. For example,</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;<span class="comment">  /// partially transforming a scalar bswap() pattern into vector code is</span></div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="comment">  /// effectively impossible for the backend to undo.</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;<span class="comment">  /// TODO: If load combining is allowed in the IR optimizer, this analysis</span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="comment">  ///       may not be necessary.</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="Reassociate_8cpp.html#ae32b03825183735233b4142e1945abf8">isLoadCombineCandidate</a>() <span class="keyword">const</span>;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160; </div>
<div class="line"><a name="l01168"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a3560e6ff2cf16b519313ee80c08a3383"> 1168</a></span>&#160;  <a class="code" href="classllvm_1_1OptimizationRemarkEmitter.html">OptimizationRemarkEmitter</a> *<a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a3560e6ff2cf16b519313ee80c08a3383">getORE</a>() { <span class="keywordflow">return</span> ORE; }</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;<span class="comment">  /// This structure holds any data we need about the edges being traversed</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="comment">  /// during buildTree_rec(). We keep track of:</span></div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;<span class="comment">  /// (i) the user TreeEntry index, and</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="comment">  /// (ii) the index of the edge.</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"><a class="line" href="structllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo.html"> 1174</a></span>&#160;<span class="comment"></span>  <span class="keyword">struct </span><a class="code" href="structllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo.html">EdgeInfo</a> {</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    <a class="code" href="structllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo.html">EdgeInfo</a>() = <span class="keywordflow">default</span>;</div>
<div class="line"><a name="l01176"></a><span class="lineno"><a class="line" href="structllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo.html#a245e7cffbc040976da0a6407651983de"> 1176</a></span>&#160;    <a class="code" href="structllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo.html#a245e7cffbc040976da0a6407651983de">EdgeInfo</a>(TreeEntry *UserTE, <span class="keywordtype">unsigned</span> EdgeIdx)</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;        : UserTE(UserTE), EdgeIdx(EdgeIdx) {}<span class="comment"></span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;<span class="comment">    /// The user TreeEntry.</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"><a class="line" href="structllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo.html#ac3d3c4a713b6bbd7165cd4b872252b79"> 1179</a></span>&#160;<span class="comment"></span>    TreeEntry *UserTE = <span class="keyword">nullptr</span>;<span class="comment"></span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;<span class="comment">    /// The operand index of the use.</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"><a class="line" href="structllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo.html#a014a11a5b7363e38bdd5c5c04302c6b8"> 1181</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> EdgeIdx = UINT_MAX;</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l01183"></a><span class="lineno"><a class="line" href="structllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo.html#a8f5111c835c412c59d5f3f158a2214ed"> 1183</a></span>&#160;    <span class="keyword">friend</span> <span class="keyword">inline</span> <a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;<a class="code" href="structllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo.html#a8f5111c835c412c59d5f3f158a2214ed">operator&lt;&lt;</a>(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;<a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>,</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;                                          <span class="keyword">const</span> <a class="code" href="structllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo.html">BoUpSLP::EdgeInfo</a> &amp;EI) {</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;      EI.<a class="code" href="structllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo.html#afaf1506235fe5124a0fe4bf12d655551">dump</a>(<a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>);</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>;</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    }<span class="comment"></span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="comment">    /// Debug print.</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"><a class="line" href="structllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo.html#afaf1506235fe5124a0fe4bf12d655551"> 1189</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> <a class="code" href="structllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo.html#afaf1506235fe5124a0fe4bf12d655551">dump</a>(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;<a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;      <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; <span class="stringliteral">&quot;{User:&quot;</span> &lt;&lt; (UserTE ? <a class="code" href="namespacellvm.html#a13c1b5a253da5da49ce33d03dc1efc07">std::to_string</a>(UserTE-&gt;Idx) : <span class="stringliteral">&quot;null&quot;</span>)</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;         &lt;&lt; <span class="stringliteral">&quot; EdgeIdx:&quot;</span> &lt;&lt; EdgeIdx &lt;&lt; <span class="stringliteral">&quot;}&quot;</span>;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    }</div>
<div class="line"><a name="l01193"></a><span class="lineno"><a class="line" href="structllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo.html#a2b5258ea831ff51e2dc51dd405c547ba"> 1193</a></span>&#160;    <a class="code" href="Compiler_8h.html#aa863693eef567397d9c292da5bf22d34">LLVM_DUMP_METHOD</a> <span class="keywordtype">void</span> <a class="code" href="structllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo.html#a2b5258ea831ff51e2dc51dd405c547ba">dump</a>()<span class="keyword"> const </span>{ <a class="code" href="structllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo.html#a2b5258ea831ff51e2dc51dd405c547ba">dump</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()); }</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  };</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;<span class="comment">  /// A helper class used for scoring candidates for two consecutive lanes.</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html"> 1198</a></span>&#160;<span class="comment"></span>  <span class="keyword">class </span><a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html">LookAheadHeuristics</a> {</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> &amp;TLI;</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>;</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> &amp;R;</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    <span class="keywordtype">int</span> NumLanes; <span class="comment">// Total number of lanes (aka vectorization factor).</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    <span class="keywordtype">int</span> MaxLevel; <span class="comment">// The maximum recursion depth for accumulating score.</span></div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160; </div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  <span class="keyword">public</span>:</div>
<div class="line"><a name="l01207"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html#a8e14accdaa3da86f319cd54a73cf7e79"> 1207</a></span>&#160;    <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html#a8e14accdaa3da86f319cd54a73cf7e79">LookAheadHeuristics</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> &amp;TLI, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;                        <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE, <span class="keyword">const</span> <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> &amp;R, <span class="keywordtype">int</span> NumLanes,</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;                        <span class="keywordtype">int</span> MaxLevel)</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        : TLI(TLI), <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>), SE(SE), R(R), NumLanes(NumLanes),</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;          MaxLevel(MaxLevel) {}</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160; </div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    <span class="comment">// The hard-coded scores listed here are not very important, though it shall</span></div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    <span class="comment">// be higher for better matches to improve the resulting cost. When</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    <span class="comment">// computing the scores of matching one sub-tree with another, we are</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    <span class="comment">// basically counting the number of values that are matching. So even if all</span></div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    <span class="comment">// scores are set to 1, we would still get a decent matching result.</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <span class="comment">// However, sometimes we have to break ties. For example we may have to</span></div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    <span class="comment">// choose between matching loads vs matching opcodes. This is what these</span></div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    <span class="comment">// scores are helping us with: they provide the order of preference. Also,</span></div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    <span class="comment">// this is important if the scalar is externally used or used in another</span></div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    <span class="comment">// tree entry node in the different lane.</span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="comment">    /// Loads from consecutive memory addresses, e.g. load(A[i]), load(A[i+1]).</span></div>
<div class="line"><a name="l01225"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html#af379975020343d71dc168188b48b3e80"> 1225</a></span>&#160;<span class="comment"></span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> ScoreConsecutiveLoads = 4;<span class="comment"></span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="comment">    /// The same load multiple times. This should have a better score than</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="comment">    /// `ScoreSplat` because it in x86 for a 2-lane vector we can represent it</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="comment">    /// with `movddup (%reg), xmm0` which has a throughput of 0.5 versus 0.5 for</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;<span class="comment">    /// a vector load and 1.0 for a broadcast.</span></div>
<div class="line"><a name="l01230"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html#a9bcb4a0dcff036fbe065d2d3fc070e0a"> 1230</a></span>&#160;<span class="comment"></span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> ScoreSplatLoads = 3;<span class="comment"></span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;<span class="comment">    /// Loads from reversed memory addresses, e.g. load(A[i+1]), load(A[i]).</span></div>
<div class="line"><a name="l01232"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html#ada590dc321fc7e964c5639abab76c735"> 1232</a></span>&#160;<span class="comment"></span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> ScoreReversedLoads = 3;<span class="comment"></span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;<span class="comment">    /// A load candidate for masked gather.</span></div>
<div class="line"><a name="l01234"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html#a6dcdab31ac73597814edddf95b66b079"> 1234</a></span>&#160;<span class="comment"></span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> ScoreMaskedGatherCandidate = 1;<span class="comment"></span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="comment">    /// ExtractElementInst from same vector and consecutive indexes.</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html#a0495d664301e5383505277ee1072e6fa"> 1236</a></span>&#160;<span class="comment"></span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> ScoreConsecutiveExtracts = 4;<span class="comment"></span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;<span class="comment">    /// ExtractElementInst from same vector and reversed indices.</span></div>
<div class="line"><a name="l01238"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html#afa5391fdb54f44ff31e9030c8ed87863"> 1238</a></span>&#160;<span class="comment"></span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> ScoreReversedExtracts = 3;<span class="comment"></span></div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;<span class="comment">    /// Constants.</span></div>
<div class="line"><a name="l01240"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html#add1a9bf14a2e92c4fb46746153901644"> 1240</a></span>&#160;<span class="comment"></span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> ScoreConstants = 2;<span class="comment"></span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;<span class="comment">    /// Instructions with the same opcode.</span></div>
<div class="line"><a name="l01242"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html#a4266baa26aefdbb58a1e666e8552bb7e"> 1242</a></span>&#160;<span class="comment"></span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> ScoreSameOpcode = 2;<span class="comment"></span></div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;<span class="comment">    /// Instructions with alt opcodes (e.g, add + sub).</span></div>
<div class="line"><a name="l01244"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html#ae2865b5c84930650da21d4f65a9cc12d"> 1244</a></span>&#160;<span class="comment"></span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> ScoreAltOpcodes = 1;<span class="comment"></span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;<span class="comment">    /// Identical instructions (a.k.a. splat or broadcast).</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html#a6ea90b8fcc43312bd928ea5bd01bd7f6"> 1246</a></span>&#160;<span class="comment"></span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> ScoreSplat = 1;<span class="comment"></span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;<span class="comment">    /// Matching with an undef is preferable to failing.</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html#a4e6265bb96873ff702396ba6f70dd698"> 1248</a></span>&#160;<span class="comment"></span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> ScoreUndef = 1;<span class="comment"></span></div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="comment">    /// Score for failing to find a decent match.</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html#a653c21908b15629b676161353d43d719"> 1250</a></span>&#160;<span class="comment"></span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> ScoreFail = 0;<span class="comment"></span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="comment">    /// Score if all users are vectorized.</span></div>
<div class="line"><a name="l01252"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html#a39f0c9721718a7656117ed02d6f32b29"> 1252</a></span>&#160;<span class="comment"></span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> ScoreAllUserVectorized = 1;</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;<span class="comment">    /// \returns the score of placing \p V1 and \p V2 in consecutive lanes.</span></div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="comment">    /// \p U1 and \p U2 are the users of \p V1 and \p V2.</span></div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;<span class="comment">    /// Also, checks if \p V1 and \p V2 are compatible with instructions in \p</span></div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;<span class="comment">    /// MainAltOps.</span></div>
<div class="line"><a name="l01258"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html#a266c328585c72cd84dc48ef488acef49"> 1258</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">int</span> <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html#a266c328585c72cd84dc48ef488acef49">getShallowScore</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V1, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *U1, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *U2,</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;                        <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> MainAltOps)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="SLPVectorizer_8cpp.html#aa3ea54a95743867473d32853d3c65603">isValidElementType</a>(V1-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()) ||</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;          !<a class="code" href="SLPVectorizer_8cpp.html#aa3ea54a95743867473d32853d3c65603">isValidElementType</a>(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>-&gt;getType()))</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;        <span class="keywordflow">return</span> LookAheadHeuristics::ScoreFail;</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160; </div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;      <span class="keywordflow">if</span> (V1 == <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>) {</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;        <span class="keywordflow">if</span> (isa&lt;LoadInst&gt;(V1)) {</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;          <span class="comment">// Retruns true if the users of V1 and V2 won&#39;t need to be extracted.</span></div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;          <span class="keyword">auto</span> AllUsersAreInternal = [U1, U2, <span class="keyword">this</span>](<a class="code" href="classllvm_1_1Value.html">Value</a> *V1, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>) {</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;            <span class="comment">// Bail out if we have too many uses to save compilation time.</span></div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;            <span class="keyword">static</span> constexpr <span class="keywordtype">unsigned</span> Limit = 8;</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;            <span class="keywordflow">if</span> (V1-&gt;hasNUsesOrMore(Limit) || <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>-&gt;hasNUsesOrMore(Limit))</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;              <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160; </div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;            <span class="keyword">auto</span> AllUsersVectorized = [U1, U2, <span class="keyword">this</span>](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;              <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all_of</a>(V-&gt;<a class="code" href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">users</a>(), [U1, U2, <span class="keyword">this</span>](<a class="code" href="classllvm_1_1Value.html">Value</a> *U) {</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;                return U == U1 || U == U2 || R.getTreeEntry(U) != nullptr;</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;              });</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;            };</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;            <span class="keywordflow">return</span> AllUsersVectorized(V1) &amp;&amp; AllUsersVectorized(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>);</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;          };</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;          <span class="comment">// A broadcast of a load can be cheaper on some targets.</span></div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;          <span class="keywordflow">if</span> (R.TTI-&gt;isLegalBroadcastLoad(V1-&gt;getType(),</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;                                          <a class="code" href="classllvm_1_1ElementCount.html#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(NumLanes)) &amp;&amp;</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;              ((<span class="keywordtype">int</span>)V1-&gt;getNumUses() == NumLanes ||</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;               AllUsersAreInternal(V1, <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>)))</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;            <span class="keywordflow">return</span> LookAheadHeuristics::ScoreSplatLoads;</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;        }</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;        <span class="keywordflow">return</span> LookAheadHeuristics::ScoreSplat;</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;      }</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160; </div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;      <span class="keyword">auto</span> *LI1 = dyn_cast&lt;LoadInst&gt;(V1);</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;      <span class="keyword">auto</span> *LI2 = dyn_cast&lt;LoadInst&gt;(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>);</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;      <span class="keywordflow">if</span> (LI1 &amp;&amp; LI2) {</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;        <span class="keywordflow">if</span> (LI1-&gt;getParent() != LI2-&gt;getParent() || !LI1-&gt;isSimple() ||</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;            !LI2-&gt;isSimple())</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;          <span class="keywordflow">return</span> LookAheadHeuristics::ScoreFail;</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160; </div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        std::optional&lt;int&gt; Dist = <a class="code" href="namespacellvm.html#a034d66b8c0aeb72ea13fd26392083446">getPointersDiff</a>(</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;            LI1-&gt;getType(), LI1-&gt;getPointerOperand(), LI2-&gt;getType(),</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;            LI2-&gt;getPointerOperand(), <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, SE, <span class="comment">/*StrictCheck=*/</span><span class="keyword">true</span>);</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;        <span class="keywordflow">if</span> (!Dist || *Dist == 0) {</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a3b1c5788b85ffa254be0e834edf5cf8f">getUnderlyingObject</a>(LI1-&gt;getPointerOperand()) ==</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;                  <a class="code" href="namespacellvm.html#a3b1c5788b85ffa254be0e834edf5cf8f">getUnderlyingObject</a>(LI2-&gt;getPointerOperand()) &amp;&amp;</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;              R.TTI-&gt;isLegalMaskedGather(</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;                  <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(LI1-&gt;getType(), NumLanes),</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;                  LI1-&gt;getAlign()))</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;            <span class="keywordflow">return</span> LookAheadHeuristics::ScoreMaskedGatherCandidate;</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;          <span class="keywordflow">return</span> LookAheadHeuristics::ScoreFail;</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;        }</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;        <span class="comment">// The distance is too large - still may be profitable to use masked</span></div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;        <span class="comment">// loads/gathers.</span></div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a2816e84a08c108d18bc4665bc1817e01">std::abs</a>(*Dist) &gt; NumLanes / 2)</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;          <span class="keywordflow">return</span> LookAheadHeuristics::ScoreMaskedGatherCandidate;</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;        <span class="comment">// This still will detect consecutive loads, but we might have &quot;holes&quot;</span></div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;        <span class="comment">// in some cases. It is ok for non-power-2 vectorization and may produce</span></div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;        <span class="comment">// better results. It should not affect current vectorization.</span></div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;        <span class="keywordflow">return</span> (*Dist &gt; 0) ? LookAheadHeuristics::ScoreConsecutiveLoads</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;                           : LookAheadHeuristics::ScoreReversedLoads;</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;      }</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160; </div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="lib_2Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a> = dyn_cast&lt;Constant&gt;(V1);</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;      <span class="keyword">auto</span> *C2 = dyn_cast&lt;Constant&gt;(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>);</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="lib_2Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a> &amp;&amp; C2)</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;        <span class="keywordflow">return</span> LookAheadHeuristics::ScoreConstants;</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160; </div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;      <span class="comment">// Extracts from consecutive indexes of the same vector better score as</span></div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;      <span class="comment">// the extracts could be optimized away.</span></div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *EV1;</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;      <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *Ex1Idx;</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V1, <a class="code" href="namespacellvm_1_1PatternMatch.html#adf0290c7c322f0bf8b275d6b26410b52">m_ExtractElt</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(EV1), <a class="code" href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">m_ConstantInt</a>(Ex1Idx)))) {</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;        <span class="comment">// Undefs are always profitable for extractelements.</span></div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        <span class="keywordflow">if</span> (isa&lt;UndefValue&gt;(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>))</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;          <span class="keywordflow">return</span> LookAheadHeuristics::ScoreConsecutiveExtracts;</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *EV2 = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;        <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *Ex2Idx = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>,</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;                  <a class="code" href="namespacellvm_1_1PatternMatch.html#adf0290c7c322f0bf8b275d6b26410b52">m_ExtractElt</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(EV2), <a class="code" href="namespacellvm_1_1PatternMatch.html#af4feec45578e32fe65d8efc59112bc8e">m_CombineOr</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">m_ConstantInt</a>(Ex2Idx),</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;                                                         <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>())))) {</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;          <span class="comment">// Undefs are always profitable for extractelements.</span></div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;          <span class="keywordflow">if</span> (!Ex2Idx)</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;            <span class="keywordflow">return</span> LookAheadHeuristics::ScoreConsecutiveExtracts;</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#ac396bb87eb4db1dd3ce315e4d91ee2de">isUndefVector</a>(EV2).<a class="code" href="namespacellvm_1_1LegalityPredicates.html#ad7ac7032baa62cc00002886633b9f281">all</a>() &amp;&amp; EV2-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() == EV1-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;            <span class="keywordflow">return</span> LookAheadHeuristics::ScoreConsecutiveExtracts;</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;          <span class="keywordflow">if</span> (EV2 == EV1) {</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;            <span class="keywordtype">int</span> Idx1 = Ex1Idx-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#ac09a21c371a9c535cbc13e8f82503aec">getZExtValue</a>();</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;            <span class="keywordtype">int</span> Idx2 = Ex2Idx-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#ac09a21c371a9c535cbc13e8f82503aec">getZExtValue</a>();</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;            <span class="keywordtype">int</span> Dist = Idx2 - Idx1;</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;            <span class="comment">// The distance is too large - still may be profitable to use</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;            <span class="comment">// shuffles.</span></div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a2816e84a08c108d18bc4665bc1817e01">std::abs</a>(Dist) == 0)</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;              <span class="keywordflow">return</span> LookAheadHeuristics::ScoreSplat;</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a2816e84a08c108d18bc4665bc1817e01">std::abs</a>(Dist) &gt; NumLanes / 2)</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;              <span class="keywordflow">return</span> LookAheadHeuristics::ScoreSameOpcode;</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;            <span class="keywordflow">return</span> (Dist &gt; 0) ? LookAheadHeuristics::ScoreConsecutiveExtracts</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;                              : LookAheadHeuristics::ScoreReversedExtracts;</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;          }</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;          <span class="keywordflow">return</span> LookAheadHeuristics::ScoreAltOpcodes;</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;        }</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;        <span class="keywordflow">return</span> LookAheadHeuristics::ScoreFail;</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;      }</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160; </div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;      <span class="keyword">auto</span> *I1 = dyn_cast&lt;Instruction&gt;(V1);</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;      <span class="keyword">auto</span> *I2 = dyn_cast&lt;Instruction&gt;(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>);</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;      <span class="keywordflow">if</span> (I1 &amp;&amp; I2) {</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;        <span class="keywordflow">if</span> (I1-&gt;getParent() != I2-&gt;getParent())</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;          <span class="keywordflow">return</span> LookAheadHeuristics::ScoreFail;</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;        <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 4&gt;</a> Ops(MainAltOps.<a class="code" href="classllvm_1_1ArrayRef.html#aab36927882fbfdcbb860d87fd9c30da8">begin</a>(), MainAltOps.<a class="code" href="classllvm_1_1ArrayRef.html#a7ca5197533a9c1fb8a2bd30587fcec6b">end</a>());</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;        Ops.push_back(I1);</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;        Ops.push_back(I2);</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        InstructionsState <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = <a class="code" href="SLPVectorizer_8cpp.html#ae37b3a41d982a793664ab021d9b9b325">getSameOpcode</a>(Ops, TLI);</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;        <span class="comment">// Note: Only consider instructions with &lt;= 2 operands to avoid</span></div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;        <span class="comment">// complexity explosion.</span></div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.getOpcode() &amp;&amp;</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;            (<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.MainOp-&gt;getNumOperands() &lt;= 2 || !MainAltOps.<a class="code" href="classllvm_1_1ArrayRef.html#ac835b8735b1b2faec0efdca236e37d94">empty</a>() ||</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;             !<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.isAltShuffle()) &amp;&amp;</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;            <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(Ops, [&amp;<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;              <span class="keywordflow">return</span> cast&lt;Instruction&gt;(V)-&gt;getNumOperands() ==</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;                     <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.MainOp-&gt;getNumOperands();</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;            }))</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.isAltShuffle() ? LookAheadHeuristics::ScoreAltOpcodes</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;                                  : LookAheadHeuristics::ScoreSameOpcode;</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;      }</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160; </div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;      <span class="keywordflow">if</span> (isa&lt;UndefValue&gt;(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>))</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;        <span class="keywordflow">return</span> LookAheadHeuristics::ScoreUndef;</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160; </div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;      <span class="keywordflow">return</span> LookAheadHeuristics::ScoreFail;</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    }</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="comment">    /// Go through the operands of \p LHS and \p RHS recursively until</span></div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="comment">    /// MaxLevel, and return the cummulative score. \p U1 and \p U2 are</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="comment">    /// the users of \p LHS and \p RHS (that is \p LHS and \p RHS are operands</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="comment">    /// of \p U1 and \p U2), except at the beginning of the recursion where</span></div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="comment">    /// these are set to nullptr.</span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;<span class="comment">    ///</span></div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="comment">    /// For example:</span></div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="comment">    /// \verbatim</span></div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;<span class="comment">    ///  A[0]  B[0]  A[1]  B[1]  C[0] D[0]  B[1] A[1]</span></div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="comment">    ///     \ /         \ /         \ /        \ /</span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="comment">    ///      +           +           +          +</span></div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="comment">    ///     G1          G2          G3         G4</span></div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;<span class="comment">    /// \endverbatim</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;<span class="comment">    /// The getScoreAtLevelRec(G1, G2) function will try to match the nodes at</span></div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;<span class="comment">    /// each level recursively, accumulating the score. It starts from matching</span></div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;<span class="comment">    /// the additions at level 0, then moves on to the loads (level 1). The</span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;<span class="comment">    /// score of G1 and G2 is higher than G1 and G3, because {A[0],A[1]} and</span></div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;<span class="comment">    /// {B[0],B[1]} match with LookAheadHeuristics::ScoreConsecutiveLoads, while</span></div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;<span class="comment">    /// {A[0],C[0]} has a score of LookAheadHeuristics::ScoreFail.</span></div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;<span class="comment">    /// Please note that the order of the operands does not matter, as we</span></div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;<span class="comment">    /// evaluate the score of all profitable combinations of operands. In</span></div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="comment">    /// other words the score of G1 and G4 is the same as G1 and G2. This</span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="comment">    /// heuristic is based on ideas described in:</span></div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="comment">    ///   Look-ahead SLP: Auto-vectorization in the presence of commutative</span></div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;<span class="comment">    ///   operations, CGO 2018 by Vasileios Porpodas, Rodrigo C. O. Rocha,</span></div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;<span class="comment">    ///   Luís F. W. Góes</span></div>
<div class="line"><a name="l01415"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html#a54d9af6b4c656c782e017020406e8291"> 1415</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">int</span> <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html#a54d9af6b4c656c782e017020406e8291">getScoreAtLevelRec</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *U1,</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;                           <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *U2, <span class="keywordtype">int</span> CurrLevel,</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;                           <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> MainAltOps)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160; </div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;      <span class="comment">// Get the shallow score of V1 and V2.</span></div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;      <span class="keywordtype">int</span> ShallowScoreAtThisLevel =</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;          getShallowScore(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, U1, U2, MainAltOps);</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160; </div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;      <span class="comment">// If reached MaxLevel,</span></div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;      <span class="comment">//  or if V1 and V2 are not instructions,</span></div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;      <span class="comment">//  or if they are SPLAT,</span></div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;      <span class="comment">//  or if they are not consecutive,</span></div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;      <span class="comment">//  or if profitable to vectorize loads or extractelements, early return</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;      <span class="comment">//  the current cost.</span></div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;      <span class="keyword">auto</span> *I1 = dyn_cast&lt;Instruction&gt;(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>);</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;      <span class="keyword">auto</span> *I2 = dyn_cast&lt;Instruction&gt;(<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;      <span class="keywordflow">if</span> (CurrLevel == MaxLevel || !(I1 &amp;&amp; I2) || I1 == I2 ||</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;          ShallowScoreAtThisLevel == LookAheadHeuristics::ScoreFail ||</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;          (((isa&lt;LoadInst&gt;(I1) &amp;&amp; isa&lt;LoadInst&gt;(I2)) ||</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;            (I1-&gt;getNumOperands() &gt; 2 &amp;&amp; I2-&gt;getNumOperands() &gt; 2) ||</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;            (isa&lt;ExtractElementInst&gt;(I1) &amp;&amp; isa&lt;ExtractElementInst&gt;(I2))) &amp;&amp;</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;           ShallowScoreAtThisLevel))</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;        <span class="keywordflow">return</span> ShallowScoreAtThisLevel;</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(I1 &amp;&amp; I2 &amp;&amp; <span class="stringliteral">&quot;Should have early exited.&quot;</span>);</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160; </div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;      <span class="comment">// Contains the I2 operand indexes that got matched with I1 operands.</span></div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;      <a class="code" href="classllvm_1_1SmallSet.html">SmallSet&lt;unsigned, 4&gt;</a> Op2Used;</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160; </div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;      <span class="comment">// Recursion towards the operands of I1 and I2. We are trying all possible</span></div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;      <span class="comment">// operand pairs, and keeping track of the best score.</span></div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> OpIdx1 = 0, NumOperands1 = I1-&gt;getNumOperands();</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;           OpIdx1 != NumOperands1; ++OpIdx1) {</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;        <span class="comment">// Try to pair op1I with the best operand of I2.</span></div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;        <span class="keywordtype">int</span> MaxTmpScore = 0;</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;        <span class="keywordtype">unsigned</span> MaxOpIdx2 = 0;</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;        <span class="keywordtype">bool</span> FoundBest = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;        <span class="comment">// If I2 is commutative try all combinations.</span></div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;        <span class="keywordtype">unsigned</span> FromIdx = <a class="code" href="SLPVectorizer_8cpp.html#ab0da56db6da27340e5a7151a4676106a">isCommutative</a>(I2) ? 0 : OpIdx1;</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;        <span class="keywordtype">unsigned</span> ToIdx = <a class="code" href="SLPVectorizer_8cpp.html#ab0da56db6da27340e5a7151a4676106a">isCommutative</a>(I2)</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;                             ? I2-&gt;getNumOperands()</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;                             : <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(I2-&gt;getNumOperands(), OpIdx1 + 1);</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FromIdx &lt;= ToIdx &amp;&amp; <span class="stringliteral">&quot;Bad index&quot;</span>);</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> OpIdx2 = FromIdx; OpIdx2 != ToIdx; ++OpIdx2) {</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;          <span class="comment">// Skip operands already paired with OpIdx1.</span></div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;          <span class="keywordflow">if</span> (Op2Used.<a class="code" href="classllvm_1_1SmallSet.html#a2a98f19750ba941ce791b75ca6d77e48">count</a>(OpIdx2))</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;          <span class="comment">// Recursively calculate the cost at each level</span></div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;          <span class="keywordtype">int</span> TmpScore =</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;              getScoreAtLevelRec(I1-&gt;getOperand(OpIdx1), I2-&gt;getOperand(OpIdx2),</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;                                 I1, I2, CurrLevel + 1, std::nullopt);</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;          <span class="comment">// Look for the best score.</span></div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;          <span class="keywordflow">if</span> (TmpScore &gt; LookAheadHeuristics::ScoreFail &amp;&amp;</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;              TmpScore &gt; MaxTmpScore) {</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;            MaxTmpScore = TmpScore;</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;            MaxOpIdx2 = OpIdx2;</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;            FoundBest = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;          }</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;        }</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;        <span class="keywordflow">if</span> (FoundBest) {</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;          <span class="comment">// Pair {OpIdx1, MaxOpIdx2} was found to be best. Never revisit it.</span></div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;          Op2Used.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(MaxOpIdx2);</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;          ShallowScoreAtThisLevel += MaxTmpScore;</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;        }</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;      }</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;      <span class="keywordflow">return</span> ShallowScoreAtThisLevel;</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    }</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;  };<span class="comment"></span></div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;<span class="comment">  /// A helper data structure to hold the operands of a vector of instructions.</span></div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;<span class="comment">  /// This supports a fixed vector length for all operand vectors.</span></div>
<div class="line"><a name="l01484"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html"> 1484</a></span>&#160;<span class="comment"></span>  <span class="keyword">class </span><a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html">VLOperands</a> {<span class="comment"></span></div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;<span class="comment">    /// For each operand we need (i) the value, and (ii) the opcode that it</span></div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;<span class="comment">    /// would be attached to if the expression was in a left-linearized form.</span></div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;<span class="comment">    /// This is required to avoid illegal operand reordering.</span></div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;<span class="comment">    /// For example:</span></div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;<span class="comment">    /// \verbatim</span></div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;<span class="comment">    ///                         0 Op1</span></div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;<span class="comment">    ///                         |/</span></div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;<span class="comment">    /// Op1 Op2   Linearized    + Op2</span></div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;<span class="comment">    ///   \ /     ----------&gt;   |/</span></div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;<span class="comment">    ///    -                    -</span></div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;<span class="comment">    ///</span></div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;<span class="comment">    /// Op1 - Op2            (0 + Op1) - Op2</span></div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;<span class="comment">    /// \endverbatim</span></div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;<span class="comment">    ///</span></div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;<span class="comment">    /// Value Op1 is attached to a &#39;+&#39; operation, and Op2 to a &#39;-&#39;.</span></div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;<span class="comment">    ///</span></div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;<span class="comment">    /// Another way to think of this is to track all the operations across the</span></div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;<span class="comment">    /// path from the operand all the way to the root of the tree and to</span></div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;<span class="comment">    /// calculate the operation that corresponds to this path. For example, the</span></div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;<span class="comment">    /// path from Op2 to the root crosses the RHS of the &#39;-&#39;, therefore the</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="comment">    /// corresponding operation is a &#39;-&#39; (which matches the one in the</span></div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;<span class="comment">    /// linearized tree, as shown above).</span></div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="comment">    ///</span></div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="comment">    /// For lack of a better term, we refer to this operation as Accumulated</span></div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="comment">    /// Path Operation (APO).</span></div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;<span class="comment"></span>    <span class="keyword">struct </span>OperandData {</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;      OperandData() = <span class="keywordflow">default</span>;</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;      OperandData(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <span class="keywordtype">bool</span> APO, <span class="keywordtype">bool</span> IsUsed)</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;          : V(V), APO(APO), IsUsed(IsUsed) {}<span class="comment"></span></div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;<span class="comment">      /// The operand value.</span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;<span class="comment"></span>      <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <span class="keyword">nullptr</span>;<span class="comment"></span></div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;<span class="comment">      /// TreeEntries only allow a single opcode, or an alternate sequence of</span></div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;<span class="comment">      /// them (e.g, +, -). Therefore, we can safely use a boolean value for the</span></div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;<span class="comment">      /// APO. It is set to &#39;true&#39; if &#39;V&#39; is attached to an inverse operation</span></div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;<span class="comment">      /// in the left-linearized form (e.g., Sub/Div), and &#39;false&#39; otherwise</span></div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;<span class="comment">      /// (e.g., Add/Mul)</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;<span class="comment"></span>      <span class="keywordtype">bool</span> APO = <span class="keyword">false</span>;<span class="comment"></span></div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;<span class="comment">      /// Helper data for the reordering function.</span></div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;<span class="comment"></span>      <span class="keywordtype">bool</span> IsUsed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;    };</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;<span class="comment">    /// During operand reordering, we are trying to select the operand at lane</span></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;<span class="comment">    /// that matches best with the operand at the neighboring lane. Our</span></div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;<span class="comment">    /// selection is based on the type of value we are looking for. For example,</span></div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;<span class="comment">    /// if the neighboring lane has a load, we need to look for a load that is</span></div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;<span class="comment">    /// accessing a consecutive address. These strategies are summarized in the</span></div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;<span class="comment">    /// &#39;ReorderingMode&#39; enumerator.</span></div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;<span class="comment"></span>    <span class="keyword">enum class</span> ReorderingMode {</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;      <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a>,     <span class="comment">///&lt; Matching loads to consecutive memory addresses</span></div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;<span class="comment"></span>      Opcode,   <span class="comment">///&lt; Matching instructions based on opcode (same or alternate)</span></div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;<span class="comment"></span>      <a class="code" href="classllvm_1_1Constant.html">Constant</a>, <span class="comment">///&lt; Matching constants</span></div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;<span class="comment"></span>      Splat,    <span class="comment">///&lt; Matching the same instruction multiple times (broadcast)</span></div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;<span class="comment"></span>      <a class="code" href="namespacellvm.html#aeed8ef055d0b853fb0b4c07bf7c96206">Failed</a>,   <span class="comment">///&lt; We failed to create a vectorizable group</span></div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="comment"></span>    };</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160; </div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;    <span class="keyword">using</span> <a class="code" href="classllvm_1_1SmallVector.html">OperandDataVec</a> = <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;OperandData, 2&gt;</a>;</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;<span class="comment">    /// A vector of operand vectors.</span></div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;OperandDataVec, 4&gt;</a> OpsVec;</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160; </div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> &amp;TLI;</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>;</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;    <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE;</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> &amp;R;</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;<span class="comment">    /// \returns the operand data at \p OpIdx and \p Lane.</span></div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;<span class="comment"></span>    OperandData &amp;getData(<span class="keywordtype">unsigned</span> OpIdx, <span class="keywordtype">unsigned</span> Lane) {</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;      <span class="keywordflow">return</span> OpsVec[OpIdx][Lane];</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    }</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;<span class="comment">    /// \returns the operand data at \p OpIdx and \p Lane. Const version.</span></div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;<span class="comment"></span>    <span class="keyword">const</span> OperandData &amp;getData(<span class="keywordtype">unsigned</span> OpIdx, <span class="keywordtype">unsigned</span> Lane)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;      <span class="keywordflow">return</span> OpsVec[OpIdx][Lane];</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    }</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;<span class="comment">    /// Clears the used flag for all entries.</span></div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> clearUsed() {</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> OpIdx = 0, NumOperands = getNumOperands();</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;           OpIdx != NumOperands; ++OpIdx)</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Lane = 0, NumLanes = getNumLanes(); Lane != NumLanes;</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;             ++Lane)</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;          OpsVec[OpIdx][Lane].IsUsed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;    }</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;<span class="comment">    /// Swap the operand at \p OpIdx1 with that one at \p OpIdx2.</span></div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">swap</a>(<span class="keywordtype">unsigned</span> OpIdx1, <span class="keywordtype">unsigned</span> OpIdx2, <span class="keywordtype">unsigned</span> Lane) {</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;      <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(OpsVec[OpIdx1][Lane], OpsVec[OpIdx2][Lane]);</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    }</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;<span class="comment">    /// \param Lane lane of the operands under analysis.</span></div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;<span class="comment">    /// \param OpIdx operand index in \p Lane lane we&#39;re looking the best</span></div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;<span class="comment">    /// candidate for.</span></div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;<span class="comment">    /// \param Idx operand index of the current candidate value.</span></div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;<span class="comment">    /// \returns The additional score due to possible broadcasting of the</span></div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;<span class="comment">    /// elements in the lane. It is more profitable to have power-of-2 unique</span></div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;<span class="comment">    /// elements in the lane, it will be vectorized with higher probability</span></div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;<span class="comment">    /// after removing duplicates. Currently the SLP vectorizer supports only</span></div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;<span class="comment">    /// vectorization of the power-of-2 number of unique scalars.</span></div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;<span class="comment"></span>    <span class="keywordtype">int</span> getSplatScore(<span class="keywordtype">unsigned</span> Lane, <span class="keywordtype">unsigned</span> OpIdx, <span class="keywordtype">unsigned</span> Idx)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *IdxLaneV = getData(Idx, Lane).V;</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;      <span class="keywordflow">if</span> (!isa&lt;Instruction&gt;(IdxLaneV) || IdxLaneV == getData(OpIdx, Lane).V)</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;      <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value *, 4&gt;</a> Uniques;</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Ln = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = getNumLanes(); Ln &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++Ln) {</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;        <span class="keywordflow">if</span> (Ln == Lane)</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *OpIdxLnV = getData(OpIdx, Ln).V;</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;        <span class="keywordflow">if</span> (!isa&lt;Instruction&gt;(OpIdxLnV))</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;          <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;        Uniques.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(OpIdxLnV);</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;      }</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;      <span class="keywordtype">int</span> UniquesCount = Uniques.<a class="code" href="classllvm_1_1SmallPtrSetImplBase.html#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>();</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;      <span class="keywordtype">int</span> UniquesCntWithIdxLaneV =</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;          Uniques.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#af74676a3c7447be34bd2c1da76ec0c48">contains</a>(IdxLaneV) ? UniquesCount : UniquesCount + 1;</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *OpIdxLaneV = getData(OpIdx, Lane).V;</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;      <span class="keywordtype">int</span> UniquesCntWithOpIdxLaneV =</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;          Uniques.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#af74676a3c7447be34bd2c1da76ec0c48">contains</a>(OpIdxLaneV) ? UniquesCount : UniquesCount + 1;</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;      <span class="keywordflow">if</span> (UniquesCntWithIdxLaneV == UniquesCntWithOpIdxLaneV)</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;      <span class="keywordflow">return</span> (<a class="code" href="namespacellvm.html#a5542d44947f8d964b5ce3b20ea719b44">PowerOf2Ceil</a>(UniquesCntWithOpIdxLaneV) -</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;              UniquesCntWithOpIdxLaneV) -</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;             (<a class="code" href="namespacellvm.html#a5542d44947f8d964b5ce3b20ea719b44">PowerOf2Ceil</a>(UniquesCntWithIdxLaneV) - UniquesCntWithIdxLaneV);</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    }</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;<span class="comment">    /// \param Lane lane of the operands under analysis.</span></div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;<span class="comment">    /// \param OpIdx operand index in \p Lane lane we&#39;re looking the best</span></div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;<span class="comment">    /// candidate for.</span></div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;<span class="comment">    /// \param Idx operand index of the current candidate value.</span></div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;<span class="comment">    /// \returns The additional score for the scalar which users are all</span></div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;<span class="comment">    /// vectorized.</span></div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;<span class="comment"></span>    <span class="keywordtype">int</span> getExternalUseScore(<span class="keywordtype">unsigned</span> Lane, <span class="keywordtype">unsigned</span> OpIdx, <span class="keywordtype">unsigned</span> Idx)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *IdxLaneV = getData(Idx, Lane).V;</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *OpIdxLaneV = getData(OpIdx, Lane).V;</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;      <span class="comment">// Do not care about number of uses for vector-like instructions</span></div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;      <span class="comment">// (extractelement/extractvalue with constant indices), they are extracts</span></div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;      <span class="comment">// themselves and already externally used. Vectorization of such</span></div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;      <span class="comment">// instructions does not add extra extractelement instruction, just may</span></div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;      <span class="comment">// remove it.</span></div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#a06a9edb69d0ed6fda201d59948acfd89">isVectorLikeInstWithConstOps</a>(IdxLaneV) &amp;&amp;</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;          <a class="code" href="SLPVectorizer_8cpp.html#a06a9edb69d0ed6fda201d59948acfd89">isVectorLikeInstWithConstOps</a>(OpIdxLaneV))</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;        <span class="keywordflow">return</span> LookAheadHeuristics::ScoreAllUserVectorized;</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;      <span class="keyword">auto</span> *IdxLaneI = dyn_cast&lt;Instruction&gt;(IdxLaneV);</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;      <span class="keywordflow">if</span> (!IdxLaneI || !isa&lt;Instruction&gt;(OpIdxLaneV))</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;      <span class="keywordflow">return</span> R.areAllUsersVectorized(IdxLaneI, std::nullopt)</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;                 ? LookAheadHeuristics::ScoreAllUserVectorized</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;                 : 0;</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    }</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;<span class="comment">    /// Score scaling factor for fully compatible instructions but with</span></div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;<span class="comment">    /// different number of external uses. Allows better selection of the</span></div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;<span class="comment">    /// instructions with less external uses.</span></div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;<span class="comment"></span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> ScoreScaleFactor = 10;</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;<span class="comment">    /// \Returns the look-ahead score, which tells us how much the sub-trees</span></div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;<span class="comment">    /// rooted at \p LHS and \p RHS match, the more they match the higher the</span></div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;<span class="comment">    /// score. This helps break ties in an informed way when we cannot decide on</span></div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;<span class="comment">    /// the order of the operands by just considering the immediate</span></div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;<span class="comment">    /// predecessors.</span></div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;<span class="comment"></span>    <span class="keywordtype">int</span> getLookAheadScore(<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> MainAltOps,</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;                          <span class="keywordtype">int</span> Lane, <span class="keywordtype">unsigned</span> OpIdx, <span class="keywordtype">unsigned</span> Idx,</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;                          <span class="keywordtype">bool</span> &amp;IsUsed) {</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;      <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html">LookAheadHeuristics</a> LookAhead(TLI, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, SE, R, getNumLanes(),</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;                                    <a class="code" href="SLPVectorizer_8cpp.html#ab7c8670d4d4589e06bedd21c48405060">LookAheadMaxDepth</a>);</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;      <span class="comment">// Keep track of the instruction stack as we recurse into the operands</span></div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;      <span class="comment">// during the look-ahead score exploration.</span></div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;      <span class="keywordtype">int</span> Score =</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;          LookAhead.<a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html#a54d9af6b4c656c782e017020406e8291">getScoreAtLevelRec</a>(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, <span class="comment">/*U1=*/</span><span class="keyword">nullptr</span>, <span class="comment">/*U2=*/</span><span class="keyword">nullptr</span>,</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;                                       <span class="comment">/*CurrLevel=*/</span>1, MainAltOps);</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;      <span class="keywordflow">if</span> (Score) {</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;        <span class="keywordtype">int</span> SplatScore = getSplatScore(Lane, OpIdx, Idx);</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;        <span class="keywordflow">if</span> (Score &lt;= -SplatScore) {</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;          <span class="comment">// Set the minimum score for splat-like sequence to avoid setting</span></div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;          <span class="comment">// failed state.</span></div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;          Score = 1;</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;          Score += SplatScore;</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;          <span class="comment">// Scale score to see the difference between different operands</span></div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;          <span class="comment">// and similar operands but all vectorized/not all vectorized</span></div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;          <span class="comment">// uses. It does not affect actual selection of the best</span></div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;          <span class="comment">// compatible operand in general, just allows to select the</span></div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;          <span class="comment">// operand with all vectorized uses.</span></div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;          Score *= ScoreScaleFactor;</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;          Score += getExternalUseScore(Lane, OpIdx, Idx);</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;          IsUsed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;        }</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;      }</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;      <span class="keywordflow">return</span> Score;</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    }</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;<span class="comment">    /// Best defined scores per lanes between the passes. Used to choose the</span></div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;<span class="comment">    /// best operand (with the highest score) between the passes.</span></div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;<span class="comment">    /// The key - {Operand Index, Lane}.</span></div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;<span class="comment">    /// The value - the best score between the passes for the lane and the</span></div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;<span class="comment">    /// operand.</span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;std::pair&lt;unsigned, unsigned&gt;</a>, <a class="code" href="ADT_2tmp_8txt.html#aa10ee7493bddf2c751ca6e05451ef410">unsigned</a>, 8&gt;</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;        BestScoresPerLanes;</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160; </div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;    <span class="comment">// Search all operands in Ops[*][Lane] for the one that matches best</span></div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;    <span class="comment">// Ops[OpIdx][LastLane] and return its opreand index.</span></div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;    <span class="comment">// If no good match can be found, return std::nullopt.</span></div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;    std::optional&lt;unsigned&gt; getBestOperand(<span class="keywordtype">unsigned</span> OpIdx, <span class="keywordtype">int</span> Lane, <span class="keywordtype">int</span> LastLane,</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;                                      <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;ReorderingMode&gt;</a> ReorderingModes,</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;                                      <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> MainAltOps) {</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;      <span class="keywordtype">unsigned</span> NumOperands = getNumOperands();</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160; </div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;      <span class="comment">// The operand of the previous lane at OpIdx.</span></div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *OpLastLane = getData(OpIdx, LastLane).V;</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160; </div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;      <span class="comment">// Our strategy mode for OpIdx.</span></div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;      ReorderingMode RMode = ReorderingModes[OpIdx];</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;      <span class="keywordflow">if</span> (RMode == <a class="code" href="namespacellvm.html#aeed8ef055d0b853fb0b4c07bf7c96206">ReorderingMode::Failed</a>)</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;        <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160; </div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;      <span class="comment">// The linearized opcode of the operand at OpIdx, Lane.</span></div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;      <span class="keywordtype">bool</span> OpIdxAPO = getData(OpIdx, Lane).APO;</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160; </div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;      <span class="comment">// The best operand index and its score.</span></div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;      <span class="comment">// Sometimes we have more than one option (e.g., Opcode and Undefs), so we</span></div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;      <span class="comment">// are using the score to differentiate between the two.</span></div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;      <span class="keyword">struct </span>BestOpData {</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;        std::optional&lt;unsigned&gt; Idx;</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;        <span class="keywordtype">unsigned</span> Score = 0;</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;      } BestOp;</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;      BestOp.Score =</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;          BestScoresPerLanes.<a class="code" href="classllvm_1_1DenseMapBase.html#a98c685a0c53f3f7ed5f4793890a6c850">try_emplace</a>(std::make_pair(OpIdx, Lane), 0)</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;              .first-&gt;second;</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160; </div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;      <span class="comment">// Track if the operand must be marked as used. If the operand is set to</span></div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;      <span class="comment">// Score 1 explicitly (because of non power-of-2 unique scalars, we may</span></div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;      <span class="comment">// want to reestimate the operands again on the following iterations).</span></div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;      <span class="keywordtype">bool</span> IsUsed =</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;          RMode == ReorderingMode::Splat || RMode == <a class="code" href="namespacellvm_1_1ISD.html#a22ea9cec080dd5f4f47ba234c2f59110aac2f0a84dd2aa5ee4c3f1385e9565f5e">ReorderingMode::Constant</a>;</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;      <span class="comment">// Iterate through all unused operands and look for the best.</span></div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Idx = 0; Idx != NumOperands; ++Idx) {</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;        <span class="comment">// Get the operand at Idx and Lane.</span></div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;        OperandData &amp;OpData = getData(Idx, Lane);</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = OpData.V;</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;        <span class="keywordtype">bool</span> OpAPO = OpData.APO;</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160; </div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;        <span class="comment">// Skip already selected operands.</span></div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;        <span class="keywordflow">if</span> (OpData.IsUsed)</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160; </div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;        <span class="comment">// Skip if we are trying to move the operand to a position with a</span></div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;        <span class="comment">// different opcode in the linearized tree form. This would break the</span></div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;        <span class="comment">// semantics.</span></div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;        <span class="keywordflow">if</span> (OpAPO != OpIdxAPO)</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160; </div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;        <span class="comment">// Look for an operand that matches the current mode.</span></div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;        <span class="keywordflow">switch</span> (RMode) {</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">ReorderingMode::Load</a>:</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1ISD.html#a22ea9cec080dd5f4f47ba234c2f59110aac2f0a84dd2aa5ee4c3f1385e9565f5e">ReorderingMode::Constant</a>:</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;        <span class="keywordflow">case</span> ReorderingMode::Opcode: {</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;          <span class="keywordtype">bool</span> LeftToRight = Lane &gt; LastLane;</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *OpLeft = (LeftToRight) ? OpLastLane : <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>;</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *OpRight = (LeftToRight) ? <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> : OpLastLane;</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;          <span class="keywordtype">int</span> Score = getLookAheadScore(OpLeft, OpRight, MainAltOps, Lane,</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;                                        OpIdx, Idx, IsUsed);</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;          <span class="keywordflow">if</span> (Score &gt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(BestOp.Score)) {</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;            BestOp.Idx = Idx;</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;            BestOp.Score = Score;</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;            BestScoresPerLanes[std::make_pair(OpIdx, Lane)] = Score;</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;          }</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;        }</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;        <span class="keywordflow">case</span> ReorderingMode::Splat:</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> == OpLastLane)</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;            BestOp.Idx = Idx;</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aeed8ef055d0b853fb0b4c07bf7c96206">ReorderingMode::Failed</a>:</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;          <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Not expected Failed reordering mode.&quot;</span>);</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;        }</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;      }</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160; </div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;      <span class="keywordflow">if</span> (BestOp.Idx) {</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;        getData(*BestOp.Idx, Lane).IsUsed = IsUsed;</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;        <span class="keywordflow">return</span> BestOp.Idx;</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;      }</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;      <span class="comment">// If we could not find a good match return std::nullopt.</span></div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;      <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    }</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;<span class="comment">    /// Helper for reorderOperandVecs.</span></div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;<span class="comment">    /// \returns the lane that we should start reordering from. This is the one</span></div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;<span class="comment">    /// which has the least number of operands that can freely move about or</span></div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;<span class="comment">    /// less profitable because it already has the most optimal set of operands.</span></div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> getBestLaneToStartReordering()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;      <span class="keywordtype">unsigned</span> Min = UINT_MAX;</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;      <span class="keywordtype">unsigned</span> SameOpNumber = 0;</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;      <span class="comment">// std::pair&lt;unsigned, unsigned&gt; is used to implement a simple voting</span></div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;      <span class="comment">// algorithm and choose the lane with the least number of operands that</span></div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;      <span class="comment">// can freely move about or less profitable because it already has the</span></div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;      <span class="comment">// most optimal set of operands. The first unsigned is a counter for</span></div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;      <span class="comment">// voting, the second unsigned is the counter of lanes with instructions</span></div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;      <span class="comment">// with same/alternate opcodes and same parent basic block.</span></div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;      <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;unsigned, std::pair&lt;unsigned, unsigned&gt;</a>&gt; HashMap;</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;      <span class="comment">// Try to be closer to the original results, if we have multiple lanes</span></div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;      <span class="comment">// with same cost. If 2 lanes have the same cost, use the one with the</span></div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;      <span class="comment">// lowest index.</span></div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = getNumLanes(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &gt; 0; --<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;        <span class="keywordtype">unsigned</span> Lane = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> - 1;</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;        OperandsOrderData NumFreeOpsHash =</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;            getMaxNumOperandsThatCanBeReordered(Lane);</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;        <span class="comment">// Compare the number of operands that can move and choose the one with</span></div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;        <span class="comment">// the least number.</span></div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;        <span class="keywordflow">if</span> (NumFreeOpsHash.NumOfAPOs &lt; Min) {</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;          Min = NumFreeOpsHash.NumOfAPOs;</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;          SameOpNumber = NumFreeOpsHash.NumOpsWithSameOpcodeParent;</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;          HashMap.<a class="code" href="classllvm_1_1MapVector.html#ae091b147039557cf8ce505740e7ff7ac">clear</a>();</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;          HashMap[NumFreeOpsHash.Hash] = std::make_pair(1, Lane);</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NumFreeOpsHash.NumOfAPOs == Min &amp;&amp;</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;                   NumFreeOpsHash.NumOpsWithSameOpcodeParent &lt; SameOpNumber) {</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;          <span class="comment">// Select the most optimal lane in terms of number of operands that</span></div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;          <span class="comment">// should be moved around.</span></div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;          SameOpNumber = NumFreeOpsHash.NumOpsWithSameOpcodeParent;</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;          HashMap[NumFreeOpsHash.Hash] = std::make_pair(1, Lane);</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NumFreeOpsHash.NumOfAPOs == Min &amp;&amp;</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;                   NumFreeOpsHash.NumOpsWithSameOpcodeParent == SameOpNumber) {</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;          <span class="keyword">auto</span> It = HashMap.<a class="code" href="classllvm_1_1MapVector.html#a6b0c3e15c351ba9682837c29b0a141b6">find</a>(NumFreeOpsHash.Hash);</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;          <span class="keywordflow">if</span> (It == HashMap.<a class="code" href="classllvm_1_1MapVector.html#a0881334358ff6ff7ff8cea5562c7988e">end</a>())</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;            HashMap[NumFreeOpsHash.Hash] = std::make_pair(1, Lane);</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;            ++It-&gt;second.first;</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;        }</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;      }</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;      <span class="comment">// Select the lane with the minimum counter.</span></div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;      <span class="keywordtype">unsigned</span> BestLane = 0;</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;      <span class="keywordtype">unsigned</span> CntMin = UINT_MAX;</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a> : <a class="code" href="namespacellvm.html#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(HashMap)) {</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.second.first &lt; CntMin) {</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;          CntMin = <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.second.first;</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;          BestLane = <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.second.second;</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;        }</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;      }</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;      <span class="keywordflow">return</span> BestLane;</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;    }</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;<span class="comment">    /// Data structure that helps to reorder operands.</span></div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;<span class="comment"></span>    <span class="keyword">struct </span>OperandsOrderData {<span class="comment"></span></div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;<span class="comment">      /// The best number of operands with the same APOs, which can be</span></div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;<span class="comment">      /// reordered.</span></div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;<span class="comment"></span>      <span class="keywordtype">unsigned</span> NumOfAPOs = UINT_MAX;<span class="comment"></span></div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;<span class="comment">      /// Number of operands with the same/alternate instruction opcode and</span></div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;<span class="comment">      /// parent.</span></div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;<span class="comment"></span>      <span class="keywordtype">unsigned</span> NumOpsWithSameOpcodeParent = 0;<span class="comment"></span></div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;<span class="comment">      /// Hash for the actual operands ordering.</span></div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;<span class="comment">      /// Used to count operands, actually their position id and opcode</span></div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;<span class="comment">      /// value. It is used in the voting mechanism to find the lane with the</span></div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;<span class="comment">      /// least number of operands that can freely move about or less profitable</span></div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;<span class="comment">      /// because it already has the most optimal set of operands. Can be</span></div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;<span class="comment">      /// replaced with SmallVector&lt;unsigned&gt; instead but hash code is faster</span></div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;<span class="comment">      /// and requires less memory.</span></div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;<span class="comment"></span>      <span class="keywordtype">unsigned</span> Hash = 0;</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;    };<span class="comment"></span></div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;<span class="comment">    /// \returns the maximum number of operands that are allowed to be reordered</span></div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;<span class="comment">    /// for \p Lane and the number of compatible instructions(with the same</span></div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;<span class="comment">    /// parent/opcode). This is used as a heuristic for selecting the first lane</span></div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;<span class="comment">    /// to start operand reordering.</span></div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;<span class="comment"></span>    OperandsOrderData getMaxNumOperandsThatCanBeReordered(<span class="keywordtype">unsigned</span> Lane)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;      <span class="keywordtype">unsigned</span> CntTrue = 0;</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;      <span class="keywordtype">unsigned</span> NumOperands = getNumOperands();</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;      <span class="comment">// Operands with the same APO can be reordered. We therefore need to count</span></div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;      <span class="comment">// how many of them we have for each APO, like this: Cnt[APO] = x.</span></div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;      <span class="comment">// Since we only have two APOs, namely true and false, we can avoid using</span></div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;      <span class="comment">// a map. Instead we can simply count the number of operands that</span></div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;      <span class="comment">// correspond to one of them (in this case the &#39;true&#39; APO), and calculate</span></div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;      <span class="comment">// the other by subtracting it from the total number of operands.</span></div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;      <span class="comment">// Operands with the same instruction opcode and parent are more</span></div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;      <span class="comment">// profitable since we don&#39;t need to move them in many cases, with a high</span></div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;      <span class="comment">// probability such lane already can be vectorized effectively.</span></div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;      <span class="keywordtype">bool</span> AllUndefs = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;      <span class="keywordtype">unsigned</span> NumOpsWithSameOpcodeParent = 0;</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *OpcodeI = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Parent = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;      <span class="keywordtype">unsigned</span> Hash = 0;</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> OpIdx = 0; OpIdx != NumOperands; ++OpIdx) {</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;        <span class="keyword">const</span> OperandData &amp;OpData = getData(OpIdx, Lane);</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;        <span class="keywordflow">if</span> (OpData.APO)</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;          ++CntTrue;</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;        <span class="comment">// Use Boyer-Moore majority voting for finding the majority opcode and</span></div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;        <span class="comment">// the number of times it occurs.</span></div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(OpData.V)) {</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;          <span class="keywordflow">if</span> (!OpcodeI || !<a class="code" href="SLPVectorizer_8cpp.html#ae37b3a41d982a793664ab021d9b9b325">getSameOpcode</a>({OpcodeI, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>}, TLI).<a class="code" href="VPlanSLP_8cpp.html#af04704e906a9654777e92a4612c58c13">getOpcode</a>() ||</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;              <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() != Parent) {</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;            <span class="keywordflow">if</span> (NumOpsWithSameOpcodeParent == 0) {</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;              NumOpsWithSameOpcodeParent = 1;</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;              OpcodeI = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;              Parent = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;              --NumOpsWithSameOpcodeParent;</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;            }</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;            ++NumOpsWithSameOpcodeParent;</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;          }</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;        }</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;        Hash = <a class="code" href="namespacellvm.html#add71474638430694c84640146383fc44">hash_combine</a>(</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;            Hash, <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>((OpIdx + 1) * (OpData.V-&gt;getValueID() + 1)));</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;        AllUndefs = AllUndefs &amp;&amp; isa&lt;UndefValue&gt;(OpData.V);</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;      }</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;      <span class="keywordflow">if</span> (AllUndefs)</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;        <span class="keywordflow">return</span> {};</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;      OperandsOrderData <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>;</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;      <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.NumOfAPOs = <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(CntTrue, NumOperands - CntTrue);</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;      <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.NumOpsWithSameOpcodeParent = NumOpsWithSameOpcodeParent;</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;      <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.Hash = Hash;</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>;</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;    }</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;<span class="comment">    /// Go through the instructions in VL and append their operands.</span></div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> appendOperandsOfVL(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL) {</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!VL.<a class="code" href="classllvm_1_1ArrayRef.html#ac835b8735b1b2faec0efdca236e37d94">empty</a>() &amp;&amp; <span class="stringliteral">&quot;Bad VL&quot;</span>);</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((empty() || VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() == getNumLanes()) &amp;&amp;</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;             <span class="stringliteral">&quot;Expected same number of lanes&quot;</span>);</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isa&lt;Instruction&gt;(VL[0]) &amp;&amp; <span class="stringliteral">&quot;Expected instruction&quot;</span>);</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;      <span class="keywordtype">unsigned</span> NumOperands = cast&lt;Instruction&gt;(VL[0])-&gt;getNumOperands();</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;      OpsVec.<a class="code" href="classllvm_1_1SmallVectorImpl.html#ad0b3d8447f88377b62d9c019f3c4e118">resize</a>(NumOperands);</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;      <span class="keywordtype">unsigned</span> NumLanes = VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>();</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> OpIdx = 0; OpIdx != NumOperands; ++OpIdx) {</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;        OpsVec[OpIdx].<a class="code" href="classllvm_1_1SmallVectorImpl.html#ad0b3d8447f88377b62d9c019f3c4e118">resize</a>(NumLanes);</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Lane = 0; Lane != NumLanes; ++Lane) {</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isa&lt;Instruction&gt;(VL[Lane]) &amp;&amp; <span class="stringliteral">&quot;Expected instruction&quot;</span>);</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;          <span class="comment">// Our tree has just 3 nodes: the root and two operands.</span></div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;          <span class="comment">// It is therefore trivial to get the APO. We only need to check the</span></div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;          <span class="comment">// opcode of VL[Lane] and whether the operand at OpIdx is the LHS or</span></div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;          <span class="comment">// RHS operand. The LHS operand of both add and sub is never attached</span></div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;          <span class="comment">// to an inversese operation in the linearized form, therefore its APO</span></div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;          <span class="comment">// is false. The RHS is true only if VL[Lane] is an inverse operation.</span></div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160; </div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;          <span class="comment">// Since operand reordering is performed on groups of commutative</span></div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;          <span class="comment">// operations or alternating sequences (e.g., +, -), we can safely</span></div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;          <span class="comment">// tell the inverse operations by checking commutativity.</span></div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;          <span class="keywordtype">bool</span> IsInverseOperation = !<a class="code" href="SLPVectorizer_8cpp.html#ab0da56db6da27340e5a7151a4676106a">isCommutative</a>(cast&lt;Instruction&gt;(VL[Lane]));</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;          <span class="keywordtype">bool</span> APO = (OpIdx == 0) ? <span class="keyword">false</span> : IsInverseOperation;</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;          OpsVec[OpIdx][Lane] = {cast&lt;Instruction&gt;(VL[Lane])-&gt;getOperand(OpIdx),</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;                                 APO, <span class="keyword">false</span>};</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;        }</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;      }</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;    }</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;<span class="comment">    /// \returns the number of operands.</span></div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> getNumOperands()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> OpsVec.size(); }</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;<span class="comment">    /// \returns the number of lanes.</span></div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> getNumLanes()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> OpsVec[0].size(); }</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;<span class="comment">    /// \returns the operand value at \p OpIdx and \p Lane.</span></div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1Value.html">Value</a> *getValue(<span class="keywordtype">unsigned</span> OpIdx, <span class="keywordtype">unsigned</span> Lane)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;      <span class="keywordflow">return</span> getData(OpIdx, Lane).V;</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;    }</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;<span class="comment">    /// \returns true if the data structure is empty.</span></div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span> empty()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> OpsVec.empty(); }</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;<span class="comment">    /// Clears the data.</span></div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> <a class="code" href="Coroutines_8cpp.html#ac781ce96aa25ba7f6fd38f72de665450">clear</a>() { OpsVec.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>(); }</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;<span class="comment">    /// \Returns true if there are enough operands identical to \p Op to fill</span></div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;<span class="comment">    /// the whole vector.</span></div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;<span class="comment">    /// Note: This modifies the &#39;IsUsed&#39; flag, so a cleanUsed() must follow.</span></div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span> shouldBroadcast(<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>, <span class="keywordtype">unsigned</span> OpIdx, <span class="keywordtype">unsigned</span> Lane) {</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;      <span class="keywordtype">bool</span> OpAPO = getData(OpIdx, Lane).APO;</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Ln = 0, Lns = getNumLanes(); Ln != Lns; ++Ln) {</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;        <span class="keywordflow">if</span> (Ln == Lane)</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;        <span class="comment">// This is set to true if we found a candidate for broadcast at Lane.</span></div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;        <span class="keywordtype">bool</span> FoundCandidate = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> OpI = 0, OpE = getNumOperands(); OpI != OpE; ++OpI) {</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;          OperandData &amp;<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a> = getData(OpI, Ln);</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.APO != OpAPO || <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.IsUsed)</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.V == <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>) {</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;            FoundCandidate = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;            <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.IsUsed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;          }</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;        }</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;        <span class="keywordflow">if</span> (!FoundCandidate)</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;      }</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;    }</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160; </div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;  <span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;<span class="comment">    /// Initialize with all the operands of the instruction vector \p RootVL.</span></div>
<div class="line"><a name="l01971"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#a2f8993663388ca686412e1b22b2743de"> 1971</a></span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#a2f8993663388ca686412e1b22b2743de">VLOperands</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> RootVL, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> &amp;TLI,</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;               <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE, <span class="keyword">const</span> <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> &amp;R)</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;        : TLI(TLI), <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>), SE(SE), R(R) {</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;      <span class="comment">// Append all the operands of RootVL.</span></div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;      appendOperandsOfVL(RootVL);</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;    }</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;<span class="comment">    /// \Returns a value vector with the operands across all lanes for the</span></div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;<span class="comment">    /// opearnd at \p OpIdx.</span></div>
<div class="line"><a name="l01980"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#a017e1ed67d6b197edc2e79bb8bbdd769"> 1980</a></span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1SmallVector.html">ValueList</a> <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#a017e1ed67d6b197edc2e79bb8bbdd769">getVL</a>(<span class="keywordtype">unsigned</span> OpIdx)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">ValueList</a> OpVL(OpsVec[OpIdx].<a class="code" href="namespacellvm.html#a10f3d955592ae2bc745f57e5b48ae115">size</a>());</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OpsVec[OpIdx].<a class="code" href="namespacellvm.html#a10f3d955592ae2bc745f57e5b48ae115">size</a>() == getNumLanes() &amp;&amp;</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;             <span class="stringliteral">&quot;Expected same num of lanes across all operands&quot;</span>);</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Lane = 0, Lanes = getNumLanes(); Lane != Lanes; ++Lane)</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;        OpVL[Lane] = OpsVec[OpIdx][Lane].V;</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;      <span class="keywordflow">return</span> OpVL;</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;    }</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160; </div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;    <span class="comment">// Performs operand reordering for 2 or more operands.</span></div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;    <span class="comment">// The original operands are in OrigOps[OpIdx][Lane].</span></div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;    <span class="comment">// The reordered operands are returned in &#39;SortedOps[OpIdx][Lane]&#39;.</span></div>
<div class="line"><a name="l01992"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#ab3635230226f6d60dad04b8e83d848fd"> 1992</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#ab3635230226f6d60dad04b8e83d848fd">reorder</a>() {</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;      <span class="keywordtype">unsigned</span> NumOperands = getNumOperands();</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;      <span class="keywordtype">unsigned</span> NumLanes = getNumLanes();</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;      <span class="comment">// Each operand has its own mode. We are using this mode to help us select</span></div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;      <span class="comment">// the instructions for each lane, so that they match best with the ones</span></div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;      <span class="comment">// we have selected so far.</span></div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;ReorderingMode, 2&gt;</a> ReorderingModes(NumOperands);</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160; </div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;      <span class="comment">// This is a greedy single-pass algorithm. We are going over each lane</span></div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;      <span class="comment">// once and deciding on the best order right away with no back-tracking.</span></div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;      <span class="comment">// However, in order to increase its effectiveness, we start with the lane</span></div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;      <span class="comment">// that has operands that can move the least. For example, given the</span></div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;      <span class="comment">// following lanes:</span></div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;      <span class="comment">//  Lane 0 : A[0] = B[0] + C[0]   // Visited 3rd</span></div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;      <span class="comment">//  Lane 1 : A[1] = C[1] - B[1]   // Visited 1st</span></div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;      <span class="comment">//  Lane 2 : A[2] = B[2] + C[2]   // Visited 2nd</span></div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;      <span class="comment">//  Lane 3 : A[3] = C[3] - B[3]   // Visited 4th</span></div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;      <span class="comment">// we will start at Lane 1, since the operands of the subtraction cannot</span></div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;      <span class="comment">// be reordered. Then we will visit the rest of the lanes in a circular</span></div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;      <span class="comment">// fashion. That is, Lanes 2, then Lane 0, and finally Lane 3.</span></div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160; </div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;      <span class="comment">// Find the first lane that we will start our search from.</span></div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;      <span class="keywordtype">unsigned</span> FirstLane = getBestLaneToStartReordering();</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160; </div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;      <span class="comment">// Initialize the modes.</span></div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> OpIdx = 0; OpIdx != NumOperands; ++OpIdx) {</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *OpLane0 = getValue(OpIdx, FirstLane);</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;        <span class="comment">// Keep track if we have instructions with all the same opcode on one</span></div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;        <span class="comment">// side.</span></div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;        <span class="keywordflow">if</span> (isa&lt;LoadInst&gt;(OpLane0))</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;          ReorderingModes[OpIdx] = <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">ReorderingMode::Load</a>;</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;Instruction&gt;(OpLane0)) {</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;          <span class="comment">// Check if OpLane0 should be broadcast.</span></div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;          <span class="keywordflow">if</span> (shouldBroadcast(OpLane0, OpIdx, FirstLane))</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;            ReorderingModes[OpIdx] = ReorderingMode::Splat;</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;            ReorderingModes[OpIdx] = ReorderingMode::Opcode;</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;        }</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;Constant&gt;(OpLane0))</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;          ReorderingModes[OpIdx] = <a class="code" href="namespacellvm_1_1ISD.html#a22ea9cec080dd5f4f47ba234c2f59110aac2f0a84dd2aa5ee4c3f1385e9565f5e">ReorderingMode::Constant</a>;</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;Argument&gt;(OpLane0))</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;          <span class="comment">// Our best hope is a Splat. It may save some cost in some cases.</span></div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;          ReorderingModes[OpIdx] = ReorderingMode::Splat;</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;          <span class="comment">// NOTE: This should be unreachable.</span></div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;          ReorderingModes[OpIdx] = <a class="code" href="namespacellvm.html#aeed8ef055d0b853fb0b4c07bf7c96206">ReorderingMode::Failed</a>;</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;      }</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160; </div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;      <span class="comment">// Check that we don&#39;t have same operands. No need to reorder if operands</span></div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;      <span class="comment">// are just perfect diamond or shuffled diamond match. Do not do it only</span></div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;      <span class="comment">// for possible broadcasts or non-power of 2 number of scalars (just for</span></div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;      <span class="comment">// now).</span></div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;      <span class="keyword">auto</span> &amp;&amp;SkipReordering = [<span class="keyword">this</span>]() {</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;        <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value *, 4&gt;</a> UniqueValues;</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;        <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;OperandData&gt;</a> Op0 = OpsVec.front();</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> OperandData &amp;<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a> : Op0)</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;          UniqueValues.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.V);</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;OperandData&gt;</a> <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> : <a class="code" href="namespacellvm.html#a02981de53fb6ffd384d39addc4d25f37">drop_begin</a>(OpsVec, 1)) {</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>, [&amp;UniqueValues](<span class="keyword">const</span> OperandData &amp;<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>) {</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;                <span class="keywordflow">return</span> !UniqueValues.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#af74676a3c7447be34bd2c1da76ec0c48">contains</a>(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.V);</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;              }))</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;        }</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;        <span class="comment">// TODO: Check if we can remove a check for non-power-2 number of</span></div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;        <span class="comment">// scalars after full support of non-power-2 vectorization.</span></div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;        <span class="keywordflow">return</span> UniqueValues.<a class="code" href="classllvm_1_1SmallPtrSetImplBase.html#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>() != 2 &amp;&amp; <a class="code" href="namespacellvm.html#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2_32</a>(UniqueValues.<a class="code" href="classllvm_1_1SmallPtrSetImplBase.html#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>());</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;      };</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160; </div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;      <span class="comment">// If the initial strategy fails for any of the operand indexes, then we</span></div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;      <span class="comment">// perform reordering again in a second pass. This helps avoid assigning</span></div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;      <span class="comment">// high priority to the failed strategy, and should improve reordering for</span></div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;      <span class="comment">// the non-failed operand indexes.</span></div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="classllvm_1_1Pass.html">Pass</a> = 0; <a class="code" href="classllvm_1_1Pass.html">Pass</a> != 2; ++<a class="code" href="LazyValueInfo_8cpp.html#a739511554e31b02d233401957fd86f44">Pass</a>) {</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;        <span class="comment">// Check if no need to reorder operands since they&#39;re are perfect or</span></div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;        <span class="comment">// shuffled diamond match.</span></div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;        <span class="comment">// Need to to do it to avoid extra external use cost counting for</span></div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;        <span class="comment">// shuffled matches, which may cause regressions.</span></div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;        <span class="keywordflow">if</span> (SkipReordering())</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;        <span class="comment">// Skip the second pass if the first pass did not fail.</span></div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;        <span class="keywordtype">bool</span> StrategyFailed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;        <span class="comment">// Mark all operand data as free to use.</span></div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;        clearUsed();</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;        <span class="comment">// We keep the original operand order for the FirstLane, so reorder the</span></div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;        <span class="comment">// rest of the lanes. We are visiting the nodes in a circular fashion,</span></div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;        <span class="comment">// using FirstLane as the center point and increasing the radius</span></div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;        <span class="comment">// distance.</span></div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;        <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;SmallVector&lt;Value *, 2&gt;</a>&gt; MainAltOps(NumOperands);</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumOperands; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;          MainAltOps[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].push_back(getData(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, FirstLane).V);</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160; </div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Distance = 1; Distance != NumLanes; ++Distance) {</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;          <span class="comment">// Visit the lane on the right and then the lane on the left.</span></div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="structllvm_1_1Loop_1_1LoopBounds.html#a1c06ad0290f168148c08edc0ce69703f">Direction</a> : {+1, -1}) {</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;            <span class="keywordtype">int</span> Lane = FirstLane + <a class="code" href="structllvm_1_1Loop_1_1LoopBounds.html#a1c06ad0290f168148c08edc0ce69703f">Direction</a> * Distance;</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;            <span class="keywordflow">if</span> (Lane &lt; 0 || Lane &gt;= (<span class="keywordtype">int</span>)NumLanes)</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;              <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;            <span class="keywordtype">int</span> LastLane = Lane - <a class="code" href="LoopInfo_8cpp.html#ab4c7e3039b29b12e4dc97bcae93d79c3">Direction</a>;</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;            <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LastLane &gt;= 0 &amp;&amp; LastLane &lt; (<span class="keywordtype">int</span>)NumLanes &amp;&amp;</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;                   <span class="stringliteral">&quot;Out of bounds&quot;</span>);</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;            <span class="comment">// Look for a good match for each operand.</span></div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> OpIdx = 0; OpIdx != NumOperands; ++OpIdx) {</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;              <span class="comment">// Search for the operand that matches SortedOps[OpIdx][Lane-1].</span></div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;              std::optional&lt;unsigned&gt; BestIdx = getBestOperand(</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;                  OpIdx, Lane, LastLane, ReorderingModes, MainAltOps[OpIdx]);</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;              <span class="comment">// By not selecting a value, we allow the operands that follow to</span></div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;              <span class="comment">// select a better matching value. We will get a non-null value in</span></div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;              <span class="comment">// the next run of getBestOperand().</span></div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;              <span class="keywordflow">if</span> (BestIdx) {</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;                <span class="comment">// Swap the current operand with the one returned by</span></div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;                <span class="comment">// getBestOperand().</span></div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;                <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">swap</a>(OpIdx, *BestIdx, Lane);</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;              } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;                <span class="comment">// We failed to find a best operand, set mode to &#39;Failed&#39;.</span></div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;                ReorderingModes[OpIdx] = <a class="code" href="namespacellvm.html#aeed8ef055d0b853fb0b4c07bf7c96206">ReorderingMode::Failed</a>;</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;                <span class="comment">// Enable the second pass.</span></div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;                StrategyFailed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;              }</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;              <span class="comment">// Try to get the alternate opcode and follow it during analysis.</span></div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;              <span class="keywordflow">if</span> (MainAltOps[OpIdx].<a class="code" href="namespacellvm.html#a10f3d955592ae2bc745f57e5b48ae115">size</a>() != 2) {</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;                OperandData &amp;AltOp = getData(OpIdx, Lane);</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;                InstructionsState OpS =</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;                    <a class="code" href="SLPVectorizer_8cpp.html#ae37b3a41d982a793664ab021d9b9b325">getSameOpcode</a>({MainAltOps[OpIdx].front(), AltOp.V}, TLI);</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;                <span class="keywordflow">if</span> (OpS.getOpcode() &amp;&amp; OpS.isAltShuffle())</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;                  MainAltOps[OpIdx].push_back(AltOp.V);</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;              }</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;            }</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;          }</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;        }</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;        <span class="comment">// Skip second pass if the strategy did not fail.</span></div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;        <span class="keywordflow">if</span> (!StrategyFailed)</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;      }</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;    }</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160; </div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;<span class="preprocessor">#if !defined(NDEBUG) || defined(LLVM_ENABLE_DUMP)</span></div>
<div class="line"><a name="l02128"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#a25c846db09b53a522a9fd2ac38462406"> 2128</a></span>&#160;    <a class="code" href="Compiler_8h.html#aa863693eef567397d9c292da5bf22d34">LLVM_DUMP_METHOD</a> <span class="keyword">static</span> <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#a25c846db09b53a522a9fd2ac38462406">getModeStr</a>(ReorderingMode RMode) {</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;      <span class="keywordflow">switch</span> (RMode) {</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">ReorderingMode::Load</a>:</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Load&quot;</span>;</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;      <span class="keywordflow">case</span> ReorderingMode::Opcode:</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Opcode&quot;</span>;</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1ISD.html#a22ea9cec080dd5f4f47ba234c2f59110aac2f0a84dd2aa5ee4c3f1385e9565f5e">ReorderingMode::Constant</a>:</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Constant&quot;</span>;</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;      <span class="keywordflow">case</span> ReorderingMode::Splat:</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Splat&quot;</span>;</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aeed8ef055d0b853fb0b4c07bf7c96206">ReorderingMode::Failed</a>:</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Failed&quot;</span>;</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;      }</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;      <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Unimplemented Reordering Type&quot;</span>);</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;    }</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160; </div>
<div class="line"><a name="l02144"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#aef7ceb8ccf02838b7d935dcfcf3a7fcc"> 2144</a></span>&#160;    <a class="code" href="Compiler_8h.html#aa863693eef567397d9c292da5bf22d34">LLVM_DUMP_METHOD</a> <span class="keyword">static</span> <a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;<a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#aef7ceb8ccf02838b7d935dcfcf3a7fcc">printMode</a>(ReorderingMode RMode,</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;                                                   <a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;<a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>) {</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; getModeStr(RMode);</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;    }</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;<span class="comment">    /// Debug print.</span></div>
<div class="line"><a name="l02150"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#a54b0557e2672c4799a99740259ddc41d"> 2150</a></span>&#160;<span class="comment"></span>    <a class="code" href="Compiler_8h.html#aa863693eef567397d9c292da5bf22d34">LLVM_DUMP_METHOD</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#a54b0557e2672c4799a99740259ddc41d">dumpMode</a>(ReorderingMode RMode) {</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;      printMode(RMode, <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>());</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;    }</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160; </div>
<div class="line"><a name="l02154"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#aae56f63ba0ddbe1875b6c76a27abbee8"> 2154</a></span>&#160;    <span class="keyword">friend</span> <a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;<a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#aae56f63ba0ddbe1875b6c76a27abbee8">operator&lt;&lt;</a>(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;<a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>, ReorderingMode RMode) {</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;      <span class="keywordflow">return</span> printMode(RMode, <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>);</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;    }</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160; </div>
<div class="line"><a name="l02158"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#a77bfd96a945ce3d147264ebaa8c6d2c7"> 2158</a></span>&#160;    <a class="code" href="Compiler_8h.html#aa863693eef567397d9c292da5bf22d34">LLVM_DUMP_METHOD</a> <a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;<a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#a77bfd96a945ce3d147264ebaa8c6d2c7">print</a>(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;<a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> Indent = 2;</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;      <span class="keywordtype">unsigned</span> Cnt = 0;</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVector.html">OperandDataVec</a> &amp;OpDataVec : OpsVec) {</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;        <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; <span class="stringliteral">&quot;Operand &quot;</span> &lt;&lt; Cnt++ &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> OperandData &amp;OpData : OpDataVec) {</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;          <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>.<a class="code" href="classllvm_1_1raw__ostream.html#a8fdf5cdf041c8aded7e3308c1c3efacc">indent</a>(Indent) &lt;&lt; <span class="stringliteral">&quot;{&quot;</span>;</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V = OpData.V)</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;            <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; *V;</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;            <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; <span class="stringliteral">&quot;null&quot;</span>;</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;          <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; <span class="stringliteral">&quot;, APO:&quot;</span> &lt;&lt; OpData.APO &lt;&lt; <span class="stringliteral">&quot;}\n&quot;</span>;</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;        }</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;        <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;      }</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>;</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;    }</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;<span class="comment">    /// Debug print.</span></div>
<div class="line"><a name="l02177"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#a8d66b6c2df1694b91c47b9ffe7a9edb8"> 2177</a></span>&#160;<span class="comment"></span>    <a class="code" href="Compiler_8h.html#aa863693eef567397d9c292da5bf22d34">LLVM_DUMP_METHOD</a> <span class="keywordtype">void</span> <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#a8d66b6c2df1694b91c47b9ffe7a9edb8">dump</a>()<span class="keyword"> const </span>{ <a class="code" href="namespacellvm.html#a67980a8ae101d2fda845eb750ffb1942">print</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()); }</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;  };</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;<span class="comment">  /// Evaluate each pair in \p Candidates and return index into \p Candidates</span></div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;<span class="comment">  /// for a pair which have highest score deemed to have best chance to form</span></div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;<span class="comment">  /// root of profitable tree to vectorize. Return std::nullopt if no candidate</span></div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;<span class="comment">  /// scored above the LookAheadHeuristics::ScoreFail. \param Limit Lower limit</span></div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;<span class="comment">  /// of the cost, considered to be good enough score.</span></div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;<span class="comment"></span>  std::optional&lt;int&gt;</div>
<div class="line"><a name="l02187"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a439ba19759640c34ec2262c0a837e82c"> 2187</a></span>&#160;  <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a439ba19759640c34ec2262c0a837e82c">findBestRootPair</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef</a>&lt;std::pair&lt;Value *, Value *&gt;&gt; Candidates,</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;                   <span class="keywordtype">int</span> Limit = LookAheadHeuristics::ScoreFail) {</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;    <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html">LookAheadHeuristics</a> LookAhead(*TLI, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, *SE, *<span class="keyword">this</span>, <span class="comment">/*NumLanes=*/</span>2,</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;                                  <a class="code" href="SLPVectorizer_8cpp.html#a4a37b37137fe1d0888e796e0429d3dc7">RootLookAheadMaxDepth</a>);</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;    <span class="keywordtype">int</span> BestScore = Limit;</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;    std::optional&lt;int&gt; <a class="code" href="ELFObjHandler_8cpp.html#aef61945034b9431b804748fc317c5548">Index</a>;</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : seq&lt;int&gt;(0, Candidates.size())) {</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;      <span class="keywordtype">int</span> Score = LookAhead.<a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html#a54d9af6b4c656c782e017020406e8291">getScoreAtLevelRec</a>(Candidates[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].first,</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;                                               Candidates[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].second,</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;                                               <span class="comment">/*U1=*/</span><span class="keyword">nullptr</span>, <span class="comment">/*U2=*/</span><span class="keyword">nullptr</span>,</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;                                               <span class="comment">/*Level=*/</span>1, std::nullopt);</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;      <span class="keywordflow">if</span> (Score &gt; BestScore) {</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;        BestScore = Score;</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;        <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;      }</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;    }</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="ELFObjHandler_8cpp.html#aef61945034b9431b804748fc317c5548">Index</a>;</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;  }</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;<span class="comment">  /// Checks if the instruction is marked for deletion.</span></div>
<div class="line"><a name="l02207"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a937e8e7cd2fb7c82d9512b69fc81b65b"> 2207</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a937e8e7cd2fb7c82d9512b69fc81b65b">isDeleted</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> DeletedInstructions.count(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>); }</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;<span class="comment">  /// Removes an instruction from its block and eventually deletes it.</span></div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;<span class="comment">  /// It&#39;s like Instruction::eraseFromParent() except that the actual deletion</span></div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;<span class="comment">  /// is delayed until BoUpSLP is destructed.</span></div>
<div class="line"><a name="l02212"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#ab93aab6d000a610c36f69bb84137b2b8"> 2212</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#ab93aab6d000a610c36f69bb84137b2b8">eraseInstruction</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;    DeletedInstructions.insert(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;  }</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;<span class="comment">  /// Checks if the instruction was already analyzed for being possible</span></div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;<span class="comment">  /// reduction root.</span></div>
<div class="line"><a name="l02218"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#ab27b8e376a736c99b51c692c97a988fc"> 2218</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#ab27b8e376a736c99b51c692c97a988fc">isAnalyzedReductionRoot</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;    <span class="keywordflow">return</span> AnalyzedReductionsRoots.count(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;  }<span class="comment"></span></div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;<span class="comment">  /// Register given instruction as already analyzed for being possible</span></div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;<span class="comment">  /// reduction root.</span></div>
<div class="line"><a name="l02223"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a5e8175cf734a1f96d3e5cda536407932"> 2223</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a5e8175cf734a1f96d3e5cda536407932">analyzedReductionRoot</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;    AnalyzedReductionsRoots.insert(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;  }<span class="comment"></span></div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;<span class="comment">  /// Checks if the provided list of reduced values was checked already for</span></div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;<span class="comment">  /// vectorization.</span></div>
<div class="line"><a name="l02228"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a47fd84cb035443c529e17a54beae390f"> 2228</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a47fd84cb035443c529e17a54beae390f">areAnalyzedReductionVals</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;    <span class="keywordflow">return</span> AnalyzedReductionVals.contains(<a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(VL));</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;  }<span class="comment"></span></div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;<span class="comment">  /// Adds the list of reduced values to list of already checked values for the</span></div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;<span class="comment">  /// vectorization.</span></div>
<div class="line"><a name="l02233"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a51b254a1b9cc02e8f8790cdd85b36a7f"> 2233</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a51b254a1b9cc02e8f8790cdd85b36a7f">analyzedReductionVals</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL) {</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;    AnalyzedReductionVals.insert(<a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(VL));</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;  }<span class="comment"></span></div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;<span class="comment">  /// Clear the list of the analyzed reduction root instructions.</span></div>
<div class="line"><a name="l02237"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#afaa748b2bfe8b9ddbd614dab3542411c"> 2237</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#afaa748b2bfe8b9ddbd614dab3542411c">clearReductionData</a>() {</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;    AnalyzedReductionsRoots.clear();</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;    AnalyzedReductionVals.clear();</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;  }<span class="comment"></span></div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;<span class="comment">  /// Checks if the given value is gathered in one of the nodes.</span></div>
<div class="line"><a name="l02242"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#acc0cf2fab0dd3b42f500516296cb0bea"> 2242</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#acc0cf2fab0dd3b42f500516296cb0bea">isAnyGathered</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallDenseSet.html">SmallDenseSet&lt;Value *&gt;</a> &amp;Vals)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(MustGather, [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) { <span class="keywordflow">return</span> Vals.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(V); });</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;  }</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;<span class="comment">  /// Check if the value is vectorized in the tree.</span></div>
<div class="line"><a name="l02247"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#adef9fad96a0d90c56a892520edbdb749"> 2247</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#adef9fad96a0d90c56a892520edbdb749">isVectorized</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> getTreeEntry(V); }</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160; </div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;  ~<a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a>();</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160; </div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;<span class="keyword">private</span>:<span class="comment"></span></div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;<span class="comment">  /// Check if the operands on the edges \p Edges of the \p UserTE allows</span></div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;<span class="comment">  /// reordering (i.e. the operands can be reordered because they have only one</span></div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;<span class="comment">  /// user and reordarable).</span></div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;<span class="comment">  /// \param ReorderableGathers List of all gather nodes that require reordering</span></div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;<span class="comment">  /// (e.g., gather of extractlements or partially vectorizable loads).</span></div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;<span class="comment">  /// \param GatherOps List of gather operand nodes for \p UserTE that require</span></div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;<span class="comment">  /// reordering, subset of \p NonVectorized.</span></div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span></div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;  canReorderOperands(TreeEntry *UserTE,</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;                     <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl</a>&lt;std::pair&lt;unsigned, TreeEntry *&gt;&gt; &amp;Edges,</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;                     <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;TreeEntry *&gt;</a> ReorderableGathers,</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;                     <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;TreeEntry *&gt;</a> &amp;GatherOps);</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;<span class="comment">  /// Checks if the given \p TE is a gather node with clustered reused scalars</span></div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;<span class="comment">  /// and reorders it per given \p Mask.</span></div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> reorderNodeWithReuses(TreeEntry &amp;TE, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>) <span class="keyword">const</span>;</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;<span class="comment">  /// Returns vectorized operand \p OpIdx of the node \p UserTE from the graph,</span></div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;<span class="comment">  /// if any. If it is not vectorized (gather node), returns nullptr.</span></div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;<span class="comment"></span>  TreeEntry *getVectorizedOperand(TreeEntry *UserTE, <span class="keywordtype">unsigned</span> OpIdx) {</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;    <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL = UserTE-&gt;getOperand(OpIdx);</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;    TreeEntry *TE = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> *It = <a class="code" href="namespacellvm.html#ac78c09ae232b2ce188ff590d51e3c268">find_if</a>(VL, [<span class="keyword">this</span>, &amp;TE](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;      TE = getTreeEntry(V);</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;      <span class="keywordflow">return</span> TE;</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;    });</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;    <span class="keywordflow">if</span> (It != VL.<a class="code" href="classllvm_1_1ArrayRef.html#a7ca5197533a9c1fb8a2bd30587fcec6b">end</a>() &amp;&amp; TE-&gt;isSame(VL))</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;      <span class="keywordflow">return</span> TE;</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;  }</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;<span class="comment">  /// Returns vectorized operand \p OpIdx of the node \p UserTE from the graph,</span></div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;<span class="comment">  /// if any. If it is not vectorized (gather node), returns nullptr.</span></div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;<span class="comment"></span>  <span class="keyword">const</span> TreeEntry *getVectorizedOperand(<span class="keyword">const</span> TreeEntry *UserTE,</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;                                        <span class="keywordtype">unsigned</span> OpIdx)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">const_cast&lt;</span><a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> *<span class="keyword">&gt;</span>(<span class="keyword">this</span>)-&gt;getVectorizedOperand(</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;        <span class="keyword">const_cast&lt;</span>TreeEntry *<span class="keyword">&gt;</span>(UserTE), OpIdx);</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;  }</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;<span class="comment">  /// Checks if all users of \p I are the part of the vectorization tree.</span></div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> areAllUsersVectorized(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;                             <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VectorizedVals) <span class="keyword">const</span>;</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;<span class="comment">  /// Return information about the vector formed for the specified index</span></div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;<span class="comment">  /// of a vector of (the same) instruction.</span></div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;<span class="comment"></span>  <a class="code" href="structllvm_1_1TargetTransformInfo_1_1OperandValueInfo.html">TargetTransformInfo::OperandValueInfo</a> getOperandInfo(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL,</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;                                                       <span class="keywordtype">unsigned</span> OpIdx);</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;<span class="comment">  /// \returns the cost of the vectorizable entry.</span></div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> getEntryCost(<span class="keyword">const</span> TreeEntry *<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>,</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;                               <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VectorizedVals);</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;<span class="comment">  /// This is the recursive part of buildTree.</span></div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> buildTree_rec(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> Roots, <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>,</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;                     <span class="keyword">const</span> EdgeInfo &amp;EI);</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;<span class="comment">  /// \returns true if the ExtractElement/ExtractValue instructions in \p VL can</span></div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;<span class="comment">  /// be vectorized to use the original vector (or aggregate &quot;bitcast&quot; to a</span></div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;<span class="comment">  /// vector) and sets \p CurrentOrder to the identity permutation; otherwise</span></div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;<span class="comment">  /// returns false, setting \p CurrentOrder to either an empty vector or a</span></div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;<span class="comment">  /// non-identity permutation that allows to reuse extract instructions.</span></div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> canReuseExtract(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL, <a class="code" href="classllvm_1_1Value.html">Value</a> *OpValue,</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;                       <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;unsigned&gt;</a> &amp;CurrentOrder) <span class="keyword">const</span>;</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;<span class="comment">  /// Vectorize a single entry in the tree.</span></div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Value.html">Value</a> *vectorizeTree(TreeEntry *<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;<span class="comment">  /// Vectorize a single entry in the tree, the \p Idx-th operand of the entry</span></div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;<span class="comment">  /// \p E.</span></div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Value.html">Value</a> *vectorizeOperand(TreeEntry *<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, <span class="keywordtype">unsigned</span> NodeIdx);</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;<span class="comment">  /// Create a new vector from a list of scalar values.  Produces a sequence</span></div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;<span class="comment">  /// which exploits values reused across lanes, and arranges the inserts</span></div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;<span class="comment">  /// for ease of later optimization.</span></div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Value.html">Value</a> *createBuildVector(<span class="keyword">const</span> TreeEntry *<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;<span class="comment">  /// \returns the scalarization cost for this type. Scalarization in this</span></div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;<span class="comment">  /// context means the creation of vectors from a group of scalars. If \p</span></div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;<span class="comment">  /// NeedToShuffle is true, need to add a cost of reshuffling some of the</span></div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;<span class="comment">  /// vector elements.</span></div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> getGatherCost(<a class="code" href="classllvm_1_1FixedVectorType.html">FixedVectorType</a> *Ty,</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;                                <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;ShuffledIndices,</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;                                <span class="keywordtype">bool</span> NeedToShuffle) <span class="keyword">const</span>;</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;<span class="comment">  /// Returns the instruction in the bundle, which can be used as a base point</span></div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;<span class="comment">  /// for scheduling. Usually it is the last instruction in the bundle, except</span></div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;<span class="comment">  /// for the case when all operands are external (in this case, it is the first</span></div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;<span class="comment">  /// instruction in the list).</span></div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;getLastInstructionInBundle(<span class="keyword">const</span> TreeEntry *<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;<span class="comment">  /// Checks if the gathered \p VL can be represented as shuffle(s) of previous</span></div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;<span class="comment">  /// tree entries.</span></div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;<span class="comment">  /// \param TE Tree entry checked for permutation.</span></div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;<span class="comment">  /// \param VL List of scalars (a subset of the TE scalar), checked for</span></div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;<span class="comment">  /// permutations.</span></div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;<span class="comment">  /// \returns ShuffleKind, if gathered values can be represented as shuffles of</span></div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;<span class="comment">  /// previous tree entries. \p Mask is filled with the shuffle mask.</span></div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;<span class="comment"></span>  std::optional&lt;TargetTransformInfo::ShuffleKind&gt;</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;  isGatherShuffledEntry(<span class="keyword">const</span> TreeEntry *TE, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL,</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;                        <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;int&gt;</a> &amp;<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>,</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;                        <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const TreeEntry *&gt;</a> &amp;Entries);</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;<span class="comment">  /// \returns the scalarization cost for this list of values. Assuming that</span></div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;<span class="comment">  /// this subtree gets vectorized, we may need to extract the values from the</span></div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;<span class="comment">  /// roots. This method calculates the cost of extracting the values.</span></div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> getGatherCost(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL) <span class="keyword">const</span>;</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;<span class="comment">  /// Set the Builder insert point to one after the last instruction in</span></div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;<span class="comment">  /// the bundle</span></div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> setInsertPointAfterBundle(<span class="keyword">const</span> TreeEntry *<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;<span class="comment">  /// \returns a vector from a collection of scalars in \p VL.</span></div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Value.html">Value</a> *gather(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL);</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;<span class="comment">  /// \returns whether the VectorizableTree is fully vectorizable and will</span></div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;<span class="comment">  /// be beneficial even the tree height is tiny.</span></div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> isFullyVectorizableTinyTree(<span class="keywordtype">bool</span> ForReduction) <span class="keyword">const</span>;</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;<span class="comment">  /// Reorder commutative or alt operands to get better probability of</span></div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;<span class="comment">  /// generating vectorized code.</span></div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> <span class="keywordtype">void</span> reorderInputsAccordingToOpcode(</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;      <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL, <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Value *&gt;</a> &amp;Left,</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;      <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Value *&gt;</a> &amp;Right, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> &amp;TLI,</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE, <span class="keyword">const</span> <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> &amp;R);</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;<span class="comment">  /// Helper for `findExternalStoreUsersReorderIndices()`. It iterates over the</span></div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;<span class="comment">  /// users of \p TE and collects the stores. It returns the map from the store</span></div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;<span class="comment">  /// pointers to the collected stores.</span></div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, SmallVector&lt;StoreInst *, 4&gt;</a>&gt;</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;  collectUserStores(<span class="keyword">const</span> BoUpSLP::TreeEntry *TE) <span class="keyword">const</span>;</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;<span class="comment">  /// Helper for `findExternalStoreUsersReorderIndices()`. It checks if the</span></div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;<span class="comment">  /// stores in \p StoresVec can form a vector instruction. If so it returns true</span></div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;<span class="comment">  /// and populates \p ReorderIndices with the shuffle indices of the the stores</span></div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;<span class="comment">  /// when compared to the sorted vector.</span></div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> canFormVector(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;StoreInst *, 4&gt;</a> &amp;StoresVec,</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;                     OrdersType &amp;ReorderIndices) <span class="keyword">const</span>;</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;<span class="comment">  /// Iterates through the users of \p TE, looking for scalar stores that can be</span></div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;<span class="comment">  /// potentially vectorized in a future SLP-tree. If found, it keeps track of</span></div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;<span class="comment">  /// their order and builds an order index vector for each store bundle. It</span></div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;<span class="comment">  /// returns all these order vectors found.</span></div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;<span class="comment">  /// We run this after the tree has formed, otherwise we may come across user</span></div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;<span class="comment">  /// instructions that are not yet in the tree.</span></div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;OrdersType, 1&gt;</a></div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;  findExternalStoreUsersReorderIndices(TreeEntry *TE) <span class="keyword">const</span>;</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160; </div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;  <span class="keyword">struct </span>TreeEntry {</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;    <span class="keyword">using</span> VecTreeTy = <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::unique_ptr&lt;TreeEntry&gt;</a>, 8&gt;;</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;    TreeEntry(VecTreeTy &amp;Container) : Container(Container) {}</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;<span class="comment">    /// \returns true if the scalars in VL are equal to this entry.</span></div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span> isSame(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;      <span class="keyword">auto</span> &amp;&amp;IsSame = [VL](<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> Scalars, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>) {</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size() != VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() &amp;&amp; VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() == Scalars.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>())</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1lltok.html#af353621f14cb4b4b3af5ffaff84076b1abf5ba3ee47e95dae362eb24b6d4f48e5">std::equal</a>(VL.<a class="code" href="classllvm_1_1ArrayRef.html#aab36927882fbfdcbb860d87fd9c30da8">begin</a>(), VL.<a class="code" href="classllvm_1_1ArrayRef.html#a7ca5197533a9c1fb8a2bd30587fcec6b">end</a>(), Scalars.<a class="code" href="classllvm_1_1ArrayRef.html#aab36927882fbfdcbb860d87fd9c30da8">begin</a>());</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;        <span class="keywordflow">return</span> VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() == <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size() &amp;&amp;</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;               <a class="code" href="namespacellvm_1_1lltok.html#af353621f14cb4b4b3af5ffaff84076b1abf5ba3ee47e95dae362eb24b6d4f48e5">std::equal</a>(VL.<a class="code" href="classllvm_1_1ArrayRef.html#aab36927882fbfdcbb860d87fd9c30da8">begin</a>(), VL.<a class="code" href="classllvm_1_1ArrayRef.html#a7ca5197533a9c1fb8a2bd30587fcec6b">end</a>(), <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.begin(),</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;                          [Scalars](<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <span class="keywordtype">int</span> Idx) {</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;                            return (isa&lt;UndefValue&gt;(V) &amp;&amp;</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;                                    Idx == UndefMaskElem) ||</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;                                   (Idx != UndefMaskElem &amp;&amp; V == Scalars[Idx]);</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;                          });</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;      };</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;      <span class="keywordflow">if</span> (!ReorderIndices.empty()) {</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;        <span class="comment">// TODO: implement matching if the nodes are just reordered, still can</span></div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;        <span class="comment">// treat the vector as the same if the list of scalars matches VL</span></div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;        <span class="comment">// directly, without reordering.</span></div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;        <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>;</div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;        <a class="code" href="namespacellvm.html#a6f0917bf2ae18fac81fea6bf7e887115">inversePermutation</a>(ReorderIndices, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;        <span class="keywordflow">if</span> (VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() == Scalars.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>())</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;          <span class="keywordflow">return</span> IsSame(Scalars, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;        <span class="keywordflow">if</span> (VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() == ReuseShuffleIndices.size()) {</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;          <a class="code" href="SLPVectorizer_8cpp.html#aff62592a7901b27bdb120c2e64cd86d0">::addMask</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, ReuseShuffleIndices);</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;          <span class="keywordflow">return</span> IsSame(Scalars, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;        }</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;      }</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;      <span class="keywordflow">return</span> IsSame(Scalars, ReuseShuffleIndices);</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;    }</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160; </div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;    <span class="keywordtype">bool</span> isOperandGatherNode(<span class="keyword">const</span> EdgeInfo &amp;UserEI)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;      <span class="keywordflow">return</span> State == TreeEntry::NeedToGather &amp;&amp;</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;             UserTreeIndices.front().EdgeIdx == UserEI.EdgeIdx &amp;&amp;</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;             UserTreeIndices.front().UserTE == UserEI.UserTE;</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;    }</div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;<span class="comment">    /// \returns true if current entry has same operands as \p TE.</span></div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span> hasEqualOperands(<span class="keyword">const</span> TreeEntry &amp;TE)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.getNumOperands() != getNumOperands())</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;      <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> <a class="code" href="namespacellvm_1_1ZeroCallUsedRegs.html#af03f9c4ce466646943e50f317397cec0a019d1ca7d50cc54b995f60d456435e87">Used</a>(getNumOperands());</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = getNumOperands(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;        <span class="keywordtype">unsigned</span> PrevCount = <a class="code" href="namespacellvm_1_1ZeroCallUsedRegs.html#af03f9c4ce466646943e50f317397cec0a019d1ca7d50cc54b995f60d456435e87">Used</a>.count();</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> K = 0; K &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++K) {</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ZeroCallUsedRegs.html#af03f9c4ce466646943e50f317397cec0a019d1ca7d50cc54b995f60d456435e87">Used</a>.test(K))</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;          <span class="keywordflow">if</span> (getOperand(K) == <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.getOperand(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;            <a class="code" href="namespacellvm_1_1ZeroCallUsedRegs.html#af03f9c4ce466646943e50f317397cec0a019d1ca7d50cc54b995f60d456435e87">Used</a>.set(K);</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;          }</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;        }</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;        <span class="comment">// Check if we actually found the matching operand.</span></div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;        <span class="keywordflow">if</span> (PrevCount == <a class="code" href="namespacellvm_1_1ZeroCallUsedRegs.html#af03f9c4ce466646943e50f317397cec0a019d1ca7d50cc54b995f60d456435e87">Used</a>.count())</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;      }</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;    }</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;<span class="comment">    /// \return Final vectorization factor for the node. Defined by the total</span></div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;<span class="comment">    /// number of vectorized scalars, including those, used several times in the</span></div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;<span class="comment">    /// entry and counted in the \a ReuseShuffleIndices, if any.</span></div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> getVectorFactor()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;      <span class="keywordflow">if</span> (!ReuseShuffleIndices.empty())</div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;        <span class="keywordflow">return</span> ReuseShuffleIndices.size();</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;      <span class="keywordflow">return</span> Scalars.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>();</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;    };</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;<span class="comment">    /// A vector of scalars.</span></div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;<span class="comment"></span>    ValueList Scalars;</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;<span class="comment">    /// The Scalars are vectorized into this value. It is initialized to Null.</span></div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1Value.html">Value</a> *VectorizedValue = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;<span class="comment">    /// Do we need to gather this sequence or vectorize it</span></div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;<span class="comment">    /// (either with vector instruction or with scatter/gather</span></div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;<span class="comment">    /// intrinsics for store/load)?</span></div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;<span class="comment"></span>    <span class="keyword">enum</span> EntryState { Vectorize, ScatterVectorize, NeedToGather };</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;    EntryState State;</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;<span class="comment">    /// Does this sequence require some shuffling?</span></div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int, 4&gt;</a> ReuseShuffleIndices;</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;<span class="comment">    /// Does this entry require reordering?</span></div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;unsigned, 4&gt;</a> ReorderIndices;</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;<span class="comment">    /// Points back to the VectorizableTree.</span></div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;<span class="comment">    ///</span></div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;<span class="comment">    /// Only used for Graphviz right now.  Unfortunately GraphTrait::NodeRef has</span></div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;<span class="comment">    /// to be a pointer and needs to be able to initialize the child iterator.</span></div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;<span class="comment">    /// Thus we need a reference back to the container to translate the indices</span></div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;<span class="comment">    /// to entries.</span></div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;<span class="comment"></span>    VecTreeTy &amp;Container;</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;<span class="comment">    /// The TreeEntry index containing the user of this entry.  We can actually</span></div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;<span class="comment">    /// have multiple users so the data structure is not truly a tree.</span></div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;EdgeInfo, 1&gt;</a> UserTreeIndices;</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;<span class="comment">    /// The index of this treeEntry in VectorizableTree.</span></div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;<span class="comment"></span>    <span class="keywordtype">int</span> Idx = -1;</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160; </div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;  <span class="keyword">private</span>:<span class="comment"></span></div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;<span class="comment">    /// The operands of each instruction in each lane Operands[op_index][lane].</span></div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;<span class="comment">    /// Note: This helps avoid the replication of the code that performs the</span></div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;<span class="comment">    /// reordering of operands during buildTree_rec() and vectorizeTree().</span></div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;ValueList, 2&gt;</a> <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>;</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;<span class="comment">    /// The main/alternate instruction.</span></div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *MainOp = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *AltOp = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160; </div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;  <span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;<span class="comment">    /// Set this bundle&#39;s \p OpIdx&#39;th operand to \p OpVL.</span></div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> setOperand(<span class="keywordtype">unsigned</span> OpIdx, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> OpVL) {</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.size() &lt; OpIdx + 1)</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;        <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.resize(OpIdx + 1);</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>[OpIdx].empty() &amp;&amp; <span class="stringliteral">&quot;Already resized?&quot;</span>);</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OpVL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() &lt;= Scalars.size() &amp;&amp;</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;             <span class="stringliteral">&quot;Number of operands is greater than the number of scalars.&quot;</span>);</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;      <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>[OpIdx].resize(OpVL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;      <a class="code" href="namespacellvm.html#abb650e853db0ddbb60411b885c499737">copy</a>(OpVL, <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>[OpIdx].<a class="code" href="namespacellvm_1_1sys_1_1path.html#a00a76a729b319dc47beffbe07325565f">begin</a>());</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;    }</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;<span class="comment">    /// Set the operands of this bundle in their original order.</span></div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> setOperandsInOrder() {</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.empty() &amp;&amp; <span class="stringliteral">&quot;Already initialized?&quot;</span>);</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;      <span class="keyword">auto</span> *I0 = cast&lt;Instruction&gt;(Scalars[0]);</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;      <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.resize(I0-&gt;getNumOperands());</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;      <span class="keywordtype">unsigned</span> NumLanes = Scalars.size();</div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> OpIdx = 0, NumOperands = I0-&gt;getNumOperands();</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;           OpIdx != NumOperands; ++OpIdx) {</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;        <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>[OpIdx].resize(NumLanes);</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Lane = 0; Lane != NumLanes; ++Lane) {</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;          <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = cast&lt;Instruction&gt;(Scalars[Lane]);</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNumOperands() == NumOperands &amp;&amp;</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;                 <span class="stringliteral">&quot;Expected same number of operands&quot;</span>);</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;          <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>[OpIdx][Lane] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(OpIdx);</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;        }</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;      }</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;    }</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;<span class="comment">    /// Reorders operands of the node to the given mask \p Mask.</span></div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> reorderOperands(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>) {</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;      <span class="keywordflow">for</span> (ValueList &amp;Operand : <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>)</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;        <a class="code" href="namespacellvm.html#a14c12bda1f5a9beed612b00f3f98b888">reorderScalars</a>(Operand, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;    }</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;<span class="comment">    /// \returns the \p OpIdx operand of this TreeEntry.</span></div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;<span class="comment"></span>    ValueList &amp;getOperand(<span class="keywordtype">unsigned</span> OpIdx) {</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OpIdx &lt; <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.size() &amp;&amp; <span class="stringliteral">&quot;Off bounds&quot;</span>);</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>[OpIdx];</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;    }</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;<span class="comment">    /// \returns the \p OpIdx operand of this TreeEntry.</span></div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> getOperand(<span class="keywordtype">unsigned</span> OpIdx)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OpIdx &lt; <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.size() &amp;&amp; <span class="stringliteral">&quot;Off bounds&quot;</span>);</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>[OpIdx];</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;    }</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;<span class="comment">    /// \returns the number of operands.</span></div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> getNumOperands()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.size(); }</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;<span class="comment">    /// \return the single \p OpIdx operand.</span></div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1Value.html">Value</a> *getSingleOperand(<span class="keywordtype">unsigned</span> OpIdx)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OpIdx &lt; <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.size() &amp;&amp; <span class="stringliteral">&quot;Off bounds&quot;</span>);</div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>[OpIdx].empty() &amp;&amp; <span class="stringliteral">&quot;No operand available&quot;</span>);</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>[OpIdx][0];</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;    }</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;<span class="comment">    /// Some of the instructions in the list have alternate opcodes.</span></div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span> isAltShuffle()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> MainOp != AltOp; }</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160; </div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;    <span class="keywordtype">bool</span> isOpcodeOrAlt(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;      <span class="keywordtype">unsigned</span> CheckedOpcode = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode();</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;      <span class="keywordflow">return</span> (<a class="code" href="VPlanSLP_8cpp.html#af04704e906a9654777e92a4612c58c13">getOpcode</a>() == CheckedOpcode ||</div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;              getAltOpcode() == CheckedOpcode);</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;    }</div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;<span class="comment">    /// Chooses the correct key for scheduling data. If \p Op has the same (or</span></div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;<span class="comment">    /// alternate) opcode as \p OpValue, the key is \p Op. Otherwise the key is</span></div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;<span class="comment">    /// \p OpValue.</span></div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="SLPVectorizer_8cpp.html#a2207681d736278c6968f548195f1f90c">isOneOf</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>);</div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp; isOpcodeOrAlt(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>;</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;      <span class="keywordflow">return</span> MainOp;</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;    }</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160; </div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;    <span class="keywordtype">void</span> setOperations(<span class="keyword">const</span> InstructionsState &amp;<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>) {</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;      MainOp = <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.MainOp;</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;      AltOp = <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.AltOp;</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;    }</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160; </div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *getMainOp()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;      <span class="keywordflow">return</span> MainOp;</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;    }</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160; </div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *getAltOp()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;      <span class="keywordflow">return</span> AltOp;</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;    }</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;<span class="comment">    /// The main/alternate opcodes for the list of instructions.</span></div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> <a class="code" href="VPlanSLP_8cpp.html#af04704e906a9654777e92a4612c58c13">getOpcode</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;      <span class="keywordflow">return</span> MainOp ? MainOp-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() : 0;</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;    }</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160; </div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;    <span class="keywordtype">unsigned</span> getAltOpcode()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;      <span class="keywordflow">return</span> AltOp ? AltOp-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() : 0;</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;    }</div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;<span class="comment">    /// When ReuseReorderShuffleIndices is empty it just returns position of \p</span></div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;<span class="comment">    /// V within vector of Scalars. Otherwise, try to remap on its reuse index.</span></div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;<span class="comment"></span>    <span class="keywordtype">int</span> findLaneForValue(<a class="code" href="classllvm_1_1Value.html">Value</a> *V)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;      <span class="keywordtype">unsigned</span> FoundLane = std::distance(Scalars.begin(), <a class="code" href="namespacellvm.html#a086e9fbdb06276db7753101a08a63adf">find</a>(Scalars, V));</div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FoundLane &lt; Scalars.size() &amp;&amp; <span class="stringliteral">&quot;Couldn&#39;t find extract lane&quot;</span>);</div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;      <span class="keywordflow">if</span> (!ReorderIndices.empty())</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;        FoundLane = ReorderIndices[FoundLane];</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FoundLane &lt; Scalars.size() &amp;&amp; <span class="stringliteral">&quot;Couldn&#39;t find extract lane&quot;</span>);</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;      <span class="keywordflow">if</span> (!ReuseShuffleIndices.empty()) {</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;        FoundLane = std::distance(ReuseShuffleIndices.begin(),</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;                                  <a class="code" href="namespacellvm.html#a086e9fbdb06276db7753101a08a63adf">find</a>(ReuseShuffleIndices, FoundLane));</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;      }</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;      <span class="keywordflow">return</span> FoundLane;</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;    }</div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160; </div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;<span class="comment">    /// Debug printer.</span></div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;<span class="comment"></span>    <a class="code" href="Compiler_8h.html#aa863693eef567397d9c292da5bf22d34">LLVM_DUMP_METHOD</a> <span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a03503773241005f01b090b9862aad304">dump</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;      <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; Idx &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>;</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> OpI = 0, OpE = <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.size(); OpI != OpE; ++OpI) {</div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Operand &quot;</span> &lt;&lt; OpI &lt;&lt; <span class="stringliteral">&quot;:\n&quot;</span>;</div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *V : <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>[OpI])</div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;          <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>().<a class="code" href="classllvm_1_1raw__ostream.html#a8fdf5cdf041c8aded7e3308c1c3efacc">indent</a>(2) &lt;&lt; *V &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;      }</div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;      <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Scalars: \n&quot;</span>;</div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : Scalars)</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>().<a class="code" href="classllvm_1_1raw__ostream.html#a8fdf5cdf041c8aded7e3308c1c3efacc">indent</a>(2) &lt;&lt; *V &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;      <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;State: &quot;</span>;</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;      <span class="keywordflow">switch</span> (State) {</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;      <span class="keywordflow">case</span> Vectorize:</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Vectorize\n&quot;</span>;</div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;      <span class="keywordflow">case</span> ScatterVectorize:</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;ScatterVectorize\n&quot;</span>;</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;      <span class="keywordflow">case</span> NeedToGather:</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;NeedToGather\n&quot;</span>;</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;      }</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;      <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;MainOp: &quot;</span>;</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;      <span class="keywordflow">if</span> (MainOp)</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; *MainOp &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;NULL\n&quot;</span>;</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;      <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;AltOp: &quot;</span>;</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;      <span class="keywordflow">if</span> (AltOp)</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; *AltOp &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;NULL\n&quot;</span>;</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;      <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;VectorizedValue: &quot;</span>;</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;      <span class="keywordflow">if</span> (VectorizedValue)</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; *VectorizedValue &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;NULL\n&quot;</span>;</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;      <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;ReuseShuffleIndices: &quot;</span>;</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;      <span class="keywordflow">if</span> (ReuseShuffleIndices.empty())</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Empty&quot;</span>;</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ReuseIdx : ReuseShuffleIndices)</div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;          <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; ReuseIdx &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;      <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;      <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;ReorderIndices: &quot;</span>;</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> ReorderIdx : ReorderIndices)</div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; ReorderIdx &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;      <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;      <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;UserTreeIndices: &quot;</span>;</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;EInfo : UserTreeIndices)</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; EInfo &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;      <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;    }</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;  };</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160; </div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;  <span class="keywordtype">void</span> dumpTreeCosts(<span class="keyword">const</span> TreeEntry *<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> ReuseShuffleCost,</div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;                     <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> VecCost,</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;                     <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> ScalarCost)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;    <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Calculated costs for Tree:\n&quot;</span>; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;dump();</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;    <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Costs:\n&quot;</span>;</div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;    <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP:     ReuseShuffleCost = &quot;</span> &lt;&lt; ReuseShuffleCost &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;    <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP:     VectorCost = &quot;</span> &lt;&lt; VecCost &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;    <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP:     ScalarCost = &quot;</span> &lt;&lt; ScalarCost &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;    <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP:     ReuseShuffleCost + VecCost - ScalarCost = &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;               ReuseShuffleCost + VecCost - ScalarCost &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;  }</div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;<span class="comment">  /// Create a new VectorizableTree entry.</span></div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;<span class="comment"></span>  TreeEntry *newTreeEntry(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL, std::optional&lt;ScheduleData *&gt; Bundle,</div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;                          <span class="keyword">const</span> InstructionsState &amp;<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>,</div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;                          <span class="keyword">const</span> EdgeInfo &amp;UserTreeIdx,</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;                          <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> ReuseShuffleIndices = std::nullopt,</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;                          <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;unsigned&gt;</a> ReorderIndices = std::nullopt) {</div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;    TreeEntry::EntryState EntryState =</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;        Bundle ? TreeEntry::Vectorize : TreeEntry::NeedToGather;</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;    <span class="keywordflow">return</span> newTreeEntry(VL, EntryState, Bundle, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;                        ReuseShuffleIndices, ReorderIndices);</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;  }</div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160; </div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;  TreeEntry *newTreeEntry(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL,</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;                          TreeEntry::EntryState EntryState,</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;                          std::optional&lt;ScheduleData *&gt; Bundle,</div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;                          <span class="keyword">const</span> InstructionsState &amp;<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>,</div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;                          <span class="keyword">const</span> EdgeInfo &amp;UserTreeIdx,</div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;                          <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> ReuseShuffleIndices = std::nullopt,</div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;                          <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;unsigned&gt;</a> ReorderIndices = std::nullopt) {</div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(((!Bundle &amp;&amp; EntryState == TreeEntry::NeedToGather) ||</div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;            (Bundle &amp;&amp; EntryState != TreeEntry::NeedToGather)) &amp;&amp;</div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;           <span class="stringliteral">&quot;Need to vectorize gather entry?&quot;</span>);</div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;    VectorizableTree.push_back(std::make_unique&lt;TreeEntry&gt;(VectorizableTree));</div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;    TreeEntry *<a class="code" href="namespacellvm.html#ac10d13c57a7adf4a1f140afd5321309bad55b30607c2a9a2616347d6edb789f6b">Last</a> = VectorizableTree.back().get();</div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;    <a class="code" href="namespacellvm.html#ac10d13c57a7adf4a1f140afd5321309bad55b30607c2a9a2616347d6edb789f6b">Last</a>-&gt;Idx = VectorizableTree.size() - 1;</div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;    <a class="code" href="namespacellvm.html#ac10d13c57a7adf4a1f140afd5321309bad55b30607c2a9a2616347d6edb789f6b">Last</a>-&gt;State = EntryState;</div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;    <a class="code" href="namespacellvm.html#ac10d13c57a7adf4a1f140afd5321309bad55b30607c2a9a2616347d6edb789f6b">Last</a>-&gt;ReuseShuffleIndices.append(ReuseShuffleIndices.begin(),</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;                                     ReuseShuffleIndices.end());</div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;    <span class="keywordflow">if</span> (ReorderIndices.empty()) {</div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;      <a class="code" href="namespacellvm.html#ac10d13c57a7adf4a1f140afd5321309bad55b30607c2a9a2616347d6edb789f6b">Last</a>-&gt;Scalars.assign(VL.<a class="code" href="classllvm_1_1ArrayRef.html#aab36927882fbfdcbb860d87fd9c30da8">begin</a>(), VL.<a class="code" href="classllvm_1_1ArrayRef.html#a7ca5197533a9c1fb8a2bd30587fcec6b">end</a>());</div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;      <a class="code" href="namespacellvm.html#ac10d13c57a7adf4a1f140afd5321309bad55b30607c2a9a2616347d6edb789f6b">Last</a>-&gt;setOperations(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>);</div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;      <span class="comment">// Reorder scalars and build final mask.</span></div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;      <a class="code" href="namespacellvm.html#ac10d13c57a7adf4a1f140afd5321309bad55b30607c2a9a2616347d6edb789f6b">Last</a>-&gt;Scalars.assign(VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(), <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;      <a class="code" href="namespacellvm.html#a615619b0b2879029152b9a20e96624bc">transform</a>(ReorderIndices, <a class="code" href="namespacellvm.html#ac10d13c57a7adf4a1f140afd5321309bad55b30607c2a9a2616347d6edb789f6b">Last</a>-&gt;Scalars.begin(),</div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;                [VL](<span class="keywordtype">unsigned</span> Idx) -&gt; <a class="code" href="classllvm_1_1Value.html">Value</a> * {</div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;                  if (Idx &gt;= VL.size())</div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;                    return UndefValue::get(VL.front()-&gt;getType());</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;                  return VL[Idx];</div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;                });</div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;      InstructionsState <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = <a class="code" href="SLPVectorizer_8cpp.html#ae37b3a41d982a793664ab021d9b9b325">getSameOpcode</a>(<a class="code" href="namespacellvm.html#ac10d13c57a7adf4a1f140afd5321309bad55b30607c2a9a2616347d6edb789f6b">Last</a>-&gt;Scalars, *TLI);</div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;      <a class="code" href="namespacellvm.html#ac10d13c57a7adf4a1f140afd5321309bad55b30607c2a9a2616347d6edb789f6b">Last</a>-&gt;setOperations(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>);</div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;      <a class="code" href="namespacellvm.html#ac10d13c57a7adf4a1f140afd5321309bad55b30607c2a9a2616347d6edb789f6b">Last</a>-&gt;ReorderIndices.append(ReorderIndices.begin(), ReorderIndices.end());</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;    }</div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ac10d13c57a7adf4a1f140afd5321309bad55b30607c2a9a2616347d6edb789f6b">Last</a>-&gt;State != TreeEntry::NeedToGather) {</div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!getTreeEntry(V) &amp;&amp; <span class="stringliteral">&quot;Scalar already in tree!&quot;</span>);</div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;        ScalarToTreeEntry[V] = <a class="code" href="namespacellvm.html#ac10d13c57a7adf4a1f140afd5321309bad55b30607c2a9a2616347d6edb789f6b">Last</a>;</div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;      }</div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;      <span class="comment">// Update the scheduler bundle to point to this TreeEntry.</span></div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;      ScheduleData *BundleMember = *Bundle;</div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((BundleMember || isa&lt;PHINode&gt;(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.MainOp) ||</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;              <a class="code" href="SLPVectorizer_8cpp.html#a06a9edb69d0ed6fda201d59948acfd89">isVectorLikeInstWithConstOps</a>(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.MainOp) ||</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;              <a class="code" href="namespacellvm.html#abed730d9d5b8f4c70f4fbe1094a0157f">doesNotNeedToSchedule</a>(VL)) &amp;&amp;</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;             <span class="stringliteral">&quot;Bundle and VL out of sync&quot;</span>);</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;      <span class="keywordflow">if</span> (BundleMember) {</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a05a7412bf10f2226fb69f2876b76e9cd">doesNotNeedToBeScheduled</a>(V))</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BundleMember &amp;&amp; <span class="stringliteral">&quot;Unexpected end of bundle.&quot;</span>);</div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;          BundleMember-&gt;TE = <a class="code" href="namespacellvm.html#ac10d13c57a7adf4a1f140afd5321309bad55b30607c2a9a2616347d6edb789f6b">Last</a>;</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;          BundleMember = BundleMember-&gt;NextInBundle;</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;        }</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;      }</div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!BundleMember &amp;&amp; <span class="stringliteral">&quot;Bundle and VL out of sync&quot;</span>);</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;      MustGather.insert(VL.begin(), VL.end());</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;    }</div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160; </div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;    <span class="keywordflow">if</span> (UserTreeIdx.UserTE)</div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;      <a class="code" href="namespacellvm.html#ac10d13c57a7adf4a1f140afd5321309bad55b30607c2a9a2616347d6edb789f6b">Last</a>-&gt;UserTreeIndices.push_back(UserTreeIdx);</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160; </div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#ac10d13c57a7adf4a1f140afd5321309bad55b30607c2a9a2616347d6edb789f6b">Last</a>;</div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;  }</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;<span class="comment">  /// -- Vectorization State --</span></div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;<span class="comment">  /// Holds all of the tree entries.</span></div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;<span class="comment"></span>  TreeEntry::VecTreeTy VectorizableTree;</div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160; </div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;<span class="comment">  /// Debug printer.</span></div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;<span class="comment"></span>  <a class="code" href="Compiler_8h.html#aa863693eef567397d9c292da5bf22d34">LLVM_DUMP_METHOD</a> <span class="keywordtype">void</span> dumpVectorizableTree()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1AMDGPU_1_1VGPRIndexMode.html#a9afd95476c40096a5898ba0f06370b3a">Id</a> = 0, IdE = VectorizableTree.size(); <a class="code" href="namespacellvm_1_1AMDGPU_1_1VGPRIndexMode.html#a9afd95476c40096a5898ba0f06370b3a">Id</a> != IdE; ++<a class="code" href="namespacellvm_1_1AMDGPU_1_1VGPRIndexMode.html#a9afd95476c40096a5898ba0f06370b3a">Id</a>) {</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;      VectorizableTree[<a class="code" href="namespacellvm_1_1AMDGPU_1_1VGPRIndexMode.html#a9afd95476c40096a5898ba0f06370b3a">Id</a>]-&gt;dump();</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;      <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;    }</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;  }</div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160; </div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;  TreeEntry *getTreeEntry(<a class="code" href="classllvm_1_1Value.html">Value</a> *V) { <span class="keywordflow">return</span> ScalarToTreeEntry.lookup(V); }</div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160; </div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;  <span class="keyword">const</span> TreeEntry *getTreeEntry(<a class="code" href="classllvm_1_1Value.html">Value</a> *V)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;    <span class="keywordflow">return</span> ScalarToTreeEntry.lookup(V);</div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;  }</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;<span class="comment">  /// Maps a specific scalar to its tree entry.</span></div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;Value*, TreeEntry *&gt;</a> ScalarToTreeEntry;</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;<span class="comment">  /// Maps a value to the proposed vectorizable size.</span></div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;Value *, unsigned&gt;</a> InstrElementSize;</div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;<span class="comment">  /// A list of scalars that we found that we need to keep as scalars.</span></div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;<span class="comment"></span>  ValueSet MustGather;</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;<span class="comment">  /// A map between the vectorized entries and the last instructions in the</span></div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;<span class="comment">  /// bundles. The bundles are built in use order, not in the def order of the</span></div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;<span class="comment">  /// instructions. So, we cannot rely directly on the last instruction in the</span></div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;<span class="comment">  /// bundle being the last instruction in the program order during</span></div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;<span class="comment">  /// vectorization process since the basic blocks are affected, need to</span></div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;<span class="comment">  /// pre-gather them before.</span></div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const TreeEntry *, Instruction *&gt;</a> EntryToLastInstruction;</div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;<span class="comment">  /// This POD struct describes one external user in the vectorized tree.</span></div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;<span class="comment"></span>  <span class="keyword">struct </span>ExternalUser {</div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;    ExternalUser(<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, <a class="code" href="classllvm_1_1User.html">llvm::User</a> *U, <span class="keywordtype">int</span> L)</div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;        : <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a>(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>), <a class="code" href="classllvm_1_1User.html">User</a>(U), Lane(L) {}</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160; </div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;    <span class="comment">// Which scalar in our function.</span></div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a>;</div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160; </div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;    <span class="comment">// Which user that uses the scalar.</span></div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;    <a class="code" href="classllvm_1_1User.html">llvm::User</a> *<a class="code" href="classllvm_1_1User.html">User</a>;</div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160; </div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;    <span class="comment">// Which lane does the scalar belong to.</span></div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;    <span class="keywordtype">int</span> Lane;</div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;  };</div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;  <span class="keyword">using</span> UserList = <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;ExternalUser, 16&gt;</a>;</div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;<span class="comment">  /// Checks if two instructions may access the same memory.</span></div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;<span class="comment">  ///</span></div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;<span class="comment">  /// \p Loc1 is the location of \p Inst1. It is passed explicitly because it</span></div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;<span class="comment">  /// is invariant in the calling loop.</span></div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> isAliased(<span class="keyword">const</span> <a class="code" href="classllvm_1_1MemoryLocation.html">MemoryLocation</a> &amp;Loc1, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst1,</div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;                 <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst2) {</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;    <span class="comment">// First check if the result is already in the cache.</span></div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;    AliasCacheKey key = std::make_pair(Inst1, Inst2);</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;    std::optional&lt;bool&gt; &amp;<a class="code" href="README__P9_8txt.html#ae070adaf1b4bf0e7c12fcae2b9c5ae67">result</a> = AliasCache[key];</div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="README__P9_8txt.html#ae070adaf1b4bf0e7c12fcae2b9c5ae67">result</a>) {</div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;      <span class="keywordflow">return</span> *<a class="code" href="README__P9_8txt.html#ae070adaf1b4bf0e7c12fcae2b9c5ae67">result</a>;</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;    }</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;    <span class="keywordtype">bool</span> aliased = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;    <span class="keywordflow">if</span> (Loc1.<a class="code" href="classllvm_1_1MemoryLocation.html#a9550ce4a179e46db37f653ce28feca7a">Ptr</a> &amp;&amp; <a class="code" href="SLPVectorizer_8cpp.html#a3ca9742688618517cc4690fb947fb609">isSimple</a>(Inst1))</div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;      aliased = <a class="code" href="namespacellvm.html#a854abfc88bcd24e3878e2c9ab1f70fd3">isModOrRefSet</a>(BatchAA.getModRefInfo(Inst2, Loc1));</div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;    <span class="comment">// Store the result in the cache.</span></div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;    <a class="code" href="README__P9_8txt.html#ae070adaf1b4bf0e7c12fcae2b9c5ae67">result</a> = aliased;</div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;    <span class="keywordflow">return</span> aliased;</div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;  }</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160; </div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;  <span class="keyword">using</span> AliasCacheKey = std::pair&lt;Instruction *, Instruction *&gt;;</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;<span class="comment">  /// Cache for alias results.</span></div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;<span class="comment">  /// TODO: consider moving this to the AliasAnalysis itself.</span></div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;AliasCacheKey, std::optional&lt;bool&gt;</a>&gt; AliasCache;</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160; </div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;  <span class="comment">// Cache for pointerMayBeCaptured calls inside AA.  This is preserved</span></div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;  <span class="comment">// globally through SLP because we don&#39;t perform any action which</span></div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;  <span class="comment">// invalidates capture results.</span></div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;  <a class="code" href="classllvm_1_1BatchAAResults.html">BatchAAResults</a> BatchAA;</div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;<span class="comment">  /// Temporary store for deleted instructions. Instructions will be deleted</span></div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;<span class="comment">  /// eventually when the BoUpSLP is destructed.  The deferral is required to</span></div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;<span class="comment">  /// ensure that there are no incorrect collisions in the AliasCache, which</span></div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;<span class="comment">  /// can happen if a new instruction is allocated at the same address as a</span></div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;<span class="comment">  /// previously deleted instruction.</span></div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;Instruction *&gt;</a> DeletedInstructions;</div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;<span class="comment">  /// Set of the instruction, being analyzed already for reductions.</span></div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction *, 16&gt;</a> AnalyzedReductionsRoots;</div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;<span class="comment">  /// Set of hashes for the list of reduction values already being analyzed.</span></div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;size_t&gt;</a> AnalyzedReductionVals;</div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;<span class="comment">  /// A list of values that need to extracted out of the tree.</span></div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;<span class="comment">  /// This list holds pairs of (Internal Scalar : External User). External User</span></div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;<span class="comment">  /// can be nullptr, it means that this Internal Scalar will be used later,</span></div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;<span class="comment">  /// after vectorization.</span></div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;<span class="comment"></span>  UserList ExternalUses;</div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;<span class="comment">  /// Values used only by @llvm.assume calls.</span></div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const Value *, 32&gt;</a> EphValues;</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;<span class="comment">  /// Holds all of the instructions that we gathered, shuffle instructions and</span></div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;<span class="comment">  /// extractelements.</span></div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;Instruction *&gt;</a> GatherShuffleExtractSeq;</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;<span class="comment">  /// A list of blocks that we are going to CSE.</span></div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;BasicBlock *&gt;</a> CSEBlocks;</div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;<span class="comment">  /// Contains all scheduling relevant data for an instruction.</span></div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;<span class="comment">  /// A ScheduleData either represents a single instruction or a member of an</span></div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;<span class="comment">  /// instruction bundle (= a group of instructions which is combined into a</span></div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;<span class="comment">  /// vector instruction).</span></div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;<span class="comment"></span>  <span class="keyword">struct </span>ScheduleData {</div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;    <span class="comment">// The initial value for the dependency counters. It means that the</span></div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;    <span class="comment">// dependencies are not calculated yet.</span></div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;    <span class="keyword">enum</span> { InvalidDeps = -1 };</div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160; </div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;    ScheduleData() = <span class="keywordflow">default</span>;</div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160; </div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">init</a>(<span class="keywordtype">int</span> BlockSchedulingRegionID, <a class="code" href="classllvm_1_1Value.html">Value</a> *OpVal) {</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;      FirstInBundle = <span class="keyword">this</span>;</div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;      NextInBundle = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;      NextLoadStore = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;      IsScheduled = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;      SchedulingRegionID = BlockSchedulingRegionID;</div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;      clearDependencies();</div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;      OpValue = OpVal;</div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;      <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;    }</div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;<span class="comment">    /// Verify basic self consistency properties</span></div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> <a class="code" href="PPCCTRLoopsVerify_8cpp.html#a593cc2f204f7b2edc16ee222c37c3196">verify</a>() {</div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;      <span class="keywordflow">if</span> (hasValidDependencies()) {</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(UnscheduledDeps &lt;= Dependencies &amp;&amp; <span class="stringliteral">&quot;invariant&quot;</span>);</div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(UnscheduledDeps == Dependencies &amp;&amp; <span class="stringliteral">&quot;invariant&quot;</span>);</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;      }</div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160; </div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;      <span class="keywordflow">if</span> (IsScheduled) {</div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isSchedulingEntity() &amp;&amp;</div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;                <span class="stringliteral">&quot;unexpected scheduled state&quot;</span>);</div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> ScheduleData *BundleMember = <span class="keyword">this</span>; BundleMember;</div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;             BundleMember = BundleMember-&gt;NextInBundle) {</div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BundleMember-&gt;hasValidDependencies() &amp;&amp;</div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;                 BundleMember-&gt;UnscheduledDeps == 0 &amp;&amp;</div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;                 <span class="stringliteral">&quot;unexpected scheduled state&quot;</span>);</div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((BundleMember == <span class="keyword">this</span> || !BundleMember-&gt;IsScheduled) &amp;&amp;</div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;                 <span class="stringliteral">&quot;only bundle is marked scheduled&quot;</span>);</div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;        }</div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;      }</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160; </div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Inst-&gt;getParent() == FirstInBundle-&gt;Inst-&gt;getParent() &amp;&amp;</div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;             <span class="stringliteral">&quot;all bundle members must be in same basic block&quot;</span>);</div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;    }</div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;<span class="comment">    /// Returns true if the dependency information has been calculated.</span></div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;<span class="comment">    /// Note that depenendency validity can vary between instructions within</span></div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;<span class="comment">    /// a single bundle.</span></div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span> hasValidDependencies()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> Dependencies != InvalidDeps; }</div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;<span class="comment">    /// Returns true for single instructions and for bundle representatives</span></div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;<span class="comment">    /// (= the head of a bundle).</span></div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span> isSchedulingEntity()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> FirstInBundle == <span class="keyword">this</span>; }</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;<span class="comment">    /// Returns true if it represents an instruction bundle and not only a</span></div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;<span class="comment">    /// single instruction.</span></div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span> isPartOfBundle()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;      <span class="keywordflow">return</span> NextInBundle != <span class="keyword">nullptr</span> || FirstInBundle != <span class="keyword">this</span> || <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>;</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;    }</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;<span class="comment">    /// Returns true if it is ready for scheduling, i.e. it has no more</span></div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;<span class="comment">    /// unscheduled depending instructions/bundles.</span></div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span> isReady()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isSchedulingEntity() &amp;&amp;</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;             <span class="stringliteral">&quot;can&#39;t consider non-scheduling entity for ready list&quot;</span>);</div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;      <span class="keywordflow">return</span> unscheduledDepsInBundle() == 0 &amp;&amp; !IsScheduled;</div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;    }</div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;<span class="comment">    /// Modifies the number of unscheduled dependencies for this instruction,</span></div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;<span class="comment">    /// and returns the number of remaining dependencies for the containing</span></div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;<span class="comment">    /// bundle.</span></div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;<span class="comment"></span>    <span class="keywordtype">int</span> incrementUnscheduledDeps(<span class="keywordtype">int</span> Incr) {</div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(hasValidDependencies() &amp;&amp;</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;             <span class="stringliteral">&quot;increment of unscheduled deps would be meaningless&quot;</span>);</div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;      UnscheduledDeps += Incr;</div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;      <span class="keywordflow">return</span> FirstInBundle-&gt;unscheduledDepsInBundle();</div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;    }</div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;<span class="comment">    /// Sets the number of unscheduled dependencies to the number of</span></div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;<span class="comment">    /// dependencies.</span></div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> resetUnscheduledDeps() {</div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;      UnscheduledDeps = Dependencies;</div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;    }</div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;<span class="comment">    /// Clears all dependency information.</span></div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> clearDependencies() {</div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;      Dependencies = InvalidDeps;</div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;      resetUnscheduledDeps();</div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;      MemoryDependencies.clear();</div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;      ControlDependencies.clear();</div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;    }</div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160; </div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;    <span class="keywordtype">int</span> unscheduledDepsInBundle()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isSchedulingEntity() &amp;&amp; <span class="stringliteral">&quot;only meaningful on the bundle&quot;</span>);</div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;      <span class="keywordtype">int</span> Sum = 0;</div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">const</span> ScheduleData *BundleMember = <span class="keyword">this</span>; BundleMember;</div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;           BundleMember = BundleMember-&gt;NextInBundle) {</div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;        <span class="keywordflow">if</span> (BundleMember-&gt;UnscheduledDeps == InvalidDeps)</div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;          <span class="keywordflow">return</span> InvalidDeps;</div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;        Sum += BundleMember-&gt;UnscheduledDeps;</div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;      }</div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;      <span class="keywordflow">return</span> Sum;</div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;    }</div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160; </div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a03503773241005f01b090b9862aad304">dump</a>(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;os)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;      <span class="keywordflow">if</span> (!isSchedulingEntity()) {</div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;        os &lt;&lt; <span class="stringliteral">&quot;/ &quot;</span> &lt;&lt; *Inst;</div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NextInBundle) {</div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;        os &lt;&lt; <span class="charliteral">&#39;[&#39;</span> &lt;&lt; *Inst;</div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;        ScheduleData *SD = NextInBundle;</div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;        <span class="keywordflow">while</span> (SD) {</div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;          os &lt;&lt; <span class="charliteral">&#39;;&#39;</span> &lt;&lt; *SD-&gt;Inst;</div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;          SD = SD-&gt;NextInBundle;</div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;        }</div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;        os &lt;&lt; <span class="charliteral">&#39;]&#39;</span>;</div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;        os &lt;&lt; *Inst;</div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;      }</div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;    }</div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160; </div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;<span class="comment">    /// Opcode of the current instruction in the schedule data.</span></div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1Value.html">Value</a> *OpValue = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;<span class="comment">    /// The TreeEntry that this instruction corresponds to.</span></div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;<span class="comment"></span>    TreeEntry *<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;<span class="comment">    /// Points to the head in an instruction bundle (and always to this for</span></div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;<span class="comment">    /// single instructions).</span></div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;<span class="comment"></span>    ScheduleData *FirstInBundle = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;<span class="comment">    /// Single linked list of all instructions in a bundle. Null if it is a</span></div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;<span class="comment">    /// single instruction.</span></div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;<span class="comment"></span>    ScheduleData *NextInBundle = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;<span class="comment">    /// Single linked list of all memory instructions (e.g. load, store, call)</span></div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;<span class="comment">    /// in the block - until the end of the scheduling region.</span></div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;<span class="comment"></span>    ScheduleData *NextLoadStore = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;<span class="comment">    /// The dependent memory instructions.</span></div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;<span class="comment">    /// This list is derived on demand in calculateDependencies().</span></div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;ScheduleData *, 4&gt;</a> MemoryDependencies;</div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;<span class="comment">    /// List of instructions which this instruction could be control dependent</span></div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;<span class="comment">    /// on.  Allowing such nodes to be scheduled below this one could introduce</span></div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;<span class="comment">    /// a runtime fault which didn&#39;t exist in the original program.</span></div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;<span class="comment">    /// ex: this is a load or udiv following a readonly call which inf loops</span></div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;ScheduleData *, 4&gt;</a> ControlDependencies;</div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;<span class="comment">    /// This ScheduleData is in the current scheduling region if this matches</span></div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;<span class="comment">    /// the current SchedulingRegionID of BlockScheduling.</span></div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;<span class="comment"></span>    <span class="keywordtype">int</span> SchedulingRegionID = 0;</div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;<span class="comment">    /// Used for getting a &quot;good&quot; final ordering of instructions.</span></div>
<div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;<span class="comment"></span>    <span class="keywordtype">int</span> SchedulingPriority = 0;</div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;<span class="comment">    /// The number of dependencies. Constitutes of the number of users of the</span></div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;<span class="comment">    /// instruction plus the number of dependent memory instructions (if any).</span></div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;<span class="comment">    /// This value is calculated on demand.</span></div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;<span class="comment">    /// If InvalidDeps, the number of dependencies is not calculated yet.</span></div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;<span class="comment"></span>    <span class="keywordtype">int</span> Dependencies = InvalidDeps;</div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;<span class="comment">    /// The number of dependencies minus the number of dependencies of scheduled</span></div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;<span class="comment">    /// instructions. As soon as this is zero, the instruction/bundle gets ready</span></div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;<span class="comment">    /// for scheduling.</span></div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;<span class="comment">    /// Note that this is negative as long as Dependencies is not calculated.</span></div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;<span class="comment"></span>    <span class="keywordtype">int</span> UnscheduledDeps = InvalidDeps;</div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;<span class="comment">    /// True if this instruction is scheduled (or considered as scheduled in the</span></div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;<span class="comment">    /// dry-run).</span></div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span> IsScheduled = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;  };</div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160; </div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l03064"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a59c27b232cd05843ebd28dd6b0852ea5"> 3064</a></span>&#160;  <span class="keyword">friend</span> <span class="keyword">inline</span> <a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;<a class="code" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a59c27b232cd05843ebd28dd6b0852ea5">operator&lt;&lt;</a>(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;os,</div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;                                        <span class="keyword">const</span> BoUpSLP::ScheduleData &amp;SD) {</div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;    SD.dump(os);</div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;    <span class="keywordflow">return</span> os;</div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;  }</div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160; </div>
<div class="line"><a name="l03071"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a01ca80cf3ebaaf7a2923280b9ae1cfe8"> 3071</a></span>&#160;  <span class="keyword">friend</span> <span class="keyword">struct </span><a class="code" href="structllvm_1_1GraphTraits.html">GraphTraits</a>&lt;<a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> *&gt;;</div>
<div class="line"><a name="l03072"></a><span class="lineno"><a class="line" href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a00a020a143720f62cbf698f3da52aab8"> 3072</a></span>&#160;  <span class="keyword">friend</span> <span class="keyword">struct </span><a class="code" href="structllvm_1_1DOTGraphTraits.html">DOTGraphTraits</a>&lt;<a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> *&gt;;</div>
<div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;<span class="comment">  /// Contains all scheduling data for a basic block.</span></div>
<div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;<span class="comment">  /// It does not schedules instructions, which are not memory read/write</span></div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;<span class="comment">  /// instructions and their operands are either constants, or arguments, or</span></div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;<span class="comment">  /// phis, or instructions from others blocks, or their users are phis or from</span></div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;<span class="comment">  /// the other blocks. The resulting vector instructions can be placed at the</span></div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;<span class="comment">  /// beginning of the basic block without scheduling (if operands does not need</span></div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;<span class="comment">  /// to be scheduled) or at the end of the block (if users are outside of the</span></div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;<span class="comment">  /// block). It allows to save some compile time and memory used by the</span></div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;<span class="comment">  /// compiler.</span></div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;<span class="comment">  /// ScheduleData is assigned for each instruction in between the boundaries of</span></div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;<span class="comment">  /// the tree entry, even for those, which are not part of the graph. It is</span></div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;<span class="comment">  /// required to correctly follow the dependencies between the instructions and</span></div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;<span class="comment">  /// their correct scheduling. The ScheduleData is not allocated for the</span></div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;<span class="comment">  /// instructions, which do not require scheduling, like phis, nodes with</span></div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;<span class="comment">  /// extractelements/insertelements only or nodes with instructions, with</span></div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;<span class="comment">  /// uses/operands outside of the block.</span></div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;<span class="comment"></span>  <span class="keyword">struct </span>BlockScheduling {</div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;    BlockScheduling(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;        : <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>), ChunkSize(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;size()), ChunkPos(ChunkSize) {}</div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160; </div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="Coroutines_8cpp.html#ac781ce96aa25ba7f6fd38f72de665450">clear</a>() {</div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;      ReadyInsts.clear();</div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;      ScheduleStart = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;      ScheduleEnd = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;      FirstLoadStoreInRegion = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;      LastLoadStoreInRegion = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;      RegionHasStackSave = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160; </div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;      <span class="comment">// Reduce the maximum schedule region size by the size of the</span></div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;      <span class="comment">// previous scheduling run.</span></div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;      ScheduleRegionSizeLimit -= ScheduleRegionSize;</div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;      <span class="keywordflow">if</span> (ScheduleRegionSizeLimit &lt; <a class="code" href="SLPVectorizer_8cpp.html#a3d78104bfada8d17dad04e588b7d9a17">MinScheduleRegionSize</a>)</div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;        ScheduleRegionSizeLimit = <a class="code" href="SLPVectorizer_8cpp.html#a3d78104bfada8d17dad04e588b7d9a17">MinScheduleRegionSize</a>;</div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;      ScheduleRegionSize = 0;</div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160; </div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;      <span class="comment">// Make a new scheduling region, i.e. all existing ScheduleData is not</span></div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;      <span class="comment">// in the new region yet.</span></div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;      ++SchedulingRegionID;</div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;    }</div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160; </div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;    ScheduleData *getScheduleData(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> != <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent())</div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;        <span class="comment">// Avoid lookup if can&#39;t possibly be in map.</span></div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;      ScheduleData *SD = ScheduleDataMap.lookup(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;      <span class="keywordflow">if</span> (SD &amp;&amp; isInSchedulingRegion(SD))</div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;        <span class="keywordflow">return</span> SD;</div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;    }</div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160; </div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;    ScheduleData *getScheduleData(<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V))</div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;        <span class="keywordflow">return</span> getScheduleData(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;    }</div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160; </div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;    ScheduleData *getScheduleData(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>) {</div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;      <span class="keywordflow">if</span> (V == <a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>)</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;        <span class="keywordflow">return</span> getScheduleData(V);</div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;      <span class="keyword">auto</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = ExtraScheduleDataMap.find(V);</div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != ExtraScheduleDataMap.end()) {</div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;        ScheduleData *SD = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second.lookup(<a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>);</div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;        <span class="keywordflow">if</span> (SD &amp;&amp; isInSchedulingRegion(SD))</div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;          <span class="keywordflow">return</span> SD;</div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;      }</div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;    }</div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160; </div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;    <span class="keywordtype">bool</span> isInSchedulingRegion(ScheduleData *SD)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;      <span class="keywordflow">return</span> SD-&gt;SchedulingRegionID == SchedulingRegionID;</div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;    }</div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;<span class="comment">    /// Marks an instruction as scheduled and puts all dependent ready</span></div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;<span class="comment">    /// instructions into the ready-list.</span></div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;<span class="comment"></span>    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> ReadyListType&gt;</div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;    <span class="keywordtype">void</span> schedule(ScheduleData *SD, ReadyListType &amp;ReadyList) {</div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;      SD-&gt;IsScheduled = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP:   schedule &quot;</span> &lt;&lt; *SD &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160; </div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;      <span class="keywordflow">for</span> (ScheduleData *BundleMember = SD; BundleMember;</div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;           BundleMember = BundleMember-&gt;NextInBundle) {</div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;        <span class="keywordflow">if</span> (BundleMember-&gt;Inst != BundleMember-&gt;OpValue)</div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160; </div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;        <span class="comment">// Handle the def-use chain dependencies.</span></div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160; </div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;        <span class="comment">// Decrement the unscheduled counter and insert to ready list if ready.</span></div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;        <span class="keyword">auto</span> &amp;&amp;DecrUnsched = [<span class="keyword">this</span>, &amp;ReadyList](<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;          doForAllOpcodes(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, [&amp;ReadyList](ScheduleData *OpDef) {</div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;            <span class="keywordflow">if</span> (OpDef &amp;&amp; OpDef-&gt;hasValidDependencies() &amp;&amp;</div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;                OpDef-&gt;incrementUnscheduledDeps(-1) == 0) {</div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;              <span class="comment">// There are no more unscheduled dependencies after</span></div>
<div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;              <span class="comment">// decrementing, so we can put the dependent instruction</span></div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;              <span class="comment">// into the ready list.</span></div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;              ScheduleData *DepBundle = OpDef-&gt;FirstInBundle;</div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;              assert(!DepBundle-&gt;IsScheduled &amp;&amp;</div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;                     <span class="stringliteral">&quot;already scheduled bundle gets ready&quot;</span>);</div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;              ReadyList.insert(DepBundle);</div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;              LLVM_DEBUG(dbgs()</div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;                         &lt;&lt; <span class="stringliteral">&quot;SLP:    gets ready (def): &quot;</span> &lt;&lt; *DepBundle &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;            }</div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;          });</div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;        };</div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160; </div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;        <span class="comment">// If BundleMember is a vector bundle, its operands may have been</span></div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;        <span class="comment">// reordered during buildTree(). We therefore need to get its operands</span></div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;        <span class="comment">// through the TreeEntry.</span></div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;        <span class="keywordflow">if</span> (TreeEntry *TE = BundleMember-&gt;TE) {</div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;          <span class="comment">// Need to search for the lane since the tree entry can be reordered.</span></div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;          <span class="keywordtype">int</span> Lane = std::distance(TE-&gt;Scalars.begin(),</div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;                                   <a class="code" href="namespacellvm.html#a086e9fbdb06276db7753101a08a63adf">find</a>(TE-&gt;Scalars, BundleMember-&gt;Inst));</div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Lane &gt;= 0 &amp;&amp; <span class="stringliteral">&quot;Lane not set&quot;</span>);</div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160; </div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;          <span class="comment">// Since vectorization tree is being built recursively this assertion</span></div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;          <span class="comment">// ensures that the tree entry has all operands set before reaching</span></div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;          <span class="comment">// this code. Couple of exceptions known at the moment are extracts</span></div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;          <span class="comment">// where their second (immediate) operand is not added. Since</span></div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;          <span class="comment">// immediates do not affect scheduler behavior this is considered</span></div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;          <span class="comment">// okay.</span></div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;          <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a> = BundleMember-&gt;Inst;</div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a> &amp;&amp;</div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;                 (isa&lt;ExtractValueInst, ExtractElementInst&gt;(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>) ||</div>
<div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;                  <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>-&gt;getNumOperands() == TE-&gt;getNumOperands()) &amp;&amp;</div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;                 <span class="stringliteral">&quot;Missed TreeEntry operands?&quot;</span>);</div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;          (void)<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>; <span class="comment">// fake use to avoid build failure when assertions disabled</span></div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160; </div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> OpIdx = 0, NumOperands = TE-&gt;getNumOperands();</div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;               OpIdx != NumOperands; ++OpIdx)</div>
<div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;            <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(TE-&gt;getOperand(OpIdx)[Lane]))</div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;              DecrUnsched(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;          <span class="comment">// If BundleMember is a stand-alone instruction, no operand reordering</span></div>
<div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;          <span class="comment">// has taken place, so we directly access its operands.</span></div>
<div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U : BundleMember-&gt;Inst-&gt;operands())</div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;            <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(U.get()))</div>
<div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;              DecrUnsched(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;        }</div>
<div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;        <span class="comment">// Handle the memory dependencies.</span></div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;        <span class="keywordflow">for</span> (ScheduleData *MemoryDepSD : BundleMember-&gt;MemoryDependencies) {</div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;          <span class="keywordflow">if</span> (MemoryDepSD-&gt;hasValidDependencies() &amp;&amp;</div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;              MemoryDepSD-&gt;incrementUnscheduledDeps(-1) == 0) {</div>
<div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;            <span class="comment">// There are no more unscheduled dependencies after decrementing,</span></div>
<div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;            <span class="comment">// so we can put the dependent instruction into the ready list.</span></div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;            ScheduleData *DepBundle = MemoryDepSD-&gt;FirstInBundle;</div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;            <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!DepBundle-&gt;IsScheduled &amp;&amp;</div>
<div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;                   <span class="stringliteral">&quot;already scheduled bundle gets ready&quot;</span>);</div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;            ReadyList.insert(DepBundle);</div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;            <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</div>
<div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;                       &lt;&lt; <span class="stringliteral">&quot;SLP:    gets ready (mem): &quot;</span> &lt;&lt; *DepBundle &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;          }</div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;        }</div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;        <span class="comment">// Handle the control dependencies.</span></div>
<div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;        <span class="keywordflow">for</span> (ScheduleData *DepSD : BundleMember-&gt;ControlDependencies) {</div>
<div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;          <span class="keywordflow">if</span> (DepSD-&gt;incrementUnscheduledDeps(-1) == 0) {</div>
<div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;            <span class="comment">// There are no more unscheduled dependencies after decrementing,</span></div>
<div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;            <span class="comment">// so we can put the dependent instruction into the ready list.</span></div>
<div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;            ScheduleData *DepBundle = DepSD-&gt;FirstInBundle;</div>
<div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;            <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!DepBundle-&gt;IsScheduled &amp;&amp;</div>
<div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;                   <span class="stringliteral">&quot;already scheduled bundle gets ready&quot;</span>);</div>
<div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;            ReadyList.insert(DepBundle);</div>
<div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;            <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</div>
<div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;                       &lt;&lt; <span class="stringliteral">&quot;SLP:    gets ready (ctl): &quot;</span> &lt;&lt; *DepBundle &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;          }</div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;        }</div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160; </div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;      }</div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;    }</div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;<span class="comment">    /// Verify basic self consistency properties of the data structure.</span></div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> <a class="code" href="PPCCTRLoopsVerify_8cpp.html#a593cc2f204f7b2edc16ee222c37c3196">verify</a>() {</div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;      <span class="keywordflow">if</span> (!ScheduleStart)</div>
<div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160; </div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ScheduleStart-&gt;getParent() == ScheduleEnd-&gt;getParent() &amp;&amp;</div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;             ScheduleStart-&gt;comesBefore(ScheduleEnd) &amp;&amp;</div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;             <span class="stringliteral">&quot;Not a valid scheduling region?&quot;</span>);</div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160; </div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = ScheduleStart; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != ScheduleEnd; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNextNode()) {</div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;        <span class="keyword">auto</span> *SD = getScheduleData(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;        <span class="keywordflow">if</span> (!SD)</div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isInSchedulingRegion(SD) &amp;&amp;</div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;               <span class="stringliteral">&quot;primary schedule data not in window?&quot;</span>);</div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isInSchedulingRegion(SD-&gt;FirstInBundle) &amp;&amp;</div>
<div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;               <span class="stringliteral">&quot;entire bundle in window!&quot;</span>);</div>
<div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;        (void)SD;</div>
<div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;        doForAllOpcodes(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, [](ScheduleData *SD) { SD-&gt;verify(); });</div>
<div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;      }</div>
<div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160; </div>
<div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *SD : ReadyInsts) {</div>
<div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SD-&gt;isSchedulingEntity() &amp;&amp; SD-&gt;isReady() &amp;&amp;</div>
<div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;               <span class="stringliteral">&quot;item in ready list not ready?&quot;</span>);</div>
<div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;        (void)SD;</div>
<div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;      }</div>
<div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;    }</div>
<div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160; </div>
<div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;    <span class="keywordtype">void</span> doForAllOpcodes(<a class="code" href="classllvm_1_1Value.html">Value</a> *V,</div>
<div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;                         <a class="code" href="classllvm_1_1function__ref.html">function_ref</a>&lt;<span class="keywordtype">void</span>(ScheduleData *SD)&gt; Action) {</div>
<div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;      <span class="keywordflow">if</span> (ScheduleData *SD = getScheduleData(V))</div>
<div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;        Action(SD);</div>
<div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;      <span class="keyword">auto</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = ExtraScheduleDataMap.find(V);</div>
<div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != ExtraScheduleDataMap.end())</div>
<div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> : <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second)</div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;          <span class="keywordflow">if</span> (isInSchedulingRegion(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>.second))</div>
<div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;            Action(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>.second);</div>
<div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;    }</div>
<div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;<span class="comment">    /// Put all instructions into the ReadyList which are ready for scheduling.</span></div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;<span class="comment"></span>    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> ReadyListType&gt;</div>
<div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;    <span class="keywordtype">void</span> initialFillReadyList(ReadyListType &amp;ReadyList) {</div>
<div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = ScheduleStart; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != ScheduleEnd; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNextNode()) {</div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;        doForAllOpcodes(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, [&amp;](ScheduleData *SD) {</div>
<div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;          <span class="keywordflow">if</span> (SD-&gt;isSchedulingEntity() &amp;&amp; SD-&gt;hasValidDependencies() &amp;&amp;</div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;              SD-&gt;isReady()) {</div>
<div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;            ReadyList.insert(SD);</div>
<div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;            LLVM_DEBUG(dbgs()</div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;                       &lt;&lt; <span class="stringliteral">&quot;SLP:    initially in ready list: &quot;</span> &lt;&lt; *SD &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;          }</div>
<div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;        });</div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;      }</div>
<div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;    }</div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;<span class="comment">    /// Build a bundle from the ScheduleData nodes corresponding to the</span></div>
<div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;<span class="comment">    /// scalar instruction for each lane.</span></div>
<div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;<span class="comment"></span>    ScheduleData *buildBundle(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL);</div>
<div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;<span class="comment">    /// Checks if a bundle of instructions can be scheduled, i.e. has no</span></div>
<div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;<span class="comment">    /// cyclic dependencies. This is only a dry-run, no instructions are</span></div>
<div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;<span class="comment">    /// actually moved at this stage.</span></div>
<div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;<span class="comment">    /// \returns the scheduling bundle. The returned Optional value is not</span></div>
<div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;<span class="comment">    /// std::nullopt if \p VL is allowed to be scheduled.</span></div>
<div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;<span class="comment"></span>    std::optional&lt;ScheduleData *&gt;</div>
<div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;    tryScheduleBundle(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL, <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> *SLP,</div>
<div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;                      <span class="keyword">const</span> InstructionsState &amp;<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>);</div>
<div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;<span class="comment">    /// Un-bundles a group of instructions.</span></div>
<div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> cancelScheduling(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL, <a class="code" href="classllvm_1_1Value.html">Value</a> *OpValue);</div>
<div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;<span class="comment">    /// Allocates schedule data chunk.</span></div>
<div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;<span class="comment"></span>    ScheduleData *allocateScheduleDataChunks();</div>
<div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;<span class="comment">    /// Extends the scheduling region so that V is inside the region.</span></div>
<div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;<span class="comment">    /// \returns true if the region size is within the limit.</span></div>
<div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span> extendSchedulingRegion(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <span class="keyword">const</span> InstructionsState &amp;<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>);</div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;<span class="comment">    /// Initialize the ScheduleData structures for new instructions in the</span></div>
<div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;<span class="comment">    /// scheduling region.</span></div>
<div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> initScheduleData(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *FromI, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ToI,</div>
<div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;                          ScheduleData *PrevLoadStore,</div>
<div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;                          ScheduleData *NextLoadStore);</div>
<div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;<span class="comment">    /// Updates the dependency information of a bundle and of all instructions/</span></div>
<div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;<span class="comment">    /// bundles which depend on the original bundle.</span></div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> calculateDependencies(ScheduleData *SD, <span class="keywordtype">bool</span> InsertInReadyList,</div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;                               <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> *SLP);</div>
<div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;<span class="comment">    /// Sets all instruction in the scheduling region to un-scheduled.</span></div>
<div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> resetSchedule();</div>
<div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160; </div>
<div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>;</div>
<div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;<span class="comment">    /// Simple memory allocation for ScheduleData.</span></div>
<div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;<span class="comment"></span>    std::vector&lt;std::unique_ptr&lt;ScheduleData[]&gt;&gt; ScheduleDataChunks;</div>
<div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;<span class="comment">    /// The size of a ScheduleData array in ScheduleDataChunks.</span></div>
<div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;<span class="comment"></span>    <span class="keywordtype">int</span> ChunkSize;</div>
<div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;<span class="comment">    /// The allocator position in the current chunk, which is the last entry</span></div>
<div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;<span class="comment">    /// of ScheduleDataChunks.</span></div>
<div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;<span class="comment"></span>    <span class="keywordtype">int</span> ChunkPos;</div>
<div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;<span class="comment">    /// Attaches ScheduleData to Instruction.</span></div>
<div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;<span class="comment">    /// Note that the mapping survives during all vectorization iterations, i.e.</span></div>
<div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;<span class="comment">    /// ScheduleData structures are recycled.</span></div>
<div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Instruction *, ScheduleData *&gt;</a> ScheduleDataMap;</div>
<div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;<span class="comment">    /// Attaches ScheduleData to Instruction with the leading key.</span></div>
<div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, SmallDenseMap&lt;Value *, ScheduleData *&gt;</a>&gt;</div>
<div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;        ExtraScheduleDataMap;</div>
<div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;<span class="comment">    /// The ready-list for scheduling (only used for the dry-run).</span></div>
<div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;ScheduleData *&gt;</a> ReadyInsts;</div>
<div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;<span class="comment">    /// The first instruction of the scheduling region.</span></div>
<div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ScheduleStart = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;<span class="comment">    /// The first instruction _after_ the scheduling region.</span></div>
<div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ScheduleEnd = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;<span class="comment">    /// The first memory accessing instruction in the scheduling region</span></div>
<div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;<span class="comment">    /// (can be null).</span></div>
<div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;<span class="comment"></span>    ScheduleData *FirstLoadStoreInRegion = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;<span class="comment">    /// The last memory accessing instruction in the scheduling region</span></div>
<div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;<span class="comment">    /// (can be null).</span></div>
<div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;<span class="comment"></span>    ScheduleData *LastLoadStoreInRegion = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;<span class="comment">    /// Is there an llvm.stacksave or llvm.stackrestore in the scheduling</span></div>
<div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;<span class="comment">    /// region?  Used to optimize the dependence calculation for the</span></div>
<div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;<span class="comment">    /// common case where there isn&#39;t.</span></div>
<div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span> RegionHasStackSave = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;<span class="comment">    /// The current size of the scheduling region.</span></div>
<div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;<span class="comment"></span>    <span class="keywordtype">int</span> ScheduleRegionSize = 0;</div>
<div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;<span class="comment">    /// The maximum size allowed for the scheduling region.</span></div>
<div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;<span class="comment"></span>    <span class="keywordtype">int</span> ScheduleRegionSizeLimit = <a class="code" href="SLPVectorizer_8cpp.html#adb9592b867016414cf26ca6bad0dc544">ScheduleRegionSizeBudget</a>;</div>
<div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;<span class="comment">    /// The ID of the scheduling region. For a new vectorization iteration this</span></div>
<div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;<span class="comment">    /// is incremented which &quot;removes&quot; all ScheduleData from the region.</span></div>
<div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;<span class="comment">    /// Make sure that the initial SchedulingRegionID is greater than the</span></div>
<div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;<span class="comment">    /// initial SchedulingRegionID in ScheduleData (which is 0).</span></div>
<div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;<span class="comment"></span>    <span class="keywordtype">int</span> SchedulingRegionID = 1;</div>
<div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;  };</div>
<div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;<span class="comment">  /// Attaches the BlockScheduling structures to basic blocks.</span></div>
<div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;BasicBlock *, std::unique_ptr&lt;BlockScheduling&gt;</a>&gt; BlocksSchedules;</div>
<div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;<span class="comment">  /// Performs the &quot;real&quot; scheduling. Done before vectorization is actually</span></div>
<div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;<span class="comment">  /// performed in a basic block.</span></div>
<div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> scheduleBlock(BlockScheduling *BS);</div>
<div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;<span class="comment">  /// List of users to ignore during scheduling and that don&#39;t need extracting.</span></div>
<div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;<span class="comment"></span>  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallDenseSet.html">SmallDenseSet&lt;Value *&gt;</a> *UserIgnoreList = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;<span class="comment">  /// A DenseMapInfo implementation for holding DenseMaps and DenseSets of</span></div>
<div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;<span class="comment">  /// sorted SmallVectors of unsigned.</span></div>
<div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;<span class="comment"></span>  <span class="keyword">struct </span>OrdersTypeDenseMapInfo {</div>
<div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;    <span class="keyword">static</span> OrdersType getEmptyKey() {</div>
<div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;      OrdersType V;</div>
<div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;      V.push_back(~1U);</div>
<div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;      <span class="keywordflow">return</span> V;</div>
<div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;    }</div>
<div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160; </div>
<div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;    <span class="keyword">static</span> OrdersType getTombstoneKey() {</div>
<div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;      OrdersType V;</div>
<div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;      V.push_back(~2U);</div>
<div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;      <span class="keywordflow">return</span> V;</div>
<div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;    }</div>
<div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160; </div>
<div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">unsigned</span> getHashValue(<span class="keyword">const</span> OrdersType &amp;V) {</div>
<div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span><span class="keyword">&gt;</span>(<a class="code" href="namespacellvm.html#af80edfc5e42059e045aa7bf7fe42bee3">hash_combine_range</a>(V.begin(), V.end()));</div>
<div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;    }</div>
<div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160; </div>
<div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#a0f0d66fa63bebb53ddd51f1cc4def0f8">isEqual</a>(<span class="keyword">const</span> OrdersType &amp;<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <span class="keyword">const</span> OrdersType &amp;<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) {</div>
<div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> == <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>;</div>
<div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;    }</div>
<div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;  };</div>
<div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160; </div>
<div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;  <span class="comment">// Analysis and block reference.</span></div>
<div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;  <a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>;</div>
<div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;  <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> *SE;</div>
<div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;  <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> *<a class="code" href="namespacellvm.html#aa0d69e81725c10fa5407f0bf34462068">TTI</a>;</div>
<div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;  <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> *TLI;</div>
<div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;  <a class="code" href="classllvm_1_1LoopInfo.html">LoopInfo</a> *LI;</div>
<div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;  <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> *DT;</div>
<div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;  <a class="code" href="classllvm_1_1AssumptionCache.html">AssumptionCache</a> *AC;</div>
<div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;  <a class="code" href="classllvm_1_1DemandedBits.html">DemandedBits</a> *<a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46a8a67c950f093761829058d45fbc3f522">DB</a>;</div>
<div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>;</div>
<div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;  <a class="code" href="classllvm_1_1OptimizationRemarkEmitter.html">OptimizationRemarkEmitter</a> *ORE;</div>
<div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160; </div>
<div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;  <span class="keywordtype">unsigned</span> MaxVecRegSize; <span class="comment">// This is set by TTI or overridden by cl::opt.</span></div>
<div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;  <span class="keywordtype">unsigned</span> MinVecRegSize; <span class="comment">// Set by cl::opt (default: 128).</span></div>
<div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;<span class="comment">  /// Instruction builder to construct the vectorized tree.</span></div>
<div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>;</div>
<div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;<span class="comment">  /// A map of scalar integer values to the smallest bit width with which they</span></div>
<div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;<span class="comment">  /// can legally be represented. The values map to (width, signed) pairs,</span></div>
<div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;<span class="comment">  /// where &quot;width&quot; indicates the minimum bit width and &quot;signed&quot; is True if the</span></div>
<div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;<span class="comment">  /// value must be signed-extended, rather than zero-extended, back to its</span></div>
<div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;<span class="comment">  /// original width.</span></div>
<div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;Value *, std::pair&lt;uint64_t, bool&gt;</a>&gt; MinBWs;</div>
<div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;};</div>
<div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160; </div>
<div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;} <span class="comment">// end namespace slpvectorizer</span></div>
<div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160; </div>
<div class="line"><a name="l03451"></a><span class="lineno"><a class="line" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html"> 3451</a></span>&#160;<span class="keyword">template</span> &lt;&gt; <span class="keyword">struct </span><a class="code" href="structllvm_1_1GraphTraits.html">GraphTraits</a>&lt;<a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> *&gt; {</div>
<div class="line"><a name="l03452"></a><span class="lineno"><a class="line" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a7ceeff5a65c10abe289db52446ac088a"> 3452</a></span>&#160;  <span class="keyword">using</span> <a class="code" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a7ceeff5a65c10abe289db52446ac088a">TreeEntry</a> = BoUpSLP::TreeEntry;</div>
<div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;<span class="comment">  /// NodeRef has to be a pointer per the GraphWriter.</span></div>
<div class="line"><a name="l03455"></a><span class="lineno"><a class="line" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a55cdb660a488b62f949a57dc65f5296e"> 3455</a></span>&#160;<span class="comment"></span>  <span class="keyword">using</span> <a class="code" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a55cdb660a488b62f949a57dc65f5296e">NodeRef</a> = <a class="code" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a7ceeff5a65c10abe289db52446ac088a">TreeEntry</a> *;</div>
<div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160; </div>
<div class="line"><a name="l03457"></a><span class="lineno"><a class="line" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#aba5049d783b8594ef0a36b6c1d1a973b"> 3457</a></span>&#160;  <span class="keyword">using</span> <a class="code" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#aba5049d783b8594ef0a36b6c1d1a973b">ContainerTy</a> = BoUpSLP::TreeEntry::VecTreeTy;</div>
<div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;<span class="comment">  /// Add the VectorizableTree to the index iterator to be able to return</span></div>
<div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;<span class="comment">  /// TreeEntry pointers.</span></div>
<div class="line"><a name="l03461"></a><span class="lineno"><a class="line" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1ChildIteratorType.html"> 3461</a></span>&#160;<span class="comment"></span>  <span class="keyword">struct </span>ChildIteratorType</div>
<div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;      : <span class="keyword">public</span> <a class="code" href="classllvm_1_1iterator__adaptor__base.html">iterator_adaptor_base</a>&lt;</div>
<div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;            ChildIteratorType, SmallVector&lt;BoUpSLP::EdgeInfo, 1&gt;::iterator&gt; {</div>
<div class="line"><a name="l03464"></a><span class="lineno"><a class="line" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1ChildIteratorType.html#afd5f85f0c5276e1cc3a9bcee214ab81e"> 3464</a></span>&#160;    <a class="code" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#aba5049d783b8594ef0a36b6c1d1a973b">ContainerTy</a> &amp;<a class="code" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1ChildIteratorType.html#afd5f85f0c5276e1cc3a9bcee214ab81e">VectorizableTree</a>;</div>
<div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160; </div>
<div class="line"><a name="l03466"></a><span class="lineno"><a class="line" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1ChildIteratorType.html#aa709fbae8ecf0c4d40fdbbcd1a37114f"> 3466</a></span>&#160;    <a class="code" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1ChildIteratorType.html#aa709fbae8ecf0c4d40fdbbcd1a37114f">ChildIteratorType</a>(<a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BoUpSLP::EdgeInfo, 1&gt;::iterator</a> <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa05c79fbfc58d9dd2851c467a1ef166bf">W</a>,</div>
<div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;                      <a class="code" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#aba5049d783b8594ef0a36b6c1d1a973b">ContainerTy</a> &amp;VT)</div>
<div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;        : ChildIteratorType::<a class="code" href="classllvm_1_1iterator__adaptor__base.html">iterator_adaptor_base</a>(<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa05c79fbfc58d9dd2851c467a1ef166bf">W</a>), VectorizableTree(VT) {}</div>
<div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160; </div>
<div class="line"><a name="l03470"></a><span class="lineno"><a class="line" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1ChildIteratorType.html#a078cde4ddd868aff68189c7b4fe56f00"> 3470</a></span>&#160;    <a class="code" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a55cdb660a488b62f949a57dc65f5296e">NodeRef</a> <a class="code" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1ChildIteratorType.html#a078cde4ddd868aff68189c7b4fe56f00">operator*</a>() { <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;UserTE; }</div>
<div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;  };</div>
<div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160; </div>
<div class="line"><a name="l03473"></a><span class="lineno"><a class="line" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a180903be02d9be17b09b5bab0a19cfde"> 3473</a></span>&#160;  <span class="keyword">static</span> <a class="code" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a55cdb660a488b62f949a57dc65f5296e">NodeRef</a> <a class="code" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a180903be02d9be17b09b5bab0a19cfde">getEntryNode</a>(<a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> &amp;R) {</div>
<div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;    <span class="keywordflow">return</span> R.VectorizableTree[0].get();</div>
<div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;  }</div>
<div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160; </div>
<div class="line"><a name="l03477"></a><span class="lineno"><a class="line" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a20073b3e631a14c7639284690a2a3d63"> 3477</a></span>&#160;  <span class="keyword">static</span> ChildIteratorType <a class="code" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a20073b3e631a14c7639284690a2a3d63">child_begin</a>(<a class="code" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a55cdb660a488b62f949a57dc65f5296e">NodeRef</a> <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>) {</div>
<div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;    <span class="keywordflow">return</span> {<a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>-&gt;UserTreeIndices.begin(), <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>-&gt;Container};</div>
<div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;  }</div>
<div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160; </div>
<div class="line"><a name="l03481"></a><span class="lineno"><a class="line" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a0471d402d5bb1c256eeefc915d2bc00b"> 3481</a></span>&#160;  <span class="keyword">static</span> ChildIteratorType <a class="code" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a0471d402d5bb1c256eeefc915d2bc00b">child_end</a>(<a class="code" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a55cdb660a488b62f949a57dc65f5296e">NodeRef</a> <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>) {</div>
<div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;    <span class="keywordflow">return</span> {<a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>-&gt;UserTreeIndices.end(), <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>-&gt;Container};</div>
<div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;  }</div>
<div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;<span class="comment">  /// For the node iterator we just need to turn the TreeEntry iterator into a</span></div>
<div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;<span class="comment">  /// TreeEntry* iterator so that it dereferences to NodeRef.</span></div>
<div class="line"><a name="l03487"></a><span class="lineno"><a class="line" href="classllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1nodes__iterator.html"> 3487</a></span>&#160;<span class="comment"></span>  <span class="keyword">class </span>nodes_iterator {</div>
<div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;    <span class="keyword">using</span> ItTy = ContainerTy::iterator;</div>
<div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;    ItTy It;</div>
<div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160; </div>
<div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;  <span class="keyword">public</span>:</div>
<div class="line"><a name="l03492"></a><span class="lineno"><a class="line" href="classllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1nodes__iterator.html#a4c4742270efd4962f67118785836da65"> 3492</a></span>&#160;    <a class="code" href="classllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1nodes__iterator.html#a4c4742270efd4962f67118785836da65">nodes_iterator</a>(<span class="keyword">const</span> ItTy &amp;It2) : It(It2) {}</div>
<div class="line"><a name="l03493"></a><span class="lineno"><a class="line" href="classllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1nodes__iterator.html#a7c96b270649e7b4bb961a85c9a03852c"> 3493</a></span>&#160;    <a class="code" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a55cdb660a488b62f949a57dc65f5296e">NodeRef</a> <a class="code" href="classllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1nodes__iterator.html#a7c96b270649e7b4bb961a85c9a03852c">operator*</a>() { <span class="keywordflow">return</span> It-&gt;get(); }</div>
<div class="line"><a name="l03494"></a><span class="lineno"><a class="line" href="classllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1nodes__iterator.html#a110d907b8accd61d00d8a4b2354fc16e"> 3494</a></span>&#160;    nodes_iterator <a class="code" href="classllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1nodes__iterator.html#a110d907b8accd61d00d8a4b2354fc16e">operator++</a>() {</div>
<div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;      ++It;</div>
<div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;      <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;    }</div>
<div class="line"><a name="l03498"></a><span class="lineno"><a class="line" href="classllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1nodes__iterator.html#ae8c02c6d639d41ef827da13f8acf10f4"> 3498</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1nodes__iterator.html#ae8c02c6d639d41ef827da13f8acf10f4">operator!=</a>(<span class="keyword">const</span> nodes_iterator &amp;N2)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> N2.It != It; }</div>
<div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;  };</div>
<div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160; </div>
<div class="line"><a name="l03501"></a><span class="lineno"><a class="line" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a54ec406eac73f6b06dd97f1d58c8bb97"> 3501</a></span>&#160;  <span class="keyword">static</span> nodes_iterator <a class="code" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a54ec406eac73f6b06dd97f1d58c8bb97">nodes_begin</a>(<a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> *R) {</div>
<div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;    <span class="keywordflow">return</span> nodes_iterator(R-&gt;VectorizableTree.begin());</div>
<div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;  }</div>
<div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160; </div>
<div class="line"><a name="l03505"></a><span class="lineno"><a class="line" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#ab4c8013f467416a8c492e3a26fb8b077"> 3505</a></span>&#160;  <span class="keyword">static</span> nodes_iterator <a class="code" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#ab4c8013f467416a8c492e3a26fb8b077">nodes_end</a>(<a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> *R) {</div>
<div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;    <span class="keywordflow">return</span> nodes_iterator(R-&gt;VectorizableTree.end());</div>
<div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;  }</div>
<div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160; </div>
<div class="line"><a name="l03509"></a><span class="lineno"><a class="line" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a69646757cf64341a41b3d5da0824fcc5"> 3509</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <a class="code" href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a69646757cf64341a41b3d5da0824fcc5">size</a>(<a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> *R) { <span class="keywordflow">return</span> R-&gt;VectorizableTree.size(); }</div>
<div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;};</div>
<div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160; </div>
<div class="line"><a name="l03512"></a><span class="lineno"><a class="line" href="structllvm_1_1DOTGraphTraits_3_01BoUpSLP_01_5_01_4.html"> 3512</a></span>&#160;<span class="keyword">template</span> &lt;&gt; <span class="keyword">struct </span><a class="code" href="structllvm_1_1DOTGraphTraits.html">DOTGraphTraits</a>&lt;<a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> *&gt; : <span class="keyword">public</span> <a class="code" href="structllvm_1_1DefaultDOTGraphTraits.html">DefaultDOTGraphTraits</a> {</div>
<div class="line"><a name="l03513"></a><span class="lineno"><a class="line" href="structllvm_1_1DOTGraphTraits_3_01BoUpSLP_01_5_01_4.html#a2c2b4fe580b504831c0fb50183e578a3"> 3513</a></span>&#160;  <span class="keyword">using</span> <a class="code" href="structllvm_1_1DOTGraphTraits_3_01BoUpSLP_01_5_01_4.html#a2c2b4fe580b504831c0fb50183e578a3">TreeEntry</a> = BoUpSLP::TreeEntry;</div>
<div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160; </div>
<div class="line"><a name="l03515"></a><span class="lineno"><a class="line" href="structllvm_1_1DOTGraphTraits_3_01BoUpSLP_01_5_01_4.html#a45a13602ae6871b220b0f63d82853741"> 3515</a></span>&#160;  <a class="code" href="structllvm_1_1DOTGraphTraits_3_01BoUpSLP_01_5_01_4.html#a45a13602ae6871b220b0f63d82853741">DOTGraphTraits</a>(<span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#a3ca9742688618517cc4690fb947fb609">isSimple</a> = <span class="keyword">false</span>) : <a class="code" href="structllvm_1_1DefaultDOTGraphTraits.html">DefaultDOTGraphTraits</a>(<a class="code" href="SLPVectorizer_8cpp.html#a3ca9742688618517cc4690fb947fb609">isSimple</a>) {}</div>
<div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160; </div>
<div class="line"><a name="l03517"></a><span class="lineno"><a class="line" href="structllvm_1_1DOTGraphTraits_3_01BoUpSLP_01_5_01_4.html#a9946c2fd6dbd021039d7ec6e75fce182"> 3517</a></span>&#160;  std::string <a class="code" href="structllvm_1_1DOTGraphTraits_3_01BoUpSLP_01_5_01_4.html#a9946c2fd6dbd021039d7ec6e75fce182">getNodeLabel</a>(<span class="keyword">const</span> <a class="code" href="structllvm_1_1DOTGraphTraits_3_01BoUpSLP_01_5_01_4.html#a2c2b4fe580b504831c0fb50183e578a3">TreeEntry</a> *Entry, <span class="keyword">const</span> <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> *<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>) {</div>
<div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;    std::string Str;</div>
<div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;    <a class="code" href="classllvm_1_1raw__string__ostream.html">raw_string_ostream</a> <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>(Str);</div>
<div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;    <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; Entry-&gt;Idx &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>;</div>
<div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#a6ef5b86735d738868e5fb00a18643b1c">isSplat</a>(Entry-&gt;Scalars))</div>
<div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;      <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; <span class="stringliteral">&quot;&lt;splat&gt; &quot;</span>;</div>
<div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *V : Entry-&gt;Scalars) {</div>
<div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;      <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; *V;</div>
<div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">llvm::any_of</a>(<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>-&gt;ExternalUses, [&amp;](<span class="keyword">const</span> BoUpSLP::ExternalUser &amp;EU) {</div>
<div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;            return EU.Scalar == V;</div>
<div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;          }))</div>
<div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;        <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; <span class="stringliteral">&quot; &lt;extract&gt;&quot;</span>;</div>
<div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;      <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;    }</div>
<div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;    <span class="keywordflow">return</span> Str;</div>
<div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;  }</div>
<div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160; </div>
<div class="line"><a name="l03534"></a><span class="lineno"><a class="line" href="structllvm_1_1DOTGraphTraits_3_01BoUpSLP_01_5_01_4.html#ac476b8b83abaea597007b025fa19a676"> 3534</a></span>&#160;  <span class="keyword">static</span> std::string <a class="code" href="structllvm_1_1DOTGraphTraits_3_01BoUpSLP_01_5_01_4.html#ac476b8b83abaea597007b025fa19a676">getNodeAttributes</a>(<span class="keyword">const</span> <a class="code" href="structllvm_1_1DOTGraphTraits_3_01BoUpSLP_01_5_01_4.html#a2c2b4fe580b504831c0fb50183e578a3">TreeEntry</a> *Entry,</div>
<div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;                                       <span class="keyword">const</span> <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> *) {</div>
<div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;    <span class="keywordflow">if</span> (Entry-&gt;State == TreeEntry::NeedToGather)</div>
<div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;color=red&quot;</span>;</div>
<div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;    <span class="keywordflow">if</span> (Entry-&gt;State == TreeEntry::ScatterVectorize)</div>
<div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;color=blue&quot;</span>;</div>
<div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;  }</div>
<div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;};</div>
<div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160; </div>
<div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;} <span class="comment">// end namespace llvm</span></div>
<div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160; </div>
<div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;BoUpSLP::~BoUpSLP() {</div>
<div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;WeakTrackingVH&gt;</a> DeadInsts;</div>
<div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : DeletedInstructions) {</div>
<div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U : <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands()) {</div>
<div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = dyn_cast&lt;Instruction&gt;(U.get());</div>
<div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> &amp;&amp; !DeletedInstructions.count(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>) &amp;&amp; <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>-&gt;hasOneUser() &amp;&amp;</div>
<div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;          <a class="code" href="namespacellvm.html#a64ac0fc718d697dc3cb861e36b1c591a">wouldInstructionBeTriviallyDead</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>, TLI))</div>
<div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;        DeadInsts.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>);</div>
<div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;    }</div>
<div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;    <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;dropAllReferences();</div>
<div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;  }</div>
<div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : DeletedInstructions) {</div>
<div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;use_empty() &amp;&amp;</div>
<div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;           <span class="stringliteral">&quot;trying to erase instruction with users.&quot;</span>);</div>
<div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;    <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;  }</div>
<div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160; </div>
<div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;  <span class="comment">// Cleanup any dead scalar code feeding the vectorized instructions</span></div>
<div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;  <a class="code" href="namespacellvm.html#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(DeadInsts, TLI);</div>
<div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160; </div>
<div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;<span class="preprocessor">#ifdef EXPENSIVE_CHECKS</span></div>
<div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;  <span class="comment">// If we could guarantee that this call is not extremely slow, we could</span></div>
<div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;  <span class="comment">// remove the ifdef limitation (see PR47712).</span></div>
<div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a class="code" href="namespacellvm.html#a26389c546573f058ad8ecbdc5c1933cf">verifyFunction</a>(*<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, &amp;<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</div>
<div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;}</div>
<div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;<span class="comment">/// Reorders the given \p Reuses mask according to the given \p Mask. \p Reuses</span></div>
<div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;<span class="comment">/// contains original mask for the scalars reused in the node. Procedure</span></div>
<div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;<span class="comment">/// transform this mask in accordance with the given \p Mask.</span></div>
<div class="line"><a name="l03576"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a4a3e80130d3f25468190ba343064b37e"> 3576</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="SLPVectorizer_8cpp.html#a4a3e80130d3f25468190ba343064b37e">reorderReuses</a>(<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;int&gt;</a> &amp;Reuses, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>) {</div>
<div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.empty() &amp;&amp; Reuses.size() == <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size() &amp;&amp;</div>
<div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;         <span class="stringliteral">&quot;Expected non-empty mask.&quot;</span>);</div>
<div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> Prev(Reuses.begin(), Reuses.end());</div>
<div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;  Prev.<a class="code" href="classllvm_1_1SmallVectorImpl.html#abd962b7b01f49ce61ea41ee10c49e313">swap</a>(Reuses);</div>
<div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = Prev.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] != <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;      Reuses[<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]] = Prev[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;}</div>
<div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;<span class="comment">/// Reorders the given \p Order according to the given \p Mask. \p Order - is</span></div>
<div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;<span class="comment">/// the original order of the scalars. Procedure transforms the provided order</span></div>
<div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;<span class="comment">/// in accordance with the given \p Mask. If the resulting \p Order is just an</span></div>
<div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;<span class="comment">/// identity order, \p Order is cleared.</span></div>
<div class="line"><a name="l03590"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a52b518b4e744d8c2d89e04e30e7be715"> 3590</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="SLPVectorizer_8cpp.html#a52b518b4e744d8c2d89e04e30e7be715">reorderOrder</a>(<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;unsigned&gt;</a> &amp;Order, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>) {</div>
<div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.empty() &amp;&amp; <span class="stringliteral">&quot;Expected non-empty mask.&quot;</span>);</div>
<div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> MaskOrder;</div>
<div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;  <span class="keywordflow">if</span> (Order.empty()) {</div>
<div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;    MaskOrder.<a class="code" href="classllvm_1_1SmallVectorImpl.html#ad0b3d8447f88377b62d9c019f3c4e118">resize</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size());</div>
<div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;    std::iota(MaskOrder.begin(), MaskOrder.end(), 0);</div>
<div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;    <a class="code" href="namespacellvm.html#a6f0917bf2ae18fac81fea6bf7e887115">inversePermutation</a>(Order, MaskOrder);</div>
<div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;  }</div>
<div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;  <a class="code" href="SLPVectorizer_8cpp.html#a4a3e80130d3f25468190ba343064b37e">reorderReuses</a>(MaskOrder, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a4bc8953b0fd0277b0e5a8e5b78025150">ShuffleVectorInst::isIdentityMask</a>(MaskOrder)) {</div>
<div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;    Order.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div>
<div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;  }</div>
<div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;  Order.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a38c50aa8e3e9588f4f968c2e03a0cee0">assign</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size(), <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size());</div>
<div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;    <span class="keywordflow">if</span> (MaskOrder[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] != <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;      Order[MaskOrder[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;  <a class="code" href="SLPVectorizer_8cpp.html#acd356293c4520fc1fb4a83de901e5bb7">fixupOrderingIndices</a>(Order);</div>
<div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;}</div>
<div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160; </div>
<div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;std::optional&lt;BoUpSLP::OrdersType&gt;</div>
<div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;BoUpSLP::findReusedOrderedScalars(<span class="keyword">const</span> BoUpSLP::TreeEntry &amp;TE) {</div>
<div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.State == TreeEntry::NeedToGather &amp;&amp; <span class="stringliteral">&quot;Expected gather node only.&quot;</span>);</div>
<div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;  <span class="keywordtype">unsigned</span> NumScalars = <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.Scalars.size();</div>
<div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;  OrdersType CurrentOrder(NumScalars, NumScalars);</div>
<div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> Positions;</div>
<div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;  <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> UsedPositions(NumScalars);</div>
<div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;  <span class="keyword">const</span> TreeEntry *STE = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;  <span class="comment">// Try to find all gathered scalars that are gets vectorized in other</span></div>
<div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;  <span class="comment">// vectorize node. Here we can have only one single tree vector node to</span></div>
<div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;  <span class="comment">// correctly identify order of the gathered scalars.</span></div>
<div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumScalars; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.Scalars[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;    <span class="keywordflow">if</span> (!isa&lt;LoadInst, ExtractElementInst, ExtractValueInst&gt;(V))</div>
<div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> *LocalSTE = getTreeEntry(V)) {</div>
<div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;      <span class="keywordflow">if</span> (!STE)</div>
<div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;        STE = LocalSTE;</div>
<div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (STE != LocalSTE)</div>
<div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;        <span class="comment">// Take the order only from the single vector node.</span></div>
<div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;        <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;      <span class="keywordtype">unsigned</span> Lane =</div>
<div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;          std::distance(STE-&gt;Scalars.begin(), <a class="code" href="namespacellvm.html#a086e9fbdb06276db7753101a08a63adf">find</a>(STE-&gt;Scalars, V));</div>
<div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;      <span class="keywordflow">if</span> (Lane &gt;= NumScalars)</div>
<div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;        <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;      <span class="keywordflow">if</span> (CurrentOrder[Lane] != NumScalars) {</div>
<div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;        <span class="keywordflow">if</span> (Lane != <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;        UsedPositions.reset(CurrentOrder[Lane]);</div>
<div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;      }</div>
<div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;      <span class="comment">// The partial identity (where only some elements of the gather node are</span></div>
<div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;      <span class="comment">// in the identity order) is good.</span></div>
<div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;      CurrentOrder[Lane] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;      UsedPositions.set(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;    }</div>
<div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;  }</div>
<div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;  <span class="comment">// Need to keep the order if we have a vector entry and at least 2 scalars or</span></div>
<div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;  <span class="comment">// the vectorized entry has just 2 scalars.</span></div>
<div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;  <span class="keywordflow">if</span> (STE &amp;&amp; (UsedPositions.count() &gt; 1 || STE-&gt;Scalars.size() == 2)) {</div>
<div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;    <span class="keyword">auto</span> &amp;&amp;IsIdentityOrder = [NumScalars](<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;unsigned&gt;</a> CurrentOrder) {</div>
<div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumScalars; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;        <span class="keywordflow">if</span> (CurrentOrder[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] != <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp; CurrentOrder[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] != NumScalars)</div>
<div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;    };</div>
<div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;    <span class="keywordflow">if</span> (IsIdentityOrder(CurrentOrder)) {</div>
<div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;      CurrentOrder.clear();</div>
<div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;      <span class="keywordflow">return</span> CurrentOrder;</div>
<div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;    }</div>
<div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;    <span class="keyword">auto</span> *It = CurrentOrder.begin();</div>
<div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumScalars;) {</div>
<div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;      <span class="keywordflow">if</span> (UsedPositions.test(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;        ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;      }</div>
<div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;      <span class="keywordflow">if</span> (*It == NumScalars) {</div>
<div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;        *It = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;        ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;      }</div>
<div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;      ++It;</div>
<div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;    }</div>
<div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;    <span class="keywordflow">return</span> CurrentOrder;</div>
<div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;  }</div>
<div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;  <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;}</div>
<div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160; </div>
<div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div>
<div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;<span class="comment">/// Tracks the state we can represent the loads in the given sequence.</span></div>
<div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;<span class="comment"></span><span class="keyword">enum class</span> LoadsState { Gather, Vectorize, ScatterVectorize };</div>
<div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;} <span class="comment">// anonymous namespace</span></div>
<div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160; </div>
<div class="line"><a name="l03682"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#abf8c65a150fe96c228db5b19d6b09e3a"> 3682</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#abf8c65a150fe96c228db5b19d6b09e3a">arePointersCompatible</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *Ptr1, <a class="code" href="classllvm_1_1Value.html">Value</a> *Ptr2,</div>
<div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;                                  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> &amp;TLI,</div>
<div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;                                  <span class="keywordtype">bool</span> CompareOpcodes = <span class="keyword">true</span>) {</div>
<div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a3b1c5788b85ffa254be0e834edf5cf8f">getUnderlyingObject</a>(Ptr1) != <a class="code" href="namespacellvm.html#a3b1c5788b85ffa254be0e834edf5cf8f">getUnderlyingObject</a>(Ptr2))</div>
<div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;  <span class="keyword">auto</span> *GEP1 = dyn_cast&lt;GetElementPtrInst&gt;(Ptr1);</div>
<div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;  <span class="keywordflow">if</span> (!GEP1)</div>
<div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;  <span class="keyword">auto</span> *GEP2 = dyn_cast&lt;GetElementPtrInst&gt;(Ptr2);</div>
<div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;  <span class="keywordflow">if</span> (!GEP2)</div>
<div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;  <span class="keywordflow">return</span> GEP1-&gt;getNumOperands() == 2 &amp;&amp; GEP2-&gt;getNumOperands() == 2 &amp;&amp;</div>
<div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;         ((<a class="code" href="SLPVectorizer_8cpp.html#a6848b7e929178610d01e1b2b5052af86">isConstant</a>(GEP1-&gt;getOperand(1)) &amp;&amp;</div>
<div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;           <a class="code" href="SLPVectorizer_8cpp.html#a6848b7e929178610d01e1b2b5052af86">isConstant</a>(GEP2-&gt;getOperand(1))) ||</div>
<div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;          !CompareOpcodes ||</div>
<div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;          <a class="code" href="SLPVectorizer_8cpp.html#ae37b3a41d982a793664ab021d9b9b325">getSameOpcode</a>({GEP1-&gt;getOperand(1), GEP2-&gt;getOperand(1)}, TLI)</div>
<div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;              .<a class="code" href="VPlanSLP_8cpp.html#af04704e906a9654777e92a4612c58c13">getOpcode</a>());</div>
<div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;}</div>
<div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;<span class="comment">/// Checks if the given array of loads can be represented as a vectorized,</span></div>
<div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;<span class="comment">/// scatter or just simple gather.</span></div>
<div class="line"><a name="l03703"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a06f9ac1f9413750e1782f666f635a4ed"> 3703</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> LoadsState <a class="code" href="SLPVectorizer_8cpp.html#a06f9ac1f9413750e1782f666f635a4ed">canVectorizeLoads</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL, <span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *VL0,</div>
<div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;                                    <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>,</div>
<div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;                                    <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE,</div>
<div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;                                    <a class="code" href="classllvm_1_1LoopInfo.html">LoopInfo</a> &amp;LI, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> &amp;TLI,</div>
<div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;                                    <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;unsigned&gt;</a> &amp;Order,</div>
<div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;                                    <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Value *&gt;</a> &amp;PointerOps) {</div>
<div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;  <span class="comment">// Check that a vectorized load would load the same memory as a scalar</span></div>
<div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;  <span class="comment">// load. For example, we don&#39;t want to vectorize loads that are smaller</span></div>
<div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;  <span class="comment">// than 8-bit. Even though we have a packed struct {&lt;i2, i2, i2, i2&gt;} LLVM</span></div>
<div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;  <span class="comment">// treats loading/storing it as an i8 struct. If we vectorize loads/stores</span></div>
<div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;  <span class="comment">// from such a struct, we read/write packed bits disagreeing with the</span></div>
<div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;  <span class="comment">// unvectorized version.</span></div>
<div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *ScalarTy = VL0-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160; </div>
<div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(ScalarTy) != <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSizeInBits(ScalarTy))</div>
<div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;    <span class="keywordflow">return</span> LoadsState::Gather;</div>
<div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160; </div>
<div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;  <span class="comment">// Make sure all loads in the bundle are simple - we can&#39;t vectorize</span></div>
<div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;  <span class="comment">// atomic or volatile loads.</span></div>
<div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;  PointerOps.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div>
<div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;  PointerOps.<a class="code" href="classllvm_1_1SmallVectorImpl.html#ad0b3d8447f88377b62d9c019f3c4e118">resize</a>(VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</div>
<div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;  <span class="keyword">auto</span> *POIter = PointerOps.begin();</div>
<div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;    <span class="keyword">auto</span> *L = cast&lt;LoadInst&gt;(V);</div>
<div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;    <span class="keywordflow">if</span> (!L-&gt;isSimple())</div>
<div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;      <span class="keywordflow">return</span> LoadsState::Gather;</div>
<div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;    *POIter = L-&gt;getPointerOperand();</div>
<div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;    ++POIter;</div>
<div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;  }</div>
<div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160; </div>
<div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;  Order.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div>
<div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;  <span class="comment">// Check the order of pointer operands or that all pointers are the same.</span></div>
<div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;  <span class="keywordtype">bool</span> IsSorted = <a class="code" href="namespacellvm.html#a8d9d7c33311a38eae588e12caf8985ce">sortPtrAccesses</a>(PointerOps, ScalarTy, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, SE, Order);</div>
<div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;  <span class="keywordflow">if</span> (IsSorted || <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(PointerOps, [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>) {</div>
<div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="SLPVectorizer_8cpp.html#abf8c65a150fe96c228db5b19d6b09e3a">arePointersCompatible</a>(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>, PointerOps.front(), TLI);</div>
<div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;      })) {</div>
<div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;    <span class="keywordflow">if</span> (IsSorted) {</div>
<div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Ptr0;</div>
<div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *PtrN;</div>
<div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;      <span class="keywordflow">if</span> (Order.empty()) {</div>
<div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;        Ptr0 = PointerOps.front();</div>
<div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;        PtrN = PointerOps.back();</div>
<div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;        Ptr0 = PointerOps[Order.front()];</div>
<div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;        PtrN = PointerOps[Order.back()];</div>
<div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;      }</div>
<div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;      std::optional&lt;int&gt; Diff =</div>
<div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;          <a class="code" href="namespacellvm.html#a034d66b8c0aeb72ea13fd26392083446">getPointersDiff</a>(ScalarTy, Ptr0, ScalarTy, PtrN, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, SE);</div>
<div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;      <span class="comment">// Check that the sorted loads are consecutive.</span></div>
<div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span><span class="keyword">&gt;</span>(*Diff) == VL.size() - 1)</div>
<div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;        <span class="keywordflow">return</span> LoadsState::Vectorize;</div>
<div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;    }</div>
<div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;    <span class="comment">// TODO: need to improve analysis of the pointers, if not all of them are</span></div>
<div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;    <span class="comment">// GEPs or have &gt; 2 operands, we end up with a gather node, which just</span></div>
<div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;    <span class="comment">// increases the cost.</span></div>
<div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;    <a class="code" href="classllvm_1_1Loop.html">Loop</a> *L = LI.<a class="code" href="classllvm_1_1LoopInfoBase.html#a7a7c8e0e4f836c13c015b62e18f386bd">getLoopFor</a>(cast&lt;LoadInst&gt;(VL0)-&gt;<a class="code" href="BasicAliasAnalysis_8cpp.html#a2675de1d8479c7b00387979714da43f7">getParent</a>());</div>
<div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;    <span class="keywordtype">bool</span> ProfitableGatherPointers =</div>
<div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;        <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span><span class="keyword">&gt;</span>(<a class="code" href="namespacellvm.html#ac214df91cdc242f4710ea5a93939c678">count_if</a>(PointerOps, [L](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;          <span class="keywordflow">return</span> L &amp;&amp; L-&gt;<a class="code" href="classllvm_1_1Loop.html#a6cb6a58fb0ded82b4c7755fc4c27c86d">isLoopInvariant</a>(V);</div>
<div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;        })) &lt;= VL.size() / 2 &amp;&amp; VL.size() &gt; 2;</div>
<div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;    <span class="keywordflow">if</span> (ProfitableGatherPointers || <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(PointerOps, [IsSorted](<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>) {</div>
<div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;          <span class="keyword">auto</span> *<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = dyn_cast&lt;GetElementPtrInst&gt;(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>);</div>
<div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;          <span class="keywordflow">return</span> (IsSorted &amp;&amp; !<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a> &amp;&amp; <a class="code" href="namespacellvm.html#a05a7412bf10f2226fb69f2876b76e9cd">doesNotNeedToBeScheduled</a>(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>)) ||</div>
<div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;                 (<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a> &amp;&amp; <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getNumOperands() == 2);</div>
<div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;        })) {</div>
<div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;      <a class="code" href="structllvm_1_1Align.html">Align</a> CommonAlignment = cast&lt;LoadInst&gt;(VL0)-&gt;getAlign();</div>
<div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL)</div>
<div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;        CommonAlignment =</div>
<div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;            <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(CommonAlignment, cast&lt;LoadInst&gt;(V)-&gt;<a class="code" href="namespacellvm.html#a2ec9079c9e11f3cad2a09d84a9c617f6">getAlign</a>());</div>
<div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;      <span class="keyword">auto</span> *VecTy = <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(ScalarTy, VL.size());</div>
<div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>.<a class="code" href="classllvm_1_1TargetTransformInfo.html#a33ac7704be5bd5455f78caf0b5371012">isLegalMaskedGather</a>(VecTy, CommonAlignment) &amp;&amp;</div>
<div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;          !<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>.<a class="code" href="classllvm_1_1TargetTransformInfo.html#a661bd4bd069ee48ef7bf8a7892790468">forceScalarizeMaskedGather</a>(VecTy, CommonAlignment))</div>
<div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;        <span class="keywordflow">return</span> LoadsState::ScatterVectorize;</div>
<div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;    }</div>
<div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;  }</div>
<div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160; </div>
<div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;  <span class="keywordflow">return</span> LoadsState::Gather;</div>
<div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;}</div>
<div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160; </div>
<div class="line"><a name="l03782"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a674549c09f11cbea1872d9d59b6c49df"> 3782</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#a674549c09f11cbea1872d9d59b6c49df">clusterSortPtrAccesses</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL, <a class="code" href="classllvm_1_1Type.html">Type</a> *ElemTy,</div>
<div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;                            <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE,</div>
<div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;                            <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;unsigned&gt;</a> &amp;SortedIndices) {</div>
<div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all_of</a>(</div>
<div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;             VL, [](<span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *V) { <span class="keywordflow">return</span> V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;isPointerTy(); }) &amp;&amp;</div>
<div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;         <span class="stringliteral">&quot;Expected list of pointer operands.&quot;</span>);</div>
<div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;  <span class="comment">// Map from bases to a vector of (Ptr, Offset, OrigIdx), which we insert each</span></div>
<div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;  <span class="comment">// Ptr into, sort and return the sorted indices with values next to one</span></div>
<div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;  <span class="comment">// another.</span></div>
<div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;  <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;Value *, SmallVector&lt;std::tuple&lt;Value *, int, unsigned&gt;</a>&gt;&gt; Bases;</div>
<div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;  Bases[VL[0]].push_back(std::make_tuple(VL[0], 0U, 0U));</div>
<div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160; </div>
<div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;  <span class="keywordtype">unsigned</span> Cnt = 1;</div>
<div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> : VL.<a class="code" href="classllvm_1_1ArrayRef.html#a0b7abf908b6ce436de4d1012f2df7c0c">drop_front</a>()) {</div>
<div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;    <span class="keywordtype">bool</span> Found = <a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(Bases, [&amp;](<span class="keyword">auto</span> &amp;<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>) {</div>
<div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;      std::optional&lt;int&gt; Diff =</div>
<div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;          <a class="code" href="namespacellvm.html#a034d66b8c0aeb72ea13fd26392083446">getPointersDiff</a>(ElemTy, <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>.first, ElemTy, <a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, SE,</div>
<div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;                          <span class="comment">/*StrictCheck=*/</span><span class="keyword">true</span>);</div>
<div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;      <span class="keywordflow">if</span> (!Diff)</div>
<div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160; </div>
<div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;      <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>.second.emplace_back(<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, *Diff, Cnt++);</div>
<div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;    });</div>
<div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160; </div>
<div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;    <span class="keywordflow">if</span> (!Found) {</div>
<div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;      <span class="comment">// If we haven&#39;t found enough to usefully cluster, return early.</span></div>
<div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;      <span class="keywordflow">if</span> (Bases.<a class="code" href="classllvm_1_1MapVector.html#acf4c09e1f30cdd4e0b5b1b8a236ead34">size</a>() &gt; VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() / 2 - 1)</div>
<div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160; </div>
<div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;      <span class="comment">// Not found already - add a new Base</span></div>
<div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;      Bases[<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>].emplace_back(<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, 0, Cnt++);</div>
<div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;    }</div>
<div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;  }</div>
<div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160; </div>
<div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;  <span class="comment">// For each of the bases sort the pointers by Offset and check if any of the</span></div>
<div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;  <span class="comment">// base become consecutively allocated.</span></div>
<div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;  <span class="keywordtype">bool</span> AnyConsecutive = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> : Bases) {</div>
<div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;    <span class="keyword">auto</span> &amp;Vec = <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>.second;</div>
<div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;    <span class="keywordflow">if</span> (Vec.size() &gt; 1) {</div>
<div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;      <a class="code" href="namespacellvm.html#a076f93c387f454f0db13d4bc7d4e7f9c">llvm::stable_sort</a>(Vec, [](<span class="keyword">const</span> std::tuple&lt;Value *, int, unsigned&gt; &amp;<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>,</div>
<div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;                                <span class="keyword">const</span> std::tuple&lt;Value *, int, unsigned&gt; &amp;<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>) {</div>
<div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;        <span class="keywordflow">return</span> std::get&lt;1&gt;(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>) &lt; std::get&lt;1&gt;(<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>);</div>
<div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;      });</div>
<div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;      <span class="keywordtype">int</span> InitialOffset = std::get&lt;1&gt;(Vec[0]);</div>
<div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;      AnyConsecutive |= <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(<a class="code" href="namespacellvm.html#a7b2175e18ff52174fad26b6b68818564">enumerate</a>(Vec), [InitialOffset](<span class="keyword">auto</span> &amp;<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>) {</div>
<div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;        <span class="keywordflow">return</span> std::get&lt;1&gt;(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>.value()) == <a class="code" href="lib_2Target_2README_8txt.html#a3217063f680fa8e35dea3c59b6e52b18">int</a>(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>.index()) + InitialOffset;</div>
<div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;      });</div>
<div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;    }</div>
<div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;  }</div>
<div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160; </div>
<div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;  <span class="comment">// Fill SortedIndices array only if it looks worth-while to sort the ptrs.</span></div>
<div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;  SortedIndices.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div>
<div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;  <span class="keywordflow">if</span> (!AnyConsecutive)</div>
<div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160; </div>
<div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> : Bases) {</div>
<div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="classT.html">T</a> : <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>.second)</div>
<div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;      SortedIndices.push_back(std::get&lt;2&gt;(<a class="code" href="classT.html">T</a>));</div>
<div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;  }</div>
<div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160; </div>
<div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SortedIndices.size() == VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() &amp;&amp;</div>
<div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;         <span class="stringliteral">&quot;Expected SortedIndices to be the size of VL&quot;</span>);</div>
<div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;}</div>
<div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160; </div>
<div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;std::optional&lt;BoUpSLP::OrdersType&gt;</div>
<div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;BoUpSLP::findPartiallyOrderedLoads(<span class="keyword">const</span> BoUpSLP::TreeEntry &amp;TE) {</div>
<div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.State == TreeEntry::NeedToGather &amp;&amp; <span class="stringliteral">&quot;Expected gather node only.&quot;</span>);</div>
<div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *ScalarTy = <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.Scalars[0]-&gt;getType();</div>
<div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160; </div>
<div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *&gt;</a> Ptrs;</div>
<div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;  Ptrs.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.Scalars.size());</div>
<div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.Scalars) {</div>
<div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;    <span class="keyword">auto</span> *L = dyn_cast&lt;LoadInst&gt;(V);</div>
<div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;    <span class="keywordflow">if</span> (!L || !L-&gt;isSimple())</div>
<div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;      <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;    Ptrs.push_back(L-&gt;getPointerOperand());</div>
<div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;  }</div>
<div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160; </div>
<div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;  BoUpSLP::OrdersType Order;</div>
<div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#a674549c09f11cbea1872d9d59b6c49df">clusterSortPtrAccesses</a>(Ptrs, ScalarTy, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, *SE, Order))</div>
<div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;    <span class="keywordflow">return</span> Order;</div>
<div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;  <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;}</div>
<div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;<span class="comment">/// Check if two insertelement instructions are from the same buildvector.</span></div>
<div class="line"><a name="l03870"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#abe6927d96b3815417479246b5afc732e"> 3870</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#abe6927d96b3815417479246b5afc732e">areTwoInsertFromSameBuildVector</a>(</div>
<div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;    <a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> *VU, <a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> *V,</div>
<div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;    <a class="code" href="classllvm_1_1function__ref.html">function_ref</a>&lt;<a class="code" href="classllvm_1_1Value.html">Value</a> *(<a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> *)&gt; GetBaseOperand) {</div>
<div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;  <span class="comment">// Instructions must be from the same basic blocks.</span></div>
<div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;  <span class="keywordflow">if</span> (VU-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() != V-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>())</div>
<div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;  <span class="comment">// Checks if 2 insertelements are from the same buildvector.</span></div>
<div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;  <span class="keywordflow">if</span> (VU-&gt;<a class="code" href="classllvm_1_1InsertElementInst.html#a5532ffa629e5d85d605bb379f7aed857">getType</a>() != V-&gt;<a class="code" href="classllvm_1_1InsertElementInst.html#a5532ffa629e5d85d605bb379f7aed857">getType</a>())</div>
<div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;  <span class="comment">// Multiple used inserts are separate nodes.</span></div>
<div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;  <span class="keywordflow">if</span> (!VU-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; !V-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</div>
<div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;  <span class="keyword">auto</span> *IE1 = VU;</div>
<div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;  <span class="keyword">auto</span> *IE2 = V;</div>
<div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;  std::optional&lt;unsigned&gt; Idx1 = <a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(IE1);</div>
<div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;  std::optional&lt;unsigned&gt; Idx2 = <a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(IE2);</div>
<div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;  <span class="keywordflow">if</span> (Idx1 == std::nullopt || Idx2 == std::nullopt)</div>
<div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;  <span class="comment">// Go through the vector operand of insertelement instructions trying to find</span></div>
<div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;  <span class="comment">// either VU as the original vector for IE2 or V as the original vector for</span></div>
<div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;  <span class="comment">// IE1.</span></div>
<div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;  <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;    <span class="keywordflow">if</span> (IE2 == VU)</div>
<div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;      <span class="keywordflow">return</span> VU-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>();</div>
<div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;    <span class="keywordflow">if</span> (IE1 == V)</div>
<div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;      <span class="keywordflow">return</span> V-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>();</div>
<div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;    <span class="keywordflow">if</span> (IE1) {</div>
<div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;      <span class="keywordflow">if</span> ((IE1 != VU &amp;&amp; !IE1-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>()) ||</div>
<div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;          <a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(IE1).value_or(*Idx2) == *Idx2)</div>
<div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;        IE1 = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;        IE1 = dyn_cast_or_null&lt;InsertElementInst&gt;(GetBaseOperand(IE1));</div>
<div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;    }</div>
<div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;    <span class="keywordflow">if</span> (IE2) {</div>
<div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;      <span class="keywordflow">if</span> ((IE2 != V &amp;&amp; !IE2-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>()) ||</div>
<div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;          <a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(IE2).value_or(*Idx1) == *Idx1)</div>
<div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;        IE2 = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;        IE2 = dyn_cast_or_null&lt;InsertElementInst&gt;(GetBaseOperand(IE2));</div>
<div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;    }</div>
<div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;  } <span class="keywordflow">while</span> (IE1 || IE2);</div>
<div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;}</div>
<div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160; </div>
<div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;std::optional&lt;BoUpSLP::OrdersType&gt; BoUpSLP::getReorderingData(<span class="keyword">const</span> TreeEntry &amp;TE,</div>
<div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;                                                         <span class="keywordtype">bool</span> TopToBottom) {</div>
<div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;  <span class="comment">// No need to reorder if need to shuffle reuses, still need to shuffle the</span></div>
<div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;  <span class="comment">// node.</span></div>
<div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.ReuseShuffleIndices.empty()) {</div>
<div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;    <span class="comment">// Check if reuse shuffle indices can be improved by reordering.</span></div>
<div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;    <span class="comment">// For this, check that reuse mask is &quot;clustered&quot;, i.e. each scalar values</span></div>
<div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;    <span class="comment">// is used once in each submask of size &lt;number_of_scalars&gt;.</span></div>
<div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;    <span class="comment">// Example: 4 scalar values.</span></div>
<div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;    <span class="comment">// ReuseShuffleIndices mask: 0, 1, 2, 3, 3, 2, 0, 1 - clustered.</span></div>
<div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;    <span class="comment">//                           0, 1, 2, 3, 3, 3, 1, 0 - not clustered, because</span></div>
<div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;    <span class="comment">//                           element 3 is used twice in the second submask.</span></div>
<div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;    <span class="keywordtype">unsigned</span> Sz = <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.Scalars.size();</div>
<div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a6659bba6a4be5e7102bdb10e5fc3658c">ShuffleVectorInst::isOneUseSingleSourceMask</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.ReuseShuffleIndices,</div>
<div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;                                                     Sz))</div>
<div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;      <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;    <span class="keywordtype">unsigned</span> VF = <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.getVectorFactor();</div>
<div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;    <span class="comment">// Try build correct order for extractelement instructions.</span></div>
<div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> ReusedMask(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.ReuseShuffleIndices.begin(),</div>
<div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;                                <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.ReuseShuffleIndices.end());</div>
<div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.getOpcode() == Instruction::ExtractElement &amp;&amp; !<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.isAltShuffle() &amp;&amp;</div>
<div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;        <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.Scalars, [Sz](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;          std::optional&lt;unsigned&gt; Idx = getExtractIndex(cast&lt;Instruction&gt;(V));</div>
<div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;          return Idx &amp;&amp; *Idx &lt; Sz;</div>
<div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;        })) {</div>
<div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> ReorderMask(Sz, <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.ReorderIndices.empty())</div>
<div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;        std::iota(ReorderMask.begin(), ReorderMask.end(), 0);</div>
<div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;        <a class="code" href="namespacellvm.html#a6f0917bf2ae18fac81fea6bf7e887115">inversePermutation</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.ReorderIndices, ReorderMask);</div>
<div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; VF; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;        <span class="keywordtype">int</span> &amp;Idx = ReusedMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;        <span class="keywordflow">if</span> (Idx == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.Scalars[ReorderMask[Idx]];</div>
<div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;        std::optional&lt;unsigned&gt; EI = <a class="code" href="SLPVectorizer_8cpp.html#abe11501239b82a4ba1730e12be769bc6">getExtractIndex</a>(cast&lt;Instruction&gt;(V));</div>
<div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;        Idx = std::distance(ReorderMask.begin(), <a class="code" href="namespacellvm.html#a086e9fbdb06276db7753101a08a63adf">find</a>(ReorderMask, *EI));</div>
<div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;      }</div>
<div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;    }</div>
<div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;    <span class="comment">// Build the order of the VF size, need to reorder reuses shuffles, they are</span></div>
<div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;    <span class="comment">// always of VF size.</span></div>
<div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;    OrdersType ResOrder(VF);</div>
<div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;    std::iota(ResOrder.begin(), ResOrder.end(), 0);</div>
<div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;    <span class="keyword">auto</span> *It = ResOrder.begin();</div>
<div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> K = 0; K &lt; VF; K += Sz) {</div>
<div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;      OrdersType CurrentOrder(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.ReorderIndices);</div>
<div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> SubMask{<a class="code" href="namespacellvm.html#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(ReusedMask).slice(K, Sz)};</div>
<div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;      <span class="keywordflow">if</span> (SubMask.front() == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;        std::iota(SubMask.begin(), SubMask.end(), 0);</div>
<div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;      <a class="code" href="SLPVectorizer_8cpp.html#a52b518b4e744d8c2d89e04e30e7be715">reorderOrder</a>(CurrentOrder, SubMask);</div>
<div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;      <a class="code" href="namespacellvm.html#a615619b0b2879029152b9a20e96624bc">transform</a>(CurrentOrder, It, [K](<span class="keywordtype">unsigned</span> Pos) { <span class="keywordflow">return</span> Pos + K; });</div>
<div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;      std::advance(It, Sz);</div>
<div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;    }</div>
<div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(<a class="code" href="namespacellvm.html#a7b2175e18ff52174fad26b6b68818564">enumerate</a>(ResOrder),</div>
<div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;               [](<span class="keyword">const</span> <span class="keyword">auto</span> &amp;Data) { <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.index() == <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.value(); }))</div>
<div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;      <span class="keywordflow">return</span> {}; <span class="comment">// Use identity order.</span></div>
<div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;    <span class="keywordflow">return</span> ResOrder;</div>
<div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;  }</div>
<div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.State == TreeEntry::Vectorize &amp;&amp;</div>
<div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;      (isa&lt;LoadInst, ExtractElementInst, ExtractValueInst&gt;(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.getMainOp()) ||</div>
<div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;       (TopToBottom &amp;&amp; isa&lt;StoreInst, InsertElementInst&gt;(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.getMainOp()))) &amp;&amp;</div>
<div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;      !<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.isAltShuffle())</div>
<div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.ReorderIndices;</div>
<div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.State == TreeEntry::Vectorize &amp;&amp; <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.getOpcode() == <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">Instruction::PHI</a>) {</div>
<div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;    <span class="keyword">auto</span> PHICompare = [](<a class="code" href="classllvm_1_1Value.html">llvm::Value</a> *V1, <a class="code" href="classllvm_1_1Value.html">llvm::Value</a> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>) {</div>
<div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;      <span class="keywordflow">if</span> (!V1-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() || !<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>-&gt;hasOneUse())</div>
<div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;      <span class="keyword">auto</span> *FirstUserOfPhi1 = cast&lt;Instruction&gt;(*V1-&gt;<a class="code" href="classllvm_1_1Value.html#a158da2b6d3d938aaa15b6acd00150e2c">user_begin</a>());</div>
<div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;      <span class="keyword">auto</span> *FirstUserOfPhi2 = cast&lt;Instruction&gt;(*<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>-&gt;user_begin());</div>
<div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *IE1 = dyn_cast&lt;InsertElementInst&gt;(FirstUserOfPhi1))</div>
<div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *IE2 = dyn_cast&lt;InsertElementInst&gt;(FirstUserOfPhi2)) {</div>
<div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;          <span class="keywordflow">if</span> (!<a class="code" href="SLPVectorizer_8cpp.html#abe6927d96b3815417479246b5afc732e">areTwoInsertFromSameBuildVector</a>(</div>
<div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;                  IE1, IE2,</div>
<div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;                  [](<a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> *II) { <span class="keywordflow">return</span> II-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0); }))</div>
<div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;          std::optional&lt;unsigned&gt; Idx1 = <a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(IE1);</div>
<div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;          std::optional&lt;unsigned&gt; Idx2 = <a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(IE2);</div>
<div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;          <span class="keywordflow">if</span> (Idx1 == std::nullopt || Idx2 == std::nullopt)</div>
<div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;          <span class="keywordflow">return</span> *Idx1 &lt; *Idx2;</div>
<div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;        }</div>
<div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *EE1 = dyn_cast&lt;ExtractElementInst&gt;(FirstUserOfPhi1))</div>
<div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *EE2 = dyn_cast&lt;ExtractElementInst&gt;(FirstUserOfPhi2)) {</div>
<div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;          <span class="keywordflow">if</span> (EE1-&gt;getOperand(0) != EE2-&gt;getOperand(0))</div>
<div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;          std::optional&lt;unsigned&gt; Idx1 = <a class="code" href="SLPVectorizer_8cpp.html#abe11501239b82a4ba1730e12be769bc6">getExtractIndex</a>(EE1);</div>
<div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;          std::optional&lt;unsigned&gt; Idx2 = <a class="code" href="SLPVectorizer_8cpp.html#abe11501239b82a4ba1730e12be769bc6">getExtractIndex</a>(EE2);</div>
<div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;          <span class="keywordflow">if</span> (Idx1 == std::nullopt || Idx2 == std::nullopt)</div>
<div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;          <span class="keywordflow">return</span> *Idx1 &lt; *Idx2;</div>
<div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;        }</div>
<div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;    };</div>
<div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;    <span class="keyword">auto</span> IsIdentityOrder = [](<span class="keyword">const</span> OrdersType &amp;Order) {</div>
<div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Idx : seq&lt;unsigned&gt;(0, Order.size()))</div>
<div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;        <span class="keywordflow">if</span> (Idx != Order[Idx])</div>
<div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;    };</div>
<div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.ReorderIndices.empty())</div>
<div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.ReorderIndices;</div>
<div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, unsigned&gt;</a> PhiToId;</div>
<div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 4&gt;</a> Phis;</div>
<div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;    OrdersType ResOrder(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.Scalars.size());</div>
<div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1AMDGPU_1_1VGPRIndexMode.html#a9afd95476c40096a5898ba0f06370b3a">Id</a> = 0, Sz = <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.Scalars.size(); <a class="code" href="namespacellvm_1_1AMDGPU_1_1VGPRIndexMode.html#a9afd95476c40096a5898ba0f06370b3a">Id</a> &lt; Sz; ++<a class="code" href="namespacellvm_1_1AMDGPU_1_1VGPRIndexMode.html#a9afd95476c40096a5898ba0f06370b3a">Id</a>) {</div>
<div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;      PhiToId[<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.Scalars[<a class="code" href="namespacellvm_1_1AMDGPU_1_1VGPRIndexMode.html#a9afd95476c40096a5898ba0f06370b3a">Id</a>]] = <a class="code" href="namespacellvm_1_1AMDGPU_1_1VGPRIndexMode.html#a9afd95476c40096a5898ba0f06370b3a">Id</a>;</div>
<div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;      Phis.push_back(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.Scalars[<a class="code" href="namespacellvm_1_1AMDGPU_1_1VGPRIndexMode.html#a9afd95476c40096a5898ba0f06370b3a">Id</a>]);</div>
<div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;    }</div>
<div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;    <a class="code" href="namespacellvm.html#a076f93c387f454f0db13d4bc7d4e7f9c">llvm::stable_sort</a>(Phis, PHICompare);</div>
<div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1AMDGPU_1_1VGPRIndexMode.html#a9afd95476c40096a5898ba0f06370b3a">Id</a> = 0, Sz = Phis.size(); <a class="code" href="namespacellvm_1_1AMDGPU_1_1VGPRIndexMode.html#a9afd95476c40096a5898ba0f06370b3a">Id</a> &lt; Sz; ++<a class="code" href="namespacellvm_1_1AMDGPU_1_1VGPRIndexMode.html#a9afd95476c40096a5898ba0f06370b3a">Id</a>)</div>
<div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;      ResOrder[<a class="code" href="namespacellvm_1_1AMDGPU_1_1VGPRIndexMode.html#a9afd95476c40096a5898ba0f06370b3a">Id</a>] = PhiToId[Phis[<a class="code" href="namespacellvm_1_1AMDGPU_1_1VGPRIndexMode.html#a9afd95476c40096a5898ba0f06370b3a">Id</a>]];</div>
<div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;    <span class="keywordflow">if</span> (IsIdentityOrder(ResOrder))</div>
<div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;      <span class="keywordflow">return</span> {};</div>
<div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;    <span class="keywordflow">return</span> ResOrder;</div>
<div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;  }</div>
<div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.State == TreeEntry::NeedToGather) {</div>
<div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;    <span class="comment">// TODO: add analysis of other gather nodes with extractelement</span></div>
<div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;    <span class="comment">// instructions and other values/instructions, not only undefs.</span></div>
<div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;    <span class="keywordflow">if</span> (((<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.getOpcode() == Instruction::ExtractElement &amp;&amp;</div>
<div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;          !<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.isAltShuffle()) ||</div>
<div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;         (<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.Scalars,</div>
<div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;                 [](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;                   return isa&lt;UndefValue, ExtractElementInst&gt;(V);</div>
<div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;                 }) &amp;&amp;</div>
<div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;          <a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.Scalars,</div>
<div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;                 [](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) { return isa&lt;ExtractElementInst&gt;(V); }))) &amp;&amp;</div>
<div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;        <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.Scalars,</div>
<div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;               [](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;                 auto *EE = dyn_cast&lt;ExtractElementInst&gt;(V);</div>
<div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;                 return !EE || isa&lt;FixedVectorType&gt;(EE-&gt;getVectorOperandType());</div>
<div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;               }) &amp;&amp;</div>
<div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;        <a class="code" href="SLPVectorizer_8cpp.html#aabfbce373feafd33ca9e104d8b164ece">allSameType</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.Scalars)) {</div>
<div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;      <span class="comment">// Check that gather of extractelements can be represented as</span></div>
<div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;      <span class="comment">// just a shuffle of a single vector.</span></div>
<div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;      OrdersType CurrentOrder;</div>
<div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;      <span class="keywordtype">bool</span> Reuse = canReuseExtract(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.Scalars, <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.getMainOp(), CurrentOrder);</div>
<div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;      <span class="keywordflow">if</span> (Reuse || !CurrentOrder.empty()) {</div>
<div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;        <span class="keywordflow">if</span> (!CurrentOrder.empty())</div>
<div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;          <a class="code" href="SLPVectorizer_8cpp.html#acd356293c4520fc1fb4a83de901e5bb7">fixupOrderingIndices</a>(CurrentOrder);</div>
<div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;        <span class="keywordflow">return</span> CurrentOrder;</div>
<div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;      }</div>
<div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;    }</div>
<div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;    <span class="keywordflow">if</span> (std::optional&lt;OrdersType&gt; CurrentOrder = findReusedOrderedScalars(TE))</div>
<div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;      <span class="keywordflow">return</span> CurrentOrder;</div>
<div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.Scalars.size() &gt;= 4)</div>
<div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;      <span class="keywordflow">if</span> (std::optional&lt;OrdersType&gt; Order = findPartiallyOrderedLoads(TE))</div>
<div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;        <span class="keywordflow">return</span> Order;</div>
<div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;  }</div>
<div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;  <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;}</div>
<div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;<span class="comment">/// Checks if the given mask is a &quot;clustered&quot; mask with the same clusters of</span></div>
<div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;<span class="comment">/// size \p Sz, which are not identity submasks.</span></div>
<div class="line"><a name="l04067"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a0feeaece30961860a542ba8ee2a1f9f3"> 4067</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#a0feeaece30961860a542ba8ee2a1f9f3">isRepeatedNonIdentityClusteredMask</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>,</div>
<div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;                                               <span class="keywordtype">unsigned</span> Sz) {</div>
<div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;  <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> FirstCluster = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.slice(0, Sz);</div>
<div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a4bc8953b0fd0277b0e5a8e5b78025150">ShuffleVectorInst::isIdentityMask</a>(FirstCluster))</div>
<div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Sz, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> += Sz) {</div>
<div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;    <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> Cluster = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.slice(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Sz);</div>
<div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;    <span class="keywordflow">if</span> (Cluster != FirstCluster)</div>
<div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;  }</div>
<div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;}</div>
<div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160; </div>
<div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;<span class="keywordtype">void</span> BoUpSLP::reorderNodeWithReuses(TreeEntry &amp;TE, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;  <span class="comment">// Reorder reuses mask.</span></div>
<div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;  <a class="code" href="SLPVectorizer_8cpp.html#a4a3e80130d3f25468190ba343064b37e">reorderReuses</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.ReuseShuffleIndices, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> Sz = <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.Scalars.size();</div>
<div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;  <span class="comment">// For vectorized and non-clustered reused no need to do anything else.</span></div>
<div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.State != TreeEntry::NeedToGather ||</div>
<div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;      !<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a6659bba6a4be5e7102bdb10e5fc3658c">ShuffleVectorInst::isOneUseSingleSourceMask</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.ReuseShuffleIndices,</div>
<div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;                                                   Sz) ||</div>
<div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;      !<a class="code" href="SLPVectorizer_8cpp.html#a0feeaece30961860a542ba8ee2a1f9f3">isRepeatedNonIdentityClusteredMask</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.ReuseShuffleIndices, Sz))</div>
<div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> NewMask;</div>
<div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;  <a class="code" href="namespacellvm.html#a6f0917bf2ae18fac81fea6bf7e887115">inversePermutation</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.ReorderIndices, NewMask);</div>
<div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;  <a class="code" href="SLPVectorizer_8cpp.html#aff62592a7901b27bdb120c2e64cd86d0">addMask</a>(NewMask, <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.ReuseShuffleIndices);</div>
<div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;  <span class="comment">// Clear reorder since it is going to be applied to the new mask.</span></div>
<div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;  <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.ReorderIndices.clear();</div>
<div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;  <span class="comment">// Try to improve gathered nodes with clustered reuses, if possible.</span></div>
<div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;  <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> Slice = <a class="code" href="namespacellvm.html#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(NewMask).slice(0, Sz);</div>
<div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;unsigned&gt;</a> NewOrder(Slice.<a class="code" href="classllvm_1_1ArrayRef.html#aab36927882fbfdcbb860d87fd9c30da8">begin</a>(), Slice.<a class="code" href="classllvm_1_1ArrayRef.html#a7ca5197533a9c1fb8a2bd30587fcec6b">end</a>());</div>
<div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;  <a class="code" href="namespacellvm.html#a6f0917bf2ae18fac81fea6bf7e887115">inversePermutation</a>(NewOrder, NewMask);</div>
<div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;  <a class="code" href="namespacellvm.html#a14c12bda1f5a9beed612b00f3f98b888">reorderScalars</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.Scalars, NewMask);</div>
<div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;  <span class="comment">// Fill the reuses mask with the identity submasks.</span></div>
<div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *It = <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.ReuseShuffleIndices.begin(),</div>
<div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;            *End = <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.ReuseShuffleIndices.end();</div>
<div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;       It != End; std::advance(It, Sz))</div>
<div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;    std::iota(It, std::next(It, Sz), 0);</div>
<div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;}</div>
<div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160; </div>
<div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;<span class="keywordtype">void</span> BoUpSLP::reorderTopToBottom() {</div>
<div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;  <span class="comment">// Maps VF to the graph nodes.</span></div>
<div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;unsigned, SetVector&lt;TreeEntry *&gt;</a>&gt; VFToOrderedEntries;</div>
<div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;  <span class="comment">// ExtractElement gather nodes which can be vectorized and need to handle</span></div>
<div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;  <span class="comment">// their ordering.</span></div>
<div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const TreeEntry *, OrdersType&gt;</a> GathersToOrders;</div>
<div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160; </div>
<div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;  <span class="comment">// Phi nodes can have preferred ordering based on their result users</span></div>
<div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const TreeEntry *, OrdersType&gt;</a> PhisToOrders;</div>
<div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160; </div>
<div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;  <span class="comment">// AltShuffles can also have a preferred ordering that leads to fewer</span></div>
<div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;  <span class="comment">// instructions, e.g., the addsub instruction in x86.</span></div>
<div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const TreeEntry *, OrdersType&gt;</a> AltShufflesToOrders;</div>
<div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160; </div>
<div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;  <span class="comment">// Maps a TreeEntry to the reorder indices of external users.</span></div>
<div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const TreeEntry *, SmallVector&lt;OrdersType, 1&gt;</a>&gt;</div>
<div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;      ExternalUserReorderMap;</div>
<div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;  <span class="comment">// FIXME: Workaround for syntax error reported by MSVC buildbots.</span></div>
<div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;  <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;TTIRef = *<a class="code" href="namespacellvm.html#aa0d69e81725c10fa5407f0bf34462068">TTI</a>;</div>
<div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;  <span class="comment">// Find all reorderable nodes with the given VF.</span></div>
<div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;  <span class="comment">// Currently the are vectorized stores,loads,extracts + some gathering of</span></div>
<div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;  <span class="comment">// extracts.</span></div>
<div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;  <a class="code" href="namespacellvm.html#a0b2a153b655ed78a07468297eb4c6256">for_each</a>(VectorizableTree, [<span class="keyword">this</span>, &amp;TTIRef, &amp;VFToOrderedEntries,</div>
<div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;                              &amp;GathersToOrders, &amp;ExternalUserReorderMap,</div>
<div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;                              &amp;AltShufflesToOrders, &amp;PhisToOrders](</div>
<div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;                                 <span class="keyword">const</span> std::unique_ptr&lt;TreeEntry&gt; &amp;TE) {</div>
<div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;    <span class="comment">// Look for external users that will probably be vectorized.</span></div>
<div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;OrdersType, 1&gt;</a> ExternalUserReorderIndices =</div>
<div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;        findExternalStoreUsersReorderIndices(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.get());</div>
<div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;    <span class="keywordflow">if</span> (!ExternalUserReorderIndices.empty()) {</div>
<div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;      VFToOrderedEntries[<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;getVectorFactor()].<a class="code" href="classllvm_1_1DenseMapBase.html#a99f811d53704275b4158c62a2dd138d9">insert</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.get());</div>
<div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;      ExternalUserReorderMap.<a class="code" href="classllvm_1_1DenseMapBase.html#a98c685a0c53f3f7ed5f4793890a6c850">try_emplace</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.get(),</div>
<div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;                                         <a class="code" href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">std::move</a>(ExternalUserReorderIndices));</div>
<div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;    }</div>
<div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160; </div>
<div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;    <span class="comment">// Patterns like [fadd,fsub] can be combined into a single instruction in</span></div>
<div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;    <span class="comment">// x86. Reordering them into [fsub,fadd] blocks this pattern. So we need</span></div>
<div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;    <span class="comment">// to take into account their order when looking for the most used order.</span></div>
<div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;isAltShuffle()) {</div>
<div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;      <a class="code" href="classllvm_1_1VectorType.html">VectorType</a> *VecTy =</div>
<div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;          <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;Scalars[0]-&gt;getType(), <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;Scalars.size());</div>
<div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;      <span class="keywordtype">unsigned</span> Opcode0 = <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;getOpcode();</div>
<div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;      <span class="keywordtype">unsigned</span> Opcode1 = <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;getAltOpcode();</div>
<div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;      <span class="comment">// The opcode mask selects between the two opcodes.</span></div>
<div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;      <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> OpcodeMask(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;Scalars.size(), <span class="keyword">false</span>);</div>
<div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Lane : seq&lt;unsigned&gt;(0, <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;Scalars.size()))</div>
<div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;        <span class="keywordflow">if</span> (cast&lt;Instruction&gt;(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;Scalars[Lane])-&gt;getOpcode() == Opcode1)</div>
<div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;          OpcodeMask.set(Lane);</div>
<div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;      <span class="comment">// If this pattern is supported by the target then we consider the order.</span></div>
<div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;      <span class="keywordflow">if</span> (TTIRef.<a class="code" href="classllvm_1_1TargetTransformInfo.html#aae67acb89326f200683e3d0b872a5329">isLegalAltInstr</a>(VecTy, Opcode0, Opcode1, OpcodeMask)) {</div>
<div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;        VFToOrderedEntries[<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;getVectorFactor()].<a class="code" href="classllvm_1_1DenseMapBase.html#a99f811d53704275b4158c62a2dd138d9">insert</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.get());</div>
<div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;        AltShufflesToOrders.<a class="code" href="classllvm_1_1DenseMapBase.html#a98c685a0c53f3f7ed5f4793890a6c850">try_emplace</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.get(), OrdersType());</div>
<div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;      }</div>
<div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;      <span class="comment">// TODO: Check the reverse order too.</span></div>
<div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;    }</div>
<div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160; </div>
<div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;    <span class="keywordflow">if</span> (std::optional&lt;OrdersType&gt; CurrentOrder =</div>
<div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;            getReorderingData(*TE, <span class="comment">/*TopToBottom=*/</span><span class="keyword">true</span>)) {</div>
<div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;      <span class="comment">// Do not include ordering for nodes used in the alt opcode vectorization,</span></div>
<div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;      <span class="comment">// better to reorder them during bottom-to-top stage. If follow the order</span></div>
<div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;      <span class="comment">// here, it causes reordering of the whole graph though actually it is</span></div>
<div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;      <span class="comment">// profitable just to reorder the subgraph that starts from the alternate</span></div>
<div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;      <span class="comment">// opcode vectorization node. Such nodes already end-up with the shuffle</span></div>
<div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;      <span class="comment">// instruction and it is just enough to change this shuffle rather than</span></div>
<div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;      <span class="comment">// rotate the scalars for the whole graph.</span></div>
<div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;      <span class="keywordtype">unsigned</span> Cnt = 0;</div>
<div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;      <span class="keyword">const</span> TreeEntry *UserTE = <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.get();</div>
<div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;      <span class="keywordflow">while</span> (UserTE &amp;&amp; Cnt &lt; <a class="code" href="SLPVectorizer_8cpp.html#a70927cb83bb008a2a60a657d651909aa">RecursionMaxDepth</a>) {</div>
<div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;        <span class="keywordflow">if</span> (UserTE-&gt;UserTreeIndices.size() != 1)</div>
<div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(UserTE-&gt;UserTreeIndices, [](<span class="keyword">const</span> EdgeInfo &amp;EI) {</div>
<div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;              return EI.UserTE-&gt;State == TreeEntry::Vectorize &amp;&amp;</div>
<div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;                     EI.UserTE-&gt;isAltShuffle() &amp;&amp; EI.UserTE-&gt;Idx != 0;</div>
<div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;            }))</div>
<div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;          <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;        UserTE = UserTE-&gt;UserTreeIndices.back().UserTE;</div>
<div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;        ++Cnt;</div>
<div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;      }</div>
<div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;      VFToOrderedEntries[<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;getVectorFactor()].<a class="code" href="classllvm_1_1DenseMapBase.html#a99f811d53704275b4158c62a2dd138d9">insert</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.get());</div>
<div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;State != TreeEntry::Vectorize || !<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;ReuseShuffleIndices.empty())</div>
<div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;        GathersToOrders.<a class="code" href="classllvm_1_1DenseMapBase.html#a98c685a0c53f3f7ed5f4793890a6c850">try_emplace</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.get(), *CurrentOrder);</div>
<div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;State == TreeEntry::Vectorize &amp;&amp;</div>
<div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;          <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;getOpcode() == <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">Instruction::PHI</a>)</div>
<div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;        PhisToOrders.<a class="code" href="classllvm_1_1DenseMapBase.html#a98c685a0c53f3f7ed5f4793890a6c850">try_emplace</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.get(), *CurrentOrder);</div>
<div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;    }</div>
<div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;  });</div>
<div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160; </div>
<div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;  <span class="comment">// Reorder the graph nodes according to their vectorization factor.</span></div>
<div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> VF = VectorizableTree.front()-&gt;getVectorFactor(); VF &gt; 1;</div>
<div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;       VF /= 2) {</div>
<div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;    <span class="keyword">auto</span> It = VFToOrderedEntries.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(VF);</div>
<div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;    <span class="keywordflow">if</span> (It == VFToOrderedEntries.<a class="code" href="classllvm_1_1DenseMapBase.html#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</div>
<div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;    <span class="comment">// Try to find the most profitable order. We just are looking for the most</span></div>
<div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;    <span class="comment">// used order and reorder scalar elements in the nodes according to this</span></div>
<div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;    <span class="comment">// mostly used order.</span></div>
<div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;    <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;TreeEntry *&gt;</a> OrderedEntries = It-&gt;second.getArrayRef();</div>
<div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;    <span class="comment">// All operands are reordered and used only in this node - propagate the</span></div>
<div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;    <span class="comment">// most used order to the user node.</span></div>
<div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;    <a class="code" href="classllvm_1_1MapVector.html">MapVector</a>&lt;OrdersType, <a class="code" href="ADT_2tmp_8txt.html#aa10ee7493bddf2c751ca6e05451ef410">unsigned</a>,</div>
<div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;              <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;OrdersType, unsigned, OrdersTypeDenseMapInfo&gt;</a>&gt;</div>
<div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;        OrdersUses;</div>
<div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const TreeEntry *, 4&gt;</a> VisitedOps;</div>
<div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> TreeEntry *OpTE : OrderedEntries) {</div>
<div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;      <span class="comment">// No need to reorder this nodes, still need to extend and to use shuffle,</span></div>
<div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;      <span class="comment">// just need to merge reordering shuffle and the reuse shuffle.</span></div>
<div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;      <span class="keywordflow">if</span> (!OpTE-&gt;ReuseShuffleIndices.empty() &amp;&amp; !GathersToOrders.<a class="code" href="classllvm_1_1DenseMapBase.html#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(OpTE))</div>
<div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;      <span class="comment">// Count number of orders uses.</span></div>
<div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> &amp;Order = [OpTE, &amp;GathersToOrders, &amp;AltShufflesToOrders,</div>
<div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;                           &amp;PhisToOrders]() -&gt; <span class="keyword">const</span> OrdersType &amp; {</div>
<div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;        <span class="keywordflow">if</span> (OpTE-&gt;State == TreeEntry::NeedToGather ||</div>
<div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;            !OpTE-&gt;ReuseShuffleIndices.empty()) {</div>
<div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;          <span class="keyword">auto</span> It = GathersToOrders.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a153ea412ff7a0ba105111155d1e16128">find</a>(OpTE);</div>
<div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;          <span class="keywordflow">if</span> (It != GathersToOrders.end())</div>
<div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;            <span class="keywordflow">return</span> It-&gt;second;</div>
<div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;        }</div>
<div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;        <span class="keywordflow">if</span> (OpTE-&gt;isAltShuffle()) {</div>
<div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;          <span class="keyword">auto</span> It = AltShufflesToOrders.find(OpTE);</div>
<div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;          <span class="keywordflow">if</span> (It != AltShufflesToOrders.end())</div>
<div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;            <span class="keywordflow">return</span> It-&gt;second;</div>
<div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;        }</div>
<div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;        <span class="keywordflow">if</span> (OpTE-&gt;State == TreeEntry::Vectorize &amp;&amp;</div>
<div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;            OpTE-&gt;getOpcode() == <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">Instruction::PHI</a>) {</div>
<div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;          <span class="keyword">auto</span> It = PhisToOrders.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(OpTE);</div>
<div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;          <span class="keywordflow">if</span> (It != PhisToOrders.<a class="code" href="classllvm_1_1DenseMapBase.html#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</div>
<div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;            <span class="keywordflow">return</span> It-&gt;second;</div>
<div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;        }</div>
<div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;        <span class="keywordflow">return</span> OpTE-&gt;ReorderIndices;</div>
<div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;      }();</div>
<div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;      <span class="comment">// First consider the order of the external scalar users.</span></div>
<div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;      <span class="keyword">auto</span> It = ExternalUserReorderMap.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(OpTE);</div>
<div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;      <span class="keywordflow">if</span> (It != ExternalUserReorderMap.<a class="code" href="classllvm_1_1DenseMapBase.html#a65520b9c67759099e313d0f4e7b5ff9e">end</a>()) {</div>
<div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> &amp;ExternalUserReorderIndices = It-&gt;second;</div>
<div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;        <span class="comment">// If the OpTE vector factor != number of scalars - use natural order,</span></div>
<div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;        <span class="comment">// it is an attempt to reorder node with reused scalars but with</span></div>
<div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;        <span class="comment">// external uses.</span></div>
<div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;        <span class="keywordflow">if</span> (OpTE-&gt;getVectorFactor() != OpTE-&gt;Scalars.size()) {</div>
<div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;          OrdersUses.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a94d23373106467003722f7d6c17b1528">insert</a>(std::make_pair(OrdersType(), 0)).first-&gt;second +=</div>
<div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;              ExternalUserReorderIndices.size();</div>
<div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;          <span class="keywordflow">for</span> (<span class="keyword">const</span> OrdersType &amp;ExtOrder : ExternalUserReorderIndices)</div>
<div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;            ++OrdersUses.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a94d23373106467003722f7d6c17b1528">insert</a>(std::make_pair(ExtOrder, 0)).first-&gt;second;</div>
<div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;        }</div>
<div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;        <span class="comment">// No other useful reorder data in this entry.</span></div>
<div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;        <span class="keywordflow">if</span> (Order.empty())</div>
<div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;      }</div>
<div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;      <span class="comment">// Stores actually store the mask, not the order, need to invert.</span></div>
<div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;      <span class="keywordflow">if</span> (OpTE-&gt;State == TreeEntry::Vectorize &amp;&amp; !OpTE-&gt;isAltShuffle() &amp;&amp;</div>
<div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;          OpTE-&gt;getOpcode() == <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Instruction::Store</a> &amp;&amp; !Order.empty()) {</div>
<div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;        <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>;</div>
<div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;        <a class="code" href="namespacellvm.html#a6f0917bf2ae18fac81fea6bf7e887115">inversePermutation</a>(Order, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;        <span class="keywordtype">unsigned</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = Order.size();</div>
<div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;        OrdersType CurrentOrder(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;        <a class="code" href="namespacellvm.html#a615619b0b2879029152b9a20e96624bc">transform</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, CurrentOrder.begin(), [<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>](<span class="keywordtype">int</span> Idx) {</div>
<div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;          return Idx == UndefMaskElem ? E : static_cast&lt;unsigned&gt;(Idx);</div>
<div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;        });</div>
<div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;        <a class="code" href="SLPVectorizer_8cpp.html#acd356293c4520fc1fb4a83de901e5bb7">fixupOrderingIndices</a>(CurrentOrder);</div>
<div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;        ++OrdersUses.insert(std::make_pair(CurrentOrder, 0)).first-&gt;second;</div>
<div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;        ++OrdersUses.insert(std::make_pair(Order, 0)).first-&gt;second;</div>
<div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;      }</div>
<div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;    }</div>
<div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;    <span class="comment">// Set order of the user node.</span></div>
<div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;    <span class="keywordflow">if</span> (OrdersUses.empty())</div>
<div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;    <span class="comment">// Choose the most used order.</span></div>
<div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;    <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;unsigned&gt;</a> BestOrder = OrdersUses.<a class="code" href="classllvm_1_1ArrayRef.html#a6bc2b53fce3b1d8975eea027d8a8eb90">front</a>().first;</div>
<div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;    <span class="keywordtype">unsigned</span> Cnt = OrdersUses.front().second;</div>
<div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;Pair : <a class="code" href="namespacellvm.html#a02981de53fb6ffd384d39addc4d25f37">drop_begin</a>(OrdersUses)) {</div>
<div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;      <span class="keywordflow">if</span> (Cnt &lt; Pair.second || (Cnt == Pair.second &amp;&amp; Pair.first.empty())) {</div>
<div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;        BestOrder = Pair.first;</div>
<div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;        Cnt = Pair.second;</div>
<div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;      }</div>
<div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;    }</div>
<div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;    <span class="comment">// Set order of the user node.</span></div>
<div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;    <span class="keywordflow">if</span> (BestOrder.<a class="code" href="classllvm_1_1ArrayRef.html#ac835b8735b1b2faec0efdca236e37d94">empty</a>())</div>
<div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>;</div>
<div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;    <a class="code" href="namespacellvm.html#a6f0917bf2ae18fac81fea6bf7e887115">inversePermutation</a>(BestOrder, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> MaskOrder(BestOrder.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(), <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;    <span class="keywordtype">unsigned</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = BestOrder.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>();</div>
<div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;    <a class="code" href="namespacellvm.html#a615619b0b2879029152b9a20e96624bc">transform</a>(BestOrder, MaskOrder.begin(), [<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>](<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;      return I &lt; E ? static_cast&lt;int&gt;(I) : UndefMaskElem;</div>
<div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;    });</div>
<div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;    <span class="comment">// Do an actual reordering, if profitable.</span></div>
<div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;    <span class="keywordflow">for</span> (std::unique_ptr&lt;TreeEntry&gt; &amp;TE : VectorizableTree) {</div>
<div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;      <span class="comment">// Just do the reordering for the nodes with the given VF.</span></div>
<div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;Scalars.size() != VF) {</div>
<div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;ReuseShuffleIndices.size() == VF) {</div>
<div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;          <span class="comment">// Need to reorder the reuses masks of the operands with smaller VF to</span></div>
<div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;          <span class="comment">// be able to find the match between the graph nodes and scalar</span></div>
<div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;          <span class="comment">// operands of the given node during vectorization/cost estimation.</span></div>
<div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;UserTreeIndices,</div>
<div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;                        [VF, &amp;TE](<span class="keyword">const</span> EdgeInfo &amp;EI) {</div>
<div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;                          return EI.UserTE-&gt;Scalars.size() == VF ||</div>
<div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;                                 EI.UserTE-&gt;Scalars.size() ==</div>
<div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;                                     TE-&gt;Scalars.size();</div>
<div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;                        }) &amp;&amp;</div>
<div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;                 <span class="stringliteral">&quot;All users must be of VF size.&quot;</span>);</div>
<div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;          <span class="comment">// Update ordering of the operands with the smaller VF than the given</span></div>
<div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;          <span class="comment">// one.</span></div>
<div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;          reorderNodeWithReuses(*TE, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;        }</div>
<div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;      }</div>
<div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;State == TreeEntry::Vectorize &amp;&amp;</div>
<div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;          <a class="code" href="namespacellvm.html#a92ca992e52dddc420f4b069cae06dfbe">isa</a>&lt;<a class="code" href="classllvm_1_1ExtractElementInst.html">ExtractElementInst</a>, <a class="code" href="classllvm_1_1ExtractValueInst.html">ExtractValueInst</a>, <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a>, <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a>,</div>
<div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;              <a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a>&gt;(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;getMainOp()) &amp;&amp;</div>
<div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;          !<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;isAltShuffle()) {</div>
<div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;        <span class="comment">// Build correct orders for extract{element,value}, loads and</span></div>
<div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;        <span class="comment">// stores.</span></div>
<div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;        <a class="code" href="SLPVectorizer_8cpp.html#a52b518b4e744d8c2d89e04e30e7be715">reorderOrder</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;ReorderIndices, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;        <span class="keywordflow">if</span> (isa&lt;InsertElementInst, StoreInst&gt;(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;getMainOp()))</div>
<div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;          <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;reorderOperands(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;        <span class="comment">// Reorder the node and its operands.</span></div>
<div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;        <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;reorderOperands(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;ReorderIndices.empty() &amp;&amp;</div>
<div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;               <span class="stringliteral">&quot;Expected empty reorder sequence.&quot;</span>);</div>
<div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;        <a class="code" href="namespacellvm.html#a14c12bda1f5a9beed612b00f3f98b888">reorderScalars</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;Scalars, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;      }</div>
<div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;ReuseShuffleIndices.empty()) {</div>
<div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;        <span class="comment">// Apply reversed order to keep the original ordering of the reused</span></div>
<div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;        <span class="comment">// elements to avoid extra reorder indices shuffling.</span></div>
<div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;        OrdersType CurrentOrder;</div>
<div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;        <a class="code" href="SLPVectorizer_8cpp.html#a52b518b4e744d8c2d89e04e30e7be715">reorderOrder</a>(CurrentOrder, MaskOrder);</div>
<div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;        <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> NewReuses;</div>
<div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;        <a class="code" href="namespacellvm.html#a6f0917bf2ae18fac81fea6bf7e887115">inversePermutation</a>(CurrentOrder, NewReuses);</div>
<div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;        <a class="code" href="SLPVectorizer_8cpp.html#aff62592a7901b27bdb120c2e64cd86d0">addMask</a>(NewReuses, <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;ReuseShuffleIndices);</div>
<div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;        <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;ReuseShuffleIndices.swap(NewReuses);</div>
<div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;      }</div>
<div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;    }</div>
<div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;  }</div>
<div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;}</div>
<div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160; </div>
<div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;<span class="keywordtype">bool</span> BoUpSLP::canReorderOperands(</div>
<div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;    TreeEntry *UserTE, <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl</a>&lt;std::pair&lt;unsigned, TreeEntry *&gt;&gt; &amp;Edges,</div>
<div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;    <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;TreeEntry *&gt;</a> ReorderableGathers,</div>
<div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;    <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;TreeEntry *&gt;</a> &amp;GatherOps) {</div>
<div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = UserTE-&gt;getNumOperands(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(Edges, [<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>](<span class="keyword">const</span> std::pair&lt;unsigned, TreeEntry *&gt; &amp;OpData) {</div>
<div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;          <span class="keywordflow">return</span> OpData.first == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp;</div>
<div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;                 OpData.second-&gt;State == TreeEntry::Vectorize;</div>
<div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;        }))</div>
<div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;    <span class="keywordflow">if</span> (TreeEntry *TE = getVectorizedOperand(UserTE, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;      <span class="comment">// Do not reorder if operand node is used by many user nodes.</span></div>
<div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;UserTreeIndices,</div>
<div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;                 [UserTE](<span class="keyword">const</span> EdgeInfo &amp;EI) { return EI.UserTE != UserTE; }))</div>
<div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;      <span class="comment">// Add the node to the list of the ordered nodes with the identity</span></div>
<div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;      <span class="comment">// order.</span></div>
<div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;      Edges.emplace_back(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, TE);</div>
<div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;      <span class="comment">// Add ScatterVectorize nodes to the list of operands, where just</span></div>
<div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;      <span class="comment">// reordering of the scalars is required. Similar to the gathers, so</span></div>
<div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;      <span class="comment">// simply add to the list of gathered ops.</span></div>
<div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;      <span class="comment">// If there are reused scalars, process this node as a regular vectorize</span></div>
<div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;      <span class="comment">// node, just reorder reuses mask.</span></div>
<div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;State != TreeEntry::Vectorize &amp;&amp; <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;ReuseShuffleIndices.empty())</div>
<div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;        GatherOps.push_back(TE);</div>
<div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;    }</div>
<div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;    TreeEntry *Gather = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ac214df91cdc242f4710ea5a93939c678">count_if</a>(ReorderableGathers,</div>
<div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;                 [&amp;Gather, UserTE, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>](TreeEntry *TE) {</div>
<div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;                   <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;State != TreeEntry::Vectorize &amp;&amp;</div>
<div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;                          <span class="stringliteral">&quot;Only non-vectorized nodes are expected.&quot;</span>);</div>
<div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;                   <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;UserTreeIndices,</div>
<div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;                              [UserTE, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>](<span class="keyword">const</span> EdgeInfo &amp;EI) {</div>
<div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;                                return EI.UserTE == UserTE &amp;&amp; EI.EdgeIdx == I;</div>
<div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;                              })) {</div>
<div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;                     <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;isSame(UserTE-&gt;getOperand(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</div>
<div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;                            <span class="stringliteral">&quot;Operand entry does not match operands.&quot;</span>);</div>
<div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;                     Gather = <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>;</div>
<div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;                     <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;                   }</div>
<div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;                   <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;                 }) &gt; 1 &amp;&amp;</div>
<div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;        !<a class="code" href="SLPVectorizer_8cpp.html#a7568c08b526dbf7f7b5402f3eb605b55">allConstant</a>(UserTE-&gt;getOperand(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)))</div>
<div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;    <span class="keywordflow">if</span> (Gather)</div>
<div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;      GatherOps.push_back(Gather);</div>
<div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;  }</div>
<div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;}</div>
<div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160; </div>
<div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;<span class="keywordtype">void</span> BoUpSLP::reorderBottomToTop(<span class="keywordtype">bool</span> IgnoreReorder) {</div>
<div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;  <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;TreeEntry *&gt;</a> OrderedEntries;</div>
<div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const TreeEntry *, OrdersType&gt;</a> GathersToOrders;</div>
<div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;  <span class="comment">// Find all reorderable leaf nodes with the given VF.</span></div>
<div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;  <span class="comment">// Currently the are vectorized loads,extracts without alternate operands +</span></div>
<div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;  <span class="comment">// some gathering of extracts.</span></div>
<div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;TreeEntry *&gt;</a> NonVectorized;</div>
<div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;  <a class="code" href="namespacellvm.html#a0b2a153b655ed78a07468297eb4c6256">for_each</a>(VectorizableTree, [<span class="keyword">this</span>, &amp;OrderedEntries, &amp;GathersToOrders,</div>
<div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;                              &amp;NonVectorized](</div>
<div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;                                 <span class="keyword">const</span> std::unique_ptr&lt;TreeEntry&gt; &amp;TE) {</div>
<div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;State != TreeEntry::Vectorize)</div>
<div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;      NonVectorized.push_back(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.get());</div>
<div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;    <a class="code" href="include_2llvm_2Support_2CMakeLists_8txt.html#aef9367eb0b7430eaf70b1f2725488f2a">if</a> (std::optional&lt;OrdersType&gt; CurrentOrder =</div>
<div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;            getReorderingData(*TE, <span class="comment">/*TopToBottom=*/</span><span class="keyword">false</span>)) {</div>
<div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;      OrderedEntries.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.get());</div>
<div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;      <a class="code" href="include_2llvm_2Support_2CMakeLists_8txt.html#aef9367eb0b7430eaf70b1f2725488f2a">if</a> (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;State != TreeEntry::Vectorize || !<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;ReuseShuffleIndices.empty())</div>
<div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;        GathersToOrders.<a class="code" href="classllvm_1_1DenseMapBase.html#a98c685a0c53f3f7ed5f4793890a6c850">try_emplace</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.get(), *CurrentOrder);</div>
<div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;    }</div>
<div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;  });</div>
<div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160; </div>
<div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;  <span class="comment">// 1. Propagate order to the graph nodes, which use only reordered nodes.</span></div>
<div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;  <span class="comment">// I.e., if the node has operands, that are reordered, try to make at least</span></div>
<div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;  <span class="comment">// one operand order in the natural order and reorder others + reorder the</span></div>
<div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;  <span class="comment">// user node itself.</span></div>
<div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const TreeEntry *, 4&gt;</a> Visited;</div>
<div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;  <span class="keywordflow">while</span> (!OrderedEntries.<a class="code" href="classllvm_1_1SetVector.html#aaf9ee38b9973681c1720aaf03af3a069">empty</a>()) {</div>
<div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160;    <span class="comment">// 1. Filter out only reordered nodes.</span></div>
<div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;    <span class="comment">// 2. If the entry has multiple uses - skip it and jump to the next node.</span></div>
<div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;TreeEntry *, SmallVector&lt;std::pair&lt;unsigned, TreeEntry *&gt;</a>&gt;&gt; <a class="code" href="IVUsers_8cpp.html#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>;</div>
<div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;TreeEntry *&gt;</a> Filtered;</div>
<div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;    <span class="keywordflow">for</span> (TreeEntry *TE : OrderedEntries) {</div>
<div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;      <span class="keywordflow">if</span> (!(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;State == TreeEntry::Vectorize ||</div>
<div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;            (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;State == TreeEntry::NeedToGather &amp;&amp;</div>
<div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;             GathersToOrders.<a class="code" href="classllvm_1_1DenseMapBase.html#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(TE))) ||</div>
<div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;          <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;UserTreeIndices.empty() || !<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;ReuseShuffleIndices.empty() ||</div>
<div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;          !<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(<a class="code" href="namespacellvm.html#a02981de53fb6ffd384d39addc4d25f37">drop_begin</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;UserTreeIndices),</div>
<div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;                  [TE](<span class="keyword">const</span> EdgeInfo &amp;EI) {</div>
<div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;                    return EI.UserTE == TE-&gt;UserTreeIndices.front().UserTE;</div>
<div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;                  }) ||</div>
<div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;          !Visited.insert(TE).second) {</div>
<div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;        Filtered.push_back(TE);</div>
<div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;      }</div>
<div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;      <span class="comment">// Build a map between user nodes and their operands order to speedup</span></div>
<div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;      <span class="comment">// search. The graph currently does not provide this dependency directly.</span></div>
<div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;      <span class="keywordflow">for</span> (EdgeInfo &amp;EI : <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;UserTreeIndices) {</div>
<div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;        TreeEntry *UserTE = EI.UserTE;</div>
<div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;        <span class="keyword">auto</span> It = <a class="code" href="IVUsers_8cpp.html#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.find(UserTE);</div>
<div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;        <span class="keywordflow">if</span> (It == <a class="code" href="IVUsers_8cpp.html#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.end())</div>
<div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;          It = <a class="code" href="IVUsers_8cpp.html#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.insert({UserTE, {}}).first;</div>
<div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;        It-&gt;second.emplace_back(EI.EdgeIdx, TE);</div>
<div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;      }</div>
<div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;    }</div>
<div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;    <span class="comment">// Erase filtered entries.</span></div>
<div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;    <a class="code" href="namespacellvm.html#a0b2a153b655ed78a07468297eb4c6256">for_each</a>(Filtered,</div>
<div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;             [&amp;OrderedEntries](TreeEntry *TE) { OrderedEntries.remove(TE); });</div>
<div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector</a>&lt;</div>
<div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;        std::pair&lt;TreeEntry *, SmallVector&lt;std::pair&lt;unsigned, TreeEntry *&gt;&gt;&gt;&gt;</div>
<div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;        UsersVec(<a class="code" href="IVUsers_8cpp.html#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.begin(), <a class="code" href="IVUsers_8cpp.html#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.end());</div>
<div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;    <a class="code" href="namespacellvm.html#a74cdbd1e4f731e7d7cd83461b8b1de0b">sort</a>(UsersVec, [](<span class="keyword">const</span> <span class="keyword">auto</span> &amp;Data1, <span class="keyword">const</span> <span class="keyword">auto</span> &amp;Data2) {</div>
<div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;      <span class="keywordflow">return</span> Data1.first-&gt;Idx &gt; Data2.first-&gt;Idx;</div>
<div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;    });</div>
<div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Data : UsersVec) {</div>
<div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;      <span class="comment">// Check that operands are used only in the User node.</span></div>
<div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;TreeEntry *&gt;</a> GatherOps;</div>
<div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;      <span class="keywordflow">if</span> (!canReorderOperands(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.first, <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.second, NonVectorized,</div>
<div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;                              GatherOps)) {</div>
<div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;        <a class="code" href="namespacellvm.html#a0b2a153b655ed78a07468297eb4c6256">for_each</a>(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.second,</div>
<div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;                 [&amp;OrderedEntries](<span class="keyword">const</span> std::pair&lt;unsigned, TreeEntry *&gt; &amp;<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>) {</div>
<div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;                   OrderedEntries.remove(Op.second);</div>
<div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;                 });</div>
<div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;      }</div>
<div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;      <span class="comment">// All operands are reordered and used only in this node - propagate the</span></div>
<div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;      <span class="comment">// most used order to the user node.</span></div>
<div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;      <a class="code" href="classllvm_1_1MapVector.html">MapVector</a>&lt;OrdersType, <a class="code" href="ADT_2tmp_8txt.html#aa10ee7493bddf2c751ca6e05451ef410">unsigned</a>,</div>
<div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;                <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;OrdersType, unsigned, OrdersTypeDenseMapInfo&gt;</a>&gt;</div>
<div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;          OrdersUses;</div>
<div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;      <span class="comment">// Do the analysis for each tree entry only once, otherwise the order of</span></div>
<div class="line"><a name="l04474"></a><span class="lineno"> 4474</span>&#160;      <span class="comment">// the same node my be considered several times, though might be not</span></div>
<div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;      <span class="comment">// profitable.</span></div>
<div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;      <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const TreeEntry *, 4&gt;</a> VisitedOps;</div>
<div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;      <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const TreeEntry *, 4&gt;</a> VisitedUsers;</div>
<div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> : <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.second) {</div>
<div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;        TreeEntry *OpTE = <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.second;</div>
<div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;        <span class="keywordflow">if</span> (!VisitedOps.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(OpTE).second)</div>
<div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;        <span class="keywordflow">if</span> (!OpTE-&gt;ReuseShuffleIndices.empty() &amp;&amp; !GathersToOrders.<a class="code" href="classllvm_1_1DenseMapBase.html#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(OpTE))</div>
<div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> &amp;Order = [OpTE, &amp;GathersToOrders]() -&gt; <span class="keyword">const</span> OrdersType &amp; {</div>
<div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;          <span class="keywordflow">if</span> (OpTE-&gt;State == TreeEntry::NeedToGather ||</div>
<div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;              !OpTE-&gt;ReuseShuffleIndices.empty())</div>
<div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;            <span class="keywordflow">return</span> GathersToOrders.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(OpTE)-&gt;second;</div>
<div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;          <span class="keywordflow">return</span> OpTE-&gt;ReorderIndices;</div>
<div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;        }();</div>
<div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;        <span class="keywordtype">unsigned</span> NumOps = <a class="code" href="namespacellvm.html#ac214df91cdc242f4710ea5a93939c678">count_if</a>(</div>
<div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;            <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.second, [OpTE](<span class="keyword">const</span> std::pair&lt;unsigned, TreeEntry *&gt; &amp;<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>) {</div>
<div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;              return P.second == OpTE;</div>
<div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;            });</div>
<div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160;        <span class="comment">// Stores actually store the mask, not the order, need to invert.</span></div>
<div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;        <span class="keywordflow">if</span> (OpTE-&gt;State == TreeEntry::Vectorize &amp;&amp; !OpTE-&gt;isAltShuffle() &amp;&amp;</div>
<div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;            OpTE-&gt;getOpcode() == <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Instruction::Store</a> &amp;&amp; !Order.empty()) {</div>
<div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;          <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>;</div>
<div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160;          <a class="code" href="namespacellvm.html#a6f0917bf2ae18fac81fea6bf7e887115">inversePermutation</a>(Order, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;          <span class="keywordtype">unsigned</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = Order.size();</div>
<div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;          OrdersType CurrentOrder(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;          <a class="code" href="namespacellvm.html#a615619b0b2879029152b9a20e96624bc">transform</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, CurrentOrder.begin(), [<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>](<span class="keywordtype">int</span> Idx) {</div>
<div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;            return Idx == UndefMaskElem ? E : static_cast&lt;unsigned&gt;(Idx);</div>
<div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;          });</div>
<div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;          <a class="code" href="SLPVectorizer_8cpp.html#acd356293c4520fc1fb4a83de901e5bb7">fixupOrderingIndices</a>(CurrentOrder);</div>
<div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;          OrdersUses.insert(std::make_pair(CurrentOrder, 0)).first-&gt;second +=</div>
<div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;              NumOps;</div>
<div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;          OrdersUses.insert(std::make_pair(Order, 0)).first-&gt;second += NumOps;</div>
<div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;        }</div>
<div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;        <span class="keyword">auto</span> Res = OrdersUses.insert(std::make_pair(OrdersType(), 0));</div>
<div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> &amp;&amp;AllowsReordering = [IgnoreReorder, &amp;GathersToOrders](</div>
<div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;                                            <span class="keyword">const</span> TreeEntry *<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>) {</div>
<div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;          <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;ReorderIndices.empty() || !<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;ReuseShuffleIndices.empty() ||</div>
<div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;              (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;State == TreeEntry::Vectorize &amp;&amp; <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;isAltShuffle()) ||</div>
<div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;              (IgnoreReorder &amp;&amp; <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;Idx == 0))</div>
<div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;State == TreeEntry::NeedToGather) {</div>
<div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;            <span class="keyword">auto</span> It = GathersToOrders.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(TE);</div>
<div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;            <span class="keywordflow">if</span> (It != GathersToOrders.<a class="code" href="classllvm_1_1DenseMapBase.html#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</div>
<div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;              <span class="keywordflow">return</span> !It-&gt;second.empty();</div>
<div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;          }</div>
<div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;        };</div>
<div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> EdgeInfo &amp;EI : OpTE-&gt;UserTreeIndices) {</div>
<div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;          TreeEntry *UserTE = EI.UserTE;</div>
<div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;          <span class="keywordflow">if</span> (!VisitedUsers.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(UserTE).second)</div>
<div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;          <span class="comment">// May reorder user node if it requires reordering, has reused</span></div>
<div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;          <span class="comment">// scalars, is an alternate op vectorize node or its op nodes require</span></div>
<div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;          <span class="comment">// reordering.</span></div>
<div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;          <span class="keywordflow">if</span> (AllowsReordering(UserTE))</div>
<div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;          <span class="comment">// Check if users allow reordering.</span></div>
<div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;          <span class="comment">// Currently look up just 1 level of operands to avoid increase of</span></div>
<div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;          <span class="comment">// the compile time.</span></div>
<div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;          <span class="comment">// Profitable to reorder if definitely more operands allow</span></div>
<div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;          <span class="comment">// reordering rather than those with natural order.</span></div>
<div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;          <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;std::pair&lt;unsigned, TreeEntry *&gt;</a>&gt; Ops = <a class="code" href="IVUsers_8cpp.html#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>[UserTE];</div>
<div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span><span class="keyword">&gt;</span>(<a class="code" href="namespacellvm.html#ac214df91cdc242f4710ea5a93939c678">count_if</a>(</div>
<div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;                  Ops, [UserTE, &amp;AllowsReordering](</div>
<div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;                           <span class="keyword">const</span> std::pair&lt;unsigned, TreeEntry *&gt; &amp;<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>) {</div>
<div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;                    <span class="keywordflow">return</span> AllowsReordering(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.second) &amp;&amp;</div>
<div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;                           <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.second-&gt;UserTreeIndices,</div>
<div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;                                  [UserTE](<span class="keyword">const</span> EdgeInfo &amp;EI) {</div>
<div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;                                    return EI.UserTE == UserTE;</div>
<div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;                                  });</div>
<div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;                  })) &lt;= Ops.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() / 2)</div>
<div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;            ++Res.first-&gt;second;</div>
<div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;        }</div>
<div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;      }</div>
<div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;      <span class="comment">// If no orders - skip current nodes and jump to the next one, if any.</span></div>
<div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;      <span class="keywordflow">if</span> (OrdersUses.empty()) {</div>
<div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;        <a class="code" href="namespacellvm.html#a0b2a153b655ed78a07468297eb4c6256">for_each</a>(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.second,</div>
<div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;                 [&amp;OrderedEntries](<span class="keyword">const</span> std::pair&lt;unsigned, TreeEntry *&gt; &amp;<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>) {</div>
<div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;                   OrderedEntries.remove(Op.second);</div>
<div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;                 });</div>
<div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;      }</div>
<div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;      <span class="comment">// Choose the best order.</span></div>
<div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;      <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;unsigned&gt;</a> BestOrder = OrdersUses.<a class="code" href="classllvm_1_1ArrayRef.html#a6bc2b53fce3b1d8975eea027d8a8eb90">front</a>().first;</div>
<div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;      <span class="keywordtype">unsigned</span> Cnt = OrdersUses.front().second;</div>
<div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;Pair : <a class="code" href="namespacellvm.html#a02981de53fb6ffd384d39addc4d25f37">drop_begin</a>(OrdersUses)) {</div>
<div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;        <span class="keywordflow">if</span> (Cnt &lt; Pair.second || (Cnt == Pair.second &amp;&amp; Pair.first.empty())) {</div>
<div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;          BestOrder = Pair.first;</div>
<div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;          Cnt = Pair.second;</div>
<div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;        }</div>
<div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;      }</div>
<div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;      <span class="comment">// Set order of the user node (reordering of operands and user nodes).</span></div>
<div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;      <span class="keywordflow">if</span> (BestOrder.<a class="code" href="classllvm_1_1ArrayRef.html#ac835b8735b1b2faec0efdca236e37d94">empty</a>()) {</div>
<div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;        <a class="code" href="namespacellvm.html#a0b2a153b655ed78a07468297eb4c6256">for_each</a>(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.second,</div>
<div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;                 [&amp;OrderedEntries](<span class="keyword">const</span> std::pair&lt;unsigned, TreeEntry *&gt; &amp;<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>) {</div>
<div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;                   OrderedEntries.remove(Op.second);</div>
<div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;                 });</div>
<div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;      }</div>
<div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;      <span class="comment">// Erase operands from OrderedEntries list and adjust their orders.</span></div>
<div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;      VisitedOps.<a class="code" href="classllvm_1_1SmallPtrSetImplBase.html#a16413f1a88d8baca228d0a1b4cc0bfc6">clear</a>();</div>
<div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>;</div>
<div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;      <a class="code" href="namespacellvm.html#a6f0917bf2ae18fac81fea6bf7e887115">inversePermutation</a>(BestOrder, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> MaskOrder(BestOrder.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(), <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = BestOrder.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>();</div>
<div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;      <a class="code" href="namespacellvm.html#a615619b0b2879029152b9a20e96624bc">transform</a>(BestOrder, MaskOrder.begin(), [<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>](<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;        return I &lt; E ? static_cast&lt;int&gt;(I) : UndefMaskElem;</div>
<div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;      });</div>
<div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">const</span> std::pair&lt;unsigned, TreeEntry *&gt; &amp;<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> : <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.second) {</div>
<div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;        TreeEntry *<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a> = <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.second;</div>
<div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;        OrderedEntries.remove(TE);</div>
<div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;        <span class="keywordflow">if</span> (!VisitedOps.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(TE).second)</div>
<div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;ReuseShuffleIndices.size() == BestOrder.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>()) {</div>
<div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;          reorderNodeWithReuses(*TE, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;        }</div>
<div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;        <span class="comment">// Gathers are processed separately.</span></div>
<div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;State != TreeEntry::Vectorize)</div>
<div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((BestOrder.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() == <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;ReorderIndices.size() ||</div>
<div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;                <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;ReorderIndices.empty()) &amp;&amp;</div>
<div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;               <span class="stringliteral">&quot;Non-matching sizes of user/operand entries.&quot;</span>);</div>
<div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;        <a class="code" href="SLPVectorizer_8cpp.html#a52b518b4e744d8c2d89e04e30e7be715">reorderOrder</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;ReorderIndices, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;        <span class="keywordflow">if</span> (IgnoreReorder &amp;&amp; TE == VectorizableTree.front().get())</div>
<div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;          IgnoreReorder = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;      }</div>
<div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;      <span class="comment">// For gathers just need to reorder its scalars.</span></div>
<div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;      <span class="keywordflow">for</span> (TreeEntry *Gather : GatherOps) {</div>
<div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Gather-&gt;ReorderIndices.empty() &amp;&amp;</div>
<div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;               <span class="stringliteral">&quot;Unexpected reordering of gathers.&quot;</span>);</div>
<div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;        <span class="keywordflow">if</span> (!Gather-&gt;ReuseShuffleIndices.empty()) {</div>
<div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;          <span class="comment">// Just reorder reuses indices.</span></div>
<div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;          <a class="code" href="SLPVectorizer_8cpp.html#a4a3e80130d3f25468190ba343064b37e">reorderReuses</a>(Gather-&gt;ReuseShuffleIndices, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;        }</div>
<div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;        <a class="code" href="namespacellvm.html#a14c12bda1f5a9beed612b00f3f98b888">reorderScalars</a>(Gather-&gt;Scalars, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;        OrderedEntries.remove(Gather);</div>
<div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;      }</div>
<div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;      <span class="comment">// Reorder operands of the user node and set the ordering for the user</span></div>
<div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;      <span class="comment">// node itself.</span></div>
<div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.first-&gt;State != TreeEntry::Vectorize ||</div>
<div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;          !isa&lt;ExtractElementInst, ExtractValueInst, LoadInst&gt;(</div>
<div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;              <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.first-&gt;getMainOp()) ||</div>
<div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;          <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.first-&gt;isAltShuffle())</div>
<div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;        <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.first-&gt;reorderOperands(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;      <span class="keywordflow">if</span> (!isa&lt;InsertElementInst, StoreInst&gt;(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.first-&gt;getMainOp()) ||</div>
<div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;          <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.first-&gt;isAltShuffle()) {</div>
<div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;        <a class="code" href="namespacellvm.html#a14c12bda1f5a9beed612b00f3f98b888">reorderScalars</a>(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.first-&gt;Scalars, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;        <a class="code" href="SLPVectorizer_8cpp.html#a52b518b4e744d8c2d89e04e30e7be715">reorderOrder</a>(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.first-&gt;ReorderIndices, MaskOrder);</div>
<div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.first-&gt;ReuseShuffleIndices.empty() &amp;&amp;</div>
<div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;            !<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.first-&gt;ReorderIndices.empty() &amp;&amp;</div>
<div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;            !<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.first-&gt;isAltShuffle()) {</div>
<div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;          <span class="comment">// Insert user node to the list to try to sink reordering deeper in</span></div>
<div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;          <span class="comment">// the graph.</span></div>
<div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;          OrderedEntries.insert(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.first);</div>
<div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;        }</div>
<div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;        <a class="code" href="SLPVectorizer_8cpp.html#a52b518b4e744d8c2d89e04e30e7be715">reorderOrder</a>(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.first-&gt;ReorderIndices, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;      }</div>
<div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;    }</div>
<div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;  }</div>
<div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;  <span class="comment">// If the reordering is unnecessary, just remove the reorder.</span></div>
<div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;  <span class="keywordflow">if</span> (IgnoreReorder &amp;&amp; !VectorizableTree.front()-&gt;ReorderIndices.empty() &amp;&amp;</div>
<div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;      VectorizableTree.front()-&gt;ReuseShuffleIndices.empty())</div>
<div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;    VectorizableTree.front()-&gt;ReorderIndices.clear();</div>
<div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;}</div>
<div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160; </div>
<div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;<span class="keywordtype">void</span> BoUpSLP::buildExternalUses(</div>
<div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;    <span class="keyword">const</span> ExtraValueToDebugLocsMap &amp;ExternallyUsedValues) {</div>
<div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;  <span class="comment">// Collect the values that we need to extract from the tree.</span></div>
<div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;TEPtr : VectorizableTree) {</div>
<div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;    TreeEntry *Entry = TEPtr.get();</div>
<div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160; </div>
<div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;    <span class="comment">// No need to handle users of gathered values.</span></div>
<div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;    <span class="keywordflow">if</span> (Entry-&gt;State == TreeEntry::NeedToGather)</div>
<div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160; </div>
<div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;    <span class="comment">// For each lane:</span></div>
<div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> Lane = 0, <a class="code" href="namespacellvm_1_1AArch64CC.html#abfa1f7dce576430da99eed57807c7f28aeb67eda6b42e3237bc28fb457347a1cb">LE</a> = Entry-&gt;Scalars.size(); Lane != <a class="code" href="namespacellvm_1_1AArch64CC.html#abfa1f7dce576430da99eed57807c7f28aeb67eda6b42e3237bc28fb457347a1cb">LE</a>; ++Lane) {</div>
<div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a> = Entry-&gt;Scalars[Lane];</div>
<div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;      <span class="keywordtype">int</span> FoundLane = Entry-&gt;findLaneForValue(Scalar);</div>
<div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160; </div>
<div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;      <span class="comment">// Check if the scalar is externally used as an extra arg.</span></div>
<div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;      <span class="keyword">auto</span> ExtI = ExternallyUsedValues.find(Scalar);</div>
<div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;      <span class="keywordflow">if</span> (ExtI != ExternallyUsedValues.end()) {</div>
<div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Need to extract: Extra arg from lane &quot;</span></div>
<div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;                          &lt;&lt; Lane &lt;&lt; <span class="stringliteral">&quot; from &quot;</span> &lt;&lt; *Scalar &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;        ExternalUses.emplace_back(Scalar, <span class="keyword">nullptr</span>, FoundLane);</div>
<div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;      }</div>
<div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1User.html">User</a> *U : <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a>-&gt;users()) {</div>
<div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Checking user:&quot;</span> &lt;&lt; *U &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160; </div>
<div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;        <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *UserInst = dyn_cast&lt;Instruction&gt;(U);</div>
<div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;        <span class="keywordflow">if</span> (!UserInst)</div>
<div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160; </div>
<div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;        <span class="keywordflow">if</span> (isDeleted(UserInst))</div>
<div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160; </div>
<div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;        <span class="comment">// Skip in-tree scalars that become vectors</span></div>
<div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;        <span class="keywordflow">if</span> (TreeEntry *UseEntry = getTreeEntry(U)) {</div>
<div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *UseScalar = UseEntry-&gt;Scalars[0];</div>
<div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;          <span class="comment">// Some in-tree scalars will remain as scalar in vectorized</span></div>
<div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;          <span class="comment">// instructions. If that is the case, the one in Lane 0 will</span></div>
<div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;          <span class="comment">// be used.</span></div>
<div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;          <span class="keywordflow">if</span> (UseScalar != U ||</div>
<div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;              UseEntry-&gt;State == TreeEntry::ScatterVectorize ||</div>
<div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160;              !<a class="code" href="SLPVectorizer_8cpp.html#afebd06edd5d7c956687d26be5c6040c1">InTreeUserNeedToExtract</a>(Scalar, UserInst, TLI)) {</div>
<div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;            <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: \tInternal user will be removed:&quot;</span> &lt;&lt; *U</div>
<div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160;                              &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l04689"></a><span class="lineno"> 4689</span>&#160;            <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(UseEntry-&gt;State != TreeEntry::NeedToGather &amp;&amp; <span class="stringliteral">&quot;Bad state&quot;</span>);</div>
<div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;          }</div>
<div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;        }</div>
<div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160; </div>
<div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;        <span class="comment">// Ignore users in the user ignore list.</span></div>
<div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;        <span class="keywordflow">if</span> (UserIgnoreList &amp;&amp; UserIgnoreList-&gt;contains(UserInst))</div>
<div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160; </div>
<div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Need to extract:&quot;</span> &lt;&lt; *U &lt;&lt; <span class="stringliteral">&quot; from lane &quot;</span></div>
<div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;                          &lt;&lt; Lane &lt;&lt; <span class="stringliteral">&quot; from &quot;</span> &lt;&lt; *Scalar &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;        ExternalUses.push_back(ExternalUser(Scalar, U, FoundLane));</div>
<div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;      }</div>
<div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;    }</div>
<div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;  }</div>
<div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;}</div>
<div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160; </div>
<div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;<a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, SmallVector&lt;StoreInst *, 4&gt;</a>&gt;</div>
<div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;BoUpSLP::collectUserStores(<span class="keyword">const</span> BoUpSLP::TreeEntry *TE)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, SmallVector&lt;StoreInst *, 4&gt;</a>&gt; PtrToStoresMap;</div>
<div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Lane : seq&lt;unsigned&gt;(0, <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;Scalars.size())) {</div>
<div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;Scalars[Lane];</div>
<div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;    <span class="comment">// To save compilation time we don&#39;t visit if we have too many users.</span></div>
<div class="line"><a name="l04712"></a><span class="lineno"> 4712</span>&#160;    <span class="keyword">static</span> constexpr <span class="keywordtype">unsigned</span> UsersLimit = 4;</div>
<div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160;    <span class="keywordflow">if</span> (V-&gt;<a class="code" href="classllvm_1_1Value.html#a72fb137716cff838d389e392b9729dc9">hasNUsesOrMore</a>(UsersLimit))</div>
<div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l04715"></a><span class="lineno"> 4715</span>&#160; </div>
<div class="line"><a name="l04716"></a><span class="lineno"> 4716</span>&#160;    <span class="comment">// Collect stores per pointer object.</span></div>
<div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1User.html">User</a> *U : V-&gt;<a class="code" href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">users</a>()) {</div>
<div class="line"><a name="l04718"></a><span class="lineno"> 4718</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;StoreInst&gt;(U);</div>
<div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> == <span class="keyword">nullptr</span> || !<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;isSimple() ||</div>
<div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;          !<a class="code" href="SLPVectorizer_8cpp.html#aa3ea54a95743867473d32853d3c65603">isValidElementType</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getValueOperand()-&gt;getType()))</div>
<div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04722"></a><span class="lineno"> 4722</span>&#160;      <span class="comment">// Skip entry if already</span></div>
<div class="line"><a name="l04723"></a><span class="lineno"> 4723</span>&#160;      <span class="keywordflow">if</span> (getTreeEntry(U))</div>
<div class="line"><a name="l04724"></a><span class="lineno"> 4724</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04725"></a><span class="lineno"> 4725</span>&#160; </div>
<div class="line"><a name="l04726"></a><span class="lineno"> 4726</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a class="code" href="namespacellvm.html#a3b1c5788b85ffa254be0e834edf5cf8f">getUnderlyingObject</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getPointerOperand());</div>
<div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160;      <span class="keyword">auto</span> &amp;StoresVec = PtrToStoresMap[<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>];</div>
<div class="line"><a name="l04728"></a><span class="lineno"> 4728</span>&#160;      <span class="comment">// For now just keep one store per pointer object per lane.</span></div>
<div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160;      <span class="comment">// TODO: Extend this to support multiple stores per pointer per lane</span></div>
<div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160;      <span class="keywordflow">if</span> (StoresVec.size() &gt; Lane)</div>
<div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;      <span class="comment">// Skip if in different BBs.</span></div>
<div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;      <span class="keywordflow">if</span> (!StoresVec.empty() &amp;&amp;</div>
<div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;          <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getParent() != StoresVec.back()-&gt;getParent())</div>
<div class="line"><a name="l04735"></a><span class="lineno"> 4735</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;      <span class="comment">// Make sure that the stores are of the same type.</span></div>
<div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;      <span class="keywordflow">if</span> (!StoresVec.empty() &amp;&amp;</div>
<div class="line"><a name="l04738"></a><span class="lineno"> 4738</span>&#160;          <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getValueOperand()-&gt;getType() !=</div>
<div class="line"><a name="l04739"></a><span class="lineno"> 4739</span>&#160;              StoresVec.back()-&gt;getValueOperand()-&gt;getType())</div>
<div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04741"></a><span class="lineno"> 4741</span>&#160;      StoresVec.push_back(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160;    }</div>
<div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;  }</div>
<div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160;  <span class="keywordflow">return</span> PtrToStoresMap;</div>
<div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160;}</div>
<div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160; </div>
<div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;<span class="keywordtype">bool</span> BoUpSLP::canFormVector(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;StoreInst *, 4&gt;</a> &amp;StoresVec,</div>
<div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;                            OrdersType &amp;ReorderIndices)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l04749"></a><span class="lineno"> 4749</span>&#160;  <span class="comment">// We check whether the stores in StoreVec can form a vector by sorting them</span></div>
<div class="line"><a name="l04750"></a><span class="lineno"> 4750</span>&#160;  <span class="comment">// and checking whether they are consecutive.</span></div>
<div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160; </div>
<div class="line"><a name="l04752"></a><span class="lineno"> 4752</span>&#160;  <span class="comment">// To avoid calling getPointersDiff() while sorting we create a vector of</span></div>
<div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160;  <span class="comment">// pairs {store, offset from first} and sort this instead.</span></div>
<div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;StoreInst *, int&gt;</a>, 4&gt; StoreOffsetVec(StoresVec.size());</div>
<div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;  <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *S0 = StoresVec[0];</div>
<div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160;  StoreOffsetVec[0] = {S0, 0};</div>
<div class="line"><a name="l04757"></a><span class="lineno"> 4757</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *S0Ty = S0-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a14298313bdf734e2db5a921cc6e861a0">getValueOperand</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l04758"></a><span class="lineno"> 4758</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *S0Ptr = S0-&gt;<a class="code" href="classllvm_1_1StoreInst.html#ac03c1c093059ea000216af8dd6f2dbf4">getPointerOperand</a>();</div>
<div class="line"><a name="l04759"></a><span class="lineno"> 4759</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Idx : seq&lt;unsigned&gt;(1, StoresVec.size())) {</div>
<div class="line"><a name="l04760"></a><span class="lineno"> 4760</span>&#160;    <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = StoresVec[Idx];</div>
<div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160;    std::optional&lt;int&gt; Diff =</div>
<div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160;        <a class="code" href="namespacellvm.html#a034d66b8c0aeb72ea13fd26392083446">getPointersDiff</a>(S0Ty, S0Ptr, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getValueOperand()-&gt;getType(),</div>
<div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160;                        <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getPointerOperand(), *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, *SE,</div>
<div class="line"><a name="l04764"></a><span class="lineno"> 4764</span>&#160;                        <span class="comment">/*StrictCheck=*/</span><span class="keyword">true</span>);</div>
<div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;    <span class="comment">// We failed to compare the pointers so just abandon this StoresVec.</span></div>
<div class="line"><a name="l04766"></a><span class="lineno"> 4766</span>&#160;    <span class="keywordflow">if</span> (!Diff)</div>
<div class="line"><a name="l04767"></a><span class="lineno"> 4767</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04768"></a><span class="lineno"> 4768</span>&#160;    StoreOffsetVec[Idx] = {StoresVec[Idx], *Diff};</div>
<div class="line"><a name="l04769"></a><span class="lineno"> 4769</span>&#160;  }</div>
<div class="line"><a name="l04770"></a><span class="lineno"> 4770</span>&#160; </div>
<div class="line"><a name="l04771"></a><span class="lineno"> 4771</span>&#160;  <span class="comment">// Sort the vector based on the pointers. We create a copy because we may</span></div>
<div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;  <span class="comment">// need the original later for calculating the reorder (shuffle) indices.</span></div>
<div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;  <a class="code" href="namespacellvm.html#a076f93c387f454f0db13d4bc7d4e7f9c">stable_sort</a>(StoreOffsetVec, [](<span class="keyword">const</span> std::pair&lt;StoreInst *, int&gt; &amp;Pair1,</div>
<div class="line"><a name="l04774"></a><span class="lineno"> 4774</span>&#160;                                 <span class="keyword">const</span> std::pair&lt;StoreInst *, int&gt; &amp;Pair2) {</div>
<div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160;    <span class="keywordtype">int</span> Offset1 = Pair1.second;</div>
<div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;    <span class="keywordtype">int</span> Offset2 = Pair2.second;</div>
<div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;    <span class="keywordflow">return</span> Offset1 &lt; Offset2;</div>
<div class="line"><a name="l04778"></a><span class="lineno"> 4778</span>&#160;  });</div>
<div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160; </div>
<div class="line"><a name="l04780"></a><span class="lineno"> 4780</span>&#160;  <span class="comment">// Check if the stores are consecutive by checking if their difference is 1.</span></div>
<div class="line"><a name="l04781"></a><span class="lineno"> 4781</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Idx : seq&lt;unsigned&gt;(1, StoreOffsetVec.size()))</div>
<div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160;    <span class="keywordflow">if</span> (StoreOffsetVec[Idx].second != StoreOffsetVec[Idx-1].second + 1)</div>
<div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04784"></a><span class="lineno"> 4784</span>&#160; </div>
<div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160;  <span class="comment">// Calculate the shuffle indices according to their offset against the sorted</span></div>
<div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;  <span class="comment">// StoreOffsetVec.</span></div>
<div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;  ReorderIndices.reserve(StoresVec.size());</div>
<div class="line"><a name="l04788"></a><span class="lineno"> 4788</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> : StoresVec) {</div>
<div class="line"><a name="l04789"></a><span class="lineno"> 4789</span>&#160;    <span class="keywordtype">unsigned</span> Idx = <a class="code" href="namespacellvm.html#ac78c09ae232b2ce188ff590d51e3c268">find_if</a>(StoreOffsetVec,</div>
<div class="line"><a name="l04790"></a><span class="lineno"> 4790</span>&#160;                           [<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>](<span class="keyword">const</span> std::pair&lt;StoreInst *, int&gt; &amp;Pair) {</div>
<div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;                             <span class="keywordflow">return</span> Pair.first == <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>;</div>
<div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;                           }) -</div>
<div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160;                   StoreOffsetVec.begin();</div>
<div class="line"><a name="l04794"></a><span class="lineno"> 4794</span>&#160;    ReorderIndices.push_back(Idx);</div>
<div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160;  }</div>
<div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;  <span class="comment">// Identity order (e.g., {0,1,2,3}) is modeled as an empty OrdersType in</span></div>
<div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;  <span class="comment">// reorderTopToBottom() and reorderBottomToTop(), so we are following the</span></div>
<div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;  <span class="comment">// same convention here.</span></div>
<div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;  <span class="keyword">auto</span> IsIdentityOrder = [](<span class="keyword">const</span> OrdersType &amp;Order) {</div>
<div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Idx : seq&lt;unsigned&gt;(0, Order.size()))</div>
<div class="line"><a name="l04801"></a><span class="lineno"> 4801</span>&#160;      <span class="keywordflow">if</span> (Idx != Order[Idx])</div>
<div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160;  };</div>
<div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;  <span class="keywordflow">if</span> (IsIdentityOrder(ReorderIndices))</div>
<div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;    ReorderIndices.clear();</div>
<div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160; </div>
<div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;}</div>
<div class="line"><a name="l04810"></a><span class="lineno"> 4810</span>&#160; </div>
<div class="line"><a name="l04811"></a><span class="lineno"> 4811</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l04812"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a9fb7740f0fb6e5a825320f3c63df3263"> 4812</a></span>&#160;<a class="code" href="Compiler_8h.html#aa863693eef567397d9c292da5bf22d34">LLVM_DUMP_METHOD</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="SLPVectorizer_8cpp.html#a9fb7740f0fb6e5a825320f3c63df3263">dumpOrder</a>(<span class="keyword">const</span> BoUpSLP::OrdersType &amp;Order) {</div>
<div class="line"><a name="l04813"></a><span class="lineno"> 4813</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Idx : Order)</div>
<div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160;    <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; Idx &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div>
<div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;  <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160;}</div>
<div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04818"></a><span class="lineno"> 4818</span>&#160; </div>
<div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160;<a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BoUpSLP::OrdersType, 1&gt;</a></div>
<div class="line"><a name="l04820"></a><span class="lineno"> 4820</span>&#160;BoUpSLP::findExternalStoreUsersReorderIndices(TreeEntry *TE)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l04821"></a><span class="lineno"> 4821</span>&#160;  <span class="keywordtype">unsigned</span> NumLanes = <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;Scalars.size();</div>
<div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160; </div>
<div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, SmallVector&lt;StoreInst *, 4&gt;</a>&gt; PtrToStoresMap =</div>
<div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;      collectUserStores(TE);</div>
<div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160; </div>
<div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;  <span class="comment">// Holds the reorder indices for each candidate store vector that is a user of</span></div>
<div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;  <span class="comment">// the current TreeEntry.</span></div>
<div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;OrdersType, 1&gt;</a> ExternalReorderIndices;</div>
<div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160; </div>
<div class="line"><a name="l04830"></a><span class="lineno"> 4830</span>&#160;  <span class="comment">// Now inspect the stores collected per pointer and look for vectorization</span></div>
<div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;  <span class="comment">// candidates. For each candidate calculate the reorder index vector and push</span></div>
<div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;  <span class="comment">// it into `ExternalReorderIndices`</span></div>
<div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;Pair : PtrToStoresMap) {</div>
<div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;    <span class="keyword">auto</span> &amp;StoresVec = Pair.second;</div>
<div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;    <span class="comment">// If we have fewer than NumLanes stores, then we can&#39;t form a vector.</span></div>
<div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160;    <span class="keywordflow">if</span> (StoresVec.size() != NumLanes)</div>
<div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04838"></a><span class="lineno"> 4838</span>&#160; </div>
<div class="line"><a name="l04839"></a><span class="lineno"> 4839</span>&#160;    <span class="comment">// If the stores are not consecutive then abandon this StoresVec.</span></div>
<div class="line"><a name="l04840"></a><span class="lineno"> 4840</span>&#160;    OrdersType ReorderIndices;</div>
<div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;    <span class="keywordflow">if</span> (!canFormVector(StoresVec, ReorderIndices))</div>
<div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160; </div>
<div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;    <span class="comment">// We now know that the scalars in StoresVec can form a vector instruction,</span></div>
<div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;    <span class="comment">// so set the reorder indices.</span></div>
<div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;    ExternalReorderIndices.push_back(ReorderIndices);</div>
<div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;  }</div>
<div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;  <span class="keywordflow">return</span> ExternalReorderIndices;</div>
<div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;}</div>
<div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160; </div>
<div class="line"><a name="l04851"></a><span class="lineno"> 4851</span>&#160;<span class="keywordtype">void</span> BoUpSLP::buildTree(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> Roots,</div>
<div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;                        <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallDenseSet.html">SmallDenseSet&lt;Value *&gt;</a> &amp;UserIgnoreLst) {</div>
<div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160;  deleteTree();</div>
<div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;  UserIgnoreList = &amp;UserIgnoreLst;</div>
<div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="SLPVectorizer_8cpp.html#aabfbce373feafd33ca9e104d8b164ece">allSameType</a>(Roots))</div>
<div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04857"></a><span class="lineno"> 4857</span>&#160;  buildTree_rec(Roots, 0, EdgeInfo());</div>
<div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;}</div>
<div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160; </div>
<div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;<span class="keywordtype">void</span> BoUpSLP::buildTree(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> Roots) {</div>
<div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;  deleteTree();</div>
<div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="SLPVectorizer_8cpp.html#aabfbce373feafd33ca9e104d8b164ece">allSameType</a>(Roots))</div>
<div class="line"><a name="l04863"></a><span class="lineno"> 4863</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160;  buildTree_rec(Roots, 0, EdgeInfo());</div>
<div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;}</div>
<div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160;<span class="comment">/// \return true if the specified list of values has only one instruction that</span></div>
<div class="line"><a name="l04868"></a><span class="lineno"> 4868</span>&#160;<span class="comment">/// requires scheduling, false otherwise.</span></div>
<div class="line"><a name="l04869"></a><span class="lineno"> 4869</span>&#160;<span class="comment"></span><span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l04870"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a2acd0e4598d1a9c34a8f2d9c9f98aaca"> 4870</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#a2acd0e4598d1a9c34a8f2d9c9f98aaca">needToScheduleSingleInstruction</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL) {</div>
<div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NeedsScheduling = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a05a7412bf10f2226fb69f2876b76e9cd">doesNotNeedToBeScheduled</a>(V))</div>
<div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;    <span class="keywordflow">if</span> (!NeedsScheduling) {</div>
<div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160;      NeedsScheduling = V;</div>
<div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04878"></a><span class="lineno"> 4878</span>&#160;    }</div>
<div class="line"><a name="l04879"></a><span class="lineno"> 4879</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04880"></a><span class="lineno"> 4880</span>&#160;  }</div>
<div class="line"><a name="l04881"></a><span class="lineno"> 4881</span>&#160;  <span class="keywordflow">return</span> NeedsScheduling;</div>
<div class="line"><a name="l04882"></a><span class="lineno"> 4882</span>&#160;}</div>
<div class="line"><a name="l04883"></a><span class="lineno"> 4883</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04884"></a><span class="lineno"> 4884</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l04885"></a><span class="lineno"> 4885</span>&#160;<span class="comment">/// Generates key/subkey pair for the given value to provide effective sorting</span></div>
<div class="line"><a name="l04886"></a><span class="lineno"> 4886</span>&#160;<span class="comment">/// of the values and better detection of the vectorizable values sequences. The</span></div>
<div class="line"><a name="l04887"></a><span class="lineno"> 4887</span>&#160;<span class="comment">/// keys/subkeys can be used for better sorting of the values themselves (keys)</span></div>
<div class="line"><a name="l04888"></a><span class="lineno"> 4888</span>&#160;<span class="comment">/// and in values subgroups (subkeys).</span></div>
<div class="line"><a name="l04889"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#ac8e9faa42b77ed7ed26cba77288e6f73"> 4889</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> std::pair&lt;size_t, size_t&gt; <a class="code" href="SLPVectorizer_8cpp.html#ac8e9faa42b77ed7ed26cba77288e6f73">generateKeySubkey</a>(</div>
<div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> *TLI,</div>
<div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;    <a class="code" href="classllvm_1_1function__ref.html">function_ref</a>&lt;<a class="code" href="classllvm_1_1hash__code.html">hash_code</a>(<span class="keywordtype">size_t</span>, <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *)&gt; LoadsSubkeyGenerator,</div>
<div class="line"><a name="l04892"></a><span class="lineno"> 4892</span>&#160;    <span class="keywordtype">bool</span> AllowAlternate) {</div>
<div class="line"><a name="l04893"></a><span class="lineno"> 4893</span>&#160;  <a class="code" href="classllvm_1_1hash__code.html">hash_code</a> <a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a> = <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(V-&gt;<a class="code" href="classllvm_1_1Value.html#a4a6ca5a5b87bd84231be9d8dbec46c1a">getValueID</a>() + 2);</div>
<div class="line"><a name="l04894"></a><span class="lineno"> 4894</span>&#160;  <a class="code" href="classllvm_1_1hash__code.html">hash_code</a> SubKey = <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(0);</div>
<div class="line"><a name="l04895"></a><span class="lineno"> 4895</span>&#160;  <span class="comment">// Sort the loads by the distance between the pointers.</span></div>
<div class="line"><a name="l04896"></a><span class="lineno"> 4896</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *LI = dyn_cast&lt;LoadInst&gt;(V)) {</div>
<div class="line"><a name="l04897"></a><span class="lineno"> 4897</span>&#160;    <a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a> = <a class="code" href="namespacellvm.html#add71474638430694c84640146383fc44">hash_combine</a>(LI-&gt;getType(), <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Instruction::Load</a>), <a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>);</div>
<div class="line"><a name="l04898"></a><span class="lineno"> 4898</span>&#160;    <span class="keywordflow">if</span> (LI-&gt;isSimple())</div>
<div class="line"><a name="l04899"></a><span class="lineno"> 4899</span>&#160;      SubKey = <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(LoadsSubkeyGenerator(<a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>, LI));</div>
<div class="line"><a name="l04900"></a><span class="lineno"> 4900</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l04901"></a><span class="lineno"> 4901</span>&#160;      <a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a> = SubKey = <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(LI);</div>
<div class="line"><a name="l04902"></a><span class="lineno"> 4902</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#a06a9edb69d0ed6fda201d59948acfd89">isVectorLikeInstWithConstOps</a>(V)) {</div>
<div class="line"><a name="l04903"></a><span class="lineno"> 4903</span>&#160;    <span class="comment">// Sort extracts by the vector operands.</span></div>
<div class="line"><a name="l04904"></a><span class="lineno"> 4904</span>&#160;    <span class="keywordflow">if</span> (isa&lt;ExtractElementInst, UndefValue&gt;(V))</div>
<div class="line"><a name="l04905"></a><span class="lineno"> 4905</span>&#160;      <a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a> = <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(Value::UndefValueVal + 1);</div>
<div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *EI = dyn_cast&lt;ExtractElementInst&gt;(V)) {</div>
<div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="SLPVectorizer_8cpp.html#ac396bb87eb4db1dd3ce315e4d91ee2de">isUndefVector</a>(EI-&gt;getVectorOperand()).<a class="code" href="classllvm_1_1SmallBitVector.html#a8cfcd92a373cdd7deefb939dd76b83e3">all</a>() &amp;&amp;</div>
<div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;          !isa&lt;UndefValue&gt;(EI-&gt;getIndexOperand()))</div>
<div class="line"><a name="l04909"></a><span class="lineno"> 4909</span>&#160;        SubKey = <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(EI-&gt;getVectorOperand());</div>
<div class="line"><a name="l04910"></a><span class="lineno"> 4910</span>&#160;    }</div>
<div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V)) {</div>
<div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;    <span class="comment">// Sort other instructions just by the opcodes except for CMPInst.</span></div>
<div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;    <span class="comment">// For CMP also sort by the predicate kind.</span></div>
<div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;    <span class="keywordflow">if</span> ((isa&lt;BinaryOperator, CastInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</div>
<div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;        <a class="code" href="SLPVectorizer_8cpp.html#a8f3292dcaad99569501ace7909f2ccf0">isValidForAlternation</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode())) {</div>
<div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160;      <span class="keywordflow">if</span> (AllowAlternate)</div>
<div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160;        <a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a> = <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(isa&lt;BinaryOperator&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ? 1 : 0);</div>
<div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160;        <a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a> = <a class="code" href="namespacellvm.html#add71474638430694c84640146383fc44">hash_combine</a>(<a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()), <a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>);</div>
<div class="line"><a name="l04920"></a><span class="lineno"> 4920</span>&#160;      SubKey = <a class="code" href="namespacellvm.html#add71474638430694c84640146383fc44">hash_combine</a>(</div>
<div class="line"><a name="l04921"></a><span class="lineno"> 4921</span>&#160;          <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()), <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()),</div>
<div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160;          <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(isa&lt;BinaryOperator&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l04923"></a><span class="lineno"> 4923</span>&#160;                         ? <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()</div>
<div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;                         : cast&lt;CastInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getOperand(0)-&gt;getType()));</div>
<div class="line"><a name="l04925"></a><span class="lineno"> 4925</span>&#160;      <span class="comment">// For casts, look through the only operand to improve compile time.</span></div>
<div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;      <span class="keywordflow">if</span> (isa&lt;CastInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l04927"></a><span class="lineno"> 4927</span>&#160;        std::pair&lt;size_t, size_t&gt; OpVals =</div>
<div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160;            <a class="code" href="SLPVectorizer_8cpp.html#ac8e9faa42b77ed7ed26cba77288e6f73">generateKeySubkey</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), TLI, LoadsSubkeyGenerator,</div>
<div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;                              <span class="comment">/*AllowAlternate=*/</span><span class="keyword">true</span>);</div>
<div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;        <a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a> = <a class="code" href="namespacellvm.html#add71474638430694c84640146383fc44">hash_combine</a>(OpVals.first, <a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>);</div>
<div class="line"><a name="l04931"></a><span class="lineno"> 4931</span>&#160;        SubKey = <a class="code" href="namespacellvm.html#add71474638430694c84640146383fc44">hash_combine</a>(OpVals.first, SubKey);</div>
<div class="line"><a name="l04932"></a><span class="lineno"> 4932</span>&#160;      }</div>
<div class="line"><a name="l04933"></a><span class="lineno"> 4933</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *CI = dyn_cast&lt;CmpInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l04934"></a><span class="lineno"> 4934</span>&#160;      <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> Pred = CI-&gt;getPredicate();</div>
<div class="line"><a name="l04935"></a><span class="lineno"> 4935</span>&#160;      <span class="keywordflow">if</span> (CI-&gt;isCommutative())</div>
<div class="line"><a name="l04936"></a><span class="lineno"> 4936</span>&#160;        Pred = <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(Pred, <a class="code" href="classllvm_1_1CmpInst.html#aa2a54b545d237ecfe450fd1292f7675e">CmpInst::getInversePredicate</a>(Pred));</div>
<div class="line"><a name="l04937"></a><span class="lineno"> 4937</span>&#160;      <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> SwapPred = <a class="code" href="classllvm_1_1CmpInst.html#a49a2d8f483ea08a3d6ea75f90c640d76">CmpInst::getSwappedPredicate</a>(Pred);</div>
<div class="line"><a name="l04938"></a><span class="lineno"> 4938</span>&#160;      SubKey = <a class="code" href="namespacellvm.html#add71474638430694c84640146383fc44">hash_combine</a>(<a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()), <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(Pred),</div>
<div class="line"><a name="l04939"></a><span class="lineno"> 4939</span>&#160;                            <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(SwapPred),</div>
<div class="line"><a name="l04940"></a><span class="lineno"> 4940</span>&#160;                            <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(CI-&gt;getOperand(0)-&gt;getType()));</div>
<div class="line"><a name="l04941"></a><span class="lineno"> 4941</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Call = dyn_cast&lt;CallInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l04942"></a><span class="lineno"> 4942</span>&#160;      <a class="code" href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> <a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a> = <a class="code" href="namespacellvm.html#a11c66d01880f53332fc7ad53f565b039">getVectorIntrinsicIDForCall</a>(Call, TLI);</div>
<div class="line"><a name="l04943"></a><span class="lineno"> 4943</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#aeb65ce026673a69aac75e5a7a26007b3">isTriviallyVectorizable</a>(<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>)) {</div>
<div class="line"><a name="l04944"></a><span class="lineno"> 4944</span>&#160;        SubKey = <a class="code" href="namespacellvm.html#add71474638430694c84640146383fc44">hash_combine</a>(<a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()), <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>));</div>
<div class="line"><a name="l04945"></a><span class="lineno"> 4945</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classllvm_1_1VFDatabase.html">VFDatabase</a>(*Call).<a class="code" href="classllvm_1_1VFDatabase.html#af9abb14ef675e9dee8dd14bd4dd43aac">getMappings</a>(*Call).empty()) {</div>
<div class="line"><a name="l04946"></a><span class="lineno"> 4946</span>&#160;        SubKey = <a class="code" href="namespacellvm.html#add71474638430694c84640146383fc44">hash_combine</a>(<a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()),</div>
<div class="line"><a name="l04947"></a><span class="lineno"> 4947</span>&#160;                              <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(Call-&gt;getCalledFunction()));</div>
<div class="line"><a name="l04948"></a><span class="lineno"> 4948</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04949"></a><span class="lineno"> 4949</span>&#160;        <a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a> = <a class="code" href="namespacellvm.html#add71474638430694c84640146383fc44">hash_combine</a>(<a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(Call), <a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>);</div>
<div class="line"><a name="l04950"></a><span class="lineno"> 4950</span>&#160;        SubKey = <a class="code" href="namespacellvm.html#add71474638430694c84640146383fc44">hash_combine</a>(<a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()), <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(Call));</div>
<div class="line"><a name="l04951"></a><span class="lineno"> 4951</span>&#160;      }</div>
<div class="line"><a name="l04952"></a><span class="lineno"> 4952</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="structllvm_1_1CallBase_1_1BundleOpInfo.html">CallBase::BundleOpInfo</a> &amp;<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> : Call-&gt;bundle_op_infos())</div>
<div class="line"><a name="l04953"></a><span class="lineno"> 4953</span>&#160;        SubKey = <a class="code" href="namespacellvm.html#add71474638430694c84640146383fc44">hash_combine</a>(<a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.Begin), <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.End),</div>
<div class="line"><a name="l04954"></a><span class="lineno"> 4954</span>&#160;                              <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>.Tag), SubKey);</div>
<div class="line"><a name="l04955"></a><span class="lineno"> 4955</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Gep = dyn_cast&lt;GetElementPtrInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l04956"></a><span class="lineno"> 4956</span>&#160;      <span class="keywordflow">if</span> (Gep-&gt;getNumOperands() == 2 &amp;&amp; isa&lt;ConstantInt&gt;(Gep-&gt;getOperand(1)))</div>
<div class="line"><a name="l04957"></a><span class="lineno"> 4957</span>&#160;        SubKey = <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(Gep-&gt;getPointerOperand());</div>
<div class="line"><a name="l04958"></a><span class="lineno"> 4958</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l04959"></a><span class="lineno"> 4959</span>&#160;        SubKey = <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(Gep);</div>
<div class="line"><a name="l04960"></a><span class="lineno"> 4960</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html#af9c2825ab53adf1bf8c9fa19ec89d986">BinaryOperator::isIntDivRem</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) &amp;&amp;</div>
<div class="line"><a name="l04961"></a><span class="lineno"> 4961</span>&#160;               !isa&lt;ConstantInt&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1))) {</div>
<div class="line"><a name="l04962"></a><span class="lineno"> 4962</span>&#160;      <span class="comment">// Do not try to vectorize instructions with potentially high cost.</span></div>
<div class="line"><a name="l04963"></a><span class="lineno"> 4963</span>&#160;      SubKey = <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l04964"></a><span class="lineno"> 4964</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04965"></a><span class="lineno"> 4965</span>&#160;      SubKey = <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode());</div>
<div class="line"><a name="l04966"></a><span class="lineno"> 4966</span>&#160;    }</div>
<div class="line"><a name="l04967"></a><span class="lineno"> 4967</span>&#160;    <a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a> = <a class="code" href="namespacellvm.html#add71474638430694c84640146383fc44">hash_combine</a>(<a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()), <a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>);</div>
<div class="line"><a name="l04968"></a><span class="lineno"> 4968</span>&#160;  }</div>
<div class="line"><a name="l04969"></a><span class="lineno"> 4969</span>&#160;  <span class="keywordflow">return</span> std::make_pair(<a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>, SubKey);</div>
<div class="line"><a name="l04970"></a><span class="lineno"> 4970</span>&#160;}</div>
<div class="line"><a name="l04971"></a><span class="lineno"> 4971</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l04972"></a><span class="lineno"> 4972</span>&#160;<span class="comment">/// Checks if the specified instruction \p I is an alternate operation for</span></div>
<div class="line"><a name="l04973"></a><span class="lineno"> 4973</span>&#160;<span class="comment">/// the given \p MainOp and \p AltOp instructions.</span></div>
<div class="line"><a name="l04974"></a><span class="lineno"> 4974</span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#afb636ad432c97f9178ff3f966e93d819">isAlternateInstruction</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</div>
<div class="line"><a name="l04975"></a><span class="lineno"> 4975</span>&#160;                                   <span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *MainOp,</div>
<div class="line"><a name="l04976"></a><span class="lineno"> 4976</span>&#160;                                   <span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *AltOp,</div>
<div class="line"><a name="l04977"></a><span class="lineno"> 4977</span>&#160;                                   <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> &amp;TLI);</div>
<div class="line"><a name="l04978"></a><span class="lineno"> 4978</span>&#160; </div>
<div class="line"><a name="l04979"></a><span class="lineno"> 4979</span>&#160;<span class="keywordtype">void</span> BoUpSLP::buildTree_rec(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL, <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>,</div>
<div class="line"><a name="l04980"></a><span class="lineno"> 4980</span>&#160;                            <span class="keyword">const</span> EdgeInfo &amp;UserTreeIdx) {</div>
<div class="line"><a name="l04981"></a><span class="lineno"> 4981</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a class="code" href="SLPVectorizer_8cpp.html#a7568c08b526dbf7f7b5402f3eb605b55">allConstant</a>(VL) || <a class="code" href="SLPVectorizer_8cpp.html#aabfbce373feafd33ca9e104d8b164ece">allSameType</a>(VL)) &amp;&amp; <span class="stringliteral">&quot;Invalid types!&quot;</span>);</div>
<div class="line"><a name="l04982"></a><span class="lineno"> 4982</span>&#160; </div>
<div class="line"><a name="l04983"></a><span class="lineno"> 4983</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> ReuseShuffleIndicies;</div>
<div class="line"><a name="l04984"></a><span class="lineno"> 4984</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *&gt;</a> UniqueValues;</div>
<div class="line"><a name="l04985"></a><span class="lineno"> 4985</span>&#160;  <span class="keyword">auto</span> &amp;&amp;TryToFindDuplicates = [&amp;VL, &amp;ReuseShuffleIndicies, &amp;UniqueValues,</div>
<div class="line"><a name="l04986"></a><span class="lineno"> 4986</span>&#160;                                &amp;UserTreeIdx,</div>
<div class="line"><a name="l04987"></a><span class="lineno"> 4987</span>&#160;                                <span class="keyword">this</span>](<span class="keyword">const</span> InstructionsState &amp;<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>) {</div>
<div class="line"><a name="l04988"></a><span class="lineno"> 4988</span>&#160;    <span class="comment">// Check that every instruction appears once in this bundle.</span></div>
<div class="line"><a name="l04989"></a><span class="lineno"> 4989</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, unsigned&gt;</a> UniquePositions(VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</div>
<div class="line"><a name="l04990"></a><span class="lineno"> 4990</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l04991"></a><span class="lineno"> 4991</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#a6848b7e929178610d01e1b2b5052af86">isConstant</a>(V)) {</div>
<div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160;        ReuseShuffleIndicies.emplace_back(</div>
<div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160;            isa&lt;UndefValue&gt;(V) ? <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a> : UniqueValues.size());</div>
<div class="line"><a name="l04994"></a><span class="lineno"> 4994</span>&#160;        UniqueValues.emplace_back(V);</div>
<div class="line"><a name="l04995"></a><span class="lineno"> 4995</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04996"></a><span class="lineno"> 4996</span>&#160;      }</div>
<div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160;      <span class="keyword">auto</span> Res = UniquePositions.try_emplace(V, UniqueValues.size());</div>
<div class="line"><a name="l04998"></a><span class="lineno"> 4998</span>&#160;      ReuseShuffleIndicies.emplace_back(Res.first-&gt;second);</div>
<div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;      <span class="keywordflow">if</span> (Res.second)</div>
<div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160;        UniqueValues.emplace_back(V);</div>
<div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;    }</div>
<div class="line"><a name="l05002"></a><span class="lineno"> 5002</span>&#160;    <span class="keywordtype">size_t</span> NumUniqueScalarValues = UniqueValues.size();</div>
<div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;    <span class="keywordflow">if</span> (NumUniqueScalarValues == VL.size()) {</div>
<div class="line"><a name="l05004"></a><span class="lineno"> 5004</span>&#160;      ReuseShuffleIndicies.clear();</div>
<div class="line"><a name="l05005"></a><span class="lineno"> 5005</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Shuffle for reused scalars.\n&quot;</span>);</div>
<div class="line"><a name="l05007"></a><span class="lineno"> 5007</span>&#160;      <span class="keywordflow">if</span> (NumUniqueScalarValues &lt;= 1 ||</div>
<div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160;          (UniquePositions.size() == 1 &amp;&amp; <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(UniqueValues,</div>
<div class="line"><a name="l05009"></a><span class="lineno"> 5009</span>&#160;                                                 [](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;                                                   <span class="keywordflow">return</span> isa&lt;UndefValue&gt;(V) ||</div>
<div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160;                                                          !<a class="code" href="SLPVectorizer_8cpp.html#a6848b7e929178610d01e1b2b5052af86">isConstant</a>(V);</div>
<div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160;                                                 })) ||</div>
<div class="line"><a name="l05013"></a><span class="lineno"> 5013</span>&#160;          !llvm::has_single_bit&lt;uint32_t&gt;(NumUniqueScalarValues)) {</div>
<div class="line"><a name="l05014"></a><span class="lineno"> 5014</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Scalar used twice in bundle.\n&quot;</span>);</div>
<div class="line"><a name="l05015"></a><span class="lineno"> 5015</span>&#160;        newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx);</div>
<div class="line"><a name="l05016"></a><span class="lineno"> 5016</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05017"></a><span class="lineno"> 5017</span>&#160;      }</div>
<div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160;      VL = UniqueValues;</div>
<div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160;    }</div>
<div class="line"><a name="l05020"></a><span class="lineno"> 5020</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05021"></a><span class="lineno"> 5021</span>&#160;  };</div>
<div class="line"><a name="l05022"></a><span class="lineno"> 5022</span>&#160; </div>
<div class="line"><a name="l05023"></a><span class="lineno"> 5023</span>&#160;  InstructionsState <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = <a class="code" href="SLPVectorizer_8cpp.html#ae37b3a41d982a793664ab021d9b9b325">getSameOpcode</a>(VL, *TLI);</div>
<div class="line"><a name="l05024"></a><span class="lineno"> 5024</span>&#160; </div>
<div class="line"><a name="l05025"></a><span class="lineno"> 5025</span>&#160;  <span class="comment">// Gather if we hit the RecursionMaxDepth, unless this is a load (or z/sext of</span></div>
<div class="line"><a name="l05026"></a><span class="lineno"> 5026</span>&#160;  <span class="comment">// a load), in which case peek through to include it in the tree, without</span></div>
<div class="line"><a name="l05027"></a><span class="lineno"> 5027</span>&#160;  <span class="comment">// ballooning over-budget.</span></div>
<div class="line"><a name="l05028"></a><span class="lineno"> 5028</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> &gt;= <a class="code" href="SLPVectorizer_8cpp.html#a70927cb83bb008a2a60a657d651909aa">RecursionMaxDepth</a> &amp;&amp;</div>
<div class="line"><a name="l05029"></a><span class="lineno"> 5029</span>&#160;      !(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.MainOp &amp;&amp; isa&lt;Instruction&gt;(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.MainOp) &amp;&amp; <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.MainOp == <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.AltOp &amp;&amp;</div>
<div class="line"><a name="l05030"></a><span class="lineno"> 5030</span>&#160;        VL.size() &gt;= 4 &amp;&amp;</div>
<div class="line"><a name="l05031"></a><span class="lineno"> 5031</span>&#160;        (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.MainOp, <a class="code" href="namespacellvm_1_1PatternMatch.html#a78cd22f497c1e81c4d8a5e9073ef5a24">m_Load</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>())) || <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(VL, [&amp;<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>](<span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l05032"></a><span class="lineno"> 5032</span>&#160;           <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</div>
<div class="line"><a name="l05033"></a><span class="lineno"> 5033</span>&#160;                        <a class="code" href="namespacellvm_1_1PatternMatch.html#aca6428e7fec51ba0b55594f469eb9691">m_OneUse</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a247b6987d634040b8aa6fb9c5887b703">m_ZExtOrSExt</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#aca6428e7fec51ba0b55594f469eb9691">m_OneUse</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a78cd22f497c1e81c4d8a5e9073ef5a24">m_Load</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>()))))) &amp;&amp;</div>
<div class="line"><a name="l05034"></a><span class="lineno"> 5034</span>&#160;                  cast&lt;Instruction&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getOpcode() ==</div>
<div class="line"><a name="l05035"></a><span class="lineno"> 5035</span>&#160;                      cast&lt;Instruction&gt;(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.MainOp)-&gt;getOpcode();</div>
<div class="line"><a name="l05036"></a><span class="lineno"> 5036</span>&#160;         })))) {</div>
<div class="line"><a name="l05037"></a><span class="lineno"> 5037</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Gathering due to max recursion depth.\n&quot;</span>);</div>
<div class="line"><a name="l05038"></a><span class="lineno"> 5038</span>&#160;    <span class="keywordflow">if</span> (TryToFindDuplicates(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>))</div>
<div class="line"><a name="l05039"></a><span class="lineno"> 5039</span>&#160;      newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05040"></a><span class="lineno"> 5040</span>&#160;                   ReuseShuffleIndicies);</div>
<div class="line"><a name="l05041"></a><span class="lineno"> 5041</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05042"></a><span class="lineno"> 5042</span>&#160;  }</div>
<div class="line"><a name="l05043"></a><span class="lineno"> 5043</span>&#160; </div>
<div class="line"><a name="l05044"></a><span class="lineno"> 5044</span>&#160;  <span class="comment">// Don&#39;t handle scalable vectors</span></div>
<div class="line"><a name="l05045"></a><span class="lineno"> 5045</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.getOpcode() == Instruction::ExtractElement &amp;&amp;</div>
<div class="line"><a name="l05046"></a><span class="lineno"> 5046</span>&#160;      isa&lt;ScalableVectorType&gt;(</div>
<div class="line"><a name="l05047"></a><span class="lineno"> 5047</span>&#160;          cast&lt;ExtractElementInst&gt;(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.OpValue)-&gt;getVectorOperandType())) {</div>
<div class="line"><a name="l05048"></a><span class="lineno"> 5048</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Gathering due to scalable vector type.\n&quot;</span>);</div>
<div class="line"><a name="l05049"></a><span class="lineno"> 5049</span>&#160;    <span class="keywordflow">if</span> (TryToFindDuplicates(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>))</div>
<div class="line"><a name="l05050"></a><span class="lineno"> 5050</span>&#160;      newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160;                   ReuseShuffleIndicies);</div>
<div class="line"><a name="l05052"></a><span class="lineno"> 5052</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05053"></a><span class="lineno"> 5053</span>&#160;  }</div>
<div class="line"><a name="l05054"></a><span class="lineno"> 5054</span>&#160; </div>
<div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160;  <span class="comment">// Don&#39;t handle vectors.</span></div>
<div class="line"><a name="l05056"></a><span class="lineno"> 5056</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.OpValue-&gt;getType()-&gt;isVectorTy() &amp;&amp;</div>
<div class="line"><a name="l05057"></a><span class="lineno"> 5057</span>&#160;      !isa&lt;InsertElementInst&gt;(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.OpValue)) {</div>
<div class="line"><a name="l05058"></a><span class="lineno"> 5058</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Gathering due to vector type.\n&quot;</span>);</div>
<div class="line"><a name="l05059"></a><span class="lineno"> 5059</span>&#160;    newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx);</div>
<div class="line"><a name="l05060"></a><span class="lineno"> 5060</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05061"></a><span class="lineno"> 5061</span>&#160;  }</div>
<div class="line"><a name="l05062"></a><span class="lineno"> 5062</span>&#160; </div>
<div class="line"><a name="l05063"></a><span class="lineno"> 5063</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;StoreInst&gt;(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.OpValue))</div>
<div class="line"><a name="l05064"></a><span class="lineno"> 5064</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getValueOperand()-&gt;getType()-&gt;isVectorTy()) {</div>
<div class="line"><a name="l05065"></a><span class="lineno"> 5065</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Gathering due to store vector type.\n&quot;</span>);</div>
<div class="line"><a name="l05066"></a><span class="lineno"> 5066</span>&#160;      newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx);</div>
<div class="line"><a name="l05067"></a><span class="lineno"> 5067</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05068"></a><span class="lineno"> 5068</span>&#160;    }</div>
<div class="line"><a name="l05069"></a><span class="lineno"> 5069</span>&#160; </div>
<div class="line"><a name="l05070"></a><span class="lineno"> 5070</span>&#160;  <span class="comment">// If all of the operands are identical or constant we have a simple solution.</span></div>
<div class="line"><a name="l05071"></a><span class="lineno"> 5071</span>&#160;  <span class="comment">// If we deal with insert/extract instructions, they all must have constant</span></div>
<div class="line"><a name="l05072"></a><span class="lineno"> 5072</span>&#160;  <span class="comment">// indices, otherwise we should gather them, not try to vectorize.</span></div>
<div class="line"><a name="l05073"></a><span class="lineno"> 5073</span>&#160;  <span class="comment">// If alternate op node with 2 elements with gathered operands - do not</span></div>
<div class="line"><a name="l05074"></a><span class="lineno"> 5074</span>&#160;  <span class="comment">// vectorize.</span></div>
<div class="line"><a name="l05075"></a><span class="lineno"> 5075</span>&#160;  <span class="keyword">auto</span> &amp;&amp;NotProfitableForVectorization = [&amp;<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, <span class="keyword">this</span>,</div>
<div class="line"><a name="l05076"></a><span class="lineno"> 5076</span>&#160;                                          <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>](<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL) {</div>
<div class="line"><a name="l05077"></a><span class="lineno"> 5077</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.getOpcode() || !<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.isAltShuffle() || VL.size() &gt; 2)</div>
<div class="line"><a name="l05078"></a><span class="lineno"> 5078</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05079"></a><span class="lineno"> 5079</span>&#160;    <span class="keywordflow">if</span> (VectorizableTree.size() &lt; <a class="code" href="SLPVectorizer_8cpp.html#a29dc6da1b32ad914af533bee9c23afda">MinTreeSize</a>)</div>
<div class="line"><a name="l05080"></a><span class="lineno"> 5080</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05081"></a><span class="lineno"> 5081</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> &gt;= <a class="code" href="SLPVectorizer_8cpp.html#a70927cb83bb008a2a60a657d651909aa">RecursionMaxDepth</a> - 1)</div>
<div class="line"><a name="l05082"></a><span class="lineno"> 5082</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05083"></a><span class="lineno"> 5083</span>&#160;    <span class="comment">// Check if all operands are extracts, part of vector node or can build a</span></div>
<div class="line"><a name="l05084"></a><span class="lineno"> 5084</span>&#160;    <span class="comment">// regular vectorize node.</span></div>
<div class="line"><a name="l05085"></a><span class="lineno"> 5085</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;unsigned, 2&gt;</a> InstsCount(VL.size(), 0);</div>
<div class="line"><a name="l05086"></a><span class="lineno"> 5086</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l05087"></a><span class="lineno"> 5087</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l05088"></a><span class="lineno"> 5088</span>&#160;      InstsCount.push_back(<a class="code" href="namespacellvm.html#ac214df91cdc242f4710ea5a93939c678">count_if</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operand_values(), [](<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>) {</div>
<div class="line"><a name="l05089"></a><span class="lineno"> 5089</span>&#160;        return isa&lt;Instruction&gt;(Op) || isVectorLikeInstWithConstOps(Op);</div>
<div class="line"><a name="l05090"></a><span class="lineno"> 5090</span>&#160;      }));</div>
<div class="line"><a name="l05091"></a><span class="lineno"> 5091</span>&#160;    }</div>
<div class="line"><a name="l05092"></a><span class="lineno"> 5092</span>&#160;    <span class="keywordtype">bool</span> IsCommutative = <a class="code" href="SLPVectorizer_8cpp.html#ab0da56db6da27340e5a7151a4676106a">isCommutative</a>(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.MainOp) || <a class="code" href="SLPVectorizer_8cpp.html#ab0da56db6da27340e5a7151a4676106a">isCommutative</a>(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.AltOp);</div>
<div class="line"><a name="l05093"></a><span class="lineno"> 5093</span>&#160;    <span class="keywordflow">if</span> ((IsCommutative &amp;&amp;</div>
<div class="line"><a name="l05094"></a><span class="lineno"> 5094</span>&#160;         std::accumulate(InstsCount.begin(), InstsCount.end(), 0) &lt; 2) ||</div>
<div class="line"><a name="l05095"></a><span class="lineno"> 5095</span>&#160;        (!IsCommutative &amp;&amp;</div>
<div class="line"><a name="l05096"></a><span class="lineno"> 5096</span>&#160;         <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(InstsCount, [](<span class="keywordtype">unsigned</span> ICnt) { <span class="keywordflow">return</span> ICnt &lt; 2; })))</div>
<div class="line"><a name="l05097"></a><span class="lineno"> 5097</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05098"></a><span class="lineno"> 5098</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VL.size() == 2 &amp;&amp; <span class="stringliteral">&quot;Expected only 2 alternate op instructions.&quot;</span>);</div>
<div class="line"><a name="l05099"></a><span class="lineno"> 5099</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;SmallVector&lt;std::pair&lt;Value *, Value *&gt;</a>&gt;&gt; Candidates;</div>
<div class="line"><a name="l05100"></a><span class="lineno"> 5100</span>&#160;    <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a> = cast&lt;Instruction&gt;(VL.front());</div>
<div class="line"><a name="l05101"></a><span class="lineno"> 5101</span>&#160;    <span class="keyword">auto</span> *I2 = cast&lt;Instruction&gt;(VL.back());</div>
<div class="line"><a name="l05102"></a><span class="lineno"> 5102</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.MainOp-&gt;getNumOperands(); <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>)</div>
<div class="line"><a name="l05103"></a><span class="lineno"> 5103</span>&#160;      Candidates.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>().emplace_back(<a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>-&gt;getOperand(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>),</div>
<div class="line"><a name="l05104"></a><span class="lineno"> 5104</span>&#160;                                             I2-&gt;getOperand(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>));</div>
<div class="line"><a name="l05105"></a><span class="lineno"> 5105</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span><span class="keyword">&gt;</span>(<a class="code" href="namespacellvm.html#ac214df91cdc242f4710ea5a93939c678">count_if</a>(</div>
<div class="line"><a name="l05106"></a><span class="lineno"> 5106</span>&#160;            Candidates, [<span class="keyword">this</span>](<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef</a>&lt;std::pair&lt;Value *, Value *&gt;&gt; Cand) {</div>
<div class="line"><a name="l05107"></a><span class="lineno"> 5107</span>&#160;              <span class="keywordflow">return</span> findBestRootPair(Cand, LookAheadHeuristics::ScoreSplat);</div>
<div class="line"><a name="l05108"></a><span class="lineno"> 5108</span>&#160;            })) &gt;= <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.MainOp-&gt;getNumOperands() / 2)</div>
<div class="line"><a name="l05109"></a><span class="lineno"> 5109</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05110"></a><span class="lineno"> 5110</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.MainOp-&gt;getNumOperands() &gt; 2)</div>
<div class="line"><a name="l05111"></a><span class="lineno"> 5111</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05112"></a><span class="lineno"> 5112</span>&#160;    <span class="keywordflow">if</span> (IsCommutative) {</div>
<div class="line"><a name="l05113"></a><span class="lineno"> 5113</span>&#160;      <span class="comment">// Check permuted operands.</span></div>
<div class="line"><a name="l05114"></a><span class="lineno"> 5114</span>&#160;      Candidates.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div>
<div class="line"><a name="l05115"></a><span class="lineno"> 5115</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.MainOp-&gt;getNumOperands(); <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>)</div>
<div class="line"><a name="l05116"></a><span class="lineno"> 5116</span>&#160;        Candidates.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>().emplace_back(<a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>-&gt;getOperand(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>),</div>
<div class="line"><a name="l05117"></a><span class="lineno"> 5117</span>&#160;                                               I2-&gt;getOperand((<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> + 1) % <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>));</div>
<div class="line"><a name="l05118"></a><span class="lineno"> 5118</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(</div>
<div class="line"><a name="l05119"></a><span class="lineno"> 5119</span>&#160;              Candidates, [<span class="keyword">this</span>](<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef</a>&lt;std::pair&lt;Value *, Value *&gt;&gt; Cand) {</div>
<div class="line"><a name="l05120"></a><span class="lineno"> 5120</span>&#160;                <span class="keywordflow">return</span> findBestRootPair(Cand, LookAheadHeuristics::ScoreSplat);</div>
<div class="line"><a name="l05121"></a><span class="lineno"> 5121</span>&#160;              }))</div>
<div class="line"><a name="l05122"></a><span class="lineno"> 5122</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05123"></a><span class="lineno"> 5123</span>&#160;    }</div>
<div class="line"><a name="l05124"></a><span class="lineno"> 5124</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05125"></a><span class="lineno"> 5125</span>&#160;  };</div>
<div class="line"><a name="l05126"></a><span class="lineno"> 5126</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;unsigned&gt;</a> SortedIndices;</div>
<div class="line"><a name="l05127"></a><span class="lineno"> 5127</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05128"></a><span class="lineno"> 5128</span>&#160;  <span class="keywordtype">bool</span> IsScatterVectorizeUserTE =</div>
<div class="line"><a name="l05129"></a><span class="lineno"> 5129</span>&#160;      UserTreeIdx.UserTE &amp;&amp;</div>
<div class="line"><a name="l05130"></a><span class="lineno"> 5130</span>&#160;      UserTreeIdx.UserTE-&gt;State == TreeEntry::ScatterVectorize;</div>
<div class="line"><a name="l05131"></a><span class="lineno"> 5131</span>&#160;  <span class="keywordtype">bool</span> AreAllSameInsts =</div>
<div class="line"><a name="l05132"></a><span class="lineno"> 5132</span>&#160;      (<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.getOpcode() &amp;&amp; <a class="code" href="SLPVectorizer_8cpp.html#abd5114d6b451e9ca85a36fc3f19f76c4">allSameBlock</a>(VL)) ||</div>
<div class="line"><a name="l05133"></a><span class="lineno"> 5133</span>&#160;      (<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.OpValue-&gt;getType()-&gt;isPointerTy() &amp;&amp; IsScatterVectorizeUserTE &amp;&amp;</div>
<div class="line"><a name="l05134"></a><span class="lineno"> 5134</span>&#160;       VL.size() &gt; 2 &amp;&amp;</div>
<div class="line"><a name="l05135"></a><span class="lineno"> 5135</span>&#160;       <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(VL,</div>
<div class="line"><a name="l05136"></a><span class="lineno"> 5136</span>&#160;              [&amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l05137"></a><span class="lineno"> 5137</span>&#160;                <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;GetElementPtrInst&gt;(V);</div>
<div class="line"><a name="l05138"></a><span class="lineno"> 5138</span>&#160;                <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l05139"></a><span class="lineno"> 5139</span>&#160;                  <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a05a7412bf10f2226fb69f2876b76e9cd">doesNotNeedToBeScheduled</a>(V);</div>
<div class="line"><a name="l05140"></a><span class="lineno"> 5140</span>&#160;                <span class="keywordflow">if</span> (!<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l05141"></a><span class="lineno"> 5141</span>&#160;                  <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</div>
<div class="line"><a name="l05142"></a><span class="lineno"> 5142</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() &amp;&amp; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNumOperands() == 2;</div>
<div class="line"><a name="l05143"></a><span class="lineno"> 5143</span>&#160;              }) &amp;&amp;</div>
<div class="line"><a name="l05144"></a><span class="lineno"> 5144</span>&#160;       <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> &amp;&amp;</div>
<div class="line"><a name="l05145"></a><span class="lineno"> 5145</span>&#160;       <a class="code" href="namespacellvm.html#a8d9d7c33311a38eae588e12caf8985ce">sortPtrAccesses</a>(VL, UserTreeIdx.UserTE-&gt;getMainOp()-&gt;getType(), *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, *SE,</div>
<div class="line"><a name="l05146"></a><span class="lineno"> 5146</span>&#160;                       SortedIndices));</div>
<div class="line"><a name="l05147"></a><span class="lineno"> 5147</span>&#160;  <span class="keywordflow">if</span> (!AreAllSameInsts || <a class="code" href="SLPVectorizer_8cpp.html#a7568c08b526dbf7f7b5402f3eb605b55">allConstant</a>(VL) || <a class="code" href="SLPVectorizer_8cpp.html#a6ef5b86735d738868e5fb00a18643b1c">isSplat</a>(VL) ||</div>
<div class="line"><a name="l05148"></a><span class="lineno"> 5148</span>&#160;      (isa&lt;InsertElementInst, ExtractValueInst, ExtractElementInst&gt;(</div>
<div class="line"><a name="l05149"></a><span class="lineno"> 5149</span>&#160;           <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.OpValue) &amp;&amp;</div>
<div class="line"><a name="l05150"></a><span class="lineno"> 5150</span>&#160;       !<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(VL, <a class="code" href="SLPVectorizer_8cpp.html#a06a9edb69d0ed6fda201d59948acfd89">isVectorLikeInstWithConstOps</a>)) ||</div>
<div class="line"><a name="l05151"></a><span class="lineno"> 5151</span>&#160;      NotProfitableForVectorization(VL)) {</div>
<div class="line"><a name="l05152"></a><span class="lineno"> 5152</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Gathering due to C,S,B,O, small shuffle. \n&quot;</span>);</div>
<div class="line"><a name="l05153"></a><span class="lineno"> 5153</span>&#160;    <span class="keywordflow">if</span> (TryToFindDuplicates(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>))</div>
<div class="line"><a name="l05154"></a><span class="lineno"> 5154</span>&#160;      newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05155"></a><span class="lineno"> 5155</span>&#160;                   ReuseShuffleIndicies);</div>
<div class="line"><a name="l05156"></a><span class="lineno"> 5156</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05157"></a><span class="lineno"> 5157</span>&#160;  }</div>
<div class="line"><a name="l05158"></a><span class="lineno"> 5158</span>&#160; </div>
<div class="line"><a name="l05159"></a><span class="lineno"> 5159</span>&#160;  <span class="comment">// We now know that this is a vector of instructions of the same type from</span></div>
<div class="line"><a name="l05160"></a><span class="lineno"> 5160</span>&#160;  <span class="comment">// the same block.</span></div>
<div class="line"><a name="l05161"></a><span class="lineno"> 5161</span>&#160; </div>
<div class="line"><a name="l05162"></a><span class="lineno"> 5162</span>&#160;  <span class="comment">// Don&#39;t vectorize ephemeral values.</span></div>
<div class="line"><a name="l05163"></a><span class="lineno"> 5163</span>&#160;  <span class="keywordflow">if</span> (!EphValues.<a class="code" href="classllvm_1_1SmallPtrSetImplBase.html#af8a50544090e81ac83601aff8f4b0142">empty</a>()) {</div>
<div class="line"><a name="l05164"></a><span class="lineno"> 5164</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l05165"></a><span class="lineno"> 5165</span>&#160;      <span class="keywordflow">if</span> (EphValues.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(V)) {</div>
<div class="line"><a name="l05166"></a><span class="lineno"> 5166</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: The instruction (&quot;</span> &lt;&lt; *V</div>
<div class="line"><a name="l05167"></a><span class="lineno"> 5167</span>&#160;                          &lt;&lt; <span class="stringliteral">&quot;) is ephemeral.\n&quot;</span>);</div>
<div class="line"><a name="l05168"></a><span class="lineno"> 5168</span>&#160;        newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx);</div>
<div class="line"><a name="l05169"></a><span class="lineno"> 5169</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05170"></a><span class="lineno"> 5170</span>&#160;      }</div>
<div class="line"><a name="l05171"></a><span class="lineno"> 5171</span>&#160;    }</div>
<div class="line"><a name="l05172"></a><span class="lineno"> 5172</span>&#160;  }</div>
<div class="line"><a name="l05173"></a><span class="lineno"> 5173</span>&#160; </div>
<div class="line"><a name="l05174"></a><span class="lineno"> 5174</span>&#160;  <span class="comment">// Check if this is a duplicate of another entry.</span></div>
<div class="line"><a name="l05175"></a><span class="lineno"> 5175</span>&#160;  <span class="keywordflow">if</span> (TreeEntry *<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = getTreeEntry(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.OpValue)) {</div>
<div class="line"><a name="l05176"></a><span class="lineno"> 5176</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: \tChecking bundle: &quot;</span> &lt;&lt; *<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.OpValue &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l05177"></a><span class="lineno"> 5177</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;isSame(VL)) {</div>
<div class="line"><a name="l05178"></a><span class="lineno"> 5178</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Gathering due to partial overlap.\n&quot;</span>);</div>
<div class="line"><a name="l05179"></a><span class="lineno"> 5179</span>&#160;      <span class="keywordflow">if</span> (TryToFindDuplicates(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>))</div>
<div class="line"><a name="l05180"></a><span class="lineno"> 5180</span>&#160;        newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05181"></a><span class="lineno"> 5181</span>&#160;                     ReuseShuffleIndicies);</div>
<div class="line"><a name="l05182"></a><span class="lineno"> 5182</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05183"></a><span class="lineno"> 5183</span>&#160;    }</div>
<div class="line"><a name="l05184"></a><span class="lineno"> 5184</span>&#160;    <span class="comment">// Record the reuse of the tree node.  FIXME, currently this is only used to</span></div>
<div class="line"><a name="l05185"></a><span class="lineno"> 5185</span>&#160;    <span class="comment">// properly draw the graph rather than for the actual vectorization.</span></div>
<div class="line"><a name="l05186"></a><span class="lineno"> 5186</span>&#160;    <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;UserTreeIndices.push_back(UserTreeIdx);</div>
<div class="line"><a name="l05187"></a><span class="lineno"> 5187</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Perfect diamond merge at &quot;</span> &lt;&lt; *<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.OpValue</div>
<div class="line"><a name="l05188"></a><span class="lineno"> 5188</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l05189"></a><span class="lineno"> 5189</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05190"></a><span class="lineno"> 5190</span>&#160;  }</div>
<div class="line"><a name="l05191"></a><span class="lineno"> 5191</span>&#160; </div>
<div class="line"><a name="l05192"></a><span class="lineno"> 5192</span>&#160;  <span class="comment">// Check that none of the instructions in the bundle are already in the tree.</span></div>
<div class="line"><a name="l05193"></a><span class="lineno"> 5193</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l05194"></a><span class="lineno"> 5194</span>&#160;    <span class="keywordflow">if</span> (!IsScatterVectorizeUserTE &amp;&amp; !isa&lt;Instruction&gt;(V))</div>
<div class="line"><a name="l05195"></a><span class="lineno"> 5195</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05196"></a><span class="lineno"> 5196</span>&#160;    <span class="keywordflow">if</span> (getTreeEntry(V)) {</div>
<div class="line"><a name="l05197"></a><span class="lineno"> 5197</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: The instruction (&quot;</span> &lt;&lt; *V</div>
<div class="line"><a name="l05198"></a><span class="lineno"> 5198</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;) is already in tree.\n&quot;</span>);</div>
<div class="line"><a name="l05199"></a><span class="lineno"> 5199</span>&#160;      <span class="keywordflow">if</span> (TryToFindDuplicates(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>))</div>
<div class="line"><a name="l05200"></a><span class="lineno"> 5200</span>&#160;        newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05201"></a><span class="lineno"> 5201</span>&#160;                     ReuseShuffleIndicies);</div>
<div class="line"><a name="l05202"></a><span class="lineno"> 5202</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05203"></a><span class="lineno"> 5203</span>&#160;    }</div>
<div class="line"><a name="l05204"></a><span class="lineno"> 5204</span>&#160;  }</div>
<div class="line"><a name="l05205"></a><span class="lineno"> 5205</span>&#160; </div>
<div class="line"><a name="l05206"></a><span class="lineno"> 5206</span>&#160;  <span class="comment">// The reduction nodes (stored in UserIgnoreList) also should stay scalar.</span></div>
<div class="line"><a name="l05207"></a><span class="lineno"> 5207</span>&#160;  <span class="keywordflow">if</span> (UserIgnoreList &amp;&amp; !UserIgnoreList-&gt;empty()) {</div>
<div class="line"><a name="l05208"></a><span class="lineno"> 5208</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l05209"></a><span class="lineno"> 5209</span>&#160;      <span class="keywordflow">if</span> (UserIgnoreList &amp;&amp; UserIgnoreList-&gt;contains(V)) {</div>
<div class="line"><a name="l05210"></a><span class="lineno"> 5210</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Gathering due to gathered scalar.\n&quot;</span>);</div>
<div class="line"><a name="l05211"></a><span class="lineno"> 5211</span>&#160;        <span class="keywordflow">if</span> (TryToFindDuplicates(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>))</div>
<div class="line"><a name="l05212"></a><span class="lineno"> 5212</span>&#160;          newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05213"></a><span class="lineno"> 5213</span>&#160;                       ReuseShuffleIndicies);</div>
<div class="line"><a name="l05214"></a><span class="lineno"> 5214</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05215"></a><span class="lineno"> 5215</span>&#160;      }</div>
<div class="line"><a name="l05216"></a><span class="lineno"> 5216</span>&#160;    }</div>
<div class="line"><a name="l05217"></a><span class="lineno"> 5217</span>&#160;  }</div>
<div class="line"><a name="l05218"></a><span class="lineno"> 5218</span>&#160; </div>
<div class="line"><a name="l05219"></a><span class="lineno"> 5219</span>&#160;  <span class="comment">// Special processing for sorted pointers for ScatterVectorize node with</span></div>
<div class="line"><a name="l05220"></a><span class="lineno"> 5220</span>&#160;  <span class="comment">// constant indeces only.</span></div>
<div class="line"><a name="l05221"></a><span class="lineno"> 5221</span>&#160;  <span class="keywordflow">if</span> (AreAllSameInsts &amp;&amp; UserTreeIdx.UserTE &amp;&amp;</div>
<div class="line"><a name="l05222"></a><span class="lineno"> 5222</span>&#160;      UserTreeIdx.UserTE-&gt;State == TreeEntry::ScatterVectorize &amp;&amp;</div>
<div class="line"><a name="l05223"></a><span class="lineno"> 5223</span>&#160;      !(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.getOpcode() &amp;&amp; <a class="code" href="SLPVectorizer_8cpp.html#abd5114d6b451e9ca85a36fc3f19f76c4">allSameBlock</a>(VL))) {</div>
<div class="line"><a name="l05224"></a><span class="lineno"> 5224</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.OpValue-&gt;getType()-&gt;isPointerTy() &amp;&amp;</div>
<div class="line"><a name="l05225"></a><span class="lineno"> 5225</span>&#160;           <a class="code" href="namespacellvm.html#ac214df91cdc242f4710ea5a93939c678">count_if</a>(VL, [](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) { <span class="keywordflow">return</span> isa&lt;GetElementPtrInst&gt;(V); }) &gt;=</div>
<div class="line"><a name="l05226"></a><span class="lineno"> 5226</span>&#160;               2 &amp;&amp;</div>
<div class="line"><a name="l05227"></a><span class="lineno"> 5227</span>&#160;           <span class="stringliteral">&quot;Expected pointers only.&quot;</span>);</div>
<div class="line"><a name="l05228"></a><span class="lineno"> 5228</span>&#160;    <span class="comment">// Reset S to make it GetElementPtr kind of node.</span></div>
<div class="line"><a name="l05229"></a><span class="lineno"> 5229</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> *It = <a class="code" href="namespacellvm.html#ac78c09ae232b2ce188ff590d51e3c268">find_if</a>(VL, [](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) { <span class="keywordflow">return</span> isa&lt;GetElementPtrInst&gt;(V); });</div>
<div class="line"><a name="l05230"></a><span class="lineno"> 5230</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(It != VL.end() &amp;&amp; <span class="stringliteral">&quot;Expected at least one GEP.&quot;</span>);</div>
<div class="line"><a name="l05231"></a><span class="lineno"> 5231</span>&#160;    <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = <a class="code" href="SLPVectorizer_8cpp.html#ae37b3a41d982a793664ab021d9b9b325">getSameOpcode</a>(*It, *TLI);</div>
<div class="line"><a name="l05232"></a><span class="lineno"> 5232</span>&#160;  }</div>
<div class="line"><a name="l05233"></a><span class="lineno"> 5233</span>&#160; </div>
<div class="line"><a name="l05234"></a><span class="lineno"> 5234</span>&#160;  <span class="comment">// Check that all of the users of the scalars that we want to vectorize are</span></div>
<div class="line"><a name="l05235"></a><span class="lineno"> 5235</span>&#160;  <span class="comment">// schedulable.</span></div>
<div class="line"><a name="l05236"></a><span class="lineno"> 5236</span>&#160;  <span class="keyword">auto</span> *VL0 = cast&lt;Instruction&gt;(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.OpValue);</div>
<div class="line"><a name="l05237"></a><span class="lineno"> 5237</span>&#160;  <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = VL0-&gt;getParent();</div>
<div class="line"><a name="l05238"></a><span class="lineno"> 5238</span>&#160; </div>
<div class="line"><a name="l05239"></a><span class="lineno"> 5239</span>&#160;  <span class="keywordflow">if</span> (!DT-&gt;isReachableFromEntry(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)) {</div>
<div class="line"><a name="l05240"></a><span class="lineno"> 5240</span>&#160;    <span class="comment">// Don&#39;t go into unreachable blocks. They may contain instructions with</span></div>
<div class="line"><a name="l05241"></a><span class="lineno"> 5241</span>&#160;    <span class="comment">// dependency cycles which confuse the final scheduling.</span></div>
<div class="line"><a name="l05242"></a><span class="lineno"> 5242</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: bundle in unreachable block.\n&quot;</span>);</div>
<div class="line"><a name="l05243"></a><span class="lineno"> 5243</span>&#160;    newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx);</div>
<div class="line"><a name="l05244"></a><span class="lineno"> 5244</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05245"></a><span class="lineno"> 5245</span>&#160;  }</div>
<div class="line"><a name="l05246"></a><span class="lineno"> 5246</span>&#160; </div>
<div class="line"><a name="l05247"></a><span class="lineno"> 5247</span>&#160;  <span class="comment">// Don&#39;t go into catchswitch blocks, which can happen with PHIs.</span></div>
<div class="line"><a name="l05248"></a><span class="lineno"> 5248</span>&#160;  <span class="comment">// Such blocks can only have PHIs and the catchswitch.  There is no</span></div>
<div class="line"><a name="l05249"></a><span class="lineno"> 5249</span>&#160;  <span class="comment">// place to insert a shuffle if we need to, so just avoid that issue.</span></div>
<div class="line"><a name="l05250"></a><span class="lineno"> 5250</span>&#160;  <span class="keywordflow">if</span> (isa&lt;CatchSwitchInst&gt;(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getTerminator())) {</div>
<div class="line"><a name="l05251"></a><span class="lineno"> 5251</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: bundle in catchswitch block.\n&quot;</span>);</div>
<div class="line"><a name="l05252"></a><span class="lineno"> 5252</span>&#160;    newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx);</div>
<div class="line"><a name="l05253"></a><span class="lineno"> 5253</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05254"></a><span class="lineno"> 5254</span>&#160;  }</div>
<div class="line"><a name="l05255"></a><span class="lineno"> 5255</span>&#160; </div>
<div class="line"><a name="l05256"></a><span class="lineno"> 5256</span>&#160;  <span class="comment">// Check that every instruction appears once in this bundle.</span></div>
<div class="line"><a name="l05257"></a><span class="lineno"> 5257</span>&#160;  <span class="keywordflow">if</span> (!TryToFindDuplicates(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>))</div>
<div class="line"><a name="l05258"></a><span class="lineno"> 5258</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05259"></a><span class="lineno"> 5259</span>&#160; </div>
<div class="line"><a name="l05260"></a><span class="lineno"> 5260</span>&#160;  <span class="keyword">auto</span> &amp;BSRef = BlocksSchedules[<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>];</div>
<div class="line"><a name="l05261"></a><span class="lineno"> 5261</span>&#160;  <span class="keywordflow">if</span> (!BSRef)</div>
<div class="line"><a name="l05262"></a><span class="lineno"> 5262</span>&#160;    BSRef = std::make_unique&lt;BlockScheduling&gt;(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l05263"></a><span class="lineno"> 5263</span>&#160; </div>
<div class="line"><a name="l05264"></a><span class="lineno"> 5264</span>&#160;  BlockScheduling &amp;BS = *BSRef;</div>
<div class="line"><a name="l05265"></a><span class="lineno"> 5265</span>&#160; </div>
<div class="line"><a name="l05266"></a><span class="lineno"> 5266</span>&#160;  std::optional&lt;ScheduleData *&gt; Bundle = BS.tryScheduleBundle(VL, <span class="keyword">this</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>);</div>
<div class="line"><a name="l05267"></a><span class="lineno"> 5267</span>&#160;<span class="preprocessor">#ifdef EXPENSIVE_CHECKS</span></div>
<div class="line"><a name="l05268"></a><span class="lineno"> 5268</span>&#160;  <span class="comment">// Make sure we didn&#39;t break any internal invariants</span></div>
<div class="line"><a name="l05269"></a><span class="lineno"> 5269</span>&#160;  BS.verify();</div>
<div class="line"><a name="l05270"></a><span class="lineno"> 5270</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05271"></a><span class="lineno"> 5271</span>&#160;  <span class="keywordflow">if</span> (!Bundle) {</div>
<div class="line"><a name="l05272"></a><span class="lineno"> 5272</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: We are not able to schedule this bundle!\n&quot;</span>);</div>
<div class="line"><a name="l05273"></a><span class="lineno"> 5273</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!BS.getScheduleData(VL0) ||</div>
<div class="line"><a name="l05274"></a><span class="lineno"> 5274</span>&#160;            !BS.getScheduleData(VL0)-&gt;isPartOfBundle()) &amp;&amp;</div>
<div class="line"><a name="l05275"></a><span class="lineno"> 5275</span>&#160;           <span class="stringliteral">&quot;tryScheduleBundle should cancelScheduling on failure&quot;</span>);</div>
<div class="line"><a name="l05276"></a><span class="lineno"> 5276</span>&#160;    newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05277"></a><span class="lineno"> 5277</span>&#160;                 ReuseShuffleIndicies);</div>
<div class="line"><a name="l05278"></a><span class="lineno"> 5278</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05279"></a><span class="lineno"> 5279</span>&#160;  }</div>
<div class="line"><a name="l05280"></a><span class="lineno"> 5280</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: We are able to schedule this bundle.\n&quot;</span>);</div>
<div class="line"><a name="l05281"></a><span class="lineno"> 5281</span>&#160; </div>
<div class="line"><a name="l05282"></a><span class="lineno"> 5282</span>&#160;  <span class="keywordtype">unsigned</span> ShuffleOrOp = <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.isAltShuffle() ?</div>
<div class="line"><a name="l05283"></a><span class="lineno"> 5283</span>&#160;                (<a class="code" href="ADT_2tmp_8txt.html#aa10ee7493bddf2c751ca6e05451ef410">unsigned</a>) Instruction::ShuffleVector : <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.getOpcode();</div>
<div class="line"><a name="l05284"></a><span class="lineno"> 5284</span>&#160;  <span class="keywordflow">switch</span> (ShuffleOrOp) {</div>
<div class="line"><a name="l05285"></a><span class="lineno"> 5285</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">Instruction::PHI</a>: {</div>
<div class="line"><a name="l05286"></a><span class="lineno"> 5286</span>&#160;      <span class="keyword">auto</span> *PH = cast&lt;PHINode&gt;(VL0);</div>
<div class="line"><a name="l05287"></a><span class="lineno"> 5287</span>&#160; </div>
<div class="line"><a name="l05288"></a><span class="lineno"> 5288</span>&#160;      <span class="comment">// Check for terminator values (e.g. invoke).</span></div>
<div class="line"><a name="l05289"></a><span class="lineno"> 5289</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL)</div>
<div class="line"><a name="l05290"></a><span class="lineno"> 5290</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *Incoming : cast&lt;PHINode&gt;(V)-&gt;incoming_values()) {</div>
<div class="line"><a name="l05291"></a><span class="lineno"> 5291</span>&#160;          <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="namespacellvm_1_1M68kBeads.html#a7eeab1fe8f39bf89dcd7929b816ebfcca27d0e059322508a76f918503800ef1bd">Term</a> = dyn_cast&lt;Instruction&gt;(Incoming);</div>
<div class="line"><a name="l05292"></a><span class="lineno"> 5292</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1M68kBeads.html#a7eeab1fe8f39bf89dcd7929b816ebfcca27d0e059322508a76f918503800ef1bd">Term</a> &amp;&amp; <a class="code" href="namespacellvm_1_1M68kBeads.html#a7eeab1fe8f39bf89dcd7929b816ebfcca27d0e059322508a76f918503800ef1bd">Term</a>-&gt;isTerminator()) {</div>
<div class="line"><a name="l05293"></a><span class="lineno"> 5293</span>&#160;            <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</div>
<div class="line"><a name="l05294"></a><span class="lineno"> 5294</span>&#160;                       &lt;&lt; <span class="stringliteral">&quot;SLP: Need to swizzle PHINodes (terminator use).\n&quot;</span>);</div>
<div class="line"><a name="l05295"></a><span class="lineno"> 5295</span>&#160;            BS.cancelScheduling(VL, VL0);</div>
<div class="line"><a name="l05296"></a><span class="lineno"> 5296</span>&#160;            newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05297"></a><span class="lineno"> 5297</span>&#160;                         ReuseShuffleIndicies);</div>
<div class="line"><a name="l05298"></a><span class="lineno"> 5298</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05299"></a><span class="lineno"> 5299</span>&#160;          }</div>
<div class="line"><a name="l05300"></a><span class="lineno"> 5300</span>&#160;        }</div>
<div class="line"><a name="l05301"></a><span class="lineno"> 5301</span>&#160; </div>
<div class="line"><a name="l05302"></a><span class="lineno"> 5302</span>&#160;      TreeEntry *<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a> =</div>
<div class="line"><a name="l05303"></a><span class="lineno"> 5303</span>&#160;          newTreeEntry(VL, Bundle, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx, ReuseShuffleIndicies);</div>
<div class="line"><a name="l05304"></a><span class="lineno"> 5304</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: added a vector of PHINodes.\n&quot;</span>);</div>
<div class="line"><a name="l05305"></a><span class="lineno"> 5305</span>&#160; </div>
<div class="line"><a name="l05306"></a><span class="lineno"> 5306</span>&#160;      <span class="comment">// Keeps the reordered operands to avoid code duplication.</span></div>
<div class="line"><a name="l05307"></a><span class="lineno"> 5307</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;ValueList, 2&gt;</a> OperandsVec;</div>
<div class="line"><a name="l05308"></a><span class="lineno"> 5308</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = PH-&gt;getNumIncomingValues(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l05309"></a><span class="lineno"> 5309</span>&#160;        <span class="keywordflow">if</span> (!DT-&gt;isReachableFromEntry(PH-&gt;getIncomingBlock(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))) {</div>
<div class="line"><a name="l05310"></a><span class="lineno"> 5310</span>&#160;          ValueList <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>(VL.size(), <a class="code" href="classllvm_1_1PoisonValue.html#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(PH-&gt;getType()));</div>
<div class="line"><a name="l05311"></a><span class="lineno"> 5311</span>&#160;          <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;setOperand(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>);</div>
<div class="line"><a name="l05312"></a><span class="lineno"> 5312</span>&#160;          OperandsVec.push_back(<a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>);</div>
<div class="line"><a name="l05313"></a><span class="lineno"> 5313</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05314"></a><span class="lineno"> 5314</span>&#160;        }</div>
<div class="line"><a name="l05315"></a><span class="lineno"> 5315</span>&#160;        ValueList <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>;</div>
<div class="line"><a name="l05316"></a><span class="lineno"> 5316</span>&#160;        <span class="comment">// Prepare the operand vector.</span></div>
<div class="line"><a name="l05317"></a><span class="lineno"> 5317</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL)</div>
<div class="line"><a name="l05318"></a><span class="lineno"> 5318</span>&#160;          <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.push_back(cast&lt;PHINode&gt;(V)-&gt;getIncomingValueForBlock(</div>
<div class="line"><a name="l05319"></a><span class="lineno"> 5319</span>&#160;              PH-&gt;getIncomingBlock(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)));</div>
<div class="line"><a name="l05320"></a><span class="lineno"> 5320</span>&#160;        <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;setOperand(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>);</div>
<div class="line"><a name="l05321"></a><span class="lineno"> 5321</span>&#160;        OperandsVec.push_back(<a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>);</div>
<div class="line"><a name="l05322"></a><span class="lineno"> 5322</span>&#160;      }</div>
<div class="line"><a name="l05323"></a><span class="lineno"> 5323</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> OpIdx = 0, OpE = OperandsVec.size(); OpIdx != OpE; ++OpIdx)</div>
<div class="line"><a name="l05324"></a><span class="lineno"> 5324</span>&#160;        buildTree_rec(OperandsVec[OpIdx], <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1, {<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>, OpIdx});</div>
<div class="line"><a name="l05325"></a><span class="lineno"> 5325</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05326"></a><span class="lineno"> 5326</span>&#160;    }</div>
<div class="line"><a name="l05327"></a><span class="lineno"> 5327</span>&#160;    <span class="keywordflow">case</span> Instruction::ExtractValue:</div>
<div class="line"><a name="l05328"></a><span class="lineno"> 5328</span>&#160;    <span class="keywordflow">case</span> Instruction::ExtractElement: {</div>
<div class="line"><a name="l05329"></a><span class="lineno"> 5329</span>&#160;      OrdersType CurrentOrder;</div>
<div class="line"><a name="l05330"></a><span class="lineno"> 5330</span>&#160;      <span class="keywordtype">bool</span> Reuse = canReuseExtract(VL, VL0, CurrentOrder);</div>
<div class="line"><a name="l05331"></a><span class="lineno"> 5331</span>&#160;      <span class="keywordflow">if</span> (Reuse) {</div>
<div class="line"><a name="l05332"></a><span class="lineno"> 5332</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Reusing or shuffling extract sequence.\n&quot;</span>);</div>
<div class="line"><a name="l05333"></a><span class="lineno"> 5333</span>&#160;        newTreeEntry(VL, Bundle <span class="comment">/*vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05334"></a><span class="lineno"> 5334</span>&#160;                     ReuseShuffleIndicies);</div>
<div class="line"><a name="l05335"></a><span class="lineno"> 5335</span>&#160;        <span class="comment">// This is a special case, as it does not gather, but at the same time</span></div>
<div class="line"><a name="l05336"></a><span class="lineno"> 5336</span>&#160;        <span class="comment">// we are not extending buildTree_rec() towards the operands.</span></div>
<div class="line"><a name="l05337"></a><span class="lineno"> 5337</span>&#160;        ValueList Op0;</div>
<div class="line"><a name="l05338"></a><span class="lineno"> 5338</span>&#160;        Op0.assign(VL.size(), VL0-&gt;getOperand(0));</div>
<div class="line"><a name="l05339"></a><span class="lineno"> 5339</span>&#160;        VectorizableTree.back()-&gt;setOperand(0, Op0);</div>
<div class="line"><a name="l05340"></a><span class="lineno"> 5340</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05341"></a><span class="lineno"> 5341</span>&#160;      }</div>
<div class="line"><a name="l05342"></a><span class="lineno"> 5342</span>&#160;      <span class="keywordflow">if</span> (!CurrentOrder.empty()) {</div>
<div class="line"><a name="l05343"></a><span class="lineno"> 5343</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>({</div>
<div class="line"><a name="l05344"></a><span class="lineno"> 5344</span>&#160;          <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Reusing or shuffling of reordered extract sequence &quot;</span></div>
<div class="line"><a name="l05345"></a><span class="lineno"> 5345</span>&#160;                    <span class="stringliteral">&quot;with order&quot;</span>;</div>
<div class="line"><a name="l05346"></a><span class="lineno"> 5346</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Idx : CurrentOrder)</div>
<div class="line"><a name="l05347"></a><span class="lineno"> 5347</span>&#160;            <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; Idx;</div>
<div class="line"><a name="l05348"></a><span class="lineno"> 5348</span>&#160;          <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l05349"></a><span class="lineno"> 5349</span>&#160;        });</div>
<div class="line"><a name="l05350"></a><span class="lineno"> 5350</span>&#160;        <a class="code" href="SLPVectorizer_8cpp.html#acd356293c4520fc1fb4a83de901e5bb7">fixupOrderingIndices</a>(CurrentOrder);</div>
<div class="line"><a name="l05351"></a><span class="lineno"> 5351</span>&#160;        <span class="comment">// Insert new order with initial value 0, if it does not exist,</span></div>
<div class="line"><a name="l05352"></a><span class="lineno"> 5352</span>&#160;        <span class="comment">// otherwise return the iterator to the existing one.</span></div>
<div class="line"><a name="l05353"></a><span class="lineno"> 5353</span>&#160;        newTreeEntry(VL, Bundle <span class="comment">/*vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05354"></a><span class="lineno"> 5354</span>&#160;                     ReuseShuffleIndicies, CurrentOrder);</div>
<div class="line"><a name="l05355"></a><span class="lineno"> 5355</span>&#160;        <span class="comment">// This is a special case, as it does not gather, but at the same time</span></div>
<div class="line"><a name="l05356"></a><span class="lineno"> 5356</span>&#160;        <span class="comment">// we are not extending buildTree_rec() towards the operands.</span></div>
<div class="line"><a name="l05357"></a><span class="lineno"> 5357</span>&#160;        ValueList Op0;</div>
<div class="line"><a name="l05358"></a><span class="lineno"> 5358</span>&#160;        Op0.assign(VL.size(), VL0-&gt;getOperand(0));</div>
<div class="line"><a name="l05359"></a><span class="lineno"> 5359</span>&#160;        VectorizableTree.back()-&gt;setOperand(0, Op0);</div>
<div class="line"><a name="l05360"></a><span class="lineno"> 5360</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05361"></a><span class="lineno"> 5361</span>&#160;      }</div>
<div class="line"><a name="l05362"></a><span class="lineno"> 5362</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Gather extract sequence.\n&quot;</span>);</div>
<div class="line"><a name="l05363"></a><span class="lineno"> 5363</span>&#160;      newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05364"></a><span class="lineno"> 5364</span>&#160;                   ReuseShuffleIndicies);</div>
<div class="line"><a name="l05365"></a><span class="lineno"> 5365</span>&#160;      BS.cancelScheduling(VL, VL0);</div>
<div class="line"><a name="l05366"></a><span class="lineno"> 5366</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05367"></a><span class="lineno"> 5367</span>&#160;    }</div>
<div class="line"><a name="l05368"></a><span class="lineno"> 5368</span>&#160;    <span class="keywordflow">case</span> Instruction::InsertElement: {</div>
<div class="line"><a name="l05369"></a><span class="lineno"> 5369</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ReuseShuffleIndicies.empty() &amp;&amp; <span class="stringliteral">&quot;All inserts should be unique&quot;</span>);</div>
<div class="line"><a name="l05370"></a><span class="lineno"> 5370</span>&#160; </div>
<div class="line"><a name="l05371"></a><span class="lineno"> 5371</span>&#160;      <span class="comment">// Check that we have a buildvector and not a shuffle of 2 or more</span></div>
<div class="line"><a name="l05372"></a><span class="lineno"> 5372</span>&#160;      <span class="comment">// different vectors.</span></div>
<div class="line"><a name="l05373"></a><span class="lineno"> 5373</span>&#160;      ValueSet SourceVectors;</div>
<div class="line"><a name="l05374"></a><span class="lineno"> 5374</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l05375"></a><span class="lineno"> 5375</span>&#160;        SourceVectors.insert(cast&lt;Instruction&gt;(V)-&gt;getOperand(0));</div>
<div class="line"><a name="l05376"></a><span class="lineno"> 5376</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(V) != std::nullopt &amp;&amp;</div>
<div class="line"><a name="l05377"></a><span class="lineno"> 5377</span>&#160;               <span class="stringliteral">&quot;Non-constant or undef index?&quot;</span>);</div>
<div class="line"><a name="l05378"></a><span class="lineno"> 5378</span>&#160;      }</div>
<div class="line"><a name="l05379"></a><span class="lineno"> 5379</span>&#160; </div>
<div class="line"><a name="l05380"></a><span class="lineno"> 5380</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ac214df91cdc242f4710ea5a93939c678">count_if</a>(VL, [&amp;SourceVectors](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l05381"></a><span class="lineno"> 5381</span>&#160;            <span class="keywordflow">return</span> !SourceVectors.contains(V);</div>
<div class="line"><a name="l05382"></a><span class="lineno"> 5382</span>&#160;          }) &gt;= 2) {</div>
<div class="line"><a name="l05383"></a><span class="lineno"> 5383</span>&#160;        <span class="comment">// Found 2nd source vector - cancel.</span></div>
<div class="line"><a name="l05384"></a><span class="lineno"> 5384</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Gather of insertelement vectors with &quot;</span></div>
<div class="line"><a name="l05385"></a><span class="lineno"> 5385</span>&#160;                             <span class="stringliteral">&quot;different source vectors.\n&quot;</span>);</div>
<div class="line"><a name="l05386"></a><span class="lineno"> 5386</span>&#160;        newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx);</div>
<div class="line"><a name="l05387"></a><span class="lineno"> 5387</span>&#160;        BS.cancelScheduling(VL, VL0);</div>
<div class="line"><a name="l05388"></a><span class="lineno"> 5388</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05389"></a><span class="lineno"> 5389</span>&#160;      }</div>
<div class="line"><a name="l05390"></a><span class="lineno"> 5390</span>&#160; </div>
<div class="line"><a name="l05391"></a><span class="lineno"> 5391</span>&#160;      <span class="keyword">auto</span> OrdCompare = [](<span class="keyword">const</span> std::pair&lt;int, int&gt; &amp;P1,</div>
<div class="line"><a name="l05392"></a><span class="lineno"> 5392</span>&#160;                           <span class="keyword">const</span> std::pair&lt;int, int&gt; &amp;<a class="code" href="README-SSE_8txt.html#ae7fc2fb0e2d536219c1193f1a178e7db">P2</a>) {</div>
<div class="line"><a name="l05393"></a><span class="lineno"> 5393</span>&#160;        <span class="keywordflow">return</span> P1.first &gt; <a class="code" href="README-SSE_8txt.html#ae7fc2fb0e2d536219c1193f1a178e7db">P2</a>.first;</div>
<div class="line"><a name="l05394"></a><span class="lineno"> 5394</span>&#160;      };</div>
<div class="line"><a name="l05395"></a><span class="lineno"> 5395</span>&#160;      <a class="code" href="classllvm_1_1PriorityQueue.html">PriorityQueue&lt;std::pair&lt;int, int&gt;</a>, <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;int, int&gt;</a>&gt;,</div>
<div class="line"><a name="l05396"></a><span class="lineno"> 5396</span>&#160;                    decltype(OrdCompare)&gt;</div>
<div class="line"><a name="l05397"></a><span class="lineno"> 5397</span>&#160;          Indices(OrdCompare);</div>
<div class="line"><a name="l05398"></a><span class="lineno"> 5398</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = VL.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l05399"></a><span class="lineno"> 5399</span>&#160;        <span class="keywordtype">unsigned</span> Idx = *<a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(VL[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]);</div>
<div class="line"><a name="l05400"></a><span class="lineno"> 5400</span>&#160;        Indices.emplace(Idx, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l05401"></a><span class="lineno"> 5401</span>&#160;      }</div>
<div class="line"><a name="l05402"></a><span class="lineno"> 5402</span>&#160;      OrdersType CurrentOrder(VL.size(), VL.size());</div>
<div class="line"><a name="l05403"></a><span class="lineno"> 5403</span>&#160;      <span class="keywordtype">bool</span> IsIdentity = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05404"></a><span class="lineno"> 5404</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = VL.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l05405"></a><span class="lineno"> 5405</span>&#160;        CurrentOrder[Indices.top().second] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l05406"></a><span class="lineno"> 5406</span>&#160;        IsIdentity &amp;= Indices.top().second == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l05407"></a><span class="lineno"> 5407</span>&#160;        Indices.pop();</div>
<div class="line"><a name="l05408"></a><span class="lineno"> 5408</span>&#160;      }</div>
<div class="line"><a name="l05409"></a><span class="lineno"> 5409</span>&#160;      <span class="keywordflow">if</span> (IsIdentity)</div>
<div class="line"><a name="l05410"></a><span class="lineno"> 5410</span>&#160;        CurrentOrder.clear();</div>
<div class="line"><a name="l05411"></a><span class="lineno"> 5411</span>&#160;      TreeEntry *<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a> = newTreeEntry(VL, Bundle <span class="comment">/*vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05412"></a><span class="lineno"> 5412</span>&#160;                                   std::nullopt, CurrentOrder);</div>
<div class="line"><a name="l05413"></a><span class="lineno"> 5413</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: added inserts bundle.\n&quot;</span>);</div>
<div class="line"><a name="l05414"></a><span class="lineno"> 5414</span>&#160; </div>
<div class="line"><a name="l05415"></a><span class="lineno"> 5415</span>&#160;      constexpr <span class="keywordtype">int</span> NumOps = 2;</div>
<div class="line"><a name="l05416"></a><span class="lineno"> 5416</span>&#160;      ValueList VectorOperands[NumOps];</div>
<div class="line"><a name="l05417"></a><span class="lineno"> 5417</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumOps; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l05418"></a><span class="lineno"> 5418</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL)</div>
<div class="line"><a name="l05419"></a><span class="lineno"> 5419</span>&#160;          VectorOperands[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].push_back(cast&lt;Instruction&gt;(V)-&gt;getOperand(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</div>
<div class="line"><a name="l05420"></a><span class="lineno"> 5420</span>&#160; </div>
<div class="line"><a name="l05421"></a><span class="lineno"> 5421</span>&#160;        <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;setOperand(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VectorOperands[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]);</div>
<div class="line"><a name="l05422"></a><span class="lineno"> 5422</span>&#160;      }</div>
<div class="line"><a name="l05423"></a><span class="lineno"> 5423</span>&#160;      buildTree_rec(VectorOperands[NumOps - 1], <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1, {<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>, NumOps - 1});</div>
<div class="line"><a name="l05424"></a><span class="lineno"> 5424</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05425"></a><span class="lineno"> 5425</span>&#160;    }</div>
<div class="line"><a name="l05426"></a><span class="lineno"> 5426</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Instruction::Load</a>: {</div>
<div class="line"><a name="l05427"></a><span class="lineno"> 5427</span>&#160;      <span class="comment">// Check that a vectorized load would load the same memory as a scalar</span></div>
<div class="line"><a name="l05428"></a><span class="lineno"> 5428</span>&#160;      <span class="comment">// load. For example, we don&#39;t want to vectorize loads that are smaller</span></div>
<div class="line"><a name="l05429"></a><span class="lineno"> 5429</span>&#160;      <span class="comment">// than 8-bit. Even though we have a packed struct {&lt;i2, i2, i2, i2&gt;} LLVM</span></div>
<div class="line"><a name="l05430"></a><span class="lineno"> 5430</span>&#160;      <span class="comment">// treats loading/storing it as an i8 struct. If we vectorize loads/stores</span></div>
<div class="line"><a name="l05431"></a><span class="lineno"> 5431</span>&#160;      <span class="comment">// from such a struct, we read/write packed bits disagreeing with the</span></div>
<div class="line"><a name="l05432"></a><span class="lineno"> 5432</span>&#160;      <span class="comment">// unvectorized version.</span></div>
<div class="line"><a name="l05433"></a><span class="lineno"> 5433</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *&gt;</a> PointerOps;</div>
<div class="line"><a name="l05434"></a><span class="lineno"> 5434</span>&#160;      OrdersType CurrentOrder;</div>
<div class="line"><a name="l05435"></a><span class="lineno"> 5435</span>&#160;      TreeEntry *<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05436"></a><span class="lineno"> 5436</span>&#160;      <span class="keywordflow">switch</span> (<a class="code" href="SLPVectorizer_8cpp.html#a06f9ac1f9413750e1782f666f635a4ed">canVectorizeLoads</a>(VL, VL0, *<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, *SE, *LI, *TLI,</div>
<div class="line"><a name="l05437"></a><span class="lineno"> 5437</span>&#160;                                CurrentOrder, PointerOps)) {</div>
<div class="line"><a name="l05438"></a><span class="lineno"> 5438</span>&#160;      <span class="keywordflow">case</span> LoadsState::Vectorize:</div>
<div class="line"><a name="l05439"></a><span class="lineno"> 5439</span>&#160;        <span class="keywordflow">if</span> (CurrentOrder.empty()) {</div>
<div class="line"><a name="l05440"></a><span class="lineno"> 5440</span>&#160;          <span class="comment">// Original loads are consecutive and does not require reordering.</span></div>
<div class="line"><a name="l05441"></a><span class="lineno"> 5441</span>&#160;          <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a> = newTreeEntry(VL, Bundle <span class="comment">/*vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05442"></a><span class="lineno"> 5442</span>&#160;                            ReuseShuffleIndicies);</div>
<div class="line"><a name="l05443"></a><span class="lineno"> 5443</span>&#160;          <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: added a vector of loads.\n&quot;</span>);</div>
<div class="line"><a name="l05444"></a><span class="lineno"> 5444</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05445"></a><span class="lineno"> 5445</span>&#160;          <a class="code" href="SLPVectorizer_8cpp.html#acd356293c4520fc1fb4a83de901e5bb7">fixupOrderingIndices</a>(CurrentOrder);</div>
<div class="line"><a name="l05446"></a><span class="lineno"> 5446</span>&#160;          <span class="comment">// Need to reorder.</span></div>
<div class="line"><a name="l05447"></a><span class="lineno"> 5447</span>&#160;          <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a> = newTreeEntry(VL, Bundle <span class="comment">/*vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05448"></a><span class="lineno"> 5448</span>&#160;                            ReuseShuffleIndicies, CurrentOrder);</div>
<div class="line"><a name="l05449"></a><span class="lineno"> 5449</span>&#160;          <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: added a vector of jumbled loads.\n&quot;</span>);</div>
<div class="line"><a name="l05450"></a><span class="lineno"> 5450</span>&#160;        }</div>
<div class="line"><a name="l05451"></a><span class="lineno"> 5451</span>&#160;        <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;setOperandsInOrder();</div>
<div class="line"><a name="l05452"></a><span class="lineno"> 5452</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l05453"></a><span class="lineno"> 5453</span>&#160;      <span class="keywordflow">case</span> LoadsState::ScatterVectorize:</div>
<div class="line"><a name="l05454"></a><span class="lineno"> 5454</span>&#160;        <span class="comment">// Vectorizing non-consecutive loads with `llvm.masked.gather`.</span></div>
<div class="line"><a name="l05455"></a><span class="lineno"> 5455</span>&#160;        <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a> = newTreeEntry(VL, TreeEntry::ScatterVectorize, Bundle, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>,</div>
<div class="line"><a name="l05456"></a><span class="lineno"> 5456</span>&#160;                          UserTreeIdx, ReuseShuffleIndicies);</div>
<div class="line"><a name="l05457"></a><span class="lineno"> 5457</span>&#160;        <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;setOperandsInOrder();</div>
<div class="line"><a name="l05458"></a><span class="lineno"> 5458</span>&#160;        buildTree_rec(PointerOps, <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1, {<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>, 0});</div>
<div class="line"><a name="l05459"></a><span class="lineno"> 5459</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: added a vector of non-consecutive loads.\n&quot;</span>);</div>
<div class="line"><a name="l05460"></a><span class="lineno"> 5460</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l05461"></a><span class="lineno"> 5461</span>&#160;      <span class="keywordflow">case</span> LoadsState::Gather:</div>
<div class="line"><a name="l05462"></a><span class="lineno"> 5462</span>&#160;        BS.cancelScheduling(VL, VL0);</div>
<div class="line"><a name="l05463"></a><span class="lineno"> 5463</span>&#160;        newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05464"></a><span class="lineno"> 5464</span>&#160;                     ReuseShuffleIndicies);</div>
<div class="line"><a name="l05465"></a><span class="lineno"> 5465</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l05466"></a><span class="lineno"> 5466</span>&#160;        <a class="code" href="classllvm_1_1Type.html">Type</a> *ScalarTy = VL0-&gt;getType();</div>
<div class="line"><a name="l05467"></a><span class="lineno"> 5467</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getTypeSizeInBits(ScalarTy) !=</div>
<div class="line"><a name="l05468"></a><span class="lineno"> 5468</span>&#160;            <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getTypeAllocSizeInBits(ScalarTy))</div>
<div class="line"><a name="l05469"></a><span class="lineno"> 5469</span>&#160;          <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Gathering loads of non-packed type.\n&quot;</span>);</div>
<div class="line"><a name="l05470"></a><span class="lineno"> 5470</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(VL, [](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l05471"></a><span class="lineno"> 5471</span>&#160;                   <span class="keywordflow">return</span> !cast&lt;LoadInst&gt;(V)-&gt;isSimple();</div>
<div class="line"><a name="l05472"></a><span class="lineno"> 5472</span>&#160;                 }))</div>
<div class="line"><a name="l05473"></a><span class="lineno"> 5473</span>&#160;          <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Gathering non-simple loads.\n&quot;</span>);</div>
<div class="line"><a name="l05474"></a><span class="lineno"> 5474</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l05475"></a><span class="lineno"> 5475</span>&#160;          <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Gathering non-consecutive loads.\n&quot;</span>);</div>
<div class="line"><a name="l05476"></a><span class="lineno"> 5476</span>&#160;<span class="preprocessor">#endif // NDEBUG</span></div>
<div class="line"><a name="l05477"></a><span class="lineno"> 5477</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l05478"></a><span class="lineno"> 5478</span>&#160;      }</div>
<div class="line"><a name="l05479"></a><span class="lineno"> 5479</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05480"></a><span class="lineno"> 5480</span>&#160;    }</div>
<div class="line"><a name="l05481"></a><span class="lineno"> 5481</span>&#160;    <span class="keywordflow">case</span> Instruction::ZExt:</div>
<div class="line"><a name="l05482"></a><span class="lineno"> 5482</span>&#160;    <span class="keywordflow">case</span> Instruction::SExt:</div>
<div class="line"><a name="l05483"></a><span class="lineno"> 5483</span>&#160;    <span class="keywordflow">case</span> Instruction::FPToUI:</div>
<div class="line"><a name="l05484"></a><span class="lineno"> 5484</span>&#160;    <span class="keywordflow">case</span> Instruction::FPToSI:</div>
<div class="line"><a name="l05485"></a><span class="lineno"> 5485</span>&#160;    <span class="keywordflow">case</span> Instruction::FPExt:</div>
<div class="line"><a name="l05486"></a><span class="lineno"> 5486</span>&#160;    <span class="keywordflow">case</span> Instruction::PtrToInt:</div>
<div class="line"><a name="l05487"></a><span class="lineno"> 5487</span>&#160;    <span class="keywordflow">case</span> Instruction::IntToPtr:</div>
<div class="line"><a name="l05488"></a><span class="lineno"> 5488</span>&#160;    <span class="keywordflow">case</span> Instruction::SIToFP:</div>
<div class="line"><a name="l05489"></a><span class="lineno"> 5489</span>&#160;    <span class="keywordflow">case</span> Instruction::UIToFP:</div>
<div class="line"><a name="l05490"></a><span class="lineno"> 5490</span>&#160;    <span class="keywordflow">case</span> Instruction::Trunc:</div>
<div class="line"><a name="l05491"></a><span class="lineno"> 5491</span>&#160;    <span class="keywordflow">case</span> Instruction::FPTrunc:</div>
<div class="line"><a name="l05492"></a><span class="lineno"> 5492</span>&#160;    <span class="keywordflow">case</span> Instruction::BitCast: {</div>
<div class="line"><a name="l05493"></a><span class="lineno"> 5493</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *SrcTy = VL0-&gt;getOperand(0)-&gt;getType();</div>
<div class="line"><a name="l05494"></a><span class="lineno"> 5494</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l05495"></a><span class="lineno"> 5495</span>&#160;        <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty = cast&lt;Instruction&gt;(V)-&gt;getOperand(0)-&gt;getType();</div>
<div class="line"><a name="l05496"></a><span class="lineno"> 5496</span>&#160;        <span class="keywordflow">if</span> (Ty != SrcTy || !<a class="code" href="SLPVectorizer_8cpp.html#aa3ea54a95743867473d32853d3c65603">isValidElementType</a>(Ty)) {</div>
<div class="line"><a name="l05497"></a><span class="lineno"> 5497</span>&#160;          BS.cancelScheduling(VL, VL0);</div>
<div class="line"><a name="l05498"></a><span class="lineno"> 5498</span>&#160;          newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05499"></a><span class="lineno"> 5499</span>&#160;                       ReuseShuffleIndicies);</div>
<div class="line"><a name="l05500"></a><span class="lineno"> 5500</span>&#160;          <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</div>
<div class="line"><a name="l05501"></a><span class="lineno"> 5501</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot;SLP: Gathering casts with different src types.\n&quot;</span>);</div>
<div class="line"><a name="l05502"></a><span class="lineno"> 5502</span>&#160;          <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05503"></a><span class="lineno"> 5503</span>&#160;        }</div>
<div class="line"><a name="l05504"></a><span class="lineno"> 5504</span>&#160;      }</div>
<div class="line"><a name="l05505"></a><span class="lineno"> 5505</span>&#160;      TreeEntry *<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a> = newTreeEntry(VL, Bundle <span class="comment">/*vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05506"></a><span class="lineno"> 5506</span>&#160;                                   ReuseShuffleIndicies);</div>
<div class="line"><a name="l05507"></a><span class="lineno"> 5507</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: added a vector of casts.\n&quot;</span>);</div>
<div class="line"><a name="l05508"></a><span class="lineno"> 5508</span>&#160; </div>
<div class="line"><a name="l05509"></a><span class="lineno"> 5509</span>&#160;      <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;setOperandsInOrder();</div>
<div class="line"><a name="l05510"></a><span class="lineno"> 5510</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = VL0-&gt;getNumOperands(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l05511"></a><span class="lineno"> 5511</span>&#160;        ValueList <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>;</div>
<div class="line"><a name="l05512"></a><span class="lineno"> 5512</span>&#160;        <span class="comment">// Prepare the operand vector.</span></div>
<div class="line"><a name="l05513"></a><span class="lineno"> 5513</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL)</div>
<div class="line"><a name="l05514"></a><span class="lineno"> 5514</span>&#160;          <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.push_back(cast&lt;Instruction&gt;(V)-&gt;getOperand(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div>
<div class="line"><a name="l05515"></a><span class="lineno"> 5515</span>&#160; </div>
<div class="line"><a name="l05516"></a><span class="lineno"> 5516</span>&#160;        buildTree_rec(<a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1, {<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>, <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>});</div>
<div class="line"><a name="l05517"></a><span class="lineno"> 5517</span>&#160;      }</div>
<div class="line"><a name="l05518"></a><span class="lineno"> 5518</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05519"></a><span class="lineno"> 5519</span>&#160;    }</div>
<div class="line"><a name="l05520"></a><span class="lineno"> 5520</span>&#160;    <span class="keywordflow">case</span> Instruction::ICmp:</div>
<div class="line"><a name="l05521"></a><span class="lineno"> 5521</span>&#160;    <span class="keywordflow">case</span> Instruction::FCmp: {</div>
<div class="line"><a name="l05522"></a><span class="lineno"> 5522</span>&#160;      <span class="comment">// Check that all of the compares have the same predicate.</span></div>
<div class="line"><a name="l05523"></a><span class="lineno"> 5523</span>&#160;      <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> P0 = cast&lt;CmpInst&gt;(VL0)-&gt;getPredicate();</div>
<div class="line"><a name="l05524"></a><span class="lineno"> 5524</span>&#160;      <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> SwapP0 = <a class="code" href="classllvm_1_1CmpInst.html#a49a2d8f483ea08a3d6ea75f90c640d76">CmpInst::getSwappedPredicate</a>(P0);</div>
<div class="line"><a name="l05525"></a><span class="lineno"> 5525</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *ComparedTy = VL0-&gt;getOperand(0)-&gt;getType();</div>
<div class="line"><a name="l05526"></a><span class="lineno"> 5526</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l05527"></a><span class="lineno"> 5527</span>&#160;        <a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a> *<a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a> = cast&lt;CmpInst&gt;(V);</div>
<div class="line"><a name="l05528"></a><span class="lineno"> 5528</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getPredicate() != P0 &amp;&amp; <a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getPredicate() != SwapP0) ||</div>
<div class="line"><a name="l05529"></a><span class="lineno"> 5529</span>&#160;            <a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getOperand(0)-&gt;getType() != ComparedTy) {</div>
<div class="line"><a name="l05530"></a><span class="lineno"> 5530</span>&#160;          BS.cancelScheduling(VL, VL0);</div>
<div class="line"><a name="l05531"></a><span class="lineno"> 5531</span>&#160;          newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05532"></a><span class="lineno"> 5532</span>&#160;                       ReuseShuffleIndicies);</div>
<div class="line"><a name="l05533"></a><span class="lineno"> 5533</span>&#160;          <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</div>
<div class="line"><a name="l05534"></a><span class="lineno"> 5534</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot;SLP: Gathering cmp with different predicate.\n&quot;</span>);</div>
<div class="line"><a name="l05535"></a><span class="lineno"> 5535</span>&#160;          <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05536"></a><span class="lineno"> 5536</span>&#160;        }</div>
<div class="line"><a name="l05537"></a><span class="lineno"> 5537</span>&#160;      }</div>
<div class="line"><a name="l05538"></a><span class="lineno"> 5538</span>&#160; </div>
<div class="line"><a name="l05539"></a><span class="lineno"> 5539</span>&#160;      TreeEntry *<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a> = newTreeEntry(VL, Bundle <span class="comment">/*vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05540"></a><span class="lineno"> 5540</span>&#160;                                   ReuseShuffleIndicies);</div>
<div class="line"><a name="l05541"></a><span class="lineno"> 5541</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: added a vector of compares.\n&quot;</span>);</div>
<div class="line"><a name="l05542"></a><span class="lineno"> 5542</span>&#160; </div>
<div class="line"><a name="l05543"></a><span class="lineno"> 5543</span>&#160;      ValueList <a class="code" href="namespacellvm.html#a2554a96c67bdd7d0a62855a844ec55b0a945d5e233cf7d6240f6b783b36a374ff">Left</a>, <a class="code" href="README__P9_8txt.html#acc80d72f12f6f9e1d8eda2ec3d74133c">Right</a>;</div>
<div class="line"><a name="l05544"></a><span class="lineno"> 5544</span>&#160;      <span class="keywordflow">if</span> (cast&lt;CmpInst&gt;(VL0)-&gt;<a class="code" href="SLPVectorizer_8cpp.html#ab0da56db6da27340e5a7151a4676106a">isCommutative</a>()) {</div>
<div class="line"><a name="l05545"></a><span class="lineno"> 5545</span>&#160;        <span class="comment">// Commutative predicate - collect + sort operands of the instructions</span></div>
<div class="line"><a name="l05546"></a><span class="lineno"> 5546</span>&#160;        <span class="comment">// so that each side is more likely to have the same opcode.</span></div>
<div class="line"><a name="l05547"></a><span class="lineno"> 5547</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(P0 == SwapP0 &amp;&amp; <span class="stringliteral">&quot;Commutative Predicate mismatch&quot;</span>);</div>
<div class="line"><a name="l05548"></a><span class="lineno"> 5548</span>&#160;        reorderInputsAccordingToOpcode(VL, Left, Right, *TLI, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, *SE, *<span class="keyword">this</span>);</div>
<div class="line"><a name="l05549"></a><span class="lineno"> 5549</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05550"></a><span class="lineno"> 5550</span>&#160;        <span class="comment">// Collect operands - commute if it uses the swapped predicate.</span></div>
<div class="line"><a name="l05551"></a><span class="lineno"> 5551</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l05552"></a><span class="lineno"> 5552</span>&#160;          <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a> = cast&lt;CmpInst&gt;(V);</div>
<div class="line"><a name="l05553"></a><span class="lineno"> 5553</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = <a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getOperand(0);</div>
<div class="line"><a name="l05554"></a><span class="lineno"> 5554</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = <a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getOperand(1);</div>
<div class="line"><a name="l05555"></a><span class="lineno"> 5555</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getPredicate() != P0)</div>
<div class="line"><a name="l05556"></a><span class="lineno"> 5556</span>&#160;            <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</div>
<div class="line"><a name="l05557"></a><span class="lineno"> 5557</span>&#160;          <a class="code" href="namespacellvm.html#a2554a96c67bdd7d0a62855a844ec55b0a945d5e233cf7d6240f6b783b36a374ff">Left</a>.push_back(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>);</div>
<div class="line"><a name="l05558"></a><span class="lineno"> 5558</span>&#160;          <a class="code" href="README__P9_8txt.html#acc80d72f12f6f9e1d8eda2ec3d74133c">Right</a>.push_back(<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</div>
<div class="line"><a name="l05559"></a><span class="lineno"> 5559</span>&#160;        }</div>
<div class="line"><a name="l05560"></a><span class="lineno"> 5560</span>&#160;      }</div>
<div class="line"><a name="l05561"></a><span class="lineno"> 5561</span>&#160;      <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;setOperand(0, Left);</div>
<div class="line"><a name="l05562"></a><span class="lineno"> 5562</span>&#160;      <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;setOperand(1, Right);</div>
<div class="line"><a name="l05563"></a><span class="lineno"> 5563</span>&#160;      buildTree_rec(Left, <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1, {<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>, 0});</div>
<div class="line"><a name="l05564"></a><span class="lineno"> 5564</span>&#160;      buildTree_rec(Right, <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1, {<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>, 1});</div>
<div class="line"><a name="l05565"></a><span class="lineno"> 5565</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05566"></a><span class="lineno"> 5566</span>&#160;    }</div>
<div class="line"><a name="l05567"></a><span class="lineno"> 5567</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Instruction::Select</a>:</div>
<div class="line"><a name="l05568"></a><span class="lineno"> 5568</span>&#160;    <span class="keywordflow">case</span> Instruction::FNeg:</div>
<div class="line"><a name="l05569"></a><span class="lineno"> 5569</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec">Instruction::Add</a>:</div>
<div class="line"><a name="l05570"></a><span class="lineno"> 5570</span>&#160;    <span class="keywordflow">case</span> Instruction::FAdd:</div>
<div class="line"><a name="l05571"></a><span class="lineno"> 5571</span>&#160;    <span class="keywordflow">case</span> Instruction::Sub:</div>
<div class="line"><a name="l05572"></a><span class="lineno"> 5572</span>&#160;    <span class="keywordflow">case</span> Instruction::FSub:</div>
<div class="line"><a name="l05573"></a><span class="lineno"> 5573</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="X86PartialReduction_8cpp.html#ae0f503db91504a3f3440ab81260e4134">Instruction::Mul</a>:</div>
<div class="line"><a name="l05574"></a><span class="lineno"> 5574</span>&#160;    <span class="keywordflow">case</span> Instruction::FMul:</div>
<div class="line"><a name="l05575"></a><span class="lineno"> 5575</span>&#160;    <span class="keywordflow">case</span> Instruction::UDiv:</div>
<div class="line"><a name="l05576"></a><span class="lineno"> 5576</span>&#160;    <span class="keywordflow">case</span> Instruction::SDiv:</div>
<div class="line"><a name="l05577"></a><span class="lineno"> 5577</span>&#160;    <span class="keywordflow">case</span> Instruction::FDiv:</div>
<div class="line"><a name="l05578"></a><span class="lineno"> 5578</span>&#160;    <span class="keywordflow">case</span> Instruction::URem:</div>
<div class="line"><a name="l05579"></a><span class="lineno"> 5579</span>&#160;    <span class="keywordflow">case</span> Instruction::SRem:</div>
<div class="line"><a name="l05580"></a><span class="lineno"> 5580</span>&#160;    <span class="keywordflow">case</span> Instruction::FRem:</div>
<div class="line"><a name="l05581"></a><span class="lineno"> 5581</span>&#160;    <span class="keywordflow">case</span> Instruction::Shl:</div>
<div class="line"><a name="l05582"></a><span class="lineno"> 5582</span>&#160;    <span class="keywordflow">case</span> Instruction::LShr:</div>
<div class="line"><a name="l05583"></a><span class="lineno"> 5583</span>&#160;    <span class="keywordflow">case</span> Instruction::AShr:</div>
<div class="line"><a name="l05584"></a><span class="lineno"> 5584</span>&#160;    <span class="keywordflow">case</span> Instruction::And:</div>
<div class="line"><a name="l05585"></a><span class="lineno"> 5585</span>&#160;    <span class="keywordflow">case</span> Instruction::Or:</div>
<div class="line"><a name="l05586"></a><span class="lineno"> 5586</span>&#160;    <span class="keywordflow">case</span> Instruction::Xor: {</div>
<div class="line"><a name="l05587"></a><span class="lineno"> 5587</span>&#160;      TreeEntry *<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a> = newTreeEntry(VL, Bundle <span class="comment">/*vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05588"></a><span class="lineno"> 5588</span>&#160;                                   ReuseShuffleIndicies);</div>
<div class="line"><a name="l05589"></a><span class="lineno"> 5589</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: added a vector of un/bin op.\n&quot;</span>);</div>
<div class="line"><a name="l05590"></a><span class="lineno"> 5590</span>&#160; </div>
<div class="line"><a name="l05591"></a><span class="lineno"> 5591</span>&#160;      <span class="comment">// Sort operands of the instructions so that each side is more likely to</span></div>
<div class="line"><a name="l05592"></a><span class="lineno"> 5592</span>&#160;      <span class="comment">// have the same opcode.</span></div>
<div class="line"><a name="l05593"></a><span class="lineno"> 5593</span>&#160;      <span class="keywordflow">if</span> (isa&lt;BinaryOperator&gt;(VL0) &amp;&amp; VL0-&gt;isCommutative()) {</div>
<div class="line"><a name="l05594"></a><span class="lineno"> 5594</span>&#160;        ValueList <a class="code" href="namespacellvm.html#a2554a96c67bdd7d0a62855a844ec55b0a945d5e233cf7d6240f6b783b36a374ff">Left</a>, <a class="code" href="README__P9_8txt.html#acc80d72f12f6f9e1d8eda2ec3d74133c">Right</a>;</div>
<div class="line"><a name="l05595"></a><span class="lineno"> 5595</span>&#160;        reorderInputsAccordingToOpcode(VL, Left, Right, *TLI, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, *SE, *<span class="keyword">this</span>);</div>
<div class="line"><a name="l05596"></a><span class="lineno"> 5596</span>&#160;        <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;setOperand(0, Left);</div>
<div class="line"><a name="l05597"></a><span class="lineno"> 5597</span>&#160;        <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;setOperand(1, Right);</div>
<div class="line"><a name="l05598"></a><span class="lineno"> 5598</span>&#160;        buildTree_rec(Left, <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1, {<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>, 0});</div>
<div class="line"><a name="l05599"></a><span class="lineno"> 5599</span>&#160;        buildTree_rec(Right, <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1, {<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>, 1});</div>
<div class="line"><a name="l05600"></a><span class="lineno"> 5600</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05601"></a><span class="lineno"> 5601</span>&#160;      }</div>
<div class="line"><a name="l05602"></a><span class="lineno"> 5602</span>&#160; </div>
<div class="line"><a name="l05603"></a><span class="lineno"> 5603</span>&#160;      <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;setOperandsInOrder();</div>
<div class="line"><a name="l05604"></a><span class="lineno"> 5604</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = VL0-&gt;getNumOperands(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l05605"></a><span class="lineno"> 5605</span>&#160;        ValueList <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>;</div>
<div class="line"><a name="l05606"></a><span class="lineno"> 5606</span>&#160;        <span class="comment">// Prepare the operand vector.</span></div>
<div class="line"><a name="l05607"></a><span class="lineno"> 5607</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL)</div>
<div class="line"><a name="l05608"></a><span class="lineno"> 5608</span>&#160;          <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.push_back(cast&lt;Instruction&gt;(V)-&gt;getOperand(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div>
<div class="line"><a name="l05609"></a><span class="lineno"> 5609</span>&#160; </div>
<div class="line"><a name="l05610"></a><span class="lineno"> 5610</span>&#160;        buildTree_rec(<a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1, {<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>, <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>});</div>
<div class="line"><a name="l05611"></a><span class="lineno"> 5611</span>&#160;      }</div>
<div class="line"><a name="l05612"></a><span class="lineno"> 5612</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05613"></a><span class="lineno"> 5613</span>&#160;    }</div>
<div class="line"><a name="l05614"></a><span class="lineno"> 5614</span>&#160;    <span class="keywordflow">case</span> Instruction::GetElementPtr: {</div>
<div class="line"><a name="l05615"></a><span class="lineno"> 5615</span>&#160;      <span class="comment">// We don&#39;t combine GEPs with complicated (nested) indexing.</span></div>
<div class="line"><a name="l05616"></a><span class="lineno"> 5616</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l05617"></a><span class="lineno"> 5617</span>&#160;        <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;GetElementPtrInst&gt;(V);</div>
<div class="line"><a name="l05618"></a><span class="lineno"> 5618</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l05619"></a><span class="lineno"> 5619</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05620"></a><span class="lineno"> 5620</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNumOperands() != 2) {</div>
<div class="line"><a name="l05621"></a><span class="lineno"> 5621</span>&#160;          <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: not-vectorizable GEP (nested indexes).\n&quot;</span>);</div>
<div class="line"><a name="l05622"></a><span class="lineno"> 5622</span>&#160;          BS.cancelScheduling(VL, VL0);</div>
<div class="line"><a name="l05623"></a><span class="lineno"> 5623</span>&#160;          newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05624"></a><span class="lineno"> 5624</span>&#160;                       ReuseShuffleIndicies);</div>
<div class="line"><a name="l05625"></a><span class="lineno"> 5625</span>&#160;          <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05626"></a><span class="lineno"> 5626</span>&#160;        }</div>
<div class="line"><a name="l05627"></a><span class="lineno"> 5627</span>&#160;      }</div>
<div class="line"><a name="l05628"></a><span class="lineno"> 5628</span>&#160; </div>
<div class="line"><a name="l05629"></a><span class="lineno"> 5629</span>&#160;      <span class="comment">// We can&#39;t combine several GEPs into one vector if they operate on</span></div>
<div class="line"><a name="l05630"></a><span class="lineno"> 5630</span>&#160;      <span class="comment">// different types.</span></div>
<div class="line"><a name="l05631"></a><span class="lineno"> 5631</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty0 = cast&lt;GEPOperator&gt;(VL0)-&gt;getSourceElementType();</div>
<div class="line"><a name="l05632"></a><span class="lineno"> 5632</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l05633"></a><span class="lineno"> 5633</span>&#160;        <span class="keyword">auto</span> *<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = dyn_cast&lt;GEPOperator&gt;(V);</div>
<div class="line"><a name="l05634"></a><span class="lineno"> 5634</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>)</div>
<div class="line"><a name="l05635"></a><span class="lineno"> 5635</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05636"></a><span class="lineno"> 5636</span>&#160;        <a class="code" href="classllvm_1_1Type.html">Type</a> *CurTy = <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getSourceElementType();</div>
<div class="line"><a name="l05637"></a><span class="lineno"> 5637</span>&#160;        <span class="keywordflow">if</span> (Ty0 != CurTy) {</div>
<div class="line"><a name="l05638"></a><span class="lineno"> 5638</span>&#160;          <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</div>
<div class="line"><a name="l05639"></a><span class="lineno"> 5639</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot;SLP: not-vectorizable GEP (different types).\n&quot;</span>);</div>
<div class="line"><a name="l05640"></a><span class="lineno"> 5640</span>&#160;          BS.cancelScheduling(VL, VL0);</div>
<div class="line"><a name="l05641"></a><span class="lineno"> 5641</span>&#160;          newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05642"></a><span class="lineno"> 5642</span>&#160;                       ReuseShuffleIndicies);</div>
<div class="line"><a name="l05643"></a><span class="lineno"> 5643</span>&#160;          <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05644"></a><span class="lineno"> 5644</span>&#160;        }</div>
<div class="line"><a name="l05645"></a><span class="lineno"> 5645</span>&#160;      }</div>
<div class="line"><a name="l05646"></a><span class="lineno"> 5646</span>&#160; </div>
<div class="line"><a name="l05647"></a><span class="lineno"> 5647</span>&#160;      <span class="comment">// We don&#39;t combine GEPs with non-constant indexes.</span></div>
<div class="line"><a name="l05648"></a><span class="lineno"> 5648</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty1 = VL0-&gt;getOperand(1)-&gt;getType();</div>
<div class="line"><a name="l05649"></a><span class="lineno"> 5649</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l05650"></a><span class="lineno"> 5650</span>&#160;        <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;GetElementPtrInst&gt;(V);</div>
<div class="line"><a name="l05651"></a><span class="lineno"> 5651</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l05652"></a><span class="lineno"> 5652</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05653"></a><span class="lineno"> 5653</span>&#160;        <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1);</div>
<div class="line"><a name="l05654"></a><span class="lineno"> 5654</span>&#160;        <span class="keywordflow">if</span> ((!IsScatterVectorizeUserTE &amp;&amp; !isa&lt;ConstantInt&gt;(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>)) ||</div>
<div class="line"><a name="l05655"></a><span class="lineno"> 5655</span>&#160;            (<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>-&gt;getType() != Ty1 &amp;&amp;</div>
<div class="line"><a name="l05656"></a><span class="lineno"> 5656</span>&#160;             ((IsScatterVectorizeUserTE &amp;&amp; !isa&lt;ConstantInt&gt;(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>)) ||</div>
<div class="line"><a name="l05657"></a><span class="lineno"> 5657</span>&#160;              <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>-&gt;getType()-&gt;getScalarSizeInBits() &gt;</div>
<div class="line"><a name="l05658"></a><span class="lineno"> 5658</span>&#160;                  <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getIndexSizeInBits(</div>
<div class="line"><a name="l05659"></a><span class="lineno"> 5659</span>&#160;                      V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>())))) {</div>
<div class="line"><a name="l05660"></a><span class="lineno"> 5660</span>&#160;          <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</div>
<div class="line"><a name="l05661"></a><span class="lineno"> 5661</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot;SLP: not-vectorizable GEP (non-constant indexes).\n&quot;</span>);</div>
<div class="line"><a name="l05662"></a><span class="lineno"> 5662</span>&#160;          BS.cancelScheduling(VL, VL0);</div>
<div class="line"><a name="l05663"></a><span class="lineno"> 5663</span>&#160;          newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05664"></a><span class="lineno"> 5664</span>&#160;                       ReuseShuffleIndicies);</div>
<div class="line"><a name="l05665"></a><span class="lineno"> 5665</span>&#160;          <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05666"></a><span class="lineno"> 5666</span>&#160;        }</div>
<div class="line"><a name="l05667"></a><span class="lineno"> 5667</span>&#160;      }</div>
<div class="line"><a name="l05668"></a><span class="lineno"> 5668</span>&#160; </div>
<div class="line"><a name="l05669"></a><span class="lineno"> 5669</span>&#160;      TreeEntry *<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a> = newTreeEntry(VL, Bundle <span class="comment">/*vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05670"></a><span class="lineno"> 5670</span>&#160;                                   ReuseShuffleIndicies);</div>
<div class="line"><a name="l05671"></a><span class="lineno"> 5671</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: added a vector of GEPs.\n&quot;</span>);</div>
<div class="line"><a name="l05672"></a><span class="lineno"> 5672</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;ValueList, 2&gt;</a> <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>(2);</div>
<div class="line"><a name="l05673"></a><span class="lineno"> 5673</span>&#160;      <span class="comment">// Prepare the operand vector for pointer operands.</span></div>
<div class="line"><a name="l05674"></a><span class="lineno"> 5674</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l05675"></a><span class="lineno"> 5675</span>&#160;        <span class="keyword">auto</span> *<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = dyn_cast&lt;GetElementPtrInst&gt;(V);</div>
<div class="line"><a name="l05676"></a><span class="lineno"> 5676</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>) {</div>
<div class="line"><a name="l05677"></a><span class="lineno"> 5677</span>&#160;          <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.front().push_back(V);</div>
<div class="line"><a name="l05678"></a><span class="lineno"> 5678</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05679"></a><span class="lineno"> 5679</span>&#160;        }</div>
<div class="line"><a name="l05680"></a><span class="lineno"> 5680</span>&#160;        <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.front().push_back(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getPointerOperand());</div>
<div class="line"><a name="l05681"></a><span class="lineno"> 5681</span>&#160;      }</div>
<div class="line"><a name="l05682"></a><span class="lineno"> 5682</span>&#160;      <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;setOperand(0, <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.front());</div>
<div class="line"><a name="l05683"></a><span class="lineno"> 5683</span>&#160;      <span class="comment">// Need to cast all indices to the same type before vectorization to</span></div>
<div class="line"><a name="l05684"></a><span class="lineno"> 5684</span>&#160;      <span class="comment">// avoid crash.</span></div>
<div class="line"><a name="l05685"></a><span class="lineno"> 5685</span>&#160;      <span class="comment">// Required to be able to find correct matches between different gather</span></div>
<div class="line"><a name="l05686"></a><span class="lineno"> 5686</span>&#160;      <span class="comment">// nodes and reuse the vectorized values rather than trying to gather them</span></div>
<div class="line"><a name="l05687"></a><span class="lineno"> 5687</span>&#160;      <span class="comment">// again.</span></div>
<div class="line"><a name="l05688"></a><span class="lineno"> 5688</span>&#160;      <span class="keywordtype">int</span> IndexIdx = 1;</div>
<div class="line"><a name="l05689"></a><span class="lineno"> 5689</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *VL0Ty = VL0-&gt;getOperand(IndexIdx)-&gt;getType();</div>
<div class="line"><a name="l05690"></a><span class="lineno"> 5690</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty = <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(VL,</div>
<div class="line"><a name="l05691"></a><span class="lineno"> 5691</span>&#160;                        [VL0Ty, IndexIdx](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l05692"></a><span class="lineno"> 5692</span>&#160;                          <span class="keyword">auto</span> *<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = dyn_cast&lt;GetElementPtrInst&gt;(V);</div>
<div class="line"><a name="l05693"></a><span class="lineno"> 5693</span>&#160;                          <span class="keywordflow">if</span> (!<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>)</div>
<div class="line"><a name="l05694"></a><span class="lineno"> 5694</span>&#160;                            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05695"></a><span class="lineno"> 5695</span>&#160;                          <span class="keywordflow">return</span> VL0Ty == <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getOperand(IndexIdx)-&gt;getType();</div>
<div class="line"><a name="l05696"></a><span class="lineno"> 5696</span>&#160;                        })</div>
<div class="line"><a name="l05697"></a><span class="lineno"> 5697</span>&#160;                     ? VL0Ty</div>
<div class="line"><a name="l05698"></a><span class="lineno"> 5698</span>&#160;                     : <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getIndexType(cast&lt;GetElementPtrInst&gt;(VL0)</div>
<div class="line"><a name="l05699"></a><span class="lineno"> 5699</span>&#160;                                            -&gt;getPointerOperandType()</div>
<div class="line"><a name="l05700"></a><span class="lineno"> 5700</span>&#160;                                            -&gt;getScalarType());</div>
<div class="line"><a name="l05701"></a><span class="lineno"> 5701</span>&#160;      <span class="comment">// Prepare the operand vector.</span></div>
<div class="line"><a name="l05702"></a><span class="lineno"> 5702</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l05703"></a><span class="lineno"> 5703</span>&#160;        <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;GetElementPtrInst&gt;(V);</div>
<div class="line"><a name="l05704"></a><span class="lineno"> 5704</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l05705"></a><span class="lineno"> 5705</span>&#160;          <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.back().push_back(</div>
<div class="line"><a name="l05706"></a><span class="lineno"> 5706</span>&#160;              <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(Ty, 0, <span class="comment">/*isSigned=*/</span><span class="keyword">false</span>));</div>
<div class="line"><a name="l05707"></a><span class="lineno"> 5707</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05708"></a><span class="lineno"> 5708</span>&#160;        }</div>
<div class="line"><a name="l05709"></a><span class="lineno"> 5709</span>&#160;        <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(IndexIdx);</div>
<div class="line"><a name="l05710"></a><span class="lineno"> 5710</span>&#160;        <span class="keyword">auto</span> *CI = dyn_cast&lt;ConstantInt&gt;(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>);</div>
<div class="line"><a name="l05711"></a><span class="lineno"> 5711</span>&#160;        <span class="keywordflow">if</span> (!CI)</div>
<div class="line"><a name="l05712"></a><span class="lineno"> 5712</span>&#160;          <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.back().push_back(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>);</div>
<div class="line"><a name="l05713"></a><span class="lineno"> 5713</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l05714"></a><span class="lineno"> 5714</span>&#160;          <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.back().push_back(<a class="code" href="classllvm_1_1ConstantExpr.html#a90d84324b6b6aa2a60077a79b31a49e7">ConstantExpr::getIntegerCast</a>(</div>
<div class="line"><a name="l05715"></a><span class="lineno"> 5715</span>&#160;              CI, Ty, CI-&gt;getValue().isSignBitSet()));</div>
<div class="line"><a name="l05716"></a><span class="lineno"> 5716</span>&#160;      }</div>
<div class="line"><a name="l05717"></a><span class="lineno"> 5717</span>&#160;      <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;setOperand(IndexIdx, <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.back());</div>
<div class="line"><a name="l05718"></a><span class="lineno"> 5718</span>&#160; </div>
<div class="line"><a name="l05719"></a><span class="lineno"> 5719</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, Ops = <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; Ops; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l05720"></a><span class="lineno"> 5720</span>&#160;        buildTree_rec(<a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>], <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1, {<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>});</div>
<div class="line"><a name="l05721"></a><span class="lineno"> 5721</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05722"></a><span class="lineno"> 5722</span>&#160;    }</div>
<div class="line"><a name="l05723"></a><span class="lineno"> 5723</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Instruction::Store</a>: {</div>
<div class="line"><a name="l05724"></a><span class="lineno"> 5724</span>&#160;      <span class="comment">// Check if the stores are consecutive or if we need to swizzle them.</span></div>
<div class="line"><a name="l05725"></a><span class="lineno"> 5725</span>&#160;      <a class="code" href="classllvm_1_1Type.html">llvm::Type</a> *ScalarTy = cast&lt;StoreInst&gt;(VL0)-&gt;getValueOperand()-&gt;getType();</div>
<div class="line"><a name="l05726"></a><span class="lineno"> 5726</span>&#160;      <span class="comment">// Avoid types that are padded when being allocated as scalars, while</span></div>
<div class="line"><a name="l05727"></a><span class="lineno"> 5727</span>&#160;      <span class="comment">// being packed together in a vector (such as i1).</span></div>
<div class="line"><a name="l05728"></a><span class="lineno"> 5728</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getTypeSizeInBits(ScalarTy) !=</div>
<div class="line"><a name="l05729"></a><span class="lineno"> 5729</span>&#160;          <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getTypeAllocSizeInBits(ScalarTy)) {</div>
<div class="line"><a name="l05730"></a><span class="lineno"> 5730</span>&#160;        BS.cancelScheduling(VL, VL0);</div>
<div class="line"><a name="l05731"></a><span class="lineno"> 5731</span>&#160;        newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05732"></a><span class="lineno"> 5732</span>&#160;                     ReuseShuffleIndicies);</div>
<div class="line"><a name="l05733"></a><span class="lineno"> 5733</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Gathering stores of non-packed type.\n&quot;</span>);</div>
<div class="line"><a name="l05734"></a><span class="lineno"> 5734</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05735"></a><span class="lineno"> 5735</span>&#160;      }</div>
<div class="line"><a name="l05736"></a><span class="lineno"> 5736</span>&#160;      <span class="comment">// Make sure all stores in the bundle are simple - we can&#39;t vectorize</span></div>
<div class="line"><a name="l05737"></a><span class="lineno"> 5737</span>&#160;      <span class="comment">// atomic or volatile stores.</span></div>
<div class="line"><a name="l05738"></a><span class="lineno"> 5738</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 4&gt;</a> PointerOps(VL.size());</div>
<div class="line"><a name="l05739"></a><span class="lineno"> 5739</span>&#160;      ValueList <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>(VL.size());</div>
<div class="line"><a name="l05740"></a><span class="lineno"> 5740</span>&#160;      <span class="keyword">auto</span> POIter = PointerOps.begin();</div>
<div class="line"><a name="l05741"></a><span class="lineno"> 5741</span>&#160;      <span class="keyword">auto</span> OIter = <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.begin();</div>
<div class="line"><a name="l05742"></a><span class="lineno"> 5742</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l05743"></a><span class="lineno"> 5743</span>&#160;        <span class="keyword">auto</span> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = cast&lt;StoreInst&gt;(V);</div>
<div class="line"><a name="l05744"></a><span class="lineno"> 5744</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;isSimple()) {</div>
<div class="line"><a name="l05745"></a><span class="lineno"> 5745</span>&#160;          BS.cancelScheduling(VL, VL0);</div>
<div class="line"><a name="l05746"></a><span class="lineno"> 5746</span>&#160;          newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05747"></a><span class="lineno"> 5747</span>&#160;                       ReuseShuffleIndicies);</div>
<div class="line"><a name="l05748"></a><span class="lineno"> 5748</span>&#160;          <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Gathering non-simple stores.\n&quot;</span>);</div>
<div class="line"><a name="l05749"></a><span class="lineno"> 5749</span>&#160;          <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05750"></a><span class="lineno"> 5750</span>&#160;        }</div>
<div class="line"><a name="l05751"></a><span class="lineno"> 5751</span>&#160;        *POIter = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getPointerOperand();</div>
<div class="line"><a name="l05752"></a><span class="lineno"> 5752</span>&#160;        *OIter = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getValueOperand();</div>
<div class="line"><a name="l05753"></a><span class="lineno"> 5753</span>&#160;        ++POIter;</div>
<div class="line"><a name="l05754"></a><span class="lineno"> 5754</span>&#160;        ++OIter;</div>
<div class="line"><a name="l05755"></a><span class="lineno"> 5755</span>&#160;      }</div>
<div class="line"><a name="l05756"></a><span class="lineno"> 5756</span>&#160; </div>
<div class="line"><a name="l05757"></a><span class="lineno"> 5757</span>&#160;      OrdersType CurrentOrder;</div>
<div class="line"><a name="l05758"></a><span class="lineno"> 5758</span>&#160;      <span class="comment">// Check the order of pointer operands.</span></div>
<div class="line"><a name="l05759"></a><span class="lineno"> 5759</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a8d9d7c33311a38eae588e12caf8985ce">llvm::sortPtrAccesses</a>(PointerOps, ScalarTy, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, *SE, CurrentOrder)) {</div>
<div class="line"><a name="l05760"></a><span class="lineno"> 5760</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *Ptr0;</div>
<div class="line"><a name="l05761"></a><span class="lineno"> 5761</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *PtrN;</div>
<div class="line"><a name="l05762"></a><span class="lineno"> 5762</span>&#160;        <span class="keywordflow">if</span> (CurrentOrder.empty()) {</div>
<div class="line"><a name="l05763"></a><span class="lineno"> 5763</span>&#160;          Ptr0 = PointerOps.front();</div>
<div class="line"><a name="l05764"></a><span class="lineno"> 5764</span>&#160;          PtrN = PointerOps.back();</div>
<div class="line"><a name="l05765"></a><span class="lineno"> 5765</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05766"></a><span class="lineno"> 5766</span>&#160;          Ptr0 = PointerOps[CurrentOrder.front()];</div>
<div class="line"><a name="l05767"></a><span class="lineno"> 5767</span>&#160;          PtrN = PointerOps[CurrentOrder.back()];</div>
<div class="line"><a name="l05768"></a><span class="lineno"> 5768</span>&#160;        }</div>
<div class="line"><a name="l05769"></a><span class="lineno"> 5769</span>&#160;        std::optional&lt;int&gt; Dist =</div>
<div class="line"><a name="l05770"></a><span class="lineno"> 5770</span>&#160;            <a class="code" href="namespacellvm.html#a034d66b8c0aeb72ea13fd26392083446">getPointersDiff</a>(ScalarTy, Ptr0, ScalarTy, PtrN, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, *SE);</div>
<div class="line"><a name="l05771"></a><span class="lineno"> 5771</span>&#160;        <span class="comment">// Check that the sorted pointer operands are consecutive.</span></div>
<div class="line"><a name="l05772"></a><span class="lineno"> 5772</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span><span class="keyword">&gt;</span>(*Dist) == VL.size() - 1) {</div>
<div class="line"><a name="l05773"></a><span class="lineno"> 5773</span>&#160;          <span class="keywordflow">if</span> (CurrentOrder.empty()) {</div>
<div class="line"><a name="l05774"></a><span class="lineno"> 5774</span>&#160;            <span class="comment">// Original stores are consecutive and does not require reordering.</span></div>
<div class="line"><a name="l05775"></a><span class="lineno"> 5775</span>&#160;            TreeEntry *<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a> = newTreeEntry(VL, Bundle <span class="comment">/*vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>,</div>
<div class="line"><a name="l05776"></a><span class="lineno"> 5776</span>&#160;                                         UserTreeIdx, ReuseShuffleIndicies);</div>
<div class="line"><a name="l05777"></a><span class="lineno"> 5777</span>&#160;            <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;setOperandsInOrder();</div>
<div class="line"><a name="l05778"></a><span class="lineno"> 5778</span>&#160;            buildTree_rec(<a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1, {<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>, 0});</div>
<div class="line"><a name="l05779"></a><span class="lineno"> 5779</span>&#160;            <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: added a vector of stores.\n&quot;</span>);</div>
<div class="line"><a name="l05780"></a><span class="lineno"> 5780</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05781"></a><span class="lineno"> 5781</span>&#160;            <a class="code" href="SLPVectorizer_8cpp.html#acd356293c4520fc1fb4a83de901e5bb7">fixupOrderingIndices</a>(CurrentOrder);</div>
<div class="line"><a name="l05782"></a><span class="lineno"> 5782</span>&#160;            TreeEntry *<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a> =</div>
<div class="line"><a name="l05783"></a><span class="lineno"> 5783</span>&#160;                newTreeEntry(VL, Bundle <span class="comment">/*vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05784"></a><span class="lineno"> 5784</span>&#160;                             ReuseShuffleIndicies, CurrentOrder);</div>
<div class="line"><a name="l05785"></a><span class="lineno"> 5785</span>&#160;            <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;setOperandsInOrder();</div>
<div class="line"><a name="l05786"></a><span class="lineno"> 5786</span>&#160;            buildTree_rec(<a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1, {<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>, 0});</div>
<div class="line"><a name="l05787"></a><span class="lineno"> 5787</span>&#160;            <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: added a vector of jumbled stores.\n&quot;</span>);</div>
<div class="line"><a name="l05788"></a><span class="lineno"> 5788</span>&#160;          }</div>
<div class="line"><a name="l05789"></a><span class="lineno"> 5789</span>&#160;          <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05790"></a><span class="lineno"> 5790</span>&#160;        }</div>
<div class="line"><a name="l05791"></a><span class="lineno"> 5791</span>&#160;      }</div>
<div class="line"><a name="l05792"></a><span class="lineno"> 5792</span>&#160; </div>
<div class="line"><a name="l05793"></a><span class="lineno"> 5793</span>&#160;      BS.cancelScheduling(VL, VL0);</div>
<div class="line"><a name="l05794"></a><span class="lineno"> 5794</span>&#160;      newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05795"></a><span class="lineno"> 5795</span>&#160;                   ReuseShuffleIndicies);</div>
<div class="line"><a name="l05796"></a><span class="lineno"> 5796</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Non-consecutive store.\n&quot;</span>);</div>
<div class="line"><a name="l05797"></a><span class="lineno"> 5797</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05798"></a><span class="lineno"> 5798</span>&#160;    }</div>
<div class="line"><a name="l05799"></a><span class="lineno"> 5799</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Instruction::Call</a>: {</div>
<div class="line"><a name="l05800"></a><span class="lineno"> 5800</span>&#160;      <span class="comment">// Check if the calls are all to the same vectorizable intrinsic or</span></div>
<div class="line"><a name="l05801"></a><span class="lineno"> 5801</span>&#160;      <span class="comment">// library function.</span></div>
<div class="line"><a name="l05802"></a><span class="lineno"> 5802</span>&#160;      <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI = cast&lt;CallInst&gt;(VL0);</div>
<div class="line"><a name="l05803"></a><span class="lineno"> 5803</span>&#160;      <a class="code" href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> <a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a> = <a class="code" href="namespacellvm.html#a11c66d01880f53332fc7ad53f565b039">getVectorIntrinsicIDForCall</a>(CI, TLI);</div>
<div class="line"><a name="l05804"></a><span class="lineno"> 5804</span>&#160; </div>
<div class="line"><a name="l05805"></a><span class="lineno"> 5805</span>&#160;      <a class="code" href="structllvm_1_1VFShape.html">VFShape</a> Shape = <a class="code" href="structllvm_1_1VFShape.html#a33df83a8555fc8dd7c7d547576abb354">VFShape::get</a>(</div>
<div class="line"><a name="l05806"></a><span class="lineno"> 5806</span>&#160;          *CI, <a class="code" href="classllvm_1_1ElementCount.html#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(<span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(VL.size())),</div>
<div class="line"><a name="l05807"></a><span class="lineno"> 5807</span>&#160;          <span class="keyword">false</span> <span class="comment">/*HasGlobalPred*/</span>);</div>
<div class="line"><a name="l05808"></a><span class="lineno"> 5808</span>&#160;      <a class="code" href="classllvm_1_1Function.html">Function</a> *VecFunc = <a class="code" href="classllvm_1_1VFDatabase.html">VFDatabase</a>(*CI).<a class="code" href="group__VFDatabase.html#ga66862f50dead385e61e416b35110c5f1">getVectorizedFunction</a>(Shape);</div>
<div class="line"><a name="l05809"></a><span class="lineno"> 5809</span>&#160; </div>
<div class="line"><a name="l05810"></a><span class="lineno"> 5810</span>&#160;      <span class="keywordflow">if</span> (!VecFunc &amp;&amp; !<a class="code" href="namespacellvm.html#aeb65ce026673a69aac75e5a7a26007b3">isTriviallyVectorizable</a>(<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>)) {</div>
<div class="line"><a name="l05811"></a><span class="lineno"> 5811</span>&#160;        BS.cancelScheduling(VL, VL0);</div>
<div class="line"><a name="l05812"></a><span class="lineno"> 5812</span>&#160;        newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05813"></a><span class="lineno"> 5813</span>&#160;                     ReuseShuffleIndicies);</div>
<div class="line"><a name="l05814"></a><span class="lineno"> 5814</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Non-vectorizable call.\n&quot;</span>);</div>
<div class="line"><a name="l05815"></a><span class="lineno"> 5815</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05816"></a><span class="lineno"> 5816</span>&#160;      }</div>
<div class="line"><a name="l05817"></a><span class="lineno"> 5817</span>&#160;      <a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#a83b8c9e572130f403445c0b0f69b837c">getCalledFunction</a>();</div>
<div class="line"><a name="l05818"></a><span class="lineno"> 5818</span>&#160;      <span class="keywordtype">unsigned</span> NumArgs = CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#adde2ea00dd2613ee41bfe91908e4e68e">arg_size</a>();</div>
<div class="line"><a name="l05819"></a><span class="lineno"> 5819</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value*, 4&gt;</a> ScalarArgs(NumArgs, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l05820"></a><span class="lineno"> 5820</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a> != NumArgs; ++<a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>)</div>
<div class="line"><a name="l05821"></a><span class="lineno"> 5821</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ad5f1403d57d5cc4301785b181caa5f1b">isVectorIntrinsicWithScalarOpAtArg</a>(<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>, <a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>))</div>
<div class="line"><a name="l05822"></a><span class="lineno"> 5822</span>&#160;          ScalarArgs[<a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>] = CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(<a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>);</div>
<div class="line"><a name="l05823"></a><span class="lineno"> 5823</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l05824"></a><span class="lineno"> 5824</span>&#160;        <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI2 = dyn_cast&lt;CallInst&gt;(V);</div>
<div class="line"><a name="l05825"></a><span class="lineno"> 5825</span>&#160;        <span class="keywordflow">if</span> (!CI2 || CI2-&gt;<a class="code" href="classllvm_1_1CallBase.html#a83b8c9e572130f403445c0b0f69b837c">getCalledFunction</a>() != <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> ||</div>
<div class="line"><a name="l05826"></a><span class="lineno"> 5826</span>&#160;            <a class="code" href="namespacellvm.html#a11c66d01880f53332fc7ad53f565b039">getVectorIntrinsicIDForCall</a>(CI2, TLI) != <a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a> ||</div>
<div class="line"><a name="l05827"></a><span class="lineno"> 5827</span>&#160;            (VecFunc &amp;&amp;</div>
<div class="line"><a name="l05828"></a><span class="lineno"> 5828</span>&#160;             VecFunc != <a class="code" href="classllvm_1_1VFDatabase.html">VFDatabase</a>(*CI2).<a class="code" href="group__VFDatabase.html#ga66862f50dead385e61e416b35110c5f1">getVectorizedFunction</a>(Shape)) ||</div>
<div class="line"><a name="l05829"></a><span class="lineno"> 5829</span>&#160;            !CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#a4e301518882466a796c3b890aac2e866">hasIdenticalOperandBundleSchema</a>(*CI2)) {</div>
<div class="line"><a name="l05830"></a><span class="lineno"> 5830</span>&#160;          BS.cancelScheduling(VL, VL0);</div>
<div class="line"><a name="l05831"></a><span class="lineno"> 5831</span>&#160;          newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05832"></a><span class="lineno"> 5832</span>&#160;                       ReuseShuffleIndicies);</div>
<div class="line"><a name="l05833"></a><span class="lineno"> 5833</span>&#160;          <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: mismatched calls:&quot;</span> &lt;&lt; *CI &lt;&lt; <span class="stringliteral">&quot;!=&quot;</span> &lt;&lt; *V</div>
<div class="line"><a name="l05834"></a><span class="lineno"> 5834</span>&#160;                            &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l05835"></a><span class="lineno"> 5835</span>&#160;          <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05836"></a><span class="lineno"> 5836</span>&#160;        }</div>
<div class="line"><a name="l05837"></a><span class="lineno"> 5837</span>&#160;        <span class="comment">// Some intrinsics have scalar arguments and should be same in order for</span></div>
<div class="line"><a name="l05838"></a><span class="lineno"> 5838</span>&#160;        <span class="comment">// them to be vectorized.</span></div>
<div class="line"><a name="l05839"></a><span class="lineno"> 5839</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a> != NumArgs; ++<a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>) {</div>
<div class="line"><a name="l05840"></a><span class="lineno"> 5840</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ad5f1403d57d5cc4301785b181caa5f1b">isVectorIntrinsicWithScalarOpAtArg</a>(<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>, <a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>)) {</div>
<div class="line"><a name="l05841"></a><span class="lineno"> 5841</span>&#160;            <a class="code" href="classllvm_1_1Value.html">Value</a> *A1J = CI2-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(<a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>);</div>
<div class="line"><a name="l05842"></a><span class="lineno"> 5842</span>&#160;            <span class="keywordflow">if</span> (ScalarArgs[<a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>] != A1J) {</div>
<div class="line"><a name="l05843"></a><span class="lineno"> 5843</span>&#160;              BS.cancelScheduling(VL, VL0);</div>
<div class="line"><a name="l05844"></a><span class="lineno"> 5844</span>&#160;              newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05845"></a><span class="lineno"> 5845</span>&#160;                           ReuseShuffleIndicies);</div>
<div class="line"><a name="l05846"></a><span class="lineno"> 5846</span>&#160;              <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: mismatched arguments in call:&quot;</span> &lt;&lt; *CI</div>
<div class="line"><a name="l05847"></a><span class="lineno"> 5847</span>&#160;                                &lt;&lt; <span class="stringliteral">&quot; argument &quot;</span> &lt;&lt; ScalarArgs[<a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>] &lt;&lt; <span class="stringliteral">&quot;!=&quot;</span> &lt;&lt; A1J</div>
<div class="line"><a name="l05848"></a><span class="lineno"> 5848</span>&#160;                                &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l05849"></a><span class="lineno"> 5849</span>&#160;              <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05850"></a><span class="lineno"> 5850</span>&#160;            }</div>
<div class="line"><a name="l05851"></a><span class="lineno"> 5851</span>&#160;          }</div>
<div class="line"><a name="l05852"></a><span class="lineno"> 5852</span>&#160;        }</div>
<div class="line"><a name="l05853"></a><span class="lineno"> 5853</span>&#160;        <span class="comment">// Verify that the bundle operands are identical between the two calls.</span></div>
<div class="line"><a name="l05854"></a><span class="lineno"> 5854</span>&#160;        <span class="keywordflow">if</span> (CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#aecc0c27ae96638bc9d8fa4caffa92c31">hasOperandBundles</a>() &amp;&amp;</div>
<div class="line"><a name="l05855"></a><span class="lineno"> 5855</span>&#160;            !<a class="code" href="namespacellvm_1_1lltok.html#af353621f14cb4b4b3af5ffaff84076b1abf5ba3ee47e95dae362eb24b6d4f48e5">std::equal</a>(CI-&gt;<a class="code" href="classllvm_1_1User.html#a2eeb1c7ed1cfe403f2ae0470e36c07e2">op_begin</a>() + CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#a7a21e7face454c8ea6c4b9e12b506e40">getBundleOperandsStartIndex</a>(),</div>
<div class="line"><a name="l05856"></a><span class="lineno"> 5856</span>&#160;                        CI-&gt;<a class="code" href="classllvm_1_1User.html#a2eeb1c7ed1cfe403f2ae0470e36c07e2">op_begin</a>() + CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#a0951bc018bd4725e28d9d05e36a1360a">getBundleOperandsEndIndex</a>(),</div>
<div class="line"><a name="l05857"></a><span class="lineno"> 5857</span>&#160;                        CI2-&gt;<a class="code" href="classllvm_1_1User.html#a2eeb1c7ed1cfe403f2ae0470e36c07e2">op_begin</a>() + CI2-&gt;<a class="code" href="classllvm_1_1CallBase.html#a7a21e7face454c8ea6c4b9e12b506e40">getBundleOperandsStartIndex</a>())) {</div>
<div class="line"><a name="l05858"></a><span class="lineno"> 5858</span>&#160;          BS.cancelScheduling(VL, VL0);</div>
<div class="line"><a name="l05859"></a><span class="lineno"> 5859</span>&#160;          newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05860"></a><span class="lineno"> 5860</span>&#160;                       ReuseShuffleIndicies);</div>
<div class="line"><a name="l05861"></a><span class="lineno"> 5861</span>&#160;          <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: mismatched bundle operands in calls:&quot;</span></div>
<div class="line"><a name="l05862"></a><span class="lineno"> 5862</span>&#160;                            &lt;&lt; *CI &lt;&lt; <span class="stringliteral">&quot;!=&quot;</span> &lt;&lt; *V &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l05863"></a><span class="lineno"> 5863</span>&#160;          <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05864"></a><span class="lineno"> 5864</span>&#160;        }</div>
<div class="line"><a name="l05865"></a><span class="lineno"> 5865</span>&#160;      }</div>
<div class="line"><a name="l05866"></a><span class="lineno"> 5866</span>&#160; </div>
<div class="line"><a name="l05867"></a><span class="lineno"> 5867</span>&#160;      TreeEntry *<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a> = newTreeEntry(VL, Bundle <span class="comment">/*vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05868"></a><span class="lineno"> 5868</span>&#160;                                   ReuseShuffleIndicies);</div>
<div class="line"><a name="l05869"></a><span class="lineno"> 5869</span>&#160;      <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;setOperandsInOrder();</div>
<div class="line"><a name="l05870"></a><span class="lineno"> 5870</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#adde2ea00dd2613ee41bfe91908e4e68e">arg_size</a>(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l05871"></a><span class="lineno"> 5871</span>&#160;        <span class="comment">// For scalar operands no need to to create an entry since no need to</span></div>
<div class="line"><a name="l05872"></a><span class="lineno"> 5872</span>&#160;        <span class="comment">// vectorize it.</span></div>
<div class="line"><a name="l05873"></a><span class="lineno"> 5873</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ad5f1403d57d5cc4301785b181caa5f1b">isVectorIntrinsicWithScalarOpAtArg</a>(<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>, <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>))</div>
<div class="line"><a name="l05874"></a><span class="lineno"> 5874</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05875"></a><span class="lineno"> 5875</span>&#160;        ValueList <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>;</div>
<div class="line"><a name="l05876"></a><span class="lineno"> 5876</span>&#160;        <span class="comment">// Prepare the operand vector.</span></div>
<div class="line"><a name="l05877"></a><span class="lineno"> 5877</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l05878"></a><span class="lineno"> 5878</span>&#160;          <span class="keyword">auto</span> *CI2 = cast&lt;CallInst&gt;(V);</div>
<div class="line"><a name="l05879"></a><span class="lineno"> 5879</span>&#160;          <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.push_back(CI2-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div>
<div class="line"><a name="l05880"></a><span class="lineno"> 5880</span>&#160;        }</div>
<div class="line"><a name="l05881"></a><span class="lineno"> 5881</span>&#160;        buildTree_rec(<a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1, {<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>, <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>});</div>
<div class="line"><a name="l05882"></a><span class="lineno"> 5882</span>&#160;      }</div>
<div class="line"><a name="l05883"></a><span class="lineno"> 5883</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05884"></a><span class="lineno"> 5884</span>&#160;    }</div>
<div class="line"><a name="l05885"></a><span class="lineno"> 5885</span>&#160;    <span class="keywordflow">case</span> Instruction::ShuffleVector: {</div>
<div class="line"><a name="l05886"></a><span class="lineno"> 5886</span>&#160;      <span class="comment">// If this is not an alternate sequence of opcode like add-sub</span></div>
<div class="line"><a name="l05887"></a><span class="lineno"> 5887</span>&#160;      <span class="comment">// then do not vectorize this instruction.</span></div>
<div class="line"><a name="l05888"></a><span class="lineno"> 5888</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.isAltShuffle()) {</div>
<div class="line"><a name="l05889"></a><span class="lineno"> 5889</span>&#160;        BS.cancelScheduling(VL, VL0);</div>
<div class="line"><a name="l05890"></a><span class="lineno"> 5890</span>&#160;        newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05891"></a><span class="lineno"> 5891</span>&#160;                     ReuseShuffleIndicies);</div>
<div class="line"><a name="l05892"></a><span class="lineno"> 5892</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: ShuffleVector are not vectorized.\n&quot;</span>);</div>
<div class="line"><a name="l05893"></a><span class="lineno"> 5893</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05894"></a><span class="lineno"> 5894</span>&#160;      }</div>
<div class="line"><a name="l05895"></a><span class="lineno"> 5895</span>&#160;      TreeEntry *<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a> = newTreeEntry(VL, Bundle <span class="comment">/*vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05896"></a><span class="lineno"> 5896</span>&#160;                                   ReuseShuffleIndicies);</div>
<div class="line"><a name="l05897"></a><span class="lineno"> 5897</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: added a ShuffleVector op.\n&quot;</span>);</div>
<div class="line"><a name="l05898"></a><span class="lineno"> 5898</span>&#160; </div>
<div class="line"><a name="l05899"></a><span class="lineno"> 5899</span>&#160;      <span class="comment">// Reorder operands if reordering would enable vectorization.</span></div>
<div class="line"><a name="l05900"></a><span class="lineno"> 5900</span>&#160;      <span class="keyword">auto</span> *CI = dyn_cast&lt;CmpInst&gt;(VL0);</div>
<div class="line"><a name="l05901"></a><span class="lineno"> 5901</span>&#160;      <span class="keywordflow">if</span> (isa&lt;BinaryOperator&gt;(VL0) || CI) {</div>
<div class="line"><a name="l05902"></a><span class="lineno"> 5902</span>&#160;        ValueList <a class="code" href="namespacellvm.html#a2554a96c67bdd7d0a62855a844ec55b0a945d5e233cf7d6240f6b783b36a374ff">Left</a>, <a class="code" href="README__P9_8txt.html#acc80d72f12f6f9e1d8eda2ec3d74133c">Right</a>;</div>
<div class="line"><a name="l05903"></a><span class="lineno"> 5903</span>&#160;        <span class="keywordflow">if</span> (!CI || <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(VL, [](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l05904"></a><span class="lineno"> 5904</span>&#160;              <span class="keywordflow">return</span> cast&lt;CmpInst&gt;(V)-&gt;isCommutative();</div>
<div class="line"><a name="l05905"></a><span class="lineno"> 5905</span>&#160;            })) {</div>
<div class="line"><a name="l05906"></a><span class="lineno"> 5906</span>&#160;          reorderInputsAccordingToOpcode(VL, Left, Right, *TLI, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, *SE,</div>
<div class="line"><a name="l05907"></a><span class="lineno"> 5907</span>&#160;                                         *<span class="keyword">this</span>);</div>
<div class="line"><a name="l05908"></a><span class="lineno"> 5908</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05909"></a><span class="lineno"> 5909</span>&#160;          <span class="keyword">auto</span> *MainCI = cast&lt;CmpInst&gt;(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.MainOp);</div>
<div class="line"><a name="l05910"></a><span class="lineno"> 5910</span>&#160;          <span class="keyword">auto</span> *AltCI = cast&lt;CmpInst&gt;(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.AltOp);</div>
<div class="line"><a name="l05911"></a><span class="lineno"> 5911</span>&#160;          <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> MainP = MainCI-&gt;getPredicate();</div>
<div class="line"><a name="l05912"></a><span class="lineno"> 5912</span>&#160;          <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> AltP = AltCI-&gt;getPredicate();</div>
<div class="line"><a name="l05913"></a><span class="lineno"> 5913</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MainP != AltP &amp;&amp;</div>
<div class="line"><a name="l05914"></a><span class="lineno"> 5914</span>&#160;                 <span class="stringliteral">&quot;Expected different main/alternate predicates.&quot;</span>);</div>
<div class="line"><a name="l05915"></a><span class="lineno"> 5915</span>&#160;          <span class="comment">// Collect operands - commute if it uses the swapped predicate or</span></div>
<div class="line"><a name="l05916"></a><span class="lineno"> 5916</span>&#160;          <span class="comment">// alternate operation.</span></div>
<div class="line"><a name="l05917"></a><span class="lineno"> 5917</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l05918"></a><span class="lineno"> 5918</span>&#160;            <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a> = cast&lt;CmpInst&gt;(V);</div>
<div class="line"><a name="l05919"></a><span class="lineno"> 5919</span>&#160;            <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = <a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getOperand(0);</div>
<div class="line"><a name="l05920"></a><span class="lineno"> 5920</span>&#160;            <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = <a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getOperand(1);</div>
<div class="line"><a name="l05921"></a><span class="lineno"> 5921</span>&#160; </div>
<div class="line"><a name="l05922"></a><span class="lineno"> 5922</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#afb636ad432c97f9178ff3f966e93d819">isAlternateInstruction</a>(Cmp, MainCI, AltCI, *TLI)) {</div>
<div class="line"><a name="l05923"></a><span class="lineno"> 5923</span>&#160;              <span class="keywordflow">if</span> (AltP == <a class="code" href="classllvm_1_1CmpInst.html#a49a2d8f483ea08a3d6ea75f90c640d76">CmpInst::getSwappedPredicate</a>(<a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getPredicate()))</div>
<div class="line"><a name="l05924"></a><span class="lineno"> 5924</span>&#160;                <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</div>
<div class="line"><a name="l05925"></a><span class="lineno"> 5925</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05926"></a><span class="lineno"> 5926</span>&#160;              <span class="keywordflow">if</span> (MainP == <a class="code" href="classllvm_1_1CmpInst.html#a49a2d8f483ea08a3d6ea75f90c640d76">CmpInst::getSwappedPredicate</a>(<a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getPredicate()))</div>
<div class="line"><a name="l05927"></a><span class="lineno"> 5927</span>&#160;                <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</div>
<div class="line"><a name="l05928"></a><span class="lineno"> 5928</span>&#160;            }</div>
<div class="line"><a name="l05929"></a><span class="lineno"> 5929</span>&#160;            <a class="code" href="namespacellvm.html#a2554a96c67bdd7d0a62855a844ec55b0a945d5e233cf7d6240f6b783b36a374ff">Left</a>.push_back(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>);</div>
<div class="line"><a name="l05930"></a><span class="lineno"> 5930</span>&#160;            <a class="code" href="README__P9_8txt.html#acc80d72f12f6f9e1d8eda2ec3d74133c">Right</a>.push_back(<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</div>
<div class="line"><a name="l05931"></a><span class="lineno"> 5931</span>&#160;          }</div>
<div class="line"><a name="l05932"></a><span class="lineno"> 5932</span>&#160;        }</div>
<div class="line"><a name="l05933"></a><span class="lineno"> 5933</span>&#160;        <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;setOperand(0, Left);</div>
<div class="line"><a name="l05934"></a><span class="lineno"> 5934</span>&#160;        <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;setOperand(1, Right);</div>
<div class="line"><a name="l05935"></a><span class="lineno"> 5935</span>&#160;        buildTree_rec(Left, <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1, {<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>, 0});</div>
<div class="line"><a name="l05936"></a><span class="lineno"> 5936</span>&#160;        buildTree_rec(Right, <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1, {<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>, 1});</div>
<div class="line"><a name="l05937"></a><span class="lineno"> 5937</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05938"></a><span class="lineno"> 5938</span>&#160;      }</div>
<div class="line"><a name="l05939"></a><span class="lineno"> 5939</span>&#160; </div>
<div class="line"><a name="l05940"></a><span class="lineno"> 5940</span>&#160;      <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;setOperandsInOrder();</div>
<div class="line"><a name="l05941"></a><span class="lineno"> 5941</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = VL0-&gt;getNumOperands(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l05942"></a><span class="lineno"> 5942</span>&#160;        ValueList <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>;</div>
<div class="line"><a name="l05943"></a><span class="lineno"> 5943</span>&#160;        <span class="comment">// Prepare the operand vector.</span></div>
<div class="line"><a name="l05944"></a><span class="lineno"> 5944</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL)</div>
<div class="line"><a name="l05945"></a><span class="lineno"> 5945</span>&#160;          <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.push_back(cast&lt;Instruction&gt;(V)-&gt;getOperand(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div>
<div class="line"><a name="l05946"></a><span class="lineno"> 5946</span>&#160; </div>
<div class="line"><a name="l05947"></a><span class="lineno"> 5947</span>&#160;        buildTree_rec(<a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1, {<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>, <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>});</div>
<div class="line"><a name="l05948"></a><span class="lineno"> 5948</span>&#160;      }</div>
<div class="line"><a name="l05949"></a><span class="lineno"> 5949</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05950"></a><span class="lineno"> 5950</span>&#160;    }</div>
<div class="line"><a name="l05951"></a><span class="lineno"> 5951</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l05952"></a><span class="lineno"> 5952</span>&#160;      BS.cancelScheduling(VL, VL0);</div>
<div class="line"><a name="l05953"></a><span class="lineno"> 5953</span>&#160;      newTreeEntry(VL, std::nullopt <span class="comment">/*not vectorized*/</span>, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, UserTreeIdx,</div>
<div class="line"><a name="l05954"></a><span class="lineno"> 5954</span>&#160;                   ReuseShuffleIndicies);</div>
<div class="line"><a name="l05955"></a><span class="lineno"> 5955</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Gathering unknown instruction.\n&quot;</span>);</div>
<div class="line"><a name="l05956"></a><span class="lineno"> 5956</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05957"></a><span class="lineno"> 5957</span>&#160;  }</div>
<div class="line"><a name="l05958"></a><span class="lineno"> 5958</span>&#160;}</div>
<div class="line"><a name="l05959"></a><span class="lineno"> 5959</span>&#160; </div>
<div class="line"><a name="l05960"></a><span class="lineno"> 5960</span>&#160;<span class="keywordtype">unsigned</span> BoUpSLP::canMapToVector(<a class="code" href="classllvm_1_1Type.html">Type</a> *<a class="code" href="classT.html">T</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l05961"></a><span class="lineno"> 5961</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = 1;</div>
<div class="line"><a name="l05962"></a><span class="lineno"> 5962</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *EltTy = <a class="code" href="classT.html">T</a>;</div>
<div class="line"><a name="l05963"></a><span class="lineno"> 5963</span>&#160; </div>
<div class="line"><a name="l05964"></a><span class="lineno"> 5964</span>&#160;  <span class="keywordflow">while</span> (isa&lt;StructType, ArrayType, VectorType&gt;(EltTy)) {</div>
<div class="line"><a name="l05965"></a><span class="lineno"> 5965</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a> = dyn_cast&lt;StructType&gt;(EltTy)) {</div>
<div class="line"><a name="l05966"></a><span class="lineno"> 5966</span>&#160;      <span class="comment">// Check that struct is homogeneous.</span></div>
<div class="line"><a name="l05967"></a><span class="lineno"> 5967</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> *Ty : <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;elements())</div>
<div class="line"><a name="l05968"></a><span class="lineno"> 5968</span>&#160;        <span class="keywordflow">if</span> (Ty != *<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;element_begin())</div>
<div class="line"><a name="l05969"></a><span class="lineno"> 5969</span>&#160;          <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l05970"></a><span class="lineno"> 5970</span>&#160;      <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> *= <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;getNumElements();</div>
<div class="line"><a name="l05971"></a><span class="lineno"> 5971</span>&#160;      EltTy = *<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;element_begin();</div>
<div class="line"><a name="l05972"></a><span class="lineno"> 5972</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *AT = dyn_cast&lt;ArrayType&gt;(EltTy)) {</div>
<div class="line"><a name="l05973"></a><span class="lineno"> 5973</span>&#160;      <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> *= AT-&gt;getNumElements();</div>
<div class="line"><a name="l05974"></a><span class="lineno"> 5974</span>&#160;      EltTy = AT-&gt;getElementType();</div>
<div class="line"><a name="l05975"></a><span class="lineno"> 5975</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05976"></a><span class="lineno"> 5976</span>&#160;      <span class="keyword">auto</span> *VT = cast&lt;FixedVectorType&gt;(EltTy);</div>
<div class="line"><a name="l05977"></a><span class="lineno"> 5977</span>&#160;      <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> *= VT-&gt;getNumElements();</div>
<div class="line"><a name="l05978"></a><span class="lineno"> 5978</span>&#160;      EltTy = VT-&gt;getElementType();</div>
<div class="line"><a name="l05979"></a><span class="lineno"> 5979</span>&#160;    }</div>
<div class="line"><a name="l05980"></a><span class="lineno"> 5980</span>&#160;  }</div>
<div class="line"><a name="l05981"></a><span class="lineno"> 5981</span>&#160; </div>
<div class="line"><a name="l05982"></a><span class="lineno"> 5982</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="SLPVectorizer_8cpp.html#aa3ea54a95743867473d32853d3c65603">isValidElementType</a>(EltTy))</div>
<div class="line"><a name="l05983"></a><span class="lineno"> 5983</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l05984"></a><span class="lineno"> 5984</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> VTSize = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSizeInBits(<a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(EltTy, <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>));</div>
<div class="line"><a name="l05985"></a><span class="lineno"> 5985</span>&#160;  <span class="keywordflow">if</span> (VTSize &lt; MinVecRegSize || VTSize &gt; MaxVecRegSize || VTSize != <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSizeInBits(<a class="code" href="classT.html">T</a>))</div>
<div class="line"><a name="l05986"></a><span class="lineno"> 5986</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l05987"></a><span class="lineno"> 5987</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>;</div>
<div class="line"><a name="l05988"></a><span class="lineno"> 5988</span>&#160;}</div>
<div class="line"><a name="l05989"></a><span class="lineno"> 5989</span>&#160; </div>
<div class="line"><a name="l05990"></a><span class="lineno"> 5990</span>&#160;<span class="keywordtype">bool</span> BoUpSLP::canReuseExtract(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL, <a class="code" href="classllvm_1_1Value.html">Value</a> *OpValue,</div>
<div class="line"><a name="l05991"></a><span class="lineno"> 5991</span>&#160;                              <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;unsigned&gt;</a> &amp;CurrentOrder)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l05992"></a><span class="lineno"> 5992</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> *It = <a class="code" href="namespacellvm.html#ac78c09ae232b2ce188ff590d51e3c268">find_if</a>(VL, [](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l05993"></a><span class="lineno"> 5993</span>&#160;    <span class="keywordflow">return</span> isa&lt;ExtractElementInst, ExtractValueInst&gt;(V);</div>
<div class="line"><a name="l05994"></a><span class="lineno"> 5994</span>&#160;  });</div>
<div class="line"><a name="l05995"></a><span class="lineno"> 5995</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(It != VL.<a class="code" href="classllvm_1_1ArrayRef.html#a7ca5197533a9c1fb8a2bd30587fcec6b">end</a>() &amp;&amp; <span class="stringliteral">&quot;Expected at least one extract instruction.&quot;</span>);</div>
<div class="line"><a name="l05996"></a><span class="lineno"> 5996</span>&#160;  <span class="keyword">auto</span> *E0 = cast&lt;Instruction&gt;(*It);</div>
<div class="line"><a name="l05997"></a><span class="lineno"> 5997</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(VL,</div>
<div class="line"><a name="l05998"></a><span class="lineno"> 5998</span>&#160;                [](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l05999"></a><span class="lineno"> 5999</span>&#160;                  <span class="keywordflow">return</span> isa&lt;UndefValue, ExtractElementInst, ExtractValueInst&gt;(</div>
<div class="line"><a name="l06000"></a><span class="lineno"> 6000</span>&#160;                      V);</div>
<div class="line"><a name="l06001"></a><span class="lineno"> 6001</span>&#160;                }) &amp;&amp;</div>
<div class="line"><a name="l06002"></a><span class="lineno"> 6002</span>&#160;         <span class="stringliteral">&quot;Invalid opcode&quot;</span>);</div>
<div class="line"><a name="l06003"></a><span class="lineno"> 6003</span>&#160;  <span class="comment">// Check if all of the extracts come from the same vector and from the</span></div>
<div class="line"><a name="l06004"></a><span class="lineno"> 6004</span>&#160;  <span class="comment">// correct offset.</span></div>
<div class="line"><a name="l06005"></a><span class="lineno"> 6005</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Vec = E0-&gt;getOperand(0);</div>
<div class="line"><a name="l06006"></a><span class="lineno"> 6006</span>&#160; </div>
<div class="line"><a name="l06007"></a><span class="lineno"> 6007</span>&#160;  CurrentOrder.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div>
<div class="line"><a name="l06008"></a><span class="lineno"> 6008</span>&#160; </div>
<div class="line"><a name="l06009"></a><span class="lineno"> 6009</span>&#160;  <span class="comment">// We have to extract from a vector/aggregate with the same number of elements.</span></div>
<div class="line"><a name="l06010"></a><span class="lineno"> 6010</span>&#160;  <span class="keywordtype">unsigned</span> NElts;</div>
<div class="line"><a name="l06011"></a><span class="lineno"> 6011</span>&#160;  <span class="keywordflow">if</span> (E0-&gt;getOpcode() == Instruction::ExtractValue) {</div>
<div class="line"><a name="l06012"></a><span class="lineno"> 6012</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a> = E0-&gt;getModule()-&gt;getDataLayout();</div>
<div class="line"><a name="l06013"></a><span class="lineno"> 6013</span>&#160;    NElts = canMapToVector(Vec-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l06014"></a><span class="lineno"> 6014</span>&#160;    <span class="keywordflow">if</span> (!NElts)</div>
<div class="line"><a name="l06015"></a><span class="lineno"> 6015</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06016"></a><span class="lineno"> 6016</span>&#160;    <span class="comment">// Check if load can be rewritten as load of vector.</span></div>
<div class="line"><a name="l06017"></a><span class="lineno"> 6017</span>&#160;    <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(Vec);</div>
<div class="line"><a name="l06018"></a><span class="lineno"> 6018</span>&#160;    <span class="keywordflow">if</span> (!LI || !LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#aeb534c1a0391ce24551c226a582099a7">isSimple</a>() || !LI-&gt;<a class="code" href="classllvm_1_1Value.html#a7c779ce2ba55bc94f52014fc25f3d520">hasNUses</a>(VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>()))</div>
<div class="line"><a name="l06019"></a><span class="lineno"> 6019</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06020"></a><span class="lineno"> 6020</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06021"></a><span class="lineno"> 6021</span>&#160;    NElts = cast&lt;FixedVectorType&gt;(Vec-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getNumElements();</div>
<div class="line"><a name="l06022"></a><span class="lineno"> 6022</span>&#160;  }</div>
<div class="line"><a name="l06023"></a><span class="lineno"> 6023</span>&#160; </div>
<div class="line"><a name="l06024"></a><span class="lineno"> 6024</span>&#160;  <span class="keywordflow">if</span> (NElts != VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>())</div>
<div class="line"><a name="l06025"></a><span class="lineno"> 6025</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06026"></a><span class="lineno"> 6026</span>&#160; </div>
<div class="line"><a name="l06027"></a><span class="lineno"> 6027</span>&#160;  <span class="comment">// Check that all of the indices extract from the correct offset.</span></div>
<div class="line"><a name="l06028"></a><span class="lineno"> 6028</span>&#160;  <span class="keywordtype">bool</span> ShouldKeepOrder = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06029"></a><span class="lineno"> 6029</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>();</div>
<div class="line"><a name="l06030"></a><span class="lineno"> 6030</span>&#160;  <span class="comment">// Assign to all items the initial value E + 1 so we can check if the extract</span></div>
<div class="line"><a name="l06031"></a><span class="lineno"> 6031</span>&#160;  <span class="comment">// instruction index was used already.</span></div>
<div class="line"><a name="l06032"></a><span class="lineno"> 6032</span>&#160;  <span class="comment">// Also, later we can check that all the indices are used and we have a</span></div>
<div class="line"><a name="l06033"></a><span class="lineno"> 6033</span>&#160;  <span class="comment">// consecutive access in the extract instructions, by checking that no</span></div>
<div class="line"><a name="l06034"></a><span class="lineno"> 6034</span>&#160;  <span class="comment">// element of CurrentOrder still has value E + 1.</span></div>
<div class="line"><a name="l06035"></a><span class="lineno"> 6035</span>&#160;  CurrentOrder.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a38c50aa8e3e9588f4f968c2e03a0cee0">assign</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l06036"></a><span class="lineno"> 6036</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0;</div>
<div class="line"><a name="l06037"></a><span class="lineno"> 6037</span>&#160;  <span class="keywordflow">for</span> (; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l06038"></a><span class="lineno"> 6038</span>&#160;    <span class="keyword">auto</span> *Inst = dyn_cast&lt;Instruction&gt;(VL[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]);</div>
<div class="line"><a name="l06039"></a><span class="lineno"> 6039</span>&#160;    <span class="keywordflow">if</span> (!Inst)</div>
<div class="line"><a name="l06040"></a><span class="lineno"> 6040</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06041"></a><span class="lineno"> 6041</span>&#160;    <span class="keywordflow">if</span> (Inst-&gt;getOperand(0) != Vec)</div>
<div class="line"><a name="l06042"></a><span class="lineno"> 6042</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06043"></a><span class="lineno"> 6043</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *EE = dyn_cast&lt;ExtractElementInst&gt;(Inst))</div>
<div class="line"><a name="l06044"></a><span class="lineno"> 6044</span>&#160;      <span class="keywordflow">if</span> (isa&lt;UndefValue&gt;(EE-&gt;getIndexOperand()))</div>
<div class="line"><a name="l06045"></a><span class="lineno"> 6045</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06046"></a><span class="lineno"> 6046</span>&#160;    std::optional&lt;unsigned&gt; Idx = <a class="code" href="SLPVectorizer_8cpp.html#abe11501239b82a4ba1730e12be769bc6">getExtractIndex</a>(Inst);</div>
<div class="line"><a name="l06047"></a><span class="lineno"> 6047</span>&#160;    <span class="keywordflow">if</span> (!Idx)</div>
<div class="line"><a name="l06048"></a><span class="lineno"> 6048</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06049"></a><span class="lineno"> 6049</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> ExtIdx = *Idx;</div>
<div class="line"><a name="l06050"></a><span class="lineno"> 6050</span>&#160;    <span class="keywordflow">if</span> (ExtIdx != <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l06051"></a><span class="lineno"> 6051</span>&#160;      <span class="keywordflow">if</span> (ExtIdx &gt;= <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> || CurrentOrder[ExtIdx] != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>)</div>
<div class="line"><a name="l06052"></a><span class="lineno"> 6052</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06053"></a><span class="lineno"> 6053</span>&#160;      ShouldKeepOrder = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06054"></a><span class="lineno"> 6054</span>&#160;      CurrentOrder[ExtIdx] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l06055"></a><span class="lineno"> 6055</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06056"></a><span class="lineno"> 6056</span>&#160;      <span class="keywordflow">if</span> (CurrentOrder[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>)</div>
<div class="line"><a name="l06057"></a><span class="lineno"> 6057</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06058"></a><span class="lineno"> 6058</span>&#160;      CurrentOrder[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l06059"></a><span class="lineno"> 6059</span>&#160;    }</div>
<div class="line"><a name="l06060"></a><span class="lineno"> 6060</span>&#160;  }</div>
<div class="line"><a name="l06061"></a><span class="lineno"> 6061</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>) {</div>
<div class="line"><a name="l06062"></a><span class="lineno"> 6062</span>&#160;    CurrentOrder.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div>
<div class="line"><a name="l06063"></a><span class="lineno"> 6063</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06064"></a><span class="lineno"> 6064</span>&#160;  }</div>
<div class="line"><a name="l06065"></a><span class="lineno"> 6065</span>&#160;  <span class="keywordflow">if</span> (ShouldKeepOrder)</div>
<div class="line"><a name="l06066"></a><span class="lineno"> 6066</span>&#160;    CurrentOrder.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div>
<div class="line"><a name="l06067"></a><span class="lineno"> 6067</span>&#160; </div>
<div class="line"><a name="l06068"></a><span class="lineno"> 6068</span>&#160;  <span class="keywordflow">return</span> ShouldKeepOrder;</div>
<div class="line"><a name="l06069"></a><span class="lineno"> 6069</span>&#160;}</div>
<div class="line"><a name="l06070"></a><span class="lineno"> 6070</span>&#160; </div>
<div class="line"><a name="l06071"></a><span class="lineno"> 6071</span>&#160;<span class="keywordtype">bool</span> BoUpSLP::areAllUsersVectorized(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</div>
<div class="line"><a name="l06072"></a><span class="lineno"> 6072</span>&#160;                                    <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VectorizedVals)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l06073"></a><span class="lineno"> 6073</span>&#160;  <span class="keywordflow">return</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUse() &amp;&amp; <a class="code" href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">is_contained</a>(VectorizedVals, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) ||</div>
<div class="line"><a name="l06074"></a><span class="lineno"> 6074</span>&#160;         <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;users(), [<span class="keyword">this</span>](<a class="code" href="classllvm_1_1User.html">User</a> *U) {</div>
<div class="line"><a name="l06075"></a><span class="lineno"> 6075</span>&#160;           return ScalarToTreeEntry.count(U) &gt; 0 ||</div>
<div class="line"><a name="l06076"></a><span class="lineno"> 6076</span>&#160;                  isVectorLikeInstWithConstOps(U) ||</div>
<div class="line"><a name="l06077"></a><span class="lineno"> 6077</span>&#160;                  (isa&lt;ExtractElementInst&gt;(U) &amp;&amp; MustGather.contains(U));</div>
<div class="line"><a name="l06078"></a><span class="lineno"> 6078</span>&#160;         });</div>
<div class="line"><a name="l06079"></a><span class="lineno"> 6079</span>&#160;}</div>
<div class="line"><a name="l06080"></a><span class="lineno"> 6080</span>&#160; </div>
<div class="line"><a name="l06081"></a><span class="lineno"> 6081</span>&#160;<span class="keyword">static</span> std::pair&lt;InstructionCost, InstructionCost&gt;</div>
<div class="line"><a name="l06082"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#af6afa6e00a2ef98815dd54413ab32fe2"> 6082</a></span>&#160;<a class="code" href="SLPVectorizer_8cpp.html#af6afa6e00a2ef98815dd54413ab32fe2">getVectorCallCosts</a>(<a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI, <a class="code" href="classllvm_1_1FixedVectorType.html">FixedVectorType</a> *VecTy,</div>
<div class="line"><a name="l06083"></a><span class="lineno"> 6083</span>&#160;                   <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> *<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> *TLI) {</div>
<div class="line"><a name="l06084"></a><span class="lineno"> 6084</span>&#160;  <a class="code" href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> <a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a> = <a class="code" href="namespacellvm.html#a11c66d01880f53332fc7ad53f565b039">getVectorIntrinsicIDForCall</a>(CI, TLI);</div>
<div class="line"><a name="l06085"></a><span class="lineno"> 6085</span>&#160; </div>
<div class="line"><a name="l06086"></a><span class="lineno"> 6086</span>&#160;  <span class="comment">// Calculate the cost of the scalar and vector calls.</span></div>
<div class="line"><a name="l06087"></a><span class="lineno"> 6087</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Type *, 4&gt;</a> VecTys;</div>
<div class="line"><a name="l06088"></a><span class="lineno"> 6088</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a> : CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#ac63dbb4994494c46f025715272cdb81e">args</a>())</div>
<div class="line"><a name="l06089"></a><span class="lineno"> 6089</span>&#160;    VecTys.push_back(</div>
<div class="line"><a name="l06090"></a><span class="lineno"> 6090</span>&#160;        <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a>-&gt;getType(), VecTy-&gt;<a class="code" href="classllvm_1_1FixedVectorType.html#a1893caf878859959ba6a3d5442ef1439">getNumElements</a>()));</div>
<div class="line"><a name="l06091"></a><span class="lineno"> 6091</span>&#160;  <a class="code" href="classllvm_1_1FastMathFlags.html">FastMathFlags</a> FMF;</div>
<div class="line"><a name="l06092"></a><span class="lineno"> 6092</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *FPCI = dyn_cast&lt;FPMathOperator&gt;(CI))</div>
<div class="line"><a name="l06093"></a><span class="lineno"> 6093</span>&#160;    FMF = FPCI-&gt;getFastMathFlags();</div>
<div class="line"><a name="l06094"></a><span class="lineno"> 6094</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const Value *&gt;</a> <a class="code" href="AMDGPULowerKernelArguments_8cpp.html#a1161e5a4e753384aaba3a8e4533c4261">Arguments</a>(CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#ac63dbb4994494c46f025715272cdb81e">args</a>());</div>
<div class="line"><a name="l06095"></a><span class="lineno"> 6095</span>&#160;  <a class="code" href="classllvm_1_1IntrinsicCostAttributes.html">IntrinsicCostAttributes</a> CostAttrs(<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>, VecTy, <a class="code" href="AMDGPULowerKernelArguments_8cpp.html#a1161e5a4e753384aaba3a8e4533c4261">Arguments</a>, VecTys, FMF,</div>
<div class="line"><a name="l06096"></a><span class="lineno"> 6096</span>&#160;                                    dyn_cast&lt;IntrinsicInst&gt;(CI));</div>
<div class="line"><a name="l06097"></a><span class="lineno"> 6097</span>&#160;  <span class="keyword">auto</span> IntrinsicCost =</div>
<div class="line"><a name="l06098"></a><span class="lineno"> 6098</span>&#160;    <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a4218f47749d093473e680ad0199fb239">getIntrinsicInstrCost</a>(CostAttrs, <a class="code" href="classllvm_1_1TargetTransformInfo.html#a706f223f760b55668fbae74202b816bba59b32ea7b6f10564abd40ad90602ca5b">TTI::TCK_RecipThroughput</a>);</div>
<div class="line"><a name="l06099"></a><span class="lineno"> 6099</span>&#160; </div>
<div class="line"><a name="l06100"></a><span class="lineno"> 6100</span>&#160;  <span class="keyword">auto</span> Shape = <a class="code" href="structllvm_1_1VFShape.html#a33df83a8555fc8dd7c7d547576abb354">VFShape::get</a>(*CI, <a class="code" href="classllvm_1_1ElementCount.html#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(<span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span><span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l06101"></a><span class="lineno"> 6101</span>&#160;                                     VecTy-&gt;<a class="code" href="classllvm_1_1FixedVectorType.html#a1893caf878859959ba6a3d5442ef1439">getNumElements</a>())),</div>
<div class="line"><a name="l06102"></a><span class="lineno"> 6102</span>&#160;                            <span class="keyword">false</span> <span class="comment">/*HasGlobalPred*/</span>);</div>
<div class="line"><a name="l06103"></a><span class="lineno"> 6103</span>&#160;  <a class="code" href="classllvm_1_1Function.html">Function</a> *VecFunc = <a class="code" href="classllvm_1_1VFDatabase.html">VFDatabase</a>(*CI).<a class="code" href="group__VFDatabase.html#ga66862f50dead385e61e416b35110c5f1">getVectorizedFunction</a>(Shape);</div>
<div class="line"><a name="l06104"></a><span class="lineno"> 6104</span>&#160;  <span class="keyword">auto</span> LibCost = IntrinsicCost;</div>
<div class="line"><a name="l06105"></a><span class="lineno"> 6105</span>&#160;  <span class="keywordflow">if</span> (!CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#a1fb374eb65dcf7cd3d1671efb2616f76">isNoBuiltin</a>() &amp;&amp; VecFunc) {</div>
<div class="line"><a name="l06106"></a><span class="lineno"> 6106</span>&#160;    <span class="comment">// Calculate the cost of the vector library call.</span></div>
<div class="line"><a name="l06107"></a><span class="lineno"> 6107</span>&#160;    <span class="comment">// If the corresponding vector call is cheaper, return its cost.</span></div>
<div class="line"><a name="l06108"></a><span class="lineno"> 6108</span>&#160;    LibCost = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#af67833027bb46ddb390684a6f0b75398">getCallInstrCost</a>(<span class="keyword">nullptr</span>, VecTy, VecTys,</div>
<div class="line"><a name="l06109"></a><span class="lineno"> 6109</span>&#160;                                    <a class="code" href="classllvm_1_1TargetTransformInfo.html#a706f223f760b55668fbae74202b816bba59b32ea7b6f10564abd40ad90602ca5b">TTI::TCK_RecipThroughput</a>);</div>
<div class="line"><a name="l06110"></a><span class="lineno"> 6110</span>&#160;  }</div>
<div class="line"><a name="l06111"></a><span class="lineno"> 6111</span>&#160;  <span class="keywordflow">return</span> {IntrinsicCost, LibCost};</div>
<div class="line"><a name="l06112"></a><span class="lineno"> 6112</span>&#160;}</div>
<div class="line"><a name="l06113"></a><span class="lineno"> 6113</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l06114"></a><span class="lineno"> 6114</span>&#160;<span class="comment">/// Compute the cost of creating a vector of type \p VecTy containing the</span></div>
<div class="line"><a name="l06115"></a><span class="lineno"> 6115</span>&#160;<span class="comment">/// extracted values from \p VL.</span></div>
<div class="line"><a name="l06116"></a><span class="lineno"> 6116</span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a></div>
<div class="line"><a name="l06117"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#aaf4b1586dd2d57daa5d28ea5ee3e14ca"> 6117</a></span>&#160;<a class="code" href="SLPVectorizer_8cpp.html#aaf4b1586dd2d57daa5d28ea5ee3e14ca">computeExtractCost</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL, <a class="code" href="classllvm_1_1FixedVectorType.html">FixedVectorType</a> *VecTy,</div>
<div class="line"><a name="l06118"></a><span class="lineno"> 6118</span>&#160;                   <a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53ec">TargetTransformInfo::ShuffleKind</a> ShuffleKind,</div>
<div class="line"><a name="l06119"></a><span class="lineno"> 6119</span>&#160;                   <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) {</div>
<div class="line"><a name="l06120"></a><span class="lineno"> 6120</span>&#160;  <span class="keywordtype">unsigned</span> NumOfParts = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>.<a class="code" href="classllvm_1_1TargetTransformInfo.html#ad67b7e389a52ada1d5264e23d09f4cbe">getNumberOfParts</a>(VecTy);</div>
<div class="line"><a name="l06121"></a><span class="lineno"> 6121</span>&#160; </div>
<div class="line"><a name="l06122"></a><span class="lineno"> 6122</span>&#160;  <span class="keywordflow">if</span> (ShuffleKind != <a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53eca7beec9815d0197f2d31fac9968e9205b">TargetTransformInfo::SK_PermuteSingleSrc</a> || !NumOfParts ||</div>
<div class="line"><a name="l06123"></a><span class="lineno"> 6123</span>&#160;      VecTy-&gt;<a class="code" href="classllvm_1_1FixedVectorType.html#a1893caf878859959ba6a3d5442ef1439">getNumElements</a>() &lt; NumOfParts)</div>
<div class="line"><a name="l06124"></a><span class="lineno"> 6124</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>.<a class="code" href="classllvm_1_1TargetTransformInfo.html#aa0519f26bcb15c25ac0ff557061fa7af">getShuffleCost</a>(ShuffleKind, VecTy, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l06125"></a><span class="lineno"> 6125</span>&#160; </div>
<div class="line"><a name="l06126"></a><span class="lineno"> 6126</span>&#160;  <span class="keywordtype">bool</span> AllConsecutive = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06127"></a><span class="lineno"> 6127</span>&#160;  <span class="keywordtype">unsigned</span> EltsPerVector = VecTy-&gt;<a class="code" href="classllvm_1_1FixedVectorType.html#a1893caf878859959ba6a3d5442ef1439">getNumElements</a>() / NumOfParts;</div>
<div class="line"><a name="l06128"></a><span class="lineno"> 6128</span>&#160;  <span class="keywordtype">unsigned</span> Idx = -1;</div>
<div class="line"><a name="l06129"></a><span class="lineno"> 6129</span>&#160;  <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> = 0;</div>
<div class="line"><a name="l06130"></a><span class="lineno"> 6130</span>&#160; </div>
<div class="line"><a name="l06131"></a><span class="lineno"> 6131</span>&#160;  <span class="comment">// Process extracts in blocks of EltsPerVector to check if the source vector</span></div>
<div class="line"><a name="l06132"></a><span class="lineno"> 6132</span>&#160;  <span class="comment">// operand can be re-used directly. If not, add the cost of creating a shuffle</span></div>
<div class="line"><a name="l06133"></a><span class="lineno"> 6133</span>&#160;  <span class="comment">// to extract the values into a vector register.</span></div>
<div class="line"><a name="l06134"></a><span class="lineno"> 6134</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> RegMask(EltsPerVector, <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l06135"></a><span class="lineno"> 6135</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *V : VL) {</div>
<div class="line"><a name="l06136"></a><span class="lineno"> 6136</span>&#160;    ++Idx;</div>
<div class="line"><a name="l06137"></a><span class="lineno"> 6137</span>&#160; </div>
<div class="line"><a name="l06138"></a><span class="lineno"> 6138</span>&#160;    <span class="comment">// Reached the start of a new vector registers.</span></div>
<div class="line"><a name="l06139"></a><span class="lineno"> 6139</span>&#160;    <span class="keywordflow">if</span> (Idx % EltsPerVector == 0) {</div>
<div class="line"><a name="l06140"></a><span class="lineno"> 6140</span>&#160;      RegMask.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a38c50aa8e3e9588f4f968c2e03a0cee0">assign</a>(EltsPerVector, <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l06141"></a><span class="lineno"> 6141</span>&#160;      AllConsecutive = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06142"></a><span class="lineno"> 6142</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06143"></a><span class="lineno"> 6143</span>&#160;    }</div>
<div class="line"><a name="l06144"></a><span class="lineno"> 6144</span>&#160; </div>
<div class="line"><a name="l06145"></a><span class="lineno"> 6145</span>&#160;    <span class="comment">// Need to exclude undefs from analysis.</span></div>
<div class="line"><a name="l06146"></a><span class="lineno"> 6146</span>&#160;    <span class="keywordflow">if</span> (isa&lt;UndefValue&gt;(V) || <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[Idx] == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l06147"></a><span class="lineno"> 6147</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06148"></a><span class="lineno"> 6148</span>&#160; </div>
<div class="line"><a name="l06149"></a><span class="lineno"> 6149</span>&#160;    <span class="comment">// Check all extracts for a vector register on the target directly</span></div>
<div class="line"><a name="l06150"></a><span class="lineno"> 6150</span>&#160;    <span class="comment">// extract values in order.</span></div>
<div class="line"><a name="l06151"></a><span class="lineno"> 6151</span>&#160;    <span class="keywordtype">unsigned</span> CurrentIdx = *<a class="code" href="SLPVectorizer_8cpp.html#abe11501239b82a4ba1730e12be769bc6">getExtractIndex</a>(cast&lt;Instruction&gt;(V));</div>
<div class="line"><a name="l06152"></a><span class="lineno"> 6152</span>&#160;    <span class="keywordflow">if</span> (!isa&lt;UndefValue&gt;(VL[Idx - 1]) &amp;&amp; <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[Idx - 1] != <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>) {</div>
<div class="line"><a name="l06153"></a><span class="lineno"> 6153</span>&#160;      <span class="keywordtype">unsigned</span> PrevIdx = *<a class="code" href="SLPVectorizer_8cpp.html#abe11501239b82a4ba1730e12be769bc6">getExtractIndex</a>(cast&lt;Instruction&gt;(VL[Idx - 1]));</div>
<div class="line"><a name="l06154"></a><span class="lineno"> 6154</span>&#160;      AllConsecutive &amp;= PrevIdx + 1 == CurrentIdx &amp;&amp;</div>
<div class="line"><a name="l06155"></a><span class="lineno"> 6155</span>&#160;                        CurrentIdx % EltsPerVector == Idx % EltsPerVector;</div>
<div class="line"><a name="l06156"></a><span class="lineno"> 6156</span>&#160;      RegMask[Idx % EltsPerVector] = CurrentIdx % EltsPerVector;</div>
<div class="line"><a name="l06157"></a><span class="lineno"> 6157</span>&#160;    }</div>
<div class="line"><a name="l06158"></a><span class="lineno"> 6158</span>&#160; </div>
<div class="line"><a name="l06159"></a><span class="lineno"> 6159</span>&#160;    <span class="keywordflow">if</span> (AllConsecutive)</div>
<div class="line"><a name="l06160"></a><span class="lineno"> 6160</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06161"></a><span class="lineno"> 6161</span>&#160; </div>
<div class="line"><a name="l06162"></a><span class="lineno"> 6162</span>&#160;    <span class="comment">// Skip all indices, except for the last index per vector block.</span></div>
<div class="line"><a name="l06163"></a><span class="lineno"> 6163</span>&#160;    <span class="keywordflow">if</span> ((Idx + 1) % EltsPerVector != 0 &amp;&amp; Idx + 1 != VL.size())</div>
<div class="line"><a name="l06164"></a><span class="lineno"> 6164</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06165"></a><span class="lineno"> 6165</span>&#160; </div>
<div class="line"><a name="l06166"></a><span class="lineno"> 6166</span>&#160;    <span class="comment">// If we have a series of extracts which are not consecutive and hence</span></div>
<div class="line"><a name="l06167"></a><span class="lineno"> 6167</span>&#160;    <span class="comment">// cannot re-use the source vector register directly, compute the shuffle</span></div>
<div class="line"><a name="l06168"></a><span class="lineno"> 6168</span>&#160;    <span class="comment">// cost to extract the vector with EltsPerVector elements.</span></div>
<div class="line"><a name="l06169"></a><span class="lineno"> 6169</span>&#160;    <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> += <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>.<a class="code" href="classllvm_1_1TargetTransformInfo.html#aa0519f26bcb15c25ac0ff557061fa7af">getShuffleCost</a>(</div>
<div class="line"><a name="l06170"></a><span class="lineno"> 6170</span>&#160;        <a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53eca7beec9815d0197f2d31fac9968e9205b">TargetTransformInfo::SK_PermuteSingleSrc</a>,</div>
<div class="line"><a name="l06171"></a><span class="lineno"> 6171</span>&#160;        <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(VecTy-&gt;<a class="code" href="classllvm_1_1VectorType.html#a12e23c3d619db313388fe11dc76eb23f">getElementType</a>(), EltsPerVector), RegMask);</div>
<div class="line"><a name="l06172"></a><span class="lineno"> 6172</span>&#160;  }</div>
<div class="line"><a name="l06173"></a><span class="lineno"> 6173</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a>;</div>
<div class="line"><a name="l06174"></a><span class="lineno"> 6174</span>&#160;}</div>
<div class="line"><a name="l06175"></a><span class="lineno"> 6175</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l06176"></a><span class="lineno"> 6176</span>&#160;<span class="comment">/// Build shuffle mask for shuffle graph entries and lists of main and alternate</span></div>
<div class="line"><a name="l06177"></a><span class="lineno"> 6177</span>&#160;<span class="comment">/// operations operands.</span></div>
<div class="line"><a name="l06178"></a><span class="lineno"> 6178</span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l06179"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a68f8b6509e5780355450f139ddfe89ec"> 6179</a></span>&#160;<a class="code" href="SLPVectorizer_8cpp.html#a68f8b6509e5780355450f139ddfe89ec">buildShuffleEntryMask</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;unsigned&gt;</a> ReorderIndices,</div>
<div class="line"><a name="l06180"></a><span class="lineno"> 6180</span>&#160;                      <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> ReusesIndices,</div>
<div class="line"><a name="l06181"></a><span class="lineno"> 6181</span>&#160;                      <span class="keyword">const</span> <a class="code" href="classllvm_1_1function__ref.html">function_ref</a>&lt;<span class="keywordtype">bool</span>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *)&gt; IsAltOp,</div>
<div class="line"><a name="l06182"></a><span class="lineno"> 6182</span>&#160;                      <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;int&gt;</a> &amp;<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>,</div>
<div class="line"><a name="l06183"></a><span class="lineno"> 6183</span>&#160;                      <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Value *&gt;</a> *OpScalars = <span class="keyword">nullptr</span>,</div>
<div class="line"><a name="l06184"></a><span class="lineno"> 6184</span>&#160;                      <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Value *&gt;</a> *AltScalars = <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l06185"></a><span class="lineno"> 6185</span>&#160;  <span class="keywordtype">unsigned</span> Sz = VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>();</div>
<div class="line"><a name="l06186"></a><span class="lineno"> 6186</span>&#160;  <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.assign(Sz, <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l06187"></a><span class="lineno"> 6187</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> OrderMask;</div>
<div class="line"><a name="l06188"></a><span class="lineno"> 6188</span>&#160;  <span class="keywordflow">if</span> (!ReorderIndices.<a class="code" href="classllvm_1_1ArrayRef.html#ac835b8735b1b2faec0efdca236e37d94">empty</a>())</div>
<div class="line"><a name="l06189"></a><span class="lineno"> 6189</span>&#160;    <a class="code" href="namespacellvm.html#a6f0917bf2ae18fac81fea6bf7e887115">inversePermutation</a>(ReorderIndices, OrderMask);</div>
<div class="line"><a name="l06190"></a><span class="lineno"> 6190</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; Sz; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l06191"></a><span class="lineno"> 6191</span>&#160;    <span class="keywordtype">unsigned</span> Idx = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l06192"></a><span class="lineno"> 6192</span>&#160;    <span class="keywordflow">if</span> (!ReorderIndices.<a class="code" href="classllvm_1_1ArrayRef.html#ac835b8735b1b2faec0efdca236e37d94">empty</a>())</div>
<div class="line"><a name="l06193"></a><span class="lineno"> 6193</span>&#160;      Idx = OrderMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l06194"></a><span class="lineno"> 6194</span>&#160;    <span class="keyword">auto</span> *OpInst = cast&lt;Instruction&gt;(VL[Idx]);</div>
<div class="line"><a name="l06195"></a><span class="lineno"> 6195</span>&#160;    <span class="keywordflow">if</span> (IsAltOp(OpInst)) {</div>
<div class="line"><a name="l06196"></a><span class="lineno"> 6196</span>&#160;      <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = Sz + Idx;</div>
<div class="line"><a name="l06197"></a><span class="lineno"> 6197</span>&#160;      <span class="keywordflow">if</span> (AltScalars)</div>
<div class="line"><a name="l06198"></a><span class="lineno"> 6198</span>&#160;        AltScalars-&gt;push_back(OpInst);</div>
<div class="line"><a name="l06199"></a><span class="lineno"> 6199</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06200"></a><span class="lineno"> 6200</span>&#160;      <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = Idx;</div>
<div class="line"><a name="l06201"></a><span class="lineno"> 6201</span>&#160;      <span class="keywordflow">if</span> (OpScalars)</div>
<div class="line"><a name="l06202"></a><span class="lineno"> 6202</span>&#160;        OpScalars-&gt;push_back(OpInst);</div>
<div class="line"><a name="l06203"></a><span class="lineno"> 6203</span>&#160;    }</div>
<div class="line"><a name="l06204"></a><span class="lineno"> 6204</span>&#160;  }</div>
<div class="line"><a name="l06205"></a><span class="lineno"> 6205</span>&#160;  <span class="keywordflow">if</span> (!ReusesIndices.<a class="code" href="classllvm_1_1ArrayRef.html#ac835b8735b1b2faec0efdca236e37d94">empty</a>()) {</div>
<div class="line"><a name="l06206"></a><span class="lineno"> 6206</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> NewMask(ReusesIndices.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(), <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l06207"></a><span class="lineno"> 6207</span>&#160;    <a class="code" href="namespacellvm.html#a615619b0b2879029152b9a20e96624bc">transform</a>(ReusesIndices, NewMask.begin(), [&amp;<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>](<span class="keywordtype">int</span> Idx) {</div>
<div class="line"><a name="l06208"></a><span class="lineno"> 6208</span>&#160;      return Idx != UndefMaskElem ? Mask[Idx] : UndefMaskElem;</div>
<div class="line"><a name="l06209"></a><span class="lineno"> 6209</span>&#160;    });</div>
<div class="line"><a name="l06210"></a><span class="lineno"> 6210</span>&#160;    <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.swap(NewMask);</div>
<div class="line"><a name="l06211"></a><span class="lineno"> 6211</span>&#160;  }</div>
<div class="line"><a name="l06212"></a><span class="lineno"> 6212</span>&#160;}</div>
<div class="line"><a name="l06213"></a><span class="lineno"> 6213</span>&#160; </div>
<div class="line"><a name="l06214"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#afb636ad432c97f9178ff3f966e93d819"> 6214</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#afb636ad432c97f9178ff3f966e93d819">isAlternateInstruction</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</div>
<div class="line"><a name="l06215"></a><span class="lineno"> 6215</span>&#160;                                   <span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *MainOp,</div>
<div class="line"><a name="l06216"></a><span class="lineno"> 6216</span>&#160;                                   <span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *AltOp,</div>
<div class="line"><a name="l06217"></a><span class="lineno"> 6217</span>&#160;                                   <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> &amp;TLI) {</div>
<div class="line"><a name="l06218"></a><span class="lineno"> 6218</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *MainCI = dyn_cast&lt;CmpInst&gt;(MainOp)) {</div>
<div class="line"><a name="l06219"></a><span class="lineno"> 6219</span>&#160;    <span class="keyword">auto</span> *AltCI = cast&lt;CmpInst&gt;(AltOp);</div>
<div class="line"><a name="l06220"></a><span class="lineno"> 6220</span>&#160;    <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> MainP = MainCI-&gt;getPredicate();</div>
<div class="line"><a name="l06221"></a><span class="lineno"> 6221</span>&#160;    <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> AltP = AltCI-&gt;getPredicate();</div>
<div class="line"><a name="l06222"></a><span class="lineno"> 6222</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MainP != AltP &amp;&amp; <span class="stringliteral">&quot;Expected different main/alternate predicates.&quot;</span>);</div>
<div class="line"><a name="l06223"></a><span class="lineno"> 6223</span>&#160;    <span class="keyword">auto</span> *CI = cast&lt;CmpInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l06224"></a><span class="lineno"> 6224</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#a807bb3d2ecc2999993a91d499bd26543">isCmpSameOrSwapped</a>(MainCI, CI, TLI))</div>
<div class="line"><a name="l06225"></a><span class="lineno"> 6225</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06226"></a><span class="lineno"> 6226</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#a807bb3d2ecc2999993a91d499bd26543">isCmpSameOrSwapped</a>(AltCI, CI, TLI))</div>
<div class="line"><a name="l06227"></a><span class="lineno"> 6227</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l06228"></a><span class="lineno"> 6228</span>&#160;    <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> = CI-&gt;getPredicate();</div>
<div class="line"><a name="l06229"></a><span class="lineno"> 6229</span>&#160;    <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> SwappedP = <a class="code" href="classllvm_1_1CmpInst.html#a49a2d8f483ea08a3d6ea75f90c640d76">CmpInst::getSwappedPredicate</a>(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>);</div>
<div class="line"><a name="l06230"></a><span class="lineno"> 6230</span>&#160; </div>
<div class="line"><a name="l06231"></a><span class="lineno"> 6231</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((MainP == <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> || AltP == <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> || MainP == SwappedP || AltP == SwappedP) &amp;&amp;</div>
<div class="line"><a name="l06232"></a><span class="lineno"> 6232</span>&#160;           <span class="stringliteral">&quot;CmpInst expected to match either main or alternate predicate or &quot;</span></div>
<div class="line"><a name="l06233"></a><span class="lineno"> 6233</span>&#160;           <span class="stringliteral">&quot;their swap.&quot;</span>);</div>
<div class="line"><a name="l06234"></a><span class="lineno"> 6234</span>&#160;    (void)AltP;</div>
<div class="line"><a name="l06235"></a><span class="lineno"> 6235</span>&#160;    <span class="keywordflow">return</span> MainP != <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> &amp;&amp; MainP != SwappedP;</div>
<div class="line"><a name="l06236"></a><span class="lineno"> 6236</span>&#160;  }</div>
<div class="line"><a name="l06237"></a><span class="lineno"> 6237</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == AltOp-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>();</div>
<div class="line"><a name="l06238"></a><span class="lineno"> 6238</span>&#160;}</div>
<div class="line"><a name="l06239"></a><span class="lineno"> 6239</span>&#160; </div>
<div class="line"><a name="l06240"></a><span class="lineno"> 6240</span>&#160;<a class="code" href="structllvm_1_1TargetTransformInfo_1_1OperandValueInfo.html">TTI::OperandValueInfo</a> BoUpSLP::getOperandInfo(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL,</div>
<div class="line"><a name="l06241"></a><span class="lineno"> 6241</span>&#160;                                              <span class="keywordtype">unsigned</span> OpIdx) {</div>
<div class="line"><a name="l06242"></a><span class="lineno"> 6242</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!VL.<a class="code" href="classllvm_1_1ArrayRef.html#ac835b8735b1b2faec0efdca236e37d94">empty</a>());</div>
<div class="line"><a name="l06243"></a><span class="lineno"> 6243</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> *I0 = cast&lt;Instruction&gt;(*<a class="code" href="namespacellvm.html#ac78c09ae232b2ce188ff590d51e3c268">find_if</a>(VL, <a class="code" href="classllvm_1_1Instruction.html#a644afe0cf8a4816171b3384098325dc2">Instruction::classof</a>));</div>
<div class="line"><a name="l06244"></a><span class="lineno"> 6244</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> *Op0 = I0-&gt;getOperand(OpIdx);</div>
<div class="line"><a name="l06245"></a><span class="lineno"> 6245</span>&#160; </div>
<div class="line"><a name="l06246"></a><span class="lineno"> 6246</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="namespacellvm_1_1codeview.html#adea5cfab927f82e2664c69c86f8f572faffb12d1a144101cc60187107b298897d">IsConstant</a> = <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(VL, [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l06247"></a><span class="lineno"> 6247</span>&#160;    <span class="comment">// TODO: We should allow undef elements here</span></div>
<div class="line"><a name="l06248"></a><span class="lineno"> 6248</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l06249"></a><span class="lineno"> 6249</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l06250"></a><span class="lineno"> 6250</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l06251"></a><span class="lineno"> 6251</span>&#160;    <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(OpIdx);</div>
<div class="line"><a name="l06252"></a><span class="lineno"> 6252</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="SLPVectorizer_8cpp.html#a6848b7e929178610d01e1b2b5052af86">isConstant</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>) &amp;&amp; !isa&lt;UndefValue&gt;(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>);</div>
<div class="line"><a name="l06253"></a><span class="lineno"> 6253</span>&#160;  });</div>
<div class="line"><a name="l06254"></a><span class="lineno"> 6254</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> IsUniform = <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(VL, [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l06255"></a><span class="lineno"> 6255</span>&#160;    <span class="comment">// TODO: We should allow undef elements here</span></div>
<div class="line"><a name="l06256"></a><span class="lineno"> 6256</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l06257"></a><span class="lineno"> 6257</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l06258"></a><span class="lineno"> 6258</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06259"></a><span class="lineno"> 6259</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(OpIdx) == Op0;</div>
<div class="line"><a name="l06260"></a><span class="lineno"> 6260</span>&#160;  });</div>
<div class="line"><a name="l06261"></a><span class="lineno"> 6261</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> IsPowerOfTwo = <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(VL, [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l06262"></a><span class="lineno"> 6262</span>&#160;    <span class="comment">// TODO: We should allow undef elements here</span></div>
<div class="line"><a name="l06263"></a><span class="lineno"> 6263</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l06264"></a><span class="lineno"> 6264</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l06265"></a><span class="lineno"> 6265</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((isa&lt;UndefValue&gt;(V) ||</div>
<div class="line"><a name="l06266"></a><span class="lineno"> 6266</span>&#160;              I0-&gt;getOpcode() == Instruction::GetElementPtr) &amp;&amp;</div>
<div class="line"><a name="l06267"></a><span class="lineno"> 6267</span>&#160;             <span class="stringliteral">&quot;Expected undef or GEP.&quot;</span>);</div>
<div class="line"><a name="l06268"></a><span class="lineno"> 6268</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l06269"></a><span class="lineno"> 6269</span>&#160;    }</div>
<div class="line"><a name="l06270"></a><span class="lineno"> 6270</span>&#160;    <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(OpIdx);</div>
<div class="line"><a name="l06271"></a><span class="lineno"> 6271</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *CI = dyn_cast&lt;ConstantInt&gt;(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>))</div>
<div class="line"><a name="l06272"></a><span class="lineno"> 6272</span>&#160;      <span class="keywordflow">return</span> CI-&gt;getValue().isPowerOf2();</div>
<div class="line"><a name="l06273"></a><span class="lineno"> 6273</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06274"></a><span class="lineno"> 6274</span>&#160;  });</div>
<div class="line"><a name="l06275"></a><span class="lineno"> 6275</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> IsNegatedPowerOfTwo = <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(VL, [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l06276"></a><span class="lineno"> 6276</span>&#160;    <span class="comment">// TODO: We should allow undef elements here</span></div>
<div class="line"><a name="l06277"></a><span class="lineno"> 6277</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l06278"></a><span class="lineno"> 6278</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l06279"></a><span class="lineno"> 6279</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((isa&lt;UndefValue&gt;(V) ||</div>
<div class="line"><a name="l06280"></a><span class="lineno"> 6280</span>&#160;              I0-&gt;getOpcode() == Instruction::GetElementPtr) &amp;&amp;</div>
<div class="line"><a name="l06281"></a><span class="lineno"> 6281</span>&#160;             <span class="stringliteral">&quot;Expected undef or GEP.&quot;</span>);</div>
<div class="line"><a name="l06282"></a><span class="lineno"> 6282</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l06283"></a><span class="lineno"> 6283</span>&#160;    }</div>
<div class="line"><a name="l06284"></a><span class="lineno"> 6284</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(OpIdx);</div>
<div class="line"><a name="l06285"></a><span class="lineno"> 6285</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *CI = dyn_cast&lt;ConstantInt&gt;(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>))</div>
<div class="line"><a name="l06286"></a><span class="lineno"> 6286</span>&#160;      <span class="keywordflow">return</span> CI-&gt;getValue().isNegatedPowerOf2();</div>
<div class="line"><a name="l06287"></a><span class="lineno"> 6287</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06288"></a><span class="lineno"> 6288</span>&#160;  });</div>
<div class="line"><a name="l06289"></a><span class="lineno"> 6289</span>&#160; </div>
<div class="line"><a name="l06290"></a><span class="lineno"> 6290</span>&#160;  <a class="code" href="classllvm_1_1TargetTransformInfo.html#afa38851d75434d1476444ac93f94cb4c">TTI::OperandValueKind</a> VK = <a class="code" href="classllvm_1_1TargetTransformInfo.html#afa38851d75434d1476444ac93f94cb4ca9c0eecea29e9fa58e4dac7ee32b9b2ac">TTI::OK_AnyValue</a>;</div>
<div class="line"><a name="l06291"></a><span class="lineno"> 6291</span>&#160;  <span class="keywordflow">if</span> (IsConstant &amp;&amp; IsUniform)</div>
<div class="line"><a name="l06292"></a><span class="lineno"> 6292</span>&#160;    VK = <a class="code" href="classllvm_1_1TargetTransformInfo.html#afa38851d75434d1476444ac93f94cb4ca76d8855d96b8e66b9411ed74737ca8f7">TTI::OK_UniformConstantValue</a>;</div>
<div class="line"><a name="l06293"></a><span class="lineno"> 6293</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (IsConstant)</div>
<div class="line"><a name="l06294"></a><span class="lineno"> 6294</span>&#160;    VK = <a class="code" href="classllvm_1_1TargetTransformInfo.html#afa38851d75434d1476444ac93f94cb4cacf63326297610dfbedd0ad408b54e3e4">TTI::OK_NonUniformConstantValue</a>;</div>
<div class="line"><a name="l06295"></a><span class="lineno"> 6295</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (IsUniform)</div>
<div class="line"><a name="l06296"></a><span class="lineno"> 6296</span>&#160;    VK = <a class="code" href="classllvm_1_1TargetTransformInfo.html#afa38851d75434d1476444ac93f94cb4ca7aa61d9e9d33bdf28478754c69c59640">TTI::OK_UniformValue</a>;</div>
<div class="line"><a name="l06297"></a><span class="lineno"> 6297</span>&#160; </div>
<div class="line"><a name="l06298"></a><span class="lineno"> 6298</span>&#160;  <a class="code" href="classllvm_1_1TargetTransformInfo.html#a733fb237f3037c95ed59de6055b176c5">TTI::OperandValueProperties</a> VP = <a class="code" href="classllvm_1_1TargetTransformInfo.html#a733fb237f3037c95ed59de6055b176c5a2bc39e3785b29fe7bc4af768842a2072">TTI::OP_None</a>;</div>
<div class="line"><a name="l06299"></a><span class="lineno"> 6299</span>&#160;  VP = IsPowerOfTwo ? <a class="code" href="classllvm_1_1TargetTransformInfo.html#a733fb237f3037c95ed59de6055b176c5a974f46ced0fd416db695ce5da6059dcc">TTI::OP_PowerOf2</a> : VP;</div>
<div class="line"><a name="l06300"></a><span class="lineno"> 6300</span>&#160;  VP = IsNegatedPowerOfTwo ? <a class="code" href="classllvm_1_1TargetTransformInfo.html#a733fb237f3037c95ed59de6055b176c5a19af6b5f4f70eaefcc0b6734f1f06cd8">TTI::OP_NegatedPowerOf2</a> : VP;</div>
<div class="line"><a name="l06301"></a><span class="lineno"> 6301</span>&#160; </div>
<div class="line"><a name="l06302"></a><span class="lineno"> 6302</span>&#160;  <span class="keywordflow">return</span> {VK, VP};</div>
<div class="line"><a name="l06303"></a><span class="lineno"> 6303</span>&#160;}</div>
<div class="line"><a name="l06304"></a><span class="lineno"> 6304</span>&#160; </div>
<div class="line"><a name="l06305"></a><span class="lineno"> 6305</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div>
<div class="line"><a name="l06306"></a><span class="lineno"> 6306</span>&#160;<span class="comment">/// The base class for shuffle instruction emission and shuffle cost estimation.</span></div>
<div class="line"><a name="l06307"></a><span class="lineno"> 6307</span>&#160;<span class="comment"></span><span class="keyword">class </span>BaseShuffleAnalysis {</div>
<div class="line"><a name="l06308"></a><span class="lineno"> 6308</span>&#160;<span class="keyword">protected</span>:<span class="comment"></span></div>
<div class="line"><a name="l06309"></a><span class="lineno"> 6309</span>&#160;<span class="comment">  /// Checks if the mask is an identity mask.</span></div>
<div class="line"><a name="l06310"></a><span class="lineno"> 6310</span>&#160;<span class="comment">  /// \param IsStrict if is true the function returns false if mask size does</span></div>
<div class="line"><a name="l06311"></a><span class="lineno"> 6311</span>&#160;<span class="comment">  /// not match vector size.</span></div>
<div class="line"><a name="l06312"></a><span class="lineno"> 6312</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> <span class="keywordtype">bool</span> isIdentityMask(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1FixedVectorType.html">FixedVectorType</a> *VecTy,</div>
<div class="line"><a name="l06313"></a><span class="lineno"> 6313</span>&#160;                             <span class="keywordtype">bool</span> IsStrict) {</div>
<div class="line"><a name="l06314"></a><span class="lineno"> 6314</span>&#160;    <span class="keywordtype">int</span> Limit = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size();</div>
<div class="line"><a name="l06315"></a><span class="lineno"> 6315</span>&#160;    <span class="keywordtype">int</span> VF = VecTy-&gt;<a class="code" href="classllvm_1_1FixedVectorType.html#a1893caf878859959ba6a3d5442ef1439">getNumElements</a>();</div>
<div class="line"><a name="l06316"></a><span class="lineno"> 6316</span>&#160;    <span class="keywordflow">return</span> (VF == Limit || !IsStrict) &amp;&amp;</div>
<div class="line"><a name="l06317"></a><span class="lineno"> 6317</span>&#160;           <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, [Limit](<span class="keywordtype">int</span> Idx) { <span class="keywordflow">return</span> Idx &lt; Limit; }) &amp;&amp;</div>
<div class="line"><a name="l06318"></a><span class="lineno"> 6318</span>&#160;           <a class="code" href="classllvm_1_1ShuffleVectorInst.html#a4bc8953b0fd0277b0e5a8e5b78025150">ShuffleVectorInst::isIdentityMask</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l06319"></a><span class="lineno"> 6319</span>&#160;  }</div>
<div class="line"><a name="l06320"></a><span class="lineno"> 6320</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l06321"></a><span class="lineno"> 6321</span>&#160;<span class="comment">  /// Tries to combine 2 different masks into single one.</span></div>
<div class="line"><a name="l06322"></a><span class="lineno"> 6322</span>&#160;<span class="comment">  /// \param LocalVF Vector length of the permuted input vector. \p Mask may</span></div>
<div class="line"><a name="l06323"></a><span class="lineno"> 6323</span>&#160;<span class="comment">  /// change the size of the vector, \p LocalVF is the original size of the</span></div>
<div class="line"><a name="l06324"></a><span class="lineno"> 6324</span>&#160;<span class="comment">  /// shuffled vector.</span></div>
<div class="line"><a name="l06325"></a><span class="lineno"> 6325</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> <span class="keywordtype">void</span> combineMasks(<span class="keywordtype">unsigned</span> LocalVF, <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;int&gt;</a> &amp;<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>,</div>
<div class="line"><a name="l06326"></a><span class="lineno"> 6326</span>&#160;                           <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> ExtMask) {</div>
<div class="line"><a name="l06327"></a><span class="lineno"> 6327</span>&#160;    <span class="keywordtype">unsigned</span> VF = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size();</div>
<div class="line"><a name="l06328"></a><span class="lineno"> 6328</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> NewMask(ExtMask.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(), <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l06329"></a><span class="lineno"> 6329</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, Sz = ExtMask.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; Sz; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l06330"></a><span class="lineno"> 6330</span>&#160;      <span class="keywordflow">if</span> (ExtMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l06331"></a><span class="lineno"> 6331</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06332"></a><span class="lineno"> 6332</span>&#160;      <span class="keywordtype">int</span> MaskedIdx = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[ExtMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] % VF];</div>
<div class="line"><a name="l06333"></a><span class="lineno"> 6333</span>&#160;      NewMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] =</div>
<div class="line"><a name="l06334"></a><span class="lineno"> 6334</span>&#160;          MaskedIdx == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a> ? <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a> : MaskedIdx % LocalVF;</div>
<div class="line"><a name="l06335"></a><span class="lineno"> 6335</span>&#160;    }</div>
<div class="line"><a name="l06336"></a><span class="lineno"> 6336</span>&#160;    <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.swap(NewMask);</div>
<div class="line"><a name="l06337"></a><span class="lineno"> 6337</span>&#160;  }</div>
<div class="line"><a name="l06338"></a><span class="lineno"> 6338</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l06339"></a><span class="lineno"> 6339</span>&#160;<span class="comment">  /// Looks through shuffles trying to reduce final number of shuffles in the</span></div>
<div class="line"><a name="l06340"></a><span class="lineno"> 6340</span>&#160;<span class="comment">  /// code. The function looks through the previously emitted shuffle</span></div>
<div class="line"><a name="l06341"></a><span class="lineno"> 6341</span>&#160;<span class="comment">  /// instructions and properly mark indices in mask as undef.</span></div>
<div class="line"><a name="l06342"></a><span class="lineno"> 6342</span>&#160;<span class="comment">  /// For example, given the code</span></div>
<div class="line"><a name="l06343"></a><span class="lineno"> 6343</span>&#160;<span class="comment">  /// \code</span></div>
<div class="line"><a name="l06344"></a><span class="lineno"> 6344</span>&#160;<span class="comment">  /// %s1 = shufflevector &lt;2 x ty&gt; %0, poison, &lt;1, 0&gt;</span></div>
<div class="line"><a name="l06345"></a><span class="lineno"> 6345</span>&#160;<span class="comment">  /// %s2 = shufflevector &lt;2 x ty&gt; %1, poison, &lt;1, 0&gt;</span></div>
<div class="line"><a name="l06346"></a><span class="lineno"> 6346</span>&#160;<span class="comment">  /// \endcode</span></div>
<div class="line"><a name="l06347"></a><span class="lineno"> 6347</span>&#160;<span class="comment">  /// and if need to emit shuffle of %s1 and %s2 with mask &lt;1, 0, 3, 2&gt;, it will</span></div>
<div class="line"><a name="l06348"></a><span class="lineno"> 6348</span>&#160;<span class="comment">  /// look through %s1 and %s2 and select vectors %0 and %1 with mask</span></div>
<div class="line"><a name="l06349"></a><span class="lineno"> 6349</span>&#160;<span class="comment">  /// &lt;0, 1, 2, 3&gt; for the shuffle.</span></div>
<div class="line"><a name="l06350"></a><span class="lineno"> 6350</span>&#160;<span class="comment">  /// If 2 operands are of different size, the smallest one will be resized and</span></div>
<div class="line"><a name="l06351"></a><span class="lineno"> 6351</span>&#160;<span class="comment">  /// the mask recalculated properly.</span></div>
<div class="line"><a name="l06352"></a><span class="lineno"> 6352</span>&#160;<span class="comment">  /// For example, given the code</span></div>
<div class="line"><a name="l06353"></a><span class="lineno"> 6353</span>&#160;<span class="comment">  /// \code</span></div>
<div class="line"><a name="l06354"></a><span class="lineno"> 6354</span>&#160;<span class="comment">  /// %s1 = shufflevector &lt;2 x ty&gt; %0, poison, &lt;1, 0, 1, 0&gt;</span></div>
<div class="line"><a name="l06355"></a><span class="lineno"> 6355</span>&#160;<span class="comment">  /// %s2 = shufflevector &lt;2 x ty&gt; %1, poison, &lt;1, 0, 1, 0&gt;</span></div>
<div class="line"><a name="l06356"></a><span class="lineno"> 6356</span>&#160;<span class="comment">  /// \endcode</span></div>
<div class="line"><a name="l06357"></a><span class="lineno"> 6357</span>&#160;<span class="comment">  /// and if need to emit shuffle of %s1 and %s2 with mask &lt;1, 0, 5, 4&gt;, it will</span></div>
<div class="line"><a name="l06358"></a><span class="lineno"> 6358</span>&#160;<span class="comment">  /// look through %s1 and %s2 and select vectors %0 and %1 with mask</span></div>
<div class="line"><a name="l06359"></a><span class="lineno"> 6359</span>&#160;<span class="comment">  /// &lt;0, 1, 2, 3&gt; for the shuffle.</span></div>
<div class="line"><a name="l06360"></a><span class="lineno"> 6360</span>&#160;<span class="comment">  /// So, it tries to transform permutations to simple vector merge, if</span></div>
<div class="line"><a name="l06361"></a><span class="lineno"> 6361</span>&#160;<span class="comment">  /// possible.</span></div>
<div class="line"><a name="l06362"></a><span class="lineno"> 6362</span>&#160;<span class="comment">  /// \param V The input vector which must be shuffled using the given \p Mask.</span></div>
<div class="line"><a name="l06363"></a><span class="lineno"> 6363</span>&#160;<span class="comment">  /// If the better candidate is found, \p V is set to this best candidate</span></div>
<div class="line"><a name="l06364"></a><span class="lineno"> 6364</span>&#160;<span class="comment">  /// vector.</span></div>
<div class="line"><a name="l06365"></a><span class="lineno"> 6365</span>&#160;<span class="comment">  /// \param Mask The input mask for the shuffle. If the best candidate is found</span></div>
<div class="line"><a name="l06366"></a><span class="lineno"> 6366</span>&#160;<span class="comment">  /// during looking-through-shuffles attempt, it is updated accordingly.</span></div>
<div class="line"><a name="l06367"></a><span class="lineno"> 6367</span>&#160;<span class="comment">  /// \param SinglePermute true if the shuffle operation is originally a</span></div>
<div class="line"><a name="l06368"></a><span class="lineno"> 6368</span>&#160;<span class="comment">  /// single-value-permutation. In this case the look-through-shuffles procedure</span></div>
<div class="line"><a name="l06369"></a><span class="lineno"> 6369</span>&#160;<span class="comment">  /// may look for resizing shuffles as the best candidates.</span></div>
<div class="line"><a name="l06370"></a><span class="lineno"> 6370</span>&#160;<span class="comment">  /// \return true if the shuffle results in the non-resizing identity shuffle</span></div>
<div class="line"><a name="l06371"></a><span class="lineno"> 6371</span>&#160;<span class="comment">  /// (and thus can be ignored), false - otherwise.</span></div>
<div class="line"><a name="l06372"></a><span class="lineno"> 6372</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> <span class="keywordtype">bool</span> peekThroughShuffles(<a class="code" href="classllvm_1_1Value.html">Value</a> *&amp;V, <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;int&gt;</a> &amp;<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>,</div>
<div class="line"><a name="l06373"></a><span class="lineno"> 6373</span>&#160;                                  <span class="keywordtype">bool</span> SinglePermute) {</div>
<div class="line"><a name="l06374"></a><span class="lineno"> 6374</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = V;</div>
<div class="line"><a name="l06375"></a><span class="lineno"> 6375</span>&#160;    <a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a> *IdentityOp = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06376"></a><span class="lineno"> 6376</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> IdentityMask;</div>
<div class="line"><a name="l06377"></a><span class="lineno"> 6377</span>&#160;    <span class="keywordflow">while</span> (<span class="keyword">auto</span> *SV = dyn_cast&lt;ShuffleVectorInst&gt;(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>)) {</div>
<div class="line"><a name="l06378"></a><span class="lineno"> 6378</span>&#160;      <span class="comment">// Exit if not a fixed vector type or changing size shuffle.</span></div>
<div class="line"><a name="l06379"></a><span class="lineno"> 6379</span>&#160;      <span class="keyword">auto</span> *SVTy = dyn_cast&lt;FixedVectorType&gt;(SV-&gt;getType());</div>
<div class="line"><a name="l06380"></a><span class="lineno"> 6380</span>&#160;      <span class="keywordflow">if</span> (!SVTy)</div>
<div class="line"><a name="l06381"></a><span class="lineno"> 6381</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06382"></a><span class="lineno"> 6382</span>&#160;      <span class="comment">// Remember the identity or broadcast mask, if it is not a resizing</span></div>
<div class="line"><a name="l06383"></a><span class="lineno"> 6383</span>&#160;      <span class="comment">// shuffle. If no better candidates are found, this Op and Mask will be</span></div>
<div class="line"><a name="l06384"></a><span class="lineno"> 6384</span>&#160;      <span class="comment">// used in the final shuffle.</span></div>
<div class="line"><a name="l06385"></a><span class="lineno"> 6385</span>&#160;      <span class="keywordflow">if</span> (isIdentityMask(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, SVTy, <span class="comment">/*IsStrict=*/</span><span class="keyword">false</span>)) {</div>
<div class="line"><a name="l06386"></a><span class="lineno"> 6386</span>&#160;        <span class="keywordflow">if</span> (!IdentityOp || !SinglePermute ||</div>
<div class="line"><a name="l06387"></a><span class="lineno"> 6387</span>&#160;            (isIdentityMask(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, SVTy, <span class="comment">/*IsStrict=*/</span><span class="keyword">true</span>) &amp;&amp;</div>
<div class="line"><a name="l06388"></a><span class="lineno"> 6388</span>&#160;             !<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a8f1924af1a6e8747ad3ca08f60b74fcb">ShuffleVectorInst::isZeroEltSplatMask</a>(IdentityMask))) {</div>
<div class="line"><a name="l06389"></a><span class="lineno"> 6389</span>&#160;          IdentityOp = SV;</div>
<div class="line"><a name="l06390"></a><span class="lineno"> 6390</span>&#160;          <span class="comment">// Store current mask in the IdentityMask so later we did not lost</span></div>
<div class="line"><a name="l06391"></a><span class="lineno"> 6391</span>&#160;          <span class="comment">// this info if IdentityOp is selected as the best candidate for the</span></div>
<div class="line"><a name="l06392"></a><span class="lineno"> 6392</span>&#160;          <span class="comment">// permutation.</span></div>
<div class="line"><a name="l06393"></a><span class="lineno"> 6393</span>&#160;          IdentityMask.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a38c50aa8e3e9588f4f968c2e03a0cee0">assign</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l06394"></a><span class="lineno"> 6394</span>&#160;        }</div>
<div class="line"><a name="l06395"></a><span class="lineno"> 6395</span>&#160;      }</div>
<div class="line"><a name="l06396"></a><span class="lineno"> 6396</span>&#160;      <span class="comment">// Remember the broadcast mask. If no better candidates are found, this Op</span></div>
<div class="line"><a name="l06397"></a><span class="lineno"> 6397</span>&#160;      <span class="comment">// and Mask will be used in the final shuffle.</span></div>
<div class="line"><a name="l06398"></a><span class="lineno"> 6398</span>&#160;      <span class="comment">// Zero splat can be used as identity too, since it might be used with</span></div>
<div class="line"><a name="l06399"></a><span class="lineno"> 6399</span>&#160;      <span class="comment">// mask &lt;0, 1, 2, ...&gt;, i.e. identity mask without extra reshuffling.</span></div>
<div class="line"><a name="l06400"></a><span class="lineno"> 6400</span>&#160;      <span class="comment">// E.g. if need to shuffle the vector with the mask &lt;3, 1, 2, 0&gt;, which is</span></div>
<div class="line"><a name="l06401"></a><span class="lineno"> 6401</span>&#160;      <span class="comment">// expensive, the analysis founds out, that the source vector is just a</span></div>
<div class="line"><a name="l06402"></a><span class="lineno"> 6402</span>&#160;      <span class="comment">// broadcast, this original mask can be transformed to identity mask &lt;0,</span></div>
<div class="line"><a name="l06403"></a><span class="lineno"> 6403</span>&#160;      <span class="comment">// 1, 2, 3&gt;.</span></div>
<div class="line"><a name="l06404"></a><span class="lineno"> 6404</span>&#160;      <span class="comment">// \code</span></div>
<div class="line"><a name="l06405"></a><span class="lineno"> 6405</span>&#160;      <span class="comment">// %0 = shuffle %v, poison, zeroinitalizer</span></div>
<div class="line"><a name="l06406"></a><span class="lineno"> 6406</span>&#160;      <span class="comment">// %res = shuffle %0, poison, &lt;3, 1, 2, 0&gt;</span></div>
<div class="line"><a name="l06407"></a><span class="lineno"> 6407</span>&#160;      <span class="comment">// \endcode</span></div>
<div class="line"><a name="l06408"></a><span class="lineno"> 6408</span>&#160;      <span class="comment">// may be transformed to</span></div>
<div class="line"><a name="l06409"></a><span class="lineno"> 6409</span>&#160;      <span class="comment">// \code</span></div>
<div class="line"><a name="l06410"></a><span class="lineno"> 6410</span>&#160;      <span class="comment">// %0 = shuffle %v, poison, zeroinitalizer</span></div>
<div class="line"><a name="l06411"></a><span class="lineno"> 6411</span>&#160;      <span class="comment">// %res = shuffle %0, poison, &lt;0, 1, 2, 3&gt;</span></div>
<div class="line"><a name="l06412"></a><span class="lineno"> 6412</span>&#160;      <span class="comment">// \endcode</span></div>
<div class="line"><a name="l06413"></a><span class="lineno"> 6413</span>&#160;      <span class="keywordflow">if</span> (SV-&gt;isZeroEltSplat()) {</div>
<div class="line"><a name="l06414"></a><span class="lineno"> 6414</span>&#160;        IdentityOp = SV;</div>
<div class="line"><a name="l06415"></a><span class="lineno"> 6415</span>&#160;        IdentityMask.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a38c50aa8e3e9588f4f968c2e03a0cee0">assign</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l06416"></a><span class="lineno"> 6416</span>&#160;      }</div>
<div class="line"><a name="l06417"></a><span class="lineno"> 6417</span>&#160;      <span class="keywordtype">int</span> LocalVF = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size();</div>
<div class="line"><a name="l06418"></a><span class="lineno"> 6418</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *SVOpTy =</div>
<div class="line"><a name="l06419"></a><span class="lineno"> 6419</span>&#160;              dyn_cast&lt;FixedVectorType&gt;(SV-&gt;getOperand(0)-&gt;getType()))</div>
<div class="line"><a name="l06420"></a><span class="lineno"> 6420</span>&#160;        LocalVF = SVOpTy-&gt;getNumElements();</div>
<div class="line"><a name="l06421"></a><span class="lineno"> 6421</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> ExtMask(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size(), <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l06422"></a><span class="lineno"> 6422</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> [Idx, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] : <a class="code" href="namespacellvm.html#a7b2175e18ff52174fad26b6b68818564">enumerate</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>)) {</div>
<div class="line"><a name="l06423"></a><span class="lineno"> 6423</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l06424"></a><span class="lineno"> 6424</span>&#160;           <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06425"></a><span class="lineno"> 6425</span>&#160;         ExtMask[Idx] = SV-&gt;getMaskValue(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l06426"></a><span class="lineno"> 6426</span>&#160;      }</div>
<div class="line"><a name="l06427"></a><span class="lineno"> 6427</span>&#160;      <span class="keywordtype">bool</span> IsOp1Undef =</div>
<div class="line"><a name="l06428"></a><span class="lineno"> 6428</span>&#160;          <a class="code" href="SLPVectorizer_8cpp.html#ac396bb87eb4db1dd3ce315e4d91ee2de">isUndefVector</a>(SV-&gt;getOperand(0),</div>
<div class="line"><a name="l06429"></a><span class="lineno"> 6429</span>&#160;                        <a class="code" href="SLPVectorizer_8cpp.html#a2fd40bb67aec98438b791520159fb146">buildUseMask</a>(LocalVF, ExtMask, UseMask::FirstArg))</div>
<div class="line"><a name="l06430"></a><span class="lineno"> 6430</span>&#160;              .<a class="code" href="classllvm_1_1SmallBitVector.html#a8cfcd92a373cdd7deefb939dd76b83e3">all</a>();</div>
<div class="line"><a name="l06431"></a><span class="lineno"> 6431</span>&#160;      <span class="keywordtype">bool</span> IsOp2Undef =</div>
<div class="line"><a name="l06432"></a><span class="lineno"> 6432</span>&#160;          <a class="code" href="SLPVectorizer_8cpp.html#ac396bb87eb4db1dd3ce315e4d91ee2de">isUndefVector</a>(SV-&gt;getOperand(1),</div>
<div class="line"><a name="l06433"></a><span class="lineno"> 6433</span>&#160;                        <a class="code" href="SLPVectorizer_8cpp.html#a2fd40bb67aec98438b791520159fb146">buildUseMask</a>(LocalVF, ExtMask, UseMask::SecondArg))</div>
<div class="line"><a name="l06434"></a><span class="lineno"> 6434</span>&#160;              .<a class="code" href="classllvm_1_1SmallBitVector.html#a8cfcd92a373cdd7deefb939dd76b83e3">all</a>();</div>
<div class="line"><a name="l06435"></a><span class="lineno"> 6435</span>&#160;      <span class="keywordflow">if</span> (!IsOp1Undef &amp;&amp; !IsOp2Undef) {</div>
<div class="line"><a name="l06436"></a><span class="lineno"> 6436</span>&#160;        <span class="comment">// Update mask and mark undef elems.</span></div>
<div class="line"><a name="l06437"></a><span class="lineno"> 6437</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>) {</div>
<div class="line"><a name="l06438"></a><span class="lineno"> 6438</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l06439"></a><span class="lineno"> 6439</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06440"></a><span class="lineno"> 6440</span>&#160;          <span class="keywordflow">if</span> (SV-&gt;getMaskValue(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> % SV-&gt;getShuffleMask().size()) ==</div>
<div class="line"><a name="l06441"></a><span class="lineno"> 6441</span>&#160;              <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l06442"></a><span class="lineno"> 6442</span>&#160;            <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>;</div>
<div class="line"><a name="l06443"></a><span class="lineno"> 6443</span>&#160;        }</div>
<div class="line"><a name="l06444"></a><span class="lineno"> 6444</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06445"></a><span class="lineno"> 6445</span>&#160;      }</div>
<div class="line"><a name="l06446"></a><span class="lineno"> 6446</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> ShuffleMask(SV-&gt;getShuffleMask().begin(),</div>
<div class="line"><a name="l06447"></a><span class="lineno"> 6447</span>&#160;                                   SV-&gt;getShuffleMask().end());</div>
<div class="line"><a name="l06448"></a><span class="lineno"> 6448</span>&#160;      combineMasks(LocalVF, ShuffleMask, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l06449"></a><span class="lineno"> 6449</span>&#160;      <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.swap(ShuffleMask);</div>
<div class="line"><a name="l06450"></a><span class="lineno"> 6450</span>&#160;      <span class="keywordflow">if</span> (IsOp2Undef)</div>
<div class="line"><a name="l06451"></a><span class="lineno"> 6451</span>&#160;        <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = SV-&gt;getOperand(0);</div>
<div class="line"><a name="l06452"></a><span class="lineno"> 6452</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l06453"></a><span class="lineno"> 6453</span>&#160;        <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = SV-&gt;getOperand(1);</div>
<div class="line"><a name="l06454"></a><span class="lineno"> 6454</span>&#160;    }</div>
<div class="line"><a name="l06455"></a><span class="lineno"> 6455</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *OpTy = dyn_cast&lt;FixedVectorType&gt;(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>-&gt;getType());</div>
<div class="line"><a name="l06456"></a><span class="lineno"> 6456</span>&#160;        !OpTy || !isIdentityMask(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, OpTy, SinglePermute)) {</div>
<div class="line"><a name="l06457"></a><span class="lineno"> 6457</span>&#160;      <span class="keywordflow">if</span> (IdentityOp) {</div>
<div class="line"><a name="l06458"></a><span class="lineno"> 6458</span>&#160;        V = IdentityOp;</div>
<div class="line"><a name="l06459"></a><span class="lineno"> 6459</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size() == IdentityMask.size() &amp;&amp;</div>
<div class="line"><a name="l06460"></a><span class="lineno"> 6460</span>&#160;               <span class="stringliteral">&quot;Expected masks of same sizes.&quot;</span>);</div>
<div class="line"><a name="l06461"></a><span class="lineno"> 6461</span>&#160;        <span class="comment">// Clear known poison elements.</span></div>
<div class="line"><a name="l06462"></a><span class="lineno"> 6462</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> [<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Idx] : <a class="code" href="namespacellvm.html#a7b2175e18ff52174fad26b6b68818564">enumerate</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>))</div>
<div class="line"><a name="l06463"></a><span class="lineno"> 6463</span>&#160;          <span class="keywordflow">if</span> (Idx == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l06464"></a><span class="lineno"> 6464</span>&#160;            IdentityMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>;</div>
<div class="line"><a name="l06465"></a><span class="lineno"> 6465</span>&#160;        <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.swap(IdentityMask);</div>
<div class="line"><a name="l06466"></a><span class="lineno"> 6466</span>&#160;        <span class="keyword">auto</span> *<a class="code" href="namespacellvm.html#a766456df1dd21e804cd4596304e10764ae8b4b40ec3622e371789b790caabc083">Shuffle</a> = dyn_cast&lt;ShuffleVectorInst&gt;(V);</div>
<div class="line"><a name="l06467"></a><span class="lineno"> 6467</span>&#160;        <span class="keywordflow">return</span> SinglePermute &amp;&amp;</div>
<div class="line"><a name="l06468"></a><span class="lineno"> 6468</span>&#160;               (isIdentityMask(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, cast&lt;FixedVectorType&gt;(V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()),</div>
<div class="line"><a name="l06469"></a><span class="lineno"> 6469</span>&#160;                               <span class="comment">/*IsStrict=*/</span><span class="keyword">true</span>) ||</div>
<div class="line"><a name="l06470"></a><span class="lineno"> 6470</span>&#160;                (<a class="code" href="namespacellvm.html#a766456df1dd21e804cd4596304e10764ae8b4b40ec3622e371789b790caabc083">Shuffle</a> &amp;&amp; <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size() == <a class="code" href="namespacellvm.html#a766456df1dd21e804cd4596304e10764ae8b4b40ec3622e371789b790caabc083">Shuffle</a>-&gt;getShuffleMask().size() &amp;&amp;</div>
<div class="line"><a name="l06471"></a><span class="lineno"> 6471</span>&#160;                 <a class="code" href="namespacellvm.html#a766456df1dd21e804cd4596304e10764ae8b4b40ec3622e371789b790caabc083">Shuffle</a>-&gt;isZeroEltSplat() &amp;&amp;</div>
<div class="line"><a name="l06472"></a><span class="lineno"> 6472</span>&#160;                 <a class="code" href="classllvm_1_1ShuffleVectorInst.html#a8f1924af1a6e8747ad3ca08f60b74fcb">ShuffleVectorInst::isZeroEltSplatMask</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>)));</div>
<div class="line"><a name="l06473"></a><span class="lineno"> 6473</span>&#160;      }</div>
<div class="line"><a name="l06474"></a><span class="lineno"> 6474</span>&#160;      V = <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>;</div>
<div class="line"><a name="l06475"></a><span class="lineno"> 6475</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l06476"></a><span class="lineno"> 6476</span>&#160;    }</div>
<div class="line"><a name="l06477"></a><span class="lineno"> 6477</span>&#160;    V = <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>;</div>
<div class="line"><a name="l06478"></a><span class="lineno"> 6478</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l06479"></a><span class="lineno"> 6479</span>&#160;  }</div>
<div class="line"><a name="l06480"></a><span class="lineno"> 6480</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l06481"></a><span class="lineno"> 6481</span>&#160;<span class="comment">  /// Smart shuffle instruction emission, walks through shuffles trees and</span></div>
<div class="line"><a name="l06482"></a><span class="lineno"> 6482</span>&#160;<span class="comment">  /// tries to find the best matching vector for the actual shuffle</span></div>
<div class="line"><a name="l06483"></a><span class="lineno"> 6483</span>&#160;<span class="comment">  /// instruction.</span></div>
<div class="line"><a name="l06484"></a><span class="lineno"> 6484</span>&#160;<span class="comment"></span>  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> ShuffleBuilderTy&gt;</div>
<div class="line"><a name="l06485"></a><span class="lineno"> 6485</span>&#160;  <span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *createShuffle(<a class="code" href="classllvm_1_1Value.html">Value</a> *V1, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>,</div>
<div class="line"><a name="l06486"></a><span class="lineno"> 6486</span>&#160;                              ShuffleBuilderTy &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>) {</div>
<div class="line"><a name="l06487"></a><span class="lineno"> 6487</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(V1 &amp;&amp; <span class="stringliteral">&quot;Expected at least one vector value.&quot;</span>);</div>
<div class="line"><a name="l06488"></a><span class="lineno"> 6488</span>&#160;    <span class="keywordtype">int</span> VF = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size();</div>
<div class="line"><a name="l06489"></a><span class="lineno"> 6489</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *FTy = dyn_cast&lt;FixedVectorType&gt;(V1-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()))</div>
<div class="line"><a name="l06490"></a><span class="lineno"> 6490</span>&#160;      VF = FTy-&gt;getNumElements();</div>
<div class="line"><a name="l06491"></a><span class="lineno"> 6491</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a> &amp;&amp;</div>
<div class="line"><a name="l06492"></a><span class="lineno"> 6492</span>&#160;        !<a class="code" href="SLPVectorizer_8cpp.html#ac396bb87eb4db1dd3ce315e4d91ee2de">isUndefVector</a>(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>, <a class="code" href="SLPVectorizer_8cpp.html#a2fd40bb67aec98438b791520159fb146">buildUseMask</a>(VF, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, UseMask::SecondArg)).<a class="code" href="namespacellvm_1_1LegalityPredicates.html#ad7ac7032baa62cc00002886633b9f281">all</a>()) {</div>
<div class="line"><a name="l06493"></a><span class="lineno"> 6493</span>&#160;      <span class="comment">// Peek through shuffles.</span></div>
<div class="line"><a name="l06494"></a><span class="lineno"> 6494</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Op1 = V1;</div>
<div class="line"><a name="l06495"></a><span class="lineno"> 6495</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Op2 = <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>;</div>
<div class="line"><a name="l06496"></a><span class="lineno"> 6496</span>&#160;      <span class="keywordtype">int</span> VF =</div>
<div class="line"><a name="l06497"></a><span class="lineno"> 6497</span>&#160;          cast&lt;VectorType&gt;(V1-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getElementCount().getKnownMinValue();</div>
<div class="line"><a name="l06498"></a><span class="lineno"> 6498</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> CombinedMask1(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size(), <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l06499"></a><span class="lineno"> 6499</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> CombinedMask2(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size(), <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l06500"></a><span class="lineno"> 6500</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l06501"></a><span class="lineno"> 6501</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] &lt; VF)</div>
<div class="line"><a name="l06502"></a><span class="lineno"> 6502</span>&#160;          CombinedMask1[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l06503"></a><span class="lineno"> 6503</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l06504"></a><span class="lineno"> 6504</span>&#160;          CombinedMask2[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] - VF;</div>
<div class="line"><a name="l06505"></a><span class="lineno"> 6505</span>&#160;      }</div>
<div class="line"><a name="l06506"></a><span class="lineno"> 6506</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *PrevOp1;</div>
<div class="line"><a name="l06507"></a><span class="lineno"> 6507</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *PrevOp2;</div>
<div class="line"><a name="l06508"></a><span class="lineno"> 6508</span>&#160;      <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l06509"></a><span class="lineno"> 6509</span>&#160;        PrevOp1 = Op1;</div>
<div class="line"><a name="l06510"></a><span class="lineno"> 6510</span>&#160;        PrevOp2 = Op2;</div>
<div class="line"><a name="l06511"></a><span class="lineno"> 6511</span>&#160;        (void)peekThroughShuffles(Op1, CombinedMask1, <span class="comment">/*SinglePermute=*/</span><span class="keyword">false</span>);</div>
<div class="line"><a name="l06512"></a><span class="lineno"> 6512</span>&#160;        (void)peekThroughShuffles(Op2, CombinedMask2, <span class="comment">/*SinglePermute=*/</span><span class="keyword">false</span>);</div>
<div class="line"><a name="l06513"></a><span class="lineno"> 6513</span>&#160;        <span class="comment">// Check if we have 2 resizing shuffles - need to peek through operands</span></div>
<div class="line"><a name="l06514"></a><span class="lineno"> 6514</span>&#160;        <span class="comment">// again.</span></div>
<div class="line"><a name="l06515"></a><span class="lineno"> 6515</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *SV1 = dyn_cast&lt;ShuffleVectorInst&gt;(Op1))</div>
<div class="line"><a name="l06516"></a><span class="lineno"> 6516</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">auto</span> *SV2 = dyn_cast&lt;ShuffleVectorInst&gt;(Op2)) {</div>
<div class="line"><a name="l06517"></a><span class="lineno"> 6517</span>&#160;            <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> ExtMask1(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size(), <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l06518"></a><span class="lineno"> 6518</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">auto</span> [Idx, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] : <a class="code" href="namespacellvm.html#a7b2175e18ff52174fad26b6b68818564">enumerate</a>(CombinedMask1)) {</div>
<div class="line"><a name="l06519"></a><span class="lineno"> 6519</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l06520"></a><span class="lineno"> 6520</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06521"></a><span class="lineno"> 6521</span>&#160;                ExtMask1[Idx] = SV1-&gt;getMaskValue(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l06522"></a><span class="lineno"> 6522</span>&#160;            }</div>
<div class="line"><a name="l06523"></a><span class="lineno"> 6523</span>&#160;            <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> UseMask1 = <a class="code" href="SLPVectorizer_8cpp.html#a2fd40bb67aec98438b791520159fb146">buildUseMask</a>(</div>
<div class="line"><a name="l06524"></a><span class="lineno"> 6524</span>&#160;                cast&lt;FixedVectorType&gt;(SV1-&gt;getOperand(1)-&gt;getType())</div>
<div class="line"><a name="l06525"></a><span class="lineno"> 6525</span>&#160;                    -&gt;getNumElements(),</div>
<div class="line"><a name="l06526"></a><span class="lineno"> 6526</span>&#160;                ExtMask1, UseMask::SecondArg);</div>
<div class="line"><a name="l06527"></a><span class="lineno"> 6527</span>&#160;            <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> ExtMask2(CombinedMask2.size(), <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l06528"></a><span class="lineno"> 6528</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">auto</span> [Idx, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] : <a class="code" href="namespacellvm.html#a7b2175e18ff52174fad26b6b68818564">enumerate</a>(CombinedMask2)) {</div>
<div class="line"><a name="l06529"></a><span class="lineno"> 6529</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l06530"></a><span class="lineno"> 6530</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06531"></a><span class="lineno"> 6531</span>&#160;                ExtMask2[Idx] = SV2-&gt;getMaskValue(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l06532"></a><span class="lineno"> 6532</span>&#160;            }</div>
<div class="line"><a name="l06533"></a><span class="lineno"> 6533</span>&#160;            <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> UseMask2 = <a class="code" href="SLPVectorizer_8cpp.html#a2fd40bb67aec98438b791520159fb146">buildUseMask</a>(</div>
<div class="line"><a name="l06534"></a><span class="lineno"> 6534</span>&#160;                cast&lt;FixedVectorType&gt;(SV2-&gt;getOperand(1)-&gt;getType())</div>
<div class="line"><a name="l06535"></a><span class="lineno"> 6535</span>&#160;                    -&gt;getNumElements(),</div>
<div class="line"><a name="l06536"></a><span class="lineno"> 6536</span>&#160;                ExtMask2, UseMask::SecondArg);</div>
<div class="line"><a name="l06537"></a><span class="lineno"> 6537</span>&#160;            <span class="keywordflow">if</span> (SV1-&gt;getOperand(0)-&gt;getType() ==</div>
<div class="line"><a name="l06538"></a><span class="lineno"> 6538</span>&#160;                    SV2-&gt;getOperand(0)-&gt;getType() &amp;&amp;</div>
<div class="line"><a name="l06539"></a><span class="lineno"> 6539</span>&#160;                SV1-&gt;getOperand(0)-&gt;getType() != SV1-&gt;getType() &amp;&amp;</div>
<div class="line"><a name="l06540"></a><span class="lineno"> 6540</span>&#160;                <a class="code" href="SLPVectorizer_8cpp.html#ac396bb87eb4db1dd3ce315e4d91ee2de">isUndefVector</a>(SV1-&gt;getOperand(1), UseMask1).<a class="code" href="classllvm_1_1SmallBitVector.html#a8cfcd92a373cdd7deefb939dd76b83e3">all</a>() &amp;&amp;</div>
<div class="line"><a name="l06541"></a><span class="lineno"> 6541</span>&#160;                <a class="code" href="SLPVectorizer_8cpp.html#ac396bb87eb4db1dd3ce315e4d91ee2de">isUndefVector</a>(SV2-&gt;getOperand(1), UseMask2).<a class="code" href="classllvm_1_1SmallBitVector.html#a8cfcd92a373cdd7deefb939dd76b83e3">all</a>()) {</div>
<div class="line"><a name="l06542"></a><span class="lineno"> 6542</span>&#160;              Op1 = SV1-&gt;getOperand(0);</div>
<div class="line"><a name="l06543"></a><span class="lineno"> 6543</span>&#160;              Op2 = SV2-&gt;getOperand(0);</div>
<div class="line"><a name="l06544"></a><span class="lineno"> 6544</span>&#160;              <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> ShuffleMask1(SV1-&gt;getShuffleMask().begin(),</div>
<div class="line"><a name="l06545"></a><span class="lineno"> 6545</span>&#160;                                            SV1-&gt;getShuffleMask().end());</div>
<div class="line"><a name="l06546"></a><span class="lineno"> 6546</span>&#160;              <span class="keywordtype">int</span> LocalVF = ShuffleMask1.size();</div>
<div class="line"><a name="l06547"></a><span class="lineno"> 6547</span>&#160;              <span class="keywordflow">if</span> (<span class="keyword">auto</span> *FTy = dyn_cast&lt;FixedVectorType&gt;(Op1-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()))</div>
<div class="line"><a name="l06548"></a><span class="lineno"> 6548</span>&#160;                LocalVF = FTy-&gt;getNumElements();</div>
<div class="line"><a name="l06549"></a><span class="lineno"> 6549</span>&#160;              combineMasks(LocalVF, ShuffleMask1, CombinedMask1);</div>
<div class="line"><a name="l06550"></a><span class="lineno"> 6550</span>&#160;              CombinedMask1.swap(ShuffleMask1);</div>
<div class="line"><a name="l06551"></a><span class="lineno"> 6551</span>&#160;              <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> ShuffleMask2(SV2-&gt;getShuffleMask().begin(),</div>
<div class="line"><a name="l06552"></a><span class="lineno"> 6552</span>&#160;                                            SV2-&gt;getShuffleMask().end());</div>
<div class="line"><a name="l06553"></a><span class="lineno"> 6553</span>&#160;              LocalVF = ShuffleMask2.size();</div>
<div class="line"><a name="l06554"></a><span class="lineno"> 6554</span>&#160;              <span class="keywordflow">if</span> (<span class="keyword">auto</span> *FTy = dyn_cast&lt;FixedVectorType&gt;(Op2-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()))</div>
<div class="line"><a name="l06555"></a><span class="lineno"> 6555</span>&#160;                LocalVF = FTy-&gt;getNumElements();</div>
<div class="line"><a name="l06556"></a><span class="lineno"> 6556</span>&#160;              combineMasks(LocalVF, ShuffleMask2, CombinedMask2);</div>
<div class="line"><a name="l06557"></a><span class="lineno"> 6557</span>&#160;              CombinedMask2.swap(ShuffleMask2);</div>
<div class="line"><a name="l06558"></a><span class="lineno"> 6558</span>&#160;            }</div>
<div class="line"><a name="l06559"></a><span class="lineno"> 6559</span>&#160;          }</div>
<div class="line"><a name="l06560"></a><span class="lineno"> 6560</span>&#160;      } <span class="keywordflow">while</span> (PrevOp1 != Op1 || PrevOp2 != Op2);</div>
<div class="line"><a name="l06561"></a><span class="lineno"> 6561</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.resizeToMatch(Op1, Op2);</div>
<div class="line"><a name="l06562"></a><span class="lineno"> 6562</span>&#160;      VF = <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(cast&lt;VectorType&gt;(Op1-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())</div>
<div class="line"><a name="l06563"></a><span class="lineno"> 6563</span>&#160;                        -&gt;getElementCount()</div>
<div class="line"><a name="l06564"></a><span class="lineno"> 6564</span>&#160;                        .getKnownMinValue(),</div>
<div class="line"><a name="l06565"></a><span class="lineno"> 6565</span>&#160;                    cast&lt;VectorType&gt;(Op2-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())</div>
<div class="line"><a name="l06566"></a><span class="lineno"> 6566</span>&#160;                        -&gt;getElementCount()</div>
<div class="line"><a name="l06567"></a><span class="lineno"> 6567</span>&#160;                        .getKnownMinValue());</div>
<div class="line"><a name="l06568"></a><span class="lineno"> 6568</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l06569"></a><span class="lineno"> 6569</span>&#160;        <span class="keywordflow">if</span> (CombinedMask2[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] != <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>) {</div>
<div class="line"><a name="l06570"></a><span class="lineno"> 6570</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CombinedMask1[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a> &amp;&amp;</div>
<div class="line"><a name="l06571"></a><span class="lineno"> 6571</span>&#160;                 <span class="stringliteral">&quot;Expected undefined mask element&quot;</span>);</div>
<div class="line"><a name="l06572"></a><span class="lineno"> 6572</span>&#160;          CombinedMask1[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = CombinedMask2[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] + (Op1 == Op2 ? 0 : VF);</div>
<div class="line"><a name="l06573"></a><span class="lineno"> 6573</span>&#160;        }</div>
<div class="line"><a name="l06574"></a><span class="lineno"> 6574</span>&#160;      }</div>
<div class="line"><a name="l06575"></a><span class="lineno"> 6575</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.createShuffleVector(</div>
<div class="line"><a name="l06576"></a><span class="lineno"> 6576</span>&#160;          Op1, Op1 == Op2 ? <a class="code" href="classllvm_1_1PoisonValue.html#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(Op1-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()) : Op2,</div>
<div class="line"><a name="l06577"></a><span class="lineno"> 6577</span>&#160;          CombinedMask1);</div>
<div class="line"><a name="l06578"></a><span class="lineno"> 6578</span>&#160;    }</div>
<div class="line"><a name="l06579"></a><span class="lineno"> 6579</span>&#160;    <span class="keywordflow">if</span> (isa&lt;PoisonValue&gt;(V1))</div>
<div class="line"><a name="l06580"></a><span class="lineno"> 6580</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1PoisonValue.html#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(<a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(</div>
<div class="line"><a name="l06581"></a><span class="lineno"> 6581</span>&#160;          cast&lt;VectorType&gt;(V1-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getElementType(), <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size()));</div>
<div class="line"><a name="l06582"></a><span class="lineno"> 6582</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> NewMask(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.begin(), <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.end());</div>
<div class="line"><a name="l06583"></a><span class="lineno"> 6583</span>&#160;    <span class="keywordtype">bool</span> IsIdentity = peekThroughShuffles(V1, NewMask, <span class="comment">/*SinglePermute=*/</span><span class="keyword">true</span>);</div>
<div class="line"><a name="l06584"></a><span class="lineno"> 6584</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(V1 &amp;&amp; <span class="stringliteral">&quot;Expected non-null value after looking through shuffles.&quot;</span>);</div>
<div class="line"><a name="l06585"></a><span class="lineno"> 6585</span>&#160; </div>
<div class="line"><a name="l06586"></a><span class="lineno"> 6586</span>&#160;    <span class="keywordflow">if</span> (!IsIdentity)</div>
<div class="line"><a name="l06587"></a><span class="lineno"> 6587</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.createShuffleVector(V1, NewMask);</div>
<div class="line"><a name="l06588"></a><span class="lineno"> 6588</span>&#160;    <span class="keywordflow">return</span> V1;</div>
<div class="line"><a name="l06589"></a><span class="lineno"> 6589</span>&#160;  }</div>
<div class="line"><a name="l06590"></a><span class="lineno"> 6590</span>&#160;};</div>
<div class="line"><a name="l06591"></a><span class="lineno"> 6591</span>&#160;} <span class="comment">// namespace</span></div>
<div class="line"><a name="l06592"></a><span class="lineno"> 6592</span>&#160; </div>
<div class="line"><a name="l06593"></a><span class="lineno"> 6593</span>&#160;<a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> BoUpSLP::getEntryCost(<span class="keyword">const</span> TreeEntry *<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>,</div>
<div class="line"><a name="l06594"></a><span class="lineno"> 6594</span>&#160;                                      <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VectorizedVals) {</div>
<div class="line"><a name="l06595"></a><span class="lineno"> 6595</span>&#160;  <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL = <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars;</div>
<div class="line"><a name="l06596"></a><span class="lineno"> 6596</span>&#160; </div>
<div class="line"><a name="l06597"></a><span class="lineno"> 6597</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *ScalarTy = VL[0]-&gt;getType();</div>
<div class="line"><a name="l06598"></a><span class="lineno"> 6598</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;StoreInst&gt;(VL[0]))</div>
<div class="line"><a name="l06599"></a><span class="lineno"> 6599</span>&#160;    ScalarTy = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getValueOperand()-&gt;getType();</div>
<div class="line"><a name="l06600"></a><span class="lineno"> 6600</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a> *CI = dyn_cast&lt;CmpInst&gt;(VL[0]))</div>
<div class="line"><a name="l06601"></a><span class="lineno"> 6601</span>&#160;    ScalarTy = CI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l06602"></a><span class="lineno"> 6602</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a> = dyn_cast&lt;InsertElementInst&gt;(VL[0]))</div>
<div class="line"><a name="l06603"></a><span class="lineno"> 6603</span>&#160;    ScalarTy = <a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>-&gt;getOperand(1)-&gt;getType();</div>
<div class="line"><a name="l06604"></a><span class="lineno"> 6604</span>&#160;  <span class="keyword">auto</span> *VecTy = <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(ScalarTy, VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</div>
<div class="line"><a name="l06605"></a><span class="lineno"> 6605</span>&#160;  <a class="code" href="classllvm_1_1TargetTransformInfo.html#a706f223f760b55668fbae74202b816bb">TTI::TargetCostKind</a> <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a> = <a class="code" href="classllvm_1_1TargetTransformInfo.html#a706f223f760b55668fbae74202b816bba59b32ea7b6f10564abd40ad90602ca5b">TTI::TCK_RecipThroughput</a>;</div>
<div class="line"><a name="l06606"></a><span class="lineno"> 6606</span>&#160; </div>
<div class="line"><a name="l06607"></a><span class="lineno"> 6607</span>&#160;  <span class="comment">// If we have computed a smaller type for the expression, update VecTy so</span></div>
<div class="line"><a name="l06608"></a><span class="lineno"> 6608</span>&#160;  <span class="comment">// that the costs will be accurate.</span></div>
<div class="line"><a name="l06609"></a><span class="lineno"> 6609</span>&#160;  <span class="keywordflow">if</span> (MinBWs.count(VL[0]))</div>
<div class="line"><a name="l06610"></a><span class="lineno"> 6610</span>&#160;    VecTy = <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(</div>
<div class="line"><a name="l06611"></a><span class="lineno"> 6611</span>&#160;        <a class="code" href="classllvm_1_1IntegerType.html#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getContext(), MinBWs[VL[0]].first), VL.size());</div>
<div class="line"><a name="l06612"></a><span class="lineno"> 6612</span>&#160;  <span class="keywordtype">unsigned</span> EntryVF = <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getVectorFactor();</div>
<div class="line"><a name="l06613"></a><span class="lineno"> 6613</span>&#160;  <span class="keyword">auto</span> *FinalVecTy = <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(VecTy-&gt;<a class="code" href="classllvm_1_1VectorType.html#a12e23c3d619db313388fe11dc76eb23f">getElementType</a>(), EntryVF);</div>
<div class="line"><a name="l06614"></a><span class="lineno"> 6614</span>&#160; </div>
<div class="line"><a name="l06615"></a><span class="lineno"> 6615</span>&#160;  <span class="keywordtype">bool</span> NeedToShuffleReuses = !<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReuseShuffleIndices.empty();</div>
<div class="line"><a name="l06616"></a><span class="lineno"> 6616</span>&#160;  <span class="comment">// FIXME: it tries to fix a problem with MSVC buildbots.</span></div>
<div class="line"><a name="l06617"></a><span class="lineno"> 6617</span>&#160;  <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> *<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a> = this-&gt;<a class="code" href="namespacellvm.html#aa0d69e81725c10fa5407f0bf34462068">TTI</a>;</div>
<div class="line"><a name="l06618"></a><span class="lineno"> 6618</span>&#160;  <span class="keyword">auto</span> AdjustExtractsCost = [=](<a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> &amp;<a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a>) {</div>
<div class="line"><a name="l06619"></a><span class="lineno"> 6619</span>&#160;    <span class="comment">// If the resulting type is scalarized, do not adjust the cost.</span></div>
<div class="line"><a name="l06620"></a><span class="lineno"> 6620</span>&#160;    <span class="keywordtype">unsigned</span> VecNumParts = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#ad67b7e389a52ada1d5264e23d09f4cbe">getNumberOfParts</a>(VecTy);</div>
<div class="line"><a name="l06621"></a><span class="lineno"> 6621</span>&#160;    <span class="keywordflow">if</span> (VecNumParts == VecTy-&gt;<a class="code" href="classllvm_1_1FixedVectorType.html#a1893caf878859959ba6a3d5442ef1439">getNumElements</a>())</div>
<div class="line"><a name="l06622"></a><span class="lineno"> 6622</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l06623"></a><span class="lineno"> 6623</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, int&gt;</a> ExtractVectorsTys;</div>
<div class="line"><a name="l06624"></a><span class="lineno"> 6624</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value *, 4&gt;</a> CheckedExtracts;</div>
<div class="line"><a name="l06625"></a><span class="lineno"> 6625</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *V : VL) {</div>
<div class="line"><a name="l06626"></a><span class="lineno"> 6626</span>&#160;      <span class="keywordflow">if</span> (isa&lt;UndefValue&gt;(V))</div>
<div class="line"><a name="l06627"></a><span class="lineno"> 6627</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06628"></a><span class="lineno"> 6628</span>&#160;      <span class="comment">// If all users of instruction are going to be vectorized and this</span></div>
<div class="line"><a name="l06629"></a><span class="lineno"> 6629</span>&#160;      <span class="comment">// instruction itself is not going to be vectorized, consider this</span></div>
<div class="line"><a name="l06630"></a><span class="lineno"> 6630</span>&#160;      <span class="comment">// instruction as dead and remove its cost from the final cost of the</span></div>
<div class="line"><a name="l06631"></a><span class="lineno"> 6631</span>&#160;      <span class="comment">// vectorized tree.</span></div>
<div class="line"><a name="l06632"></a><span class="lineno"> 6632</span>&#160;      <span class="comment">// Also, avoid adjusting the cost for extractelements with multiple uses</span></div>
<div class="line"><a name="l06633"></a><span class="lineno"> 6633</span>&#160;      <span class="comment">// in different graph entries.</span></div>
<div class="line"><a name="l06634"></a><span class="lineno"> 6634</span>&#160;      <span class="keyword">const</span> TreeEntry *VE = getTreeEntry(V);</div>
<div class="line"><a name="l06635"></a><span class="lineno"> 6635</span>&#160;      <span class="keywordflow">if</span> (!CheckedExtracts.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(V).second ||</div>
<div class="line"><a name="l06636"></a><span class="lineno"> 6636</span>&#160;          !areAllUsersVectorized(cast&lt;Instruction&gt;(V), VectorizedVals) ||</div>
<div class="line"><a name="l06637"></a><span class="lineno"> 6637</span>&#160;          (VE &amp;&amp; VE != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>))</div>
<div class="line"><a name="l06638"></a><span class="lineno"> 6638</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06639"></a><span class="lineno"> 6639</span>&#160;      <span class="keyword">auto</span> *EE = cast&lt;ExtractElementInst&gt;(V);</div>
<div class="line"><a name="l06640"></a><span class="lineno"> 6640</span>&#160;      std::optional&lt;unsigned&gt; EEIdx = <a class="code" href="SLPVectorizer_8cpp.html#abe11501239b82a4ba1730e12be769bc6">getExtractIndex</a>(EE);</div>
<div class="line"><a name="l06641"></a><span class="lineno"> 6641</span>&#160;      <span class="keywordflow">if</span> (!EEIdx)</div>
<div class="line"><a name="l06642"></a><span class="lineno"> 6642</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06643"></a><span class="lineno"> 6643</span>&#160;      <span class="keywordtype">unsigned</span> Idx = *EEIdx;</div>
<div class="line"><a name="l06644"></a><span class="lineno"> 6644</span>&#160;      <span class="keywordflow">if</span> (VecNumParts != <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#ad67b7e389a52ada1d5264e23d09f4cbe">getNumberOfParts</a>(EE-&gt;getVectorOperandType())) {</div>
<div class="line"><a name="l06645"></a><span class="lineno"> 6645</span>&#160;        <span class="keyword">auto</span> It =</div>
<div class="line"><a name="l06646"></a><span class="lineno"> 6646</span>&#160;            ExtractVectorsTys.<a class="code" href="classllvm_1_1DenseMapBase.html#a98c685a0c53f3f7ed5f4793890a6c850">try_emplace</a>(EE-&gt;getVectorOperand(), Idx).first;</div>
<div class="line"><a name="l06647"></a><span class="lineno"> 6647</span>&#160;        It-&gt;getSecond() = std::min&lt;int&gt;(It-&gt;second, Idx);</div>
<div class="line"><a name="l06648"></a><span class="lineno"> 6648</span>&#160;      }</div>
<div class="line"><a name="l06649"></a><span class="lineno"> 6649</span>&#160;      <span class="comment">// Take credit for instruction that will become dead.</span></div>
<div class="line"><a name="l06650"></a><span class="lineno"> 6650</span>&#160;      <span class="keywordflow">if</span> (EE-&gt;hasOneUse()) {</div>
<div class="line"><a name="l06651"></a><span class="lineno"> 6651</span>&#160;        <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a> = EE-&gt;user_back();</div>
<div class="line"><a name="l06652"></a><span class="lineno"> 6652</span>&#160;        <span class="keywordflow">if</span> (isa&lt;SExtInst, ZExtInst&gt;(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>) &amp;&amp; <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;users(), [](<a class="code" href="classllvm_1_1User.html">User</a> *U) {</div>
<div class="line"><a name="l06653"></a><span class="lineno"> 6653</span>&#160;              return isa&lt;GetElementPtrInst&gt;(U);</div>
<div class="line"><a name="l06654"></a><span class="lineno"> 6654</span>&#160;            })) {</div>
<div class="line"><a name="l06655"></a><span class="lineno"> 6655</span>&#160;          <span class="comment">// Use getExtractWithExtendCost() to calculate the cost of</span></div>
<div class="line"><a name="l06656"></a><span class="lineno"> 6656</span>&#160;          <span class="comment">// extractelement/ext pair.</span></div>
<div class="line"><a name="l06657"></a><span class="lineno"> 6657</span>&#160;          <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> -=</div>
<div class="line"><a name="l06658"></a><span class="lineno"> 6658</span>&#160;              <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#acbea7151f5e66776f92f7b4e305418d6">getExtractWithExtendCost</a>(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getOpcode(), <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType(),</div>
<div class="line"><a name="l06659"></a><span class="lineno"> 6659</span>&#160;                                            EE-&gt;getVectorOperandType(), Idx);</div>
<div class="line"><a name="l06660"></a><span class="lineno"> 6660</span>&#160;          <span class="comment">// Add back the cost of s|zext which is subtracted separately.</span></div>
<div class="line"><a name="l06661"></a><span class="lineno"> 6661</span>&#160;          <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> += <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a425eab58717b81784602a0b169dd9ff8">getCastInstrCost</a>(</div>
<div class="line"><a name="l06662"></a><span class="lineno"> 6662</span>&#160;              <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getOpcode(), <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType(), EE-&gt;getType(),</div>
<div class="line"><a name="l06663"></a><span class="lineno"> 6663</span>&#160;              <a class="code" href="classllvm_1_1TargetTransformInfo.html#a096c8b641174dc0e486006926c5202cf">TTI::getCastContextHint</a>(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>), <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>, <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>);</div>
<div class="line"><a name="l06664"></a><span class="lineno"> 6664</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06665"></a><span class="lineno"> 6665</span>&#160;        }</div>
<div class="line"><a name="l06666"></a><span class="lineno"> 6666</span>&#160;      }</div>
<div class="line"><a name="l06667"></a><span class="lineno"> 6667</span>&#160;      <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> -= <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#af37b2842424eb63440bdcacca0af9820">getVectorInstrCost</a>(*EE, EE-&gt;getVectorOperandType(), <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>,</div>
<div class="line"><a name="l06668"></a><span class="lineno"> 6668</span>&#160;                                      Idx);</div>
<div class="line"><a name="l06669"></a><span class="lineno"> 6669</span>&#160;    }</div>
<div class="line"><a name="l06670"></a><span class="lineno"> 6670</span>&#160;    <span class="comment">// Add a cost for subvector extracts/inserts if required.</span></div>
<div class="line"><a name="l06671"></a><span class="lineno"> 6671</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;Data : ExtractVectorsTys) {</div>
<div class="line"><a name="l06672"></a><span class="lineno"> 6672</span>&#160;      <span class="keyword">auto</span> *EEVTy = cast&lt;FixedVectorType&gt;(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.first-&gt;getType());</div>
<div class="line"><a name="l06673"></a><span class="lineno"> 6673</span>&#160;      <span class="keywordtype">unsigned</span> NumElts = VecTy-&gt;<a class="code" href="classllvm_1_1FixedVectorType.html#a1893caf878859959ba6a3d5442ef1439">getNumElements</a>();</div>
<div class="line"><a name="l06674"></a><span class="lineno"> 6674</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.second % NumElts == 0)</div>
<div class="line"><a name="l06675"></a><span class="lineno"> 6675</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06676"></a><span class="lineno"> 6676</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#ad67b7e389a52ada1d5264e23d09f4cbe">getNumberOfParts</a>(EEVTy) &gt; VecNumParts) {</div>
<div class="line"><a name="l06677"></a><span class="lineno"> 6677</span>&#160;        <span class="keywordtype">unsigned</span> Idx = (<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.second / NumElts) * NumElts;</div>
<div class="line"><a name="l06678"></a><span class="lineno"> 6678</span>&#160;        <span class="keywordtype">unsigned</span> EENumElts = EEVTy-&gt;getNumElements();</div>
<div class="line"><a name="l06679"></a><span class="lineno"> 6679</span>&#160;        <span class="keywordflow">if</span> (Idx + NumElts &lt;= EENumElts) {</div>
<div class="line"><a name="l06680"></a><span class="lineno"> 6680</span>&#160;          <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> +=</div>
<div class="line"><a name="l06681"></a><span class="lineno"> 6681</span>&#160;              <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#aa0519f26bcb15c25ac0ff557061fa7af">getShuffleCost</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53ecafd6c03f570400fcb24d861aa21ddffe9">TargetTransformInfo::SK_ExtractSubvector</a>,</div>
<div class="line"><a name="l06682"></a><span class="lineno"> 6682</span>&#160;                                  EEVTy, std::nullopt, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>, Idx, VecTy);</div>
<div class="line"><a name="l06683"></a><span class="lineno"> 6683</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06684"></a><span class="lineno"> 6684</span>&#160;          <span class="comment">// Need to round up the subvector type vectorization factor to avoid a</span></div>
<div class="line"><a name="l06685"></a><span class="lineno"> 6685</span>&#160;          <span class="comment">// crash in cost model functions. Make SubVT so that Idx + VF of SubVT</span></div>
<div class="line"><a name="l06686"></a><span class="lineno"> 6686</span>&#160;          <span class="comment">// &lt;= EENumElts.</span></div>
<div class="line"><a name="l06687"></a><span class="lineno"> 6687</span>&#160;          <span class="keyword">auto</span> *SubVT =</div>
<div class="line"><a name="l06688"></a><span class="lineno"> 6688</span>&#160;              <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(VecTy-&gt;<a class="code" href="classllvm_1_1VectorType.html#a12e23c3d619db313388fe11dc76eb23f">getElementType</a>(), EENumElts - Idx);</div>
<div class="line"><a name="l06689"></a><span class="lineno"> 6689</span>&#160;          <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> +=</div>
<div class="line"><a name="l06690"></a><span class="lineno"> 6690</span>&#160;              <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#aa0519f26bcb15c25ac0ff557061fa7af">getShuffleCost</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53ecafd6c03f570400fcb24d861aa21ddffe9">TargetTransformInfo::SK_ExtractSubvector</a>,</div>
<div class="line"><a name="l06691"></a><span class="lineno"> 6691</span>&#160;                                  EEVTy, std::nullopt, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>, Idx, SubVT);</div>
<div class="line"><a name="l06692"></a><span class="lineno"> 6692</span>&#160;        }</div>
<div class="line"><a name="l06693"></a><span class="lineno"> 6693</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06694"></a><span class="lineno"> 6694</span>&#160;        <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> += <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#aa0519f26bcb15c25ac0ff557061fa7af">getShuffleCost</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53eca466a4d581cf3a553414b9c2e889b944a">TargetTransformInfo::SK_InsertSubvector</a>,</div>
<div class="line"><a name="l06695"></a><span class="lineno"> 6695</span>&#160;                                    VecTy, std::nullopt, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>, 0, EEVTy);</div>
<div class="line"><a name="l06696"></a><span class="lineno"> 6696</span>&#160;      }</div>
<div class="line"><a name="l06697"></a><span class="lineno"> 6697</span>&#160;    }</div>
<div class="line"><a name="l06698"></a><span class="lineno"> 6698</span>&#160;  };</div>
<div class="line"><a name="l06699"></a><span class="lineno"> 6699</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;State == TreeEntry::NeedToGather) {</div>
<div class="line"><a name="l06700"></a><span class="lineno"> 6700</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#a7568c08b526dbf7f7b5402f3eb605b55">allConstant</a>(VL))</div>
<div class="line"><a name="l06701"></a><span class="lineno"> 6701</span>&#160;      <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l06702"></a><span class="lineno"> 6702</span>&#160;    <span class="keywordflow">if</span> (isa&lt;InsertElementInst&gt;(VL[0]))</div>
<div class="line"><a name="l06703"></a><span class="lineno"> 6703</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1InstructionCost.html#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</div>
<div class="line"><a name="l06704"></a><span class="lineno"> 6704</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *&gt;</a> GatheredScalars(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars.begin(), <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars.end());</div>
<div class="line"><a name="l06705"></a><span class="lineno"> 6705</span>&#160;    <span class="comment">// Build a mask out of the reorder indices and reorder scalars per this</span></div>
<div class="line"><a name="l06706"></a><span class="lineno"> 6706</span>&#160;    <span class="comment">// mask.</span></div>
<div class="line"><a name="l06707"></a><span class="lineno"> 6707</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> ReorderMask;</div>
<div class="line"><a name="l06708"></a><span class="lineno"> 6708</span>&#160;    <a class="code" href="namespacellvm.html#a6f0917bf2ae18fac81fea6bf7e887115">inversePermutation</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReorderIndices, ReorderMask);</div>
<div class="line"><a name="l06709"></a><span class="lineno"> 6709</span>&#160;    <span class="keywordflow">if</span> (!ReorderMask.empty())</div>
<div class="line"><a name="l06710"></a><span class="lineno"> 6710</span>&#160;      <a class="code" href="namespacellvm.html#a14c12bda1f5a9beed612b00f3f98b888">reorderScalars</a>(GatheredScalars, ReorderMask);</div>
<div class="line"><a name="l06711"></a><span class="lineno"> 6711</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>;</div>
<div class="line"><a name="l06712"></a><span class="lineno"> 6712</span>&#160;    std::optional&lt;TargetTransformInfo::ShuffleKind&gt; GatherShuffle;</div>
<div class="line"><a name="l06713"></a><span class="lineno"> 6713</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const TreeEntry *&gt;</a> Entries;</div>
<div class="line"><a name="l06714"></a><span class="lineno"> 6714</span>&#160;    <span class="comment">// Do not try to look for reshuffled loads for gathered loads (they will be</span></div>
<div class="line"><a name="l06715"></a><span class="lineno"> 6715</span>&#160;    <span class="comment">// handled later), for vectorized scalars, and cases, which are definitely</span></div>
<div class="line"><a name="l06716"></a><span class="lineno"> 6716</span>&#160;    <span class="comment">// not profitable (splats and small gather nodes.)</span></div>
<div class="line"><a name="l06717"></a><span class="lineno"> 6717</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode() != <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Instruction::Load</a> || <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;isAltShuffle() ||</div>
<div class="line"><a name="l06718"></a><span class="lineno"> 6718</span>&#160;        <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars, [<span class="keyword">this</span>](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) { return getTreeEntry(V); }) ||</div>
<div class="line"><a name="l06719"></a><span class="lineno"> 6719</span>&#160;        <a class="code" href="SLPVectorizer_8cpp.html#a6ef5b86735d738868e5fb00a18643b1c">isSplat</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars) ||</div>
<div class="line"><a name="l06720"></a><span class="lineno"> 6720</span>&#160;        (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars != GatheredScalars &amp;&amp; GatheredScalars.size() &lt;= 2))</div>
<div class="line"><a name="l06721"></a><span class="lineno"> 6721</span>&#160;      GatherShuffle = isGatherShuffledEntry(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, GatheredScalars, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, Entries);</div>
<div class="line"><a name="l06722"></a><span class="lineno"> 6722</span>&#160;    <span class="keywordflow">if</span> (GatherShuffle) {</div>
<div class="line"><a name="l06723"></a><span class="lineno"> 6723</span>&#160;      <span class="comment">// Remove shuffled elements from list of gathers.</span></div>
<div class="line"><a name="l06724"></a><span class="lineno"> 6724</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, Sz = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; Sz; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l06725"></a><span class="lineno"> 6725</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] != <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l06726"></a><span class="lineno"> 6726</span>&#160;          GatheredScalars[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="classllvm_1_1PoisonValue.html#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(ScalarTy);</div>
<div class="line"><a name="l06727"></a><span class="lineno"> 6727</span>&#160;      }</div>
<div class="line"><a name="l06728"></a><span class="lineno"> 6728</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((Entries.size() == 1 || Entries.size() == 2) &amp;&amp;</div>
<div class="line"><a name="l06729"></a><span class="lineno"> 6729</span>&#160;             <span class="stringliteral">&quot;Expected shuffle of 1 or 2 entries.&quot;</span>);</div>
<div class="line"><a name="l06730"></a><span class="lineno"> 6730</span>&#160;      <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> GatherCost = 0;</div>
<div class="line"><a name="l06731"></a><span class="lineno"> 6731</span>&#160;      <span class="keywordtype">int</span> Limit = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size() * 2;</div>
<div class="line"><a name="l06732"></a><span class="lineno"> 6732</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, [=](<span class="keywordtype">int</span> Idx) { <span class="keywordflow">return</span> Idx &lt; Limit; }) &amp;&amp;</div>
<div class="line"><a name="l06733"></a><span class="lineno"> 6733</span>&#160;          <a class="code" href="classllvm_1_1ShuffleVectorInst.html#a4bc8953b0fd0277b0e5a8e5b78025150">ShuffleVectorInst::isIdentityMask</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>)) {</div>
<div class="line"><a name="l06734"></a><span class="lineno"> 6734</span>&#160;        <span class="comment">// Perfect match in the graph, will reuse the previously vectorized</span></div>
<div class="line"><a name="l06735"></a><span class="lineno"> 6735</span>&#160;        <span class="comment">// node. Cost is 0.</span></div>
<div class="line"><a name="l06736"></a><span class="lineno"> 6736</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(</div>
<div class="line"><a name="l06737"></a><span class="lineno"> 6737</span>&#160;            <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</div>
<div class="line"><a name="l06738"></a><span class="lineno"> 6738</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;SLP: perfect diamond match for gather bundle that starts with &quot;</span></div>
<div class="line"><a name="l06739"></a><span class="lineno"> 6739</span>&#160;            &lt;&lt; *VL.front() &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l06740"></a><span class="lineno"> 6740</span>&#160;        <span class="keywordflow">if</span> (NeedToShuffleReuses)</div>
<div class="line"><a name="l06741"></a><span class="lineno"> 6741</span>&#160;          GatherCost =</div>
<div class="line"><a name="l06742"></a><span class="lineno"> 6742</span>&#160;              <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#aa0519f26bcb15c25ac0ff557061fa7af">getShuffleCost</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53eca7beec9815d0197f2d31fac9968e9205b">TargetTransformInfo::SK_PermuteSingleSrc</a>,</div>
<div class="line"><a name="l06743"></a><span class="lineno"> 6743</span>&#160;                                  FinalVecTy, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReuseShuffleIndices);</div>
<div class="line"><a name="l06744"></a><span class="lineno"> 6744</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06745"></a><span class="lineno"> 6745</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: shuffled &quot;</span> &lt;&lt; Entries.size()</div>
<div class="line"><a name="l06746"></a><span class="lineno"> 6746</span>&#160;                          &lt;&lt; <span class="stringliteral">&quot; entries for bundle that starts with &quot;</span></div>
<div class="line"><a name="l06747"></a><span class="lineno"> 6747</span>&#160;                          &lt;&lt; *VL.front() &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l06748"></a><span class="lineno"> 6748</span>&#160;        <span class="comment">// Detected that instead of gather we can emit a shuffle of single/two</span></div>
<div class="line"><a name="l06749"></a><span class="lineno"> 6749</span>&#160;        <span class="comment">// previously vectorized nodes. Add the cost of the permutation rather</span></div>
<div class="line"><a name="l06750"></a><span class="lineno"> 6750</span>&#160;        <span class="comment">// than gather.</span></div>
<div class="line"><a name="l06751"></a><span class="lineno"> 6751</span>&#160;        <a class="code" href="SLPVectorizer_8cpp.html#aff62592a7901b27bdb120c2e64cd86d0">::addMask</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReuseShuffleIndices);</div>
<div class="line"><a name="l06752"></a><span class="lineno"> 6752</span>&#160;        GatherCost = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#aa0519f26bcb15c25ac0ff557061fa7af">getShuffleCost</a>(*GatherShuffle, FinalVecTy, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l06753"></a><span class="lineno"> 6753</span>&#160;      }</div>
<div class="line"><a name="l06754"></a><span class="lineno"> 6754</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(GatheredScalars, <a class="code" href="classllvm_1_1UndefValue.html#a72f33f26b467287ba52d3adf82b7afb5">UndefValue::classof</a>))</div>
<div class="line"><a name="l06755"></a><span class="lineno"> 6755</span>&#160;        GatherCost += getGatherCost(GatheredScalars);</div>
<div class="line"><a name="l06756"></a><span class="lineno"> 6756</span>&#160;      <span class="keywordflow">return</span> GatherCost;</div>
<div class="line"><a name="l06757"></a><span class="lineno"> 6757</span>&#160;    }</div>
<div class="line"><a name="l06758"></a><span class="lineno"> 6758</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode() == Instruction::ExtractElement ||</div>
<div class="line"><a name="l06759"></a><span class="lineno"> 6759</span>&#160;         <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars,</div>
<div class="line"><a name="l06760"></a><span class="lineno"> 6760</span>&#160;                [](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l06761"></a><span class="lineno"> 6761</span>&#160;                  return isa&lt;ExtractElementInst, UndefValue&gt;(V);</div>
<div class="line"><a name="l06762"></a><span class="lineno"> 6762</span>&#160;                })) &amp;&amp;</div>
<div class="line"><a name="l06763"></a><span class="lineno"> 6763</span>&#160;        <a class="code" href="SLPVectorizer_8cpp.html#aabfbce373feafd33ca9e104d8b164ece">allSameType</a>(VL)) {</div>
<div class="line"><a name="l06764"></a><span class="lineno"> 6764</span>&#160;      <span class="comment">// Check that gather of extractelements can be represented as just a</span></div>
<div class="line"><a name="l06765"></a><span class="lineno"> 6765</span>&#160;      <span class="comment">// shuffle of a single/two vectors the scalars are extracted from.</span></div>
<div class="line"><a name="l06766"></a><span class="lineno"> 6766</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>;</div>
<div class="line"><a name="l06767"></a><span class="lineno"> 6767</span>&#160;      std::optional&lt;TargetTransformInfo::ShuffleKind&gt; ShuffleKind =</div>
<div class="line"><a name="l06768"></a><span class="lineno"> 6768</span>&#160;          <a class="code" href="SLPVectorizer_8cpp.html#a8b409af081b7132c139c0bdc22c5cefd">isFixedVectorShuffle</a>(VL, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l06769"></a><span class="lineno"> 6769</span>&#160;      <span class="keywordflow">if</span> (ShuffleKind) {</div>
<div class="line"><a name="l06770"></a><span class="lineno"> 6770</span>&#160;        <span class="comment">// Found the bunch of extractelement instructions that must be gathered</span></div>
<div class="line"><a name="l06771"></a><span class="lineno"> 6771</span>&#160;        <span class="comment">// into a vector and can be represented as a permutation elements in a</span></div>
<div class="line"><a name="l06772"></a><span class="lineno"> 6772</span>&#160;        <span class="comment">// single input vector or of 2 input vectors.</span></div>
<div class="line"><a name="l06773"></a><span class="lineno"> 6773</span>&#160;        <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> =</div>
<div class="line"><a name="l06774"></a><span class="lineno"> 6774</span>&#160;            <a class="code" href="SLPVectorizer_8cpp.html#aaf4b1586dd2d57daa5d28ea5ee3e14ca">computeExtractCost</a>(VL, VecTy, *ShuffleKind, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, *<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>);</div>
<div class="line"><a name="l06775"></a><span class="lineno"> 6775</span>&#160;        AdjustExtractsCost(Cost);</div>
<div class="line"><a name="l06776"></a><span class="lineno"> 6776</span>&#160;        <span class="keywordflow">if</span> (NeedToShuffleReuses)</div>
<div class="line"><a name="l06777"></a><span class="lineno"> 6777</span>&#160;          <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> += <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#aa0519f26bcb15c25ac0ff557061fa7af">getShuffleCost</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53eca7beec9815d0197f2d31fac9968e9205b">TargetTransformInfo::SK_PermuteSingleSrc</a>,</div>
<div class="line"><a name="l06778"></a><span class="lineno"> 6778</span>&#160;                                      FinalVecTy, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReuseShuffleIndices);</div>
<div class="line"><a name="l06779"></a><span class="lineno"> 6779</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a>;</div>
<div class="line"><a name="l06780"></a><span class="lineno"> 6780</span>&#160;      }</div>
<div class="line"><a name="l06781"></a><span class="lineno"> 6781</span>&#160;    }</div>
<div class="line"><a name="l06782"></a><span class="lineno"> 6782</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#a6ef5b86735d738868e5fb00a18643b1c">isSplat</a>(VL)) {</div>
<div class="line"><a name="l06783"></a><span class="lineno"> 6783</span>&#160;      <span class="comment">// Found the broadcasting of the single scalar, calculate the cost as the</span></div>
<div class="line"><a name="l06784"></a><span class="lineno"> 6784</span>&#160;      <span class="comment">// broadcast.</span></div>
<div class="line"><a name="l06785"></a><span class="lineno"> 6785</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VecTy == FinalVecTy &amp;&amp;</div>
<div class="line"><a name="l06786"></a><span class="lineno"> 6786</span>&#160;             <span class="stringliteral">&quot;No reused scalars expected for broadcast.&quot;</span>);</div>
<div class="line"><a name="l06787"></a><span class="lineno"> 6787</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> *It =</div>
<div class="line"><a name="l06788"></a><span class="lineno"> 6788</span>&#160;          <a class="code" href="namespacellvm.html#ac78c09ae232b2ce188ff590d51e3c268">find_if</a>(VL, [](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) { <span class="keywordflow">return</span> !isa&lt;UndefValue&gt;(V); });</div>
<div class="line"><a name="l06789"></a><span class="lineno"> 6789</span>&#160;      <span class="comment">// If all values are undefs - consider cost free.</span></div>
<div class="line"><a name="l06790"></a><span class="lineno"> 6790</span>&#160;      <span class="keywordflow">if</span> (It == VL.end())</div>
<div class="line"><a name="l06791"></a><span class="lineno"> 6791</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html#ac44f6b9fdbb5f9cc199f8329cb0b272ca89f768b1267e3083b4eb05b4ab77e717">TTI::TCC_Free</a>;</div>
<div class="line"><a name="l06792"></a><span class="lineno"> 6792</span>&#160;      <span class="comment">// Add broadcast for non-identity shuffle only.</span></div>
<div class="line"><a name="l06793"></a><span class="lineno"> 6793</span>&#160;      <span class="keywordtype">bool</span> NeedShuffle =</div>
<div class="line"><a name="l06794"></a><span class="lineno"> 6794</span>&#160;          VL.front() != *It || !<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(VL.drop_front(), <a class="code" href="classllvm_1_1UndefValue.html#a72f33f26b467287ba52d3adf82b7afb5">UndefValue::classof</a>);</div>
<div class="line"><a name="l06795"></a><span class="lineno"> 6795</span>&#160;      <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> InsertCost =</div>
<div class="line"><a name="l06796"></a><span class="lineno"> 6796</span>&#160;          <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#af37b2842424eb63440bdcacca0af9820">getVectorInstrCost</a>(Instruction::InsertElement, VecTy, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>,</div>
<div class="line"><a name="l06797"></a><span class="lineno"> 6797</span>&#160;                                  <span class="comment">/*Index=*/</span>0, <a class="code" href="classllvm_1_1PoisonValue.html#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(VecTy), *It);</div>
<div class="line"><a name="l06798"></a><span class="lineno"> 6798</span>&#160;      <span class="keywordflow">return</span> InsertCost + (NeedShuffle</div>
<div class="line"><a name="l06799"></a><span class="lineno"> 6799</span>&#160;                               ? <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#aa0519f26bcb15c25ac0ff557061fa7af">getShuffleCost</a>(</div>
<div class="line"><a name="l06800"></a><span class="lineno"> 6800</span>&#160;                                     <a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53ecab1ac8982cdb119f39a5fe74610a46796">TargetTransformInfo::SK_Broadcast</a>, VecTy,</div>
<div class="line"><a name="l06801"></a><span class="lineno"> 6801</span>&#160;                                     <span class="comment">/*Mask=*/</span>std::nullopt, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>,</div>
<div class="line"><a name="l06802"></a><span class="lineno"> 6802</span>&#160;                                     <span class="comment">/*Index=*/</span>0,</div>
<div class="line"><a name="l06803"></a><span class="lineno"> 6803</span>&#160;                                     <span class="comment">/*SubTp=*/</span><span class="keyword">nullptr</span>, <span class="comment">/*Args=*/</span>VL[0])</div>
<div class="line"><a name="l06804"></a><span class="lineno"> 6804</span>&#160;                               : <a class="code" href="classllvm_1_1TargetTransformInfo.html#ac44f6b9fdbb5f9cc199f8329cb0b272ca89f768b1267e3083b4eb05b4ab77e717">TTI::TCC_Free</a>);</div>
<div class="line"><a name="l06805"></a><span class="lineno"> 6805</span>&#160;    }</div>
<div class="line"><a name="l06806"></a><span class="lineno"> 6806</span>&#160;    <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> ReuseShuffleCost = 0;</div>
<div class="line"><a name="l06807"></a><span class="lineno"> 6807</span>&#160;    <span class="keywordflow">if</span> (NeedToShuffleReuses)</div>
<div class="line"><a name="l06808"></a><span class="lineno"> 6808</span>&#160;      ReuseShuffleCost = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#aa0519f26bcb15c25ac0ff557061fa7af">getShuffleCost</a>(</div>
<div class="line"><a name="l06809"></a><span class="lineno"> 6809</span>&#160;          <a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53eca7beec9815d0197f2d31fac9968e9205b">TTI::SK_PermuteSingleSrc</a>, FinalVecTy, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReuseShuffleIndices);</div>
<div class="line"><a name="l06810"></a><span class="lineno"> 6810</span>&#160;    <span class="comment">// Improve gather cost for gather of loads, if we can group some of the</span></div>
<div class="line"><a name="l06811"></a><span class="lineno"> 6811</span>&#160;    <span class="comment">// loads into vector loads.</span></div>
<div class="line"><a name="l06812"></a><span class="lineno"> 6812</span>&#160;    <span class="keywordflow">if</span> (VL.size() &gt; 2 &amp;&amp; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode() == <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Instruction::Load</a> &amp;&amp;</div>
<div class="line"><a name="l06813"></a><span class="lineno"> 6813</span>&#160;        !<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;isAltShuffle()) {</div>
<div class="line"><a name="l06814"></a><span class="lineno"> 6814</span>&#160;      BoUpSLP::ValueSet VectorizedLoads;</div>
<div class="line"><a name="l06815"></a><span class="lineno"> 6815</span>&#160;      <span class="keywordtype">unsigned</span> StartIdx = 0;</div>
<div class="line"><a name="l06816"></a><span class="lineno"> 6816</span>&#160;      <span class="keywordtype">unsigned</span> VF = VL.size() / 2;</div>
<div class="line"><a name="l06817"></a><span class="lineno"> 6817</span>&#160;      <span class="keywordtype">unsigned</span> VectorizedCnt = 0;</div>
<div class="line"><a name="l06818"></a><span class="lineno"> 6818</span>&#160;      <span class="keywordtype">unsigned</span> ScatterVectorizeCnt = 0;</div>
<div class="line"><a name="l06819"></a><span class="lineno"> 6819</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> Sz = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getTypeSizeInBits(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getMainOp()-&gt;getType());</div>
<div class="line"><a name="l06820"></a><span class="lineno"> 6820</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> MinVF = getMinVF(2 * Sz); VF &gt;= MinVF; VF /= 2) {</div>
<div class="line"><a name="l06821"></a><span class="lineno"> 6821</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Cnt = StartIdx, End = VL.size(); Cnt + VF &lt;= End;</div>
<div class="line"><a name="l06822"></a><span class="lineno"> 6822</span>&#160;             Cnt += VF) {</div>
<div class="line"><a name="l06823"></a><span class="lineno"> 6823</span>&#160;          <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> Slice = VL.<a class="code" href="classllvm_1_1ArrayRef.html#ace7bdce94e806bb8870626657630dab0">slice</a>(Cnt, VF);</div>
<div class="line"><a name="l06824"></a><span class="lineno"> 6824</span>&#160;          <span class="keywordflow">if</span> (!VectorizedLoads.count(Slice.<a class="code" href="classllvm_1_1ArrayRef.html#a6bc2b53fce3b1d8975eea027d8a8eb90">front</a>()) &amp;&amp;</div>
<div class="line"><a name="l06825"></a><span class="lineno"> 6825</span>&#160;              !VectorizedLoads.count(Slice.<a class="code" href="classllvm_1_1ArrayRef.html#adb38eaaa53c1d9c57b6fe11cf84bd7a4">back</a>()) &amp;&amp; <a class="code" href="SLPVectorizer_8cpp.html#abd5114d6b451e9ca85a36fc3f19f76c4">allSameBlock</a>(Slice)) {</div>
<div class="line"><a name="l06826"></a><span class="lineno"> 6826</span>&#160;            <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *&gt;</a> PointerOps;</div>
<div class="line"><a name="l06827"></a><span class="lineno"> 6827</span>&#160;            OrdersType CurrentOrder;</div>
<div class="line"><a name="l06828"></a><span class="lineno"> 6828</span>&#160;            LoadsState <a class="code" href="namespacellvm_1_1AArch64CC.html#abfa1f7dce576430da99eed57807c7f28afdd8238d6005774fe2bb9067de76eb8c">LS</a> =</div>
<div class="line"><a name="l06829"></a><span class="lineno"> 6829</span>&#160;                <a class="code" href="SLPVectorizer_8cpp.html#a06f9ac1f9413750e1782f666f635a4ed">canVectorizeLoads</a>(Slice, Slice.<a class="code" href="classllvm_1_1ArrayRef.html#a6bc2b53fce3b1d8975eea027d8a8eb90">front</a>(), *<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, *SE, *LI,</div>
<div class="line"><a name="l06830"></a><span class="lineno"> 6830</span>&#160;                                  *TLI, CurrentOrder, PointerOps);</div>
<div class="line"><a name="l06831"></a><span class="lineno"> 6831</span>&#160;            <span class="keywordflow">switch</span> (<a class="code" href="namespacellvm_1_1AArch64CC.html#abfa1f7dce576430da99eed57807c7f28afdd8238d6005774fe2bb9067de76eb8c">LS</a>) {</div>
<div class="line"><a name="l06832"></a><span class="lineno"> 6832</span>&#160;            <span class="keywordflow">case</span> LoadsState::Vectorize:</div>
<div class="line"><a name="l06833"></a><span class="lineno"> 6833</span>&#160;            <span class="keywordflow">case</span> LoadsState::ScatterVectorize:</div>
<div class="line"><a name="l06834"></a><span class="lineno"> 6834</span>&#160;              <span class="comment">// Mark the vectorized loads so that we don&#39;t vectorize them</span></div>
<div class="line"><a name="l06835"></a><span class="lineno"> 6835</span>&#160;              <span class="comment">// again.</span></div>
<div class="line"><a name="l06836"></a><span class="lineno"> 6836</span>&#160;              <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1AArch64CC.html#abfa1f7dce576430da99eed57807c7f28afdd8238d6005774fe2bb9067de76eb8c">LS</a> == LoadsState::Vectorize)</div>
<div class="line"><a name="l06837"></a><span class="lineno"> 6837</span>&#160;                ++VectorizedCnt;</div>
<div class="line"><a name="l06838"></a><span class="lineno"> 6838</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l06839"></a><span class="lineno"> 6839</span>&#160;                ++ScatterVectorizeCnt;</div>
<div class="line"><a name="l06840"></a><span class="lineno"> 6840</span>&#160;              VectorizedLoads.insert(Slice.<a class="code" href="classllvm_1_1ArrayRef.html#aab36927882fbfdcbb860d87fd9c30da8">begin</a>(), Slice.<a class="code" href="classllvm_1_1ArrayRef.html#a7ca5197533a9c1fb8a2bd30587fcec6b">end</a>());</div>
<div class="line"><a name="l06841"></a><span class="lineno"> 6841</span>&#160;              <span class="comment">// If we vectorized initial block, no need to try to vectorize it</span></div>
<div class="line"><a name="l06842"></a><span class="lineno"> 6842</span>&#160;              <span class="comment">// again.</span></div>
<div class="line"><a name="l06843"></a><span class="lineno"> 6843</span>&#160;              <span class="keywordflow">if</span> (Cnt == StartIdx)</div>
<div class="line"><a name="l06844"></a><span class="lineno"> 6844</span>&#160;                StartIdx += VF;</div>
<div class="line"><a name="l06845"></a><span class="lineno"> 6845</span>&#160;              <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06846"></a><span class="lineno"> 6846</span>&#160;            <span class="keywordflow">case</span> LoadsState::Gather:</div>
<div class="line"><a name="l06847"></a><span class="lineno"> 6847</span>&#160;              <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06848"></a><span class="lineno"> 6848</span>&#160;            }</div>
<div class="line"><a name="l06849"></a><span class="lineno"> 6849</span>&#160;          }</div>
<div class="line"><a name="l06850"></a><span class="lineno"> 6850</span>&#160;        }</div>
<div class="line"><a name="l06851"></a><span class="lineno"> 6851</span>&#160;        <span class="comment">// Check if the whole array was vectorized already - exit.</span></div>
<div class="line"><a name="l06852"></a><span class="lineno"> 6852</span>&#160;        <span class="keywordflow">if</span> (StartIdx &gt;= VL.size())</div>
<div class="line"><a name="l06853"></a><span class="lineno"> 6853</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06854"></a><span class="lineno"> 6854</span>&#160;        <span class="comment">// Found vectorizable parts - exit.</span></div>
<div class="line"><a name="l06855"></a><span class="lineno"> 6855</span>&#160;        <span class="keywordflow">if</span> (!VectorizedLoads.empty())</div>
<div class="line"><a name="l06856"></a><span class="lineno"> 6856</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06857"></a><span class="lineno"> 6857</span>&#160;      }</div>
<div class="line"><a name="l06858"></a><span class="lineno"> 6858</span>&#160;      <span class="keywordflow">if</span> (!VectorizedLoads.empty()) {</div>
<div class="line"><a name="l06859"></a><span class="lineno"> 6859</span>&#160;        <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> GatherCost = 0;</div>
<div class="line"><a name="l06860"></a><span class="lineno"> 6860</span>&#160;        <span class="keywordtype">unsigned</span> NumParts = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#ad67b7e389a52ada1d5264e23d09f4cbe">getNumberOfParts</a>(VecTy);</div>
<div class="line"><a name="l06861"></a><span class="lineno"> 6861</span>&#160;        <span class="keywordtype">bool</span> NeedInsertSubvectorAnalysis =</div>
<div class="line"><a name="l06862"></a><span class="lineno"> 6862</span>&#160;            !NumParts || (VL.size() / VF) &gt; NumParts;</div>
<div class="line"><a name="l06863"></a><span class="lineno"> 6863</span>&#160;        <span class="comment">// Get the cost for gathered loads.</span></div>
<div class="line"><a name="l06864"></a><span class="lineno"> 6864</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, End = VL.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; End; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> += VF) {</div>
<div class="line"><a name="l06865"></a><span class="lineno"> 6865</span>&#160;          <span class="keywordflow">if</span> (VectorizedLoads.contains(VL[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]))</div>
<div class="line"><a name="l06866"></a><span class="lineno"> 6866</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06867"></a><span class="lineno"> 6867</span>&#160;          GatherCost += getGatherCost(VL.slice(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF));</div>
<div class="line"><a name="l06868"></a><span class="lineno"> 6868</span>&#160;        }</div>
<div class="line"><a name="l06869"></a><span class="lineno"> 6869</span>&#160;        <span class="comment">// The cost for vectorized loads.</span></div>
<div class="line"><a name="l06870"></a><span class="lineno"> 6870</span>&#160;        <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> ScalarsCost = 0;</div>
<div class="line"><a name="l06871"></a><span class="lineno"> 6871</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VectorizedLoads) {</div>
<div class="line"><a name="l06872"></a><span class="lineno"> 6872</span>&#160;          <span class="keyword">auto</span> *LI = cast&lt;LoadInst&gt;(V);</div>
<div class="line"><a name="l06873"></a><span class="lineno"> 6873</span>&#160;          ScalarsCost +=</div>
<div class="line"><a name="l06874"></a><span class="lineno"> 6874</span>&#160;              <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a34c987c590db0e5cff66d9869a34c556">getMemoryOpCost</a>(<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Instruction::Load</a>, LI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(),</div>
<div class="line"><a name="l06875"></a><span class="lineno"> 6875</span>&#160;                                   LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#af51c113a039c82f6870df5dc9666b5e3">getAlign</a>(), LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#a161c2db145827f4e181e7fe662b53a81">getPointerAddressSpace</a>(),</div>
<div class="line"><a name="l06876"></a><span class="lineno"> 6876</span>&#160;                                   <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>, <a class="code" href="structllvm_1_1TargetTransformInfo_1_1OperandValueInfo.html">TTI::OperandValueInfo</a>(), LI);</div>
<div class="line"><a name="l06877"></a><span class="lineno"> 6877</span>&#160;        }</div>
<div class="line"><a name="l06878"></a><span class="lineno"> 6878</span>&#160;        <span class="keyword">auto</span> *LI = cast&lt;LoadInst&gt;(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getMainOp());</div>
<div class="line"><a name="l06879"></a><span class="lineno"> 6879</span>&#160;        <span class="keyword">auto</span> *LoadTy = <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(LI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), VF);</div>
<div class="line"><a name="l06880"></a><span class="lineno"> 6880</span>&#160;        <a class="code" href="structllvm_1_1Align.html">Align</a> Alignment = LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#af51c113a039c82f6870df5dc9666b5e3">getAlign</a>();</div>
<div class="line"><a name="l06881"></a><span class="lineno"> 6881</span>&#160;        GatherCost +=</div>
<div class="line"><a name="l06882"></a><span class="lineno"> 6882</span>&#160;            VectorizedCnt *</div>
<div class="line"><a name="l06883"></a><span class="lineno"> 6883</span>&#160;            <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a34c987c590db0e5cff66d9869a34c556">getMemoryOpCost</a>(<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Instruction::Load</a>, LoadTy, Alignment,</div>
<div class="line"><a name="l06884"></a><span class="lineno"> 6884</span>&#160;                                 LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#a161c2db145827f4e181e7fe662b53a81">getPointerAddressSpace</a>(), <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>,</div>
<div class="line"><a name="l06885"></a><span class="lineno"> 6885</span>&#160;                                 <a class="code" href="structllvm_1_1TargetTransformInfo_1_1OperandValueInfo.html">TTI::OperandValueInfo</a>(), LI);</div>
<div class="line"><a name="l06886"></a><span class="lineno"> 6886</span>&#160;        GatherCost += ScatterVectorizeCnt *</div>
<div class="line"><a name="l06887"></a><span class="lineno"> 6887</span>&#160;                      <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#aa0f4a801858ac7255f623ca0ec53394f">getGatherScatterOpCost</a>(</div>
<div class="line"><a name="l06888"></a><span class="lineno"> 6888</span>&#160;                          <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Instruction::Load</a>, LoadTy, LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad47eefa1d094f60494b6b927061ca001">getPointerOperand</a>(),</div>
<div class="line"><a name="l06889"></a><span class="lineno"> 6889</span>&#160;                          <span class="comment">/*VariableMask=*/</span><span class="keyword">false</span>, Alignment, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>, LI);</div>
<div class="line"><a name="l06890"></a><span class="lineno"> 6890</span>&#160;        <span class="keywordflow">if</span> (NeedInsertSubvectorAnalysis) {</div>
<div class="line"><a name="l06891"></a><span class="lineno"> 6891</span>&#160;          <span class="comment">// Add the cost for the subvectors insert.</span></div>
<div class="line"><a name="l06892"></a><span class="lineno"> 6892</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = VF, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = VL.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> += VF)</div>
<div class="line"><a name="l06893"></a><span class="lineno"> 6893</span>&#160;            GatherCost +=</div>
<div class="line"><a name="l06894"></a><span class="lineno"> 6894</span>&#160;                <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#aa0519f26bcb15c25ac0ff557061fa7af">getShuffleCost</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53eca466a4d581cf3a553414b9c2e889b944a">TTI::SK_InsertSubvector</a>, VecTy,</div>
<div class="line"><a name="l06895"></a><span class="lineno"> 6895</span>&#160;                                    std::nullopt, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, LoadTy);</div>
<div class="line"><a name="l06896"></a><span class="lineno"> 6896</span>&#160;        }</div>
<div class="line"><a name="l06897"></a><span class="lineno"> 6897</span>&#160;        <span class="keywordflow">return</span> ReuseShuffleCost + GatherCost - ScalarsCost;</div>
<div class="line"><a name="l06898"></a><span class="lineno"> 6898</span>&#160;      }</div>
<div class="line"><a name="l06899"></a><span class="lineno"> 6899</span>&#160;    }</div>
<div class="line"><a name="l06900"></a><span class="lineno"> 6900</span>&#160;    <span class="keywordflow">return</span> ReuseShuffleCost + getGatherCost(VL);</div>
<div class="line"><a name="l06901"></a><span class="lineno"> 6901</span>&#160;  }</div>
<div class="line"><a name="l06902"></a><span class="lineno"> 6902</span>&#160;  <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> CommonCost = 0;</div>
<div class="line"><a name="l06903"></a><span class="lineno"> 6903</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>;</div>
<div class="line"><a name="l06904"></a><span class="lineno"> 6904</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReorderIndices.empty()) {</div>
<div class="line"><a name="l06905"></a><span class="lineno"> 6905</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> NewMask;</div>
<div class="line"><a name="l06906"></a><span class="lineno"> 6906</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode() == <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Instruction::Store</a>) {</div>
<div class="line"><a name="l06907"></a><span class="lineno"> 6907</span>&#160;      <span class="comment">// For stores the order is actually a mask.</span></div>
<div class="line"><a name="l06908"></a><span class="lineno"> 6908</span>&#160;      NewMask.<a class="code" href="classllvm_1_1SmallVectorImpl.html#ad0b3d8447f88377b62d9c019f3c4e118">resize</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReorderIndices.size());</div>
<div class="line"><a name="l06909"></a><span class="lineno"> 6909</span>&#160;      <a class="code" href="namespacellvm.html#abb650e853db0ddbb60411b885c499737">copy</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReorderIndices, NewMask.begin());</div>
<div class="line"><a name="l06910"></a><span class="lineno"> 6910</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06911"></a><span class="lineno"> 6911</span>&#160;      <a class="code" href="namespacellvm.html#a6f0917bf2ae18fac81fea6bf7e887115">inversePermutation</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReorderIndices, NewMask);</div>
<div class="line"><a name="l06912"></a><span class="lineno"> 6912</span>&#160;    }</div>
<div class="line"><a name="l06913"></a><span class="lineno"> 6913</span>&#160;    <a class="code" href="SLPVectorizer_8cpp.html#aff62592a7901b27bdb120c2e64cd86d0">::addMask</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, NewMask);</div>
<div class="line"><a name="l06914"></a><span class="lineno"> 6914</span>&#160;  }</div>
<div class="line"><a name="l06915"></a><span class="lineno"> 6915</span>&#160;  <span class="keywordflow">if</span> (NeedToShuffleReuses)</div>
<div class="line"><a name="l06916"></a><span class="lineno"> 6916</span>&#160;    <a class="code" href="SLPVectorizer_8cpp.html#aff62592a7901b27bdb120c2e64cd86d0">::addMask</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReuseShuffleIndices);</div>
<div class="line"><a name="l06917"></a><span class="lineno"> 6917</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.empty() &amp;&amp; !<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a4bc8953b0fd0277b0e5a8e5b78025150">ShuffleVectorInst::isIdentityMask</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>))</div>
<div class="line"><a name="l06918"></a><span class="lineno"> 6918</span>&#160;    CommonCost =</div>
<div class="line"><a name="l06919"></a><span class="lineno"> 6919</span>&#160;        <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#aa0519f26bcb15c25ac0ff557061fa7af">getShuffleCost</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53eca7beec9815d0197f2d31fac9968e9205b">TTI::SK_PermuteSingleSrc</a>, FinalVecTy, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l06920"></a><span class="lineno"> 6920</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;State == TreeEntry::Vectorize ||</div>
<div class="line"><a name="l06921"></a><span class="lineno"> 6921</span>&#160;          <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;State == TreeEntry::ScatterVectorize) &amp;&amp;</div>
<div class="line"><a name="l06922"></a><span class="lineno"> 6922</span>&#160;         <span class="stringliteral">&quot;Unhandled state&quot;</span>);</div>
<div class="line"><a name="l06923"></a><span class="lineno"> 6923</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode() &amp;&amp;</div>
<div class="line"><a name="l06924"></a><span class="lineno"> 6924</span>&#160;         ((<a class="code" href="SLPVectorizer_8cpp.html#aabfbce373feafd33ca9e104d8b164ece">allSameType</a>(VL) &amp;&amp; <a class="code" href="SLPVectorizer_8cpp.html#abd5114d6b451e9ca85a36fc3f19f76c4">allSameBlock</a>(VL)) ||</div>
<div class="line"><a name="l06925"></a><span class="lineno"> 6925</span>&#160;          (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode() == Instruction::GetElementPtr &amp;&amp;</div>
<div class="line"><a name="l06926"></a><span class="lineno"> 6926</span>&#160;           <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getMainOp()-&gt;getType()-&gt;isPointerTy())) &amp;&amp;</div>
<div class="line"><a name="l06927"></a><span class="lineno"> 6927</span>&#160;         <span class="stringliteral">&quot;Invalid VL&quot;</span>);</div>
<div class="line"><a name="l06928"></a><span class="lineno"> 6928</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *VL0 = <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getMainOp();</div>
<div class="line"><a name="l06929"></a><span class="lineno"> 6929</span>&#160;  <span class="keywordtype">unsigned</span> ShuffleOrOp =</div>
<div class="line"><a name="l06930"></a><span class="lineno"> 6930</span>&#160;      <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;isAltShuffle() ? (<a class="code" href="ADT_2tmp_8txt.html#aa10ee7493bddf2c751ca6e05451ef410">unsigned</a>)Instruction::ShuffleVector : <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode();</div>
<div class="line"><a name="l06931"></a><span class="lineno"> 6931</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> Sz = VL.size();</div>
<div class="line"><a name="l06932"></a><span class="lineno"> 6932</span>&#160;  <span class="keyword">auto</span> GetCostDiff =</div>
<div class="line"><a name="l06933"></a><span class="lineno"> 6933</span>&#160;      [=](<a class="code" href="classllvm_1_1function__ref.html">function_ref</a>&lt;<a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a>(<span class="keywordtype">unsigned</span>)&gt; ScalarEltCost,</div>
<div class="line"><a name="l06934"></a><span class="lineno"> 6934</span>&#160;          <a class="code" href="classllvm_1_1function__ref.html">function_ref</a>&lt;<a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a>(<a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a>)&gt; VectorCost) {</div>
<div class="line"><a name="l06935"></a><span class="lineno"> 6935</span>&#160;        <span class="comment">// Calculate the cost of this instruction.</span></div>
<div class="line"><a name="l06936"></a><span class="lineno"> 6936</span>&#160;        <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> ScalarCost = 0;</div>
<div class="line"><a name="l06937"></a><span class="lineno"> 6937</span>&#160;        <span class="keywordflow">if</span> (isa&lt;CastInst, CmpInst, SelectInst, CallInst&gt;(VL0)) {</div>
<div class="line"><a name="l06938"></a><span class="lineno"> 6938</span>&#160;          <span class="comment">// For some of the instructions no need to calculate cost for each</span></div>
<div class="line"><a name="l06939"></a><span class="lineno"> 6939</span>&#160;          <span class="comment">// particular instruction, we can use the cost of the single</span></div>
<div class="line"><a name="l06940"></a><span class="lineno"> 6940</span>&#160;          <span class="comment">// instruction x total number of scalar instructions.</span></div>
<div class="line"><a name="l06941"></a><span class="lineno"> 6941</span>&#160;          ScalarCost = Sz * ScalarEltCost(0);</div>
<div class="line"><a name="l06942"></a><span class="lineno"> 6942</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06943"></a><span class="lineno"> 6943</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; Sz; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l06944"></a><span class="lineno"> 6944</span>&#160;            ScalarCost += ScalarEltCost(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l06945"></a><span class="lineno"> 6945</span>&#160;        }</div>
<div class="line"><a name="l06946"></a><span class="lineno"> 6946</span>&#160; </div>
<div class="line"><a name="l06947"></a><span class="lineno"> 6947</span>&#160;        <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> VecCost = VectorCost(CommonCost);</div>
<div class="line"><a name="l06948"></a><span class="lineno"> 6948</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(</div>
<div class="line"><a name="l06949"></a><span class="lineno"> 6949</span>&#160;            dumpTreeCosts(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, CommonCost, VecCost - CommonCost, ScalarCost));</div>
<div class="line"><a name="l06950"></a><span class="lineno"> 6950</span>&#160;        <span class="comment">// Disable warnings for `this` and `E` are unused. Required for</span></div>
<div class="line"><a name="l06951"></a><span class="lineno"> 6951</span>&#160;        <span class="comment">// `dumpTreeCosts`.</span></div>
<div class="line"><a name="l06952"></a><span class="lineno"> 6952</span>&#160;        (void)<span class="keyword">this</span>;</div>
<div class="line"><a name="l06953"></a><span class="lineno"> 6953</span>&#160;        (void)<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>;</div>
<div class="line"><a name="l06954"></a><span class="lineno"> 6954</span>&#160;        <span class="keywordflow">return</span> VecCost - ScalarCost;</div>
<div class="line"><a name="l06955"></a><span class="lineno"> 6955</span>&#160;      };</div>
<div class="line"><a name="l06956"></a><span class="lineno"> 6956</span>&#160;  <span class="comment">// Calculate cost difference from vectorizing set of GEPs.</span></div>
<div class="line"><a name="l06957"></a><span class="lineno"> 6957</span>&#160;  <span class="comment">// Negative value means vectorizing is profitable.</span></div>
<div class="line"><a name="l06958"></a><span class="lineno"> 6958</span>&#160;  <span class="keyword">auto</span> GetGEPCostDiff = [=](<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> Ptrs, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1codeview.html#aa8c11d016a2dd473a4cf0ed1da777f5ea67f23a49a4828b272554feea07834f7d">BasePtr</a>) {</div>
<div class="line"><a name="l06959"></a><span class="lineno"> 6959</span>&#160;    <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> CostSavings = 0;</div>
<div class="line"><a name="l06960"></a><span class="lineno"> 6960</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : Ptrs) {</div>
<div class="line"><a name="l06961"></a><span class="lineno"> 6961</span>&#160;      <span class="keywordflow">if</span> (V == BasePtr)</div>
<div class="line"><a name="l06962"></a><span class="lineno"> 6962</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06963"></a><span class="lineno"> 6963</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = dyn_cast&lt;GetElementPtrInst&gt;(V);</div>
<div class="line"><a name="l06964"></a><span class="lineno"> 6964</span>&#160;      <span class="comment">// GEPs may contain just addresses without instructions, considered free.</span></div>
<div class="line"><a name="l06965"></a><span class="lineno"> 6965</span>&#160;      <span class="comment">// GEPs with all constant indices also considered to have zero cost.</span></div>
<div class="line"><a name="l06966"></a><span class="lineno"> 6966</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> || <a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;hasAllConstantIndices())</div>
<div class="line"><a name="l06967"></a><span class="lineno"> 6967</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06968"></a><span class="lineno"> 6968</span>&#160; </div>
<div class="line"><a name="l06969"></a><span class="lineno"> 6969</span>&#160;      <span class="comment">// Here we differentiate two cases: when GEPs represent a regular</span></div>
<div class="line"><a name="l06970"></a><span class="lineno"> 6970</span>&#160;      <span class="comment">// vectorization tree node (and hence vectorized) and when the set is</span></div>
<div class="line"><a name="l06971"></a><span class="lineno"> 6971</span>&#160;      <span class="comment">// arguments of a set of loads or stores being vectorized. In the former</span></div>
<div class="line"><a name="l06972"></a><span class="lineno"> 6972</span>&#160;      <span class="comment">// case all the scalar GEPs will be removed as a result of vectorization.</span></div>
<div class="line"><a name="l06973"></a><span class="lineno"> 6973</span>&#160;      <span class="comment">// For any external uses of some lanes extract element instructions will</span></div>
<div class="line"><a name="l06974"></a><span class="lineno"> 6974</span>&#160;      <span class="comment">// be generated (which cost is estimated separately). For the latter case</span></div>
<div class="line"><a name="l06975"></a><span class="lineno"> 6975</span>&#160;      <span class="comment">// since the set of GEPs itself is not vectorized those used more than</span></div>
<div class="line"><a name="l06976"></a><span class="lineno"> 6976</span>&#160;      <span class="comment">// once will remain staying in vectorized code as well. So we should not</span></div>
<div class="line"><a name="l06977"></a><span class="lineno"> 6977</span>&#160;      <span class="comment">// count them as savings.</span></div>
<div class="line"><a name="l06978"></a><span class="lineno"> 6978</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;hasOneUse() &amp;&amp; isa&lt;LoadInst, StoreInst&gt;(VL0))</div>
<div class="line"><a name="l06979"></a><span class="lineno"> 6979</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06980"></a><span class="lineno"> 6980</span>&#160; </div>
<div class="line"><a name="l06981"></a><span class="lineno"> 6981</span>&#160;      <span class="comment">// TODO: it is target dependent, so need to implement and then use a TTI</span></div>
<div class="line"><a name="l06982"></a><span class="lineno"> 6982</span>&#160;      <span class="comment">// interface.</span></div>
<div class="line"><a name="l06983"></a><span class="lineno"> 6983</span>&#160;      CostSavings += <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a9679969ae87f8a08d5f6948be6cf7210">getArithmeticInstrCost</a>(<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec">Instruction::Add</a>,</div>
<div class="line"><a name="l06984"></a><span class="lineno"> 6984</span>&#160;                                                 <a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getType(), <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>);</div>
<div class="line"><a name="l06985"></a><span class="lineno"> 6985</span>&#160;    }</div>
<div class="line"><a name="l06986"></a><span class="lineno"> 6986</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Calculated GEPs cost savings or Tree:\n&quot;</span>;</div>
<div class="line"><a name="l06987"></a><span class="lineno"> 6987</span>&#160;               <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;dump());</div>
<div class="line"><a name="l06988"></a><span class="lineno"> 6988</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP:     GEP cost saving = &quot;</span> &lt;&lt; CostSavings &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l06989"></a><span class="lineno"> 6989</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a>() - CostSavings;</div>
<div class="line"><a name="l06990"></a><span class="lineno"> 6990</span>&#160;  };</div>
<div class="line"><a name="l06991"></a><span class="lineno"> 6991</span>&#160; </div>
<div class="line"><a name="l06992"></a><span class="lineno"> 6992</span>&#160;  <span class="keywordflow">switch</span> (ShuffleOrOp) {</div>
<div class="line"><a name="l06993"></a><span class="lineno"> 6993</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">Instruction::PHI</a>: {</div>
<div class="line"><a name="l06994"></a><span class="lineno"> 6994</span>&#160;    <span class="comment">// Count reused scalars.</span></div>
<div class="line"><a name="l06995"></a><span class="lineno"> 6995</span>&#160;    <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> ScalarCost = 0;</div>
<div class="line"><a name="l06996"></a><span class="lineno"> 6996</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const TreeEntry *, 4&gt;</a> CountedOps;</div>
<div class="line"><a name="l06997"></a><span class="lineno"> 6997</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l06998"></a><span class="lineno"> 6998</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = dyn_cast&lt;PHINode&gt;(V);</div>
<div class="line"><a name="l06999"></a><span class="lineno"> 6999</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>)</div>
<div class="line"><a name="l07000"></a><span class="lineno"> 7000</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l07001"></a><span class="lineno"> 7001</span>&#160; </div>
<div class="line"><a name="l07002"></a><span class="lineno"> 7002</span>&#160;      ValueList <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>(<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getNumIncomingValues(), <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l07003"></a><span class="lineno"> 7003</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getNumIncomingValues(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l07004"></a><span class="lineno"> 7004</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getIncomingValue(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l07005"></a><span class="lineno"> 7005</span>&#160;        <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>;</div>
<div class="line"><a name="l07006"></a><span class="lineno"> 7006</span>&#160;      }</div>
<div class="line"><a name="l07007"></a><span class="lineno"> 7007</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">const</span> TreeEntry *OpTE = getTreeEntry(<a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.front()))</div>
<div class="line"><a name="l07008"></a><span class="lineno"> 7008</span>&#160;        <span class="keywordflow">if</span> (OpTE-&gt;isSame(<a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>) &amp;&amp; CountedOps.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(OpTE).second)</div>
<div class="line"><a name="l07009"></a><span class="lineno"> 7009</span>&#160;          <span class="keywordflow">if</span> (!OpTE-&gt;ReuseShuffleIndices.empty())</div>
<div class="line"><a name="l07010"></a><span class="lineno"> 7010</span>&#160;            ScalarCost += <a class="code" href="classllvm_1_1TargetTransformInfo.html#ac44f6b9fdbb5f9cc199f8329cb0b272cae46c9eecc49bd2dc253c607e78a0fb86">TTI::TCC_Basic</a> * (OpTE-&gt;ReuseShuffleIndices.size() -</div>
<div class="line"><a name="l07011"></a><span class="lineno"> 7011</span>&#160;                                            OpTE-&gt;Scalars.size());</div>
<div class="line"><a name="l07012"></a><span class="lineno"> 7012</span>&#160;    }</div>
<div class="line"><a name="l07013"></a><span class="lineno"> 7013</span>&#160; </div>
<div class="line"><a name="l07014"></a><span class="lineno"> 7014</span>&#160;    <span class="keywordflow">return</span> CommonCost - ScalarCost;</div>
<div class="line"><a name="l07015"></a><span class="lineno"> 7015</span>&#160;  }</div>
<div class="line"><a name="l07016"></a><span class="lineno"> 7016</span>&#160;  <span class="keywordflow">case</span> Instruction::ExtractValue:</div>
<div class="line"><a name="l07017"></a><span class="lineno"> 7017</span>&#160;  <span class="keywordflow">case</span> Instruction::ExtractElement: {</div>
<div class="line"><a name="l07018"></a><span class="lineno"> 7018</span>&#160;    <span class="keyword">auto</span> GetScalarCost = [=](<span class="keywordtype">unsigned</span> Idx) {</div>
<div class="line"><a name="l07019"></a><span class="lineno"> 7019</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = cast&lt;Instruction&gt;(VL[Idx]);</div>
<div class="line"><a name="l07020"></a><span class="lineno"> 7020</span>&#160;      <a class="code" href="classllvm_1_1VectorType.html">VectorType</a> *SrcVecTy;</div>
<div class="line"><a name="l07021"></a><span class="lineno"> 7021</span>&#160;      <span class="keywordflow">if</span> (ShuffleOrOp == Instruction::ExtractElement) {</div>
<div class="line"><a name="l07022"></a><span class="lineno"> 7022</span>&#160;        <span class="keyword">auto</span> *EE = cast&lt;ExtractElementInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l07023"></a><span class="lineno"> 7023</span>&#160;        SrcVecTy = EE-&gt;getVectorOperandType();</div>
<div class="line"><a name="l07024"></a><span class="lineno"> 7024</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l07025"></a><span class="lineno"> 7025</span>&#160;        <span class="keyword">auto</span> *EV = cast&lt;ExtractValueInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l07026"></a><span class="lineno"> 7026</span>&#160;        <a class="code" href="classllvm_1_1Type.html">Type</a> *AggregateTy = EV-&gt;getAggregateOperand()-&gt;getType();</div>
<div class="line"><a name="l07027"></a><span class="lineno"> 7027</span>&#160;        <span class="keywordtype">unsigned</span> NumElts;</div>
<div class="line"><a name="l07028"></a><span class="lineno"> 7028</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *ATy = dyn_cast&lt;ArrayType&gt;(AggregateTy))</div>
<div class="line"><a name="l07029"></a><span class="lineno"> 7029</span>&#160;          NumElts = ATy-&gt;getNumElements();</div>
<div class="line"><a name="l07030"></a><span class="lineno"> 7030</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l07031"></a><span class="lineno"> 7031</span>&#160;          NumElts = AggregateTy-&gt;<a class="code" href="classllvm_1_1Type.html#a58e54adaa7672bbf72091254a5391137">getStructNumElements</a>();</div>
<div class="line"><a name="l07032"></a><span class="lineno"> 7032</span>&#160;        SrcVecTy = <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(ScalarTy, NumElts);</div>
<div class="line"><a name="l07033"></a><span class="lineno"> 7033</span>&#160;      }</div>
<div class="line"><a name="l07034"></a><span class="lineno"> 7034</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUse()) {</div>
<div class="line"><a name="l07035"></a><span class="lineno"> 7035</span>&#160;        <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;user_back();</div>
<div class="line"><a name="l07036"></a><span class="lineno"> 7036</span>&#160;        <span class="keywordflow">if</span> ((isa&lt;SExtInst&gt;(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>) || isa&lt;ZExtInst&gt;(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>)) &amp;&amp;</div>
<div class="line"><a name="l07037"></a><span class="lineno"> 7037</span>&#160;            <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;users(),</div>
<div class="line"><a name="l07038"></a><span class="lineno"> 7038</span>&#160;                   [](<a class="code" href="classllvm_1_1User.html">User</a> *U) { return isa&lt;GetElementPtrInst&gt;(U); })) {</div>
<div class="line"><a name="l07039"></a><span class="lineno"> 7039</span>&#160;          <span class="comment">// Use getExtractWithExtendCost() to calculate the cost of</span></div>
<div class="line"><a name="l07040"></a><span class="lineno"> 7040</span>&#160;          <span class="comment">// extractelement/ext pair.</span></div>
<div class="line"><a name="l07041"></a><span class="lineno"> 7041</span>&#160;          <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#acbea7151f5e66776f92f7b4e305418d6">getExtractWithExtendCost</a>(</div>
<div class="line"><a name="l07042"></a><span class="lineno"> 7042</span>&#160;              <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getOpcode(), <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType(), SrcVecTy, *<a class="code" href="SLPVectorizer_8cpp.html#abe11501239b82a4ba1730e12be769bc6">getExtractIndex</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</div>
<div class="line"><a name="l07043"></a><span class="lineno"> 7043</span>&#160;          <span class="comment">// Subtract the cost of s|zext which is subtracted separately.</span></div>
<div class="line"><a name="l07044"></a><span class="lineno"> 7044</span>&#160;          <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> -= <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a425eab58717b81784602a0b169dd9ff8">getCastInstrCost</a>(</div>
<div class="line"><a name="l07045"></a><span class="lineno"> 7045</span>&#160;              <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getOpcode(), <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>-&gt;getType(), <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType(),</div>
<div class="line"><a name="l07046"></a><span class="lineno"> 7046</span>&#160;              <a class="code" href="classllvm_1_1TargetTransformInfo.html#a096c8b641174dc0e486006926c5202cf">TTI::getCastContextHint</a>(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>), <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>, <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>);</div>
<div class="line"><a name="l07047"></a><span class="lineno"> 7047</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a>;</div>
<div class="line"><a name="l07048"></a><span class="lineno"> 7048</span>&#160;        }</div>
<div class="line"><a name="l07049"></a><span class="lineno"> 7049</span>&#160;      }</div>
<div class="line"><a name="l07050"></a><span class="lineno"> 7050</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#af37b2842424eb63440bdcacca0af9820">getVectorInstrCost</a>(Instruction::ExtractElement, SrcVecTy,</div>
<div class="line"><a name="l07051"></a><span class="lineno"> 7051</span>&#160;                                     <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>, *<a class="code" href="SLPVectorizer_8cpp.html#abe11501239b82a4ba1730e12be769bc6">getExtractIndex</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</div>
<div class="line"><a name="l07052"></a><span class="lineno"> 7052</span>&#160;    };</div>
<div class="line"><a name="l07053"></a><span class="lineno"> 7053</span>&#160;    <span class="keyword">auto</span> GetVectorCost = [](<a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> CommonCost) { <span class="keywordflow">return</span> CommonCost; };</div>
<div class="line"><a name="l07054"></a><span class="lineno"> 7054</span>&#160;    <span class="keywordflow">return</span> GetCostDiff(GetScalarCost, GetVectorCost);</div>
<div class="line"><a name="l07055"></a><span class="lineno"> 7055</span>&#160;  }</div>
<div class="line"><a name="l07056"></a><span class="lineno"> 7056</span>&#160;  <span class="keywordflow">case</span> Instruction::InsertElement: {</div>
<div class="line"><a name="l07057"></a><span class="lineno"> 7057</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReuseShuffleIndices.empty() &amp;&amp;</div>
<div class="line"><a name="l07058"></a><span class="lineno"> 7058</span>&#160;           <span class="stringliteral">&quot;Unique insertelements only are expected.&quot;</span>);</div>
<div class="line"><a name="l07059"></a><span class="lineno"> 7059</span>&#160;    <span class="keyword">auto</span> *SrcVecTy = cast&lt;FixedVectorType&gt;(VL0-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l07060"></a><span class="lineno"> 7060</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keyword">const</span> NumElts = SrcVecTy-&gt;getNumElements();</div>
<div class="line"><a name="l07061"></a><span class="lineno"> 7061</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keyword">const</span> NumScalars = VL.size();</div>
<div class="line"><a name="l07062"></a><span class="lineno"> 7062</span>&#160; </div>
<div class="line"><a name="l07063"></a><span class="lineno"> 7063</span>&#160;    <span class="keywordtype">unsigned</span> NumOfParts = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#ad67b7e389a52ada1d5264e23d09f4cbe">getNumberOfParts</a>(SrcVecTy);</div>
<div class="line"><a name="l07064"></a><span class="lineno"> 7064</span>&#160; </div>
<div class="line"><a name="l07065"></a><span class="lineno"> 7065</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> InsertMask(NumElts, <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l07066"></a><span class="lineno"> 7066</span>&#160;    <span class="keywordtype">unsigned</span> OffsetBeg = *<a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(VL.front());</div>
<div class="line"><a name="l07067"></a><span class="lineno"> 7067</span>&#160;    <span class="keywordtype">unsigned</span> OffsetEnd = OffsetBeg;</div>
<div class="line"><a name="l07068"></a><span class="lineno"> 7068</span>&#160;    InsertMask[OffsetBeg] = 0;</div>
<div class="line"><a name="l07069"></a><span class="lineno"> 7069</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> [<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, V] : <a class="code" href="namespacellvm.html#a7b2175e18ff52174fad26b6b68818564">enumerate</a>(VL.drop_front())) {</div>
<div class="line"><a name="l07070"></a><span class="lineno"> 7070</span>&#160;      <span class="keywordtype">unsigned</span> Idx = *<a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(V);</div>
<div class="line"><a name="l07071"></a><span class="lineno"> 7071</span>&#160;      <span class="keywordflow">if</span> (OffsetBeg &gt; Idx)</div>
<div class="line"><a name="l07072"></a><span class="lineno"> 7072</span>&#160;        OffsetBeg = Idx;</div>
<div class="line"><a name="l07073"></a><span class="lineno"> 7073</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (OffsetEnd &lt; Idx)</div>
<div class="line"><a name="l07074"></a><span class="lineno"> 7074</span>&#160;        OffsetEnd = Idx;</div>
<div class="line"><a name="l07075"></a><span class="lineno"> 7075</span>&#160;      InsertMask[Idx] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> + 1;</div>
<div class="line"><a name="l07076"></a><span class="lineno"> 7076</span>&#160;    }</div>
<div class="line"><a name="l07077"></a><span class="lineno"> 7077</span>&#160;    <span class="keywordtype">unsigned</span> VecScalarsSz = <a class="code" href="namespacellvm.html#a5542d44947f8d964b5ce3b20ea719b44">PowerOf2Ceil</a>(NumElts);</div>
<div class="line"><a name="l07078"></a><span class="lineno"> 7078</span>&#160;    <span class="keywordflow">if</span> (NumOfParts &gt; 0)</div>
<div class="line"><a name="l07079"></a><span class="lineno"> 7079</span>&#160;      VecScalarsSz = <a class="code" href="namespacellvm.html#a5542d44947f8d964b5ce3b20ea719b44">PowerOf2Ceil</a>((NumElts + NumOfParts - 1) / NumOfParts);</div>
<div class="line"><a name="l07080"></a><span class="lineno"> 7080</span>&#160;    <span class="keywordtype">unsigned</span> VecSz = (1 + OffsetEnd / VecScalarsSz - OffsetBeg / VecScalarsSz) *</div>
<div class="line"><a name="l07081"></a><span class="lineno"> 7081</span>&#160;                     VecScalarsSz;</div>
<div class="line"><a name="l07082"></a><span class="lineno"> 7082</span>&#160;    <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1AMDGPU_1_1Hwreg.html#a6110fc30bc7311a6cf99814530362e21">Offset</a> = VecScalarsSz * (OffsetBeg / VecScalarsSz);</div>
<div class="line"><a name="l07083"></a><span class="lineno"> 7083</span>&#160;    <span class="keywordtype">unsigned</span> InsertVecSz = std::min&lt;unsigned&gt;(</div>
<div class="line"><a name="l07084"></a><span class="lineno"> 7084</span>&#160;        <a class="code" href="namespacellvm.html#a5542d44947f8d964b5ce3b20ea719b44">PowerOf2Ceil</a>(OffsetEnd - OffsetBeg + 1),</div>
<div class="line"><a name="l07085"></a><span class="lineno"> 7085</span>&#160;        ((OffsetEnd - OffsetBeg + VecScalarsSz) / VecScalarsSz) * VecScalarsSz);</div>
<div class="line"><a name="l07086"></a><span class="lineno"> 7086</span>&#160;    <span class="keywordtype">bool</span> IsWholeSubvector =</div>
<div class="line"><a name="l07087"></a><span class="lineno"> 7087</span>&#160;        OffsetBeg == <a class="code" href="namespacellvm_1_1AMDGPU_1_1Hwreg.html#a6110fc30bc7311a6cf99814530362e21">Offset</a> &amp;&amp; ((OffsetEnd + 1) % VecScalarsSz == 0);</div>
<div class="line"><a name="l07088"></a><span class="lineno"> 7088</span>&#160;    <span class="comment">// Check if we can safely insert a subvector. If it is not possible, just</span></div>
<div class="line"><a name="l07089"></a><span class="lineno"> 7089</span>&#160;    <span class="comment">// generate a whole-sized vector and shuffle the source vector and the new</span></div>
<div class="line"><a name="l07090"></a><span class="lineno"> 7090</span>&#160;    <span class="comment">// subvector.</span></div>
<div class="line"><a name="l07091"></a><span class="lineno"> 7091</span>&#160;    <span class="keywordflow">if</span> (OffsetBeg + InsertVecSz &gt; VecSz) {</div>
<div class="line"><a name="l07092"></a><span class="lineno"> 7092</span>&#160;      <span class="comment">// Align OffsetBeg to generate correct mask.</span></div>
<div class="line"><a name="l07093"></a><span class="lineno"> 7093</span>&#160;      OffsetBeg = <a class="code" href="namespacellvm.html#ad9be86c95736bfa4bb0dc52322a0002a">alignDown</a>(OffsetBeg, VecSz, Offset);</div>
<div class="line"><a name="l07094"></a><span class="lineno"> 7094</span>&#160;      InsertVecSz = VecSz;</div>
<div class="line"><a name="l07095"></a><span class="lineno"> 7095</span>&#160;    }</div>
<div class="line"><a name="l07096"></a><span class="lineno"> 7096</span>&#160; </div>
<div class="line"><a name="l07097"></a><span class="lineno"> 7097</span>&#160;    <a class="code" href="classllvm_1_1APInt.html">APInt</a> DemandedElts = <a class="code" href="classllvm_1_1APInt.html#add4e37b60ea64faafbc9a5bf3e27280f">APInt::getZero</a>(NumElts);</div>
<div class="line"><a name="l07098"></a><span class="lineno"> 7098</span>&#160;    <span class="comment">// TODO: Add support for Instruction::InsertValue.</span></div>
<div class="line"><a name="l07099"></a><span class="lineno"> 7099</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>;</div>
<div class="line"><a name="l07100"></a><span class="lineno"> 7100</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReorderIndices.empty()) {</div>
<div class="line"><a name="l07101"></a><span class="lineno"> 7101</span>&#160;      <a class="code" href="namespacellvm.html#a6f0917bf2ae18fac81fea6bf7e887115">inversePermutation</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReorderIndices, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l07102"></a><span class="lineno"> 7102</span>&#160;      <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.append(InsertVecSz - <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size(), <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l07103"></a><span class="lineno"> 7103</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l07104"></a><span class="lineno"> 7104</span>&#160;      <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.assign(VecSz, <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l07105"></a><span class="lineno"> 7105</span>&#160;      std::iota(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.begin(), std::next(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.begin(), InsertVecSz), 0);</div>
<div class="line"><a name="l07106"></a><span class="lineno"> 7106</span>&#160;    }</div>
<div class="line"><a name="l07107"></a><span class="lineno"> 7107</span>&#160;    <span class="keywordtype">bool</span> IsIdentity = <span class="keyword">true</span>;</div>
<div class="line"><a name="l07108"></a><span class="lineno"> 7108</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> PrevMask(InsertVecSz, <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l07109"></a><span class="lineno"> 7109</span>&#160;    <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.swap(PrevMask);</div>
<div class="line"><a name="l07110"></a><span class="lineno"> 7110</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumScalars; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l07111"></a><span class="lineno"> 7111</span>&#160;      <span class="keywordtype">unsigned</span> InsertIdx = *<a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(VL[PrevMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]]);</div>
<div class="line"><a name="l07112"></a><span class="lineno"> 7112</span>&#160;      DemandedElts.<a class="code" href="classllvm_1_1APInt.html#a33f9f862dca8ee0f23bff5941bf433d8">setBit</a>(InsertIdx);</div>
<div class="line"><a name="l07113"></a><span class="lineno"> 7113</span>&#160;      IsIdentity &amp;= InsertIdx - OffsetBeg == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l07114"></a><span class="lineno"> 7114</span>&#160;      <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[InsertIdx - OffsetBeg] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l07115"></a><span class="lineno"> 7115</span>&#160;    }</div>
<div class="line"><a name="l07116"></a><span class="lineno"> 7116</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Offset &lt; NumElts &amp;&amp; <span class="stringliteral">&quot;Failed to find vector index offset&quot;</span>);</div>
<div class="line"><a name="l07117"></a><span class="lineno"> 7117</span>&#160; </div>
<div class="line"><a name="l07118"></a><span class="lineno"> 7118</span>&#160;    <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> = 0;</div>
<div class="line"><a name="l07119"></a><span class="lineno"> 7119</span>&#160;    <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> -= <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#ae7fe2d1bb4f708d68fe7a908ba675d1b">getScalarizationOverhead</a>(SrcVecTy, DemandedElts,</div>
<div class="line"><a name="l07120"></a><span class="lineno"> 7120</span>&#160;                                          <span class="comment">/*Insert*/</span> <span class="keyword">true</span>, <span class="comment">/*Extract*/</span> <span class="keyword">false</span>,</div>
<div class="line"><a name="l07121"></a><span class="lineno"> 7121</span>&#160;                                          <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>);</div>
<div class="line"><a name="l07122"></a><span class="lineno"> 7122</span>&#160; </div>
<div class="line"><a name="l07123"></a><span class="lineno"> 7123</span>&#160;    <span class="comment">// First cost - resize to actual vector size if not identity shuffle or</span></div>
<div class="line"><a name="l07124"></a><span class="lineno"> 7124</span>&#160;    <span class="comment">// need to shift the vector.</span></div>
<div class="line"><a name="l07125"></a><span class="lineno"> 7125</span>&#160;    <span class="comment">// Do not calculate the cost if the actual size is the register size and</span></div>
<div class="line"><a name="l07126"></a><span class="lineno"> 7126</span>&#160;    <span class="comment">// we can merge this shuffle with the following SK_Select.</span></div>
<div class="line"><a name="l07127"></a><span class="lineno"> 7127</span>&#160;    <span class="keyword">auto</span> *InsertVecTy =</div>
<div class="line"><a name="l07128"></a><span class="lineno"> 7128</span>&#160;        <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(SrcVecTy-&gt;<a class="code" href="classllvm_1_1VectorType.html#a12e23c3d619db313388fe11dc76eb23f">getElementType</a>(), InsertVecSz);</div>
<div class="line"><a name="l07129"></a><span class="lineno"> 7129</span>&#160;    <span class="keywordflow">if</span> (!IsIdentity)</div>
<div class="line"><a name="l07130"></a><span class="lineno"> 7130</span>&#160;      <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> += <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#aa0519f26bcb15c25ac0ff557061fa7af">getShuffleCost</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53eca7beec9815d0197f2d31fac9968e9205b">TargetTransformInfo::SK_PermuteSingleSrc</a>,</div>
<div class="line"><a name="l07131"></a><span class="lineno"> 7131</span>&#160;                                  InsertVecTy, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l07132"></a><span class="lineno"> 7132</span>&#160;    <span class="keyword">auto</span> *FirstInsert = cast&lt;Instruction&gt;(*<a class="code" href="namespacellvm.html#ac78c09ae232b2ce188ff590d51e3c268">find_if</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars, [<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l07133"></a><span class="lineno"> 7133</span>&#160;      return !is_contained(E-&gt;Scalars, cast&lt;Instruction&gt;(V)-&gt;getOperand(0));</div>
<div class="line"><a name="l07134"></a><span class="lineno"> 7134</span>&#160;    }));</div>
<div class="line"><a name="l07135"></a><span class="lineno"> 7135</span>&#160;    <span class="comment">// Second cost - permutation with subvector, if some elements are from the</span></div>
<div class="line"><a name="l07136"></a><span class="lineno"> 7136</span>&#160;    <span class="comment">// initial vector or inserting a subvector.</span></div>
<div class="line"><a name="l07137"></a><span class="lineno"> 7137</span>&#160;    <span class="comment">// TODO: Implement the analysis of the FirstInsert-&gt;getOperand(0)</span></div>
<div class="line"><a name="l07138"></a><span class="lineno"> 7138</span>&#160;    <span class="comment">// subvector of ActualVecTy.</span></div>
<div class="line"><a name="l07139"></a><span class="lineno"> 7139</span>&#160;    <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> InMask =</div>
<div class="line"><a name="l07140"></a><span class="lineno"> 7140</span>&#160;        <a class="code" href="SLPVectorizer_8cpp.html#ac396bb87eb4db1dd3ce315e4d91ee2de">isUndefVector</a>(FirstInsert-&gt;getOperand(0),</div>
<div class="line"><a name="l07141"></a><span class="lineno"> 7141</span>&#160;                      <a class="code" href="SLPVectorizer_8cpp.html#a2fd40bb67aec98438b791520159fb146">buildUseMask</a>(NumElts, InsertMask, UseMask::UndefsAsMask));</div>
<div class="line"><a name="l07142"></a><span class="lineno"> 7142</span>&#160;    <span class="keywordflow">if</span> (!InMask.<a class="code" href="classllvm_1_1SmallBitVector.html#a8cfcd92a373cdd7deefb939dd76b83e3">all</a>() &amp;&amp; NumScalars != NumElts &amp;&amp; !IsWholeSubvector) {</div>
<div class="line"><a name="l07143"></a><span class="lineno"> 7143</span>&#160;      <span class="keywordflow">if</span> (InsertVecSz != VecSz) {</div>
<div class="line"><a name="l07144"></a><span class="lineno"> 7144</span>&#160;        <span class="keyword">auto</span> *ActualVecTy =</div>
<div class="line"><a name="l07145"></a><span class="lineno"> 7145</span>&#160;            <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(SrcVecTy-&gt;<a class="code" href="classllvm_1_1VectorType.html#a12e23c3d619db313388fe11dc76eb23f">getElementType</a>(), VecSz);</div>
<div class="line"><a name="l07146"></a><span class="lineno"> 7146</span>&#160;        <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> += <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#aa0519f26bcb15c25ac0ff557061fa7af">getShuffleCost</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53eca466a4d581cf3a553414b9c2e889b944a">TTI::SK_InsertSubvector</a>, ActualVecTy,</div>
<div class="line"><a name="l07147"></a><span class="lineno"> 7147</span>&#160;                                    std::nullopt, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>, OffsetBeg - Offset,</div>
<div class="line"><a name="l07148"></a><span class="lineno"> 7148</span>&#160;                                    InsertVecTy);</div>
<div class="line"><a name="l07149"></a><span class="lineno"> 7149</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l07150"></a><span class="lineno"> 7150</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, End = OffsetBeg - Offset; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; End; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l07151"></a><span class="lineno"> 7151</span>&#160;          <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = InMask.<a class="code" href="classllvm_1_1SmallBitVector.html#a585f149dd8c344a40c53b1694d3161ed">test</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ? <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a> : <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l07152"></a><span class="lineno"> 7152</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = OffsetBeg - Offset, End = OffsetEnd - Offset;</div>
<div class="line"><a name="l07153"></a><span class="lineno"> 7153</span>&#160;             <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;= End; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l07154"></a><span class="lineno"> 7154</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] != <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l07155"></a><span class="lineno"> 7155</span>&#160;            <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> + VecSz;</div>
<div class="line"><a name="l07156"></a><span class="lineno"> 7156</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = OffsetEnd + 1 - Offset; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; VecSz; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l07157"></a><span class="lineno"> 7157</span>&#160;          <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] =</div>
<div class="line"><a name="l07158"></a><span class="lineno"> 7158</span>&#160;              ((<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &gt;= InMask.<a class="code" href="classllvm_1_1SmallBitVector.html#aa4dce99d953b67f83ef932810a44e21f">size</a>()) || InMask.<a class="code" href="classllvm_1_1SmallBitVector.html#a585f149dd8c344a40c53b1694d3161ed">test</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) ? <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a> : <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l07159"></a><span class="lineno"> 7159</span>&#160;        <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> += <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#aa0519f26bcb15c25ac0ff557061fa7af">getShuffleCost</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53ecab4616961a3bfdaec42aedc4fc426ccfe">TTI::SK_PermuteTwoSrc</a>, InsertVecTy, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l07160"></a><span class="lineno"> 7160</span>&#160;      }</div>
<div class="line"><a name="l07161"></a><span class="lineno"> 7161</span>&#160;    }</div>
<div class="line"><a name="l07162"></a><span class="lineno"> 7162</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a>;</div>
<div class="line"><a name="l07163"></a><span class="lineno"> 7163</span>&#160;  }</div>
<div class="line"><a name="l07164"></a><span class="lineno"> 7164</span>&#160;  <span class="keywordflow">case</span> Instruction::ZExt:</div>
<div class="line"><a name="l07165"></a><span class="lineno"> 7165</span>&#160;  <span class="keywordflow">case</span> Instruction::SExt:</div>
<div class="line"><a name="l07166"></a><span class="lineno"> 7166</span>&#160;  <span class="keywordflow">case</span> Instruction::FPToUI:</div>
<div class="line"><a name="l07167"></a><span class="lineno"> 7167</span>&#160;  <span class="keywordflow">case</span> Instruction::FPToSI:</div>
<div class="line"><a name="l07168"></a><span class="lineno"> 7168</span>&#160;  <span class="keywordflow">case</span> Instruction::FPExt:</div>
<div class="line"><a name="l07169"></a><span class="lineno"> 7169</span>&#160;  <span class="keywordflow">case</span> Instruction::PtrToInt:</div>
<div class="line"><a name="l07170"></a><span class="lineno"> 7170</span>&#160;  <span class="keywordflow">case</span> Instruction::IntToPtr:</div>
<div class="line"><a name="l07171"></a><span class="lineno"> 7171</span>&#160;  <span class="keywordflow">case</span> Instruction::SIToFP:</div>
<div class="line"><a name="l07172"></a><span class="lineno"> 7172</span>&#160;  <span class="keywordflow">case</span> Instruction::UIToFP:</div>
<div class="line"><a name="l07173"></a><span class="lineno"> 7173</span>&#160;  <span class="keywordflow">case</span> Instruction::Trunc:</div>
<div class="line"><a name="l07174"></a><span class="lineno"> 7174</span>&#160;  <span class="keywordflow">case</span> Instruction::FPTrunc:</div>
<div class="line"><a name="l07175"></a><span class="lineno"> 7175</span>&#160;  <span class="keywordflow">case</span> Instruction::BitCast: {</div>
<div class="line"><a name="l07176"></a><span class="lineno"> 7176</span>&#160;    <span class="keyword">auto</span> GetScalarCost = [=](<span class="keywordtype">unsigned</span> Idx) {</div>
<div class="line"><a name="l07177"></a><span class="lineno"> 7177</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a> = cast&lt;Instruction&gt;(VL[Idx]);</div>
<div class="line"><a name="l07178"></a><span class="lineno"> 7178</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a425eab58717b81784602a0b169dd9ff8">getCastInstrCost</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode(), ScalarTy,</div>
<div class="line"><a name="l07179"></a><span class="lineno"> 7179</span>&#160;                                   <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>-&gt;getOperand(0)-&gt;getType(),</div>
<div class="line"><a name="l07180"></a><span class="lineno"> 7180</span>&#160;                                   <a class="code" href="classllvm_1_1TargetTransformInfo.html#a096c8b641174dc0e486006926c5202cf">TTI::getCastContextHint</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>), <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>);</div>
<div class="line"><a name="l07181"></a><span class="lineno"> 7181</span>&#160;    };</div>
<div class="line"><a name="l07182"></a><span class="lineno"> 7182</span>&#160;    <span class="keyword">auto</span> GetVectorCost = [=](<a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> CommonCost) {</div>
<div class="line"><a name="l07183"></a><span class="lineno"> 7183</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *SrcTy = VL0-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l07184"></a><span class="lineno"> 7184</span>&#160;      <span class="keyword">auto</span> *SrcVecTy = <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(SrcTy, VL.size());</div>
<div class="line"><a name="l07185"></a><span class="lineno"> 7185</span>&#160;      <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> VecCost = CommonCost;</div>
<div class="line"><a name="l07186"></a><span class="lineno"> 7186</span>&#160;      <span class="comment">// Check if the values are candidates to demote.</span></div>
<div class="line"><a name="l07187"></a><span class="lineno"> 7187</span>&#160;      <span class="keywordflow">if</span> (!MinBWs.count(VL0) || VecTy != SrcVecTy)</div>
<div class="line"><a name="l07188"></a><span class="lineno"> 7188</span>&#160;        VecCost +=</div>
<div class="line"><a name="l07189"></a><span class="lineno"> 7189</span>&#160;            <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a425eab58717b81784602a0b169dd9ff8">getCastInstrCost</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode(), VecTy, SrcVecTy,</div>
<div class="line"><a name="l07190"></a><span class="lineno"> 7190</span>&#160;                                  <a class="code" href="classllvm_1_1TargetTransformInfo.html#a096c8b641174dc0e486006926c5202cf">TTI::getCastContextHint</a>(VL0), <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>, VL0);</div>
<div class="line"><a name="l07191"></a><span class="lineno"> 7191</span>&#160;      <span class="keywordflow">return</span> VecCost;</div>
<div class="line"><a name="l07192"></a><span class="lineno"> 7192</span>&#160;    };</div>
<div class="line"><a name="l07193"></a><span class="lineno"> 7193</span>&#160;    <span class="keywordflow">return</span> GetCostDiff(GetScalarCost, GetVectorCost);</div>
<div class="line"><a name="l07194"></a><span class="lineno"> 7194</span>&#160;  }</div>
<div class="line"><a name="l07195"></a><span class="lineno"> 7195</span>&#160;  <span class="keywordflow">case</span> Instruction::FCmp:</div>
<div class="line"><a name="l07196"></a><span class="lineno"> 7196</span>&#160;  <span class="keywordflow">case</span> Instruction::ICmp:</div>
<div class="line"><a name="l07197"></a><span class="lineno"> 7197</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Instruction::Select</a>: {</div>
<div class="line"><a name="l07198"></a><span class="lineno"> 7198</span>&#160;    <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> VecPred, SwappedVecPred;</div>
<div class="line"><a name="l07199"></a><span class="lineno"> 7199</span>&#160;    <span class="keyword">auto</span> MatchCmp = <a class="code" href="namespacellvm_1_1PatternMatch.html#a753e1338645ec04d045211b8a46d968d">m_Cmp</a>(VecPred, <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>());</div>
<div class="line"><a name="l07200"></a><span class="lineno"> 7200</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VL0, <a class="code" href="namespacellvm_1_1PatternMatch.html#addb87fe3f509b7803d3f5933ee24b560">m_Select</a>(MatchCmp, <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>())) ||</div>
<div class="line"><a name="l07201"></a><span class="lineno"> 7201</span>&#160;        <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VL0, MatchCmp))</div>
<div class="line"><a name="l07202"></a><span class="lineno"> 7202</span>&#160;      SwappedVecPred = <a class="code" href="classllvm_1_1CmpInst.html#a49a2d8f483ea08a3d6ea75f90c640d76">CmpInst::getSwappedPredicate</a>(VecPred);</div>
<div class="line"><a name="l07203"></a><span class="lineno"> 7203</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l07204"></a><span class="lineno"> 7204</span>&#160;      SwappedVecPred = VecPred = ScalarTy-&gt;<a class="code" href="classllvm_1_1Type.html#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>()</div>
<div class="line"><a name="l07205"></a><span class="lineno"> 7205</span>&#160;                                     ? <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78bad99425e1c7df18b4be5edbffbf896e55">CmpInst::BAD_FCMP_PREDICATE</a></div>
<div class="line"><a name="l07206"></a><span class="lineno"> 7206</span>&#160;                                     : <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba07aee43ffb66908a25c55c77ce4c0d05">CmpInst::BAD_ICMP_PREDICATE</a>;</div>
<div class="line"><a name="l07207"></a><span class="lineno"> 7207</span>&#160;    <span class="keyword">auto</span> GetScalarCost = [&amp;](<span class="keywordtype">unsigned</span> Idx) {</div>
<div class="line"><a name="l07208"></a><span class="lineno"> 7208</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a> = cast&lt;Instruction&gt;(VL[Idx]);</div>
<div class="line"><a name="l07209"></a><span class="lineno"> 7209</span>&#160;      <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> CurrentPred = ScalarTy-&gt;<a class="code" href="classllvm_1_1Type.html#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>()</div>
<div class="line"><a name="l07210"></a><span class="lineno"> 7210</span>&#160;                                           ? <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78bad99425e1c7df18b4be5edbffbf896e55">CmpInst::BAD_FCMP_PREDICATE</a></div>
<div class="line"><a name="l07211"></a><span class="lineno"> 7211</span>&#160;                                           : <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba07aee43ffb66908a25c55c77ce4c0d05">CmpInst::BAD_ICMP_PREDICATE</a>;</div>
<div class="line"><a name="l07212"></a><span class="lineno"> 7212</span>&#160;      <span class="keyword">auto</span> MatchCmp = <a class="code" href="namespacellvm_1_1PatternMatch.html#a753e1338645ec04d045211b8a46d968d">m_Cmp</a>(CurrentPred, <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>());</div>
<div class="line"><a name="l07213"></a><span class="lineno"> 7213</span>&#160;      <span class="keywordflow">if</span> ((!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#addb87fe3f509b7803d3f5933ee24b560">m_Select</a>(MatchCmp, <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>())) &amp;&amp;</div>
<div class="line"><a name="l07214"></a><span class="lineno"> 7214</span>&#160;           !<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>, MatchCmp)) ||</div>
<div class="line"><a name="l07215"></a><span class="lineno"> 7215</span>&#160;          (CurrentPred != VecPred &amp;&amp; CurrentPred != SwappedVecPred))</div>
<div class="line"><a name="l07216"></a><span class="lineno"> 7216</span>&#160;        VecPred = SwappedVecPred = ScalarTy-&gt;<a class="code" href="classllvm_1_1Type.html#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>()</div>
<div class="line"><a name="l07217"></a><span class="lineno"> 7217</span>&#160;                                       ? <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78bad99425e1c7df18b4be5edbffbf896e55">CmpInst::BAD_FCMP_PREDICATE</a></div>
<div class="line"><a name="l07218"></a><span class="lineno"> 7218</span>&#160;                                       : <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba07aee43ffb66908a25c55c77ce4c0d05">CmpInst::BAD_ICMP_PREDICATE</a>;</div>
<div class="line"><a name="l07219"></a><span class="lineno"> 7219</span>&#160; </div>
<div class="line"><a name="l07220"></a><span class="lineno"> 7220</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#af89277d8bd76d6348291e29b6076796a">getCmpSelInstrCost</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode(), ScalarTy,</div>
<div class="line"><a name="l07221"></a><span class="lineno"> 7221</span>&#160;                                     <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt1Ty(), CurrentPred, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>,</div>
<div class="line"><a name="l07222"></a><span class="lineno"> 7222</span>&#160;                                     <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>);</div>
<div class="line"><a name="l07223"></a><span class="lineno"> 7223</span>&#160;    };</div>
<div class="line"><a name="l07224"></a><span class="lineno"> 7224</span>&#160;    <span class="keyword">auto</span> GetVectorCost = [&amp;](<a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> CommonCost) {</div>
<div class="line"><a name="l07225"></a><span class="lineno"> 7225</span>&#160;      <span class="keyword">auto</span> *MaskTy = <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt1Ty(), VL.size());</div>
<div class="line"><a name="l07226"></a><span class="lineno"> 7226</span>&#160; </div>
<div class="line"><a name="l07227"></a><span class="lineno"> 7227</span>&#160;      <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> VecCost = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#af89277d8bd76d6348291e29b6076796a">getCmpSelInstrCost</a>(</div>
<div class="line"><a name="l07228"></a><span class="lineno"> 7228</span>&#160;          <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode(), VecTy, MaskTy, VecPred, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>, VL0);</div>
<div class="line"><a name="l07229"></a><span class="lineno"> 7229</span>&#160;      <span class="comment">// Check if it is possible and profitable to use min/max for selects</span></div>
<div class="line"><a name="l07230"></a><span class="lineno"> 7230</span>&#160;      <span class="comment">// in VL.</span></div>
<div class="line"><a name="l07231"></a><span class="lineno"> 7231</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l07232"></a><span class="lineno"> 7232</span>&#160;      <span class="keyword">auto</span> IntrinsicAndUse = <a class="code" href="namespacellvm.html#a323137971325611ddc1b899b00b8aaa0">canConvertToMinOrMaxIntrinsic</a>(VL);</div>
<div class="line"><a name="l07233"></a><span class="lineno"> 7233</span>&#160;      <span class="keywordflow">if</span> (IntrinsicAndUse.first != <a class="code" href="namespacellvm_1_1Intrinsic.html#a35fedf4db6d756bd82501607f93c1e79aab5fb650050f184fa7c19c26abde5226">Intrinsic::not_intrinsic</a>) {</div>
<div class="line"><a name="l07234"></a><span class="lineno"> 7234</span>&#160;        <a class="code" href="classllvm_1_1IntrinsicCostAttributes.html">IntrinsicCostAttributes</a> CostAttrs(IntrinsicAndUse.first, VecTy,</div>
<div class="line"><a name="l07235"></a><span class="lineno"> 7235</span>&#160;                                          {VecTy, VecTy});</div>
<div class="line"><a name="l07236"></a><span class="lineno"> 7236</span>&#160;        <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> IntrinsicCost =</div>
<div class="line"><a name="l07237"></a><span class="lineno"> 7237</span>&#160;            <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a4218f47749d093473e680ad0199fb239">getIntrinsicInstrCost</a>(CostAttrs, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>);</div>
<div class="line"><a name="l07238"></a><span class="lineno"> 7238</span>&#160;        <span class="comment">// If the selects are the only uses of the compares, they will be</span></div>
<div class="line"><a name="l07239"></a><span class="lineno"> 7239</span>&#160;        <span class="comment">// dead and we can adjust the cost by removing their cost.</span></div>
<div class="line"><a name="l07240"></a><span class="lineno"> 7240</span>&#160;        <span class="keywordflow">if</span> (IntrinsicAndUse.second)</div>
<div class="line"><a name="l07241"></a><span class="lineno"> 7241</span>&#160;          IntrinsicCost -= <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#af89277d8bd76d6348291e29b6076796a">getCmpSelInstrCost</a>(Instruction::ICmp, VecTy,</div>
<div class="line"><a name="l07242"></a><span class="lineno"> 7242</span>&#160;                                                   MaskTy, VecPred, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>);</div>
<div class="line"><a name="l07243"></a><span class="lineno"> 7243</span>&#160;        VecCost = <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(VecCost, IntrinsicCost);</div>
<div class="line"><a name="l07244"></a><span class="lineno"> 7244</span>&#160;      }</div>
<div class="line"><a name="l07245"></a><span class="lineno"> 7245</span>&#160;      <span class="keywordflow">return</span> VecCost + CommonCost;</div>
<div class="line"><a name="l07246"></a><span class="lineno"> 7246</span>&#160;    };</div>
<div class="line"><a name="l07247"></a><span class="lineno"> 7247</span>&#160;    <span class="keywordflow">return</span> GetCostDiff(GetScalarCost, GetVectorCost);</div>
<div class="line"><a name="l07248"></a><span class="lineno"> 7248</span>&#160;  }</div>
<div class="line"><a name="l07249"></a><span class="lineno"> 7249</span>&#160;  <span class="keywordflow">case</span> Instruction::FNeg:</div>
<div class="line"><a name="l07250"></a><span class="lineno"> 7250</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec">Instruction::Add</a>:</div>
<div class="line"><a name="l07251"></a><span class="lineno"> 7251</span>&#160;  <span class="keywordflow">case</span> Instruction::FAdd:</div>
<div class="line"><a name="l07252"></a><span class="lineno"> 7252</span>&#160;  <span class="keywordflow">case</span> Instruction::Sub:</div>
<div class="line"><a name="l07253"></a><span class="lineno"> 7253</span>&#160;  <span class="keywordflow">case</span> Instruction::FSub:</div>
<div class="line"><a name="l07254"></a><span class="lineno"> 7254</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="X86PartialReduction_8cpp.html#ae0f503db91504a3f3440ab81260e4134">Instruction::Mul</a>:</div>
<div class="line"><a name="l07255"></a><span class="lineno"> 7255</span>&#160;  <span class="keywordflow">case</span> Instruction::FMul:</div>
<div class="line"><a name="l07256"></a><span class="lineno"> 7256</span>&#160;  <span class="keywordflow">case</span> Instruction::UDiv:</div>
<div class="line"><a name="l07257"></a><span class="lineno"> 7257</span>&#160;  <span class="keywordflow">case</span> Instruction::SDiv:</div>
<div class="line"><a name="l07258"></a><span class="lineno"> 7258</span>&#160;  <span class="keywordflow">case</span> Instruction::FDiv:</div>
<div class="line"><a name="l07259"></a><span class="lineno"> 7259</span>&#160;  <span class="keywordflow">case</span> Instruction::URem:</div>
<div class="line"><a name="l07260"></a><span class="lineno"> 7260</span>&#160;  <span class="keywordflow">case</span> Instruction::SRem:</div>
<div class="line"><a name="l07261"></a><span class="lineno"> 7261</span>&#160;  <span class="keywordflow">case</span> Instruction::FRem:</div>
<div class="line"><a name="l07262"></a><span class="lineno"> 7262</span>&#160;  <span class="keywordflow">case</span> Instruction::Shl:</div>
<div class="line"><a name="l07263"></a><span class="lineno"> 7263</span>&#160;  <span class="keywordflow">case</span> Instruction::LShr:</div>
<div class="line"><a name="l07264"></a><span class="lineno"> 7264</span>&#160;  <span class="keywordflow">case</span> Instruction::AShr:</div>
<div class="line"><a name="l07265"></a><span class="lineno"> 7265</span>&#160;  <span class="keywordflow">case</span> Instruction::And:</div>
<div class="line"><a name="l07266"></a><span class="lineno"> 7266</span>&#160;  <span class="keywordflow">case</span> Instruction::Or:</div>
<div class="line"><a name="l07267"></a><span class="lineno"> 7267</span>&#160;  <span class="keywordflow">case</span> Instruction::Xor: {</div>
<div class="line"><a name="l07268"></a><span class="lineno"> 7268</span>&#160;    <span class="keyword">auto</span> GetScalarCost = [=](<span class="keywordtype">unsigned</span> Idx) {</div>
<div class="line"><a name="l07269"></a><span class="lineno"> 7269</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a> = cast&lt;Instruction&gt;(VL[Idx]);</div>
<div class="line"><a name="l07270"></a><span class="lineno"> 7270</span>&#160;      <span class="keywordtype">unsigned</span> OpIdx = isa&lt;UnaryOperator&gt;(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>) ? 0 : 1;</div>
<div class="line"><a name="l07271"></a><span class="lineno"> 7271</span>&#160;      <a class="code" href="structllvm_1_1TargetTransformInfo_1_1OperandValueInfo.html">TTI::OperandValueInfo</a> Op1Info = <a class="code" href="classllvm_1_1TargetTransformInfo.html#a5fecba95c1ba20950ea8e2139127e621">TTI::getOperandInfo</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>-&gt;getOperand(0));</div>
<div class="line"><a name="l07272"></a><span class="lineno"> 7272</span>&#160;      <a class="code" href="structllvm_1_1TargetTransformInfo_1_1OperandValueInfo.html">TTI::OperandValueInfo</a> Op2Info =</div>
<div class="line"><a name="l07273"></a><span class="lineno"> 7273</span>&#160;          <a class="code" href="classllvm_1_1TargetTransformInfo.html#a5fecba95c1ba20950ea8e2139127e621">TTI::getOperandInfo</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>-&gt;getOperand(OpIdx));</div>
<div class="line"><a name="l07274"></a><span class="lineno"> 7274</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const Value *&gt;</a> <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>-&gt;operand_values());</div>
<div class="line"><a name="l07275"></a><span class="lineno"> 7275</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a9679969ae87f8a08d5f6948be6cf7210">getArithmeticInstrCost</a>(ShuffleOrOp, ScalarTy, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>,</div>
<div class="line"><a name="l07276"></a><span class="lineno"> 7276</span>&#160;                                         Op1Info, Op2Info, <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>);</div>
<div class="line"><a name="l07277"></a><span class="lineno"> 7277</span>&#160;    };</div>
<div class="line"><a name="l07278"></a><span class="lineno"> 7278</span>&#160;    <span class="keyword">auto</span> GetVectorCost = [=](<a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> CommonCost) {</div>
<div class="line"><a name="l07279"></a><span class="lineno"> 7279</span>&#160;      <span class="keywordtype">unsigned</span> OpIdx = isa&lt;UnaryOperator&gt;(VL0) ? 0 : 1;</div>
<div class="line"><a name="l07280"></a><span class="lineno"> 7280</span>&#160;      <a class="code" href="structllvm_1_1TargetTransformInfo_1_1OperandValueInfo.html">TTI::OperandValueInfo</a> Op1Info = getOperandInfo(VL, 0);</div>
<div class="line"><a name="l07281"></a><span class="lineno"> 7281</span>&#160;      <a class="code" href="structllvm_1_1TargetTransformInfo_1_1OperandValueInfo.html">TTI::OperandValueInfo</a> Op2Info = getOperandInfo(VL, OpIdx);</div>
<div class="line"><a name="l07282"></a><span class="lineno"> 7282</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a9679969ae87f8a08d5f6948be6cf7210">getArithmeticInstrCost</a>(ShuffleOrOp, VecTy, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>, Op1Info,</div>
<div class="line"><a name="l07283"></a><span class="lineno"> 7283</span>&#160;                                         Op2Info) +</div>
<div class="line"><a name="l07284"></a><span class="lineno"> 7284</span>&#160;             CommonCost;</div>
<div class="line"><a name="l07285"></a><span class="lineno"> 7285</span>&#160;    };</div>
<div class="line"><a name="l07286"></a><span class="lineno"> 7286</span>&#160;    <span class="keywordflow">return</span> GetCostDiff(GetScalarCost, GetVectorCost);</div>
<div class="line"><a name="l07287"></a><span class="lineno"> 7287</span>&#160;  }</div>
<div class="line"><a name="l07288"></a><span class="lineno"> 7288</span>&#160;  <span class="keywordflow">case</span> Instruction::GetElementPtr: {</div>
<div class="line"><a name="l07289"></a><span class="lineno"> 7289</span>&#160;    <span class="keywordflow">return</span> CommonCost + GetGEPCostDiff(VL, VL0);</div>
<div class="line"><a name="l07290"></a><span class="lineno"> 7290</span>&#160;  }</div>
<div class="line"><a name="l07291"></a><span class="lineno"> 7291</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Instruction::Load</a>: {</div>
<div class="line"><a name="l07292"></a><span class="lineno"> 7292</span>&#160;    <span class="keyword">auto</span> GetScalarCost = [=](<span class="keywordtype">unsigned</span> Idx) {</div>
<div class="line"><a name="l07293"></a><span class="lineno"> 7293</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a> = cast&lt;LoadInst&gt;(VL[Idx]);</div>
<div class="line"><a name="l07294"></a><span class="lineno"> 7294</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a34c987c590db0e5cff66d9869a34c556">getMemoryOpCost</a>(<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Instruction::Load</a>, ScalarTy, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>-&gt;getAlign(),</div>
<div class="line"><a name="l07295"></a><span class="lineno"> 7295</span>&#160;                                  <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>-&gt;getPointerAddressSpace(), <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>,</div>
<div class="line"><a name="l07296"></a><span class="lineno"> 7296</span>&#160;                                  <a class="code" href="structllvm_1_1TargetTransformInfo_1_1OperandValueInfo.html">TTI::OperandValueInfo</a>(), <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>);</div>
<div class="line"><a name="l07297"></a><span class="lineno"> 7297</span>&#160;    };</div>
<div class="line"><a name="l07298"></a><span class="lineno"> 7298</span>&#160;    <span class="keyword">auto</span> *LI0 = cast&lt;LoadInst&gt;(VL0);</div>
<div class="line"><a name="l07299"></a><span class="lineno"> 7299</span>&#160;    <span class="keyword">auto</span> GetVectorCost = [=](<a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> CommonCost) {</div>
<div class="line"><a name="l07300"></a><span class="lineno"> 7300</span>&#160;      <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> VecLdCost;</div>
<div class="line"><a name="l07301"></a><span class="lineno"> 7301</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;State == TreeEntry::Vectorize) {</div>
<div class="line"><a name="l07302"></a><span class="lineno"> 7302</span>&#160;        VecLdCost = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a34c987c590db0e5cff66d9869a34c556">getMemoryOpCost</a>(</div>
<div class="line"><a name="l07303"></a><span class="lineno"> 7303</span>&#160;            <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Instruction::Load</a>, VecTy, LI0-&gt;getAlign(),</div>
<div class="line"><a name="l07304"></a><span class="lineno"> 7304</span>&#160;            LI0-&gt;getPointerAddressSpace(), <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>, <a class="code" href="structllvm_1_1TargetTransformInfo_1_1OperandValueInfo.html">TTI::OperandValueInfo</a>());</div>
<div class="line"><a name="l07305"></a><span class="lineno"> 7305</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l07306"></a><span class="lineno"> 7306</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;State == TreeEntry::ScatterVectorize &amp;&amp; <span class="stringliteral">&quot;Unknown EntryState&quot;</span>);</div>
<div class="line"><a name="l07307"></a><span class="lineno"> 7307</span>&#160;        <a class="code" href="structllvm_1_1Align.html">Align</a> CommonAlignment = LI0-&gt;getAlign();</div>
<div class="line"><a name="l07308"></a><span class="lineno"> 7308</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL)</div>
<div class="line"><a name="l07309"></a><span class="lineno"> 7309</span>&#160;          CommonAlignment =</div>
<div class="line"><a name="l07310"></a><span class="lineno"> 7310</span>&#160;              <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(CommonAlignment, cast&lt;LoadInst&gt;(V)-&gt;<a class="code" href="namespacellvm.html#a2ec9079c9e11f3cad2a09d84a9c617f6">getAlign</a>());</div>
<div class="line"><a name="l07311"></a><span class="lineno"> 7311</span>&#160;        VecLdCost = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#aa0f4a801858ac7255f623ca0ec53394f">getGatherScatterOpCost</a>(</div>
<div class="line"><a name="l07312"></a><span class="lineno"> 7312</span>&#160;            <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Instruction::Load</a>, VecTy, LI0-&gt;getPointerOperand(),</div>
<div class="line"><a name="l07313"></a><span class="lineno"> 7313</span>&#160;            <span class="comment">/*VariableMask=*/</span><span class="keyword">false</span>, CommonAlignment, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>);</div>
<div class="line"><a name="l07314"></a><span class="lineno"> 7314</span>&#160;      }</div>
<div class="line"><a name="l07315"></a><span class="lineno"> 7315</span>&#160;      <span class="keywordflow">return</span> VecLdCost + CommonCost;</div>
<div class="line"><a name="l07316"></a><span class="lineno"> 7316</span>&#160;    };</div>
<div class="line"><a name="l07317"></a><span class="lineno"> 7317</span>&#160; </div>
<div class="line"><a name="l07318"></a><span class="lineno"> 7318</span>&#160;    <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> = GetCostDiff(GetScalarCost, GetVectorCost);</div>
<div class="line"><a name="l07319"></a><span class="lineno"> 7319</span>&#160;    <span class="comment">// If this node generates masked gather load then it is not a terminal node.</span></div>
<div class="line"><a name="l07320"></a><span class="lineno"> 7320</span>&#160;    <span class="comment">// Hence address operand cost is estimated separately.</span></div>
<div class="line"><a name="l07321"></a><span class="lineno"> 7321</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;State == TreeEntry::ScatterVectorize)</div>
<div class="line"><a name="l07322"></a><span class="lineno"> 7322</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a>;</div>
<div class="line"><a name="l07323"></a><span class="lineno"> 7323</span>&#160; </div>
<div class="line"><a name="l07324"></a><span class="lineno"> 7324</span>&#160;    <span class="comment">// Estimate cost of GEPs since this tree node is a terminator.</span></div>
<div class="line"><a name="l07325"></a><span class="lineno"> 7325</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *&gt;</a> PointerOps(VL.size());</div>
<div class="line"><a name="l07326"></a><span class="lineno"> 7326</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> [<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, V] : <a class="code" href="namespacellvm.html#a7b2175e18ff52174fad26b6b68818564">enumerate</a>(VL))</div>
<div class="line"><a name="l07327"></a><span class="lineno"> 7327</span>&#160;      PointerOps[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = cast&lt;LoadInst&gt;(V)-&gt;getPointerOperand();</div>
<div class="line"><a name="l07328"></a><span class="lineno"> 7328</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> + GetGEPCostDiff(PointerOps, LI0-&gt;getPointerOperand());</div>
<div class="line"><a name="l07329"></a><span class="lineno"> 7329</span>&#160;  }</div>
<div class="line"><a name="l07330"></a><span class="lineno"> 7330</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Instruction::Store</a>: {</div>
<div class="line"><a name="l07331"></a><span class="lineno"> 7331</span>&#160;    <span class="keywordtype">bool</span> IsReorder = !<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReorderIndices.empty();</div>
<div class="line"><a name="l07332"></a><span class="lineno"> 7332</span>&#160;    <span class="keyword">auto</span> GetScalarCost = [=](<span class="keywordtype">unsigned</span> Idx) {</div>
<div class="line"><a name="l07333"></a><span class="lineno"> 7333</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a> = cast&lt;StoreInst&gt;(VL[Idx]);</div>
<div class="line"><a name="l07334"></a><span class="lineno"> 7334</span>&#160;      <a class="code" href="structllvm_1_1TargetTransformInfo_1_1OperandValueInfo.html">TTI::OperandValueInfo</a> OpInfo = getOperandInfo(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>, 0);</div>
<div class="line"><a name="l07335"></a><span class="lineno"> 7335</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a34c987c590db0e5cff66d9869a34c556">getMemoryOpCost</a>(<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Instruction::Store</a>, ScalarTy, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>-&gt;getAlign(),</div>
<div class="line"><a name="l07336"></a><span class="lineno"> 7336</span>&#160;                                  <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>-&gt;getPointerAddressSpace(), <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>,</div>
<div class="line"><a name="l07337"></a><span class="lineno"> 7337</span>&#160;                                  OpInfo, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>);</div>
<div class="line"><a name="l07338"></a><span class="lineno"> 7338</span>&#160;    };</div>
<div class="line"><a name="l07339"></a><span class="lineno"> 7339</span>&#160;    <span class="keyword">auto</span> *BaseSI =</div>
<div class="line"><a name="l07340"></a><span class="lineno"> 7340</span>&#160;        cast&lt;StoreInst&gt;(IsReorder ? VL[<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReorderIndices.front()] : VL0);</div>
<div class="line"><a name="l07341"></a><span class="lineno"> 7341</span>&#160;    <span class="keyword">auto</span> GetVectorCost = [=](<a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> CommonCost) {</div>
<div class="line"><a name="l07342"></a><span class="lineno"> 7342</span>&#160;      <span class="comment">// We know that we can merge the stores. Calculate the cost.</span></div>
<div class="line"><a name="l07343"></a><span class="lineno"> 7343</span>&#160;      <a class="code" href="structllvm_1_1TargetTransformInfo_1_1OperandValueInfo.html">TTI::OperandValueInfo</a> OpInfo = getOperandInfo(VL, 0);</div>
<div class="line"><a name="l07344"></a><span class="lineno"> 7344</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a34c987c590db0e5cff66d9869a34c556">getMemoryOpCost</a>(<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Instruction::Store</a>, VecTy, BaseSI-&gt;getAlign(),</div>
<div class="line"><a name="l07345"></a><span class="lineno"> 7345</span>&#160;                                  BaseSI-&gt;getPointerAddressSpace(), <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>,</div>
<div class="line"><a name="l07346"></a><span class="lineno"> 7346</span>&#160;                                  OpInfo) +</div>
<div class="line"><a name="l07347"></a><span class="lineno"> 7347</span>&#160;             CommonCost;</div>
<div class="line"><a name="l07348"></a><span class="lineno"> 7348</span>&#160;    };</div>
<div class="line"><a name="l07349"></a><span class="lineno"> 7349</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *&gt;</a> PointerOps(VL.size());</div>
<div class="line"><a name="l07350"></a><span class="lineno"> 7350</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> [<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, V] : <a class="code" href="namespacellvm.html#a7b2175e18ff52174fad26b6b68818564">enumerate</a>(VL)) {</div>
<div class="line"><a name="l07351"></a><span class="lineno"> 7351</span>&#160;      <span class="keywordtype">unsigned</span> Idx = IsReorder ? <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReorderIndices[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] : <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l07352"></a><span class="lineno"> 7352</span>&#160;      PointerOps[Idx] = cast&lt;StoreInst&gt;(V)-&gt;getPointerOperand();</div>
<div class="line"><a name="l07353"></a><span class="lineno"> 7353</span>&#160;    }</div>
<div class="line"><a name="l07354"></a><span class="lineno"> 7354</span>&#160; </div>
<div class="line"><a name="l07355"></a><span class="lineno"> 7355</span>&#160;    <span class="keywordflow">return</span> GetCostDiff(GetScalarCost, GetVectorCost) +</div>
<div class="line"><a name="l07356"></a><span class="lineno"> 7356</span>&#160;           GetGEPCostDiff(PointerOps, BaseSI-&gt;getPointerOperand());</div>
<div class="line"><a name="l07357"></a><span class="lineno"> 7357</span>&#160;  }</div>
<div class="line"><a name="l07358"></a><span class="lineno"> 7358</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Instruction::Call</a>: {</div>
<div class="line"><a name="l07359"></a><span class="lineno"> 7359</span>&#160;    <span class="keyword">auto</span> GetScalarCost = [=](<span class="keywordtype">unsigned</span> Idx) {</div>
<div class="line"><a name="l07360"></a><span class="lineno"> 7360</span>&#160;      <span class="keyword">auto</span> *CI = cast&lt;CallInst&gt;(VL[Idx]);</div>
<div class="line"><a name="l07361"></a><span class="lineno"> 7361</span>&#160;      <a class="code" href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> <a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a> = <a class="code" href="namespacellvm.html#a11c66d01880f53332fc7ad53f565b039">getVectorIntrinsicIDForCall</a>(CI, TLI);</div>
<div class="line"><a name="l07362"></a><span class="lineno"> 7362</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a> != <a class="code" href="namespacellvm_1_1Intrinsic.html#a35fedf4db6d756bd82501607f93c1e79aab5fb650050f184fa7c19c26abde5226">Intrinsic::not_intrinsic</a>) {</div>
<div class="line"><a name="l07363"></a><span class="lineno"> 7363</span>&#160;        <a class="code" href="classllvm_1_1IntrinsicCostAttributes.html">IntrinsicCostAttributes</a> CostAttrs(<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>, *CI, 1);</div>
<div class="line"><a name="l07364"></a><span class="lineno"> 7364</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a4218f47749d093473e680ad0199fb239">getIntrinsicInstrCost</a>(CostAttrs, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>);</div>
<div class="line"><a name="l07365"></a><span class="lineno"> 7365</span>&#160;      }</div>
<div class="line"><a name="l07366"></a><span class="lineno"> 7366</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#af67833027bb46ddb390684a6f0b75398">getCallInstrCost</a>(CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#a83b8c9e572130f403445c0b0f69b837c">getCalledFunction</a>(),</div>
<div class="line"><a name="l07367"></a><span class="lineno"> 7367</span>&#160;                                   CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#a5e4a09f80c7cd5283dbbc7256d122d12">getFunctionType</a>()-&gt;<a class="code" href="classllvm_1_1FunctionType.html#ac453ad79a3d50950bac79bc9dff85918">getReturnType</a>(),</div>
<div class="line"><a name="l07368"></a><span class="lineno"> 7368</span>&#160;                                   CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#a5e4a09f80c7cd5283dbbc7256d122d12">getFunctionType</a>()-&gt;<a class="code" href="classllvm_1_1FunctionType.html#a0400b7a6fcffcd3892d7bb6de435674a">params</a>(), <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>);</div>
<div class="line"><a name="l07369"></a><span class="lineno"> 7369</span>&#160;    };</div>
<div class="line"><a name="l07370"></a><span class="lineno"> 7370</span>&#160;    <span class="keyword">auto</span> GetVectorCost = [=](<a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> CommonCost) {</div>
<div class="line"><a name="l07371"></a><span class="lineno"> 7371</span>&#160;      <span class="keyword">auto</span> *CI = cast&lt;CallInst&gt;(VL0);</div>
<div class="line"><a name="l07372"></a><span class="lineno"> 7372</span>&#160;      <span class="keyword">auto</span> VecCallCosts = <a class="code" href="SLPVectorizer_8cpp.html#af6afa6e00a2ef98815dd54413ab32fe2">getVectorCallCosts</a>(CI, VecTy, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, TLI);</div>
<div class="line"><a name="l07373"></a><span class="lineno"> 7373</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(VecCallCosts.first, VecCallCosts.second) + CommonCost;</div>
<div class="line"><a name="l07374"></a><span class="lineno"> 7374</span>&#160;    };</div>
<div class="line"><a name="l07375"></a><span class="lineno"> 7375</span>&#160;    <span class="keywordflow">return</span> GetCostDiff(GetScalarCost, GetVectorCost);</div>
<div class="line"><a name="l07376"></a><span class="lineno"> 7376</span>&#160;  }</div>
<div class="line"><a name="l07377"></a><span class="lineno"> 7377</span>&#160;  <span class="keywordflow">case</span> Instruction::ShuffleVector: {</div>
<div class="line"><a name="l07378"></a><span class="lineno"> 7378</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;isAltShuffle() &amp;&amp;</div>
<div class="line"><a name="l07379"></a><span class="lineno"> 7379</span>&#160;           ((<a class="code" href="classllvm_1_1Instruction.html#a5c88132322ca3f46f242f7c023a57010">Instruction::isBinaryOp</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode()) &amp;&amp;</div>
<div class="line"><a name="l07380"></a><span class="lineno"> 7380</span>&#160;             <a class="code" href="classllvm_1_1Instruction.html#a5c88132322ca3f46f242f7c023a57010">Instruction::isBinaryOp</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getAltOpcode())) ||</div>
<div class="line"><a name="l07381"></a><span class="lineno"> 7381</span>&#160;            (<a class="code" href="classllvm_1_1Instruction.html#a27997849d8982bf226891024fd68daee">Instruction::isCast</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode()) &amp;&amp;</div>
<div class="line"><a name="l07382"></a><span class="lineno"> 7382</span>&#160;             <a class="code" href="classllvm_1_1Instruction.html#a27997849d8982bf226891024fd68daee">Instruction::isCast</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getAltOpcode())) ||</div>
<div class="line"><a name="l07383"></a><span class="lineno"> 7383</span>&#160;            (isa&lt;CmpInst&gt;(VL0) &amp;&amp; isa&lt;CmpInst&gt;(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getAltOp()))) &amp;&amp;</div>
<div class="line"><a name="l07384"></a><span class="lineno"> 7384</span>&#160;           <span class="stringliteral">&quot;Invalid Shuffle Vector Operand&quot;</span>);</div>
<div class="line"><a name="l07385"></a><span class="lineno"> 7385</span>&#160;    <span class="comment">// Try to find the previous shuffle node with the same operands and same</span></div>
<div class="line"><a name="l07386"></a><span class="lineno"> 7386</span>&#160;    <span class="comment">// main/alternate ops.</span></div>
<div class="line"><a name="l07387"></a><span class="lineno"> 7387</span>&#160;    <span class="keyword">auto</span> TryFindNodeWithEqualOperands = [=]() {</div>
<div class="line"><a name="l07388"></a><span class="lineno"> 7388</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">const</span> std::unique_ptr&lt;TreeEntry&gt; &amp;TE : VectorizableTree) {</div>
<div class="line"><a name="l07389"></a><span class="lineno"> 7389</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.get() == <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>)</div>
<div class="line"><a name="l07390"></a><span class="lineno"> 7390</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l07391"></a><span class="lineno"> 7391</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;isAltShuffle() &amp;&amp;</div>
<div class="line"><a name="l07392"></a><span class="lineno"> 7392</span>&#160;            ((<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;getOpcode() == <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode() &amp;&amp;</div>
<div class="line"><a name="l07393"></a><span class="lineno"> 7393</span>&#160;              <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;getAltOpcode() == <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getAltOpcode()) ||</div>
<div class="line"><a name="l07394"></a><span class="lineno"> 7394</span>&#160;             (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;getOpcode() == <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getAltOpcode() &amp;&amp;</div>
<div class="line"><a name="l07395"></a><span class="lineno"> 7395</span>&#160;              <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;getAltOpcode() == <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode())) &amp;&amp;</div>
<div class="line"><a name="l07396"></a><span class="lineno"> 7396</span>&#160;            <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;hasEqualOperands(*<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>))</div>
<div class="line"><a name="l07397"></a><span class="lineno"> 7397</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07398"></a><span class="lineno"> 7398</span>&#160;      }</div>
<div class="line"><a name="l07399"></a><span class="lineno"> 7399</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07400"></a><span class="lineno"> 7400</span>&#160;    };</div>
<div class="line"><a name="l07401"></a><span class="lineno"> 7401</span>&#160;    <span class="keyword">auto</span> GetScalarCost = [=](<span class="keywordtype">unsigned</span> Idx) {</div>
<div class="line"><a name="l07402"></a><span class="lineno"> 7402</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a> = cast&lt;Instruction&gt;(VL[Idx]);</div>
<div class="line"><a name="l07403"></a><span class="lineno"> 7403</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;isOpcodeOrAlt(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>) &amp;&amp; <span class="stringliteral">&quot;Unexpected main/alternate opcode&quot;</span>);</div>
<div class="line"><a name="l07404"></a><span class="lineno"> 7404</span>&#160;      (void)<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>;</div>
<div class="line"><a name="l07405"></a><span class="lineno"> 7405</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#ac77dbedcfd916a5c9b58e753b2678a98">getInstructionCost</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>);</div>
<div class="line"><a name="l07406"></a><span class="lineno"> 7406</span>&#160;    };</div>
<div class="line"><a name="l07407"></a><span class="lineno"> 7407</span>&#160;    <span class="comment">// Need to clear CommonCost since the final shuffle cost is included into</span></div>
<div class="line"><a name="l07408"></a><span class="lineno"> 7408</span>&#160;    <span class="comment">// vector cost.</span></div>
<div class="line"><a name="l07409"></a><span class="lineno"> 7409</span>&#160;    <span class="keyword">auto</span> GetVectorCost = [&amp;](<a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a>) {</div>
<div class="line"><a name="l07410"></a><span class="lineno"> 7410</span>&#160;      <span class="comment">// VecCost is equal to sum of the cost of creating 2 vectors</span></div>
<div class="line"><a name="l07411"></a><span class="lineno"> 7411</span>&#160;      <span class="comment">// and the cost of creating shuffle.</span></div>
<div class="line"><a name="l07412"></a><span class="lineno"> 7412</span>&#160;      <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> VecCost = 0;</div>
<div class="line"><a name="l07413"></a><span class="lineno"> 7413</span>&#160;      <span class="keywordflow">if</span> (TryFindNodeWithEqualOperands()) {</div>
<div class="line"><a name="l07414"></a><span class="lineno"> 7414</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>({</div>
<div class="line"><a name="l07415"></a><span class="lineno"> 7415</span>&#160;          <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: diamond match for alternate node found.\n&quot;</span>;</div>
<div class="line"><a name="l07416"></a><span class="lineno"> 7416</span>&#160;          <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;dump();</div>
<div class="line"><a name="l07417"></a><span class="lineno"> 7417</span>&#160;        });</div>
<div class="line"><a name="l07418"></a><span class="lineno"> 7418</span>&#160;        <span class="comment">// No need to add new vector costs here since we&#39;re going to reuse</span></div>
<div class="line"><a name="l07419"></a><span class="lineno"> 7419</span>&#160;        <span class="comment">// same main/alternate vector ops, just do different shuffling.</span></div>
<div class="line"><a name="l07420"></a><span class="lineno"> 7420</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html#a5c88132322ca3f46f242f7c023a57010">Instruction::isBinaryOp</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode())) {</div>
<div class="line"><a name="l07421"></a><span class="lineno"> 7421</span>&#160;        VecCost = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a9679969ae87f8a08d5f6948be6cf7210">getArithmeticInstrCost</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode(), VecTy, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>);</div>
<div class="line"><a name="l07422"></a><span class="lineno"> 7422</span>&#160;        VecCost +=</div>
<div class="line"><a name="l07423"></a><span class="lineno"> 7423</span>&#160;            <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a9679969ae87f8a08d5f6948be6cf7210">getArithmeticInstrCost</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getAltOpcode(), VecTy, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>);</div>
<div class="line"><a name="l07424"></a><span class="lineno"> 7424</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *CI0 = dyn_cast&lt;CmpInst&gt;(VL0)) {</div>
<div class="line"><a name="l07425"></a><span class="lineno"> 7425</span>&#160;        VecCost = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#af89277d8bd76d6348291e29b6076796a">getCmpSelInstrCost</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode(), ScalarTy,</div>
<div class="line"><a name="l07426"></a><span class="lineno"> 7426</span>&#160;                                          <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt1Ty(),</div>
<div class="line"><a name="l07427"></a><span class="lineno"> 7427</span>&#160;                                          CI0-&gt;getPredicate(), <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>, VL0);</div>
<div class="line"><a name="l07428"></a><span class="lineno"> 7428</span>&#160;        VecCost += <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#af89277d8bd76d6348291e29b6076796a">getCmpSelInstrCost</a>(</div>
<div class="line"><a name="l07429"></a><span class="lineno"> 7429</span>&#160;            <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode(), ScalarTy, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt1Ty(),</div>
<div class="line"><a name="l07430"></a><span class="lineno"> 7430</span>&#160;            cast&lt;CmpInst&gt;(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getAltOp())-&gt;getPredicate(), <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>,</div>
<div class="line"><a name="l07431"></a><span class="lineno"> 7431</span>&#160;            <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getAltOp());</div>
<div class="line"><a name="l07432"></a><span class="lineno"> 7432</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l07433"></a><span class="lineno"> 7433</span>&#160;        <a class="code" href="classllvm_1_1Type.html">Type</a> *Src0SclTy = <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getMainOp()-&gt;getOperand(0)-&gt;getType();</div>
<div class="line"><a name="l07434"></a><span class="lineno"> 7434</span>&#160;        <a class="code" href="classllvm_1_1Type.html">Type</a> *Src1SclTy = <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getAltOp()-&gt;getOperand(0)-&gt;getType();</div>
<div class="line"><a name="l07435"></a><span class="lineno"> 7435</span>&#160;        <span class="keyword">auto</span> *Src0Ty = <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(Src0SclTy, VL.size());</div>
<div class="line"><a name="l07436"></a><span class="lineno"> 7436</span>&#160;        <span class="keyword">auto</span> *Src1Ty = <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(Src1SclTy, VL.size());</div>
<div class="line"><a name="l07437"></a><span class="lineno"> 7437</span>&#160;        VecCost = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a425eab58717b81784602a0b169dd9ff8">getCastInstrCost</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode(), VecTy, Src0Ty,</div>
<div class="line"><a name="l07438"></a><span class="lineno"> 7438</span>&#160;                                        <a class="code" href="classllvm_1_1TargetTransformInfo.html#af84cce349a77262269fd3f6756f37a64a6adf97f83acf6453d4a6a4b1070f3754">TTI::CastContextHint::None</a>, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>);</div>
<div class="line"><a name="l07439"></a><span class="lineno"> 7439</span>&#160;        VecCost += <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a425eab58717b81784602a0b169dd9ff8">getCastInstrCost</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getAltOpcode(), VecTy, Src1Ty,</div>
<div class="line"><a name="l07440"></a><span class="lineno"> 7440</span>&#160;                                         <a class="code" href="classllvm_1_1TargetTransformInfo.html#af84cce349a77262269fd3f6756f37a64a6adf97f83acf6453d4a6a4b1070f3754">TTI::CastContextHint::None</a>, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>);</div>
<div class="line"><a name="l07441"></a><span class="lineno"> 7441</span>&#160;      }</div>
<div class="line"><a name="l07442"></a><span class="lineno"> 7442</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReuseShuffleIndices.empty()) {</div>
<div class="line"><a name="l07443"></a><span class="lineno"> 7443</span>&#160;        VecCost +=</div>
<div class="line"><a name="l07444"></a><span class="lineno"> 7444</span>&#160;            <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#aa0519f26bcb15c25ac0ff557061fa7af">getShuffleCost</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53eca64d439485545faa793c20de7fbfd274c">TargetTransformInfo::SK_Select</a>, FinalVecTy);</div>
<div class="line"><a name="l07445"></a><span class="lineno"> 7445</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l07446"></a><span class="lineno"> 7446</span>&#160;        <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>;</div>
<div class="line"><a name="l07447"></a><span class="lineno"> 7447</span>&#160;        <a class="code" href="SLPVectorizer_8cpp.html#a68f8b6509e5780355450f139ddfe89ec">buildShuffleEntryMask</a>(</div>
<div class="line"><a name="l07448"></a><span class="lineno"> 7448</span>&#160;            <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReorderIndices, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReuseShuffleIndices,</div>
<div class="line"><a name="l07449"></a><span class="lineno"> 7449</span>&#160;            [<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>](<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l07450"></a><span class="lineno"> 7450</span>&#160;              assert(E-&gt;isOpcodeOrAlt(I) &amp;&amp; <span class="stringliteral">&quot;Unexpected main/alternate opcode&quot;</span>);</div>
<div class="line"><a name="l07451"></a><span class="lineno"> 7451</span>&#160;              return I-&gt;getOpcode() == E-&gt;getAltOpcode();</div>
<div class="line"><a name="l07452"></a><span class="lineno"> 7452</span>&#160;            },</div>
<div class="line"><a name="l07453"></a><span class="lineno"> 7453</span>&#160;            <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l07454"></a><span class="lineno"> 7454</span>&#160;        VecCost += <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#aa0519f26bcb15c25ac0ff557061fa7af">getShuffleCost</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53ecab4616961a3bfdaec42aedc4fc426ccfe">TargetTransformInfo::SK_PermuteTwoSrc</a>,</div>
<div class="line"><a name="l07455"></a><span class="lineno"> 7455</span>&#160;                                       FinalVecTy, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l07456"></a><span class="lineno"> 7456</span>&#160;      }</div>
<div class="line"><a name="l07457"></a><span class="lineno"> 7457</span>&#160;      <span class="keywordflow">return</span> VecCost;</div>
<div class="line"><a name="l07458"></a><span class="lineno"> 7458</span>&#160;    };</div>
<div class="line"><a name="l07459"></a><span class="lineno"> 7459</span>&#160;    <span class="keywordflow">return</span> GetCostDiff(GetScalarCost, GetVectorCost);</div>
<div class="line"><a name="l07460"></a><span class="lineno"> 7460</span>&#160;  }</div>
<div class="line"><a name="l07461"></a><span class="lineno"> 7461</span>&#160;  <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l07462"></a><span class="lineno"> 7462</span>&#160;    <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Unknown instruction&quot;</span>);</div>
<div class="line"><a name="l07463"></a><span class="lineno"> 7463</span>&#160;  }</div>
<div class="line"><a name="l07464"></a><span class="lineno"> 7464</span>&#160;}</div>
<div class="line"><a name="l07465"></a><span class="lineno"> 7465</span>&#160; </div>
<div class="line"><a name="l07466"></a><span class="lineno"> 7466</span>&#160;<span class="keywordtype">bool</span> BoUpSLP::isFullyVectorizableTinyTree(<span class="keywordtype">bool</span> ForReduction)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l07467"></a><span class="lineno"> 7467</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Check whether the tree with height &quot;</span></div>
<div class="line"><a name="l07468"></a><span class="lineno"> 7468</span>&#160;                    &lt;&lt; VectorizableTree.size() &lt;&lt; <span class="stringliteral">&quot; is fully vectorizable .\n&quot;</span>);</div>
<div class="line"><a name="l07469"></a><span class="lineno"> 7469</span>&#160; </div>
<div class="line"><a name="l07470"></a><span class="lineno"> 7470</span>&#160;  <span class="keyword">auto</span> &amp;&amp;AreVectorizableGathers = [<span class="keyword">this</span>](<span class="keyword">const</span> TreeEntry *<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>, <span class="keywordtype">unsigned</span> Limit) {</div>
<div class="line"><a name="l07471"></a><span class="lineno"> 7471</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>;</div>
<div class="line"><a name="l07472"></a><span class="lineno"> 7472</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;State == TreeEntry::NeedToGather &amp;&amp;</div>
<div class="line"><a name="l07473"></a><span class="lineno"> 7473</span>&#160;           !<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;Scalars,</div>
<div class="line"><a name="l07474"></a><span class="lineno"> 7474</span>&#160;                   [<span class="keyword">this</span>](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) { return EphValues.contains(V); }) &amp;&amp;</div>
<div class="line"><a name="l07475"></a><span class="lineno"> 7475</span>&#160;           (<a class="code" href="SLPVectorizer_8cpp.html#a7568c08b526dbf7f7b5402f3eb605b55">allConstant</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;Scalars) || <a class="code" href="SLPVectorizer_8cpp.html#a6ef5b86735d738868e5fb00a18643b1c">isSplat</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;Scalars) ||</div>
<div class="line"><a name="l07476"></a><span class="lineno"> 7476</span>&#160;            <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;Scalars.size() &lt; Limit ||</div>
<div class="line"><a name="l07477"></a><span class="lineno"> 7477</span>&#160;            ((<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;getOpcode() == Instruction::ExtractElement ||</div>
<div class="line"><a name="l07478"></a><span class="lineno"> 7478</span>&#160;              <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;Scalars,</div>
<div class="line"><a name="l07479"></a><span class="lineno"> 7479</span>&#160;                     [](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l07480"></a><span class="lineno"> 7480</span>&#160;                       return isa&lt;ExtractElementInst, UndefValue&gt;(V);</div>
<div class="line"><a name="l07481"></a><span class="lineno"> 7481</span>&#160;                     })) &amp;&amp;</div>
<div class="line"><a name="l07482"></a><span class="lineno"> 7482</span>&#160;             <a class="code" href="SLPVectorizer_8cpp.html#a8b409af081b7132c139c0bdc22c5cefd">isFixedVectorShuffle</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;Scalars, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>)) ||</div>
<div class="line"><a name="l07483"></a><span class="lineno"> 7483</span>&#160;            (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;State == TreeEntry::NeedToGather &amp;&amp;</div>
<div class="line"><a name="l07484"></a><span class="lineno"> 7484</span>&#160;             <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;getOpcode() == <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Instruction::Load</a> &amp;&amp; !<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;isAltShuffle()));</div>
<div class="line"><a name="l07485"></a><span class="lineno"> 7485</span>&#160;  };</div>
<div class="line"><a name="l07486"></a><span class="lineno"> 7486</span>&#160; </div>
<div class="line"><a name="l07487"></a><span class="lineno"> 7487</span>&#160;  <span class="comment">// We only handle trees of heights 1 and 2.</span></div>
<div class="line"><a name="l07488"></a><span class="lineno"> 7488</span>&#160;  <span class="keywordflow">if</span> (VectorizableTree.size() == 1 &amp;&amp;</div>
<div class="line"><a name="l07489"></a><span class="lineno"> 7489</span>&#160;      (VectorizableTree[0]-&gt;State == TreeEntry::Vectorize ||</div>
<div class="line"><a name="l07490"></a><span class="lineno"> 7490</span>&#160;       (ForReduction &amp;&amp;</div>
<div class="line"><a name="l07491"></a><span class="lineno"> 7491</span>&#160;        AreVectorizableGathers(VectorizableTree[0].<a class="code" href="namespacellvm.html#a73257f51950d9ea50955e3fb9c724a25">get</a>(),</div>
<div class="line"><a name="l07492"></a><span class="lineno"> 7492</span>&#160;                               VectorizableTree[0]-&gt;Scalars.size()) &amp;&amp;</div>
<div class="line"><a name="l07493"></a><span class="lineno"> 7493</span>&#160;        VectorizableTree[0]-&gt;getVectorFactor() &gt; 2)))</div>
<div class="line"><a name="l07494"></a><span class="lineno"> 7494</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07495"></a><span class="lineno"> 7495</span>&#160; </div>
<div class="line"><a name="l07496"></a><span class="lineno"> 7496</span>&#160;  <span class="keywordflow">if</span> (VectorizableTree.size() != 2)</div>
<div class="line"><a name="l07497"></a><span class="lineno"> 7497</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07498"></a><span class="lineno"> 7498</span>&#160; </div>
<div class="line"><a name="l07499"></a><span class="lineno"> 7499</span>&#160;  <span class="comment">// Handle splat and all-constants stores. Also try to vectorize tiny trees</span></div>
<div class="line"><a name="l07500"></a><span class="lineno"> 7500</span>&#160;  <span class="comment">// with the second gather nodes if they have less scalar operands rather than</span></div>
<div class="line"><a name="l07501"></a><span class="lineno"> 7501</span>&#160;  <span class="comment">// the initial tree element (may be profitable to shuffle the second gather)</span></div>
<div class="line"><a name="l07502"></a><span class="lineno"> 7502</span>&#160;  <span class="comment">// or they are extractelements, which form shuffle.</span></div>
<div class="line"><a name="l07503"></a><span class="lineno"> 7503</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>;</div>
<div class="line"><a name="l07504"></a><span class="lineno"> 7504</span>&#160;  <span class="keywordflow">if</span> (VectorizableTree[0]-&gt;State == TreeEntry::Vectorize &amp;&amp;</div>
<div class="line"><a name="l07505"></a><span class="lineno"> 7505</span>&#160;      AreVectorizableGathers(VectorizableTree[1].<a class="code" href="namespacellvm.html#a73257f51950d9ea50955e3fb9c724a25">get</a>(),</div>
<div class="line"><a name="l07506"></a><span class="lineno"> 7506</span>&#160;                             VectorizableTree[0]-&gt;Scalars.size()))</div>
<div class="line"><a name="l07507"></a><span class="lineno"> 7507</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07508"></a><span class="lineno"> 7508</span>&#160; </div>
<div class="line"><a name="l07509"></a><span class="lineno"> 7509</span>&#160;  <span class="comment">// Gathering cost would be too much for tiny trees.</span></div>
<div class="line"><a name="l07510"></a><span class="lineno"> 7510</span>&#160;  <span class="keywordflow">if</span> (VectorizableTree[0]-&gt;State == TreeEntry::NeedToGather ||</div>
<div class="line"><a name="l07511"></a><span class="lineno"> 7511</span>&#160;      (VectorizableTree[1]-&gt;State == TreeEntry::NeedToGather &amp;&amp;</div>
<div class="line"><a name="l07512"></a><span class="lineno"> 7512</span>&#160;       VectorizableTree[0]-&gt;State != TreeEntry::ScatterVectorize))</div>
<div class="line"><a name="l07513"></a><span class="lineno"> 7513</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07514"></a><span class="lineno"> 7514</span>&#160; </div>
<div class="line"><a name="l07515"></a><span class="lineno"> 7515</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07516"></a><span class="lineno"> 7516</span>&#160;}</div>
<div class="line"><a name="l07517"></a><span class="lineno"> 7517</span>&#160; </div>
<div class="line"><a name="l07518"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a0109582eb646d501101a7e6a059814fb"> 7518</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#a0109582eb646d501101a7e6a059814fb">isLoadCombineCandidateImpl</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *Root, <span class="keywordtype">unsigned</span> NumElts,</div>
<div class="line"><a name="l07519"></a><span class="lineno"> 7519</span>&#160;                                       <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> *<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>,</div>
<div class="line"><a name="l07520"></a><span class="lineno"> 7520</span>&#160;                                       <span class="keywordtype">bool</span> MustMatchOrInst) {</div>
<div class="line"><a name="l07521"></a><span class="lineno"> 7521</span>&#160;  <span class="comment">// Look past the root to find a source value. Arbitrarily follow the</span></div>
<div class="line"><a name="l07522"></a><span class="lineno"> 7522</span>&#160;  <span class="comment">// path through operand 0 of any &#39;or&#39;. Also, peek through optional</span></div>
<div class="line"><a name="l07523"></a><span class="lineno"> 7523</span>&#160;  <span class="comment">// shift-left-by-multiple-of-8-bits.</span></div>
<div class="line"><a name="l07524"></a><span class="lineno"> 7524</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ZextLoad = Root;</div>
<div class="line"><a name="l07525"></a><span class="lineno"> 7525</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> *ShAmtC;</div>
<div class="line"><a name="l07526"></a><span class="lineno"> 7526</span>&#160;  <span class="keywordtype">bool</span> FoundOr = <span class="keyword">false</span>;</div>
<div class="line"><a name="l07527"></a><span class="lineno"> 7527</span>&#160;  <span class="keywordflow">while</span> (!isa&lt;ConstantExpr&gt;(ZextLoad) &amp;&amp;</div>
<div class="line"><a name="l07528"></a><span class="lineno"> 7528</span>&#160;         (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ZextLoad, <a class="code" href="namespacellvm_1_1PatternMatch.html#a42569041ddafba7d40243e126af07f42">m_Or</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>())) ||</div>
<div class="line"><a name="l07529"></a><span class="lineno"> 7529</span>&#160;          (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ZextLoad, <a class="code" href="namespacellvm_1_1PatternMatch.html#a37668d9884c78ac77254cf9fb8a4276a">m_Shl</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#aac9e78b3aa02ec087c4621358f506718">m_APInt</a>(ShAmtC))) &amp;&amp;</div>
<div class="line"><a name="l07530"></a><span class="lineno"> 7530</span>&#160;           ShAmtC-&gt;<a class="code" href="classllvm_1_1APInt.html#a4e3a2187cacdec76028617a403c47d89">urem</a>(8) == 0))) {</div>
<div class="line"><a name="l07531"></a><span class="lineno"> 7531</span>&#160;    <span class="keyword">auto</span> *BinOp = cast&lt;BinaryOperator&gt;(ZextLoad);</div>
<div class="line"><a name="l07532"></a><span class="lineno"> 7532</span>&#160;    ZextLoad = BinOp-&gt;getOperand(0);</div>
<div class="line"><a name="l07533"></a><span class="lineno"> 7533</span>&#160;    <span class="keywordflow">if</span> (BinOp-&gt;getOpcode() == Instruction::Or)</div>
<div class="line"><a name="l07534"></a><span class="lineno"> 7534</span>&#160;      FoundOr = <span class="keyword">true</span>;</div>
<div class="line"><a name="l07535"></a><span class="lineno"> 7535</span>&#160;  }</div>
<div class="line"><a name="l07536"></a><span class="lineno"> 7536</span>&#160;  <span class="comment">// Check if the input is an extended load of the required or/shift expression.</span></div>
<div class="line"><a name="l07537"></a><span class="lineno"> 7537</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a>;</div>
<div class="line"><a name="l07538"></a><span class="lineno"> 7538</span>&#160;  <span class="keywordflow">if</span> ((MustMatchOrInst &amp;&amp; !FoundOr) || ZextLoad == Root ||</div>
<div class="line"><a name="l07539"></a><span class="lineno"> 7539</span>&#160;      !<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ZextLoad, <a class="code" href="namespacellvm_1_1PatternMatch.html#a2cbdca7c8267aac6914d674f8e81841b">m_ZExt</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a>))) || !isa&lt;LoadInst&gt;(<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a>))</div>
<div class="line"><a name="l07540"></a><span class="lineno"> 7540</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07541"></a><span class="lineno"> 7541</span>&#160; </div>
<div class="line"><a name="l07542"></a><span class="lineno"> 7542</span>&#160;  <span class="comment">// Require that the total load bit width is a legal integer type.</span></div>
<div class="line"><a name="l07543"></a><span class="lineno"> 7543</span>&#160;  <span class="comment">// For example, &lt;8 x i8&gt; --&gt; i64 is a legal integer on a 64-bit target.</span></div>
<div class="line"><a name="l07544"></a><span class="lineno"> 7544</span>&#160;  <span class="comment">// But &lt;16 x i8&gt; --&gt; i128 is not, so the backend probably can&#39;t reduce it.</span></div>
<div class="line"><a name="l07545"></a><span class="lineno"> 7545</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *SrcTy = <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;getType();</div>
<div class="line"><a name="l07546"></a><span class="lineno"> 7546</span>&#160;  <span class="keywordtype">unsigned</span> LoadBitWidth = SrcTy-&gt;<a class="code" href="classllvm_1_1Type.html#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>() * NumElts;</div>
<div class="line"><a name="l07547"></a><span class="lineno"> 7547</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a7a84209b8495d8fd3d2799eb01f1ab2b">isTypeLegal</a>(<a class="code" href="classllvm_1_1IntegerType.html#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(Root-&gt;<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), LoadBitWidth)))</div>
<div class="line"><a name="l07548"></a><span class="lineno"> 7548</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07549"></a><span class="lineno"> 7549</span>&#160; </div>
<div class="line"><a name="l07550"></a><span class="lineno"> 7550</span>&#160;  <span class="comment">// Everything matched - assume that we can fold the whole sequence using</span></div>
<div class="line"><a name="l07551"></a><span class="lineno"> 7551</span>&#160;  <span class="comment">// load combining.</span></div>
<div class="line"><a name="l07552"></a><span class="lineno"> 7552</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Assume load combining for tree starting at &quot;</span></div>
<div class="line"><a name="l07553"></a><span class="lineno"> 7553</span>&#160;             &lt;&lt; *(cast&lt;Instruction&gt;(Root)) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l07554"></a><span class="lineno"> 7554</span>&#160; </div>
<div class="line"><a name="l07555"></a><span class="lineno"> 7555</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07556"></a><span class="lineno"> 7556</span>&#160;}</div>
<div class="line"><a name="l07557"></a><span class="lineno"> 7557</span>&#160; </div>
<div class="line"><a name="l07558"></a><span class="lineno"> 7558</span>&#160;<span class="keywordtype">bool</span> BoUpSLP::isLoadCombineReductionCandidate(<a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830e">RecurKind</a> RdxKind)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l07559"></a><span class="lineno"> 7559</span>&#160;  <span class="keywordflow">if</span> (RdxKind != <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea3a2d5fe857d8f9541136a124c2edec6c">RecurKind::Or</a>)</div>
<div class="line"><a name="l07560"></a><span class="lineno"> 7560</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07561"></a><span class="lineno"> 7561</span>&#160; </div>
<div class="line"><a name="l07562"></a><span class="lineno"> 7562</span>&#160;  <span class="keywordtype">unsigned</span> NumElts = VectorizableTree[0]-&gt;Scalars.size();</div>
<div class="line"><a name="l07563"></a><span class="lineno"> 7563</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *FirstReduced = VectorizableTree[0]-&gt;Scalars[0];</div>
<div class="line"><a name="l07564"></a><span class="lineno"> 7564</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="SLPVectorizer_8cpp.html#a0109582eb646d501101a7e6a059814fb">isLoadCombineCandidateImpl</a>(FirstReduced, NumElts, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>,</div>
<div class="line"><a name="l07565"></a><span class="lineno"> 7565</span>&#160;                                    <span class="comment">/* MatchOr */</span> <span class="keyword">false</span>);</div>
<div class="line"><a name="l07566"></a><span class="lineno"> 7566</span>&#160;}</div>
<div class="line"><a name="l07567"></a><span class="lineno"> 7567</span>&#160; </div>
<div class="line"><a name="l07568"></a><span class="lineno"> 7568</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="Reassociate_8cpp.html#ae32b03825183735233b4142e1945abf8">BoUpSLP::isLoadCombineCandidate</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l07569"></a><span class="lineno"> 7569</span>&#160;  <span class="comment">// Peek through a final sequence of stores and check if all operations are</span></div>
<div class="line"><a name="l07570"></a><span class="lineno"> 7570</span>&#160;  <span class="comment">// likely to be load-combined.</span></div>
<div class="line"><a name="l07571"></a><span class="lineno"> 7571</span>&#160;  <span class="keywordtype">unsigned</span> NumElts = VectorizableTree[0]-&gt;Scalars.size();</div>
<div class="line"><a name="l07572"></a><span class="lineno"> 7572</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *Scalar : VectorizableTree[0]-&gt;Scalars) {</div>
<div class="line"><a name="l07573"></a><span class="lineno"> 7573</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>;</div>
<div class="line"><a name="l07574"></a><span class="lineno"> 7574</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Scalar, <a class="code" href="namespacellvm_1_1PatternMatch.html#ab00c67eb2b92ca056ceefc07c67f46f0">m_Store</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>())) ||</div>
<div class="line"><a name="l07575"></a><span class="lineno"> 7575</span>&#160;        !<a class="code" href="SLPVectorizer_8cpp.html#a0109582eb646d501101a7e6a059814fb">isLoadCombineCandidateImpl</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, NumElts, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, <span class="comment">/* MatchOr */</span> <span class="keyword">true</span>))</div>
<div class="line"><a name="l07576"></a><span class="lineno"> 7576</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07577"></a><span class="lineno"> 7577</span>&#160;  }</div>
<div class="line"><a name="l07578"></a><span class="lineno"> 7578</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07579"></a><span class="lineno"> 7579</span>&#160;}</div>
<div class="line"><a name="l07580"></a><span class="lineno"> 7580</span>&#160; </div>
<div class="line"><a name="l07581"></a><span class="lineno"> 7581</span>&#160;<span class="keywordtype">bool</span> BoUpSLP::isTreeTinyAndNotFullyVectorizable(<span class="keywordtype">bool</span> ForReduction)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l07582"></a><span class="lineno"> 7582</span>&#160;  <span class="comment">// No need to vectorize inserts of gathered values.</span></div>
<div class="line"><a name="l07583"></a><span class="lineno"> 7583</span>&#160;  <span class="keywordflow">if</span> (VectorizableTree.size() == 2 &amp;&amp;</div>
<div class="line"><a name="l07584"></a><span class="lineno"> 7584</span>&#160;      isa&lt;InsertElementInst&gt;(VectorizableTree[0]-&gt;Scalars[0]) &amp;&amp;</div>
<div class="line"><a name="l07585"></a><span class="lineno"> 7585</span>&#160;      VectorizableTree[1]-&gt;State == TreeEntry::NeedToGather &amp;&amp;</div>
<div class="line"><a name="l07586"></a><span class="lineno"> 7586</span>&#160;      (VectorizableTree[1]-&gt;getVectorFactor() &lt;= 2 ||</div>
<div class="line"><a name="l07587"></a><span class="lineno"> 7587</span>&#160;       !(<a class="code" href="SLPVectorizer_8cpp.html#a6ef5b86735d738868e5fb00a18643b1c">isSplat</a>(VectorizableTree[1]-&gt;Scalars) ||</div>
<div class="line"><a name="l07588"></a><span class="lineno"> 7588</span>&#160;         <a class="code" href="SLPVectorizer_8cpp.html#a7568c08b526dbf7f7b5402f3eb605b55">allConstant</a>(VectorizableTree[1]-&gt;Scalars))))</div>
<div class="line"><a name="l07589"></a><span class="lineno"> 7589</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07590"></a><span class="lineno"> 7590</span>&#160; </div>
<div class="line"><a name="l07591"></a><span class="lineno"> 7591</span>&#160;  <span class="comment">// We can vectorize the tree if its size is greater than or equal to the</span></div>
<div class="line"><a name="l07592"></a><span class="lineno"> 7592</span>&#160;  <span class="comment">// minimum size specified by the MinTreeSize command line option.</span></div>
<div class="line"><a name="l07593"></a><span class="lineno"> 7593</span>&#160;  <span class="keywordflow">if</span> (VectorizableTree.size() &gt;= <a class="code" href="SLPVectorizer_8cpp.html#a29dc6da1b32ad914af533bee9c23afda">MinTreeSize</a>)</div>
<div class="line"><a name="l07594"></a><span class="lineno"> 7594</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07595"></a><span class="lineno"> 7595</span>&#160; </div>
<div class="line"><a name="l07596"></a><span class="lineno"> 7596</span>&#160;  <span class="comment">// If we have a tiny tree (a tree whose size is less than MinTreeSize), we</span></div>
<div class="line"><a name="l07597"></a><span class="lineno"> 7597</span>&#160;  <span class="comment">// can vectorize it if we can prove it fully vectorizable.</span></div>
<div class="line"><a name="l07598"></a><span class="lineno"> 7598</span>&#160;  <span class="keywordflow">if</span> (isFullyVectorizableTinyTree(ForReduction))</div>
<div class="line"><a name="l07599"></a><span class="lineno"> 7599</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07600"></a><span class="lineno"> 7600</span>&#160; </div>
<div class="line"><a name="l07601"></a><span class="lineno"> 7601</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VectorizableTree.empty()</div>
<div class="line"><a name="l07602"></a><span class="lineno"> 7602</span>&#160;             ? ExternalUses.empty()</div>
<div class="line"><a name="l07603"></a><span class="lineno"> 7603</span>&#160;             : <span class="keyword">true</span> &amp;&amp; <span class="stringliteral">&quot;We shouldn&#39;t have any external users&quot;</span>);</div>
<div class="line"><a name="l07604"></a><span class="lineno"> 7604</span>&#160; </div>
<div class="line"><a name="l07605"></a><span class="lineno"> 7605</span>&#160;  <span class="comment">// Otherwise, we can&#39;t vectorize the tree. It is both tiny and not fully</span></div>
<div class="line"><a name="l07606"></a><span class="lineno"> 7606</span>&#160;  <span class="comment">// vectorizable.</span></div>
<div class="line"><a name="l07607"></a><span class="lineno"> 7607</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07608"></a><span class="lineno"> 7608</span>&#160;}</div>
<div class="line"><a name="l07609"></a><span class="lineno"> 7609</span>&#160; </div>
<div class="line"><a name="l07610"></a><span class="lineno"> 7610</span>&#160;<a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> BoUpSLP::getSpillCost()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l07611"></a><span class="lineno"> 7611</span>&#160;  <span class="comment">// Walk from the bottom of the tree to the top, tracking which values are</span></div>
<div class="line"><a name="l07612"></a><span class="lineno"> 7612</span>&#160;  <span class="comment">// live. When we see a call instruction that is not part of our tree,</span></div>
<div class="line"><a name="l07613"></a><span class="lineno"> 7613</span>&#160;  <span class="comment">// query TTI to see if there is a cost to keeping values live over it</span></div>
<div class="line"><a name="l07614"></a><span class="lineno"> 7614</span>&#160;  <span class="comment">// (for example, if spills and fills are required).</span></div>
<div class="line"><a name="l07615"></a><span class="lineno"> 7615</span>&#160;  <span class="keywordtype">unsigned</span> BundleWidth = VectorizableTree.front()-&gt;Scalars.size();</div>
<div class="line"><a name="l07616"></a><span class="lineno"> 7616</span>&#160;  <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> = 0;</div>
<div class="line"><a name="l07617"></a><span class="lineno"> 7617</span>&#160; </div>
<div class="line"><a name="l07618"></a><span class="lineno"> 7618</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction*, 4&gt;</a> LiveValues;</div>
<div class="line"><a name="l07619"></a><span class="lineno"> 7619</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *PrevInst = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l07620"></a><span class="lineno"> 7620</span>&#160; </div>
<div class="line"><a name="l07621"></a><span class="lineno"> 7621</span>&#160;  <span class="comment">// The entries in VectorizableTree are not necessarily ordered by their</span></div>
<div class="line"><a name="l07622"></a><span class="lineno"> 7622</span>&#160;  <span class="comment">// position in basic blocks. Collect them and order them by dominance so later</span></div>
<div class="line"><a name="l07623"></a><span class="lineno"> 7623</span>&#160;  <span class="comment">// instructions are guaranteed to be visited first. For instructions in</span></div>
<div class="line"><a name="l07624"></a><span class="lineno"> 7624</span>&#160;  <span class="comment">// different basic blocks, we only scan to the beginning of the block, so</span></div>
<div class="line"><a name="l07625"></a><span class="lineno"> 7625</span>&#160;  <span class="comment">// their order does not matter, as long as all instructions in a basic block</span></div>
<div class="line"><a name="l07626"></a><span class="lineno"> 7626</span>&#160;  <span class="comment">// are grouped together. Using dominance ensures a deterministic order.</span></div>
<div class="line"><a name="l07627"></a><span class="lineno"> 7627</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 16&gt;</a> OrderedScalars;</div>
<div class="line"><a name="l07628"></a><span class="lineno"> 7628</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;TEPtr : VectorizableTree) {</div>
<div class="line"><a name="l07629"></a><span class="lineno"> 7629</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst = dyn_cast&lt;Instruction&gt;(TEPtr-&gt;Scalars[0]);</div>
<div class="line"><a name="l07630"></a><span class="lineno"> 7630</span>&#160;    <span class="keywordflow">if</span> (!Inst)</div>
<div class="line"><a name="l07631"></a><span class="lineno"> 7631</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l07632"></a><span class="lineno"> 7632</span>&#160;    OrderedScalars.push_back(Inst);</div>
<div class="line"><a name="l07633"></a><span class="lineno"> 7633</span>&#160;  }</div>
<div class="line"><a name="l07634"></a><span class="lineno"> 7634</span>&#160;  <a class="code" href="namespacellvm.html#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a>(OrderedScalars, [&amp;](<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *A, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>) {</div>
<div class="line"><a name="l07635"></a><span class="lineno"> 7635</span>&#160;    <span class="keyword">auto</span> *NodeA = DT-&gt;getNode(<a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>-&gt;getParent());</div>
<div class="line"><a name="l07636"></a><span class="lineno"> 7636</span>&#160;    <span class="keyword">auto</span> *NodeB = DT-&gt;getNode(<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>-&gt;getParent());</div>
<div class="line"><a name="l07637"></a><span class="lineno"> 7637</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NodeA &amp;&amp; <span class="stringliteral">&quot;Should only process reachable instructions&quot;</span>);</div>
<div class="line"><a name="l07638"></a><span class="lineno"> 7638</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NodeB &amp;&amp; <span class="stringliteral">&quot;Should only process reachable instructions&quot;</span>);</div>
<div class="line"><a name="l07639"></a><span class="lineno"> 7639</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((NodeA == NodeB) == (NodeA-&gt;getDFSNumIn() == NodeB-&gt;getDFSNumIn()) &amp;&amp;</div>
<div class="line"><a name="l07640"></a><span class="lineno"> 7640</span>&#160;           <span class="stringliteral">&quot;Different nodes should have different DFS numbers&quot;</span>);</div>
<div class="line"><a name="l07641"></a><span class="lineno"> 7641</span>&#160;    <span class="keywordflow">if</span> (NodeA != NodeB)</div>
<div class="line"><a name="l07642"></a><span class="lineno"> 7642</span>&#160;      <span class="keywordflow">return</span> NodeA-&gt;getDFSNumIn() &lt; NodeB-&gt;getDFSNumIn();</div>
<div class="line"><a name="l07643"></a><span class="lineno"> 7643</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>-&gt;comesBefore(A);</div>
<div class="line"><a name="l07644"></a><span class="lineno"> 7644</span>&#160;  });</div>
<div class="line"><a name="l07645"></a><span class="lineno"> 7645</span>&#160; </div>
<div class="line"><a name="l07646"></a><span class="lineno"> 7646</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst : OrderedScalars) {</div>
<div class="line"><a name="l07647"></a><span class="lineno"> 7647</span>&#160;    <span class="keywordflow">if</span> (!PrevInst) {</div>
<div class="line"><a name="l07648"></a><span class="lineno"> 7648</span>&#160;      PrevInst = Inst;</div>
<div class="line"><a name="l07649"></a><span class="lineno"> 7649</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l07650"></a><span class="lineno"> 7650</span>&#160;    }</div>
<div class="line"><a name="l07651"></a><span class="lineno"> 7651</span>&#160; </div>
<div class="line"><a name="l07652"></a><span class="lineno"> 7652</span>&#160;    <span class="comment">// Update LiveValues.</span></div>
<div class="line"><a name="l07653"></a><span class="lineno"> 7653</span>&#160;    LiveValues.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a11045c7973ab24a8d6315b61fa337d4e">erase</a>(PrevInst);</div>
<div class="line"><a name="l07654"></a><span class="lineno"> 7654</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;J : PrevInst-&gt;<a class="code" href="classllvm_1_1User.html#a0b931781aa589c6ebe64a76c1447e5b2">operands</a>()) {</div>
<div class="line"><a name="l07655"></a><span class="lineno"> 7655</span>&#160;      <span class="keywordflow">if</span> (isa&lt;Instruction&gt;(&amp;*J) &amp;&amp; getTreeEntry(&amp;*J))</div>
<div class="line"><a name="l07656"></a><span class="lineno"> 7656</span>&#160;        LiveValues.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(cast&lt;Instruction&gt;(&amp;*J));</div>
<div class="line"><a name="l07657"></a><span class="lineno"> 7657</span>&#160;    }</div>
<div class="line"><a name="l07658"></a><span class="lineno"> 7658</span>&#160; </div>
<div class="line"><a name="l07659"></a><span class="lineno"> 7659</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>({</div>
<div class="line"><a name="l07660"></a><span class="lineno"> 7660</span>&#160;      <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: #LV: &quot;</span> &lt;&lt; LiveValues.<a class="code" href="classllvm_1_1SmallPtrSetImplBase.html#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>();</div>
<div class="line"><a name="l07661"></a><span class="lineno"> 7661</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a> : LiveValues)</div>
<div class="line"><a name="l07662"></a><span class="lineno"> 7662</span>&#160;        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>-&gt;getName();</div>
<div class="line"><a name="l07663"></a><span class="lineno"> 7663</span>&#160;      <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;, Looking at &quot;</span>;</div>
<div class="line"><a name="l07664"></a><span class="lineno"> 7664</span>&#160;      Inst-&gt;<a class="code" href="classllvm_1_1Value.html#af7dca9a9e816ef69fd9e9467f64f72b4">dump</a>();</div>
<div class="line"><a name="l07665"></a><span class="lineno"> 7665</span>&#160;    });</div>
<div class="line"><a name="l07666"></a><span class="lineno"> 7666</span>&#160; </div>
<div class="line"><a name="l07667"></a><span class="lineno"> 7667</span>&#160;    <span class="comment">// Now find the sequence of instructions between PrevInst and Inst.</span></div>
<div class="line"><a name="l07668"></a><span class="lineno"> 7668</span>&#160;    <span class="keywordtype">unsigned</span> NumCalls = 0;</div>
<div class="line"><a name="l07669"></a><span class="lineno"> 7669</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html#a6d3231fb84ed4182ec22e9442a87dbf8">BasicBlock::reverse_iterator</a> InstIt = ++Inst-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>().<a class="code" href="classllvm_1_1ilist__iterator.html#a78fdbf2880abbb855abdb5bf030d9105">getReverse</a>(),</div>
<div class="line"><a name="l07670"></a><span class="lineno"> 7670</span>&#160;                                 PrevInstIt =</div>
<div class="line"><a name="l07671"></a><span class="lineno"> 7671</span>&#160;                                     PrevInst-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>().<a class="code" href="classllvm_1_1ilist__iterator.html#a78fdbf2880abbb855abdb5bf030d9105">getReverse</a>();</div>
<div class="line"><a name="l07672"></a><span class="lineno"> 7672</span>&#160;    <span class="keywordflow">while</span> (InstIt != PrevInstIt) {</div>
<div class="line"><a name="l07673"></a><span class="lineno"> 7673</span>&#160;      <span class="keywordflow">if</span> (PrevInstIt == PrevInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a9237251072bf6816163abc2d053212ee">rend</a>()) {</div>
<div class="line"><a name="l07674"></a><span class="lineno"> 7674</span>&#160;        PrevInstIt = Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a1c2af7a9e501d399f06ca7e10eef46e4">rbegin</a>();</div>
<div class="line"><a name="l07675"></a><span class="lineno"> 7675</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l07676"></a><span class="lineno"> 7676</span>&#160;      }</div>
<div class="line"><a name="l07677"></a><span class="lineno"> 7677</span>&#160; </div>
<div class="line"><a name="l07678"></a><span class="lineno"> 7678</span>&#160;      <span class="keyword">auto</span> NoCallIntrinsic = [<span class="keyword">this</span>](<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l07679"></a><span class="lineno"> 7679</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *II = dyn_cast&lt;IntrinsicInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l07680"></a><span class="lineno"> 7680</span>&#160;          <span class="keywordflow">if</span> (II-&gt;isAssumeLikeIntrinsic())</div>
<div class="line"><a name="l07681"></a><span class="lineno"> 7681</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07682"></a><span class="lineno"> 7682</span>&#160;          <a class="code" href="classllvm_1_1FastMathFlags.html">FastMathFlags</a> FMF;</div>
<div class="line"><a name="l07683"></a><span class="lineno"> 7683</span>&#160;          <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Type *, 4&gt;</a> Tys;</div>
<div class="line"><a name="l07684"></a><span class="lineno"> 7684</span>&#160;          <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;ArgOp : II-&gt;args())</div>
<div class="line"><a name="l07685"></a><span class="lineno"> 7685</span>&#160;            Tys.push_back(ArgOp-&gt;getType());</div>
<div class="line"><a name="l07686"></a><span class="lineno"> 7686</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">auto</span> *FPMO = dyn_cast&lt;FPMathOperator&gt;(II))</div>
<div class="line"><a name="l07687"></a><span class="lineno"> 7687</span>&#160;            FMF = FPMO-&gt;getFastMathFlags();</div>
<div class="line"><a name="l07688"></a><span class="lineno"> 7688</span>&#160;          <a class="code" href="classllvm_1_1IntrinsicCostAttributes.html">IntrinsicCostAttributes</a> ICA(II-&gt;getIntrinsicID(), II-&gt;<a class="code" href="classllvm_1_1InsertElementInst.html#a5532ffa629e5d85d605bb379f7aed857">getType</a>(), Tys,</div>
<div class="line"><a name="l07689"></a><span class="lineno"> 7689</span>&#160;                                      FMF);</div>
<div class="line"><a name="l07690"></a><span class="lineno"> 7690</span>&#160;          <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> IntrCost =</div>
<div class="line"><a name="l07691"></a><span class="lineno"> 7691</span>&#160;              <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a4218f47749d093473e680ad0199fb239">getIntrinsicInstrCost</a>(ICA, <a class="code" href="classllvm_1_1TargetTransformInfo.html#a706f223f760b55668fbae74202b816bba59b32ea7b6f10564abd40ad90602ca5b">TTI::TCK_RecipThroughput</a>);</div>
<div class="line"><a name="l07692"></a><span class="lineno"> 7692</span>&#160;          <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> CallCost = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#af67833027bb46ddb390684a6f0b75398">getCallInstrCost</a>(</div>
<div class="line"><a name="l07693"></a><span class="lineno"> 7693</span>&#160;              <span class="keyword">nullptr</span>, II-&gt;<a class="code" href="classllvm_1_1InsertElementInst.html#a5532ffa629e5d85d605bb379f7aed857">getType</a>(), Tys, <a class="code" href="classllvm_1_1TargetTransformInfo.html#a706f223f760b55668fbae74202b816bba59b32ea7b6f10564abd40ad90602ca5b">TTI::TCK_RecipThroughput</a>);</div>
<div class="line"><a name="l07694"></a><span class="lineno"> 7694</span>&#160;          <span class="keywordflow">if</span> (IntrCost &lt; CallCost)</div>
<div class="line"><a name="l07695"></a><span class="lineno"> 7695</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07696"></a><span class="lineno"> 7696</span>&#160;        }</div>
<div class="line"><a name="l07697"></a><span class="lineno"> 7697</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07698"></a><span class="lineno"> 7698</span>&#160;      };</div>
<div class="line"><a name="l07699"></a><span class="lineno"> 7699</span>&#160; </div>
<div class="line"><a name="l07700"></a><span class="lineno"> 7700</span>&#160;      <span class="comment">// Debug information does not impact spill cost.</span></div>
<div class="line"><a name="l07701"></a><span class="lineno"> 7701</span>&#160;      <span class="keywordflow">if</span> (isa&lt;CallInst&gt;(&amp;*PrevInstIt) &amp;&amp; !NoCallIntrinsic(&amp;*PrevInstIt) &amp;&amp;</div>
<div class="line"><a name="l07702"></a><span class="lineno"> 7702</span>&#160;          &amp;*PrevInstIt != PrevInst)</div>
<div class="line"><a name="l07703"></a><span class="lineno"> 7703</span>&#160;        NumCalls++;</div>
<div class="line"><a name="l07704"></a><span class="lineno"> 7704</span>&#160; </div>
<div class="line"><a name="l07705"></a><span class="lineno"> 7705</span>&#160;      ++PrevInstIt;</div>
<div class="line"><a name="l07706"></a><span class="lineno"> 7706</span>&#160;    }</div>
<div class="line"><a name="l07707"></a><span class="lineno"> 7707</span>&#160; </div>
<div class="line"><a name="l07708"></a><span class="lineno"> 7708</span>&#160;    <span class="keywordflow">if</span> (NumCalls) {</div>
<div class="line"><a name="l07709"></a><span class="lineno"> 7709</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Type*, 4&gt;</a> V;</div>
<div class="line"><a name="l07710"></a><span class="lineno"> 7710</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *II : LiveValues) {</div>
<div class="line"><a name="l07711"></a><span class="lineno"> 7711</span>&#160;        <span class="keyword">auto</span> *ScalarTy = II-&gt;<a class="code" href="classllvm_1_1InsertElementInst.html#a5532ffa629e5d85d605bb379f7aed857">getType</a>();</div>
<div class="line"><a name="l07712"></a><span class="lineno"> 7712</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *VectorTy = dyn_cast&lt;FixedVectorType&gt;(ScalarTy))</div>
<div class="line"><a name="l07713"></a><span class="lineno"> 7713</span>&#160;          ScalarTy = VectorTy-&gt;getElementType();</div>
<div class="line"><a name="l07714"></a><span class="lineno"> 7714</span>&#160;        V.push_back(<a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(ScalarTy, BundleWidth));</div>
<div class="line"><a name="l07715"></a><span class="lineno"> 7715</span>&#160;      }</div>
<div class="line"><a name="l07716"></a><span class="lineno"> 7716</span>&#160;      <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> += NumCalls * <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a8920039419b33a0b7248a0957e262ee7">getCostOfKeepingLiveOverCall</a>(V);</div>
<div class="line"><a name="l07717"></a><span class="lineno"> 7717</span>&#160;    }</div>
<div class="line"><a name="l07718"></a><span class="lineno"> 7718</span>&#160; </div>
<div class="line"><a name="l07719"></a><span class="lineno"> 7719</span>&#160;    PrevInst = Inst;</div>
<div class="line"><a name="l07720"></a><span class="lineno"> 7720</span>&#160;  }</div>
<div class="line"><a name="l07721"></a><span class="lineno"> 7721</span>&#160; </div>
<div class="line"><a name="l07722"></a><span class="lineno"> 7722</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a>;</div>
<div class="line"><a name="l07723"></a><span class="lineno"> 7723</span>&#160;}</div>
<div class="line"><a name="l07724"></a><span class="lineno"> 7724</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07725"></a><span class="lineno"> 7725</span>&#160;<span class="comment">/// Checks if the \p IE1 instructions is followed by \p IE2 instruction in the</span></div>
<div class="line"><a name="l07726"></a><span class="lineno"> 7726</span>&#160;<span class="comment">/// buildvector sequence.</span></div>
<div class="line"><a name="l07727"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a405ff61e8571b58fecaa716540af108f"> 7727</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#a405ff61e8571b58fecaa716540af108f">isFirstInsertElement</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> *IE1,</div>
<div class="line"><a name="l07728"></a><span class="lineno"> 7728</span>&#160;                                 <span class="keyword">const</span> <a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> *IE2) {</div>
<div class="line"><a name="l07729"></a><span class="lineno"> 7729</span>&#160;  <span class="keywordflow">if</span> (IE1 == IE2)</div>
<div class="line"><a name="l07730"></a><span class="lineno"> 7730</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07731"></a><span class="lineno"> 7731</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> *I1 = IE1;</div>
<div class="line"><a name="l07732"></a><span class="lineno"> 7732</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> *I2 = IE2;</div>
<div class="line"><a name="l07733"></a><span class="lineno"> 7733</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> *PrevI1;</div>
<div class="line"><a name="l07734"></a><span class="lineno"> 7734</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> *PrevI2;</div>
<div class="line"><a name="l07735"></a><span class="lineno"> 7735</span>&#160;  <span class="keywordtype">unsigned</span> Idx1 = *<a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(IE1);</div>
<div class="line"><a name="l07736"></a><span class="lineno"> 7736</span>&#160;  <span class="keywordtype">unsigned</span> Idx2 = *<a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(IE2);</div>
<div class="line"><a name="l07737"></a><span class="lineno"> 7737</span>&#160;  <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l07738"></a><span class="lineno"> 7738</span>&#160;    <span class="keywordflow">if</span> (I2 == IE1)</div>
<div class="line"><a name="l07739"></a><span class="lineno"> 7739</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l07740"></a><span class="lineno"> 7740</span>&#160;    <span class="keywordflow">if</span> (I1 == IE2)</div>
<div class="line"><a name="l07741"></a><span class="lineno"> 7741</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l07742"></a><span class="lineno"> 7742</span>&#160;    PrevI1 = I1;</div>
<div class="line"><a name="l07743"></a><span class="lineno"> 7743</span>&#160;    PrevI2 = I2;</div>
<div class="line"><a name="l07744"></a><span class="lineno"> 7744</span>&#160;    <span class="keywordflow">if</span> (I1 &amp;&amp; (I1 == IE1 || I1-&gt;hasOneUse()) &amp;&amp;</div>
<div class="line"><a name="l07745"></a><span class="lineno"> 7745</span>&#160;        <a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(I1).value_or(Idx2) != Idx2)</div>
<div class="line"><a name="l07746"></a><span class="lineno"> 7746</span>&#160;      I1 = dyn_cast&lt;InsertElementInst&gt;(I1-&gt;getOperand(0));</div>
<div class="line"><a name="l07747"></a><span class="lineno"> 7747</span>&#160;    <span class="keywordflow">if</span> (I2 &amp;&amp; ((I2 == IE2 || I2-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())) &amp;&amp;</div>
<div class="line"><a name="l07748"></a><span class="lineno"> 7748</span>&#160;        <a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(I2).value_or(Idx1) != Idx1)</div>
<div class="line"><a name="l07749"></a><span class="lineno"> 7749</span>&#160;      I2 = dyn_cast&lt;InsertElementInst&gt;(I2-&gt;getOperand(0));</div>
<div class="line"><a name="l07750"></a><span class="lineno"> 7750</span>&#160;  } <span class="keywordflow">while</span> ((I1 &amp;&amp; PrevI1 != I1) || (I2 &amp;&amp; PrevI2 != I2));</div>
<div class="line"><a name="l07751"></a><span class="lineno"> 7751</span>&#160;  <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Two different buildvectors not expected.&quot;</span>);</div>
<div class="line"><a name="l07752"></a><span class="lineno"> 7752</span>&#160;}</div>
<div class="line"><a name="l07753"></a><span class="lineno"> 7753</span>&#160; </div>
<div class="line"><a name="l07754"></a><span class="lineno"> 7754</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div>
<div class="line"><a name="l07755"></a><span class="lineno"> 7755</span>&#160;<span class="comment">/// Returns incoming Value *, if the requested type is Value * too, or a default</span></div>
<div class="line"><a name="l07756"></a><span class="lineno"> 7756</span>&#160;<span class="comment">/// value, otherwise.</span></div>
<div class="line"><a name="l07757"></a><span class="lineno"> 7757</span>&#160;<span class="comment"></span><span class="keyword">struct </span>ValueSelect {</div>
<div class="line"><a name="l07758"></a><span class="lineno"> 7758</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt;</div>
<div class="line"><a name="l07759"></a><span class="lineno"> 7759</span>&#160;  <span class="keyword">static</span> std::enable_if_t&lt;std::is_same_v&lt;Value *, U&gt;, <a class="code" href="classllvm_1_1Value.html">Value</a> *&gt; <a class="code" href="namespacellvm.html#a73257f51950d9ea50955e3fb9c724a25">get</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l07760"></a><span class="lineno"> 7760</span>&#160;    <span class="keywordflow">return</span> V;</div>
<div class="line"><a name="l07761"></a><span class="lineno"> 7761</span>&#160;  }</div>
<div class="line"><a name="l07762"></a><span class="lineno"> 7762</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt;</div>
<div class="line"><a name="l07763"></a><span class="lineno"> 7763</span>&#160;  <span class="keyword">static</span> std::enable_if_t&lt;!std::is_same_v&lt;Value *, U&gt;, U&gt; <a class="code" href="namespacellvm.html#a73257f51950d9ea50955e3fb9c724a25">get</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *) {</div>
<div class="line"><a name="l07764"></a><span class="lineno"> 7764</span>&#160;    <span class="keywordflow">return</span> U();</div>
<div class="line"><a name="l07765"></a><span class="lineno"> 7765</span>&#160;  }</div>
<div class="line"><a name="l07766"></a><span class="lineno"> 7766</span>&#160;};</div>
<div class="line"><a name="l07767"></a><span class="lineno"> 7767</span>&#160;} <span class="comment">// namespace</span></div>
<div class="line"><a name="l07768"></a><span class="lineno"> 7768</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l07769"></a><span class="lineno"> 7769</span>&#160;<span class="comment">/// Does the analysis of the provided shuffle masks and performs the requested</span></div>
<div class="line"><a name="l07770"></a><span class="lineno"> 7770</span>&#160;<span class="comment">/// actions on the vectors with the given shuffle masks. It tries to do it in</span></div>
<div class="line"><a name="l07771"></a><span class="lineno"> 7771</span>&#160;<span class="comment">/// several steps.</span></div>
<div class="line"><a name="l07772"></a><span class="lineno"> 7772</span>&#160;<span class="comment">/// 1. If the Base vector is not undef vector, resizing the very first mask to</span></div>
<div class="line"><a name="l07773"></a><span class="lineno"> 7773</span>&#160;<span class="comment">/// have common VF and perform action for 2 input vectors (including non-undef</span></div>
<div class="line"><a name="l07774"></a><span class="lineno"> 7774</span>&#160;<span class="comment">/// Base). Other shuffle masks are combined with the resulting after the 1 stage</span></div>
<div class="line"><a name="l07775"></a><span class="lineno"> 7775</span>&#160;<span class="comment">/// and processed as a shuffle of 2 elements.</span></div>
<div class="line"><a name="l07776"></a><span class="lineno"> 7776</span>&#160;<span class="comment">/// 2. If the Base is undef vector and have only 1 shuffle mask, perform the</span></div>
<div class="line"><a name="l07777"></a><span class="lineno"> 7777</span>&#160;<span class="comment">/// action only for 1 vector with the given mask, if it is not the identity</span></div>
<div class="line"><a name="l07778"></a><span class="lineno"> 7778</span>&#160;<span class="comment">/// mask.</span></div>
<div class="line"><a name="l07779"></a><span class="lineno"> 7779</span>&#160;<span class="comment">/// 3. If &gt; 2 masks are used, perform the remaining shuffle actions for 2</span></div>
<div class="line"><a name="l07780"></a><span class="lineno"> 7780</span>&#160;<span class="comment">/// vectors, combing the masks properly between the steps.</span></div>
<div class="line"><a name="l07781"></a><span class="lineno"> 7781</span>&#160;<span class="comment"></span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l07782"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#abe36995f592a8ca21971d82531cb2c6d"> 7782</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classT.html">T</a> *<a class="code" href="SLPVectorizer_8cpp.html#abe36995f592a8ca21971d82531cb2c6d">performExtractsShuffleAction</a>(</div>
<div class="line"><a name="l07783"></a><span class="lineno"> 7783</span>&#160;    <a class="code" href="classllvm_1_1MutableArrayRef.html">MutableArrayRef</a>&lt;std::pair&lt;<a class="code" href="classT.html">T</a> *, <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a>&gt;&gt; ShuffleMask, <a class="code" href="classllvm_1_1Value.html">Value</a> *Base,</div>
<div class="line"><a name="l07784"></a><span class="lineno"> 7784</span>&#160;    <a class="code" href="classllvm_1_1function__ref.html">function_ref</a>&lt;<span class="keywordtype">unsigned</span>(<a class="code" href="classT.html">T</a> *)&gt; GetVF,</div>
<div class="line"><a name="l07785"></a><span class="lineno"> 7785</span>&#160;    <a class="code" href="classllvm_1_1function__ref.html">function_ref</a>&lt;std::pair&lt;T *, bool&gt;(<a class="code" href="classT.html">T</a> *, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a>, <span class="keywordtype">bool</span>)&gt; ResizeAction,</div>
<div class="line"><a name="l07786"></a><span class="lineno"> 7786</span>&#160;    <a class="code" href="classllvm_1_1function__ref.html">function_ref</a>&lt;<a class="code" href="classT.html">T</a> *(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a>, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;T *&gt;</a>)&gt; Action) {</div>
<div class="line"><a name="l07787"></a><span class="lineno"> 7787</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!ShuffleMask.empty() &amp;&amp; <span class="stringliteral">&quot;Empty list of shuffles for inserts.&quot;</span>);</div>
<div class="line"><a name="l07788"></a><span class="lineno"> 7788</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>(ShuffleMask.begin()-&gt;second);</div>
<div class="line"><a name="l07789"></a><span class="lineno"> 7789</span>&#160;  <span class="keyword">auto</span> VMIt = std::next(ShuffleMask.begin());</div>
<div class="line"><a name="l07790"></a><span class="lineno"> 7790</span>&#160;  <a class="code" href="classT.html">T</a> *Prev = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l07791"></a><span class="lineno"> 7791</span>&#160;  <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> UseMask =</div>
<div class="line"><a name="l07792"></a><span class="lineno"> 7792</span>&#160;      <a class="code" href="SLPVectorizer_8cpp.html#a2fd40bb67aec98438b791520159fb146">buildUseMask</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size(), <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, UseMask::UndefsAsMask);</div>
<div class="line"><a name="l07793"></a><span class="lineno"> 7793</span>&#160;  <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> IsBaseUndef = <a class="code" href="SLPVectorizer_8cpp.html#ac396bb87eb4db1dd3ce315e4d91ee2de">isUndefVector</a>(<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, UseMask);</div>
<div class="line"><a name="l07794"></a><span class="lineno"> 7794</span>&#160;  <span class="keywordflow">if</span> (!IsBaseUndef.<a class="code" href="classllvm_1_1SmallBitVector.html#a8cfcd92a373cdd7deefb939dd76b83e3">all</a>()) {</div>
<div class="line"><a name="l07795"></a><span class="lineno"> 7795</span>&#160;    <span class="comment">// Base is not undef, need to combine it with the next subvectors.</span></div>
<div class="line"><a name="l07796"></a><span class="lineno"> 7796</span>&#160;    std::pair&lt;T *, bool&gt; Res =</div>
<div class="line"><a name="l07797"></a><span class="lineno"> 7797</span>&#160;        ResizeAction(ShuffleMask.begin()-&gt;first, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, <span class="comment">/*ForSingleMask=*/</span><span class="keyword">false</span>);</div>
<div class="line"><a name="l07798"></a><span class="lineno"> 7798</span>&#160;    <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> IsBasePoison = isUndefVector&lt;true&gt;(<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, UseMask);</div>
<div class="line"><a name="l07799"></a><span class="lineno"> 7799</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Idx = 0, VF = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size(); Idx &lt; VF; ++Idx) {</div>
<div class="line"><a name="l07800"></a><span class="lineno"> 7800</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[Idx] == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l07801"></a><span class="lineno"> 7801</span>&#160;        <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[Idx] = IsBasePoison.<a class="code" href="classllvm_1_1SmallBitVector.html#a585f149dd8c344a40c53b1694d3161ed">test</a>(Idx) ? <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a> : Idx;</div>
<div class="line"><a name="l07802"></a><span class="lineno"> 7802</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l07803"></a><span class="lineno"> 7803</span>&#160;        <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[Idx] = (Res.second ? Idx : <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[Idx]) + VF;</div>
<div class="line"><a name="l07804"></a><span class="lineno"> 7804</span>&#160;    }</div>
<div class="line"><a name="l07805"></a><span class="lineno"> 7805</span>&#160;    <span class="keyword">auto</span> *V = ValueSelect::get&lt;T *&gt;(<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>);</div>
<div class="line"><a name="l07806"></a><span class="lineno"> 7806</span>&#160;    (void)V;</div>
<div class="line"><a name="l07807"></a><span class="lineno"> 7807</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!V || GetVF(V) == <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size()) &amp;&amp;</div>
<div class="line"><a name="l07808"></a><span class="lineno"> 7808</span>&#160;           <span class="stringliteral">&quot;Expected base vector of VF number of elements.&quot;</span>);</div>
<div class="line"><a name="l07809"></a><span class="lineno"> 7809</span>&#160;    Prev = Action(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, {<span class="keyword">nullptr</span>, Res.first});</div>
<div class="line"><a name="l07810"></a><span class="lineno"> 7810</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ShuffleMask.size() == 1) {</div>
<div class="line"><a name="l07811"></a><span class="lineno"> 7811</span>&#160;    <span class="comment">// Base is undef and only 1 vector is shuffled - perform the action only for</span></div>
<div class="line"><a name="l07812"></a><span class="lineno"> 7812</span>&#160;    <span class="comment">// single vector, if the mask is not the identity mask.</span></div>
<div class="line"><a name="l07813"></a><span class="lineno"> 7813</span>&#160;    std::pair&lt;T *, bool&gt; Res = ResizeAction(ShuffleMask.begin()-&gt;first, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>,</div>
<div class="line"><a name="l07814"></a><span class="lineno"> 7814</span>&#160;                                            <span class="comment">/*ForSingleMask=*/</span><span class="keyword">true</span>);</div>
<div class="line"><a name="l07815"></a><span class="lineno"> 7815</span>&#160;    <span class="keywordflow">if</span> (Res.second)</div>
<div class="line"><a name="l07816"></a><span class="lineno"> 7816</span>&#160;      <span class="comment">// Identity mask is found.</span></div>
<div class="line"><a name="l07817"></a><span class="lineno"> 7817</span>&#160;      Prev = Res.first;</div>
<div class="line"><a name="l07818"></a><span class="lineno"> 7818</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l07819"></a><span class="lineno"> 7819</span>&#160;      Prev = Action(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, {ShuffleMask.begin()-&gt;first});</div>
<div class="line"><a name="l07820"></a><span class="lineno"> 7820</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l07821"></a><span class="lineno"> 7821</span>&#160;    <span class="comment">// Base is undef and at least 2 input vectors shuffled - perform 2 vectors</span></div>
<div class="line"><a name="l07822"></a><span class="lineno"> 7822</span>&#160;    <span class="comment">// shuffles step by step, combining shuffle between the steps.</span></div>
<div class="line"><a name="l07823"></a><span class="lineno"> 7823</span>&#160;    <span class="keywordtype">unsigned</span> Vec1VF = GetVF(ShuffleMask.begin()-&gt;first);</div>
<div class="line"><a name="l07824"></a><span class="lineno"> 7824</span>&#160;    <span class="keywordtype">unsigned</span> Vec2VF = GetVF(VMIt-&gt;first);</div>
<div class="line"><a name="l07825"></a><span class="lineno"> 7825</span>&#160;    <span class="keywordflow">if</span> (Vec1VF == Vec2VF) {</div>
<div class="line"><a name="l07826"></a><span class="lineno"> 7826</span>&#160;      <span class="comment">// No need to resize the input vectors since they are of the same size, we</span></div>
<div class="line"><a name="l07827"></a><span class="lineno"> 7827</span>&#160;      <span class="comment">// can shuffle them directly.</span></div>
<div class="line"><a name="l07828"></a><span class="lineno"> 7828</span>&#160;      <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> SecMask = VMIt-&gt;second;</div>
<div class="line"><a name="l07829"></a><span class="lineno"> 7829</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, VF = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; VF; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l07830"></a><span class="lineno"> 7830</span>&#160;        <span class="keywordflow">if</span> (SecMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] != <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>) {</div>
<div class="line"><a name="l07831"></a><span class="lineno"> 7831</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a> &amp;&amp; <span class="stringliteral">&quot;Multiple uses of scalars.&quot;</span>);</div>
<div class="line"><a name="l07832"></a><span class="lineno"> 7832</span>&#160;          <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = SecMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] + Vec1VF;</div>
<div class="line"><a name="l07833"></a><span class="lineno"> 7833</span>&#160;        }</div>
<div class="line"><a name="l07834"></a><span class="lineno"> 7834</span>&#160;      }</div>
<div class="line"><a name="l07835"></a><span class="lineno"> 7835</span>&#160;      Prev = Action(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, {ShuffleMask.begin()-&gt;first, VMIt-&gt;first});</div>
<div class="line"><a name="l07836"></a><span class="lineno"> 7836</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l07837"></a><span class="lineno"> 7837</span>&#160;      <span class="comment">// Vectors of different sizes - resize and reshuffle.</span></div>
<div class="line"><a name="l07838"></a><span class="lineno"> 7838</span>&#160;      std::pair&lt;T *, bool&gt; Res1 = ResizeAction(ShuffleMask.begin()-&gt;first, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>,</div>
<div class="line"><a name="l07839"></a><span class="lineno"> 7839</span>&#160;                                               <span class="comment">/*ForSingleMask=*/</span><span class="keyword">false</span>);</div>
<div class="line"><a name="l07840"></a><span class="lineno"> 7840</span>&#160;      std::pair&lt;T *, bool&gt; Res2 =</div>
<div class="line"><a name="l07841"></a><span class="lineno"> 7841</span>&#160;          ResizeAction(VMIt-&gt;first, VMIt-&gt;second, <span class="comment">/*ForSingleMask=*/</span><span class="keyword">false</span>);</div>
<div class="line"><a name="l07842"></a><span class="lineno"> 7842</span>&#160;      <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> SecMask = VMIt-&gt;second;</div>
<div class="line"><a name="l07843"></a><span class="lineno"> 7843</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, VF = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; VF; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l07844"></a><span class="lineno"> 7844</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] != <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>) {</div>
<div class="line"><a name="l07845"></a><span class="lineno"> 7845</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SecMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a> &amp;&amp; <span class="stringliteral">&quot;Multiple uses of scalars.&quot;</span>);</div>
<div class="line"><a name="l07846"></a><span class="lineno"> 7846</span>&#160;          <span class="keywordflow">if</span> (Res1.second)</div>
<div class="line"><a name="l07847"></a><span class="lineno"> 7847</span>&#160;            <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l07848"></a><span class="lineno"> 7848</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (SecMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] != <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>) {</div>
<div class="line"><a name="l07849"></a><span class="lineno"> 7849</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a> &amp;&amp; <span class="stringliteral">&quot;Multiple uses of scalars.&quot;</span>);</div>
<div class="line"><a name="l07850"></a><span class="lineno"> 7850</span>&#160;          <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = (Res2.second ? <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : SecMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]) + VF;</div>
<div class="line"><a name="l07851"></a><span class="lineno"> 7851</span>&#160;        }</div>
<div class="line"><a name="l07852"></a><span class="lineno"> 7852</span>&#160;      }</div>
<div class="line"><a name="l07853"></a><span class="lineno"> 7853</span>&#160;      Prev = Action(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, {Res1.first, Res2.first});</div>
<div class="line"><a name="l07854"></a><span class="lineno"> 7854</span>&#160;    }</div>
<div class="line"><a name="l07855"></a><span class="lineno"> 7855</span>&#160;    VMIt = std::next(VMIt);</div>
<div class="line"><a name="l07856"></a><span class="lineno"> 7856</span>&#160;  }</div>
<div class="line"><a name="l07857"></a><span class="lineno"> 7857</span>&#160;  <span class="keywordtype">bool</span> IsBaseNotUndef = !IsBaseUndef.<a class="code" href="classllvm_1_1SmallBitVector.html#a8cfcd92a373cdd7deefb939dd76b83e3">all</a>();</div>
<div class="line"><a name="l07858"></a><span class="lineno"> 7858</span>&#160;  (void)IsBaseNotUndef;</div>
<div class="line"><a name="l07859"></a><span class="lineno"> 7859</span>&#160;  <span class="comment">// Perform requested actions for the remaining masks/vectors.</span></div>
<div class="line"><a name="l07860"></a><span class="lineno"> 7860</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = ShuffleMask.end(); VMIt != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++VMIt) {</div>
<div class="line"><a name="l07861"></a><span class="lineno"> 7861</span>&#160;    <span class="comment">// Shuffle other input vectors, if any.</span></div>
<div class="line"><a name="l07862"></a><span class="lineno"> 7862</span>&#160;    std::pair&lt;T *, bool&gt; Res =</div>
<div class="line"><a name="l07863"></a><span class="lineno"> 7863</span>&#160;        ResizeAction(VMIt-&gt;first, VMIt-&gt;second, <span class="comment">/*ForSingleMask=*/</span><span class="keyword">false</span>);</div>
<div class="line"><a name="l07864"></a><span class="lineno"> 7864</span>&#160;    <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> SecMask = VMIt-&gt;second;</div>
<div class="line"><a name="l07865"></a><span class="lineno"> 7865</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, VF = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; VF; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l07866"></a><span class="lineno"> 7866</span>&#160;      <span class="keywordflow">if</span> (SecMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] != <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>) {</div>
<div class="line"><a name="l07867"></a><span class="lineno"> 7867</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a> || IsBaseNotUndef) &amp;&amp;</div>
<div class="line"><a name="l07868"></a><span class="lineno"> 7868</span>&#160;               <span class="stringliteral">&quot;Multiple uses of scalars.&quot;</span>);</div>
<div class="line"><a name="l07869"></a><span class="lineno"> 7869</span>&#160;        <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = (Res.second ? <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : SecMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]) + VF;</div>
<div class="line"><a name="l07870"></a><span class="lineno"> 7870</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] != <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>) {</div>
<div class="line"><a name="l07871"></a><span class="lineno"> 7871</span>&#160;        <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l07872"></a><span class="lineno"> 7872</span>&#160;      }</div>
<div class="line"><a name="l07873"></a><span class="lineno"> 7873</span>&#160;    }</div>
<div class="line"><a name="l07874"></a><span class="lineno"> 7874</span>&#160;    Prev = Action(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, {Prev, Res.first});</div>
<div class="line"><a name="l07875"></a><span class="lineno"> 7875</span>&#160;  }</div>
<div class="line"><a name="l07876"></a><span class="lineno"> 7876</span>&#160;  <span class="keywordflow">return</span> Prev;</div>
<div class="line"><a name="l07877"></a><span class="lineno"> 7877</span>&#160;}</div>
<div class="line"><a name="l07878"></a><span class="lineno"> 7878</span>&#160; </div>
<div class="line"><a name="l07879"></a><span class="lineno"> 7879</span>&#160;<a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> BoUpSLP::getTreeCost(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VectorizedVals) {</div>
<div class="line"><a name="l07880"></a><span class="lineno"> 7880</span>&#160;  <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> = 0;</div>
<div class="line"><a name="l07881"></a><span class="lineno"> 7881</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Calculating cost for tree of size &quot;</span></div>
<div class="line"><a name="l07882"></a><span class="lineno"> 7882</span>&#160;                    &lt;&lt; VectorizableTree.size() &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l07883"></a><span class="lineno"> 7883</span>&#160; </div>
<div class="line"><a name="l07884"></a><span class="lineno"> 7884</span>&#160;  <span class="keywordtype">unsigned</span> BundleWidth = VectorizableTree[0]-&gt;Scalars.size();</div>
<div class="line"><a name="l07885"></a><span class="lineno"> 7885</span>&#160; </div>
<div class="line"><a name="l07886"></a><span class="lineno"> 7886</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = VectorizableTree.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l07887"></a><span class="lineno"> 7887</span>&#160;    TreeEntry &amp;<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a> = *VectorizableTree[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l07888"></a><span class="lineno"> 7888</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.State == TreeEntry::NeedToGather) {</div>
<div class="line"><a name="l07889"></a><span class="lineno"> 7889</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">const</span> TreeEntry *<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = getTreeEntry(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.getMainOp());</div>
<div class="line"><a name="l07890"></a><span class="lineno"> 7890</span>&#160;          <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> &amp;&amp; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getVectorFactor() == <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.getVectorFactor() &amp;&amp;</div>
<div class="line"><a name="l07891"></a><span class="lineno"> 7891</span>&#160;          <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;isSame(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.Scalars)) {</div>
<div class="line"><a name="l07892"></a><span class="lineno"> 7892</span>&#160;        <span class="comment">// Some gather nodes might be absolutely the same as some vectorizable</span></div>
<div class="line"><a name="l07893"></a><span class="lineno"> 7893</span>&#160;        <span class="comment">// nodes after reordering, need to handle it.</span></div>
<div class="line"><a name="l07894"></a><span class="lineno"> 7894</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Adding cost 0 for bundle that starts with &quot;</span></div>
<div class="line"><a name="l07895"></a><span class="lineno"> 7895</span>&#160;                          &lt;&lt; *<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.Scalars[0] &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span></div>
<div class="line"><a name="l07896"></a><span class="lineno"> 7896</span>&#160;                          &lt;&lt; <span class="stringliteral">&quot;SLP: Current total cost = &quot;</span> &lt;&lt; Cost &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l07897"></a><span class="lineno"> 7897</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l07898"></a><span class="lineno"> 7898</span>&#160;      }</div>
<div class="line"><a name="l07899"></a><span class="lineno"> 7899</span>&#160;    }</div>
<div class="line"><a name="l07900"></a><span class="lineno"> 7900</span>&#160; </div>
<div class="line"><a name="l07901"></a><span class="lineno"> 7901</span>&#160;    <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = getEntryCost(&amp;TE, VectorizedVals);</div>
<div class="line"><a name="l07902"></a><span class="lineno"> 7902</span>&#160;    <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> += <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>;</div>
<div class="line"><a name="l07903"></a><span class="lineno"> 7903</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Adding cost &quot;</span> &lt;&lt; <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a></div>
<div class="line"><a name="l07904"></a><span class="lineno"> 7904</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot; for bundle that starts with &quot;</span> &lt;&lt; *<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>.Scalars[0]</div>
<div class="line"><a name="l07905"></a><span class="lineno"> 7905</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span></div>
<div class="line"><a name="l07906"></a><span class="lineno"> 7906</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;SLP: Current total cost = &quot;</span> &lt;&lt; Cost &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l07907"></a><span class="lineno"> 7907</span>&#160;  }</div>
<div class="line"><a name="l07908"></a><span class="lineno"> 7908</span>&#160; </div>
<div class="line"><a name="l07909"></a><span class="lineno"> 7909</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value *, 16&gt;</a> ExtractCostCalculated;</div>
<div class="line"><a name="l07910"></a><span class="lineno"> 7910</span>&#160;  <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> ExtractCost = 0;</div>
<div class="line"><a name="l07911"></a><span class="lineno"> 7911</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;MapVector&lt;const TreeEntry *, SmallVector&lt;int&gt;</a>&gt;&gt; ShuffleMasks;</div>
<div class="line"><a name="l07912"></a><span class="lineno"> 7912</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;Value *, const TreeEntry *&gt;</a>&gt; FirstUsers;</div>
<div class="line"><a name="l07913"></a><span class="lineno"> 7913</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;APInt&gt;</a> DemandedElts;</div>
<div class="line"><a name="l07914"></a><span class="lineno"> 7914</span>&#160;  <span class="keywordflow">for</span> (ExternalUser &amp;EU : ExternalUses) {</div>
<div class="line"><a name="l07915"></a><span class="lineno"> 7915</span>&#160;    <span class="comment">// We only add extract cost once for the same scalar.</span></div>
<div class="line"><a name="l07916"></a><span class="lineno"> 7916</span>&#160;    <span class="keywordflow">if</span> (!isa_and_nonnull&lt;InsertElementInst&gt;(EU.User) &amp;&amp;</div>
<div class="line"><a name="l07917"></a><span class="lineno"> 7917</span>&#160;        !ExtractCostCalculated.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(EU.Scalar).second)</div>
<div class="line"><a name="l07918"></a><span class="lineno"> 7918</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l07919"></a><span class="lineno"> 7919</span>&#160; </div>
<div class="line"><a name="l07920"></a><span class="lineno"> 7920</span>&#160;    <span class="comment">// Uses by ephemeral values are free (because the ephemeral value will be</span></div>
<div class="line"><a name="l07921"></a><span class="lineno"> 7921</span>&#160;    <span class="comment">// removed prior to code generation, and so the extraction will be</span></div>
<div class="line"><a name="l07922"></a><span class="lineno"> 7922</span>&#160;    <span class="comment">// removed as well).</span></div>
<div class="line"><a name="l07923"></a><span class="lineno"> 7923</span>&#160;    <span class="keywordflow">if</span> (EphValues.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(EU.User))</div>
<div class="line"><a name="l07924"></a><span class="lineno"> 7924</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l07925"></a><span class="lineno"> 7925</span>&#160; </div>
<div class="line"><a name="l07926"></a><span class="lineno"> 7926</span>&#160;    <span class="comment">// No extract cost for vector &quot;scalar&quot;</span></div>
<div class="line"><a name="l07927"></a><span class="lineno"> 7927</span>&#160;    <span class="keywordflow">if</span> (isa&lt;FixedVectorType&gt;(EU.Scalar-&gt;getType()))</div>
<div class="line"><a name="l07928"></a><span class="lineno"> 7928</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l07929"></a><span class="lineno"> 7929</span>&#160; </div>
<div class="line"><a name="l07930"></a><span class="lineno"> 7930</span>&#160;    <span class="comment">// If found user is an insertelement, do not calculate extract cost but try</span></div>
<div class="line"><a name="l07931"></a><span class="lineno"> 7931</span>&#160;    <span class="comment">// to detect it as a final shuffled/identity match.</span></div>
<div class="line"><a name="l07932"></a><span class="lineno"> 7932</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *VU = dyn_cast_or_null&lt;InsertElementInst&gt;(EU.User)) {</div>
<div class="line"><a name="l07933"></a><span class="lineno"> 7933</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *FTy = dyn_cast&lt;FixedVectorType&gt;(VU-&gt;<a class="code" href="classllvm_1_1InsertElementInst.html#a5532ffa629e5d85d605bb379f7aed857">getType</a>())) {</div>
<div class="line"><a name="l07934"></a><span class="lineno"> 7934</span>&#160;        std::optional&lt;unsigned&gt; InsertIdx = <a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(VU);</div>
<div class="line"><a name="l07935"></a><span class="lineno"> 7935</span>&#160;        <span class="keywordflow">if</span> (InsertIdx) {</div>
<div class="line"><a name="l07936"></a><span class="lineno"> 7936</span>&#160;          <span class="keyword">const</span> TreeEntry *ScalarTE = getTreeEntry(EU.Scalar);</div>
<div class="line"><a name="l07937"></a><span class="lineno"> 7937</span>&#160;          <span class="keyword">auto</span> *It = <a class="code" href="namespacellvm.html#ac78c09ae232b2ce188ff590d51e3c268">find_if</a>(</div>
<div class="line"><a name="l07938"></a><span class="lineno"> 7938</span>&#160;              FirstUsers,</div>
<div class="line"><a name="l07939"></a><span class="lineno"> 7939</span>&#160;              [<span class="keyword">this</span>, VU](<span class="keyword">const</span> std::pair&lt;Value *, const TreeEntry *&gt; &amp;Pair) {</div>
<div class="line"><a name="l07940"></a><span class="lineno"> 7940</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="SLPVectorizer_8cpp.html#abe6927d96b3815417479246b5afc732e">areTwoInsertFromSameBuildVector</a>(</div>
<div class="line"><a name="l07941"></a><span class="lineno"> 7941</span>&#160;                    VU, cast&lt;InsertElementInst&gt;(Pair.first),</div>
<div class="line"><a name="l07942"></a><span class="lineno"> 7942</span>&#160;                    [<span class="keyword">this</span>](<a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> *II) -&gt; <a class="code" href="classllvm_1_1Value.html">Value</a> * {</div>
<div class="line"><a name="l07943"></a><span class="lineno"> 7943</span>&#160;                      Value *Op0 = II-&gt;getOperand(0);</div>
<div class="line"><a name="l07944"></a><span class="lineno"> 7944</span>&#160;                      if (getTreeEntry(II) &amp;&amp; !getTreeEntry(Op0))</div>
<div class="line"><a name="l07945"></a><span class="lineno"> 7945</span>&#160;                        return nullptr;</div>
<div class="line"><a name="l07946"></a><span class="lineno"> 7946</span>&#160;                      return Op0;</div>
<div class="line"><a name="l07947"></a><span class="lineno"> 7947</span>&#160;                    });</div>
<div class="line"><a name="l07948"></a><span class="lineno"> 7948</span>&#160;              });</div>
<div class="line"><a name="l07949"></a><span class="lineno"> 7949</span>&#160;          <span class="keywordtype">int</span> VecId = -1;</div>
<div class="line"><a name="l07950"></a><span class="lineno"> 7950</span>&#160;          <span class="keywordflow">if</span> (It == FirstUsers.end()) {</div>
<div class="line"><a name="l07951"></a><span class="lineno"> 7951</span>&#160;            (void)ShuffleMasks.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>();</div>
<div class="line"><a name="l07952"></a><span class="lineno"> 7952</span>&#160;            <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;int&gt;</a> &amp;<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a> = ShuffleMasks.back()[ScalarTE];</div>
<div class="line"><a name="l07953"></a><span class="lineno"> 7953</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.empty())</div>
<div class="line"><a name="l07954"></a><span class="lineno"> 7954</span>&#160;              <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.assign(FTy-&gt;getNumElements(), <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l07955"></a><span class="lineno"> 7955</span>&#160;            <span class="comment">// Find the insertvector, vectorized in tree, if any.</span></div>
<div class="line"><a name="l07956"></a><span class="lineno"> 7956</span>&#160;            <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = VU;</div>
<div class="line"><a name="l07957"></a><span class="lineno"> 7957</span>&#160;            <span class="keywordflow">while</span> (<span class="keyword">auto</span> *IEBase = dyn_cast&lt;InsertElementInst&gt;(Base)) {</div>
<div class="line"><a name="l07958"></a><span class="lineno"> 7958</span>&#160;              <span class="keywordflow">if</span> (IEBase != EU.User &amp;&amp;</div>
<div class="line"><a name="l07959"></a><span class="lineno"> 7959</span>&#160;                  (!IEBase-&gt;hasOneUse() ||</div>
<div class="line"><a name="l07960"></a><span class="lineno"> 7960</span>&#160;                   <a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(IEBase).value_or(*InsertIdx) == *InsertIdx))</div>
<div class="line"><a name="l07961"></a><span class="lineno"> 7961</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l07962"></a><span class="lineno"> 7962</span>&#160;              <span class="comment">// Build the mask for the vectorized insertelement instructions.</span></div>
<div class="line"><a name="l07963"></a><span class="lineno"> 7963</span>&#160;              <span class="keywordflow">if</span> (<span class="keyword">const</span> TreeEntry *<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = getTreeEntry(IEBase)) {</div>
<div class="line"><a name="l07964"></a><span class="lineno"> 7964</span>&#160;                VU = IEBase;</div>
<div class="line"><a name="l07965"></a><span class="lineno"> 7965</span>&#160;                <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l07966"></a><span class="lineno"> 7966</span>&#160;                  IEBase = cast&lt;InsertElementInst&gt;(Base);</div>
<div class="line"><a name="l07967"></a><span class="lineno"> 7967</span>&#160;                  <span class="keywordtype">int</span> Idx = *<a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(IEBase);</div>
<div class="line"><a name="l07968"></a><span class="lineno"> 7968</span>&#160;                  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[Idx] == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a> &amp;&amp;</div>
<div class="line"><a name="l07969"></a><span class="lineno"> 7969</span>&#160;                         <span class="stringliteral">&quot;InsertElementInstruction used already.&quot;</span>);</div>
<div class="line"><a name="l07970"></a><span class="lineno"> 7970</span>&#160;                  <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[Idx] = Idx;</div>
<div class="line"><a name="l07971"></a><span class="lineno"> 7971</span>&#160;                  <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = IEBase-&gt;getOperand(0);</div>
<div class="line"><a name="l07972"></a><span class="lineno"> 7972</span>&#160;                } <span class="keywordflow">while</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> == getTreeEntry(Base));</div>
<div class="line"><a name="l07973"></a><span class="lineno"> 7973</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l07974"></a><span class="lineno"> 7974</span>&#160;              }</div>
<div class="line"><a name="l07975"></a><span class="lineno"> 7975</span>&#160;              <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = cast&lt;InsertElementInst&gt;(Base)-&gt;getOperand(0);</div>
<div class="line"><a name="l07976"></a><span class="lineno"> 7976</span>&#160;            }</div>
<div class="line"><a name="l07977"></a><span class="lineno"> 7977</span>&#160;            FirstUsers.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>(VU, ScalarTE);</div>
<div class="line"><a name="l07978"></a><span class="lineno"> 7978</span>&#160;            DemandedElts.push_back(<a class="code" href="classllvm_1_1APInt.html#add4e37b60ea64faafbc9a5bf3e27280f">APInt::getZero</a>(FTy-&gt;getNumElements()));</div>
<div class="line"><a name="l07979"></a><span class="lineno"> 7979</span>&#160;            VecId = FirstUsers.size() - 1;</div>
<div class="line"><a name="l07980"></a><span class="lineno"> 7980</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l07981"></a><span class="lineno"> 7981</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#a405ff61e8571b58fecaa716540af108f">isFirstInsertElement</a>(VU, cast&lt;InsertElementInst&gt;(It-&gt;first)))</div>
<div class="line"><a name="l07982"></a><span class="lineno"> 7982</span>&#160;              It-&gt;first = VU;</div>
<div class="line"><a name="l07983"></a><span class="lineno"> 7983</span>&#160;            VecId = std::distance(FirstUsers.begin(), It);</div>
<div class="line"><a name="l07984"></a><span class="lineno"> 7984</span>&#160;          }</div>
<div class="line"><a name="l07985"></a><span class="lineno"> 7985</span>&#160;          <span class="keywordtype">int</span> InIdx = *InsertIdx;</div>
<div class="line"><a name="l07986"></a><span class="lineno"> 7986</span>&#160;          <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;int&gt;</a> &amp;<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a> = ShuffleMasks[VecId][ScalarTE];</div>
<div class="line"><a name="l07987"></a><span class="lineno"> 7987</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.empty())</div>
<div class="line"><a name="l07988"></a><span class="lineno"> 7988</span>&#160;            <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.assign(FTy-&gt;getNumElements(), <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l07989"></a><span class="lineno"> 7989</span>&#160;          <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[InIdx] = EU.Lane;</div>
<div class="line"><a name="l07990"></a><span class="lineno"> 7990</span>&#160;          DemandedElts[VecId].setBit(InIdx);</div>
<div class="line"><a name="l07991"></a><span class="lineno"> 7991</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l07992"></a><span class="lineno"> 7992</span>&#160;        }</div>
<div class="line"><a name="l07993"></a><span class="lineno"> 7993</span>&#160;      }</div>
<div class="line"><a name="l07994"></a><span class="lineno"> 7994</span>&#160;    }</div>
<div class="line"><a name="l07995"></a><span class="lineno"> 7995</span>&#160; </div>
<div class="line"><a name="l07996"></a><span class="lineno"> 7996</span>&#160;    <span class="comment">// If we plan to rewrite the tree in a smaller type, we will need to sign</span></div>
<div class="line"><a name="l07997"></a><span class="lineno"> 7997</span>&#160;    <span class="comment">// extend the extracted value back to the original type. Here, we account</span></div>
<div class="line"><a name="l07998"></a><span class="lineno"> 7998</span>&#160;    <span class="comment">// for the extract and the added cost of the sign extend if needed.</span></div>
<div class="line"><a name="l07999"></a><span class="lineno"> 7999</span>&#160;    <span class="keyword">auto</span> *VecTy = <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(EU.Scalar-&gt;getType(), BundleWidth);</div>
<div class="line"><a name="l08000"></a><span class="lineno"> 8000</span>&#160;    <a class="code" href="classllvm_1_1TargetTransformInfo.html#a706f223f760b55668fbae74202b816bb">TTI::TargetCostKind</a> <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a> = <a class="code" href="classllvm_1_1TargetTransformInfo.html#a706f223f760b55668fbae74202b816bba59b32ea7b6f10564abd40ad90602ca5b">TTI::TCK_RecipThroughput</a>;</div>
<div class="line"><a name="l08001"></a><span class="lineno"> 8001</span>&#160;    <span class="keyword">auto</span> *ScalarRoot = VectorizableTree[0]-&gt;Scalars[0];</div>
<div class="line"><a name="l08002"></a><span class="lineno"> 8002</span>&#160;    <span class="keywordflow">if</span> (MinBWs.count(ScalarRoot)) {</div>
<div class="line"><a name="l08003"></a><span class="lineno"> 8003</span>&#160;      <span class="keyword">auto</span> *MinTy = <a class="code" href="classllvm_1_1IntegerType.html#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getContext(), MinBWs[ScalarRoot].first);</div>
<div class="line"><a name="l08004"></a><span class="lineno"> 8004</span>&#160;      <span class="keyword">auto</span> Extend =</div>
<div class="line"><a name="l08005"></a><span class="lineno"> 8005</span>&#160;          MinBWs[ScalarRoot].second ? Instruction::SExt : Instruction::ZExt;</div>
<div class="line"><a name="l08006"></a><span class="lineno"> 8006</span>&#160;      VecTy = <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(MinTy, BundleWidth);</div>
<div class="line"><a name="l08007"></a><span class="lineno"> 8007</span>&#160;      ExtractCost += <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#acbea7151f5e66776f92f7b4e305418d6">getExtractWithExtendCost</a>(Extend, EU.Scalar-&gt;getType(),</div>
<div class="line"><a name="l08008"></a><span class="lineno"> 8008</span>&#160;                                                   VecTy, EU.Lane);</div>
<div class="line"><a name="l08009"></a><span class="lineno"> 8009</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l08010"></a><span class="lineno"> 8010</span>&#160;      ExtractCost += <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#af37b2842424eb63440bdcacca0af9820">getVectorInstrCost</a>(Instruction::ExtractElement, VecTy,</div>
<div class="line"><a name="l08011"></a><span class="lineno"> 8011</span>&#160;                                             <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>, EU.Lane);</div>
<div class="line"><a name="l08012"></a><span class="lineno"> 8012</span>&#160;    }</div>
<div class="line"><a name="l08013"></a><span class="lineno"> 8013</span>&#160;  }</div>
<div class="line"><a name="l08014"></a><span class="lineno"> 8014</span>&#160; </div>
<div class="line"><a name="l08015"></a><span class="lineno"> 8015</span>&#160;  <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> SpillCost = getSpillCost();</div>
<div class="line"><a name="l08016"></a><span class="lineno"> 8016</span>&#160;  <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> += SpillCost + ExtractCost;</div>
<div class="line"><a name="l08017"></a><span class="lineno"> 8017</span>&#160;  <span class="keyword">auto</span> &amp;&amp;ResizeToVF = [<span class="keyword">this</span>, &amp;<a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a>](<span class="keyword">const</span> TreeEntry *<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>,</div>
<div class="line"><a name="l08018"></a><span class="lineno"> 8018</span>&#160;                                    bool) {</div>
<div class="line"><a name="l08019"></a><span class="lineno"> 8019</span>&#160;    <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = 0;</div>
<div class="line"><a name="l08020"></a><span class="lineno"> 8020</span>&#160;    <span class="keywordtype">unsigned</span> VF = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size();</div>
<div class="line"><a name="l08021"></a><span class="lineno"> 8021</span>&#160;    <span class="keywordtype">unsigned</span> VecVF = <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;getVectorFactor();</div>
<div class="line"><a name="l08022"></a><span class="lineno"> 8022</span>&#160;    <span class="keywordflow">if</span> (VF != VecVF &amp;&amp;</div>
<div class="line"><a name="l08023"></a><span class="lineno"> 8023</span>&#160;        (<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, [VF](<span class="keywordtype">int</span> Idx) { <span class="keywordflow">return</span> Idx &gt;= <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(VF); }) ||</div>
<div class="line"><a name="l08024"></a><span class="lineno"> 8024</span>&#160;         (<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>,</div>
<div class="line"><a name="l08025"></a><span class="lineno"> 8025</span>&#160;                 [VF](<span class="keywordtype">int</span> Idx) { <span class="keywordflow">return</span> Idx &lt; 2 * static_cast&lt;int&gt;(VF); }) &amp;&amp;</div>
<div class="line"><a name="l08026"></a><span class="lineno"> 8026</span>&#160;          !<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a4bc8953b0fd0277b0e5a8e5b78025150">ShuffleVectorInst::isIdentityMask</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>)))) {</div>
<div class="line"><a name="l08027"></a><span class="lineno"> 8027</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> OrigMask(VecVF, <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l08028"></a><span class="lineno"> 8028</span>&#160;      <a class="code" href="lib_2Target_2WebAssembly_2README_8txt.html#a79ea041233b5866026c3071dfc464ec0">std::copy</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.begin(), std::next(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.begin(), <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(VF, VecVF)),</div>
<div class="line"><a name="l08029"></a><span class="lineno"> 8029</span>&#160;                OrigMask.begin());</div>
<div class="line"><a name="l08030"></a><span class="lineno"> 8030</span>&#160;      <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#aa0519f26bcb15c25ac0ff557061fa7af">getShuffleCost</a>(</div>
<div class="line"><a name="l08031"></a><span class="lineno"> 8031</span>&#160;          <a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53eca7beec9815d0197f2d31fac9968e9205b">TTI::SK_PermuteSingleSrc</a>,</div>
<div class="line"><a name="l08032"></a><span class="lineno"> 8032</span>&#160;          <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;getMainOp()-&gt;getType(), VecVF), OrigMask);</div>
<div class="line"><a name="l08033"></a><span class="lineno"> 8033</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(</div>
<div class="line"><a name="l08034"></a><span class="lineno"> 8034</span>&#160;          <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Adding cost &quot;</span> &lt;&lt; <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a></div>
<div class="line"><a name="l08035"></a><span class="lineno"> 8035</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot; for final shuffle of insertelement external users.\n&quot;</span>;</div>
<div class="line"><a name="l08036"></a><span class="lineno"> 8036</span>&#160;          <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;dump(); <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Current total cost = &quot;</span> &lt;&lt; <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l08037"></a><span class="lineno"> 8037</span>&#160;      <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> += <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>;</div>
<div class="line"><a name="l08038"></a><span class="lineno"> 8038</span>&#160;      <span class="keywordflow">return</span> std::make_pair(TE, <span class="keyword">true</span>);</div>
<div class="line"><a name="l08039"></a><span class="lineno"> 8039</span>&#160;    }</div>
<div class="line"><a name="l08040"></a><span class="lineno"> 8040</span>&#160;    <span class="keywordflow">return</span> std::make_pair(TE, <span class="keyword">false</span>);</div>
<div class="line"><a name="l08041"></a><span class="lineno"> 8041</span>&#160;  };</div>
<div class="line"><a name="l08042"></a><span class="lineno"> 8042</span>&#160;  <span class="comment">// Calculate the cost of the reshuffled vectors, if any.</span></div>
<div class="line"><a name="l08043"></a><span class="lineno"> 8043</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = FirstUsers.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l08044"></a><span class="lineno"> 8044</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = cast&lt;Instruction&gt;(FirstUsers[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].first)-&gt;getOperand(0);</div>
<div class="line"><a name="l08045"></a><span class="lineno"> 8045</span>&#160;    <span class="keywordtype">unsigned</span> VF = ShuffleMasks[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].begin()-&gt;second.size();</div>
<div class="line"><a name="l08046"></a><span class="lineno"> 8046</span>&#160;    <span class="keyword">auto</span> *FTy = <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(</div>
<div class="line"><a name="l08047"></a><span class="lineno"> 8047</span>&#160;        cast&lt;VectorType&gt;(FirstUsers[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].first-&gt;getType())-&gt;getElementType(), VF);</div>
<div class="line"><a name="l08048"></a><span class="lineno"> 8048</span>&#160;    <span class="keyword">auto</span> <a class="code" href="README__P9_8txt.html#ae6881514a39f1bcf75ad62e5188700a4">Vector</a> = ShuffleMasks[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].takeVector();</div>
<div class="line"><a name="l08049"></a><span class="lineno"> 8049</span>&#160;    <span class="keyword">auto</span> &amp;&amp;EstimateShufflesCost = [<span class="keyword">this</span>, FTy,</div>
<div class="line"><a name="l08050"></a><span class="lineno"> 8050</span>&#160;                                   &amp;<a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a>](<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>,</div>
<div class="line"><a name="l08051"></a><span class="lineno"> 8051</span>&#160;                                          <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;const TreeEntry *&gt;</a> TEs) {</div>
<div class="line"><a name="l08052"></a><span class="lineno"> 8052</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((TEs.size() == 1 || TEs.size() == 2) &amp;&amp;</div>
<div class="line"><a name="l08053"></a><span class="lineno"> 8053</span>&#160;             <span class="stringliteral">&quot;Expected exactly 1 or 2 tree entries.&quot;</span>);</div>
<div class="line"><a name="l08054"></a><span class="lineno"> 8054</span>&#160;      <span class="keywordflow">if</span> (TEs.size() == 1) {</div>
<div class="line"><a name="l08055"></a><span class="lineno"> 8055</span>&#160;        <span class="keywordtype">int</span> Limit = 2 * <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size();</div>
<div class="line"><a name="l08056"></a><span class="lineno"> 8056</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, [Limit](<span class="keywordtype">int</span> Idx) { <span class="keywordflow">return</span> Idx &lt; Limit; }) ||</div>
<div class="line"><a name="l08057"></a><span class="lineno"> 8057</span>&#160;            !<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a4bc8953b0fd0277b0e5a8e5b78025150">ShuffleVectorInst::isIdentityMask</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>)) {</div>
<div class="line"><a name="l08058"></a><span class="lineno"> 8058</span>&#160;          <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> =</div>
<div class="line"><a name="l08059"></a><span class="lineno"> 8059</span>&#160;              <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#aa0519f26bcb15c25ac0ff557061fa7af">getShuffleCost</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53eca7beec9815d0197f2d31fac9968e9205b">TTI::SK_PermuteSingleSrc</a>, FTy, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l08060"></a><span class="lineno"> 8060</span>&#160;          <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Adding cost &quot;</span> &lt;&lt; <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a></div>
<div class="line"><a name="l08061"></a><span class="lineno"> 8061</span>&#160;                            &lt;&lt; <span class="stringliteral">&quot; for final shuffle of insertelement &quot;</span></div>
<div class="line"><a name="l08062"></a><span class="lineno"> 8062</span>&#160;                               <span class="stringliteral">&quot;external users.\n&quot;</span>;</div>
<div class="line"><a name="l08063"></a><span class="lineno"> 8063</span>&#160;                     TEs.front()-&gt;<a class="code" href="namespacellvm.html#a03503773241005f01b090b9862aad304">dump</a>();</div>
<div class="line"><a name="l08064"></a><span class="lineno"> 8064</span>&#160;                     <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Current total cost = &quot;</span> &lt;&lt; <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l08065"></a><span class="lineno"> 8065</span>&#160;          <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> += <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>;</div>
<div class="line"><a name="l08066"></a><span class="lineno"> 8066</span>&#160;        }</div>
<div class="line"><a name="l08067"></a><span class="lineno"> 8067</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l08068"></a><span class="lineno"> 8068</span>&#160;        <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> =</div>
<div class="line"><a name="l08069"></a><span class="lineno"> 8069</span>&#160;            <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#aa0519f26bcb15c25ac0ff557061fa7af">getShuffleCost</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53ecab4616961a3bfdaec42aedc4fc426ccfe">TTI::SK_PermuteTwoSrc</a>, FTy, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l08070"></a><span class="lineno"> 8070</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Adding cost &quot;</span> &lt;&lt; <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a></div>
<div class="line"><a name="l08071"></a><span class="lineno"> 8071</span>&#160;                          &lt;&lt; <span class="stringliteral">&quot; for final shuffle of vector node and external &quot;</span></div>
<div class="line"><a name="l08072"></a><span class="lineno"> 8072</span>&#160;                             <span class="stringliteral">&quot;insertelement users.\n&quot;</span>;</div>
<div class="line"><a name="l08073"></a><span class="lineno"> 8073</span>&#160;                   <span class="keywordflow">if</span> (TEs.front()) { TEs.front()-&gt;dump(); } TEs.back()-&gt;dump();</div>
<div class="line"><a name="l08074"></a><span class="lineno"> 8074</span>&#160;                   <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Current total cost = &quot;</span> &lt;&lt; Cost &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l08075"></a><span class="lineno"> 8075</span>&#160;        <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> += <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>;</div>
<div class="line"><a name="l08076"></a><span class="lineno"> 8076</span>&#160;      }</div>
<div class="line"><a name="l08077"></a><span class="lineno"> 8077</span>&#160;      <span class="keywordflow">return</span> TEs.back();</div>
<div class="line"><a name="l08078"></a><span class="lineno"> 8078</span>&#160;    };</div>
<div class="line"><a name="l08079"></a><span class="lineno"> 8079</span>&#160;    (void)performExtractsShuffleAction&lt;const TreeEntry&gt;(</div>
<div class="line"><a name="l08080"></a><span class="lineno"> 8080</span>&#160;        <a class="code" href="namespacellvm.html#a99416758c13252bef45320a6ba6aa09c">MutableArrayRef</a>(<a class="code" href="README__P9_8txt.html#ae6881514a39f1bcf75ad62e5188700a4">Vector</a>.data(), <a class="code" href="README__P9_8txt.html#ae6881514a39f1bcf75ad62e5188700a4">Vector</a>.size()), <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>,</div>
<div class="line"><a name="l08081"></a><span class="lineno"> 8081</span>&#160;        [](<span class="keyword">const</span> TreeEntry *<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>) { <span class="keywordflow">return</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getVectorFactor(); }, ResizeToVF,</div>
<div class="line"><a name="l08082"></a><span class="lineno"> 8082</span>&#160;        EstimateShufflesCost);</div>
<div class="line"><a name="l08083"></a><span class="lineno"> 8083</span>&#160;    <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> InsertCost = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#ae7fe2d1bb4f708d68fe7a908ba675d1b">getScalarizationOverhead</a>(</div>
<div class="line"><a name="l08084"></a><span class="lineno"> 8084</span>&#160;        cast&lt;FixedVectorType&gt;(FirstUsers[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].first-&gt;getType()), DemandedElts[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>],</div>
<div class="line"><a name="l08085"></a><span class="lineno"> 8085</span>&#160;        <span class="comment">/*Insert*/</span> <span class="keyword">true</span>, <span class="comment">/*Extract*/</span> <span class="keyword">false</span>, <a class="code" href="classllvm_1_1TargetTransformInfo.html#a706f223f760b55668fbae74202b816bba59b32ea7b6f10564abd40ad90602ca5b">TTI::TCK_RecipThroughput</a>);</div>
<div class="line"><a name="l08086"></a><span class="lineno"> 8086</span>&#160;    <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> -= InsertCost;</div>
<div class="line"><a name="l08087"></a><span class="lineno"> 8087</span>&#160;  }</div>
<div class="line"><a name="l08088"></a><span class="lineno"> 8088</span>&#160; </div>
<div class="line"><a name="l08089"></a><span class="lineno"> 8089</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l08090"></a><span class="lineno"> 8090</span>&#160;  <a class="code" href="classllvm_1_1SmallString.html">SmallString&lt;256&gt;</a> Str;</div>
<div class="line"><a name="l08091"></a><span class="lineno"> 8091</span>&#160;  {</div>
<div class="line"><a name="l08092"></a><span class="lineno"> 8092</span>&#160;    <a class="code" href="classllvm_1_1raw__svector__ostream.html">raw_svector_ostream</a> <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a>(Str);</div>
<div class="line"><a name="l08093"></a><span class="lineno"> 8093</span>&#160;    <a class="code" href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a> &lt;&lt; <span class="stringliteral">&quot;SLP: Spill Cost = &quot;</span> &lt;&lt; SpillCost &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span></div>
<div class="line"><a name="l08094"></a><span class="lineno"> 8094</span>&#160;       &lt;&lt; <span class="stringliteral">&quot;SLP: Extract Cost = &quot;</span> &lt;&lt; ExtractCost &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span></div>
<div class="line"><a name="l08095"></a><span class="lineno"> 8095</span>&#160;       &lt;&lt; <span class="stringliteral">&quot;SLP: Total Cost = &quot;</span> &lt;&lt; <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>;</div>
<div class="line"><a name="l08096"></a><span class="lineno"> 8096</span>&#160;  }</div>
<div class="line"><a name="l08097"></a><span class="lineno"> 8097</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; Str);</div>
<div class="line"><a name="l08098"></a><span class="lineno"> 8098</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#a2bbbb8fefbe682386c09baafff9a7cf1">ViewSLPTree</a>)</div>
<div class="line"><a name="l08099"></a><span class="lineno"> 8099</span>&#160;    <a class="code" href="namespacellvm.html#ab8635363d4287c93f64c55ad5567fcf0">ViewGraph</a>(<span class="keyword">this</span>, <span class="stringliteral">&quot;SLP&quot;</span> + <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName(), <span class="keyword">false</span>, Str);</div>
<div class="line"><a name="l08100"></a><span class="lineno"> 8100</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l08101"></a><span class="lineno"> 8101</span>&#160; </div>
<div class="line"><a name="l08102"></a><span class="lineno"> 8102</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a>;</div>
<div class="line"><a name="l08103"></a><span class="lineno"> 8103</span>&#160;}</div>
<div class="line"><a name="l08104"></a><span class="lineno"> 8104</span>&#160; </div>
<div class="line"><a name="l08105"></a><span class="lineno"> 8105</span>&#160;std::optional&lt;TargetTransformInfo::ShuffleKind&gt;</div>
<div class="line"><a name="l08106"></a><span class="lineno"> 8106</span>&#160;BoUpSLP::isGatherShuffledEntry(<span class="keyword">const</span> TreeEntry *TE, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL,</div>
<div class="line"><a name="l08107"></a><span class="lineno"> 8107</span>&#160;                               <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;int&gt;</a> &amp;<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>,</div>
<div class="line"><a name="l08108"></a><span class="lineno"> 8108</span>&#160;                               <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const TreeEntry *&gt;</a> &amp;Entries) {</div>
<div class="line"><a name="l08109"></a><span class="lineno"> 8109</span>&#160;  Entries.clear();</div>
<div class="line"><a name="l08110"></a><span class="lineno"> 8110</span>&#160;  <span class="comment">// No need to check for the topmost gather node.</span></div>
<div class="line"><a name="l08111"></a><span class="lineno"> 8111</span>&#160;  <span class="keywordflow">if</span> (TE == VectorizableTree.front().get())</div>
<div class="line"><a name="l08112"></a><span class="lineno"> 8112</span>&#160;    <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l08113"></a><span class="lineno"> 8113</span>&#160;  <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.assign(VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(), <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l08114"></a><span class="lineno"> 8114</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;UserTreeIndices.size() == 1 &amp;&amp;</div>
<div class="line"><a name="l08115"></a><span class="lineno"> 8115</span>&#160;         <span class="stringliteral">&quot;Expected only single user of the gather node.&quot;</span>);</div>
<div class="line"><a name="l08116"></a><span class="lineno"> 8116</span>&#160;  <span class="comment">// TODO: currently checking only for Scalars in the tree entry, need to count</span></div>
<div class="line"><a name="l08117"></a><span class="lineno"> 8117</span>&#160;  <span class="comment">// reused elements too for better cost estimation.</span></div>
<div class="line"><a name="l08118"></a><span class="lineno"> 8118</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;UserInst =</div>
<div class="line"><a name="l08119"></a><span class="lineno"> 8119</span>&#160;      getLastInstructionInBundle(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;UserTreeIndices.front().UserTE);</div>
<div class="line"><a name="l08120"></a><span class="lineno"> 8120</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = dyn_cast&lt;PHINode&gt;(&amp;UserInst);</div>
<div class="line"><a name="l08121"></a><span class="lineno"> 8121</span>&#160;  <span class="keyword">auto</span> *NodeUI = DT-&gt;getNode(</div>
<div class="line"><a name="l08122"></a><span class="lineno"> 8122</span>&#160;      <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> ? <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getIncomingBlock(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;UserTreeIndices.front().EdgeIdx)</div>
<div class="line"><a name="l08123"></a><span class="lineno"> 8123</span>&#160;          : UserInst.<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>());</div>
<div class="line"><a name="l08124"></a><span class="lineno"> 8124</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NodeUI &amp;&amp; <span class="stringliteral">&quot;Should only process reachable instructions&quot;</span>);</div>
<div class="line"><a name="l08125"></a><span class="lineno"> 8125</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value *, 4&gt;</a> GatheredScalars(VL.<a class="code" href="classllvm_1_1ArrayRef.html#aab36927882fbfdcbb860d87fd9c30da8">begin</a>(), VL.<a class="code" href="classllvm_1_1ArrayRef.html#a7ca5197533a9c1fb8a2bd30587fcec6b">end</a>());</div>
<div class="line"><a name="l08126"></a><span class="lineno"> 8126</span>&#160;  <span class="keyword">auto</span> CheckOrdering = [&amp;](<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *LastEI) {</div>
<div class="line"><a name="l08127"></a><span class="lineno"> 8127</span>&#160;    <span class="comment">// Check if the user node of the TE comes after user node of EntryPtr,</span></div>
<div class="line"><a name="l08128"></a><span class="lineno"> 8128</span>&#160;    <span class="comment">// otherwise EntryPtr depends on TE.</span></div>
<div class="line"><a name="l08129"></a><span class="lineno"> 8129</span>&#160;    <span class="comment">// Gather nodes usually are not scheduled and inserted before their first</span></div>
<div class="line"><a name="l08130"></a><span class="lineno"> 8130</span>&#160;    <span class="comment">// user node. So, instead of checking dependency between the gather nodes</span></div>
<div class="line"><a name="l08131"></a><span class="lineno"> 8131</span>&#160;    <span class="comment">// themselves, we check the dependency between their user nodes.</span></div>
<div class="line"><a name="l08132"></a><span class="lineno"> 8132</span>&#160;    <span class="comment">// If one user node comes before the second one, we cannot use the second</span></div>
<div class="line"><a name="l08133"></a><span class="lineno"> 8133</span>&#160;    <span class="comment">// gather node as the source vector for the first gather node, because in</span></div>
<div class="line"><a name="l08134"></a><span class="lineno"> 8134</span>&#160;    <span class="comment">// the list of instructions it will be emitted later.</span></div>
<div class="line"><a name="l08135"></a><span class="lineno"> 8135</span>&#160;    <span class="keyword">auto</span> *EntryParent = LastEI-&gt;getParent();</div>
<div class="line"><a name="l08136"></a><span class="lineno"> 8136</span>&#160;    <span class="keyword">auto</span> *NodeEUI = DT-&gt;getNode(EntryParent);</div>
<div class="line"><a name="l08137"></a><span class="lineno"> 8137</span>&#160;    <span class="keywordflow">if</span> (!NodeEUI)</div>
<div class="line"><a name="l08138"></a><span class="lineno"> 8138</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l08139"></a><span class="lineno"> 8139</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((NodeUI == NodeEUI) ==</div>
<div class="line"><a name="l08140"></a><span class="lineno"> 8140</span>&#160;               (NodeUI-&gt;getDFSNumIn() == NodeEUI-&gt;getDFSNumIn()) &amp;&amp;</div>
<div class="line"><a name="l08141"></a><span class="lineno"> 8141</span>&#160;           <span class="stringliteral">&quot;Different nodes should have different DFS numbers&quot;</span>);</div>
<div class="line"><a name="l08142"></a><span class="lineno"> 8142</span>&#160;    <span class="comment">// Check the order of the gather nodes users.</span></div>
<div class="line"><a name="l08143"></a><span class="lineno"> 8143</span>&#160;    <span class="keywordflow">if</span> (UserInst.<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() != EntryParent &amp;&amp;</div>
<div class="line"><a name="l08144"></a><span class="lineno"> 8144</span>&#160;        (DT-&gt;dominates(NodeUI, NodeEUI) || !DT-&gt;dominates(NodeEUI, NodeUI)))</div>
<div class="line"><a name="l08145"></a><span class="lineno"> 8145</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l08146"></a><span class="lineno"> 8146</span>&#160;    <span class="keywordflow">if</span> (UserInst.<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() == EntryParent &amp;&amp; UserInst.<a class="code" href="classllvm_1_1Instruction.html#a784097fca76abad9e815cf1692de79c4">comesBefore</a>(LastEI))</div>
<div class="line"><a name="l08147"></a><span class="lineno"> 8147</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l08148"></a><span class="lineno"> 8148</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l08149"></a><span class="lineno"> 8149</span>&#160;  };</div>
<div class="line"><a name="l08150"></a><span class="lineno"> 8150</span>&#160;  <span class="comment">// Build a lists of values to tree entries.</span></div>
<div class="line"><a name="l08151"></a><span class="lineno"> 8151</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, SmallPtrSet&lt;const TreeEntry *, 4&gt;</a>&gt; ValueToTEs;</div>
<div class="line"><a name="l08152"></a><span class="lineno"> 8152</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> std::unique_ptr&lt;TreeEntry&gt; &amp;EntryPtr : VectorizableTree) {</div>
<div class="line"><a name="l08153"></a><span class="lineno"> 8153</span>&#160;    <span class="keywordflow">if</span> (EntryPtr.get() == TE)</div>
<div class="line"><a name="l08154"></a><span class="lineno"> 8154</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08155"></a><span class="lineno"> 8155</span>&#160;    <span class="keywordflow">if</span> (EntryPtr-&gt;State != TreeEntry::NeedToGather)</div>
<div class="line"><a name="l08156"></a><span class="lineno"> 8156</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08157"></a><span class="lineno"> 8157</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(EntryPtr-&gt;Scalars, [&amp;GatheredScalars](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l08158"></a><span class="lineno"> 8158</span>&#160;          return GatheredScalars.contains(V);</div>
<div class="line"><a name="l08159"></a><span class="lineno"> 8159</span>&#160;        }))</div>
<div class="line"><a name="l08160"></a><span class="lineno"> 8160</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08161"></a><span class="lineno"> 8161</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EntryPtr-&gt;UserTreeIndices.size() == 1 &amp;&amp;</div>
<div class="line"><a name="l08162"></a><span class="lineno"> 8162</span>&#160;           <span class="stringliteral">&quot;Expected only single user of the gather node.&quot;</span>);</div>
<div class="line"><a name="l08163"></a><span class="lineno"> 8163</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;EntryUserInst =</div>
<div class="line"><a name="l08164"></a><span class="lineno"> 8164</span>&#160;        getLastInstructionInBundle(EntryPtr-&gt;UserTreeIndices.front().UserTE);</div>
<div class="line"><a name="l08165"></a><span class="lineno"> 8165</span>&#160;    <span class="keywordflow">if</span> (&amp;UserInst == &amp;EntryUserInst) {</div>
<div class="line"><a name="l08166"></a><span class="lineno"> 8166</span>&#160;      <span class="comment">// If 2 gathers are operands of the same entry, compare operands indices,</span></div>
<div class="line"><a name="l08167"></a><span class="lineno"> 8167</span>&#160;      <span class="comment">// use the earlier one as the base.</span></div>
<div class="line"><a name="l08168"></a><span class="lineno"> 8168</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;UserTreeIndices.front().UserTE ==</div>
<div class="line"><a name="l08169"></a><span class="lineno"> 8169</span>&#160;              EntryPtr-&gt;UserTreeIndices.front().UserTE &amp;&amp;</div>
<div class="line"><a name="l08170"></a><span class="lineno"> 8170</span>&#160;          <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;UserTreeIndices.front().EdgeIdx &lt;</div>
<div class="line"><a name="l08171"></a><span class="lineno"> 8171</span>&#160;              EntryPtr-&gt;UserTreeIndices.front().EdgeIdx)</div>
<div class="line"><a name="l08172"></a><span class="lineno"> 8172</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08173"></a><span class="lineno"> 8173</span>&#160;    }</div>
<div class="line"><a name="l08174"></a><span class="lineno"> 8174</span>&#160;    <span class="comment">// Check if the user node of the TE comes after user node of EntryPtr,</span></div>
<div class="line"><a name="l08175"></a><span class="lineno"> 8175</span>&#160;    <span class="comment">// otherwise EntryPtr depends on TE.</span></div>
<div class="line"><a name="l08176"></a><span class="lineno"> 8176</span>&#160;    <span class="keyword">auto</span> *EntryPHI = dyn_cast&lt;PHINode&gt;(&amp;EntryUserInst);</div>
<div class="line"><a name="l08177"></a><span class="lineno"> 8177</span>&#160;    <span class="keyword">auto</span> *EntryI =</div>
<div class="line"><a name="l08178"></a><span class="lineno"> 8178</span>&#160;        EntryPHI</div>
<div class="line"><a name="l08179"></a><span class="lineno"> 8179</span>&#160;            ? EntryPHI</div>
<div class="line"><a name="l08180"></a><span class="lineno"> 8180</span>&#160;                  -&gt;getIncomingBlock(EntryPtr-&gt;UserTreeIndices.front().EdgeIdx)</div>
<div class="line"><a name="l08181"></a><span class="lineno"> 8181</span>&#160;                  -&gt;getTerminator()</div>
<div class="line"><a name="l08182"></a><span class="lineno"> 8182</span>&#160;            : &amp;EntryUserInst;</div>
<div class="line"><a name="l08183"></a><span class="lineno"> 8183</span>&#160;    <span class="keywordflow">if</span> (!CheckOrdering(EntryI))</div>
<div class="line"><a name="l08184"></a><span class="lineno"> 8184</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08185"></a><span class="lineno"> 8185</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : EntryPtr-&gt;Scalars)</div>
<div class="line"><a name="l08186"></a><span class="lineno"> 8186</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="SLPVectorizer_8cpp.html#a6848b7e929178610d01e1b2b5052af86">isConstant</a>(V))</div>
<div class="line"><a name="l08187"></a><span class="lineno"> 8187</span>&#160;        ValueToTEs.<a class="code" href="classllvm_1_1DenseMapBase.html#a98c685a0c53f3f7ed5f4793890a6c850">try_emplace</a>(V).first-&gt;getSecond().insert(EntryPtr.get());</div>
<div class="line"><a name="l08188"></a><span class="lineno"> 8188</span>&#160;  }</div>
<div class="line"><a name="l08189"></a><span class="lineno"> 8189</span>&#160;  <span class="comment">// Find all tree entries used by the gathered values. If no common entries</span></div>
<div class="line"><a name="l08190"></a><span class="lineno"> 8190</span>&#160;  <span class="comment">// found - not a shuffle.</span></div>
<div class="line"><a name="l08191"></a><span class="lineno"> 8191</span>&#160;  <span class="comment">// Here we build a set of tree nodes for each gathered value and trying to</span></div>
<div class="line"><a name="l08192"></a><span class="lineno"> 8192</span>&#160;  <span class="comment">// find the intersection between these sets. If we have at least one common</span></div>
<div class="line"><a name="l08193"></a><span class="lineno"> 8193</span>&#160;  <span class="comment">// tree node for each gathered value - we have just a permutation of the</span></div>
<div class="line"><a name="l08194"></a><span class="lineno"> 8194</span>&#160;  <span class="comment">// single vector. If we have 2 different sets, we&#39;re in situation where we</span></div>
<div class="line"><a name="l08195"></a><span class="lineno"> 8195</span>&#160;  <span class="comment">// have a permutation of 2 input vectors.</span></div>
<div class="line"><a name="l08196"></a><span class="lineno"> 8196</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;SmallPtrSet&lt;const TreeEntry *, 4&gt;</a>&gt; UsedTEs;</div>
<div class="line"><a name="l08197"></a><span class="lineno"> 8197</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, int&gt;</a> UsedValuesEntry;</div>
<div class="line"><a name="l08198"></a><span class="lineno"> 8198</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;Scalars) {</div>
<div class="line"><a name="l08199"></a><span class="lineno"> 8199</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#a6848b7e929178610d01e1b2b5052af86">isConstant</a>(V))</div>
<div class="line"><a name="l08200"></a><span class="lineno"> 8200</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08201"></a><span class="lineno"> 8201</span>&#160;    <span class="comment">// Build a list of tree entries where V is used.</span></div>
<div class="line"><a name="l08202"></a><span class="lineno"> 8202</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const TreeEntry *, 4&gt;</a> VToTEs;</div>
<div class="line"><a name="l08203"></a><span class="lineno"> 8203</span>&#160;    <span class="keyword">auto</span> It = ValueToTEs.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(V);</div>
<div class="line"><a name="l08204"></a><span class="lineno"> 8204</span>&#160;    <span class="keywordflow">if</span> (It != ValueToTEs.<a class="code" href="classllvm_1_1DenseMapBase.html#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</div>
<div class="line"><a name="l08205"></a><span class="lineno"> 8205</span>&#160;      VToTEs = It-&gt;second;</div>
<div class="line"><a name="l08206"></a><span class="lineno"> 8206</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> TreeEntry *VTE = getTreeEntry(V))</div>
<div class="line"><a name="l08207"></a><span class="lineno"> 8207</span>&#160;      VToTEs.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(VTE);</div>
<div class="line"><a name="l08208"></a><span class="lineno"> 8208</span>&#160;    <span class="keywordflow">if</span> (VToTEs.<a class="code" href="classllvm_1_1SmallPtrSetImplBase.html#af8a50544090e81ac83601aff8f4b0142">empty</a>())</div>
<div class="line"><a name="l08209"></a><span class="lineno"> 8209</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08210"></a><span class="lineno"> 8210</span>&#160;    <span class="keywordflow">if</span> (UsedTEs.empty()) {</div>
<div class="line"><a name="l08211"></a><span class="lineno"> 8211</span>&#160;      <span class="comment">// The first iteration, just insert the list of nodes to vector.</span></div>
<div class="line"><a name="l08212"></a><span class="lineno"> 8212</span>&#160;      UsedTEs.push_back(VToTEs);</div>
<div class="line"><a name="l08213"></a><span class="lineno"> 8213</span>&#160;      UsedValuesEntry.<a class="code" href="classllvm_1_1DenseMapBase.html#a98c685a0c53f3f7ed5f4793890a6c850">try_emplace</a>(V, 0);</div>
<div class="line"><a name="l08214"></a><span class="lineno"> 8214</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l08215"></a><span class="lineno"> 8215</span>&#160;      <span class="comment">// Need to check if there are any previously used tree nodes which use V.</span></div>
<div class="line"><a name="l08216"></a><span class="lineno"> 8216</span>&#160;      <span class="comment">// If there are no such nodes, consider that we have another one input</span></div>
<div class="line"><a name="l08217"></a><span class="lineno"> 8217</span>&#160;      <span class="comment">// vector.</span></div>
<div class="line"><a name="l08218"></a><span class="lineno"> 8218</span>&#160;      <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const TreeEntry *, 4&gt;</a> SavedVToTEs(VToTEs);</div>
<div class="line"><a name="l08219"></a><span class="lineno"> 8219</span>&#160;      <span class="keywordtype">unsigned</span> Idx = 0;</div>
<div class="line"><a name="l08220"></a><span class="lineno"> 8220</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const TreeEntry *, 4&gt;</a> &amp;Set : UsedTEs) {</div>
<div class="line"><a name="l08221"></a><span class="lineno"> 8221</span>&#160;        <span class="comment">// Do we have a non-empty intersection of previously listed tree entries</span></div>
<div class="line"><a name="l08222"></a><span class="lineno"> 8222</span>&#160;        <span class="comment">// and tree entries using current V?</span></div>
<div class="line"><a name="l08223"></a><span class="lineno"> 8223</span>&#160;        <a class="code" href="namespacellvm.html#a2162d123f222998300d308bdefdb38b9">set_intersect</a>(VToTEs, Set);</div>
<div class="line"><a name="l08224"></a><span class="lineno"> 8224</span>&#160;        <span class="keywordflow">if</span> (!VToTEs.<a class="code" href="classllvm_1_1SmallPtrSetImplBase.html#af8a50544090e81ac83601aff8f4b0142">empty</a>()) {</div>
<div class="line"><a name="l08225"></a><span class="lineno"> 8225</span>&#160;          <span class="comment">// Yes, write the new subset and continue analysis for the next</span></div>
<div class="line"><a name="l08226"></a><span class="lineno"> 8226</span>&#160;          <span class="comment">// scalar.</span></div>
<div class="line"><a name="l08227"></a><span class="lineno"> 8227</span>&#160;          Set.swap(VToTEs);</div>
<div class="line"><a name="l08228"></a><span class="lineno"> 8228</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l08229"></a><span class="lineno"> 8229</span>&#160;        }</div>
<div class="line"><a name="l08230"></a><span class="lineno"> 8230</span>&#160;        VToTEs = SavedVToTEs;</div>
<div class="line"><a name="l08231"></a><span class="lineno"> 8231</span>&#160;        ++Idx;</div>
<div class="line"><a name="l08232"></a><span class="lineno"> 8232</span>&#160;      }</div>
<div class="line"><a name="l08233"></a><span class="lineno"> 8233</span>&#160;      <span class="comment">// No non-empty intersection found - need to add a second set of possible</span></div>
<div class="line"><a name="l08234"></a><span class="lineno"> 8234</span>&#160;      <span class="comment">// source vectors.</span></div>
<div class="line"><a name="l08235"></a><span class="lineno"> 8235</span>&#160;      <span class="keywordflow">if</span> (Idx == UsedTEs.<a class="code" href="classllvm_1_1SmallPtrSetImplBase.html#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>()) {</div>
<div class="line"><a name="l08236"></a><span class="lineno"> 8236</span>&#160;        <span class="comment">// If the number of input vectors is greater than 2 - not a permutation,</span></div>
<div class="line"><a name="l08237"></a><span class="lineno"> 8237</span>&#160;        <span class="comment">// fallback to the regular gather.</span></div>
<div class="line"><a name="l08238"></a><span class="lineno"> 8238</span>&#160;        <span class="comment">// TODO: support multiple reshuffled nodes.</span></div>
<div class="line"><a name="l08239"></a><span class="lineno"> 8239</span>&#160;        <span class="keywordflow">if</span> (UsedTEs.<a class="code" href="classllvm_1_1SmallPtrSetImplBase.html#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>() == 2)</div>
<div class="line"><a name="l08240"></a><span class="lineno"> 8240</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08241"></a><span class="lineno"> 8241</span>&#160;        UsedTEs.push_back(SavedVToTEs);</div>
<div class="line"><a name="l08242"></a><span class="lineno"> 8242</span>&#160;        Idx = UsedTEs.<a class="code" href="classllvm_1_1SmallPtrSetImplBase.html#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>() - 1;</div>
<div class="line"><a name="l08243"></a><span class="lineno"> 8243</span>&#160;      }</div>
<div class="line"><a name="l08244"></a><span class="lineno"> 8244</span>&#160;      UsedValuesEntry.<a class="code" href="classllvm_1_1DenseMapBase.html#a98c685a0c53f3f7ed5f4793890a6c850">try_emplace</a>(V, Idx);</div>
<div class="line"><a name="l08245"></a><span class="lineno"> 8245</span>&#160;    }</div>
<div class="line"><a name="l08246"></a><span class="lineno"> 8246</span>&#160;  }</div>
<div class="line"><a name="l08247"></a><span class="lineno"> 8247</span>&#160; </div>
<div class="line"><a name="l08248"></a><span class="lineno"> 8248</span>&#160;  <span class="keywordflow">if</span> (UsedTEs.<a class="code" href="classllvm_1_1SmallPtrSetImplBase.html#af8a50544090e81ac83601aff8f4b0142">empty</a>())</div>
<div class="line"><a name="l08249"></a><span class="lineno"> 8249</span>&#160;    <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l08250"></a><span class="lineno"> 8250</span>&#160; </div>
<div class="line"><a name="l08251"></a><span class="lineno"> 8251</span>&#160;  <span class="keywordtype">unsigned</span> VF = 0;</div>
<div class="line"><a name="l08252"></a><span class="lineno"> 8252</span>&#160;  <span class="keywordflow">if</span> (UsedTEs.<a class="code" href="classllvm_1_1SmallPtrSetImplBase.html#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>() == 1) {</div>
<div class="line"><a name="l08253"></a><span class="lineno"> 8253</span>&#160;    <span class="comment">// Keep the order to avoid non-determinism.</span></div>
<div class="line"><a name="l08254"></a><span class="lineno"> 8254</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const TreeEntry *&gt;</a> FirstEntries(UsedTEs.front().<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#abf73a826b5d6f739eb4af48ddf14c5b4">begin</a>(),</div>
<div class="line"><a name="l08255"></a><span class="lineno"> 8255</span>&#160;                                                UsedTEs.front().<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a7004354fbee1c8cd74ed9001915e1db5">end</a>());</div>
<div class="line"><a name="l08256"></a><span class="lineno"> 8256</span>&#160;    <a class="code" href="namespacellvm.html#a74cdbd1e4f731e7d7cd83461b8b1de0b">sort</a>(FirstEntries, [](<span class="keyword">const</span> TreeEntry *TE1, <span class="keyword">const</span> TreeEntry *TE2) {</div>
<div class="line"><a name="l08257"></a><span class="lineno"> 8257</span>&#160;      <span class="keywordflow">return</span> TE1-&gt;Idx &lt; TE2-&gt;Idx;</div>
<div class="line"><a name="l08258"></a><span class="lineno"> 8258</span>&#160;    });</div>
<div class="line"><a name="l08259"></a><span class="lineno"> 8259</span>&#160;    <span class="comment">// Try to find the perfect match in another gather node at first.</span></div>
<div class="line"><a name="l08260"></a><span class="lineno"> 8260</span>&#160;    <span class="keyword">auto</span> *It = <a class="code" href="namespacellvm.html#ac78c09ae232b2ce188ff590d51e3c268">find_if</a>(FirstEntries, [=](<span class="keyword">const</span> TreeEntry *EntryPtr) {</div>
<div class="line"><a name="l08261"></a><span class="lineno"> 8261</span>&#160;      <span class="keywordflow">return</span> EntryPtr-&gt;isSame(VL) || EntryPtr-&gt;isSame(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;Scalars);</div>
<div class="line"><a name="l08262"></a><span class="lineno"> 8262</span>&#160;    });</div>
<div class="line"><a name="l08263"></a><span class="lineno"> 8263</span>&#160;    <span class="keywordflow">if</span> (It != FirstEntries.end()) {</div>
<div class="line"><a name="l08264"></a><span class="lineno"> 8264</span>&#160;      Entries.push_back(*It);</div>
<div class="line"><a name="l08265"></a><span class="lineno"> 8265</span>&#160;      std::iota(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.begin(), <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.end(), 0);</div>
<div class="line"><a name="l08266"></a><span class="lineno"> 8266</span>&#160;      <span class="comment">// Clear undef scalars.</span></div>
<div class="line"><a name="l08267"></a><span class="lineno"> 8267</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, Sz = VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; Sz; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l08268"></a><span class="lineno"> 8268</span>&#160;        <span class="keywordflow">if</span> (isa&lt;PoisonValue&gt;(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;Scalars[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]))</div>
<div class="line"><a name="l08269"></a><span class="lineno"> 8269</span>&#160;          <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>;</div>
<div class="line"><a name="l08270"></a><span class="lineno"> 8270</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53eca7beec9815d0197f2d31fac9968e9205b">TargetTransformInfo::SK_PermuteSingleSrc</a>;</div>
<div class="line"><a name="l08271"></a><span class="lineno"> 8271</span>&#160;    }</div>
<div class="line"><a name="l08272"></a><span class="lineno"> 8272</span>&#160;    <span class="comment">// No perfect match, just shuffle, so choose the first tree node from the</span></div>
<div class="line"><a name="l08273"></a><span class="lineno"> 8273</span>&#160;    <span class="comment">// tree.</span></div>
<div class="line"><a name="l08274"></a><span class="lineno"> 8274</span>&#160;    Entries.push_back(FirstEntries.front());</div>
<div class="line"><a name="l08275"></a><span class="lineno"> 8275</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l08276"></a><span class="lineno"> 8276</span>&#160;    <span class="comment">// Try to find nodes with the same vector factor.</span></div>
<div class="line"><a name="l08277"></a><span class="lineno"> 8277</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(UsedTEs.<a class="code" href="classllvm_1_1SmallPtrSetImplBase.html#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>() == 2 &amp;&amp; <span class="stringliteral">&quot;Expected at max 2 permuted entries.&quot;</span>);</div>
<div class="line"><a name="l08278"></a><span class="lineno"> 8278</span>&#160;    <span class="comment">// Keep the order of tree nodes to avoid non-determinism.</span></div>
<div class="line"><a name="l08279"></a><span class="lineno"> 8279</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;int, const TreeEntry *&gt;</a> VFToTE;</div>
<div class="line"><a name="l08280"></a><span class="lineno"> 8280</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> TreeEntry *TE : UsedTEs.front()) {</div>
<div class="line"><a name="l08281"></a><span class="lineno"> 8281</span>&#160;      <span class="keywordtype">unsigned</span> VF = <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;getVectorFactor();</div>
<div class="line"><a name="l08282"></a><span class="lineno"> 8282</span>&#160;      <span class="keyword">auto</span> It = VFToTE.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(VF);</div>
<div class="line"><a name="l08283"></a><span class="lineno"> 8283</span>&#160;      <span class="keywordflow">if</span> (It != VFToTE.<a class="code" href="classllvm_1_1DenseMapBase.html#a65520b9c67759099e313d0f4e7b5ff9e">end</a>()) {</div>
<div class="line"><a name="l08284"></a><span class="lineno"> 8284</span>&#160;        <span class="keywordflow">if</span> (It-&gt;second-&gt;Idx &gt; <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;Idx)</div>
<div class="line"><a name="l08285"></a><span class="lineno"> 8285</span>&#160;          It-&gt;getSecond() = <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>;</div>
<div class="line"><a name="l08286"></a><span class="lineno"> 8286</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08287"></a><span class="lineno"> 8287</span>&#160;      }</div>
<div class="line"><a name="l08288"></a><span class="lineno"> 8288</span>&#160;      VFToTE.<a class="code" href="classllvm_1_1DenseMapBase.html#a98c685a0c53f3f7ed5f4793890a6c850">try_emplace</a>(VF, TE);</div>
<div class="line"><a name="l08289"></a><span class="lineno"> 8289</span>&#160;    }</div>
<div class="line"><a name="l08290"></a><span class="lineno"> 8290</span>&#160;    <span class="comment">// Same, keep the order to avoid non-determinism.</span></div>
<div class="line"><a name="l08291"></a><span class="lineno"> 8291</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const TreeEntry *&gt;</a> SecondEntries(UsedTEs.back().<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#abf73a826b5d6f739eb4af48ddf14c5b4">begin</a>(),</div>
<div class="line"><a name="l08292"></a><span class="lineno"> 8292</span>&#160;                                                 UsedTEs.back().<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a7004354fbee1c8cd74ed9001915e1db5">end</a>());</div>
<div class="line"><a name="l08293"></a><span class="lineno"> 8293</span>&#160;    <a class="code" href="namespacellvm.html#a74cdbd1e4f731e7d7cd83461b8b1de0b">sort</a>(SecondEntries, [](<span class="keyword">const</span> TreeEntry *TE1, <span class="keyword">const</span> TreeEntry *TE2) {</div>
<div class="line"><a name="l08294"></a><span class="lineno"> 8294</span>&#160;      <span class="keywordflow">return</span> TE1-&gt;Idx &lt; TE2-&gt;Idx;</div>
<div class="line"><a name="l08295"></a><span class="lineno"> 8295</span>&#160;    });</div>
<div class="line"><a name="l08296"></a><span class="lineno"> 8296</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> TreeEntry *TE : SecondEntries) {</div>
<div class="line"><a name="l08297"></a><span class="lineno"> 8297</span>&#160;      <span class="keyword">auto</span> It = VFToTE.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;getVectorFactor());</div>
<div class="line"><a name="l08298"></a><span class="lineno"> 8298</span>&#160;      <span class="keywordflow">if</span> (It != VFToTE.<a class="code" href="classllvm_1_1DenseMapBase.html#a65520b9c67759099e313d0f4e7b5ff9e">end</a>()) {</div>
<div class="line"><a name="l08299"></a><span class="lineno"> 8299</span>&#160;        VF = It-&gt;first;</div>
<div class="line"><a name="l08300"></a><span class="lineno"> 8300</span>&#160;        Entries.push_back(It-&gt;second);</div>
<div class="line"><a name="l08301"></a><span class="lineno"> 8301</span>&#160;        Entries.push_back(TE);</div>
<div class="line"><a name="l08302"></a><span class="lineno"> 8302</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l08303"></a><span class="lineno"> 8303</span>&#160;      }</div>
<div class="line"><a name="l08304"></a><span class="lineno"> 8304</span>&#160;    }</div>
<div class="line"><a name="l08305"></a><span class="lineno"> 8305</span>&#160;    <span class="comment">// No 2 source vectors with the same vector factor - give up and do regular</span></div>
<div class="line"><a name="l08306"></a><span class="lineno"> 8306</span>&#160;    <span class="comment">// gather.</span></div>
<div class="line"><a name="l08307"></a><span class="lineno"> 8307</span>&#160;    <span class="keywordflow">if</span> (Entries.empty())</div>
<div class="line"><a name="l08308"></a><span class="lineno"> 8308</span>&#160;      <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l08309"></a><span class="lineno"> 8309</span>&#160;  }</div>
<div class="line"><a name="l08310"></a><span class="lineno"> 8310</span>&#160; </div>
<div class="line"><a name="l08311"></a><span class="lineno"> 8311</span>&#160;  <span class="keywordtype">bool</span> IsSplatOrUndefs = <a class="code" href="SLPVectorizer_8cpp.html#a6ef5b86735d738868e5fb00a18643b1c">isSplat</a>(VL) || <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(VL, <a class="code" href="classllvm_1_1UndefValue.html#a72f33f26b467287ba52d3adf82b7afb5">UndefValue::classof</a>);</div>
<div class="line"><a name="l08312"></a><span class="lineno"> 8312</span>&#160;  <span class="comment">// Checks if the 2 PHIs are compatible in terms of high possibility to be</span></div>
<div class="line"><a name="l08313"></a><span class="lineno"> 8313</span>&#160;  <span class="comment">// vectorized.</span></div>
<div class="line"><a name="l08314"></a><span class="lineno"> 8314</span>&#160;  <span class="keyword">auto</span> AreCompatiblePHIs = [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1Value.html">Value</a> *V1) {</div>
<div class="line"><a name="l08315"></a><span class="lineno"> 8315</span>&#160;    <span class="keyword">auto</span> *<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = cast&lt;PHINode&gt;(V);</div>
<div class="line"><a name="l08316"></a><span class="lineno"> 8316</span>&#160;    <span class="keyword">auto</span> *PHI1 = cast&lt;PHINode&gt;(V1);</div>
<div class="line"><a name="l08317"></a><span class="lineno"> 8317</span>&#160;    <span class="comment">// Check that all incoming values are compatible/from same parent (if they</span></div>
<div class="line"><a name="l08318"></a><span class="lineno"> 8318</span>&#160;    <span class="comment">// are instructions).</span></div>
<div class="line"><a name="l08319"></a><span class="lineno"> 8319</span>&#160;    <span class="comment">// The incoming values are compatible if they all are constants, or</span></div>
<div class="line"><a name="l08320"></a><span class="lineno"> 8320</span>&#160;    <span class="comment">// instruction with the same/alternate opcodes from the same basic block.</span></div>
<div class="line"><a name="l08321"></a><span class="lineno"> 8321</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getNumIncomingValues(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l08322"></a><span class="lineno"> 8322</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a> = <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getIncomingValue(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l08323"></a><span class="lineno"> 8323</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *In1 = PHI1-&gt;getIncomingValue(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l08324"></a><span class="lineno"> 8324</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#a6848b7e929178610d01e1b2b5052af86">isConstant</a>(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>) &amp;&amp; <a class="code" href="SLPVectorizer_8cpp.html#a6848b7e929178610d01e1b2b5052af86">isConstant</a>(In1))</div>
<div class="line"><a name="l08325"></a><span class="lineno"> 8325</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08326"></a><span class="lineno"> 8326</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="SLPVectorizer_8cpp.html#ae37b3a41d982a793664ab021d9b9b325">getSameOpcode</a>({<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>, In1}, *TLI).<a class="code" href="VPlanSLP_8cpp.html#af04704e906a9654777e92a4612c58c13">getOpcode</a>())</div>
<div class="line"><a name="l08327"></a><span class="lineno"> 8327</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l08328"></a><span class="lineno"> 8328</span>&#160;      <span class="keywordflow">if</span> (cast&lt;Instruction&gt;(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>)-&gt;<a class="code" href="BasicAliasAnalysis_8cpp.html#a2675de1d8479c7b00387979714da43f7">getParent</a>() !=</div>
<div class="line"><a name="l08329"></a><span class="lineno"> 8329</span>&#160;          cast&lt;Instruction&gt;(In1)-&gt;<a class="code" href="BasicAliasAnalysis_8cpp.html#a2675de1d8479c7b00387979714da43f7">getParent</a>())</div>
<div class="line"><a name="l08330"></a><span class="lineno"> 8330</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l08331"></a><span class="lineno"> 8331</span>&#160;    }</div>
<div class="line"><a name="l08332"></a><span class="lineno"> 8332</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l08333"></a><span class="lineno"> 8333</span>&#160;  };</div>
<div class="line"><a name="l08334"></a><span class="lineno"> 8334</span>&#160;  <span class="comment">// Check if the value can be ignored during analysis for shuffled gathers.</span></div>
<div class="line"><a name="l08335"></a><span class="lineno"> 8335</span>&#160;  <span class="comment">// We suppose it is better to ignore instruction, which do not form splats,</span></div>
<div class="line"><a name="l08336"></a><span class="lineno"> 8336</span>&#160;  <span class="comment">// are not vectorized/not extractelements (these instructions will be handled</span></div>
<div class="line"><a name="l08337"></a><span class="lineno"> 8337</span>&#160;  <span class="comment">// by extractelements processing) or may form vector node in future.</span></div>
<div class="line"><a name="l08338"></a><span class="lineno"> 8338</span>&#160;  <span class="keyword">auto</span> MightBeIgnored = [=](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l08339"></a><span class="lineno"> 8339</span>&#160;    <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l08340"></a><span class="lineno"> 8340</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *&gt;</a> IgnoredVals;</div>
<div class="line"><a name="l08341"></a><span class="lineno"> 8341</span>&#160;    <span class="keywordflow">if</span> (UserIgnoreList)</div>
<div class="line"><a name="l08342"></a><span class="lineno"> 8342</span>&#160;      IgnoredVals.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a38c50aa8e3e9588f4f968c2e03a0cee0">assign</a>(UserIgnoreList-&gt;begin(), UserIgnoreList-&gt;end());</div>
<div class="line"><a name="l08343"></a><span class="lineno"> 8343</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp; !IsSplatOrUndefs &amp;&amp; !ScalarToTreeEntry.<a class="code" href="classllvm_1_1DenseMapBase.html#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</div>
<div class="line"><a name="l08344"></a><span class="lineno"> 8344</span>&#160;           !<a class="code" href="SLPVectorizer_8cpp.html#a06a9edb69d0ed6fda201d59948acfd89">isVectorLikeInstWithConstOps</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</div>
<div class="line"><a name="l08345"></a><span class="lineno"> 8345</span>&#160;           !areAllUsersVectorized(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, IgnoredVals) &amp;&amp; <a class="code" href="SLPVectorizer_8cpp.html#a3ca9742688618517cc4690fb947fb609">isSimple</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l08346"></a><span class="lineno"> 8346</span>&#160;  };</div>
<div class="line"><a name="l08347"></a><span class="lineno"> 8347</span>&#160;  <span class="comment">// Check that the neighbor instruction may form a full vector node with the</span></div>
<div class="line"><a name="l08348"></a><span class="lineno"> 8348</span>&#160;  <span class="comment">// current instruction V. It is possible, if they have same/alternate opcode</span></div>
<div class="line"><a name="l08349"></a><span class="lineno"> 8349</span>&#160;  <span class="comment">// and same parent basic block.</span></div>
<div class="line"><a name="l08350"></a><span class="lineno"> 8350</span>&#160;  <span class="keyword">auto</span> NeighborMightBeIgnored = [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <span class="keywordtype">int</span> Idx) {</div>
<div class="line"><a name="l08351"></a><span class="lineno"> 8351</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V1 = VL[Idx];</div>
<div class="line"><a name="l08352"></a><span class="lineno"> 8352</span>&#160;    <span class="keywordtype">bool</span> UsedInSameVTE = <span class="keyword">false</span>;</div>
<div class="line"><a name="l08353"></a><span class="lineno"> 8353</span>&#160;    <span class="keyword">auto</span> It = UsedValuesEntry.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(V1);</div>
<div class="line"><a name="l08354"></a><span class="lineno"> 8354</span>&#160;    <span class="keywordflow">if</span> (It != UsedValuesEntry.<a class="code" href="classllvm_1_1DenseMapBase.html#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</div>
<div class="line"><a name="l08355"></a><span class="lineno"> 8355</span>&#160;      UsedInSameVTE = It-&gt;second == UsedValuesEntry.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(V)-&gt;second;</div>
<div class="line"><a name="l08356"></a><span class="lineno"> 8356</span>&#160;    <span class="keywordflow">return</span> V != V1 &amp;&amp; MightBeIgnored(V1) &amp;&amp; !UsedInSameVTE &amp;&amp;</div>
<div class="line"><a name="l08357"></a><span class="lineno"> 8357</span>&#160;           <a class="code" href="SLPVectorizer_8cpp.html#ae37b3a41d982a793664ab021d9b9b325">getSameOpcode</a>({V, V1}, *TLI).<a class="code" href="VPlanSLP_8cpp.html#af04704e906a9654777e92a4612c58c13">getOpcode</a>() &amp;&amp;</div>
<div class="line"><a name="l08358"></a><span class="lineno"> 8358</span>&#160;           cast&lt;Instruction&gt;(V)-&gt;getParent() ==</div>
<div class="line"><a name="l08359"></a><span class="lineno"> 8359</span>&#160;               cast&lt;Instruction&gt;(V1)-&gt;getParent() &amp;&amp;</div>
<div class="line"><a name="l08360"></a><span class="lineno"> 8360</span>&#160;           (!isa&lt;PHINode&gt;(V1) || AreCompatiblePHIs(V, V1));</div>
<div class="line"><a name="l08361"></a><span class="lineno"> 8361</span>&#160;  };</div>
<div class="line"><a name="l08362"></a><span class="lineno"> 8362</span>&#160;  <span class="comment">// Build a shuffle mask for better cost estimation and vector emission.</span></div>
<div class="line"><a name="l08363"></a><span class="lineno"> 8363</span>&#160;  <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> UsedIdxs(Entries.size());</div>
<div class="line"><a name="l08364"></a><span class="lineno"> 8364</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;unsigned, int&gt;</a>&gt; EntryLanes;</div>
<div class="line"><a name="l08365"></a><span class="lineno"> 8365</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l08366"></a><span class="lineno"> 8366</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V = VL[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l08367"></a><span class="lineno"> 8367</span>&#160;    <span class="keyword">auto</span> It = UsedValuesEntry.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(V);</div>
<div class="line"><a name="l08368"></a><span class="lineno"> 8368</span>&#160;    <span class="keywordflow">if</span> (It == UsedValuesEntry.<a class="code" href="classllvm_1_1DenseMapBase.html#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</div>
<div class="line"><a name="l08369"></a><span class="lineno"> 8369</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08370"></a><span class="lineno"> 8370</span>&#160;    <span class="comment">// Do not try to shuffle scalars, if they are constants, or instructions</span></div>
<div class="line"><a name="l08371"></a><span class="lineno"> 8371</span>&#160;    <span class="comment">// that can be vectorized as a result of the following vector build</span></div>
<div class="line"><a name="l08372"></a><span class="lineno"> 8372</span>&#160;    <span class="comment">// vectorization.</span></div>
<div class="line"><a name="l08373"></a><span class="lineno"> 8373</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#a6848b7e929178610d01e1b2b5052af86">isConstant</a>(V) || (MightBeIgnored(V) &amp;&amp;</div>
<div class="line"><a name="l08374"></a><span class="lineno"> 8374</span>&#160;                          ((<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &gt; 0 &amp;&amp; NeighborMightBeIgnored(V, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> - 1)) ||</div>
<div class="line"><a name="l08375"></a><span class="lineno"> 8375</span>&#160;                           (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> - 1 &amp;&amp; NeighborMightBeIgnored(V, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> + 1)))))</div>
<div class="line"><a name="l08376"></a><span class="lineno"> 8376</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08377"></a><span class="lineno"> 8377</span>&#160;    <span class="keywordtype">unsigned</span> Idx = It-&gt;second;</div>
<div class="line"><a name="l08378"></a><span class="lineno"> 8378</span>&#160;    EntryLanes.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>(Idx, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l08379"></a><span class="lineno"> 8379</span>&#160;    UsedIdxs.set(Idx);</div>
<div class="line"><a name="l08380"></a><span class="lineno"> 8380</span>&#160;  }</div>
<div class="line"><a name="l08381"></a><span class="lineno"> 8381</span>&#160;  <span class="comment">// Iterate through all shuffled scalars and select entries, which can be used</span></div>
<div class="line"><a name="l08382"></a><span class="lineno"> 8382</span>&#160;  <span class="comment">// for final shuffle.</span></div>
<div class="line"><a name="l08383"></a><span class="lineno"> 8383</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const TreeEntry *&gt;</a> TempEntries;</div>
<div class="line"><a name="l08384"></a><span class="lineno"> 8384</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, Sz = Entries.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; Sz; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l08385"></a><span class="lineno"> 8385</span>&#160;    <span class="keywordflow">if</span> (!UsedIdxs.test(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l08386"></a><span class="lineno"> 8386</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08387"></a><span class="lineno"> 8387</span>&#160;    <span class="comment">// Fix the entry number for the given scalar. If it is the first entry, set</span></div>
<div class="line"><a name="l08388"></a><span class="lineno"> 8388</span>&#160;    <span class="comment">// Pair.first to 0, otherwise to 1 (currently select at max 2 nodes).</span></div>
<div class="line"><a name="l08389"></a><span class="lineno"> 8389</span>&#160;    <span class="comment">// These indices are used when calculating final shuffle mask as the vector</span></div>
<div class="line"><a name="l08390"></a><span class="lineno"> 8390</span>&#160;    <span class="comment">// offset.</span></div>
<div class="line"><a name="l08391"></a><span class="lineno"> 8391</span>&#160;    <span class="keywordflow">for</span> (std::pair&lt;unsigned, int&gt; &amp;Pair : EntryLanes)</div>
<div class="line"><a name="l08392"></a><span class="lineno"> 8392</span>&#160;      <span class="keywordflow">if</span> (Pair.first == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l08393"></a><span class="lineno"> 8393</span>&#160;        Pair.first = TempEntries.size();</div>
<div class="line"><a name="l08394"></a><span class="lineno"> 8394</span>&#160;    TempEntries.push_back(Entries[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]);</div>
<div class="line"><a name="l08395"></a><span class="lineno"> 8395</span>&#160;  }</div>
<div class="line"><a name="l08396"></a><span class="lineno"> 8396</span>&#160;  Entries.swap(TempEntries);</div>
<div class="line"><a name="l08397"></a><span class="lineno"> 8397</span>&#160;  <span class="keywordflow">if</span> (EntryLanes.size() == Entries.size() &amp;&amp; !VL.<a class="code" href="classllvm_1_1ArrayRef.html#a21ff1fd12b25b79fcd4449c35dc814b6">equals</a>(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;Scalars)) {</div>
<div class="line"><a name="l08398"></a><span class="lineno"> 8398</span>&#160;    <span class="comment">// We may have here 1 or 2 entries only. If the number of scalars is equal</span></div>
<div class="line"><a name="l08399"></a><span class="lineno"> 8399</span>&#160;    <span class="comment">// to the number of entries, no need to do the analysis, it is not very</span></div>
<div class="line"><a name="l08400"></a><span class="lineno"> 8400</span>&#160;    <span class="comment">// profitable. Since VL is not the same as TE-&gt;Scalars, it means we already</span></div>
<div class="line"><a name="l08401"></a><span class="lineno"> 8401</span>&#160;    <span class="comment">// have some shuffles before. Cut off not profitable case.</span></div>
<div class="line"><a name="l08402"></a><span class="lineno"> 8402</span>&#160;    Entries.clear();</div>
<div class="line"><a name="l08403"></a><span class="lineno"> 8403</span>&#160;    <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l08404"></a><span class="lineno"> 8404</span>&#160;  }</div>
<div class="line"><a name="l08405"></a><span class="lineno"> 8405</span>&#160;  <span class="comment">// Build the final mask, check for the identity shuffle, if possible.</span></div>
<div class="line"><a name="l08406"></a><span class="lineno"> 8406</span>&#160;  <span class="keywordtype">bool</span> IsIdentity = Entries.size() == 1;</div>
<div class="line"><a name="l08407"></a><span class="lineno"> 8407</span>&#160;  <span class="comment">// Pair.first is the offset to the vector, while Pair.second is the index of</span></div>
<div class="line"><a name="l08408"></a><span class="lineno"> 8408</span>&#160;  <span class="comment">// scalar in the list.</span></div>
<div class="line"><a name="l08409"></a><span class="lineno"> 8409</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> std::pair&lt;unsigned, int&gt; &amp;Pair : EntryLanes) {</div>
<div class="line"><a name="l08410"></a><span class="lineno"> 8410</span>&#160;    <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[Pair.second] = Pair.first * VF +</div>
<div class="line"><a name="l08411"></a><span class="lineno"> 8411</span>&#160;                        Entries[Pair.first]-&gt;findLaneForValue(VL[Pair.second]);</div>
<div class="line"><a name="l08412"></a><span class="lineno"> 8412</span>&#160;    IsIdentity &amp;= <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[Pair.second] == Pair.second;</div>
<div class="line"><a name="l08413"></a><span class="lineno"> 8413</span>&#160;  }</div>
<div class="line"><a name="l08414"></a><span class="lineno"> 8414</span>&#160;  <span class="keywordflow">switch</span> (Entries.size()) {</div>
<div class="line"><a name="l08415"></a><span class="lineno"> 8415</span>&#160;  <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l08416"></a><span class="lineno"> 8416</span>&#160;    <span class="keywordflow">if</span> (IsIdentity || EntryLanes.size() &gt; 1 || VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() &lt;= 2)</div>
<div class="line"><a name="l08417"></a><span class="lineno"> 8417</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53eca7beec9815d0197f2d31fac9968e9205b">TargetTransformInfo::SK_PermuteSingleSrc</a>;</div>
<div class="line"><a name="l08418"></a><span class="lineno"> 8418</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l08419"></a><span class="lineno"> 8419</span>&#160;  <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l08420"></a><span class="lineno"> 8420</span>&#160;    <span class="keywordflow">if</span> (EntryLanes.size() &gt; 2 || VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() &lt;= 2)</div>
<div class="line"><a name="l08421"></a><span class="lineno"> 8421</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53ecab4616961a3bfdaec42aedc4fc426ccfe">TargetTransformInfo::SK_PermuteTwoSrc</a>;</div>
<div class="line"><a name="l08422"></a><span class="lineno"> 8422</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l08423"></a><span class="lineno"> 8423</span>&#160;  <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l08424"></a><span class="lineno"> 8424</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l08425"></a><span class="lineno"> 8425</span>&#160;  }</div>
<div class="line"><a name="l08426"></a><span class="lineno"> 8426</span>&#160;  Entries.clear();</div>
<div class="line"><a name="l08427"></a><span class="lineno"> 8427</span>&#160;  <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l08428"></a><span class="lineno"> 8428</span>&#160;}</div>
<div class="line"><a name="l08429"></a><span class="lineno"> 8429</span>&#160; </div>
<div class="line"><a name="l08430"></a><span class="lineno"> 8430</span>&#160;<a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> BoUpSLP::getGatherCost(<a class="code" href="classllvm_1_1FixedVectorType.html">FixedVectorType</a> *Ty,</div>
<div class="line"><a name="l08431"></a><span class="lineno"> 8431</span>&#160;                                       <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;ShuffledIndices,</div>
<div class="line"><a name="l08432"></a><span class="lineno"> 8432</span>&#160;                                       <span class="keywordtype">bool</span> NeedToShuffle)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l08433"></a><span class="lineno"> 8433</span>&#160;  <a class="code" href="classllvm_1_1TargetTransformInfo.html#a706f223f760b55668fbae74202b816bb">TTI::TargetCostKind</a> <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a> = <a class="code" href="classllvm_1_1TargetTransformInfo.html#a706f223f760b55668fbae74202b816bba59b32ea7b6f10564abd40ad90602ca5b">TTI::TCK_RecipThroughput</a>;</div>
<div class="line"><a name="l08434"></a><span class="lineno"> 8434</span>&#160;  <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> =</div>
<div class="line"><a name="l08435"></a><span class="lineno"> 8435</span>&#160;      <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#ae7fe2d1bb4f708d68fe7a908ba675d1b">getScalarizationOverhead</a>(Ty, ~ShuffledIndices, <span class="comment">/*Insert*/</span> <span class="keyword">true</span>,</div>
<div class="line"><a name="l08436"></a><span class="lineno"> 8436</span>&#160;                                    <span class="comment">/*Extract*/</span> <span class="keyword">false</span>, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>);</div>
<div class="line"><a name="l08437"></a><span class="lineno"> 8437</span>&#160;  <span class="keywordflow">if</span> (NeedToShuffle)</div>
<div class="line"><a name="l08438"></a><span class="lineno"> 8438</span>&#160;    <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> += <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#aa0519f26bcb15c25ac0ff557061fa7af">getShuffleCost</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53eca7beec9815d0197f2d31fac9968e9205b">TargetTransformInfo::SK_PermuteSingleSrc</a>, Ty);</div>
<div class="line"><a name="l08439"></a><span class="lineno"> 8439</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a>;</div>
<div class="line"><a name="l08440"></a><span class="lineno"> 8440</span>&#160;}</div>
<div class="line"><a name="l08441"></a><span class="lineno"> 8441</span>&#160; </div>
<div class="line"><a name="l08442"></a><span class="lineno"> 8442</span>&#160;<a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> BoUpSLP::getGatherCost(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l08443"></a><span class="lineno"> 8443</span>&#160;  <span class="comment">// Find the type of the operands in VL.</span></div>
<div class="line"><a name="l08444"></a><span class="lineno"> 8444</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *ScalarTy = VL[0]-&gt;getType();</div>
<div class="line"><a name="l08445"></a><span class="lineno"> 8445</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;StoreInst&gt;(VL[0]))</div>
<div class="line"><a name="l08446"></a><span class="lineno"> 8446</span>&#160;    ScalarTy = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getValueOperand()-&gt;getType();</div>
<div class="line"><a name="l08447"></a><span class="lineno"> 8447</span>&#160;  <span class="keyword">auto</span> *VecTy = <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(ScalarTy, VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</div>
<div class="line"><a name="l08448"></a><span class="lineno"> 8448</span>&#160;  <span class="keywordtype">bool</span> DuplicateNonConst = <span class="keyword">false</span>;</div>
<div class="line"><a name="l08449"></a><span class="lineno"> 8449</span>&#160;  <span class="comment">// Find the cost of inserting/extracting values from the vector.</span></div>
<div class="line"><a name="l08450"></a><span class="lineno"> 8450</span>&#160;  <span class="comment">// Check if the same elements are inserted several times and count them as</span></div>
<div class="line"><a name="l08451"></a><span class="lineno"> 8451</span>&#160;  <span class="comment">// shuffle candidates.</span></div>
<div class="line"><a name="l08452"></a><span class="lineno"> 8452</span>&#160;  <a class="code" href="classllvm_1_1APInt.html">APInt</a> ShuffledElements = <a class="code" href="classllvm_1_1APInt.html#add4e37b60ea64faafbc9a5bf3e27280f">APInt::getZero</a>(VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</div>
<div class="line"><a name="l08453"></a><span class="lineno"> 8453</span>&#160;  <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;Value *&gt;</a> UniqueElements;</div>
<div class="line"><a name="l08454"></a><span class="lineno"> 8454</span>&#160;  <span class="comment">// Iterate in reverse order to consider insert elements with the high cost.</span></div>
<div class="line"><a name="l08455"></a><span class="lineno"> 8455</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &gt; 0; --<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l08456"></a><span class="lineno"> 8456</span>&#160;    <span class="keywordtype">unsigned</span> Idx = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> - 1;</div>
<div class="line"><a name="l08457"></a><span class="lineno"> 8457</span>&#160;    <span class="comment">// No need to shuffle duplicates for constants.</span></div>
<div class="line"><a name="l08458"></a><span class="lineno"> 8458</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#a6848b7e929178610d01e1b2b5052af86">isConstant</a>(VL[Idx])) {</div>
<div class="line"><a name="l08459"></a><span class="lineno"> 8459</span>&#160;      ShuffledElements.<a class="code" href="classllvm_1_1APInt.html#a33f9f862dca8ee0f23bff5941bf433d8">setBit</a>(Idx);</div>
<div class="line"><a name="l08460"></a><span class="lineno"> 8460</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08461"></a><span class="lineno"> 8461</span>&#160;    }</div>
<div class="line"><a name="l08462"></a><span class="lineno"> 8462</span>&#160;    <span class="keywordflow">if</span> (!UniqueElements.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a79eed48913651aeedda2eed25201ea84">insert</a>(VL[Idx]).second) {</div>
<div class="line"><a name="l08463"></a><span class="lineno"> 8463</span>&#160;      DuplicateNonConst = <span class="keyword">true</span>;</div>
<div class="line"><a name="l08464"></a><span class="lineno"> 8464</span>&#160;      ShuffledElements.<a class="code" href="classllvm_1_1APInt.html#a33f9f862dca8ee0f23bff5941bf433d8">setBit</a>(Idx);</div>
<div class="line"><a name="l08465"></a><span class="lineno"> 8465</span>&#160;    }</div>
<div class="line"><a name="l08466"></a><span class="lineno"> 8466</span>&#160;  }</div>
<div class="line"><a name="l08467"></a><span class="lineno"> 8467</span>&#160;  <span class="keywordflow">return</span> getGatherCost(VecTy, ShuffledElements, DuplicateNonConst);</div>
<div class="line"><a name="l08468"></a><span class="lineno"> 8468</span>&#160;}</div>
<div class="line"><a name="l08469"></a><span class="lineno"> 8469</span>&#160; </div>
<div class="line"><a name="l08470"></a><span class="lineno"> 8470</span>&#160;<span class="comment">// Perform operand reordering on the instructions in VL and return the reordered</span></div>
<div class="line"><a name="l08471"></a><span class="lineno"> 8471</span>&#160;<span class="comment">// operands in Left and Right.</span></div>
<div class="line"><a name="l08472"></a><span class="lineno"> 8472</span>&#160;<span class="keywordtype">void</span> BoUpSLP::reorderInputsAccordingToOpcode(</div>
<div class="line"><a name="l08473"></a><span class="lineno"> 8473</span>&#160;    <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL, <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Value *&gt;</a> &amp;Left,</div>
<div class="line"><a name="l08474"></a><span class="lineno"> 8474</span>&#160;    <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Value *&gt;</a> &amp;Right, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> &amp;TLI,</div>
<div class="line"><a name="l08475"></a><span class="lineno"> 8475</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE, <span class="keyword">const</span> <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> &amp;R) {</div>
<div class="line"><a name="l08476"></a><span class="lineno"> 8476</span>&#160;  <span class="keywordflow">if</span> (VL.<a class="code" href="classllvm_1_1ArrayRef.html#ac835b8735b1b2faec0efdca236e37d94">empty</a>())</div>
<div class="line"><a name="l08477"></a><span class="lineno"> 8477</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l08478"></a><span class="lineno"> 8478</span>&#160;  VLOperands Ops(VL, TLI, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, SE, R);</div>
<div class="line"><a name="l08479"></a><span class="lineno"> 8479</span>&#160;  <span class="comment">// Reorder the operands in place.</span></div>
<div class="line"><a name="l08480"></a><span class="lineno"> 8480</span>&#160;  Ops.reorder();</div>
<div class="line"><a name="l08481"></a><span class="lineno"> 8481</span>&#160;  <a class="code" href="namespacellvm.html#a2554a96c67bdd7d0a62855a844ec55b0a945d5e233cf7d6240f6b783b36a374ff">Left</a> = Ops.getVL(0);</div>
<div class="line"><a name="l08482"></a><span class="lineno"> 8482</span>&#160;  <a class="code" href="README__P9_8txt.html#acc80d72f12f6f9e1d8eda2ec3d74133c">Right</a> = Ops.getVL(1);</div>
<div class="line"><a name="l08483"></a><span class="lineno"> 8483</span>&#160;}</div>
<div class="line"><a name="l08484"></a><span class="lineno"> 8484</span>&#160; </div>
<div class="line"><a name="l08485"></a><span class="lineno"> 8485</span>&#160;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;BoUpSLP::getLastInstructionInBundle(<span class="keyword">const</span> TreeEntry *<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>) {</div>
<div class="line"><a name="l08486"></a><span class="lineno"> 8486</span>&#160;  <span class="comment">// Get the basic block this bundle is in. All instructions in the bundle</span></div>
<div class="line"><a name="l08487"></a><span class="lineno"> 8487</span>&#160;  <span class="comment">// should be in this block (except for extractelement-like instructions with</span></div>
<div class="line"><a name="l08488"></a><span class="lineno"> 8488</span>&#160;  <span class="comment">// constant indeces).</span></div>
<div class="line"><a name="l08489"></a><span class="lineno"> 8489</span>&#160;  <span class="keyword">auto</span> *Front = <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getMainOp();</div>
<div class="line"><a name="l08490"></a><span class="lineno"> 8490</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = Front-&gt;getParent();</div>
<div class="line"><a name="l08491"></a><span class="lineno"> 8491</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all_of</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars, [=](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) -&gt; <span class="keywordtype">bool</span> {</div>
<div class="line"><a name="l08492"></a><span class="lineno"> 8492</span>&#160;    if (E-&gt;getOpcode() == Instruction::GetElementPtr &amp;&amp;</div>
<div class="line"><a name="l08493"></a><span class="lineno"> 8493</span>&#160;        !isa&lt;GetElementPtrInst&gt;(V))</div>
<div class="line"><a name="l08494"></a><span class="lineno"> 8494</span>&#160;      return true;</div>
<div class="line"><a name="l08495"></a><span class="lineno"> 8495</span>&#160;    auto *I = cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l08496"></a><span class="lineno"> 8496</span>&#160;    return !E-&gt;isOpcodeOrAlt(I) || I-&gt;getParent() == BB ||</div>
<div class="line"><a name="l08497"></a><span class="lineno"> 8497</span>&#160;           isVectorLikeInstWithConstOps(I);</div>
<div class="line"><a name="l08498"></a><span class="lineno"> 8498</span>&#160;  }));</div>
<div class="line"><a name="l08499"></a><span class="lineno"> 8499</span>&#160; </div>
<div class="line"><a name="l08500"></a><span class="lineno"> 8500</span>&#160;  <span class="keyword">auto</span> &amp;&amp;FindLastInst = [<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, Front, <span class="keyword">this</span>, &amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>]() {</div>
<div class="line"><a name="l08501"></a><span class="lineno"> 8501</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *LastInst = Front;</div>
<div class="line"><a name="l08502"></a><span class="lineno"> 8502</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars) {</div>
<div class="line"><a name="l08503"></a><span class="lineno"> 8503</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l08504"></a><span class="lineno"> 8504</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l08505"></a><span class="lineno"> 8505</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08506"></a><span class="lineno"> 8506</span>&#160;      <span class="keywordflow">if</span> (LastInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()) {</div>
<div class="line"><a name="l08507"></a><span class="lineno"> 8507</span>&#160;        <span class="keywordflow">if</span> (LastInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a784097fca76abad9e815cf1692de79c4">comesBefore</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l08508"></a><span class="lineno"> 8508</span>&#160;          LastInst = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l08509"></a><span class="lineno"> 8509</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08510"></a><span class="lineno"> 8510</span>&#160;      }</div>
<div class="line"><a name="l08511"></a><span class="lineno"> 8511</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="SLPVectorizer_8cpp.html#a06a9edb69d0ed6fda201d59948acfd89">isVectorLikeInstWithConstOps</a>(LastInst) &amp;&amp;</div>
<div class="line"><a name="l08512"></a><span class="lineno"> 8512</span>&#160;             <a class="code" href="SLPVectorizer_8cpp.html#a06a9edb69d0ed6fda201d59948acfd89">isVectorLikeInstWithConstOps</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</div>
<div class="line"><a name="l08513"></a><span class="lineno"> 8513</span>&#160;             <span class="stringliteral">&quot;Expected vector-like insts only.&quot;</span>);</div>
<div class="line"><a name="l08514"></a><span class="lineno"> 8514</span>&#160;      <span class="keywordflow">if</span> (!DT-&gt;isReachableFromEntry(LastInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>())) {</div>
<div class="line"><a name="l08515"></a><span class="lineno"> 8515</span>&#160;        LastInst = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l08516"></a><span class="lineno"> 8516</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08517"></a><span class="lineno"> 8517</span>&#160;      }</div>
<div class="line"><a name="l08518"></a><span class="lineno"> 8518</span>&#160;      <span class="keywordflow">if</span> (!DT-&gt;isReachableFromEntry(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()))</div>
<div class="line"><a name="l08519"></a><span class="lineno"> 8519</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08520"></a><span class="lineno"> 8520</span>&#160;      <span class="keyword">auto</span> *NodeA = DT-&gt;getNode(LastInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>());</div>
<div class="line"><a name="l08521"></a><span class="lineno"> 8521</span>&#160;      <span class="keyword">auto</span> *NodeB = DT-&gt;getNode(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent());</div>
<div class="line"><a name="l08522"></a><span class="lineno"> 8522</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NodeA &amp;&amp; <span class="stringliteral">&quot;Should only process reachable instructions&quot;</span>);</div>
<div class="line"><a name="l08523"></a><span class="lineno"> 8523</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NodeB &amp;&amp; <span class="stringliteral">&quot;Should only process reachable instructions&quot;</span>);</div>
<div class="line"><a name="l08524"></a><span class="lineno"> 8524</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((NodeA == NodeB) ==</div>
<div class="line"><a name="l08525"></a><span class="lineno"> 8525</span>&#160;                 (NodeA-&gt;getDFSNumIn() == NodeB-&gt;getDFSNumIn()) &amp;&amp;</div>
<div class="line"><a name="l08526"></a><span class="lineno"> 8526</span>&#160;             <span class="stringliteral">&quot;Different nodes should have different DFS numbers&quot;</span>);</div>
<div class="line"><a name="l08527"></a><span class="lineno"> 8527</span>&#160;      <span class="keywordflow">if</span> (NodeA-&gt;getDFSNumIn() &lt; NodeB-&gt;getDFSNumIn())</div>
<div class="line"><a name="l08528"></a><span class="lineno"> 8528</span>&#160;        LastInst = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l08529"></a><span class="lineno"> 8529</span>&#160;    }</div>
<div class="line"><a name="l08530"></a><span class="lineno"> 8530</span>&#160;    <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = LastInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l08531"></a><span class="lineno"> 8531</span>&#160;    <span class="keywordflow">return</span> LastInst;</div>
<div class="line"><a name="l08532"></a><span class="lineno"> 8532</span>&#160;  };</div>
<div class="line"><a name="l08533"></a><span class="lineno"> 8533</span>&#160; </div>
<div class="line"><a name="l08534"></a><span class="lineno"> 8534</span>&#160;  <span class="keyword">auto</span> &amp;&amp;FindFirstInst = [<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, Front, <span class="keyword">this</span>]() {</div>
<div class="line"><a name="l08535"></a><span class="lineno"> 8535</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *FirstInst = Front;</div>
<div class="line"><a name="l08536"></a><span class="lineno"> 8536</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars) {</div>
<div class="line"><a name="l08537"></a><span class="lineno"> 8537</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l08538"></a><span class="lineno"> 8538</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l08539"></a><span class="lineno"> 8539</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08540"></a><span class="lineno"> 8540</span>&#160;      <span class="keywordflow">if</span> (FirstInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()) {</div>
<div class="line"><a name="l08541"></a><span class="lineno"> 8541</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;comesBefore(FirstInst))</div>
<div class="line"><a name="l08542"></a><span class="lineno"> 8542</span>&#160;          FirstInst = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l08543"></a><span class="lineno"> 8543</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08544"></a><span class="lineno"> 8544</span>&#160;      }</div>
<div class="line"><a name="l08545"></a><span class="lineno"> 8545</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="SLPVectorizer_8cpp.html#a06a9edb69d0ed6fda201d59948acfd89">isVectorLikeInstWithConstOps</a>(FirstInst) &amp;&amp;</div>
<div class="line"><a name="l08546"></a><span class="lineno"> 8546</span>&#160;             <a class="code" href="SLPVectorizer_8cpp.html#a06a9edb69d0ed6fda201d59948acfd89">isVectorLikeInstWithConstOps</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</div>
<div class="line"><a name="l08547"></a><span class="lineno"> 8547</span>&#160;             <span class="stringliteral">&quot;Expected vector-like insts only.&quot;</span>);</div>
<div class="line"><a name="l08548"></a><span class="lineno"> 8548</span>&#160;      <span class="keywordflow">if</span> (!DT-&gt;isReachableFromEntry(FirstInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>())) {</div>
<div class="line"><a name="l08549"></a><span class="lineno"> 8549</span>&#160;        FirstInst = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l08550"></a><span class="lineno"> 8550</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08551"></a><span class="lineno"> 8551</span>&#160;      }</div>
<div class="line"><a name="l08552"></a><span class="lineno"> 8552</span>&#160;      <span class="keywordflow">if</span> (!DT-&gt;isReachableFromEntry(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()))</div>
<div class="line"><a name="l08553"></a><span class="lineno"> 8553</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08554"></a><span class="lineno"> 8554</span>&#160;      <span class="keyword">auto</span> *NodeA = DT-&gt;getNode(FirstInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>());</div>
<div class="line"><a name="l08555"></a><span class="lineno"> 8555</span>&#160;      <span class="keyword">auto</span> *NodeB = DT-&gt;getNode(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent());</div>
<div class="line"><a name="l08556"></a><span class="lineno"> 8556</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NodeA &amp;&amp; <span class="stringliteral">&quot;Should only process reachable instructions&quot;</span>);</div>
<div class="line"><a name="l08557"></a><span class="lineno"> 8557</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NodeB &amp;&amp; <span class="stringliteral">&quot;Should only process reachable instructions&quot;</span>);</div>
<div class="line"><a name="l08558"></a><span class="lineno"> 8558</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((NodeA == NodeB) ==</div>
<div class="line"><a name="l08559"></a><span class="lineno"> 8559</span>&#160;                 (NodeA-&gt;getDFSNumIn() == NodeB-&gt;getDFSNumIn()) &amp;&amp;</div>
<div class="line"><a name="l08560"></a><span class="lineno"> 8560</span>&#160;             <span class="stringliteral">&quot;Different nodes should have different DFS numbers&quot;</span>);</div>
<div class="line"><a name="l08561"></a><span class="lineno"> 8561</span>&#160;      <span class="keywordflow">if</span> (NodeA-&gt;getDFSNumIn() &gt; NodeB-&gt;getDFSNumIn())</div>
<div class="line"><a name="l08562"></a><span class="lineno"> 8562</span>&#160;        FirstInst = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l08563"></a><span class="lineno"> 8563</span>&#160;    }</div>
<div class="line"><a name="l08564"></a><span class="lineno"> 8564</span>&#160;    <span class="keywordflow">return</span> FirstInst;</div>
<div class="line"><a name="l08565"></a><span class="lineno"> 8565</span>&#160;  };</div>
<div class="line"><a name="l08566"></a><span class="lineno"> 8566</span>&#160; </div>
<div class="line"><a name="l08567"></a><span class="lineno"> 8567</span>&#160;  <span class="comment">// Set the insert point to the beginning of the basic block if the entry</span></div>
<div class="line"><a name="l08568"></a><span class="lineno"> 8568</span>&#160;  <span class="comment">// should not be scheduled.</span></div>
<div class="line"><a name="l08569"></a><span class="lineno"> 8569</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;State != TreeEntry::NeedToGather &amp;&amp;</div>
<div class="line"><a name="l08570"></a><span class="lineno"> 8570</span>&#160;      (<a class="code" href="namespacellvm.html#abed730d9d5b8f4c70f4fbe1094a0157f">doesNotNeedToSchedule</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars) ||</div>
<div class="line"><a name="l08571"></a><span class="lineno"> 8571</span>&#160;       <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars, <a class="code" href="SLPVectorizer_8cpp.html#a06a9edb69d0ed6fda201d59948acfd89">isVectorLikeInstWithConstOps</a>))) {</div>
<div class="line"><a name="l08572"></a><span class="lineno"> 8572</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *InsertInst;</div>
<div class="line"><a name="l08573"></a><span class="lineno"> 8573</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">all_of</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars, [](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l08574"></a><span class="lineno"> 8574</span>&#160;          return !isVectorLikeInstWithConstOps(V) &amp;&amp; isUsedOutsideBlock(V);</div>
<div class="line"><a name="l08575"></a><span class="lineno"> 8575</span>&#160;        }))</div>
<div class="line"><a name="l08576"></a><span class="lineno"> 8576</span>&#160;      InsertInst = FindLastInst();</div>
<div class="line"><a name="l08577"></a><span class="lineno"> 8577</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l08578"></a><span class="lineno"> 8578</span>&#160;      InsertInst = FindFirstInst();</div>
<div class="line"><a name="l08579"></a><span class="lineno"> 8579</span>&#160;    <span class="keywordflow">return</span> *InsertInst;</div>
<div class="line"><a name="l08580"></a><span class="lineno"> 8580</span>&#160;  }</div>
<div class="line"><a name="l08581"></a><span class="lineno"> 8581</span>&#160; </div>
<div class="line"><a name="l08582"></a><span class="lineno"> 8582</span>&#160;  <span class="comment">// The last instruction in the bundle in program order.</span></div>
<div class="line"><a name="l08583"></a><span class="lineno"> 8583</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *LastInst = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l08584"></a><span class="lineno"> 8584</span>&#160; </div>
<div class="line"><a name="l08585"></a><span class="lineno"> 8585</span>&#160;  <span class="comment">// Find the last instruction. The common case should be that BB has been</span></div>
<div class="line"><a name="l08586"></a><span class="lineno"> 8586</span>&#160;  <span class="comment">// scheduled, and the last instruction is VL.back(). So we start with</span></div>
<div class="line"><a name="l08587"></a><span class="lineno"> 8587</span>&#160;  <span class="comment">// VL.back() and iterate over schedule data until we reach the end of the</span></div>
<div class="line"><a name="l08588"></a><span class="lineno"> 8588</span>&#160;  <span class="comment">// bundle. The end of the bundle is marked by null ScheduleData.</span></div>
<div class="line"><a name="l08589"></a><span class="lineno"> 8589</span>&#160;  <span class="keywordflow">if</span> (BlocksSchedules.count(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)) {</div>
<div class="line"><a name="l08590"></a><span class="lineno"> 8590</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;isOneOf(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars.back());</div>
<div class="line"><a name="l08591"></a><span class="lineno"> 8591</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a05a7412bf10f2226fb69f2876b76e9cd">doesNotNeedToBeScheduled</a>(V))</div>
<div class="line"><a name="l08592"></a><span class="lineno"> 8592</span>&#160;      V = *<a class="code" href="namespacellvm.html#a7b49849160e7f089916f83c52511da9e">find_if_not</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars, <a class="code" href="namespacellvm.html#a05a7412bf10f2226fb69f2876b76e9cd">doesNotNeedToBeScheduled</a>);</div>
<div class="line"><a name="l08593"></a><span class="lineno"> 8593</span>&#160;    <span class="keyword">auto</span> *Bundle = BlocksSchedules[<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>]-&gt;getScheduleData(V);</div>
<div class="line"><a name="l08594"></a><span class="lineno"> 8594</span>&#160;    <span class="keywordflow">if</span> (Bundle &amp;&amp; Bundle-&gt;isPartOfBundle())</div>
<div class="line"><a name="l08595"></a><span class="lineno"> 8595</span>&#160;      <span class="keywordflow">for</span> (; Bundle; Bundle = Bundle-&gt;NextInBundle)</div>
<div class="line"><a name="l08596"></a><span class="lineno"> 8596</span>&#160;        <span class="keywordflow">if</span> (Bundle-&gt;OpValue == Bundle-&gt;Inst)</div>
<div class="line"><a name="l08597"></a><span class="lineno"> 8597</span>&#160;          LastInst = Bundle-&gt;Inst;</div>
<div class="line"><a name="l08598"></a><span class="lineno"> 8598</span>&#160;  }</div>
<div class="line"><a name="l08599"></a><span class="lineno"> 8599</span>&#160; </div>
<div class="line"><a name="l08600"></a><span class="lineno"> 8600</span>&#160;  <span class="comment">// LastInst can still be null at this point if there&#39;s either not an entry</span></div>
<div class="line"><a name="l08601"></a><span class="lineno"> 8601</span>&#160;  <span class="comment">// for BB in BlocksSchedules or there&#39;s no ScheduleData available for</span></div>
<div class="line"><a name="l08602"></a><span class="lineno"> 8602</span>&#160;  <span class="comment">// VL.back(). This can be the case if buildTree_rec aborts for various</span></div>
<div class="line"><a name="l08603"></a><span class="lineno"> 8603</span>&#160;  <span class="comment">// reasons (e.g., the maximum recursion depth is reached, the maximum region</span></div>
<div class="line"><a name="l08604"></a><span class="lineno"> 8604</span>&#160;  <span class="comment">// size is reached, etc.). ScheduleData is initialized in the scheduling</span></div>
<div class="line"><a name="l08605"></a><span class="lineno"> 8605</span>&#160;  <span class="comment">// &quot;dry-run&quot;.</span></div>
<div class="line"><a name="l08606"></a><span class="lineno"> 8606</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l08607"></a><span class="lineno"> 8607</span>&#160;  <span class="comment">// If this happens, we can still find the last instruction by brute force. We</span></div>
<div class="line"><a name="l08608"></a><span class="lineno"> 8608</span>&#160;  <span class="comment">// iterate forwards from Front (inclusive) until we either see all</span></div>
<div class="line"><a name="l08609"></a><span class="lineno"> 8609</span>&#160;  <span class="comment">// instructions in the bundle or reach the end of the block. If Front is the</span></div>
<div class="line"><a name="l08610"></a><span class="lineno"> 8610</span>&#160;  <span class="comment">// last instruction in program order, LastInst will be set to Front, and we</span></div>
<div class="line"><a name="l08611"></a><span class="lineno"> 8611</span>&#160;  <span class="comment">// will visit all the remaining instructions in the block.</span></div>
<div class="line"><a name="l08612"></a><span class="lineno"> 8612</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l08613"></a><span class="lineno"> 8613</span>&#160;  <span class="comment">// One of the reasons we exit early from buildTree_rec is to place an upper</span></div>
<div class="line"><a name="l08614"></a><span class="lineno"> 8614</span>&#160;  <span class="comment">// bound on compile-time. Thus, taking an additional compile-time hit here is</span></div>
<div class="line"><a name="l08615"></a><span class="lineno"> 8615</span>&#160;  <span class="comment">// not ideal. However, this should be exceedingly rare since it requires that</span></div>
<div class="line"><a name="l08616"></a><span class="lineno"> 8616</span>&#160;  <span class="comment">// we both exit early from buildTree_rec and that the bundle be out-of-order</span></div>
<div class="line"><a name="l08617"></a><span class="lineno"> 8617</span>&#160;  <span class="comment">// (causing us to iterate all the way to the end of the block).</span></div>
<div class="line"><a name="l08618"></a><span class="lineno"> 8618</span>&#160;  <span class="keywordflow">if</span> (!LastInst)</div>
<div class="line"><a name="l08619"></a><span class="lineno"> 8619</span>&#160;    LastInst = FindLastInst();</div>
<div class="line"><a name="l08620"></a><span class="lineno"> 8620</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LastInst &amp;&amp; <span class="stringliteral">&quot;Failed to find last instruction in bundle&quot;</span>);</div>
<div class="line"><a name="l08621"></a><span class="lineno"> 8621</span>&#160;  <span class="keywordflow">return</span> *LastInst;</div>
<div class="line"><a name="l08622"></a><span class="lineno"> 8622</span>&#160;}</div>
<div class="line"><a name="l08623"></a><span class="lineno"> 8623</span>&#160; </div>
<div class="line"><a name="l08624"></a><span class="lineno"> 8624</span>&#160;<span class="keywordtype">void</span> BoUpSLP::setInsertPointAfterBundle(<span class="keyword">const</span> TreeEntry *<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>) {</div>
<div class="line"><a name="l08625"></a><span class="lineno"> 8625</span>&#160;  <span class="keyword">auto</span> *Front = <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getMainOp();</div>
<div class="line"><a name="l08626"></a><span class="lineno"> 8626</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *LastInst = EntryToLastInstruction.<a class="code" href="classllvm_1_1DenseMapBase.html#a0b2ca98dc28c61793ff5c90d23e5f14e">lookup</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l08627"></a><span class="lineno"> 8627</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LastInst &amp;&amp; <span class="stringliteral">&quot;Failed to find last instruction in bundle&quot;</span>);</div>
<div class="line"><a name="l08628"></a><span class="lineno"> 8628</span>&#160;  <span class="comment">// If the instruction is PHI, set the insert point after all the PHIs.</span></div>
<div class="line"><a name="l08629"></a><span class="lineno"> 8629</span>&#160;  <span class="keywordtype">bool</span> IsPHI = isa&lt;PHINode&gt;(LastInst);</div>
<div class="line"><a name="l08630"></a><span class="lineno"> 8630</span>&#160;  <span class="keywordflow">if</span> (IsPHI)</div>
<div class="line"><a name="l08631"></a><span class="lineno"> 8631</span>&#160;    LastInst = LastInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a46ef6115027606b67adcf4d28f3dac17">getFirstNonPHI</a>();</div>
<div class="line"><a name="l08632"></a><span class="lineno"> 8632</span>&#160;  <span class="keywordflow">if</span> (IsPHI || (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;State != TreeEntry::NeedToGather &amp;&amp;</div>
<div class="line"><a name="l08633"></a><span class="lineno"> 8633</span>&#160;                <a class="code" href="namespacellvm.html#abed730d9d5b8f4c70f4fbe1094a0157f">doesNotNeedToSchedule</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars))) {</div>
<div class="line"><a name="l08634"></a><span class="lineno"> 8634</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(LastInst);</div>
<div class="line"><a name="l08635"></a><span class="lineno"> 8635</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l08636"></a><span class="lineno"> 8636</span>&#160;    <span class="comment">// Set the insertion point after the last instruction in the bundle. Set the</span></div>
<div class="line"><a name="l08637"></a><span class="lineno"> 8637</span>&#160;    <span class="comment">// debug location to Front.</span></div>
<div class="line"><a name="l08638"></a><span class="lineno"> 8638</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(LastInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>(),</div>
<div class="line"><a name="l08639"></a><span class="lineno"> 8639</span>&#160;                           std::next(LastInst-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>()));</div>
<div class="line"><a name="l08640"></a><span class="lineno"> 8640</span>&#160;  }</div>
<div class="line"><a name="l08641"></a><span class="lineno"> 8641</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetCurrentDebugLocation(Front-&gt;getDebugLoc());</div>
<div class="line"><a name="l08642"></a><span class="lineno"> 8642</span>&#160;}</div>
<div class="line"><a name="l08643"></a><span class="lineno"> 8643</span>&#160; </div>
<div class="line"><a name="l08644"></a><span class="lineno"> 8644</span>&#160;<a class="code" href="classllvm_1_1Value.html">Value</a> *BoUpSLP::gather(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL) {</div>
<div class="line"><a name="l08645"></a><span class="lineno"> 8645</span>&#160;  <span class="comment">// List of instructions/lanes from current block and/or the blocks which are</span></div>
<div class="line"><a name="l08646"></a><span class="lineno"> 8646</span>&#160;  <span class="comment">// part of the current loop. These instructions will be inserted at the end to</span></div>
<div class="line"><a name="l08647"></a><span class="lineno"> 8647</span>&#160;  <span class="comment">// make it possible to optimize loops and hoist invariant instructions out of</span></div>
<div class="line"><a name="l08648"></a><span class="lineno"> 8648</span>&#160;  <span class="comment">// the loops body with better chances for success.</span></div>
<div class="line"><a name="l08649"></a><span class="lineno"> 8649</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;Value *, unsigned&gt;</a>, 4&gt; PostponedInsts;</div>
<div class="line"><a name="l08650"></a><span class="lineno"> 8650</span>&#160;  <a class="code" href="classllvm_1_1SmallSet.html">SmallSet&lt;int, 4&gt;</a> PostponedIndices;</div>
<div class="line"><a name="l08651"></a><span class="lineno"> 8651</span>&#160;  <a class="code" href="classllvm_1_1Loop.html">Loop</a> *L = LI-&gt;getLoopFor(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.GetInsertBlock());</div>
<div class="line"><a name="l08652"></a><span class="lineno"> 8652</span>&#160;  <span class="keyword">auto</span> &amp;&amp;CheckPredecessor = [](<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *InstBB, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *InsertBB) {</div>
<div class="line"><a name="l08653"></a><span class="lineno"> 8653</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;BasicBlock *, 4&gt;</a> Visited;</div>
<div class="line"><a name="l08654"></a><span class="lineno"> 8654</span>&#160;    <span class="keywordflow">while</span> (InsertBB &amp;&amp; InsertBB != InstBB &amp;&amp; Visited.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(InsertBB).second)</div>
<div class="line"><a name="l08655"></a><span class="lineno"> 8655</span>&#160;      InsertBB = InsertBB-&gt;getSinglePredecessor();</div>
<div class="line"><a name="l08656"></a><span class="lineno"> 8656</span>&#160;    <span class="keywordflow">return</span> InsertBB &amp;&amp; InsertBB == InstBB;</div>
<div class="line"><a name="l08657"></a><span class="lineno"> 8657</span>&#160;  };</div>
<div class="line"><a name="l08658"></a><span class="lineno"> 8658</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l08659"></a><span class="lineno"> 8659</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Inst = dyn_cast&lt;Instruction&gt;(VL[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]))</div>
<div class="line"><a name="l08660"></a><span class="lineno"> 8660</span>&#160;      <span class="keywordflow">if</span> ((CheckPredecessor(Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>(), <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.GetInsertBlock()) ||</div>
<div class="line"><a name="l08661"></a><span class="lineno"> 8661</span>&#160;           getTreeEntry(Inst) || (L &amp;&amp; (L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#a04337b572d34ea413c35dbac5d75530b">contains</a>(Inst)))) &amp;&amp;</div>
<div class="line"><a name="l08662"></a><span class="lineno"> 8662</span>&#160;          PostponedIndices.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>).second)</div>
<div class="line"><a name="l08663"></a><span class="lineno"> 8663</span>&#160;        PostponedInsts.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>(Inst, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l08664"></a><span class="lineno"> 8664</span>&#160;  }</div>
<div class="line"><a name="l08665"></a><span class="lineno"> 8665</span>&#160; </div>
<div class="line"><a name="l08666"></a><span class="lineno"> 8666</span>&#160;  <span class="keyword">auto</span> &amp;&amp;CreateInsertElement = [<span class="keyword">this</span>](<a class="code" href="classllvm_1_1Value.html">Value</a> *Vec, <a class="code" href="classllvm_1_1Value.html">Value</a> *V, <span class="keywordtype">unsigned</span> Pos) {</div>
<div class="line"><a name="l08667"></a><span class="lineno"> 8667</span>&#160;    Vec = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateInsertElement(Vec, V, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt32(Pos));</div>
<div class="line"><a name="l08668"></a><span class="lineno"> 8668</span>&#160;    <span class="keyword">auto</span> *InsElt = dyn_cast&lt;InsertElementInst&gt;(Vec);</div>
<div class="line"><a name="l08669"></a><span class="lineno"> 8669</span>&#160;    <span class="keywordflow">if</span> (!InsElt)</div>
<div class="line"><a name="l08670"></a><span class="lineno"> 8670</span>&#160;      <span class="keywordflow">return</span> Vec;</div>
<div class="line"><a name="l08671"></a><span class="lineno"> 8671</span>&#160;    GatherShuffleExtractSeq.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(InsElt);</div>
<div class="line"><a name="l08672"></a><span class="lineno"> 8672</span>&#160;    CSEBlocks.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(InsElt-&gt;getParent());</div>
<div class="line"><a name="l08673"></a><span class="lineno"> 8673</span>&#160;    <span class="comment">// Add to our &#39;need-to-extract&#39; list.</span></div>
<div class="line"><a name="l08674"></a><span class="lineno"> 8674</span>&#160;    <span class="keywordflow">if</span> (TreeEntry *Entry = getTreeEntry(V)) {</div>
<div class="line"><a name="l08675"></a><span class="lineno"> 8675</span>&#160;      <span class="comment">// Find which lane we need to extract.</span></div>
<div class="line"><a name="l08676"></a><span class="lineno"> 8676</span>&#160;      <span class="keywordtype">unsigned</span> FoundLane = Entry-&gt;findLaneForValue(V);</div>
<div class="line"><a name="l08677"></a><span class="lineno"> 8677</span>&#160;      ExternalUses.emplace_back(V, InsElt, FoundLane);</div>
<div class="line"><a name="l08678"></a><span class="lineno"> 8678</span>&#160;    }</div>
<div class="line"><a name="l08679"></a><span class="lineno"> 8679</span>&#160;    <span class="keywordflow">return</span> Vec;</div>
<div class="line"><a name="l08680"></a><span class="lineno"> 8680</span>&#160;  };</div>
<div class="line"><a name="l08681"></a><span class="lineno"> 8681</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Val0 =</div>
<div class="line"><a name="l08682"></a><span class="lineno"> 8682</span>&#160;      isa&lt;StoreInst&gt;(VL[0]) ? cast&lt;StoreInst&gt;(VL[0])-&gt;getValueOperand() : VL[0];</div>
<div class="line"><a name="l08683"></a><span class="lineno"> 8683</span>&#160;  <a class="code" href="classllvm_1_1FixedVectorType.html">FixedVectorType</a> *VecTy = <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(Val0-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</div>
<div class="line"><a name="l08684"></a><span class="lineno"> 8684</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Vec = <a class="code" href="classllvm_1_1PoisonValue.html#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(VecTy);</div>
<div class="line"><a name="l08685"></a><span class="lineno"> 8685</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> NonConsts;</div>
<div class="line"><a name="l08686"></a><span class="lineno"> 8686</span>&#160;  <span class="comment">// Insert constant values at first.</span></div>
<div class="line"><a name="l08687"></a><span class="lineno"> 8687</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l08688"></a><span class="lineno"> 8688</span>&#160;    <span class="keywordflow">if</span> (PostponedIndices.<a class="code" href="classllvm_1_1SmallSet.html#ae04ad615dfdd885e85cbddda146787c6">contains</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l08689"></a><span class="lineno"> 8689</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08690"></a><span class="lineno"> 8690</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="SLPVectorizer_8cpp.html#a6848b7e929178610d01e1b2b5052af86">isConstant</a>(VL[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>])) {</div>
<div class="line"><a name="l08691"></a><span class="lineno"> 8691</span>&#160;      NonConsts.push_back(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l08692"></a><span class="lineno"> 8692</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08693"></a><span class="lineno"> 8693</span>&#160;    }</div>
<div class="line"><a name="l08694"></a><span class="lineno"> 8694</span>&#160;    Vec = CreateInsertElement(Vec, VL[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>], <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l08695"></a><span class="lineno"> 8695</span>&#160;  }</div>
<div class="line"><a name="l08696"></a><span class="lineno"> 8696</span>&#160;  <span class="comment">// Insert non-constant values.</span></div>
<div class="line"><a name="l08697"></a><span class="lineno"> 8697</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : NonConsts)</div>
<div class="line"><a name="l08698"></a><span class="lineno"> 8698</span>&#160;    Vec = CreateInsertElement(Vec, VL[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>], <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l08699"></a><span class="lineno"> 8699</span>&#160;  <span class="comment">// Append instructions, which are/may be part of the loop, in the end to make</span></div>
<div class="line"><a name="l08700"></a><span class="lineno"> 8700</span>&#160;  <span class="comment">// it possible to hoist non-loop-based instructions.</span></div>
<div class="line"><a name="l08701"></a><span class="lineno"> 8701</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> std::pair&lt;Value *, unsigned&gt; &amp;Pair : PostponedInsts)</div>
<div class="line"><a name="l08702"></a><span class="lineno"> 8702</span>&#160;    Vec = CreateInsertElement(Vec, Pair.first, Pair.second);</div>
<div class="line"><a name="l08703"></a><span class="lineno"> 8703</span>&#160; </div>
<div class="line"><a name="l08704"></a><span class="lineno"> 8704</span>&#160;  <span class="keywordflow">return</span> Vec;</div>
<div class="line"><a name="l08705"></a><span class="lineno"> 8705</span>&#160;}</div>
<div class="line"><a name="l08706"></a><span class="lineno"> 8706</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l08707"></a><span class="lineno"> 8707</span>&#160;<span class="comment">/// Merges shuffle masks and emits final shuffle instruction, if required. It</span></div>
<div class="line"><a name="l08708"></a><span class="lineno"> 8708</span>&#160;<span class="comment">/// supports shuffling of 2 input vectors. It implements lazy shuffles emission,</span></div>
<div class="line"><a name="l08709"></a><span class="lineno"> 8709</span>&#160;<span class="comment">/// when the actual shuffle instruction is generated only if this is actually</span></div>
<div class="line"><a name="l08710"></a><span class="lineno"> 8710</span>&#160;<span class="comment">/// required. Otherwise, the shuffle instruction emission is delayed till the</span></div>
<div class="line"><a name="l08711"></a><span class="lineno"> 8711</span>&#160;<span class="comment">/// end of the process, to reduce the number of emitted instructions and further</span></div>
<div class="line"><a name="l08712"></a><span class="lineno"> 8712</span>&#160;<span class="comment">/// analysis/transformations.</span></div>
<div class="line"><a name="l08713"></a><span class="lineno"> 8713</span>&#160;<span class="comment">/// The class also will look through the previously emitted shuffle instructions</span></div>
<div class="line"><a name="l08714"></a><span class="lineno"> 8714</span>&#160;<span class="comment">/// and properly mark indices in mask as undef.</span></div>
<div class="line"><a name="l08715"></a><span class="lineno"> 8715</span>&#160;<span class="comment">/// For example, given the code</span></div>
<div class="line"><a name="l08716"></a><span class="lineno"> 8716</span>&#160;<span class="comment">/// \code</span></div>
<div class="line"><a name="l08717"></a><span class="lineno"> 8717</span>&#160;<span class="comment">/// %s1 = shufflevector &lt;2 x ty&gt; %0, poison, &lt;1, 0&gt;</span></div>
<div class="line"><a name="l08718"></a><span class="lineno"> 8718</span>&#160;<span class="comment">/// %s2 = shufflevector &lt;2 x ty&gt; %1, poison, &lt;1, 0&gt;</span></div>
<div class="line"><a name="l08719"></a><span class="lineno"> 8719</span>&#160;<span class="comment">/// \endcode</span></div>
<div class="line"><a name="l08720"></a><span class="lineno"> 8720</span>&#160;<span class="comment">/// and if need to emit shuffle of %s1 and %s2 with mask &lt;1, 0, 3, 2&gt;, it will</span></div>
<div class="line"><a name="l08721"></a><span class="lineno"> 8721</span>&#160;<span class="comment">/// look through %s1 and %s2 and emit</span></div>
<div class="line"><a name="l08722"></a><span class="lineno"> 8722</span>&#160;<span class="comment">/// \code</span></div>
<div class="line"><a name="l08723"></a><span class="lineno"> 8723</span>&#160;<span class="comment">/// %res = shufflevector &lt;2 x ty&gt; %0, %1, &lt;0, 1, 2, 3&gt;</span></div>
<div class="line"><a name="l08724"></a><span class="lineno"> 8724</span>&#160;<span class="comment">/// \endcode</span></div>
<div class="line"><a name="l08725"></a><span class="lineno"> 8725</span>&#160;<span class="comment">/// instead.</span></div>
<div class="line"><a name="l08726"></a><span class="lineno"> 8726</span>&#160;<span class="comment">/// If 2 operands are of different size, the smallest one will be resized and</span></div>
<div class="line"><a name="l08727"></a><span class="lineno"> 8727</span>&#160;<span class="comment">/// the mask recalculated properly.</span></div>
<div class="line"><a name="l08728"></a><span class="lineno"> 8728</span>&#160;<span class="comment">/// For example, given the code</span></div>
<div class="line"><a name="l08729"></a><span class="lineno"> 8729</span>&#160;<span class="comment">/// \code</span></div>
<div class="line"><a name="l08730"></a><span class="lineno"> 8730</span>&#160;<span class="comment">/// %s1 = shufflevector &lt;2 x ty&gt; %0, poison, &lt;1, 0, 1, 0&gt;</span></div>
<div class="line"><a name="l08731"></a><span class="lineno"> 8731</span>&#160;<span class="comment">/// %s2 = shufflevector &lt;2 x ty&gt; %1, poison, &lt;1, 0, 1, 0&gt;</span></div>
<div class="line"><a name="l08732"></a><span class="lineno"> 8732</span>&#160;<span class="comment">/// \endcode</span></div>
<div class="line"><a name="l08733"></a><span class="lineno"> 8733</span>&#160;<span class="comment">/// and if need to emit shuffle of %s1 and %s2 with mask &lt;1, 0, 5, 4&gt;, it will</span></div>
<div class="line"><a name="l08734"></a><span class="lineno"> 8734</span>&#160;<span class="comment">/// look through %s1 and %s2 and emit</span></div>
<div class="line"><a name="l08735"></a><span class="lineno"> 8735</span>&#160;<span class="comment">/// \code</span></div>
<div class="line"><a name="l08736"></a><span class="lineno"> 8736</span>&#160;<span class="comment">/// %res = shufflevector &lt;2 x ty&gt; %0, %1, &lt;0, 1, 2, 3&gt;</span></div>
<div class="line"><a name="l08737"></a><span class="lineno"> 8737</span>&#160;<span class="comment">/// \endcode</span></div>
<div class="line"><a name="l08738"></a><span class="lineno"> 8738</span>&#160;<span class="comment">/// instead.</span></div>
<div class="line"><a name="l08739"></a><span class="lineno"><a class="line" href="classBoUpSLP_1_1ShuffleInstructionBuilder.html"> 8739</a></span>&#160;<span class="comment"></span><span class="keyword">class </span><a class="code" href="classBoUpSLP_1_1ShuffleInstructionBuilder.html">BoUpSLP::ShuffleInstructionBuilder</a> final : <span class="keyword">public</span> BaseShuffleAnalysis {</div>
<div class="line"><a name="l08740"></a><span class="lineno"> 8740</span>&#160;  <span class="keywordtype">bool</span> IsFinalized = <span class="keyword">false</span>;<span class="comment"></span></div>
<div class="line"><a name="l08741"></a><span class="lineno"> 8741</span>&#160;<span class="comment">  /// Combined mask for all applied operands and masks. It is built during</span></div>
<div class="line"><a name="l08742"></a><span class="lineno"> 8742</span>&#160;<span class="comment">  /// analysis and actual emission of shuffle vector instructions.</span></div>
<div class="line"><a name="l08743"></a><span class="lineno"> 8743</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> CommonMask;<span class="comment"></span></div>
<div class="line"><a name="l08744"></a><span class="lineno"> 8744</span>&#160;<span class="comment">  /// List of operands for the shuffle vector instruction. It hold at max 2</span></div>
<div class="line"><a name="l08745"></a><span class="lineno"> 8745</span>&#160;<span class="comment">  /// operands, if the 3rd is going to be added, the first 2 are combined into</span></div>
<div class="line"><a name="l08746"></a><span class="lineno"> 8746</span>&#160;<span class="comment">  /// shuffle with \p CommonMask mask, the first operand sets to be the</span></div>
<div class="line"><a name="l08747"></a><span class="lineno"> 8747</span>&#160;<span class="comment">  /// resulting shuffle and the second operand sets to be the newly added</span></div>
<div class="line"><a name="l08748"></a><span class="lineno"> 8748</span>&#160;<span class="comment">  /// operand. The \p CommonMask is transformed in the proper way after that.</span></div>
<div class="line"><a name="l08749"></a><span class="lineno"> 8749</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 2&gt;</a> InVectors;</div>
<div class="line"><a name="l08750"></a><span class="lineno"> 8750</span>&#160;  <a class="code" href="classllvm_1_1IRBuilderBase.html">IRBuilderBase</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>;</div>
<div class="line"><a name="l08751"></a><span class="lineno"> 8751</span>&#160;  <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> &amp;R;</div>
<div class="line"><a name="l08752"></a><span class="lineno"> 8752</span>&#160; </div>
<div class="line"><a name="l08753"></a><span class="lineno"> 8753</span>&#160;  <span class="keyword">class </span>ShuffleIRBuilder {</div>
<div class="line"><a name="l08754"></a><span class="lineno"> 8754</span>&#160;    <a class="code" href="classllvm_1_1IRBuilderBase.html">IRBuilderBase</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>;<span class="comment"></span></div>
<div class="line"><a name="l08755"></a><span class="lineno"> 8755</span>&#160;<span class="comment">    /// Holds all of the instructions that we gathered.</span></div>
<div class="line"><a name="l08756"></a><span class="lineno"> 8756</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;Instruction *&gt;</a> &amp;GatherShuffleExtractSeq;<span class="comment"></span></div>
<div class="line"><a name="l08757"></a><span class="lineno"> 8757</span>&#160;<span class="comment">    /// A list of blocks that we are going to CSE.</span></div>
<div class="line"><a name="l08758"></a><span class="lineno"> 8758</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;BasicBlock *&gt;</a> &amp;CSEBlocks;</div>
<div class="line"><a name="l08759"></a><span class="lineno"> 8759</span>&#160; </div>
<div class="line"><a name="l08760"></a><span class="lineno"> 8760</span>&#160;  <span class="keyword">public</span>:</div>
<div class="line"><a name="l08761"></a><span class="lineno"> 8761</span>&#160;    ShuffleIRBuilder(<a class="code" href="classllvm_1_1IRBuilderBase.html">IRBuilderBase</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>,</div>
<div class="line"><a name="l08762"></a><span class="lineno"> 8762</span>&#160;                     <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;Instruction *&gt;</a> &amp;GatherShuffleExtractSeq,</div>
<div class="line"><a name="l08763"></a><span class="lineno"> 8763</span>&#160;                     <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;BasicBlock *&gt;</a> &amp;CSEBlocks)</div>
<div class="line"><a name="l08764"></a><span class="lineno"> 8764</span>&#160;        : <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>), GatherShuffleExtractSeq(GatherShuffleExtractSeq),</div>
<div class="line"><a name="l08765"></a><span class="lineno"> 8765</span>&#160;          CSEBlocks(CSEBlocks) {}</div>
<div class="line"><a name="l08766"></a><span class="lineno"> 8766</span>&#160;    ~ShuffleIRBuilder() = <span class="keywordflow">default</span>;<span class="comment"></span></div>
<div class="line"><a name="l08767"></a><span class="lineno"> 8767</span>&#160;<span class="comment">    /// Creates shufflevector for the 2 operands with the given mask.</span></div>
<div class="line"><a name="l08768"></a><span class="lineno"> 8768</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1Value.html">Value</a> *createShuffleVector(<a class="code" href="classllvm_1_1Value.html">Value</a> *V1, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>) {</div>
<div class="line"><a name="l08769"></a><span class="lineno"> 8769</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Vec = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShuffleVector(V1, <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l08770"></a><span class="lineno"> 8770</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(Vec)) {</div>
<div class="line"><a name="l08771"></a><span class="lineno"> 8771</span>&#160;        GatherShuffleExtractSeq.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l08772"></a><span class="lineno"> 8772</span>&#160;        CSEBlocks.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent());</div>
<div class="line"><a name="l08773"></a><span class="lineno"> 8773</span>&#160;      }</div>
<div class="line"><a name="l08774"></a><span class="lineno"> 8774</span>&#160;      <span class="keywordflow">return</span> Vec;</div>
<div class="line"><a name="l08775"></a><span class="lineno"> 8775</span>&#160;    }<span class="comment"></span></div>
<div class="line"><a name="l08776"></a><span class="lineno"> 8776</span>&#160;<span class="comment">    /// Creates permutation of the single vector operand with the given mask, if</span></div>
<div class="line"><a name="l08777"></a><span class="lineno"> 8777</span>&#160;<span class="comment">    /// it is not identity mask.</span></div>
<div class="line"><a name="l08778"></a><span class="lineno"> 8778</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1Value.html">Value</a> *createShuffleVector(<a class="code" href="classllvm_1_1Value.html">Value</a> *V1, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>) {</div>
<div class="line"><a name="l08779"></a><span class="lineno"> 8779</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.empty())</div>
<div class="line"><a name="l08780"></a><span class="lineno"> 8780</span>&#160;        <span class="keywordflow">return</span> V1;</div>
<div class="line"><a name="l08781"></a><span class="lineno"> 8781</span>&#160;      <span class="keywordtype">unsigned</span> VF = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size();</div>
<div class="line"><a name="l08782"></a><span class="lineno"> 8782</span>&#160;      <span class="keywordtype">unsigned</span> LocalVF = cast&lt;FixedVectorType&gt;(V1-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getNumElements();</div>
<div class="line"><a name="l08783"></a><span class="lineno"> 8783</span>&#160;      <span class="keywordflow">if</span> (VF == LocalVF &amp;&amp; <a class="code" href="classllvm_1_1ShuffleVectorInst.html#a4bc8953b0fd0277b0e5a8e5b78025150">ShuffleVectorInst::isIdentityMask</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>))</div>
<div class="line"><a name="l08784"></a><span class="lineno"> 8784</span>&#160;        <span class="keywordflow">return</span> V1;</div>
<div class="line"><a name="l08785"></a><span class="lineno"> 8785</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Vec = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShuffleVector(V1, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l08786"></a><span class="lineno"> 8786</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(Vec)) {</div>
<div class="line"><a name="l08787"></a><span class="lineno"> 8787</span>&#160;        GatherShuffleExtractSeq.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l08788"></a><span class="lineno"> 8788</span>&#160;        CSEBlocks.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent());</div>
<div class="line"><a name="l08789"></a><span class="lineno"> 8789</span>&#160;      }</div>
<div class="line"><a name="l08790"></a><span class="lineno"> 8790</span>&#160;      <span class="keywordflow">return</span> Vec;</div>
<div class="line"><a name="l08791"></a><span class="lineno"> 8791</span>&#160;    }<span class="comment"></span></div>
<div class="line"><a name="l08792"></a><span class="lineno"> 8792</span>&#160;<span class="comment">    /// Resizes 2 input vector to match the sizes, if the they are not equal</span></div>
<div class="line"><a name="l08793"></a><span class="lineno"> 8793</span>&#160;<span class="comment">    /// yet. The smallest vector is resized to the size of the larger vector.</span></div>
<div class="line"><a name="l08794"></a><span class="lineno"> 8794</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> resizeToMatch(<a class="code" href="classllvm_1_1Value.html">Value</a> *&amp;V1, <a class="code" href="classllvm_1_1Value.html">Value</a> *&amp;<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>) {</div>
<div class="line"><a name="l08795"></a><span class="lineno"> 8795</span>&#160;      <span class="keywordflow">if</span> (V1-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() == <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>-&gt;getType())</div>
<div class="line"><a name="l08796"></a><span class="lineno"> 8796</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l08797"></a><span class="lineno"> 8797</span>&#160;      <span class="keywordtype">int</span> V1VF = cast&lt;FixedVectorType&gt;(V1-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getNumElements();</div>
<div class="line"><a name="l08798"></a><span class="lineno"> 8798</span>&#160;      <span class="keywordtype">int</span> V2VF = cast&lt;FixedVectorType&gt;(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>-&gt;getType())-&gt;getNumElements();</div>
<div class="line"><a name="l08799"></a><span class="lineno"> 8799</span>&#160;      <span class="keywordtype">int</span> VF = <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(V1VF, V2VF);</div>
<div class="line"><a name="l08800"></a><span class="lineno"> 8800</span>&#160;      <span class="keywordtype">int</span> MinVF = <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(V1VF, V2VF);</div>
<div class="line"><a name="l08801"></a><span class="lineno"> 8801</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> IdentityMask(VF, <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l08802"></a><span class="lineno"> 8802</span>&#160;      std::iota(IdentityMask.begin(), std::next(IdentityMask.begin(), MinVF),</div>
<div class="line"><a name="l08803"></a><span class="lineno"> 8803</span>&#160;                0);</div>
<div class="line"><a name="l08804"></a><span class="lineno"> 8804</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *&amp;<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = MinVF == V1VF ? V1 : <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>;</div>
<div class="line"><a name="l08805"></a><span class="lineno"> 8805</span>&#160;      <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShuffleVector(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>, IdentityMask);</div>
<div class="line"><a name="l08806"></a><span class="lineno"> 8806</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>)) {</div>
<div class="line"><a name="l08807"></a><span class="lineno"> 8807</span>&#160;        GatherShuffleExtractSeq.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l08808"></a><span class="lineno"> 8808</span>&#160;        CSEBlocks.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent());</div>
<div class="line"><a name="l08809"></a><span class="lineno"> 8809</span>&#160;      }</div>
<div class="line"><a name="l08810"></a><span class="lineno"> 8810</span>&#160;      <span class="keywordflow">if</span> (MinVF == V1VF)</div>
<div class="line"><a name="l08811"></a><span class="lineno"> 8811</span>&#160;        V1 = <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>;</div>
<div class="line"><a name="l08812"></a><span class="lineno"> 8812</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l08813"></a><span class="lineno"> 8813</span>&#160;        <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a> = <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>;</div>
<div class="line"><a name="l08814"></a><span class="lineno"> 8814</span>&#160;    }</div>
<div class="line"><a name="l08815"></a><span class="lineno"> 8815</span>&#160;  };</div>
<div class="line"><a name="l08816"></a><span class="lineno"> 8816</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l08817"></a><span class="lineno"> 8817</span>&#160;<span class="comment">  /// Smart shuffle instruction emission, walks through shuffles trees and</span></div>
<div class="line"><a name="l08818"></a><span class="lineno"> 8818</span>&#160;<span class="comment">  /// tries to find the best matching vector for the actual shuffle</span></div>
<div class="line"><a name="l08819"></a><span class="lineno"> 8819</span>&#160;<span class="comment">  /// instruction.</span></div>
<div class="line"><a name="l08820"></a><span class="lineno"> 8820</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Value.html">Value</a> *createShuffle(<a class="code" href="classllvm_1_1Value.html">Value</a> *V1, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>) {</div>
<div class="line"><a name="l08821"></a><span class="lineno"> 8821</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(V1 &amp;&amp; <span class="stringliteral">&quot;Expected at least one vector value.&quot;</span>);</div>
<div class="line"><a name="l08822"></a><span class="lineno"> 8822</span>&#160;    ShuffleIRBuilder ShuffleBuilder(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, R.GatherShuffleExtractSeq,</div>
<div class="line"><a name="l08823"></a><span class="lineno"> 8823</span>&#160;                                    R.CSEBlocks);</div>
<div class="line"><a name="l08824"></a><span class="lineno"> 8824</span>&#160;    <span class="keywordflow">return</span> BaseShuffleAnalysis::createShuffle(V1, <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, ShuffleBuilder);</div>
<div class="line"><a name="l08825"></a><span class="lineno"> 8825</span>&#160;  }</div>
<div class="line"><a name="l08826"></a><span class="lineno"> 8826</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l08827"></a><span class="lineno"> 8827</span>&#160;<span class="comment">  /// Transforms mask \p CommonMask per given \p Mask to make proper set after</span></div>
<div class="line"><a name="l08828"></a><span class="lineno"> 8828</span>&#160;<span class="comment">  /// shuffle emission.</span></div>
<div class="line"><a name="l08829"></a><span class="lineno"> 8829</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> <span class="keywordtype">void</span> transformMaskAfterShuffle(<a class="code" href="classllvm_1_1MutableArrayRef.html">MutableArrayRef&lt;int&gt;</a> CommonMask,</div>
<div class="line"><a name="l08830"></a><span class="lineno"> 8830</span>&#160;                                        <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>) {</div>
<div class="line"><a name="l08831"></a><span class="lineno"> 8831</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Idx = 0, Sz = CommonMask.size(); Idx &lt; Sz; ++Idx)</div>
<div class="line"><a name="l08832"></a><span class="lineno"> 8832</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[Idx] != <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l08833"></a><span class="lineno"> 8833</span>&#160;        CommonMask[Idx] = Idx;</div>
<div class="line"><a name="l08834"></a><span class="lineno"> 8834</span>&#160;  }</div>
<div class="line"><a name="l08835"></a><span class="lineno"> 8835</span>&#160; </div>
<div class="line"><a name="l08836"></a><span class="lineno"> 8836</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l08837"></a><span class="lineno"><a class="line" href="classBoUpSLP_1_1ShuffleInstructionBuilder.html#aaee34f78593d529e1b378422b93062e1"> 8837</a></span>&#160;  <a class="code" href="classBoUpSLP_1_1ShuffleInstructionBuilder.html#aaee34f78593d529e1b378422b93062e1">ShuffleInstructionBuilder</a>(<a class="code" href="classllvm_1_1IRBuilderBase.html">IRBuilderBase</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> &amp;R)</div>
<div class="line"><a name="l08838"></a><span class="lineno"> 8838</span>&#160;      : <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>), R(R) {}</div>
<div class="line"><a name="l08839"></a><span class="lineno"> 8839</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l08840"></a><span class="lineno"> 8840</span>&#160;<span class="comment">  /// Adds 2 input vectors and the mask for their shuffling.</span></div>
<div class="line"><a name="l08841"></a><span class="lineno"><a class="line" href="classBoUpSLP_1_1ShuffleInstructionBuilder.html#a2a70579b10e07cbdcfa20fb9b05a48e7"> 8841</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="classBoUpSLP_1_1ShuffleInstructionBuilder.html#a2a70579b10e07cbdcfa20fb9b05a48e7">add</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V1, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>) {</div>
<div class="line"><a name="l08842"></a><span class="lineno"> 8842</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(V1 &amp;&amp; <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a> &amp;&amp; !<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.empty() &amp;&amp; <span class="stringliteral">&quot;Expected non-empty input vectors.&quot;</span>);</div>
<div class="line"><a name="l08843"></a><span class="lineno"> 8843</span>&#160;    <span class="keywordflow">if</span> (InVectors.empty()) {</div>
<div class="line"><a name="l08844"></a><span class="lineno"> 8844</span>&#160;      InVectors.push_back(V1);</div>
<div class="line"><a name="l08845"></a><span class="lineno"> 8845</span>&#160;      InVectors.push_back(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>);</div>
<div class="line"><a name="l08846"></a><span class="lineno"> 8846</span>&#160;      CommonMask.assign(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.begin(), <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.end());</div>
<div class="line"><a name="l08847"></a><span class="lineno"> 8847</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l08848"></a><span class="lineno"> 8848</span>&#160;    }</div>
<div class="line"><a name="l08849"></a><span class="lineno"> 8849</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Vec = InVectors.front();</div>
<div class="line"><a name="l08850"></a><span class="lineno"> 8850</span>&#160;    <span class="keywordflow">if</span> (InVectors.size() == 2) {</div>
<div class="line"><a name="l08851"></a><span class="lineno"> 8851</span>&#160;      Vec = createShuffle(Vec, InVectors.back(), CommonMask);</div>
<div class="line"><a name="l08852"></a><span class="lineno"> 8852</span>&#160;      transformMaskAfterShuffle(CommonMask, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l08853"></a><span class="lineno"> 8853</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cast&lt;FixedVectorType&gt;(Vec-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getNumElements() !=</div>
<div class="line"><a name="l08854"></a><span class="lineno"> 8854</span>&#160;               <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size()) {</div>
<div class="line"><a name="l08855"></a><span class="lineno"> 8855</span>&#160;      Vec = createShuffle(Vec, <span class="keyword">nullptr</span>, CommonMask);</div>
<div class="line"><a name="l08856"></a><span class="lineno"> 8856</span>&#160;      transformMaskAfterShuffle(CommonMask, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l08857"></a><span class="lineno"> 8857</span>&#160;    }</div>
<div class="line"><a name="l08858"></a><span class="lineno"> 8858</span>&#160;    V1 = createShuffle(V1, <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l08859"></a><span class="lineno"> 8859</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Idx = 0, Sz = CommonMask.size(); Idx &lt; Sz; ++Idx)</div>
<div class="line"><a name="l08860"></a><span class="lineno"> 8860</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[Idx] != <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l08861"></a><span class="lineno"> 8861</span>&#160;        CommonMask[Idx] = Idx + Sz;</div>
<div class="line"><a name="l08862"></a><span class="lineno"> 8862</span>&#160;    InVectors.front() = Vec;</div>
<div class="line"><a name="l08863"></a><span class="lineno"> 8863</span>&#160;    <span class="keywordflow">if</span> (InVectors.size() == 2)</div>
<div class="line"><a name="l08864"></a><span class="lineno"> 8864</span>&#160;      InVectors.back() = V1;</div>
<div class="line"><a name="l08865"></a><span class="lineno"> 8865</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l08866"></a><span class="lineno"> 8866</span>&#160;      InVectors.push_back(V1);</div>
<div class="line"><a name="l08867"></a><span class="lineno"> 8867</span>&#160;  }<span class="comment"></span></div>
<div class="line"><a name="l08868"></a><span class="lineno"> 8868</span>&#160;<span class="comment">  /// Adds another one input vector and the mask for the shuffling.</span></div>
<div class="line"><a name="l08869"></a><span class="lineno"><a class="line" href="classBoUpSLP_1_1ShuffleInstructionBuilder.html#ae071f05fc43a0d7c6b2d4984f9aefe9b"> 8869</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="classBoUpSLP_1_1ShuffleInstructionBuilder.html#ae071f05fc43a0d7c6b2d4984f9aefe9b">add</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V1, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>) {</div>
<div class="line"><a name="l08870"></a><span class="lineno"> 8870</span>&#160;    <span class="keywordflow">if</span> (InVectors.empty()) {</div>
<div class="line"><a name="l08871"></a><span class="lineno"> 8871</span>&#160;      <span class="keywordflow">if</span> (!isa&lt;FixedVectorType&gt;(V1-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())) {</div>
<div class="line"><a name="l08872"></a><span class="lineno"> 8872</span>&#160;        V1 = createShuffle(V1, <span class="keyword">nullptr</span>, CommonMask);</div>
<div class="line"><a name="l08873"></a><span class="lineno"> 8873</span>&#160;        CommonMask.assign(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size(), <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l08874"></a><span class="lineno"> 8874</span>&#160;        transformMaskAfterShuffle(CommonMask, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l08875"></a><span class="lineno"> 8875</span>&#160;      }</div>
<div class="line"><a name="l08876"></a><span class="lineno"> 8876</span>&#160;      InVectors.push_back(V1);</div>
<div class="line"><a name="l08877"></a><span class="lineno"> 8877</span>&#160;      CommonMask.assign(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.begin(), <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.end());</div>
<div class="line"><a name="l08878"></a><span class="lineno"> 8878</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l08879"></a><span class="lineno"> 8879</span>&#160;    }</div>
<div class="line"><a name="l08880"></a><span class="lineno"> 8880</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> *It = <a class="code" href="namespacellvm.html#a086e9fbdb06276db7753101a08a63adf">find</a>(InVectors, V1);</div>
<div class="line"><a name="l08881"></a><span class="lineno"> 8881</span>&#160;    <span class="keywordflow">if</span> (It == InVectors.end()) {</div>
<div class="line"><a name="l08882"></a><span class="lineno"> 8882</span>&#160;      <span class="keywordflow">if</span> (InVectors.size() == 2 ||</div>
<div class="line"><a name="l08883"></a><span class="lineno"> 8883</span>&#160;          InVectors.front()-&gt;getType() != V1-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() ||</div>
<div class="line"><a name="l08884"></a><span class="lineno"> 8884</span>&#160;          !isa&lt;FixedVectorType&gt;(V1-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())) {</div>
<div class="line"><a name="l08885"></a><span class="lineno"> 8885</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *V = InVectors.front();</div>
<div class="line"><a name="l08886"></a><span class="lineno"> 8886</span>&#160;        <span class="keywordflow">if</span> (InVectors.size() == 2) {</div>
<div class="line"><a name="l08887"></a><span class="lineno"> 8887</span>&#160;          V = createShuffle(InVectors.front(), InVectors.back(), CommonMask);</div>
<div class="line"><a name="l08888"></a><span class="lineno"> 8888</span>&#160;          transformMaskAfterShuffle(CommonMask, CommonMask);</div>
<div class="line"><a name="l08889"></a><span class="lineno"> 8889</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cast&lt;FixedVectorType&gt;(V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getNumElements() !=</div>
<div class="line"><a name="l08890"></a><span class="lineno"> 8890</span>&#160;                   CommonMask.size()) {</div>
<div class="line"><a name="l08891"></a><span class="lineno"> 8891</span>&#160;          V = createShuffle(InVectors.front(), <span class="keyword">nullptr</span>, CommonMask);</div>
<div class="line"><a name="l08892"></a><span class="lineno"> 8892</span>&#160;          transformMaskAfterShuffle(CommonMask, CommonMask);</div>
<div class="line"><a name="l08893"></a><span class="lineno"> 8893</span>&#160;        }</div>
<div class="line"><a name="l08894"></a><span class="lineno"> 8894</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Idx = 0, Sz = CommonMask.size(); Idx &lt; Sz; ++Idx)</div>
<div class="line"><a name="l08895"></a><span class="lineno"> 8895</span>&#160;          <span class="keywordflow">if</span> (CommonMask[Idx] == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a> &amp;&amp; <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[Idx] != <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l08896"></a><span class="lineno"> 8896</span>&#160;            CommonMask[Idx] =</div>
<div class="line"><a name="l08897"></a><span class="lineno"> 8897</span>&#160;                V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() != V1-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()</div>
<div class="line"><a name="l08898"></a><span class="lineno"> 8898</span>&#160;                    ? Idx + Sz</div>
<div class="line"><a name="l08899"></a><span class="lineno"> 8899</span>&#160;                    : <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[Idx] + cast&lt;FixedVectorType&gt;(V1-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())</div>
<div class="line"><a name="l08900"></a><span class="lineno"> 8900</span>&#160;                                      -&gt;getNumElements();</div>
<div class="line"><a name="l08901"></a><span class="lineno"> 8901</span>&#160;        <span class="keywordflow">if</span> (V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() != V1-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())</div>
<div class="line"><a name="l08902"></a><span class="lineno"> 8902</span>&#160;          V1 = createShuffle(V1, <span class="keyword">nullptr</span>, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l08903"></a><span class="lineno"> 8903</span>&#160;        InVectors.front() = V;</div>
<div class="line"><a name="l08904"></a><span class="lineno"> 8904</span>&#160;        <span class="keywordflow">if</span> (InVectors.size() == 2)</div>
<div class="line"><a name="l08905"></a><span class="lineno"> 8905</span>&#160;          InVectors.back() = V1;</div>
<div class="line"><a name="l08906"></a><span class="lineno"> 8906</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l08907"></a><span class="lineno"> 8907</span>&#160;          InVectors.push_back(V1);</div>
<div class="line"><a name="l08908"></a><span class="lineno"> 8908</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l08909"></a><span class="lineno"> 8909</span>&#160;      }</div>
<div class="line"><a name="l08910"></a><span class="lineno"> 8910</span>&#160;      <span class="comment">// Check if second vector is required if the used elements are already</span></div>
<div class="line"><a name="l08911"></a><span class="lineno"> 8911</span>&#160;      <span class="comment">// used from the first one.</span></div>
<div class="line"><a name="l08912"></a><span class="lineno"> 8912</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Idx = 0, Sz = CommonMask.size(); Idx &lt; Sz; ++Idx)</div>
<div class="line"><a name="l08913"></a><span class="lineno"> 8913</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[Idx] != <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a> &amp;&amp; CommonMask[Idx] == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>) {</div>
<div class="line"><a name="l08914"></a><span class="lineno"> 8914</span>&#160;          InVectors.push_back(V1);</div>
<div class="line"><a name="l08915"></a><span class="lineno"> 8915</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l08916"></a><span class="lineno"> 8916</span>&#160;        }</div>
<div class="line"><a name="l08917"></a><span class="lineno"> 8917</span>&#160;    }</div>
<div class="line"><a name="l08918"></a><span class="lineno"> 8918</span>&#160;    <span class="keywordtype">int</span> VF = CommonMask.size();</div>
<div class="line"><a name="l08919"></a><span class="lineno"> 8919</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *FTy = dyn_cast&lt;FixedVectorType&gt;(V1-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()))</div>
<div class="line"><a name="l08920"></a><span class="lineno"> 8920</span>&#160;      VF = FTy-&gt;getNumElements();</div>
<div class="line"><a name="l08921"></a><span class="lineno"> 8921</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Idx = 0, Sz = CommonMask.size(); Idx &lt; Sz; ++Idx)</div>
<div class="line"><a name="l08922"></a><span class="lineno"> 8922</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[Idx] != <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a> &amp;&amp; CommonMask[Idx] == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l08923"></a><span class="lineno"> 8923</span>&#160;        CommonMask[Idx] = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[Idx] + (It == InVectors.begin() ? 0 : VF);</div>
<div class="line"><a name="l08924"></a><span class="lineno"> 8924</span>&#160;  }<span class="comment"></span></div>
<div class="line"><a name="l08925"></a><span class="lineno"> 8925</span>&#160;<span class="comment">  /// Adds another one input vector and the mask for the shuffling.</span></div>
<div class="line"><a name="l08926"></a><span class="lineno"><a class="line" href="classBoUpSLP_1_1ShuffleInstructionBuilder.html#ae036b393a449f51cd7d7bf0458dac6be"> 8926</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="classBoUpSLP_1_1ShuffleInstructionBuilder.html#ae036b393a449f51cd7d7bf0458dac6be">addOrdered</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V1, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;unsigned&gt;</a> Order) {</div>
<div class="line"><a name="l08927"></a><span class="lineno"> 8927</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> NewMask;</div>
<div class="line"><a name="l08928"></a><span class="lineno"> 8928</span>&#160;    <a class="code" href="namespacellvm.html#a6f0917bf2ae18fac81fea6bf7e887115">inversePermutation</a>(Order, NewMask);</div>
<div class="line"><a name="l08929"></a><span class="lineno"> 8929</span>&#160;    <a class="code" href="namespacellvm_1_1ARM__AM.html#a5d0557608eaebed12bc00812724ba2cdae6bcee28992dab735eaa43f5dfa48a09">add</a>(V1, NewMask);</div>
<div class="line"><a name="l08930"></a><span class="lineno"> 8930</span>&#160;  }<span class="comment"></span></div>
<div class="line"><a name="l08931"></a><span class="lineno"> 8931</span>&#160;<span class="comment">  /// Finalize emission of the shuffles.</span></div>
<div class="line"><a name="l08932"></a><span class="lineno"> 8932</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Value.html">Value</a> *</div>
<div class="line"><a name="l08933"></a><span class="lineno"><a class="line" href="classBoUpSLP_1_1ShuffleInstructionBuilder.html#a90d914a4c74deeeb0224cb65ce60b897"> 8933</a></span>&#160;  <a class="code" href="classBoUpSLP_1_1ShuffleInstructionBuilder.html#a90d914a4c74deeeb0224cb65ce60b897">finalize</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> ExtMask = std::nullopt) {</div>
<div class="line"><a name="l08934"></a><span class="lineno"> 8934</span>&#160;    IsFinalized = <span class="keyword">true</span>;</div>
<div class="line"><a name="l08935"></a><span class="lineno"> 8935</span>&#160;    <span class="keywordflow">if</span> (!ExtMask.<a class="code" href="classllvm_1_1ArrayRef.html#ac835b8735b1b2faec0efdca236e37d94">empty</a>()) {</div>
<div class="line"><a name="l08936"></a><span class="lineno"> 8936</span>&#160;      <span class="keywordflow">if</span> (CommonMask.empty()) {</div>
<div class="line"><a name="l08937"></a><span class="lineno"> 8937</span>&#160;        CommonMask.assign(ExtMask.<a class="code" href="classllvm_1_1ArrayRef.html#aab36927882fbfdcbb860d87fd9c30da8">begin</a>(), ExtMask.<a class="code" href="classllvm_1_1ArrayRef.html#a7ca5197533a9c1fb8a2bd30587fcec6b">end</a>());</div>
<div class="line"><a name="l08938"></a><span class="lineno"> 8938</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l08939"></a><span class="lineno"> 8939</span>&#160;        <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> NewMask(ExtMask.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(), <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l08940"></a><span class="lineno"> 8940</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, Sz = ExtMask.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; Sz; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l08941"></a><span class="lineno"> 8941</span>&#160;          <span class="keywordflow">if</span> (ExtMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l08942"></a><span class="lineno"> 8942</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l08943"></a><span class="lineno"> 8943</span>&#160;          NewMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = CommonMask[ExtMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]];</div>
<div class="line"><a name="l08944"></a><span class="lineno"> 8944</span>&#160;        }</div>
<div class="line"><a name="l08945"></a><span class="lineno"> 8945</span>&#160;        CommonMask.swap(NewMask);</div>
<div class="line"><a name="l08946"></a><span class="lineno"> 8946</span>&#160;      }</div>
<div class="line"><a name="l08947"></a><span class="lineno"> 8947</span>&#160;    }</div>
<div class="line"><a name="l08948"></a><span class="lineno"> 8948</span>&#160;    <span class="keywordflow">if</span> (CommonMask.empty()) {</div>
<div class="line"><a name="l08949"></a><span class="lineno"> 8949</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InVectors.size() == 1 &amp;&amp; <span class="stringliteral">&quot;Expected only one vector with no mask&quot;</span>);</div>
<div class="line"><a name="l08950"></a><span class="lineno"> 8950</span>&#160;      <span class="keywordflow">return</span> InVectors.front();</div>
<div class="line"><a name="l08951"></a><span class="lineno"> 8951</span>&#160;    }</div>
<div class="line"><a name="l08952"></a><span class="lineno"> 8952</span>&#160;    <span class="keywordflow">if</span> (InVectors.size() == 2)</div>
<div class="line"><a name="l08953"></a><span class="lineno"> 8953</span>&#160;      <span class="keywordflow">return</span> createShuffle(InVectors.front(), InVectors.back(), CommonMask);</div>
<div class="line"><a name="l08954"></a><span class="lineno"> 8954</span>&#160;    <span class="keywordflow">return</span> createShuffle(InVectors.front(), <span class="keyword">nullptr</span>, CommonMask);</div>
<div class="line"><a name="l08955"></a><span class="lineno"> 8955</span>&#160;  }</div>
<div class="line"><a name="l08956"></a><span class="lineno"> 8956</span>&#160; </div>
<div class="line"><a name="l08957"></a><span class="lineno"><a class="line" href="classBoUpSLP_1_1ShuffleInstructionBuilder.html#a96568e1eeadf54f7ec4b9265c6e98c80"> 8957</a></span>&#160;  <a class="code" href="classBoUpSLP_1_1ShuffleInstructionBuilder.html#a96568e1eeadf54f7ec4b9265c6e98c80">~ShuffleInstructionBuilder</a>() {</div>
<div class="line"><a name="l08958"></a><span class="lineno"> 8958</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((IsFinalized || CommonMask.empty()) &amp;&amp;</div>
<div class="line"><a name="l08959"></a><span class="lineno"> 8959</span>&#160;           <span class="stringliteral">&quot;Shuffle construction must be finalized.&quot;</span>);</div>
<div class="line"><a name="l08960"></a><span class="lineno"> 8960</span>&#160;  }</div>
<div class="line"><a name="l08961"></a><span class="lineno"> 8961</span>&#160;};</div>
<div class="line"><a name="l08962"></a><span class="lineno"> 8962</span>&#160; </div>
<div class="line"><a name="l08963"></a><span class="lineno"> 8963</span>&#160;<a class="code" href="classllvm_1_1Value.html">Value</a> *BoUpSLP::vectorizeOperand(TreeEntry *<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, <span class="keywordtype">unsigned</span> NodeIdx) {</div>
<div class="line"><a name="l08964"></a><span class="lineno"> 8964</span>&#160;  <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL = <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOperand(NodeIdx);</div>
<div class="line"><a name="l08965"></a><span class="lineno"> 8965</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> VF = VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>();</div>
<div class="line"><a name="l08966"></a><span class="lineno"> 8966</span>&#160;  InstructionsState <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = <a class="code" href="SLPVectorizer_8cpp.html#ae37b3a41d982a793664ab021d9b9b325">getSameOpcode</a>(VL, *TLI);</div>
<div class="line"><a name="l08967"></a><span class="lineno"> 8967</span>&#160;  <span class="comment">// Special processing for GEPs bundle, which may include non-gep values.</span></div>
<div class="line"><a name="l08968"></a><span class="lineno"> 8968</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.getOpcode() &amp;&amp; VL.<a class="code" href="classllvm_1_1ArrayRef.html#a6bc2b53fce3b1d8975eea027d8a8eb90">front</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>()) {</div>
<div class="line"><a name="l08969"></a><span class="lineno"> 8969</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> *It =</div>
<div class="line"><a name="l08970"></a><span class="lineno"> 8970</span>&#160;        <a class="code" href="namespacellvm.html#ac78c09ae232b2ce188ff590d51e3c268">find_if</a>(VL, [](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) { <span class="keywordflow">return</span> isa&lt;GetElementPtrInst&gt;(V); });</div>
<div class="line"><a name="l08971"></a><span class="lineno"> 8971</span>&#160;    <span class="keywordflow">if</span> (It != VL.<a class="code" href="classllvm_1_1ArrayRef.html#a7ca5197533a9c1fb8a2bd30587fcec6b">end</a>())</div>
<div class="line"><a name="l08972"></a><span class="lineno"> 8972</span>&#160;      <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = <a class="code" href="SLPVectorizer_8cpp.html#ae37b3a41d982a793664ab021d9b9b325">getSameOpcode</a>(*It, *TLI);</div>
<div class="line"><a name="l08973"></a><span class="lineno"> 8973</span>&#160;  }</div>
<div class="line"><a name="l08974"></a><span class="lineno"> 8974</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.getOpcode()) {</div>
<div class="line"><a name="l08975"></a><span class="lineno"> 8975</span>&#160;    <span class="keywordflow">if</span> (TreeEntry *VE = getTreeEntry(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.OpValue);</div>
<div class="line"><a name="l08976"></a><span class="lineno"> 8976</span>&#160;        VE &amp;&amp; VE-&gt;isSame(VL) &amp;&amp;</div>
<div class="line"><a name="l08977"></a><span class="lineno"> 8977</span>&#160;        (<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(VE-&gt;UserTreeIndices,</div>
<div class="line"><a name="l08978"></a><span class="lineno"> 8978</span>&#160;                [<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, NodeIdx](<span class="keyword">const</span> EdgeInfo &amp;EI) {</div>
<div class="line"><a name="l08979"></a><span class="lineno"> 8979</span>&#160;                  return EI.UserTE == E &amp;&amp; EI.EdgeIdx == NodeIdx;</div>
<div class="line"><a name="l08980"></a><span class="lineno"> 8980</span>&#160;                }) ||</div>
<div class="line"><a name="l08981"></a><span class="lineno"> 8981</span>&#160;         <a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(VectorizableTree,</div>
<div class="line"><a name="l08982"></a><span class="lineno"> 8982</span>&#160;                [<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, NodeIdx, VE](<span class="keyword">const</span> std::unique_ptr&lt;TreeEntry&gt; &amp;TE) {</div>
<div class="line"><a name="l08983"></a><span class="lineno"> 8983</span>&#160;                  <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;isOperandGatherNode({<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, NodeIdx}) &amp;&amp;</div>
<div class="line"><a name="l08984"></a><span class="lineno"> 8984</span>&#160;                         VE-&gt;isSame(<a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;Scalars);</div>
<div class="line"><a name="l08985"></a><span class="lineno"> 8985</span>&#160;                }))) {</div>
<div class="line"><a name="l08986"></a><span class="lineno"> 8986</span>&#160;      <span class="keyword">auto</span> FinalShuffle = [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>) {</div>
<div class="line"><a name="l08987"></a><span class="lineno"> 8987</span>&#160;        ShuffleInstructionBuilder ShuffleBuilder(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, *<span class="keyword">this</span>);</div>
<div class="line"><a name="l08988"></a><span class="lineno"> 8988</span>&#160;        ShuffleBuilder.add(V, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l08989"></a><span class="lineno"> 8989</span>&#160;        <span class="keywordflow">return</span> ShuffleBuilder.finalize(std::nullopt);</div>
<div class="line"><a name="l08990"></a><span class="lineno"> 8990</span>&#160;      };</div>
<div class="line"><a name="l08991"></a><span class="lineno"> 8991</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V = vectorizeTree(VE);</div>
<div class="line"><a name="l08992"></a><span class="lineno"> 8992</span>&#160;      <span class="keywordflow">if</span> (VF != cast&lt;FixedVectorType&gt;(V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getNumElements()) {</div>
<div class="line"><a name="l08993"></a><span class="lineno"> 8993</span>&#160;        <span class="keywordflow">if</span> (!VE-&gt;ReuseShuffleIndices.empty()) {</div>
<div class="line"><a name="l08994"></a><span class="lineno"> 8994</span>&#160;          <span class="comment">// Reshuffle to get only unique values.</span></div>
<div class="line"><a name="l08995"></a><span class="lineno"> 8995</span>&#160;          <span class="comment">// If some of the scalars are duplicated in the vectorization</span></div>
<div class="line"><a name="l08996"></a><span class="lineno"> 8996</span>&#160;          <span class="comment">// tree entry, we do not vectorize them but instead generate a</span></div>
<div class="line"><a name="l08997"></a><span class="lineno"> 8997</span>&#160;          <span class="comment">// mask for the reuses. But if there are several users of the</span></div>
<div class="line"><a name="l08998"></a><span class="lineno"> 8998</span>&#160;          <span class="comment">// same entry, they may have different vectorization factors.</span></div>
<div class="line"><a name="l08999"></a><span class="lineno"> 8999</span>&#160;          <span class="comment">// This is especially important for PHI nodes. In this case, we</span></div>
<div class="line"><a name="l09000"></a><span class="lineno"> 9000</span>&#160;          <span class="comment">// need to adapt the resulting instruction for the user</span></div>
<div class="line"><a name="l09001"></a><span class="lineno"> 9001</span>&#160;          <span class="comment">// vectorization factor and have to reshuffle it again to take</span></div>
<div class="line"><a name="l09002"></a><span class="lineno"> 9002</span>&#160;          <span class="comment">// only unique elements of the vector. Without this code the</span></div>
<div class="line"><a name="l09003"></a><span class="lineno"> 9003</span>&#160;          <span class="comment">// function incorrectly returns reduced vector instruction with</span></div>
<div class="line"><a name="l09004"></a><span class="lineno"> 9004</span>&#160;          <span class="comment">// the same elements, not with the unique ones.</span></div>
<div class="line"><a name="l09005"></a><span class="lineno"> 9005</span>&#160; </div>
<div class="line"><a name="l09006"></a><span class="lineno"> 9006</span>&#160;          <span class="comment">// block:</span></div>
<div class="line"><a name="l09007"></a><span class="lineno"> 9007</span>&#160;          <span class="comment">// %phi = phi &lt;2 x &gt; { .., %entry} {%shuffle, %block}</span></div>
<div class="line"><a name="l09008"></a><span class="lineno"> 9008</span>&#160;          <span class="comment">// %2 = shuffle &lt;2 x &gt; %phi, poison, &lt;4 x &gt; &lt;1, 1, 0, 0&gt;</span></div>
<div class="line"><a name="l09009"></a><span class="lineno"> 9009</span>&#160;          <span class="comment">// ... (use %2)</span></div>
<div class="line"><a name="l09010"></a><span class="lineno"> 9010</span>&#160;          <span class="comment">// %shuffle = shuffle &lt;2 x&gt; %2, poison, &lt;2 x&gt; {2, 0}</span></div>
<div class="line"><a name="l09011"></a><span class="lineno"> 9011</span>&#160;          <span class="comment">// br %block</span></div>
<div class="line"><a name="l09012"></a><span class="lineno"> 9012</span>&#160;          <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> UniqueIdxs(VF, <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l09013"></a><span class="lineno"> 9013</span>&#160;          <a class="code" href="classllvm_1_1SmallSet.html">SmallSet&lt;int, 4&gt;</a> UsedIdxs;</div>
<div class="line"><a name="l09014"></a><span class="lineno"> 9014</span>&#160;          <span class="keywordtype">int</span> Pos = 0;</div>
<div class="line"><a name="l09015"></a><span class="lineno"> 9015</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> Idx : VE-&gt;ReuseShuffleIndices) {</div>
<div class="line"><a name="l09016"></a><span class="lineno"> 9016</span>&#160;            <span class="keywordflow">if</span> (Idx != <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(VF) &amp;&amp; Idx != <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a> &amp;&amp;</div>
<div class="line"><a name="l09017"></a><span class="lineno"> 9017</span>&#160;                UsedIdxs.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(Idx).second)</div>
<div class="line"><a name="l09018"></a><span class="lineno"> 9018</span>&#160;              UniqueIdxs[Idx] = Pos;</div>
<div class="line"><a name="l09019"></a><span class="lineno"> 9019</span>&#160;            ++Pos;</div>
<div class="line"><a name="l09020"></a><span class="lineno"> 9020</span>&#160;          }</div>
<div class="line"><a name="l09021"></a><span class="lineno"> 9021</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VF &gt;= UsedIdxs.<a class="code" href="classllvm_1_1SmallSet.html#afd7c135e18f2d7253d4f8545cd7b1756">size</a>() &amp;&amp; <span class="stringliteral">&quot;Expected vectorization factor &quot;</span></div>
<div class="line"><a name="l09022"></a><span class="lineno"> 9022</span>&#160;                                          <span class="stringliteral">&quot;less than original vector size.&quot;</span>);</div>
<div class="line"><a name="l09023"></a><span class="lineno"> 9023</span>&#160;          UniqueIdxs.append(VF - UsedIdxs.<a class="code" href="classllvm_1_1SmallSet.html#afd7c135e18f2d7253d4f8545cd7b1756">size</a>(), <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l09024"></a><span class="lineno"> 9024</span>&#160;          V = FinalShuffle(V, UniqueIdxs);</div>
<div class="line"><a name="l09025"></a><span class="lineno"> 9025</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l09026"></a><span class="lineno"> 9026</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VF &lt; cast&lt;FixedVectorType&gt;(V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getNumElements() &amp;&amp;</div>
<div class="line"><a name="l09027"></a><span class="lineno"> 9027</span>&#160;                 <span class="stringliteral">&quot;Expected vectorization factor less &quot;</span></div>
<div class="line"><a name="l09028"></a><span class="lineno"> 9028</span>&#160;                 <span class="stringliteral">&quot;than original vector size.&quot;</span>);</div>
<div class="line"><a name="l09029"></a><span class="lineno"> 9029</span>&#160;          <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> UniformMask(VF, 0);</div>
<div class="line"><a name="l09030"></a><span class="lineno"> 9030</span>&#160;          std::iota(UniformMask.begin(), UniformMask.end(), 0);</div>
<div class="line"><a name="l09031"></a><span class="lineno"> 9031</span>&#160;          V = FinalShuffle(V, UniformMask);</div>
<div class="line"><a name="l09032"></a><span class="lineno"> 9032</span>&#160;        }</div>
<div class="line"><a name="l09033"></a><span class="lineno"> 9033</span>&#160;      }</div>
<div class="line"><a name="l09034"></a><span class="lineno"> 9034</span>&#160;      <span class="keywordflow">return</span> V;</div>
<div class="line"><a name="l09035"></a><span class="lineno"> 9035</span>&#160;    }</div>
<div class="line"><a name="l09036"></a><span class="lineno"> 9036</span>&#160;  }</div>
<div class="line"><a name="l09037"></a><span class="lineno"> 9037</span>&#160; </div>
<div class="line"><a name="l09038"></a><span class="lineno"> 9038</span>&#160;  <span class="comment">// Find the corresponding gather entry and vectorize it.</span></div>
<div class="line"><a name="l09039"></a><span class="lineno"> 9039</span>&#160;  <span class="comment">// Allows to be more accurate with tree/graph transformations, checks for the</span></div>
<div class="line"><a name="l09040"></a><span class="lineno"> 9040</span>&#160;  <span class="comment">// correctness of the transformations in many cases.</span></div>
<div class="line"><a name="l09041"></a><span class="lineno"> 9041</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="namespacellvm.html#ac78c09ae232b2ce188ff590d51e3c268">find_if</a>(VectorizableTree,</div>
<div class="line"><a name="l09042"></a><span class="lineno"> 9042</span>&#160;                    [<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, NodeIdx](<span class="keyword">const</span> std::unique_ptr&lt;TreeEntry&gt; &amp;TE) {</div>
<div class="line"><a name="l09043"></a><span class="lineno"> 9043</span>&#160;                      <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">TE</a>-&gt;isOperandGatherNode({<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, NodeIdx});</div>
<div class="line"><a name="l09044"></a><span class="lineno"> 9044</span>&#160;                    });</div>
<div class="line"><a name="l09045"></a><span class="lineno"> 9045</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != VectorizableTree.end() &amp;&amp; <span class="stringliteral">&quot;Gather node is not in the graph.&quot;</span>);</div>
<div class="line"><a name="l09046"></a><span class="lineno"> 9046</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;get()-&gt;UserTreeIndices.size() == 1 &amp;&amp;</div>
<div class="line"><a name="l09047"></a><span class="lineno"> 9047</span>&#160;         <span class="stringliteral">&quot;Expected only single user for the gather node.&quot;</span>);</div>
<div class="line"><a name="l09048"></a><span class="lineno"> 9048</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;get()-&gt;isSame(VL) &amp;&amp; <span class="stringliteral">&quot;Expected same list of scalars.&quot;</span>);</div>
<div class="line"><a name="l09049"></a><span class="lineno"> 9049</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;::InsertPointGuard</a> Guard(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>);</div>
<div class="line"><a name="l09050"></a><span class="lineno"> 9050</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode() != Instruction::InsertElement &amp;&amp;</div>
<div class="line"><a name="l09051"></a><span class="lineno"> 9051</span>&#160;      <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode() != <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">Instruction::PHI</a>) {</div>
<div class="line"><a name="l09052"></a><span class="lineno"> 9052</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *LastInst = EntryToLastInstruction.<a class="code" href="classllvm_1_1DenseMapBase.html#a0b2ca98dc28c61793ff5c90d23e5f14e">lookup</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09053"></a><span class="lineno"> 9053</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LastInst &amp;&amp; <span class="stringliteral">&quot;Failed to find last instruction in bundle&quot;</span>);</div>
<div class="line"><a name="l09054"></a><span class="lineno"> 9054</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(LastInst);</div>
<div class="line"><a name="l09055"></a><span class="lineno"> 9055</span>&#160;  }</div>
<div class="line"><a name="l09056"></a><span class="lineno"> 9056</span>&#160;  <span class="keywordflow">return</span> vectorizeTree(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;get());</div>
<div class="line"><a name="l09057"></a><span class="lineno"> 9057</span>&#160;}</div>
<div class="line"><a name="l09058"></a><span class="lineno"> 9058</span>&#160; </div>
<div class="line"><a name="l09059"></a><span class="lineno"> 9059</span>&#160;<a class="code" href="classllvm_1_1Value.html">Value</a> *BoUpSLP::createBuildVector(<span class="keyword">const</span> TreeEntry *<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>) {</div>
<div class="line"><a name="l09060"></a><span class="lineno"> 9060</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;State == TreeEntry::NeedToGather &amp;&amp; <span class="stringliteral">&quot;Expected gather node.&quot;</span>);</div>
<div class="line"><a name="l09061"></a><span class="lineno"> 9061</span>&#160;  <span class="keywordtype">unsigned</span> VF = <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getVectorFactor();</div>
<div class="line"><a name="l09062"></a><span class="lineno"> 9062</span>&#160; </div>
<div class="line"><a name="l09063"></a><span class="lineno"> 9063</span>&#160;  ShuffleInstructionBuilder ShuffleBuilder(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, *<span class="keyword">this</span>);</div>
<div class="line"><a name="l09064"></a><span class="lineno"> 9064</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *&gt;</a> Gathered(</div>
<div class="line"><a name="l09065"></a><span class="lineno"> 9065</span>&#160;      VF, <a class="code" href="classllvm_1_1PoisonValue.html#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars.front()-&gt;getType()));</div>
<div class="line"><a name="l09066"></a><span class="lineno"> 9066</span>&#160;  <span class="keywordtype">bool</span> NeedFreeze = <span class="keyword">false</span>;</div>
<div class="line"><a name="l09067"></a><span class="lineno"> 9067</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *&gt;</a> VL(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars.begin(), <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars.end());</div>
<div class="line"><a name="l09068"></a><span class="lineno"> 9068</span>&#160;  <span class="comment">// Build a mask out of the redorder indices and reorder scalars per this mask.</span></div>
<div class="line"><a name="l09069"></a><span class="lineno"> 9069</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> ReorderMask;</div>
<div class="line"><a name="l09070"></a><span class="lineno"> 9070</span>&#160;  <a class="code" href="namespacellvm.html#a6f0917bf2ae18fac81fea6bf7e887115">inversePermutation</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReorderIndices, ReorderMask);</div>
<div class="line"><a name="l09071"></a><span class="lineno"> 9071</span>&#160;  <span class="keywordflow">if</span> (!ReorderMask.empty())</div>
<div class="line"><a name="l09072"></a><span class="lineno"> 9072</span>&#160;    <a class="code" href="namespacellvm.html#a14c12bda1f5a9beed612b00f3f98b888">reorderScalars</a>(VL, ReorderMask);</div>
<div class="line"><a name="l09073"></a><span class="lineno"> 9073</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> ReuseMask(VF, <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l09074"></a><span class="lineno"> 9074</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="SLPVectorizer_8cpp.html#a7568c08b526dbf7f7b5402f3eb605b55">allConstant</a>(VL)) {</div>
<div class="line"><a name="l09075"></a><span class="lineno"> 9075</span>&#160;    <span class="comment">// For splats with can emit broadcasts instead of gathers, so try to find</span></div>
<div class="line"><a name="l09076"></a><span class="lineno"> 9076</span>&#160;    <span class="comment">// such sequences.</span></div>
<div class="line"><a name="l09077"></a><span class="lineno"> 9077</span>&#160;    <span class="keywordtype">bool</span> IsSplat = <a class="code" href="SLPVectorizer_8cpp.html#a6ef5b86735d738868e5fb00a18643b1c">isSplat</a>(VL) &amp;&amp; (VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() &gt; 2 || VL.<a class="code" href="classllvm_1_1ArrayRef.html#a6bc2b53fce3b1d8975eea027d8a8eb90">front</a>() == VL.<a class="code" href="classllvm_1_1ArrayRef.html#adb38eaaa53c1d9c57b6fe11cf84bd7a4">back</a>());</div>
<div class="line"><a name="l09078"></a><span class="lineno"> 9078</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> UndefPos;</div>
<div class="line"><a name="l09079"></a><span class="lineno"> 9079</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, unsigned&gt;</a> UniquePositions;</div>
<div class="line"><a name="l09080"></a><span class="lineno"> 9080</span>&#160;    <span class="comment">// Gather unique non-const values and all constant values.</span></div>
<div class="line"><a name="l09081"></a><span class="lineno"> 9081</span>&#160;    <span class="comment">// For repeated values, just shuffle them.</span></div>
<div class="line"><a name="l09082"></a><span class="lineno"> 9082</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> [<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, V] : <a class="code" href="namespacellvm.html#a7b2175e18ff52174fad26b6b68818564">enumerate</a>(VL)) {</div>
<div class="line"><a name="l09083"></a><span class="lineno"> 9083</span>&#160;      <span class="keywordflow">if</span> (isa&lt;UndefValue&gt;(V)) {</div>
<div class="line"><a name="l09084"></a><span class="lineno"> 9084</span>&#160;        <span class="keywordflow">if</span> (!isa&lt;PoisonValue&gt;(V)) {</div>
<div class="line"><a name="l09085"></a><span class="lineno"> 9085</span>&#160;          Gathered[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = V;</div>
<div class="line"><a name="l09086"></a><span class="lineno"> 9086</span>&#160;          ReuseMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l09087"></a><span class="lineno"> 9087</span>&#160;          UndefPos.push_back(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l09088"></a><span class="lineno"> 9088</span>&#160;        }</div>
<div class="line"><a name="l09089"></a><span class="lineno"> 9089</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l09090"></a><span class="lineno"> 9090</span>&#160;      }</div>
<div class="line"><a name="l09091"></a><span class="lineno"> 9091</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#a6848b7e929178610d01e1b2b5052af86">isConstant</a>(V)) {</div>
<div class="line"><a name="l09092"></a><span class="lineno"> 9092</span>&#160;        Gathered[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = V;</div>
<div class="line"><a name="l09093"></a><span class="lineno"> 9093</span>&#160;        ReuseMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l09094"></a><span class="lineno"> 9094</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l09095"></a><span class="lineno"> 9095</span>&#160;      }</div>
<div class="line"><a name="l09096"></a><span class="lineno"> 9096</span>&#160;      <span class="keywordflow">if</span> (IsSplat) {</div>
<div class="line"><a name="l09097"></a><span class="lineno"> 9097</span>&#160;        Gathered.front() = V;</div>
<div class="line"><a name="l09098"></a><span class="lineno"> 9098</span>&#160;        ReuseMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = 0;</div>
<div class="line"><a name="l09099"></a><span class="lineno"> 9099</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l09100"></a><span class="lineno"> 9100</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> Res = UniquePositions.<a class="code" href="classllvm_1_1DenseMapBase.html#a98c685a0c53f3f7ed5f4793890a6c850">try_emplace</a>(V, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l09101"></a><span class="lineno"> 9101</span>&#160;        Gathered[Res.first-&gt;second] = V;</div>
<div class="line"><a name="l09102"></a><span class="lineno"> 9102</span>&#160;        ReuseMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = Res.first-&gt;second;</div>
<div class="line"><a name="l09103"></a><span class="lineno"> 9103</span>&#160;      }</div>
<div class="line"><a name="l09104"></a><span class="lineno"> 9104</span>&#160;    }</div>
<div class="line"><a name="l09105"></a><span class="lineno"> 9105</span>&#160;    <span class="keywordflow">if</span> (!UndefPos.empty() &amp;&amp; IsSplat) {</div>
<div class="line"><a name="l09106"></a><span class="lineno"> 9106</span>&#160;      <span class="comment">// For undef values, try to replace them with the simple broadcast.</span></div>
<div class="line"><a name="l09107"></a><span class="lineno"> 9107</span>&#160;      <span class="comment">// We can do it if the broadcasted value is guaranteed to be</span></div>
<div class="line"><a name="l09108"></a><span class="lineno"> 9108</span>&#160;      <span class="comment">// non-poisonous, or by freezing the incoming scalar value first.</span></div>
<div class="line"><a name="l09109"></a><span class="lineno"> 9109</span>&#160;      <span class="keyword">auto</span> *It = <a class="code" href="namespacellvm.html#ac78c09ae232b2ce188ff590d51e3c268">find_if</a>(Gathered, [<span class="keyword">this</span>, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l09110"></a><span class="lineno"> 9110</span>&#160;        <span class="keywordflow">return</span> !isa&lt;UndefValue&gt;(V) &amp;&amp;</div>
<div class="line"><a name="l09111"></a><span class="lineno"> 9111</span>&#160;               (getTreeEntry(V) || <a class="code" href="namespacellvm.html#ae058c4750de2c85f12a1f96841ac9ae3">isGuaranteedNotToBePoison</a>(V) ||</div>
<div class="line"><a name="l09112"></a><span class="lineno"> 9112</span>&#160;                <a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(V-&gt;<a class="code" href="classllvm_1_1Value.html#aecb93439702247fe5353a9966f7cefcd">uses</a>(), [<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>](<span class="keyword">const</span> <a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U) {</div>
<div class="line"><a name="l09113"></a><span class="lineno"> 9113</span>&#160;                  <span class="comment">// Check if the value already used in the same operation in</span></div>
<div class="line"><a name="l09114"></a><span class="lineno"> 9114</span>&#160;                  <span class="comment">// one of the nodes already.</span></div>
<div class="line"><a name="l09115"></a><span class="lineno"> 9115</span>&#160;                  return E-&gt;UserTreeIndices.size() == 1 &amp;&amp;</div>
<div class="line"><a name="l09116"></a><span class="lineno"> 9116</span>&#160;                         is_contained(</div>
<div class="line"><a name="l09117"></a><span class="lineno"> 9117</span>&#160;                             E-&gt;UserTreeIndices.front().UserTE-&gt;Scalars,</div>
<div class="line"><a name="l09118"></a><span class="lineno"> 9118</span>&#160;                             U.getUser()) &amp;&amp;</div>
<div class="line"><a name="l09119"></a><span class="lineno"> 9119</span>&#160;                         E-&gt;UserTreeIndices.front().EdgeIdx != U.getOperandNo();</div>
<div class="line"><a name="l09120"></a><span class="lineno"> 9120</span>&#160;                }));</div>
<div class="line"><a name="l09121"></a><span class="lineno"> 9121</span>&#160;      });</div>
<div class="line"><a name="l09122"></a><span class="lineno"> 9122</span>&#160;      <span class="keywordflow">if</span> (It != Gathered.end()) {</div>
<div class="line"><a name="l09123"></a><span class="lineno"> 9123</span>&#160;        <span class="comment">// Replace undefs by the non-poisoned scalars and emit broadcast.</span></div>
<div class="line"><a name="l09124"></a><span class="lineno"> 9124</span>&#160;        <span class="keywordtype">int</span> Pos = std::distance(Gathered.begin(), It);</div>
<div class="line"><a name="l09125"></a><span class="lineno"> 9125</span>&#160;        <a class="code" href="namespacellvm.html#a0b2a153b655ed78a07468297eb4c6256">for_each</a>(UndefPos, [&amp;](<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l09126"></a><span class="lineno"> 9126</span>&#160;          <span class="comment">// Set the undef position to the non-poisoned scalar.</span></div>
<div class="line"><a name="l09127"></a><span class="lineno"> 9127</span>&#160;          ReuseMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = Pos;</div>
<div class="line"><a name="l09128"></a><span class="lineno"> 9128</span>&#160;          <span class="comment">// Replace the undef by the poison, in the mask it is replaced by non-poisoned scalar already.</span></div>
<div class="line"><a name="l09129"></a><span class="lineno"> 9129</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != Pos)</div>
<div class="line"><a name="l09130"></a><span class="lineno"> 9130</span>&#160;            Gathered[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="classllvm_1_1PoisonValue.html#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(Gathered[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]-&gt;<a class="code" href="M68kELFObjectWriter_8cpp.html#ae4a8bc3879d2282eefd72b16b12c2a37">getType</a>());</div>
<div class="line"><a name="l09131"></a><span class="lineno"> 9131</span>&#160;        });</div>
<div class="line"><a name="l09132"></a><span class="lineno"> 9132</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l09133"></a><span class="lineno"> 9133</span>&#160;        <span class="comment">// Replace undefs by the poisons, emit broadcast and then emit</span></div>
<div class="line"><a name="l09134"></a><span class="lineno"> 9134</span>&#160;        <span class="comment">// freeze.</span></div>
<div class="line"><a name="l09135"></a><span class="lineno"> 9135</span>&#160;        <a class="code" href="namespacellvm.html#a0b2a153b655ed78a07468297eb4c6256">for_each</a>(UndefPos, [&amp;](<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l09136"></a><span class="lineno"> 9136</span>&#160;          ReuseMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>;</div>
<div class="line"><a name="l09137"></a><span class="lineno"> 9137</span>&#160;          <span class="keywordflow">if</span> (isa&lt;UndefValue&gt;(Gathered[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]))</div>
<div class="line"><a name="l09138"></a><span class="lineno"> 9138</span>&#160;            Gathered[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="classllvm_1_1PoisonValue.html#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(Gathered[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]-&gt;<a class="code" href="M68kELFObjectWriter_8cpp.html#ae4a8bc3879d2282eefd72b16b12c2a37">getType</a>());</div>
<div class="line"><a name="l09139"></a><span class="lineno"> 9139</span>&#160;        });</div>
<div class="line"><a name="l09140"></a><span class="lineno"> 9140</span>&#160;        NeedFreeze = <span class="keyword">true</span>;</div>
<div class="line"><a name="l09141"></a><span class="lineno"> 9141</span>&#160;      }</div>
<div class="line"><a name="l09142"></a><span class="lineno"> 9142</span>&#160;    }</div>
<div class="line"><a name="l09143"></a><span class="lineno"> 9143</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l09144"></a><span class="lineno"> 9144</span>&#160;    ReuseMask.clear();</div>
<div class="line"><a name="l09145"></a><span class="lineno"> 9145</span>&#160;    <a class="code" href="namespacellvm.html#abb650e853db0ddbb60411b885c499737">copy</a>(VL, Gathered.begin());</div>
<div class="line"><a name="l09146"></a><span class="lineno"> 9146</span>&#160;  }</div>
<div class="line"><a name="l09147"></a><span class="lineno"> 9147</span>&#160;  <span class="comment">// Gather unique scalars and all constants.</span></div>
<div class="line"><a name="l09148"></a><span class="lineno"> 9148</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Vec = gather(Gathered);</div>
<div class="line"><a name="l09149"></a><span class="lineno"> 9149</span>&#160;  ShuffleBuilder.add(Vec, ReuseMask);</div>
<div class="line"><a name="l09150"></a><span class="lineno"> 9150</span>&#160;  Vec = ShuffleBuilder.finalize(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReuseShuffleIndices);</div>
<div class="line"><a name="l09151"></a><span class="lineno"> 9151</span>&#160;  <span class="keywordflow">if</span> (NeedFreeze)</div>
<div class="line"><a name="l09152"></a><span class="lineno"> 9152</span>&#160;    Vec = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateFreeze(Vec);</div>
<div class="line"><a name="l09153"></a><span class="lineno"> 9153</span>&#160;  <span class="keywordflow">return</span> Vec;</div>
<div class="line"><a name="l09154"></a><span class="lineno"> 9154</span>&#160;}</div>
<div class="line"><a name="l09155"></a><span class="lineno"> 9155</span>&#160; </div>
<div class="line"><a name="l09156"></a><span class="lineno"> 9156</span>&#160;<a class="code" href="classllvm_1_1Value.html">Value</a> *BoUpSLP::vectorizeTree(TreeEntry *<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>) {</div>
<div class="line"><a name="l09157"></a><span class="lineno"> 9157</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;::InsertPointGuard</a> Guard(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>);</div>
<div class="line"><a name="l09158"></a><span class="lineno"> 9158</span>&#160; </div>
<div class="line"><a name="l09159"></a><span class="lineno"> 9159</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue) {</div>
<div class="line"><a name="l09160"></a><span class="lineno"> 9160</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Diamond merged for &quot;</span> &lt;&lt; *<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars[0] &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l09161"></a><span class="lineno"> 9161</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue;</div>
<div class="line"><a name="l09162"></a><span class="lineno"> 9162</span>&#160;  }</div>
<div class="line"><a name="l09163"></a><span class="lineno"> 9163</span>&#160; </div>
<div class="line"><a name="l09164"></a><span class="lineno"> 9164</span>&#160;  <span class="keyword">auto</span> FinalShuffle = [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <span class="keyword">const</span> TreeEntry *<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>) {</div>
<div class="line"><a name="l09165"></a><span class="lineno"> 9165</span>&#160;    ShuffleInstructionBuilder ShuffleBuilder(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, *<span class="keyword">this</span>);</div>
<div class="line"><a name="l09166"></a><span class="lineno"> 9166</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;State != TreeEntry::NeedToGather &amp;&amp;</div>
<div class="line"><a name="l09167"></a><span class="lineno"> 9167</span>&#160;        <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode() == <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Instruction::Store</a>) {</div>
<div class="line"><a name="l09168"></a><span class="lineno"> 9168</span>&#160;      <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a> =</div>
<div class="line"><a name="l09169"></a><span class="lineno"> 9169</span>&#160;          <a class="code" href="namespacellvm.html#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">int</span> *<span class="keyword">&gt;</span>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReorderIndices.begin()),</div>
<div class="line"><a name="l09170"></a><span class="lineno"> 9170</span>&#160;                   <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReorderIndices.size());</div>
<div class="line"><a name="l09171"></a><span class="lineno"> 9171</span>&#160;      ShuffleBuilder.add(V, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l09172"></a><span class="lineno"> 9172</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l09173"></a><span class="lineno"> 9173</span>&#160;      ShuffleBuilder.addOrdered(V, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReorderIndices);</div>
<div class="line"><a name="l09174"></a><span class="lineno"> 9174</span>&#160;    }</div>
<div class="line"><a name="l09175"></a><span class="lineno"> 9175</span>&#160;    <span class="keywordflow">return</span> ShuffleBuilder.finalize(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReuseShuffleIndices);</div>
<div class="line"><a name="l09176"></a><span class="lineno"> 9176</span>&#160;  };</div>
<div class="line"><a name="l09177"></a><span class="lineno"> 9177</span>&#160; </div>
<div class="line"><a name="l09178"></a><span class="lineno"> 9178</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;State == TreeEntry::NeedToGather) {</div>
<div class="line"><a name="l09179"></a><span class="lineno"> 9179</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Idx &gt; 0) {</div>
<div class="line"><a name="l09180"></a><span class="lineno"> 9180</span>&#160;      <span class="comment">// We are in the middle of a vectorizable chain. We need to gather the</span></div>
<div class="line"><a name="l09181"></a><span class="lineno"> 9181</span>&#160;      <span class="comment">// scalars from the users.</span></div>
<div class="line"><a name="l09182"></a><span class="lineno"> 9182</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Vec = createBuildVector(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09183"></a><span class="lineno"> 9183</span>&#160;      <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue = Vec;</div>
<div class="line"><a name="l09184"></a><span class="lineno"> 9184</span>&#160;      <span class="keywordflow">return</span> Vec;</div>
<div class="line"><a name="l09185"></a><span class="lineno"> 9185</span>&#160;    }</div>
<div class="line"><a name="l09186"></a><span class="lineno"> 9186</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getMainOp())</div>
<div class="line"><a name="l09187"></a><span class="lineno"> 9187</span>&#160;      setInsertPointAfterBundle(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09188"></a><span class="lineno"> 9188</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *&gt;</a> GatheredScalars(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars.begin(), <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars.end());</div>
<div class="line"><a name="l09189"></a><span class="lineno"> 9189</span>&#160;    <span class="comment">// Build a mask out of the reorder indices and reorder scalars per this</span></div>
<div class="line"><a name="l09190"></a><span class="lineno"> 9190</span>&#160;    <span class="comment">// mask.</span></div>
<div class="line"><a name="l09191"></a><span class="lineno"> 9191</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> ReorderMask;</div>
<div class="line"><a name="l09192"></a><span class="lineno"> 9192</span>&#160;    <a class="code" href="namespacellvm.html#a6f0917bf2ae18fac81fea6bf7e887115">inversePermutation</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReorderIndices, ReorderMask);</div>
<div class="line"><a name="l09193"></a><span class="lineno"> 9193</span>&#160;    <span class="keywordflow">if</span> (!ReorderMask.empty())</div>
<div class="line"><a name="l09194"></a><span class="lineno"> 9194</span>&#160;      <a class="code" href="namespacellvm.html#a14c12bda1f5a9beed612b00f3f98b888">reorderScalars</a>(GatheredScalars, ReorderMask);</div>
<div class="line"><a name="l09195"></a><span class="lineno"> 9195</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Vec;</div>
<div class="line"><a name="l09196"></a><span class="lineno"> 9196</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>;</div>
<div class="line"><a name="l09197"></a><span class="lineno"> 9197</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const TreeEntry *&gt;</a> Entries;</div>
<div class="line"><a name="l09198"></a><span class="lineno"> 9198</span>&#160;    std::optional&lt;TargetTransformInfo::ShuffleKind&gt; <a class="code" href="namespacellvm.html#a766456df1dd21e804cd4596304e10764ae8b4b40ec3622e371789b790caabc083">Shuffle</a> =</div>
<div class="line"><a name="l09199"></a><span class="lineno"> 9199</span>&#160;        isGatherShuffledEntry(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, GatheredScalars, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, Entries);</div>
<div class="line"><a name="l09200"></a><span class="lineno"> 9200</span>&#160;    <span class="keywordflow">if</span> (Shuffle) {</div>
<div class="line"><a name="l09201"></a><span class="lineno"> 9201</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((Entries.size() == 1 || Entries.size() == 2) &amp;&amp;</div>
<div class="line"><a name="l09202"></a><span class="lineno"> 9202</span>&#160;             <span class="stringliteral">&quot;Expected shuffle of 1 or 2 entries.&quot;</span>);</div>
<div class="line"><a name="l09203"></a><span class="lineno"> 9203</span>&#160;      Vec = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShuffleVector(Entries.front()-&gt;VectorizedValue,</div>
<div class="line"><a name="l09204"></a><span class="lineno"> 9204</span>&#160;                                        Entries.back()-&gt;VectorizedValue, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l09205"></a><span class="lineno"> 9205</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(Vec)) {</div>
<div class="line"><a name="l09206"></a><span class="lineno"> 9206</span>&#160;        GatherShuffleExtractSeq.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l09207"></a><span class="lineno"> 9207</span>&#160;        CSEBlocks.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent());</div>
<div class="line"><a name="l09208"></a><span class="lineno"> 9208</span>&#160;      }</div>
<div class="line"><a name="l09209"></a><span class="lineno"> 9209</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l09210"></a><span class="lineno"> 9210</span>&#160;      Vec = gather(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars);</div>
<div class="line"><a name="l09211"></a><span class="lineno"> 9211</span>&#160;    }</div>
<div class="line"><a name="l09212"></a><span class="lineno"> 9212</span>&#160;    Vec = FinalShuffle(Vec, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09213"></a><span class="lineno"> 9213</span>&#160;    <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue = Vec;</div>
<div class="line"><a name="l09214"></a><span class="lineno"> 9214</span>&#160;    <span class="keywordflow">return</span> Vec;</div>
<div class="line"><a name="l09215"></a><span class="lineno"> 9215</span>&#160;  }</div>
<div class="line"><a name="l09216"></a><span class="lineno"> 9216</span>&#160; </div>
<div class="line"><a name="l09217"></a><span class="lineno"> 9217</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;State == TreeEntry::Vectorize ||</div>
<div class="line"><a name="l09218"></a><span class="lineno"> 9218</span>&#160;          <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;State == TreeEntry::ScatterVectorize) &amp;&amp;</div>
<div class="line"><a name="l09219"></a><span class="lineno"> 9219</span>&#160;         <span class="stringliteral">&quot;Unhandled state&quot;</span>);</div>
<div class="line"><a name="l09220"></a><span class="lineno"> 9220</span>&#160;  <span class="keywordtype">unsigned</span> ShuffleOrOp =</div>
<div class="line"><a name="l09221"></a><span class="lineno"> 9221</span>&#160;      <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;isAltShuffle() ? (<a class="code" href="ADT_2tmp_8txt.html#aa10ee7493bddf2c751ca6e05451ef410">unsigned</a>)Instruction::ShuffleVector : <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode();</div>
<div class="line"><a name="l09222"></a><span class="lineno"> 9222</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *VL0 = <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getMainOp();</div>
<div class="line"><a name="l09223"></a><span class="lineno"> 9223</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *ScalarTy = VL0-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l09224"></a><span class="lineno"> 9224</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Store</a> = dyn_cast&lt;StoreInst&gt;(VL0))</div>
<div class="line"><a name="l09225"></a><span class="lineno"> 9225</span>&#160;    ScalarTy = <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;getValueOperand()-&gt;getType();</div>
<div class="line"><a name="l09226"></a><span class="lineno"> 9226</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a> = dyn_cast&lt;InsertElementInst&gt;(VL0))</div>
<div class="line"><a name="l09227"></a><span class="lineno"> 9227</span>&#160;    ScalarTy = <a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>-&gt;getOperand(1)-&gt;getType();</div>
<div class="line"><a name="l09228"></a><span class="lineno"> 9228</span>&#160;  <span class="keyword">auto</span> *VecTy = <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(ScalarTy, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars.size());</div>
<div class="line"><a name="l09229"></a><span class="lineno"> 9229</span>&#160;  <span class="keywordflow">switch</span> (ShuffleOrOp) {</div>
<div class="line"><a name="l09230"></a><span class="lineno"> 9230</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">Instruction::PHI</a>: {</div>
<div class="line"><a name="l09231"></a><span class="lineno"> 9231</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReorderIndices.empty() ||</div>
<div class="line"><a name="l09232"></a><span class="lineno"> 9232</span>&#160;              <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> != VectorizableTree.front().get() ||</div>
<div class="line"><a name="l09233"></a><span class="lineno"> 9233</span>&#160;              !<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;UserTreeIndices.empty()) &amp;&amp;</div>
<div class="line"><a name="l09234"></a><span class="lineno"> 9234</span>&#160;             <span class="stringliteral">&quot;PHI reordering is free.&quot;</span>);</div>
<div class="line"><a name="l09235"></a><span class="lineno"> 9235</span>&#160;      <span class="keyword">auto</span> *PH = cast&lt;PHINode&gt;(VL0);</div>
<div class="line"><a name="l09236"></a><span class="lineno"> 9236</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(PH-&gt;getParent()-&gt;getFirstNonPHI());</div>
<div class="line"><a name="l09237"></a><span class="lineno"> 9237</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetCurrentDebugLocation(PH-&gt;getDebugLoc());</div>
<div class="line"><a name="l09238"></a><span class="lineno"> 9238</span>&#160;      <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *NewPhi = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePHI(VecTy, PH-&gt;getNumIncomingValues());</div>
<div class="line"><a name="l09239"></a><span class="lineno"> 9239</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V = NewPhi;</div>
<div class="line"><a name="l09240"></a><span class="lineno"> 9240</span>&#160; </div>
<div class="line"><a name="l09241"></a><span class="lineno"> 9241</span>&#160;      <span class="comment">// Adjust insertion point once all PHI&#39;s have been generated.</span></div>
<div class="line"><a name="l09242"></a><span class="lineno"> 9242</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(&amp;*PH-&gt;getParent()-&gt;getFirstInsertionPt());</div>
<div class="line"><a name="l09243"></a><span class="lineno"> 9243</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetCurrentDebugLocation(PH-&gt;getDebugLoc());</div>
<div class="line"><a name="l09244"></a><span class="lineno"> 9244</span>&#160; </div>
<div class="line"><a name="l09245"></a><span class="lineno"> 9245</span>&#160;      V = FinalShuffle(V, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09246"></a><span class="lineno"> 9246</span>&#160; </div>
<div class="line"><a name="l09247"></a><span class="lineno"> 9247</span>&#160;      <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue = V;</div>
<div class="line"><a name="l09248"></a><span class="lineno"> 9248</span>&#160; </div>
<div class="line"><a name="l09249"></a><span class="lineno"> 9249</span>&#160;      <span class="comment">// PHINodes may have multiple entries from the same block. We want to</span></div>
<div class="line"><a name="l09250"></a><span class="lineno"> 9250</span>&#160;      <span class="comment">// visit every block once.</span></div>
<div class="line"><a name="l09251"></a><span class="lineno"> 9251</span>&#160;      <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;BasicBlock*, 4&gt;</a> VisitedBBs;</div>
<div class="line"><a name="l09252"></a><span class="lineno"> 9252</span>&#160; </div>
<div class="line"><a name="l09253"></a><span class="lineno"> 9253</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = PH-&gt;getNumIncomingValues(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l09254"></a><span class="lineno"> 9254</span>&#160;        ValueList <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>;</div>
<div class="line"><a name="l09255"></a><span class="lineno"> 9255</span>&#160;        <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *IBB = PH-&gt;getIncomingBlock(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l09256"></a><span class="lineno"> 9256</span>&#160; </div>
<div class="line"><a name="l09257"></a><span class="lineno"> 9257</span>&#160;        <span class="comment">// Stop emission if all incoming values are generated.</span></div>
<div class="line"><a name="l09258"></a><span class="lineno"> 9258</span>&#160;        <span class="keywordflow">if</span> (NewPhi-&gt;<a class="code" href="classllvm_1_1PHINode.html#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>() == PH-&gt;getNumIncomingValues()) {</div>
<div class="line"><a name="l09259"></a><span class="lineno"> 9259</span>&#160;          <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Diamond merged for &quot;</span> &lt;&lt; *VL0 &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l09260"></a><span class="lineno"> 9260</span>&#160;          <span class="keywordflow">return</span> V;</div>
<div class="line"><a name="l09261"></a><span class="lineno"> 9261</span>&#160;        }</div>
<div class="line"><a name="l09262"></a><span class="lineno"> 9262</span>&#160; </div>
<div class="line"><a name="l09263"></a><span class="lineno"> 9263</span>&#160;        <span class="keywordflow">if</span> (!VisitedBBs.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(IBB).second) {</div>
<div class="line"><a name="l09264"></a><span class="lineno"> 9264</span>&#160;          NewPhi-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(NewPhi-&gt;<a class="code" href="classllvm_1_1PHINode.html#adfb61ffe25c950c75c86310245b3ef39">getIncomingValueForBlock</a>(IBB), IBB);</div>
<div class="line"><a name="l09265"></a><span class="lineno"> 9265</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l09266"></a><span class="lineno"> 9266</span>&#160;        }</div>
<div class="line"><a name="l09267"></a><span class="lineno"> 9267</span>&#160; </div>
<div class="line"><a name="l09268"></a><span class="lineno"> 9268</span>&#160;        <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(IBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>());</div>
<div class="line"><a name="l09269"></a><span class="lineno"> 9269</span>&#160;        <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetCurrentDebugLocation(PH-&gt;getDebugLoc());</div>
<div class="line"><a name="l09270"></a><span class="lineno"> 9270</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *Vec = vectorizeOperand(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l09271"></a><span class="lineno"> 9271</span>&#160;        NewPhi-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(Vec, IBB);</div>
<div class="line"><a name="l09272"></a><span class="lineno"> 9272</span>&#160;      }</div>
<div class="line"><a name="l09273"></a><span class="lineno"> 9273</span>&#160; </div>
<div class="line"><a name="l09274"></a><span class="lineno"> 9274</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewPhi-&gt;<a class="code" href="classllvm_1_1PHINode.html#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>() == PH-&gt;getNumIncomingValues() &amp;&amp;</div>
<div class="line"><a name="l09275"></a><span class="lineno"> 9275</span>&#160;             <span class="stringliteral">&quot;Invalid number of incoming values&quot;</span>);</div>
<div class="line"><a name="l09276"></a><span class="lineno"> 9276</span>&#160;      <span class="keywordflow">return</span> V;</div>
<div class="line"><a name="l09277"></a><span class="lineno"> 9277</span>&#160;    }</div>
<div class="line"><a name="l09278"></a><span class="lineno"> 9278</span>&#160; </div>
<div class="line"><a name="l09279"></a><span class="lineno"> 9279</span>&#160;    <span class="keywordflow">case</span> Instruction::ExtractElement: {</div>
<div class="line"><a name="l09280"></a><span class="lineno"> 9280</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getSingleOperand(0);</div>
<div class="line"><a name="l09281"></a><span class="lineno"> 9281</span>&#160;      setInsertPointAfterBundle(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09282"></a><span class="lineno"> 9282</span>&#160;      V = FinalShuffle(V, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09283"></a><span class="lineno"> 9283</span>&#160;      <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue = V;</div>
<div class="line"><a name="l09284"></a><span class="lineno"> 9284</span>&#160;      <span class="keywordflow">return</span> V;</div>
<div class="line"><a name="l09285"></a><span class="lineno"> 9285</span>&#160;    }</div>
<div class="line"><a name="l09286"></a><span class="lineno"> 9286</span>&#160;    <span class="keywordflow">case</span> Instruction::ExtractValue: {</div>
<div class="line"><a name="l09287"></a><span class="lineno"> 9287</span>&#160;      <span class="keyword">auto</span> *LI = cast&lt;LoadInst&gt;(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getSingleOperand(0));</div>
<div class="line"><a name="l09288"></a><span class="lineno"> 9288</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(LI);</div>
<div class="line"><a name="l09289"></a><span class="lineno"> 9289</span>&#160;      <span class="keyword">auto</span> *PtrTy = <a class="code" href="classllvm_1_1PointerType.html#a050a395d1656e546679d8b144d951bb2">PointerType::get</a>(VecTy, LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#a161c2db145827f4e181e7fe662b53a81">getPointerAddressSpace</a>());</div>
<div class="line"><a name="l09290"></a><span class="lineno"> 9290</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(LI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), PtrTy);</div>
<div class="line"><a name="l09291"></a><span class="lineno"> 9291</span>&#160;      <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAlignedLoad(VecTy, <a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#af51c113a039c82f6870df5dc9666b5e3">getAlign</a>());</div>
<div class="line"><a name="l09292"></a><span class="lineno"> 9292</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *NewV = <a class="code" href="namespacellvm.html#a48a6deb3e714d54e75caadcf84b0ca76">propagateMetadata</a>(V, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars);</div>
<div class="line"><a name="l09293"></a><span class="lineno"> 9293</span>&#160;      NewV = FinalShuffle(NewV, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09294"></a><span class="lineno"> 9294</span>&#160;      <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue = NewV;</div>
<div class="line"><a name="l09295"></a><span class="lineno"> 9295</span>&#160;      <span class="keywordflow">return</span> NewV;</div>
<div class="line"><a name="l09296"></a><span class="lineno"> 9296</span>&#160;    }</div>
<div class="line"><a name="l09297"></a><span class="lineno"> 9297</span>&#160;    <span class="keywordflow">case</span> Instruction::InsertElement: {</div>
<div class="line"><a name="l09298"></a><span class="lineno"> 9298</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReuseShuffleIndices.empty() &amp;&amp; <span class="stringliteral">&quot;All inserts should be unique&quot;</span>);</div>
<div class="line"><a name="l09299"></a><span class="lineno"> 9299</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(cast&lt;Instruction&gt;(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars.back()));</div>
<div class="line"><a name="l09300"></a><span class="lineno"> 9300</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V = vectorizeOperand(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, 1);</div>
<div class="line"><a name="l09301"></a><span class="lineno"> 9301</span>&#160; </div>
<div class="line"><a name="l09302"></a><span class="lineno"> 9302</span>&#160;      <span class="comment">// Create InsertVector shuffle if necessary</span></div>
<div class="line"><a name="l09303"></a><span class="lineno"> 9303</span>&#160;      <span class="keyword">auto</span> *FirstInsert = cast&lt;Instruction&gt;(*<a class="code" href="namespacellvm.html#ac78c09ae232b2ce188ff590d51e3c268">find_if</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars, [<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l09304"></a><span class="lineno"> 9304</span>&#160;        return !is_contained(E-&gt;Scalars, cast&lt;Instruction&gt;(V)-&gt;getOperand(0));</div>
<div class="line"><a name="l09305"></a><span class="lineno"> 9305</span>&#160;      }));</div>
<div class="line"><a name="l09306"></a><span class="lineno"> 9306</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> NumElts =</div>
<div class="line"><a name="l09307"></a><span class="lineno"> 9307</span>&#160;          cast&lt;FixedVectorType&gt;(FirstInsert-&gt;getType())-&gt;getNumElements();</div>
<div class="line"><a name="l09308"></a><span class="lineno"> 9308</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">unsigned</span> NumScalars = <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars.size();</div>
<div class="line"><a name="l09309"></a><span class="lineno"> 9309</span>&#160; </div>
<div class="line"><a name="l09310"></a><span class="lineno"> 9310</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1AMDGPU_1_1Hwreg.html#a6110fc30bc7311a6cf99814530362e21">Offset</a> = *<a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(VL0);</div>
<div class="line"><a name="l09311"></a><span class="lineno"> 9311</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Offset &lt; NumElts &amp;&amp; <span class="stringliteral">&quot;Failed to find vector index offset&quot;</span>);</div>
<div class="line"><a name="l09312"></a><span class="lineno"> 9312</span>&#160; </div>
<div class="line"><a name="l09313"></a><span class="lineno"> 9313</span>&#160;      <span class="comment">// Create shuffle to resize vector</span></div>
<div class="line"><a name="l09314"></a><span class="lineno"> 9314</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>;</div>
<div class="line"><a name="l09315"></a><span class="lineno"> 9315</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReorderIndices.empty()) {</div>
<div class="line"><a name="l09316"></a><span class="lineno"> 9316</span>&#160;        <a class="code" href="namespacellvm.html#a6f0917bf2ae18fac81fea6bf7e887115">inversePermutation</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReorderIndices, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l09317"></a><span class="lineno"> 9317</span>&#160;        <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.append(NumElts - NumScalars, <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l09318"></a><span class="lineno"> 9318</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l09319"></a><span class="lineno"> 9319</span>&#160;        <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.assign(NumElts, <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l09320"></a><span class="lineno"> 9320</span>&#160;        std::iota(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.begin(), std::next(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.begin(), NumScalars), 0);</div>
<div class="line"><a name="l09321"></a><span class="lineno"> 9321</span>&#160;      }</div>
<div class="line"><a name="l09322"></a><span class="lineno"> 9322</span>&#160;      <span class="comment">// Create InsertVector shuffle if necessary</span></div>
<div class="line"><a name="l09323"></a><span class="lineno"> 9323</span>&#160;      <span class="keywordtype">bool</span> IsIdentity = <span class="keyword">true</span>;</div>
<div class="line"><a name="l09324"></a><span class="lineno"> 9324</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> PrevMask(NumElts, <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l09325"></a><span class="lineno"> 9325</span>&#160;      <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.swap(PrevMask);</div>
<div class="line"><a name="l09326"></a><span class="lineno"> 9326</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumScalars; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l09327"></a><span class="lineno"> 9327</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a> = <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars[PrevMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]];</div>
<div class="line"><a name="l09328"></a><span class="lineno"> 9328</span>&#160;        <span class="keywordtype">unsigned</span> InsertIdx = *<a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(Scalar);</div>
<div class="line"><a name="l09329"></a><span class="lineno"> 9329</span>&#160;        IsIdentity &amp;= InsertIdx - <a class="code" href="namespacellvm_1_1AMDGPU_1_1Hwreg.html#a6110fc30bc7311a6cf99814530362e21">Offset</a> == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l09330"></a><span class="lineno"> 9330</span>&#160;        <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[InsertIdx - <a class="code" href="namespacellvm_1_1AMDGPU_1_1Hwreg.html#a6110fc30bc7311a6cf99814530362e21">Offset</a>] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l09331"></a><span class="lineno"> 9331</span>&#160;      }</div>
<div class="line"><a name="l09332"></a><span class="lineno"> 9332</span>&#160;      <span class="keywordflow">if</span> (!IsIdentity || NumElts != NumScalars) {</div>
<div class="line"><a name="l09333"></a><span class="lineno"> 9333</span>&#160;        V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShuffleVector(V, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l09334"></a><span class="lineno"> 9334</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V)) {</div>
<div class="line"><a name="l09335"></a><span class="lineno"> 9335</span>&#160;          GatherShuffleExtractSeq.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l09336"></a><span class="lineno"> 9336</span>&#160;          CSEBlocks.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent());</div>
<div class="line"><a name="l09337"></a><span class="lineno"> 9337</span>&#160;        }</div>
<div class="line"><a name="l09338"></a><span class="lineno"> 9338</span>&#160;      }</div>
<div class="line"><a name="l09339"></a><span class="lineno"> 9339</span>&#160; </div>
<div class="line"><a name="l09340"></a><span class="lineno"> 9340</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> InsertMask(NumElts, <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l09341"></a><span class="lineno"> 9341</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumElts; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) {</div>
<div class="line"><a name="l09342"></a><span class="lineno"> 9342</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] != <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l09343"></a><span class="lineno"> 9343</span>&#160;          InsertMask[<a class="code" href="namespacellvm_1_1AMDGPU_1_1Hwreg.html#a6110fc30bc7311a6cf99814530362e21">Offset</a> + <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l09344"></a><span class="lineno"> 9344</span>&#160;      }</div>
<div class="line"><a name="l09345"></a><span class="lineno"> 9345</span>&#160;      <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> UseMask =</div>
<div class="line"><a name="l09346"></a><span class="lineno"> 9346</span>&#160;          <a class="code" href="SLPVectorizer_8cpp.html#a2fd40bb67aec98438b791520159fb146">buildUseMask</a>(NumElts, InsertMask, UseMask::UndefsAsMask);</div>
<div class="line"><a name="l09347"></a><span class="lineno"> 9347</span>&#160;      <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> IsFirstUndef =</div>
<div class="line"><a name="l09348"></a><span class="lineno"> 9348</span>&#160;          <a class="code" href="SLPVectorizer_8cpp.html#ac396bb87eb4db1dd3ce315e4d91ee2de">isUndefVector</a>(FirstInsert-&gt;getOperand(0), UseMask);</div>
<div class="line"><a name="l09349"></a><span class="lineno"> 9349</span>&#160;      <span class="keywordflow">if</span> ((!IsIdentity || Offset != 0 || !IsFirstUndef.<a class="code" href="classllvm_1_1SmallBitVector.html#a8cfcd92a373cdd7deefb939dd76b83e3">all</a>()) &amp;&amp;</div>
<div class="line"><a name="l09350"></a><span class="lineno"> 9350</span>&#160;          NumElts != NumScalars) {</div>
<div class="line"><a name="l09351"></a><span class="lineno"> 9351</span>&#160;        <span class="keywordflow">if</span> (IsFirstUndef.<a class="code" href="classllvm_1_1SmallBitVector.html#a8cfcd92a373cdd7deefb939dd76b83e3">all</a>()) {</div>
<div class="line"><a name="l09352"></a><span class="lineno"> 9352</span>&#160;          <span class="keywordflow">if</span> (!<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a4bc8953b0fd0277b0e5a8e5b78025150">ShuffleVectorInst::isIdentityMask</a>(InsertMask)) {</div>
<div class="line"><a name="l09353"></a><span class="lineno"> 9353</span>&#160;          <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> IsFirstPoison =</div>
<div class="line"><a name="l09354"></a><span class="lineno"> 9354</span>&#160;              isUndefVector&lt;true&gt;(FirstInsert-&gt;getOperand(0), UseMask);</div>
<div class="line"><a name="l09355"></a><span class="lineno"> 9355</span>&#160;          <span class="keywordflow">if</span> (!IsFirstPoison.<a class="code" href="classllvm_1_1SmallBitVector.html#a8cfcd92a373cdd7deefb939dd76b83e3">all</a>()) {</div>
<div class="line"><a name="l09356"></a><span class="lineno"> 9356</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumElts; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) {</div>
<div class="line"><a name="l09357"></a><span class="lineno"> 9357</span>&#160;              <span class="keywordflow">if</span> (InsertMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a> &amp;&amp; !IsFirstPoison.<a class="code" href="classllvm_1_1SmallBitVector.html#a585f149dd8c344a40c53b1694d3161ed">test</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l09358"></a><span class="lineno"> 9358</span>&#160;                InsertMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> + NumElts;</div>
<div class="line"><a name="l09359"></a><span class="lineno"> 9359</span>&#160;            }</div>
<div class="line"><a name="l09360"></a><span class="lineno"> 9360</span>&#160;            }</div>
<div class="line"><a name="l09361"></a><span class="lineno"> 9361</span>&#160;            V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShuffleVector(</div>
<div class="line"><a name="l09362"></a><span class="lineno"> 9362</span>&#160;                V,</div>
<div class="line"><a name="l09363"></a><span class="lineno"> 9363</span>&#160;                IsFirstPoison.<a class="code" href="classllvm_1_1SmallBitVector.html#a8cfcd92a373cdd7deefb939dd76b83e3">all</a>() ? <a class="code" href="classllvm_1_1PoisonValue.html#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())</div>
<div class="line"><a name="l09364"></a><span class="lineno"> 9364</span>&#160;                                    : FirstInsert-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0),</div>
<div class="line"><a name="l09365"></a><span class="lineno"> 9365</span>&#160;                InsertMask, cast&lt;Instruction&gt;(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars.back())-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>());</div>
<div class="line"><a name="l09366"></a><span class="lineno"> 9366</span>&#160;            <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V)) {</div>
<div class="line"><a name="l09367"></a><span class="lineno"> 9367</span>&#160;              GatherShuffleExtractSeq.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l09368"></a><span class="lineno"> 9368</span>&#160;              CSEBlocks.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent());</div>
<div class="line"><a name="l09369"></a><span class="lineno"> 9369</span>&#160;            }</div>
<div class="line"><a name="l09370"></a><span class="lineno"> 9370</span>&#160;          }</div>
<div class="line"><a name="l09371"></a><span class="lineno"> 9371</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l09372"></a><span class="lineno"> 9372</span>&#160;          <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> IsFirstPoison =</div>
<div class="line"><a name="l09373"></a><span class="lineno"> 9373</span>&#160;              isUndefVector&lt;true&gt;(FirstInsert-&gt;getOperand(0), UseMask);</div>
<div class="line"><a name="l09374"></a><span class="lineno"> 9374</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumElts; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) {</div>
<div class="line"><a name="l09375"></a><span class="lineno"> 9375</span>&#160;            <span class="keywordflow">if</span> (InsertMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l09376"></a><span class="lineno"> 9376</span>&#160;              InsertMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = IsFirstPoison.<a class="code" href="classllvm_1_1SmallBitVector.html#a585f149dd8c344a40c53b1694d3161ed">test</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ? <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a> : <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l09377"></a><span class="lineno"> 9377</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l09378"></a><span class="lineno"> 9378</span>&#160;              InsertMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] += NumElts;</div>
<div class="line"><a name="l09379"></a><span class="lineno"> 9379</span>&#160;          }</div>
<div class="line"><a name="l09380"></a><span class="lineno"> 9380</span>&#160;          V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShuffleVector(</div>
<div class="line"><a name="l09381"></a><span class="lineno"> 9381</span>&#160;              FirstInsert-&gt;getOperand(0), V, InsertMask,</div>
<div class="line"><a name="l09382"></a><span class="lineno"> 9382</span>&#160;              cast&lt;Instruction&gt;(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars.back())-&gt;getName());</div>
<div class="line"><a name="l09383"></a><span class="lineno"> 9383</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V)) {</div>
<div class="line"><a name="l09384"></a><span class="lineno"> 9384</span>&#160;            GatherShuffleExtractSeq.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l09385"></a><span class="lineno"> 9385</span>&#160;            CSEBlocks.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent());</div>
<div class="line"><a name="l09386"></a><span class="lineno"> 9386</span>&#160;          }</div>
<div class="line"><a name="l09387"></a><span class="lineno"> 9387</span>&#160;        }</div>
<div class="line"><a name="l09388"></a><span class="lineno"> 9388</span>&#160;      }</div>
<div class="line"><a name="l09389"></a><span class="lineno"> 9389</span>&#160; </div>
<div class="line"><a name="l09390"></a><span class="lineno"> 9390</span>&#160;      ++NumVectorInstructions;</div>
<div class="line"><a name="l09391"></a><span class="lineno"> 9391</span>&#160;      <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue = V;</div>
<div class="line"><a name="l09392"></a><span class="lineno"> 9392</span>&#160;      <span class="keywordflow">return</span> V;</div>
<div class="line"><a name="l09393"></a><span class="lineno"> 9393</span>&#160;    }</div>
<div class="line"><a name="l09394"></a><span class="lineno"> 9394</span>&#160;    <span class="keywordflow">case</span> Instruction::ZExt:</div>
<div class="line"><a name="l09395"></a><span class="lineno"> 9395</span>&#160;    <span class="keywordflow">case</span> Instruction::SExt:</div>
<div class="line"><a name="l09396"></a><span class="lineno"> 9396</span>&#160;    <span class="keywordflow">case</span> Instruction::FPToUI:</div>
<div class="line"><a name="l09397"></a><span class="lineno"> 9397</span>&#160;    <span class="keywordflow">case</span> Instruction::FPToSI:</div>
<div class="line"><a name="l09398"></a><span class="lineno"> 9398</span>&#160;    <span class="keywordflow">case</span> Instruction::FPExt:</div>
<div class="line"><a name="l09399"></a><span class="lineno"> 9399</span>&#160;    <span class="keywordflow">case</span> Instruction::PtrToInt:</div>
<div class="line"><a name="l09400"></a><span class="lineno"> 9400</span>&#160;    <span class="keywordflow">case</span> Instruction::IntToPtr:</div>
<div class="line"><a name="l09401"></a><span class="lineno"> 9401</span>&#160;    <span class="keywordflow">case</span> Instruction::SIToFP:</div>
<div class="line"><a name="l09402"></a><span class="lineno"> 9402</span>&#160;    <span class="keywordflow">case</span> Instruction::UIToFP:</div>
<div class="line"><a name="l09403"></a><span class="lineno"> 9403</span>&#160;    <span class="keywordflow">case</span> Instruction::Trunc:</div>
<div class="line"><a name="l09404"></a><span class="lineno"> 9404</span>&#160;    <span class="keywordflow">case</span> Instruction::FPTrunc:</div>
<div class="line"><a name="l09405"></a><span class="lineno"> 9405</span>&#160;    <span class="keywordflow">case</span> Instruction::BitCast: {</div>
<div class="line"><a name="l09406"></a><span class="lineno"> 9406</span>&#160;      setInsertPointAfterBundle(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09407"></a><span class="lineno"> 9407</span>&#160; </div>
<div class="line"><a name="l09408"></a><span class="lineno"> 9408</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *InVec = vectorizeOperand(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, 0);</div>
<div class="line"><a name="l09409"></a><span class="lineno"> 9409</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue) {</div>
<div class="line"><a name="l09410"></a><span class="lineno"> 9410</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Diamond merged for &quot;</span> &lt;&lt; *VL0 &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l09411"></a><span class="lineno"> 9411</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue;</div>
<div class="line"><a name="l09412"></a><span class="lineno"> 9412</span>&#160;      }</div>
<div class="line"><a name="l09413"></a><span class="lineno"> 9413</span>&#160; </div>
<div class="line"><a name="l09414"></a><span class="lineno"> 9414</span>&#160;      <span class="keyword">auto</span> *CI = cast&lt;CastInst&gt;(VL0);</div>
<div class="line"><a name="l09415"></a><span class="lineno"> 9415</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCast(CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>(), InVec, VecTy);</div>
<div class="line"><a name="l09416"></a><span class="lineno"> 9416</span>&#160;      V = FinalShuffle(V, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09417"></a><span class="lineno"> 9417</span>&#160; </div>
<div class="line"><a name="l09418"></a><span class="lineno"> 9418</span>&#160;      <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue = V;</div>
<div class="line"><a name="l09419"></a><span class="lineno"> 9419</span>&#160;      ++NumVectorInstructions;</div>
<div class="line"><a name="l09420"></a><span class="lineno"> 9420</span>&#160;      <span class="keywordflow">return</span> V;</div>
<div class="line"><a name="l09421"></a><span class="lineno"> 9421</span>&#160;    }</div>
<div class="line"><a name="l09422"></a><span class="lineno"> 9422</span>&#160;    <span class="keywordflow">case</span> Instruction::FCmp:</div>
<div class="line"><a name="l09423"></a><span class="lineno"> 9423</span>&#160;    <span class="keywordflow">case</span> Instruction::ICmp: {</div>
<div class="line"><a name="l09424"></a><span class="lineno"> 9424</span>&#160;      setInsertPointAfterBundle(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09425"></a><span class="lineno"> 9425</span>&#160; </div>
<div class="line"><a name="l09426"></a><span class="lineno"> 9426</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *L = vectorizeOperand(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, 0);</div>
<div class="line"><a name="l09427"></a><span class="lineno"> 9427</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue) {</div>
<div class="line"><a name="l09428"></a><span class="lineno"> 9428</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Diamond merged for &quot;</span> &lt;&lt; *VL0 &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l09429"></a><span class="lineno"> 9429</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue;</div>
<div class="line"><a name="l09430"></a><span class="lineno"> 9430</span>&#160;      }</div>
<div class="line"><a name="l09431"></a><span class="lineno"> 9431</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a> = vectorizeOperand(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, 1);</div>
<div class="line"><a name="l09432"></a><span class="lineno"> 9432</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue) {</div>
<div class="line"><a name="l09433"></a><span class="lineno"> 9433</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Diamond merged for &quot;</span> &lt;&lt; *VL0 &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l09434"></a><span class="lineno"> 9434</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue;</div>
<div class="line"><a name="l09435"></a><span class="lineno"> 9435</span>&#160;      }</div>
<div class="line"><a name="l09436"></a><span class="lineno"> 9436</span>&#160; </div>
<div class="line"><a name="l09437"></a><span class="lineno"> 9437</span>&#160;      <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> P0 = cast&lt;CmpInst&gt;(VL0)-&gt;getPredicate();</div>
<div class="line"><a name="l09438"></a><span class="lineno"> 9438</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCmp(P0, L, R);</div>
<div class="line"><a name="l09439"></a><span class="lineno"> 9439</span>&#160;      <a class="code" href="namespacellvm.html#a9451ae71f535d06cd1d8ae642d76fc0d">propagateIRFlags</a>(V, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars, VL0);</div>
<div class="line"><a name="l09440"></a><span class="lineno"> 9440</span>&#160;      V = FinalShuffle(V, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09441"></a><span class="lineno"> 9441</span>&#160; </div>
<div class="line"><a name="l09442"></a><span class="lineno"> 9442</span>&#160;      <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue = V;</div>
<div class="line"><a name="l09443"></a><span class="lineno"> 9443</span>&#160;      ++NumVectorInstructions;</div>
<div class="line"><a name="l09444"></a><span class="lineno"> 9444</span>&#160;      <span class="keywordflow">return</span> V;</div>
<div class="line"><a name="l09445"></a><span class="lineno"> 9445</span>&#160;    }</div>
<div class="line"><a name="l09446"></a><span class="lineno"> 9446</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Instruction::Select</a>: {</div>
<div class="line"><a name="l09447"></a><span class="lineno"> 9447</span>&#160;      setInsertPointAfterBundle(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09448"></a><span class="lineno"> 9448</span>&#160; </div>
<div class="line"><a name="l09449"></a><span class="lineno"> 9449</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a> = vectorizeOperand(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, 0);</div>
<div class="line"><a name="l09450"></a><span class="lineno"> 9450</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue) {</div>
<div class="line"><a name="l09451"></a><span class="lineno"> 9451</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Diamond merged for &quot;</span> &lt;&lt; *VL0 &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l09452"></a><span class="lineno"> 9452</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue;</div>
<div class="line"><a name="l09453"></a><span class="lineno"> 9453</span>&#160;      }</div>
<div class="line"><a name="l09454"></a><span class="lineno"> 9454</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *True = vectorizeOperand(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, 1);</div>
<div class="line"><a name="l09455"></a><span class="lineno"> 9455</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue) {</div>
<div class="line"><a name="l09456"></a><span class="lineno"> 9456</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Diamond merged for &quot;</span> &lt;&lt; *VL0 &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l09457"></a><span class="lineno"> 9457</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue;</div>
<div class="line"><a name="l09458"></a><span class="lineno"> 9458</span>&#160;      }</div>
<div class="line"><a name="l09459"></a><span class="lineno"> 9459</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *False = vectorizeOperand(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, 2);</div>
<div class="line"><a name="l09460"></a><span class="lineno"> 9460</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue) {</div>
<div class="line"><a name="l09461"></a><span class="lineno"> 9461</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Diamond merged for &quot;</span> &lt;&lt; *VL0 &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l09462"></a><span class="lineno"> 9462</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue;</div>
<div class="line"><a name="l09463"></a><span class="lineno"> 9463</span>&#160;      }</div>
<div class="line"><a name="l09464"></a><span class="lineno"> 9464</span>&#160; </div>
<div class="line"><a name="l09465"></a><span class="lineno"> 9465</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSelect(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>, True, False);</div>
<div class="line"><a name="l09466"></a><span class="lineno"> 9466</span>&#160;      V = FinalShuffle(V, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09467"></a><span class="lineno"> 9467</span>&#160; </div>
<div class="line"><a name="l09468"></a><span class="lineno"> 9468</span>&#160;      <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue = V;</div>
<div class="line"><a name="l09469"></a><span class="lineno"> 9469</span>&#160;      ++NumVectorInstructions;</div>
<div class="line"><a name="l09470"></a><span class="lineno"> 9470</span>&#160;      <span class="keywordflow">return</span> V;</div>
<div class="line"><a name="l09471"></a><span class="lineno"> 9471</span>&#160;    }</div>
<div class="line"><a name="l09472"></a><span class="lineno"> 9472</span>&#160;    <span class="keywordflow">case</span> Instruction::FNeg: {</div>
<div class="line"><a name="l09473"></a><span class="lineno"> 9473</span>&#160;      setInsertPointAfterBundle(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09474"></a><span class="lineno"> 9474</span>&#160; </div>
<div class="line"><a name="l09475"></a><span class="lineno"> 9475</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = vectorizeOperand(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, 0);</div>
<div class="line"><a name="l09476"></a><span class="lineno"> 9476</span>&#160; </div>
<div class="line"><a name="l09477"></a><span class="lineno"> 9477</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue) {</div>
<div class="line"><a name="l09478"></a><span class="lineno"> 9478</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Diamond merged for &quot;</span> &lt;&lt; *VL0 &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l09479"></a><span class="lineno"> 9479</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue;</div>
<div class="line"><a name="l09480"></a><span class="lineno"> 9480</span>&#160;      }</div>
<div class="line"><a name="l09481"></a><span class="lineno"> 9481</span>&#160; </div>
<div class="line"><a name="l09482"></a><span class="lineno"> 9482</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateUnOp(</div>
<div class="line"><a name="l09483"></a><span class="lineno"> 9483</span>&#160;          <span class="keyword">static_cast&lt;</span><a class="code" href="classllvm_1_1Instruction.html#af9f57a32b08304fea642871735717f24">Instruction::UnaryOps</a><span class="keyword">&gt;</span>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode()), <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>);</div>
<div class="line"><a name="l09484"></a><span class="lineno"> 9484</span>&#160;      <a class="code" href="namespacellvm.html#a9451ae71f535d06cd1d8ae642d76fc0d">propagateIRFlags</a>(V, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars, VL0);</div>
<div class="line"><a name="l09485"></a><span class="lineno"> 9485</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V))</div>
<div class="line"><a name="l09486"></a><span class="lineno"> 9486</span>&#160;        V = <a class="code" href="namespacellvm.html#a48a6deb3e714d54e75caadcf84b0ca76">propagateMetadata</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars);</div>
<div class="line"><a name="l09487"></a><span class="lineno"> 9487</span>&#160; </div>
<div class="line"><a name="l09488"></a><span class="lineno"> 9488</span>&#160;      V = FinalShuffle(V, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09489"></a><span class="lineno"> 9489</span>&#160; </div>
<div class="line"><a name="l09490"></a><span class="lineno"> 9490</span>&#160;      <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue = V;</div>
<div class="line"><a name="l09491"></a><span class="lineno"> 9491</span>&#160;      ++NumVectorInstructions;</div>
<div class="line"><a name="l09492"></a><span class="lineno"> 9492</span>&#160; </div>
<div class="line"><a name="l09493"></a><span class="lineno"> 9493</span>&#160;      <span class="keywordflow">return</span> V;</div>
<div class="line"><a name="l09494"></a><span class="lineno"> 9494</span>&#160;    }</div>
<div class="line"><a name="l09495"></a><span class="lineno"> 9495</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec">Instruction::Add</a>:</div>
<div class="line"><a name="l09496"></a><span class="lineno"> 9496</span>&#160;    <span class="keywordflow">case</span> Instruction::FAdd:</div>
<div class="line"><a name="l09497"></a><span class="lineno"> 9497</span>&#160;    <span class="keywordflow">case</span> Instruction::Sub:</div>
<div class="line"><a name="l09498"></a><span class="lineno"> 9498</span>&#160;    <span class="keywordflow">case</span> Instruction::FSub:</div>
<div class="line"><a name="l09499"></a><span class="lineno"> 9499</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="X86PartialReduction_8cpp.html#ae0f503db91504a3f3440ab81260e4134">Instruction::Mul</a>:</div>
<div class="line"><a name="l09500"></a><span class="lineno"> 9500</span>&#160;    <span class="keywordflow">case</span> Instruction::FMul:</div>
<div class="line"><a name="l09501"></a><span class="lineno"> 9501</span>&#160;    <span class="keywordflow">case</span> Instruction::UDiv:</div>
<div class="line"><a name="l09502"></a><span class="lineno"> 9502</span>&#160;    <span class="keywordflow">case</span> Instruction::SDiv:</div>
<div class="line"><a name="l09503"></a><span class="lineno"> 9503</span>&#160;    <span class="keywordflow">case</span> Instruction::FDiv:</div>
<div class="line"><a name="l09504"></a><span class="lineno"> 9504</span>&#160;    <span class="keywordflow">case</span> Instruction::URem:</div>
<div class="line"><a name="l09505"></a><span class="lineno"> 9505</span>&#160;    <span class="keywordflow">case</span> Instruction::SRem:</div>
<div class="line"><a name="l09506"></a><span class="lineno"> 9506</span>&#160;    <span class="keywordflow">case</span> Instruction::FRem:</div>
<div class="line"><a name="l09507"></a><span class="lineno"> 9507</span>&#160;    <span class="keywordflow">case</span> Instruction::Shl:</div>
<div class="line"><a name="l09508"></a><span class="lineno"> 9508</span>&#160;    <span class="keywordflow">case</span> Instruction::LShr:</div>
<div class="line"><a name="l09509"></a><span class="lineno"> 9509</span>&#160;    <span class="keywordflow">case</span> Instruction::AShr:</div>
<div class="line"><a name="l09510"></a><span class="lineno"> 9510</span>&#160;    <span class="keywordflow">case</span> Instruction::And:</div>
<div class="line"><a name="l09511"></a><span class="lineno"> 9511</span>&#160;    <span class="keywordflow">case</span> Instruction::Or:</div>
<div class="line"><a name="l09512"></a><span class="lineno"> 9512</span>&#160;    <span class="keywordflow">case</span> Instruction::Xor: {</div>
<div class="line"><a name="l09513"></a><span class="lineno"> 9513</span>&#160;      setInsertPointAfterBundle(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09514"></a><span class="lineno"> 9514</span>&#160; </div>
<div class="line"><a name="l09515"></a><span class="lineno"> 9515</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = vectorizeOperand(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, 0);</div>
<div class="line"><a name="l09516"></a><span class="lineno"> 9516</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue) {</div>
<div class="line"><a name="l09517"></a><span class="lineno"> 9517</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Diamond merged for &quot;</span> &lt;&lt; *VL0 &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l09518"></a><span class="lineno"> 9518</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue;</div>
<div class="line"><a name="l09519"></a><span class="lineno"> 9519</span>&#160;      }</div>
<div class="line"><a name="l09520"></a><span class="lineno"> 9520</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = vectorizeOperand(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, 1);</div>
<div class="line"><a name="l09521"></a><span class="lineno"> 9521</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue) {</div>
<div class="line"><a name="l09522"></a><span class="lineno"> 9522</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Diamond merged for &quot;</span> &lt;&lt; *VL0 &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l09523"></a><span class="lineno"> 9523</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue;</div>
<div class="line"><a name="l09524"></a><span class="lineno"> 9524</span>&#160;      }</div>
<div class="line"><a name="l09525"></a><span class="lineno"> 9525</span>&#160; </div>
<div class="line"><a name="l09526"></a><span class="lineno"> 9526</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBinOp(</div>
<div class="line"><a name="l09527"></a><span class="lineno"> 9527</span>&#160;          <span class="keyword">static_cast&lt;</span><a class="code" href="classllvm_1_1Instruction.html#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a><span class="keyword">&gt;</span>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode()), <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>,</div>
<div class="line"><a name="l09528"></a><span class="lineno"> 9528</span>&#160;          <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</div>
<div class="line"><a name="l09529"></a><span class="lineno"> 9529</span>&#160;      <a class="code" href="namespacellvm.html#a9451ae71f535d06cd1d8ae642d76fc0d">propagateIRFlags</a>(V, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars, VL0);</div>
<div class="line"><a name="l09530"></a><span class="lineno"> 9530</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V))</div>
<div class="line"><a name="l09531"></a><span class="lineno"> 9531</span>&#160;        V = <a class="code" href="namespacellvm.html#a48a6deb3e714d54e75caadcf84b0ca76">propagateMetadata</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars);</div>
<div class="line"><a name="l09532"></a><span class="lineno"> 9532</span>&#160; </div>
<div class="line"><a name="l09533"></a><span class="lineno"> 9533</span>&#160;      V = FinalShuffle(V, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09534"></a><span class="lineno"> 9534</span>&#160; </div>
<div class="line"><a name="l09535"></a><span class="lineno"> 9535</span>&#160;      <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue = V;</div>
<div class="line"><a name="l09536"></a><span class="lineno"> 9536</span>&#160;      ++NumVectorInstructions;</div>
<div class="line"><a name="l09537"></a><span class="lineno"> 9537</span>&#160; </div>
<div class="line"><a name="l09538"></a><span class="lineno"> 9538</span>&#160;      <span class="keywordflow">return</span> V;</div>
<div class="line"><a name="l09539"></a><span class="lineno"> 9539</span>&#160;    }</div>
<div class="line"><a name="l09540"></a><span class="lineno"> 9540</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Instruction::Load</a>: {</div>
<div class="line"><a name="l09541"></a><span class="lineno"> 9541</span>&#160;      <span class="comment">// Loads are inserted at the head of the tree because we don&#39;t want to</span></div>
<div class="line"><a name="l09542"></a><span class="lineno"> 9542</span>&#160;      <span class="comment">// sink them all the way down past store instructions.</span></div>
<div class="line"><a name="l09543"></a><span class="lineno"> 9543</span>&#160;      setInsertPointAfterBundle(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09544"></a><span class="lineno"> 9544</span>&#160; </div>
<div class="line"><a name="l09545"></a><span class="lineno"> 9545</span>&#160;      <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = cast&lt;LoadInst&gt;(VL0);</div>
<div class="line"><a name="l09546"></a><span class="lineno"> 9546</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NewLI;</div>
<div class="line"><a name="l09547"></a><span class="lineno"> 9547</span>&#160;      <span class="keywordtype">unsigned</span> AS = LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#a161c2db145827f4e181e7fe662b53a81">getPointerAddressSpace</a>();</div>
<div class="line"><a name="l09548"></a><span class="lineno"> 9548</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *PO = LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad47eefa1d094f60494b6b927061ca001">getPointerOperand</a>();</div>
<div class="line"><a name="l09549"></a><span class="lineno"> 9549</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;State == TreeEntry::Vectorize) {</div>
<div class="line"><a name="l09550"></a><span class="lineno"> 9550</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *VecPtr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(PO, VecTy-&gt;<a class="code" href="classllvm_1_1Type.html#adc01a7457de85fc52a3bb860d7e1c6a4">getPointerTo</a>(AS));</div>
<div class="line"><a name="l09551"></a><span class="lineno"> 9551</span>&#160;        NewLI = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAlignedLoad(VecTy, VecPtr, LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#af51c113a039c82f6870df5dc9666b5e3">getAlign</a>());</div>
<div class="line"><a name="l09552"></a><span class="lineno"> 9552</span>&#160; </div>
<div class="line"><a name="l09553"></a><span class="lineno"> 9553</span>&#160;        <span class="comment">// The pointer operand uses an in-tree scalar so we add the new BitCast</span></div>
<div class="line"><a name="l09554"></a><span class="lineno"> 9554</span>&#160;        <span class="comment">// or LoadInst to ExternalUses list to make sure that an extract will</span></div>
<div class="line"><a name="l09555"></a><span class="lineno"> 9555</span>&#160;        <span class="comment">// be generated in the future.</span></div>
<div class="line"><a name="l09556"></a><span class="lineno"> 9556</span>&#160;        <span class="keywordflow">if</span> (TreeEntry *Entry = getTreeEntry(PO)) {</div>
<div class="line"><a name="l09557"></a><span class="lineno"> 9557</span>&#160;          <span class="comment">// Find which lane we need to extract.</span></div>
<div class="line"><a name="l09558"></a><span class="lineno"> 9558</span>&#160;          <span class="keywordtype">unsigned</span> FoundLane = Entry-&gt;findLaneForValue(PO);</div>
<div class="line"><a name="l09559"></a><span class="lineno"> 9559</span>&#160;          ExternalUses.emplace_back(</div>
<div class="line"><a name="l09560"></a><span class="lineno"> 9560</span>&#160;              PO, PO != VecPtr ? cast&lt;User&gt;(VecPtr) : NewLI, FoundLane);</div>
<div class="line"><a name="l09561"></a><span class="lineno"> 9561</span>&#160;        }</div>
<div class="line"><a name="l09562"></a><span class="lineno"> 9562</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l09563"></a><span class="lineno"> 9563</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;State == TreeEntry::ScatterVectorize &amp;&amp; <span class="stringliteral">&quot;Unhandled state&quot;</span>);</div>
<div class="line"><a name="l09564"></a><span class="lineno"> 9564</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *VecPtr = vectorizeOperand(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, 0);</div>
<div class="line"><a name="l09565"></a><span class="lineno"> 9565</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue) {</div>
<div class="line"><a name="l09566"></a><span class="lineno"> 9566</span>&#160;          <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Diamond merged for &quot;</span> &lt;&lt; *VL0 &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l09567"></a><span class="lineno"> 9567</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue;</div>
<div class="line"><a name="l09568"></a><span class="lineno"> 9568</span>&#160;        }</div>
<div class="line"><a name="l09569"></a><span class="lineno"> 9569</span>&#160;        <span class="comment">// Use the minimum alignment of the gathered loads.</span></div>
<div class="line"><a name="l09570"></a><span class="lineno"> 9570</span>&#160;        <a class="code" href="structllvm_1_1Align.html">Align</a> CommonAlignment = LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#af51c113a039c82f6870df5dc9666b5e3">getAlign</a>();</div>
<div class="line"><a name="l09571"></a><span class="lineno"> 9571</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars)</div>
<div class="line"><a name="l09572"></a><span class="lineno"> 9572</span>&#160;          CommonAlignment =</div>
<div class="line"><a name="l09573"></a><span class="lineno"> 9573</span>&#160;              <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(CommonAlignment, cast&lt;LoadInst&gt;(V)-&gt;<a class="code" href="namespacellvm.html#a2ec9079c9e11f3cad2a09d84a9c617f6">getAlign</a>());</div>
<div class="line"><a name="l09574"></a><span class="lineno"> 9574</span>&#160;        NewLI = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateMaskedGather(VecTy, VecPtr, CommonAlignment);</div>
<div class="line"><a name="l09575"></a><span class="lineno"> 9575</span>&#160;      }</div>
<div class="line"><a name="l09576"></a><span class="lineno"> 9576</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="namespacellvm.html#a48a6deb3e714d54e75caadcf84b0ca76">propagateMetadata</a>(NewLI, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars);</div>
<div class="line"><a name="l09577"></a><span class="lineno"> 9577</span>&#160; </div>
<div class="line"><a name="l09578"></a><span class="lineno"> 9578</span>&#160;      V = FinalShuffle(V, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09579"></a><span class="lineno"> 9579</span>&#160;      <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue = V;</div>
<div class="line"><a name="l09580"></a><span class="lineno"> 9580</span>&#160;      ++NumVectorInstructions;</div>
<div class="line"><a name="l09581"></a><span class="lineno"> 9581</span>&#160;      <span class="keywordflow">return</span> V;</div>
<div class="line"><a name="l09582"></a><span class="lineno"> 9582</span>&#160;    }</div>
<div class="line"><a name="l09583"></a><span class="lineno"> 9583</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Instruction::Store</a>: {</div>
<div class="line"><a name="l09584"></a><span class="lineno"> 9584</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = cast&lt;StoreInst&gt;(VL0);</div>
<div class="line"><a name="l09585"></a><span class="lineno"> 9585</span>&#160;      <span class="keywordtype">unsigned</span> AS = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getPointerAddressSpace();</div>
<div class="line"><a name="l09586"></a><span class="lineno"> 9586</span>&#160; </div>
<div class="line"><a name="l09587"></a><span class="lineno"> 9587</span>&#160;      setInsertPointAfterBundle(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09588"></a><span class="lineno"> 9588</span>&#160; </div>
<div class="line"><a name="l09589"></a><span class="lineno"> 9589</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *VecValue = vectorizeOperand(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, 0);</div>
<div class="line"><a name="l09590"></a><span class="lineno"> 9590</span>&#160;      VecValue = FinalShuffle(VecValue, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09591"></a><span class="lineno"> 9591</span>&#160; </div>
<div class="line"><a name="l09592"></a><span class="lineno"> 9592</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *ScalarPtr = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getPointerOperand();</div>
<div class="line"><a name="l09593"></a><span class="lineno"> 9593</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *VecPtr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(</div>
<div class="line"><a name="l09594"></a><span class="lineno"> 9594</span>&#160;          ScalarPtr, VecValue-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#adc01a7457de85fc52a3bb860d7e1c6a4">getPointerTo</a>(AS));</div>
<div class="line"><a name="l09595"></a><span class="lineno"> 9595</span>&#160;      <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a> =</div>
<div class="line"><a name="l09596"></a><span class="lineno"> 9596</span>&#160;          <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAlignedStore(VecValue, VecPtr, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getAlign());</div>
<div class="line"><a name="l09597"></a><span class="lineno"> 9597</span>&#160; </div>
<div class="line"><a name="l09598"></a><span class="lineno"> 9598</span>&#160;      <span class="comment">// The pointer operand uses an in-tree scalar, so add the new BitCast or</span></div>
<div class="line"><a name="l09599"></a><span class="lineno"> 9599</span>&#160;      <span class="comment">// StoreInst to ExternalUses to make sure that an extract will be</span></div>
<div class="line"><a name="l09600"></a><span class="lineno"> 9600</span>&#160;      <span class="comment">// generated in the future.</span></div>
<div class="line"><a name="l09601"></a><span class="lineno"> 9601</span>&#160;      <span class="keywordflow">if</span> (TreeEntry *Entry = getTreeEntry(ScalarPtr)) {</div>
<div class="line"><a name="l09602"></a><span class="lineno"> 9602</span>&#160;        <span class="comment">// Find which lane we need to extract.</span></div>
<div class="line"><a name="l09603"></a><span class="lineno"> 9603</span>&#160;        <span class="keywordtype">unsigned</span> FoundLane = Entry-&gt;findLaneForValue(ScalarPtr);</div>
<div class="line"><a name="l09604"></a><span class="lineno"> 9604</span>&#160;        ExternalUses.push_back(ExternalUser(</div>
<div class="line"><a name="l09605"></a><span class="lineno"> 9605</span>&#160;            ScalarPtr, ScalarPtr != VecPtr ? cast&lt;User&gt;(VecPtr) : <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>,</div>
<div class="line"><a name="l09606"></a><span class="lineno"> 9606</span>&#160;            FoundLane));</div>
<div class="line"><a name="l09607"></a><span class="lineno"> 9607</span>&#160;      }</div>
<div class="line"><a name="l09608"></a><span class="lineno"> 9608</span>&#160; </div>
<div class="line"><a name="l09609"></a><span class="lineno"> 9609</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="namespacellvm.html#a48a6deb3e714d54e75caadcf84b0ca76">propagateMetadata</a>(<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars);</div>
<div class="line"><a name="l09610"></a><span class="lineno"> 9610</span>&#160; </div>
<div class="line"><a name="l09611"></a><span class="lineno"> 9611</span>&#160;      <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue = V;</div>
<div class="line"><a name="l09612"></a><span class="lineno"> 9612</span>&#160;      ++NumVectorInstructions;</div>
<div class="line"><a name="l09613"></a><span class="lineno"> 9613</span>&#160;      <span class="keywordflow">return</span> V;</div>
<div class="line"><a name="l09614"></a><span class="lineno"> 9614</span>&#160;    }</div>
<div class="line"><a name="l09615"></a><span class="lineno"> 9615</span>&#160;    <span class="keywordflow">case</span> Instruction::GetElementPtr: {</div>
<div class="line"><a name="l09616"></a><span class="lineno"> 9616</span>&#160;      <span class="keyword">auto</span> *GEP0 = cast&lt;GetElementPtrInst&gt;(VL0);</div>
<div class="line"><a name="l09617"></a><span class="lineno"> 9617</span>&#160;      setInsertPointAfterBundle(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09618"></a><span class="lineno"> 9618</span>&#160; </div>
<div class="line"><a name="l09619"></a><span class="lineno"> 9619</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Op0 = vectorizeOperand(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, 0);</div>
<div class="line"><a name="l09620"></a><span class="lineno"> 9620</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue) {</div>
<div class="line"><a name="l09621"></a><span class="lineno"> 9621</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Diamond merged for &quot;</span> &lt;&lt; *VL0 &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l09622"></a><span class="lineno"> 9622</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue;</div>
<div class="line"><a name="l09623"></a><span class="lineno"> 9623</span>&#160;      }</div>
<div class="line"><a name="l09624"></a><span class="lineno"> 9624</span>&#160; </div>
<div class="line"><a name="l09625"></a><span class="lineno"> 9625</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *&gt;</a> OpVecs;</div>
<div class="line"><a name="l09626"></a><span class="lineno"> 9626</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> J = 1, <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = GEP0-&gt;getNumOperands(); J &lt; <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>; ++J) {</div>
<div class="line"><a name="l09627"></a><span class="lineno"> 9627</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *OpVec = vectorizeOperand(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, J);</div>
<div class="line"><a name="l09628"></a><span class="lineno"> 9628</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue) {</div>
<div class="line"><a name="l09629"></a><span class="lineno"> 9629</span>&#160;          <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Diamond merged for &quot;</span> &lt;&lt; *VL0 &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l09630"></a><span class="lineno"> 9630</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue;</div>
<div class="line"><a name="l09631"></a><span class="lineno"> 9631</span>&#160;        }</div>
<div class="line"><a name="l09632"></a><span class="lineno"> 9632</span>&#160;        OpVecs.push_back(OpVec);</div>
<div class="line"><a name="l09633"></a><span class="lineno"> 9633</span>&#160;      }</div>
<div class="line"><a name="l09634"></a><span class="lineno"> 9634</span>&#160; </div>
<div class="line"><a name="l09635"></a><span class="lineno"> 9635</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateGEP(GEP0-&gt;getSourceElementType(), Op0, OpVecs);</div>
<div class="line"><a name="l09636"></a><span class="lineno"> 9636</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;GetElementPtrInst&gt;(V)) {</div>
<div class="line"><a name="l09637"></a><span class="lineno"> 9637</span>&#160;        <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *&gt;</a> GEPs;</div>
<div class="line"><a name="l09638"></a><span class="lineno"> 9638</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars) {</div>
<div class="line"><a name="l09639"></a><span class="lineno"> 9639</span>&#160;          <span class="keywordflow">if</span> (isa&lt;GetElementPtrInst&gt;(V))</div>
<div class="line"><a name="l09640"></a><span class="lineno"> 9640</span>&#160;            GEPs.push_back(V);</div>
<div class="line"><a name="l09641"></a><span class="lineno"> 9641</span>&#160;        }</div>
<div class="line"><a name="l09642"></a><span class="lineno"> 9642</span>&#160;        V = <a class="code" href="namespacellvm.html#a48a6deb3e714d54e75caadcf84b0ca76">propagateMetadata</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, GEPs);</div>
<div class="line"><a name="l09643"></a><span class="lineno"> 9643</span>&#160;      }</div>
<div class="line"><a name="l09644"></a><span class="lineno"> 9644</span>&#160; </div>
<div class="line"><a name="l09645"></a><span class="lineno"> 9645</span>&#160;      V = FinalShuffle(V, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09646"></a><span class="lineno"> 9646</span>&#160; </div>
<div class="line"><a name="l09647"></a><span class="lineno"> 9647</span>&#160;      <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue = V;</div>
<div class="line"><a name="l09648"></a><span class="lineno"> 9648</span>&#160;      ++NumVectorInstructions;</div>
<div class="line"><a name="l09649"></a><span class="lineno"> 9649</span>&#160; </div>
<div class="line"><a name="l09650"></a><span class="lineno"> 9650</span>&#160;      <span class="keywordflow">return</span> V;</div>
<div class="line"><a name="l09651"></a><span class="lineno"> 9651</span>&#160;    }</div>
<div class="line"><a name="l09652"></a><span class="lineno"> 9652</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Instruction::Call</a>: {</div>
<div class="line"><a name="l09653"></a><span class="lineno"> 9653</span>&#160;      <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI = cast&lt;CallInst&gt;(VL0);</div>
<div class="line"><a name="l09654"></a><span class="lineno"> 9654</span>&#160;      setInsertPointAfterBundle(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09655"></a><span class="lineno"> 9655</span>&#160; </div>
<div class="line"><a name="l09656"></a><span class="lineno"> 9656</span>&#160;      <a class="code" href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IID  = <a class="code" href="namespacellvm_1_1Intrinsic.html#a35fedf4db6d756bd82501607f93c1e79aab5fb650050f184fa7c19c26abde5226">Intrinsic::not_intrinsic</a>;</div>
<div class="line"><a name="l09657"></a><span class="lineno"> 9657</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Function.html">Function</a> *FI = CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#a83b8c9e572130f403445c0b0f69b837c">getCalledFunction</a>())</div>
<div class="line"><a name="l09658"></a><span class="lineno"> 9658</span>&#160;        IID = FI-&gt;getIntrinsicID();</div>
<div class="line"><a name="l09659"></a><span class="lineno"> 9659</span>&#160; </div>
<div class="line"><a name="l09660"></a><span class="lineno"> 9660</span>&#160;      <a class="code" href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> <a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a> = <a class="code" href="namespacellvm.html#a11c66d01880f53332fc7ad53f565b039">getVectorIntrinsicIDForCall</a>(CI, TLI);</div>
<div class="line"><a name="l09661"></a><span class="lineno"> 9661</span>&#160; </div>
<div class="line"><a name="l09662"></a><span class="lineno"> 9662</span>&#160;      <span class="keyword">auto</span> VecCallCosts = <a class="code" href="SLPVectorizer_8cpp.html#af6afa6e00a2ef98815dd54413ab32fe2">getVectorCallCosts</a>(CI, VecTy, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, TLI);</div>
<div class="line"><a name="l09663"></a><span class="lineno"> 9663</span>&#160;      <span class="keywordtype">bool</span> UseIntrinsic = <a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a> != <a class="code" href="namespacellvm_1_1Intrinsic.html#a35fedf4db6d756bd82501607f93c1e79aab5fb650050f184fa7c19c26abde5226">Intrinsic::not_intrinsic</a> &amp;&amp;</div>
<div class="line"><a name="l09664"></a><span class="lineno"> 9664</span>&#160;                          VecCallCosts.first &lt;= VecCallCosts.second;</div>
<div class="line"><a name="l09665"></a><span class="lineno"> 9665</span>&#160; </div>
<div class="line"><a name="l09666"></a><span class="lineno"> 9666</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *ScalarArg = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l09667"></a><span class="lineno"> 9667</span>&#160;      std::vector&lt;Value *&gt; OpVecs;</div>
<div class="line"><a name="l09668"></a><span class="lineno"> 9668</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Type *, 2&gt;</a> TysForDecl =</div>
<div class="line"><a name="l09669"></a><span class="lineno"> 9669</span>&#160;          {<a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(CI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars.size())};</div>
<div class="line"><a name="l09670"></a><span class="lineno"> 9670</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#adde2ea00dd2613ee41bfe91908e4e68e">arg_size</a>(); <a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a> &lt; <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>) {</div>
<div class="line"><a name="l09671"></a><span class="lineno"> 9671</span>&#160;        ValueList OpVL;</div>
<div class="line"><a name="l09672"></a><span class="lineno"> 9672</span>&#160;        <span class="comment">// Some intrinsics have scalar arguments. This argument should not be</span></div>
<div class="line"><a name="l09673"></a><span class="lineno"> 9673</span>&#160;        <span class="comment">// vectorized.</span></div>
<div class="line"><a name="l09674"></a><span class="lineno"> 9674</span>&#160;        <span class="keywordflow">if</span> (UseIntrinsic &amp;&amp; <a class="code" href="namespacellvm.html#ad5f1403d57d5cc4301785b181caa5f1b">isVectorIntrinsicWithScalarOpAtArg</a>(IID, <a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>)) {</div>
<div class="line"><a name="l09675"></a><span class="lineno"> 9675</span>&#160;          <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CEI = cast&lt;CallInst&gt;(VL0);</div>
<div class="line"><a name="l09676"></a><span class="lineno"> 9676</span>&#160;          ScalarArg = CEI-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(<a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>);</div>
<div class="line"><a name="l09677"></a><span class="lineno"> 9677</span>&#160;          OpVecs.push_back(CEI-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(<a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>));</div>
<div class="line"><a name="l09678"></a><span class="lineno"> 9678</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a07e02addfc027a2e0f403fdac5b49163">isVectorIntrinsicWithOverloadTypeAtArg</a>(IID, <a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>))</div>
<div class="line"><a name="l09679"></a><span class="lineno"> 9679</span>&#160;            TysForDecl.push_back(ScalarArg-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l09680"></a><span class="lineno"> 9680</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l09681"></a><span class="lineno"> 9681</span>&#160;        }</div>
<div class="line"><a name="l09682"></a><span class="lineno"> 9682</span>&#160; </div>
<div class="line"><a name="l09683"></a><span class="lineno"> 9683</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *OpVec = vectorizeOperand(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, <a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>);</div>
<div class="line"><a name="l09684"></a><span class="lineno"> 9684</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue) {</div>
<div class="line"><a name="l09685"></a><span class="lineno"> 9685</span>&#160;          <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Diamond merged for &quot;</span> &lt;&lt; *VL0 &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l09686"></a><span class="lineno"> 9686</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue;</div>
<div class="line"><a name="l09687"></a><span class="lineno"> 9687</span>&#160;        }</div>
<div class="line"><a name="l09688"></a><span class="lineno"> 9688</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: OpVec[&quot;</span> &lt;&lt; <a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a> &lt;&lt; <span class="stringliteral">&quot;]: &quot;</span> &lt;&lt; *OpVec &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l09689"></a><span class="lineno"> 9689</span>&#160;        OpVecs.push_back(OpVec);</div>
<div class="line"><a name="l09690"></a><span class="lineno"> 9690</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a07e02addfc027a2e0f403fdac5b49163">isVectorIntrinsicWithOverloadTypeAtArg</a>(IID, <a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>))</div>
<div class="line"><a name="l09691"></a><span class="lineno"> 9691</span>&#160;          TysForDecl.push_back(OpVec-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l09692"></a><span class="lineno"> 9692</span>&#160;      }</div>
<div class="line"><a name="l09693"></a><span class="lineno"> 9693</span>&#160; </div>
<div class="line"><a name="l09694"></a><span class="lineno"> 9694</span>&#160;      <a class="code" href="classllvm_1_1Function.html">Function</a> *CF;</div>
<div class="line"><a name="l09695"></a><span class="lineno"> 9695</span>&#160;      <span class="keywordflow">if</span> (!UseIntrinsic) {</div>
<div class="line"><a name="l09696"></a><span class="lineno"> 9696</span>&#160;        <a class="code" href="structllvm_1_1VFShape.html">VFShape</a> Shape =</div>
<div class="line"><a name="l09697"></a><span class="lineno"> 9697</span>&#160;            <a class="code" href="structllvm_1_1VFShape.html#a33df83a8555fc8dd7c7d547576abb354">VFShape::get</a>(*CI, <a class="code" href="classllvm_1_1ElementCount.html#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(<span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span><span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l09698"></a><span class="lineno"> 9698</span>&#160;                                  VecTy-&gt;<a class="code" href="classllvm_1_1FixedVectorType.html#a1893caf878859959ba6a3d5442ef1439">getNumElements</a>())),</div>
<div class="line"><a name="l09699"></a><span class="lineno"> 9699</span>&#160;                         <span class="keyword">false</span> <span class="comment">/*HasGlobalPred*/</span>);</div>
<div class="line"><a name="l09700"></a><span class="lineno"> 9700</span>&#160;        CF = <a class="code" href="classllvm_1_1VFDatabase.html">VFDatabase</a>(*CI).<a class="code" href="group__VFDatabase.html#ga66862f50dead385e61e416b35110c5f1">getVectorizedFunction</a>(Shape);</div>
<div class="line"><a name="l09701"></a><span class="lineno"> 9701</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l09702"></a><span class="lineno"> 9702</span>&#160;        CF = <a class="code" href="namespacellvm_1_1Intrinsic.html#aefa39f6b622360ce4e947feb9f671b73">Intrinsic::getDeclaration</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getParent(), <a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>, TysForDecl);</div>
<div class="line"><a name="l09703"></a><span class="lineno"> 9703</span>&#160;      }</div>
<div class="line"><a name="l09704"></a><span class="lineno"> 9704</span>&#160; </div>
<div class="line"><a name="l09705"></a><span class="lineno"> 9705</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;OperandBundleDef, 1&gt;</a> OpBundles;</div>
<div class="line"><a name="l09706"></a><span class="lineno"> 9706</span>&#160;      CI-&gt;<a class="code" href="classllvm_1_1CallBase.html#a19263fff7f5b3a9d22b48151fa0d85d0">getOperandBundlesAsDefs</a>(OpBundles);</div>
<div class="line"><a name="l09707"></a><span class="lineno"> 9707</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCall(CF, OpVecs, OpBundles);</div>
<div class="line"><a name="l09708"></a><span class="lineno"> 9708</span>&#160; </div>
<div class="line"><a name="l09709"></a><span class="lineno"> 9709</span>&#160;      <span class="comment">// The scalar argument uses an in-tree scalar so we add the new vectorized</span></div>
<div class="line"><a name="l09710"></a><span class="lineno"> 9710</span>&#160;      <span class="comment">// call to ExternalUses list to make sure that an extract will be</span></div>
<div class="line"><a name="l09711"></a><span class="lineno"> 9711</span>&#160;      <span class="comment">// generated in the future.</span></div>
<div class="line"><a name="l09712"></a><span class="lineno"> 9712</span>&#160;      <span class="keywordflow">if</span> (ScalarArg) {</div>
<div class="line"><a name="l09713"></a><span class="lineno"> 9713</span>&#160;        <span class="keywordflow">if</span> (TreeEntry *Entry = getTreeEntry(ScalarArg)) {</div>
<div class="line"><a name="l09714"></a><span class="lineno"> 9714</span>&#160;          <span class="comment">// Find which lane we need to extract.</span></div>
<div class="line"><a name="l09715"></a><span class="lineno"> 9715</span>&#160;          <span class="keywordtype">unsigned</span> FoundLane = Entry-&gt;findLaneForValue(ScalarArg);</div>
<div class="line"><a name="l09716"></a><span class="lineno"> 9716</span>&#160;          ExternalUses.push_back(</div>
<div class="line"><a name="l09717"></a><span class="lineno"> 9717</span>&#160;              ExternalUser(ScalarArg, cast&lt;User&gt;(V), FoundLane));</div>
<div class="line"><a name="l09718"></a><span class="lineno"> 9718</span>&#160;        }</div>
<div class="line"><a name="l09719"></a><span class="lineno"> 9719</span>&#160;      }</div>
<div class="line"><a name="l09720"></a><span class="lineno"> 9720</span>&#160; </div>
<div class="line"><a name="l09721"></a><span class="lineno"> 9721</span>&#160;      <a class="code" href="namespacellvm.html#a9451ae71f535d06cd1d8ae642d76fc0d">propagateIRFlags</a>(V, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars, VL0);</div>
<div class="line"><a name="l09722"></a><span class="lineno"> 9722</span>&#160;      V = FinalShuffle(V, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09723"></a><span class="lineno"> 9723</span>&#160; </div>
<div class="line"><a name="l09724"></a><span class="lineno"> 9724</span>&#160;      <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue = V;</div>
<div class="line"><a name="l09725"></a><span class="lineno"> 9725</span>&#160;      ++NumVectorInstructions;</div>
<div class="line"><a name="l09726"></a><span class="lineno"> 9726</span>&#160;      <span class="keywordflow">return</span> V;</div>
<div class="line"><a name="l09727"></a><span class="lineno"> 9727</span>&#160;    }</div>
<div class="line"><a name="l09728"></a><span class="lineno"> 9728</span>&#160;    <span class="keywordflow">case</span> Instruction::ShuffleVector: {</div>
<div class="line"><a name="l09729"></a><span class="lineno"> 9729</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;isAltShuffle() &amp;&amp;</div>
<div class="line"><a name="l09730"></a><span class="lineno"> 9730</span>&#160;             ((<a class="code" href="classllvm_1_1Instruction.html#a5c88132322ca3f46f242f7c023a57010">Instruction::isBinaryOp</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode()) &amp;&amp;</div>
<div class="line"><a name="l09731"></a><span class="lineno"> 9731</span>&#160;               <a class="code" href="classllvm_1_1Instruction.html#a5c88132322ca3f46f242f7c023a57010">Instruction::isBinaryOp</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getAltOpcode())) ||</div>
<div class="line"><a name="l09732"></a><span class="lineno"> 9732</span>&#160;              (<a class="code" href="classllvm_1_1Instruction.html#a27997849d8982bf226891024fd68daee">Instruction::isCast</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode()) &amp;&amp;</div>
<div class="line"><a name="l09733"></a><span class="lineno"> 9733</span>&#160;               <a class="code" href="classllvm_1_1Instruction.html#a27997849d8982bf226891024fd68daee">Instruction::isCast</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getAltOpcode())) ||</div>
<div class="line"><a name="l09734"></a><span class="lineno"> 9734</span>&#160;              (isa&lt;CmpInst&gt;(VL0) &amp;&amp; isa&lt;CmpInst&gt;(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getAltOp()))) &amp;&amp;</div>
<div class="line"><a name="l09735"></a><span class="lineno"> 9735</span>&#160;             <span class="stringliteral">&quot;Invalid Shuffle Vector Operand&quot;</span>);</div>
<div class="line"><a name="l09736"></a><span class="lineno"> 9736</span>&#160; </div>
<div class="line"><a name="l09737"></a><span class="lineno"> 9737</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = <span class="keyword">nullptr</span>, *<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l09738"></a><span class="lineno"> 9738</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html#a5c88132322ca3f46f242f7c023a57010">Instruction::isBinaryOp</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode()) || isa&lt;CmpInst&gt;(VL0)) {</div>
<div class="line"><a name="l09739"></a><span class="lineno"> 9739</span>&#160;        setInsertPointAfterBundle(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09740"></a><span class="lineno"> 9740</span>&#160;        <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = vectorizeOperand(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, 0);</div>
<div class="line"><a name="l09741"></a><span class="lineno"> 9741</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue) {</div>
<div class="line"><a name="l09742"></a><span class="lineno"> 9742</span>&#160;          <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Diamond merged for &quot;</span> &lt;&lt; *VL0 &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l09743"></a><span class="lineno"> 9743</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue;</div>
<div class="line"><a name="l09744"></a><span class="lineno"> 9744</span>&#160;        }</div>
<div class="line"><a name="l09745"></a><span class="lineno"> 9745</span>&#160;        <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = vectorizeOperand(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, 1);</div>
<div class="line"><a name="l09746"></a><span class="lineno"> 9746</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l09747"></a><span class="lineno"> 9747</span>&#160;        setInsertPointAfterBundle(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>);</div>
<div class="line"><a name="l09748"></a><span class="lineno"> 9748</span>&#160;        <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = vectorizeOperand(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, 0);</div>
<div class="line"><a name="l09749"></a><span class="lineno"> 9749</span>&#160;      }</div>
<div class="line"><a name="l09750"></a><span class="lineno"> 9750</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue) {</div>
<div class="line"><a name="l09751"></a><span class="lineno"> 9751</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Diamond merged for &quot;</span> &lt;&lt; *VL0 &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l09752"></a><span class="lineno"> 9752</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue;</div>
<div class="line"><a name="l09753"></a><span class="lineno"> 9753</span>&#160;      }</div>
<div class="line"><a name="l09754"></a><span class="lineno"> 9754</span>&#160; </div>
<div class="line"><a name="l09755"></a><span class="lineno"> 9755</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V0, *V1;</div>
<div class="line"><a name="l09756"></a><span class="lineno"> 9756</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html#a5c88132322ca3f46f242f7c023a57010">Instruction::isBinaryOp</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode())) {</div>
<div class="line"><a name="l09757"></a><span class="lineno"> 9757</span>&#160;        V0 = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBinOp(</div>
<div class="line"><a name="l09758"></a><span class="lineno"> 9758</span>&#160;            <span class="keyword">static_cast&lt;</span><a class="code" href="classllvm_1_1Instruction.html#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a><span class="keyword">&gt;</span>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode()), <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</div>
<div class="line"><a name="l09759"></a><span class="lineno"> 9759</span>&#160;        V1 = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBinOp(</div>
<div class="line"><a name="l09760"></a><span class="lineno"> 9760</span>&#160;            <span class="keyword">static_cast&lt;</span><a class="code" href="classllvm_1_1Instruction.html#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a><span class="keyword">&gt;</span>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getAltOpcode()), <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</div>
<div class="line"><a name="l09761"></a><span class="lineno"> 9761</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *CI0 = dyn_cast&lt;CmpInst&gt;(VL0)) {</div>
<div class="line"><a name="l09762"></a><span class="lineno"> 9762</span>&#160;        V0 = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCmp(CI0-&gt;getPredicate(), <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</div>
<div class="line"><a name="l09763"></a><span class="lineno"> 9763</span>&#160;        <span class="keyword">auto</span> *AltCI = cast&lt;CmpInst&gt;(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getAltOp());</div>
<div class="line"><a name="l09764"></a><span class="lineno"> 9764</span>&#160;        <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> AltPred = AltCI-&gt;getPredicate();</div>
<div class="line"><a name="l09765"></a><span class="lineno"> 9765</span>&#160;        V1 = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCmp(AltPred, <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</div>
<div class="line"><a name="l09766"></a><span class="lineno"> 9766</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l09767"></a><span class="lineno"> 9767</span>&#160;        V0 = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCast(</div>
<div class="line"><a name="l09768"></a><span class="lineno"> 9768</span>&#160;            <span class="keyword">static_cast&lt;</span><a class="code" href="classllvm_1_1Instruction.html#afa0b2fa29ba074f2b6ec9ac11163f2d9">Instruction::CastOps</a><span class="keyword">&gt;</span>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode()), <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, VecTy);</div>
<div class="line"><a name="l09769"></a><span class="lineno"> 9769</span>&#160;        V1 = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCast(</div>
<div class="line"><a name="l09770"></a><span class="lineno"> 9770</span>&#160;            <span class="keyword">static_cast&lt;</span><a class="code" href="classllvm_1_1Instruction.html#afa0b2fa29ba074f2b6ec9ac11163f2d9">Instruction::CastOps</a><span class="keyword">&gt;</span>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getAltOpcode()), <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, VecTy);</div>
<div class="line"><a name="l09771"></a><span class="lineno"> 9771</span>&#160;      }</div>
<div class="line"><a name="l09772"></a><span class="lineno"> 9772</span>&#160;      <span class="comment">// Add V0 and V1 to later analysis to try to find and remove matching</span></div>
<div class="line"><a name="l09773"></a><span class="lineno"> 9773</span>&#160;      <span class="comment">// instruction, if any.</span></div>
<div class="line"><a name="l09774"></a><span class="lineno"> 9774</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : {V0, V1}) {</div>
<div class="line"><a name="l09775"></a><span class="lineno"> 9775</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V)) {</div>
<div class="line"><a name="l09776"></a><span class="lineno"> 9776</span>&#160;          GatherShuffleExtractSeq.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l09777"></a><span class="lineno"> 9777</span>&#160;          CSEBlocks.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent());</div>
<div class="line"><a name="l09778"></a><span class="lineno"> 9778</span>&#160;        }</div>
<div class="line"><a name="l09779"></a><span class="lineno"> 9779</span>&#160;      }</div>
<div class="line"><a name="l09780"></a><span class="lineno"> 9780</span>&#160; </div>
<div class="line"><a name="l09781"></a><span class="lineno"> 9781</span>&#160;      <span class="comment">// Create shuffle to take alternate operations from the vector.</span></div>
<div class="line"><a name="l09782"></a><span class="lineno"> 9782</span>&#160;      <span class="comment">// Also, gather up main and alt scalar ops to propagate IR flags to</span></div>
<div class="line"><a name="l09783"></a><span class="lineno"> 9783</span>&#160;      <span class="comment">// each vector operation.</span></div>
<div class="line"><a name="l09784"></a><span class="lineno"> 9784</span>&#160;      ValueList OpScalars, AltScalars;</div>
<div class="line"><a name="l09785"></a><span class="lineno"> 9785</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>;</div>
<div class="line"><a name="l09786"></a><span class="lineno"> 9786</span>&#160;      <a class="code" href="SLPVectorizer_8cpp.html#a68f8b6509e5780355450f139ddfe89ec">buildShuffleEntryMask</a>(</div>
<div class="line"><a name="l09787"></a><span class="lineno"> 9787</span>&#160;          <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReorderIndices, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;ReuseShuffleIndices,</div>
<div class="line"><a name="l09788"></a><span class="lineno"> 9788</span>&#160;          [<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, <span class="keyword">this</span>](<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l09789"></a><span class="lineno"> 9789</span>&#160;            assert(E-&gt;isOpcodeOrAlt(I) &amp;&amp; <span class="stringliteral">&quot;Unexpected main/alternate opcode&quot;</span>);</div>
<div class="line"><a name="l09790"></a><span class="lineno"> 9790</span>&#160;            return isAlternateInstruction(I, E-&gt;getMainOp(), E-&gt;getAltOp(),</div>
<div class="line"><a name="l09791"></a><span class="lineno"> 9791</span>&#160;                                          *TLI);</div>
<div class="line"><a name="l09792"></a><span class="lineno"> 9792</span>&#160;          },</div>
<div class="line"><a name="l09793"></a><span class="lineno"> 9793</span>&#160;          <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, &amp;OpScalars, &amp;AltScalars);</div>
<div class="line"><a name="l09794"></a><span class="lineno"> 9794</span>&#160; </div>
<div class="line"><a name="l09795"></a><span class="lineno"> 9795</span>&#160;      <a class="code" href="namespacellvm.html#a9451ae71f535d06cd1d8ae642d76fc0d">propagateIRFlags</a>(V0, OpScalars);</div>
<div class="line"><a name="l09796"></a><span class="lineno"> 9796</span>&#160;      <a class="code" href="namespacellvm.html#a9451ae71f535d06cd1d8ae642d76fc0d">propagateIRFlags</a>(V1, AltScalars);</div>
<div class="line"><a name="l09797"></a><span class="lineno"> 9797</span>&#160; </div>
<div class="line"><a name="l09798"></a><span class="lineno"> 9798</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShuffleVector(V0, V1, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l09799"></a><span class="lineno"> 9799</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V)) {</div>
<div class="line"><a name="l09800"></a><span class="lineno"> 9800</span>&#160;        V = <a class="code" href="namespacellvm.html#a48a6deb3e714d54e75caadcf84b0ca76">propagateMetadata</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Scalars);</div>
<div class="line"><a name="l09801"></a><span class="lineno"> 9801</span>&#160;        GatherShuffleExtractSeq.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l09802"></a><span class="lineno"> 9802</span>&#160;        CSEBlocks.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent());</div>
<div class="line"><a name="l09803"></a><span class="lineno"> 9803</span>&#160;      }</div>
<div class="line"><a name="l09804"></a><span class="lineno"> 9804</span>&#160; </div>
<div class="line"><a name="l09805"></a><span class="lineno"> 9805</span>&#160;      <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue = V;</div>
<div class="line"><a name="l09806"></a><span class="lineno"> 9806</span>&#160;      ++NumVectorInstructions;</div>
<div class="line"><a name="l09807"></a><span class="lineno"> 9807</span>&#160; </div>
<div class="line"><a name="l09808"></a><span class="lineno"> 9808</span>&#160;      <span class="keywordflow">return</span> V;</div>
<div class="line"><a name="l09809"></a><span class="lineno"> 9809</span>&#160;    }</div>
<div class="line"><a name="l09810"></a><span class="lineno"> 9810</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l09811"></a><span class="lineno"> 9811</span>&#160;    <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;unknown inst&quot;</span>);</div>
<div class="line"><a name="l09812"></a><span class="lineno"> 9812</span>&#160;  }</div>
<div class="line"><a name="l09813"></a><span class="lineno"> 9813</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l09814"></a><span class="lineno"> 9814</span>&#160;}</div>
<div class="line"><a name="l09815"></a><span class="lineno"> 9815</span>&#160; </div>
<div class="line"><a name="l09816"></a><span class="lineno"> 9816</span>&#160;<a class="code" href="classllvm_1_1Value.html">Value</a> *BoUpSLP::vectorizeTree() {</div>
<div class="line"><a name="l09817"></a><span class="lineno"> 9817</span>&#160;  ExtraValueToDebugLocsMap ExternallyUsedValues;</div>
<div class="line"><a name="l09818"></a><span class="lineno"> 9818</span>&#160;  <span class="keywordflow">return</span> vectorizeTree(ExternallyUsedValues);</div>
<div class="line"><a name="l09819"></a><span class="lineno"> 9819</span>&#160;}</div>
<div class="line"><a name="l09820"></a><span class="lineno"> 9820</span>&#160; </div>
<div class="line"><a name="l09821"></a><span class="lineno"> 9821</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div>
<div class="line"><a name="l09822"></a><span class="lineno"> 9822</span>&#160;<span class="comment">/// Data type for handling buildvector sequences with the reused scalars from</span></div>
<div class="line"><a name="l09823"></a><span class="lineno"> 9823</span>&#160;<span class="comment">/// other tree entries.</span></div>
<div class="line"><a name="l09824"></a><span class="lineno"> 9824</span>&#160;<span class="comment"></span><span class="keyword">struct </span>ShuffledInsertData {<span class="comment"></span></div>
<div class="line"><a name="l09825"></a><span class="lineno"> 9825</span>&#160;<span class="comment">  /// List of insertelements to be replaced by shuffles.</span></div>
<div class="line"><a name="l09826"></a><span class="lineno"> 9826</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;InsertElementInst *&gt;</a> InsertElements;<span class="comment"></span></div>
<div class="line"><a name="l09827"></a><span class="lineno"> 9827</span>&#160;<span class="comment">  /// The parent vectors and shuffle mask for the given list of inserts.</span></div>
<div class="line"><a name="l09828"></a><span class="lineno"> 9828</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;Value *, SmallVector&lt;int&gt;</a>&gt; ValueMasks;</div>
<div class="line"><a name="l09829"></a><span class="lineno"> 9829</span>&#160;};</div>
<div class="line"><a name="l09830"></a><span class="lineno"> 9830</span>&#160;} <span class="comment">// namespace</span></div>
<div class="line"><a name="l09831"></a><span class="lineno"> 9831</span>&#160; </div>
<div class="line"><a name="l09832"></a><span class="lineno"> 9832</span>&#160;<a class="code" href="classllvm_1_1Value.html">Value</a> *BoUpSLP::vectorizeTree(ExtraValueToDebugLocsMap &amp;ExternallyUsedValues,</div>
<div class="line"><a name="l09833"></a><span class="lineno"> 9833</span>&#160;                              <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ReductionRoot) {</div>
<div class="line"><a name="l09834"></a><span class="lineno"> 9834</span>&#160;  <span class="comment">// All blocks must be scheduled before any instructions are inserted.</span></div>
<div class="line"><a name="l09835"></a><span class="lineno"> 9835</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;BSIter : BlocksSchedules) {</div>
<div class="line"><a name="l09836"></a><span class="lineno"> 9836</span>&#160;    scheduleBlock(BSIter.second.get());</div>
<div class="line"><a name="l09837"></a><span class="lineno"> 9837</span>&#160;  }</div>
<div class="line"><a name="l09838"></a><span class="lineno"> 9838</span>&#160; </div>
<div class="line"><a name="l09839"></a><span class="lineno"> 9839</span>&#160;  <span class="comment">// Pre-gather last instructions.</span></div>
<div class="line"><a name="l09840"></a><span class="lineno"> 9840</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> std::unique_ptr&lt;TreeEntry&gt; &amp;<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> : VectorizableTree) {</div>
<div class="line"><a name="l09841"></a><span class="lineno"> 9841</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;State == TreeEntry::NeedToGather &amp;&amp;</div>
<div class="line"><a name="l09842"></a><span class="lineno"> 9842</span>&#160;         (!<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getMainOp() || <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;Idx &gt; 0)) ||</div>
<div class="line"><a name="l09843"></a><span class="lineno"> 9843</span>&#160;        (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;State != TreeEntry::NeedToGather &amp;&amp;</div>
<div class="line"><a name="l09844"></a><span class="lineno"> 9844</span>&#160;         <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode() == Instruction::ExtractValue) ||</div>
<div class="line"><a name="l09845"></a><span class="lineno"> 9845</span>&#160;        <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode() == Instruction::InsertElement)</div>
<div class="line"><a name="l09846"></a><span class="lineno"> 9846</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l09847"></a><span class="lineno"> 9847</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *LastInst = &amp;getLastInstructionInBundle(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>.get());</div>
<div class="line"><a name="l09848"></a><span class="lineno"> 9848</span>&#160;    EntryToLastInstruction.<a class="code" href="classllvm_1_1DenseMapBase.html#a98c685a0c53f3f7ed5f4793890a6c850">try_emplace</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>.get(), LastInst);</div>
<div class="line"><a name="l09849"></a><span class="lineno"> 9849</span>&#160;  }</div>
<div class="line"><a name="l09850"></a><span class="lineno"> 9850</span>&#160; </div>
<div class="line"><a name="l09851"></a><span class="lineno"> 9851</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(ReductionRoot ? ReductionRoot</div>
<div class="line"><a name="l09852"></a><span class="lineno"> 9852</span>&#160;                                       : &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getEntryBlock().front());</div>
<div class="line"><a name="l09853"></a><span class="lineno"> 9853</span>&#160;  <span class="keyword">auto</span> *VectorRoot = vectorizeTree(VectorizableTree[0].<a class="code" href="namespacellvm.html#a73257f51950d9ea50955e3fb9c724a25">get</a>());</div>
<div class="line"><a name="l09854"></a><span class="lineno"> 9854</span>&#160; </div>
<div class="line"><a name="l09855"></a><span class="lineno"> 9855</span>&#160;  <span class="comment">// If the vectorized tree can be rewritten in a smaller type, we truncate the</span></div>
<div class="line"><a name="l09856"></a><span class="lineno"> 9856</span>&#160;  <span class="comment">// vectorized root. InstCombine will then rewrite the entire expression. We</span></div>
<div class="line"><a name="l09857"></a><span class="lineno"> 9857</span>&#160;  <span class="comment">// sign extend the extracted values below.</span></div>
<div class="line"><a name="l09858"></a><span class="lineno"> 9858</span>&#160;  <span class="keyword">auto</span> *ScalarRoot = VectorizableTree[0]-&gt;Scalars[0];</div>
<div class="line"><a name="l09859"></a><span class="lineno"> 9859</span>&#160;  <span class="keywordflow">if</span> (MinBWs.count(ScalarRoot)) {</div>
<div class="line"><a name="l09860"></a><span class="lineno"> 9860</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(VectorRoot)) {</div>
<div class="line"><a name="l09861"></a><span class="lineno"> 9861</span>&#160;      <span class="comment">// If current instr is a phi and not the last phi, insert it after the</span></div>
<div class="line"><a name="l09862"></a><span class="lineno"> 9862</span>&#160;      <span class="comment">// last phi node.</span></div>
<div class="line"><a name="l09863"></a><span class="lineno"> 9863</span>&#160;      <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l09864"></a><span class="lineno"> 9864</span>&#160;        <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(&amp;*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()-&gt;getFirstInsertionPt());</div>
<div class="line"><a name="l09865"></a><span class="lineno"> 9865</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l09866"></a><span class="lineno"> 9866</span>&#160;        <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(&amp;*++<a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</div>
<div class="line"><a name="l09867"></a><span class="lineno"> 9867</span>&#160;    }</div>
<div class="line"><a name="l09868"></a><span class="lineno"> 9868</span>&#160;    <span class="keyword">auto</span> BundleWidth = VectorizableTree[0]-&gt;Scalars.size();</div>
<div class="line"><a name="l09869"></a><span class="lineno"> 9869</span>&#160;    <span class="keyword">auto</span> *MinTy = <a class="code" href="classllvm_1_1IntegerType.html#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getContext(), MinBWs[ScalarRoot].first);</div>
<div class="line"><a name="l09870"></a><span class="lineno"> 9870</span>&#160;    <span class="keyword">auto</span> *VecTy = <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(MinTy, BundleWidth);</div>
<div class="line"><a name="l09871"></a><span class="lineno"> 9871</span>&#160;    <span class="keyword">auto</span> *Trunc = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateTrunc(VectorRoot, VecTy);</div>
<div class="line"><a name="l09872"></a><span class="lineno"> 9872</span>&#160;    VectorizableTree[0]-&gt;VectorizedValue = Trunc;</div>
<div class="line"><a name="l09873"></a><span class="lineno"> 9873</span>&#160;  }</div>
<div class="line"><a name="l09874"></a><span class="lineno"> 9874</span>&#160; </div>
<div class="line"><a name="l09875"></a><span class="lineno"> 9875</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Extracting &quot;</span> &lt;&lt; ExternalUses.size()</div>
<div class="line"><a name="l09876"></a><span class="lineno"> 9876</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; values .\n&quot;</span>);</div>
<div class="line"><a name="l09877"></a><span class="lineno"> 9877</span>&#160; </div>
<div class="line"><a name="l09878"></a><span class="lineno"> 9878</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;ShuffledInsertData&gt;</a> ShuffledInserts;</div>
<div class="line"><a name="l09879"></a><span class="lineno"> 9879</span>&#160;  <span class="comment">// Maps vector instruction to original insertelement instruction</span></div>
<div class="line"><a name="l09880"></a><span class="lineno"> 9880</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, InsertElementInst *&gt;</a> VectorToInsertElement;</div>
<div class="line"><a name="l09881"></a><span class="lineno"> 9881</span>&#160;  <span class="comment">// Maps extract Scalar to the corresponding extractelement instruction in the</span></div>
<div class="line"><a name="l09882"></a><span class="lineno"> 9882</span>&#160;  <span class="comment">// basic block. Only one extractelement per block should be emitted.</span></div>
<div class="line"><a name="l09883"></a><span class="lineno"> 9883</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, DenseMap&lt;BasicBlock *, Instruction *&gt;</a>&gt; ScalarToEEs;</div>
<div class="line"><a name="l09884"></a><span class="lineno"> 9884</span>&#160;  <span class="comment">// Extract all of the elements with the external uses.</span></div>
<div class="line"><a name="l09885"></a><span class="lineno"> 9885</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;ExternalUse : ExternalUses) {</div>
<div class="line"><a name="l09886"></a><span class="lineno"> 9886</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a> = ExternalUse.Scalar;</div>
<div class="line"><a name="l09887"></a><span class="lineno"> 9887</span>&#160;    <a class="code" href="classllvm_1_1User.html">llvm::User</a> *<a class="code" href="classllvm_1_1User.html">User</a> = ExternalUse.<a class="code" href="classllvm_1_1User.html#a171cb6c09b8e26e80eb13a55a5fd6dfe">User</a>;</div>
<div class="line"><a name="l09888"></a><span class="lineno"> 9888</span>&#160; </div>
<div class="line"><a name="l09889"></a><span class="lineno"> 9889</span>&#160;    <span class="comment">// Skip users that we already RAUW. This happens when one instruction</span></div>
<div class="line"><a name="l09890"></a><span class="lineno"> 9890</span>&#160;    <span class="comment">// has multiple uses of the same value.</span></div>
<div class="line"><a name="l09891"></a><span class="lineno"> 9891</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1User.html">User</a> &amp;&amp; !<a class="code" href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">is_contained</a>(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a>-&gt;users(), <a class="code" href="classllvm_1_1User.html">User</a>))</div>
<div class="line"><a name="l09892"></a><span class="lineno"> 9892</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l09893"></a><span class="lineno"> 9893</span>&#160;    TreeEntry *<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = getTreeEntry(Scalar);</div>
<div class="line"><a name="l09894"></a><span class="lineno"> 9894</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> &amp;&amp; <span class="stringliteral">&quot;Invalid scalar&quot;</span>);</div>
<div class="line"><a name="l09895"></a><span class="lineno"> 9895</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;State != TreeEntry::NeedToGather &amp;&amp;</div>
<div class="line"><a name="l09896"></a><span class="lineno"> 9896</span>&#160;           <span class="stringliteral">&quot;Extracting from a gather list&quot;</span>);</div>
<div class="line"><a name="l09897"></a><span class="lineno"> 9897</span>&#160;    <span class="comment">// Non-instruction pointers are not deleted, just skip them.</span></div>
<div class="line"><a name="l09898"></a><span class="lineno"> 9898</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;getOpcode() == Instruction::GetElementPtr &amp;&amp;</div>
<div class="line"><a name="l09899"></a><span class="lineno"> 9899</span>&#160;        !isa&lt;GetElementPtrInst&gt;(Scalar))</div>
<div class="line"><a name="l09900"></a><span class="lineno"> 9900</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l09901"></a><span class="lineno"> 9901</span>&#160; </div>
<div class="line"><a name="l09902"></a><span class="lineno"> 9902</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Vec = <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;VectorizedValue;</div>
<div class="line"><a name="l09903"></a><span class="lineno"> 9903</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Vec &amp;&amp; <span class="stringliteral">&quot;Can&#39;t find vectorizable value&quot;</span>);</div>
<div class="line"><a name="l09904"></a><span class="lineno"> 9904</span>&#160; </div>
<div class="line"><a name="l09905"></a><span class="lineno"> 9905</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Lane = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt32(ExternalUse.Lane);</div>
<div class="line"><a name="l09906"></a><span class="lineno"> 9906</span>&#160;    <span class="keyword">auto</span> ExtractAndExtendIfNeeded = [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *Vec) {</div>
<div class="line"><a name="l09907"></a><span class="lineno"> 9907</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a>-&gt;getType() != Vec-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()) {</div>
<div class="line"><a name="l09908"></a><span class="lineno"> 9908</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *Ex = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l09909"></a><span class="lineno"> 9909</span>&#160;        <span class="keyword">auto</span> It = ScalarToEEs.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(Scalar);</div>
<div class="line"><a name="l09910"></a><span class="lineno"> 9910</span>&#160;        <span class="keywordflow">if</span> (It != ScalarToEEs.<a class="code" href="classllvm_1_1DenseMapBase.html#a65520b9c67759099e313d0f4e7b5ff9e">end</a>()) {</div>
<div class="line"><a name="l09911"></a><span class="lineno"> 9911</span>&#160;          <span class="comment">// No need to emit many extracts, just move the only one in the</span></div>
<div class="line"><a name="l09912"></a><span class="lineno"> 9912</span>&#160;          <span class="comment">// current block.</span></div>
<div class="line"><a name="l09913"></a><span class="lineno"> 9913</span>&#160;          <span class="keyword">auto</span> EEIt = It-&gt;second.find(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.GetInsertBlock());</div>
<div class="line"><a name="l09914"></a><span class="lineno"> 9914</span>&#160;          <span class="keywordflow">if</span> (EEIt != It-&gt;second.end()) {</div>
<div class="line"><a name="l09915"></a><span class="lineno"> 9915</span>&#160;            <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = EEIt-&gt;second;</div>
<div class="line"><a name="l09916"></a><span class="lineno"> 9916</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.GetInsertPoint() != <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.GetInsertBlock()-&gt;end() &amp;&amp;</div>
<div class="line"><a name="l09917"></a><span class="lineno"> 9917</span>&#160;                <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.GetInsertPoint()-&gt;comesBefore(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l09918"></a><span class="lineno"> 9918</span>&#160;              <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;moveBefore(&amp;*<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.GetInsertPoint());</div>
<div class="line"><a name="l09919"></a><span class="lineno"> 9919</span>&#160;            Ex = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l09920"></a><span class="lineno"> 9920</span>&#160;          }</div>
<div class="line"><a name="l09921"></a><span class="lineno"> 9921</span>&#160;        }</div>
<div class="line"><a name="l09922"></a><span class="lineno"> 9922</span>&#160;        <span class="keywordflow">if</span> (!Ex) {</div>
<div class="line"><a name="l09923"></a><span class="lineno"> 9923</span>&#160;          <span class="comment">// &quot;Reuse&quot; the existing extract to improve final codegen.</span></div>
<div class="line"><a name="l09924"></a><span class="lineno"> 9924</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">auto</span> *ES = dyn_cast&lt;ExtractElementInst&gt;(Scalar)) {</div>
<div class="line"><a name="l09925"></a><span class="lineno"> 9925</span>&#160;            Ex = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateExtractElement(ES-&gt;getOperand(0),</div>
<div class="line"><a name="l09926"></a><span class="lineno"> 9926</span>&#160;                                              ES-&gt;getOperand(1));</div>
<div class="line"><a name="l09927"></a><span class="lineno"> 9927</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l09928"></a><span class="lineno"> 9928</span>&#160;            Ex = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateExtractElement(Vec, Lane);</div>
<div class="line"><a name="l09929"></a><span class="lineno"> 9929</span>&#160;          }</div>
<div class="line"><a name="l09930"></a><span class="lineno"> 9930</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(Ex))</div>
<div class="line"><a name="l09931"></a><span class="lineno"> 9931</span>&#160;            ScalarToEEs[Scalar].try_emplace(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.GetInsertBlock(), <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l09932"></a><span class="lineno"> 9932</span>&#160;        }</div>
<div class="line"><a name="l09933"></a><span class="lineno"> 9933</span>&#160;        <span class="comment">// The then branch of the previous if may produce constants, since 0</span></div>
<div class="line"><a name="l09934"></a><span class="lineno"> 9934</span>&#160;        <span class="comment">// operand might be a constant.</span></div>
<div class="line"><a name="l09935"></a><span class="lineno"> 9935</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *ExI = dyn_cast&lt;Instruction&gt;(Ex)) {</div>
<div class="line"><a name="l09936"></a><span class="lineno"> 9936</span>&#160;          GatherShuffleExtractSeq.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(ExI);</div>
<div class="line"><a name="l09937"></a><span class="lineno"> 9937</span>&#160;          CSEBlocks.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(ExI-&gt;getParent());</div>
<div class="line"><a name="l09938"></a><span class="lineno"> 9938</span>&#160;        }</div>
<div class="line"><a name="l09939"></a><span class="lineno"> 9939</span>&#160;        <span class="comment">// If necessary, sign-extend or zero-extend ScalarRoot</span></div>
<div class="line"><a name="l09940"></a><span class="lineno"> 9940</span>&#160;        <span class="comment">// to the larger type.</span></div>
<div class="line"><a name="l09941"></a><span class="lineno"> 9941</span>&#160;        <span class="keywordflow">if</span> (!MinBWs.count(ScalarRoot))</div>
<div class="line"><a name="l09942"></a><span class="lineno"> 9942</span>&#160;          <span class="keywordflow">return</span> Ex;</div>
<div class="line"><a name="l09943"></a><span class="lineno"> 9943</span>&#160;        <span class="keywordflow">if</span> (MinBWs[ScalarRoot].second)</div>
<div class="line"><a name="l09944"></a><span class="lineno"> 9944</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSExt(Ex, <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a>-&gt;getType());</div>
<div class="line"><a name="l09945"></a><span class="lineno"> 9945</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateZExt(Ex, <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a>-&gt;getType());</div>
<div class="line"><a name="l09946"></a><span class="lineno"> 9946</span>&#160;      }</div>
<div class="line"><a name="l09947"></a><span class="lineno"> 9947</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isa&lt;FixedVectorType&gt;(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a>-&gt;getType()) &amp;&amp;</div>
<div class="line"><a name="l09948"></a><span class="lineno"> 9948</span>&#160;             isa&lt;InsertElementInst&gt;(Scalar) &amp;&amp;</div>
<div class="line"><a name="l09949"></a><span class="lineno"> 9949</span>&#160;             <span class="stringliteral">&quot;In-tree scalar of vector type is not insertelement?&quot;</span>);</div>
<div class="line"><a name="l09950"></a><span class="lineno"> 9950</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a> = cast&lt;InsertElementInst&gt;(Scalar);</div>
<div class="line"><a name="l09951"></a><span class="lineno"> 9951</span>&#160;      VectorToInsertElement.<a class="code" href="classllvm_1_1DenseMapBase.html#a98c685a0c53f3f7ed5f4793890a6c850">try_emplace</a>(Vec, <a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>);</div>
<div class="line"><a name="l09952"></a><span class="lineno"> 9952</span>&#160;      <span class="keywordflow">return</span> Vec;</div>
<div class="line"><a name="l09953"></a><span class="lineno"> 9953</span>&#160;    };</div>
<div class="line"><a name="l09954"></a><span class="lineno"> 9954</span>&#160;    <span class="comment">// If User == nullptr, the Scalar is used as extra arg. Generate</span></div>
<div class="line"><a name="l09955"></a><span class="lineno"> 9955</span>&#160;    <span class="comment">// ExtractElement instruction and update the record for this scalar in</span></div>
<div class="line"><a name="l09956"></a><span class="lineno"> 9956</span>&#160;    <span class="comment">// ExternallyUsedValues.</span></div>
<div class="line"><a name="l09957"></a><span class="lineno"> 9957</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classllvm_1_1User.html">User</a>) {</div>
<div class="line"><a name="l09958"></a><span class="lineno"> 9958</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ExternallyUsedValues.count(Scalar) &amp;&amp;</div>
<div class="line"><a name="l09959"></a><span class="lineno"> 9959</span>&#160;             <span class="stringliteral">&quot;Scalar with nullptr as an external user must be registered in &quot;</span></div>
<div class="line"><a name="l09960"></a><span class="lineno"> 9960</span>&#160;             <span class="stringliteral">&quot;ExternallyUsedValues map&quot;</span>);</div>
<div class="line"><a name="l09961"></a><span class="lineno"> 9961</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *VecI = dyn_cast&lt;Instruction&gt;(Vec)) {</div>
<div class="line"><a name="l09962"></a><span class="lineno"> 9962</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = dyn_cast&lt;PHINode&gt;(VecI))</div>
<div class="line"><a name="l09963"></a><span class="lineno"> 9963</span>&#160;          <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getParent()-&gt;getFirstNonPHI());</div>
<div class="line"><a name="l09964"></a><span class="lineno"> 9964</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l09965"></a><span class="lineno"> 9965</span>&#160;          <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(VecI-&gt;getParent(),</div>
<div class="line"><a name="l09966"></a><span class="lineno"> 9966</span>&#160;                                 std::next(VecI-&gt;getIterator()));</div>
<div class="line"><a name="l09967"></a><span class="lineno"> 9967</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l09968"></a><span class="lineno"> 9968</span>&#160;        <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(&amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getEntryBlock().front());</div>
<div class="line"><a name="l09969"></a><span class="lineno"> 9969</span>&#160;      }</div>
<div class="line"><a name="l09970"></a><span class="lineno"> 9970</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *NewInst = ExtractAndExtendIfNeeded(Vec);</div>
<div class="line"><a name="l09971"></a><span class="lineno"> 9971</span>&#160;      <span class="keyword">auto</span> &amp;NewInstLocs = ExternallyUsedValues[NewInst];</div>
<div class="line"><a name="l09972"></a><span class="lineno"> 9972</span>&#160;      <span class="keyword">auto</span> It = ExternallyUsedValues.find(Scalar);</div>
<div class="line"><a name="l09973"></a><span class="lineno"> 9973</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(It != ExternallyUsedValues.end() &amp;&amp;</div>
<div class="line"><a name="l09974"></a><span class="lineno"> 9974</span>&#160;             <span class="stringliteral">&quot;Externally used scalar is not found in ExternallyUsedValues&quot;</span>);</div>
<div class="line"><a name="l09975"></a><span class="lineno"> 9975</span>&#160;      NewInstLocs.append(It-&gt;second);</div>
<div class="line"><a name="l09976"></a><span class="lineno"> 9976</span>&#160;      ExternallyUsedValues.erase(Scalar);</div>
<div class="line"><a name="l09977"></a><span class="lineno"> 9977</span>&#160;      <span class="comment">// Required to update internally referenced instructions.</span></div>
<div class="line"><a name="l09978"></a><span class="lineno"> 9978</span>&#160;      <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a>-&gt;replaceAllUsesWith(NewInst);</div>
<div class="line"><a name="l09979"></a><span class="lineno"> 9979</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l09980"></a><span class="lineno"> 9980</span>&#160;    }</div>
<div class="line"><a name="l09981"></a><span class="lineno"> 9981</span>&#160; </div>
<div class="line"><a name="l09982"></a><span class="lineno"> 9982</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *VU = dyn_cast&lt;InsertElementInst&gt;(<a class="code" href="classllvm_1_1User.html">User</a>)) {</div>
<div class="line"><a name="l09983"></a><span class="lineno"> 9983</span>&#160;      <span class="comment">// Skip if the scalar is another vector op or Vec is not an instruction.</span></div>
<div class="line"><a name="l09984"></a><span class="lineno"> 9984</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a>-&gt;getType()-&gt;isVectorTy() &amp;&amp; isa&lt;Instruction&gt;(Vec)) {</div>
<div class="line"><a name="l09985"></a><span class="lineno"> 9985</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *FTy = dyn_cast&lt;FixedVectorType&gt;(<a class="code" href="classllvm_1_1User.html">User</a>-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())) {</div>
<div class="line"><a name="l09986"></a><span class="lineno"> 9986</span>&#160;          std::optional&lt;unsigned&gt; InsertIdx = <a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(VU);</div>
<div class="line"><a name="l09987"></a><span class="lineno"> 9987</span>&#160;          <span class="keywordflow">if</span> (InsertIdx) {</div>
<div class="line"><a name="l09988"></a><span class="lineno"> 9988</span>&#160;            <span class="comment">// Need to use original vector, if the root is truncated.</span></div>
<div class="line"><a name="l09989"></a><span class="lineno"> 9989</span>&#160;            <span class="keywordflow">if</span> (MinBWs.count(Scalar) &amp;&amp;</div>
<div class="line"><a name="l09990"></a><span class="lineno"> 9990</span>&#160;                VectorizableTree[0]-&gt;VectorizedValue == Vec)</div>
<div class="line"><a name="l09991"></a><span class="lineno"> 9991</span>&#160;              Vec = VectorRoot;</div>
<div class="line"><a name="l09992"></a><span class="lineno"> 9992</span>&#160;            <span class="keyword">auto</span> *It =</div>
<div class="line"><a name="l09993"></a><span class="lineno"> 9993</span>&#160;                <a class="code" href="namespacellvm.html#ac78c09ae232b2ce188ff590d51e3c268">find_if</a>(ShuffledInserts, [VU](<span class="keyword">const</span> ShuffledInsertData &amp;Data) {</div>
<div class="line"><a name="l09994"></a><span class="lineno"> 9994</span>&#160;                  <span class="comment">// Checks if 2 insertelements are from the same buildvector.</span></div>
<div class="line"><a name="l09995"></a><span class="lineno"> 9995</span>&#160;                  <a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> *<a class="code" href="namespacellvm_1_1NVPTX.html#a4faf1254f7468faf963b328603a1463ea6bf6e930014478ac74fdd6d309cc9004">VecInsert</a> = <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.InsertElements.front();</div>
<div class="line"><a name="l09996"></a><span class="lineno"> 9996</span>&#160;                  <span class="keywordflow">return</span> <a class="code" href="SLPVectorizer_8cpp.html#abe6927d96b3815417479246b5afc732e">areTwoInsertFromSameBuildVector</a>(</div>
<div class="line"><a name="l09997"></a><span class="lineno"> 9997</span>&#160;                      VU, <a class="code" href="namespacellvm_1_1NVPTX.html#a4faf1254f7468faf963b328603a1463ea6bf6e930014478ac74fdd6d309cc9004">VecInsert</a>,</div>
<div class="line"><a name="l09998"></a><span class="lineno"> 9998</span>&#160;                      [](<a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> *II) { <span class="keywordflow">return</span> II-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0); });</div>
<div class="line"><a name="l09999"></a><span class="lineno"> 9999</span>&#160;                });</div>
<div class="line"><a name="l10000"></a><span class="lineno">10000</span>&#160;            <span class="keywordtype">unsigned</span> Idx = *InsertIdx;</div>
<div class="line"><a name="l10001"></a><span class="lineno">10001</span>&#160;            <span class="keywordflow">if</span> (It == ShuffledInserts.end()) {</div>
<div class="line"><a name="l10002"></a><span class="lineno">10002</span>&#160;              (void)ShuffledInserts.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>();</div>
<div class="line"><a name="l10003"></a><span class="lineno">10003</span>&#160;              It = std::next(ShuffledInserts.begin(),</div>
<div class="line"><a name="l10004"></a><span class="lineno">10004</span>&#160;                             ShuffledInserts.size() - 1);</div>
<div class="line"><a name="l10005"></a><span class="lineno">10005</span>&#160;              <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;int&gt;</a> &amp;<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a> = It-&gt;ValueMasks[Vec];</div>
<div class="line"><a name="l10006"></a><span class="lineno">10006</span>&#160;              <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.empty())</div>
<div class="line"><a name="l10007"></a><span class="lineno">10007</span>&#160;                <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.assign(FTy-&gt;getNumElements(), <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l10008"></a><span class="lineno">10008</span>&#160;              <span class="comment">// Find the insertvector, vectorized in tree, if any.</span></div>
<div class="line"><a name="l10009"></a><span class="lineno">10009</span>&#160;              <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = VU;</div>
<div class="line"><a name="l10010"></a><span class="lineno">10010</span>&#160;              <span class="keywordflow">while</span> (<span class="keyword">auto</span> *IEBase = dyn_cast&lt;InsertElementInst&gt;(Base)) {</div>
<div class="line"><a name="l10011"></a><span class="lineno">10011</span>&#160;                <span class="keywordflow">if</span> (IEBase != <a class="code" href="classllvm_1_1User.html">User</a> &amp;&amp;</div>
<div class="line"><a name="l10012"></a><span class="lineno">10012</span>&#160;                    (!IEBase-&gt;hasOneUse() ||</div>
<div class="line"><a name="l10013"></a><span class="lineno">10013</span>&#160;                     <a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(IEBase).value_or(Idx) == Idx))</div>
<div class="line"><a name="l10014"></a><span class="lineno">10014</span>&#160;                  <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l10015"></a><span class="lineno">10015</span>&#160;                <span class="comment">// Build the mask for the vectorized insertelement instructions.</span></div>
<div class="line"><a name="l10016"></a><span class="lineno">10016</span>&#160;                <span class="keywordflow">if</span> (<span class="keyword">const</span> TreeEntry *<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = getTreeEntry(IEBase)) {</div>
<div class="line"><a name="l10017"></a><span class="lineno">10017</span>&#160;                  <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l10018"></a><span class="lineno">10018</span>&#160;                    IEBase = cast&lt;InsertElementInst&gt;(Base);</div>
<div class="line"><a name="l10019"></a><span class="lineno">10019</span>&#160;                    <span class="keywordtype">int</span> IEIdx = *<a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(IEBase);</div>
<div class="line"><a name="l10020"></a><span class="lineno">10020</span>&#160;                    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[Idx] == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a> &amp;&amp;</div>
<div class="line"><a name="l10021"></a><span class="lineno">10021</span>&#160;                           <span class="stringliteral">&quot;InsertElementInstruction used already.&quot;</span>);</div>
<div class="line"><a name="l10022"></a><span class="lineno">10022</span>&#160;                    <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[IEIdx] = IEIdx;</div>
<div class="line"><a name="l10023"></a><span class="lineno">10023</span>&#160;                    <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = IEBase-&gt;getOperand(0);</div>
<div class="line"><a name="l10024"></a><span class="lineno">10024</span>&#160;                  } <span class="keywordflow">while</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> == getTreeEntry(Base));</div>
<div class="line"><a name="l10025"></a><span class="lineno">10025</span>&#160;                  <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l10026"></a><span class="lineno">10026</span>&#160;                }</div>
<div class="line"><a name="l10027"></a><span class="lineno">10027</span>&#160;                <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = cast&lt;InsertElementInst&gt;(Base)-&gt;getOperand(0);</div>
<div class="line"><a name="l10028"></a><span class="lineno">10028</span>&#160;                <span class="comment">// After the vectorization the def-use chain has changed, need</span></div>
<div class="line"><a name="l10029"></a><span class="lineno">10029</span>&#160;                <span class="comment">// to look through original insertelement instructions, if they</span></div>
<div class="line"><a name="l10030"></a><span class="lineno">10030</span>&#160;                <span class="comment">// get replaced by vector instructions.</span></div>
<div class="line"><a name="l10031"></a><span class="lineno">10031</span>&#160;                <span class="keyword">auto</span> It = VectorToInsertElement.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(Base);</div>
<div class="line"><a name="l10032"></a><span class="lineno">10032</span>&#160;                <span class="keywordflow">if</span> (It != VectorToInsertElement.<a class="code" href="classllvm_1_1DenseMapBase.html#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</div>
<div class="line"><a name="l10033"></a><span class="lineno">10033</span>&#160;                  <a class="code" href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = It-&gt;second;</div>
<div class="line"><a name="l10034"></a><span class="lineno">10034</span>&#160;              }</div>
<div class="line"><a name="l10035"></a><span class="lineno">10035</span>&#160;            }</div>
<div class="line"><a name="l10036"></a><span class="lineno">10036</span>&#160;            <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;int&gt;</a> &amp;<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a> = It-&gt;ValueMasks[Vec];</div>
<div class="line"><a name="l10037"></a><span class="lineno">10037</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.empty())</div>
<div class="line"><a name="l10038"></a><span class="lineno">10038</span>&#160;              <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.assign(FTy-&gt;getNumElements(), <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l10039"></a><span class="lineno">10039</span>&#160;            <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[Idx] = ExternalUse.Lane;</div>
<div class="line"><a name="l10040"></a><span class="lineno">10040</span>&#160;            It-&gt;InsertElements.push_back(cast&lt;InsertElementInst&gt;(<a class="code" href="classllvm_1_1User.html">User</a>));</div>
<div class="line"><a name="l10041"></a><span class="lineno">10041</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l10042"></a><span class="lineno">10042</span>&#160;          }</div>
<div class="line"><a name="l10043"></a><span class="lineno">10043</span>&#160;        }</div>
<div class="line"><a name="l10044"></a><span class="lineno">10044</span>&#160;      }</div>
<div class="line"><a name="l10045"></a><span class="lineno">10045</span>&#160;    }</div>
<div class="line"><a name="l10046"></a><span class="lineno">10046</span>&#160; </div>
<div class="line"><a name="l10047"></a><span class="lineno">10047</span>&#160;    <span class="comment">// Generate extracts for out-of-tree users.</span></div>
<div class="line"><a name="l10048"></a><span class="lineno">10048</span>&#160;    <span class="comment">// Find the insertion point for the extractelement lane.</span></div>
<div class="line"><a name="l10049"></a><span class="lineno">10049</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *VecI = dyn_cast&lt;Instruction&gt;(Vec)) {</div>
<div class="line"><a name="l10050"></a><span class="lineno">10050</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PH = dyn_cast&lt;PHINode&gt;(<a class="code" href="classllvm_1_1User.html">User</a>)) {</div>
<div class="line"><a name="l10051"></a><span class="lineno">10051</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = PH-&gt;getNumIncomingValues(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l10052"></a><span class="lineno">10052</span>&#160;          <span class="keywordflow">if</span> (PH-&gt;getIncomingValue(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) == Scalar) {</div>
<div class="line"><a name="l10053"></a><span class="lineno">10053</span>&#160;            <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *IncomingTerminator =</div>
<div class="line"><a name="l10054"></a><span class="lineno">10054</span>&#160;                PH-&gt;getIncomingBlock(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;getTerminator();</div>
<div class="line"><a name="l10055"></a><span class="lineno">10055</span>&#160;            <span class="keywordflow">if</span> (isa&lt;CatchSwitchInst&gt;(IncomingTerminator)) {</div>
<div class="line"><a name="l10056"></a><span class="lineno">10056</span>&#160;              <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(VecI-&gt;getParent(),</div>
<div class="line"><a name="l10057"></a><span class="lineno">10057</span>&#160;                                     std::next(VecI-&gt;getIterator()));</div>
<div class="line"><a name="l10058"></a><span class="lineno">10058</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l10059"></a><span class="lineno">10059</span>&#160;              <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(PH-&gt;getIncomingBlock(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;getTerminator());</div>
<div class="line"><a name="l10060"></a><span class="lineno">10060</span>&#160;            }</div>
<div class="line"><a name="l10061"></a><span class="lineno">10061</span>&#160;            <a class="code" href="classllvm_1_1Value.html">Value</a> *NewInst = ExtractAndExtendIfNeeded(Vec);</div>
<div class="line"><a name="l10062"></a><span class="lineno">10062</span>&#160;            PH-&gt;setOperand(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>, NewInst);</div>
<div class="line"><a name="l10063"></a><span class="lineno">10063</span>&#160;          }</div>
<div class="line"><a name="l10064"></a><span class="lineno">10064</span>&#160;        }</div>
<div class="line"><a name="l10065"></a><span class="lineno">10065</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l10066"></a><span class="lineno">10066</span>&#160;        <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(cast&lt;Instruction&gt;(<a class="code" href="classllvm_1_1User.html">User</a>));</div>
<div class="line"><a name="l10067"></a><span class="lineno">10067</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *NewInst = ExtractAndExtendIfNeeded(Vec);</div>
<div class="line"><a name="l10068"></a><span class="lineno">10068</span>&#160;        <a class="code" href="classllvm_1_1User.html">User</a>-&gt;<a class="code" href="classllvm_1_1User.html#a1600c7959045cb6b6a5f5a1d427ec67e">replaceUsesOfWith</a>(Scalar, NewInst);</div>
<div class="line"><a name="l10069"></a><span class="lineno">10069</span>&#160;      }</div>
<div class="line"><a name="l10070"></a><span class="lineno">10070</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l10071"></a><span class="lineno">10071</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(&amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getEntryBlock().front());</div>
<div class="line"><a name="l10072"></a><span class="lineno">10072</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *NewInst = ExtractAndExtendIfNeeded(Vec);</div>
<div class="line"><a name="l10073"></a><span class="lineno">10073</span>&#160;      <a class="code" href="classllvm_1_1User.html">User</a>-&gt;<a class="code" href="classllvm_1_1User.html#a1600c7959045cb6b6a5f5a1d427ec67e">replaceUsesOfWith</a>(Scalar, NewInst);</div>
<div class="line"><a name="l10074"></a><span class="lineno">10074</span>&#160;    }</div>
<div class="line"><a name="l10075"></a><span class="lineno">10075</span>&#160; </div>
<div class="line"><a name="l10076"></a><span class="lineno">10076</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Replaced:&quot;</span> &lt;&lt; *<a class="code" href="classllvm_1_1User.html">User</a> &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l10077"></a><span class="lineno">10077</span>&#160;  }</div>
<div class="line"><a name="l10078"></a><span class="lineno">10078</span>&#160; </div>
<div class="line"><a name="l10079"></a><span class="lineno">10079</span>&#160;  <span class="keyword">auto</span> CreateShuffle = [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *V1, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>) {</div>
<div class="line"><a name="l10080"></a><span class="lineno">10080</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> CombinedMask1(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size(), <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l10081"></a><span class="lineno">10081</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> CombinedMask2(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size(), <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l10082"></a><span class="lineno">10082</span>&#160;    <span class="keywordtype">int</span> VF = cast&lt;FixedVectorType&gt;(V1-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getNumElements();</div>
<div class="line"><a name="l10083"></a><span class="lineno">10083</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l10084"></a><span class="lineno">10084</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] &lt; VF)</div>
<div class="line"><a name="l10085"></a><span class="lineno">10085</span>&#160;        CombinedMask1[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l10086"></a><span class="lineno">10086</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l10087"></a><span class="lineno">10087</span>&#160;        CombinedMask2[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] - VF;</div>
<div class="line"><a name="l10088"></a><span class="lineno">10088</span>&#160;    }</div>
<div class="line"><a name="l10089"></a><span class="lineno">10089</span>&#160;    ShuffleInstructionBuilder ShuffleBuilder(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, *<span class="keyword">this</span>);</div>
<div class="line"><a name="l10090"></a><span class="lineno">10090</span>&#160;    ShuffleBuilder.add(V1, CombinedMask1);</div>
<div class="line"><a name="l10091"></a><span class="lineno">10091</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>)</div>
<div class="line"><a name="l10092"></a><span class="lineno">10092</span>&#160;      ShuffleBuilder.add(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>, CombinedMask2);</div>
<div class="line"><a name="l10093"></a><span class="lineno">10093</span>&#160;    <span class="keywordflow">return</span> ShuffleBuilder.finalize(std::nullopt);</div>
<div class="line"><a name="l10094"></a><span class="lineno">10094</span>&#160;  };</div>
<div class="line"><a name="l10095"></a><span class="lineno">10095</span>&#160; </div>
<div class="line"><a name="l10096"></a><span class="lineno">10096</span>&#160;  <span class="keyword">auto</span> &amp;&amp;ResizeToVF = [&amp;CreateShuffle](<a class="code" href="classllvm_1_1Value.html">Value</a> *Vec, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>,</div>
<div class="line"><a name="l10097"></a><span class="lineno">10097</span>&#160;                                       <span class="keywordtype">bool</span> ForSingleMask) {</div>
<div class="line"><a name="l10098"></a><span class="lineno">10098</span>&#160;    <span class="keywordtype">unsigned</span> VF = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size();</div>
<div class="line"><a name="l10099"></a><span class="lineno">10099</span>&#160;    <span class="keywordtype">unsigned</span> VecVF = cast&lt;FixedVectorType&gt;(Vec-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getNumElements();</div>
<div class="line"><a name="l10100"></a><span class="lineno">10100</span>&#160;    <span class="keywordflow">if</span> (VF != VecVF) {</div>
<div class="line"><a name="l10101"></a><span class="lineno">10101</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, [VF](<span class="keywordtype">int</span> Idx) { <span class="keywordflow">return</span> Idx &gt;= <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(VF); })) {</div>
<div class="line"><a name="l10102"></a><span class="lineno">10102</span>&#160;        Vec = CreateShuffle(Vec, <span class="keyword">nullptr</span>, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l10103"></a><span class="lineno">10103</span>&#160;        <span class="keywordflow">return</span> std::make_pair(Vec, <span class="keyword">true</span>);</div>
<div class="line"><a name="l10104"></a><span class="lineno">10104</span>&#160;      }</div>
<div class="line"><a name="l10105"></a><span class="lineno">10105</span>&#160;      <span class="keywordflow">if</span> (!ForSingleMask) {</div>
<div class="line"><a name="l10106"></a><span class="lineno">10106</span>&#160;        <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> ResizeMask(VF, <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>);</div>
<div class="line"><a name="l10107"></a><span class="lineno">10107</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; VF; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l10108"></a><span class="lineno">10108</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] != <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l10109"></a><span class="lineno">10109</span>&#160;            ResizeMask[<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]] = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l10110"></a><span class="lineno">10110</span>&#160;        }</div>
<div class="line"><a name="l10111"></a><span class="lineno">10111</span>&#160;        Vec = CreateShuffle(Vec, <span class="keyword">nullptr</span>, ResizeMask);</div>
<div class="line"><a name="l10112"></a><span class="lineno">10112</span>&#160;      }</div>
<div class="line"><a name="l10113"></a><span class="lineno">10113</span>&#160;    }</div>
<div class="line"><a name="l10114"></a><span class="lineno">10114</span>&#160; </div>
<div class="line"><a name="l10115"></a><span class="lineno">10115</span>&#160;    <span class="keywordflow">return</span> std::make_pair(Vec, <span class="keyword">false</span>);</div>
<div class="line"><a name="l10116"></a><span class="lineno">10116</span>&#160;  };</div>
<div class="line"><a name="l10117"></a><span class="lineno">10117</span>&#160;  <span class="comment">// Perform shuffling of the vectorize tree entries for better handling of</span></div>
<div class="line"><a name="l10118"></a><span class="lineno">10118</span>&#160;  <span class="comment">// external extracts.</span></div>
<div class="line"><a name="l10119"></a><span class="lineno">10119</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = ShuffledInserts.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l10120"></a><span class="lineno">10120</span>&#160;    <span class="comment">// Find the first and the last instruction in the list of insertelements.</span></div>
<div class="line"><a name="l10121"></a><span class="lineno">10121</span>&#160;    <a class="code" href="namespacellvm.html#a74cdbd1e4f731e7d7cd83461b8b1de0b">sort</a>(ShuffledInserts[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].InsertElements, <a class="code" href="SLPVectorizer_8cpp.html#a405ff61e8571b58fecaa716540af108f">isFirstInsertElement</a>);</div>
<div class="line"><a name="l10122"></a><span class="lineno">10122</span>&#160;    <a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> *FirstInsert = ShuffledInserts[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].InsertElements.front();</div>
<div class="line"><a name="l10123"></a><span class="lineno">10123</span>&#160;    <a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> *LastInsert = ShuffledInserts[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].InsertElements.back();</div>
<div class="line"><a name="l10124"></a><span class="lineno">10124</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(LastInsert);</div>
<div class="line"><a name="l10125"></a><span class="lineno">10125</span>&#160;    <span class="keyword">auto</span> <a class="code" href="README__P9_8txt.html#ae6881514a39f1bcf75ad62e5188700a4">Vector</a> = ShuffledInserts[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].ValueMasks.takeVector();</div>
<div class="line"><a name="l10126"></a><span class="lineno">10126</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *NewInst = performExtractsShuffleAction&lt;Value&gt;(</div>
<div class="line"><a name="l10127"></a><span class="lineno">10127</span>&#160;        <a class="code" href="namespacellvm.html#a99416758c13252bef45320a6ba6aa09c">MutableArrayRef</a>(<a class="code" href="README__P9_8txt.html#ae6881514a39f1bcf75ad62e5188700a4">Vector</a>.data(), <a class="code" href="README__P9_8txt.html#ae6881514a39f1bcf75ad62e5188700a4">Vector</a>.size()),</div>
<div class="line"><a name="l10128"></a><span class="lineno">10128</span>&#160;        FirstInsert-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0),</div>
<div class="line"><a name="l10129"></a><span class="lineno">10129</span>&#160;        [](<a class="code" href="classllvm_1_1Value.html">Value</a> *Vec) {</div>
<div class="line"><a name="l10130"></a><span class="lineno">10130</span>&#160;          return cast&lt;VectorType&gt;(Vec-&gt;getType())</div>
<div class="line"><a name="l10131"></a><span class="lineno">10131</span>&#160;              -&gt;getElementCount()</div>
<div class="line"><a name="l10132"></a><span class="lineno">10132</span>&#160;              .getKnownMinValue();</div>
<div class="line"><a name="l10133"></a><span class="lineno">10133</span>&#160;        },</div>
<div class="line"><a name="l10134"></a><span class="lineno">10134</span>&#160;        ResizeToVF,</div>
<div class="line"><a name="l10135"></a><span class="lineno">10135</span>&#160;        [FirstInsert, &amp;CreateShuffle](<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>,</div>
<div class="line"><a name="l10136"></a><span class="lineno">10136</span>&#160;                                      <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> Vals) {</div>
<div class="line"><a name="l10137"></a><span class="lineno">10137</span>&#160;          assert((Vals.size() == 1 || Vals.size() == 2) &amp;&amp;</div>
<div class="line"><a name="l10138"></a><span class="lineno">10138</span>&#160;                 <span class="stringliteral">&quot;Expected exactly 1 or 2 input values.&quot;</span>);</div>
<div class="line"><a name="l10139"></a><span class="lineno">10139</span>&#160;          if (Vals.size() == 1) {</div>
<div class="line"><a name="l10140"></a><span class="lineno">10140</span>&#160;            <span class="comment">// Do not create shuffle if the mask is a simple identity</span></div>
<div class="line"><a name="l10141"></a><span class="lineno">10141</span>&#160;            <span class="comment">// non-resizing mask.</span></div>
<div class="line"><a name="l10142"></a><span class="lineno">10142</span>&#160;            if (Mask.size() != cast&lt;FixedVectorType&gt;(Vals.front()-&gt;getType())</div>
<div class="line"><a name="l10143"></a><span class="lineno">10143</span>&#160;                                   -&gt;getNumElements() ||</div>
<div class="line"><a name="l10144"></a><span class="lineno">10144</span>&#160;                !ShuffleVectorInst::isIdentityMask(Mask))</div>
<div class="line"><a name="l10145"></a><span class="lineno">10145</span>&#160;              return CreateShuffle(Vals.front(), nullptr, Mask);</div>
<div class="line"><a name="l10146"></a><span class="lineno">10146</span>&#160;            return Vals.front();</div>
<div class="line"><a name="l10147"></a><span class="lineno">10147</span>&#160;          }</div>
<div class="line"><a name="l10148"></a><span class="lineno">10148</span>&#160;          <span class="keywordflow">return</span> CreateShuffle(Vals.<a class="code" href="classllvm_1_1ArrayRef.html#a6bc2b53fce3b1d8975eea027d8a8eb90">front</a>() ? Vals.<a class="code" href="classllvm_1_1ArrayRef.html#a6bc2b53fce3b1d8975eea027d8a8eb90">front</a>()</div>
<div class="line"><a name="l10149"></a><span class="lineno">10149</span>&#160;                                            : FirstInsert-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0),</div>
<div class="line"><a name="l10150"></a><span class="lineno">10150</span>&#160;                               Vals.<a class="code" href="classllvm_1_1ArrayRef.html#adb38eaaa53c1d9c57b6fe11cf84bd7a4">back</a>(), <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l10151"></a><span class="lineno">10151</span>&#160;        });</div>
<div class="line"><a name="l10152"></a><span class="lineno">10152</span>&#160;    <span class="keyword">auto</span> It = ShuffledInserts[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].InsertElements.rbegin();</div>
<div class="line"><a name="l10153"></a><span class="lineno">10153</span>&#160;    <span class="comment">// Rebuild buildvector chain.</span></div>
<div class="line"><a name="l10154"></a><span class="lineno">10154</span>&#160;    <a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> *II = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l10155"></a><span class="lineno">10155</span>&#160;    <span class="keywordflow">if</span> (It != ShuffledInserts[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].InsertElements.rend())</div>
<div class="line"><a name="l10156"></a><span class="lineno">10156</span>&#160;      II = *It;</div>
<div class="line"><a name="l10157"></a><span class="lineno">10157</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *&gt;</a> Inserts;</div>
<div class="line"><a name="l10158"></a><span class="lineno">10158</span>&#160;    <span class="keywordflow">while</span> (It != ShuffledInserts[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].InsertElements.rend()) {</div>
<div class="line"><a name="l10159"></a><span class="lineno">10159</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(II &amp;&amp; <span class="stringliteral">&quot;Must be an insertelement instruction.&quot;</span>);</div>
<div class="line"><a name="l10160"></a><span class="lineno">10160</span>&#160;      <span class="keywordflow">if</span> (*It == II)</div>
<div class="line"><a name="l10161"></a><span class="lineno">10161</span>&#160;        ++It;</div>
<div class="line"><a name="l10162"></a><span class="lineno">10162</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l10163"></a><span class="lineno">10163</span>&#160;        Inserts.push_back(cast&lt;Instruction&gt;(II));</div>
<div class="line"><a name="l10164"></a><span class="lineno">10164</span>&#160;      II = dyn_cast&lt;InsertElementInst&gt;(II-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0));</div>
<div class="line"><a name="l10165"></a><span class="lineno">10165</span>&#160;    }</div>
<div class="line"><a name="l10166"></a><span class="lineno">10166</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *II : <a class="code" href="namespacellvm.html#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(Inserts)) {</div>
<div class="line"><a name="l10167"></a><span class="lineno">10167</span>&#160;      II-&gt;<a class="code" href="classllvm_1_1User.html#a1600c7959045cb6b6a5f5a1d427ec67e">replaceUsesOfWith</a>(II-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), NewInst);</div>
<div class="line"><a name="l10168"></a><span class="lineno">10168</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *NewI = dyn_cast&lt;Instruction&gt;(NewInst))</div>
<div class="line"><a name="l10169"></a><span class="lineno">10169</span>&#160;        <span class="keywordflow">if</span> (II-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() == NewI-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a38bee869ad41aebfef3de2641b12004c">getParent</a>() &amp;&amp; II-&gt;<a class="code" href="classllvm_1_1Instruction.html#a784097fca76abad9e815cf1692de79c4">comesBefore</a>(NewI))</div>
<div class="line"><a name="l10170"></a><span class="lineno">10170</span>&#160;          II-&gt;<a class="code" href="classllvm_1_1Instruction.html#a54507f01d7d06127068ee0663233511d">moveAfter</a>(NewI);</div>
<div class="line"><a name="l10171"></a><span class="lineno">10171</span>&#160;      NewInst = II;</div>
<div class="line"><a name="l10172"></a><span class="lineno">10172</span>&#160;    }</div>
<div class="line"><a name="l10173"></a><span class="lineno">10173</span>&#160;    LastInsert-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewInst);</div>
<div class="line"><a name="l10174"></a><span class="lineno">10174</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> *<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a> : <a class="code" href="namespacellvm.html#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(ShuffledInserts[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].InsertElements)) {</div>
<div class="line"><a name="l10175"></a><span class="lineno">10175</span>&#160;      <a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>-&gt;replaceUsesOfWith(<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>-&gt;getOperand(0),</div>
<div class="line"><a name="l10176"></a><span class="lineno">10176</span>&#160;                            <a class="code" href="classllvm_1_1PoisonValue.html#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>-&gt;getOperand(0)-&gt;getType()));</div>
<div class="line"><a name="l10177"></a><span class="lineno">10177</span>&#160;      <a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>-&gt;replaceUsesOfWith(<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>-&gt;getOperand(1),</div>
<div class="line"><a name="l10178"></a><span class="lineno">10178</span>&#160;                            <a class="code" href="classllvm_1_1PoisonValue.html#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>-&gt;getOperand(1)-&gt;getType()));</div>
<div class="line"><a name="l10179"></a><span class="lineno">10179</span>&#160;      <a class="code" href="LICM_8cpp.html#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a>(<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>);</div>
<div class="line"><a name="l10180"></a><span class="lineno">10180</span>&#160;    }</div>
<div class="line"><a name="l10181"></a><span class="lineno">10181</span>&#160;    CSEBlocks.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(LastInsert-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>());</div>
<div class="line"><a name="l10182"></a><span class="lineno">10182</span>&#160;  }</div>
<div class="line"><a name="l10183"></a><span class="lineno">10183</span>&#160; </div>
<div class="line"><a name="l10184"></a><span class="lineno">10184</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *&gt;</a> RemovedInsts;</div>
<div class="line"><a name="l10185"></a><span class="lineno">10185</span>&#160;  <span class="comment">// For each vectorized value:</span></div>
<div class="line"><a name="l10186"></a><span class="lineno">10186</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;TEPtr : VectorizableTree) {</div>
<div class="line"><a name="l10187"></a><span class="lineno">10187</span>&#160;    TreeEntry *Entry = TEPtr.get();</div>
<div class="line"><a name="l10188"></a><span class="lineno">10188</span>&#160; </div>
<div class="line"><a name="l10189"></a><span class="lineno">10189</span>&#160;    <span class="comment">// No need to handle users of gathered values.</span></div>
<div class="line"><a name="l10190"></a><span class="lineno">10190</span>&#160;    <span class="keywordflow">if</span> (Entry-&gt;State == TreeEntry::NeedToGather)</div>
<div class="line"><a name="l10191"></a><span class="lineno">10191</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l10192"></a><span class="lineno">10192</span>&#160; </div>
<div class="line"><a name="l10193"></a><span class="lineno">10193</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Entry-&gt;VectorizedValue &amp;&amp; <span class="stringliteral">&quot;Can&#39;t find vectorizable value&quot;</span>);</div>
<div class="line"><a name="l10194"></a><span class="lineno">10194</span>&#160; </div>
<div class="line"><a name="l10195"></a><span class="lineno">10195</span>&#160;    <span class="comment">// For each lane:</span></div>
<div class="line"><a name="l10196"></a><span class="lineno">10196</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> Lane = 0, <a class="code" href="namespacellvm_1_1AArch64CC.html#abfa1f7dce576430da99eed57807c7f28aeb67eda6b42e3237bc28fb457347a1cb">LE</a> = Entry-&gt;Scalars.size(); Lane != <a class="code" href="namespacellvm_1_1AArch64CC.html#abfa1f7dce576430da99eed57807c7f28aeb67eda6b42e3237bc28fb457347a1cb">LE</a>; ++Lane) {</div>
<div class="line"><a name="l10197"></a><span class="lineno">10197</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a> = Entry-&gt;Scalars[Lane];</div>
<div class="line"><a name="l10198"></a><span class="lineno">10198</span>&#160; </div>
<div class="line"><a name="l10199"></a><span class="lineno">10199</span>&#160;      <span class="keywordflow">if</span> (Entry-&gt;getOpcode() == Instruction::GetElementPtr &amp;&amp;</div>
<div class="line"><a name="l10200"></a><span class="lineno">10200</span>&#160;          !isa&lt;GetElementPtrInst&gt;(Scalar))</div>
<div class="line"><a name="l10201"></a><span class="lineno">10201</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l10202"></a><span class="lineno">10202</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l10203"></a><span class="lineno">10203</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty = <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a>-&gt;getType();</div>
<div class="line"><a name="l10204"></a><span class="lineno">10204</span>&#160;      <span class="keywordflow">if</span> (!Ty-&gt;<a class="code" href="classllvm_1_1Type.html#ae8eaa0b4eeac52a2b2282cb1bfd981ae">isVoidTy</a>()) {</div>
<div class="line"><a name="l10205"></a><span class="lineno">10205</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1User.html">User</a> *U : <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a>-&gt;users()) {</div>
<div class="line"><a name="l10206"></a><span class="lineno">10206</span>&#160;          <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: \tvalidating user:&quot;</span> &lt;&lt; *U &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l10207"></a><span class="lineno">10207</span>&#160; </div>
<div class="line"><a name="l10208"></a><span class="lineno">10208</span>&#160;          <span class="comment">// It is legal to delete users in the ignorelist.</span></div>
<div class="line"><a name="l10209"></a><span class="lineno">10209</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((getTreeEntry(U) ||</div>
<div class="line"><a name="l10210"></a><span class="lineno">10210</span>&#160;                  (UserIgnoreList &amp;&amp; UserIgnoreList-&gt;contains(U)) ||</div>
<div class="line"><a name="l10211"></a><span class="lineno">10211</span>&#160;                  (isa_and_nonnull&lt;Instruction&gt;(U) &amp;&amp;</div>
<div class="line"><a name="l10212"></a><span class="lineno">10212</span>&#160;                   isDeleted(cast&lt;Instruction&gt;(U)))) &amp;&amp;</div>
<div class="line"><a name="l10213"></a><span class="lineno">10213</span>&#160;                 <span class="stringliteral">&quot;Deleting out-of-tree value&quot;</span>);</div>
<div class="line"><a name="l10214"></a><span class="lineno">10214</span>&#160;        }</div>
<div class="line"><a name="l10215"></a><span class="lineno">10215</span>&#160;      }</div>
<div class="line"><a name="l10216"></a><span class="lineno">10216</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l10217"></a><span class="lineno">10217</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: \tErasing scalar:&quot;</span> &lt;&lt; *Scalar &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l10218"></a><span class="lineno">10218</span>&#160;      <a class="code" href="LICM_8cpp.html#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a>(cast&lt;Instruction&gt;(Scalar));</div>
<div class="line"><a name="l10219"></a><span class="lineno">10219</span>&#160;      <span class="comment">// Retain to-be-deleted instructions for some debug-info</span></div>
<div class="line"><a name="l10220"></a><span class="lineno">10220</span>&#160;      <span class="comment">// bookkeeping. NOTE: eraseInstruction only marks the instruction for</span></div>
<div class="line"><a name="l10221"></a><span class="lineno">10221</span>&#160;      <span class="comment">// deletion - instructions are not deleted until later.</span></div>
<div class="line"><a name="l10222"></a><span class="lineno">10222</span>&#160;      RemovedInsts.push_back(cast&lt;Instruction&gt;(Scalar));</div>
<div class="line"><a name="l10223"></a><span class="lineno">10223</span>&#160;    }</div>
<div class="line"><a name="l10224"></a><span class="lineno">10224</span>&#160;  }</div>
<div class="line"><a name="l10225"></a><span class="lineno">10225</span>&#160; </div>
<div class="line"><a name="l10226"></a><span class="lineno">10226</span>&#160;  <span class="comment">// Merge the DIAssignIDs from the about-to-be-deleted instructions into the</span></div>
<div class="line"><a name="l10227"></a><span class="lineno">10227</span>&#160;  <span class="comment">// new vector instruction.</span></div>
<div class="line"><a name="l10228"></a><span class="lineno">10228</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *V = dyn_cast&lt;Instruction&gt;(VectorizableTree[0]-&gt;VectorizedValue))</div>
<div class="line"><a name="l10229"></a><span class="lineno">10229</span>&#160;    V-&gt;mergeDIAssignID(RemovedInsts);</div>
<div class="line"><a name="l10230"></a><span class="lineno">10230</span>&#160; </div>
<div class="line"><a name="l10231"></a><span class="lineno">10231</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.ClearInsertionPoint();</div>
<div class="line"><a name="l10232"></a><span class="lineno">10232</span>&#160;  InstrElementSize.<a class="code" href="classllvm_1_1DenseMapBase.html#adf4e7878fc0b3b8dcde545178564190d">clear</a>();</div>
<div class="line"><a name="l10233"></a><span class="lineno">10233</span>&#160; </div>
<div class="line"><a name="l10234"></a><span class="lineno">10234</span>&#160;  <span class="keywordflow">return</span> VectorizableTree[0]-&gt;VectorizedValue;</div>
<div class="line"><a name="l10235"></a><span class="lineno">10235</span>&#160;}</div>
<div class="line"><a name="l10236"></a><span class="lineno">10236</span>&#160; </div>
<div class="line"><a name="l10237"></a><span class="lineno">10237</span>&#160;<span class="keywordtype">void</span> BoUpSLP::optimizeGatherSequence() {</div>
<div class="line"><a name="l10238"></a><span class="lineno">10238</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Optimizing &quot;</span> &lt;&lt; GatherShuffleExtractSeq.<a class="code" href="classllvm_1_1SetVector.html#a18b9d328d2490f447589ba60345eba6e">size</a>()</div>
<div class="line"><a name="l10239"></a><span class="lineno">10239</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; gather sequences instructions.\n&quot;</span>);</div>
<div class="line"><a name="l10240"></a><span class="lineno">10240</span>&#160;  <span class="comment">// LICM InsertElementInst sequences.</span></div>
<div class="line"><a name="l10241"></a><span class="lineno">10241</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : GatherShuffleExtractSeq) {</div>
<div class="line"><a name="l10242"></a><span class="lineno">10242</span>&#160;    <span class="keywordflow">if</span> (isDeleted(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l10243"></a><span class="lineno">10243</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l10244"></a><span class="lineno">10244</span>&#160; </div>
<div class="line"><a name="l10245"></a><span class="lineno">10245</span>&#160;    <span class="comment">// Check if this block is inside a loop.</span></div>
<div class="line"><a name="l10246"></a><span class="lineno">10246</span>&#160;    <a class="code" href="classllvm_1_1Loop.html">Loop</a> *L = LI-&gt;getLoopFor(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent());</div>
<div class="line"><a name="l10247"></a><span class="lineno">10247</span>&#160;    <span class="keywordflow">if</span> (!L)</div>
<div class="line"><a name="l10248"></a><span class="lineno">10248</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l10249"></a><span class="lineno">10249</span>&#160; </div>
<div class="line"><a name="l10250"></a><span class="lineno">10250</span>&#160;    <span class="comment">// Check if it has a preheader.</span></div>
<div class="line"><a name="l10251"></a><span class="lineno">10251</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PreHeader = L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#ac3280e7f76f955403fe17eacf126b90d">getLoopPreheader</a>();</div>
<div class="line"><a name="l10252"></a><span class="lineno">10252</span>&#160;    <span class="keywordflow">if</span> (!PreHeader)</div>
<div class="line"><a name="l10253"></a><span class="lineno">10253</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l10254"></a><span class="lineno">10254</span>&#160; </div>
<div class="line"><a name="l10255"></a><span class="lineno">10255</span>&#160;    <span class="comment">// If the vector or the element that we insert into it are</span></div>
<div class="line"><a name="l10256"></a><span class="lineno">10256</span>&#160;    <span class="comment">// instructions that are defined in this basic block then we can&#39;t</span></div>
<div class="line"><a name="l10257"></a><span class="lineno">10257</span>&#160;    <span class="comment">// hoist this instruction.</span></div>
<div class="line"><a name="l10258"></a><span class="lineno">10258</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands(), [L](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l10259"></a><span class="lineno">10259</span>&#160;          auto *OpI = dyn_cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l10260"></a><span class="lineno">10260</span>&#160;          return OpI &amp;&amp; L-&gt;contains(OpI);</div>
<div class="line"><a name="l10261"></a><span class="lineno">10261</span>&#160;        }))</div>
<div class="line"><a name="l10262"></a><span class="lineno">10262</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l10263"></a><span class="lineno">10263</span>&#160; </div>
<div class="line"><a name="l10264"></a><span class="lineno">10264</span>&#160;    <span class="comment">// We can hoist this instruction. Move it to the pre-header.</span></div>
<div class="line"><a name="l10265"></a><span class="lineno">10265</span>&#160;    <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;moveBefore(PreHeader-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">getTerminator</a>());</div>
<div class="line"><a name="l10266"></a><span class="lineno">10266</span>&#160;    CSEBlocks.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(PreHeader);</div>
<div class="line"><a name="l10267"></a><span class="lineno">10267</span>&#160;  }</div>
<div class="line"><a name="l10268"></a><span class="lineno">10268</span>&#160; </div>
<div class="line"><a name="l10269"></a><span class="lineno">10269</span>&#160;  <span class="comment">// Make a list of all reachable blocks in our CSE queue.</span></div>
<div class="line"><a name="l10270"></a><span class="lineno">10270</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const DomTreeNode *, 8&gt;</a> CSEWorkList;</div>
<div class="line"><a name="l10271"></a><span class="lineno">10271</span>&#160;  CSEWorkList.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(CSEBlocks.<a class="code" href="classllvm_1_1SetVector.html#a18b9d328d2490f447589ba60345eba6e">size</a>());</div>
<div class="line"><a name="l10272"></a><span class="lineno">10272</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> : CSEBlocks)</div>
<div class="line"><a name="l10273"></a><span class="lineno">10273</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1DomTreeNodeBase.html">DomTreeNode</a> *<a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = DT-&gt;getNode(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)) {</div>
<div class="line"><a name="l10274"></a><span class="lineno">10274</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DT-&gt;isReachableFromEntry(<a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>));</div>
<div class="line"><a name="l10275"></a><span class="lineno">10275</span>&#160;      CSEWorkList.push_back(<a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);</div>
<div class="line"><a name="l10276"></a><span class="lineno">10276</span>&#160;    }</div>
<div class="line"><a name="l10277"></a><span class="lineno">10277</span>&#160; </div>
<div class="line"><a name="l10278"></a><span class="lineno">10278</span>&#160;  <span class="comment">// Sort blocks by domination. This ensures we visit a block after all blocks</span></div>
<div class="line"><a name="l10279"></a><span class="lineno">10279</span>&#160;  <span class="comment">// dominating it are visited.</span></div>
<div class="line"><a name="l10280"></a><span class="lineno">10280</span>&#160;  <a class="code" href="namespacellvm.html#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a>(CSEWorkList, [](<span class="keyword">const</span> <a class="code" href="classllvm_1_1DomTreeNodeBase.html">DomTreeNode</a> *A, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DomTreeNodeBase.html">DomTreeNode</a> *<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>) {</div>
<div class="line"><a name="l10281"></a><span class="lineno">10281</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((A == <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>) == (<a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>-&gt;getDFSNumIn() == <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>-&gt;getDFSNumIn()) &amp;&amp;</div>
<div class="line"><a name="l10282"></a><span class="lineno">10282</span>&#160;           <span class="stringliteral">&quot;Different nodes should have different DFS numbers&quot;</span>);</div>
<div class="line"><a name="l10283"></a><span class="lineno">10283</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>-&gt;getDFSNumIn() &lt; <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>-&gt;getDFSNumIn();</div>
<div class="line"><a name="l10284"></a><span class="lineno">10284</span>&#160;  });</div>
<div class="line"><a name="l10285"></a><span class="lineno">10285</span>&#160; </div>
<div class="line"><a name="l10286"></a><span class="lineno">10286</span>&#160;  <span class="comment">// Less defined shuffles can be replaced by the more defined copies.</span></div>
<div class="line"><a name="l10287"></a><span class="lineno">10287</span>&#160;  <span class="comment">// Between two shuffles one is less defined if it has the same vector operands</span></div>
<div class="line"><a name="l10288"></a><span class="lineno">10288</span>&#160;  <span class="comment">// and its mask indeces are the same as in the first one or undefs. E.g.</span></div>
<div class="line"><a name="l10289"></a><span class="lineno">10289</span>&#160;  <span class="comment">// shuffle %0, poison, &lt;0, 0, 0, undef&gt; is less defined than shuffle %0,</span></div>
<div class="line"><a name="l10290"></a><span class="lineno">10290</span>&#160;  <span class="comment">// poison, &lt;0, 0, 0, 0&gt;.</span></div>
<div class="line"><a name="l10291"></a><span class="lineno">10291</span>&#160;  <span class="keyword">auto</span> &amp;&amp;IsIdenticalOrLessDefined = [<span class="keyword">this</span>](<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I2,</div>
<div class="line"><a name="l10292"></a><span class="lineno">10292</span>&#160;                                           <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;int&gt;</a> &amp;NewMask) {</div>
<div class="line"><a name="l10293"></a><span class="lineno">10293</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>-&gt;getType() != I2-&gt;getType())</div>
<div class="line"><a name="l10294"></a><span class="lineno">10294</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l10295"></a><span class="lineno">10295</span>&#160;    <span class="keyword">auto</span> *SI1 = dyn_cast&lt;ShuffleVectorInst&gt;(I1);</div>
<div class="line"><a name="l10296"></a><span class="lineno">10296</span>&#160;    <span class="keyword">auto</span> *SI2 = dyn_cast&lt;ShuffleVectorInst&gt;(I2);</div>
<div class="line"><a name="l10297"></a><span class="lineno">10297</span>&#160;    <span class="keywordflow">if</span> (!SI1 || !SI2)</div>
<div class="line"><a name="l10298"></a><span class="lineno">10298</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>-&gt;isIdenticalTo(I2);</div>
<div class="line"><a name="l10299"></a><span class="lineno">10299</span>&#160;    <span class="keywordflow">if</span> (SI1-&gt;isIdenticalTo(SI2))</div>
<div class="line"><a name="l10300"></a><span class="lineno">10300</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l10301"></a><span class="lineno">10301</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = SI1-&gt;getNumOperands(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l10302"></a><span class="lineno">10302</span>&#160;      <span class="keywordflow">if</span> (SI1-&gt;getOperand(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) != SI2-&gt;getOperand(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l10303"></a><span class="lineno">10303</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l10304"></a><span class="lineno">10304</span>&#160;    <span class="comment">// Check if the second instruction is more defined than the first one.</span></div>
<div class="line"><a name="l10305"></a><span class="lineno">10305</span>&#160;    NewMask.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a38c50aa8e3e9588f4f968c2e03a0cee0">assign</a>(SI2-&gt;getShuffleMask().begin(), SI2-&gt;getShuffleMask().end());</div>
<div class="line"><a name="l10306"></a><span class="lineno">10306</span>&#160;    <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> SM1 = SI1-&gt;getShuffleMask();</div>
<div class="line"><a name="l10307"></a><span class="lineno">10307</span>&#160;    <span class="comment">// Count trailing undefs in the mask to check the final number of used</span></div>
<div class="line"><a name="l10308"></a><span class="lineno">10308</span>&#160;    <span class="comment">// registers.</span></div>
<div class="line"><a name="l10309"></a><span class="lineno">10309</span>&#160;    <span class="keywordtype">unsigned</span> LastUndefsCnt = 0;</div>
<div class="line"><a name="l10310"></a><span class="lineno">10310</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = NewMask.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l10311"></a><span class="lineno">10311</span>&#160;      <span class="keywordflow">if</span> (SM1[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l10312"></a><span class="lineno">10312</span>&#160;        ++LastUndefsCnt;</div>
<div class="line"><a name="l10313"></a><span class="lineno">10313</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l10314"></a><span class="lineno">10314</span>&#160;        LastUndefsCnt = 0;</div>
<div class="line"><a name="l10315"></a><span class="lineno">10315</span>&#160;      <span class="keywordflow">if</span> (NewMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] != <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a> &amp;&amp; SM1[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] != <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a> &amp;&amp;</div>
<div class="line"><a name="l10316"></a><span class="lineno">10316</span>&#160;          NewMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] != SM1[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>])</div>
<div class="line"><a name="l10317"></a><span class="lineno">10317</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l10318"></a><span class="lineno">10318</span>&#160;      <span class="keywordflow">if</span> (NewMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l10319"></a><span class="lineno">10319</span>&#160;        NewMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = SM1[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l10320"></a><span class="lineno">10320</span>&#160;    }</div>
<div class="line"><a name="l10321"></a><span class="lineno">10321</span>&#160;    <span class="comment">// Check if the last undefs actually change the final number of used vector</span></div>
<div class="line"><a name="l10322"></a><span class="lineno">10322</span>&#160;    <span class="comment">// registers.</span></div>
<div class="line"><a name="l10323"></a><span class="lineno">10323</span>&#160;    <span class="keywordflow">return</span> SM1.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() - LastUndefsCnt &gt; 1 &amp;&amp;</div>
<div class="line"><a name="l10324"></a><span class="lineno">10324</span>&#160;           <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#ad67b7e389a52ada1d5264e23d09f4cbe">getNumberOfParts</a>(SI1-&gt;getType()) ==</div>
<div class="line"><a name="l10325"></a><span class="lineno">10325</span>&#160;               <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#ad67b7e389a52ada1d5264e23d09f4cbe">getNumberOfParts</a>(</div>
<div class="line"><a name="l10326"></a><span class="lineno">10326</span>&#160;                   <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(SI1-&gt;getType()-&gt;getElementType(),</div>
<div class="line"><a name="l10327"></a><span class="lineno">10327</span>&#160;                                        SM1.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() - LastUndefsCnt));</div>
<div class="line"><a name="l10328"></a><span class="lineno">10328</span>&#160;  };</div>
<div class="line"><a name="l10329"></a><span class="lineno">10329</span>&#160;  <span class="comment">// Perform O(N^2) search over the gather/shuffle sequences and merge identical</span></div>
<div class="line"><a name="l10330"></a><span class="lineno">10330</span>&#160;  <span class="comment">// instructions. TODO: We can further optimize this scan if we split the</span></div>
<div class="line"><a name="l10331"></a><span class="lineno">10331</span>&#160;  <span class="comment">// instructions into different buckets based on the insert lane.</span></div>
<div class="line"><a name="l10332"></a><span class="lineno">10332</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 16&gt;</a> Visited;</div>
<div class="line"><a name="l10333"></a><span class="lineno">10333</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = CSEWorkList.begin(), <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = CSEWorkList.end(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l10334"></a><span class="lineno">10334</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp;</div>
<div class="line"><a name="l10335"></a><span class="lineno">10335</span>&#160;           (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> == CSEWorkList.begin() || !DT-&gt;dominates(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, *std::prev(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))) &amp;&amp;</div>
<div class="line"><a name="l10336"></a><span class="lineno">10336</span>&#160;           <span class="stringliteral">&quot;Worklist not sorted properly!&quot;</span>);</div>
<div class="line"><a name="l10337"></a><span class="lineno">10337</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = (*I)-&gt;getBlock();</div>
<div class="line"><a name="l10338"></a><span class="lineno">10338</span>&#160;    <span class="comment">// For all instructions in blocks containing gather sequences:</span></div>
<div class="line"><a name="l10339"></a><span class="lineno">10339</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a> : <a class="code" href="namespacellvm.html#a8154638df88e4eaa568b67b23d463dac">llvm::make_early_inc_range</a>(*<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)) {</div>
<div class="line"><a name="l10340"></a><span class="lineno">10340</span>&#160;      <span class="keywordflow">if</span> (isDeleted(&amp;<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>))</div>
<div class="line"><a name="l10341"></a><span class="lineno">10341</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l10342"></a><span class="lineno">10342</span>&#160;      <span class="keywordflow">if</span> (!isa&lt;InsertElementInst, ExtractElementInst, ShuffleVectorInst&gt;(&amp;<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>) &amp;&amp;</div>
<div class="line"><a name="l10343"></a><span class="lineno">10343</span>&#160;          !GatherShuffleExtractSeq.contains(&amp;<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>))</div>
<div class="line"><a name="l10344"></a><span class="lineno">10344</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l10345"></a><span class="lineno">10345</span>&#160; </div>
<div class="line"><a name="l10346"></a><span class="lineno">10346</span>&#160;      <span class="comment">// Check if we can replace this instruction with any of the</span></div>
<div class="line"><a name="l10347"></a><span class="lineno">10347</span>&#160;      <span class="comment">// visited instructions.</span></div>
<div class="line"><a name="l10348"></a><span class="lineno">10348</span>&#160;      <span class="keywordtype">bool</span> Replaced = <span class="keyword">false</span>;</div>
<div class="line"><a name="l10349"></a><span class="lineno">10349</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *&amp;V : Visited) {</div>
<div class="line"><a name="l10350"></a><span class="lineno">10350</span>&#160;        <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> NewMask;</div>
<div class="line"><a name="l10351"></a><span class="lineno">10351</span>&#160;        <span class="keywordflow">if</span> (IsIdenticalOrLessDefined(&amp;<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>, V, NewMask) &amp;&amp;</div>
<div class="line"><a name="l10352"></a><span class="lineno">10352</span>&#160;            DT-&gt;dominates(V-&gt;getParent(), <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>.getParent())) {</div>
<div class="line"><a name="l10353"></a><span class="lineno">10353</span>&#160;          <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>.replaceAllUsesWith(V);</div>
<div class="line"><a name="l10354"></a><span class="lineno">10354</span>&#160;          <a class="code" href="LICM_8cpp.html#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a>(&amp;<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>);</div>
<div class="line"><a name="l10355"></a><span class="lineno">10355</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;ShuffleVectorInst&gt;(V))</div>
<div class="line"><a name="l10356"></a><span class="lineno">10356</span>&#160;            <span class="keywordflow">if</span> (!NewMask.empty())</div>
<div class="line"><a name="l10357"></a><span class="lineno">10357</span>&#160;              <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;setShuffleMask(NewMask);</div>
<div class="line"><a name="l10358"></a><span class="lineno">10358</span>&#160;          Replaced = <span class="keyword">true</span>;</div>
<div class="line"><a name="l10359"></a><span class="lineno">10359</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l10360"></a><span class="lineno">10360</span>&#160;        }</div>
<div class="line"><a name="l10361"></a><span class="lineno">10361</span>&#160;        <span class="keywordflow">if</span> (isa&lt;ShuffleVectorInst&gt;(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>) &amp;&amp; isa&lt;ShuffleVectorInst&gt;(V) &amp;&amp;</div>
<div class="line"><a name="l10362"></a><span class="lineno">10362</span>&#160;            GatherShuffleExtractSeq.contains(V) &amp;&amp;</div>
<div class="line"><a name="l10363"></a><span class="lineno">10363</span>&#160;            IsIdenticalOrLessDefined(V, &amp;<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>, NewMask) &amp;&amp;</div>
<div class="line"><a name="l10364"></a><span class="lineno">10364</span>&#160;            DT-&gt;dominates(<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>.getParent(), V-&gt;getParent())) {</div>
<div class="line"><a name="l10365"></a><span class="lineno">10365</span>&#160;          <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>.moveAfter(V);</div>
<div class="line"><a name="l10366"></a><span class="lineno">10366</span>&#160;          V-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(&amp;<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>);</div>
<div class="line"><a name="l10367"></a><span class="lineno">10367</span>&#160;          <a class="code" href="LICM_8cpp.html#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a>(V);</div>
<div class="line"><a name="l10368"></a><span class="lineno">10368</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;ShuffleVectorInst&gt;(&amp;<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>))</div>
<div class="line"><a name="l10369"></a><span class="lineno">10369</span>&#160;            <span class="keywordflow">if</span> (!NewMask.empty())</div>
<div class="line"><a name="l10370"></a><span class="lineno">10370</span>&#160;              <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;setShuffleMask(NewMask);</div>
<div class="line"><a name="l10371"></a><span class="lineno">10371</span>&#160;          V = &amp;<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>;</div>
<div class="line"><a name="l10372"></a><span class="lineno">10372</span>&#160;          Replaced = <span class="keyword">true</span>;</div>
<div class="line"><a name="l10373"></a><span class="lineno">10373</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l10374"></a><span class="lineno">10374</span>&#160;        }</div>
<div class="line"><a name="l10375"></a><span class="lineno">10375</span>&#160;      }</div>
<div class="line"><a name="l10376"></a><span class="lineno">10376</span>&#160;      <span class="keywordflow">if</span> (!Replaced) {</div>
<div class="line"><a name="l10377"></a><span class="lineno">10377</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a class="code" href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">is_contained</a>(Visited, &amp;<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>));</div>
<div class="line"><a name="l10378"></a><span class="lineno">10378</span>&#160;        Visited.push_back(&amp;<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>);</div>
<div class="line"><a name="l10379"></a><span class="lineno">10379</span>&#160;      }</div>
<div class="line"><a name="l10380"></a><span class="lineno">10380</span>&#160;    }</div>
<div class="line"><a name="l10381"></a><span class="lineno">10381</span>&#160;  }</div>
<div class="line"><a name="l10382"></a><span class="lineno">10382</span>&#160;  CSEBlocks.clear();</div>
<div class="line"><a name="l10383"></a><span class="lineno">10383</span>&#160;  GatherShuffleExtractSeq.clear();</div>
<div class="line"><a name="l10384"></a><span class="lineno">10384</span>&#160;}</div>
<div class="line"><a name="l10385"></a><span class="lineno">10385</span>&#160; </div>
<div class="line"><a name="l10386"></a><span class="lineno">10386</span>&#160;BoUpSLP::ScheduleData *</div>
<div class="line"><a name="l10387"></a><span class="lineno">10387</span>&#160;BoUpSLP::BlockScheduling::buildBundle(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL) {</div>
<div class="line"><a name="l10388"></a><span class="lineno">10388</span>&#160;  ScheduleData *Bundle = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l10389"></a><span class="lineno">10389</span>&#160;  ScheduleData *PrevInBundle = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l10390"></a><span class="lineno">10390</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l10391"></a><span class="lineno">10391</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a05a7412bf10f2226fb69f2876b76e9cd">doesNotNeedToBeScheduled</a>(V))</div>
<div class="line"><a name="l10392"></a><span class="lineno">10392</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l10393"></a><span class="lineno">10393</span>&#160;    ScheduleData *BundleMember = getScheduleData(V);</div>
<div class="line"><a name="l10394"></a><span class="lineno">10394</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BundleMember &amp;&amp;</div>
<div class="line"><a name="l10395"></a><span class="lineno">10395</span>&#160;           <span class="stringliteral">&quot;no ScheduleData for bundle member &quot;</span></div>
<div class="line"><a name="l10396"></a><span class="lineno">10396</span>&#160;           <span class="stringliteral">&quot;(maybe not in same basic block)&quot;</span>);</div>
<div class="line"><a name="l10397"></a><span class="lineno">10397</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BundleMember-&gt;isSchedulingEntity() &amp;&amp;</div>
<div class="line"><a name="l10398"></a><span class="lineno">10398</span>&#160;           <span class="stringliteral">&quot;bundle member already part of other bundle&quot;</span>);</div>
<div class="line"><a name="l10399"></a><span class="lineno">10399</span>&#160;    <span class="keywordflow">if</span> (PrevInBundle) {</div>
<div class="line"><a name="l10400"></a><span class="lineno">10400</span>&#160;      PrevInBundle-&gt;NextInBundle = BundleMember;</div>
<div class="line"><a name="l10401"></a><span class="lineno">10401</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l10402"></a><span class="lineno">10402</span>&#160;      Bundle = BundleMember;</div>
<div class="line"><a name="l10403"></a><span class="lineno">10403</span>&#160;    }</div>
<div class="line"><a name="l10404"></a><span class="lineno">10404</span>&#160; </div>
<div class="line"><a name="l10405"></a><span class="lineno">10405</span>&#160;    <span class="comment">// Group the instructions to a bundle.</span></div>
<div class="line"><a name="l10406"></a><span class="lineno">10406</span>&#160;    BundleMember-&gt;FirstInBundle = Bundle;</div>
<div class="line"><a name="l10407"></a><span class="lineno">10407</span>&#160;    PrevInBundle = BundleMember;</div>
<div class="line"><a name="l10408"></a><span class="lineno">10408</span>&#160;  }</div>
<div class="line"><a name="l10409"></a><span class="lineno">10409</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Bundle &amp;&amp; <span class="stringliteral">&quot;Failed to find schedule bundle&quot;</span>);</div>
<div class="line"><a name="l10410"></a><span class="lineno">10410</span>&#160;  <span class="keywordflow">return</span> Bundle;</div>
<div class="line"><a name="l10411"></a><span class="lineno">10411</span>&#160;}</div>
<div class="line"><a name="l10412"></a><span class="lineno">10412</span>&#160; </div>
<div class="line"><a name="l10413"></a><span class="lineno">10413</span>&#160;<span class="comment">// Groups the instructions to a bundle (which is then a single scheduling entity)</span></div>
<div class="line"><a name="l10414"></a><span class="lineno">10414</span>&#160;<span class="comment">// and schedules instructions until the bundle gets ready.</span></div>
<div class="line"><a name="l10415"></a><span class="lineno">10415</span>&#160;std::optional&lt;BoUpSLP::ScheduleData *&gt;</div>
<div class="line"><a name="l10416"></a><span class="lineno">10416</span>&#160;BoUpSLP::BlockScheduling::tryScheduleBundle(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL, <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> *SLP,</div>
<div class="line"><a name="l10417"></a><span class="lineno">10417</span>&#160;                                            <span class="keyword">const</span> InstructionsState &amp;<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>) {</div>
<div class="line"><a name="l10418"></a><span class="lineno">10418</span>&#160;  <span class="comment">// No need to schedule PHIs, insertelement, extractelement and extractvalue</span></div>
<div class="line"><a name="l10419"></a><span class="lineno">10419</span>&#160;  <span class="comment">// instructions.</span></div>
<div class="line"><a name="l10420"></a><span class="lineno">10420</span>&#160;  <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.OpValue) || <a class="code" href="SLPVectorizer_8cpp.html#a06a9edb69d0ed6fda201d59948acfd89">isVectorLikeInstWithConstOps</a>(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.OpValue) ||</div>
<div class="line"><a name="l10421"></a><span class="lineno">10421</span>&#160;      <a class="code" href="namespacellvm.html#abed730d9d5b8f4c70f4fbe1094a0157f">doesNotNeedToSchedule</a>(VL))</div>
<div class="line"><a name="l10422"></a><span class="lineno">10422</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l10423"></a><span class="lineno">10423</span>&#160; </div>
<div class="line"><a name="l10424"></a><span class="lineno">10424</span>&#160;  <span class="comment">// Initialize the instruction bundle.</span></div>
<div class="line"><a name="l10425"></a><span class="lineno">10425</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *OldScheduleEnd = ScheduleEnd;</div>
<div class="line"><a name="l10426"></a><span class="lineno">10426</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP:  bundle: &quot;</span> &lt;&lt; *<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.OpValue &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l10427"></a><span class="lineno">10427</span>&#160; </div>
<div class="line"><a name="l10428"></a><span class="lineno">10428</span>&#160;  <span class="keyword">auto</span> TryScheduleBundleImpl = [<span class="keyword">this</span>, OldScheduleEnd, SLP](<span class="keywordtype">bool</span> ReSchedule,</div>
<div class="line"><a name="l10429"></a><span class="lineno">10429</span>&#160;                                                         ScheduleData *Bundle) {</div>
<div class="line"><a name="l10430"></a><span class="lineno">10430</span>&#160;    <span class="comment">// The scheduling region got new instructions at the lower end (or it is a</span></div>
<div class="line"><a name="l10431"></a><span class="lineno">10431</span>&#160;    <span class="comment">// new region for the first bundle). This makes it necessary to</span></div>
<div class="line"><a name="l10432"></a><span class="lineno">10432</span>&#160;    <span class="comment">// recalculate all dependencies.</span></div>
<div class="line"><a name="l10433"></a><span class="lineno">10433</span>&#160;    <span class="comment">// It is seldom that this needs to be done a second time after adding the</span></div>
<div class="line"><a name="l10434"></a><span class="lineno">10434</span>&#160;    <span class="comment">// initial bundle to the region.</span></div>
<div class="line"><a name="l10435"></a><span class="lineno">10435</span>&#160;    <span class="keywordflow">if</span> (ScheduleEnd != OldScheduleEnd) {</div>
<div class="line"><a name="l10436"></a><span class="lineno">10436</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = ScheduleStart; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != ScheduleEnd; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNextNode())</div>
<div class="line"><a name="l10437"></a><span class="lineno">10437</span>&#160;        doForAllOpcodes(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, [](ScheduleData *SD) { SD-&gt;clearDependencies(); });</div>
<div class="line"><a name="l10438"></a><span class="lineno">10438</span>&#160;      ReSchedule = <span class="keyword">true</span>;</div>
<div class="line"><a name="l10439"></a><span class="lineno">10439</span>&#160;    }</div>
<div class="line"><a name="l10440"></a><span class="lineno">10440</span>&#160;    <span class="keywordflow">if</span> (Bundle) {</div>
<div class="line"><a name="l10441"></a><span class="lineno">10441</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: try schedule bundle &quot;</span> &lt;&lt; *Bundle</div>
<div class="line"><a name="l10442"></a><span class="lineno">10442</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot; in block &quot;</span> &lt;&lt; <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l10443"></a><span class="lineno">10443</span>&#160;      calculateDependencies(Bundle, <span class="comment">/*InsertInReadyList=*/</span><span class="keyword">true</span>, SLP);</div>
<div class="line"><a name="l10444"></a><span class="lineno">10444</span>&#160;    }</div>
<div class="line"><a name="l10445"></a><span class="lineno">10445</span>&#160; </div>
<div class="line"><a name="l10446"></a><span class="lineno">10446</span>&#160;    <span class="keywordflow">if</span> (ReSchedule) {</div>
<div class="line"><a name="l10447"></a><span class="lineno">10447</span>&#160;      resetSchedule();</div>
<div class="line"><a name="l10448"></a><span class="lineno">10448</span>&#160;      initialFillReadyList(ReadyInsts);</div>
<div class="line"><a name="l10449"></a><span class="lineno">10449</span>&#160;    }</div>
<div class="line"><a name="l10450"></a><span class="lineno">10450</span>&#160; </div>
<div class="line"><a name="l10451"></a><span class="lineno">10451</span>&#160;    <span class="comment">// Now try to schedule the new bundle or (if no bundle) just calculate</span></div>
<div class="line"><a name="l10452"></a><span class="lineno">10452</span>&#160;    <span class="comment">// dependencies. As soon as the bundle is &quot;ready&quot; it means that there are no</span></div>
<div class="line"><a name="l10453"></a><span class="lineno">10453</span>&#160;    <span class="comment">// cyclic dependencies and we can schedule it. Note that&#39;s important that we</span></div>
<div class="line"><a name="l10454"></a><span class="lineno">10454</span>&#160;    <span class="comment">// don&#39;t &quot;schedule&quot; the bundle yet (see cancelScheduling).</span></div>
<div class="line"><a name="l10455"></a><span class="lineno">10455</span>&#160;    <span class="keywordflow">while</span> (((!Bundle &amp;&amp; ReSchedule) || (Bundle &amp;&amp; !Bundle-&gt;isReady())) &amp;&amp;</div>
<div class="line"><a name="l10456"></a><span class="lineno">10456</span>&#160;           !ReadyInsts.empty()) {</div>
<div class="line"><a name="l10457"></a><span class="lineno">10457</span>&#160;      ScheduleData *Picked = ReadyInsts.pop_back_val();</div>
<div class="line"><a name="l10458"></a><span class="lineno">10458</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Picked-&gt;isSchedulingEntity() &amp;&amp; Picked-&gt;isReady() &amp;&amp;</div>
<div class="line"><a name="l10459"></a><span class="lineno">10459</span>&#160;             <span class="stringliteral">&quot;must be ready to schedule&quot;</span>);</div>
<div class="line"><a name="l10460"></a><span class="lineno">10460</span>&#160;      schedule(Picked, ReadyInsts);</div>
<div class="line"><a name="l10461"></a><span class="lineno">10461</span>&#160;    }</div>
<div class="line"><a name="l10462"></a><span class="lineno">10462</span>&#160;  };</div>
<div class="line"><a name="l10463"></a><span class="lineno">10463</span>&#160; </div>
<div class="line"><a name="l10464"></a><span class="lineno">10464</span>&#160;  <span class="comment">// Make sure that the scheduling region contains all</span></div>
<div class="line"><a name="l10465"></a><span class="lineno">10465</span>&#160;  <span class="comment">// instructions of the bundle.</span></div>
<div class="line"><a name="l10466"></a><span class="lineno">10466</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l10467"></a><span class="lineno">10467</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a05a7412bf10f2226fb69f2876b76e9cd">doesNotNeedToBeScheduled</a>(V))</div>
<div class="line"><a name="l10468"></a><span class="lineno">10468</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l10469"></a><span class="lineno">10469</span>&#160;    <span class="keywordflow">if</span> (!extendSchedulingRegion(V, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>)) {</div>
<div class="line"><a name="l10470"></a><span class="lineno">10470</span>&#160;      <span class="comment">// If the scheduling region got new instructions at the lower end (or it</span></div>
<div class="line"><a name="l10471"></a><span class="lineno">10471</span>&#160;      <span class="comment">// is a new region for the first bundle). This makes it necessary to</span></div>
<div class="line"><a name="l10472"></a><span class="lineno">10472</span>&#160;      <span class="comment">// recalculate all dependencies.</span></div>
<div class="line"><a name="l10473"></a><span class="lineno">10473</span>&#160;      <span class="comment">// Otherwise the compiler may crash trying to incorrectly calculate</span></div>
<div class="line"><a name="l10474"></a><span class="lineno">10474</span>&#160;      <span class="comment">// dependencies and emit instruction in the wrong order at the actual</span></div>
<div class="line"><a name="l10475"></a><span class="lineno">10475</span>&#160;      <span class="comment">// scheduling.</span></div>
<div class="line"><a name="l10476"></a><span class="lineno">10476</span>&#160;      TryScheduleBundleImpl(<span class="comment">/*ReSchedule=*/</span><span class="keyword">false</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l10477"></a><span class="lineno">10477</span>&#160;      <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l10478"></a><span class="lineno">10478</span>&#160;    }</div>
<div class="line"><a name="l10479"></a><span class="lineno">10479</span>&#160;  }</div>
<div class="line"><a name="l10480"></a><span class="lineno">10480</span>&#160; </div>
<div class="line"><a name="l10481"></a><span class="lineno">10481</span>&#160;  <span class="keywordtype">bool</span> ReSchedule = <span class="keyword">false</span>;</div>
<div class="line"><a name="l10482"></a><span class="lineno">10482</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l10483"></a><span class="lineno">10483</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a05a7412bf10f2226fb69f2876b76e9cd">doesNotNeedToBeScheduled</a>(V))</div>
<div class="line"><a name="l10484"></a><span class="lineno">10484</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l10485"></a><span class="lineno">10485</span>&#160;    ScheduleData *BundleMember = getScheduleData(V);</div>
<div class="line"><a name="l10486"></a><span class="lineno">10486</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BundleMember &amp;&amp;</div>
<div class="line"><a name="l10487"></a><span class="lineno">10487</span>&#160;           <span class="stringliteral">&quot;no ScheduleData for bundle member (maybe not in same basic block)&quot;</span>);</div>
<div class="line"><a name="l10488"></a><span class="lineno">10488</span>&#160; </div>
<div class="line"><a name="l10489"></a><span class="lineno">10489</span>&#160;    <span class="comment">// Make sure we don&#39;t leave the pieces of the bundle in the ready list when</span></div>
<div class="line"><a name="l10490"></a><span class="lineno">10490</span>&#160;    <span class="comment">// whole bundle might not be ready.</span></div>
<div class="line"><a name="l10491"></a><span class="lineno">10491</span>&#160;    ReadyInsts.remove(BundleMember);</div>
<div class="line"><a name="l10492"></a><span class="lineno">10492</span>&#160; </div>
<div class="line"><a name="l10493"></a><span class="lineno">10493</span>&#160;    <span class="keywordflow">if</span> (!BundleMember-&gt;IsScheduled)</div>
<div class="line"><a name="l10494"></a><span class="lineno">10494</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l10495"></a><span class="lineno">10495</span>&#160;    <span class="comment">// A bundle member was scheduled as single instruction before and now</span></div>
<div class="line"><a name="l10496"></a><span class="lineno">10496</span>&#160;    <span class="comment">// needs to be scheduled as part of the bundle. We just get rid of the</span></div>
<div class="line"><a name="l10497"></a><span class="lineno">10497</span>&#160;    <span class="comment">// existing schedule.</span></div>
<div class="line"><a name="l10498"></a><span class="lineno">10498</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP:  reset schedule because &quot;</span> &lt;&lt; *BundleMember</div>
<div class="line"><a name="l10499"></a><span class="lineno">10499</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot; was already scheduled\n&quot;</span>);</div>
<div class="line"><a name="l10500"></a><span class="lineno">10500</span>&#160;    ReSchedule = <span class="keyword">true</span>;</div>
<div class="line"><a name="l10501"></a><span class="lineno">10501</span>&#160;  }</div>
<div class="line"><a name="l10502"></a><span class="lineno">10502</span>&#160; </div>
<div class="line"><a name="l10503"></a><span class="lineno">10503</span>&#160;  <span class="keyword">auto</span> *Bundle = buildBundle(VL);</div>
<div class="line"><a name="l10504"></a><span class="lineno">10504</span>&#160;  TryScheduleBundleImpl(ReSchedule, Bundle);</div>
<div class="line"><a name="l10505"></a><span class="lineno">10505</span>&#160;  <span class="keywordflow">if</span> (!Bundle-&gt;isReady()) {</div>
<div class="line"><a name="l10506"></a><span class="lineno">10506</span>&#160;    cancelScheduling(VL, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.OpValue);</div>
<div class="line"><a name="l10507"></a><span class="lineno">10507</span>&#160;    <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l10508"></a><span class="lineno">10508</span>&#160;  }</div>
<div class="line"><a name="l10509"></a><span class="lineno">10509</span>&#160;  <span class="keywordflow">return</span> Bundle;</div>
<div class="line"><a name="l10510"></a><span class="lineno">10510</span>&#160;}</div>
<div class="line"><a name="l10511"></a><span class="lineno">10511</span>&#160; </div>
<div class="line"><a name="l10512"></a><span class="lineno">10512</span>&#160;<span class="keywordtype">void</span> BoUpSLP::BlockScheduling::cancelScheduling(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL,</div>
<div class="line"><a name="l10513"></a><span class="lineno">10513</span>&#160;                                                <a class="code" href="classllvm_1_1Value.html">Value</a> *OpValue) {</div>
<div class="line"><a name="l10514"></a><span class="lineno">10514</span>&#160;  <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(OpValue) || <a class="code" href="SLPVectorizer_8cpp.html#a06a9edb69d0ed6fda201d59948acfd89">isVectorLikeInstWithConstOps</a>(OpValue) ||</div>
<div class="line"><a name="l10515"></a><span class="lineno">10515</span>&#160;      <a class="code" href="namespacellvm.html#abed730d9d5b8f4c70f4fbe1094a0157f">doesNotNeedToSchedule</a>(VL))</div>
<div class="line"><a name="l10516"></a><span class="lineno">10516</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l10517"></a><span class="lineno">10517</span>&#160; </div>
<div class="line"><a name="l10518"></a><span class="lineno">10518</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a05a7412bf10f2226fb69f2876b76e9cd">doesNotNeedToBeScheduled</a>(OpValue))</div>
<div class="line"><a name="l10519"></a><span class="lineno">10519</span>&#160;    OpValue = *<a class="code" href="namespacellvm.html#a7b49849160e7f089916f83c52511da9e">find_if_not</a>(VL, <a class="code" href="namespacellvm.html#a05a7412bf10f2226fb69f2876b76e9cd">doesNotNeedToBeScheduled</a>);</div>
<div class="line"><a name="l10520"></a><span class="lineno">10520</span>&#160;  ScheduleData *Bundle = getScheduleData(OpValue);</div>
<div class="line"><a name="l10521"></a><span class="lineno">10521</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP:  cancel scheduling of &quot;</span> &lt;&lt; *Bundle &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l10522"></a><span class="lineno">10522</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!Bundle-&gt;IsScheduled &amp;&amp;</div>
<div class="line"><a name="l10523"></a><span class="lineno">10523</span>&#160;         <span class="stringliteral">&quot;Can&#39;t cancel bundle which is already scheduled&quot;</span>);</div>
<div class="line"><a name="l10524"></a><span class="lineno">10524</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Bundle-&gt;isSchedulingEntity() &amp;&amp;</div>
<div class="line"><a name="l10525"></a><span class="lineno">10525</span>&#160;         (Bundle-&gt;isPartOfBundle() || <a class="code" href="SLPVectorizer_8cpp.html#a2acd0e4598d1a9c34a8f2d9c9f98aaca">needToScheduleSingleInstruction</a>(VL)) &amp;&amp;</div>
<div class="line"><a name="l10526"></a><span class="lineno">10526</span>&#160;         <span class="stringliteral">&quot;tried to unbundle something which is not a bundle&quot;</span>);</div>
<div class="line"><a name="l10527"></a><span class="lineno">10527</span>&#160; </div>
<div class="line"><a name="l10528"></a><span class="lineno">10528</span>&#160;  <span class="comment">// Remove the bundle from the ready list.</span></div>
<div class="line"><a name="l10529"></a><span class="lineno">10529</span>&#160;  <span class="keywordflow">if</span> (Bundle-&gt;isReady())</div>
<div class="line"><a name="l10530"></a><span class="lineno">10530</span>&#160;    ReadyInsts.remove(Bundle);</div>
<div class="line"><a name="l10531"></a><span class="lineno">10531</span>&#160; </div>
<div class="line"><a name="l10532"></a><span class="lineno">10532</span>&#160;  <span class="comment">// Un-bundle: make single instructions out of the bundle.</span></div>
<div class="line"><a name="l10533"></a><span class="lineno">10533</span>&#160;  ScheduleData *BundleMember = Bundle;</div>
<div class="line"><a name="l10534"></a><span class="lineno">10534</span>&#160;  <span class="keywordflow">while</span> (BundleMember) {</div>
<div class="line"><a name="l10535"></a><span class="lineno">10535</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BundleMember-&gt;FirstInBundle == Bundle &amp;&amp; <span class="stringliteral">&quot;corrupt bundle links&quot;</span>);</div>
<div class="line"><a name="l10536"></a><span class="lineno">10536</span>&#160;    BundleMember-&gt;FirstInBundle = BundleMember;</div>
<div class="line"><a name="l10537"></a><span class="lineno">10537</span>&#160;    ScheduleData *Next = BundleMember-&gt;NextInBundle;</div>
<div class="line"><a name="l10538"></a><span class="lineno">10538</span>&#160;    BundleMember-&gt;NextInBundle = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l10539"></a><span class="lineno">10539</span>&#160;    BundleMember-&gt;TE = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l10540"></a><span class="lineno">10540</span>&#160;    <span class="keywordflow">if</span> (BundleMember-&gt;unscheduledDepsInBundle() == 0) {</div>
<div class="line"><a name="l10541"></a><span class="lineno">10541</span>&#160;      ReadyInsts.insert(BundleMember);</div>
<div class="line"><a name="l10542"></a><span class="lineno">10542</span>&#160;    }</div>
<div class="line"><a name="l10543"></a><span class="lineno">10543</span>&#160;    BundleMember = Next;</div>
<div class="line"><a name="l10544"></a><span class="lineno">10544</span>&#160;  }</div>
<div class="line"><a name="l10545"></a><span class="lineno">10545</span>&#160;}</div>
<div class="line"><a name="l10546"></a><span class="lineno">10546</span>&#160; </div>
<div class="line"><a name="l10547"></a><span class="lineno">10547</span>&#160;BoUpSLP::ScheduleData *BoUpSLP::BlockScheduling::allocateScheduleDataChunks() {</div>
<div class="line"><a name="l10548"></a><span class="lineno">10548</span>&#160;  <span class="comment">// Allocate a new ScheduleData for the instruction.</span></div>
<div class="line"><a name="l10549"></a><span class="lineno">10549</span>&#160;  <span class="keywordflow">if</span> (ChunkPos &gt;= ChunkSize) {</div>
<div class="line"><a name="l10550"></a><span class="lineno">10550</span>&#160;    ScheduleDataChunks.push_back(std::make_unique&lt;ScheduleData[]&gt;(ChunkSize));</div>
<div class="line"><a name="l10551"></a><span class="lineno">10551</span>&#160;    ChunkPos = 0;</div>
<div class="line"><a name="l10552"></a><span class="lineno">10552</span>&#160;  }</div>
<div class="line"><a name="l10553"></a><span class="lineno">10553</span>&#160;  <span class="keywordflow">return</span> &amp;(ScheduleDataChunks.back()[ChunkPos++]);</div>
<div class="line"><a name="l10554"></a><span class="lineno">10554</span>&#160;}</div>
<div class="line"><a name="l10555"></a><span class="lineno">10555</span>&#160; </div>
<div class="line"><a name="l10556"></a><span class="lineno">10556</span>&#160;<span class="keywordtype">bool</span> BoUpSLP::BlockScheduling::extendSchedulingRegion(<a class="code" href="classllvm_1_1Value.html">Value</a> *V,</div>
<div class="line"><a name="l10557"></a><span class="lineno">10557</span>&#160;                                                      <span class="keyword">const</span> InstructionsState &amp;<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>) {</div>
<div class="line"><a name="l10558"></a><span class="lineno">10558</span>&#160;  <span class="keywordflow">if</span> (getScheduleData(V, <a class="code" href="SLPVectorizer_8cpp.html#a2207681d736278c6968f548195f1f90c">isOneOf</a>(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, V)))</div>
<div class="line"><a name="l10559"></a><span class="lineno">10559</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l10560"></a><span class="lineno">10560</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l10561"></a><span class="lineno">10561</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp; <span class="stringliteral">&quot;bundle member must be an instruction&quot;</span>);</div>
<div class="line"><a name="l10562"></a><span class="lineno">10562</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!isa&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !<a class="code" href="SLPVectorizer_8cpp.html#a06a9edb69d0ed6fda201d59948acfd89">isVectorLikeInstWithConstOps</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</div>
<div class="line"><a name="l10563"></a><span class="lineno">10563</span>&#160;         !<a class="code" href="namespacellvm.html#a05a7412bf10f2226fb69f2876b76e9cd">doesNotNeedToBeScheduled</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</div>
<div class="line"><a name="l10564"></a><span class="lineno">10564</span>&#160;         <span class="stringliteral">&quot;phi nodes/insertelements/extractelements/extractvalues don&#39;t need to &quot;</span></div>
<div class="line"><a name="l10565"></a><span class="lineno">10565</span>&#160;         <span class="stringliteral">&quot;be scheduled&quot;</span>);</div>
<div class="line"><a name="l10566"></a><span class="lineno">10566</span>&#160;  <span class="keyword">auto</span> &amp;&amp;CheckScheduleForI = [<span class="keyword">this</span>, &amp;<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>](<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) -&gt; <span class="keywordtype">bool</span> {</div>
<div class="line"><a name="l10567"></a><span class="lineno">10567</span>&#160;    ScheduleData *ISD = getScheduleData(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l10568"></a><span class="lineno">10568</span>&#160;    <span class="keywordflow">if</span> (!ISD)</div>
<div class="line"><a name="l10569"></a><span class="lineno">10569</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l10570"></a><span class="lineno">10570</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isInSchedulingRegion(ISD) &amp;&amp;</div>
<div class="line"><a name="l10571"></a><span class="lineno">10571</span>&#160;           <span class="stringliteral">&quot;ScheduleData not in scheduling region&quot;</span>);</div>
<div class="line"><a name="l10572"></a><span class="lineno">10572</span>&#160;    ScheduleData *SD = allocateScheduleDataChunks();</div>
<div class="line"><a name="l10573"></a><span class="lineno">10573</span>&#160;    SD-&gt;Inst = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l10574"></a><span class="lineno">10574</span>&#160;    SD-&gt;init(SchedulingRegionID, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.OpValue);</div>
<div class="line"><a name="l10575"></a><span class="lineno">10575</span>&#160;    ExtraScheduleDataMap[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>][<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.OpValue] = SD;</div>
<div class="line"><a name="l10576"></a><span class="lineno">10576</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l10577"></a><span class="lineno">10577</span>&#160;  };</div>
<div class="line"><a name="l10578"></a><span class="lineno">10578</span>&#160;  <span class="keywordflow">if</span> (CheckScheduleForI(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l10579"></a><span class="lineno">10579</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l10580"></a><span class="lineno">10580</span>&#160;  <span class="keywordflow">if</span> (!ScheduleStart) {</div>
<div class="line"><a name="l10581"></a><span class="lineno">10581</span>&#160;    <span class="comment">// It&#39;s the first instruction in the new region.</span></div>
<div class="line"><a name="l10582"></a><span class="lineno">10582</span>&#160;    initScheduleData(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNextNode(), <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l10583"></a><span class="lineno">10583</span>&#160;    ScheduleStart = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l10584"></a><span class="lineno">10584</span>&#160;    ScheduleEnd = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNextNode();</div>
<div class="line"><a name="l10585"></a><span class="lineno">10585</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#a2207681d736278c6968f548195f1f90c">isOneOf</a>(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) != <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l10586"></a><span class="lineno">10586</span>&#160;      CheckScheduleForI(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l10587"></a><span class="lineno">10587</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ScheduleEnd &amp;&amp; <span class="stringliteral">&quot;tried to vectorize a terminator?&quot;</span>);</div>
<div class="line"><a name="l10588"></a><span class="lineno">10588</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP:  initialize schedule region to &quot;</span> &lt;&lt; *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l10589"></a><span class="lineno">10589</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l10590"></a><span class="lineno">10590</span>&#160;  }</div>
<div class="line"><a name="l10591"></a><span class="lineno">10591</span>&#160;  <span class="comment">// Search up and down at the same time, because we don&#39;t know if the new</span></div>
<div class="line"><a name="l10592"></a><span class="lineno">10592</span>&#160;  <span class="comment">// instruction is above or below the existing scheduling region.</span></div>
<div class="line"><a name="l10593"></a><span class="lineno">10593</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html#a6d3231fb84ed4182ec22e9442a87dbf8">BasicBlock::reverse_iterator</a> UpIter =</div>
<div class="line"><a name="l10594"></a><span class="lineno">10594</span>&#160;      ++ScheduleStart-&gt;getIterator().getReverse();</div>
<div class="line"><a name="l10595"></a><span class="lineno">10595</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html#a6d3231fb84ed4182ec22e9442a87dbf8">BasicBlock::reverse_iterator</a> UpperEnd = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;rend();</div>
<div class="line"><a name="l10596"></a><span class="lineno">10596</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> DownIter = ScheduleEnd-&gt;getIterator();</div>
<div class="line"><a name="l10597"></a><span class="lineno">10597</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> LowerEnd = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;end();</div>
<div class="line"><a name="l10598"></a><span class="lineno">10598</span>&#160;  <span class="keywordflow">while</span> (UpIter != UpperEnd &amp;&amp; DownIter != LowerEnd &amp;&amp; &amp;*UpIter != <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp;</div>
<div class="line"><a name="l10599"></a><span class="lineno">10599</span>&#160;         &amp;*DownIter != <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l10600"></a><span class="lineno">10600</span>&#160;    <span class="keywordflow">if</span> (++ScheduleRegionSize &gt; ScheduleRegionSizeLimit) {</div>
<div class="line"><a name="l10601"></a><span class="lineno">10601</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP:  exceeded schedule region size limit\n&quot;</span>);</div>
<div class="line"><a name="l10602"></a><span class="lineno">10602</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l10603"></a><span class="lineno">10603</span>&#160;    }</div>
<div class="line"><a name="l10604"></a><span class="lineno">10604</span>&#160; </div>
<div class="line"><a name="l10605"></a><span class="lineno">10605</span>&#160;    ++UpIter;</div>
<div class="line"><a name="l10606"></a><span class="lineno">10606</span>&#160;    ++DownIter;</div>
<div class="line"><a name="l10607"></a><span class="lineno">10607</span>&#160;  }</div>
<div class="line"><a name="l10608"></a><span class="lineno">10608</span>&#160;  <span class="keywordflow">if</span> (DownIter == LowerEnd || (UpIter != UpperEnd &amp;&amp; &amp;*UpIter == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l10609"></a><span class="lineno">10609</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() == ScheduleStart-&gt;getParent() &amp;&amp;</div>
<div class="line"><a name="l10610"></a><span class="lineno">10610</span>&#160;           <span class="stringliteral">&quot;Instruction is in wrong basic block.&quot;</span>);</div>
<div class="line"><a name="l10611"></a><span class="lineno">10611</span>&#160;    initScheduleData(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, ScheduleStart, <span class="keyword">nullptr</span>, FirstLoadStoreInRegion);</div>
<div class="line"><a name="l10612"></a><span class="lineno">10612</span>&#160;    ScheduleStart = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l10613"></a><span class="lineno">10613</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#a2207681d736278c6968f548195f1f90c">isOneOf</a>(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) != <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l10614"></a><span class="lineno">10614</span>&#160;      CheckScheduleForI(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l10615"></a><span class="lineno">10615</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP:  extend schedule region start to &quot;</span> &lt;&lt; *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div>
<div class="line"><a name="l10616"></a><span class="lineno">10616</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l10617"></a><span class="lineno">10617</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l10618"></a><span class="lineno">10618</span>&#160;  }</div>
<div class="line"><a name="l10619"></a><span class="lineno">10619</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((UpIter == UpperEnd || (DownIter != LowerEnd &amp;&amp; &amp;*DownIter == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</div>
<div class="line"><a name="l10620"></a><span class="lineno">10620</span>&#160;         <span class="stringliteral">&quot;Expected to reach top of the basic block or instruction down the &quot;</span></div>
<div class="line"><a name="l10621"></a><span class="lineno">10621</span>&#160;         <span class="stringliteral">&quot;lower end.&quot;</span>);</div>
<div class="line"><a name="l10622"></a><span class="lineno">10622</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() == ScheduleEnd-&gt;getParent() &amp;&amp;</div>
<div class="line"><a name="l10623"></a><span class="lineno">10623</span>&#160;         <span class="stringliteral">&quot;Instruction is in wrong basic block.&quot;</span>);</div>
<div class="line"><a name="l10624"></a><span class="lineno">10624</span>&#160;  initScheduleData(ScheduleEnd, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNextNode(), LastLoadStoreInRegion,</div>
<div class="line"><a name="l10625"></a><span class="lineno">10625</span>&#160;                   <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l10626"></a><span class="lineno">10626</span>&#160;  ScheduleEnd = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNextNode();</div>
<div class="line"><a name="l10627"></a><span class="lineno">10627</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#a2207681d736278c6968f548195f1f90c">isOneOf</a>(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) != <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l10628"></a><span class="lineno">10628</span>&#160;    CheckScheduleForI(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l10629"></a><span class="lineno">10629</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ScheduleEnd &amp;&amp; <span class="stringliteral">&quot;tried to vectorize a terminator?&quot;</span>);</div>
<div class="line"><a name="l10630"></a><span class="lineno">10630</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP:  extend schedule region end to &quot;</span> &lt;&lt; *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l10631"></a><span class="lineno">10631</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l10632"></a><span class="lineno">10632</span>&#160;}</div>
<div class="line"><a name="l10633"></a><span class="lineno">10633</span>&#160; </div>
<div class="line"><a name="l10634"></a><span class="lineno">10634</span>&#160;<span class="keywordtype">void</span> BoUpSLP::BlockScheduling::initScheduleData(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *FromI,</div>
<div class="line"><a name="l10635"></a><span class="lineno">10635</span>&#160;                                                <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ToI,</div>
<div class="line"><a name="l10636"></a><span class="lineno">10636</span>&#160;                                                ScheduleData *PrevLoadStore,</div>
<div class="line"><a name="l10637"></a><span class="lineno">10637</span>&#160;                                                ScheduleData *NextLoadStore) {</div>
<div class="line"><a name="l10638"></a><span class="lineno">10638</span>&#160;  ScheduleData *CurrentLoadStore = PrevLoadStore;</div>
<div class="line"><a name="l10639"></a><span class="lineno">10639</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = FromI; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != ToI; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNextNode()) {</div>
<div class="line"><a name="l10640"></a><span class="lineno">10640</span>&#160;    <span class="comment">// No need to allocate data for non-schedulable instructions.</span></div>
<div class="line"><a name="l10641"></a><span class="lineno">10641</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a05a7412bf10f2226fb69f2876b76e9cd">doesNotNeedToBeScheduled</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l10642"></a><span class="lineno">10642</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l10643"></a><span class="lineno">10643</span>&#160;    ScheduleData *SD = ScheduleDataMap.lookup(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l10644"></a><span class="lineno">10644</span>&#160;    <span class="keywordflow">if</span> (!SD) {</div>
<div class="line"><a name="l10645"></a><span class="lineno">10645</span>&#160;      SD = allocateScheduleDataChunks();</div>
<div class="line"><a name="l10646"></a><span class="lineno">10646</span>&#160;      ScheduleDataMap[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = SD;</div>
<div class="line"><a name="l10647"></a><span class="lineno">10647</span>&#160;      SD-&gt;Inst = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l10648"></a><span class="lineno">10648</span>&#160;    }</div>
<div class="line"><a name="l10649"></a><span class="lineno">10649</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!isInSchedulingRegion(SD) &amp;&amp;</div>
<div class="line"><a name="l10650"></a><span class="lineno">10650</span>&#160;           <span class="stringliteral">&quot;new ScheduleData already in scheduling region&quot;</span>);</div>
<div class="line"><a name="l10651"></a><span class="lineno">10651</span>&#160;    SD-&gt;init(SchedulingRegionID, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l10652"></a><span class="lineno">10652</span>&#160; </div>
<div class="line"><a name="l10653"></a><span class="lineno">10653</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayReadOrWriteMemory() &amp;&amp;</div>
<div class="line"><a name="l10654"></a><span class="lineno">10654</span>&#160;        (!isa&lt;IntrinsicInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</div>
<div class="line"><a name="l10655"></a><span class="lineno">10655</span>&#160;         (cast&lt;IntrinsicInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getIntrinsicID() != Intrinsic::sideeffect &amp;&amp;</div>
<div class="line"><a name="l10656"></a><span class="lineno">10656</span>&#160;          cast&lt;IntrinsicInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getIntrinsicID() !=</div>
<div class="line"><a name="l10657"></a><span class="lineno">10657</span>&#160;              Intrinsic::pseudoprobe))) {</div>
<div class="line"><a name="l10658"></a><span class="lineno">10658</span>&#160;      <span class="comment">// Update the linked list of memory accessing instructions.</span></div>
<div class="line"><a name="l10659"></a><span class="lineno">10659</span>&#160;      <span class="keywordflow">if</span> (CurrentLoadStore) {</div>
<div class="line"><a name="l10660"></a><span class="lineno">10660</span>&#160;        CurrentLoadStore-&gt;NextLoadStore = SD;</div>
<div class="line"><a name="l10661"></a><span class="lineno">10661</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l10662"></a><span class="lineno">10662</span>&#160;        FirstLoadStoreInRegion = SD;</div>
<div class="line"><a name="l10663"></a><span class="lineno">10663</span>&#160;      }</div>
<div class="line"><a name="l10664"></a><span class="lineno">10664</span>&#160;      CurrentLoadStore = SD;</div>
<div class="line"><a name="l10665"></a><span class="lineno">10665</span>&#160;    }</div>
<div class="line"><a name="l10666"></a><span class="lineno">10666</span>&#160; </div>
<div class="line"><a name="l10667"></a><span class="lineno">10667</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, m_Intrinsic&lt;Intrinsic::stacksave&gt;()) ||</div>
<div class="line"><a name="l10668"></a><span class="lineno">10668</span>&#160;        <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, m_Intrinsic&lt;Intrinsic::stackrestore&gt;()))</div>
<div class="line"><a name="l10669"></a><span class="lineno">10669</span>&#160;      RegionHasStackSave = <span class="keyword">true</span>;</div>
<div class="line"><a name="l10670"></a><span class="lineno">10670</span>&#160;  }</div>
<div class="line"><a name="l10671"></a><span class="lineno">10671</span>&#160;  <span class="keywordflow">if</span> (NextLoadStore) {</div>
<div class="line"><a name="l10672"></a><span class="lineno">10672</span>&#160;    <span class="keywordflow">if</span> (CurrentLoadStore)</div>
<div class="line"><a name="l10673"></a><span class="lineno">10673</span>&#160;      CurrentLoadStore-&gt;NextLoadStore = NextLoadStore;</div>
<div class="line"><a name="l10674"></a><span class="lineno">10674</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l10675"></a><span class="lineno">10675</span>&#160;    LastLoadStoreInRegion = CurrentLoadStore;</div>
<div class="line"><a name="l10676"></a><span class="lineno">10676</span>&#160;  }</div>
<div class="line"><a name="l10677"></a><span class="lineno">10677</span>&#160;}</div>
<div class="line"><a name="l10678"></a><span class="lineno">10678</span>&#160; </div>
<div class="line"><a name="l10679"></a><span class="lineno">10679</span>&#160;<span class="keywordtype">void</span> BoUpSLP::BlockScheduling::calculateDependencies(ScheduleData *SD,</div>
<div class="line"><a name="l10680"></a><span class="lineno">10680</span>&#160;                                                     <span class="keywordtype">bool</span> InsertInReadyList,</div>
<div class="line"><a name="l10681"></a><span class="lineno">10681</span>&#160;                                                     <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> *SLP) {</div>
<div class="line"><a name="l10682"></a><span class="lineno">10682</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SD-&gt;isSchedulingEntity());</div>
<div class="line"><a name="l10683"></a><span class="lineno">10683</span>&#160; </div>
<div class="line"><a name="l10684"></a><span class="lineno">10684</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;ScheduleData *, 10&gt;</a> WorkList;</div>
<div class="line"><a name="l10685"></a><span class="lineno">10685</span>&#160;  WorkList.push_back(SD);</div>
<div class="line"><a name="l10686"></a><span class="lineno">10686</span>&#160; </div>
<div class="line"><a name="l10687"></a><span class="lineno">10687</span>&#160;  <span class="keywordflow">while</span> (!WorkList.empty()) {</div>
<div class="line"><a name="l10688"></a><span class="lineno">10688</span>&#160;    ScheduleData *SD = WorkList.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a0c8ffe664a36e30d49c84d0aded2fe08">pop_back_val</a>();</div>
<div class="line"><a name="l10689"></a><span class="lineno">10689</span>&#160;    <span class="keywordflow">for</span> (ScheduleData *BundleMember = SD; BundleMember;</div>
<div class="line"><a name="l10690"></a><span class="lineno">10690</span>&#160;         BundleMember = BundleMember-&gt;NextInBundle) {</div>
<div class="line"><a name="l10691"></a><span class="lineno">10691</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isInSchedulingRegion(BundleMember));</div>
<div class="line"><a name="l10692"></a><span class="lineno">10692</span>&#160;      <span class="keywordflow">if</span> (BundleMember-&gt;hasValidDependencies())</div>
<div class="line"><a name="l10693"></a><span class="lineno">10693</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l10694"></a><span class="lineno">10694</span>&#160; </div>
<div class="line"><a name="l10695"></a><span class="lineno">10695</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP:       update deps of &quot;</span> &lt;&lt; *BundleMember</div>
<div class="line"><a name="l10696"></a><span class="lineno">10696</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l10697"></a><span class="lineno">10697</span>&#160;      BundleMember-&gt;Dependencies = 0;</div>
<div class="line"><a name="l10698"></a><span class="lineno">10698</span>&#160;      BundleMember-&gt;resetUnscheduledDeps();</div>
<div class="line"><a name="l10699"></a><span class="lineno">10699</span>&#160; </div>
<div class="line"><a name="l10700"></a><span class="lineno">10700</span>&#160;      <span class="comment">// Handle def-use chain dependencies.</span></div>
<div class="line"><a name="l10701"></a><span class="lineno">10701</span>&#160;      <span class="keywordflow">if</span> (BundleMember-&gt;OpValue != BundleMember-&gt;Inst) {</div>
<div class="line"><a name="l10702"></a><span class="lineno">10702</span>&#160;        <span class="keywordflow">if</span> (ScheduleData *UseSD = getScheduleData(BundleMember-&gt;Inst)) {</div>
<div class="line"><a name="l10703"></a><span class="lineno">10703</span>&#160;          BundleMember-&gt;Dependencies++;</div>
<div class="line"><a name="l10704"></a><span class="lineno">10704</span>&#160;          ScheduleData *DestBundle = UseSD-&gt;FirstInBundle;</div>
<div class="line"><a name="l10705"></a><span class="lineno">10705</span>&#160;          <span class="keywordflow">if</span> (!DestBundle-&gt;IsScheduled)</div>
<div class="line"><a name="l10706"></a><span class="lineno">10706</span>&#160;            BundleMember-&gt;incrementUnscheduledDeps(1);</div>
<div class="line"><a name="l10707"></a><span class="lineno">10707</span>&#160;          <span class="keywordflow">if</span> (!DestBundle-&gt;hasValidDependencies())</div>
<div class="line"><a name="l10708"></a><span class="lineno">10708</span>&#160;            WorkList.push_back(DestBundle);</div>
<div class="line"><a name="l10709"></a><span class="lineno">10709</span>&#160;        }</div>
<div class="line"><a name="l10710"></a><span class="lineno">10710</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l10711"></a><span class="lineno">10711</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1User.html">User</a> *U : BundleMember-&gt;Inst-&gt;users()) {</div>
<div class="line"><a name="l10712"></a><span class="lineno">10712</span>&#160;          <span class="keywordflow">if</span> (ScheduleData *UseSD = getScheduleData(cast&lt;Instruction&gt;(U))) {</div>
<div class="line"><a name="l10713"></a><span class="lineno">10713</span>&#160;            BundleMember-&gt;Dependencies++;</div>
<div class="line"><a name="l10714"></a><span class="lineno">10714</span>&#160;            ScheduleData *DestBundle = UseSD-&gt;FirstInBundle;</div>
<div class="line"><a name="l10715"></a><span class="lineno">10715</span>&#160;            <span class="keywordflow">if</span> (!DestBundle-&gt;IsScheduled)</div>
<div class="line"><a name="l10716"></a><span class="lineno">10716</span>&#160;              BundleMember-&gt;incrementUnscheduledDeps(1);</div>
<div class="line"><a name="l10717"></a><span class="lineno">10717</span>&#160;            <span class="keywordflow">if</span> (!DestBundle-&gt;hasValidDependencies())</div>
<div class="line"><a name="l10718"></a><span class="lineno">10718</span>&#160;              WorkList.push_back(DestBundle);</div>
<div class="line"><a name="l10719"></a><span class="lineno">10719</span>&#160;          }</div>
<div class="line"><a name="l10720"></a><span class="lineno">10720</span>&#160;        }</div>
<div class="line"><a name="l10721"></a><span class="lineno">10721</span>&#160;      }</div>
<div class="line"><a name="l10722"></a><span class="lineno">10722</span>&#160; </div>
<div class="line"><a name="l10723"></a><span class="lineno">10723</span>&#160;      <span class="keyword">auto</span> makeControlDependent = [&amp;](<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l10724"></a><span class="lineno">10724</span>&#160;        <span class="keyword">auto</span> *DepDest = getScheduleData(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l10725"></a><span class="lineno">10725</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DepDest &amp;&amp; <span class="stringliteral">&quot;must be in schedule window&quot;</span>);</div>
<div class="line"><a name="l10726"></a><span class="lineno">10726</span>&#160;        DepDest-&gt;ControlDependencies.push_back(BundleMember);</div>
<div class="line"><a name="l10727"></a><span class="lineno">10727</span>&#160;        BundleMember-&gt;Dependencies++;</div>
<div class="line"><a name="l10728"></a><span class="lineno">10728</span>&#160;        ScheduleData *DestBundle = DepDest-&gt;FirstInBundle;</div>
<div class="line"><a name="l10729"></a><span class="lineno">10729</span>&#160;        <span class="keywordflow">if</span> (!DestBundle-&gt;IsScheduled)</div>
<div class="line"><a name="l10730"></a><span class="lineno">10730</span>&#160;          BundleMember-&gt;incrementUnscheduledDeps(1);</div>
<div class="line"><a name="l10731"></a><span class="lineno">10731</span>&#160;        <span class="keywordflow">if</span> (!DestBundle-&gt;hasValidDependencies())</div>
<div class="line"><a name="l10732"></a><span class="lineno">10732</span>&#160;          WorkList.push_back(DestBundle);</div>
<div class="line"><a name="l10733"></a><span class="lineno">10733</span>&#160;      };</div>
<div class="line"><a name="l10734"></a><span class="lineno">10734</span>&#160; </div>
<div class="line"><a name="l10735"></a><span class="lineno">10735</span>&#160;      <span class="comment">// Any instruction which isn&#39;t safe to speculate at the beginning of the</span></div>
<div class="line"><a name="l10736"></a><span class="lineno">10736</span>&#160;      <span class="comment">// block is control dependend on any early exit or non-willreturn call</span></div>
<div class="line"><a name="l10737"></a><span class="lineno">10737</span>&#160;      <span class="comment">// which proceeds it.</span></div>
<div class="line"><a name="l10738"></a><span class="lineno">10738</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#abff5a423c1f45e23958dde8ee695c9a9">isGuaranteedToTransferExecutionToSuccessor</a>(BundleMember-&gt;Inst)) {</div>
<div class="line"><a name="l10739"></a><span class="lineno">10739</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BundleMember-&gt;Inst-&gt;getNextNode();</div>
<div class="line"><a name="l10740"></a><span class="lineno">10740</span>&#160;             <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != ScheduleEnd; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNextNode()) {</div>
<div class="line"><a name="l10741"></a><span class="lineno">10741</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#abe76d72cda6b2b4562c72accb510040b">isSafeToSpeculativelyExecute</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, &amp;*<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;begin(), SLP-&gt;AC))</div>
<div class="line"><a name="l10742"></a><span class="lineno">10742</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l10743"></a><span class="lineno">10743</span>&#160; </div>
<div class="line"><a name="l10744"></a><span class="lineno">10744</span>&#160;          <span class="comment">// Add the dependency</span></div>
<div class="line"><a name="l10745"></a><span class="lineno">10745</span>&#160;          makeControlDependent(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l10746"></a><span class="lineno">10746</span>&#160; </div>
<div class="line"><a name="l10747"></a><span class="lineno">10747</span>&#160;          <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#abff5a423c1f45e23958dde8ee695c9a9">isGuaranteedToTransferExecutionToSuccessor</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l10748"></a><span class="lineno">10748</span>&#160;            <span class="comment">// Everything past here must be control dependent on I.</span></div>
<div class="line"><a name="l10749"></a><span class="lineno">10749</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l10750"></a><span class="lineno">10750</span>&#160;        }</div>
<div class="line"><a name="l10751"></a><span class="lineno">10751</span>&#160;      }</div>
<div class="line"><a name="l10752"></a><span class="lineno">10752</span>&#160; </div>
<div class="line"><a name="l10753"></a><span class="lineno">10753</span>&#160;      <span class="keywordflow">if</span> (RegionHasStackSave) {</div>
<div class="line"><a name="l10754"></a><span class="lineno">10754</span>&#160;        <span class="comment">// If we have an inalloc alloca instruction, it needs to be scheduled</span></div>
<div class="line"><a name="l10755"></a><span class="lineno">10755</span>&#160;        <span class="comment">// after any preceeding stacksave.  We also need to prevent any alloca</span></div>
<div class="line"><a name="l10756"></a><span class="lineno">10756</span>&#160;        <span class="comment">// from reordering above a preceeding stackrestore.</span></div>
<div class="line"><a name="l10757"></a><span class="lineno">10757</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BundleMember-&gt;Inst, m_Intrinsic&lt;Intrinsic::stacksave&gt;()) ||</div>
<div class="line"><a name="l10758"></a><span class="lineno">10758</span>&#160;            <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BundleMember-&gt;Inst, m_Intrinsic&lt;Intrinsic::stackrestore&gt;())) {</div>
<div class="line"><a name="l10759"></a><span class="lineno">10759</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BundleMember-&gt;Inst-&gt;getNextNode();</div>
<div class="line"><a name="l10760"></a><span class="lineno">10760</span>&#160;               <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != ScheduleEnd; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNextNode()) {</div>
<div class="line"><a name="l10761"></a><span class="lineno">10761</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, m_Intrinsic&lt;Intrinsic::stacksave&gt;()) ||</div>
<div class="line"><a name="l10762"></a><span class="lineno">10762</span>&#160;                <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, m_Intrinsic&lt;Intrinsic::stackrestore&gt;()))</div>
<div class="line"><a name="l10763"></a><span class="lineno">10763</span>&#160;              <span class="comment">// Any allocas past here must be control dependent on I, and I</span></div>
<div class="line"><a name="l10764"></a><span class="lineno">10764</span>&#160;              <span class="comment">// must be memory dependend on BundleMember-&gt;Inst.</span></div>
<div class="line"><a name="l10765"></a><span class="lineno">10765</span>&#160;              <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l10766"></a><span class="lineno">10766</span>&#160; </div>
<div class="line"><a name="l10767"></a><span class="lineno">10767</span>&#160;            <span class="keywordflow">if</span> (!isa&lt;AllocaInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l10768"></a><span class="lineno">10768</span>&#160;              <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l10769"></a><span class="lineno">10769</span>&#160; </div>
<div class="line"><a name="l10770"></a><span class="lineno">10770</span>&#160;            <span class="comment">// Add the dependency</span></div>
<div class="line"><a name="l10771"></a><span class="lineno">10771</span>&#160;            makeControlDependent(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l10772"></a><span class="lineno">10772</span>&#160;          }</div>
<div class="line"><a name="l10773"></a><span class="lineno">10773</span>&#160;        }</div>
<div class="line"><a name="l10774"></a><span class="lineno">10774</span>&#160; </div>
<div class="line"><a name="l10775"></a><span class="lineno">10775</span>&#160;        <span class="comment">// In addition to the cases handle just above, we need to prevent</span></div>
<div class="line"><a name="l10776"></a><span class="lineno">10776</span>&#160;        <span class="comment">// allocas and loads/stores from moving below a stacksave or a</span></div>
<div class="line"><a name="l10777"></a><span class="lineno">10777</span>&#160;        <span class="comment">// stackrestore. Avoiding moving allocas below stackrestore is currently</span></div>
<div class="line"><a name="l10778"></a><span class="lineno">10778</span>&#160;        <span class="comment">// thought to be conservatism. Moving loads/stores below a stackrestore</span></div>
<div class="line"><a name="l10779"></a><span class="lineno">10779</span>&#160;        <span class="comment">// can lead to incorrect code.</span></div>
<div class="line"><a name="l10780"></a><span class="lineno">10780</span>&#160;        <span class="keywordflow">if</span> (isa&lt;AllocaInst&gt;(BundleMember-&gt;Inst) ||</div>
<div class="line"><a name="l10781"></a><span class="lineno">10781</span>&#160;            BundleMember-&gt;Inst-&gt;mayReadOrWriteMemory()) {</div>
<div class="line"><a name="l10782"></a><span class="lineno">10782</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BundleMember-&gt;Inst-&gt;getNextNode();</div>
<div class="line"><a name="l10783"></a><span class="lineno">10783</span>&#160;               <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != ScheduleEnd; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNextNode()) {</div>
<div class="line"><a name="l10784"></a><span class="lineno">10784</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, m_Intrinsic&lt;Intrinsic::stacksave&gt;()) &amp;&amp;</div>
<div class="line"><a name="l10785"></a><span class="lineno">10785</span>&#160;                !<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, m_Intrinsic&lt;Intrinsic::stackrestore&gt;()))</div>
<div class="line"><a name="l10786"></a><span class="lineno">10786</span>&#160;              <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l10787"></a><span class="lineno">10787</span>&#160; </div>
<div class="line"><a name="l10788"></a><span class="lineno">10788</span>&#160;            <span class="comment">// Add the dependency</span></div>
<div class="line"><a name="l10789"></a><span class="lineno">10789</span>&#160;            makeControlDependent(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l10790"></a><span class="lineno">10790</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l10791"></a><span class="lineno">10791</span>&#160;          }</div>
<div class="line"><a name="l10792"></a><span class="lineno">10792</span>&#160;        }</div>
<div class="line"><a name="l10793"></a><span class="lineno">10793</span>&#160;      }</div>
<div class="line"><a name="l10794"></a><span class="lineno">10794</span>&#160; </div>
<div class="line"><a name="l10795"></a><span class="lineno">10795</span>&#160;      <span class="comment">// Handle the memory dependencies (if any).</span></div>
<div class="line"><a name="l10796"></a><span class="lineno">10796</span>&#160;      ScheduleData *DepDest = BundleMember-&gt;NextLoadStore;</div>
<div class="line"><a name="l10797"></a><span class="lineno">10797</span>&#160;      <span class="keywordflow">if</span> (!DepDest)</div>
<div class="line"><a name="l10798"></a><span class="lineno">10798</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l10799"></a><span class="lineno">10799</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *SrcInst = BundleMember-&gt;Inst;</div>
<div class="line"><a name="l10800"></a><span class="lineno">10800</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SrcInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a2d77b9d450543e86acb394ff6dda6b53">mayReadOrWriteMemory</a>() &amp;&amp;</div>
<div class="line"><a name="l10801"></a><span class="lineno">10801</span>&#160;             <span class="stringliteral">&quot;NextLoadStore list for non memory effecting bundle?&quot;</span>);</div>
<div class="line"><a name="l10802"></a><span class="lineno">10802</span>&#160;      <a class="code" href="classllvm_1_1MemoryLocation.html">MemoryLocation</a> SrcLoc = <a class="code" href="SLPVectorizer_8cpp.html#aae9f536130472bd3fbdd23c3d4486b3b">getLocation</a>(SrcInst);</div>
<div class="line"><a name="l10803"></a><span class="lineno">10803</span>&#160;      <span class="keywordtype">bool</span> SrcMayWrite = BundleMember-&gt;Inst-&gt;mayWriteToMemory();</div>
<div class="line"><a name="l10804"></a><span class="lineno">10804</span>&#160;      <span class="keywordtype">unsigned</span> numAliased = 0;</div>
<div class="line"><a name="l10805"></a><span class="lineno">10805</span>&#160;      <span class="keywordtype">unsigned</span> DistToSrc = 1;</div>
<div class="line"><a name="l10806"></a><span class="lineno">10806</span>&#160; </div>
<div class="line"><a name="l10807"></a><span class="lineno">10807</span>&#160;      <span class="keywordflow">for</span> ( ; DepDest; DepDest = DepDest-&gt;NextLoadStore) {</div>
<div class="line"><a name="l10808"></a><span class="lineno">10808</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isInSchedulingRegion(DepDest));</div>
<div class="line"><a name="l10809"></a><span class="lineno">10809</span>&#160; </div>
<div class="line"><a name="l10810"></a><span class="lineno">10810</span>&#160;        <span class="comment">// We have two limits to reduce the complexity:</span></div>
<div class="line"><a name="l10811"></a><span class="lineno">10811</span>&#160;        <span class="comment">// 1) AliasedCheckLimit: It&#39;s a small limit to reduce calls to</span></div>
<div class="line"><a name="l10812"></a><span class="lineno">10812</span>&#160;        <span class="comment">//    SLP-&gt;isAliased (which is the expensive part in this loop).</span></div>
<div class="line"><a name="l10813"></a><span class="lineno">10813</span>&#160;        <span class="comment">// 2) MaxMemDepDistance: It&#39;s for very large blocks and it aborts</span></div>
<div class="line"><a name="l10814"></a><span class="lineno">10814</span>&#160;        <span class="comment">//    the whole loop (even if the loop is fast, it&#39;s quadratic).</span></div>
<div class="line"><a name="l10815"></a><span class="lineno">10815</span>&#160;        <span class="comment">//    It&#39;s important for the loop break condition (see below) to</span></div>
<div class="line"><a name="l10816"></a><span class="lineno">10816</span>&#160;        <span class="comment">//    check this limit even between two read-only instructions.</span></div>
<div class="line"><a name="l10817"></a><span class="lineno">10817</span>&#160;        <span class="keywordflow">if</span> (DistToSrc &gt;= <a class="code" href="SLPVectorizer_8cpp.html#a4ce8fdf40e75ddf217650e2b1b15b5e6">MaxMemDepDistance</a> ||</div>
<div class="line"><a name="l10818"></a><span class="lineno">10818</span>&#160;            ((SrcMayWrite || DepDest-&gt;Inst-&gt;mayWriteToMemory()) &amp;&amp;</div>
<div class="line"><a name="l10819"></a><span class="lineno">10819</span>&#160;             (numAliased &gt;= <a class="code" href="SLPVectorizer_8cpp.html#a9d624115133c3a9ac3109be4be89a32f">AliasedCheckLimit</a> ||</div>
<div class="line"><a name="l10820"></a><span class="lineno">10820</span>&#160;              SLP-&gt;isAliased(SrcLoc, SrcInst, DepDest-&gt;Inst)))) {</div>
<div class="line"><a name="l10821"></a><span class="lineno">10821</span>&#160; </div>
<div class="line"><a name="l10822"></a><span class="lineno">10822</span>&#160;          <span class="comment">// We increment the counter only if the locations are aliased</span></div>
<div class="line"><a name="l10823"></a><span class="lineno">10823</span>&#160;          <span class="comment">// (instead of counting all alias checks). This gives a better</span></div>
<div class="line"><a name="l10824"></a><span class="lineno">10824</span>&#160;          <span class="comment">// balance between reduced runtime and accurate dependencies.</span></div>
<div class="line"><a name="l10825"></a><span class="lineno">10825</span>&#160;          numAliased++;</div>
<div class="line"><a name="l10826"></a><span class="lineno">10826</span>&#160; </div>
<div class="line"><a name="l10827"></a><span class="lineno">10827</span>&#160;          DepDest-&gt;MemoryDependencies.push_back(BundleMember);</div>
<div class="line"><a name="l10828"></a><span class="lineno">10828</span>&#160;          BundleMember-&gt;Dependencies++;</div>
<div class="line"><a name="l10829"></a><span class="lineno">10829</span>&#160;          ScheduleData *DestBundle = DepDest-&gt;FirstInBundle;</div>
<div class="line"><a name="l10830"></a><span class="lineno">10830</span>&#160;          <span class="keywordflow">if</span> (!DestBundle-&gt;IsScheduled) {</div>
<div class="line"><a name="l10831"></a><span class="lineno">10831</span>&#160;            BundleMember-&gt;incrementUnscheduledDeps(1);</div>
<div class="line"><a name="l10832"></a><span class="lineno">10832</span>&#160;          }</div>
<div class="line"><a name="l10833"></a><span class="lineno">10833</span>&#160;          <span class="keywordflow">if</span> (!DestBundle-&gt;hasValidDependencies()) {</div>
<div class="line"><a name="l10834"></a><span class="lineno">10834</span>&#160;            WorkList.push_back(DestBundle);</div>
<div class="line"><a name="l10835"></a><span class="lineno">10835</span>&#160;          }</div>
<div class="line"><a name="l10836"></a><span class="lineno">10836</span>&#160;        }</div>
<div class="line"><a name="l10837"></a><span class="lineno">10837</span>&#160; </div>
<div class="line"><a name="l10838"></a><span class="lineno">10838</span>&#160;        <span class="comment">// Example, explaining the loop break condition: Let&#39;s assume our</span></div>
<div class="line"><a name="l10839"></a><span class="lineno">10839</span>&#160;        <span class="comment">// starting instruction is i0 and MaxMemDepDistance = 3.</span></div>
<div class="line"><a name="l10840"></a><span class="lineno">10840</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l10841"></a><span class="lineno">10841</span>&#160;        <span class="comment">//                      +--------v--v--v</span></div>
<div class="line"><a name="l10842"></a><span class="lineno">10842</span>&#160;        <span class="comment">//             i0,i1,i2,i3,i4,i5,i6,i7,i8</span></div>
<div class="line"><a name="l10843"></a><span class="lineno">10843</span>&#160;        <span class="comment">//             +--------^--^--^</span></div>
<div class="line"><a name="l10844"></a><span class="lineno">10844</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l10845"></a><span class="lineno">10845</span>&#160;        <span class="comment">// MaxMemDepDistance let us stop alias-checking at i3 and we add</span></div>
<div class="line"><a name="l10846"></a><span class="lineno">10846</span>&#160;        <span class="comment">// dependencies from i0 to i3,i4,.. (even if they are not aliased).</span></div>
<div class="line"><a name="l10847"></a><span class="lineno">10847</span>&#160;        <span class="comment">// Previously we already added dependencies from i3 to i6,i7,i8</span></div>
<div class="line"><a name="l10848"></a><span class="lineno">10848</span>&#160;        <span class="comment">// (because of MaxMemDepDistance). As we added a dependency from</span></div>
<div class="line"><a name="l10849"></a><span class="lineno">10849</span>&#160;        <span class="comment">// i0 to i3, we have transitive dependencies from i0 to i6,i7,i8</span></div>
<div class="line"><a name="l10850"></a><span class="lineno">10850</span>&#160;        <span class="comment">// and we can abort this loop at i6.</span></div>
<div class="line"><a name="l10851"></a><span class="lineno">10851</span>&#160;        <span class="keywordflow">if</span> (DistToSrc &gt;= 2 * <a class="code" href="SLPVectorizer_8cpp.html#a4ce8fdf40e75ddf217650e2b1b15b5e6">MaxMemDepDistance</a>)</div>
<div class="line"><a name="l10852"></a><span class="lineno">10852</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l10853"></a><span class="lineno">10853</span>&#160;        DistToSrc++;</div>
<div class="line"><a name="l10854"></a><span class="lineno">10854</span>&#160;      }</div>
<div class="line"><a name="l10855"></a><span class="lineno">10855</span>&#160;    }</div>
<div class="line"><a name="l10856"></a><span class="lineno">10856</span>&#160;    <span class="keywordflow">if</span> (InsertInReadyList &amp;&amp; SD-&gt;isReady()) {</div>
<div class="line"><a name="l10857"></a><span class="lineno">10857</span>&#160;      ReadyInsts.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a94d23373106467003722f7d6c17b1528">insert</a>(SD);</div>
<div class="line"><a name="l10858"></a><span class="lineno">10858</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP:     gets ready on update: &quot;</span> &lt;&lt; *SD-&gt;Inst</div>
<div class="line"><a name="l10859"></a><span class="lineno">10859</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l10860"></a><span class="lineno">10860</span>&#160;    }</div>
<div class="line"><a name="l10861"></a><span class="lineno">10861</span>&#160;  }</div>
<div class="line"><a name="l10862"></a><span class="lineno">10862</span>&#160;}</div>
<div class="line"><a name="l10863"></a><span class="lineno">10863</span>&#160; </div>
<div class="line"><a name="l10864"></a><span class="lineno">10864</span>&#160;<span class="keywordtype">void</span> BoUpSLP::BlockScheduling::resetSchedule() {</div>
<div class="line"><a name="l10865"></a><span class="lineno">10865</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ScheduleStart &amp;&amp;</div>
<div class="line"><a name="l10866"></a><span class="lineno">10866</span>&#160;         <span class="stringliteral">&quot;tried to reset schedule on block which has not been scheduled&quot;</span>);</div>
<div class="line"><a name="l10867"></a><span class="lineno">10867</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = ScheduleStart; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != ScheduleEnd; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNextNode()) {</div>
<div class="line"><a name="l10868"></a><span class="lineno">10868</span>&#160;    doForAllOpcodes(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, [&amp;](ScheduleData *SD) {</div>
<div class="line"><a name="l10869"></a><span class="lineno">10869</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isInSchedulingRegion(SD) &amp;&amp;</div>
<div class="line"><a name="l10870"></a><span class="lineno">10870</span>&#160;             <span class="stringliteral">&quot;ScheduleData not in scheduling region&quot;</span>);</div>
<div class="line"><a name="l10871"></a><span class="lineno">10871</span>&#160;      SD-&gt;IsScheduled = <span class="keyword">false</span>;</div>
<div class="line"><a name="l10872"></a><span class="lineno">10872</span>&#160;      SD-&gt;resetUnscheduledDeps();</div>
<div class="line"><a name="l10873"></a><span class="lineno">10873</span>&#160;    });</div>
<div class="line"><a name="l10874"></a><span class="lineno">10874</span>&#160;  }</div>
<div class="line"><a name="l10875"></a><span class="lineno">10875</span>&#160;  ReadyInsts.clear();</div>
<div class="line"><a name="l10876"></a><span class="lineno">10876</span>&#160;}</div>
<div class="line"><a name="l10877"></a><span class="lineno">10877</span>&#160; </div>
<div class="line"><a name="l10878"></a><span class="lineno">10878</span>&#160;<span class="keywordtype">void</span> BoUpSLP::scheduleBlock(BlockScheduling *BS) {</div>
<div class="line"><a name="l10879"></a><span class="lineno">10879</span>&#160;  <span class="keywordflow">if</span> (!BS-&gt;ScheduleStart)</div>
<div class="line"><a name="l10880"></a><span class="lineno">10880</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l10881"></a><span class="lineno">10881</span>&#160; </div>
<div class="line"><a name="l10882"></a><span class="lineno">10882</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: schedule block &quot;</span> &lt;&lt; BS-&gt;BB-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l10883"></a><span class="lineno">10883</span>&#160; </div>
<div class="line"><a name="l10884"></a><span class="lineno">10884</span>&#160;  <span class="comment">// A key point - if we got here, pre-scheduling was able to find a valid</span></div>
<div class="line"><a name="l10885"></a><span class="lineno">10885</span>&#160;  <span class="comment">// scheduling of the sub-graph of the scheduling window which consists</span></div>
<div class="line"><a name="l10886"></a><span class="lineno">10886</span>&#160;  <span class="comment">// of all vector bundles and their transitive users.  As such, we do not</span></div>
<div class="line"><a name="l10887"></a><span class="lineno">10887</span>&#160;  <span class="comment">// need to reschedule anything *outside of* that subgraph.</span></div>
<div class="line"><a name="l10888"></a><span class="lineno">10888</span>&#160; </div>
<div class="line"><a name="l10889"></a><span class="lineno">10889</span>&#160;  BS-&gt;resetSchedule();</div>
<div class="line"><a name="l10890"></a><span class="lineno">10890</span>&#160; </div>
<div class="line"><a name="l10891"></a><span class="lineno">10891</span>&#160;  <span class="comment">// For the real scheduling we use a more sophisticated ready-list: it is</span></div>
<div class="line"><a name="l10892"></a><span class="lineno">10892</span>&#160;  <span class="comment">// sorted by the original instruction location. This lets the final schedule</span></div>
<div class="line"><a name="l10893"></a><span class="lineno">10893</span>&#160;  <span class="comment">// be as  close as possible to the original instruction order.</span></div>
<div class="line"><a name="l10894"></a><span class="lineno">10894</span>&#160;  <span class="comment">// WARNING: If changing this order causes a correctness issue, that means</span></div>
<div class="line"><a name="l10895"></a><span class="lineno">10895</span>&#160;  <span class="comment">// there is some missing dependence edge in the schedule data graph.</span></div>
<div class="line"><a name="l10896"></a><span class="lineno">10896</span>&#160;  <span class="keyword">struct </span>ScheduleDataCompare {</div>
<div class="line"><a name="l10897"></a><span class="lineno">10897</span>&#160;    <span class="keywordtype">bool</span> operator()(ScheduleData *SD1, ScheduleData *SD2)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l10898"></a><span class="lineno">10898</span>&#160;      <span class="keywordflow">return</span> SD2-&gt;SchedulingPriority &lt; SD1-&gt;SchedulingPriority;</div>
<div class="line"><a name="l10899"></a><span class="lineno">10899</span>&#160;    }</div>
<div class="line"><a name="l10900"></a><span class="lineno">10900</span>&#160;  };</div>
<div class="line"><a name="l10901"></a><span class="lineno">10901</span>&#160;  std::set&lt;ScheduleData *, ScheduleDataCompare&gt; ReadyInsts;</div>
<div class="line"><a name="l10902"></a><span class="lineno">10902</span>&#160; </div>
<div class="line"><a name="l10903"></a><span class="lineno">10903</span>&#160;  <span class="comment">// Ensure that all dependency data is updated (for nodes in the sub-graph)</span></div>
<div class="line"><a name="l10904"></a><span class="lineno">10904</span>&#160;  <span class="comment">// and fill the ready-list with initial instructions.</span></div>
<div class="line"><a name="l10905"></a><span class="lineno">10905</span>&#160;  <span class="keywordtype">int</span> Idx = 0;</div>
<div class="line"><a name="l10906"></a><span class="lineno">10906</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BS-&gt;ScheduleStart; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != BS-&gt;ScheduleEnd;</div>
<div class="line"><a name="l10907"></a><span class="lineno">10907</span>&#160;       <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNextNode()) {</div>
<div class="line"><a name="l10908"></a><span class="lineno">10908</span>&#160;    BS-&gt;doForAllOpcodes(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, [<span class="keyword">this</span>, &amp;Idx, BS](ScheduleData *SD) {</div>
<div class="line"><a name="l10909"></a><span class="lineno">10909</span>&#160;      TreeEntry *SDTE = getTreeEntry(SD-&gt;Inst);</div>
<div class="line"><a name="l10910"></a><span class="lineno">10910</span>&#160;      (void)SDTE;</div>
<div class="line"><a name="l10911"></a><span class="lineno">10911</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a class="code" href="SLPVectorizer_8cpp.html#a06a9edb69d0ed6fda201d59948acfd89">isVectorLikeInstWithConstOps</a>(SD-&gt;Inst) ||</div>
<div class="line"><a name="l10912"></a><span class="lineno">10912</span>&#160;              SD-&gt;isPartOfBundle() ==</div>
<div class="line"><a name="l10913"></a><span class="lineno">10913</span>&#160;                  (SDTE &amp;&amp; !<a class="code" href="namespacellvm.html#abed730d9d5b8f4c70f4fbe1094a0157f">doesNotNeedToSchedule</a>(SDTE-&gt;Scalars))) &amp;&amp;</div>
<div class="line"><a name="l10914"></a><span class="lineno">10914</span>&#160;             <span class="stringliteral">&quot;scheduler and vectorizer bundle mismatch&quot;</span>);</div>
<div class="line"><a name="l10915"></a><span class="lineno">10915</span>&#160;      SD-&gt;FirstInBundle-&gt;SchedulingPriority = Idx++;</div>
<div class="line"><a name="l10916"></a><span class="lineno">10916</span>&#160; </div>
<div class="line"><a name="l10917"></a><span class="lineno">10917</span>&#160;      <span class="keywordflow">if</span> (SD-&gt;isSchedulingEntity() &amp;&amp; SD-&gt;isPartOfBundle())</div>
<div class="line"><a name="l10918"></a><span class="lineno">10918</span>&#160;        BS-&gt;calculateDependencies(SD, <span class="keyword">false</span>, <span class="keyword">this</span>);</div>
<div class="line"><a name="l10919"></a><span class="lineno">10919</span>&#160;    });</div>
<div class="line"><a name="l10920"></a><span class="lineno">10920</span>&#160;  }</div>
<div class="line"><a name="l10921"></a><span class="lineno">10921</span>&#160;  BS-&gt;initialFillReadyList(ReadyInsts);</div>
<div class="line"><a name="l10922"></a><span class="lineno">10922</span>&#160; </div>
<div class="line"><a name="l10923"></a><span class="lineno">10923</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *LastScheduledInst = BS-&gt;ScheduleEnd;</div>
<div class="line"><a name="l10924"></a><span class="lineno">10924</span>&#160; </div>
<div class="line"><a name="l10925"></a><span class="lineno">10925</span>&#160;  <span class="comment">// Do the &quot;real&quot; scheduling.</span></div>
<div class="line"><a name="l10926"></a><span class="lineno">10926</span>&#160;  <span class="keywordflow">while</span> (!ReadyInsts.empty()) {</div>
<div class="line"><a name="l10927"></a><span class="lineno">10927</span>&#160;    ScheduleData *picked = *ReadyInsts.begin();</div>
<div class="line"><a name="l10928"></a><span class="lineno">10928</span>&#160;    ReadyInsts.erase(ReadyInsts.begin());</div>
<div class="line"><a name="l10929"></a><span class="lineno">10929</span>&#160; </div>
<div class="line"><a name="l10930"></a><span class="lineno">10930</span>&#160;    <span class="comment">// Move the scheduled instruction(s) to their dedicated places, if not</span></div>
<div class="line"><a name="l10931"></a><span class="lineno">10931</span>&#160;    <span class="comment">// there yet.</span></div>
<div class="line"><a name="l10932"></a><span class="lineno">10932</span>&#160;    <span class="keywordflow">for</span> (ScheduleData *BundleMember = picked; BundleMember;</div>
<div class="line"><a name="l10933"></a><span class="lineno">10933</span>&#160;         BundleMember = BundleMember-&gt;NextInBundle) {</div>
<div class="line"><a name="l10934"></a><span class="lineno">10934</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *pickedInst = BundleMember-&gt;Inst;</div>
<div class="line"><a name="l10935"></a><span class="lineno">10935</span>&#160;      <span class="keywordflow">if</span> (pickedInst-&gt;<a class="code" href="classllvm_1_1ilist__node__with__parent.html#a26708685cc8b94fe3d7092ee080dbb34">getNextNode</a>() != LastScheduledInst)</div>
<div class="line"><a name="l10936"></a><span class="lineno">10936</span>&#160;        pickedInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(LastScheduledInst);</div>
<div class="line"><a name="l10937"></a><span class="lineno">10937</span>&#160;      LastScheduledInst = pickedInst;</div>
<div class="line"><a name="l10938"></a><span class="lineno">10938</span>&#160;    }</div>
<div class="line"><a name="l10939"></a><span class="lineno">10939</span>&#160; </div>
<div class="line"><a name="l10940"></a><span class="lineno">10940</span>&#160;    BS-&gt;schedule(picked, ReadyInsts);</div>
<div class="line"><a name="l10941"></a><span class="lineno">10941</span>&#160;  }</div>
<div class="line"><a name="l10942"></a><span class="lineno">10942</span>&#160; </div>
<div class="line"><a name="l10943"></a><span class="lineno">10943</span>&#160;  <span class="comment">// Check that we didn&#39;t break any of our invariants.</span></div>
<div class="line"><a name="l10944"></a><span class="lineno">10944</span>&#160;<span class="preprocessor">#ifdef EXPENSIVE_CHECKS</span></div>
<div class="line"><a name="l10945"></a><span class="lineno">10945</span>&#160;  BS-&gt;verify();</div>
<div class="line"><a name="l10946"></a><span class="lineno">10946</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l10947"></a><span class="lineno">10947</span>&#160; </div>
<div class="line"><a name="l10948"></a><span class="lineno">10948</span>&#160;<span class="preprocessor">#if !defined(NDEBUG) || defined(EXPENSIVE_CHECKS)</span></div>
<div class="line"><a name="l10949"></a><span class="lineno">10949</span>&#160;  <span class="comment">// Check that all schedulable entities got scheduled</span></div>
<div class="line"><a name="l10950"></a><span class="lineno">10950</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BS-&gt;ScheduleStart; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != BS-&gt;ScheduleEnd; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNextNode()) {</div>
<div class="line"><a name="l10951"></a><span class="lineno">10951</span>&#160;    BS-&gt;doForAllOpcodes(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, [&amp;](ScheduleData *SD) {</div>
<div class="line"><a name="l10952"></a><span class="lineno">10952</span>&#160;      <span class="keywordflow">if</span> (SD-&gt;isSchedulingEntity() &amp;&amp; SD-&gt;hasValidDependencies()) {</div>
<div class="line"><a name="l10953"></a><span class="lineno">10953</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SD-&gt;IsScheduled &amp;&amp; <span class="stringliteral">&quot;must be scheduled at this point&quot;</span>);</div>
<div class="line"><a name="l10954"></a><span class="lineno">10954</span>&#160;      }</div>
<div class="line"><a name="l10955"></a><span class="lineno">10955</span>&#160;    });</div>
<div class="line"><a name="l10956"></a><span class="lineno">10956</span>&#160;  }</div>
<div class="line"><a name="l10957"></a><span class="lineno">10957</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l10958"></a><span class="lineno">10958</span>&#160; </div>
<div class="line"><a name="l10959"></a><span class="lineno">10959</span>&#160;  <span class="comment">// Avoid duplicate scheduling of the block.</span></div>
<div class="line"><a name="l10960"></a><span class="lineno">10960</span>&#160;  BS-&gt;ScheduleStart = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l10961"></a><span class="lineno">10961</span>&#160;}</div>
<div class="line"><a name="l10962"></a><span class="lineno">10962</span>&#160; </div>
<div class="line"><a name="l10963"></a><span class="lineno">10963</span>&#160;<span class="keywordtype">unsigned</span> BoUpSLP::getVectorElementSize(<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l10964"></a><span class="lineno">10964</span>&#160;  <span class="comment">// If V is a store, just return the width of the stored value (or value</span></div>
<div class="line"><a name="l10965"></a><span class="lineno">10965</span>&#160;  <span class="comment">// truncated just before storing) without traversing the expression tree.</span></div>
<div class="line"><a name="l10966"></a><span class="lineno">10966</span>&#160;  <span class="comment">// This is the common case.</span></div>
<div class="line"><a name="l10967"></a><span class="lineno">10967</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Store</a> = dyn_cast&lt;StoreInst&gt;(V))</div>
<div class="line"><a name="l10968"></a><span class="lineno">10968</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getTypeSizeInBits(<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;getValueOperand()-&gt;getType());</div>
<div class="line"><a name="l10969"></a><span class="lineno">10969</span>&#160; </div>
<div class="line"><a name="l10970"></a><span class="lineno">10970</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *IEI = dyn_cast&lt;InsertElementInst&gt;(V))</div>
<div class="line"><a name="l10971"></a><span class="lineno">10971</span>&#160;    <span class="keywordflow">return</span> getVectorElementSize(IEI-&gt;getOperand(1));</div>
<div class="line"><a name="l10972"></a><span class="lineno">10972</span>&#160; </div>
<div class="line"><a name="l10973"></a><span class="lineno">10973</span>&#160;  <span class="keyword">auto</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = InstrElementSize.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(V);</div>
<div class="line"><a name="l10974"></a><span class="lineno">10974</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> != InstrElementSize.<a class="code" href="classllvm_1_1DenseMapBase.html#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</div>
<div class="line"><a name="l10975"></a><span class="lineno">10975</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>-&gt;second;</div>
<div class="line"><a name="l10976"></a><span class="lineno">10976</span>&#160; </div>
<div class="line"><a name="l10977"></a><span class="lineno">10977</span>&#160;  <span class="comment">// If V is not a store, we can traverse the expression tree to find loads</span></div>
<div class="line"><a name="l10978"></a><span class="lineno">10978</span>&#160;  <span class="comment">// that feed it. The type of the loaded value may indicate a more suitable</span></div>
<div class="line"><a name="l10979"></a><span class="lineno">10979</span>&#160;  <span class="comment">// width than V&#39;s type. We want to base the vector element size on the width</span></div>
<div class="line"><a name="l10980"></a><span class="lineno">10980</span>&#160;  <span class="comment">// of memory operations where possible.</span></div>
<div class="line"><a name="l10981"></a><span class="lineno">10981</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;Instruction *, BasicBlock *&gt;</a>, 16&gt; Worklist;</div>
<div class="line"><a name="l10982"></a><span class="lineno">10982</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction *, 16&gt;</a> Visited;</div>
<div class="line"><a name="l10983"></a><span class="lineno">10983</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V)) {</div>
<div class="line"><a name="l10984"></a><span class="lineno">10984</span>&#160;    Worklist.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent());</div>
<div class="line"><a name="l10985"></a><span class="lineno">10985</span>&#160;    Visited.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l10986"></a><span class="lineno">10986</span>&#160;  }</div>
<div class="line"><a name="l10987"></a><span class="lineno">10987</span>&#160; </div>
<div class="line"><a name="l10988"></a><span class="lineno">10988</span>&#160;  <span class="comment">// Traverse the expression tree in bottom-up order looking for loads. If we</span></div>
<div class="line"><a name="l10989"></a><span class="lineno">10989</span>&#160;  <span class="comment">// encounter an instruction we don&#39;t yet handle, we give up.</span></div>
<div class="line"><a name="l10990"></a><span class="lineno">10990</span>&#160;  <span class="keyword">auto</span> <a class="code" href="namespacellvm_1_1AMDGPU_1_1Hwreg.html#a6467ebe1e09a75203dd5f14bdfe21d11">Width</a> = 0u;</div>
<div class="line"><a name="l10991"></a><span class="lineno">10991</span>&#160;  <span class="keywordflow">while</span> (!Worklist.empty()) {</div>
<div class="line"><a name="l10992"></a><span class="lineno">10992</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l10993"></a><span class="lineno">10993</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Parent;</div>
<div class="line"><a name="l10994"></a><span class="lineno">10994</span>&#160;    std::tie(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Parent) = Worklist.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a0c8ffe664a36e30d49c84d0aded2fe08">pop_back_val</a>();</div>
<div class="line"><a name="l10995"></a><span class="lineno">10995</span>&#160; </div>
<div class="line"><a name="l10996"></a><span class="lineno">10996</span>&#160;    <span class="comment">// We should only be looking at scalar instructions here. If the current</span></div>
<div class="line"><a name="l10997"></a><span class="lineno">10997</span>&#160;    <span class="comment">// instruction has a vector type, skip.</span></div>
<div class="line"><a name="l10998"></a><span class="lineno">10998</span>&#160;    <span class="keyword">auto</span> *Ty = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType();</div>
<div class="line"><a name="l10999"></a><span class="lineno">10999</span>&#160;    <span class="keywordflow">if</span> (isa&lt;VectorType&gt;(Ty))</div>
<div class="line"><a name="l11000"></a><span class="lineno">11000</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l11001"></a><span class="lineno">11001</span>&#160; </div>
<div class="line"><a name="l11002"></a><span class="lineno">11002</span>&#160;    <span class="comment">// If the current instruction is a load, update MaxWidth to reflect the</span></div>
<div class="line"><a name="l11003"></a><span class="lineno">11003</span>&#160;    <span class="comment">// width of the loaded value.</span></div>
<div class="line"><a name="l11004"></a><span class="lineno">11004</span>&#160;    <span class="keywordflow">if</span> (isa&lt;LoadInst, ExtractElementInst, ExtractValueInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l11005"></a><span class="lineno">11005</span>&#160;      <a class="code" href="namespacellvm_1_1AMDGPU_1_1Hwreg.html#a6467ebe1e09a75203dd5f14bdfe21d11">Width</a> = std::max&lt;unsigned&gt;(<a class="code" href="namespacellvm_1_1AMDGPU_1_1Hwreg.html#a6467ebe1e09a75203dd5f14bdfe21d11">Width</a>, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getTypeSizeInBits(Ty));</div>
<div class="line"><a name="l11006"></a><span class="lineno">11006</span>&#160; </div>
<div class="line"><a name="l11007"></a><span class="lineno">11007</span>&#160;    <span class="comment">// Otherwise, we need to visit the operands of the instruction. We only</span></div>
<div class="line"><a name="l11008"></a><span class="lineno">11008</span>&#160;    <span class="comment">// handle the interesting cases from buildTree here. If an operand is an</span></div>
<div class="line"><a name="l11009"></a><span class="lineno">11009</span>&#160;    <span class="comment">// instruction we haven&#39;t yet visited and from the same basic block as the</span></div>
<div class="line"><a name="l11010"></a><span class="lineno">11010</span>&#160;    <span class="comment">// user or the use is a PHI node, we add it to the worklist.</span></div>
<div class="line"><a name="l11011"></a><span class="lineno">11011</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a92ca992e52dddc420f4b069cae06dfbe">isa</a>&lt;<a class="code" href="classllvm_1_1PHINode.html">PHINode</a>, <a class="code" href="classllvm_1_1CastInst.html">CastInst</a>, <a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a>, <a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a>, <a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a>,</div>
<div class="line"><a name="l11012"></a><span class="lineno">11012</span>&#160;                 <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a>, <a class="code" href="classllvm_1_1UnaryOperator.html">UnaryOperator</a>&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l11013"></a><span class="lineno">11013</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U : <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands())</div>
<div class="line"><a name="l11014"></a><span class="lineno">11014</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *J = dyn_cast&lt;Instruction&gt;(U.get()))</div>
<div class="line"><a name="l11015"></a><span class="lineno">11015</span>&#160;          <span class="keywordflow">if</span> (Visited.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(J).second &amp;&amp;</div>
<div class="line"><a name="l11016"></a><span class="lineno">11016</span>&#160;              (isa&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || J-&gt;getParent() == Parent))</div>
<div class="line"><a name="l11017"></a><span class="lineno">11017</span>&#160;            Worklist.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>(J, J-&gt;getParent());</div>
<div class="line"><a name="l11018"></a><span class="lineno">11018</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l11019"></a><span class="lineno">11019</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l11020"></a><span class="lineno">11020</span>&#160;    }</div>
<div class="line"><a name="l11021"></a><span class="lineno">11021</span>&#160;  }</div>
<div class="line"><a name="l11022"></a><span class="lineno">11022</span>&#160; </div>
<div class="line"><a name="l11023"></a><span class="lineno">11023</span>&#160;  <span class="comment">// If we didn&#39;t encounter a memory access in the expression tree, or if we</span></div>
<div class="line"><a name="l11024"></a><span class="lineno">11024</span>&#160;  <span class="comment">// gave up for some reason, just return the width of V. Otherwise, return the</span></div>
<div class="line"><a name="l11025"></a><span class="lineno">11025</span>&#160;  <span class="comment">// maximum width we found.</span></div>
<div class="line"><a name="l11026"></a><span class="lineno">11026</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1AMDGPU_1_1Hwreg.html#a6467ebe1e09a75203dd5f14bdfe21d11">Width</a>) {</div>
<div class="line"><a name="l11027"></a><span class="lineno">11027</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *CI = dyn_cast&lt;CmpInst&gt;(V))</div>
<div class="line"><a name="l11028"></a><span class="lineno">11028</span>&#160;      V = CI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l11029"></a><span class="lineno">11029</span>&#160;    <a class="code" href="namespacellvm_1_1AMDGPU_1_1Hwreg.html#a6467ebe1e09a75203dd5f14bdfe21d11">Width</a> = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getTypeSizeInBits(V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l11030"></a><span class="lineno">11030</span>&#160;  }</div>
<div class="line"><a name="l11031"></a><span class="lineno">11031</span>&#160; </div>
<div class="line"><a name="l11032"></a><span class="lineno">11032</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Visited)</div>
<div class="line"><a name="l11033"></a><span class="lineno">11033</span>&#160;    InstrElementSize[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="namespacellvm_1_1AMDGPU_1_1Hwreg.html#a6467ebe1e09a75203dd5f14bdfe21d11">Width</a>;</div>
<div class="line"><a name="l11034"></a><span class="lineno">11034</span>&#160; </div>
<div class="line"><a name="l11035"></a><span class="lineno">11035</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1AMDGPU_1_1Hwreg.html#a6467ebe1e09a75203dd5f14bdfe21d11">Width</a>;</div>
<div class="line"><a name="l11036"></a><span class="lineno">11036</span>&#160;}</div>
<div class="line"><a name="l11037"></a><span class="lineno">11037</span>&#160; </div>
<div class="line"><a name="l11038"></a><span class="lineno">11038</span>&#160;<span class="comment">// Determine if a value V in a vectorizable expression Expr can be demoted to a</span></div>
<div class="line"><a name="l11039"></a><span class="lineno">11039</span>&#160;<span class="comment">// smaller type with a truncation. We collect the values that will be demoted</span></div>
<div class="line"><a name="l11040"></a><span class="lineno">11040</span>&#160;<span class="comment">// in ToDemote and additional roots that require investigating in Roots.</span></div>
<div class="line"><a name="l11041"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#ada3b8b509fcb2a84e3b9e3bd678ba27f">11041</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#ada3b8b509fcb2a84e3b9e3bd678ba27f">collectValuesToDemote</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1SmallPtrSetImpl.html">SmallPtrSetImpl&lt;Value *&gt;</a> &amp;Expr,</div>
<div class="line"><a name="l11042"></a><span class="lineno">11042</span>&#160;                                  <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Value *&gt;</a> &amp;ToDemote,</div>
<div class="line"><a name="l11043"></a><span class="lineno">11043</span>&#160;                                  <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Value *&gt;</a> &amp;Roots) {</div>
<div class="line"><a name="l11044"></a><span class="lineno">11044</span>&#160;  <span class="comment">// We can always demote constants.</span></div>
<div class="line"><a name="l11045"></a><span class="lineno">11045</span>&#160;  <span class="keywordflow">if</span> (isa&lt;Constant&gt;(V)) {</div>
<div class="line"><a name="l11046"></a><span class="lineno">11046</span>&#160;    ToDemote.push_back(V);</div>
<div class="line"><a name="l11047"></a><span class="lineno">11047</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l11048"></a><span class="lineno">11048</span>&#160;  }</div>
<div class="line"><a name="l11049"></a><span class="lineno">11049</span>&#160; </div>
<div class="line"><a name="l11050"></a><span class="lineno">11050</span>&#160;  <span class="comment">// If the value is not an instruction in the expression with only one use, it</span></div>
<div class="line"><a name="l11051"></a><span class="lineno">11051</span>&#160;  <span class="comment">// cannot be demoted.</span></div>
<div class="line"><a name="l11052"></a><span class="lineno">11052</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l11053"></a><span class="lineno">11053</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> || !<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUse() || !Expr.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l11054"></a><span class="lineno">11054</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11055"></a><span class="lineno">11055</span>&#160; </div>
<div class="line"><a name="l11056"></a><span class="lineno">11056</span>&#160;  <span class="keywordflow">switch</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) {</div>
<div class="line"><a name="l11057"></a><span class="lineno">11057</span>&#160; </div>
<div class="line"><a name="l11058"></a><span class="lineno">11058</span>&#160;  <span class="comment">// We can always demote truncations and extensions. Since truncations can</span></div>
<div class="line"><a name="l11059"></a><span class="lineno">11059</span>&#160;  <span class="comment">// seed additional demotion, we save the truncated value.</span></div>
<div class="line"><a name="l11060"></a><span class="lineno">11060</span>&#160;  <span class="keywordflow">case</span> Instruction::Trunc:</div>
<div class="line"><a name="l11061"></a><span class="lineno">11061</span>&#160;    Roots.push_back(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0));</div>
<div class="line"><a name="l11062"></a><span class="lineno">11062</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l11063"></a><span class="lineno">11063</span>&#160;  <span class="keywordflow">case</span> Instruction::ZExt:</div>
<div class="line"><a name="l11064"></a><span class="lineno">11064</span>&#160;  <span class="keywordflow">case</span> Instruction::SExt:</div>
<div class="line"><a name="l11065"></a><span class="lineno">11065</span>&#160;    <span class="keywordflow">if</span> (isa&lt;ExtractElementInst, InsertElementInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0)))</div>
<div class="line"><a name="l11066"></a><span class="lineno">11066</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11067"></a><span class="lineno">11067</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l11068"></a><span class="lineno">11068</span>&#160; </div>
<div class="line"><a name="l11069"></a><span class="lineno">11069</span>&#160;  <span class="comment">// We can demote certain binary operations if we can demote both of their</span></div>
<div class="line"><a name="l11070"></a><span class="lineno">11070</span>&#160;  <span class="comment">// operands.</span></div>
<div class="line"><a name="l11071"></a><span class="lineno">11071</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec">Instruction::Add</a>:</div>
<div class="line"><a name="l11072"></a><span class="lineno">11072</span>&#160;  <span class="keywordflow">case</span> Instruction::Sub:</div>
<div class="line"><a name="l11073"></a><span class="lineno">11073</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="X86PartialReduction_8cpp.html#ae0f503db91504a3f3440ab81260e4134">Instruction::Mul</a>:</div>
<div class="line"><a name="l11074"></a><span class="lineno">11074</span>&#160;  <span class="keywordflow">case</span> Instruction::And:</div>
<div class="line"><a name="l11075"></a><span class="lineno">11075</span>&#160;  <span class="keywordflow">case</span> Instruction::Or:</div>
<div class="line"><a name="l11076"></a><span class="lineno">11076</span>&#160;  <span class="keywordflow">case</span> Instruction::Xor:</div>
<div class="line"><a name="l11077"></a><span class="lineno">11077</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="SLPVectorizer_8cpp.html#ada3b8b509fcb2a84e3b9e3bd678ba27f">collectValuesToDemote</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), Expr, ToDemote, Roots) ||</div>
<div class="line"><a name="l11078"></a><span class="lineno">11078</span>&#160;        !<a class="code" href="SLPVectorizer_8cpp.html#ada3b8b509fcb2a84e3b9e3bd678ba27f">collectValuesToDemote</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), Expr, ToDemote, Roots))</div>
<div class="line"><a name="l11079"></a><span class="lineno">11079</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11080"></a><span class="lineno">11080</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l11081"></a><span class="lineno">11081</span>&#160; </div>
<div class="line"><a name="l11082"></a><span class="lineno">11082</span>&#160;  <span class="comment">// We can demote selects if we can demote their true and false values.</span></div>
<div class="line"><a name="l11083"></a><span class="lineno">11083</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Instruction::Select</a>: {</div>
<div class="line"><a name="l11084"></a><span class="lineno">11084</span>&#160;    <a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = cast&lt;SelectInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l11085"></a><span class="lineno">11085</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="SLPVectorizer_8cpp.html#ada3b8b509fcb2a84e3b9e3bd678ba27f">collectValuesToDemote</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getTrueValue(), Expr, ToDemote, Roots) ||</div>
<div class="line"><a name="l11086"></a><span class="lineno">11086</span>&#160;        !<a class="code" href="SLPVectorizer_8cpp.html#ada3b8b509fcb2a84e3b9e3bd678ba27f">collectValuesToDemote</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getFalseValue(), Expr, ToDemote, Roots))</div>
<div class="line"><a name="l11087"></a><span class="lineno">11087</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11088"></a><span class="lineno">11088</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l11089"></a><span class="lineno">11089</span>&#160;  }</div>
<div class="line"><a name="l11090"></a><span class="lineno">11090</span>&#160; </div>
<div class="line"><a name="l11091"></a><span class="lineno">11091</span>&#160;  <span class="comment">// We can demote phis if we can demote all their incoming operands. Note that</span></div>
<div class="line"><a name="l11092"></a><span class="lineno">11092</span>&#160;  <span class="comment">// we don&#39;t need to worry about cycles since we ensure single use above.</span></div>
<div class="line"><a name="l11093"></a><span class="lineno">11093</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">Instruction::PHI</a>: {</div>
<div class="line"><a name="l11094"></a><span class="lineno">11094</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = cast&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l11095"></a><span class="lineno">11095</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *IncValue : PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a1f0ff79b64a40d383b891f1baba89c6b">incoming_values</a>())</div>
<div class="line"><a name="l11096"></a><span class="lineno">11096</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="SLPVectorizer_8cpp.html#ada3b8b509fcb2a84e3b9e3bd678ba27f">collectValuesToDemote</a>(IncValue, Expr, ToDemote, Roots))</div>
<div class="line"><a name="l11097"></a><span class="lineno">11097</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11098"></a><span class="lineno">11098</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l11099"></a><span class="lineno">11099</span>&#160;  }</div>
<div class="line"><a name="l11100"></a><span class="lineno">11100</span>&#160; </div>
<div class="line"><a name="l11101"></a><span class="lineno">11101</span>&#160;  <span class="comment">// Otherwise, conservatively give up.</span></div>
<div class="line"><a name="l11102"></a><span class="lineno">11102</span>&#160;  <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l11103"></a><span class="lineno">11103</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11104"></a><span class="lineno">11104</span>&#160;  }</div>
<div class="line"><a name="l11105"></a><span class="lineno">11105</span>&#160; </div>
<div class="line"><a name="l11106"></a><span class="lineno">11106</span>&#160;  <span class="comment">// Record the value that we can demote.</span></div>
<div class="line"><a name="l11107"></a><span class="lineno">11107</span>&#160;  ToDemote.push_back(V);</div>
<div class="line"><a name="l11108"></a><span class="lineno">11108</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l11109"></a><span class="lineno">11109</span>&#160;}</div>
<div class="line"><a name="l11110"></a><span class="lineno">11110</span>&#160; </div>
<div class="line"><a name="l11111"></a><span class="lineno">11111</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#af7b6ae12af3578f7a20ccc11a4458f9f">BoUpSLP::computeMinimumValueSizes</a>() {</div>
<div class="line"><a name="l11112"></a><span class="lineno">11112</span>&#160;  <span class="comment">// If there are no external uses, the expression tree must be rooted by a</span></div>
<div class="line"><a name="l11113"></a><span class="lineno">11113</span>&#160;  <span class="comment">// store. We can&#39;t demote in-memory values, so there is nothing to do here.</span></div>
<div class="line"><a name="l11114"></a><span class="lineno">11114</span>&#160;  <span class="keywordflow">if</span> (ExternalUses.empty())</div>
<div class="line"><a name="l11115"></a><span class="lineno">11115</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l11116"></a><span class="lineno">11116</span>&#160; </div>
<div class="line"><a name="l11117"></a><span class="lineno">11117</span>&#160;  <span class="comment">// We only attempt to truncate integer expressions.</span></div>
<div class="line"><a name="l11118"></a><span class="lineno">11118</span>&#160;  <span class="keyword">auto</span> &amp;TreeRoot = VectorizableTree[0]-&gt;Scalars;</div>
<div class="line"><a name="l11119"></a><span class="lineno">11119</span>&#160;  <span class="keyword">auto</span> *TreeRootIT = dyn_cast&lt;IntegerType&gt;(TreeRoot[0]-&gt;<a class="code" href="M68kELFObjectWriter_8cpp.html#ae4a8bc3879d2282eefd72b16b12c2a37">getType</a>());</div>
<div class="line"><a name="l11120"></a><span class="lineno">11120</span>&#160;  <span class="keywordflow">if</span> (!TreeRootIT)</div>
<div class="line"><a name="l11121"></a><span class="lineno">11121</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l11122"></a><span class="lineno">11122</span>&#160; </div>
<div class="line"><a name="l11123"></a><span class="lineno">11123</span>&#160;  <span class="comment">// If the expression is not rooted by a store, these roots should have</span></div>
<div class="line"><a name="l11124"></a><span class="lineno">11124</span>&#160;  <span class="comment">// external uses. We will rely on InstCombine to rewrite the expression in</span></div>
<div class="line"><a name="l11125"></a><span class="lineno">11125</span>&#160;  <span class="comment">// the narrower type. However, InstCombine only rewrites single-use values.</span></div>
<div class="line"><a name="l11126"></a><span class="lineno">11126</span>&#160;  <span class="comment">// This means that if a tree entry other than a root is used externally, it</span></div>
<div class="line"><a name="l11127"></a><span class="lineno">11127</span>&#160;  <span class="comment">// must have multiple uses and InstCombine will not rewrite it. The code</span></div>
<div class="line"><a name="l11128"></a><span class="lineno">11128</span>&#160;  <span class="comment">// below ensures that only the roots are used externally.</span></div>
<div class="line"><a name="l11129"></a><span class="lineno">11129</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value *, 32&gt;</a> Expr(TreeRoot.begin(), TreeRoot.end());</div>
<div class="line"><a name="l11130"></a><span class="lineno">11130</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;EU : ExternalUses)</div>
<div class="line"><a name="l11131"></a><span class="lineno">11131</span>&#160;    <span class="keywordflow">if</span> (!Expr.erase(EU.Scalar))</div>
<div class="line"><a name="l11132"></a><span class="lineno">11132</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l11133"></a><span class="lineno">11133</span>&#160;  <span class="keywordflow">if</span> (!Expr.empty())</div>
<div class="line"><a name="l11134"></a><span class="lineno">11134</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l11135"></a><span class="lineno">11135</span>&#160; </div>
<div class="line"><a name="l11136"></a><span class="lineno">11136</span>&#160;  <span class="comment">// Collect the scalar values of the vectorizable expression. We will use this</span></div>
<div class="line"><a name="l11137"></a><span class="lineno">11137</span>&#160;  <span class="comment">// context to determine which values can be demoted. If we see a truncation,</span></div>
<div class="line"><a name="l11138"></a><span class="lineno">11138</span>&#160;  <span class="comment">// we mark it as seeding another demotion.</span></div>
<div class="line"><a name="l11139"></a><span class="lineno">11139</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;EntryPtr : VectorizableTree)</div>
<div class="line"><a name="l11140"></a><span class="lineno">11140</span>&#160;    Expr.insert(EntryPtr-&gt;Scalars.begin(), EntryPtr-&gt;Scalars.end());</div>
<div class="line"><a name="l11141"></a><span class="lineno">11141</span>&#160; </div>
<div class="line"><a name="l11142"></a><span class="lineno">11142</span>&#160;  <span class="comment">// Ensure the roots of the vectorizable tree don&#39;t form a cycle. They must</span></div>
<div class="line"><a name="l11143"></a><span class="lineno">11143</span>&#160;  <span class="comment">// have a single external user that is not in the vectorizable tree.</span></div>
<div class="line"><a name="l11144"></a><span class="lineno">11144</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Root : TreeRoot)</div>
<div class="line"><a name="l11145"></a><span class="lineno">11145</span>&#160;    <span class="keywordflow">if</span> (!Root-&gt;hasOneUse() || Expr.count(*Root-&gt;user_begin()))</div>
<div class="line"><a name="l11146"></a><span class="lineno">11146</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l11147"></a><span class="lineno">11147</span>&#160; </div>
<div class="line"><a name="l11148"></a><span class="lineno">11148</span>&#160;  <span class="comment">// Conservatively determine if we can actually truncate the roots of the</span></div>
<div class="line"><a name="l11149"></a><span class="lineno">11149</span>&#160;  <span class="comment">// expression. Collect the values that can be demoted in ToDemote and</span></div>
<div class="line"><a name="l11150"></a><span class="lineno">11150</span>&#160;  <span class="comment">// additional roots that require investigating in Roots.</span></div>
<div class="line"><a name="l11151"></a><span class="lineno">11151</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 32&gt;</a> ToDemote;</div>
<div class="line"><a name="l11152"></a><span class="lineno">11152</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 4&gt;</a> Roots;</div>
<div class="line"><a name="l11153"></a><span class="lineno">11153</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Root : TreeRoot)</div>
<div class="line"><a name="l11154"></a><span class="lineno">11154</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="SLPVectorizer_8cpp.html#ada3b8b509fcb2a84e3b9e3bd678ba27f">collectValuesToDemote</a>(Root, Expr, ToDemote, Roots))</div>
<div class="line"><a name="l11155"></a><span class="lineno">11155</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l11156"></a><span class="lineno">11156</span>&#160; </div>
<div class="line"><a name="l11157"></a><span class="lineno">11157</span>&#160;  <span class="comment">// The maximum bit width required to represent all the values that can be</span></div>
<div class="line"><a name="l11158"></a><span class="lineno">11158</span>&#160;  <span class="comment">// demoted without loss of precision. It would be safe to truncate the roots</span></div>
<div class="line"><a name="l11159"></a><span class="lineno">11159</span>&#160;  <span class="comment">// of the expression to this width.</span></div>
<div class="line"><a name="l11160"></a><span class="lineno">11160</span>&#160;  <span class="keyword">auto</span> MaxBitWidth = 8u;</div>
<div class="line"><a name="l11161"></a><span class="lineno">11161</span>&#160; </div>
<div class="line"><a name="l11162"></a><span class="lineno">11162</span>&#160;  <span class="comment">// We first check if all the bits of the roots are demanded. If they&#39;re not,</span></div>
<div class="line"><a name="l11163"></a><span class="lineno">11163</span>&#160;  <span class="comment">// we can truncate the roots to this narrower type.</span></div>
<div class="line"><a name="l11164"></a><span class="lineno">11164</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Root : TreeRoot) {</div>
<div class="line"><a name="l11165"></a><span class="lineno">11165</span>&#160;    <span class="keyword">auto</span> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a> = <a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46a8a67c950f093761829058d45fbc3f522">DB</a>-&gt;getDemandedBits(cast&lt;Instruction&gt;(Root));</div>
<div class="line"><a name="l11166"></a><span class="lineno">11166</span>&#160;    MaxBitWidth = std::max&lt;unsigned&gt;(</div>
<div class="line"><a name="l11167"></a><span class="lineno">11167</span>&#160;        <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.getBitWidth() - <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.countLeadingZeros(), MaxBitWidth);</div>
<div class="line"><a name="l11168"></a><span class="lineno">11168</span>&#160;  }</div>
<div class="line"><a name="l11169"></a><span class="lineno">11169</span>&#160; </div>
<div class="line"><a name="l11170"></a><span class="lineno">11170</span>&#160;  <span class="comment">// True if the roots can be zero-extended back to their original type, rather</span></div>
<div class="line"><a name="l11171"></a><span class="lineno">11171</span>&#160;  <span class="comment">// than sign-extended. We know that if the leading bits are not demanded, we</span></div>
<div class="line"><a name="l11172"></a><span class="lineno">11172</span>&#160;  <span class="comment">// can safely zero-extend. So we initialize IsKnownPositive to True.</span></div>
<div class="line"><a name="l11173"></a><span class="lineno">11173</span>&#160;  <span class="keywordtype">bool</span> IsKnownPositive = <span class="keyword">true</span>;</div>
<div class="line"><a name="l11174"></a><span class="lineno">11174</span>&#160; </div>
<div class="line"><a name="l11175"></a><span class="lineno">11175</span>&#160;  <span class="comment">// If all the bits of the roots are demanded, we can try a little harder to</span></div>
<div class="line"><a name="l11176"></a><span class="lineno">11176</span>&#160;  <span class="comment">// compute a narrower type. This can happen, for example, if the roots are</span></div>
<div class="line"><a name="l11177"></a><span class="lineno">11177</span>&#160;  <span class="comment">// getelementptr indices. InstCombine promotes these indices to the pointer</span></div>
<div class="line"><a name="l11178"></a><span class="lineno">11178</span>&#160;  <span class="comment">// width. Thus, all their bits are technically demanded even though the</span></div>
<div class="line"><a name="l11179"></a><span class="lineno">11179</span>&#160;  <span class="comment">// address computation might be vectorized in a smaller type.</span></div>
<div class="line"><a name="l11180"></a><span class="lineno">11180</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l11181"></a><span class="lineno">11181</span>&#160;  <span class="comment">// We start by looking at each entry that can be demoted. We compute the</span></div>
<div class="line"><a name="l11182"></a><span class="lineno">11182</span>&#160;  <span class="comment">// maximum bit width required to store the scalar by using ValueTracking to</span></div>
<div class="line"><a name="l11183"></a><span class="lineno">11183</span>&#160;  <span class="comment">// compute the number of high-order bits we can truncate.</span></div>
<div class="line"><a name="l11184"></a><span class="lineno">11184</span>&#160;  <span class="keywordflow">if</span> (MaxBitWidth == <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getTypeSizeInBits(TreeRoot[0]-&gt;getType()) &amp;&amp;</div>
<div class="line"><a name="l11185"></a><span class="lineno">11185</span>&#160;      <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all_of</a>(TreeRoot, [](<a class="code" href="classllvm_1_1Value.html">Value</a> *R) {</div>
<div class="line"><a name="l11186"></a><span class="lineno">11186</span>&#160;        assert(R-&gt;hasOneUse() &amp;&amp; <span class="stringliteral">&quot;Root should have only one use!&quot;</span>);</div>
<div class="line"><a name="l11187"></a><span class="lineno">11187</span>&#160;        return isa&lt;GetElementPtrInst&gt;(R-&gt;user_back());</div>
<div class="line"><a name="l11188"></a><span class="lineno">11188</span>&#160;      })) {</div>
<div class="line"><a name="l11189"></a><span class="lineno">11189</span>&#160;    MaxBitWidth = 8u;</div>
<div class="line"><a name="l11190"></a><span class="lineno">11190</span>&#160; </div>
<div class="line"><a name="l11191"></a><span class="lineno">11191</span>&#160;    <span class="comment">// Determine if the sign bit of all the roots is known to be zero. If not,</span></div>
<div class="line"><a name="l11192"></a><span class="lineno">11192</span>&#160;    <span class="comment">// IsKnownPositive is set to False.</span></div>
<div class="line"><a name="l11193"></a><span class="lineno">11193</span>&#160;    IsKnownPositive = <a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all_of</a>(TreeRoot, [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *R) {</div>
<div class="line"><a name="l11194"></a><span class="lineno">11194</span>&#160;      <a class="code" href="structllvm_1_1KnownBits.html">KnownBits</a> Known = <a class="code" href="namespacellvm.html#aa1f8f0633edd8b9a1c5ec15bb9fc5640">computeKnownBits</a>(R, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l11195"></a><span class="lineno">11195</span>&#160;      <span class="keywordflow">return</span> Known.<a class="code" href="structllvm_1_1KnownBits.html#a157efd68e8b4b838829cad165b1583f8">isNonNegative</a>();</div>
<div class="line"><a name="l11196"></a><span class="lineno">11196</span>&#160;    });</div>
<div class="line"><a name="l11197"></a><span class="lineno">11197</span>&#160; </div>
<div class="line"><a name="l11198"></a><span class="lineno">11198</span>&#160;    <span class="comment">// Determine the maximum number of bits required to store the scalar</span></div>
<div class="line"><a name="l11199"></a><span class="lineno">11199</span>&#160;    <span class="comment">// values.</span></div>
<div class="line"><a name="l11200"></a><span class="lineno">11200</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Scalar : ToDemote) {</div>
<div class="line"><a name="l11201"></a><span class="lineno">11201</span>&#160;      <span class="keyword">auto</span> NumSignBits = <a class="code" href="namespacellvm.html#ad46ed333b920b20e78d948610366254c">ComputeNumSignBits</a>(Scalar, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, 0, AC, <span class="keyword">nullptr</span>, DT);</div>
<div class="line"><a name="l11202"></a><span class="lineno">11202</span>&#160;      <span class="keyword">auto</span> NumTypeBits = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getTypeSizeInBits(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a>-&gt;getType());</div>
<div class="line"><a name="l11203"></a><span class="lineno">11203</span>&#160;      MaxBitWidth = std::max&lt;unsigned&gt;(NumTypeBits - NumSignBits, MaxBitWidth);</div>
<div class="line"><a name="l11204"></a><span class="lineno">11204</span>&#160;    }</div>
<div class="line"><a name="l11205"></a><span class="lineno">11205</span>&#160; </div>
<div class="line"><a name="l11206"></a><span class="lineno">11206</span>&#160;    <span class="comment">// If we can&#39;t prove that the sign bit is zero, we must add one to the</span></div>
<div class="line"><a name="l11207"></a><span class="lineno">11207</span>&#160;    <span class="comment">// maximum bit width to account for the unknown sign bit. This preserves</span></div>
<div class="line"><a name="l11208"></a><span class="lineno">11208</span>&#160;    <span class="comment">// the existing sign bit so we can safely sign-extend the root back to the</span></div>
<div class="line"><a name="l11209"></a><span class="lineno">11209</span>&#160;    <span class="comment">// original type. Otherwise, if we know the sign bit is zero, we will</span></div>
<div class="line"><a name="l11210"></a><span class="lineno">11210</span>&#160;    <span class="comment">// zero-extend the root instead.</span></div>
<div class="line"><a name="l11211"></a><span class="lineno">11211</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l11212"></a><span class="lineno">11212</span>&#160;    <span class="comment">// FIXME: This is somewhat suboptimal, as there will be cases where adding</span></div>
<div class="line"><a name="l11213"></a><span class="lineno">11213</span>&#160;    <span class="comment">//        one to the maximum bit width will yield a larger-than-necessary</span></div>
<div class="line"><a name="l11214"></a><span class="lineno">11214</span>&#160;    <span class="comment">//        type. In general, we need to add an extra bit only if we can&#39;t</span></div>
<div class="line"><a name="l11215"></a><span class="lineno">11215</span>&#160;    <span class="comment">//        prove that the upper bit of the original type is equal to the</span></div>
<div class="line"><a name="l11216"></a><span class="lineno">11216</span>&#160;    <span class="comment">//        upper bit of the proposed smaller type. If these two bits are the</span></div>
<div class="line"><a name="l11217"></a><span class="lineno">11217</span>&#160;    <span class="comment">//        same (either zero or one) we know that sign-extending from the</span></div>
<div class="line"><a name="l11218"></a><span class="lineno">11218</span>&#160;    <span class="comment">//        smaller type will result in the same value. Here, since we can&#39;t</span></div>
<div class="line"><a name="l11219"></a><span class="lineno">11219</span>&#160;    <span class="comment">//        yet prove this, we are just making the proposed smaller type</span></div>
<div class="line"><a name="l11220"></a><span class="lineno">11220</span>&#160;    <span class="comment">//        larger to ensure correctness.</span></div>
<div class="line"><a name="l11221"></a><span class="lineno">11221</span>&#160;    <span class="keywordflow">if</span> (!IsKnownPositive)</div>
<div class="line"><a name="l11222"></a><span class="lineno">11222</span>&#160;      ++MaxBitWidth;</div>
<div class="line"><a name="l11223"></a><span class="lineno">11223</span>&#160;  }</div>
<div class="line"><a name="l11224"></a><span class="lineno">11224</span>&#160; </div>
<div class="line"><a name="l11225"></a><span class="lineno">11225</span>&#160;  <span class="comment">// Round MaxBitWidth up to the next power-of-two.</span></div>
<div class="line"><a name="l11226"></a><span class="lineno">11226</span>&#160;  MaxBitWidth = <a class="code" href="namespacellvm.html#a4cc11b26432f9343b3c532f06171ad04">llvm::bit_ceil</a>(MaxBitWidth);</div>
<div class="line"><a name="l11227"></a><span class="lineno">11227</span>&#160; </div>
<div class="line"><a name="l11228"></a><span class="lineno">11228</span>&#160;  <span class="comment">// If the maximum bit width we compute is less than the with of the roots&#39;</span></div>
<div class="line"><a name="l11229"></a><span class="lineno">11229</span>&#160;  <span class="comment">// type, we can proceed with the narrowing. Otherwise, do nothing.</span></div>
<div class="line"><a name="l11230"></a><span class="lineno">11230</span>&#160;  <span class="keywordflow">if</span> (MaxBitWidth &gt;= TreeRootIT-&gt;getBitWidth())</div>
<div class="line"><a name="l11231"></a><span class="lineno">11231</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l11232"></a><span class="lineno">11232</span>&#160; </div>
<div class="line"><a name="l11233"></a><span class="lineno">11233</span>&#160;  <span class="comment">// If we can truncate the root, we must collect additional values that might</span></div>
<div class="line"><a name="l11234"></a><span class="lineno">11234</span>&#160;  <span class="comment">// be demoted as a result. That is, those seeded by truncations we will</span></div>
<div class="line"><a name="l11235"></a><span class="lineno">11235</span>&#160;  <span class="comment">// modify.</span></div>
<div class="line"><a name="l11236"></a><span class="lineno">11236</span>&#160;  <span class="keywordflow">while</span> (!Roots.empty())</div>
<div class="line"><a name="l11237"></a><span class="lineno">11237</span>&#160;    <a class="code" href="SLPVectorizer_8cpp.html#ada3b8b509fcb2a84e3b9e3bd678ba27f">collectValuesToDemote</a>(Roots.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a0c8ffe664a36e30d49c84d0aded2fe08">pop_back_val</a>(), Expr, ToDemote, Roots);</div>
<div class="line"><a name="l11238"></a><span class="lineno">11238</span>&#160; </div>
<div class="line"><a name="l11239"></a><span class="lineno">11239</span>&#160;  <span class="comment">// Finally, map the values we can demote to the maximum bit with we computed.</span></div>
<div class="line"><a name="l11240"></a><span class="lineno">11240</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Scalar : ToDemote)</div>
<div class="line"><a name="l11241"></a><span class="lineno">11241</span>&#160;    MinBWs[<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a>] = std::make_pair(MaxBitWidth, !IsKnownPositive);</div>
<div class="line"><a name="l11242"></a><span class="lineno">11242</span>&#160;}</div>
<div class="line"><a name="l11243"></a><span class="lineno">11243</span>&#160; </div>
<div class="line"><a name="l11244"></a><span class="lineno">11244</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l11245"></a><span class="lineno">11245</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l11246"></a><span class="lineno">11246</span>&#160;<span class="comment">/// The SLPVectorizer Pass.</span></div>
<div class="line"><a name="l11247"></a><span class="lineno">11247</span>&#160;<span class="comment"></span><span class="keyword">struct </span>SLPVectorizer : <span class="keyword">public</span> <a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a> {</div>
<div class="line"><a name="l11248"></a><span class="lineno">11248</span>&#160;  <a class="code" href="structllvm_1_1SLPVectorizerPass.html">SLPVectorizerPass</a> Impl;</div>
<div class="line"><a name="l11249"></a><span class="lineno">11249</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l11250"></a><span class="lineno">11250</span>&#160;<span class="comment">  /// Pass identification, replacement for typeid</span></div>
<div class="line"><a name="l11251"></a><span class="lineno">11251</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>;</div>
<div class="line"><a name="l11252"></a><span class="lineno">11252</span>&#160; </div>
<div class="line"><a name="l11253"></a><span class="lineno">11253</span>&#160;  <span class="keyword">explicit</span> SLPVectorizer() : <a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a>(<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>) {</div>
<div class="line"><a name="l11254"></a><span class="lineno">11254</span>&#160;    <a class="code" href="namespacellvm.html#ad17df6f711037aaee99496571558475c">initializeSLPVectorizerPass</a>(*<a class="code" href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</div>
<div class="line"><a name="l11255"></a><span class="lineno">11255</span>&#160;  }</div>
<div class="line"><a name="l11256"></a><span class="lineno">11256</span>&#160; </div>
<div class="line"><a name="l11257"></a><span class="lineno">11257</span>&#160;  <span class="keywordtype">bool</span> doInitialization(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M)<span class="keyword"> override </span>{ <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a name="l11258"></a><span class="lineno">11258</span>&#160; </div>
<div class="line"><a name="l11259"></a><span class="lineno">11259</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="EntryExitInstrumenter_8cpp.html#a3985f1f39349428d17f0d2b81ebc6349">runOnFunction</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)<span class="keyword"> override </span>{</div>
<div class="line"><a name="l11260"></a><span class="lineno">11260</span>&#160;    <span class="keywordflow">if</span> (skipFunction(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>))</div>
<div class="line"><a name="l11261"></a><span class="lineno">11261</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11262"></a><span class="lineno">11262</span>&#160; </div>
<div class="line"><a name="l11263"></a><span class="lineno">11263</span>&#160;    <span class="keyword">auto</span> *SE = &amp;getAnalysis&lt;ScalarEvolutionWrapperPass&gt;().getSE();</div>
<div class="line"><a name="l11264"></a><span class="lineno">11264</span>&#160;    <span class="keyword">auto</span> *<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a> = &amp;getAnalysis&lt;TargetTransformInfoWrapperPass&gt;().getTTI(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l11265"></a><span class="lineno">11265</span>&#160;    <span class="keyword">auto</span> *TLIP = getAnalysisIfAvailable&lt;TargetLibraryInfoWrapperPass&gt;();</div>
<div class="line"><a name="l11266"></a><span class="lineno">11266</span>&#160;    <span class="keyword">auto</span> *TLI = TLIP ? &amp;TLIP-&gt;getTLI(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) : <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l11267"></a><span class="lineno">11267</span>&#160;    <span class="keyword">auto</span> *AA = &amp;getAnalysis&lt;AAResultsWrapperPass&gt;().getAAResults();</div>
<div class="line"><a name="l11268"></a><span class="lineno">11268</span>&#160;    <span class="keyword">auto</span> *LI = &amp;getAnalysis&lt;LoopInfoWrapperPass&gt;().getLoopInfo();</div>
<div class="line"><a name="l11269"></a><span class="lineno">11269</span>&#160;    <span class="keyword">auto</span> *DT = &amp;getAnalysis&lt;DominatorTreeWrapperPass&gt;().getDomTree();</div>
<div class="line"><a name="l11270"></a><span class="lineno">11270</span>&#160;    <span class="keyword">auto</span> *AC = &amp;getAnalysis&lt;AssumptionCacheTracker&gt;().getAssumptionCache(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l11271"></a><span class="lineno">11271</span>&#160;    <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46a8a67c950f093761829058d45fbc3f522">DB</a> = &amp;getAnalysis&lt;DemandedBitsWrapperPass&gt;().getDemandedBits();</div>
<div class="line"><a name="l11272"></a><span class="lineno">11272</span>&#160;    <span class="keyword">auto</span> *ORE = &amp;getAnalysis&lt;OptimizationRemarkEmitterWrapperPass&gt;().getORE();</div>
<div class="line"><a name="l11273"></a><span class="lineno">11273</span>&#160; </div>
<div class="line"><a name="l11274"></a><span class="lineno">11274</span>&#160;    <span class="keywordflow">return</span> Impl.<a class="code" href="structllvm_1_1SLPVectorizerPass.html#ad2e77c37d75ccdfcb7a3bc4fa8d58c85">runImpl</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, SE, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, TLI, AA, LI, DT, AC, <a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46a8a67c950f093761829058d45fbc3f522">DB</a>, ORE);</div>
<div class="line"><a name="l11275"></a><span class="lineno">11275</span>&#160;  }</div>
<div class="line"><a name="l11276"></a><span class="lineno">11276</span>&#160; </div>
<div class="line"><a name="l11277"></a><span class="lineno">11277</span>&#160;  <span class="keywordtype">void</span> getAnalysisUsage(<a class="code" href="classllvm_1_1AnalysisUsage.html">AnalysisUsage</a> &amp;AU)<span class="keyword"> const override </span>{</div>
<div class="line"><a name="l11278"></a><span class="lineno">11278</span>&#160;    <a class="code" href="classllvm_1_1Pass.html#a6590d0486104165ca40c7df0707f7b9e">FunctionPass::getAnalysisUsage</a>(AU);</div>
<div class="line"><a name="l11279"></a><span class="lineno">11279</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1AssumptionCacheTracker.html">AssumptionCacheTracker</a>&gt;();</div>
<div class="line"><a name="l11280"></a><span class="lineno">11280</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1ScalarEvolutionWrapperPass.html">ScalarEvolutionWrapperPass</a>&gt;();</div>
<div class="line"><a name="l11281"></a><span class="lineno">11281</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1AAResultsWrapperPass.html">AAResultsWrapperPass</a>&gt;();</div>
<div class="line"><a name="l11282"></a><span class="lineno">11282</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1TargetTransformInfoWrapperPass.html">TargetTransformInfoWrapperPass</a>&gt;();</div>
<div class="line"><a name="l11283"></a><span class="lineno">11283</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1LoopInfoWrapperPass.html">LoopInfoWrapperPass</a>&gt;();</div>
<div class="line"><a name="l11284"></a><span class="lineno">11284</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1DominatorTreeWrapperPass.html">DominatorTreeWrapperPass</a>&gt;();</div>
<div class="line"><a name="l11285"></a><span class="lineno">11285</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1DemandedBitsWrapperPass.html">DemandedBitsWrapperPass</a>&gt;();</div>
<div class="line"><a name="l11286"></a><span class="lineno">11286</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1OptimizationRemarkEmitterWrapperPass.html">OptimizationRemarkEmitterWrapperPass</a>&gt;();</div>
<div class="line"><a name="l11287"></a><span class="lineno">11287</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1InjectTLIMappingsLegacy.html">InjectTLIMappingsLegacy</a>&gt;();</div>
<div class="line"><a name="l11288"></a><span class="lineno">11288</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#a884f90190bca4bd354f2d5c91c264028">addPreserved</a>&lt;<a class="code" href="classllvm_1_1LoopInfoWrapperPass.html">LoopInfoWrapperPass</a>&gt;();</div>
<div class="line"><a name="l11289"></a><span class="lineno">11289</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#a884f90190bca4bd354f2d5c91c264028">addPreserved</a>&lt;<a class="code" href="classllvm_1_1DominatorTreeWrapperPass.html">DominatorTreeWrapperPass</a>&gt;();</div>
<div class="line"><a name="l11290"></a><span class="lineno">11290</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#a884f90190bca4bd354f2d5c91c264028">addPreserved</a>&lt;<a class="code" href="classllvm_1_1AAResultsWrapperPass.html">AAResultsWrapperPass</a>&gt;();</div>
<div class="line"><a name="l11291"></a><span class="lineno">11291</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#a884f90190bca4bd354f2d5c91c264028">addPreserved</a>&lt;<a class="code" href="classllvm_1_1GlobalsAAWrapperPass.html">GlobalsAAWrapperPass</a>&gt;();</div>
<div class="line"><a name="l11292"></a><span class="lineno">11292</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#af11a6ebf7ab3c388234cb6d5378439a3">setPreservesCFG</a>();</div>
<div class="line"><a name="l11293"></a><span class="lineno">11293</span>&#160;  }</div>
<div class="line"><a name="l11294"></a><span class="lineno">11294</span>&#160;};</div>
<div class="line"><a name="l11295"></a><span class="lineno">11295</span>&#160; </div>
<div class="line"><a name="l11296"></a><span class="lineno">11296</span>&#160;} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a name="l11297"></a><span class="lineno">11297</span>&#160; </div>
<div class="line"><a name="l11298"></a><span class="lineno"><a class="line" href="structllvm_1_1SLPVectorizerPass.html#aaec443311cb572adf0e2db9db82279ef">11298</a></span>&#160;<a class="code" href="classllvm_1_1PreservedAnalyses.html">PreservedAnalyses</a> <a class="code" href="structllvm_1_1SLPVectorizerPass.html#aaec443311cb572adf0e2db9db82279ef">SLPVectorizerPass::run</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a class="code" href="classllvm_1_1AnalysisManager.html">FunctionAnalysisManager</a> &amp;AM) {</div>
<div class="line"><a name="l11299"></a><span class="lineno">11299</span>&#160;  <span class="keyword">auto</span> *SE = &amp;AM.<a class="code" href="classllvm_1_1AnalysisManager.html#ab9d3d5412c20747fd0110a046604f09a">getResult</a>&lt;<a class="code" href="classllvm_1_1ScalarEvolutionAnalysis.html">ScalarEvolutionAnalysis</a>&gt;(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l11300"></a><span class="lineno">11300</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a> = &amp;AM.<a class="code" href="classllvm_1_1AnalysisManager.html#ab9d3d5412c20747fd0110a046604f09a">getResult</a>&lt;<a class="code" href="classllvm_1_1TargetIRAnalysis.html">TargetIRAnalysis</a>&gt;(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l11301"></a><span class="lineno">11301</span>&#160;  <span class="keyword">auto</span> *TLI = AM.<a class="code" href="classllvm_1_1AnalysisManager.html#a90a202de107720c5c6af3a5bc275d8f5">getCachedResult</a>&lt;<a class="code" href="classllvm_1_1TargetLibraryAnalysis.html">TargetLibraryAnalysis</a>&gt;(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l11302"></a><span class="lineno">11302</span>&#160;  <span class="keyword">auto</span> *AA = &amp;AM.<a class="code" href="classllvm_1_1AnalysisManager.html#ab9d3d5412c20747fd0110a046604f09a">getResult</a>&lt;<a class="code" href="classllvm_1_1AAManager.html">AAManager</a>&gt;(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l11303"></a><span class="lineno">11303</span>&#160;  <span class="keyword">auto</span> *LI = &amp;AM.<a class="code" href="classllvm_1_1AnalysisManager.html#ab9d3d5412c20747fd0110a046604f09a">getResult</a>&lt;<a class="code" href="classllvm_1_1LoopAnalysis.html">LoopAnalysis</a>&gt;(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l11304"></a><span class="lineno">11304</span>&#160;  <span class="keyword">auto</span> *DT = &amp;AM.<a class="code" href="classllvm_1_1AnalysisManager.html#ab9d3d5412c20747fd0110a046604f09a">getResult</a>&lt;<a class="code" href="classllvm_1_1DominatorTreeAnalysis.html">DominatorTreeAnalysis</a>&gt;(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l11305"></a><span class="lineno">11305</span>&#160;  <span class="keyword">auto</span> *AC = &amp;AM.<a class="code" href="classllvm_1_1AnalysisManager.html#ab9d3d5412c20747fd0110a046604f09a">getResult</a>&lt;<a class="code" href="classllvm_1_1AssumptionAnalysis.html">AssumptionAnalysis</a>&gt;(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l11306"></a><span class="lineno">11306</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46a8a67c950f093761829058d45fbc3f522">DB</a> = &amp;AM.<a class="code" href="classllvm_1_1AnalysisManager.html#ab9d3d5412c20747fd0110a046604f09a">getResult</a>&lt;<a class="code" href="classllvm_1_1DemandedBitsAnalysis.html">DemandedBitsAnalysis</a>&gt;(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l11307"></a><span class="lineno">11307</span>&#160;  <span class="keyword">auto</span> *ORE = &amp;AM.<a class="code" href="classllvm_1_1AnalysisManager.html#ab9d3d5412c20747fd0110a046604f09a">getResult</a>&lt;<a class="code" href="classllvm_1_1OptimizationRemarkEmitterAnalysis.html">OptimizationRemarkEmitterAnalysis</a>&gt;(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l11308"></a><span class="lineno">11308</span>&#160; </div>
<div class="line"><a name="l11309"></a><span class="lineno">11309</span>&#160;  <span class="keywordtype">bool</span> Changed = <a class="code" href="ExpandLargeDivRem_8cpp.html#ae64f9cd0977a8b47570154312540d7d2">runImpl</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, SE, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, TLI, AA, LI, DT, AC, <a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46a8a67c950f093761829058d45fbc3f522">DB</a>, ORE);</div>
<div class="line"><a name="l11310"></a><span class="lineno">11310</span>&#160;  <span class="keywordflow">if</span> (!Changed)</div>
<div class="line"><a name="l11311"></a><span class="lineno">11311</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1PreservedAnalyses.html#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</div>
<div class="line"><a name="l11312"></a><span class="lineno">11312</span>&#160; </div>
<div class="line"><a name="l11313"></a><span class="lineno">11313</span>&#160;  <a class="code" href="classllvm_1_1PreservedAnalyses.html">PreservedAnalyses</a> PA;</div>
<div class="line"><a name="l11314"></a><span class="lineno">11314</span>&#160;  PA.<a class="code" href="classllvm_1_1PreservedAnalyses.html#a937c42f77e161349ce0f999e448c7027">preserveSet</a>&lt;<a class="code" href="classllvm_1_1CFGAnalyses.html">CFGAnalyses</a>&gt;();</div>
<div class="line"><a name="l11315"></a><span class="lineno">11315</span>&#160;  <span class="keywordflow">return</span> PA;</div>
<div class="line"><a name="l11316"></a><span class="lineno">11316</span>&#160;}</div>
<div class="line"><a name="l11317"></a><span class="lineno">11317</span>&#160; </div>
<div class="line"><a name="l11318"></a><span class="lineno"><a class="line" href="structllvm_1_1SLPVectorizerPass.html#ad2e77c37d75ccdfcb7a3bc4fa8d58c85">11318</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="structllvm_1_1SLPVectorizerPass.html#ad2e77c37d75ccdfcb7a3bc4fa8d58c85">SLPVectorizerPass::runImpl</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> *SE_,</div>
<div class="line"><a name="l11319"></a><span class="lineno">11319</span>&#160;                                <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> *TTI_,</div>
<div class="line"><a name="l11320"></a><span class="lineno">11320</span>&#160;                                <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> *TLI_, <a class="code" href="classllvm_1_1AAResults.html">AAResults</a> *AA_,</div>
<div class="line"><a name="l11321"></a><span class="lineno">11321</span>&#160;                                <a class="code" href="classllvm_1_1LoopInfo.html">LoopInfo</a> *LI_, <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> *DT_,</div>
<div class="line"><a name="l11322"></a><span class="lineno">11322</span>&#160;                                <a class="code" href="classllvm_1_1AssumptionCache.html">AssumptionCache</a> *AC_, <a class="code" href="classllvm_1_1DemandedBits.html">DemandedBits</a> *DB_,</div>
<div class="line"><a name="l11323"></a><span class="lineno">11323</span>&#160;                                <a class="code" href="classllvm_1_1OptimizationRemarkEmitter.html">OptimizationRemarkEmitter</a> *ORE_) {</div>
<div class="line"><a name="l11324"></a><span class="lineno">11324</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="SLPVectorizer_8cpp.html#ada54fa869a50e6744d9e149b542efdb1">RunSLPVectorization</a>)</div>
<div class="line"><a name="l11325"></a><span class="lineno">11325</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11326"></a><span class="lineno">11326</span>&#160;  SE = SE_;</div>
<div class="line"><a name="l11327"></a><span class="lineno">11327</span>&#160;  <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a> = TTI_;</div>
<div class="line"><a name="l11328"></a><span class="lineno">11328</span>&#160;  TLI = TLI_;</div>
<div class="line"><a name="l11329"></a><span class="lineno">11329</span>&#160;  AA = AA_;</div>
<div class="line"><a name="l11330"></a><span class="lineno">11330</span>&#160;  LI = LI_;</div>
<div class="line"><a name="l11331"></a><span class="lineno">11331</span>&#160;  DT = DT_;</div>
<div class="line"><a name="l11332"></a><span class="lineno">11332</span>&#160;  AC = AC_;</div>
<div class="line"><a name="l11333"></a><span class="lineno">11333</span>&#160;  <a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46a8a67c950f093761829058d45fbc3f522">DB</a> = DB_;</div>
<div class="line"><a name="l11334"></a><span class="lineno">11334</span>&#160;  <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a> = &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getParent()-&gt;getDataLayout();</div>
<div class="line"><a name="l11335"></a><span class="lineno">11335</span>&#160; </div>
<div class="line"><a name="l11336"></a><span class="lineno">11336</span>&#160;  Stores.clear();</div>
<div class="line"><a name="l11337"></a><span class="lineno">11337</span>&#160;  GEPs.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div>
<div class="line"><a name="l11338"></a><span class="lineno">11338</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l11339"></a><span class="lineno">11339</span>&#160; </div>
<div class="line"><a name="l11340"></a><span class="lineno">11340</span>&#160;  <span class="comment">// If the target claims to have no vector registers don&#39;t attempt</span></div>
<div class="line"><a name="l11341"></a><span class="lineno">11341</span>&#160;  <span class="comment">// vectorization.</span></div>
<div class="line"><a name="l11342"></a><span class="lineno">11342</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#aae0e8ca52658f54e5cc6214eb1a291ef">getNumberOfRegisters</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a623cced59353f83cc5eaba4068c57694">getRegisterClassForType</a>(<span class="keyword">true</span>))) {</div>
<div class="line"><a name="l11343"></a><span class="lineno">11343</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(</div>
<div class="line"><a name="l11344"></a><span class="lineno">11344</span>&#160;        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Didn&#39;t find any vector registers for target, abort.\n&quot;</span>);</div>
<div class="line"><a name="l11345"></a><span class="lineno">11345</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11346"></a><span class="lineno">11346</span>&#160;  }</div>
<div class="line"><a name="l11347"></a><span class="lineno">11347</span>&#160; </div>
<div class="line"><a name="l11348"></a><span class="lineno">11348</span>&#160;  <span class="comment">// Don&#39;t vectorize when the attribute NoImplicitFloat is used.</span></div>
<div class="line"><a name="l11349"></a><span class="lineno">11349</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasFnAttribute(Attribute::NoImplicitFloat))</div>
<div class="line"><a name="l11350"></a><span class="lineno">11350</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11351"></a><span class="lineno">11351</span>&#160; </div>
<div class="line"><a name="l11352"></a><span class="lineno">11352</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Analyzing blocks in &quot;</span> &lt;&lt; <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName() &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l11353"></a><span class="lineno">11353</span>&#160; </div>
<div class="line"><a name="l11354"></a><span class="lineno">11354</span>&#160;  <span class="comment">// Use the bottom up slp vectorizer to construct chains that start with</span></div>
<div class="line"><a name="l11355"></a><span class="lineno">11355</span>&#160;  <span class="comment">// store instructions.</span></div>
<div class="line"><a name="l11356"></a><span class="lineno">11356</span>&#160;  <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> R(&amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, SE, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, TLI, AA, LI, DT, AC, <a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46a8a67c950f093761829058d45fbc3f522">DB</a>, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, ORE_);</div>
<div class="line"><a name="l11357"></a><span class="lineno">11357</span>&#160; </div>
<div class="line"><a name="l11358"></a><span class="lineno">11358</span>&#160;  <span class="comment">// A general note: the vectorizer must use BoUpSLP::eraseInstruction() to</span></div>
<div class="line"><a name="l11359"></a><span class="lineno">11359</span>&#160;  <span class="comment">// delete instructions.</span></div>
<div class="line"><a name="l11360"></a><span class="lineno">11360</span>&#160; </div>
<div class="line"><a name="l11361"></a><span class="lineno">11361</span>&#160;  <span class="comment">// Update DFS numbers now so that we can use them for ordering.</span></div>
<div class="line"><a name="l11362"></a><span class="lineno">11362</span>&#160;  DT-&gt;updateDFSNumbers();</div>
<div class="line"><a name="l11363"></a><span class="lineno">11363</span>&#160; </div>
<div class="line"><a name="l11364"></a><span class="lineno">11364</span>&#160;  <span class="comment">// Scan the blocks in the function in post order.</span></div>
<div class="line"><a name="l11365"></a><span class="lineno">11365</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> : <a class="code" href="namespacellvm.html#aa0953557ed13c0ed48e740653e07c979">post_order</a>(&amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getEntryBlock())) {</div>
<div class="line"><a name="l11366"></a><span class="lineno">11366</span>&#160;    <span class="comment">// Start new block - clear the list of reduction roots.</span></div>
<div class="line"><a name="l11367"></a><span class="lineno">11367</span>&#160;    R.clearReductionData();</div>
<div class="line"><a name="l11368"></a><span class="lineno">11368</span>&#160;    collectSeedInstructions(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l11369"></a><span class="lineno">11369</span>&#160; </div>
<div class="line"><a name="l11370"></a><span class="lineno">11370</span>&#160;    <span class="comment">// Vectorize trees that end at stores.</span></div>
<div class="line"><a name="l11371"></a><span class="lineno">11371</span>&#160;    <span class="keywordflow">if</span> (!Stores.empty()) {</div>
<div class="line"><a name="l11372"></a><span class="lineno">11372</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Found stores for &quot;</span> &lt;&lt; Stores.size()</div>
<div class="line"><a name="l11373"></a><span class="lineno">11373</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot; underlying objects.\n&quot;</span>);</div>
<div class="line"><a name="l11374"></a><span class="lineno">11374</span>&#160;      Changed |= vectorizeStoreChains(R);</div>
<div class="line"><a name="l11375"></a><span class="lineno">11375</span>&#160;    }</div>
<div class="line"><a name="l11376"></a><span class="lineno">11376</span>&#160; </div>
<div class="line"><a name="l11377"></a><span class="lineno">11377</span>&#160;    <span class="comment">// Vectorize trees that end at reductions.</span></div>
<div class="line"><a name="l11378"></a><span class="lineno">11378</span>&#160;    Changed |= vectorizeChainsInBlock(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, R);</div>
<div class="line"><a name="l11379"></a><span class="lineno">11379</span>&#160; </div>
<div class="line"><a name="l11380"></a><span class="lineno">11380</span>&#160;    <span class="comment">// Vectorize the index computations of getelementptr instructions. This</span></div>
<div class="line"><a name="l11381"></a><span class="lineno">11381</span>&#160;    <span class="comment">// is primarily intended to catch gather-like idioms ending at</span></div>
<div class="line"><a name="l11382"></a><span class="lineno">11382</span>&#160;    <span class="comment">// non-consecutive loads.</span></div>
<div class="line"><a name="l11383"></a><span class="lineno">11383</span>&#160;    <span class="keywordflow">if</span> (!GEPs.empty()) {</div>
<div class="line"><a name="l11384"></a><span class="lineno">11384</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Found GEPs for &quot;</span> &lt;&lt; GEPs.size()</div>
<div class="line"><a name="l11385"></a><span class="lineno">11385</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot; underlying objects.\n&quot;</span>);</div>
<div class="line"><a name="l11386"></a><span class="lineno">11386</span>&#160;      Changed |= vectorizeGEPIndices(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, R);</div>
<div class="line"><a name="l11387"></a><span class="lineno">11387</span>&#160;    }</div>
<div class="line"><a name="l11388"></a><span class="lineno">11388</span>&#160;  }</div>
<div class="line"><a name="l11389"></a><span class="lineno">11389</span>&#160; </div>
<div class="line"><a name="l11390"></a><span class="lineno">11390</span>&#160;  <span class="keywordflow">if</span> (Changed) {</div>
<div class="line"><a name="l11391"></a><span class="lineno">11391</span>&#160;    R.optimizeGatherSequence();</div>
<div class="line"><a name="l11392"></a><span class="lineno">11392</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: vectorized \&quot;&quot;</span> &lt;&lt; <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName() &lt;&lt; <span class="stringliteral">&quot;\&quot;\n&quot;</span>);</div>
<div class="line"><a name="l11393"></a><span class="lineno">11393</span>&#160;  }</div>
<div class="line"><a name="l11394"></a><span class="lineno">11394</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l11395"></a><span class="lineno">11395</span>&#160;}</div>
<div class="line"><a name="l11396"></a><span class="lineno">11396</span>&#160; </div>
<div class="line"><a name="l11397"></a><span class="lineno">11397</span>&#160;<span class="keywordtype">bool</span> SLPVectorizerPass::vectorizeStoreChain(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> Chain, <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> &amp;R,</div>
<div class="line"><a name="l11398"></a><span class="lineno">11398</span>&#160;                                            <span class="keywordtype">unsigned</span> Idx, <span class="keywordtype">unsigned</span> MinVF) {</div>
<div class="line"><a name="l11399"></a><span class="lineno">11399</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Analyzing a store chain of length &quot;</span> &lt;&lt; Chain.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>()</div>
<div class="line"><a name="l11400"></a><span class="lineno">11400</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l11401"></a><span class="lineno">11401</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> Sz = R.getVectorElementSize(Chain[0]);</div>
<div class="line"><a name="l11402"></a><span class="lineno">11402</span>&#160;  <span class="keywordtype">unsigned</span> VF = Chain.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>();</div>
<div class="line"><a name="l11403"></a><span class="lineno">11403</span>&#160; </div>
<div class="line"><a name="l11404"></a><span class="lineno">11404</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2_32</a>(Sz) || !<a class="code" href="namespacellvm.html#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2_32</a>(VF) || VF &lt; 2 || VF &lt; MinVF)</div>
<div class="line"><a name="l11405"></a><span class="lineno">11405</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11406"></a><span class="lineno">11406</span>&#160; </div>
<div class="line"><a name="l11407"></a><span class="lineno">11407</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Analyzing &quot;</span> &lt;&lt; VF &lt;&lt; <span class="stringliteral">&quot; stores at offset &quot;</span> &lt;&lt; Idx</div>
<div class="line"><a name="l11408"></a><span class="lineno">11408</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l11409"></a><span class="lineno">11409</span>&#160; </div>
<div class="line"><a name="l11410"></a><span class="lineno">11410</span>&#160;  R.buildTree(Chain);</div>
<div class="line"><a name="l11411"></a><span class="lineno">11411</span>&#160;  <span class="keywordflow">if</span> (R.isTreeTinyAndNotFullyVectorizable())</div>
<div class="line"><a name="l11412"></a><span class="lineno">11412</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11413"></a><span class="lineno">11413</span>&#160;  <span class="keywordflow">if</span> (R.isLoadCombineCandidate())</div>
<div class="line"><a name="l11414"></a><span class="lineno">11414</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11415"></a><span class="lineno">11415</span>&#160;  R.reorderTopToBottom();</div>
<div class="line"><a name="l11416"></a><span class="lineno">11416</span>&#160;  R.reorderBottomToTop();</div>
<div class="line"><a name="l11417"></a><span class="lineno">11417</span>&#160;  R.buildExternalUses();</div>
<div class="line"><a name="l11418"></a><span class="lineno">11418</span>&#160; </div>
<div class="line"><a name="l11419"></a><span class="lineno">11419</span>&#160;  R.computeMinimumValueSizes();</div>
<div class="line"><a name="l11420"></a><span class="lineno">11420</span>&#160; </div>
<div class="line"><a name="l11421"></a><span class="lineno">11421</span>&#160;  <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> = R.getTreeCost();</div>
<div class="line"><a name="l11422"></a><span class="lineno">11422</span>&#160; </div>
<div class="line"><a name="l11423"></a><span class="lineno">11423</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Found cost = &quot;</span> &lt;&lt; Cost &lt;&lt; <span class="stringliteral">&quot; for VF=&quot;</span> &lt;&lt; VF &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l11424"></a><span class="lineno">11424</span>&#160;  <span class="keywordflow">if</span> (Cost &lt; -<a class="code" href="SLPVectorizer_8cpp.html#ae3295545af0d12ee89d3102df3d45b06">SLPCostThreshold</a>) {</div>
<div class="line"><a name="l11425"></a><span class="lineno">11425</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Decided to vectorize cost = &quot;</span> &lt;&lt; Cost &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l11426"></a><span class="lineno">11426</span>&#160; </div>
<div class="line"><a name="l11427"></a><span class="lineno">11427</span>&#160;    <span class="keyword">using namespace </span>ore;</div>
<div class="line"><a name="l11428"></a><span class="lineno">11428</span>&#160; </div>
<div class="line"><a name="l11429"></a><span class="lineno">11429</span>&#160;    R.getORE()-&gt;emit(<a class="code" href="classllvm_1_1OptimizationRemark.html">OptimizationRemark</a>(<a class="code" href="SLPVectorizer_8cpp.html#a274654b7f5932cae6a71a113322481be">SV_NAME</a>, <span class="stringliteral">&quot;StoresVectorized&quot;</span>,</div>
<div class="line"><a name="l11430"></a><span class="lineno">11430</span>&#160;                                        cast&lt;StoreInst&gt;(Chain[0]))</div>
<div class="line"><a name="l11431"></a><span class="lineno">11431</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot;Stores SLP vectorized with cost &quot;</span> &lt;&lt; <a class="code" href="namespacellvm_1_1ore.html#a8f5533240c6722d987a2443cba42019d">NV</a>(<span class="stringliteral">&quot;Cost&quot;</span>, Cost)</div>
<div class="line"><a name="l11432"></a><span class="lineno">11432</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot; and with tree size &quot;</span></div>
<div class="line"><a name="l11433"></a><span class="lineno">11433</span>&#160;                     &lt;&lt; <a class="code" href="namespacellvm_1_1ore.html#a8f5533240c6722d987a2443cba42019d">NV</a>(<span class="stringliteral">&quot;TreeSize&quot;</span>, R.getTreeSize()));</div>
<div class="line"><a name="l11434"></a><span class="lineno">11434</span>&#160; </div>
<div class="line"><a name="l11435"></a><span class="lineno">11435</span>&#160;    R.vectorizeTree();</div>
<div class="line"><a name="l11436"></a><span class="lineno">11436</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l11437"></a><span class="lineno">11437</span>&#160;  }</div>
<div class="line"><a name="l11438"></a><span class="lineno">11438</span>&#160; </div>
<div class="line"><a name="l11439"></a><span class="lineno">11439</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11440"></a><span class="lineno">11440</span>&#160;}</div>
<div class="line"><a name="l11441"></a><span class="lineno">11441</span>&#160; </div>
<div class="line"><a name="l11442"></a><span class="lineno">11442</span>&#160;<span class="keywordtype">bool</span> SLPVectorizerPass::vectorizeStores(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;StoreInst *&gt;</a> Stores,</div>
<div class="line"><a name="l11443"></a><span class="lineno">11443</span>&#160;                                        <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> &amp;R) {</div>
<div class="line"><a name="l11444"></a><span class="lineno">11444</span>&#160;  <span class="comment">// We may run into multiple chains that merge into a single chain. We mark the</span></div>
<div class="line"><a name="l11445"></a><span class="lineno">11445</span>&#160;  <span class="comment">// stores that we vectorized so that we don&#39;t visit the same store twice.</span></div>
<div class="line"><a name="l11446"></a><span class="lineno">11446</span>&#160;  BoUpSLP::ValueSet VectorizedStores;</div>
<div class="line"><a name="l11447"></a><span class="lineno">11447</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l11448"></a><span class="lineno">11448</span>&#160; </div>
<div class="line"><a name="l11449"></a><span class="lineno">11449</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = Stores.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>();</div>
<div class="line"><a name="l11450"></a><span class="lineno">11450</span>&#160;  <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> Tails(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l11451"></a><span class="lineno">11451</span>&#160;  <span class="keywordtype">int</span> MaxIter = <a class="code" href="SLPVectorizer_8cpp.html#a417e088fc2533a49543b5e26feb58d32">MaxStoreLookup</a>.getValue();</div>
<div class="line"><a name="l11452"></a><span class="lineno">11452</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;int, int&gt;</a>, 16&gt; ConsecutiveChain(</div>
<div class="line"><a name="l11453"></a><span class="lineno">11453</span>&#160;      <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, std::make_pair(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, INT_MAX));</div>
<div class="line"><a name="l11454"></a><span class="lineno">11454</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;SmallBitVector, 4&gt;</a> CheckedPairs(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, <span class="keyword">false</span>));</div>
<div class="line"><a name="l11455"></a><span class="lineno">11455</span>&#160;  <span class="keywordtype">int</span> IterCnt;</div>
<div class="line"><a name="l11456"></a><span class="lineno">11456</span>&#160;  <span class="keyword">auto</span> &amp;&amp;FindConsecutiveAccess = [<span class="keyword">this</span>, &amp;Stores, &amp;Tails, &amp;IterCnt, MaxIter,</div>
<div class="line"><a name="l11457"></a><span class="lineno">11457</span>&#160;                                  &amp;CheckedPairs,</div>
<div class="line"><a name="l11458"></a><span class="lineno">11458</span>&#160;                                  &amp;ConsecutiveChain](<span class="keywordtype">int</span> K, <span class="keywordtype">int</span> Idx) {</div>
<div class="line"><a name="l11459"></a><span class="lineno">11459</span>&#160;    <span class="keywordflow">if</span> (IterCnt &gt;= MaxIter)</div>
<div class="line"><a name="l11460"></a><span class="lineno">11460</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l11461"></a><span class="lineno">11461</span>&#160;    <span class="keywordflow">if</span> (CheckedPairs[Idx].<a class="code" href="ModuloSchedule_8cpp.html#a106e32122c569cdb42ddf61ecbb0aad1">test</a>(K))</div>
<div class="line"><a name="l11462"></a><span class="lineno">11462</span>&#160;      <span class="keywordflow">return</span> ConsecutiveChain[K].second == 1 &amp;&amp;</div>
<div class="line"><a name="l11463"></a><span class="lineno">11463</span>&#160;             ConsecutiveChain[K].first == Idx;</div>
<div class="line"><a name="l11464"></a><span class="lineno">11464</span>&#160;    ++IterCnt;</div>
<div class="line"><a name="l11465"></a><span class="lineno">11465</span>&#160;    CheckedPairs[Idx].set(K);</div>
<div class="line"><a name="l11466"></a><span class="lineno">11466</span>&#160;    CheckedPairs[K].set(Idx);</div>
<div class="line"><a name="l11467"></a><span class="lineno">11467</span>&#160;    std::optional&lt;int&gt; Diff = <a class="code" href="namespacellvm.html#a034d66b8c0aeb72ea13fd26392083446">getPointersDiff</a>(</div>
<div class="line"><a name="l11468"></a><span class="lineno">11468</span>&#160;        Stores[K]-&gt;getValueOperand()-&gt;<a class="code" href="M68kELFObjectWriter_8cpp.html#ae4a8bc3879d2282eefd72b16b12c2a37">getType</a>(), Stores[K]-&gt;<a class="code" href="namespacellvm.html#ac2db21413768e904d56a02c26184823d">getPointerOperand</a>(),</div>
<div class="line"><a name="l11469"></a><span class="lineno">11469</span>&#160;        Stores[Idx]-&gt;getValueOperand()-&gt;<a class="code" href="M68kELFObjectWriter_8cpp.html#ae4a8bc3879d2282eefd72b16b12c2a37">getType</a>(),</div>
<div class="line"><a name="l11470"></a><span class="lineno">11470</span>&#160;        Stores[Idx]-&gt;<a class="code" href="namespacellvm.html#ac2db21413768e904d56a02c26184823d">getPointerOperand</a>(), *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, *SE, <span class="comment">/*StrictCheck=*/</span><span class="keyword">true</span>);</div>
<div class="line"><a name="l11471"></a><span class="lineno">11471</span>&#160;    <span class="keywordflow">if</span> (!Diff || *Diff == 0)</div>
<div class="line"><a name="l11472"></a><span class="lineno">11472</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11473"></a><span class="lineno">11473</span>&#160;    <span class="keywordtype">int</span> Val = *Diff;</div>
<div class="line"><a name="l11474"></a><span class="lineno">11474</span>&#160;    <span class="keywordflow">if</span> (Val &lt; 0) {</div>
<div class="line"><a name="l11475"></a><span class="lineno">11475</span>&#160;      <span class="keywordflow">if</span> (ConsecutiveChain[Idx].second &gt; -Val) {</div>
<div class="line"><a name="l11476"></a><span class="lineno">11476</span>&#160;        Tails.set(K);</div>
<div class="line"><a name="l11477"></a><span class="lineno">11477</span>&#160;        ConsecutiveChain[Idx] = std::make_pair(K, -Val);</div>
<div class="line"><a name="l11478"></a><span class="lineno">11478</span>&#160;      }</div>
<div class="line"><a name="l11479"></a><span class="lineno">11479</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11480"></a><span class="lineno">11480</span>&#160;    }</div>
<div class="line"><a name="l11481"></a><span class="lineno">11481</span>&#160;    <span class="keywordflow">if</span> (ConsecutiveChain[K].second &lt;= Val)</div>
<div class="line"><a name="l11482"></a><span class="lineno">11482</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11483"></a><span class="lineno">11483</span>&#160; </div>
<div class="line"><a name="l11484"></a><span class="lineno">11484</span>&#160;    Tails.set(Idx);</div>
<div class="line"><a name="l11485"></a><span class="lineno">11485</span>&#160;    ConsecutiveChain[K] = std::make_pair(Idx, Val);</div>
<div class="line"><a name="l11486"></a><span class="lineno">11486</span>&#160;    <span class="keywordflow">return</span> Val == 1;</div>
<div class="line"><a name="l11487"></a><span class="lineno">11487</span>&#160;  };</div>
<div class="line"><a name="l11488"></a><span class="lineno">11488</span>&#160;  <span class="comment">// Do a quadratic search on all of the given stores in reverse order and find</span></div>
<div class="line"><a name="l11489"></a><span class="lineno">11489</span>&#160;  <span class="comment">// all of the pairs of stores that follow each other.</span></div>
<div class="line"><a name="l11490"></a><span class="lineno">11490</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> Idx = <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> - 1; Idx &gt;= 0; --Idx) {</div>
<div class="line"><a name="l11491"></a><span class="lineno">11491</span>&#160;    <span class="comment">// If a store has multiple consecutive store candidates, search according</span></div>
<div class="line"><a name="l11492"></a><span class="lineno">11492</span>&#160;    <span class="comment">// to the sequence: Idx-1, Idx+1, Idx-2, Idx+2, ...</span></div>
<div class="line"><a name="l11493"></a><span class="lineno">11493</span>&#160;    <span class="comment">// This is because usually pairing with immediate succeeding or preceding</span></div>
<div class="line"><a name="l11494"></a><span class="lineno">11494</span>&#160;    <span class="comment">// candidate create the best chance to find slp vectorization opportunity.</span></div>
<div class="line"><a name="l11495"></a><span class="lineno">11495</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> MaxLookDepth = <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> - Idx, Idx + 1);</div>
<div class="line"><a name="l11496"></a><span class="lineno">11496</span>&#160;    IterCnt = 0;</div>
<div class="line"><a name="l11497"></a><span class="lineno">11497</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> Offset = 1, <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = MaxLookDepth; <a class="code" href="namespacellvm_1_1AMDGPU_1_1Hwreg.html#a6110fc30bc7311a6cf99814530362e21">Offset</a> &lt; <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>; ++<a class="code" href="namespacellvm_1_1AMDGPU_1_1Hwreg.html#a6110fc30bc7311a6cf99814530362e21">Offset</a>)</div>
<div class="line"><a name="l11498"></a><span class="lineno">11498</span>&#160;      <span class="keywordflow">if</span> ((Idx &gt;= Offset &amp;&amp; FindConsecutiveAccess(Idx - Offset, Idx)) ||</div>
<div class="line"><a name="l11499"></a><span class="lineno">11499</span>&#160;          (Idx + Offset &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> &amp;&amp; FindConsecutiveAccess(Idx + Offset, Idx)))</div>
<div class="line"><a name="l11500"></a><span class="lineno">11500</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l11501"></a><span class="lineno">11501</span>&#160;  }</div>
<div class="line"><a name="l11502"></a><span class="lineno">11502</span>&#160; </div>
<div class="line"><a name="l11503"></a><span class="lineno">11503</span>&#160;  <span class="comment">// Tracks if we tried to vectorize stores starting from the given tail</span></div>
<div class="line"><a name="l11504"></a><span class="lineno">11504</span>&#160;  <span class="comment">// already.</span></div>
<div class="line"><a name="l11505"></a><span class="lineno">11505</span>&#160;  <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> TriedTails(<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l11506"></a><span class="lineno">11506</span>&#160;  <span class="comment">// For stores that start but don&#39;t end a link in the chain:</span></div>
<div class="line"><a name="l11507"></a><span class="lineno">11507</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> Cnt = <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; Cnt &gt; 0; --Cnt) {</div>
<div class="line"><a name="l11508"></a><span class="lineno">11508</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Cnt - 1;</div>
<div class="line"><a name="l11509"></a><span class="lineno">11509</span>&#160;    <span class="keywordflow">if</span> (ConsecutiveChain[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].first == <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> || Tails.test(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l11510"></a><span class="lineno">11510</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l11511"></a><span class="lineno">11511</span>&#160;    <span class="comment">// We found a store instr that starts a chain. Now follow the chain and try</span></div>
<div class="line"><a name="l11512"></a><span class="lineno">11512</span>&#160;    <span class="comment">// to vectorize it.</span></div>
<div class="line"><a name="l11513"></a><span class="lineno">11513</span>&#160;    BoUpSLP::ValueList <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>;</div>
<div class="line"><a name="l11514"></a><span class="lineno">11514</span>&#160;    <span class="comment">// Collect the chain into a list.</span></div>
<div class="line"><a name="l11515"></a><span class="lineno">11515</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> &amp;&amp; !VectorizedStores.count(Stores[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>])) {</div>
<div class="line"><a name="l11516"></a><span class="lineno">11516</span>&#160;      <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.push_back(Stores[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]);</div>
<div class="line"><a name="l11517"></a><span class="lineno">11517</span>&#160;      Tails.set(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l11518"></a><span class="lineno">11518</span>&#160;      <span class="keywordflow">if</span> (ConsecutiveChain[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].second != 1) {</div>
<div class="line"><a name="l11519"></a><span class="lineno">11519</span>&#160;        <span class="comment">// Mark the new end in the chain and go back, if required. It might be</span></div>
<div class="line"><a name="l11520"></a><span class="lineno">11520</span>&#160;        <span class="comment">// required if the original stores come in reversed order, for example.</span></div>
<div class="line"><a name="l11521"></a><span class="lineno">11521</span>&#160;        <span class="keywordflow">if</span> (ConsecutiveChain[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].first != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> &amp;&amp;</div>
<div class="line"><a name="l11522"></a><span class="lineno">11522</span>&#160;            Tails.test(ConsecutiveChain[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].first) &amp;&amp; !TriedTails.test(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</div>
<div class="line"><a name="l11523"></a><span class="lineno">11523</span>&#160;            !VectorizedStores.count(Stores[ConsecutiveChain[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].first])) {</div>
<div class="line"><a name="l11524"></a><span class="lineno">11524</span>&#160;          TriedTails.set(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l11525"></a><span class="lineno">11525</span>&#160;          Tails.reset(ConsecutiveChain[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].first);</div>
<div class="line"><a name="l11526"></a><span class="lineno">11526</span>&#160;          <span class="keywordflow">if</span> (Cnt &lt; ConsecutiveChain[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].first + 2)</div>
<div class="line"><a name="l11527"></a><span class="lineno">11527</span>&#160;            Cnt = ConsecutiveChain[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].first + 2;</div>
<div class="line"><a name="l11528"></a><span class="lineno">11528</span>&#160;        }</div>
<div class="line"><a name="l11529"></a><span class="lineno">11529</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l11530"></a><span class="lineno">11530</span>&#160;      }</div>
<div class="line"><a name="l11531"></a><span class="lineno">11531</span>&#160;      <span class="comment">// Move to the next value in the chain.</span></div>
<div class="line"><a name="l11532"></a><span class="lineno">11532</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = ConsecutiveChain[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].first;</div>
<div class="line"><a name="l11533"></a><span class="lineno">11533</span>&#160;    }</div>
<div class="line"><a name="l11534"></a><span class="lineno">11534</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.empty() &amp;&amp; <span class="stringliteral">&quot;Expected non-empty list of stores.&quot;</span>);</div>
<div class="line"><a name="l11535"></a><span class="lineno">11535</span>&#160; </div>
<div class="line"><a name="l11536"></a><span class="lineno">11536</span>&#160;    <span class="keywordtype">unsigned</span> MaxVecRegSize = <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.getMaxVecRegSize();</div>
<div class="line"><a name="l11537"></a><span class="lineno">11537</span>&#160;    <span class="keywordtype">unsigned</span> EltSize = <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.getVectorElementSize(<a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>[0]);</div>
<div class="line"><a name="l11538"></a><span class="lineno">11538</span>&#160;    <span class="keywordtype">unsigned</span> MaxElts = <a class="code" href="namespacellvm.html#ae22967d11b695d268992470debfae4b2">llvm::bit_floor</a>(MaxVecRegSize / EltSize);</div>
<div class="line"><a name="l11539"></a><span class="lineno">11539</span>&#160; </div>
<div class="line"><a name="l11540"></a><span class="lineno">11540</span>&#160;    <span class="keywordtype">unsigned</span> MaxVF = <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.getMaximumVF(EltSize, <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Instruction::Store</a>),</div>
<div class="line"><a name="l11541"></a><span class="lineno">11541</span>&#160;                              MaxElts);</div>
<div class="line"><a name="l11542"></a><span class="lineno">11542</span>&#160;    <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Store</a> = cast&lt;StoreInst&gt;(<a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>[0]);</div>
<div class="line"><a name="l11543"></a><span class="lineno">11543</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *StoreTy = <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;getValueOperand()-&gt;getType();</div>
<div class="line"><a name="l11544"></a><span class="lineno">11544</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *ValueTy = StoreTy;</div>
<div class="line"><a name="l11545"></a><span class="lineno">11545</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Trunc = dyn_cast&lt;TruncInst&gt;(<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;getValueOperand()))</div>
<div class="line"><a name="l11546"></a><span class="lineno">11546</span>&#160;      ValueTy = Trunc-&gt;getSrcTy();</div>
<div class="line"><a name="l11547"></a><span class="lineno">11547</span>&#160;    <span class="keywordtype">unsigned</span> MinVF = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#abdf352ba0545cdb2ad70f4d72b594cfa">getStoreMinimumVF</a>(</div>
<div class="line"><a name="l11548"></a><span class="lineno">11548</span>&#160;        <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.getMinVF(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getTypeSizeInBits(ValueTy)), StoreTy, ValueTy);</div>
<div class="line"><a name="l11549"></a><span class="lineno">11549</span>&#160; </div>
<div class="line"><a name="l11550"></a><span class="lineno">11550</span>&#160;    <span class="keywordflow">if</span> (MaxVF &lt;= MinVF) {</div>
<div class="line"><a name="l11551"></a><span class="lineno">11551</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Vectorization infeasible as MaxVF (&quot;</span> &lt;&lt; MaxVF &lt;&lt; <span class="stringliteral">&quot;) &lt;= &quot;</span></div>
<div class="line"><a name="l11552"></a><span class="lineno">11552</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;MinVF (&quot;</span> &lt;&lt; MinVF &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>);</div>
<div class="line"><a name="l11553"></a><span class="lineno">11553</span>&#160;    }</div>
<div class="line"><a name="l11554"></a><span class="lineno">11554</span>&#160; </div>
<div class="line"><a name="l11555"></a><span class="lineno">11555</span>&#160;    <span class="comment">// FIXME: Is division-by-2 the correct step? Should we assert that the</span></div>
<div class="line"><a name="l11556"></a><span class="lineno">11556</span>&#160;    <span class="comment">// register size is a power-of-2?</span></div>
<div class="line"><a name="l11557"></a><span class="lineno">11557</span>&#160;    <span class="keywordtype">unsigned</span> StartIdx = 0;</div>
<div class="line"><a name="l11558"></a><span class="lineno">11558</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Size = MaxVF; <a class="code" href="namespacellvm_1_1Check.html#a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396">Size</a> &gt;= MinVF; <a class="code" href="namespacellvm_1_1Check.html#a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396">Size</a> /= 2) {</div>
<div class="line"><a name="l11559"></a><span class="lineno">11559</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Cnt = StartIdx, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.size(); Cnt + Size &lt;= <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>;) {</div>
<div class="line"><a name="l11560"></a><span class="lineno">11560</span>&#160;        <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> Slice = <a class="code" href="namespacellvm.html#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(<a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>).slice(Cnt, Size);</div>
<div class="line"><a name="l11561"></a><span class="lineno">11561</span>&#160;        <span class="keywordflow">if</span> (!VectorizedStores.count(Slice.<a class="code" href="classllvm_1_1ArrayRef.html#a6bc2b53fce3b1d8975eea027d8a8eb90">front</a>()) &amp;&amp;</div>
<div class="line"><a name="l11562"></a><span class="lineno">11562</span>&#160;            !VectorizedStores.count(Slice.<a class="code" href="classllvm_1_1ArrayRef.html#adb38eaaa53c1d9c57b6fe11cf84bd7a4">back</a>()) &amp;&amp;</div>
<div class="line"><a name="l11563"></a><span class="lineno">11563</span>&#160;            vectorizeStoreChain(Slice, R, Cnt, MinVF)) {</div>
<div class="line"><a name="l11564"></a><span class="lineno">11564</span>&#160;          <span class="comment">// Mark the vectorized stores so that we don&#39;t vectorize them again.</span></div>
<div class="line"><a name="l11565"></a><span class="lineno">11565</span>&#160;          VectorizedStores.insert(Slice.<a class="code" href="classllvm_1_1ArrayRef.html#aab36927882fbfdcbb860d87fd9c30da8">begin</a>(), Slice.<a class="code" href="classllvm_1_1ArrayRef.html#a7ca5197533a9c1fb8a2bd30587fcec6b">end</a>());</div>
<div class="line"><a name="l11566"></a><span class="lineno">11566</span>&#160;          Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l11567"></a><span class="lineno">11567</span>&#160;          <span class="comment">// If we vectorized initial block, no need to try to vectorize it</span></div>
<div class="line"><a name="l11568"></a><span class="lineno">11568</span>&#160;          <span class="comment">// again.</span></div>
<div class="line"><a name="l11569"></a><span class="lineno">11569</span>&#160;          <span class="keywordflow">if</span> (Cnt == StartIdx)</div>
<div class="line"><a name="l11570"></a><span class="lineno">11570</span>&#160;            StartIdx += <a class="code" href="namespacellvm_1_1Check.html#a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396">Size</a>;</div>
<div class="line"><a name="l11571"></a><span class="lineno">11571</span>&#160;          Cnt += <a class="code" href="namespacellvm_1_1Check.html#a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396">Size</a>;</div>
<div class="line"><a name="l11572"></a><span class="lineno">11572</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l11573"></a><span class="lineno">11573</span>&#160;        }</div>
<div class="line"><a name="l11574"></a><span class="lineno">11574</span>&#160;        ++Cnt;</div>
<div class="line"><a name="l11575"></a><span class="lineno">11575</span>&#160;      }</div>
<div class="line"><a name="l11576"></a><span class="lineno">11576</span>&#160;      <span class="comment">// Check if the whole array was vectorized already - exit.</span></div>
<div class="line"><a name="l11577"></a><span class="lineno">11577</span>&#160;      <span class="keywordflow">if</span> (StartIdx &gt;= <a class="code" href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.size())</div>
<div class="line"><a name="l11578"></a><span class="lineno">11578</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l11579"></a><span class="lineno">11579</span>&#160;    }</div>
<div class="line"><a name="l11580"></a><span class="lineno">11580</span>&#160;  }</div>
<div class="line"><a name="l11581"></a><span class="lineno">11581</span>&#160; </div>
<div class="line"><a name="l11582"></a><span class="lineno">11582</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l11583"></a><span class="lineno">11583</span>&#160;}</div>
<div class="line"><a name="l11584"></a><span class="lineno">11584</span>&#160; </div>
<div class="line"><a name="l11585"></a><span class="lineno">11585</span>&#160;<span class="keywordtype">void</span> SLPVectorizerPass::collectSeedInstructions(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l11586"></a><span class="lineno">11586</span>&#160;  <span class="comment">// Initialize the collections. We will make a single pass over the block.</span></div>
<div class="line"><a name="l11587"></a><span class="lineno">11587</span>&#160;  Stores.clear();</div>
<div class="line"><a name="l11588"></a><span class="lineno">11588</span>&#160;  GEPs.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div>
<div class="line"><a name="l11589"></a><span class="lineno">11589</span>&#160; </div>
<div class="line"><a name="l11590"></a><span class="lineno">11590</span>&#160;  <span class="comment">// Visit the store and getelementptr instructions in BB and organize them in</span></div>
<div class="line"><a name="l11591"></a><span class="lineno">11591</span>&#160;  <span class="comment">// Stores and GEPs according to the underlying objects of their pointer</span></div>
<div class="line"><a name="l11592"></a><span class="lineno">11592</span>&#160;  <span class="comment">// operands.</span></div>
<div class="line"><a name="l11593"></a><span class="lineno">11593</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l11594"></a><span class="lineno">11594</span>&#160;    <span class="comment">// Ignore store instructions that are volatile or have a pointer operand</span></div>
<div class="line"><a name="l11595"></a><span class="lineno">11595</span>&#160;    <span class="comment">// that doesn&#39;t point to a scalar type.</span></div>
<div class="line"><a name="l11596"></a><span class="lineno">11596</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;StoreInst&gt;(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l11597"></a><span class="lineno">11597</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;isSimple())</div>
<div class="line"><a name="l11598"></a><span class="lineno">11598</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l11599"></a><span class="lineno">11599</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="SLPVectorizer_8cpp.html#aa3ea54a95743867473d32853d3c65603">isValidElementType</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getValueOperand()-&gt;getType()))</div>
<div class="line"><a name="l11600"></a><span class="lineno">11600</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l11601"></a><span class="lineno">11601</span>&#160;      Stores[<a class="code" href="namespacellvm.html#a3b1c5788b85ffa254be0e834edf5cf8f">getUnderlyingObject</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getPointerOperand())].push_back(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l11602"></a><span class="lineno">11602</span>&#160;    }</div>
<div class="line"><a name="l11603"></a><span class="lineno">11603</span>&#160; </div>
<div class="line"><a name="l11604"></a><span class="lineno">11604</span>&#160;    <span class="comment">// Ignore getelementptr instructions that have more than one index, a</span></div>
<div class="line"><a name="l11605"></a><span class="lineno">11605</span>&#160;    <span class="comment">// constant index, or a pointer operand that doesn&#39;t point to a scalar</span></div>
<div class="line"><a name="l11606"></a><span class="lineno">11606</span>&#160;    <span class="comment">// type.</span></div>
<div class="line"><a name="l11607"></a><span class="lineno">11607</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = dyn_cast&lt;GetElementPtrInst&gt;(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l11608"></a><span class="lineno">11608</span>&#160;      <span class="keyword">auto</span> Idx = <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;idx_begin()-&gt;get();</div>
<div class="line"><a name="l11609"></a><span class="lineno">11609</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getNumIndices() &gt; 1 || isa&lt;Constant&gt;(Idx))</div>
<div class="line"><a name="l11610"></a><span class="lineno">11610</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l11611"></a><span class="lineno">11611</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="SLPVectorizer_8cpp.html#aa3ea54a95743867473d32853d3c65603">isValidElementType</a>(Idx-&gt;getType()))</div>
<div class="line"><a name="l11612"></a><span class="lineno">11612</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l11613"></a><span class="lineno">11613</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getType()-&gt;isVectorTy())</div>
<div class="line"><a name="l11614"></a><span class="lineno">11614</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l11615"></a><span class="lineno">11615</span>&#160;      GEPs[<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getPointerOperand()].push_back(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>);</div>
<div class="line"><a name="l11616"></a><span class="lineno">11616</span>&#160;    }</div>
<div class="line"><a name="l11617"></a><span class="lineno">11617</span>&#160;  }</div>
<div class="line"><a name="l11618"></a><span class="lineno">11618</span>&#160;}</div>
<div class="line"><a name="l11619"></a><span class="lineno">11619</span>&#160; </div>
<div class="line"><a name="l11620"></a><span class="lineno">11620</span>&#160;<span class="keywordtype">bool</span> SLPVectorizerPass::tryToVectorizePair(<a class="code" href="classllvm_1_1Value.html">Value</a> *A, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>, <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> &amp;R) {</div>
<div class="line"><a name="l11621"></a><span class="lineno">11621</span>&#160;  <span class="keywordflow">if</span> (!A || !<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>)</div>
<div class="line"><a name="l11622"></a><span class="lineno">11622</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11623"></a><span class="lineno">11623</span>&#160;  <span class="keywordflow">if</span> (isa&lt;InsertElementInst&gt;(A) || isa&lt;InsertElementInst&gt;(<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>))</div>
<div class="line"><a name="l11624"></a><span class="lineno">11624</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11625"></a><span class="lineno">11625</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *VL[] = {<a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>, <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>};</div>
<div class="line"><a name="l11626"></a><span class="lineno">11626</span>&#160;  <span class="keywordflow">return</span> tryToVectorizeList(VL, R);</div>
<div class="line"><a name="l11627"></a><span class="lineno">11627</span>&#160;}</div>
<div class="line"><a name="l11628"></a><span class="lineno">11628</span>&#160; </div>
<div class="line"><a name="l11629"></a><span class="lineno">11629</span>&#160;<span class="keywordtype">bool</span> SLPVectorizerPass::tryToVectorizeList(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL, <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> &amp;R,</div>
<div class="line"><a name="l11630"></a><span class="lineno">11630</span>&#160;                                           <span class="keywordtype">bool</span> LimitForRegisterSize) {</div>
<div class="line"><a name="l11631"></a><span class="lineno">11631</span>&#160;  <span class="keywordflow">if</span> (VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() &lt; 2)</div>
<div class="line"><a name="l11632"></a><span class="lineno">11632</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11633"></a><span class="lineno">11633</span>&#160; </div>
<div class="line"><a name="l11634"></a><span class="lineno">11634</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Trying to vectorize a list of length = &quot;</span></div>
<div class="line"><a name="l11635"></a><span class="lineno">11635</span>&#160;                    &lt;&lt; VL.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l11636"></a><span class="lineno">11636</span>&#160; </div>
<div class="line"><a name="l11637"></a><span class="lineno">11637</span>&#160;  <span class="comment">// Check that all of the parts are instructions of the same type,</span></div>
<div class="line"><a name="l11638"></a><span class="lineno">11638</span>&#160;  <span class="comment">// we permit an alternate opcode via InstructionsState.</span></div>
<div class="line"><a name="l11639"></a><span class="lineno">11639</span>&#160;  InstructionsState <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = <a class="code" href="SLPVectorizer_8cpp.html#ae37b3a41d982a793664ab021d9b9b325">getSameOpcode</a>(VL, *TLI);</div>
<div class="line"><a name="l11640"></a><span class="lineno">11640</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.getOpcode())</div>
<div class="line"><a name="l11641"></a><span class="lineno">11641</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11642"></a><span class="lineno">11642</span>&#160; </div>
<div class="line"><a name="l11643"></a><span class="lineno">11643</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I0 = cast&lt;Instruction&gt;(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.OpValue);</div>
<div class="line"><a name="l11644"></a><span class="lineno">11644</span>&#160;  <span class="comment">// Make sure invalid types (including vector type) are rejected before</span></div>
<div class="line"><a name="l11645"></a><span class="lineno">11645</span>&#160;  <span class="comment">// determining vectorization factor for scalar instructions.</span></div>
<div class="line"><a name="l11646"></a><span class="lineno">11646</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l11647"></a><span class="lineno">11647</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty = V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l11648"></a><span class="lineno">11648</span>&#160;    <span class="keywordflow">if</span> (!isa&lt;InsertElementInst&gt;(V) &amp;&amp; !<a class="code" href="SLPVectorizer_8cpp.html#aa3ea54a95743867473d32853d3c65603">isValidElementType</a>(Ty)) {</div>
<div class="line"><a name="l11649"></a><span class="lineno">11649</span>&#160;      <span class="comment">// NOTE: the following will give user internal llvm type name, which may</span></div>
<div class="line"><a name="l11650"></a><span class="lineno">11650</span>&#160;      <span class="comment">// not be useful.</span></div>
<div class="line"><a name="l11651"></a><span class="lineno">11651</span>&#160;      <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.getORE()-&gt;emit([&amp;]() {</div>
<div class="line"><a name="l11652"></a><span class="lineno">11652</span>&#160;        std::string type_str;</div>
<div class="line"><a name="l11653"></a><span class="lineno">11653</span>&#160;        <a class="code" href="classllvm_1_1raw__string__ostream.html">llvm::raw_string_ostream</a> rso(type_str);</div>
<div class="line"><a name="l11654"></a><span class="lineno">11654</span>&#160;        Ty-&gt;<a class="code" href="classllvm_1_1Type.html#a91bbc1ac424839ba7e85d2d8542c288a">print</a>(rso);</div>
<div class="line"><a name="l11655"></a><span class="lineno">11655</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1OptimizationRemarkMissed.html">OptimizationRemarkMissed</a>(<a class="code" href="SLPVectorizer_8cpp.html#a274654b7f5932cae6a71a113322481be">SV_NAME</a>, <span class="stringliteral">&quot;UnsupportedType&quot;</span>, I0)</div>
<div class="line"><a name="l11656"></a><span class="lineno">11656</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;Cannot SLP vectorize list: type &quot;</span></div>
<div class="line"><a name="l11657"></a><span class="lineno">11657</span>&#160;               &lt;&lt; rso.str() + <span class="stringliteral">&quot; is unsupported by vectorizer&quot;</span>;</div>
<div class="line"><a name="l11658"></a><span class="lineno">11658</span>&#160;      });</div>
<div class="line"><a name="l11659"></a><span class="lineno">11659</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11660"></a><span class="lineno">11660</span>&#160;    }</div>
<div class="line"><a name="l11661"></a><span class="lineno">11661</span>&#160;  }</div>
<div class="line"><a name="l11662"></a><span class="lineno">11662</span>&#160; </div>
<div class="line"><a name="l11663"></a><span class="lineno">11663</span>&#160;  <span class="keywordtype">unsigned</span> Sz = <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.getVectorElementSize(I0);</div>
<div class="line"><a name="l11664"></a><span class="lineno">11664</span>&#160;  <span class="keywordtype">unsigned</span> MinVF = <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.getMinVF(Sz);</div>
<div class="line"><a name="l11665"></a><span class="lineno">11665</span>&#160;  <span class="keywordtype">unsigned</span> MaxVF = std::max&lt;unsigned&gt;(<a class="code" href="namespacellvm.html#ae22967d11b695d268992470debfae4b2">llvm::bit_floor</a>(VL.size()), MinVF);</div>
<div class="line"><a name="l11666"></a><span class="lineno">11666</span>&#160;  MaxVF = <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.getMaximumVF(Sz, <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.getOpcode()), MaxVF);</div>
<div class="line"><a name="l11667"></a><span class="lineno">11667</span>&#160;  <span class="keywordflow">if</span> (MaxVF &lt; 2) {</div>
<div class="line"><a name="l11668"></a><span class="lineno">11668</span>&#160;    <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.getORE()-&gt;emit([&amp;]() {</div>
<div class="line"><a name="l11669"></a><span class="lineno">11669</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1OptimizationRemarkMissed.html">OptimizationRemarkMissed</a>(<a class="code" href="SLPVectorizer_8cpp.html#a274654b7f5932cae6a71a113322481be">SV_NAME</a>, <span class="stringliteral">&quot;SmallVF&quot;</span>, I0)</div>
<div class="line"><a name="l11670"></a><span class="lineno">11670</span>&#160;             &lt;&lt; <span class="stringliteral">&quot;Cannot SLP vectorize list: vectorization factor &quot;</span></div>
<div class="line"><a name="l11671"></a><span class="lineno">11671</span>&#160;             &lt;&lt; <span class="stringliteral">&quot;less than 2 is not supported&quot;</span>;</div>
<div class="line"><a name="l11672"></a><span class="lineno">11672</span>&#160;    });</div>
<div class="line"><a name="l11673"></a><span class="lineno">11673</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11674"></a><span class="lineno">11674</span>&#160;  }</div>
<div class="line"><a name="l11675"></a><span class="lineno">11675</span>&#160; </div>
<div class="line"><a name="l11676"></a><span class="lineno">11676</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l11677"></a><span class="lineno">11677</span>&#160;  <span class="keywordtype">bool</span> CandidateFound = <span class="keyword">false</span>;</div>
<div class="line"><a name="l11678"></a><span class="lineno">11678</span>&#160;  <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> MinCost = <a class="code" href="SLPVectorizer_8cpp.html#ae3295545af0d12ee89d3102df3d45b06">SLPCostThreshold</a>.getValue();</div>
<div class="line"><a name="l11679"></a><span class="lineno">11679</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *ScalarTy = VL[0]-&gt;getType();</div>
<div class="line"><a name="l11680"></a><span class="lineno">11680</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a> = dyn_cast&lt;InsertElementInst&gt;(VL[0]))</div>
<div class="line"><a name="l11681"></a><span class="lineno">11681</span>&#160;    ScalarTy = <a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>-&gt;getOperand(1)-&gt;getType();</div>
<div class="line"><a name="l11682"></a><span class="lineno">11682</span>&#160; </div>
<div class="line"><a name="l11683"></a><span class="lineno">11683</span>&#160;  <span class="keywordtype">unsigned</span> NextInst = 0, MaxInst = VL.size();</div>
<div class="line"><a name="l11684"></a><span class="lineno">11684</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> VF = MaxVF; NextInst + 1 &lt; MaxInst &amp;&amp; VF &gt;= MinVF; VF /= 2) {</div>
<div class="line"><a name="l11685"></a><span class="lineno">11685</span>&#160;    <span class="comment">// No actual vectorization should happen, if number of parts is the same as</span></div>
<div class="line"><a name="l11686"></a><span class="lineno">11686</span>&#160;    <span class="comment">// provided vectorization factor (i.e. the scalar type is used for vector</span></div>
<div class="line"><a name="l11687"></a><span class="lineno">11687</span>&#160;    <span class="comment">// code during codegen).</span></div>
<div class="line"><a name="l11688"></a><span class="lineno">11688</span>&#160;    <span class="keyword">auto</span> *VecTy = <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(ScalarTy, VF);</div>
<div class="line"><a name="l11689"></a><span class="lineno">11689</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#ad67b7e389a52ada1d5264e23d09f4cbe">getNumberOfParts</a>(VecTy) == VF)</div>
<div class="line"><a name="l11690"></a><span class="lineno">11690</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l11691"></a><span class="lineno">11691</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = NextInst; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; MaxInst; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l11692"></a><span class="lineno">11692</span>&#160;      <span class="keywordtype">unsigned</span> OpsWidth = 0;</div>
<div class="line"><a name="l11693"></a><span class="lineno">11693</span>&#160; </div>
<div class="line"><a name="l11694"></a><span class="lineno">11694</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> + VF &gt; MaxInst)</div>
<div class="line"><a name="l11695"></a><span class="lineno">11695</span>&#160;        OpsWidth = MaxInst - <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l11696"></a><span class="lineno">11696</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l11697"></a><span class="lineno">11697</span>&#160;        OpsWidth = VF;</div>
<div class="line"><a name="l11698"></a><span class="lineno">11698</span>&#160; </div>
<div class="line"><a name="l11699"></a><span class="lineno">11699</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2_32</a>(OpsWidth))</div>
<div class="line"><a name="l11700"></a><span class="lineno">11700</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l11701"></a><span class="lineno">11701</span>&#160; </div>
<div class="line"><a name="l11702"></a><span class="lineno">11702</span>&#160;      <span class="keywordflow">if</span> ((LimitForRegisterSize &amp;&amp; OpsWidth &lt; MaxVF) ||</div>
<div class="line"><a name="l11703"></a><span class="lineno">11703</span>&#160;          (VF &gt; MinVF &amp;&amp; OpsWidth &lt;= VF / 2) || (VF == MinVF &amp;&amp; OpsWidth &lt; 2))</div>
<div class="line"><a name="l11704"></a><span class="lineno">11704</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l11705"></a><span class="lineno">11705</span>&#160; </div>
<div class="line"><a name="l11706"></a><span class="lineno">11706</span>&#160;      <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> Ops = VL.<a class="code" href="classllvm_1_1ArrayRef.html#ace7bdce94e806bb8870626657630dab0">slice</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, OpsWidth);</div>
<div class="line"><a name="l11707"></a><span class="lineno">11707</span>&#160;      <span class="comment">// Check that a previous iteration of this loop did not delete the Value.</span></div>
<div class="line"><a name="l11708"></a><span class="lineno">11708</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">llvm::any_of</a>(Ops, [&amp;R](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l11709"></a><span class="lineno">11709</span>&#160;            <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l11710"></a><span class="lineno">11710</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp; <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.isDeleted(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l11711"></a><span class="lineno">11711</span>&#160;          }))</div>
<div class="line"><a name="l11712"></a><span class="lineno">11712</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l11713"></a><span class="lineno">11713</span>&#160; </div>
<div class="line"><a name="l11714"></a><span class="lineno">11714</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Analyzing &quot;</span> &lt;&lt; OpsWidth &lt;&lt; <span class="stringliteral">&quot; operations &quot;</span></div>
<div class="line"><a name="l11715"></a><span class="lineno">11715</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l11716"></a><span class="lineno">11716</span>&#160; </div>
<div class="line"><a name="l11717"></a><span class="lineno">11717</span>&#160;      <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.buildTree(Ops);</div>
<div class="line"><a name="l11718"></a><span class="lineno">11718</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.isTreeTinyAndNotFullyVectorizable())</div>
<div class="line"><a name="l11719"></a><span class="lineno">11719</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l11720"></a><span class="lineno">11720</span>&#160;      <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.reorderTopToBottom();</div>
<div class="line"><a name="l11721"></a><span class="lineno">11721</span>&#160;      <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.reorderBottomToTop(</div>
<div class="line"><a name="l11722"></a><span class="lineno">11722</span>&#160;          <span class="comment">/*IgnoreReorder=*/</span>!isa&lt;InsertElementInst&gt;(Ops.<a class="code" href="classllvm_1_1ArrayRef.html#a6bc2b53fce3b1d8975eea027d8a8eb90">front</a>()) &amp;&amp;</div>
<div class="line"><a name="l11723"></a><span class="lineno">11723</span>&#160;          !<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.doesRootHaveInTreeUses());</div>
<div class="line"><a name="l11724"></a><span class="lineno">11724</span>&#160;      <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.buildExternalUses();</div>
<div class="line"><a name="l11725"></a><span class="lineno">11725</span>&#160; </div>
<div class="line"><a name="l11726"></a><span class="lineno">11726</span>&#160;      <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.computeMinimumValueSizes();</div>
<div class="line"><a name="l11727"></a><span class="lineno">11727</span>&#160;      <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> = <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.getTreeCost();</div>
<div class="line"><a name="l11728"></a><span class="lineno">11728</span>&#160;      CandidateFound = <span class="keyword">true</span>;</div>
<div class="line"><a name="l11729"></a><span class="lineno">11729</span>&#160;      MinCost = <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(MinCost, Cost);</div>
<div class="line"><a name="l11730"></a><span class="lineno">11730</span>&#160; </div>
<div class="line"><a name="l11731"></a><span class="lineno">11731</span>&#160;      <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Found cost = &quot;</span> &lt;&lt; Cost</div>
<div class="line"><a name="l11732"></a><span class="lineno">11732</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot; for VF=&quot;</span> &lt;&lt; OpsWidth &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l11733"></a><span class="lineno">11733</span>&#160;      <span class="keywordflow">if</span> (Cost &lt; -<a class="code" href="SLPVectorizer_8cpp.html#ae3295545af0d12ee89d3102df3d45b06">SLPCostThreshold</a>) {</div>
<div class="line"><a name="l11734"></a><span class="lineno">11734</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Vectorizing list at cost:&quot;</span> &lt;&lt; Cost &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l11735"></a><span class="lineno">11735</span>&#160;        <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.getORE()-&gt;emit(<a class="code" href="classllvm_1_1OptimizationRemark.html">OptimizationRemark</a>(<a class="code" href="SLPVectorizer_8cpp.html#a274654b7f5932cae6a71a113322481be">SV_NAME</a>, <span class="stringliteral">&quot;VectorizedList&quot;</span>,</div>
<div class="line"><a name="l11736"></a><span class="lineno">11736</span>&#160;                                                    cast&lt;Instruction&gt;(Ops[0]))</div>
<div class="line"><a name="l11737"></a><span class="lineno">11737</span>&#160;                                 &lt;&lt; <span class="stringliteral">&quot;SLP vectorized with cost &quot;</span> &lt;&lt; <a class="code" href="structllvm_1_1DiagnosticInfoOptimizationBase_1_1Argument.html">ore::NV</a>(<span class="stringliteral">&quot;Cost&quot;</span>, Cost)</div>
<div class="line"><a name="l11738"></a><span class="lineno">11738</span>&#160;                                 &lt;&lt; <span class="stringliteral">&quot; and with tree size &quot;</span></div>
<div class="line"><a name="l11739"></a><span class="lineno">11739</span>&#160;                                 &lt;&lt; <a class="code" href="structllvm_1_1DiagnosticInfoOptimizationBase_1_1Argument.html">ore::NV</a>(<span class="stringliteral">&quot;TreeSize&quot;</span>, <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.getTreeSize()));</div>
<div class="line"><a name="l11740"></a><span class="lineno">11740</span>&#160; </div>
<div class="line"><a name="l11741"></a><span class="lineno">11741</span>&#160;        <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.vectorizeTree();</div>
<div class="line"><a name="l11742"></a><span class="lineno">11742</span>&#160;        <span class="comment">// Move to the next bundle.</span></div>
<div class="line"><a name="l11743"></a><span class="lineno">11743</span>&#160;        <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> += VF - 1;</div>
<div class="line"><a name="l11744"></a><span class="lineno">11744</span>&#160;        NextInst = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> + 1;</div>
<div class="line"><a name="l11745"></a><span class="lineno">11745</span>&#160;        Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l11746"></a><span class="lineno">11746</span>&#160;      }</div>
<div class="line"><a name="l11747"></a><span class="lineno">11747</span>&#160;    }</div>
<div class="line"><a name="l11748"></a><span class="lineno">11748</span>&#160;  }</div>
<div class="line"><a name="l11749"></a><span class="lineno">11749</span>&#160; </div>
<div class="line"><a name="l11750"></a><span class="lineno">11750</span>&#160;  <span class="keywordflow">if</span> (!Changed &amp;&amp; CandidateFound) {</div>
<div class="line"><a name="l11751"></a><span class="lineno">11751</span>&#160;    <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.getORE()-&gt;emit([&amp;]() {</div>
<div class="line"><a name="l11752"></a><span class="lineno">11752</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1OptimizationRemarkMissed.html">OptimizationRemarkMissed</a>(<a class="code" href="SLPVectorizer_8cpp.html#a274654b7f5932cae6a71a113322481be">SV_NAME</a>, <span class="stringliteral">&quot;NotBeneficial&quot;</span>, I0)</div>
<div class="line"><a name="l11753"></a><span class="lineno">11753</span>&#160;             &lt;&lt; <span class="stringliteral">&quot;List vectorization was possible but not beneficial with cost &quot;</span></div>
<div class="line"><a name="l11754"></a><span class="lineno">11754</span>&#160;             &lt;&lt; <a class="code" href="namespacellvm_1_1ore.html#a8f5533240c6722d987a2443cba42019d">ore::NV</a>(<span class="stringliteral">&quot;Cost&quot;</span>, MinCost) &lt;&lt; <span class="stringliteral">&quot; &gt;= &quot;</span></div>
<div class="line"><a name="l11755"></a><span class="lineno">11755</span>&#160;             &lt;&lt; <a class="code" href="namespacellvm_1_1ore.html#a8f5533240c6722d987a2443cba42019d">ore::NV</a>(<span class="stringliteral">&quot;Treshold&quot;</span>, -<a class="code" href="SLPVectorizer_8cpp.html#ae3295545af0d12ee89d3102df3d45b06">SLPCostThreshold</a>);</div>
<div class="line"><a name="l11756"></a><span class="lineno">11756</span>&#160;    });</div>
<div class="line"><a name="l11757"></a><span class="lineno">11757</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!Changed) {</div>
<div class="line"><a name="l11758"></a><span class="lineno">11758</span>&#160;    <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.getORE()-&gt;emit([&amp;]() {</div>
<div class="line"><a name="l11759"></a><span class="lineno">11759</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1OptimizationRemarkMissed.html">OptimizationRemarkMissed</a>(<a class="code" href="SLPVectorizer_8cpp.html#a274654b7f5932cae6a71a113322481be">SV_NAME</a>, <span class="stringliteral">&quot;NotPossible&quot;</span>, I0)</div>
<div class="line"><a name="l11760"></a><span class="lineno">11760</span>&#160;             &lt;&lt; <span class="stringliteral">&quot;Cannot SLP vectorize list: vectorization was impossible&quot;</span></div>
<div class="line"><a name="l11761"></a><span class="lineno">11761</span>&#160;             &lt;&lt; <span class="stringliteral">&quot; with available vectorization factors&quot;</span>;</div>
<div class="line"><a name="l11762"></a><span class="lineno">11762</span>&#160;    });</div>
<div class="line"><a name="l11763"></a><span class="lineno">11763</span>&#160;  }</div>
<div class="line"><a name="l11764"></a><span class="lineno">11764</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l11765"></a><span class="lineno">11765</span>&#160;}</div>
<div class="line"><a name="l11766"></a><span class="lineno">11766</span>&#160; </div>
<div class="line"><a name="l11767"></a><span class="lineno">11767</span>&#160;<span class="keywordtype">bool</span> SLPVectorizerPass::tryToVectorize(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> &amp;R) {</div>
<div class="line"><a name="l11768"></a><span class="lineno">11768</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l11769"></a><span class="lineno">11769</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11770"></a><span class="lineno">11770</span>&#160; </div>
<div class="line"><a name="l11771"></a><span class="lineno">11771</span>&#160;  <span class="keywordflow">if</span> (!isa&lt;BinaryOperator, CmpInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || isa&lt;VectorType&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()))</div>
<div class="line"><a name="l11772"></a><span class="lineno">11772</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11773"></a><span class="lineno">11773</span>&#160; </div>
<div class="line"><a name="l11774"></a><span class="lineno">11774</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</div>
<div class="line"><a name="l11775"></a><span class="lineno">11775</span>&#160; </div>
<div class="line"><a name="l11776"></a><span class="lineno">11776</span>&#160;  <span class="comment">// Vectorize in current basic block only.</span></div>
<div class="line"><a name="l11777"></a><span class="lineno">11777</span>&#160;  <span class="keyword">auto</span> *Op0 = dyn_cast&lt;Instruction&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0));</div>
<div class="line"><a name="l11778"></a><span class="lineno">11778</span>&#160;  <span class="keyword">auto</span> *Op1 = dyn_cast&lt;Instruction&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1));</div>
<div class="line"><a name="l11779"></a><span class="lineno">11779</span>&#160;  <span class="keywordflow">if</span> (!Op0 || !Op1 || Op0-&gt;getParent() != <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> || Op1-&gt;getParent() != <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>)</div>
<div class="line"><a name="l11780"></a><span class="lineno">11780</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11781"></a><span class="lineno">11781</span>&#160; </div>
<div class="line"><a name="l11782"></a><span class="lineno">11782</span>&#160;  <span class="comment">// First collect all possible candidates</span></div>
<div class="line"><a name="l11783"></a><span class="lineno">11783</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;Value *, Value *&gt;</a>, 4&gt; Candidates;</div>
<div class="line"><a name="l11784"></a><span class="lineno">11784</span>&#160;  Candidates.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>(Op0, Op1);</div>
<div class="line"><a name="l11785"></a><span class="lineno">11785</span>&#160; </div>
<div class="line"><a name="l11786"></a><span class="lineno">11786</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a> = dyn_cast&lt;BinaryOperator&gt;(Op0);</div>
<div class="line"><a name="l11787"></a><span class="lineno">11787</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a> = dyn_cast&lt;BinaryOperator&gt;(Op1);</div>
<div class="line"><a name="l11788"></a><span class="lineno">11788</span>&#160;  <span class="comment">// Try to skip B.</span></div>
<div class="line"><a name="l11789"></a><span class="lineno">11789</span>&#160;  <span class="keywordflow">if</span> (A &amp;&amp; <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a> &amp;&amp; <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>-&gt;hasOneUse()) {</div>
<div class="line"><a name="l11790"></a><span class="lineno">11790</span>&#160;    <span class="keyword">auto</span> *B0 = dyn_cast&lt;BinaryOperator&gt;(<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>-&gt;getOperand(0));</div>
<div class="line"><a name="l11791"></a><span class="lineno">11791</span>&#160;    <span class="keyword">auto</span> *B1 = dyn_cast&lt;BinaryOperator&gt;(<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>-&gt;getOperand(1));</div>
<div class="line"><a name="l11792"></a><span class="lineno">11792</span>&#160;    <span class="keywordflow">if</span> (B0 &amp;&amp; B0-&gt;getParent() == <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>)</div>
<div class="line"><a name="l11793"></a><span class="lineno">11793</span>&#160;      Candidates.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>(A, B0);</div>
<div class="line"><a name="l11794"></a><span class="lineno">11794</span>&#160;    <span class="keywordflow">if</span> (B1 &amp;&amp; B1-&gt;getParent() == <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>)</div>
<div class="line"><a name="l11795"></a><span class="lineno">11795</span>&#160;      Candidates.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>(A, B1);</div>
<div class="line"><a name="l11796"></a><span class="lineno">11796</span>&#160;  }</div>
<div class="line"><a name="l11797"></a><span class="lineno">11797</span>&#160;  <span class="comment">// Try to skip A.</span></div>
<div class="line"><a name="l11798"></a><span class="lineno">11798</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a> &amp;&amp; A &amp;&amp; <a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>-&gt;hasOneUse()) {</div>
<div class="line"><a name="l11799"></a><span class="lineno">11799</span>&#160;    <span class="keyword">auto</span> *A0 = dyn_cast&lt;BinaryOperator&gt;(<a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>-&gt;getOperand(0));</div>
<div class="line"><a name="l11800"></a><span class="lineno">11800</span>&#160;    <span class="keyword">auto</span> *A1 = dyn_cast&lt;BinaryOperator&gt;(<a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>-&gt;getOperand(1));</div>
<div class="line"><a name="l11801"></a><span class="lineno">11801</span>&#160;    <span class="keywordflow">if</span> (A0 &amp;&amp; A0-&gt;getParent() == <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>)</div>
<div class="line"><a name="l11802"></a><span class="lineno">11802</span>&#160;      Candidates.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>(A0, <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>);</div>
<div class="line"><a name="l11803"></a><span class="lineno">11803</span>&#160;    <span class="keywordflow">if</span> (A1 &amp;&amp; A1-&gt;getParent() == <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>)</div>
<div class="line"><a name="l11804"></a><span class="lineno">11804</span>&#160;      Candidates.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>(A1, <a class="code" href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a>);</div>
<div class="line"><a name="l11805"></a><span class="lineno">11805</span>&#160;  }</div>
<div class="line"><a name="l11806"></a><span class="lineno">11806</span>&#160; </div>
<div class="line"><a name="l11807"></a><span class="lineno">11807</span>&#160;  <span class="keywordflow">if</span> (Candidates.size() == 1)</div>
<div class="line"><a name="l11808"></a><span class="lineno">11808</span>&#160;    <span class="keywordflow">return</span> tryToVectorizePair(Op0, Op1, R);</div>
<div class="line"><a name="l11809"></a><span class="lineno">11809</span>&#160; </div>
<div class="line"><a name="l11810"></a><span class="lineno">11810</span>&#160;  <span class="comment">// We have multiple options. Try to pick the single best.</span></div>
<div class="line"><a name="l11811"></a><span class="lineno">11811</span>&#160;  std::optional&lt;int&gt; BestCandidate = <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.findBestRootPair(Candidates);</div>
<div class="line"><a name="l11812"></a><span class="lineno">11812</span>&#160;  <span class="keywordflow">if</span> (!BestCandidate)</div>
<div class="line"><a name="l11813"></a><span class="lineno">11813</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11814"></a><span class="lineno">11814</span>&#160;  <span class="keywordflow">return</span> tryToVectorizePair(Candidates[*BestCandidate].first,</div>
<div class="line"><a name="l11815"></a><span class="lineno">11815</span>&#160;                            Candidates[*BestCandidate].second, R);</div>
<div class="line"><a name="l11816"></a><span class="lineno">11816</span>&#160;}</div>
<div class="line"><a name="l11817"></a><span class="lineno">11817</span>&#160; </div>
<div class="line"><a name="l11818"></a><span class="lineno">11818</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l11819"></a><span class="lineno">11819</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l11820"></a><span class="lineno">11820</span>&#160;<span class="comment">/// Model horizontal reductions.</span></div>
<div class="line"><a name="l11821"></a><span class="lineno">11821</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l11822"></a><span class="lineno">11822</span>&#160;<span class="comment">/// A horizontal reduction is a tree of reduction instructions that has values</span></div>
<div class="line"><a name="l11823"></a><span class="lineno">11823</span>&#160;<span class="comment">/// that can be put into a vector as its leaves. For example:</span></div>
<div class="line"><a name="l11824"></a><span class="lineno">11824</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l11825"></a><span class="lineno">11825</span>&#160;<span class="comment">/// mul mul mul mul</span></div>
<div class="line"><a name="l11826"></a><span class="lineno">11826</span>&#160;<span class="comment">///  \  /    \  /</span></div>
<div class="line"><a name="l11827"></a><span class="lineno">11827</span>&#160;<span class="comment">///   +       +</span></div>
<div class="line"><a name="l11828"></a><span class="lineno">11828</span>&#160;<span class="comment">///    \     /</span></div>
<div class="line"><a name="l11829"></a><span class="lineno">11829</span>&#160;<span class="comment">///       +</span></div>
<div class="line"><a name="l11830"></a><span class="lineno">11830</span>&#160;<span class="comment">/// This tree has &quot;mul&quot; as its leaf values and &quot;+&quot; as its reduction</span></div>
<div class="line"><a name="l11831"></a><span class="lineno">11831</span>&#160;<span class="comment">/// instructions. A reduction can feed into a store or a binary operation</span></div>
<div class="line"><a name="l11832"></a><span class="lineno">11832</span>&#160;<span class="comment">/// feeding a phi.</span></div>
<div class="line"><a name="l11833"></a><span class="lineno">11833</span>&#160;<span class="comment">///    ...</span></div>
<div class="line"><a name="l11834"></a><span class="lineno">11834</span>&#160;<span class="comment">///    \  /</span></div>
<div class="line"><a name="l11835"></a><span class="lineno">11835</span>&#160;<span class="comment">///     +</span></div>
<div class="line"><a name="l11836"></a><span class="lineno">11836</span>&#160;<span class="comment">///     |</span></div>
<div class="line"><a name="l11837"></a><span class="lineno">11837</span>&#160;<span class="comment">///  phi +=</span></div>
<div class="line"><a name="l11838"></a><span class="lineno">11838</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l11839"></a><span class="lineno">11839</span>&#160;<span class="comment">///  Or:</span></div>
<div class="line"><a name="l11840"></a><span class="lineno">11840</span>&#160;<span class="comment">///    ...</span></div>
<div class="line"><a name="l11841"></a><span class="lineno">11841</span>&#160;<span class="comment">///    \  /</span></div>
<div class="line"><a name="l11842"></a><span class="lineno">11842</span>&#160;<span class="comment">///     +</span></div>
<div class="line"><a name="l11843"></a><span class="lineno">11843</span>&#160;<span class="comment">///     |</span></div>
<div class="line"><a name="l11844"></a><span class="lineno">11844</span>&#160;<span class="comment">///   *p =</span></div>
<div class="line"><a name="l11845"></a><span class="lineno">11845</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l11846"></a><span class="lineno">11846</span>&#160;<span class="comment"></span><span class="keyword">class </span><a class="code" href="namespacellvm_1_1ARMII.html#a7d414894ef8cdc39b147eb7e0d7e4305a9e2a02c8e15c43cfe03fee48f85f76cf">HorizontalReduction</a> {</div>
<div class="line"><a name="l11847"></a><span class="lineno">11847</span>&#160;  <span class="keyword">using</span> ReductionOpsType = <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 16&gt;</a>;</div>
<div class="line"><a name="l11848"></a><span class="lineno">11848</span>&#160;  <span class="keyword">using</span> ReductionOpsListType = <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;ReductionOpsType, 2&gt;</a>;</div>
<div class="line"><a name="l11849"></a><span class="lineno">11849</span>&#160;  ReductionOpsListType ReductionOps;<span class="comment"></span></div>
<div class="line"><a name="l11850"></a><span class="lineno">11850</span>&#160;<span class="comment">  /// List of possibly reduced values.</span></div>
<div class="line"><a name="l11851"></a><span class="lineno">11851</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;SmallVector&lt;Value *&gt;</a>&gt; ReducedVals;<span class="comment"></span></div>
<div class="line"><a name="l11852"></a><span class="lineno">11852</span>&#160;<span class="comment">  /// Maps reduced value to the corresponding reduction operation.</span></div>
<div class="line"><a name="l11853"></a><span class="lineno">11853</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, SmallVector&lt;Instruction *&gt;</a>&gt; ReducedValsToOps;</div>
<div class="line"><a name="l11854"></a><span class="lineno">11854</span>&#160;  <span class="comment">// Use map vector to make stable output.</span></div>
<div class="line"><a name="l11855"></a><span class="lineno">11855</span>&#160;  <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;Instruction *, Value *&gt;</a> ExtraArgs;</div>
<div class="line"><a name="l11856"></a><span class="lineno">11856</span>&#160;  <a class="code" href="classllvm_1_1WeakTrackingVH.html">WeakTrackingVH</a> ReductionRoot;<span class="comment"></span></div>
<div class="line"><a name="l11857"></a><span class="lineno">11857</span>&#160;<span class="comment">  /// The type of reduction operation.</span></div>
<div class="line"><a name="l11858"></a><span class="lineno">11858</span>&#160;<span class="comment"></span>  <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830e">RecurKind</a> RdxKind;</div>
<div class="line"><a name="l11859"></a><span class="lineno">11859</span>&#160; </div>
<div class="line"><a name="l11860"></a><span class="lineno">11860</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">bool</span> isCmpSelMinMax(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l11861"></a><span class="lineno">11861</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#addb87fe3f509b7803d3f5933ee24b560">m_Select</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a753e1338645ec04d045211b8a46d968d">m_Cmp</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>())) &amp;&amp;</div>
<div class="line"><a name="l11862"></a><span class="lineno">11862</span>&#160;           <a class="code" href="classllvm_1_1RecurrenceDescriptor.html#af08d243545b64f4b77161992d0e2366e">RecurrenceDescriptor::isMinMaxRecurrenceKind</a>(getRdxKind(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</div>
<div class="line"><a name="l11863"></a><span class="lineno">11863</span>&#160;  }</div>
<div class="line"><a name="l11864"></a><span class="lineno">11864</span>&#160; </div>
<div class="line"><a name="l11865"></a><span class="lineno">11865</span>&#160;  <span class="comment">// And/or are potentially poison-safe logical patterns like:</span></div>
<div class="line"><a name="l11866"></a><span class="lineno">11866</span>&#160;  <span class="comment">// select x, y, false</span></div>
<div class="line"><a name="l11867"></a><span class="lineno">11867</span>&#160;  <span class="comment">// select x, true, y</span></div>
<div class="line"><a name="l11868"></a><span class="lineno">11868</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">bool</span> isBoolLogicOp(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l11869"></a><span class="lineno">11869</span>&#160;    <span class="keywordflow">return</span> isa&lt;SelectInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</div>
<div class="line"><a name="l11870"></a><span class="lineno">11870</span>&#160;           (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#a213e6c0ca6e838157373b9a6018c0769">m_LogicalAnd</a>()) || <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#a1a06b1cff93069d7403ea03e6150e386">m_LogicalOr</a>()));</div>
<div class="line"><a name="l11871"></a><span class="lineno">11871</span>&#160;  }</div>
<div class="line"><a name="l11872"></a><span class="lineno">11872</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l11873"></a><span class="lineno">11873</span>&#160;<span class="comment">  /// Checks if instruction is associative and can be vectorized.</span></div>
<div class="line"><a name="l11874"></a><span class="lineno">11874</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> <span class="keywordtype">bool</span> isVectorizable(<a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830e">RecurKind</a> Kind, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l11875"></a><span class="lineno">11875</span>&#160;    <span class="keywordflow">if</span> (Kind == <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea6adf97f83acf6453d4a6a4b1070f3754">RecurKind::None</a>)</div>
<div class="line"><a name="l11876"></a><span class="lineno">11876</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l11877"></a><span class="lineno">11877</span>&#160; </div>
<div class="line"><a name="l11878"></a><span class="lineno">11878</span>&#160;    <span class="comment">// Integer ops that map to select instructions or intrinsics are fine.</span></div>
<div class="line"><a name="l11879"></a><span class="lineno">11879</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1RecurrenceDescriptor.html#aef4824e1c55ce3d04e8759c333dbc5c5">RecurrenceDescriptor::isIntMinMaxRecurrenceKind</a>(Kind) ||</div>
<div class="line"><a name="l11880"></a><span class="lineno">11880</span>&#160;        isBoolLogicOp(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l11881"></a><span class="lineno">11881</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l11882"></a><span class="lineno">11882</span>&#160; </div>
<div class="line"><a name="l11883"></a><span class="lineno">11883</span>&#160;    <span class="keywordflow">if</span> (Kind == <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea8764eae15a1f2cf1c964d14dcf9283ee">RecurKind::FMax</a> || Kind == <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ead76b595f89852f41ac50173abae6da05">RecurKind::FMin</a>) {</div>
<div class="line"><a name="l11884"></a><span class="lineno">11884</span>&#160;      <span class="comment">// FP min/max are associative except for NaN and -0.0. We do not</span></div>
<div class="line"><a name="l11885"></a><span class="lineno">11885</span>&#160;      <span class="comment">// have to rule out -0.0 here because the intrinsic semantics do not</span></div>
<div class="line"><a name="l11886"></a><span class="lineno">11886</span>&#160;      <span class="comment">// specify a fixed result for it.</span></div>
<div class="line"><a name="l11887"></a><span class="lineno">11887</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getFastMathFlags().noNaNs();</div>
<div class="line"><a name="l11888"></a><span class="lineno">11888</span>&#160;    }</div>
<div class="line"><a name="l11889"></a><span class="lineno">11889</span>&#160; </div>
<div class="line"><a name="l11890"></a><span class="lineno">11890</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isAssociative();</div>
<div class="line"><a name="l11891"></a><span class="lineno">11891</span>&#160;  }</div>
<div class="line"><a name="l11892"></a><span class="lineno">11892</span>&#160; </div>
<div class="line"><a name="l11893"></a><span class="lineno">11893</span>&#160;  <span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *getRdxOperand(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>) {</div>
<div class="line"><a name="l11894"></a><span class="lineno">11894</span>&#160;    <span class="comment">// Poison-safe &#39;or&#39; takes the form: select X, true, Y</span></div>
<div class="line"><a name="l11895"></a><span class="lineno">11895</span>&#160;    <span class="comment">// To make that work with the normal operand processing, we skip the</span></div>
<div class="line"><a name="l11896"></a><span class="lineno">11896</span>&#160;    <span class="comment">// true value operand.</span></div>
<div class="line"><a name="l11897"></a><span class="lineno">11897</span>&#160;    <span class="comment">// TODO: Change the code and data structures to handle this without a hack.</span></div>
<div class="line"><a name="l11898"></a><span class="lineno">11898</span>&#160;    <span class="keywordflow">if</span> (getRdxKind(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) == <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea3a2d5fe857d8f9541136a124c2edec6c">RecurKind::Or</a> &amp;&amp; isa&lt;SelectInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a> == 1)</div>
<div class="line"><a name="l11899"></a><span class="lineno">11899</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(2);</div>
<div class="line"><a name="l11900"></a><span class="lineno">11900</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(<a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>);</div>
<div class="line"><a name="l11901"></a><span class="lineno">11901</span>&#160;  }</div>
<div class="line"><a name="l11902"></a><span class="lineno">11902</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l11903"></a><span class="lineno">11903</span>&#160;<span class="comment">  /// Creates reduction operation with the current opcode.</span></div>
<div class="line"><a name="l11904"></a><span class="lineno">11904</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *createOp(<a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830e">RecurKind</a> Kind, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>,</div>
<div class="line"><a name="l11905"></a><span class="lineno">11905</span>&#160;                         <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1Twine.html">Twine</a> &amp;Name, <span class="keywordtype">bool</span> UseSelect) {</div>
<div class="line"><a name="l11906"></a><span class="lineno">11906</span>&#160;    <span class="keywordtype">unsigned</span> RdxOpcode = <a class="code" href="classllvm_1_1RecurrenceDescriptor.html#a32c8ad694911bf6dcf6cb07824f2823e">RecurrenceDescriptor::getOpcode</a>(Kind);</div>
<div class="line"><a name="l11907"></a><span class="lineno">11907</span>&#160;    <span class="keywordflow">switch</span> (Kind) {</div>
<div class="line"><a name="l11908"></a><span class="lineno">11908</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea3a2d5fe857d8f9541136a124c2edec6c">RecurKind::Or</a>:</div>
<div class="line"><a name="l11909"></a><span class="lineno">11909</span>&#160;      <span class="keywordflow">if</span> (UseSelect &amp;&amp;</div>
<div class="line"><a name="l11910"></a><span class="lineno">11910</span>&#160;          <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() == <a class="code" href="classllvm_1_1CmpInst.html#a4b5e1f50cb0890ec60d8c61a61241170">CmpInst::makeCmpResultType</a>(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()))</div>
<div class="line"><a name="l11911"></a><span class="lineno">11911</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSelect(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getTrue(), <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, Name);</div>
<div class="line"><a name="l11912"></a><span class="lineno">11912</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBinOp((<a class="code" href="classllvm_1_1Instruction.html#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a>)RdxOpcode, <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>,</div>
<div class="line"><a name="l11913"></a><span class="lineno">11913</span>&#160;                                 Name);</div>
<div class="line"><a name="l11914"></a><span class="lineno">11914</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">RecurKind::And</a>:</div>
<div class="line"><a name="l11915"></a><span class="lineno">11915</span>&#160;      <span class="keywordflow">if</span> (UseSelect &amp;&amp;</div>
<div class="line"><a name="l11916"></a><span class="lineno">11916</span>&#160;          <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() == <a class="code" href="classllvm_1_1CmpInst.html#a4b5e1f50cb0890ec60d8c61a61241170">CmpInst::makeCmpResultType</a>(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()))</div>
<div class="line"><a name="l11917"></a><span class="lineno">11917</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSelect(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getFalse(), Name);</div>
<div class="line"><a name="l11918"></a><span class="lineno">11918</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBinOp((<a class="code" href="classllvm_1_1Instruction.html#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a>)RdxOpcode, <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>,</div>
<div class="line"><a name="l11919"></a><span class="lineno">11919</span>&#160;                                 Name);</div>
<div class="line"><a name="l11920"></a><span class="lineno">11920</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">RecurKind::Add</a>:</div>
<div class="line"><a name="l11921"></a><span class="lineno">11921</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea62b6d55816cf737bfc6f42e60df1a3f2">RecurKind::Mul</a>:</div>
<div class="line"><a name="l11922"></a><span class="lineno">11922</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea76feb79109026728a20736a8c6504548">RecurKind::Xor</a>:</div>
<div class="line"><a name="l11923"></a><span class="lineno">11923</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eaf552e181879ad14956985859308d77d9">RecurKind::FAdd</a>:</div>
<div class="line"><a name="l11924"></a><span class="lineno">11924</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eab48b2a9934af7a531cfd7236ded9d50e">RecurKind::FMul</a>:</div>
<div class="line"><a name="l11925"></a><span class="lineno">11925</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBinOp((<a class="code" href="classllvm_1_1Instruction.html#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a>)RdxOpcode, <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>,</div>
<div class="line"><a name="l11926"></a><span class="lineno">11926</span>&#160;                                 Name);</div>
<div class="line"><a name="l11927"></a><span class="lineno">11927</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea8764eae15a1f2cf1c964d14dcf9283ee">RecurKind::FMax</a>:</div>
<div class="line"><a name="l11928"></a><span class="lineno">11928</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBinaryIntrinsic(<a class="code" href="namespacellvm.html#a636de400e4dd2bc090b729329a99e75b">Intrinsic::maxnum</a>, <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</div>
<div class="line"><a name="l11929"></a><span class="lineno">11929</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ead76b595f89852f41ac50173abae6da05">RecurKind::FMin</a>:</div>
<div class="line"><a name="l11930"></a><span class="lineno">11930</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBinaryIntrinsic(<a class="code" href="namespacellvm.html#aa656aa475d13ec6a900414eadabe86b0">Intrinsic::minnum</a>, <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</div>
<div class="line"><a name="l11931"></a><span class="lineno">11931</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eabccd0de85dfbe7aef83629b318a4df6e">RecurKind::SMax</a>:</div>
<div class="line"><a name="l11932"></a><span class="lineno">11932</span>&#160;      <span class="keywordflow">if</span> (UseSelect) {</div>
<div class="line"><a name="l11933"></a><span class="lineno">11933</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateICmpSGT(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, Name);</div>
<div class="line"><a name="l11934"></a><span class="lineno">11934</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSelect(Cmp, <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, Name);</div>
<div class="line"><a name="l11935"></a><span class="lineno">11935</span>&#160;      }</div>
<div class="line"><a name="l11936"></a><span class="lineno">11936</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBinaryIntrinsic(<a class="code" href="namespacellvm_1_1APIntOps.html#afee2477c062b67b487941ee0f4ff95ba">Intrinsic::smax</a>, <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</div>
<div class="line"><a name="l11937"></a><span class="lineno">11937</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ead6bb6a2eca7d60c75e349ea45e138d74">RecurKind::SMin</a>:</div>
<div class="line"><a name="l11938"></a><span class="lineno">11938</span>&#160;      <span class="keywordflow">if</span> (UseSelect) {</div>
<div class="line"><a name="l11939"></a><span class="lineno">11939</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateICmpSLT(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, Name);</div>
<div class="line"><a name="l11940"></a><span class="lineno">11940</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSelect(Cmp, <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, Name);</div>
<div class="line"><a name="l11941"></a><span class="lineno">11941</span>&#160;      }</div>
<div class="line"><a name="l11942"></a><span class="lineno">11942</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBinaryIntrinsic(<a class="code" href="namespacellvm_1_1APIntOps.html#a87e2895d880926d0b9a2128b3acfc9dd">Intrinsic::smin</a>, <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</div>
<div class="line"><a name="l11943"></a><span class="lineno">11943</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eafaa1f94cd925672925f691e7f5727a6b">RecurKind::UMax</a>:</div>
<div class="line"><a name="l11944"></a><span class="lineno">11944</span>&#160;      <span class="keywordflow">if</span> (UseSelect) {</div>
<div class="line"><a name="l11945"></a><span class="lineno">11945</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateICmpUGT(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, Name);</div>
<div class="line"><a name="l11946"></a><span class="lineno">11946</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSelect(Cmp, <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, Name);</div>
<div class="line"><a name="l11947"></a><span class="lineno">11947</span>&#160;      }</div>
<div class="line"><a name="l11948"></a><span class="lineno">11948</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBinaryIntrinsic(<a class="code" href="namespacellvm_1_1APIntOps.html#a071b3581888d9e3b0b05cec58f152a91">Intrinsic::umax</a>, <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</div>
<div class="line"><a name="l11949"></a><span class="lineno">11949</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea1c692ed4bf463fb08fca4d8cb8201ac0">RecurKind::UMin</a>:</div>
<div class="line"><a name="l11950"></a><span class="lineno">11950</span>&#160;      <span class="keywordflow">if</span> (UseSelect) {</div>
<div class="line"><a name="l11951"></a><span class="lineno">11951</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateICmpULT(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, Name);</div>
<div class="line"><a name="l11952"></a><span class="lineno">11952</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSelect(Cmp, <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, Name);</div>
<div class="line"><a name="l11953"></a><span class="lineno">11953</span>&#160;      }</div>
<div class="line"><a name="l11954"></a><span class="lineno">11954</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBinaryIntrinsic(<a class="code" href="namespacellvm_1_1APIntOps.html#aa606171b17bdde9015fa656e226ca9e0">Intrinsic::umin</a>, <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</div>
<div class="line"><a name="l11955"></a><span class="lineno">11955</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l11956"></a><span class="lineno">11956</span>&#160;      <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Unknown reduction operation.&quot;</span>);</div>
<div class="line"><a name="l11957"></a><span class="lineno">11957</span>&#160;    }</div>
<div class="line"><a name="l11958"></a><span class="lineno">11958</span>&#160;  }</div>
<div class="line"><a name="l11959"></a><span class="lineno">11959</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l11960"></a><span class="lineno">11960</span>&#160;<span class="comment">  /// Creates reduction operation with the current opcode with the IR flags</span></div>
<div class="line"><a name="l11961"></a><span class="lineno">11961</span>&#160;<span class="comment">  /// from \p ReductionOps, dropping nuw/nsw flags.</span></div>
<div class="line"><a name="l11962"></a><span class="lineno">11962</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *createOp(<a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830e">RecurKind</a> RdxKind, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>,</div>
<div class="line"><a name="l11963"></a><span class="lineno">11963</span>&#160;                         <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1Twine.html">Twine</a> &amp;Name,</div>
<div class="line"><a name="l11964"></a><span class="lineno">11964</span>&#160;                         <span class="keyword">const</span> ReductionOpsListType &amp;ReductionOps) {</div>
<div class="line"><a name="l11965"></a><span class="lineno">11965</span>&#160;    <span class="keywordtype">bool</span> UseSelect = ReductionOps.size() == 2 ||</div>
<div class="line"><a name="l11966"></a><span class="lineno">11966</span>&#160;                     <span class="comment">// Logical or/and.</span></div>
<div class="line"><a name="l11967"></a><span class="lineno">11967</span>&#160;                     (ReductionOps.size() == 1 &amp;&amp;</div>
<div class="line"><a name="l11968"></a><span class="lineno">11968</span>&#160;                      isa&lt;SelectInst&gt;(ReductionOps.front().front()));</div>
<div class="line"><a name="l11969"></a><span class="lineno">11969</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!UseSelect || ReductionOps.size() != 2 ||</div>
<div class="line"><a name="l11970"></a><span class="lineno">11970</span>&#160;            isa&lt;SelectInst&gt;(ReductionOps[1][0])) &amp;&amp;</div>
<div class="line"><a name="l11971"></a><span class="lineno">11971</span>&#160;           <span class="stringliteral">&quot;Expected cmp + select pairs for reduction&quot;</span>);</div>
<div class="line"><a name="l11972"></a><span class="lineno">11972</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = createOp(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, RdxKind, <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, Name, UseSelect);</div>
<div class="line"><a name="l11973"></a><span class="lineno">11973</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1RecurrenceDescriptor.html#aef4824e1c55ce3d04e8759c333dbc5c5">RecurrenceDescriptor::isIntMinMaxRecurrenceKind</a>(RdxKind)) {</div>
<div class="line"><a name="l11974"></a><span class="lineno">11974</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Sel = dyn_cast&lt;SelectInst&gt;(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>)) {</div>
<div class="line"><a name="l11975"></a><span class="lineno">11975</span>&#160;        <a class="code" href="namespacellvm.html#a9451ae71f535d06cd1d8ae642d76fc0d">propagateIRFlags</a>(Sel-&gt;getCondition(), ReductionOps[0], <span class="keyword">nullptr</span>,</div>
<div class="line"><a name="l11976"></a><span class="lineno">11976</span>&#160;                         <span class="comment">/*IncludeWrapFlags=*/</span><span class="keyword">false</span>);</div>
<div class="line"><a name="l11977"></a><span class="lineno">11977</span>&#160;        <a class="code" href="namespacellvm.html#a9451ae71f535d06cd1d8ae642d76fc0d">propagateIRFlags</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>, ReductionOps[1], <span class="keyword">nullptr</span>,</div>
<div class="line"><a name="l11978"></a><span class="lineno">11978</span>&#160;                         <span class="comment">/*IncludeWrapFlags=*/</span><span class="keyword">false</span>);</div>
<div class="line"><a name="l11979"></a><span class="lineno">11979</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>;</div>
<div class="line"><a name="l11980"></a><span class="lineno">11980</span>&#160;      }</div>
<div class="line"><a name="l11981"></a><span class="lineno">11981</span>&#160;    }</div>
<div class="line"><a name="l11982"></a><span class="lineno">11982</span>&#160;    <a class="code" href="namespacellvm.html#a9451ae71f535d06cd1d8ae642d76fc0d">propagateIRFlags</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>, ReductionOps[0], <span class="keyword">nullptr</span>, <span class="comment">/*IncludeWrapFlags=*/</span><span class="keyword">false</span>);</div>
<div class="line"><a name="l11983"></a><span class="lineno">11983</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>;</div>
<div class="line"><a name="l11984"></a><span class="lineno">11984</span>&#160;  }</div>
<div class="line"><a name="l11985"></a><span class="lineno">11985</span>&#160; </div>
<div class="line"><a name="l11986"></a><span class="lineno">11986</span>&#160;  <span class="keyword">static</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830e">RecurKind</a> getRdxKind(<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l11987"></a><span class="lineno">11987</span>&#160;    <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l11988"></a><span class="lineno">11988</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l11989"></a><span class="lineno">11989</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea6adf97f83acf6453d4a6a4b1070f3754">RecurKind::None</a>;</div>
<div class="line"><a name="l11990"></a><span class="lineno">11990</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#a944c25ac9b73b02a17a20a08a25b9b21">m_Add</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>())))</div>
<div class="line"><a name="l11991"></a><span class="lineno">11991</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">RecurKind::Add</a>;</div>
<div class="line"><a name="l11992"></a><span class="lineno">11992</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#a971522b36bf432ad69a0083581ab4108">m_Mul</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>())))</div>
<div class="line"><a name="l11993"></a><span class="lineno">11993</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea62b6d55816cf737bfc6f42e60df1a3f2">RecurKind::Mul</a>;</div>
<div class="line"><a name="l11994"></a><span class="lineno">11994</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#a427435d4da769ae680a8e77ef89520aa">m_And</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>())) ||</div>
<div class="line"><a name="l11995"></a><span class="lineno">11995</span>&#160;        <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#a213e6c0ca6e838157373b9a6018c0769">m_LogicalAnd</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>())))</div>
<div class="line"><a name="l11996"></a><span class="lineno">11996</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">RecurKind::And</a>;</div>
<div class="line"><a name="l11997"></a><span class="lineno">11997</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#a42569041ddafba7d40243e126af07f42">m_Or</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>())) ||</div>
<div class="line"><a name="l11998"></a><span class="lineno">11998</span>&#160;        <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#a1a06b1cff93069d7403ea03e6150e386">m_LogicalOr</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>())))</div>
<div class="line"><a name="l11999"></a><span class="lineno">11999</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea3a2d5fe857d8f9541136a124c2edec6c">RecurKind::Or</a>;</div>
<div class="line"><a name="l12000"></a><span class="lineno">12000</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#a82e2ea7f0ab67e33e22b3a2a188feaba">m_Xor</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>())))</div>
<div class="line"><a name="l12001"></a><span class="lineno">12001</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea76feb79109026728a20736a8c6504548">RecurKind::Xor</a>;</div>
<div class="line"><a name="l12002"></a><span class="lineno">12002</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#a5e3486337f60bed631149fb6b141bc3e">m_FAdd</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>())))</div>
<div class="line"><a name="l12003"></a><span class="lineno">12003</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eaf552e181879ad14956985859308d77d9">RecurKind::FAdd</a>;</div>
<div class="line"><a name="l12004"></a><span class="lineno">12004</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#a7aff89f4f22502c8ad9118bed59ce21c">m_FMul</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>())))</div>
<div class="line"><a name="l12005"></a><span class="lineno">12005</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eab48b2a9934af7a531cfd7236ded9d50e">RecurKind::FMul</a>;</div>
<div class="line"><a name="l12006"></a><span class="lineno">12006</span>&#160; </div>
<div class="line"><a name="l12007"></a><span class="lineno">12007</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, m_Intrinsic&lt;Intrinsic::maxnum&gt;(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>())))</div>
<div class="line"><a name="l12008"></a><span class="lineno">12008</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea8764eae15a1f2cf1c964d14dcf9283ee">RecurKind::FMax</a>;</div>
<div class="line"><a name="l12009"></a><span class="lineno">12009</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, m_Intrinsic&lt;Intrinsic::minnum&gt;(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>())))</div>
<div class="line"><a name="l12010"></a><span class="lineno">12010</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ead76b595f89852f41ac50173abae6da05">RecurKind::FMin</a>;</div>
<div class="line"><a name="l12011"></a><span class="lineno">12011</span>&#160; </div>
<div class="line"><a name="l12012"></a><span class="lineno">12012</span>&#160;    <span class="comment">// This matches either cmp+select or intrinsics. SLP is expected to handle</span></div>
<div class="line"><a name="l12013"></a><span class="lineno">12013</span>&#160;    <span class="comment">// either form.</span></div>
<div class="line"><a name="l12014"></a><span class="lineno">12014</span>&#160;    <span class="comment">// TODO: If we are canonicalizing to intrinsics, we can remove several</span></div>
<div class="line"><a name="l12015"></a><span class="lineno">12015</span>&#160;    <span class="comment">//       special-case paths that deal with selects.</span></div>
<div class="line"><a name="l12016"></a><span class="lineno">12016</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#a38a6a25e425f94c9836dda96f3718593">m_SMax</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>())))</div>
<div class="line"><a name="l12017"></a><span class="lineno">12017</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eabccd0de85dfbe7aef83629b318a4df6e">RecurKind::SMax</a>;</div>
<div class="line"><a name="l12018"></a><span class="lineno">12018</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#af16a6c9336ca2a17389ea709b45fe7f5">m_SMin</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>())))</div>
<div class="line"><a name="l12019"></a><span class="lineno">12019</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ead6bb6a2eca7d60c75e349ea45e138d74">RecurKind::SMin</a>;</div>
<div class="line"><a name="l12020"></a><span class="lineno">12020</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#ae5a9f5c71425f38b8874296c380567ad">m_UMax</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>())))</div>
<div class="line"><a name="l12021"></a><span class="lineno">12021</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eafaa1f94cd925672925f691e7f5727a6b">RecurKind::UMax</a>;</div>
<div class="line"><a name="l12022"></a><span class="lineno">12022</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#adc571425e9aecccf7ebf5fcc3c678d94">m_UMin</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>())))</div>
<div class="line"><a name="l12023"></a><span class="lineno">12023</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea1c692ed4bf463fb08fca4d8cb8201ac0">RecurKind::UMin</a>;</div>
<div class="line"><a name="l12024"></a><span class="lineno">12024</span>&#160; </div>
<div class="line"><a name="l12025"></a><span class="lineno">12025</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a> = dyn_cast&lt;SelectInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l12026"></a><span class="lineno">12026</span>&#160;      <span class="comment">// Try harder: look for min/max pattern based on instructions producing</span></div>
<div class="line"><a name="l12027"></a><span class="lineno">12027</span>&#160;      <span class="comment">// same values such as: select ((cmp Inst1, Inst2), Inst1, Inst2).</span></div>
<div class="line"><a name="l12028"></a><span class="lineno">12028</span>&#160;      <span class="comment">// During the intermediate stages of SLP, it&#39;s very common to have</span></div>
<div class="line"><a name="l12029"></a><span class="lineno">12029</span>&#160;      <span class="comment">// pattern like this (since optimizeGatherSequence is run only once</span></div>
<div class="line"><a name="l12030"></a><span class="lineno">12030</span>&#160;      <span class="comment">// at the end):</span></div>
<div class="line"><a name="l12031"></a><span class="lineno">12031</span>&#160;      <span class="comment">// %1 = extractelement &lt;2 x i32&gt; %a, i32 0</span></div>
<div class="line"><a name="l12032"></a><span class="lineno">12032</span>&#160;      <span class="comment">// %2 = extractelement &lt;2 x i32&gt; %a, i32 1</span></div>
<div class="line"><a name="l12033"></a><span class="lineno">12033</span>&#160;      <span class="comment">// %cond = icmp sgt i32 %1, %2</span></div>
<div class="line"><a name="l12034"></a><span class="lineno">12034</span>&#160;      <span class="comment">// %3 = extractelement &lt;2 x i32&gt; %a, i32 0</span></div>
<div class="line"><a name="l12035"></a><span class="lineno">12035</span>&#160;      <span class="comment">// %4 = extractelement &lt;2 x i32&gt; %a, i32 1</span></div>
<div class="line"><a name="l12036"></a><span class="lineno">12036</span>&#160;      <span class="comment">// %select = select i1 %cond, i32 %3, i32 %4</span></div>
<div class="line"><a name="l12037"></a><span class="lineno">12037</span>&#160;      <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> Pred;</div>
<div class="line"><a name="l12038"></a><span class="lineno">12038</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *L1;</div>
<div class="line"><a name="l12039"></a><span class="lineno">12039</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="lib_2Target_2ARM_2README_8txt.html#adefbb946b174533d5eb8db503b1f4ffa">L2</a>;</div>
<div class="line"><a name="l12040"></a><span class="lineno">12040</span>&#160; </div>
<div class="line"><a name="l12041"></a><span class="lineno">12041</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = <a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a>-&gt;getTrueValue();</div>
<div class="line"><a name="l12042"></a><span class="lineno">12042</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = <a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a>-&gt;getFalseValue();</div>
<div class="line"><a name="l12043"></a><span class="lineno">12043</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a> = <a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a>-&gt;getCondition();</div>
<div class="line"><a name="l12044"></a><span class="lineno">12044</span>&#160; </div>
<div class="line"><a name="l12045"></a><span class="lineno">12045</span>&#160;      <span class="comment">// TODO: Support inverse predicates.</span></div>
<div class="line"><a name="l12046"></a><span class="lineno">12046</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#a753e1338645ec04d045211b8a46d968d">m_Cmp</a>(Pred, <a class="code" href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">m_Specific</a>(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#a04353aa48874f9bda89ff9059cd1a5a6">m_Instruction</a>(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#adefbb946b174533d5eb8db503b1f4ffa">L2</a>)))) {</div>
<div class="line"><a name="l12047"></a><span class="lineno">12047</span>&#160;        <span class="keywordflow">if</span> (!isa&lt;ExtractElementInst&gt;(<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) ||</div>
<div class="line"><a name="l12048"></a><span class="lineno">12048</span>&#160;            !<a class="code" href="lib_2Target_2ARM_2README_8txt.html#adefbb946b174533d5eb8db503b1f4ffa">L2</a>-&gt;isIdenticalTo(cast&lt;Instruction&gt;(<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>)))</div>
<div class="line"><a name="l12049"></a><span class="lineno">12049</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea6adf97f83acf6453d4a6a4b1070f3754">RecurKind::None</a>;</div>
<div class="line"><a name="l12050"></a><span class="lineno">12050</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#a753e1338645ec04d045211b8a46d968d">m_Cmp</a>(Pred, <a class="code" href="namespacellvm_1_1PatternMatch.html#a04353aa48874f9bda89ff9059cd1a5a6">m_Instruction</a>(L1), <a class="code" href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">m_Specific</a>(<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>)))) {</div>
<div class="line"><a name="l12051"></a><span class="lineno">12051</span>&#160;        <span class="keywordflow">if</span> (!isa&lt;ExtractElementInst&gt;(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>) ||</div>
<div class="line"><a name="l12052"></a><span class="lineno">12052</span>&#160;            !L1-&gt;<a class="code" href="classllvm_1_1Instruction.html#ad848bd0184fc7bcb7b71e19248f08f34">isIdenticalTo</a>(cast&lt;Instruction&gt;(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>)))</div>
<div class="line"><a name="l12053"></a><span class="lineno">12053</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea6adf97f83acf6453d4a6a4b1070f3754">RecurKind::None</a>;</div>
<div class="line"><a name="l12054"></a><span class="lineno">12054</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l12055"></a><span class="lineno">12055</span>&#160;        <span class="keywordflow">if</span> (!isa&lt;ExtractElementInst&gt;(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>) || !isa&lt;ExtractElementInst&gt;(<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>))</div>
<div class="line"><a name="l12056"></a><span class="lineno">12056</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea6adf97f83acf6453d4a6a4b1070f3754">RecurKind::None</a>;</div>
<div class="line"><a name="l12057"></a><span class="lineno">12057</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#a753e1338645ec04d045211b8a46d968d">m_Cmp</a>(Pred, <a class="code" href="namespacellvm_1_1PatternMatch.html#a04353aa48874f9bda89ff9059cd1a5a6">m_Instruction</a>(L1), <a class="code" href="namespacellvm_1_1PatternMatch.html#a04353aa48874f9bda89ff9059cd1a5a6">m_Instruction</a>(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#adefbb946b174533d5eb8db503b1f4ffa">L2</a>))) ||</div>
<div class="line"><a name="l12058"></a><span class="lineno">12058</span>&#160;            !L1-&gt;<a class="code" href="classllvm_1_1Instruction.html#ad848bd0184fc7bcb7b71e19248f08f34">isIdenticalTo</a>(cast&lt;Instruction&gt;(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>)) ||</div>
<div class="line"><a name="l12059"></a><span class="lineno">12059</span>&#160;            !<a class="code" href="lib_2Target_2ARM_2README_8txt.html#adefbb946b174533d5eb8db503b1f4ffa">L2</a>-&gt;isIdenticalTo(cast&lt;Instruction&gt;(<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>)))</div>
<div class="line"><a name="l12060"></a><span class="lineno">12060</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea6adf97f83acf6453d4a6a4b1070f3754">RecurKind::None</a>;</div>
<div class="line"><a name="l12061"></a><span class="lineno">12061</span>&#160;      }</div>
<div class="line"><a name="l12062"></a><span class="lineno">12062</span>&#160; </div>
<div class="line"><a name="l12063"></a><span class="lineno">12063</span>&#160;      <span class="keywordflow">switch</span> (Pred) {</div>
<div class="line"><a name="l12064"></a><span class="lineno">12064</span>&#160;      <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l12065"></a><span class="lineno">12065</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea6adf97f83acf6453d4a6a4b1070f3754">RecurKind::None</a>;</div>
<div class="line"><a name="l12066"></a><span class="lineno">12066</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba720a42e85f7e981afd61e28473b0000a">CmpInst::ICMP_SGT</a>:</div>
<div class="line"><a name="l12067"></a><span class="lineno">12067</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78bac1aa7b798ba11d2e497d5cce6ce6d3dc">CmpInst::ICMP_SGE</a>:</div>
<div class="line"><a name="l12068"></a><span class="lineno">12068</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eabccd0de85dfbe7aef83629b318a4df6e">RecurKind::SMax</a>;</div>
<div class="line"><a name="l12069"></a><span class="lineno">12069</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba15ae464950ac676919c2f0c7aafc706c">CmpInst::ICMP_SLT</a>:</div>
<div class="line"><a name="l12070"></a><span class="lineno">12070</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba2751d6136a2819749dcef65dc19a4246">CmpInst::ICMP_SLE</a>:</div>
<div class="line"><a name="l12071"></a><span class="lineno">12071</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ead6bb6a2eca7d60c75e349ea45e138d74">RecurKind::SMin</a>;</div>
<div class="line"><a name="l12072"></a><span class="lineno">12072</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba607cecdc5172814382033e001ed11fad">CmpInst::ICMP_UGT</a>:</div>
<div class="line"><a name="l12073"></a><span class="lineno">12073</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba573bcd571c938fce863525330bbfc4b8">CmpInst::ICMP_UGE</a>:</div>
<div class="line"><a name="l12074"></a><span class="lineno">12074</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eafaa1f94cd925672925f691e7f5727a6b">RecurKind::UMax</a>;</div>
<div class="line"><a name="l12075"></a><span class="lineno">12075</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">CmpInst::ICMP_ULT</a>:</div>
<div class="line"><a name="l12076"></a><span class="lineno">12076</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78bad92f160316221fd4090520bb2b3cefc5">CmpInst::ICMP_ULE</a>:</div>
<div class="line"><a name="l12077"></a><span class="lineno">12077</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea1c692ed4bf463fb08fca4d8cb8201ac0">RecurKind::UMin</a>;</div>
<div class="line"><a name="l12078"></a><span class="lineno">12078</span>&#160;      }</div>
<div class="line"><a name="l12079"></a><span class="lineno">12079</span>&#160;    }</div>
<div class="line"><a name="l12080"></a><span class="lineno">12080</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea6adf97f83acf6453d4a6a4b1070f3754">RecurKind::None</a>;</div>
<div class="line"><a name="l12081"></a><span class="lineno">12081</span>&#160;  }</div>
<div class="line"><a name="l12082"></a><span class="lineno">12082</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l12083"></a><span class="lineno">12083</span>&#160;<span class="comment">  /// Get the index of the first operand.</span></div>
<div class="line"><a name="l12084"></a><span class="lineno">12084</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> <span class="keywordtype">unsigned</span> getFirstOperandIndex(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l12085"></a><span class="lineno">12085</span>&#160;    <span class="keywordflow">return</span> isCmpSelMinMax(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ? 1 : 0;</div>
<div class="line"><a name="l12086"></a><span class="lineno">12086</span>&#160;  }</div>
<div class="line"><a name="l12087"></a><span class="lineno">12087</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l12088"></a><span class="lineno">12088</span>&#160;<span class="comment">  /// Total number of operands in the reduction operation.</span></div>
<div class="line"><a name="l12089"></a><span class="lineno">12089</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> <span class="keywordtype">unsigned</span> getNumberOfOperands(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l12090"></a><span class="lineno">12090</span>&#160;    <span class="keywordflow">return</span> isCmpSelMinMax(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ? 3 : 2;</div>
<div class="line"><a name="l12091"></a><span class="lineno">12091</span>&#160;  }</div>
<div class="line"><a name="l12092"></a><span class="lineno">12092</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l12093"></a><span class="lineno">12093</span>&#160;<span class="comment">  /// Checks if the instruction is in basic block \p BB.</span></div>
<div class="line"><a name="l12094"></a><span class="lineno">12094</span>&#160;<span class="comment">  /// For a cmp+sel min/max reduction check that both ops are in \p BB.</span></div>
<div class="line"><a name="l12095"></a><span class="lineno">12095</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> <span class="keywordtype">bool</span> hasSameParent(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l12096"></a><span class="lineno">12096</span>&#160;    <span class="keywordflow">if</span> (isCmpSelMinMax(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || isBoolLogicOp(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l12097"></a><span class="lineno">12097</span>&#160;      <span class="keyword">auto</span> *Sel = cast&lt;SelectInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l12098"></a><span class="lineno">12098</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a> = dyn_cast&lt;Instruction&gt;(Sel-&gt;getCondition());</div>
<div class="line"><a name="l12099"></a><span class="lineno">12099</span>&#160;      <span class="keywordflow">return</span> Sel-&gt;getParent() == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> &amp;&amp; <a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a> &amp;&amp; <a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getParent() == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>;</div>
<div class="line"><a name="l12100"></a><span class="lineno">12100</span>&#160;    }</div>
<div class="line"><a name="l12101"></a><span class="lineno">12101</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>;</div>
<div class="line"><a name="l12102"></a><span class="lineno">12102</span>&#160;  }</div>
<div class="line"><a name="l12103"></a><span class="lineno">12103</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l12104"></a><span class="lineno">12104</span>&#160;<span class="comment">  /// Expected number of uses for reduction operations/reduced values.</span></div>
<div class="line"><a name="l12105"></a><span class="lineno">12105</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> <span class="keywordtype">bool</span> hasRequiredNumberOfUses(<span class="keywordtype">bool</span> IsCmpSelMinMax, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l12106"></a><span class="lineno">12106</span>&#160;    <span class="keywordflow">if</span> (IsCmpSelMinMax) {</div>
<div class="line"><a name="l12107"></a><span class="lineno">12107</span>&#160;      <span class="comment">// SelectInst must be used twice while the condition op must have single</span></div>
<div class="line"><a name="l12108"></a><span class="lineno">12108</span>&#160;      <span class="comment">// use only.</span></div>
<div class="line"><a name="l12109"></a><span class="lineno">12109</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Sel = dyn_cast&lt;SelectInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l12110"></a><span class="lineno">12110</span>&#160;        <span class="keywordflow">return</span> Sel-&gt;hasNUses(2) &amp;&amp; Sel-&gt;getCondition()-&gt;hasOneUse();</div>
<div class="line"><a name="l12111"></a><span class="lineno">12111</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasNUses(2);</div>
<div class="line"><a name="l12112"></a><span class="lineno">12112</span>&#160;    }</div>
<div class="line"><a name="l12113"></a><span class="lineno">12113</span>&#160; </div>
<div class="line"><a name="l12114"></a><span class="lineno">12114</span>&#160;    <span class="comment">// Arithmetic reduction operation must be used once only.</span></div>
<div class="line"><a name="l12115"></a><span class="lineno">12115</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUse();</div>
<div class="line"><a name="l12116"></a><span class="lineno">12116</span>&#160;  }</div>
<div class="line"><a name="l12117"></a><span class="lineno">12117</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l12118"></a><span class="lineno">12118</span>&#160;<span class="comment">  /// Initializes the list of reduction operations.</span></div>
<div class="line"><a name="l12119"></a><span class="lineno">12119</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> initReductionOps(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l12120"></a><span class="lineno">12120</span>&#160;    <span class="keywordflow">if</span> (isCmpSelMinMax(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l12121"></a><span class="lineno">12121</span>&#160;      ReductionOps.assign(2, ReductionOpsType());</div>
<div class="line"><a name="l12122"></a><span class="lineno">12122</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l12123"></a><span class="lineno">12123</span>&#160;      ReductionOps.assign(1, ReductionOpsType());</div>
<div class="line"><a name="l12124"></a><span class="lineno">12124</span>&#160;  }</div>
<div class="line"><a name="l12125"></a><span class="lineno">12125</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l12126"></a><span class="lineno">12126</span>&#160;<span class="comment">  /// Add all reduction operations for the reduction instruction \p I.</span></div>
<div class="line"><a name="l12127"></a><span class="lineno">12127</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> addReductionOps(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l12128"></a><span class="lineno">12128</span>&#160;    <span class="keywordflow">if</span> (isCmpSelMinMax(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l12129"></a><span class="lineno">12129</span>&#160;      ReductionOps[0].emplace_back(cast&lt;SelectInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getCondition());</div>
<div class="line"><a name="l12130"></a><span class="lineno">12130</span>&#160;      ReductionOps[1].emplace_back(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l12131"></a><span class="lineno">12131</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l12132"></a><span class="lineno">12132</span>&#160;      ReductionOps[0].emplace_back(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l12133"></a><span class="lineno">12133</span>&#160;    }</div>
<div class="line"><a name="l12134"></a><span class="lineno">12134</span>&#160;  }</div>
<div class="line"><a name="l12135"></a><span class="lineno">12135</span>&#160; </div>
<div class="line"><a name="l12136"></a><span class="lineno">12136</span>&#160;  <span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *getLHS(<a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830e">RecurKind</a> Kind, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l12137"></a><span class="lineno">12137</span>&#160;    <span class="keywordflow">if</span> (Kind == <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea6adf97f83acf6453d4a6a4b1070f3754">RecurKind::None</a>)</div>
<div class="line"><a name="l12138"></a><span class="lineno">12138</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l12139"></a><span class="lineno">12139</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(getFirstOperandIndex(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</div>
<div class="line"><a name="l12140"></a><span class="lineno">12140</span>&#160;  }</div>
<div class="line"><a name="l12141"></a><span class="lineno">12141</span>&#160;  <span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *getRHS(<a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830e">RecurKind</a> Kind, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l12142"></a><span class="lineno">12142</span>&#160;    <span class="keywordflow">if</span> (Kind == <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea6adf97f83acf6453d4a6a4b1070f3754">RecurKind::None</a>)</div>
<div class="line"><a name="l12143"></a><span class="lineno">12143</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l12144"></a><span class="lineno">12144</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(getFirstOperandIndex(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) + 1);</div>
<div class="line"><a name="l12145"></a><span class="lineno">12145</span>&#160;  }</div>
<div class="line"><a name="l12146"></a><span class="lineno">12146</span>&#160; </div>
<div class="line"><a name="l12147"></a><span class="lineno">12147</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">bool</span> isGoodForReduction(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> Data) {</div>
<div class="line"><a name="l12148"></a><span class="lineno">12148</span>&#160;    <span class="keywordtype">int</span> Sz = <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.size();</div>
<div class="line"><a name="l12149"></a><span class="lineno">12149</span>&#160;    <span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.front());</div>
<div class="line"><a name="l12150"></a><span class="lineno">12150</span>&#160;    <span class="keywordflow">return</span> Sz &gt; 1 || <a class="code" href="SLPVectorizer_8cpp.html#a6848b7e929178610d01e1b2b5052af86">isConstant</a>(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.front()) ||</div>
<div class="line"><a name="l12151"></a><span class="lineno">12151</span>&#160;           (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp; !isa&lt;LoadInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; <a class="code" href="SLPVectorizer_8cpp.html#a8f3292dcaad99569501ace7909f2ccf0">isValidForAlternation</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()));</div>
<div class="line"><a name="l12152"></a><span class="lineno">12152</span>&#160;  }</div>
<div class="line"><a name="l12153"></a><span class="lineno">12153</span>&#160; </div>
<div class="line"><a name="l12154"></a><span class="lineno">12154</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l12155"></a><span class="lineno">12155</span>&#160;  <a class="code" href="namespacellvm_1_1ARMII.html#a7d414894ef8cdc39b147eb7e0d7e4305a9e2a02c8e15c43cfe03fee48f85f76cf">HorizontalReduction</a>() = <span class="keywordflow">default</span>;</div>
<div class="line"><a name="l12156"></a><span class="lineno">12156</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l12157"></a><span class="lineno">12157</span>&#160;<span class="comment">  /// Try to find a reduction tree.</span></div>
<div class="line"><a name="l12158"></a><span class="lineno">12158</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> matchAssociativeReduction(<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *Phi, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst,</div>
<div class="line"><a name="l12159"></a><span class="lineno">12159</span>&#160;                                 <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</div>
<div class="line"><a name="l12160"></a><span class="lineno">12160</span>&#160;                                 <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> &amp;TLI) {</div>
<div class="line"><a name="l12161"></a><span class="lineno">12161</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!Phi || <a class="code" href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">is_contained</a>(Phi-&gt;<a class="code" href="classllvm_1_1User.html#a0b931781aa589c6ebe64a76c1447e5b2">operands</a>(), Inst)) &amp;&amp;</div>
<div class="line"><a name="l12162"></a><span class="lineno">12162</span>&#160;           <span class="stringliteral">&quot;Phi needs to use the binary operator&quot;</span>);</div>
<div class="line"><a name="l12163"></a><span class="lineno">12163</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((isa&lt;BinaryOperator&gt;(Inst) || isa&lt;SelectInst&gt;(Inst) ||</div>
<div class="line"><a name="l12164"></a><span class="lineno">12164</span>&#160;            isa&lt;IntrinsicInst&gt;(Inst)) &amp;&amp;</div>
<div class="line"><a name="l12165"></a><span class="lineno">12165</span>&#160;           <span class="stringliteral">&quot;Expected binop, select, or intrinsic for reduction matching&quot;</span>);</div>
<div class="line"><a name="l12166"></a><span class="lineno">12166</span>&#160;    RdxKind = getRdxKind(Inst);</div>
<div class="line"><a name="l12167"></a><span class="lineno">12167</span>&#160; </div>
<div class="line"><a name="l12168"></a><span class="lineno">12168</span>&#160;    <span class="comment">// We could have a initial reductions that is not an add.</span></div>
<div class="line"><a name="l12169"></a><span class="lineno">12169</span>&#160;    <span class="comment">//  r *= v1 + v2 + v3 + v4</span></div>
<div class="line"><a name="l12170"></a><span class="lineno">12170</span>&#160;    <span class="comment">// In such a case start looking for a tree rooted in the first &#39;+&#39;.</span></div>
<div class="line"><a name="l12171"></a><span class="lineno">12171</span>&#160;    <span class="keywordflow">if</span> (Phi) {</div>
<div class="line"><a name="l12172"></a><span class="lineno">12172</span>&#160;      <span class="keywordflow">if</span> (getLHS(RdxKind, Inst) == Phi) {</div>
<div class="line"><a name="l12173"></a><span class="lineno">12173</span>&#160;        Phi = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l12174"></a><span class="lineno">12174</span>&#160;        Inst = dyn_cast&lt;Instruction&gt;(getRHS(RdxKind, Inst));</div>
<div class="line"><a name="l12175"></a><span class="lineno">12175</span>&#160;        <span class="keywordflow">if</span> (!Inst)</div>
<div class="line"><a name="l12176"></a><span class="lineno">12176</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l12177"></a><span class="lineno">12177</span>&#160;        RdxKind = getRdxKind(Inst);</div>
<div class="line"><a name="l12178"></a><span class="lineno">12178</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (getRHS(RdxKind, Inst) == Phi) {</div>
<div class="line"><a name="l12179"></a><span class="lineno">12179</span>&#160;        Phi = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l12180"></a><span class="lineno">12180</span>&#160;        Inst = dyn_cast&lt;Instruction&gt;(getLHS(RdxKind, Inst));</div>
<div class="line"><a name="l12181"></a><span class="lineno">12181</span>&#160;        <span class="keywordflow">if</span> (!Inst)</div>
<div class="line"><a name="l12182"></a><span class="lineno">12182</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l12183"></a><span class="lineno">12183</span>&#160;        RdxKind = getRdxKind(Inst);</div>
<div class="line"><a name="l12184"></a><span class="lineno">12184</span>&#160;      }</div>
<div class="line"><a name="l12185"></a><span class="lineno">12185</span>&#160;    }</div>
<div class="line"><a name="l12186"></a><span class="lineno">12186</span>&#160; </div>
<div class="line"><a name="l12187"></a><span class="lineno">12187</span>&#160;    <span class="keywordflow">if</span> (!isVectorizable(RdxKind, Inst))</div>
<div class="line"><a name="l12188"></a><span class="lineno">12188</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l12189"></a><span class="lineno">12189</span>&#160; </div>
<div class="line"><a name="l12190"></a><span class="lineno">12190</span>&#160;    <span class="comment">// Analyze &quot;regular&quot; integer/FP types for reductions - no target-specific</span></div>
<div class="line"><a name="l12191"></a><span class="lineno">12191</span>&#160;    <span class="comment">// types or pointers.</span></div>
<div class="line"><a name="l12192"></a><span class="lineno">12192</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty = Inst-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l12193"></a><span class="lineno">12193</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="SLPVectorizer_8cpp.html#aa3ea54a95743867473d32853d3c65603">isValidElementType</a>(Ty) || Ty-&gt;<a class="code" href="classllvm_1_1Type.html#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>())</div>
<div class="line"><a name="l12194"></a><span class="lineno">12194</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l12195"></a><span class="lineno">12195</span>&#160; </div>
<div class="line"><a name="l12196"></a><span class="lineno">12196</span>&#160;    <span class="comment">// Though the ultimate reduction may have multiple uses, its condition must</span></div>
<div class="line"><a name="l12197"></a><span class="lineno">12197</span>&#160;    <span class="comment">// have only single use.</span></div>
<div class="line"><a name="l12198"></a><span class="lineno">12198</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Sel = dyn_cast&lt;SelectInst&gt;(Inst))</div>
<div class="line"><a name="l12199"></a><span class="lineno">12199</span>&#160;      <span class="keywordflow">if</span> (!Sel-&gt;getCondition()-&gt;hasOneUse())</div>
<div class="line"><a name="l12200"></a><span class="lineno">12200</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l12201"></a><span class="lineno">12201</span>&#160; </div>
<div class="line"><a name="l12202"></a><span class="lineno">12202</span>&#160;    ReductionRoot = Inst;</div>
<div class="line"><a name="l12203"></a><span class="lineno">12203</span>&#160; </div>
<div class="line"><a name="l12204"></a><span class="lineno">12204</span>&#160;    <span class="comment">// Iterate through all the operands of the possible reduction tree and</span></div>
<div class="line"><a name="l12205"></a><span class="lineno">12205</span>&#160;    <span class="comment">// gather all the reduced values, sorting them by their value id.</span></div>
<div class="line"><a name="l12206"></a><span class="lineno">12206</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l12207"></a><span class="lineno">12207</span>&#160;    <span class="keywordtype">bool</span> IsCmpSelMinMax = isCmpSelMinMax(Inst);</div>
<div class="line"><a name="l12208"></a><span class="lineno">12208</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *&gt;</a> Worklist(1, Inst);</div>
<div class="line"><a name="l12209"></a><span class="lineno">12209</span>&#160;    <span class="comment">// Checks if the operands of the \p TreeN instruction are also reduction</span></div>
<div class="line"><a name="l12210"></a><span class="lineno">12210</span>&#160;    <span class="comment">// operations or should be treated as reduced values or an extra argument,</span></div>
<div class="line"><a name="l12211"></a><span class="lineno">12211</span>&#160;    <span class="comment">// which is not part of the reduction.</span></div>
<div class="line"><a name="l12212"></a><span class="lineno">12212</span>&#160;    <span class="keyword">auto</span> &amp;&amp;CheckOperands = [<span class="keyword">this</span>, IsCmpSelMinMax,</div>
<div class="line"><a name="l12213"></a><span class="lineno">12213</span>&#160;                            <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>](<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TreeN,</div>
<div class="line"><a name="l12214"></a><span class="lineno">12214</span>&#160;                                <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Value *&gt;</a> &amp;ExtraArgs,</div>
<div class="line"><a name="l12215"></a><span class="lineno">12215</span>&#160;                                <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Value *&gt;</a> &amp;PossibleReducedVals,</div>
<div class="line"><a name="l12216"></a><span class="lineno">12216</span>&#160;                                <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;ReductionOps) {</div>
<div class="line"><a name="l12217"></a><span class="lineno">12217</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = getFirstOperandIndex(TreeN),</div>
<div class="line"><a name="l12218"></a><span class="lineno">12218</span>&#160;               End = getNumberOfOperands(TreeN);</div>
<div class="line"><a name="l12219"></a><span class="lineno">12219</span>&#160;           <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; End; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l12220"></a><span class="lineno">12220</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *EdgeVal = getRdxOperand(TreeN, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l12221"></a><span class="lineno">12221</span>&#160;        ReducedValsToOps[EdgeVal].push_back(TreeN);</div>
<div class="line"><a name="l12222"></a><span class="lineno">12222</span>&#160;        <span class="keyword">auto</span> *EdgeInst = dyn_cast&lt;Instruction&gt;(EdgeVal);</div>
<div class="line"><a name="l12223"></a><span class="lineno">12223</span>&#160;        <span class="comment">// Edge has wrong parent - mark as an extra argument.</span></div>
<div class="line"><a name="l12224"></a><span class="lineno">12224</span>&#160;        <span class="keywordflow">if</span> (EdgeInst &amp;&amp; !<a class="code" href="SLPVectorizer_8cpp.html#a06a9edb69d0ed6fda201d59948acfd89">isVectorLikeInstWithConstOps</a>(EdgeInst) &amp;&amp;</div>
<div class="line"><a name="l12225"></a><span class="lineno">12225</span>&#160;            !hasSameParent(EdgeInst, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)) {</div>
<div class="line"><a name="l12226"></a><span class="lineno">12226</span>&#160;          ExtraArgs.push_back(EdgeVal);</div>
<div class="line"><a name="l12227"></a><span class="lineno">12227</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l12228"></a><span class="lineno">12228</span>&#160;        }</div>
<div class="line"><a name="l12229"></a><span class="lineno">12229</span>&#160;        <span class="comment">// If the edge is not an instruction, or it is different from the main</span></div>
<div class="line"><a name="l12230"></a><span class="lineno">12230</span>&#160;        <span class="comment">// reduction opcode or has too many uses - possible reduced value.</span></div>
<div class="line"><a name="l12231"></a><span class="lineno">12231</span>&#160;        <span class="keywordflow">if</span> (!EdgeInst || getRdxKind(EdgeInst) != RdxKind ||</div>
<div class="line"><a name="l12232"></a><span class="lineno">12232</span>&#160;            IsCmpSelMinMax != isCmpSelMinMax(EdgeInst) ||</div>
<div class="line"><a name="l12233"></a><span class="lineno">12233</span>&#160;            !hasRequiredNumberOfUses(IsCmpSelMinMax, EdgeInst) ||</div>
<div class="line"><a name="l12234"></a><span class="lineno">12234</span>&#160;            !isVectorizable(getRdxKind(EdgeInst), EdgeInst)) {</div>
<div class="line"><a name="l12235"></a><span class="lineno">12235</span>&#160;          PossibleReducedVals.push_back(EdgeVal);</div>
<div class="line"><a name="l12236"></a><span class="lineno">12236</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l12237"></a><span class="lineno">12237</span>&#160;        }</div>
<div class="line"><a name="l12238"></a><span class="lineno">12238</span>&#160;        ReductionOps.push_back(EdgeInst);</div>
<div class="line"><a name="l12239"></a><span class="lineno">12239</span>&#160;      }</div>
<div class="line"><a name="l12240"></a><span class="lineno">12240</span>&#160;    };</div>
<div class="line"><a name="l12241"></a><span class="lineno">12241</span>&#160;    <span class="comment">// Try to regroup reduced values so that it gets more profitable to try to</span></div>
<div class="line"><a name="l12242"></a><span class="lineno">12242</span>&#160;    <span class="comment">// reduce them. Values are grouped by their value ids, instructions - by</span></div>
<div class="line"><a name="l12243"></a><span class="lineno">12243</span>&#160;    <span class="comment">// instruction op id and/or alternate op id, plus do extra analysis for</span></div>
<div class="line"><a name="l12244"></a><span class="lineno">12244</span>&#160;    <span class="comment">// loads (grouping them by the distabce between pointers) and cmp</span></div>
<div class="line"><a name="l12245"></a><span class="lineno">12245</span>&#160;    <span class="comment">// instructions (grouping them by the predicate).</span></div>
<div class="line"><a name="l12246"></a><span class="lineno">12246</span>&#160;    <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;size_t, MapVector&lt;size_t, MapVector&lt;Value *, unsigned&gt;</a>&gt;&gt;</div>
<div class="line"><a name="l12247"></a><span class="lineno">12247</span>&#160;        PossibleReducedVals;</div>
<div class="line"><a name="l12248"></a><span class="lineno">12248</span>&#160;    initReductionOps(Inst);</div>
<div class="line"><a name="l12249"></a><span class="lineno">12249</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, SmallVector&lt;LoadInst *&gt;</a>&gt; LoadsMap;</div>
<div class="line"><a name="l12250"></a><span class="lineno">12250</span>&#160;    <a class="code" href="classllvm_1_1SmallSet.html">SmallSet&lt;size_t, 2&gt;</a> LoadKeyUsed;</div>
<div class="line"><a name="l12251"></a><span class="lineno">12251</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value *, 4&gt;</a> DoNotReverseVals;</div>
<div class="line"><a name="l12252"></a><span class="lineno">12252</span>&#160;    <span class="keywordflow">while</span> (!Worklist.empty()) {</div>
<div class="line"><a name="l12253"></a><span class="lineno">12253</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TreeN = Worklist.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a0c8ffe664a36e30d49c84d0aded2fe08">pop_back_val</a>();</div>
<div class="line"><a name="l12254"></a><span class="lineno">12254</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *&gt;</a> <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>;</div>
<div class="line"><a name="l12255"></a><span class="lineno">12255</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *&gt;</a> PossibleRedVals;</div>
<div class="line"><a name="l12256"></a><span class="lineno">12256</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *&gt;</a> PossibleReductionOps;</div>
<div class="line"><a name="l12257"></a><span class="lineno">12257</span>&#160;      CheckOperands(TreeN, <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>, PossibleRedVals, PossibleReductionOps);</div>
<div class="line"><a name="l12258"></a><span class="lineno">12258</span>&#160;      <span class="comment">// If too many extra args - mark the instruction itself as a reduction</span></div>
<div class="line"><a name="l12259"></a><span class="lineno">12259</span>&#160;      <span class="comment">// value, not a reduction operation.</span></div>
<div class="line"><a name="l12260"></a><span class="lineno">12260</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>.size() &lt; 2) {</div>
<div class="line"><a name="l12261"></a><span class="lineno">12261</span>&#160;        addReductionOps(TreeN);</div>
<div class="line"><a name="l12262"></a><span class="lineno">12262</span>&#160;        <span class="comment">// Add extra args.</span></div>
<div class="line"><a name="l12263"></a><span class="lineno">12263</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>.empty()) {</div>
<div class="line"><a name="l12264"></a><span class="lineno">12264</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>.size() == 1 &amp;&amp; <span class="stringliteral">&quot;Expected only single argument.&quot;</span>);</div>
<div class="line"><a name="l12265"></a><span class="lineno">12265</span>&#160;          ExtraArgs[TreeN] = <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>.front();</div>
<div class="line"><a name="l12266"></a><span class="lineno">12266</span>&#160;        }</div>
<div class="line"><a name="l12267"></a><span class="lineno">12267</span>&#160;        <span class="comment">// Add reduction values. The values are sorted for better vectorization</span></div>
<div class="line"><a name="l12268"></a><span class="lineno">12268</span>&#160;        <span class="comment">// results.</span></div>
<div class="line"><a name="l12269"></a><span class="lineno">12269</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : PossibleRedVals) {</div>
<div class="line"><a name="l12270"></a><span class="lineno">12270</span>&#160;          <span class="keywordtype">size_t</span> <a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>, Idx;</div>
<div class="line"><a name="l12271"></a><span class="lineno">12271</span>&#160;          std::tie(<a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>, Idx) = <a class="code" href="SLPVectorizer_8cpp.html#ac8e9faa42b77ed7ed26cba77288e6f73">generateKeySubkey</a>(</div>
<div class="line"><a name="l12272"></a><span class="lineno">12272</span>&#160;              V, &amp;TLI,</div>
<div class="line"><a name="l12273"></a><span class="lineno">12273</span>&#160;              [&amp;](<span class="keywordtype">size_t</span> <a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>, <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI) {</div>
<div class="line"><a name="l12274"></a><span class="lineno">12274</span>&#160;                <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a class="code" href="namespacellvm.html#a3b1c5788b85ffa254be0e834edf5cf8f">getUnderlyingObject</a>(LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad47eefa1d094f60494b6b927061ca001">getPointerOperand</a>());</div>
<div class="line"><a name="l12275"></a><span class="lineno">12275</span>&#160;                <span class="keywordflow">if</span> (LoadKeyUsed.<a class="code" href="classllvm_1_1SmallSet.html#ae04ad615dfdd885e85cbddda146787c6">contains</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>)) {</div>
<div class="line"><a name="l12276"></a><span class="lineno">12276</span>&#160;                  <span class="keyword">auto</span> LIt = LoadsMap.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</div>
<div class="line"><a name="l12277"></a><span class="lineno">12277</span>&#160;                  <span class="keywordflow">if</span> (LIt != LoadsMap.<a class="code" href="classllvm_1_1DenseMapBase.html#a65520b9c67759099e313d0f4e7b5ff9e">end</a>()) {</div>
<div class="line"><a name="l12278"></a><span class="lineno">12278</span>&#160;                    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *RLI: LIt-&gt;second) {</div>
<div class="line"><a name="l12279"></a><span class="lineno">12279</span>&#160;                      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a034d66b8c0aeb72ea13fd26392083446">getPointersDiff</a>(</div>
<div class="line"><a name="l12280"></a><span class="lineno">12280</span>&#160;                              RLI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), RLI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad47eefa1d094f60494b6b927061ca001">getPointerOperand</a>(),</div>
<div class="line"><a name="l12281"></a><span class="lineno">12281</span>&#160;                              LI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad47eefa1d094f60494b6b927061ca001">getPointerOperand</a>(), <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, SE,</div>
<div class="line"><a name="l12282"></a><span class="lineno">12282</span>&#160;                              <span class="comment">/*StrictCheck=*/</span><span class="keyword">true</span>))</div>
<div class="line"><a name="l12283"></a><span class="lineno">12283</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(RLI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad47eefa1d094f60494b6b927061ca001">getPointerOperand</a>());</div>
<div class="line"><a name="l12284"></a><span class="lineno">12284</span>&#160;                    }</div>
<div class="line"><a name="l12285"></a><span class="lineno">12285</span>&#160;                    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *RLI : LIt-&gt;second) {</div>
<div class="line"><a name="l12286"></a><span class="lineno">12286</span>&#160;                      <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#abf8c65a150fe96c228db5b19d6b09e3a">arePointersCompatible</a>(RLI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad47eefa1d094f60494b6b927061ca001">getPointerOperand</a>(),</div>
<div class="line"><a name="l12287"></a><span class="lineno">12287</span>&#160;                                                LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad47eefa1d094f60494b6b927061ca001">getPointerOperand</a>(), TLI)) {</div>
<div class="line"><a name="l12288"></a><span class="lineno">12288</span>&#160;                        <a class="code" href="classllvm_1_1hash__code.html">hash_code</a> SubKey = <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(RLI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad47eefa1d094f60494b6b927061ca001">getPointerOperand</a>());</div>
<div class="line"><a name="l12289"></a><span class="lineno">12289</span>&#160;                        DoNotReverseVals.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(RLI);</div>
<div class="line"><a name="l12290"></a><span class="lineno">12290</span>&#160;                        <span class="keywordflow">return</span> SubKey;</div>
<div class="line"><a name="l12291"></a><span class="lineno">12291</span>&#160;                      }</div>
<div class="line"><a name="l12292"></a><span class="lineno">12292</span>&#160;                    }</div>
<div class="line"><a name="l12293"></a><span class="lineno">12293</span>&#160;                    <span class="keywordflow">if</span> (LIt-&gt;second.size() &gt; 2) {</div>
<div class="line"><a name="l12294"></a><span class="lineno">12294</span>&#160;                      <a class="code" href="classllvm_1_1hash__code.html">hash_code</a> SubKey =</div>
<div class="line"><a name="l12295"></a><span class="lineno">12295</span>&#160;                          <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(LIt-&gt;second.back()-&gt;getPointerOperand());</div>
<div class="line"><a name="l12296"></a><span class="lineno">12296</span>&#160;                      DoNotReverseVals.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(LIt-&gt;second.back());</div>
<div class="line"><a name="l12297"></a><span class="lineno">12297</span>&#160;                      <span class="keywordflow">return</span> SubKey;</div>
<div class="line"><a name="l12298"></a><span class="lineno">12298</span>&#160;                    }</div>
<div class="line"><a name="l12299"></a><span class="lineno">12299</span>&#160;                  }</div>
<div class="line"><a name="l12300"></a><span class="lineno">12300</span>&#160;                }</div>
<div class="line"><a name="l12301"></a><span class="lineno">12301</span>&#160;                LoadKeyUsed.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>);</div>
<div class="line"><a name="l12302"></a><span class="lineno">12302</span>&#160;                LoadsMap.<a class="code" href="classllvm_1_1DenseMapBase.html#a98c685a0c53f3f7ed5f4793890a6c850">try_emplace</a>(<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>).first-&gt;second.push_back(LI);</div>
<div class="line"><a name="l12303"></a><span class="lineno">12303</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad47eefa1d094f60494b6b927061ca001">getPointerOperand</a>());</div>
<div class="line"><a name="l12304"></a><span class="lineno">12304</span>&#160;              },</div>
<div class="line"><a name="l12305"></a><span class="lineno">12305</span>&#160;              <span class="comment">/*AllowAlternate=*/</span><span class="keyword">false</span>);</div>
<div class="line"><a name="l12306"></a><span class="lineno">12306</span>&#160;          ++PossibleReducedVals[<a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>][Idx]</div>
<div class="line"><a name="l12307"></a><span class="lineno">12307</span>&#160;                .<a class="code" href="classllvm_1_1MapVector.html#a9318649185cfc66ba4b4eb66d5968e00">insert</a>(std::make_pair(V, 0))</div>
<div class="line"><a name="l12308"></a><span class="lineno">12308</span>&#160;                .first-&gt;second;</div>
<div class="line"><a name="l12309"></a><span class="lineno">12309</span>&#160;        }</div>
<div class="line"><a name="l12310"></a><span class="lineno">12310</span>&#160;        Worklist.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a7efd1f0c1206d95e4fe01a9b49a57b82">append</a>(PossibleReductionOps.rbegin(),</div>
<div class="line"><a name="l12311"></a><span class="lineno">12311</span>&#160;                        PossibleReductionOps.rend());</div>
<div class="line"><a name="l12312"></a><span class="lineno">12312</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l12313"></a><span class="lineno">12313</span>&#160;        <span class="keywordtype">size_t</span> <a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>, Idx;</div>
<div class="line"><a name="l12314"></a><span class="lineno">12314</span>&#160;        std::tie(<a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>, Idx) = <a class="code" href="SLPVectorizer_8cpp.html#ac8e9faa42b77ed7ed26cba77288e6f73">generateKeySubkey</a>(</div>
<div class="line"><a name="l12315"></a><span class="lineno">12315</span>&#160;            TreeN, &amp;TLI,</div>
<div class="line"><a name="l12316"></a><span class="lineno">12316</span>&#160;            [&amp;](<span class="keywordtype">size_t</span> <a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>, <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI) {</div>
<div class="line"><a name="l12317"></a><span class="lineno">12317</span>&#160;              <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a class="code" href="namespacellvm.html#a3b1c5788b85ffa254be0e834edf5cf8f">getUnderlyingObject</a>(LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad47eefa1d094f60494b6b927061ca001">getPointerOperand</a>());</div>
<div class="line"><a name="l12318"></a><span class="lineno">12318</span>&#160;              <span class="keywordflow">if</span> (LoadKeyUsed.<a class="code" href="classllvm_1_1SmallSet.html#ae04ad615dfdd885e85cbddda146787c6">contains</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>)) {</div>
<div class="line"><a name="l12319"></a><span class="lineno">12319</span>&#160;                <span class="keyword">auto</span> LIt = LoadsMap.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</div>
<div class="line"><a name="l12320"></a><span class="lineno">12320</span>&#160;                <span class="keywordflow">if</span> (LIt != LoadsMap.<a class="code" href="classllvm_1_1DenseMapBase.html#a65520b9c67759099e313d0f4e7b5ff9e">end</a>()) {</div>
<div class="line"><a name="l12321"></a><span class="lineno">12321</span>&#160;                  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *RLI: LIt-&gt;second) {</div>
<div class="line"><a name="l12322"></a><span class="lineno">12322</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a034d66b8c0aeb72ea13fd26392083446">getPointersDiff</a>(RLI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(),</div>
<div class="line"><a name="l12323"></a><span class="lineno">12323</span>&#160;                                        RLI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad47eefa1d094f60494b6b927061ca001">getPointerOperand</a>(), LI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(),</div>
<div class="line"><a name="l12324"></a><span class="lineno">12324</span>&#160;                                        LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad47eefa1d094f60494b6b927061ca001">getPointerOperand</a>(), <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, SE,</div>
<div class="line"><a name="l12325"></a><span class="lineno">12325</span>&#160;                                        <span class="comment">/*StrictCheck=*/</span><span class="keyword">true</span>))</div>
<div class="line"><a name="l12326"></a><span class="lineno">12326</span>&#160;                      <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(RLI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad47eefa1d094f60494b6b927061ca001">getPointerOperand</a>());</div>
<div class="line"><a name="l12327"></a><span class="lineno">12327</span>&#160;                  }</div>
<div class="line"><a name="l12328"></a><span class="lineno">12328</span>&#160;                  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *RLI : LIt-&gt;second) {</div>
<div class="line"><a name="l12329"></a><span class="lineno">12329</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#abf8c65a150fe96c228db5b19d6b09e3a">arePointersCompatible</a>(RLI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad47eefa1d094f60494b6b927061ca001">getPointerOperand</a>(),</div>
<div class="line"><a name="l12330"></a><span class="lineno">12330</span>&#160;                                              LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad47eefa1d094f60494b6b927061ca001">getPointerOperand</a>(), TLI)) {</div>
<div class="line"><a name="l12331"></a><span class="lineno">12331</span>&#160;                      <a class="code" href="classllvm_1_1hash__code.html">hash_code</a> SubKey = <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(RLI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad47eefa1d094f60494b6b927061ca001">getPointerOperand</a>());</div>
<div class="line"><a name="l12332"></a><span class="lineno">12332</span>&#160;                      DoNotReverseVals.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(RLI);</div>
<div class="line"><a name="l12333"></a><span class="lineno">12333</span>&#160;                      <span class="keywordflow">return</span> SubKey;</div>
<div class="line"><a name="l12334"></a><span class="lineno">12334</span>&#160;                    }</div>
<div class="line"><a name="l12335"></a><span class="lineno">12335</span>&#160;                  }</div>
<div class="line"><a name="l12336"></a><span class="lineno">12336</span>&#160;                  <span class="keywordflow">if</span> (LIt-&gt;second.size() &gt; 2) {</div>
<div class="line"><a name="l12337"></a><span class="lineno">12337</span>&#160;                    <a class="code" href="classllvm_1_1hash__code.html">hash_code</a> SubKey = <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(LIt-&gt;second.back()-&gt;getPointerOperand());</div>
<div class="line"><a name="l12338"></a><span class="lineno">12338</span>&#160;                    DoNotReverseVals.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(LIt-&gt;second.back());</div>
<div class="line"><a name="l12339"></a><span class="lineno">12339</span>&#160;                    <span class="keywordflow">return</span> SubKey;</div>
<div class="line"><a name="l12340"></a><span class="lineno">12340</span>&#160;                  }</div>
<div class="line"><a name="l12341"></a><span class="lineno">12341</span>&#160;                }</div>
<div class="line"><a name="l12342"></a><span class="lineno">12342</span>&#160;              }</div>
<div class="line"><a name="l12343"></a><span class="lineno">12343</span>&#160;              LoadKeyUsed.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>);</div>
<div class="line"><a name="l12344"></a><span class="lineno">12344</span>&#160;              LoadsMap.<a class="code" href="classllvm_1_1DenseMapBase.html#a98c685a0c53f3f7ed5f4793890a6c850">try_emplace</a>(<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>).first-&gt;second.push_back(LI);</div>
<div class="line"><a name="l12345"></a><span class="lineno">12345</span>&#160;              <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">hash_value</a>(LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad47eefa1d094f60494b6b927061ca001">getPointerOperand</a>());</div>
<div class="line"><a name="l12346"></a><span class="lineno">12346</span>&#160;            },</div>
<div class="line"><a name="l12347"></a><span class="lineno">12347</span>&#160;            <span class="comment">/*AllowAlternate=*/</span><span class="keyword">false</span>);</div>
<div class="line"><a name="l12348"></a><span class="lineno">12348</span>&#160;        ++PossibleReducedVals[<a class="code" href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">Key</a>][Idx]</div>
<div class="line"><a name="l12349"></a><span class="lineno">12349</span>&#160;              .<a class="code" href="classllvm_1_1MapVector.html#a9318649185cfc66ba4b4eb66d5968e00">insert</a>(std::make_pair(TreeN, 0))</div>
<div class="line"><a name="l12350"></a><span class="lineno">12350</span>&#160;              .first-&gt;second;</div>
<div class="line"><a name="l12351"></a><span class="lineno">12351</span>&#160;      }</div>
<div class="line"><a name="l12352"></a><span class="lineno">12352</span>&#160;    }</div>
<div class="line"><a name="l12353"></a><span class="lineno">12353</span>&#160;    <span class="keyword">auto</span> PossibleReducedValsVect = PossibleReducedVals.<a class="code" href="classllvm_1_1MapVector.html#a48284a35966b520c1da3a34a112726f5">takeVector</a>();</div>
<div class="line"><a name="l12354"></a><span class="lineno">12354</span>&#160;    <span class="comment">// Sort values by the total number of values kinds to start the reduction</span></div>
<div class="line"><a name="l12355"></a><span class="lineno">12355</span>&#160;    <span class="comment">// from the longest possible reduced values sequences.</span></div>
<div class="line"><a name="l12356"></a><span class="lineno">12356</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;PossibleReducedVals : PossibleReducedValsVect) {</div>
<div class="line"><a name="l12357"></a><span class="lineno">12357</span>&#160;      <span class="keyword">auto</span> PossibleRedVals = PossibleReducedVals.second.<a class="code" href="classllvm_1_1MapVector.html#a48284a35966b520c1da3a34a112726f5">takeVector</a>();</div>
<div class="line"><a name="l12358"></a><span class="lineno">12358</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;SmallVector&lt;Value *&gt;</a>&gt; PossibleRedValsVect;</div>
<div class="line"><a name="l12359"></a><span class="lineno">12359</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> It = PossibleRedVals.begin(), <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = PossibleRedVals.end();</div>
<div class="line"><a name="l12360"></a><span class="lineno">12360</span>&#160;           It != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++It) {</div>
<div class="line"><a name="l12361"></a><span class="lineno">12361</span>&#160;        PossibleRedValsVect.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>();</div>
<div class="line"><a name="l12362"></a><span class="lineno">12362</span>&#160;        <span class="keyword">auto</span> RedValsVect = It-&gt;second.takeVector();</div>
<div class="line"><a name="l12363"></a><span class="lineno">12363</span>&#160;        <a class="code" href="namespacellvm.html#a076f93c387f454f0db13d4bc7d4e7f9c">stable_sort</a>(RedValsVect, <a class="code" href="structllvm_1_1less__second.html">llvm::less_second</a>());</div>
<div class="line"><a name="l12364"></a><span class="lineno">12364</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> std::pair&lt;Value *, unsigned&gt; &amp;Data : RedValsVect)</div>
<div class="line"><a name="l12365"></a><span class="lineno">12365</span>&#160;          PossibleRedValsVect.back().<a class="code" href="classllvm_1_1SmallVectorImpl.html#a7efd1f0c1206d95e4fe01a9b49a57b82">append</a>(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.second, <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.first);</div>
<div class="line"><a name="l12366"></a><span class="lineno">12366</span>&#160;      }</div>
<div class="line"><a name="l12367"></a><span class="lineno">12367</span>&#160;      <a class="code" href="namespacellvm.html#a076f93c387f454f0db13d4bc7d4e7f9c">stable_sort</a>(PossibleRedValsVect, [](<span class="keyword">const</span> <span class="keyword">auto</span> &amp;P1, <span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="README-SSE_8txt.html#ae7fc2fb0e2d536219c1193f1a178e7db">P2</a>) {</div>
<div class="line"><a name="l12368"></a><span class="lineno">12368</span>&#160;        <span class="keywordflow">return</span> P1.size() &gt; <a class="code" href="README-SSE_8txt.html#ae7fc2fb0e2d536219c1193f1a178e7db">P2</a>.size();</div>
<div class="line"><a name="l12369"></a><span class="lineno">12369</span>&#160;      });</div>
<div class="line"><a name="l12370"></a><span class="lineno">12370</span>&#160;      <span class="keywordtype">int</span> NewIdx = -1;</div>
<div class="line"><a name="l12371"></a><span class="lineno">12371</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> Data : PossibleRedValsVect) {</div>
<div class="line"><a name="l12372"></a><span class="lineno">12372</span>&#160;        <span class="keywordflow">if</span> (isGoodForReduction(Data) ||</div>
<div class="line"><a name="l12373"></a><span class="lineno">12373</span>&#160;            (isa&lt;LoadInst&gt;(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.front()) &amp;&amp; NewIdx &gt;= 0 &amp;&amp;</div>
<div class="line"><a name="l12374"></a><span class="lineno">12374</span>&#160;             isa&lt;LoadInst&gt;(ReducedVals[NewIdx].front()) &amp;&amp;</div>
<div class="line"><a name="l12375"></a><span class="lineno">12375</span>&#160;             <a class="code" href="namespacellvm.html#a3b1c5788b85ffa254be0e834edf5cf8f">getUnderlyingObject</a>(</div>
<div class="line"><a name="l12376"></a><span class="lineno">12376</span>&#160;                 cast&lt;LoadInst&gt;(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.front())-&gt;getPointerOperand()) ==</div>
<div class="line"><a name="l12377"></a><span class="lineno">12377</span>&#160;                 <a class="code" href="namespacellvm.html#a3b1c5788b85ffa254be0e834edf5cf8f">getUnderlyingObject</a>(cast&lt;LoadInst&gt;(ReducedVals[NewIdx].front())</div>
<div class="line"><a name="l12378"></a><span class="lineno">12378</span>&#160;                                         -&gt;<a class="code" href="namespacellvm.html#ac2db21413768e904d56a02c26184823d">getPointerOperand</a>()))) {</div>
<div class="line"><a name="l12379"></a><span class="lineno">12379</span>&#160;          <span class="keywordflow">if</span> (NewIdx &lt; 0) {</div>
<div class="line"><a name="l12380"></a><span class="lineno">12380</span>&#160;            NewIdx = ReducedVals.size();</div>
<div class="line"><a name="l12381"></a><span class="lineno">12381</span>&#160;            ReducedVals.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>();</div>
<div class="line"><a name="l12382"></a><span class="lineno">12382</span>&#160;          }</div>
<div class="line"><a name="l12383"></a><span class="lineno">12383</span>&#160;          <span class="keywordflow">if</span> (DoNotReverseVals.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#af74676a3c7447be34bd2c1da76ec0c48">contains</a>(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.front()))</div>
<div class="line"><a name="l12384"></a><span class="lineno">12384</span>&#160;            ReducedVals[NewIdx].<a class="code" href="classllvm_1_1SmallVectorImpl.html#a7efd1f0c1206d95e4fe01a9b49a57b82">append</a>(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.begin(), <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.end());</div>
<div class="line"><a name="l12385"></a><span class="lineno">12385</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l12386"></a><span class="lineno">12386</span>&#160;            ReducedVals[NewIdx].<a class="code" href="classllvm_1_1SmallVectorImpl.html#a7efd1f0c1206d95e4fe01a9b49a57b82">append</a>(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.rbegin(), <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.rend());</div>
<div class="line"><a name="l12387"></a><span class="lineno">12387</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l12388"></a><span class="lineno">12388</span>&#160;          ReducedVals.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>().append(<a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.rbegin(), <a class="code" href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">Data</a>.rend());</div>
<div class="line"><a name="l12389"></a><span class="lineno">12389</span>&#160;        }</div>
<div class="line"><a name="l12390"></a><span class="lineno">12390</span>&#160;      }</div>
<div class="line"><a name="l12391"></a><span class="lineno">12391</span>&#160;    }</div>
<div class="line"><a name="l12392"></a><span class="lineno">12392</span>&#160;    <span class="comment">// Sort the reduced values by number of same/alternate opcode and/or pointer</span></div>
<div class="line"><a name="l12393"></a><span class="lineno">12393</span>&#160;    <span class="comment">// operand.</span></div>
<div class="line"><a name="l12394"></a><span class="lineno">12394</span>&#160;    <a class="code" href="namespacellvm.html#a076f93c387f454f0db13d4bc7d4e7f9c">stable_sort</a>(ReducedVals, [](<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> P1, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> <a class="code" href="README-SSE_8txt.html#ae7fc2fb0e2d536219c1193f1a178e7db">P2</a>) {</div>
<div class="line"><a name="l12395"></a><span class="lineno">12395</span>&#160;      <span class="keywordflow">return</span> P1.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() &gt; <a class="code" href="README-SSE_8txt.html#ae7fc2fb0e2d536219c1193f1a178e7db">P2</a>.size();</div>
<div class="line"><a name="l12396"></a><span class="lineno">12396</span>&#160;    });</div>
<div class="line"><a name="l12397"></a><span class="lineno">12397</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l12398"></a><span class="lineno">12398</span>&#160;  }</div>
<div class="line"><a name="l12399"></a><span class="lineno">12399</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l12400"></a><span class="lineno">12400</span>&#160;<span class="comment">  /// Attempt to vectorize the tree found by matchAssociativeReduction.</span></div>
<div class="line"><a name="l12401"></a><span class="lineno">12401</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Value.html">Value</a> *tryToReduce(<a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> &amp;V, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> *<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>,</div>
<div class="line"><a name="l12402"></a><span class="lineno">12402</span>&#160;                     <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> &amp;TLI) {</div>
<div class="line"><a name="l12403"></a><span class="lineno">12403</span>&#160;    constexpr <span class="keywordtype">int</span> ReductionLimit = 4;</div>
<div class="line"><a name="l12404"></a><span class="lineno">12404</span>&#160;    constexpr <span class="keywordtype">unsigned</span> RegMaxNumber = 4;</div>
<div class="line"><a name="l12405"></a><span class="lineno">12405</span>&#160;    constexpr <span class="keywordtype">unsigned</span> RedValsMaxNumber = 128;</div>
<div class="line"><a name="l12406"></a><span class="lineno">12406</span>&#160;    <span class="comment">// If there are a sufficient number of reduction values, reduce</span></div>
<div class="line"><a name="l12407"></a><span class="lineno">12407</span>&#160;    <span class="comment">// to a nearby power-of-2. We can safely generate oversized</span></div>
<div class="line"><a name="l12408"></a><span class="lineno">12408</span>&#160;    <span class="comment">// vectors and rely on the backend to split them to legal sizes.</span></div>
<div class="line"><a name="l12409"></a><span class="lineno">12409</span>&#160;    <span class="keywordtype">size_t</span> NumReducedVals =</div>
<div class="line"><a name="l12410"></a><span class="lineno">12410</span>&#160;        std::accumulate(ReducedVals.begin(), ReducedVals.end(), 0,</div>
<div class="line"><a name="l12411"></a><span class="lineno">12411</span>&#160;                        [](<span class="keywordtype">size_t</span> Num, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> Vals) {</div>
<div class="line"><a name="l12412"></a><span class="lineno">12412</span>&#160;                          if (!isGoodForReduction(Vals))</div>
<div class="line"><a name="l12413"></a><span class="lineno">12413</span>&#160;                            return Num;</div>
<div class="line"><a name="l12414"></a><span class="lineno">12414</span>&#160;                          return Num + Vals.size();</div>
<div class="line"><a name="l12415"></a><span class="lineno">12415</span>&#160;                        });</div>
<div class="line"><a name="l12416"></a><span class="lineno">12416</span>&#160;    <span class="keywordflow">if</span> (NumReducedVals &lt; ReductionLimit) {</div>
<div class="line"><a name="l12417"></a><span class="lineno">12417</span>&#160;      <span class="keywordflow">for</span> (ReductionOpsType &amp;RdxOps : ReductionOps)</div>
<div class="line"><a name="l12418"></a><span class="lineno">12418</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *RdxOp : RdxOps)</div>
<div class="line"><a name="l12419"></a><span class="lineno">12419</span>&#160;          V.analyzedReductionRoot(cast&lt;Instruction&gt;(RdxOp));</div>
<div class="line"><a name="l12420"></a><span class="lineno">12420</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l12421"></a><span class="lineno">12421</span>&#160;    }</div>
<div class="line"><a name="l12422"></a><span class="lineno">12422</span>&#160; </div>
<div class="line"><a name="l12423"></a><span class="lineno">12423</span>&#160;    <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(cast&lt;Instruction&gt;(ReductionRoot));</div>
<div class="line"><a name="l12424"></a><span class="lineno">12424</span>&#160; </div>
<div class="line"><a name="l12425"></a><span class="lineno">12425</span>&#160;    <span class="comment">// Track the reduced values in case if they are replaced by extractelement</span></div>
<div class="line"><a name="l12426"></a><span class="lineno">12426</span>&#160;    <span class="comment">// because of the vectorization.</span></div>
<div class="line"><a name="l12427"></a><span class="lineno">12427</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, WeakTrackingVH&gt;</a> TrackedVals(</div>
<div class="line"><a name="l12428"></a><span class="lineno">12428</span>&#160;        ReducedVals.size() * ReducedVals.front().size() + ExtraArgs.size());</div>
<div class="line"><a name="l12429"></a><span class="lineno">12429</span>&#160;    BoUpSLP::ExtraValueToDebugLocsMap ExternallyUsedValues;</div>
<div class="line"><a name="l12430"></a><span class="lineno">12430</span>&#160;    ExternallyUsedValues.reserve(ExtraArgs.size() + 1);</div>
<div class="line"><a name="l12431"></a><span class="lineno">12431</span>&#160;    <span class="comment">// The same extra argument may be used several times, so log each attempt</span></div>
<div class="line"><a name="l12432"></a><span class="lineno">12432</span>&#160;    <span class="comment">// to use it.</span></div>
<div class="line"><a name="l12433"></a><span class="lineno">12433</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> std::pair&lt;Instruction *, Value *&gt; &amp;Pair : ExtraArgs) {</div>
<div class="line"><a name="l12434"></a><span class="lineno">12434</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Pair.first &amp;&amp; <span class="stringliteral">&quot;DebugLoc must be set.&quot;</span>);</div>
<div class="line"><a name="l12435"></a><span class="lineno">12435</span>&#160;      ExternallyUsedValues[Pair.second].push_back(Pair.first);</div>
<div class="line"><a name="l12436"></a><span class="lineno">12436</span>&#160;      TrackedVals.try_emplace(Pair.second, Pair.second);</div>
<div class="line"><a name="l12437"></a><span class="lineno">12437</span>&#160;    }</div>
<div class="line"><a name="l12438"></a><span class="lineno">12438</span>&#160; </div>
<div class="line"><a name="l12439"></a><span class="lineno">12439</span>&#160;    <span class="comment">// The compare instruction of a min/max is the insertion point for new</span></div>
<div class="line"><a name="l12440"></a><span class="lineno">12440</span>&#160;    <span class="comment">// instructions and may be replaced with a new compare instruction.</span></div>
<div class="line"><a name="l12441"></a><span class="lineno">12441</span>&#160;    <span class="keyword">auto</span> &amp;&amp;GetCmpForMinMaxReduction = [](<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *RdxRootInst) {</div>
<div class="line"><a name="l12442"></a><span class="lineno">12442</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isa&lt;SelectInst&gt;(RdxRootInst) &amp;&amp;</div>
<div class="line"><a name="l12443"></a><span class="lineno">12443</span>&#160;             <span class="stringliteral">&quot;Expected min/max reduction to have select root instruction&quot;</span>);</div>
<div class="line"><a name="l12444"></a><span class="lineno">12444</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *ScalarCond = cast&lt;SelectInst&gt;(RdxRootInst)-&gt;getCondition();</div>
<div class="line"><a name="l12445"></a><span class="lineno">12445</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isa&lt;Instruction&gt;(ScalarCond) &amp;&amp;</div>
<div class="line"><a name="l12446"></a><span class="lineno">12446</span>&#160;             <span class="stringliteral">&quot;Expected min/max reduction to have compare condition&quot;</span>);</div>
<div class="line"><a name="l12447"></a><span class="lineno">12447</span>&#160;      <span class="keywordflow">return</span> cast&lt;Instruction&gt;(ScalarCond);</div>
<div class="line"><a name="l12448"></a><span class="lineno">12448</span>&#160;    };</div>
<div class="line"><a name="l12449"></a><span class="lineno">12449</span>&#160; </div>
<div class="line"><a name="l12450"></a><span class="lineno">12450</span>&#160;    <span class="comment">// The reduction root is used as the insertion point for new instructions,</span></div>
<div class="line"><a name="l12451"></a><span class="lineno">12451</span>&#160;    <span class="comment">// so set it as externally used to prevent it from being deleted.</span></div>
<div class="line"><a name="l12452"></a><span class="lineno">12452</span>&#160;    ExternallyUsedValues[ReductionRoot];</div>
<div class="line"><a name="l12453"></a><span class="lineno">12453</span>&#160;    <a class="code" href="classllvm_1_1SmallDenseSet.html">SmallDenseSet&lt;Value *&gt;</a> IgnoreList(ReductionOps.size() *</div>
<div class="line"><a name="l12454"></a><span class="lineno">12454</span>&#160;                                      ReductionOps.front().size());</div>
<div class="line"><a name="l12455"></a><span class="lineno">12455</span>&#160;    <span class="keywordflow">for</span> (ReductionOpsType &amp;RdxOps : ReductionOps)</div>
<div class="line"><a name="l12456"></a><span class="lineno">12456</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *RdxOp : RdxOps) {</div>
<div class="line"><a name="l12457"></a><span class="lineno">12457</span>&#160;        <span class="keywordflow">if</span> (!RdxOp)</div>
<div class="line"><a name="l12458"></a><span class="lineno">12458</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l12459"></a><span class="lineno">12459</span>&#160;        IgnoreList.insert(RdxOp);</div>
<div class="line"><a name="l12460"></a><span class="lineno">12460</span>&#160;      }</div>
<div class="line"><a name="l12461"></a><span class="lineno">12461</span>&#160;    <span class="keywordtype">bool</span> IsCmpSelMinMax = isCmpSelMinMax(cast&lt;Instruction&gt;(ReductionRoot));</div>
<div class="line"><a name="l12462"></a><span class="lineno">12462</span>&#160; </div>
<div class="line"><a name="l12463"></a><span class="lineno">12463</span>&#160;    <span class="comment">// Need to track reduced vals, they may be changed during vectorization of</span></div>
<div class="line"><a name="l12464"></a><span class="lineno">12464</span>&#160;    <span class="comment">// subvectors.</span></div>
<div class="line"><a name="l12465"></a><span class="lineno">12465</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> Candidates : ReducedVals)</div>
<div class="line"><a name="l12466"></a><span class="lineno">12466</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : Candidates)</div>
<div class="line"><a name="l12467"></a><span class="lineno">12467</span>&#160;        TrackedVals.try_emplace(V, V);</div>
<div class="line"><a name="l12468"></a><span class="lineno">12468</span>&#160; </div>
<div class="line"><a name="l12469"></a><span class="lineno">12469</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, unsigned&gt;</a> VectorizedVals(ReducedVals.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</div>
<div class="line"><a name="l12470"></a><span class="lineno">12470</span>&#160;    <span class="comment">// List of the values that were reduced in other trees as part of gather</span></div>
<div class="line"><a name="l12471"></a><span class="lineno">12471</span>&#160;    <span class="comment">// nodes and thus requiring extract if fully vectorized in other trees.</span></div>
<div class="line"><a name="l12472"></a><span class="lineno">12472</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value *, 4&gt;</a> RequiredExtract;</div>
<div class="line"><a name="l12473"></a><span class="lineno">12473</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *VectorizedTree = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l12474"></a><span class="lineno">12474</span>&#160;    <span class="keywordtype">bool</span> CheckForReusedReductionOps = <span class="keyword">false</span>;</div>
<div class="line"><a name="l12475"></a><span class="lineno">12475</span>&#160;    <span class="comment">// Try to vectorize elements based on their type.</span></div>
<div class="line"><a name="l12476"></a><span class="lineno">12476</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = ReducedVals.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l12477"></a><span class="lineno">12477</span>&#160;      <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> OrigReducedVals = ReducedVals[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l12478"></a><span class="lineno">12478</span>&#160;      InstructionsState <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = <a class="code" href="SLPVectorizer_8cpp.html#ae37b3a41d982a793664ab021d9b9b325">getSameOpcode</a>(OrigReducedVals, TLI);</div>
<div class="line"><a name="l12479"></a><span class="lineno">12479</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *&gt;</a> Candidates;</div>
<div class="line"><a name="l12480"></a><span class="lineno">12480</span>&#160;      Candidates.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(2 * OrigReducedVals.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</div>
<div class="line"><a name="l12481"></a><span class="lineno">12481</span>&#160;      <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, Value *&gt;</a> TrackedToOrig(2 * OrigReducedVals.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</div>
<div class="line"><a name="l12482"></a><span class="lineno">12482</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Cnt = 0, Sz = OrigReducedVals.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(); Cnt &lt; Sz; ++Cnt) {</div>
<div class="line"><a name="l12483"></a><span class="lineno">12483</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *RdxVal = TrackedVals.find(OrigReducedVals[Cnt])-&gt;second;</div>
<div class="line"><a name="l12484"></a><span class="lineno">12484</span>&#160;        <span class="comment">// Check if the reduction value was not overriden by the extractelement</span></div>
<div class="line"><a name="l12485"></a><span class="lineno">12485</span>&#160;        <span class="comment">// instruction because of the vectorization and exclude it, if it is not</span></div>
<div class="line"><a name="l12486"></a><span class="lineno">12486</span>&#160;        <span class="comment">// compatible with other values.</span></div>
<div class="line"><a name="l12487"></a><span class="lineno">12487</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Inst = dyn_cast&lt;Instruction&gt;(RdxVal))</div>
<div class="line"><a name="l12488"></a><span class="lineno">12488</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#a06a9edb69d0ed6fda201d59948acfd89">isVectorLikeInstWithConstOps</a>(Inst) &amp;&amp;</div>
<div class="line"><a name="l12489"></a><span class="lineno">12489</span>&#160;              (!<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.getOpcode() || !<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.isOpcodeOrAlt(Inst)))</div>
<div class="line"><a name="l12490"></a><span class="lineno">12490</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l12491"></a><span class="lineno">12491</span>&#160;        Candidates.push_back(RdxVal);</div>
<div class="line"><a name="l12492"></a><span class="lineno">12492</span>&#160;        TrackedToOrig.try_emplace(RdxVal, OrigReducedVals[Cnt]);</div>
<div class="line"><a name="l12493"></a><span class="lineno">12493</span>&#160;      }</div>
<div class="line"><a name="l12494"></a><span class="lineno">12494</span>&#160;      <span class="keywordtype">bool</span> ShuffledExtracts = <span class="keyword">false</span>;</div>
<div class="line"><a name="l12495"></a><span class="lineno">12495</span>&#160;      <span class="comment">// Try to handle shuffled extractelements.</span></div>
<div class="line"><a name="l12496"></a><span class="lineno">12496</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.getOpcode() == Instruction::ExtractElement &amp;&amp; !<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.isAltShuffle() &amp;&amp;</div>
<div class="line"><a name="l12497"></a><span class="lineno">12497</span>&#160;          <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> + 1 &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>) {</div>
<div class="line"><a name="l12498"></a><span class="lineno">12498</span>&#160;        InstructionsState NextS = <a class="code" href="SLPVectorizer_8cpp.html#ae37b3a41d982a793664ab021d9b9b325">getSameOpcode</a>(ReducedVals[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> + 1], TLI);</div>
<div class="line"><a name="l12499"></a><span class="lineno">12499</span>&#160;        <span class="keywordflow">if</span> (NextS.getOpcode() == Instruction::ExtractElement &amp;&amp;</div>
<div class="line"><a name="l12500"></a><span class="lineno">12500</span>&#160;            !NextS.isAltShuffle()) {</div>
<div class="line"><a name="l12501"></a><span class="lineno">12501</span>&#160;          <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *&gt;</a> CommonCandidates(Candidates);</div>
<div class="line"><a name="l12502"></a><span class="lineno">12502</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *RV : ReducedVals[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> + 1]) {</div>
<div class="line"><a name="l12503"></a><span class="lineno">12503</span>&#160;            <a class="code" href="classllvm_1_1Value.html">Value</a> *RdxVal = TrackedVals.find(RV)-&gt;second;</div>
<div class="line"><a name="l12504"></a><span class="lineno">12504</span>&#160;            <span class="comment">// Check if the reduction value was not overriden by the</span></div>
<div class="line"><a name="l12505"></a><span class="lineno">12505</span>&#160;            <span class="comment">// extractelement instruction because of the vectorization and</span></div>
<div class="line"><a name="l12506"></a><span class="lineno">12506</span>&#160;            <span class="comment">// exclude it, if it is not compatible with other values.</span></div>
<div class="line"><a name="l12507"></a><span class="lineno">12507</span>&#160;            <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Inst = dyn_cast&lt;Instruction&gt;(RdxVal))</div>
<div class="line"><a name="l12508"></a><span class="lineno">12508</span>&#160;              <span class="keywordflow">if</span> (!NextS.getOpcode() || !NextS.isOpcodeOrAlt(Inst))</div>
<div class="line"><a name="l12509"></a><span class="lineno">12509</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l12510"></a><span class="lineno">12510</span>&#160;            CommonCandidates.push_back(RdxVal);</div>
<div class="line"><a name="l12511"></a><span class="lineno">12511</span>&#160;            TrackedToOrig.try_emplace(RdxVal, RV);</div>
<div class="line"><a name="l12512"></a><span class="lineno">12512</span>&#160;          }</div>
<div class="line"><a name="l12513"></a><span class="lineno">12513</span>&#160;          <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>;</div>
<div class="line"><a name="l12514"></a><span class="lineno">12514</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="SLPVectorizer_8cpp.html#a8b409af081b7132c139c0bdc22c5cefd">isFixedVectorShuffle</a>(CommonCandidates, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>)) {</div>
<div class="line"><a name="l12515"></a><span class="lineno">12515</span>&#160;            ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l12516"></a><span class="lineno">12516</span>&#160;            Candidates.<a class="code" href="classllvm_1_1SmallVectorImpl.html#abd962b7b01f49ce61ea41ee10c49e313">swap</a>(CommonCandidates);</div>
<div class="line"><a name="l12517"></a><span class="lineno">12517</span>&#160;            ShuffledExtracts = <span class="keyword">true</span>;</div>
<div class="line"><a name="l12518"></a><span class="lineno">12518</span>&#160;          }</div>
<div class="line"><a name="l12519"></a><span class="lineno">12519</span>&#160;        }</div>
<div class="line"><a name="l12520"></a><span class="lineno">12520</span>&#160;      }</div>
<div class="line"><a name="l12521"></a><span class="lineno">12521</span>&#160;      <span class="keywordtype">unsigned</span> NumReducedVals = Candidates.size();</div>
<div class="line"><a name="l12522"></a><span class="lineno">12522</span>&#160;      <span class="keywordflow">if</span> (NumReducedVals &lt; ReductionLimit)</div>
<div class="line"><a name="l12523"></a><span class="lineno">12523</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l12524"></a><span class="lineno">12524</span>&#160; </div>
<div class="line"><a name="l12525"></a><span class="lineno">12525</span>&#160;      <span class="keywordtype">unsigned</span> MaxVecRegSize = V.getMaxVecRegSize();</div>
<div class="line"><a name="l12526"></a><span class="lineno">12526</span>&#160;      <span class="keywordtype">unsigned</span> EltSize = V.getVectorElementSize(Candidates[0]);</div>
<div class="line"><a name="l12527"></a><span class="lineno">12527</span>&#160;      <span class="keywordtype">unsigned</span> MaxElts =</div>
<div class="line"><a name="l12528"></a><span class="lineno">12528</span>&#160;          RegMaxNumber * <a class="code" href="namespacellvm.html#ae22967d11b695d268992470debfae4b2">llvm::bit_floor</a>(MaxVecRegSize / EltSize);</div>
<div class="line"><a name="l12529"></a><span class="lineno">12529</span>&#160; </div>
<div class="line"><a name="l12530"></a><span class="lineno">12530</span>&#160;      <span class="keywordtype">unsigned</span> ReduxWidth = std::min&lt;unsigned&gt;(</div>
<div class="line"><a name="l12531"></a><span class="lineno">12531</span>&#160;          <a class="code" href="namespacellvm.html#ae22967d11b695d268992470debfae4b2">llvm::bit_floor</a>(NumReducedVals), <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(RedValsMaxNumber, MaxElts));</div>
<div class="line"><a name="l12532"></a><span class="lineno">12532</span>&#160;      <span class="keywordtype">unsigned</span> Start = 0;</div>
<div class="line"><a name="l12533"></a><span class="lineno">12533</span>&#160;      <span class="keywordtype">unsigned</span> Pos = Start;</div>
<div class="line"><a name="l12534"></a><span class="lineno">12534</span>&#160;      <span class="comment">// Restarts vectorization attempt with lower vector factor.</span></div>
<div class="line"><a name="l12535"></a><span class="lineno">12535</span>&#160;      <span class="keywordtype">unsigned</span> PrevReduxWidth = ReduxWidth;</div>
<div class="line"><a name="l12536"></a><span class="lineno">12536</span>&#160;      <span class="keywordtype">bool</span> CheckForReusedReductionOpsLocal = <span class="keyword">false</span>;</div>
<div class="line"><a name="l12537"></a><span class="lineno">12537</span>&#160;      <span class="keyword">auto</span> &amp;&amp;AdjustReducedVals = [&amp;Pos, &amp;Start, &amp;ReduxWidth, NumReducedVals,</div>
<div class="line"><a name="l12538"></a><span class="lineno">12538</span>&#160;                                  &amp;CheckForReusedReductionOpsLocal,</div>
<div class="line"><a name="l12539"></a><span class="lineno">12539</span>&#160;                                  &amp;PrevReduxWidth, &amp;V,</div>
<div class="line"><a name="l12540"></a><span class="lineno">12540</span>&#160;                                  &amp;IgnoreList](<span class="keywordtype">bool</span> IgnoreVL = <span class="keyword">false</span>) {</div>
<div class="line"><a name="l12541"></a><span class="lineno">12541</span>&#160;        <span class="keywordtype">bool</span> IsAnyRedOpGathered = !IgnoreVL &amp;&amp; V.isAnyGathered(IgnoreList);</div>
<div class="line"><a name="l12542"></a><span class="lineno">12542</span>&#160;        <span class="keywordflow">if</span> (!CheckForReusedReductionOpsLocal &amp;&amp; PrevReduxWidth == ReduxWidth) {</div>
<div class="line"><a name="l12543"></a><span class="lineno">12543</span>&#160;          <span class="comment">// Check if any of the reduction ops are gathered. If so, worth</span></div>
<div class="line"><a name="l12544"></a><span class="lineno">12544</span>&#160;          <span class="comment">// trying again with less number of reduction ops.</span></div>
<div class="line"><a name="l12545"></a><span class="lineno">12545</span>&#160;          CheckForReusedReductionOpsLocal |= IsAnyRedOpGathered;</div>
<div class="line"><a name="l12546"></a><span class="lineno">12546</span>&#160;        }</div>
<div class="line"><a name="l12547"></a><span class="lineno">12547</span>&#160;        ++Pos;</div>
<div class="line"><a name="l12548"></a><span class="lineno">12548</span>&#160;        <span class="keywordflow">if</span> (Pos &lt; NumReducedVals - ReduxWidth + 1)</div>
<div class="line"><a name="l12549"></a><span class="lineno">12549</span>&#160;          <span class="keywordflow">return</span> IsAnyRedOpGathered;</div>
<div class="line"><a name="l12550"></a><span class="lineno">12550</span>&#160;        Pos = Start;</div>
<div class="line"><a name="l12551"></a><span class="lineno">12551</span>&#160;        ReduxWidth /= 2;</div>
<div class="line"><a name="l12552"></a><span class="lineno">12552</span>&#160;        <span class="keywordflow">return</span> IsAnyRedOpGathered;</div>
<div class="line"><a name="l12553"></a><span class="lineno">12553</span>&#160;      };</div>
<div class="line"><a name="l12554"></a><span class="lineno">12554</span>&#160;      <span class="keywordflow">while</span> (Pos &lt; NumReducedVals - ReduxWidth + 1 &amp;&amp;</div>
<div class="line"><a name="l12555"></a><span class="lineno">12555</span>&#160;             ReduxWidth &gt;= ReductionLimit) {</div>
<div class="line"><a name="l12556"></a><span class="lineno">12556</span>&#160;        <span class="comment">// Dependency in tree of the reduction ops - drop this attempt, try</span></div>
<div class="line"><a name="l12557"></a><span class="lineno">12557</span>&#160;        <span class="comment">// later.</span></div>
<div class="line"><a name="l12558"></a><span class="lineno">12558</span>&#160;        <span class="keywordflow">if</span> (CheckForReusedReductionOpsLocal &amp;&amp; PrevReduxWidth != ReduxWidth &amp;&amp;</div>
<div class="line"><a name="l12559"></a><span class="lineno">12559</span>&#160;            Start == 0) {</div>
<div class="line"><a name="l12560"></a><span class="lineno">12560</span>&#160;          CheckForReusedReductionOps = <span class="keyword">true</span>;</div>
<div class="line"><a name="l12561"></a><span class="lineno">12561</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l12562"></a><span class="lineno">12562</span>&#160;        }</div>
<div class="line"><a name="l12563"></a><span class="lineno">12563</span>&#160;        PrevReduxWidth = ReduxWidth;</div>
<div class="line"><a name="l12564"></a><span class="lineno">12564</span>&#160;        <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> VL(std::next(Candidates.begin(), Pos), ReduxWidth);</div>
<div class="line"><a name="l12565"></a><span class="lineno">12565</span>&#160;        <span class="comment">// Beeing analyzed already - skip.</span></div>
<div class="line"><a name="l12566"></a><span class="lineno">12566</span>&#160;        <span class="keywordflow">if</span> (V.areAnalyzedReductionVals(VL)) {</div>
<div class="line"><a name="l12567"></a><span class="lineno">12567</span>&#160;          (void)AdjustReducedVals(<span class="comment">/*IgnoreVL=*/</span><span class="keyword">true</span>);</div>
<div class="line"><a name="l12568"></a><span class="lineno">12568</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l12569"></a><span class="lineno">12569</span>&#160;        }</div>
<div class="line"><a name="l12570"></a><span class="lineno">12570</span>&#160;        <span class="comment">// Early exit if any of the reduction values were deleted during</span></div>
<div class="line"><a name="l12571"></a><span class="lineno">12571</span>&#160;        <span class="comment">// previous vectorization attempts.</span></div>
<div class="line"><a name="l12572"></a><span class="lineno">12572</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(VL, [&amp;V](<a class="code" href="classllvm_1_1Value.html">Value</a> *RedVal) {</div>
<div class="line"><a name="l12573"></a><span class="lineno">12573</span>&#160;              <span class="keyword">auto</span> *RedValI = dyn_cast&lt;Instruction&gt;(RedVal);</div>
<div class="line"><a name="l12574"></a><span class="lineno">12574</span>&#160;              <span class="keywordflow">if</span> (!RedValI)</div>
<div class="line"><a name="l12575"></a><span class="lineno">12575</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l12576"></a><span class="lineno">12576</span>&#160;              <span class="keywordflow">return</span> V.isDeleted(RedValI);</div>
<div class="line"><a name="l12577"></a><span class="lineno">12577</span>&#160;            }))</div>
<div class="line"><a name="l12578"></a><span class="lineno">12578</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l12579"></a><span class="lineno">12579</span>&#160;        V.buildTree(VL, IgnoreList);</div>
<div class="line"><a name="l12580"></a><span class="lineno">12580</span>&#160;        <span class="keywordflow">if</span> (V.isTreeTinyAndNotFullyVectorizable(<span class="comment">/*ForReduction=*/</span><span class="keyword">true</span>)) {</div>
<div class="line"><a name="l12581"></a><span class="lineno">12581</span>&#160;          <span class="keywordflow">if</span> (!AdjustReducedVals())</div>
<div class="line"><a name="l12582"></a><span class="lineno">12582</span>&#160;            V.analyzedReductionVals(VL);</div>
<div class="line"><a name="l12583"></a><span class="lineno">12583</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l12584"></a><span class="lineno">12584</span>&#160;        }</div>
<div class="line"><a name="l12585"></a><span class="lineno">12585</span>&#160;        <span class="keywordflow">if</span> (V.isLoadCombineReductionCandidate(RdxKind)) {</div>
<div class="line"><a name="l12586"></a><span class="lineno">12586</span>&#160;          <span class="keywordflow">if</span> (!AdjustReducedVals())</div>
<div class="line"><a name="l12587"></a><span class="lineno">12587</span>&#160;            V.analyzedReductionVals(VL);</div>
<div class="line"><a name="l12588"></a><span class="lineno">12588</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l12589"></a><span class="lineno">12589</span>&#160;        }</div>
<div class="line"><a name="l12590"></a><span class="lineno">12590</span>&#160;        V.reorderTopToBottom();</div>
<div class="line"><a name="l12591"></a><span class="lineno">12591</span>&#160;        <span class="comment">// No need to reorder the root node at all.</span></div>
<div class="line"><a name="l12592"></a><span class="lineno">12592</span>&#160;        V.reorderBottomToTop(<span class="comment">/*IgnoreReorder=*/</span><span class="keyword">true</span>);</div>
<div class="line"><a name="l12593"></a><span class="lineno">12593</span>&#160;        <span class="comment">// Keep extracted other reduction values, if they are used in the</span></div>
<div class="line"><a name="l12594"></a><span class="lineno">12594</span>&#160;        <span class="comment">// vectorization trees.</span></div>
<div class="line"><a name="l12595"></a><span class="lineno">12595</span>&#160;        BoUpSLP::ExtraValueToDebugLocsMap LocalExternallyUsedValues(</div>
<div class="line"><a name="l12596"></a><span class="lineno">12596</span>&#160;            ExternallyUsedValues);</div>
<div class="line"><a name="l12597"></a><span class="lineno">12597</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Cnt = 0, Sz = ReducedVals.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(); Cnt &lt; Sz; ++Cnt) {</div>
<div class="line"><a name="l12598"></a><span class="lineno">12598</span>&#160;          <span class="keywordflow">if</span> (Cnt == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> || (ShuffledExtracts &amp;&amp; Cnt == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> - 1))</div>
<div class="line"><a name="l12599"></a><span class="lineno">12599</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l12600"></a><span class="lineno">12600</span>&#160;          <a class="code" href="namespacellvm.html#a0b2a153b655ed78a07468297eb4c6256">for_each</a>(ReducedVals[Cnt],</div>
<div class="line"><a name="l12601"></a><span class="lineno">12601</span>&#160;                   [&amp;LocalExternallyUsedValues, &amp;TrackedVals](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l12602"></a><span class="lineno">12602</span>&#160;                     <span class="keywordflow">if</span> (isa&lt;Instruction&gt;(V))</div>
<div class="line"><a name="l12603"></a><span class="lineno">12603</span>&#160;                       LocalExternallyUsedValues[TrackedVals[V]];</div>
<div class="line"><a name="l12604"></a><span class="lineno">12604</span>&#160;                   });</div>
<div class="line"><a name="l12605"></a><span class="lineno">12605</span>&#160;        }</div>
<div class="line"><a name="l12606"></a><span class="lineno">12606</span>&#160;        <span class="comment">// Number of uses of the candidates in the vector of values.</span></div>
<div class="line"><a name="l12607"></a><span class="lineno">12607</span>&#160;        <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;Value *, unsigned&gt;</a> NumUses(Candidates.size());</div>
<div class="line"><a name="l12608"></a><span class="lineno">12608</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Cnt = 0; Cnt &lt; Pos; ++Cnt) {</div>
<div class="line"><a name="l12609"></a><span class="lineno">12609</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *V = Candidates[Cnt];</div>
<div class="line"><a name="l12610"></a><span class="lineno">12610</span>&#160;          ++NumUses.try_emplace(V, 0).first-&gt;getSecond();</div>
<div class="line"><a name="l12611"></a><span class="lineno">12611</span>&#160;        }</div>
<div class="line"><a name="l12612"></a><span class="lineno">12612</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Cnt = Pos + ReduxWidth; Cnt &lt; NumReducedVals; ++Cnt) {</div>
<div class="line"><a name="l12613"></a><span class="lineno">12613</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *V = Candidates[Cnt];</div>
<div class="line"><a name="l12614"></a><span class="lineno">12614</span>&#160;          ++NumUses.try_emplace(V, 0).first-&gt;getSecond();</div>
<div class="line"><a name="l12615"></a><span class="lineno">12615</span>&#160;        }</div>
<div class="line"><a name="l12616"></a><span class="lineno">12616</span>&#160;        <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value *, 4&gt;</a> VLScalars(VL.begin(), VL.end());</div>
<div class="line"><a name="l12617"></a><span class="lineno">12617</span>&#160;        <span class="comment">// Gather externally used values.</span></div>
<div class="line"><a name="l12618"></a><span class="lineno">12618</span>&#160;        <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value *, 4&gt;</a> Visited;</div>
<div class="line"><a name="l12619"></a><span class="lineno">12619</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Cnt = 0; Cnt &lt; Pos; ++Cnt) {</div>
<div class="line"><a name="l12620"></a><span class="lineno">12620</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *RdxVal = Candidates[Cnt];</div>
<div class="line"><a name="l12621"></a><span class="lineno">12621</span>&#160;          <span class="keywordflow">if</span> (!Visited.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(RdxVal).second)</div>
<div class="line"><a name="l12622"></a><span class="lineno">12622</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l12623"></a><span class="lineno">12623</span>&#160;          <span class="comment">// Check if the scalar was vectorized as part of the vectorization</span></div>
<div class="line"><a name="l12624"></a><span class="lineno">12624</span>&#160;          <span class="comment">// tree but not the top node.</span></div>
<div class="line"><a name="l12625"></a><span class="lineno">12625</span>&#160;          <span class="keywordflow">if</span> (!VLScalars.contains(RdxVal) &amp;&amp; V.isVectorized(RdxVal)) {</div>
<div class="line"><a name="l12626"></a><span class="lineno">12626</span>&#160;            LocalExternallyUsedValues[RdxVal];</div>
<div class="line"><a name="l12627"></a><span class="lineno">12627</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l12628"></a><span class="lineno">12628</span>&#160;          }</div>
<div class="line"><a name="l12629"></a><span class="lineno">12629</span>&#160;          <span class="keywordtype">unsigned</span> NumOps = VectorizedVals.lookup(RdxVal) + NumUses[RdxVal];</div>
<div class="line"><a name="l12630"></a><span class="lineno">12630</span>&#160;          <span class="keywordflow">if</span> (NumOps != ReducedValsToOps.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(RdxVal)-&gt;second.size())</div>
<div class="line"><a name="l12631"></a><span class="lineno">12631</span>&#160;            LocalExternallyUsedValues[RdxVal];</div>
<div class="line"><a name="l12632"></a><span class="lineno">12632</span>&#160;        }</div>
<div class="line"><a name="l12633"></a><span class="lineno">12633</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Cnt = Pos + ReduxWidth; Cnt &lt; NumReducedVals; ++Cnt) {</div>
<div class="line"><a name="l12634"></a><span class="lineno">12634</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *RdxVal = Candidates[Cnt];</div>
<div class="line"><a name="l12635"></a><span class="lineno">12635</span>&#160;          <span class="keywordflow">if</span> (!Visited.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(RdxVal).second)</div>
<div class="line"><a name="l12636"></a><span class="lineno">12636</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l12637"></a><span class="lineno">12637</span>&#160;          <span class="comment">// Check if the scalar was vectorized as part of the vectorization</span></div>
<div class="line"><a name="l12638"></a><span class="lineno">12638</span>&#160;          <span class="comment">// tree but not the top node.</span></div>
<div class="line"><a name="l12639"></a><span class="lineno">12639</span>&#160;          <span class="keywordflow">if</span> (!VLScalars.contains(RdxVal) &amp;&amp; V.isVectorized(RdxVal)) {</div>
<div class="line"><a name="l12640"></a><span class="lineno">12640</span>&#160;            LocalExternallyUsedValues[RdxVal];</div>
<div class="line"><a name="l12641"></a><span class="lineno">12641</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l12642"></a><span class="lineno">12642</span>&#160;          }</div>
<div class="line"><a name="l12643"></a><span class="lineno">12643</span>&#160;          <span class="keywordtype">unsigned</span> NumOps = VectorizedVals.lookup(RdxVal) + NumUses[RdxVal];</div>
<div class="line"><a name="l12644"></a><span class="lineno">12644</span>&#160;          <span class="keywordflow">if</span> (NumOps != ReducedValsToOps.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(RdxVal)-&gt;second.size())</div>
<div class="line"><a name="l12645"></a><span class="lineno">12645</span>&#160;            LocalExternallyUsedValues[RdxVal];</div>
<div class="line"><a name="l12646"></a><span class="lineno">12646</span>&#160;        }</div>
<div class="line"><a name="l12647"></a><span class="lineno">12647</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *RdxVal : VL)</div>
<div class="line"><a name="l12648"></a><span class="lineno">12648</span>&#160;          <span class="keywordflow">if</span> (RequiredExtract.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#af74676a3c7447be34bd2c1da76ec0c48">contains</a>(RdxVal))</div>
<div class="line"><a name="l12649"></a><span class="lineno">12649</span>&#160;            LocalExternallyUsedValues[RdxVal];</div>
<div class="line"><a name="l12650"></a><span class="lineno">12650</span>&#160;        V.buildExternalUses(LocalExternallyUsedValues);</div>
<div class="line"><a name="l12651"></a><span class="lineno">12651</span>&#160; </div>
<div class="line"><a name="l12652"></a><span class="lineno">12652</span>&#160;        V.computeMinimumValueSizes();</div>
<div class="line"><a name="l12653"></a><span class="lineno">12653</span>&#160; </div>
<div class="line"><a name="l12654"></a><span class="lineno">12654</span>&#160;        <span class="comment">// Intersect the fast-math-flags from all reduction operations.</span></div>
<div class="line"><a name="l12655"></a><span class="lineno">12655</span>&#160;        <a class="code" href="classllvm_1_1FastMathFlags.html">FastMathFlags</a> RdxFMF;</div>
<div class="line"><a name="l12656"></a><span class="lineno">12656</span>&#160;        RdxFMF.<a class="code" href="classllvm_1_1FastMathFlags.html#a871def72ec0294092d71c3370c70228e">set</a>();</div>
<div class="line"><a name="l12657"></a><span class="lineno">12657</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *U : IgnoreList)</div>
<div class="line"><a name="l12658"></a><span class="lineno">12658</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">auto</span> *FPMO = dyn_cast&lt;FPMathOperator&gt;(U))</div>
<div class="line"><a name="l12659"></a><span class="lineno">12659</span>&#160;            RdxFMF &amp;= FPMO-&gt;getFastMathFlags();</div>
<div class="line"><a name="l12660"></a><span class="lineno">12660</span>&#160;        <span class="comment">// Estimate cost.</span></div>
<div class="line"><a name="l12661"></a><span class="lineno">12661</span>&#160;        <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> TreeCost = V.getTreeCost(VL);</div>
<div class="line"><a name="l12662"></a><span class="lineno">12662</span>&#160;        <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> ReductionCost =</div>
<div class="line"><a name="l12663"></a><span class="lineno">12663</span>&#160;            getReductionCost(<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, VL, ReduxWidth, RdxFMF);</div>
<div class="line"><a name="l12664"></a><span class="lineno">12664</span>&#160;        <span class="keywordflow">if</span> (V.isVectorizedFirstNode() &amp;&amp; isa&lt;LoadInst&gt;(VL.front())) {</div>
<div class="line"><a name="l12665"></a><span class="lineno">12665</span>&#160;          <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *MainOp = V.getFirstNodeMainOp();</div>
<div class="line"><a name="l12666"></a><span class="lineno">12666</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : VL) {</div>
<div class="line"><a name="l12667"></a><span class="lineno">12667</span>&#160;            <span class="keyword">auto</span> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a> = dyn_cast&lt;LoadInst&gt;(V);</div>
<div class="line"><a name="l12668"></a><span class="lineno">12668</span>&#160;            <span class="comment">// Add the costs of scalar GEP pointers, to be removed from the</span></div>
<div class="line"><a name="l12669"></a><span class="lineno">12669</span>&#160;            <span class="comment">// code.</span></div>
<div class="line"><a name="l12670"></a><span class="lineno">12670</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a> || <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a> == MainOp)</div>
<div class="line"><a name="l12671"></a><span class="lineno">12671</span>&#160;              <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l12672"></a><span class="lineno">12672</span>&#160;            <span class="keyword">auto</span> *<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = dyn_cast&lt;GetElementPtrInst&gt;(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>-&gt;getPointerOperand());</div>
<div class="line"><a name="l12673"></a><span class="lineno">12673</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> || !<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;hasOneUse() || <a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;hasAllConstantIndices())</div>
<div class="line"><a name="l12674"></a><span class="lineno">12674</span>&#160;              <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l12675"></a><span class="lineno">12675</span>&#160;            TreeCost -= <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a9679969ae87f8a08d5f6948be6cf7210">getArithmeticInstrCost</a>(</div>
<div class="line"><a name="l12676"></a><span class="lineno">12676</span>&#160;                <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec">Instruction::Add</a>, <a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getType(), <a class="code" href="classllvm_1_1TargetTransformInfo.html#a706f223f760b55668fbae74202b816bba59b32ea7b6f10564abd40ad90602ca5b">TTI::TCK_RecipThroughput</a>);</div>
<div class="line"><a name="l12677"></a><span class="lineno">12677</span>&#160;          }</div>
<div class="line"><a name="l12678"></a><span class="lineno">12678</span>&#160;        }</div>
<div class="line"><a name="l12679"></a><span class="lineno">12679</span>&#160;        <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> <a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a> = TreeCost + ReductionCost;</div>
<div class="line"><a name="l12680"></a><span class="lineno">12680</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Found cost = &quot;</span> &lt;&lt; Cost &lt;&lt; <span class="stringliteral">&quot; for reduction\n&quot;</span>);</div>
<div class="line"><a name="l12681"></a><span class="lineno">12681</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">Cost</a>.isValid())</div>
<div class="line"><a name="l12682"></a><span class="lineno">12682</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l12683"></a><span class="lineno">12683</span>&#160;        <span class="keywordflow">if</span> (Cost &gt;= -<a class="code" href="SLPVectorizer_8cpp.html#ae3295545af0d12ee89d3102df3d45b06">SLPCostThreshold</a>) {</div>
<div class="line"><a name="l12684"></a><span class="lineno">12684</span>&#160;          V.getORE()-&gt;emit([&amp;]() {</div>
<div class="line"><a name="l12685"></a><span class="lineno">12685</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1OptimizationRemarkMissed.html">OptimizationRemarkMissed</a>(</div>
<div class="line"><a name="l12686"></a><span class="lineno">12686</span>&#160;                       <a class="code" href="SLPVectorizer_8cpp.html#a274654b7f5932cae6a71a113322481be">SV_NAME</a>, <span class="stringliteral">&quot;HorSLPNotBeneficial&quot;</span>,</div>
<div class="line"><a name="l12687"></a><span class="lineno">12687</span>&#160;                       ReducedValsToOps.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(VL[0])-&gt;second.front())</div>
<div class="line"><a name="l12688"></a><span class="lineno">12688</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot;Vectorizing horizontal reduction is possible &quot;</span></div>
<div class="line"><a name="l12689"></a><span class="lineno">12689</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot;but not beneficial with cost &quot;</span> &lt;&lt; <a class="code" href="namespacellvm_1_1ore.html#a8f5533240c6722d987a2443cba42019d">ore::NV</a>(<span class="stringliteral">&quot;Cost&quot;</span>, Cost)</div>
<div class="line"><a name="l12690"></a><span class="lineno">12690</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot; and threshold &quot;</span></div>
<div class="line"><a name="l12691"></a><span class="lineno">12691</span>&#160;                   &lt;&lt; <a class="code" href="namespacellvm_1_1ore.html#a8f5533240c6722d987a2443cba42019d">ore::NV</a>(<span class="stringliteral">&quot;Threshold&quot;</span>, -<a class="code" href="SLPVectorizer_8cpp.html#ae3295545af0d12ee89d3102df3d45b06">SLPCostThreshold</a>);</div>
<div class="line"><a name="l12692"></a><span class="lineno">12692</span>&#160;          });</div>
<div class="line"><a name="l12693"></a><span class="lineno">12693</span>&#160;          <span class="keywordflow">if</span> (!AdjustReducedVals())</div>
<div class="line"><a name="l12694"></a><span class="lineno">12694</span>&#160;            V.analyzedReductionVals(VL);</div>
<div class="line"><a name="l12695"></a><span class="lineno">12695</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l12696"></a><span class="lineno">12696</span>&#160;        }</div>
<div class="line"><a name="l12697"></a><span class="lineno">12697</span>&#160; </div>
<div class="line"><a name="l12698"></a><span class="lineno">12698</span>&#160;        <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Vectorizing horizontal reduction at cost:&quot;</span></div>
<div class="line"><a name="l12699"></a><span class="lineno">12699</span>&#160;                          &lt;&lt; Cost &lt;&lt; <span class="stringliteral">&quot;. (HorRdx)\n&quot;</span>);</div>
<div class="line"><a name="l12700"></a><span class="lineno">12700</span>&#160;        V.getORE()-&gt;emit([&amp;]() {</div>
<div class="line"><a name="l12701"></a><span class="lineno">12701</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1OptimizationRemark.html">OptimizationRemark</a>(</div>
<div class="line"><a name="l12702"></a><span class="lineno">12702</span>&#160;                     <a class="code" href="SLPVectorizer_8cpp.html#a274654b7f5932cae6a71a113322481be">SV_NAME</a>, <span class="stringliteral">&quot;VectorizedHorizontalReduction&quot;</span>,</div>
<div class="line"><a name="l12703"></a><span class="lineno">12703</span>&#160;                     ReducedValsToOps.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(VL[0])-&gt;second.front())</div>
<div class="line"><a name="l12704"></a><span class="lineno">12704</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;Vectorized horizontal reduction with cost &quot;</span></div>
<div class="line"><a name="l12705"></a><span class="lineno">12705</span>&#160;                 &lt;&lt; <a class="code" href="namespacellvm_1_1ore.html#a8f5533240c6722d987a2443cba42019d">ore::NV</a>(<span class="stringliteral">&quot;Cost&quot;</span>, Cost) &lt;&lt; <span class="stringliteral">&quot; and with tree size &quot;</span></div>
<div class="line"><a name="l12706"></a><span class="lineno">12706</span>&#160;                 &lt;&lt; <a class="code" href="namespacellvm_1_1ore.html#a8f5533240c6722d987a2443cba42019d">ore::NV</a>(<span class="stringliteral">&quot;TreeSize&quot;</span>, V.getTreeSize());</div>
<div class="line"><a name="l12707"></a><span class="lineno">12707</span>&#160;        });</div>
<div class="line"><a name="l12708"></a><span class="lineno">12708</span>&#160; </div>
<div class="line"><a name="l12709"></a><span class="lineno">12709</span>&#160;        <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.setFastMathFlags(RdxFMF);</div>
<div class="line"><a name="l12710"></a><span class="lineno">12710</span>&#160; </div>
<div class="line"><a name="l12711"></a><span class="lineno">12711</span>&#160;        <span class="comment">// Emit a reduction. If the root is a select (min/max idiom), the insert</span></div>
<div class="line"><a name="l12712"></a><span class="lineno">12712</span>&#160;        <span class="comment">// point is the compare condition of that select.</span></div>
<div class="line"><a name="l12713"></a><span class="lineno">12713</span>&#160;        <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *RdxRootInst = cast&lt;Instruction&gt;(ReductionRoot);</div>
<div class="line"><a name="l12714"></a><span class="lineno">12714</span>&#160;        <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *InsertPt = RdxRootInst;</div>
<div class="line"><a name="l12715"></a><span class="lineno">12715</span>&#160;        <span class="keywordflow">if</span> (IsCmpSelMinMax)</div>
<div class="line"><a name="l12716"></a><span class="lineno">12716</span>&#160;          InsertPt = GetCmpForMinMaxReduction(RdxRootInst);</div>
<div class="line"><a name="l12717"></a><span class="lineno">12717</span>&#160; </div>
<div class="line"><a name="l12718"></a><span class="lineno">12718</span>&#160;        <span class="comment">// Vectorize a tree.</span></div>
<div class="line"><a name="l12719"></a><span class="lineno">12719</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *VectorizedRoot =</div>
<div class="line"><a name="l12720"></a><span class="lineno">12720</span>&#160;            V.vectorizeTree(LocalExternallyUsedValues, InsertPt);</div>
<div class="line"><a name="l12721"></a><span class="lineno">12721</span>&#160; </div>
<div class="line"><a name="l12722"></a><span class="lineno">12722</span>&#160;        <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(InsertPt);</div>
<div class="line"><a name="l12723"></a><span class="lineno">12723</span>&#160; </div>
<div class="line"><a name="l12724"></a><span class="lineno">12724</span>&#160;        <span class="comment">// To prevent poison from leaking across what used to be sequential,</span></div>
<div class="line"><a name="l12725"></a><span class="lineno">12725</span>&#160;        <span class="comment">// safe, scalar boolean logic operations, the reduction operand must be</span></div>
<div class="line"><a name="l12726"></a><span class="lineno">12726</span>&#160;        <span class="comment">// frozen.</span></div>
<div class="line"><a name="l12727"></a><span class="lineno">12727</span>&#160;        <span class="keywordflow">if</span> (isBoolLogicOp(RdxRootInst))</div>
<div class="line"><a name="l12728"></a><span class="lineno">12728</span>&#160;          VectorizedRoot = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateFreeze(VectorizedRoot);</div>
<div class="line"><a name="l12729"></a><span class="lineno">12729</span>&#160; </div>
<div class="line"><a name="l12730"></a><span class="lineno">12730</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *ReducedSubTree =</div>
<div class="line"><a name="l12731"></a><span class="lineno">12731</span>&#160;            emitReduction(VectorizedRoot, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, ReduxWidth, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>);</div>
<div class="line"><a name="l12732"></a><span class="lineno">12732</span>&#160; </div>
<div class="line"><a name="l12733"></a><span class="lineno">12733</span>&#160;        <span class="keywordflow">if</span> (!VectorizedTree) {</div>
<div class="line"><a name="l12734"></a><span class="lineno">12734</span>&#160;          <span class="comment">// Initialize the final value in the reduction.</span></div>
<div class="line"><a name="l12735"></a><span class="lineno">12735</span>&#160;          VectorizedTree = ReducedSubTree;</div>
<div class="line"><a name="l12736"></a><span class="lineno">12736</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l12737"></a><span class="lineno">12737</span>&#160;          <span class="comment">// Update the final value in the reduction.</span></div>
<div class="line"><a name="l12738"></a><span class="lineno">12738</span>&#160;          <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetCurrentDebugLocation(</div>
<div class="line"><a name="l12739"></a><span class="lineno">12739</span>&#160;              cast&lt;Instruction&gt;(ReductionOps.front().front())-&gt;getDebugLoc());</div>
<div class="line"><a name="l12740"></a><span class="lineno">12740</span>&#160;          VectorizedTree = createOp(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, RdxKind, VectorizedTree,</div>
<div class="line"><a name="l12741"></a><span class="lineno">12741</span>&#160;                                    ReducedSubTree, <span class="stringliteral">&quot;op.rdx&quot;</span>, ReductionOps);</div>
<div class="line"><a name="l12742"></a><span class="lineno">12742</span>&#160;        }</div>
<div class="line"><a name="l12743"></a><span class="lineno">12743</span>&#160;        <span class="comment">// Count vectorized reduced values to exclude them from final reduction.</span></div>
<div class="line"><a name="l12744"></a><span class="lineno">12744</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *RdxVal : VL) {</div>
<div class="line"><a name="l12745"></a><span class="lineno">12745</span>&#160;          ++VectorizedVals.try_emplace(TrackedToOrig.find(RdxVal)-&gt;second, 0)</div>
<div class="line"><a name="l12746"></a><span class="lineno">12746</span>&#160;                .first-&gt;getSecond();</div>
<div class="line"><a name="l12747"></a><span class="lineno">12747</span>&#160;          <span class="keywordflow">if</span> (!V.isVectorized(RdxVal))</div>
<div class="line"><a name="l12748"></a><span class="lineno">12748</span>&#160;            RequiredExtract.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(RdxVal);</div>
<div class="line"><a name="l12749"></a><span class="lineno">12749</span>&#160;        }</div>
<div class="line"><a name="l12750"></a><span class="lineno">12750</span>&#160;        Pos += ReduxWidth;</div>
<div class="line"><a name="l12751"></a><span class="lineno">12751</span>&#160;        Start = Pos;</div>
<div class="line"><a name="l12752"></a><span class="lineno">12752</span>&#160;        ReduxWidth = <a class="code" href="namespacellvm.html#ae22967d11b695d268992470debfae4b2">llvm::bit_floor</a>(NumReducedVals - Pos);</div>
<div class="line"><a name="l12753"></a><span class="lineno">12753</span>&#160;      }</div>
<div class="line"><a name="l12754"></a><span class="lineno">12754</span>&#160;    }</div>
<div class="line"><a name="l12755"></a><span class="lineno">12755</span>&#160;    <span class="keywordflow">if</span> (VectorizedTree) {</div>
<div class="line"><a name="l12756"></a><span class="lineno">12756</span>&#160;      <span class="comment">// Reorder operands of bool logical op in the natural order to avoid</span></div>
<div class="line"><a name="l12757"></a><span class="lineno">12757</span>&#160;      <span class="comment">// possible problem with poison propagation. If not possible to reorder</span></div>
<div class="line"><a name="l12758"></a><span class="lineno">12758</span>&#160;      <span class="comment">// (both operands are originally RHS), emit an extra freeze instruction</span></div>
<div class="line"><a name="l12759"></a><span class="lineno">12759</span>&#160;      <span class="comment">// for the LHS operand.</span></div>
<div class="line"><a name="l12760"></a><span class="lineno">12760</span>&#160;      <span class="comment">//I.e., if we have original code like this:</span></div>
<div class="line"><a name="l12761"></a><span class="lineno">12761</span>&#160;      <span class="comment">// RedOp1 = select i1 ?, i1 LHS, i1 false</span></div>
<div class="line"><a name="l12762"></a><span class="lineno">12762</span>&#160;      <span class="comment">// RedOp2 = select i1 RHS, i1 ?, i1 false</span></div>
<div class="line"><a name="l12763"></a><span class="lineno">12763</span>&#160; </div>
<div class="line"><a name="l12764"></a><span class="lineno">12764</span>&#160;      <span class="comment">// Then, we swap LHS/RHS to create a new op that matches the poison</span></div>
<div class="line"><a name="l12765"></a><span class="lineno">12765</span>&#160;      <span class="comment">// semantics of the original code.</span></div>
<div class="line"><a name="l12766"></a><span class="lineno">12766</span>&#160; </div>
<div class="line"><a name="l12767"></a><span class="lineno">12767</span>&#160;      <span class="comment">// If we have original code like this and both values could be poison:</span></div>
<div class="line"><a name="l12768"></a><span class="lineno">12768</span>&#160;      <span class="comment">// RedOp1 = select i1 ?, i1 LHS, i1 false</span></div>
<div class="line"><a name="l12769"></a><span class="lineno">12769</span>&#160;      <span class="comment">// RedOp2 = select i1 ?, i1 RHS, i1 false</span></div>
<div class="line"><a name="l12770"></a><span class="lineno">12770</span>&#160; </div>
<div class="line"><a name="l12771"></a><span class="lineno">12771</span>&#160;      <span class="comment">// Then, we must freeze LHS in the new op.</span></div>
<div class="line"><a name="l12772"></a><span class="lineno">12772</span>&#160;      <span class="keyword">auto</span> &amp;&amp;FixBoolLogicalOps =</div>
<div class="line"><a name="l12773"></a><span class="lineno">12773</span>&#160;          [&amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, VectorizedTree](<a class="code" href="classllvm_1_1Value.html">Value</a> *&amp;<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *&amp;<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>,</div>
<div class="line"><a name="l12774"></a><span class="lineno">12774</span>&#160;                                     <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *RedOp1, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *RedOp2) {</div>
<div class="line"><a name="l12775"></a><span class="lineno">12775</span>&#160;            <span class="keywordflow">if</span> (!isBoolLogicOp(RedOp1))</div>
<div class="line"><a name="l12776"></a><span class="lineno">12776</span>&#160;              <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l12777"></a><span class="lineno">12777</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> == VectorizedTree || getRdxOperand(RedOp1, 0) == <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> ||</div>
<div class="line"><a name="l12778"></a><span class="lineno">12778</span>&#160;                <a class="code" href="namespacellvm.html#ae058c4750de2c85f12a1f96841ac9ae3">isGuaranteedNotToBePoison</a>(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>))</div>
<div class="line"><a name="l12779"></a><span class="lineno">12779</span>&#160;              <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l12780"></a><span class="lineno">12780</span>&#160;            <span class="keywordflow">if</span> (!isBoolLogicOp(RedOp2))</div>
<div class="line"><a name="l12781"></a><span class="lineno">12781</span>&#160;              <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l12782"></a><span class="lineno">12782</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> == VectorizedTree || getRdxOperand(RedOp2, 0) == <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> ||</div>
<div class="line"><a name="l12783"></a><span class="lineno">12783</span>&#160;                <a class="code" href="namespacellvm.html#ae058c4750de2c85f12a1f96841ac9ae3">isGuaranteedNotToBePoison</a>(<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>)) {</div>
<div class="line"><a name="l12784"></a><span class="lineno">12784</span>&#160;              <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</div>
<div class="line"><a name="l12785"></a><span class="lineno">12785</span>&#160;              <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l12786"></a><span class="lineno">12786</span>&#160;            }</div>
<div class="line"><a name="l12787"></a><span class="lineno">12787</span>&#160;            <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateFreeze(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>);</div>
<div class="line"><a name="l12788"></a><span class="lineno">12788</span>&#160;          };</div>
<div class="line"><a name="l12789"></a><span class="lineno">12789</span>&#160;      <span class="comment">// Finish the reduction.</span></div>
<div class="line"><a name="l12790"></a><span class="lineno">12790</span>&#160;      <span class="comment">// Need to add extra arguments and not vectorized possible reduction</span></div>
<div class="line"><a name="l12791"></a><span class="lineno">12791</span>&#160;      <span class="comment">// values.</span></div>
<div class="line"><a name="l12792"></a><span class="lineno">12792</span>&#160;      <span class="comment">// Try to avoid dependencies between the scalar remainders after</span></div>
<div class="line"><a name="l12793"></a><span class="lineno">12793</span>&#160;      <span class="comment">// reductions.</span></div>
<div class="line"><a name="l12794"></a><span class="lineno">12794</span>&#160;      <span class="keyword">auto</span> &amp;&amp;FinalGen =</div>
<div class="line"><a name="l12795"></a><span class="lineno">12795</span>&#160;          [<span class="keyword">this</span>, &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, &amp;TrackedVals, &amp;FixBoolLogicalOps](</div>
<div class="line"><a name="l12796"></a><span class="lineno">12796</span>&#160;              <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;std::pair&lt;Instruction *, Value *&gt;</a>&gt; InstVals) {</div>
<div class="line"><a name="l12797"></a><span class="lineno">12797</span>&#160;            <span class="keywordtype">unsigned</span> Sz = InstVals.size();</div>
<div class="line"><a name="l12798"></a><span class="lineno">12798</span>&#160;            <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;Instruction *, Value *&gt;</a>&gt; ExtraReds(Sz / 2 +</div>
<div class="line"><a name="l12799"></a><span class="lineno">12799</span>&#160;                                                                     Sz % 2);</div>
<div class="line"><a name="l12800"></a><span class="lineno">12800</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = (Sz / 2) * 2; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> += 2) {</div>
<div class="line"><a name="l12801"></a><span class="lineno">12801</span>&#160;              <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *RedOp = InstVals[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> + 1].first;</div>
<div class="line"><a name="l12802"></a><span class="lineno">12802</span>&#160;              <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetCurrentDebugLocation(RedOp-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4f3bf98b5054831b608852e33427814">getDebugLoc</a>());</div>
<div class="line"><a name="l12803"></a><span class="lineno">12803</span>&#160;              <a class="code" href="classllvm_1_1Value.html">Value</a> *RdxVal1 = InstVals[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].second;</div>
<div class="line"><a name="l12804"></a><span class="lineno">12804</span>&#160;              <a class="code" href="classllvm_1_1Value.html">Value</a> *StableRdxVal1 = RdxVal1;</div>
<div class="line"><a name="l12805"></a><span class="lineno">12805</span>&#160;              <span class="keyword">auto</span> It1 = TrackedVals.find(RdxVal1);</div>
<div class="line"><a name="l12806"></a><span class="lineno">12806</span>&#160;              <span class="keywordflow">if</span> (It1 != TrackedVals.end())</div>
<div class="line"><a name="l12807"></a><span class="lineno">12807</span>&#160;                StableRdxVal1 = It1-&gt;second;</div>
<div class="line"><a name="l12808"></a><span class="lineno">12808</span>&#160;              <a class="code" href="classllvm_1_1Value.html">Value</a> *RdxVal2 = InstVals[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> + 1].second;</div>
<div class="line"><a name="l12809"></a><span class="lineno">12809</span>&#160;              <a class="code" href="classllvm_1_1Value.html">Value</a> *StableRdxVal2 = RdxVal2;</div>
<div class="line"><a name="l12810"></a><span class="lineno">12810</span>&#160;              <span class="keyword">auto</span> It2 = TrackedVals.find(RdxVal2);</div>
<div class="line"><a name="l12811"></a><span class="lineno">12811</span>&#160;              <span class="keywordflow">if</span> (It2 != TrackedVals.end())</div>
<div class="line"><a name="l12812"></a><span class="lineno">12812</span>&#160;                StableRdxVal2 = It2-&gt;second;</div>
<div class="line"><a name="l12813"></a><span class="lineno">12813</span>&#160;              <span class="comment">// To prevent poison from leaking across what used to be</span></div>
<div class="line"><a name="l12814"></a><span class="lineno">12814</span>&#160;              <span class="comment">// sequential, safe, scalar boolean logic operations, the</span></div>
<div class="line"><a name="l12815"></a><span class="lineno">12815</span>&#160;              <span class="comment">// reduction operand must be frozen.</span></div>
<div class="line"><a name="l12816"></a><span class="lineno">12816</span>&#160;              FixBoolLogicalOps(StableRdxVal1, StableRdxVal2, InstVals[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].first,</div>
<div class="line"><a name="l12817"></a><span class="lineno">12817</span>&#160;                                RedOp);</div>
<div class="line"><a name="l12818"></a><span class="lineno">12818</span>&#160;              <a class="code" href="classllvm_1_1Value.html">Value</a> *ExtraRed = createOp(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, RdxKind, StableRdxVal1,</div>
<div class="line"><a name="l12819"></a><span class="lineno">12819</span>&#160;                                         StableRdxVal2, <span class="stringliteral">&quot;op.rdx&quot;</span>, ReductionOps);</div>
<div class="line"><a name="l12820"></a><span class="lineno">12820</span>&#160;              ExtraReds[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> / 2] = std::make_pair(InstVals[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].first, ExtraRed);</div>
<div class="line"><a name="l12821"></a><span class="lineno">12821</span>&#160;            }</div>
<div class="line"><a name="l12822"></a><span class="lineno">12822</span>&#160;            <span class="keywordflow">if</span> (Sz % 2 == 1)</div>
<div class="line"><a name="l12823"></a><span class="lineno">12823</span>&#160;              ExtraReds[Sz / 2] = InstVals.back();</div>
<div class="line"><a name="l12824"></a><span class="lineno">12824</span>&#160;            <span class="keywordflow">return</span> ExtraReds;</div>
<div class="line"><a name="l12825"></a><span class="lineno">12825</span>&#160;          };</div>
<div class="line"><a name="l12826"></a><span class="lineno">12826</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;Instruction *, Value *&gt;</a>&gt; ExtraReductions;</div>
<div class="line"><a name="l12827"></a><span class="lineno">12827</span>&#160;      ExtraReductions.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>(cast&lt;Instruction&gt;(ReductionRoot),</div>
<div class="line"><a name="l12828"></a><span class="lineno">12828</span>&#160;                                   VectorizedTree);</div>
<div class="line"><a name="l12829"></a><span class="lineno">12829</span>&#160;      <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value *, 8&gt;</a> Visited;</div>
<div class="line"><a name="l12830"></a><span class="lineno">12830</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> Candidates : ReducedVals) {</div>
<div class="line"><a name="l12831"></a><span class="lineno">12831</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *RdxVal : Candidates) {</div>
<div class="line"><a name="l12832"></a><span class="lineno">12832</span>&#160;          <span class="keywordflow">if</span> (!Visited.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(RdxVal).second)</div>
<div class="line"><a name="l12833"></a><span class="lineno">12833</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l12834"></a><span class="lineno">12834</span>&#160;          <span class="keywordtype">unsigned</span> NumOps = VectorizedVals.lookup(RdxVal);</div>
<div class="line"><a name="l12835"></a><span class="lineno">12835</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *RedOp :</div>
<div class="line"><a name="l12836"></a><span class="lineno">12836</span>&#160;               <a class="code" href="namespacellvm.html#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(ReducedValsToOps.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(RdxVal)-&gt;second)</div>
<div class="line"><a name="l12837"></a><span class="lineno">12837</span>&#160;                   .drop_back(NumOps))</div>
<div class="line"><a name="l12838"></a><span class="lineno">12838</span>&#160;            ExtraReductions.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>(RedOp, RdxVal);</div>
<div class="line"><a name="l12839"></a><span class="lineno">12839</span>&#160;        }</div>
<div class="line"><a name="l12840"></a><span class="lineno">12840</span>&#160;      }</div>
<div class="line"><a name="l12841"></a><span class="lineno">12841</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Pair : ExternallyUsedValues) {</div>
<div class="line"><a name="l12842"></a><span class="lineno">12842</span>&#160;        <span class="comment">// Add each externally used value to the final reduction.</span></div>
<div class="line"><a name="l12843"></a><span class="lineno">12843</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Pair.second)</div>
<div class="line"><a name="l12844"></a><span class="lineno">12844</span>&#160;          ExtraReductions.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Pair.first);</div>
<div class="line"><a name="l12845"></a><span class="lineno">12845</span>&#160;      }</div>
<div class="line"><a name="l12846"></a><span class="lineno">12846</span>&#160;      <span class="comment">// Iterate through all not-vectorized reduction values/extra arguments.</span></div>
<div class="line"><a name="l12847"></a><span class="lineno">12847</span>&#160;      <span class="keywordflow">while</span> (ExtraReductions.size() &gt; 1) {</div>
<div class="line"><a name="l12848"></a><span class="lineno">12848</span>&#160;        VectorizedTree = ExtraReductions.front().second;</div>
<div class="line"><a name="l12849"></a><span class="lineno">12849</span>&#160;        <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;Instruction *, Value *&gt;</a>&gt; NewReds =</div>
<div class="line"><a name="l12850"></a><span class="lineno">12850</span>&#160;            FinalGen(ExtraReductions);</div>
<div class="line"><a name="l12851"></a><span class="lineno">12851</span>&#160;        ExtraReductions.<a class="code" href="classllvm_1_1SmallVectorImpl.html#abd962b7b01f49ce61ea41ee10c49e313">swap</a>(NewReds);</div>
<div class="line"><a name="l12852"></a><span class="lineno">12852</span>&#160;      }</div>
<div class="line"><a name="l12853"></a><span class="lineno">12853</span>&#160;      VectorizedTree = ExtraReductions.front().second;</div>
<div class="line"><a name="l12854"></a><span class="lineno">12854</span>&#160; </div>
<div class="line"><a name="l12855"></a><span class="lineno">12855</span>&#160;      ReductionRoot-&gt;replaceAllUsesWith(VectorizedTree);</div>
<div class="line"><a name="l12856"></a><span class="lineno">12856</span>&#160; </div>
<div class="line"><a name="l12857"></a><span class="lineno">12857</span>&#160;      <span class="comment">// The original scalar reduction is expected to have no remaining</span></div>
<div class="line"><a name="l12858"></a><span class="lineno">12858</span>&#160;      <span class="comment">// uses outside the reduction tree itself.  Assert that we got this</span></div>
<div class="line"><a name="l12859"></a><span class="lineno">12859</span>&#160;      <span class="comment">// correct, replace internal uses with undef, and mark for eventual</span></div>
<div class="line"><a name="l12860"></a><span class="lineno">12860</span>&#160;      <span class="comment">// deletion.</span></div>
<div class="line"><a name="l12861"></a><span class="lineno">12861</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l12862"></a><span class="lineno">12862</span>&#160;      <a class="code" href="classllvm_1_1SmallSet.html">SmallSet&lt;Value *, 4&gt;</a> IgnoreSet;</div>
<div class="line"><a name="l12863"></a><span class="lineno">12863</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> RdxOps : ReductionOps)</div>
<div class="line"><a name="l12864"></a><span class="lineno">12864</span>&#160;        IgnoreSet.<a class="code" href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">insert</a>(RdxOps.begin(), RdxOps.end());</div>
<div class="line"><a name="l12865"></a><span class="lineno">12865</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l12866"></a><span class="lineno">12866</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> RdxOps : ReductionOps) {</div>
<div class="line"><a name="l12867"></a><span class="lineno">12867</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ARMLowOverheadLoops_8cpp.html#aee9acb24ef4f057644a7cf7217922eaa">Ignore</a> : RdxOps) {</div>
<div class="line"><a name="l12868"></a><span class="lineno">12868</span>&#160;          <span class="keywordflow">if</span> (!<a class="code" href="ARMLowOverheadLoops_8cpp.html#aee9acb24ef4f057644a7cf7217922eaa">Ignore</a>)</div>
<div class="line"><a name="l12869"></a><span class="lineno">12869</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l12870"></a><span class="lineno">12870</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l12871"></a><span class="lineno">12871</span>&#160;          <span class="keywordflow">for</span> (<span class="keyword">auto</span> *U : <a class="code" href="ARMLowOverheadLoops_8cpp.html#aee9acb24ef4f057644a7cf7217922eaa">Ignore</a>-&gt;users()) {</div>
<div class="line"><a name="l12872"></a><span class="lineno">12872</span>&#160;            <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IgnoreSet.<a class="code" href="classllvm_1_1SmallSet.html#a2a98f19750ba941ce791b75ca6d77e48">count</a>(U) &amp;&amp;</div>
<div class="line"><a name="l12873"></a><span class="lineno">12873</span>&#160;                   <span class="stringliteral">&quot;All users must be either in the reduction ops list.&quot;</span>);</div>
<div class="line"><a name="l12874"></a><span class="lineno">12874</span>&#160;          }</div>
<div class="line"><a name="l12875"></a><span class="lineno">12875</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l12876"></a><span class="lineno">12876</span>&#160;          <span class="keywordflow">if</span> (!<a class="code" href="ARMLowOverheadLoops_8cpp.html#aee9acb24ef4f057644a7cf7217922eaa">Ignore</a>-&gt;use_empty()) {</div>
<div class="line"><a name="l12877"></a><span class="lineno">12877</span>&#160;            <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1RegState.html#aef4cc0c855dc833e2a9d58a50703320dab502f975742e9bff6d6dd7b49439b806">Undef</a> = <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(<a class="code" href="ARMLowOverheadLoops_8cpp.html#aee9acb24ef4f057644a7cf7217922eaa">Ignore</a>-&gt;getType());</div>
<div class="line"><a name="l12878"></a><span class="lineno">12878</span>&#160;            <a class="code" href="ARMLowOverheadLoops_8cpp.html#aee9acb24ef4f057644a7cf7217922eaa">Ignore</a>-&gt;replaceAllUsesWith(<a class="code" href="namespacellvm_1_1RegState.html#aef4cc0c855dc833e2a9d58a50703320dab502f975742e9bff6d6dd7b49439b806">Undef</a>);</div>
<div class="line"><a name="l12879"></a><span class="lineno">12879</span>&#160;          }</div>
<div class="line"><a name="l12880"></a><span class="lineno">12880</span>&#160;          V.eraseInstruction(cast&lt;Instruction&gt;(<a class="code" href="ARMLowOverheadLoops_8cpp.html#aee9acb24ef4f057644a7cf7217922eaa">Ignore</a>));</div>
<div class="line"><a name="l12881"></a><span class="lineno">12881</span>&#160;        }</div>
<div class="line"><a name="l12882"></a><span class="lineno">12882</span>&#160;      }</div>
<div class="line"><a name="l12883"></a><span class="lineno">12883</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!CheckForReusedReductionOps) {</div>
<div class="line"><a name="l12884"></a><span class="lineno">12884</span>&#160;      <span class="keywordflow">for</span> (ReductionOpsType &amp;RdxOps : ReductionOps)</div>
<div class="line"><a name="l12885"></a><span class="lineno">12885</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *RdxOp : RdxOps)</div>
<div class="line"><a name="l12886"></a><span class="lineno">12886</span>&#160;          V.analyzedReductionRoot(cast&lt;Instruction&gt;(RdxOp));</div>
<div class="line"><a name="l12887"></a><span class="lineno">12887</span>&#160;    }</div>
<div class="line"><a name="l12888"></a><span class="lineno">12888</span>&#160;    <span class="keywordflow">return</span> VectorizedTree;</div>
<div class="line"><a name="l12889"></a><span class="lineno">12889</span>&#160;  }</div>
<div class="line"><a name="l12890"></a><span class="lineno">12890</span>&#160; </div>
<div class="line"><a name="l12891"></a><span class="lineno">12891</span>&#160;<span class="keyword">private</span>:<span class="comment"></span></div>
<div class="line"><a name="l12892"></a><span class="lineno">12892</span>&#160;<span class="comment">  /// Calculate the cost of a reduction.</span></div>
<div class="line"><a name="l12893"></a><span class="lineno">12893</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> getReductionCost(<a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> *<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>,</div>
<div class="line"><a name="l12894"></a><span class="lineno">12894</span>&#160;                                   <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> ReducedVals,</div>
<div class="line"><a name="l12895"></a><span class="lineno">12895</span>&#160;                                   <span class="keywordtype">unsigned</span> ReduxWidth, <a class="code" href="classllvm_1_1FastMathFlags.html">FastMathFlags</a> FMF) {</div>
<div class="line"><a name="l12896"></a><span class="lineno">12896</span>&#160;    <a class="code" href="classllvm_1_1TargetTransformInfo.html#a706f223f760b55668fbae74202b816bb">TTI::TargetCostKind</a> <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a> = <a class="code" href="classllvm_1_1TargetTransformInfo.html#a706f223f760b55668fbae74202b816bba59b32ea7b6f10564abd40ad90602ca5b">TTI::TCK_RecipThroughput</a>;</div>
<div class="line"><a name="l12897"></a><span class="lineno">12897</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *FirstReducedVal = ReducedVals.<a class="code" href="classllvm_1_1ArrayRef.html#a6bc2b53fce3b1d8975eea027d8a8eb90">front</a>();</div>
<div class="line"><a name="l12898"></a><span class="lineno">12898</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *ScalarTy = FirstReducedVal-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l12899"></a><span class="lineno">12899</span>&#160;    <a class="code" href="classllvm_1_1FixedVectorType.html">FixedVectorType</a> *VectorTy = <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(ScalarTy, ReduxWidth);</div>
<div class="line"><a name="l12900"></a><span class="lineno">12900</span>&#160;    <a class="code" href="classllvm_1_1InstructionCost.html">InstructionCost</a> VectorCost = 0, ScalarCost;</div>
<div class="line"><a name="l12901"></a><span class="lineno">12901</span>&#160;    <span class="comment">// If all of the reduced values are constant, the vector cost is 0, since</span></div>
<div class="line"><a name="l12902"></a><span class="lineno">12902</span>&#160;    <span class="comment">// the reduction value can be calculated at the compile time.</span></div>
<div class="line"><a name="l12903"></a><span class="lineno">12903</span>&#160;    <span class="keywordtype">bool</span> AllConsts = <a class="code" href="SLPVectorizer_8cpp.html#a7568c08b526dbf7f7b5402f3eb605b55">allConstant</a>(ReducedVals);</div>
<div class="line"><a name="l12904"></a><span class="lineno">12904</span>&#160;    <span class="keywordflow">switch</span> (RdxKind) {</div>
<div class="line"><a name="l12905"></a><span class="lineno">12905</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">RecurKind::Add</a>:</div>
<div class="line"><a name="l12906"></a><span class="lineno">12906</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea62b6d55816cf737bfc6f42e60df1a3f2">RecurKind::Mul</a>:</div>
<div class="line"><a name="l12907"></a><span class="lineno">12907</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea3a2d5fe857d8f9541136a124c2edec6c">RecurKind::Or</a>:</div>
<div class="line"><a name="l12908"></a><span class="lineno">12908</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">RecurKind::And</a>:</div>
<div class="line"><a name="l12909"></a><span class="lineno">12909</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea76feb79109026728a20736a8c6504548">RecurKind::Xor</a>:</div>
<div class="line"><a name="l12910"></a><span class="lineno">12910</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eaf552e181879ad14956985859308d77d9">RecurKind::FAdd</a>:</div>
<div class="line"><a name="l12911"></a><span class="lineno">12911</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eab48b2a9934af7a531cfd7236ded9d50e">RecurKind::FMul</a>: {</div>
<div class="line"><a name="l12912"></a><span class="lineno">12912</span>&#160;      <span class="keywordtype">unsigned</span> RdxOpcode = <a class="code" href="classllvm_1_1RecurrenceDescriptor.html#a32c8ad694911bf6dcf6cb07824f2823e">RecurrenceDescriptor::getOpcode</a>(RdxKind);</div>
<div class="line"><a name="l12913"></a><span class="lineno">12913</span>&#160;      <span class="keywordflow">if</span> (!AllConsts)</div>
<div class="line"><a name="l12914"></a><span class="lineno">12914</span>&#160;        VectorCost =</div>
<div class="line"><a name="l12915"></a><span class="lineno">12915</span>&#160;            <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a421ee26483edf3fd0cd1dca34513f45e">getArithmeticReductionCost</a>(RdxOpcode, VectorTy, FMF, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>);</div>
<div class="line"><a name="l12916"></a><span class="lineno">12916</span>&#160;      ScalarCost = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#a9679969ae87f8a08d5f6948be6cf7210">getArithmeticInstrCost</a>(RdxOpcode, ScalarTy, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>);</div>
<div class="line"><a name="l12917"></a><span class="lineno">12917</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l12918"></a><span class="lineno">12918</span>&#160;    }</div>
<div class="line"><a name="l12919"></a><span class="lineno">12919</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea8764eae15a1f2cf1c964d14dcf9283ee">RecurKind::FMax</a>:</div>
<div class="line"><a name="l12920"></a><span class="lineno">12920</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ead76b595f89852f41ac50173abae6da05">RecurKind::FMin</a>: {</div>
<div class="line"><a name="l12921"></a><span class="lineno">12921</span>&#160;      <span class="keyword">auto</span> *SclCondTy = <a class="code" href="classllvm_1_1CmpInst.html#a4b5e1f50cb0890ec60d8c61a61241170">CmpInst::makeCmpResultType</a>(ScalarTy);</div>
<div class="line"><a name="l12922"></a><span class="lineno">12922</span>&#160;      <span class="keywordflow">if</span> (!AllConsts) {</div>
<div class="line"><a name="l12923"></a><span class="lineno">12923</span>&#160;        <span class="keyword">auto</span> *VecCondTy =</div>
<div class="line"><a name="l12924"></a><span class="lineno">12924</span>&#160;            cast&lt;VectorType&gt;(<a class="code" href="classllvm_1_1CmpInst.html#a4b5e1f50cb0890ec60d8c61a61241170">CmpInst::makeCmpResultType</a>(VectorTy));</div>
<div class="line"><a name="l12925"></a><span class="lineno">12925</span>&#160;        VectorCost =</div>
<div class="line"><a name="l12926"></a><span class="lineno">12926</span>&#160;            <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#af573e4ba5a78948226a4abdf5e713e75">getMinMaxReductionCost</a>(VectorTy, VecCondTy,</div>
<div class="line"><a name="l12927"></a><span class="lineno">12927</span>&#160;                                        <span class="comment">/*IsUnsigned=*/</span><span class="keyword">false</span>, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>);</div>
<div class="line"><a name="l12928"></a><span class="lineno">12928</span>&#160;      }</div>
<div class="line"><a name="l12929"></a><span class="lineno">12929</span>&#160;      <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> RdxPred = <a class="code" href="namespacellvm.html#aa0d93b31f835afb05e3d03ea5f8626df">getMinMaxReductionPredicate</a>(RdxKind);</div>
<div class="line"><a name="l12930"></a><span class="lineno">12930</span>&#160;      ScalarCost = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#af89277d8bd76d6348291e29b6076796a">getCmpSelInstrCost</a>(Instruction::FCmp, ScalarTy,</div>
<div class="line"><a name="l12931"></a><span class="lineno">12931</span>&#160;                                           SclCondTy, RdxPred, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>) +</div>
<div class="line"><a name="l12932"></a><span class="lineno">12932</span>&#160;                   <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#af89277d8bd76d6348291e29b6076796a">getCmpSelInstrCost</a>(<a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Instruction::Select</a>, ScalarTy,</div>
<div class="line"><a name="l12933"></a><span class="lineno">12933</span>&#160;                                           SclCondTy, RdxPred, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>);</div>
<div class="line"><a name="l12934"></a><span class="lineno">12934</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l12935"></a><span class="lineno">12935</span>&#160;    }</div>
<div class="line"><a name="l12936"></a><span class="lineno">12936</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eabccd0de85dfbe7aef83629b318a4df6e">RecurKind::SMax</a>:</div>
<div class="line"><a name="l12937"></a><span class="lineno">12937</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ead6bb6a2eca7d60c75e349ea45e138d74">RecurKind::SMin</a>:</div>
<div class="line"><a name="l12938"></a><span class="lineno">12938</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eafaa1f94cd925672925f691e7f5727a6b">RecurKind::UMax</a>:</div>
<div class="line"><a name="l12939"></a><span class="lineno">12939</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea1c692ed4bf463fb08fca4d8cb8201ac0">RecurKind::UMin</a>: {</div>
<div class="line"><a name="l12940"></a><span class="lineno">12940</span>&#160;      <span class="keyword">auto</span> *SclCondTy = <a class="code" href="classllvm_1_1CmpInst.html#a4b5e1f50cb0890ec60d8c61a61241170">CmpInst::makeCmpResultType</a>(ScalarTy);</div>
<div class="line"><a name="l12941"></a><span class="lineno">12941</span>&#160;      <span class="keywordflow">if</span> (!AllConsts) {</div>
<div class="line"><a name="l12942"></a><span class="lineno">12942</span>&#160;        <span class="keyword">auto</span> *VecCondTy =</div>
<div class="line"><a name="l12943"></a><span class="lineno">12943</span>&#160;            cast&lt;VectorType&gt;(<a class="code" href="classllvm_1_1CmpInst.html#a4b5e1f50cb0890ec60d8c61a61241170">CmpInst::makeCmpResultType</a>(VectorTy));</div>
<div class="line"><a name="l12944"></a><span class="lineno">12944</span>&#160;        <span class="keywordtype">bool</span> IsUnsigned =</div>
<div class="line"><a name="l12945"></a><span class="lineno">12945</span>&#160;            RdxKind == <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eafaa1f94cd925672925f691e7f5727a6b">RecurKind::UMax</a> || RdxKind == <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea1c692ed4bf463fb08fca4d8cb8201ac0">RecurKind::UMin</a>;</div>
<div class="line"><a name="l12946"></a><span class="lineno">12946</span>&#160;        VectorCost = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#af573e4ba5a78948226a4abdf5e713e75">getMinMaxReductionCost</a>(VectorTy, VecCondTy,</div>
<div class="line"><a name="l12947"></a><span class="lineno">12947</span>&#160;                                                 IsUnsigned, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>);</div>
<div class="line"><a name="l12948"></a><span class="lineno">12948</span>&#160;      }</div>
<div class="line"><a name="l12949"></a><span class="lineno">12949</span>&#160;      <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> RdxPred = <a class="code" href="namespacellvm.html#aa0d93b31f835afb05e3d03ea5f8626df">getMinMaxReductionPredicate</a>(RdxKind);</div>
<div class="line"><a name="l12950"></a><span class="lineno">12950</span>&#160;      ScalarCost = <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#af89277d8bd76d6348291e29b6076796a">getCmpSelInstrCost</a>(Instruction::ICmp, ScalarTy,</div>
<div class="line"><a name="l12951"></a><span class="lineno">12951</span>&#160;                                           SclCondTy, RdxPred, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>) +</div>
<div class="line"><a name="l12952"></a><span class="lineno">12952</span>&#160;                   <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>-&gt;<a class="code" href="classllvm_1_1TargetTransformInfo.html#af89277d8bd76d6348291e29b6076796a">getCmpSelInstrCost</a>(<a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Instruction::Select</a>, ScalarTy,</div>
<div class="line"><a name="l12953"></a><span class="lineno">12953</span>&#160;                                           SclCondTy, RdxPred, <a class="code" href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a>);</div>
<div class="line"><a name="l12954"></a><span class="lineno">12954</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l12955"></a><span class="lineno">12955</span>&#160;    }</div>
<div class="line"><a name="l12956"></a><span class="lineno">12956</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l12957"></a><span class="lineno">12957</span>&#160;      <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Expected arithmetic or min/max reduction operation&quot;</span>);</div>
<div class="line"><a name="l12958"></a><span class="lineno">12958</span>&#160;    }</div>
<div class="line"><a name="l12959"></a><span class="lineno">12959</span>&#160; </div>
<div class="line"><a name="l12960"></a><span class="lineno">12960</span>&#160;    <span class="comment">// Scalar cost is repeated for N-1 elements.</span></div>
<div class="line"><a name="l12961"></a><span class="lineno">12961</span>&#160;    ScalarCost *= (ReduxWidth - 1);</div>
<div class="line"><a name="l12962"></a><span class="lineno">12962</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Adding cost &quot;</span> &lt;&lt; VectorCost - ScalarCost</div>
<div class="line"><a name="l12963"></a><span class="lineno">12963</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot; for reduction that starts with &quot;</span> &lt;&lt; *FirstReducedVal</div>
<div class="line"><a name="l12964"></a><span class="lineno">12964</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot; (It is a splitting reduction)\n&quot;</span>);</div>
<div class="line"><a name="l12965"></a><span class="lineno">12965</span>&#160;    <span class="keywordflow">return</span> VectorCost - ScalarCost;</div>
<div class="line"><a name="l12966"></a><span class="lineno">12966</span>&#160;  }</div>
<div class="line"><a name="l12967"></a><span class="lineno">12967</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l12968"></a><span class="lineno">12968</span>&#160;<span class="comment">  /// Emit a horizontal reduction of the vectorized value.</span></div>
<div class="line"><a name="l12969"></a><span class="lineno">12969</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Value.html">Value</a> *emitReduction(<a class="code" href="classllvm_1_1Value.html">Value</a> *VectorizedValue, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>,</div>
<div class="line"><a name="l12970"></a><span class="lineno">12970</span>&#160;                       <span class="keywordtype">unsigned</span> ReduxWidth, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> *<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) {</div>
<div class="line"><a name="l12971"></a><span class="lineno">12971</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VectorizedValue &amp;&amp; <span class="stringliteral">&quot;Need to have a vectorized tree node&quot;</span>);</div>
<div class="line"><a name="l12972"></a><span class="lineno">12972</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm.html#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2_32</a>(ReduxWidth) &amp;&amp;</div>
<div class="line"><a name="l12973"></a><span class="lineno">12973</span>&#160;           <span class="stringliteral">&quot;We only handle power-of-two reductions for now&quot;</span>);</div>
<div class="line"><a name="l12974"></a><span class="lineno">12974</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(RdxKind != <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eaa7dad289ea38506fb1c9b5b148405d0c">RecurKind::FMulAdd</a> &amp;&amp;</div>
<div class="line"><a name="l12975"></a><span class="lineno">12975</span>&#160;           <span class="stringliteral">&quot;A call to the llvm.fmuladd intrinsic is not handled yet&quot;</span>);</div>
<div class="line"><a name="l12976"></a><span class="lineno">12976</span>&#160; </div>
<div class="line"><a name="l12977"></a><span class="lineno">12977</span>&#160;    ++NumVectorInstructions;</div>
<div class="line"><a name="l12978"></a><span class="lineno">12978</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a206919e5542f742070811ced039f3461">createSimpleTargetReduction</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, VectorizedValue, RdxKind);</div>
<div class="line"><a name="l12979"></a><span class="lineno">12979</span>&#160;  }</div>
<div class="line"><a name="l12980"></a><span class="lineno">12980</span>&#160;};</div>
<div class="line"><a name="l12981"></a><span class="lineno">12981</span>&#160; </div>
<div class="line"><a name="l12982"></a><span class="lineno">12982</span>&#160;} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a name="l12983"></a><span class="lineno">12983</span>&#160; </div>
<div class="line"><a name="l12984"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#ac511b1624c43ecf7aefa3773fc3255f2">12984</a></span>&#160;<span class="keyword">static</span> std::optional&lt;unsigned&gt; <a class="code" href="SLPVectorizer_8cpp.html#ac511b1624c43ecf7aefa3773fc3255f2">getAggregateSize</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *InsertInst) {</div>
<div class="line"><a name="l12985"></a><span class="lineno">12985</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a> = dyn_cast&lt;InsertElementInst&gt;(InsertInst))</div>
<div class="line"><a name="l12986"></a><span class="lineno">12986</span>&#160;    <span class="keywordflow">return</span> cast&lt;FixedVectorType&gt;(<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>-&gt;getType())-&gt;getNumElements();</div>
<div class="line"><a name="l12987"></a><span class="lineno">12987</span>&#160; </div>
<div class="line"><a name="l12988"></a><span class="lineno">12988</span>&#160;  <span class="keywordtype">unsigned</span> AggregateSize = 1;</div>
<div class="line"><a name="l12989"></a><span class="lineno">12989</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="blake3__impl_8h.html#a78823051d1dad34b9b3d8120112e674d">IV</a> = cast&lt;InsertValueInst&gt;(InsertInst);</div>
<div class="line"><a name="l12990"></a><span class="lineno">12990</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *CurrentType = <a class="code" href="blake3__impl_8h.html#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;getType();</div>
<div class="line"><a name="l12991"></a><span class="lineno">12991</span>&#160;  <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l12992"></a><span class="lineno">12992</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a> = dyn_cast&lt;StructType&gt;(CurrentType)) {</div>
<div class="line"><a name="l12993"></a><span class="lineno">12993</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Elt : <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;elements())</div>
<div class="line"><a name="l12994"></a><span class="lineno">12994</span>&#160;        <span class="keywordflow">if</span> (Elt != <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;getElementType(0)) <span class="comment">// check homogeneity</span></div>
<div class="line"><a name="l12995"></a><span class="lineno">12995</span>&#160;          <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l12996"></a><span class="lineno">12996</span>&#160;      AggregateSize *= <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;getNumElements();</div>
<div class="line"><a name="l12997"></a><span class="lineno">12997</span>&#160;      CurrentType = <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;getElementType(0);</div>
<div class="line"><a name="l12998"></a><span class="lineno">12998</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *AT = dyn_cast&lt;ArrayType&gt;(CurrentType)) {</div>
<div class="line"><a name="l12999"></a><span class="lineno">12999</span>&#160;      AggregateSize *= AT-&gt;getNumElements();</div>
<div class="line"><a name="l13000"></a><span class="lineno">13000</span>&#160;      CurrentType = AT-&gt;getElementType();</div>
<div class="line"><a name="l13001"></a><span class="lineno">13001</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *VT = dyn_cast&lt;FixedVectorType&gt;(CurrentType)) {</div>
<div class="line"><a name="l13002"></a><span class="lineno">13002</span>&#160;      AggregateSize *= VT-&gt;getNumElements();</div>
<div class="line"><a name="l13003"></a><span class="lineno">13003</span>&#160;      <span class="keywordflow">return</span> AggregateSize;</div>
<div class="line"><a name="l13004"></a><span class="lineno">13004</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CurrentType-&gt;<a class="code" href="classllvm_1_1Type.html#a5f6edc5246188225b3f49bd5c974c759">isSingleValueType</a>()) {</div>
<div class="line"><a name="l13005"></a><span class="lineno">13005</span>&#160;      <span class="keywordflow">return</span> AggregateSize;</div>
<div class="line"><a name="l13006"></a><span class="lineno">13006</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l13007"></a><span class="lineno">13007</span>&#160;      <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l13008"></a><span class="lineno">13008</span>&#160;    }</div>
<div class="line"><a name="l13009"></a><span class="lineno">13009</span>&#160;  } <span class="keywordflow">while</span> (<span class="keyword">true</span>);</div>
<div class="line"><a name="l13010"></a><span class="lineno">13010</span>&#160;}</div>
<div class="line"><a name="l13011"></a><span class="lineno">13011</span>&#160; </div>
<div class="line"><a name="l13012"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#ab040531a75b07eda10dc88c82439ff89">13012</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="SLPVectorizer_8cpp.html#ab040531a75b07eda10dc88c82439ff89">findBuildAggregate_rec</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *LastInsertInst,</div>
<div class="line"><a name="l13013"></a><span class="lineno">13013</span>&#160;                                   <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> *<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>,</div>
<div class="line"><a name="l13014"></a><span class="lineno">13014</span>&#160;                                   <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Value *&gt;</a> &amp;BuildVectorOpds,</div>
<div class="line"><a name="l13015"></a><span class="lineno">13015</span>&#160;                                   <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Value *&gt;</a> &amp;InsertElts,</div>
<div class="line"><a name="l13016"></a><span class="lineno">13016</span>&#160;                                   <span class="keywordtype">unsigned</span> OperandOffset) {</div>
<div class="line"><a name="l13017"></a><span class="lineno">13017</span>&#160;  <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l13018"></a><span class="lineno">13018</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *InsertedOperand = LastInsertInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1);</div>
<div class="line"><a name="l13019"></a><span class="lineno">13019</span>&#160;    std::optional&lt;unsigned&gt; OperandIndex =</div>
<div class="line"><a name="l13020"></a><span class="lineno">13020</span>&#160;        <a class="code" href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a>(LastInsertInst, OperandOffset);</div>
<div class="line"><a name="l13021"></a><span class="lineno">13021</span>&#160;    <span class="keywordflow">if</span> (!OperandIndex)</div>
<div class="line"><a name="l13022"></a><span class="lineno">13022</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l13023"></a><span class="lineno">13023</span>&#160;    <span class="keywordflow">if</span> (isa&lt;InsertElementInst, InsertValueInst&gt;(InsertedOperand)) {</div>
<div class="line"><a name="l13024"></a><span class="lineno">13024</span>&#160;      <a class="code" href="SLPVectorizer_8cpp.html#ab040531a75b07eda10dc88c82439ff89">findBuildAggregate_rec</a>(cast&lt;Instruction&gt;(InsertedOperand), <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>,</div>
<div class="line"><a name="l13025"></a><span class="lineno">13025</span>&#160;                             BuildVectorOpds, InsertElts, *OperandIndex);</div>
<div class="line"><a name="l13026"></a><span class="lineno">13026</span>&#160; </div>
<div class="line"><a name="l13027"></a><span class="lineno">13027</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l13028"></a><span class="lineno">13028</span>&#160;      BuildVectorOpds[*OperandIndex] = InsertedOperand;</div>
<div class="line"><a name="l13029"></a><span class="lineno">13029</span>&#160;      InsertElts[*OperandIndex] = LastInsertInst;</div>
<div class="line"><a name="l13030"></a><span class="lineno">13030</span>&#160;    }</div>
<div class="line"><a name="l13031"></a><span class="lineno">13031</span>&#160;    LastInsertInst = dyn_cast&lt;Instruction&gt;(LastInsertInst-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0));</div>
<div class="line"><a name="l13032"></a><span class="lineno">13032</span>&#160;  } <span class="keywordflow">while</span> (LastInsertInst != <span class="keyword">nullptr</span> &amp;&amp;</div>
<div class="line"><a name="l13033"></a><span class="lineno">13033</span>&#160;           isa&lt;InsertValueInst, InsertElementInst&gt;(LastInsertInst) &amp;&amp;</div>
<div class="line"><a name="l13034"></a><span class="lineno">13034</span>&#160;           LastInsertInst-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>());</div>
<div class="line"><a name="l13035"></a><span class="lineno">13035</span>&#160;}</div>
<div class="line"><a name="l13036"></a><span class="lineno">13036</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l13037"></a><span class="lineno">13037</span>&#160;<span class="comment">/// Recognize construction of vectors like</span></div>
<div class="line"><a name="l13038"></a><span class="lineno">13038</span>&#160;<span class="comment">///  %ra = insertelement &lt;4 x float&gt; poison, float %s0, i32 0</span></div>
<div class="line"><a name="l13039"></a><span class="lineno">13039</span>&#160;<span class="comment">///  %rb = insertelement &lt;4 x float&gt; %ra, float %s1, i32 1</span></div>
<div class="line"><a name="l13040"></a><span class="lineno">13040</span>&#160;<span class="comment">///  %rc = insertelement &lt;4 x float&gt; %rb, float %s2, i32 2</span></div>
<div class="line"><a name="l13041"></a><span class="lineno">13041</span>&#160;<span class="comment">///  %rd = insertelement &lt;4 x float&gt; %rc, float %s3, i32 3</span></div>
<div class="line"><a name="l13042"></a><span class="lineno">13042</span>&#160;<span class="comment">///  starting from the last insertelement or insertvalue instruction.</span></div>
<div class="line"><a name="l13043"></a><span class="lineno">13043</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l13044"></a><span class="lineno">13044</span>&#160;<span class="comment">/// Also recognize homogeneous aggregates like {&lt;2 x float&gt;, &lt;2 x float&gt;},</span></div>
<div class="line"><a name="l13045"></a><span class="lineno">13045</span>&#160;<span class="comment">/// {{float, float}, {float, float}}, [2 x {float, float}] and so on.</span></div>
<div class="line"><a name="l13046"></a><span class="lineno">13046</span>&#160;<span class="comment">/// See llvm/test/Transforms/SLPVectorizer/X86/pr42022.ll for examples.</span></div>
<div class="line"><a name="l13047"></a><span class="lineno">13047</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l13048"></a><span class="lineno">13048</span>&#160;<span class="comment">/// Assume LastInsertInst is of InsertElementInst or InsertValueInst type.</span></div>
<div class="line"><a name="l13049"></a><span class="lineno">13049</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l13050"></a><span class="lineno">13050</span>&#160;<span class="comment">/// \return true if it matches.</span></div>
<div class="line"><a name="l13051"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a9e009f75d93ef01dc1f9c495dbe69327">13051</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#a9e009f75d93ef01dc1f9c495dbe69327">findBuildAggregate</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *LastInsertInst,</div>
<div class="line"><a name="l13052"></a><span class="lineno">13052</span>&#160;                               <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> *<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>,</div>
<div class="line"><a name="l13053"></a><span class="lineno">13053</span>&#160;                               <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Value *&gt;</a> &amp;BuildVectorOpds,</div>
<div class="line"><a name="l13054"></a><span class="lineno">13054</span>&#160;                               <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Value *&gt;</a> &amp;InsertElts) {</div>
<div class="line"><a name="l13055"></a><span class="lineno">13055</span>&#160; </div>
<div class="line"><a name="l13056"></a><span class="lineno">13056</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((isa&lt;InsertElementInst&gt;(LastInsertInst) ||</div>
<div class="line"><a name="l13057"></a><span class="lineno">13057</span>&#160;          isa&lt;InsertValueInst&gt;(LastInsertInst)) &amp;&amp;</div>
<div class="line"><a name="l13058"></a><span class="lineno">13058</span>&#160;         <span class="stringliteral">&quot;Expected insertelement or insertvalue instruction!&quot;</span>);</div>
<div class="line"><a name="l13059"></a><span class="lineno">13059</span>&#160; </div>
<div class="line"><a name="l13060"></a><span class="lineno">13060</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((BuildVectorOpds.empty() &amp;&amp; InsertElts.empty()) &amp;&amp;</div>
<div class="line"><a name="l13061"></a><span class="lineno">13061</span>&#160;         <span class="stringliteral">&quot;Expected empty result vectors!&quot;</span>);</div>
<div class="line"><a name="l13062"></a><span class="lineno">13062</span>&#160; </div>
<div class="line"><a name="l13063"></a><span class="lineno">13063</span>&#160;  std::optional&lt;unsigned&gt; AggregateSize = <a class="code" href="SLPVectorizer_8cpp.html#ac511b1624c43ecf7aefa3773fc3255f2">getAggregateSize</a>(LastInsertInst);</div>
<div class="line"><a name="l13064"></a><span class="lineno">13064</span>&#160;  <span class="keywordflow">if</span> (!AggregateSize)</div>
<div class="line"><a name="l13065"></a><span class="lineno">13065</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13066"></a><span class="lineno">13066</span>&#160;  BuildVectorOpds.<a class="code" href="classllvm_1_1SmallVectorImpl.html#ad0b3d8447f88377b62d9c019f3c4e118">resize</a>(*AggregateSize);</div>
<div class="line"><a name="l13067"></a><span class="lineno">13067</span>&#160;  InsertElts.<a class="code" href="classllvm_1_1SmallVectorImpl.html#ad0b3d8447f88377b62d9c019f3c4e118">resize</a>(*AggregateSize);</div>
<div class="line"><a name="l13068"></a><span class="lineno">13068</span>&#160; </div>
<div class="line"><a name="l13069"></a><span class="lineno">13069</span>&#160;  <a class="code" href="SLPVectorizer_8cpp.html#ab040531a75b07eda10dc88c82439ff89">findBuildAggregate_rec</a>(LastInsertInst, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, BuildVectorOpds, InsertElts, 0);</div>
<div class="line"><a name="l13070"></a><span class="lineno">13070</span>&#160;  <a class="code" href="namespacellvm.html#aa82bb12b2879425012b3742487e10964">llvm::erase_value</a>(BuildVectorOpds, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l13071"></a><span class="lineno">13071</span>&#160;  <a class="code" href="namespacellvm.html#aa82bb12b2879425012b3742487e10964">llvm::erase_value</a>(InsertElts, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l13072"></a><span class="lineno">13072</span>&#160;  <span class="keywordflow">if</span> (BuildVectorOpds.size() &gt;= 2)</div>
<div class="line"><a name="l13073"></a><span class="lineno">13073</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l13074"></a><span class="lineno">13074</span>&#160; </div>
<div class="line"><a name="l13075"></a><span class="lineno">13075</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13076"></a><span class="lineno">13076</span>&#160;}</div>
<div class="line"><a name="l13077"></a><span class="lineno">13077</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l13078"></a><span class="lineno">13078</span>&#160;<span class="comment">/// Try and get a reduction value from a phi node.</span></div>
<div class="line"><a name="l13079"></a><span class="lineno">13079</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l13080"></a><span class="lineno">13080</span>&#160;<span class="comment">/// Given a phi node \p P in a block \p ParentBB, consider possible reductions</span></div>
<div class="line"><a name="l13081"></a><span class="lineno">13081</span>&#160;<span class="comment">/// if they come from either \p ParentBB or a containing loop latch.</span></div>
<div class="line"><a name="l13082"></a><span class="lineno">13082</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l13083"></a><span class="lineno">13083</span>&#160;<span class="comment">/// \returns A candidate reduction value if possible, or \code nullptr \endcode</span></div>
<div class="line"><a name="l13084"></a><span class="lineno">13084</span>&#160;<span class="comment">/// if not possible.</span></div>
<div class="line"><a name="l13085"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#abae46c48115232bc5de18a6a5e1c7c7f">13085</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="SLPVectorizer_8cpp.html#abae46c48115232bc5de18a6a5e1c7c7f">getReductionValue</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> *DT, <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>,</div>
<div class="line"><a name="l13086"></a><span class="lineno">13086</span>&#160;                                <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *ParentBB, <a class="code" href="classllvm_1_1LoopInfo.html">LoopInfo</a> *LI) {</div>
<div class="line"><a name="l13087"></a><span class="lineno">13087</span>&#160;  <span class="comment">// There are situations where the reduction value is not dominated by the</span></div>
<div class="line"><a name="l13088"></a><span class="lineno">13088</span>&#160;  <span class="comment">// reduction phi. Vectorizing such cases has been reported to cause</span></div>
<div class="line"><a name="l13089"></a><span class="lineno">13089</span>&#160;  <span class="comment">// miscompiles. See PR25787.</span></div>
<div class="line"><a name="l13090"></a><span class="lineno">13090</span>&#160;  <span class="keyword">auto</span> DominatedReduxValue = [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *R) {</div>
<div class="line"><a name="l13091"></a><span class="lineno">13091</span>&#160;    <span class="keywordflow">return</span> isa&lt;Instruction&gt;(R) &amp;&amp;</div>
<div class="line"><a name="l13092"></a><span class="lineno">13092</span>&#160;           DT-&gt;<a class="code" href="classllvm_1_1DominatorTree.html#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>-&gt;getParent(), cast&lt;Instruction&gt;(R)-&gt;getParent());</div>
<div class="line"><a name="l13093"></a><span class="lineno">13093</span>&#160;  };</div>
<div class="line"><a name="l13094"></a><span class="lineno">13094</span>&#160; </div>
<div class="line"><a name="l13095"></a><span class="lineno">13095</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Rdx = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l13096"></a><span class="lineno">13096</span>&#160; </div>
<div class="line"><a name="l13097"></a><span class="lineno">13097</span>&#160;  <span class="comment">// Return the incoming value if it comes from the same BB as the phi node.</span></div>
<div class="line"><a name="l13098"></a><span class="lineno">13098</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>-&gt;getIncomingBlock(0) == ParentBB) {</div>
<div class="line"><a name="l13099"></a><span class="lineno">13099</span>&#160;    Rdx = <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>-&gt;getIncomingValue(0);</div>
<div class="line"><a name="l13100"></a><span class="lineno">13100</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>-&gt;getIncomingBlock(1) == ParentBB) {</div>
<div class="line"><a name="l13101"></a><span class="lineno">13101</span>&#160;    Rdx = <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>-&gt;getIncomingValue(1);</div>
<div class="line"><a name="l13102"></a><span class="lineno">13102</span>&#160;  }</div>
<div class="line"><a name="l13103"></a><span class="lineno">13103</span>&#160; </div>
<div class="line"><a name="l13104"></a><span class="lineno">13104</span>&#160;  <span class="keywordflow">if</span> (Rdx &amp;&amp; DominatedReduxValue(Rdx))</div>
<div class="line"><a name="l13105"></a><span class="lineno">13105</span>&#160;    <span class="keywordflow">return</span> Rdx;</div>
<div class="line"><a name="l13106"></a><span class="lineno">13106</span>&#160; </div>
<div class="line"><a name="l13107"></a><span class="lineno">13107</span>&#160;  <span class="comment">// Otherwise, check whether we have a loop latch to look at.</span></div>
<div class="line"><a name="l13108"></a><span class="lineno">13108</span>&#160;  <a class="code" href="classllvm_1_1Loop.html">Loop</a> *BBL = LI-&gt;<a class="code" href="classllvm_1_1LoopInfoBase.html#a7a7c8e0e4f836c13c015b62e18f386bd">getLoopFor</a>(ParentBB);</div>
<div class="line"><a name="l13109"></a><span class="lineno">13109</span>&#160;  <span class="keywordflow">if</span> (!BBL)</div>
<div class="line"><a name="l13110"></a><span class="lineno">13110</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l13111"></a><span class="lineno">13111</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BBLatch = BBL-&gt;<a class="code" href="classllvm_1_1LoopBase.html#a1230fd674d2609b96527fe65eaf40b1b">getLoopLatch</a>();</div>
<div class="line"><a name="l13112"></a><span class="lineno">13112</span>&#160;  <span class="keywordflow">if</span> (!BBLatch)</div>
<div class="line"><a name="l13113"></a><span class="lineno">13113</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l13114"></a><span class="lineno">13114</span>&#160; </div>
<div class="line"><a name="l13115"></a><span class="lineno">13115</span>&#160;  <span class="comment">// There is a loop latch, return the incoming value if it comes from</span></div>
<div class="line"><a name="l13116"></a><span class="lineno">13116</span>&#160;  <span class="comment">// that. This reduction pattern occasionally turns up.</span></div>
<div class="line"><a name="l13117"></a><span class="lineno">13117</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>-&gt;getIncomingBlock(0) == BBLatch) {</div>
<div class="line"><a name="l13118"></a><span class="lineno">13118</span>&#160;    Rdx = <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>-&gt;getIncomingValue(0);</div>
<div class="line"><a name="l13119"></a><span class="lineno">13119</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>-&gt;getIncomingBlock(1) == BBLatch) {</div>
<div class="line"><a name="l13120"></a><span class="lineno">13120</span>&#160;    Rdx = <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>-&gt;getIncomingValue(1);</div>
<div class="line"><a name="l13121"></a><span class="lineno">13121</span>&#160;  }</div>
<div class="line"><a name="l13122"></a><span class="lineno">13122</span>&#160; </div>
<div class="line"><a name="l13123"></a><span class="lineno">13123</span>&#160;  <span class="keywordflow">if</span> (Rdx &amp;&amp; DominatedReduxValue(Rdx))</div>
<div class="line"><a name="l13124"></a><span class="lineno">13124</span>&#160;    <span class="keywordflow">return</span> Rdx;</div>
<div class="line"><a name="l13125"></a><span class="lineno">13125</span>&#160; </div>
<div class="line"><a name="l13126"></a><span class="lineno">13126</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l13127"></a><span class="lineno">13127</span>&#160;}</div>
<div class="line"><a name="l13128"></a><span class="lineno">13128</span>&#160; </div>
<div class="line"><a name="l13129"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#ad3a526067810066884b7bb20ad94dcde">13129</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#ad3a526067810066884b7bb20ad94dcde">matchRdxBop</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *&amp;V0, <a class="code" href="classllvm_1_1Value.html">Value</a> *&amp;V1) {</div>
<div class="line"><a name="l13130"></a><span class="lineno">13130</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#a43ac4fbaaf63a88eb5ac05f6d3e5649c">m_BinOp</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(V0), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(V1))))</div>
<div class="line"><a name="l13131"></a><span class="lineno">13131</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l13132"></a><span class="lineno">13132</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, m_Intrinsic&lt;Intrinsic::maxnum&gt;(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(V0), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(V1))))</div>
<div class="line"><a name="l13133"></a><span class="lineno">13133</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l13134"></a><span class="lineno">13134</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, m_Intrinsic&lt;Intrinsic::minnum&gt;(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(V0), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(V1))))</div>
<div class="line"><a name="l13135"></a><span class="lineno">13135</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l13136"></a><span class="lineno">13136</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, m_Intrinsic&lt;Intrinsic::smax&gt;(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(V0), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(V1))))</div>
<div class="line"><a name="l13137"></a><span class="lineno">13137</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l13138"></a><span class="lineno">13138</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, m_Intrinsic&lt;Intrinsic::smin&gt;(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(V0), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(V1))))</div>
<div class="line"><a name="l13139"></a><span class="lineno">13139</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l13140"></a><span class="lineno">13140</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, m_Intrinsic&lt;Intrinsic::umax&gt;(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(V0), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(V1))))</div>
<div class="line"><a name="l13141"></a><span class="lineno">13141</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l13142"></a><span class="lineno">13142</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, m_Intrinsic&lt;Intrinsic::umin&gt;(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(V0), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(V1))))</div>
<div class="line"><a name="l13143"></a><span class="lineno">13143</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l13144"></a><span class="lineno">13144</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13145"></a><span class="lineno">13145</span>&#160;}</div>
<div class="line"><a name="l13146"></a><span class="lineno">13146</span>&#160; </div>
<div class="line"><a name="l13147"></a><span class="lineno">13147</span>&#160;<span class="keywordtype">bool</span> SLPVectorizerPass::vectorizeHorReduction(</div>
<div class="line"><a name="l13148"></a><span class="lineno">13148</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> &amp;R, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> *<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>,</div>
<div class="line"><a name="l13149"></a><span class="lineno">13149</span>&#160;    <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;WeakTrackingVH&gt;</a> &amp;PostponedInsts) {</div>
<div class="line"><a name="l13150"></a><span class="lineno">13150</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="SLPVectorizer_8cpp.html#ae44dffe81e5d4e6584fc647153353e3c">ShouldVectorizeHor</a>)</div>
<div class="line"><a name="l13151"></a><span class="lineno">13151</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13152"></a><span class="lineno">13152</span>&#160; </div>
<div class="line"><a name="l13153"></a><span class="lineno">13153</span>&#160;  <span class="keyword">auto</span> *Root = dyn_cast_or_null&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l13154"></a><span class="lineno">13154</span>&#160;  <span class="keywordflow">if</span> (!Root)</div>
<div class="line"><a name="l13155"></a><span class="lineno">13155</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13156"></a><span class="lineno">13156</span>&#160; </div>
<div class="line"><a name="l13157"></a><span class="lineno">13157</span>&#160;  <span class="keywordflow">if</span> (!isa&lt;BinaryOperator&gt;(Root))</div>
<div class="line"><a name="l13158"></a><span class="lineno">13158</span>&#160;    <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l13159"></a><span class="lineno">13159</span>&#160; </div>
<div class="line"><a name="l13160"></a><span class="lineno">13160</span>&#160;  <span class="keywordflow">if</span> (Root-&gt;getParent() != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> || isa&lt;PHINode&gt;(Root))</div>
<div class="line"><a name="l13161"></a><span class="lineno">13161</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13162"></a><span class="lineno">13162</span>&#160;  <span class="comment">// Start analysis starting from Root instruction. If horizontal reduction is</span></div>
<div class="line"><a name="l13163"></a><span class="lineno">13163</span>&#160;  <span class="comment">// found, try to vectorize it. If it is not a horizontal reduction or</span></div>
<div class="line"><a name="l13164"></a><span class="lineno">13164</span>&#160;  <span class="comment">// vectorization is not possible or not effective, and currently analyzed</span></div>
<div class="line"><a name="l13165"></a><span class="lineno">13165</span>&#160;  <span class="comment">// instruction is a binary operation, try to vectorize the operands, using</span></div>
<div class="line"><a name="l13166"></a><span class="lineno">13166</span>&#160;  <span class="comment">// pre-order DFS traversal order. If the operands were not vectorized, repeat</span></div>
<div class="line"><a name="l13167"></a><span class="lineno">13167</span>&#160;  <span class="comment">// the same procedure considering each operand as a possible root of the</span></div>
<div class="line"><a name="l13168"></a><span class="lineno">13168</span>&#160;  <span class="comment">// horizontal reduction.</span></div>
<div class="line"><a name="l13169"></a><span class="lineno">13169</span>&#160;  <span class="comment">// Interrupt the process if the Root instruction itself was vectorized or all</span></div>
<div class="line"><a name="l13170"></a><span class="lineno">13170</span>&#160;  <span class="comment">// sub-trees not higher that RecursionMaxDepth were analyzed/vectorized.</span></div>
<div class="line"><a name="l13171"></a><span class="lineno">13171</span>&#160;  <span class="comment">// If a horizintal reduction was not matched or vectorized we collect</span></div>
<div class="line"><a name="l13172"></a><span class="lineno">13172</span>&#160;  <span class="comment">// instructions for possible later attempts for vectorization.</span></div>
<div class="line"><a name="l13173"></a><span class="lineno">13173</span>&#160;  std::queue&lt;std::pair&lt;Instruction *, unsigned&gt;&gt; <a class="code" href="namespacellvm_1_1pdb.html#a0d3b0002f320808a94594a6718946d7ba2187e1021a911b3807cc1bea2eb1a9ca">Stack</a>;</div>
<div class="line"><a name="l13174"></a><span class="lineno">13174</span>&#160;  <a class="code" href="namespacellvm_1_1pdb.html#a0d3b0002f320808a94594a6718946d7ba2187e1021a911b3807cc1bea2eb1a9ca">Stack</a>.emplace(Root, 0);</div>
<div class="line"><a name="l13175"></a><span class="lineno">13175</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value *, 8&gt;</a> VisitedInstrs;</div>
<div class="line"><a name="l13176"></a><span class="lineno">13176</span>&#160;  <span class="keywordtype">bool</span> Res = <span class="keyword">false</span>;</div>
<div class="line"><a name="l13177"></a><span class="lineno">13177</span>&#160;  <span class="keyword">auto</span> &amp;&amp;TryToReduce = [<span class="keyword">this</span>, <a class="code" href="namespacellvm.html#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, &amp;<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>, &amp;<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>](<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst, <a class="code" href="classllvm_1_1Value.html">Value</a> *&amp;B0,</div>
<div class="line"><a name="l13178"></a><span class="lineno">13178</span>&#160;                                           <a class="code" href="classllvm_1_1Value.html">Value</a> *&amp;B1) -&gt; <a class="code" href="classllvm_1_1Value.html">Value</a> * {</div>
<div class="line"><a name="l13179"></a><span class="lineno">13179</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.isAnalyzedReductionRoot(Inst))</div>
<div class="line"><a name="l13180"></a><span class="lineno">13180</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l13181"></a><span class="lineno">13181</span>&#160;    <span class="keywordtype">bool</span> IsBinop = <a class="code" href="SLPVectorizer_8cpp.html#ad3a526067810066884b7bb20ad94dcde">matchRdxBop</a>(Inst, B0, B1);</div>
<div class="line"><a name="l13182"></a><span class="lineno">13182</span>&#160;    <span class="keywordtype">bool</span> IsSelect = <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Inst, <a class="code" href="namespacellvm_1_1PatternMatch.html#addb87fe3f509b7803d3f5933ee24b560">m_Select</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>()));</div>
<div class="line"><a name="l13183"></a><span class="lineno">13183</span>&#160;    <span class="keywordflow">if</span> (IsBinop || IsSelect) {</div>
<div class="line"><a name="l13184"></a><span class="lineno">13184</span>&#160;      <a class="code" href="namespacellvm_1_1ARMII.html#a7d414894ef8cdc39b147eb7e0d7e4305a9e2a02c8e15c43cfe03fee48f85f76cf">HorizontalReduction</a> HorRdx;</div>
<div class="line"><a name="l13185"></a><span class="lineno">13185</span>&#160;      <span class="keywordflow">if</span> (HorRdx.matchAssociativeReduction(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>, Inst, *SE, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, *TLI))</div>
<div class="line"><a name="l13186"></a><span class="lineno">13186</span>&#160;        <span class="keywordflow">return</span> HorRdx.tryToReduce(R, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, *TLI);</div>
<div class="line"><a name="l13187"></a><span class="lineno">13187</span>&#160;    }</div>
<div class="line"><a name="l13188"></a><span class="lineno">13188</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l13189"></a><span class="lineno">13189</span>&#160;  };</div>
<div class="line"><a name="l13190"></a><span class="lineno">13190</span>&#160;  <span class="keywordflow">while</span> (!<a class="code" href="namespacellvm_1_1pdb.html#a0d3b0002f320808a94594a6718946d7ba2187e1021a911b3807cc1bea2eb1a9ca">Stack</a>.empty()) {</div>
<div class="line"><a name="l13191"></a><span class="lineno">13191</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst;</div>
<div class="line"><a name="l13192"></a><span class="lineno">13192</span>&#160;    <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1PICLevel.html#a66ddbf1bb21f90ddc44260d1ca677b6b">Level</a>;</div>
<div class="line"><a name="l13193"></a><span class="lineno">13193</span>&#160;    std::tie(Inst, Level) = <a class="code" href="namespacellvm_1_1pdb.html#a0d3b0002f320808a94594a6718946d7ba2187e1021a911b3807cc1bea2eb1a9ca">Stack</a>.front();</div>
<div class="line"><a name="l13194"></a><span class="lineno">13194</span>&#160;    <a class="code" href="namespacellvm_1_1pdb.html#a0d3b0002f320808a94594a6718946d7ba2187e1021a911b3807cc1bea2eb1a9ca">Stack</a>.pop();</div>
<div class="line"><a name="l13195"></a><span class="lineno">13195</span>&#160;    <span class="comment">// Do not try to analyze instruction that has already been vectorized.</span></div>
<div class="line"><a name="l13196"></a><span class="lineno">13196</span>&#160;    <span class="comment">// This may happen when we vectorize instruction operands on a previous</span></div>
<div class="line"><a name="l13197"></a><span class="lineno">13197</span>&#160;    <span class="comment">// iteration while stack was populated before that happened.</span></div>
<div class="line"><a name="l13198"></a><span class="lineno">13198</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.isDeleted(Inst))</div>
<div class="line"><a name="l13199"></a><span class="lineno">13199</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13200"></a><span class="lineno">13200</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *B0 = <span class="keyword">nullptr</span>, *B1 = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l13201"></a><span class="lineno">13201</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V = TryToReduce(Inst, B0, B1)) {</div>
<div class="line"><a name="l13202"></a><span class="lineno">13202</span>&#160;      Res = <span class="keyword">true</span>;</div>
<div class="line"><a name="l13203"></a><span class="lineno">13203</span>&#160;      <span class="comment">// Set P to nullptr to avoid re-analysis of phi node in</span></div>
<div class="line"><a name="l13204"></a><span class="lineno">13204</span>&#160;      <span class="comment">// matchAssociativeReduction function unless this is the root node.</span></div>
<div class="line"><a name="l13205"></a><span class="lineno">13205</span>&#160;      <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l13206"></a><span class="lineno">13206</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V)) {</div>
<div class="line"><a name="l13207"></a><span class="lineno">13207</span>&#160;        <span class="comment">// Try to find another reduction.</span></div>
<div class="line"><a name="l13208"></a><span class="lineno">13208</span>&#160;        <a class="code" href="namespacellvm_1_1pdb.html#a0d3b0002f320808a94594a6718946d7ba2187e1021a911b3807cc1bea2eb1a9ca">Stack</a>.emplace(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Level);</div>
<div class="line"><a name="l13209"></a><span class="lineno">13209</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13210"></a><span class="lineno">13210</span>&#160;      }</div>
<div class="line"><a name="l13211"></a><span class="lineno">13211</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l13212"></a><span class="lineno">13212</span>&#160;      <span class="keywordtype">bool</span> IsBinop = B0 &amp;&amp; B1;</div>
<div class="line"><a name="l13213"></a><span class="lineno">13213</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> &amp;&amp; IsBinop) {</div>
<div class="line"><a name="l13214"></a><span class="lineno">13214</span>&#160;        Inst = dyn_cast&lt;Instruction&gt;(B0);</div>
<div class="line"><a name="l13215"></a><span class="lineno">13215</span>&#160;        <span class="keywordflow">if</span> (Inst == <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>)</div>
<div class="line"><a name="l13216"></a><span class="lineno">13216</span>&#160;          Inst = dyn_cast&lt;Instruction&gt;(B1);</div>
<div class="line"><a name="l13217"></a><span class="lineno">13217</span>&#160;        <span class="keywordflow">if</span> (!Inst) {</div>
<div class="line"><a name="l13218"></a><span class="lineno">13218</span>&#160;          <span class="comment">// Set P to nullptr to avoid re-analysis of phi node in</span></div>
<div class="line"><a name="l13219"></a><span class="lineno">13219</span>&#160;          <span class="comment">// matchAssociativeReduction function unless this is the root node.</span></div>
<div class="line"><a name="l13220"></a><span class="lineno">13220</span>&#160;          <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l13221"></a><span class="lineno">13221</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13222"></a><span class="lineno">13222</span>&#160;        }</div>
<div class="line"><a name="l13223"></a><span class="lineno">13223</span>&#160;      }</div>
<div class="line"><a name="l13224"></a><span class="lineno">13224</span>&#160;      <span class="comment">// Set P to nullptr to avoid re-analysis of phi node in</span></div>
<div class="line"><a name="l13225"></a><span class="lineno">13225</span>&#160;      <span class="comment">// matchAssociativeReduction function unless this is the root node.</span></div>
<div class="line"><a name="l13226"></a><span class="lineno">13226</span>&#160;      <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l13227"></a><span class="lineno">13227</span>&#160;      <span class="comment">// Do not collect CmpInst or InsertElementInst/InsertValueInst as their</span></div>
<div class="line"><a name="l13228"></a><span class="lineno">13228</span>&#160;      <span class="comment">// analysis is done separately.</span></div>
<div class="line"><a name="l13229"></a><span class="lineno">13229</span>&#160;      <span class="keywordflow">if</span> (!isa&lt;CmpInst, InsertElementInst, InsertValueInst&gt;(Inst))</div>
<div class="line"><a name="l13230"></a><span class="lineno">13230</span>&#160;        PostponedInsts.push_back(Inst);</div>
<div class="line"><a name="l13231"></a><span class="lineno">13231</span>&#160;    }</div>
<div class="line"><a name="l13232"></a><span class="lineno">13232</span>&#160; </div>
<div class="line"><a name="l13233"></a><span class="lineno">13233</span>&#160;    <span class="comment">// Try to vectorize operands.</span></div>
<div class="line"><a name="l13234"></a><span class="lineno">13234</span>&#160;    <span class="comment">// Continue analysis for the instruction from the same basic block only to</span></div>
<div class="line"><a name="l13235"></a><span class="lineno">13235</span>&#160;    <span class="comment">// save compile time.</span></div>
<div class="line"><a name="l13236"></a><span class="lineno">13236</span>&#160;    <span class="keywordflow">if</span> (++Level &lt; <a class="code" href="SLPVectorizer_8cpp.html#a70927cb83bb008a2a60a657d651909aa">RecursionMaxDepth</a>)</div>
<div class="line"><a name="l13237"></a><span class="lineno">13237</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> : Inst-&gt;<a class="code" href="classllvm_1_1User.html#a176409317fc26e8be3c6af0193643c27">operand_values</a>())</div>
<div class="line"><a name="l13238"></a><span class="lineno">13238</span>&#160;        <span class="keywordflow">if</span> (VisitedInstrs.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>).second)</div>
<div class="line"><a name="l13239"></a><span class="lineno">13239</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>))</div>
<div class="line"><a name="l13240"></a><span class="lineno">13240</span>&#160;            <span class="comment">// Do not try to vectorize CmpInst operands,  this is done</span></div>
<div class="line"><a name="l13241"></a><span class="lineno">13241</span>&#160;            <span class="comment">// separately.</span></div>
<div class="line"><a name="l13242"></a><span class="lineno">13242</span>&#160;            <span class="keywordflow">if</span> (!isa&lt;PHINode, CmpInst, InsertElementInst, InsertValueInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</div>
<div class="line"><a name="l13243"></a><span class="lineno">13243</span>&#160;                !<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.isDeleted(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() == <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l13244"></a><span class="lineno">13244</span>&#160;              <a class="code" href="namespacellvm_1_1pdb.html#a0d3b0002f320808a94594a6718946d7ba2187e1021a911b3807cc1bea2eb1a9ca">Stack</a>.emplace(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Level);</div>
<div class="line"><a name="l13245"></a><span class="lineno">13245</span>&#160;  }</div>
<div class="line"><a name="l13246"></a><span class="lineno">13246</span>&#160;  <span class="keywordflow">return</span> Res;</div>
<div class="line"><a name="l13247"></a><span class="lineno">13247</span>&#160;}</div>
<div class="line"><a name="l13248"></a><span class="lineno">13248</span>&#160; </div>
<div class="line"><a name="l13249"></a><span class="lineno">13249</span>&#160;<span class="keywordtype">bool</span> SLPVectorizerPass::vectorizeRootInstruction(<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *V,</div>
<div class="line"><a name="l13250"></a><span class="lineno">13250</span>&#160;                                                 <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> &amp;R,</div>
<div class="line"><a name="l13251"></a><span class="lineno">13251</span>&#160;                                                 <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> *<a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>) {</div>
<div class="line"><a name="l13252"></a><span class="lineno">13252</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;WeakTrackingVH&gt;</a> PostponedInsts;</div>
<div class="line"><a name="l13253"></a><span class="lineno">13253</span>&#160;  <span class="keywordtype">bool</span> Res = vectorizeHorReduction(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>, V, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, R, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, PostponedInsts);</div>
<div class="line"><a name="l13254"></a><span class="lineno">13254</span>&#160;  Res |= tryToVectorize(PostponedInsts, R);</div>
<div class="line"><a name="l13255"></a><span class="lineno">13255</span>&#160;  <span class="keywordflow">return</span> Res;</div>
<div class="line"><a name="l13256"></a><span class="lineno">13256</span>&#160;}</div>
<div class="line"><a name="l13257"></a><span class="lineno">13257</span>&#160; </div>
<div class="line"><a name="l13258"></a><span class="lineno">13258</span>&#160;<span class="keywordtype">bool</span> SLPVectorizerPass::tryToVectorize(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;WeakTrackingVH&gt;</a> Insts,</div>
<div class="line"><a name="l13259"></a><span class="lineno">13259</span>&#160;                                       <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> &amp;R) {</div>
<div class="line"><a name="l13260"></a><span class="lineno">13260</span>&#160;  <span class="keywordtype">bool</span> Res = <span class="keyword">false</span>;</div>
<div class="line"><a name="l13261"></a><span class="lineno">13261</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : Insts)</div>
<div class="line"><a name="l13262"></a><span class="lineno">13262</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Inst = dyn_cast&lt;Instruction&gt;(V); Inst &amp;&amp; !<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.isDeleted(Inst))</div>
<div class="line"><a name="l13263"></a><span class="lineno">13263</span>&#160;      Res |= tryToVectorize(Inst, R);</div>
<div class="line"><a name="l13264"></a><span class="lineno">13264</span>&#160;  <span class="keywordflow">return</span> Res;</div>
<div class="line"><a name="l13265"></a><span class="lineno">13265</span>&#160;}</div>
<div class="line"><a name="l13266"></a><span class="lineno">13266</span>&#160; </div>
<div class="line"><a name="l13267"></a><span class="lineno">13267</span>&#160;<span class="keywordtype">bool</span> SLPVectorizerPass::vectorizeInsertValueInst(<a class="code" href="classllvm_1_1InsertValueInst.html">InsertValueInst</a> *IVI,</div>
<div class="line"><a name="l13268"></a><span class="lineno">13268</span>&#160;                                                 <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> &amp;R) {</div>
<div class="line"><a name="l13269"></a><span class="lineno">13269</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getModule()-&gt;getDataLayout();</div>
<div class="line"><a name="l13270"></a><span class="lineno">13270</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.canMapToVector(IVI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</div>
<div class="line"><a name="l13271"></a><span class="lineno">13271</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13272"></a><span class="lineno">13272</span>&#160; </div>
<div class="line"><a name="l13273"></a><span class="lineno">13273</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 16&gt;</a> BuildVectorOpds;</div>
<div class="line"><a name="l13274"></a><span class="lineno">13274</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 16&gt;</a> BuildVectorInsts;</div>
<div class="line"><a name="l13275"></a><span class="lineno">13275</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="SLPVectorizer_8cpp.html#a9e009f75d93ef01dc1f9c495dbe69327">findBuildAggregate</a>(IVI, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, BuildVectorOpds, BuildVectorInsts))</div>
<div class="line"><a name="l13276"></a><span class="lineno">13276</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13277"></a><span class="lineno">13277</span>&#160; </div>
<div class="line"><a name="l13278"></a><span class="lineno">13278</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: array mappable to vector: &quot;</span> &lt;&lt; *IVI &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l13279"></a><span class="lineno">13279</span>&#160;  <span class="comment">// Aggregate value is unlikely to be processed in vector register.</span></div>
<div class="line"><a name="l13280"></a><span class="lineno">13280</span>&#160;  <span class="keywordflow">return</span> tryToVectorizeList(BuildVectorOpds, R);</div>
<div class="line"><a name="l13281"></a><span class="lineno">13281</span>&#160;}</div>
<div class="line"><a name="l13282"></a><span class="lineno">13282</span>&#160; </div>
<div class="line"><a name="l13283"></a><span class="lineno">13283</span>&#160;<span class="keywordtype">bool</span> SLPVectorizerPass::vectorizeInsertElementInst(<a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> *IEI,</div>
<div class="line"><a name="l13284"></a><span class="lineno">13284</span>&#160;                                                   <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> &amp;R) {</div>
<div class="line"><a name="l13285"></a><span class="lineno">13285</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 16&gt;</a> BuildVectorInsts;</div>
<div class="line"><a name="l13286"></a><span class="lineno">13286</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 16&gt;</a> BuildVectorOpds;</div>
<div class="line"><a name="l13287"></a><span class="lineno">13287</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>;</div>
<div class="line"><a name="l13288"></a><span class="lineno">13288</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="SLPVectorizer_8cpp.html#a9e009f75d93ef01dc1f9c495dbe69327">findBuildAggregate</a>(IEI, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, BuildVectorOpds, BuildVectorInsts) ||</div>
<div class="line"><a name="l13289"></a><span class="lineno">13289</span>&#160;      (<a class="code" href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all_of</a>(</div>
<div class="line"><a name="l13290"></a><span class="lineno">13290</span>&#160;           BuildVectorOpds,</div>
<div class="line"><a name="l13291"></a><span class="lineno">13291</span>&#160;           [](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) { <span class="keywordflow">return</span> isa&lt;ExtractElementInst, UndefValue&gt;(V); }) &amp;&amp;</div>
<div class="line"><a name="l13292"></a><span class="lineno">13292</span>&#160;       <a class="code" href="SLPVectorizer_8cpp.html#a8b409af081b7132c139c0bdc22c5cefd">isFixedVectorShuffle</a>(BuildVectorOpds, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>)))</div>
<div class="line"><a name="l13293"></a><span class="lineno">13293</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13294"></a><span class="lineno">13294</span>&#160; </div>
<div class="line"><a name="l13295"></a><span class="lineno">13295</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: array mappable to vector: &quot;</span> &lt;&lt; *IEI &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l13296"></a><span class="lineno">13296</span>&#160;  <span class="keywordflow">return</span> tryToVectorizeList(BuildVectorInsts, R);</div>
<div class="line"><a name="l13297"></a><span class="lineno">13297</span>&#160;}</div>
<div class="line"><a name="l13298"></a><span class="lineno">13298</span>&#160; </div>
<div class="line"><a name="l13299"></a><span class="lineno">13299</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l13300"></a><span class="lineno">13300</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="line"><a name="l13301"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#ac612e1575824af0d08b013c8588f5c68">13301</a></span>&#160;<a class="code" href="SLPVectorizer_8cpp.html#ac612e1575824af0d08b013c8588f5c68">tryToVectorizeSequence</a>(<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;T *&gt;</a> &amp;Incoming,</div>
<div class="line"><a name="l13302"></a><span class="lineno">13302</span>&#160;                       <a class="code" href="classllvm_1_1function__ref.html">function_ref</a>&lt;<span class="keywordtype">unsigned</span>(<a class="code" href="classT.html">T</a> *)&gt; Limit,</div>
<div class="line"><a name="l13303"></a><span class="lineno">13303</span>&#160;                       <a class="code" href="classllvm_1_1function__ref.html">function_ref</a>&lt;<span class="keywordtype">bool</span>(<a class="code" href="classT.html">T</a> *, <a class="code" href="classT.html">T</a> *)&gt; Comparator,</div>
<div class="line"><a name="l13304"></a><span class="lineno">13304</span>&#160;                       <a class="code" href="classllvm_1_1function__ref.html">function_ref</a>&lt;<span class="keywordtype">bool</span>(<a class="code" href="classT.html">T</a> *, <a class="code" href="classT.html">T</a> *)&gt; AreCompatible,</div>
<div class="line"><a name="l13305"></a><span class="lineno">13305</span>&#160;                       <a class="code" href="classllvm_1_1function__ref.html">function_ref</a>&lt;<span class="keywordtype">bool</span>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;T *&gt;</a>, <span class="keywordtype">bool</span>)&gt; TryToVectorizeHelper,</div>
<div class="line"><a name="l13306"></a><span class="lineno">13306</span>&#160;                       <span class="keywordtype">bool</span> LimitForRegisterSize) {</div>
<div class="line"><a name="l13307"></a><span class="lineno">13307</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l13308"></a><span class="lineno">13308</span>&#160;  <span class="comment">// Sort by type, parent, operands.</span></div>
<div class="line"><a name="l13309"></a><span class="lineno">13309</span>&#160;  <a class="code" href="namespacellvm.html#a076f93c387f454f0db13d4bc7d4e7f9c">stable_sort</a>(Incoming, Comparator);</div>
<div class="line"><a name="l13310"></a><span class="lineno">13310</span>&#160; </div>
<div class="line"><a name="l13311"></a><span class="lineno">13311</span>&#160;  <span class="comment">// Try to vectorize elements base on their type.</span></div>
<div class="line"><a name="l13312"></a><span class="lineno">13312</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;T *&gt;</a> Candidates;</div>
<div class="line"><a name="l13313"></a><span class="lineno">13313</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *IncIt = Incoming.begin(), *<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = Incoming.end(); IncIt != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>;) {</div>
<div class="line"><a name="l13314"></a><span class="lineno">13314</span>&#160;    <span class="comment">// Look for the next elements with the same type, parent and operand</span></div>
<div class="line"><a name="l13315"></a><span class="lineno">13315</span>&#160;    <span class="comment">// kinds.</span></div>
<div class="line"><a name="l13316"></a><span class="lineno">13316</span>&#160;    <span class="keyword">auto</span> *SameTypeIt = IncIt;</div>
<div class="line"><a name="l13317"></a><span class="lineno">13317</span>&#160;    <span class="keywordflow">while</span> (SameTypeIt != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> &amp;&amp; AreCompatible(*SameTypeIt, *IncIt))</div>
<div class="line"><a name="l13318"></a><span class="lineno">13318</span>&#160;      ++SameTypeIt;</div>
<div class="line"><a name="l13319"></a><span class="lineno">13319</span>&#160; </div>
<div class="line"><a name="l13320"></a><span class="lineno">13320</span>&#160;    <span class="comment">// Try to vectorize them.</span></div>
<div class="line"><a name="l13321"></a><span class="lineno">13321</span>&#160;    <span class="keywordtype">unsigned</span> NumElts = (SameTypeIt - IncIt);</div>
<div class="line"><a name="l13322"></a><span class="lineno">13322</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Trying to vectorize starting at nodes (&quot;</span></div>
<div class="line"><a name="l13323"></a><span class="lineno">13323</span>&#160;                      &lt;&lt; NumElts &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>);</div>
<div class="line"><a name="l13324"></a><span class="lineno">13324</span>&#160;    <span class="comment">// The vectorization is a 3-state attempt:</span></div>
<div class="line"><a name="l13325"></a><span class="lineno">13325</span>&#160;    <span class="comment">// 1. Try to vectorize instructions with the same/alternate opcodes with the</span></div>
<div class="line"><a name="l13326"></a><span class="lineno">13326</span>&#160;    <span class="comment">// size of maximal register at first.</span></div>
<div class="line"><a name="l13327"></a><span class="lineno">13327</span>&#160;    <span class="comment">// 2. Try to vectorize remaining instructions with the same type, if</span></div>
<div class="line"><a name="l13328"></a><span class="lineno">13328</span>&#160;    <span class="comment">// possible. This may result in the better vectorization results rather than</span></div>
<div class="line"><a name="l13329"></a><span class="lineno">13329</span>&#160;    <span class="comment">// if we try just to vectorize instructions with the same/alternate opcodes.</span></div>
<div class="line"><a name="l13330"></a><span class="lineno">13330</span>&#160;    <span class="comment">// 3. Final attempt to try to vectorize all instructions with the</span></div>
<div class="line"><a name="l13331"></a><span class="lineno">13331</span>&#160;    <span class="comment">// same/alternate ops only, this may result in some extra final</span></div>
<div class="line"><a name="l13332"></a><span class="lineno">13332</span>&#160;    <span class="comment">// vectorization.</span></div>
<div class="line"><a name="l13333"></a><span class="lineno">13333</span>&#160;    <span class="keywordflow">if</span> (NumElts &gt; 1 &amp;&amp;</div>
<div class="line"><a name="l13334"></a><span class="lineno">13334</span>&#160;        TryToVectorizeHelper(<a class="code" href="namespacellvm.html#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(IncIt, NumElts), LimitForRegisterSize)) {</div>
<div class="line"><a name="l13335"></a><span class="lineno">13335</span>&#160;      <span class="comment">// Success start over because instructions might have been changed.</span></div>
<div class="line"><a name="l13336"></a><span class="lineno">13336</span>&#160;      Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l13337"></a><span class="lineno">13337</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NumElts &lt; Limit(*IncIt) &amp;&amp;</div>
<div class="line"><a name="l13338"></a><span class="lineno">13338</span>&#160;               (Candidates.empty() ||</div>
<div class="line"><a name="l13339"></a><span class="lineno">13339</span>&#160;                Candidates.front()-&gt;getType() == (*IncIt)-&gt;getType())) {</div>
<div class="line"><a name="l13340"></a><span class="lineno">13340</span>&#160;      Candidates.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a7efd1f0c1206d95e4fe01a9b49a57b82">append</a>(IncIt, std::next(IncIt, NumElts));</div>
<div class="line"><a name="l13341"></a><span class="lineno">13341</span>&#160;    }</div>
<div class="line"><a name="l13342"></a><span class="lineno">13342</span>&#160;    <span class="comment">// Final attempt to vectorize instructions with the same types.</span></div>
<div class="line"><a name="l13343"></a><span class="lineno">13343</span>&#160;    <span class="keywordflow">if</span> (Candidates.size() &gt; 1 &amp;&amp;</div>
<div class="line"><a name="l13344"></a><span class="lineno">13344</span>&#160;        (SameTypeIt == <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> || (*SameTypeIt)-&gt;getType() != (*IncIt)-&gt;getType())) {</div>
<div class="line"><a name="l13345"></a><span class="lineno">13345</span>&#160;      <span class="keywordflow">if</span> (TryToVectorizeHelper(Candidates, <span class="comment">/*LimitForRegisterSize=*/</span><span class="keyword">false</span>)) {</div>
<div class="line"><a name="l13346"></a><span class="lineno">13346</span>&#160;        <span class="comment">// Success start over because instructions might have been changed.</span></div>
<div class="line"><a name="l13347"></a><span class="lineno">13347</span>&#160;        Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l13348"></a><span class="lineno">13348</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (LimitForRegisterSize) {</div>
<div class="line"><a name="l13349"></a><span class="lineno">13349</span>&#160;        <span class="comment">// Try to vectorize using small vectors.</span></div>
<div class="line"><a name="l13350"></a><span class="lineno">13350</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> *It = Candidates.begin(), *End = Candidates.end();</div>
<div class="line"><a name="l13351"></a><span class="lineno">13351</span>&#160;             It != End;) {</div>
<div class="line"><a name="l13352"></a><span class="lineno">13352</span>&#160;          <span class="keyword">auto</span> *SameTypeIt = It;</div>
<div class="line"><a name="l13353"></a><span class="lineno">13353</span>&#160;          <span class="keywordflow">while</span> (SameTypeIt != End &amp;&amp; AreCompatible(*SameTypeIt, *It))</div>
<div class="line"><a name="l13354"></a><span class="lineno">13354</span>&#160;            ++SameTypeIt;</div>
<div class="line"><a name="l13355"></a><span class="lineno">13355</span>&#160;          <span class="keywordtype">unsigned</span> NumElts = (SameTypeIt - It);</div>
<div class="line"><a name="l13356"></a><span class="lineno">13356</span>&#160;          <span class="keywordflow">if</span> (NumElts &gt; 1 &amp;&amp;</div>
<div class="line"><a name="l13357"></a><span class="lineno">13357</span>&#160;              TryToVectorizeHelper(<a class="code" href="namespacellvm.html#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(It, NumElts),</div>
<div class="line"><a name="l13358"></a><span class="lineno">13358</span>&#160;                                   <span class="comment">/*LimitForRegisterSize=*/</span><span class="keyword">false</span>))</div>
<div class="line"><a name="l13359"></a><span class="lineno">13359</span>&#160;            Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l13360"></a><span class="lineno">13360</span>&#160;          It = SameTypeIt;</div>
<div class="line"><a name="l13361"></a><span class="lineno">13361</span>&#160;        }</div>
<div class="line"><a name="l13362"></a><span class="lineno">13362</span>&#160;      }</div>
<div class="line"><a name="l13363"></a><span class="lineno">13363</span>&#160;      Candidates.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div>
<div class="line"><a name="l13364"></a><span class="lineno">13364</span>&#160;    }</div>
<div class="line"><a name="l13365"></a><span class="lineno">13365</span>&#160; </div>
<div class="line"><a name="l13366"></a><span class="lineno">13366</span>&#160;    <span class="comment">// Start over at the next instruction of a different type (or the end).</span></div>
<div class="line"><a name="l13367"></a><span class="lineno">13367</span>&#160;    IncIt = SameTypeIt;</div>
<div class="line"><a name="l13368"></a><span class="lineno">13368</span>&#160;  }</div>
<div class="line"><a name="l13369"></a><span class="lineno">13369</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l13370"></a><span class="lineno">13370</span>&#160;}</div>
<div class="line"><a name="l13371"></a><span class="lineno">13371</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l13372"></a><span class="lineno">13372</span>&#160;<span class="comment">/// Compare two cmp instructions. If IsCompatibility is true, function returns</span></div>
<div class="line"><a name="l13373"></a><span class="lineno">13373</span>&#160;<span class="comment">/// true if 2 cmps have same/swapped predicates and mos compatible corresponding</span></div>
<div class="line"><a name="l13374"></a><span class="lineno">13374</span>&#160;<span class="comment">/// operands. If IsCompatibility is false, function implements strict weak</span></div>
<div class="line"><a name="l13375"></a><span class="lineno">13375</span>&#160;<span class="comment">/// ordering relation between two cmp instructions, returning true if the first</span></div>
<div class="line"><a name="l13376"></a><span class="lineno">13376</span>&#160;<span class="comment">/// instruction is &quot;less&quot; than the second, i.e. its predicate is less than the</span></div>
<div class="line"><a name="l13377"></a><span class="lineno">13377</span>&#160;<span class="comment">/// predicate of the second or the operands IDs are less than the operands IDs</span></div>
<div class="line"><a name="l13378"></a><span class="lineno">13378</span>&#160;<span class="comment">/// of the second cmp instruction.</span></div>
<div class="line"><a name="l13379"></a><span class="lineno">13379</span>&#160;<span class="comment"></span><span class="keyword">template</span> &lt;<span class="keywordtype">bool</span> IsCompatibility&gt;</div>
<div class="line"><a name="l13380"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#aaf5f659329577feb1b283d6b194599bd">13380</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SLPVectorizer_8cpp.html#aaf5f659329577feb1b283d6b194599bd">compareCmp</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>, <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> &amp;TLI,</div>
<div class="line"><a name="l13381"></a><span class="lineno">13381</span>&#160;                       <a class="code" href="classllvm_1_1function__ref.html">function_ref</a>&lt;<span class="keywordtype">bool</span>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *)&gt; IsDeleted) {</div>
<div class="line"><a name="l13382"></a><span class="lineno">13382</span>&#160;  <span class="keyword">auto</span> *CI1 = cast&lt;CmpInst&gt;(V);</div>
<div class="line"><a name="l13383"></a><span class="lineno">13383</span>&#160;  <span class="keyword">auto</span> *CI2 = cast&lt;CmpInst&gt;(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>);</div>
<div class="line"><a name="l13384"></a><span class="lineno">13384</span>&#160;  <span class="keywordflow">if</span> (IsDeleted(CI2) || !<a class="code" href="SLPVectorizer_8cpp.html#aa3ea54a95743867473d32853d3c65603">isValidElementType</a>(CI2-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()))</div>
<div class="line"><a name="l13385"></a><span class="lineno">13385</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13386"></a><span class="lineno">13386</span>&#160;  <span class="keywordflow">if</span> (CI1-&gt;getOperand(0)-&gt;getType()-&gt;getTypeID() &lt;</div>
<div class="line"><a name="l13387"></a><span class="lineno">13387</span>&#160;      CI2-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#ac7b0ed5c6d30bad74769c6e87ab0edb8">getTypeID</a>())</div>
<div class="line"><a name="l13388"></a><span class="lineno">13388</span>&#160;    <span class="keywordflow">return</span> !IsCompatibility;</div>
<div class="line"><a name="l13389"></a><span class="lineno">13389</span>&#160;  <span class="keywordflow">if</span> (CI1-&gt;getOperand(0)-&gt;getType()-&gt;getTypeID() &gt;</div>
<div class="line"><a name="l13390"></a><span class="lineno">13390</span>&#160;      CI2-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#ac7b0ed5c6d30bad74769c6e87ab0edb8">getTypeID</a>())</div>
<div class="line"><a name="l13391"></a><span class="lineno">13391</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13392"></a><span class="lineno">13392</span>&#160;  <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> Pred1 = CI1-&gt;getPredicate();</div>
<div class="line"><a name="l13393"></a><span class="lineno">13393</span>&#160;  <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> Pred2 = CI2-&gt;getPredicate();</div>
<div class="line"><a name="l13394"></a><span class="lineno">13394</span>&#160;  <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> SwapPred1 = <a class="code" href="classllvm_1_1CmpInst.html#a49a2d8f483ea08a3d6ea75f90c640d76">CmpInst::getSwappedPredicate</a>(Pred1);</div>
<div class="line"><a name="l13395"></a><span class="lineno">13395</span>&#160;  <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> SwapPred2 = <a class="code" href="classllvm_1_1CmpInst.html#a49a2d8f483ea08a3d6ea75f90c640d76">CmpInst::getSwappedPredicate</a>(Pred2);</div>
<div class="line"><a name="l13396"></a><span class="lineno">13396</span>&#160;  <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> BasePred1 = <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(Pred1, SwapPred1);</div>
<div class="line"><a name="l13397"></a><span class="lineno">13397</span>&#160;  <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> BasePred2 = <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(Pred2, SwapPred2);</div>
<div class="line"><a name="l13398"></a><span class="lineno">13398</span>&#160;  <span class="keywordflow">if</span> (BasePred1 &lt; BasePred2)</div>
<div class="line"><a name="l13399"></a><span class="lineno">13399</span>&#160;    <span class="keywordflow">return</span> !IsCompatibility;</div>
<div class="line"><a name="l13400"></a><span class="lineno">13400</span>&#160;  <span class="keywordflow">if</span> (BasePred1 &gt; BasePred2)</div>
<div class="line"><a name="l13401"></a><span class="lineno">13401</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13402"></a><span class="lineno">13402</span>&#160;  <span class="comment">// Compare operands.</span></div>
<div class="line"><a name="l13403"></a><span class="lineno">13403</span>&#160;  <span class="keywordtype">bool</span> LEPreds = Pred1 &lt;= Pred2;</div>
<div class="line"><a name="l13404"></a><span class="lineno">13404</span>&#160;  <span class="keywordtype">bool</span> GEPreds = Pred1 &gt;= Pred2;</div>
<div class="line"><a name="l13405"></a><span class="lineno">13405</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = CI1-&gt;getNumOperands(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l13406"></a><span class="lineno">13406</span>&#160;    <span class="keyword">auto</span> *Op1 = CI1-&gt;getOperand(LEPreds ? <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> - <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> - 1);</div>
<div class="line"><a name="l13407"></a><span class="lineno">13407</span>&#160;    <span class="keyword">auto</span> *Op2 = CI2-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(GEPreds ? <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> - <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> - 1);</div>
<div class="line"><a name="l13408"></a><span class="lineno">13408</span>&#160;    <span class="keywordflow">if</span> (Op1-&gt;<a class="code" href="classllvm_1_1Value.html#a4a6ca5a5b87bd84231be9d8dbec46c1a">getValueID</a>() &lt; Op2-&gt;<a class="code" href="classllvm_1_1Value.html#a4a6ca5a5b87bd84231be9d8dbec46c1a">getValueID</a>())</div>
<div class="line"><a name="l13409"></a><span class="lineno">13409</span>&#160;      <span class="keywordflow">return</span> !IsCompatibility;</div>
<div class="line"><a name="l13410"></a><span class="lineno">13410</span>&#160;    <span class="keywordflow">if</span> (Op1-&gt;<a class="code" href="classllvm_1_1Value.html#a4a6ca5a5b87bd84231be9d8dbec46c1a">getValueID</a>() &gt; Op2-&gt;<a class="code" href="classllvm_1_1Value.html#a4a6ca5a5b87bd84231be9d8dbec46c1a">getValueID</a>())</div>
<div class="line"><a name="l13411"></a><span class="lineno">13411</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13412"></a><span class="lineno">13412</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *I1 = dyn_cast&lt;Instruction&gt;(Op1))</div>
<div class="line"><a name="l13413"></a><span class="lineno">13413</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *I2 = dyn_cast&lt;Instruction&gt;(Op2)) {</div>
<div class="line"><a name="l13414"></a><span class="lineno">13414</span>&#160;        <span class="keywordflow">if</span> (I1-&gt;getParent() != I2-&gt;getParent())</div>
<div class="line"><a name="l13415"></a><span class="lineno">13415</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13416"></a><span class="lineno">13416</span>&#160;        InstructionsState <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = <a class="code" href="SLPVectorizer_8cpp.html#ae37b3a41d982a793664ab021d9b9b325">getSameOpcode</a>({I1, I2}, TLI);</div>
<div class="line"><a name="l13417"></a><span class="lineno">13417</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.getOpcode())</div>
<div class="line"><a name="l13418"></a><span class="lineno">13418</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13419"></a><span class="lineno">13419</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13420"></a><span class="lineno">13420</span>&#160;      }</div>
<div class="line"><a name="l13421"></a><span class="lineno">13421</span>&#160;  }</div>
<div class="line"><a name="l13422"></a><span class="lineno">13422</span>&#160;  <span class="keywordflow">return</span> IsCompatibility;</div>
<div class="line"><a name="l13423"></a><span class="lineno">13423</span>&#160;}</div>
<div class="line"><a name="l13424"></a><span class="lineno">13424</span>&#160; </div>
<div class="line"><a name="l13425"></a><span class="lineno">13425</span>&#160;<span class="keywordtype">bool</span> SLPVectorizerPass::vectorizeSimpleInstructions(InstSetVector &amp;Instructions,</div>
<div class="line"><a name="l13426"></a><span class="lineno">13426</span>&#160;                                                    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> &amp;R,</div>
<div class="line"><a name="l13427"></a><span class="lineno">13427</span>&#160;                                                    <span class="keywordtype">bool</span> AtTerminator) {</div>
<div class="line"><a name="l13428"></a><span class="lineno">13428</span>&#160;  <span class="keywordtype">bool</span> OpsChanged = <span class="keyword">false</span>;</div>
<div class="line"><a name="l13429"></a><span class="lineno">13429</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 4&gt;</a> PostponedCmps;</div>
<div class="line"><a name="l13430"></a><span class="lineno">13430</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;WeakTrackingVH&gt;</a> PostponedInsts;</div>
<div class="line"><a name="l13431"></a><span class="lineno">13431</span>&#160;  <span class="comment">// pass1 - try to vectorize reductions only</span></div>
<div class="line"><a name="l13432"></a><span class="lineno">13432</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="namespacellvm.html#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(Instructions)) {</div>
<div class="line"><a name="l13433"></a><span class="lineno">13433</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.isDeleted(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l13434"></a><span class="lineno">13434</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13435"></a><span class="lineno">13435</span>&#160;    <span class="keywordflow">if</span> (isa&lt;CmpInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l13436"></a><span class="lineno">13436</span>&#160;      PostponedCmps.push_back(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l13437"></a><span class="lineno">13437</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13438"></a><span class="lineno">13438</span>&#160;    }</div>
<div class="line"><a name="l13439"></a><span class="lineno">13439</span>&#160;    OpsChanged |= vectorizeHorReduction(<span class="keyword">nullptr</span>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, R, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>, PostponedInsts);</div>
<div class="line"><a name="l13440"></a><span class="lineno">13440</span>&#160;  }</div>
<div class="line"><a name="l13441"></a><span class="lineno">13441</span>&#160;  <span class="comment">// pass2 - try to match and vectorize a buildvector sequence.</span></div>
<div class="line"><a name="l13442"></a><span class="lineno">13442</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="namespacellvm.html#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(Instructions)) {</div>
<div class="line"><a name="l13443"></a><span class="lineno">13443</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.isDeleted(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || isa&lt;CmpInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l13444"></a><span class="lineno">13444</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13445"></a><span class="lineno">13445</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *LastInsertValue = dyn_cast&lt;InsertValueInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l13446"></a><span class="lineno">13446</span>&#160;      OpsChanged |= vectorizeInsertValueInst(LastInsertValue, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, R);</div>
<div class="line"><a name="l13447"></a><span class="lineno">13447</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *LastInsertElem = dyn_cast&lt;InsertElementInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l13448"></a><span class="lineno">13448</span>&#160;      OpsChanged |= vectorizeInsertElementInst(LastInsertElem, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, R);</div>
<div class="line"><a name="l13449"></a><span class="lineno">13449</span>&#160;    }</div>
<div class="line"><a name="l13450"></a><span class="lineno">13450</span>&#160;  }</div>
<div class="line"><a name="l13451"></a><span class="lineno">13451</span>&#160;  <span class="comment">// Now try to vectorize postponed instructions.</span></div>
<div class="line"><a name="l13452"></a><span class="lineno">13452</span>&#160;  OpsChanged |= tryToVectorize(PostponedInsts, R);</div>
<div class="line"><a name="l13453"></a><span class="lineno">13453</span>&#160; </div>
<div class="line"><a name="l13454"></a><span class="lineno">13454</span>&#160;  <span class="keywordflow">if</span> (AtTerminator) {</div>
<div class="line"><a name="l13455"></a><span class="lineno">13455</span>&#160;    <span class="comment">// Try to find reductions first.</span></div>
<div class="line"><a name="l13456"></a><span class="lineno">13456</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : PostponedCmps) {</div>
<div class="line"><a name="l13457"></a><span class="lineno">13457</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.isDeleted(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l13458"></a><span class="lineno">13458</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13459"></a><span class="lineno">13459</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> : <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands())</div>
<div class="line"><a name="l13460"></a><span class="lineno">13460</span>&#160;        OpsChanged |= vectorizeRootInstruction(<span class="keyword">nullptr</span>, <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, R, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>);</div>
<div class="line"><a name="l13461"></a><span class="lineno">13461</span>&#160;    }</div>
<div class="line"><a name="l13462"></a><span class="lineno">13462</span>&#160;    <span class="comment">// Try to vectorize operands as vector bundles.</span></div>
<div class="line"><a name="l13463"></a><span class="lineno">13463</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : PostponedCmps) {</div>
<div class="line"><a name="l13464"></a><span class="lineno">13464</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.isDeleted(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l13465"></a><span class="lineno">13465</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13466"></a><span class="lineno">13466</span>&#160;      OpsChanged |= tryToVectorize(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, R);</div>
<div class="line"><a name="l13467"></a><span class="lineno">13467</span>&#160;    }</div>
<div class="line"><a name="l13468"></a><span class="lineno">13468</span>&#160;    <span class="comment">// Try to vectorize list of compares.</span></div>
<div class="line"><a name="l13469"></a><span class="lineno">13469</span>&#160;    <span class="comment">// Sort by type, compare predicate, etc.</span></div>
<div class="line"><a name="l13470"></a><span class="lineno">13470</span>&#160;    <span class="keyword">auto</span> CompareSorter = [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>) {</div>
<div class="line"><a name="l13471"></a><span class="lineno">13471</span>&#160;      <span class="keywordflow">return</span> compareCmp&lt;false&gt;(V, <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>, *TLI,</div>
<div class="line"><a name="l13472"></a><span class="lineno">13472</span>&#160;                               [&amp;R](<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) { <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.isDeleted(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>); });</div>
<div class="line"><a name="l13473"></a><span class="lineno">13473</span>&#160;    };</div>
<div class="line"><a name="l13474"></a><span class="lineno">13474</span>&#160; </div>
<div class="line"><a name="l13475"></a><span class="lineno">13475</span>&#160;    <span class="keyword">auto</span> AreCompatibleCompares = [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *V1, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>) {</div>
<div class="line"><a name="l13476"></a><span class="lineno">13476</span>&#160;      <span class="keywordflow">if</span> (V1 == <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>)</div>
<div class="line"><a name="l13477"></a><span class="lineno">13477</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l13478"></a><span class="lineno">13478</span>&#160;      <span class="keywordflow">return</span> compareCmp&lt;true&gt;(V1, <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>, *TLI,</div>
<div class="line"><a name="l13479"></a><span class="lineno">13479</span>&#160;                              [&amp;R](<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) { <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.isDeleted(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>); });</div>
<div class="line"><a name="l13480"></a><span class="lineno">13480</span>&#160;    };</div>
<div class="line"><a name="l13481"></a><span class="lineno">13481</span>&#160;    <span class="keyword">auto</span> Limit = [&amp;<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l13482"></a><span class="lineno">13482</span>&#160;      <span class="keywordtype">unsigned</span> EltSize = <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.getVectorElementSize(V);</div>
<div class="line"><a name="l13483"></a><span class="lineno">13483</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(2U, <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.getMaxVecRegSize() / EltSize);</div>
<div class="line"><a name="l13484"></a><span class="lineno">13484</span>&#160;    };</div>
<div class="line"><a name="l13485"></a><span class="lineno">13485</span>&#160; </div>
<div class="line"><a name="l13486"></a><span class="lineno">13486</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *&gt;</a> Vals(PostponedCmps.begin(), PostponedCmps.end());</div>
<div class="line"><a name="l13487"></a><span class="lineno">13487</span>&#160;    OpsChanged |= tryToVectorizeSequence&lt;Value&gt;(</div>
<div class="line"><a name="l13488"></a><span class="lineno">13488</span>&#160;        Vals, Limit, CompareSorter, AreCompatibleCompares,</div>
<div class="line"><a name="l13489"></a><span class="lineno">13489</span>&#160;        [<span class="keyword">this</span>, &amp;R](<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> Candidates, <span class="keywordtype">bool</span> LimitForRegisterSize) {</div>
<div class="line"><a name="l13490"></a><span class="lineno">13490</span>&#160;          <span class="comment">// Exclude possible reductions from other blocks.</span></div>
<div class="line"><a name="l13491"></a><span class="lineno">13491</span>&#160;          <span class="keywordtype">bool</span> ArePossiblyReducedInOtherBlock =</div>
<div class="line"><a name="l13492"></a><span class="lineno">13492</span>&#160;              <a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(Candidates, [](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l13493"></a><span class="lineno">13493</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">any_of</a>(V-&gt;<a class="code" href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">users</a>(), [V](<a class="code" href="classllvm_1_1User.html">User</a> *U) {</div>
<div class="line"><a name="l13494"></a><span class="lineno">13494</span>&#160;                  return isa&lt;SelectInst&gt;(U) &amp;&amp;</div>
<div class="line"><a name="l13495"></a><span class="lineno">13495</span>&#160;                         cast&lt;SelectInst&gt;(U)-&gt;getParent() !=</div>
<div class="line"><a name="l13496"></a><span class="lineno">13496</span>&#160;                             cast&lt;Instruction&gt;(V)-&gt;getParent();</div>
<div class="line"><a name="l13497"></a><span class="lineno">13497</span>&#160;                });</div>
<div class="line"><a name="l13498"></a><span class="lineno">13498</span>&#160;              });</div>
<div class="line"><a name="l13499"></a><span class="lineno">13499</span>&#160;          <span class="keywordflow">if</span> (ArePossiblyReducedInOtherBlock)</div>
<div class="line"><a name="l13500"></a><span class="lineno">13500</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13501"></a><span class="lineno">13501</span>&#160;          <span class="keywordflow">return</span> tryToVectorizeList(Candidates, R, LimitForRegisterSize);</div>
<div class="line"><a name="l13502"></a><span class="lineno">13502</span>&#160;        },</div>
<div class="line"><a name="l13503"></a><span class="lineno">13503</span>&#160;        <span class="comment">/*LimitForRegisterSize=*/</span><span class="keyword">true</span>);</div>
<div class="line"><a name="l13504"></a><span class="lineno">13504</span>&#160;    <a class="code" href="MSA_8txt.html#ab49a28dbe60da0a607449e5308b1ec3f">Instructions</a>.clear();</div>
<div class="line"><a name="l13505"></a><span class="lineno">13505</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l13506"></a><span class="lineno">13506</span>&#160;    <a class="code" href="MSA_8txt.html#ab49a28dbe60da0a607449e5308b1ec3f">Instructions</a>.clear();</div>
<div class="line"><a name="l13507"></a><span class="lineno">13507</span>&#160;    <span class="comment">// Insert in reverse order since the PostponedCmps vector was filled in</span></div>
<div class="line"><a name="l13508"></a><span class="lineno">13508</span>&#160;    <span class="comment">// reverse order.</span></div>
<div class="line"><a name="l13509"></a><span class="lineno">13509</span>&#160;    <a class="code" href="MSA_8txt.html#ab49a28dbe60da0a607449e5308b1ec3f">Instructions</a>.insert(PostponedCmps.rbegin(), PostponedCmps.rend());</div>
<div class="line"><a name="l13510"></a><span class="lineno">13510</span>&#160;  }</div>
<div class="line"><a name="l13511"></a><span class="lineno">13511</span>&#160;  <span class="keywordflow">return</span> OpsChanged;</div>
<div class="line"><a name="l13512"></a><span class="lineno">13512</span>&#160;}</div>
<div class="line"><a name="l13513"></a><span class="lineno">13513</span>&#160; </div>
<div class="line"><a name="l13514"></a><span class="lineno">13514</span>&#160;<span class="keywordtype">bool</span> SLPVectorizerPass::vectorizeChainsInBlock(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> &amp;R) {</div>
<div class="line"><a name="l13515"></a><span class="lineno">13515</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l13516"></a><span class="lineno">13516</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 4&gt;</a> Incoming;</div>
<div class="line"><a name="l13517"></a><span class="lineno">13517</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value *, 16&gt;</a> VisitedInstrs;</div>
<div class="line"><a name="l13518"></a><span class="lineno">13518</span>&#160;  <span class="comment">// Maps phi nodes to the non-phi nodes found in the use tree for each phi</span></div>
<div class="line"><a name="l13519"></a><span class="lineno">13519</span>&#160;  <span class="comment">// node. Allows better to identify the chains that can be vectorized in the</span></div>
<div class="line"><a name="l13520"></a><span class="lineno">13520</span>&#160;  <span class="comment">// better way.</span></div>
<div class="line"><a name="l13521"></a><span class="lineno">13521</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, SmallVector&lt;Value *, 4&gt;</a>&gt; PHIToOpcodes;</div>
<div class="line"><a name="l13522"></a><span class="lineno">13522</span>&#160;  <span class="keyword">auto</span> PHICompare = [<span class="keyword">this</span>, &amp;PHIToOpcodes](<a class="code" href="classllvm_1_1Value.html">Value</a> *V1, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>) {</div>
<div class="line"><a name="l13523"></a><span class="lineno">13523</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="SLPVectorizer_8cpp.html#aa3ea54a95743867473d32853d3c65603">isValidElementType</a>(V1-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()) &amp;&amp;</div>
<div class="line"><a name="l13524"></a><span class="lineno">13524</span>&#160;           <a class="code" href="SLPVectorizer_8cpp.html#aa3ea54a95743867473d32853d3c65603">isValidElementType</a>(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>-&gt;getType()) &amp;&amp;</div>
<div class="line"><a name="l13525"></a><span class="lineno">13525</span>&#160;           <span class="stringliteral">&quot;Expected vectorizable types only.&quot;</span>);</div>
<div class="line"><a name="l13526"></a><span class="lineno">13526</span>&#160;    <span class="comment">// It is fine to compare type IDs here, since we expect only vectorizable</span></div>
<div class="line"><a name="l13527"></a><span class="lineno">13527</span>&#160;    <span class="comment">// types, like ints, floats and pointers, we don&#39;t care about other type.</span></div>
<div class="line"><a name="l13528"></a><span class="lineno">13528</span>&#160;    <span class="keywordflow">if</span> (V1-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#ac7b0ed5c6d30bad74769c6e87ab0edb8">getTypeID</a>() &lt; <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>-&gt;getType()-&gt;getTypeID())</div>
<div class="line"><a name="l13529"></a><span class="lineno">13529</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l13530"></a><span class="lineno">13530</span>&#160;    <span class="keywordflow">if</span> (V1-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#ac7b0ed5c6d30bad74769c6e87ab0edb8">getTypeID</a>() &gt; <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>-&gt;getType()-&gt;getTypeID())</div>
<div class="line"><a name="l13531"></a><span class="lineno">13531</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13532"></a><span class="lineno">13532</span>&#160;    <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> Opcodes1 = PHIToOpcodes[V1];</div>
<div class="line"><a name="l13533"></a><span class="lineno">13533</span>&#160;    <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> Opcodes2 = PHIToOpcodes[<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>];</div>
<div class="line"><a name="l13534"></a><span class="lineno">13534</span>&#160;    <span class="keywordflow">if</span> (Opcodes1.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() &lt; Opcodes2.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>())</div>
<div class="line"><a name="l13535"></a><span class="lineno">13535</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l13536"></a><span class="lineno">13536</span>&#160;    <span class="keywordflow">if</span> (Opcodes1.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() &gt; Opcodes2.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>())</div>
<div class="line"><a name="l13537"></a><span class="lineno">13537</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13538"></a><span class="lineno">13538</span>&#160;    std::optional&lt;bool&gt; ConstOrder;</div>
<div class="line"><a name="l13539"></a><span class="lineno">13539</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = Opcodes1.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l13540"></a><span class="lineno">13540</span>&#160;      <span class="comment">// Undefs are compatible with any other value.</span></div>
<div class="line"><a name="l13541"></a><span class="lineno">13541</span>&#160;      <span class="keywordflow">if</span> (isa&lt;UndefValue&gt;(Opcodes1[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]) || isa&lt;UndefValue&gt;(Opcodes2[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>])) {</div>
<div class="line"><a name="l13542"></a><span class="lineno">13542</span>&#160;        <span class="keywordflow">if</span> (!ConstOrder)</div>
<div class="line"><a name="l13543"></a><span class="lineno">13543</span>&#160;          ConstOrder =</div>
<div class="line"><a name="l13544"></a><span class="lineno">13544</span>&#160;              !isa&lt;UndefValue&gt;(Opcodes1[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]) &amp;&amp; isa&lt;UndefValue&gt;(Opcodes2[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]);</div>
<div class="line"><a name="l13545"></a><span class="lineno">13545</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13546"></a><span class="lineno">13546</span>&#160;      }</div>
<div class="line"><a name="l13547"></a><span class="lineno">13547</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *I1 = dyn_cast&lt;Instruction&gt;(Opcodes1[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]))</div>
<div class="line"><a name="l13548"></a><span class="lineno">13548</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *I2 = dyn_cast&lt;Instruction&gt;(Opcodes2[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>])) {</div>
<div class="line"><a name="l13549"></a><span class="lineno">13549</span>&#160;          <a class="code" href="classllvm_1_1DomTreeNodeBase.html">DomTreeNodeBase&lt;BasicBlock&gt;</a> *NodeI1 = DT-&gt;getNode(<a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>-&gt;getParent());</div>
<div class="line"><a name="l13550"></a><span class="lineno">13550</span>&#160;          <a class="code" href="classllvm_1_1DomTreeNodeBase.html">DomTreeNodeBase&lt;BasicBlock&gt;</a> *NodeI2 = DT-&gt;getNode(I2-&gt;getParent());</div>
<div class="line"><a name="l13551"></a><span class="lineno">13551</span>&#160;          <span class="keywordflow">if</span> (!NodeI1)</div>
<div class="line"><a name="l13552"></a><span class="lineno">13552</span>&#160;            <span class="keywordflow">return</span> NodeI2 != <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l13553"></a><span class="lineno">13553</span>&#160;          <span class="keywordflow">if</span> (!NodeI2)</div>
<div class="line"><a name="l13554"></a><span class="lineno">13554</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13555"></a><span class="lineno">13555</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((NodeI1 == NodeI2) ==</div>
<div class="line"><a name="l13556"></a><span class="lineno">13556</span>&#160;                     (NodeI1-&gt;<a class="code" href="classllvm_1_1DomTreeNodeBase.html#a718717ee958956ec34ed177ef0b7f2ba">getDFSNumIn</a>() == NodeI2-&gt;<a class="code" href="classllvm_1_1DomTreeNodeBase.html#a718717ee958956ec34ed177ef0b7f2ba">getDFSNumIn</a>()) &amp;&amp;</div>
<div class="line"><a name="l13557"></a><span class="lineno">13557</span>&#160;                 <span class="stringliteral">&quot;Different nodes should have different DFS numbers&quot;</span>);</div>
<div class="line"><a name="l13558"></a><span class="lineno">13558</span>&#160;          <span class="keywordflow">if</span> (NodeI1 != NodeI2)</div>
<div class="line"><a name="l13559"></a><span class="lineno">13559</span>&#160;            <span class="keywordflow">return</span> NodeI1-&gt;<a class="code" href="classllvm_1_1DomTreeNodeBase.html#a718717ee958956ec34ed177ef0b7f2ba">getDFSNumIn</a>() &lt; NodeI2-&gt;<a class="code" href="classllvm_1_1DomTreeNodeBase.html#a718717ee958956ec34ed177ef0b7f2ba">getDFSNumIn</a>();</div>
<div class="line"><a name="l13560"></a><span class="lineno">13560</span>&#160;          InstructionsState <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = <a class="code" href="SLPVectorizer_8cpp.html#ae37b3a41d982a793664ab021d9b9b325">getSameOpcode</a>({<a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>, I2}, *TLI);</div>
<div class="line"><a name="l13561"></a><span class="lineno">13561</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.getOpcode())</div>
<div class="line"><a name="l13562"></a><span class="lineno">13562</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13563"></a><span class="lineno">13563</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>-&gt;getOpcode() &lt; I2-&gt;getOpcode();</div>
<div class="line"><a name="l13564"></a><span class="lineno">13564</span>&#160;        }</div>
<div class="line"><a name="l13565"></a><span class="lineno">13565</span>&#160;      <span class="keywordflow">if</span> (isa&lt;Constant&gt;(Opcodes1[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]) &amp;&amp; isa&lt;Constant&gt;(Opcodes2[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>])) {</div>
<div class="line"><a name="l13566"></a><span class="lineno">13566</span>&#160;        <span class="keywordflow">if</span> (!ConstOrder)</div>
<div class="line"><a name="l13567"></a><span class="lineno">13567</span>&#160;          ConstOrder = Opcodes1[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]-&gt;getValueID() &lt; Opcodes2[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]-&gt;getValueID();</div>
<div class="line"><a name="l13568"></a><span class="lineno">13568</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13569"></a><span class="lineno">13569</span>&#160;      }</div>
<div class="line"><a name="l13570"></a><span class="lineno">13570</span>&#160;      <span class="keywordflow">if</span> (Opcodes1[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]-&gt;getValueID() &lt; Opcodes2[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]-&gt;getValueID())</div>
<div class="line"><a name="l13571"></a><span class="lineno">13571</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l13572"></a><span class="lineno">13572</span>&#160;      <span class="keywordflow">if</span> (Opcodes1[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]-&gt;getValueID() &gt; Opcodes2[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]-&gt;getValueID())</div>
<div class="line"><a name="l13573"></a><span class="lineno">13573</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13574"></a><span class="lineno">13574</span>&#160;    }</div>
<div class="line"><a name="l13575"></a><span class="lineno">13575</span>&#160;    <span class="keywordflow">return</span> ConstOrder &amp;&amp; *ConstOrder;</div>
<div class="line"><a name="l13576"></a><span class="lineno">13576</span>&#160;  };</div>
<div class="line"><a name="l13577"></a><span class="lineno">13577</span>&#160;  <span class="keyword">auto</span> AreCompatiblePHIs = [&amp;PHIToOpcodes, <span class="keyword">this</span>](<a class="code" href="classllvm_1_1Value.html">Value</a> *V1, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>) {</div>
<div class="line"><a name="l13578"></a><span class="lineno">13578</span>&#160;    <span class="keywordflow">if</span> (V1 == <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>)</div>
<div class="line"><a name="l13579"></a><span class="lineno">13579</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l13580"></a><span class="lineno">13580</span>&#160;    <span class="keywordflow">if</span> (V1-&gt;getType() != <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>-&gt;getType())</div>
<div class="line"><a name="l13581"></a><span class="lineno">13581</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13582"></a><span class="lineno">13582</span>&#160;    <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> Opcodes1 = PHIToOpcodes[V1];</div>
<div class="line"><a name="l13583"></a><span class="lineno">13583</span>&#160;    <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> Opcodes2 = PHIToOpcodes[<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>];</div>
<div class="line"><a name="l13584"></a><span class="lineno">13584</span>&#160;    <span class="keywordflow">if</span> (Opcodes1.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() != Opcodes2.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>())</div>
<div class="line"><a name="l13585"></a><span class="lineno">13585</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13586"></a><span class="lineno">13586</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = Opcodes1.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l13587"></a><span class="lineno">13587</span>&#160;      <span class="comment">// Undefs are compatible with any other value.</span></div>
<div class="line"><a name="l13588"></a><span class="lineno">13588</span>&#160;      <span class="keywordflow">if</span> (isa&lt;UndefValue&gt;(Opcodes1[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]) || isa&lt;UndefValue&gt;(Opcodes2[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]))</div>
<div class="line"><a name="l13589"></a><span class="lineno">13589</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13590"></a><span class="lineno">13590</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *I1 = dyn_cast&lt;Instruction&gt;(Opcodes1[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]))</div>
<div class="line"><a name="l13591"></a><span class="lineno">13591</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *I2 = dyn_cast&lt;Instruction&gt;(Opcodes2[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>])) {</div>
<div class="line"><a name="l13592"></a><span class="lineno">13592</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>-&gt;getParent() != I2-&gt;getParent())</div>
<div class="line"><a name="l13593"></a><span class="lineno">13593</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13594"></a><span class="lineno">13594</span>&#160;          InstructionsState <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = <a class="code" href="SLPVectorizer_8cpp.html#ae37b3a41d982a793664ab021d9b9b325">getSameOpcode</a>({<a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>, I2}, *TLI);</div>
<div class="line"><a name="l13595"></a><span class="lineno">13595</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.getOpcode())</div>
<div class="line"><a name="l13596"></a><span class="lineno">13596</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13597"></a><span class="lineno">13597</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13598"></a><span class="lineno">13598</span>&#160;        }</div>
<div class="line"><a name="l13599"></a><span class="lineno">13599</span>&#160;      <span class="keywordflow">if</span> (isa&lt;Constant&gt;(Opcodes1[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]) &amp;&amp; isa&lt;Constant&gt;(Opcodes2[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]))</div>
<div class="line"><a name="l13600"></a><span class="lineno">13600</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13601"></a><span class="lineno">13601</span>&#160;      <span class="keywordflow">if</span> (Opcodes1[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]-&gt;getValueID() != Opcodes2[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]-&gt;getValueID())</div>
<div class="line"><a name="l13602"></a><span class="lineno">13602</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13603"></a><span class="lineno">13603</span>&#160;    }</div>
<div class="line"><a name="l13604"></a><span class="lineno">13604</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l13605"></a><span class="lineno">13605</span>&#160;  };</div>
<div class="line"><a name="l13606"></a><span class="lineno">13606</span>&#160;  <span class="keyword">auto</span> Limit = [&amp;<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>](<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l13607"></a><span class="lineno">13607</span>&#160;    <span class="keywordtype">unsigned</span> EltSize = <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.getVectorElementSize(V);</div>
<div class="line"><a name="l13608"></a><span class="lineno">13608</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">std::max</a>(2U, <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.getMaxVecRegSize() / EltSize);</div>
<div class="line"><a name="l13609"></a><span class="lineno">13609</span>&#160;  };</div>
<div class="line"><a name="l13610"></a><span class="lineno">13610</span>&#160; </div>
<div class="line"><a name="l13611"></a><span class="lineno">13611</span>&#160;  <span class="keywordtype">bool</span> HaveVectorizedPhiNodes = <span class="keyword">false</span>;</div>
<div class="line"><a name="l13612"></a><span class="lineno">13612</span>&#160;  <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l13613"></a><span class="lineno">13613</span>&#160;    <span class="comment">// Collect the incoming values from the PHIs.</span></div>
<div class="line"><a name="l13614"></a><span class="lineno">13614</span>&#160;    Incoming.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div>
<div class="line"><a name="l13615"></a><span class="lineno">13615</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l13616"></a><span class="lineno">13616</span>&#160;      <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> = dyn_cast&lt;PHINode&gt;(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l13617"></a><span class="lineno">13617</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>)</div>
<div class="line"><a name="l13618"></a><span class="lineno">13618</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l13619"></a><span class="lineno">13619</span>&#160; </div>
<div class="line"><a name="l13620"></a><span class="lineno">13620</span>&#160;      <span class="comment">// No need to analyze deleted, vectorized and non-vectorizable</span></div>
<div class="line"><a name="l13621"></a><span class="lineno">13621</span>&#160;      <span class="comment">// instructions.</span></div>
<div class="line"><a name="l13622"></a><span class="lineno">13622</span>&#160;      <span class="keywordflow">if</span> (!VisitedInstrs.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>) &amp;&amp; !<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.isDeleted(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>) &amp;&amp;</div>
<div class="line"><a name="l13623"></a><span class="lineno">13623</span>&#160;          <a class="code" href="SLPVectorizer_8cpp.html#aa3ea54a95743867473d32853d3c65603">isValidElementType</a>(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>-&gt;getType()))</div>
<div class="line"><a name="l13624"></a><span class="lineno">13624</span>&#160;        Incoming.push_back(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>);</div>
<div class="line"><a name="l13625"></a><span class="lineno">13625</span>&#160;    }</div>
<div class="line"><a name="l13626"></a><span class="lineno">13626</span>&#160; </div>
<div class="line"><a name="l13627"></a><span class="lineno">13627</span>&#160;    <span class="comment">// Find the corresponding non-phi nodes for better matching when trying to</span></div>
<div class="line"><a name="l13628"></a><span class="lineno">13628</span>&#160;    <span class="comment">// build the tree.</span></div>
<div class="line"><a name="l13629"></a><span class="lineno">13629</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : Incoming) {</div>
<div class="line"><a name="l13630"></a><span class="lineno">13630</span>&#160;      <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Value *&gt;</a> &amp;Opcodes =</div>
<div class="line"><a name="l13631"></a><span class="lineno">13631</span>&#160;          PHIToOpcodes.<a class="code" href="classllvm_1_1DenseMapBase.html#a98c685a0c53f3f7ed5f4793890a6c850">try_emplace</a>(V).first-&gt;getSecond();</div>
<div class="line"><a name="l13632"></a><span class="lineno">13632</span>&#160;      <span class="keywordflow">if</span> (!Opcodes.empty())</div>
<div class="line"><a name="l13633"></a><span class="lineno">13633</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13634"></a><span class="lineno">13634</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 4&gt;</a> Nodes(1, V);</div>
<div class="line"><a name="l13635"></a><span class="lineno">13635</span>&#160;      <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value *, 4&gt;</a> Visited;</div>
<div class="line"><a name="l13636"></a><span class="lineno">13636</span>&#160;      <span class="keywordflow">while</span> (!Nodes.empty()) {</div>
<div class="line"><a name="l13637"></a><span class="lineno">13637</span>&#160;        <span class="keyword">auto</span> *<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = cast&lt;PHINode&gt;(Nodes.pop_back_val());</div>
<div class="line"><a name="l13638"></a><span class="lineno">13638</span>&#160;        <span class="keywordflow">if</span> (!Visited.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>).second)</div>
<div class="line"><a name="l13639"></a><span class="lineno">13639</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13640"></a><span class="lineno">13640</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;incoming_values()) {</div>
<div class="line"><a name="l13641"></a><span class="lineno">13641</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">auto</span> *PHI1 = dyn_cast&lt;PHINode&gt;((V))) {</div>
<div class="line"><a name="l13642"></a><span class="lineno">13642</span>&#160;            Nodes.push_back(PHI1);</div>
<div class="line"><a name="l13643"></a><span class="lineno">13643</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13644"></a><span class="lineno">13644</span>&#160;          }</div>
<div class="line"><a name="l13645"></a><span class="lineno">13645</span>&#160;          Opcodes.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>(V);</div>
<div class="line"><a name="l13646"></a><span class="lineno">13646</span>&#160;        }</div>
<div class="line"><a name="l13647"></a><span class="lineno">13647</span>&#160;      }</div>
<div class="line"><a name="l13648"></a><span class="lineno">13648</span>&#160;    }</div>
<div class="line"><a name="l13649"></a><span class="lineno">13649</span>&#160; </div>
<div class="line"><a name="l13650"></a><span class="lineno">13650</span>&#160;    HaveVectorizedPhiNodes = tryToVectorizeSequence&lt;Value&gt;(</div>
<div class="line"><a name="l13651"></a><span class="lineno">13651</span>&#160;        Incoming, Limit, PHICompare, AreCompatiblePHIs,</div>
<div class="line"><a name="l13652"></a><span class="lineno">13652</span>&#160;        [<span class="keyword">this</span>, &amp;R](<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value *&gt;</a> Candidates, <span class="keywordtype">bool</span> LimitForRegisterSize) {</div>
<div class="line"><a name="l13653"></a><span class="lineno">13653</span>&#160;          <span class="keywordflow">return</span> tryToVectorizeList(Candidates, R, LimitForRegisterSize);</div>
<div class="line"><a name="l13654"></a><span class="lineno">13654</span>&#160;        },</div>
<div class="line"><a name="l13655"></a><span class="lineno">13655</span>&#160;        <span class="comment">/*LimitForRegisterSize=*/</span><span class="keyword">true</span>);</div>
<div class="line"><a name="l13656"></a><span class="lineno">13656</span>&#160;    Changed |= HaveVectorizedPhiNodes;</div>
<div class="line"><a name="l13657"></a><span class="lineno">13657</span>&#160;    VisitedInstrs.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(Incoming.begin(), Incoming.end());</div>
<div class="line"><a name="l13658"></a><span class="lineno">13658</span>&#160;  } <span class="keywordflow">while</span> (HaveVectorizedPhiNodes);</div>
<div class="line"><a name="l13659"></a><span class="lineno">13659</span>&#160; </div>
<div class="line"><a name="l13660"></a><span class="lineno">13660</span>&#160;  VisitedInstrs.<a class="code" href="classllvm_1_1SmallPtrSetImplBase.html#a16413f1a88d8baca228d0a1b4cc0bfc6">clear</a>();</div>
<div class="line"><a name="l13661"></a><span class="lineno">13661</span>&#160; </div>
<div class="line"><a name="l13662"></a><span class="lineno">13662</span>&#160;  InstSetVector PostProcessInstructions;</div>
<div class="line"><a name="l13663"></a><span class="lineno">13663</span>&#160;  <a class="code" href="classllvm_1_1SmallDenseSet.html">SmallDenseSet&lt;Instruction *, 4&gt;</a> KeyNodes;</div>
<div class="line"><a name="l13664"></a><span class="lineno">13664</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a> = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;begin(), <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;end(); <a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a>) {</div>
<div class="line"><a name="l13665"></a><span class="lineno">13665</span>&#160;    <span class="comment">// Skip instructions with scalable type. The num of elements is unknown at</span></div>
<div class="line"><a name="l13666"></a><span class="lineno">13666</span>&#160;    <span class="comment">// compile-time for scalable type.</span></div>
<div class="line"><a name="l13667"></a><span class="lineno">13667</span>&#160;    <span class="keywordflow">if</span> (isa&lt;ScalableVectorType&gt;(<a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a>-&gt;getType()))</div>
<div class="line"><a name="l13668"></a><span class="lineno">13668</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13669"></a><span class="lineno">13669</span>&#160; </div>
<div class="line"><a name="l13670"></a><span class="lineno">13670</span>&#160;    <span class="comment">// Skip instructions marked for the deletion.</span></div>
<div class="line"><a name="l13671"></a><span class="lineno">13671</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.isDeleted(&amp;*<a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a>))</div>
<div class="line"><a name="l13672"></a><span class="lineno">13672</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13673"></a><span class="lineno">13673</span>&#160;    <span class="comment">// We may go through BB multiple times so skip the one we have checked.</span></div>
<div class="line"><a name="l13674"></a><span class="lineno">13674</span>&#160;    <span class="keywordflow">if</span> (!VisitedInstrs.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">insert</a>(&amp;*<a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a>).second) {</div>
<div class="line"><a name="l13675"></a><span class="lineno">13675</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a>-&gt;use_empty() &amp;&amp; KeyNodes.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(&amp;*<a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a>) &amp;&amp;</div>
<div class="line"><a name="l13676"></a><span class="lineno">13676</span>&#160;          vectorizeSimpleInstructions(PostProcessInstructions, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, R,</div>
<div class="line"><a name="l13677"></a><span class="lineno">13677</span>&#160;                                      <a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a>-&gt;isTerminator())) {</div>
<div class="line"><a name="l13678"></a><span class="lineno">13678</span>&#160;        <span class="comment">// We would like to start over since some instructions are deleted</span></div>
<div class="line"><a name="l13679"></a><span class="lineno">13679</span>&#160;        <span class="comment">// and the iterator may become invalid value.</span></div>
<div class="line"><a name="l13680"></a><span class="lineno">13680</span>&#160;        Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l13681"></a><span class="lineno">13681</span>&#160;        <a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a> = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;begin();</div>
<div class="line"><a name="l13682"></a><span class="lineno">13682</span>&#160;        <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;end();</div>
<div class="line"><a name="l13683"></a><span class="lineno">13683</span>&#160;      }</div>
<div class="line"><a name="l13684"></a><span class="lineno">13684</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13685"></a><span class="lineno">13685</span>&#160;    }</div>
<div class="line"><a name="l13686"></a><span class="lineno">13686</span>&#160; </div>
<div class="line"><a name="l13687"></a><span class="lineno">13687</span>&#160;    <span class="keywordflow">if</span> (isa&lt;DbgInfoIntrinsic&gt;(<a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a>))</div>
<div class="line"><a name="l13688"></a><span class="lineno">13688</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13689"></a><span class="lineno">13689</span>&#160; </div>
<div class="line"><a name="l13690"></a><span class="lineno">13690</span>&#160;    <span class="comment">// Try to vectorize reductions that use PHINodes.</span></div>
<div class="line"><a name="l13691"></a><span class="lineno">13691</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> = dyn_cast&lt;PHINode&gt;(<a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a>)) {</div>
<div class="line"><a name="l13692"></a><span class="lineno">13692</span>&#160;      <span class="comment">// Check that the PHI is a reduction PHI.</span></div>
<div class="line"><a name="l13693"></a><span class="lineno">13693</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>-&gt;getNumIncomingValues() == 2) {</div>
<div class="line"><a name="l13694"></a><span class="lineno">13694</span>&#160;        <span class="comment">// Try to match and vectorize a horizontal reduction.</span></div>
<div class="line"><a name="l13695"></a><span class="lineno">13695</span>&#160;        <span class="keywordflow">if</span> (vectorizeRootInstruction(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>, <a class="code" href="SLPVectorizer_8cpp.html#abae46c48115232bc5de18a6a5e1c7c7f">getReductionValue</a>(DT, <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, LI), <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, R,</div>
<div class="line"><a name="l13696"></a><span class="lineno">13696</span>&#160;                                     <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>)) {</div>
<div class="line"><a name="l13697"></a><span class="lineno">13697</span>&#160;          Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l13698"></a><span class="lineno">13698</span>&#160;          <a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a> = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;begin();</div>
<div class="line"><a name="l13699"></a><span class="lineno">13699</span>&#160;          <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;end();</div>
<div class="line"><a name="l13700"></a><span class="lineno">13700</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13701"></a><span class="lineno">13701</span>&#160;        }</div>
<div class="line"><a name="l13702"></a><span class="lineno">13702</span>&#160;      }</div>
<div class="line"><a name="l13703"></a><span class="lineno">13703</span>&#160;      <span class="comment">// Try to vectorize the incoming values of the PHI, to catch reductions</span></div>
<div class="line"><a name="l13704"></a><span class="lineno">13704</span>&#160;      <span class="comment">// that feed into PHIs.</span></div>
<div class="line"><a name="l13705"></a><span class="lineno">13705</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>-&gt;getNumIncomingValues(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) {</div>
<div class="line"><a name="l13706"></a><span class="lineno">13706</span>&#160;        <span class="comment">// Skip if the incoming block is the current BB for now. Also, bypass</span></div>
<div class="line"><a name="l13707"></a><span class="lineno">13707</span>&#160;        <span class="comment">// unreachable IR for efficiency and to avoid crashing.</span></div>
<div class="line"><a name="l13708"></a><span class="lineno">13708</span>&#160;        <span class="comment">// TODO: Collect the skipped incoming values and try to vectorize them</span></div>
<div class="line"><a name="l13709"></a><span class="lineno">13709</span>&#160;        <span class="comment">// after processing BB.</span></div>
<div class="line"><a name="l13710"></a><span class="lineno">13710</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> == <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>-&gt;getIncomingBlock(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</div>
<div class="line"><a name="l13711"></a><span class="lineno">13711</span>&#160;            !DT-&gt;isReachableFromEntry(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>-&gt;getIncomingBlock(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)))</div>
<div class="line"><a name="l13712"></a><span class="lineno">13712</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13713"></a><span class="lineno">13713</span>&#160; </div>
<div class="line"><a name="l13714"></a><span class="lineno">13714</span>&#160;        <span class="comment">// Postponed instructions should not be vectorized here, delay their</span></div>
<div class="line"><a name="l13715"></a><span class="lineno">13715</span>&#160;        <span class="comment">// vectorization.</span></div>
<div class="line"><a name="l13716"></a><span class="lineno">13716</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> *PI = dyn_cast&lt;Instruction&gt;(<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>-&gt;getIncomingValue(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</div>
<div class="line"><a name="l13717"></a><span class="lineno">13717</span>&#160;            PI &amp;&amp; !PostProcessInstructions.contains(PI))</div>
<div class="line"><a name="l13718"></a><span class="lineno">13718</span>&#160;          Changed |= vectorizeRootInstruction(<span class="keyword">nullptr</span>, <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>-&gt;getIncomingValue(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>),</div>
<div class="line"><a name="l13719"></a><span class="lineno">13719</span>&#160;                                              <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>-&gt;getIncomingBlock(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>), <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>, <a class="code" href="namespacellvm.html#aa0d69e81725c10fa5407f0bf34462068">TTI</a>);</div>
<div class="line"><a name="l13720"></a><span class="lineno">13720</span>&#160;      }</div>
<div class="line"><a name="l13721"></a><span class="lineno">13721</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13722"></a><span class="lineno">13722</span>&#160;    }</div>
<div class="line"><a name="l13723"></a><span class="lineno">13723</span>&#160; </div>
<div class="line"><a name="l13724"></a><span class="lineno">13724</span>&#160;    <span class="comment">// Ran into an instruction without users, like terminator, or function call</span></div>
<div class="line"><a name="l13725"></a><span class="lineno">13725</span>&#160;    <span class="comment">// with ignored return value, store. Ignore unused instructions (basing on</span></div>
<div class="line"><a name="l13726"></a><span class="lineno">13726</span>&#160;    <span class="comment">// instruction type, except for CallInst and InvokeInst).</span></div>
<div class="line"><a name="l13727"></a><span class="lineno">13727</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a>-&gt;use_empty() &amp;&amp;</div>
<div class="line"><a name="l13728"></a><span class="lineno">13728</span>&#160;        (<a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a>-&gt;getType()-&gt;isVoidTy() || isa&lt;CallInst, InvokeInst&gt;(<a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a>))) {</div>
<div class="line"><a name="l13729"></a><span class="lineno">13729</span>&#160;      KeyNodes.<a class="code" href="classllvm_1_1detail_1_1DenseSetImpl.html#a79eed48913651aeedda2eed25201ea84">insert</a>(&amp;*<a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a>);</div>
<div class="line"><a name="l13730"></a><span class="lineno">13730</span>&#160;      <span class="keywordtype">bool</span> OpsChanged = <span class="keyword">false</span>;</div>
<div class="line"><a name="l13731"></a><span class="lineno">13731</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;StoreInst&gt;(<a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a>);</div>
<div class="line"><a name="l13732"></a><span class="lineno">13732</span>&#160;      <span class="keywordtype">bool</span> TryToVectorizeRoot = <a class="code" href="SLPVectorizer_8cpp.html#aa96c1a4a5e83e1e1c4bd56981a3d0773">ShouldStartVectorizeHorAtStore</a> || !<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>;</div>
<div class="line"><a name="l13733"></a><span class="lineno">13733</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>) {</div>
<div class="line"><a name="l13734"></a><span class="lineno">13734</span>&#160;        <span class="keyword">auto</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Stores.find(<a class="code" href="namespacellvm.html#a3b1c5788b85ffa254be0e834edf5cf8f">getUnderlyingObject</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getPointerOperand()));</div>
<div class="line"><a name="l13735"></a><span class="lineno">13735</span>&#160;        <span class="comment">// Try to vectorize chain in store, if this is the only store to the</span></div>
<div class="line"><a name="l13736"></a><span class="lineno">13736</span>&#160;        <span class="comment">// address in the block.</span></div>
<div class="line"><a name="l13737"></a><span class="lineno">13737</span>&#160;        <span class="comment">// TODO: This is just a temporarily solution to save compile time. Need</span></div>
<div class="line"><a name="l13738"></a><span class="lineno">13738</span>&#160;        <span class="comment">// to investigate if we can safely turn on slp-vectorize-hor-store</span></div>
<div class="line"><a name="l13739"></a><span class="lineno">13739</span>&#160;        <span class="comment">// instead to allow lookup for reduction chains in all non-vectorized</span></div>
<div class="line"><a name="l13740"></a><span class="lineno">13740</span>&#160;        <span class="comment">// stores (need to check side effects and compile time).</span></div>
<div class="line"><a name="l13741"></a><span class="lineno">13741</span>&#160;        TryToVectorizeRoot = (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> == Stores.<a class="code" href="classllvm_1_1ArrayRef.html#a7ca5197533a9c1fb8a2bd30587fcec6b">end</a>() || <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second.size() == 1) &amp;&amp;</div>
<div class="line"><a name="l13742"></a><span class="lineno">13742</span>&#160;                             <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getValueOperand()-&gt;hasOneUse();</div>
<div class="line"><a name="l13743"></a><span class="lineno">13743</span>&#160;      }</div>
<div class="line"><a name="l13744"></a><span class="lineno">13744</span>&#160;      <span class="keywordflow">if</span> (TryToVectorizeRoot) {</div>
<div class="line"><a name="l13745"></a><span class="lineno">13745</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> *V : <a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a>-&gt;operand_values()) {</div>
<div class="line"><a name="l13746"></a><span class="lineno">13746</span>&#160;          <span class="comment">// Postponed instructions should not be vectorized here, delay their</span></div>
<div class="line"><a name="l13747"></a><span class="lineno">13747</span>&#160;          <span class="comment">// vectorization.</span></div>
<div class="line"><a name="l13748"></a><span class="lineno">13748</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a> = dyn_cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l13749"></a><span class="lineno">13749</span>&#160;              <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a> &amp;&amp; !PostProcessInstructions.contains(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a>))</div>
<div class="line"><a name="l13750"></a><span class="lineno">13750</span>&#160;            <span class="comment">// Try to match and vectorize a horizontal reduction.</span></div>
<div class="line"><a name="l13751"></a><span class="lineno">13751</span>&#160;            OpsChanged |= vectorizeRootInstruction(<span class="keyword">nullptr</span>, V, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, R, <a class="code" href="classllvm_1_1TargetTransformInfo.html">TTI</a>);</div>
<div class="line"><a name="l13752"></a><span class="lineno">13752</span>&#160;        }</div>
<div class="line"><a name="l13753"></a><span class="lineno">13753</span>&#160;      }</div>
<div class="line"><a name="l13754"></a><span class="lineno">13754</span>&#160;      <span class="comment">// Start vectorization of post-process list of instructions from the</span></div>
<div class="line"><a name="l13755"></a><span class="lineno">13755</span>&#160;      <span class="comment">// top-tree instructions to try to vectorize as many instructions as</span></div>
<div class="line"><a name="l13756"></a><span class="lineno">13756</span>&#160;      <span class="comment">// possible.</span></div>
<div class="line"><a name="l13757"></a><span class="lineno">13757</span>&#160;      OpsChanged |= vectorizeSimpleInstructions(PostProcessInstructions, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, R,</div>
<div class="line"><a name="l13758"></a><span class="lineno">13758</span>&#160;                                                <a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a>-&gt;isTerminator());</div>
<div class="line"><a name="l13759"></a><span class="lineno">13759</span>&#160;      <span class="keywordflow">if</span> (OpsChanged) {</div>
<div class="line"><a name="l13760"></a><span class="lineno">13760</span>&#160;        <span class="comment">// We would like to start over since some instructions are deleted</span></div>
<div class="line"><a name="l13761"></a><span class="lineno">13761</span>&#160;        <span class="comment">// and the iterator may become invalid value.</span></div>
<div class="line"><a name="l13762"></a><span class="lineno">13762</span>&#160;        Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l13763"></a><span class="lineno">13763</span>&#160;        <a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a> = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;begin();</div>
<div class="line"><a name="l13764"></a><span class="lineno">13764</span>&#160;        <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;end();</div>
<div class="line"><a name="l13765"></a><span class="lineno">13765</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13766"></a><span class="lineno">13766</span>&#160;      }</div>
<div class="line"><a name="l13767"></a><span class="lineno">13767</span>&#160;    }</div>
<div class="line"><a name="l13768"></a><span class="lineno">13768</span>&#160; </div>
<div class="line"><a name="l13769"></a><span class="lineno">13769</span>&#160;    <span class="keywordflow">if</span> (isa&lt;CmpInst, InsertElementInst, InsertValueInst&gt;(<a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a>))</div>
<div class="line"><a name="l13770"></a><span class="lineno">13770</span>&#160;      PostProcessInstructions.insert(&amp;*<a class="code" href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a>);</div>
<div class="line"><a name="l13771"></a><span class="lineno">13771</span>&#160;  }</div>
<div class="line"><a name="l13772"></a><span class="lineno">13772</span>&#160; </div>
<div class="line"><a name="l13773"></a><span class="lineno">13773</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l13774"></a><span class="lineno">13774</span>&#160;}</div>
<div class="line"><a name="l13775"></a><span class="lineno">13775</span>&#160; </div>
<div class="line"><a name="l13776"></a><span class="lineno">13776</span>&#160;<span class="keywordtype">bool</span> SLPVectorizerPass::vectorizeGEPIndices(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> &amp;R) {</div>
<div class="line"><a name="l13777"></a><span class="lineno">13777</span>&#160;  <span class="keyword">auto</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l13778"></a><span class="lineno">13778</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Entry : GEPs) {</div>
<div class="line"><a name="l13779"></a><span class="lineno">13779</span>&#160;    <span class="comment">// If the getelementptr list has fewer than two elements, there&#39;s nothing</span></div>
<div class="line"><a name="l13780"></a><span class="lineno">13780</span>&#160;    <span class="comment">// to do.</span></div>
<div class="line"><a name="l13781"></a><span class="lineno">13781</span>&#160;    <span class="keywordflow">if</span> (Entry.second.size() &lt; 2)</div>
<div class="line"><a name="l13782"></a><span class="lineno">13782</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13783"></a><span class="lineno">13783</span>&#160; </div>
<div class="line"><a name="l13784"></a><span class="lineno">13784</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Analyzing a getelementptr list of length &quot;</span></div>
<div class="line"><a name="l13785"></a><span class="lineno">13785</span>&#160;                      &lt;&lt; Entry.second.size() &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l13786"></a><span class="lineno">13786</span>&#160; </div>
<div class="line"><a name="l13787"></a><span class="lineno">13787</span>&#160;    <span class="comment">// Process the GEP list in chunks suitable for the target&#39;s supported</span></div>
<div class="line"><a name="l13788"></a><span class="lineno">13788</span>&#160;    <span class="comment">// vector size. If a vector register can&#39;t hold 1 element, we are done. We</span></div>
<div class="line"><a name="l13789"></a><span class="lineno">13789</span>&#160;    <span class="comment">// are trying to vectorize the index computations, so the maximum number of</span></div>
<div class="line"><a name="l13790"></a><span class="lineno">13790</span>&#160;    <span class="comment">// elements is based on the size of the index expression, rather than the</span></div>
<div class="line"><a name="l13791"></a><span class="lineno">13791</span>&#160;    <span class="comment">// size of the GEP itself (the target&#39;s pointer size).</span></div>
<div class="line"><a name="l13792"></a><span class="lineno">13792</span>&#160;    <span class="keywordtype">unsigned</span> MaxVecRegSize = <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.getMaxVecRegSize();</div>
<div class="line"><a name="l13793"></a><span class="lineno">13793</span>&#160;    <span class="keywordtype">unsigned</span> EltSize = <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.getVectorElementSize(*Entry.second[0]-&gt;idx_begin());</div>
<div class="line"><a name="l13794"></a><span class="lineno">13794</span>&#160;    <span class="keywordflow">if</span> (MaxVecRegSize &lt; EltSize)</div>
<div class="line"><a name="l13795"></a><span class="lineno">13795</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13796"></a><span class="lineno">13796</span>&#160; </div>
<div class="line"><a name="l13797"></a><span class="lineno">13797</span>&#160;    <span class="keywordtype">unsigned</span> MaxElts = MaxVecRegSize / EltSize;</div>
<div class="line"><a name="l13798"></a><span class="lineno">13798</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> BI = 0, BE = Entry.second.size(); BI &lt; BE; BI += MaxElts) {</div>
<div class="line"><a name="l13799"></a><span class="lineno">13799</span>&#160;      <span class="keyword">auto</span> <a class="code" href="namespacellvm_1_1omp.html#a16d7c5f77008a84ae20bf4a5c41e51f0ae88b4464fe326a51e6e6dfae28dd536d">Len</a> = std::min&lt;unsigned&gt;(BE - BI, MaxElts);</div>
<div class="line"><a name="l13800"></a><span class="lineno">13800</span>&#160;      <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;GetElementPtrInst *&gt;</a> GEPList(&amp;Entry.second[BI], Len);</div>
<div class="line"><a name="l13801"></a><span class="lineno">13801</span>&#160; </div>
<div class="line"><a name="l13802"></a><span class="lineno">13802</span>&#160;      <span class="comment">// Initialize a set a candidate getelementptrs. Note that we use a</span></div>
<div class="line"><a name="l13803"></a><span class="lineno">13803</span>&#160;      <span class="comment">// SetVector here to preserve program order. If the index computations</span></div>
<div class="line"><a name="l13804"></a><span class="lineno">13804</span>&#160;      <span class="comment">// are vectorizable and begin with loads, we want to minimize the chance</span></div>
<div class="line"><a name="l13805"></a><span class="lineno">13805</span>&#160;      <span class="comment">// of having to reorder them later.</span></div>
<div class="line"><a name="l13806"></a><span class="lineno">13806</span>&#160;      <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;Value *&gt;</a> Candidates(GEPList.begin(), GEPList.end());</div>
<div class="line"><a name="l13807"></a><span class="lineno">13807</span>&#160; </div>
<div class="line"><a name="l13808"></a><span class="lineno">13808</span>&#160;      <span class="comment">// Some of the candidates may have already been vectorized after we</span></div>
<div class="line"><a name="l13809"></a><span class="lineno">13809</span>&#160;      <span class="comment">// initially collected them. If so, they are marked as deleted, so remove</span></div>
<div class="line"><a name="l13810"></a><span class="lineno">13810</span>&#160;      <span class="comment">// them from the set of candidates.</span></div>
<div class="line"><a name="l13811"></a><span class="lineno">13811</span>&#160;      Candidates.remove_if(</div>
<div class="line"><a name="l13812"></a><span class="lineno">13812</span>&#160;          [&amp;R](<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) { <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.isDeleted(cast&lt;Instruction&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)); });</div>
<div class="line"><a name="l13813"></a><span class="lineno">13813</span>&#160; </div>
<div class="line"><a name="l13814"></a><span class="lineno">13814</span>&#160;      <span class="comment">// Remove from the set of candidates all pairs of getelementptrs with</span></div>
<div class="line"><a name="l13815"></a><span class="lineno">13815</span>&#160;      <span class="comment">// constant differences. Such getelementptrs are likely not good</span></div>
<div class="line"><a name="l13816"></a><span class="lineno">13816</span>&#160;      <span class="comment">// candidates for vectorization in a bottom-up phase since one can be</span></div>
<div class="line"><a name="l13817"></a><span class="lineno">13817</span>&#160;      <span class="comment">// computed from the other. We also ensure all candidate getelementptr</span></div>
<div class="line"><a name="l13818"></a><span class="lineno">13818</span>&#160;      <span class="comment">// indices are unique.</span></div>
<div class="line"><a name="l13819"></a><span class="lineno">13819</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = GEPList.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> &amp;&amp; Candidates.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() &gt; 1; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l13820"></a><span class="lineno">13820</span>&#160;        <span class="keyword">auto</span> *GEPI = GEPList[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l13821"></a><span class="lineno">13821</span>&#160;        <span class="keywordflow">if</span> (!Candidates.count(GEPI))</div>
<div class="line"><a name="l13822"></a><span class="lineno">13822</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13823"></a><span class="lineno">13823</span>&#160;        <span class="keyword">auto</span> *SCEVI = SE-&gt;<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(GEPList[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]);</div>
<div class="line"><a name="l13824"></a><span class="lineno">13824</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> J = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> + 1; J &lt; <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> &amp;&amp; Candidates.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() &gt; 1; ++J) {</div>
<div class="line"><a name="l13825"></a><span class="lineno">13825</span>&#160;          <span class="keyword">auto</span> *GEPJ = GEPList[J];</div>
<div class="line"><a name="l13826"></a><span class="lineno">13826</span>&#160;          <span class="keyword">auto</span> *SCEVJ = SE-&gt;<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(GEPList[J]);</div>
<div class="line"><a name="l13827"></a><span class="lineno">13827</span>&#160;          <span class="keywordflow">if</span> (isa&lt;SCEVConstant&gt;(SE-&gt;<a class="code" href="classllvm_1_1ScalarEvolution.html#a8bcb86d8d126d95b0dc05f09e8f3df96">getMinusSCEV</a>(SCEVI, SCEVJ))) {</div>
<div class="line"><a name="l13828"></a><span class="lineno">13828</span>&#160;            Candidates.remove(GEPI);</div>
<div class="line"><a name="l13829"></a><span class="lineno">13829</span>&#160;            Candidates.remove(GEPJ);</div>
<div class="line"><a name="l13830"></a><span class="lineno">13830</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (GEPI-&gt;idx_begin()-&gt;get() == GEPJ-&gt;idx_begin()-&gt;get()) {</div>
<div class="line"><a name="l13831"></a><span class="lineno">13831</span>&#160;            Candidates.remove(GEPJ);</div>
<div class="line"><a name="l13832"></a><span class="lineno">13832</span>&#160;          }</div>
<div class="line"><a name="l13833"></a><span class="lineno">13833</span>&#160;        }</div>
<div class="line"><a name="l13834"></a><span class="lineno">13834</span>&#160;      }</div>
<div class="line"><a name="l13835"></a><span class="lineno">13835</span>&#160; </div>
<div class="line"><a name="l13836"></a><span class="lineno">13836</span>&#160;      <span class="comment">// We break out of the above computation as soon as we know there are</span></div>
<div class="line"><a name="l13837"></a><span class="lineno">13837</span>&#160;      <span class="comment">// fewer than two candidates remaining.</span></div>
<div class="line"><a name="l13838"></a><span class="lineno">13838</span>&#160;      <span class="keywordflow">if</span> (Candidates.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() &lt; 2)</div>
<div class="line"><a name="l13839"></a><span class="lineno">13839</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13840"></a><span class="lineno">13840</span>&#160; </div>
<div class="line"><a name="l13841"></a><span class="lineno">13841</span>&#160;      <span class="comment">// Add the single, non-constant index of each candidate to the bundle. We</span></div>
<div class="line"><a name="l13842"></a><span class="lineno">13842</span>&#160;      <span class="comment">// ensured the indices met these constraints when we originally collected</span></div>
<div class="line"><a name="l13843"></a><span class="lineno">13843</span>&#160;      <span class="comment">// the getelementptrs.</span></div>
<div class="line"><a name="l13844"></a><span class="lineno">13844</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 16&gt;</a> Bundle(Candidates.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</div>
<div class="line"><a name="l13845"></a><span class="lineno">13845</span>&#160;      <span class="keyword">auto</span> BundleIndex = 0u;</div>
<div class="line"><a name="l13846"></a><span class="lineno">13846</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *V : Candidates) {</div>
<div class="line"><a name="l13847"></a><span class="lineno">13847</span>&#160;        <span class="keyword">auto</span> *<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = cast&lt;GetElementPtrInst&gt;(V);</div>
<div class="line"><a name="l13848"></a><span class="lineno">13848</span>&#160;        <span class="keyword">auto</span> *GEPIdx = <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;idx_begin()-&gt;get();</div>
<div class="line"><a name="l13849"></a><span class="lineno">13849</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getNumIndices() == 1 || !isa&lt;Constant&gt;(GEPIdx));</div>
<div class="line"><a name="l13850"></a><span class="lineno">13850</span>&#160;        Bundle[BundleIndex++] = GEPIdx;</div>
<div class="line"><a name="l13851"></a><span class="lineno">13851</span>&#160;      }</div>
<div class="line"><a name="l13852"></a><span class="lineno">13852</span>&#160; </div>
<div class="line"><a name="l13853"></a><span class="lineno">13853</span>&#160;      <span class="comment">// Try and vectorize the indices. We are currently only interested in</span></div>
<div class="line"><a name="l13854"></a><span class="lineno">13854</span>&#160;      <span class="comment">// gather-like cases of the form:</span></div>
<div class="line"><a name="l13855"></a><span class="lineno">13855</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l13856"></a><span class="lineno">13856</span>&#160;      <span class="comment">// ... = g[a[0] - b[0]] + g[a[1] - b[1]] + ...</span></div>
<div class="line"><a name="l13857"></a><span class="lineno">13857</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l13858"></a><span class="lineno">13858</span>&#160;      <span class="comment">// where the loads of &quot;a&quot;, the loads of &quot;b&quot;, and the subtractions can be</span></div>
<div class="line"><a name="l13859"></a><span class="lineno">13859</span>&#160;      <span class="comment">// performed in parallel. It&#39;s likely that detecting this pattern in a</span></div>
<div class="line"><a name="l13860"></a><span class="lineno">13860</span>&#160;      <span class="comment">// bottom-up phase will be simpler and less costly than building a</span></div>
<div class="line"><a name="l13861"></a><span class="lineno">13861</span>&#160;      <span class="comment">// full-blown top-down phase beginning at the consecutive loads.</span></div>
<div class="line"><a name="l13862"></a><span class="lineno">13862</span>&#160;      Changed |= tryToVectorizeList(Bundle, R);</div>
<div class="line"><a name="l13863"></a><span class="lineno">13863</span>&#160;    }</div>
<div class="line"><a name="l13864"></a><span class="lineno">13864</span>&#160;  }</div>
<div class="line"><a name="l13865"></a><span class="lineno">13865</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l13866"></a><span class="lineno">13866</span>&#160;}</div>
<div class="line"><a name="l13867"></a><span class="lineno">13867</span>&#160; </div>
<div class="line"><a name="l13868"></a><span class="lineno">13868</span>&#160;<span class="keywordtype">bool</span> SLPVectorizerPass::vectorizeStoreChains(<a class="code" href="namespaceBoUpSLP.html">BoUpSLP</a> &amp;R) {</div>
<div class="line"><a name="l13869"></a><span class="lineno">13869</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l13870"></a><span class="lineno">13870</span>&#160;  <span class="comment">// Sort by type, base pointers and values operand. Value operands must be</span></div>
<div class="line"><a name="l13871"></a><span class="lineno">13871</span>&#160;  <span class="comment">// compatible (have the same opcode, same parent), otherwise it is</span></div>
<div class="line"><a name="l13872"></a><span class="lineno">13872</span>&#160;  <span class="comment">// definitely not profitable to try to vectorize them.</span></div>
<div class="line"><a name="l13873"></a><span class="lineno">13873</span>&#160;  <span class="keyword">auto</span> &amp;&amp;StoreSorter = [<span class="keyword">this</span>](<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *V, <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>) {</div>
<div class="line"><a name="l13874"></a><span class="lineno">13874</span>&#160;    <span class="keywordflow">if</span> (V-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a67e539f9ec2e837c7b9653cb57c89b1e">getPointerOperandType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#ac7b0ed5c6d30bad74769c6e87ab0edb8">getTypeID</a>() &lt;</div>
<div class="line"><a name="l13875"></a><span class="lineno">13875</span>&#160;        <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>-&gt;getPointerOperandType()-&gt;getTypeID())</div>
<div class="line"><a name="l13876"></a><span class="lineno">13876</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l13877"></a><span class="lineno">13877</span>&#160;    <span class="keywordflow">if</span> (V-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a67e539f9ec2e837c7b9653cb57c89b1e">getPointerOperandType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#ac7b0ed5c6d30bad74769c6e87ab0edb8">getTypeID</a>() &gt;</div>
<div class="line"><a name="l13878"></a><span class="lineno">13878</span>&#160;        <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>-&gt;getPointerOperandType()-&gt;getTypeID())</div>
<div class="line"><a name="l13879"></a><span class="lineno">13879</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13880"></a><span class="lineno">13880</span>&#160;    <span class="comment">// UndefValues are compatible with all other values.</span></div>
<div class="line"><a name="l13881"></a><span class="lineno">13881</span>&#160;    <span class="keywordflow">if</span> (isa&lt;UndefValue&gt;(V-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a14298313bdf734e2db5a921cc6e861a0">getValueOperand</a>()) ||</div>
<div class="line"><a name="l13882"></a><span class="lineno">13882</span>&#160;        isa&lt;UndefValue&gt;(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>-&gt;getValueOperand()))</div>
<div class="line"><a name="l13883"></a><span class="lineno">13883</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13884"></a><span class="lineno">13884</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *I1 = dyn_cast&lt;Instruction&gt;(V-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a14298313bdf734e2db5a921cc6e861a0">getValueOperand</a>()))</div>
<div class="line"><a name="l13885"></a><span class="lineno">13885</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *I2 = dyn_cast&lt;Instruction&gt;(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>-&gt;getValueOperand())) {</div>
<div class="line"><a name="l13886"></a><span class="lineno">13886</span>&#160;        <a class="code" href="classllvm_1_1DomTreeNodeBase.html">DomTreeNodeBase&lt;llvm::BasicBlock&gt;</a> *NodeI1 =</div>
<div class="line"><a name="l13887"></a><span class="lineno">13887</span>&#160;            DT-&gt;getNode(<a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>-&gt;getParent());</div>
<div class="line"><a name="l13888"></a><span class="lineno">13888</span>&#160;        <a class="code" href="classllvm_1_1DomTreeNodeBase.html">DomTreeNodeBase&lt;llvm::BasicBlock&gt;</a> *NodeI2 =</div>
<div class="line"><a name="l13889"></a><span class="lineno">13889</span>&#160;            DT-&gt;getNode(I2-&gt;getParent());</div>
<div class="line"><a name="l13890"></a><span class="lineno">13890</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NodeI1 &amp;&amp; <span class="stringliteral">&quot;Should only process reachable instructions&quot;</span>);</div>
<div class="line"><a name="l13891"></a><span class="lineno">13891</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NodeI2 &amp;&amp; <span class="stringliteral">&quot;Should only process reachable instructions&quot;</span>);</div>
<div class="line"><a name="l13892"></a><span class="lineno">13892</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((NodeI1 == NodeI2) ==</div>
<div class="line"><a name="l13893"></a><span class="lineno">13893</span>&#160;                   (NodeI1-&gt;<a class="code" href="classllvm_1_1DomTreeNodeBase.html#a718717ee958956ec34ed177ef0b7f2ba">getDFSNumIn</a>() == NodeI2-&gt;<a class="code" href="classllvm_1_1DomTreeNodeBase.html#a718717ee958956ec34ed177ef0b7f2ba">getDFSNumIn</a>()) &amp;&amp;</div>
<div class="line"><a name="l13894"></a><span class="lineno">13894</span>&#160;               <span class="stringliteral">&quot;Different nodes should have different DFS numbers&quot;</span>);</div>
<div class="line"><a name="l13895"></a><span class="lineno">13895</span>&#160;        <span class="keywordflow">if</span> (NodeI1 != NodeI2)</div>
<div class="line"><a name="l13896"></a><span class="lineno">13896</span>&#160;          <span class="keywordflow">return</span> NodeI1-&gt;<a class="code" href="classllvm_1_1DomTreeNodeBase.html#a718717ee958956ec34ed177ef0b7f2ba">getDFSNumIn</a>() &lt; NodeI2-&gt;<a class="code" href="classllvm_1_1DomTreeNodeBase.html#a718717ee958956ec34ed177ef0b7f2ba">getDFSNumIn</a>();</div>
<div class="line"><a name="l13897"></a><span class="lineno">13897</span>&#160;        InstructionsState <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = <a class="code" href="SLPVectorizer_8cpp.html#ae37b3a41d982a793664ab021d9b9b325">getSameOpcode</a>({<a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>, I2}, *TLI);</div>
<div class="line"><a name="l13898"></a><span class="lineno">13898</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.getOpcode())</div>
<div class="line"><a name="l13899"></a><span class="lineno">13899</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13900"></a><span class="lineno">13900</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>-&gt;getOpcode() &lt; I2-&gt;getOpcode();</div>
<div class="line"><a name="l13901"></a><span class="lineno">13901</span>&#160;      }</div>
<div class="line"><a name="l13902"></a><span class="lineno">13902</span>&#160;    <span class="keywordflow">if</span> (isa&lt;Constant&gt;(V-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a14298313bdf734e2db5a921cc6e861a0">getValueOperand</a>()) &amp;&amp;</div>
<div class="line"><a name="l13903"></a><span class="lineno">13903</span>&#160;        isa&lt;Constant&gt;(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>-&gt;getValueOperand()))</div>
<div class="line"><a name="l13904"></a><span class="lineno">13904</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13905"></a><span class="lineno">13905</span>&#160;    <span class="keywordflow">return</span> V-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a14298313bdf734e2db5a921cc6e861a0">getValueOperand</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#a4a6ca5a5b87bd84231be9d8dbec46c1a">getValueID</a>() &lt;</div>
<div class="line"><a name="l13906"></a><span class="lineno">13906</span>&#160;           <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>-&gt;getValueOperand()-&gt;getValueID();</div>
<div class="line"><a name="l13907"></a><span class="lineno">13907</span>&#160;  };</div>
<div class="line"><a name="l13908"></a><span class="lineno">13908</span>&#160; </div>
<div class="line"><a name="l13909"></a><span class="lineno">13909</span>&#160;  <span class="keyword">auto</span> &amp;&amp;AreCompatibleStores = [<span class="keyword">this</span>](<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *V1, <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>) {</div>
<div class="line"><a name="l13910"></a><span class="lineno">13910</span>&#160;    <span class="keywordflow">if</span> (V1 == <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>)</div>
<div class="line"><a name="l13911"></a><span class="lineno">13911</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l13912"></a><span class="lineno">13912</span>&#160;    <span class="keywordflow">if</span> (V1-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a67e539f9ec2e837c7b9653cb57c89b1e">getPointerOperandType</a>() != <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>-&gt;getPointerOperandType())</div>
<div class="line"><a name="l13913"></a><span class="lineno">13913</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13914"></a><span class="lineno">13914</span>&#160;    <span class="comment">// Undefs are compatible with any other value.</span></div>
<div class="line"><a name="l13915"></a><span class="lineno">13915</span>&#160;    <span class="keywordflow">if</span> (isa&lt;UndefValue&gt;(V1-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a14298313bdf734e2db5a921cc6e861a0">getValueOperand</a>()) ||</div>
<div class="line"><a name="l13916"></a><span class="lineno">13916</span>&#160;        isa&lt;UndefValue&gt;(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>-&gt;getValueOperand()))</div>
<div class="line"><a name="l13917"></a><span class="lineno">13917</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l13918"></a><span class="lineno">13918</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *I1 = dyn_cast&lt;Instruction&gt;(V1-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a14298313bdf734e2db5a921cc6e861a0">getValueOperand</a>()))</div>
<div class="line"><a name="l13919"></a><span class="lineno">13919</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *I2 = dyn_cast&lt;Instruction&gt;(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>-&gt;getValueOperand())) {</div>
<div class="line"><a name="l13920"></a><span class="lineno">13920</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>-&gt;getParent() != I2-&gt;getParent())</div>
<div class="line"><a name="l13921"></a><span class="lineno">13921</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l13922"></a><span class="lineno">13922</span>&#160;        InstructionsState <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = <a class="code" href="SLPVectorizer_8cpp.html#ae37b3a41d982a793664ab021d9b9b325">getSameOpcode</a>({<a class="code" href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">I1</a>, I2}, *TLI);</div>
<div class="line"><a name="l13923"></a><span class="lineno">13923</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>.getOpcode() &gt; 0;</div>
<div class="line"><a name="l13924"></a><span class="lineno">13924</span>&#160;      }</div>
<div class="line"><a name="l13925"></a><span class="lineno">13925</span>&#160;    <span class="keywordflow">if</span> (isa&lt;Constant&gt;(V1-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a14298313bdf734e2db5a921cc6e861a0">getValueOperand</a>()) &amp;&amp;</div>
<div class="line"><a name="l13926"></a><span class="lineno">13926</span>&#160;        isa&lt;Constant&gt;(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>-&gt;getValueOperand()))</div>
<div class="line"><a name="l13927"></a><span class="lineno">13927</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l13928"></a><span class="lineno">13928</span>&#160;    <span class="keywordflow">return</span> V1-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a14298313bdf734e2db5a921cc6e861a0">getValueOperand</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#a4a6ca5a5b87bd84231be9d8dbec46c1a">getValueID</a>() ==</div>
<div class="line"><a name="l13929"></a><span class="lineno">13929</span>&#160;           <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>-&gt;getValueOperand()-&gt;getValueID();</div>
<div class="line"><a name="l13930"></a><span class="lineno">13930</span>&#160;  };</div>
<div class="line"><a name="l13931"></a><span class="lineno">13931</span>&#160;  <span class="keyword">auto</span> Limit = [&amp;<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>, <span class="keyword">this</span>](<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>) {</div>
<div class="line"><a name="l13932"></a><span class="lineno">13932</span>&#160;    <span class="keywordtype">unsigned</span> EltSize = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getTypeSizeInBits(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getValueOperand()-&gt;getType());</div>
<div class="line"><a name="l13933"></a><span class="lineno">13933</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>.getMinVF(EltSize);</div>
<div class="line"><a name="l13934"></a><span class="lineno">13934</span>&#160;  };</div>
<div class="line"><a name="l13935"></a><span class="lineno">13935</span>&#160; </div>
<div class="line"><a name="l13936"></a><span class="lineno">13936</span>&#160;  <span class="comment">// Attempt to sort and vectorize each of the store-groups.</span></div>
<div class="line"><a name="l13937"></a><span class="lineno">13937</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;Pair : Stores) {</div>
<div class="line"><a name="l13938"></a><span class="lineno">13938</span>&#160;    <span class="keywordflow">if</span> (Pair.second.size() &lt; 2)</div>
<div class="line"><a name="l13939"></a><span class="lineno">13939</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13940"></a><span class="lineno">13940</span>&#160; </div>
<div class="line"><a name="l13941"></a><span class="lineno">13941</span>&#160;    <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SLP: Analyzing a store chain of length &quot;</span></div>
<div class="line"><a name="l13942"></a><span class="lineno">13942</span>&#160;                      &lt;&lt; Pair.second.size() &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l13943"></a><span class="lineno">13943</span>&#160; </div>
<div class="line"><a name="l13944"></a><span class="lineno">13944</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="SLPVectorizer_8cpp.html#aa3ea54a95743867473d32853d3c65603">isValidElementType</a>(Pair.second.front()-&gt;getValueOperand()-&gt;getType()))</div>
<div class="line"><a name="l13945"></a><span class="lineno">13945</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l13946"></a><span class="lineno">13946</span>&#160; </div>
<div class="line"><a name="l13947"></a><span class="lineno">13947</span>&#160;    Changed |= tryToVectorizeSequence&lt;StoreInst&gt;(</div>
<div class="line"><a name="l13948"></a><span class="lineno">13948</span>&#160;        Pair.second, Limit, StoreSorter, AreCompatibleStores,</div>
<div class="line"><a name="l13949"></a><span class="lineno">13949</span>&#160;        [<span class="keyword">this</span>, &amp;R](<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;StoreInst *&gt;</a> Candidates, <span class="keywordtype">bool</span>) {</div>
<div class="line"><a name="l13950"></a><span class="lineno">13950</span>&#160;          return vectorizeStores(Candidates, R);</div>
<div class="line"><a name="l13951"></a><span class="lineno">13951</span>&#160;        },</div>
<div class="line"><a name="l13952"></a><span class="lineno">13952</span>&#160;        <span class="comment">/*LimitForRegisterSize=*/</span><span class="keyword">false</span>);</div>
<div class="line"><a name="l13953"></a><span class="lineno">13953</span>&#160;  }</div>
<div class="line"><a name="l13954"></a><span class="lineno">13954</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l13955"></a><span class="lineno">13955</span>&#160;}</div>
<div class="line"><a name="l13956"></a><span class="lineno">13956</span>&#160; </div>
<div class="line"><a name="l13957"></a><span class="lineno">13957</span>&#160;<span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46">SLPVectorizer::ID</a> = 0;</div>
<div class="line"><a name="l13958"></a><span class="lineno">13958</span>&#160; </div>
<div class="line"><a name="l13959"></a><span class="lineno"><a class="line" href="SLPVectorizer_8cpp.html#a5ce679c74f9d5aa21d8ea3d1a798f0a9">13959</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="SLPVectorizer_8cpp.html#a5ce679c74f9d5aa21d8ea3d1a798f0a9">lv_name</a>[] = <span class="stringliteral">&quot;SLP Vectorizer&quot;</span>;</div>
<div class="line"><a name="l13960"></a><span class="lineno">13960</span>&#160; </div>
<div class="line"><a name="l13961"></a><span class="lineno">13961</span>&#160;<a class="code" href="PassSupport_8h.html#aaa970fc931c1c63037a8182e028d04b1">INITIALIZE_PASS_BEGIN</a>(SLPVectorizer, <a class="code" href="SLPVectorizer_8cpp.html#a274654b7f5932cae6a71a113322481be">SV_NAME</a>, <a class="code" href="SLPVectorizer_8cpp.html#a5ce679c74f9d5aa21d8ea3d1a798f0a9">lv_name</a>, <span class="keyword">false</span>, <span class="keyword">false</span>)</div>
<div class="line"><a name="l13962"></a><span class="lineno">13962</span>&#160;<a class="code" href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1AAResultsWrapperPass.html">AAResultsWrapperPass</a>)</div>
<div class="line"><a name="l13963"></a><span class="lineno">13963</span>&#160;<a class="code" href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1TargetTransformInfoWrapperPass.html">TargetTransformInfoWrapperPass</a>)</div>
<div class="line"><a name="l13964"></a><span class="lineno">13964</span>&#160;<a class="code" href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1AssumptionCacheTracker.html">AssumptionCacheTracker</a>)</div>
<div class="line"><a name="l13965"></a><span class="lineno">13965</span>&#160;<a class="code" href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1ScalarEvolutionWrapperPass.html">ScalarEvolutionWrapperPass</a>)</div>
<div class="line"><a name="l13966"></a><span class="lineno">13966</span>&#160;<a class="code" href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a>(LoopSimplify)</div>
<div class="line"><a name="l13967"></a><span class="lineno">13967</span>&#160;<a class="code" href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1DemandedBitsWrapperPass.html">DemandedBitsWrapperPass</a>)</div>
<div class="line"><a name="l13968"></a><span class="lineno">13968</span>&#160;<a class="code" href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1OptimizationRemarkEmitterWrapperPass.html">OptimizationRemarkEmitterWrapperPass</a>)</div>
<div class="line"><a name="l13969"></a><span class="lineno">13969</span>&#160;<a class="code" href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1InjectTLIMappingsLegacy.html">InjectTLIMappingsLegacy</a>)</div>
<div class="line"><a name="l13970"></a><span class="lineno">13970</span>&#160;<a class="code" href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a>(SLPVectorizer, <a class="code" href="SLPVectorizer_8cpp.html#a274654b7f5932cae6a71a113322481be">SV_NAME</a>, <a class="code" href="SLPVectorizer_8cpp.html#a5ce679c74f9d5aa21d8ea3d1a798f0a9">lv_name</a>, <a class="code" href="namespacefalse.html">false</a>, <a class="code" href="namespacefalse.html">false</a>)</div>
<div class="line"><a name="l13971"></a><span class="lineno">13971</span>&#160; </div>
<div class="line"><a name="l13972"></a><span class="lineno"><a class="line" href="namespacellvm.html#a6a84483f8f0bece492d8083c524db5c0">13972</a></span>&#160;<a class="code" href="classllvm_1_1Pass.html">Pass</a> *<a class="code" href="namespacellvm.html">llvm</a>::<a class="code" href="namespacellvm.html#a6a84483f8f0bece492d8083c524db5c0">createSLPVectorizerPass</a>() { <span class="keywordflow">return</span> <span class="keyword">new</span> SLPVectorizer(); }</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="aclassllvm_1_1ShuffleVectorInst_html_a8f1924af1a6e8747ad3ca08f60b74fcb"><div class="ttname"><a href="classllvm_1_1ShuffleVectorInst.html#a8f1924af1a6e8747ad3ca08f60b74fcb">llvm::ShuffleVectorInst::isZeroEltSplatMask</a></div><div class="ttdeci">static bool isZeroEltSplatMask(ArrayRef&lt; int &gt; Mask)</div><div class="ttdoc">Return true if this shuffle mask chooses all elements with the same value as the first element of exa...</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l02344">Instructions.cpp:2344</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands_html_a017e1ed67d6b197edc2e79bb8bbdd769"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#a017e1ed67d6b197edc2e79bb8bbdd769">llvm::slpvectorizer::BoUpSLP::VLOperands::getVL</a></div><div class="ttdeci">ValueList getVL(unsigned OpIdx) const</div><div class="ttdoc">\Returns a value vector with the operands across all lanes for the opearnd at OpIdx.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l01980">SLPVectorizer.cpp:1980</a></div></div>
<div class="ttc" id="anamespacellvm_html_a8d9d7c33311a38eae588e12caf8985ce"><div class="ttname"><a href="namespacellvm.html#a8d9d7c33311a38eae588e12caf8985ce">llvm::sortPtrAccesses</a></div><div class="ttdeci">bool sortPtrAccesses(ArrayRef&lt; Value * &gt; VL, Type *ElemTy, const DataLayout &amp;DL, ScalarEvolution &amp;SE, SmallVectorImpl&lt; unsigned &gt; &amp;SortedIndices)</div><div class="ttdoc">Attempt to sort the pointers in VL and return the sorted indices in SortedIndices,...</div><div class="ttdef"><b>Definition:</b> <a href="LoopAccessAnalysis_8cpp_source.html#l01547">LoopAccessAnalysis.cpp:1547</a></div></div>
<div class="ttc" id="anamespacellvm_1_1Check_html_a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396"><div class="ttname"><a href="namespacellvm_1_1Check.html#a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396">llvm::Check::Size</a></div><div class="ttdeci">@ Size</div><div class="ttdef"><b>Definition:</b> <a href="FileCheck_8h_source.html#l00077">FileCheck.h:77</a></div></div>
<div class="ttc" id="alib_2Target_2README_8txt_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2README_8txt_source.html#l00029">README.txt:29</a></div></div>
<div class="ttc" id="anamespacellvm_1_1RegState_html_aef4cc0c855dc833e2a9d58a50703320dab502f975742e9bff6d6dd7b49439b806"><div class="ttname"><a href="namespacellvm_1_1RegState.html#aef4cc0c855dc833e2a9d58a50703320dab502f975742e9bff6d6dd7b49439b806">llvm::RegState::Undef</a></div><div class="ttdeci">@ Undef</div><div class="ttdoc">Value of the register doesn't matter.</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstrBuilder_8h_source.html#l00052">MachineInstrBuilder.h:52</a></div></div>
<div class="ttc" id="aclassllvm_1_1InstructionCost_html"><div class="ttname"><a href="classllvm_1_1InstructionCost.html">llvm::InstructionCost</a></div><div class="ttdef"><b>Definition:</b> <a href="InstructionCost_8h_source.html#l00029">InstructionCost.h:29</a></div></div>
<div class="ttc" id="aclassllvm_1_1PreservedAnalyses_html"><div class="ttname"><a href="classllvm_1_1PreservedAnalyses.html">llvm::PreservedAnalyses</a></div><div class="ttdoc">A set of analyses that are preserved following a run of a transformation pass.</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00152">PassManager.h:152</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_aaf4b1586dd2d57daa5d28ea5ee3e14ca"><div class="ttname"><a href="SLPVectorizer_8cpp.html#aaf4b1586dd2d57daa5d28ea5ee3e14ca">computeExtractCost</a></div><div class="ttdeci">static InstructionCost computeExtractCost(ArrayRef&lt; Value * &gt; VL, FixedVectorType *VecTy, TargetTransformInfo::ShuffleKind ShuffleKind, ArrayRef&lt; int &gt; Mask, TargetTransformInfo &amp;TTI)</div><div class="ttdoc">Compute the cost of creating a vector of type VecTy containing the extracted values from VL.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l06117">SLPVectorizer.cpp:6117</a></div></div>
<div class="ttc" id="aclassllvm_1_1BatchAAResults_html"><div class="ttname"><a href="classllvm_1_1BatchAAResults.html">llvm::BatchAAResults</a></div><div class="ttdoc">This class is a wrapper over an AAResults, and it is intended to be used only when there are no IR ch...</div><div class="ttdef"><b>Definition:</b> <a href="AliasAnalysis_8h_source.html#l00612">AliasAnalysis.h:612</a></div></div>
<div class="ttc" id="anamespacellvm_html_a1106b8a15061e8494873e10bb8a364e5"><div class="ttname"><a href="namespacellvm.html#a1106b8a15061e8494873e10bb8a364e5">llvm::RecursivelyDeleteTriviallyDeadInstructions</a></div><div class="ttdeci">bool RecursivelyDeleteTriviallyDeadInstructions(Value *V, const TargetLibraryInfo *TLI=nullptr, MemorySSAUpdater *MSSAU=nullptr, std::function&lt; void(Value *)&gt; AboutToDeleteCallback=std::function&lt; void(Value *)&gt;())</div><div class="ttdoc">If the specified value is a trivially dead instruction, delete it.</div><div class="ttdef"><b>Definition:</b> <a href="Transforms_2Utils_2Local_8cpp_source.html#l00537">Local.cpp:537</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallBitVector_html_a0ff6951070195d0a7e0e31ffe47daaf1"><div class="ttname"><a href="classllvm_1_1SmallBitVector.html#a0ff6951070195d0a7e0e31ffe47daaf1">llvm::SmallBitVector::set</a></div><div class="ttdeci">SmallBitVector &amp; set()</div><div class="ttdef"><b>Definition:</b> <a href="SmallBitVector_8h_source.html#l00366">SmallBitVector.h:366</a></div></div>
<div class="ttc" id="aAssumptionCache_8h_html"><div class="ttname"><a href="AssumptionCache_8h.html">AssumptionCache.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1AAManager_html"><div class="ttname"><a href="classllvm_1_1AAManager.html">llvm::AAManager</a></div><div class="ttdoc">A manager for alias analyses.</div><div class="ttdef"><b>Definition:</b> <a href="AliasAnalysis_8h_source.html#l00885">AliasAnalysis.h:885</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_html_a8f40b270f64be7a9b63bc9cfb3b2977a"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a8f40b270f64be7a9b63bc9cfb3b2977a">llvm::slpvectorizer::BoUpSLP::BoUpSLP</a></div><div class="ttdeci">BoUpSLP(Function *Func, ScalarEvolution *Se, TargetTransformInfo *Tti, TargetLibraryInfo *TLi, AAResults *Aa, LoopInfo *Li, DominatorTree *Dt, AssumptionCache *AC, DemandedBits *DB, const DataLayout *DL, OptimizationRemarkEmitter *ORE)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00976">SLPVectorizer.cpp:976</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_af46433d0e36d3f80afc3a8c67b5c53eca64d439485545faa793c20de7fbfd274c"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53eca64d439485545faa793c20de7fbfd274c">llvm::TargetTransformInfo::SK_Select</a></div><div class="ttdeci">@ SK_Select</div><div class="ttdoc">Selects elements from the corresponding lane of either source operand.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00913">TargetTransformInfo.h:913</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetIRAnalysis_html"><div class="ttname"><a href="classllvm_1_1TargetIRAnalysis.html">llvm::TargetIRAnalysis</a></div><div class="ttdoc">Analysis pass providing the TargetTransformInfo.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l02626">TargetTransformInfo.h:2626</a></div></div>
<div class="ttc" id="aclassllvm_1_1OptimizationRemarkMissed_html"><div class="ttname"><a href="classllvm_1_1OptimizationRemarkMissed.html">llvm::OptimizationRemarkMissed</a></div><div class="ttdoc">Diagnostic information for missed-optimization remarks.</div><div class="ttdef"><b>Definition:</b> <a href="DiagnosticInfo_8h_source.html#l00734">DiagnosticInfo.h:734</a></div></div>
<div class="ttc" id="astructllvm_1_1less__second_html"><div class="ttname"><a href="structllvm_1_1less__second.html">llvm::less_second</a></div><div class="ttdoc">Function object to check whether the second component of a std::pair compares less than the second co...</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01485">STLExtras.h:1485</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a706f223f760b55668fbae74202b816bb"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a706f223f760b55668fbae74202b816bb">llvm::TargetTransformInfo::TargetCostKind</a></div><div class="ttdeci">TargetCostKind</div><div class="ttdoc">The kind of cost model.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00241">TargetTransformInfo.h:241</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_html_afaa748b2bfe8b9ddbd614dab3542411c"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#afaa748b2bfe8b9ddbd614dab3542411c">llvm::slpvectorizer::BoUpSLP::clearReductionData</a></div><div class="ttdeci">void clearReductionData()</div><div class="ttdoc">Clear the list of the analyzed reduction root instructions.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l02237">SLPVectorizer.cpp:2237</a></div></div>
<div class="ttc" id="aclassllvm_1_1Loop_html_a6cb6a58fb0ded82b4c7755fc4c27c86d"><div class="ttname"><a href="classllvm_1_1Loop.html#a6cb6a58fb0ded82b4c7755fc4c27c86d">llvm::Loop::isLoopInvariant</a></div><div class="ttdeci">bool isLoopInvariant(const Value *V) const</div><div class="ttdoc">Return true if the specified value is loop invariant.</div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8cpp_source.html#l00060">LoopInfo.cpp:60</a></div></div>
<div class="ttc" id="aclassllvm_1_1ScalarEvolutionAnalysis_html"><div class="ttname"><a href="classllvm_1_1ScalarEvolutionAnalysis.html">llvm::ScalarEvolutionAnalysis</a></div><div class="ttdoc">Analysis pass that exposes the ScalarEvolution for a function.</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8h_source.html#l02219">ScalarEvolution.h:2219</a></div></div>
<div class="ttc" id="aIRTranslator_8cpp_html_abe44dfdea65b4f7e11e0a608ab708b76"><div class="ttname"><a href="IRTranslator_8cpp.html#abe44dfdea65b4f7e11e0a608ab708b76">MI</a></div><div class="ttdeci">IRTranslator LLVM IR MI</div><div class="ttdef"><b>Definition:</b> <a href="IRTranslator_8cpp_source.html#l00109">IRTranslator.cpp:109</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a49a2d8f483ea08a3d6ea75f90c640d76"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a49a2d8f483ea08a3d6ea75f90c640d76">llvm::CmpInst::getSwappedPredicate</a></div><div class="ttdeci">Predicate getSwappedPredicate() const</div><div class="ttdoc">For example, EQ-&gt;EQ, SLE-&gt;SGE, ULT-&gt;UGT, OEQ-&gt;OEQ, ULE-&gt;UGE, OLT-&gt;OGT, etc.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00859">InstrTypes.h:859</a></div></div>
<div class="ttc" id="aCompiler_8h_html_aa863693eef567397d9c292da5bf22d34"><div class="ttname"><a href="Compiler_8h.html#aa863693eef567397d9c292da5bf22d34">LLVM_DUMP_METHOD</a></div><div class="ttdeci">#define LLVM_DUMP_METHOD</div><div class="ttdoc">Mark debug helper function definitions like dump() that should not be stripped from debug builds.</div><div class="ttdef"><b>Definition:</b> <a href="Compiler_8h_source.html#l00492">Compiler.h:492</a></div></div>
<div class="ttc" id="aMathExtras_8h_html"><div class="ttname"><a href="MathExtras_8h.html">MathExtras.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1MemoryLocation_html_a18e5a3f1d71ba10a624f2a8e5121cf1f"><div class="ttname"><a href="classllvm_1_1MemoryLocation.html#a18e5a3f1d71ba10a624f2a8e5121cf1f">llvm::MemoryLocation::get</a></div><div class="ttdeci">static MemoryLocation get(const LoadInst *LI)</div><div class="ttdoc">Return a location with information about the memory reference by the given instruction.</div><div class="ttdef"><b>Definition:</b> <a href="MemoryLocation_8cpp_source.html#l00036">MemoryLocation.cpp:36</a></div></div>
<div class="ttc" id="anamespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">This is an optimization pass for GlobalISel generic memory operations.</div><div class="ttdef"><b>Definition:</b> <a href="AddressRanges_8h_source.html#l00018">AddressRanges.h:18</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_a1fb374eb65dcf7cd3d1671efb2616f76"><div class="ttname"><a href="classllvm_1_1CallBase.html#a1fb374eb65dcf7cd3d1671efb2616f76">llvm::CallBase::isNoBuiltin</a></div><div class="ttdeci">bool isNoBuiltin() const</div><div class="ttdoc">Return true if the call should not be treated as a call to a builtin.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01858">InstrTypes.h:1858</a></div></div>
<div class="ttc" id="aclassllvm_1_1ShuffleVectorInst_html_a4bc8953b0fd0277b0e5a8e5b78025150"><div class="ttname"><a href="classllvm_1_1ShuffleVectorInst.html#a4bc8953b0fd0277b0e5a8e5b78025150">llvm::ShuffleVectorInst::isIdentityMask</a></div><div class="ttdeci">static bool isIdentityMask(ArrayRef&lt; int &gt; Mask)</div><div class="ttdoc">Return true if this shuffle mask chooses elements from exactly one source vector without lane crossin...</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l02320">Instructions.cpp:2320</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a9fb7740f0fb6e5a825320f3c63df3263"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a9fb7740f0fb6e5a825320f3c63df3263">dumpOrder</a></div><div class="ttdeci">static LLVM_DUMP_METHOD void dumpOrder(const BoUpSLP::OrdersType &amp;Order)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l04812">SLPVectorizer.cpp:4812</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_a19263fff7f5b3a9d22b48151fa0d85d0"><div class="ttname"><a href="classllvm_1_1CallBase.html#a19263fff7f5b3a9d22b48151fa0d85d0">llvm::CallBase::getOperandBundlesAsDefs</a></div><div class="ttdeci">void getOperandBundlesAsDefs(SmallVectorImpl&lt; OperandBundleDef &gt; &amp;Defs) const</div><div class="ttdoc">Return the list of operand bundles attached to this instruction as a vector of OperandBundleDefs.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l00425">Instructions.cpp:425</a></div></div>
<div class="ttc" id="anamespacellvm_html_a034d66b8c0aeb72ea13fd26392083446"><div class="ttname"><a href="namespacellvm.html#a034d66b8c0aeb72ea13fd26392083446">llvm::getPointersDiff</a></div><div class="ttdeci">std::optional&lt; int &gt; getPointersDiff(Type *ElemTyA, Value *PtrA, Type *ElemTyB, Value *PtrB, const DataLayout &amp;DL, ScalarEvolution &amp;SE, bool StrictCheck=false, bool CheckType=true)</div><div class="ttdoc">Returns the distance between the pointers PtrA and PtrB iff they are compatible and it is possible to...</div><div class="ttdef"><b>Definition:</b> <a href="LoopAccessAnalysis_8cpp_source.html#l01480">LoopAccessAnalysis.cpp:1480</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_aff62592a7901b27bdb120c2e64cd86d0"><div class="ttname"><a href="SLPVectorizer_8cpp.html#aff62592a7901b27bdb120c2e64cd86d0">addMask</a></div><div class="ttdeci">static void addMask(SmallVectorImpl&lt; int &gt; &amp;Mask, ArrayRef&lt; int &gt; SubMask)</div><div class="ttdoc">Shuffles Mask in accordance with the given SubMask.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00832">SLPVectorizer.cpp:832</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_ac77dbedcfd916a5c9b58e753b2678a98"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#ac77dbedcfd916a5c9b58e753b2678a98">llvm::TargetTransformInfo::getInstructionCost</a></div><div class="ttdeci">InstructionCost getInstructionCost(const User *U, ArrayRef&lt; const Value * &gt; Operands, TargetCostKind CostKind) const</div><div class="ttdoc">Estimate the cost of a given IR user when lowered.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00230">TargetTransformInfo.cpp:230</a></div></div>
<div class="ttc" id="aLazyValueInfo_8cpp_html_a739511554e31b02d233401957fd86f44"><div class="ttname"><a href="LazyValueInfo_8cpp.html#a739511554e31b02d233401957fd86f44">Pass</a></div><div class="ttdeci">print lazy value Lazy Value Info Printer Pass</div><div class="ttdef"><b>Definition:</b> <a href="LazyValueInfo_8cpp_source.html#l02067">LazyValueInfo.cpp:2067</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_html_a3a11daf8d89c135162dd6623f5bd164f"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a3a11daf8d89c135162dd6623f5bd164f">llvm::slpvectorizer::BoUpSLP::getTreeSize</a></div><div class="ttdeci">unsigned getTreeSize() const</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l01069">SLPVectorizer.cpp:1069</a></div></div>
<div class="ttc" id="aREADME-SSE_8txt_html_abb4ce3bc3096a12d4b93460bf78bcf95"><div class="ttname"><a href="README-SSE_8txt.html#abb4ce3bc3096a12d4b93460bf78bcf95">it</a></div><div class="ttdeci">into xmm2 addss xmm2 xmm1 xmm3 addss xmm3 movaps xmm0 unpcklps xmm0 ret seems silly when it could just be one addps Expand libm rounding functions main should enable SSE DAZ mode and other fast SSE modes Think about doing i64 math in SSE regs on x86 This testcase should have no SSE instructions in it</div><div class="ttdef"><b>Definition:</b> <a href="README-SSE_8txt_source.html#l00081">README-SSE.txt:81</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_a0951bc018bd4725e28d9d05e36a1360a"><div class="ttname"><a href="classllvm_1_1CallBase.html#a0951bc018bd4725e28d9d05e36a1360a">llvm::CallBase::getBundleOperandsEndIndex</a></div><div class="ttdeci">unsigned getBundleOperandsEndIndex() const</div><div class="ttdoc">Return the index of the last bundle operand in the Use array.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01963">InstrTypes.h:1963</a></div></div>
<div class="ttc" id="anamespacellvm_html_a02981de53fb6ffd384d39addc4d25f37"><div class="ttname"><a href="namespacellvm.html#a02981de53fb6ffd384d39addc4d25f37">llvm::drop_begin</a></div><div class="ttdeci">auto drop_begin(T &amp;&amp;RangeOrContainer, size_t N=1)</div><div class="ttdoc">Return a range covering RangeOrContainer with the first N elements excluded.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00386">STLExtras.h:386</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a8fa8b3631e74e836453f972aac6b4b65"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a8fa8b3631e74e836453f972aac6b4b65">llvm::TargetTransformInfo::getMinVectorRegisterBitWidth</a></div><div class="ttdeci">unsigned getMinVectorRegisterBitWidth() const</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00662">TargetTransformInfo.cpp:662</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImpl_html_a11045c7973ab24a8d6315b61fa337d4e"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html#a11045c7973ab24a8d6315b61fa337d4e">llvm::SmallPtrSetImpl::erase</a></div><div class="ttdeci">bool erase(PtrType Ptr)</div><div class="ttdoc">erase - If the set contains the specified pointer, remove it and return true, otherwise return false.</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00379">SmallPtrSet.h:379</a></div></div>
<div class="ttc" id="aclassllvm_1_1WeakTrackingVH_html"><div class="ttname"><a href="classllvm_1_1WeakTrackingVH.html">llvm::WeakTrackingVH</a></div><div class="ttdoc">Value handle that is nullable, but tries to track the Value.</div><div class="ttdef"><b>Definition:</b> <a href="ValueHandle_8h_source.html#l00204">ValueHandle.h:204</a></div></div>
<div class="ttc" id="anamespacellvm_html_aac36edd0f1ce976f0025c98e88d3830ea3a2d5fe857d8f9541136a124c2edec6c"><div class="ttname"><a href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea3a2d5fe857d8f9541136a124c2edec6c">llvm::RecurKind::Or</a></div><div class="ttdeci">@ Or</div><div class="ttdoc">Bitwise or logical OR of integers.</div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_a1f0ff79b64a40d383b891f1baba89c6b"><div class="ttname"><a href="classllvm_1_1PHINode.html#a1f0ff79b64a40d383b891f1baba89c6b">llvm::PHINode::incoming_values</a></div><div class="ttdeci">op_range incoming_values()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02784">Instructions.h:2784</a></div></div>
<div class="ttc" id="aclassllvm_1_1DataLayout_html"><div class="ttname"><a href="classllvm_1_1DataLayout.html">llvm::DataLayout</a></div><div class="ttdoc">A parsed version of the target data layout string in and methods for querying it.</div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00110">DataLayout.h:110</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_af9f57a32b08304fea642871735717f24"><div class="ttname"><a href="classllvm_1_1Instruction.html#af9f57a32b08304fea642871735717f24">llvm::Instruction::UnaryOps</a></div><div class="ttdeci">UnaryOps</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00802">Instruction.h:802</a></div></div>
<div class="ttc" id="anamespacellvm_html_aea9b36512640e798bb1a7ac08dc2124d"><div class="ttname"><a href="namespacellvm.html#aea9b36512640e798bb1a7ac08dc2124d">llvm::mayHaveNonDefUseDependency</a></div><div class="ttdeci">bool mayHaveNonDefUseDependency(const Instruction &amp;I)</div><div class="ttdoc">Returns true if the result or effects of the given instructions I depend values not reachable through...</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l04908">ValueTracking.cpp:4908</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AArch64PACKey_html_abf4394f452bde3f544999858d71e4b46"><div class="ttname"><a href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46">llvm::AArch64PACKey::ID</a></div><div class="ttdeci">ID</div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00790">AArch64BaseInfo.h:790</a></div></div>
<div class="ttc" id="anamespacellvm_1_1dxil_html_af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b"><div class="ttname"><a href="namespacellvm_1_1dxil.html#af048a5a215837b0272b22d5e7a0bc04aaa18c217c4f2a811afcaaf5052945e31b">llvm::dxil::ParameterKind::I1</a></div><div class="ttdeci">@ I1</div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a3a402430a1bbe70a9282dcb0e0b6a2cd"><div class="ttname"><a href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">llvm::Value::hasOneUse</a></div><div class="ttdeci">bool hasOneUse() const</div><div class="ttdoc">Return true if there is exactly one use of this value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00434">Value.h:434</a></div></div>
<div class="ttc" id="anamespacellvm_html_aac36edd0f1ce976f0025c98e88d3830eab48b2a9934af7a531cfd7236ded9d50e"><div class="ttname"><a href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eab48b2a9934af7a531cfd7236ded9d50e">llvm::RecurKind::FMul</a></div><div class="ttdeci">@ FMul</div><div class="ttdoc">Product of floats.</div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a2be3583dac92a031fa1458d4d992c78b"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">llvm::CmpInst::Predicate</a></div><div class="ttdeci">Predicate</div><div class="ttdoc">This enumeration lists the possible predicates for CmpInst subclasses.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00718">InstrTypes.h:718</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html_a0b931781aa589c6ebe64a76c1447e5b2"><div class="ttname"><a href="classllvm_1_1User.html#a0b931781aa589c6ebe64a76c1447e5b2">llvm::User::operands</a></div><div class="ttdeci">op_range operands()</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00242">User.h:242</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a98c0a84a5dfa8bce341c829709f171e5"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">llvm::BasicBlock::iterator</a></div><div class="ttdeci">InstListType::iterator iterator</div><div class="ttdoc">Instruction iterators...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00087">BasicBlock.h:87</a></div></div>
<div class="ttc" id="aAMDGPURewriteUndefForPHI_8cpp_html_a2e83cb1bc3f5e8986cbd14575755a134"><div class="ttname"><a href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a></div><div class="ttdeci">Rewrite undef for PHI</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPURewriteUndefForPHI_8cpp_source.html#l00101">AMDGPURewriteUndefForPHI.cpp:101</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a38bee869ad41aebfef3de2641b12004c"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a38bee869ad41aebfef3de2641b12004c">llvm::BasicBlock::getParent</a></div><div class="ttdeci">const Function * getParent() const</div><div class="ttdoc">Return the enclosing method, or null if none.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00112">BasicBlock.h:112</a></div></div>
<div class="ttc" id="aIntrinsicInst_8h_html"><div class="ttname"><a href="IntrinsicInst_8h.html">IntrinsicInst.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a3b996fbf8458aafffc86cb98a68d0a47"><div class="ttname"><a href="classllvm_1_1Type.html#a3b996fbf8458aafffc86cb98a68d0a47">llvm::Type::isPointerTy</a></div><div class="ttdeci">bool isPointerTy() const</div><div class="ttdoc">True if this is an instance of PointerType.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00249">Type.h:249</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_html_ab93aab6d000a610c36f69bb84137b2b8"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#ab93aab6d000a610c36f69bb84137b2b8">llvm::slpvectorizer::BoUpSLP::eraseInstruction</a></div><div class="ttdeci">void eraseInstruction(Instruction *I)</div><div class="ttdoc">Removes an instruction from its block and eventually deletes it.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l02212">SLPVectorizer.cpp:2212</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisManager_html_ab9d3d5412c20747fd0110a046604f09a"><div class="ttname"><a href="classllvm_1_1AnalysisManager.html#ab9d3d5412c20747fd0110a046604f09a">llvm::AnalysisManager::getResult</a></div><div class="ttdeci">PassT::Result &amp; getResult(IRUnitT &amp;IR, ExtraArgTs... ExtraArgs)</div><div class="ttdoc">Get the result of an analysis pass for a given IR unit.</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00774">PassManager.h:774</a></div></div>
<div class="ttc" id="aclassllvm_1_1MemoryLocation_html_a9550ce4a179e46db37f653ce28feca7a"><div class="ttname"><a href="classllvm_1_1MemoryLocation.html#a9550ce4a179e46db37f653ce28feca7a">llvm::MemoryLocation::Ptr</a></div><div class="ttdeci">const Value * Ptr</div><div class="ttdoc">The address of the start of the location.</div><div class="ttdef"><b>Definition:</b> <a href="MemoryLocation_8h_source.html#l00219">MemoryLocation.h:219</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_afa38851d75434d1476444ac93f94cb4ca7aa61d9e9d33bdf28478754c69c59640"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#afa38851d75434d1476444ac93f94cb4ca7aa61d9e9d33bdf28478754c69c59640">llvm::TargetTransformInfo::OK_UniformValue</a></div><div class="ttdeci">@ OK_UniformValue</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00932">TargetTransformInfo.h:932</a></div></div>
<div class="ttc" id="aSetOperations_8h_html"><div class="ttname"><a href="SetOperations_8h.html">SetOperations.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_af89277d8bd76d6348291e29b6076796a"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#af89277d8bd76d6348291e29b6076796a">llvm::TargetTransformInfo::getCmpSelInstrCost</a></div><div class="ttdeci">InstructionCost getCmpSelInstrCost(unsigned Opcode, Type *ValTy, Type *CondTy, CmpInst::Predicate VecPred, TTI::TargetCostKind CostKind=TTI::TCK_RecipThroughput, const Instruction *I=nullptr) const</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00897">TargetTransformInfo.cpp:897</a></div></div>
<div class="ttc" id="anamespacellvm_html_a11c66d01880f53332fc7ad53f565b039"><div class="ttname"><a href="namespacellvm.html#a11c66d01880f53332fc7ad53f565b039">llvm::getVectorIntrinsicIDForCall</a></div><div class="ttdeci">Intrinsic::ID getVectorIntrinsicIDForCall(const CallInst *CI, const TargetLibraryInfo *TLI)</div><div class="ttdoc">Returns intrinsic ID for call.</div><div class="ttdef"><b>Definition:</b> <a href="VectorUtils_8cpp_source.html#l00135">VectorUtils.cpp:135</a></div></div>
<div class="ttc" id="anamespacellvm_html_a92ca992e52dddc420f4b069cae06dfbe"><div class="ttname"><a href="namespacellvm.html#a92ca992e52dddc420f4b069cae06dfbe">llvm::isa</a></div><div class="ttdeci">bool isa(const From &amp;Val)</div><div class="ttdoc">isa&lt;X&gt; - Return true if the parameter to the template is an instance of one of the template type argu...</div><div class="ttdef"><b>Definition:</b> <a href="Casting_8h_source.html#l00549">Casting.h:549</a></div></div>
<div class="ttc" id="aclassT_html"><div class="ttname"><a href="classT.html">T</a></div></div>
<div class="ttc" id="aclassllvm_1_1ExtractElementInst_html"><div class="ttname"><a href="classllvm_1_1ExtractElementInst.html">llvm::ExtractElementInst</a></div><div class="ttdoc">This instruction extracts a single (scalar) element from a VectorType value.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01881">Instructions.h:1881</a></div></div>
<div class="ttc" id="aclassllvm_1_1Function_html"><div class="ttname"><a href="classllvm_1_1Function.html">llvm::Function</a></div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00059">Function.h:59</a></div></div>
<div class="ttc" id="aclassllvm_1_1Loop_html"><div class="ttname"><a href="classllvm_1_1Loop.html">llvm::Loop</a></div><div class="ttdoc">Represents a single loop in the control flow graph.</div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l00547">LoopInfo.h:547</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a27997849d8982bf226891024fd68daee"><div class="ttname"><a href="classllvm_1_1Instruction.html#a27997849d8982bf226891024fd68daee">llvm::Instruction::isCast</a></div><div class="ttdeci">bool isCast() const</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00176">Instruction.h:176</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a0b2ca98dc28c61793ff5c90d23e5f14e"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a0b2ca98dc28c61793ff5c90d23e5f14e">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::lookup</a></div><div class="ttdeci">ValueT lookup(const_arg_type_t&lt; KeyT &gt; Val) const</div><div class="ttdoc">lookup - Return the entry for the specified key, or a default constructed value if no such entry exis...</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00197">DenseMap.h:197</a></div></div>
<div class="ttc" id="anamespacellvm_html_ac10d13c57a7adf4a1f140afd5321309bad55b30607c2a9a2616347d6edb789f6b"><div class="ttname"><a href="namespacellvm.html#ac10d13c57a7adf4a1f140afd5321309bad55b30607c2a9a2616347d6edb789f6b">llvm::PseudoProbeReservedId::Last</a></div><div class="ttdeci">@ Last</div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_af7dca9a9e816ef69fd9e9467f64f72b4"><div class="ttname"><a href="classllvm_1_1Value.html#af7dca9a9e816ef69fd9e9467f64f72b4">llvm::Value::dump</a></div><div class="ttdeci">void dump() const</div><div class="ttdoc">Support for debugging, callable in GDB: V-&gt;dump()</div><div class="ttdef"><b>Definition:</b> <a href="AsmWriter_8cpp_source.html#l04942">AsmWriter.cpp:4942</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallBitVector_html_a0f5b9402c10ba28ee972fe80522b3281"><div class="ttname"><a href="classllvm_1_1SmallBitVector.html#a0f5b9402c10ba28ee972fe80522b3281">llvm::SmallBitVector::reset</a></div><div class="ttdeci">SmallBitVector &amp; reset()</div><div class="ttdef"><b>Definition:</b> <a href="SmallBitVector_8h_source.html#l00401">SmallBitVector.h:401</a></div></div>
<div class="ttc" id="aREADME-SSE_8txt_html_a63d206a063eefcdf8c318ded97b65020"><div class="ttname"><a href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a></div><div class="ttdeci">This currently compiles esp xmm0 movsd esp eax eax esp ret We should use not the dag combiner This is because dagcombine2 needs to be able to see through the X86ISD::Wrapper which DAGCombine can t really do The code for turning x load into a single vector load is target independent and should be moved to the dag combiner The code for turning x load into a vector load can only handle a direct load from a global or a direct load from the stack It should be generalized to handle any load from P</div><div class="ttdef"><b>Definition:</b> <a href="README-SSE_8txt_source.html#l00411">README-SSE.txt:411</a></div></div>
<div class="ttc" id="aPass_8h_html"><div class="ttname"><a href="Pass_8h.html">Pass.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoopBase_html_a04337b572d34ea413c35dbac5d75530b"><div class="ttname"><a href="classllvm_1_1LoopBase.html#a04337b572d34ea413c35dbac5d75530b">llvm::LoopBase::contains</a></div><div class="ttdeci">bool contains(const LoopT *L) const</div><div class="ttdoc">Return true if the specified loop is contained within in this loop.</div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l00139">LoopInfo.h:139</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a2d30dd50c6b2d64ca3bc2826ca229fdb"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a2d30dd50c6b2d64ca3bc2826ca229fdb">llvm::TargetTransformInfo::getRegisterBitWidth</a></div><div class="ttdeci">TypeSize getRegisterBitWidth(RegisterKind K) const</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00657">TargetTransformInfo.cpp:657</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a52b518b4e744d8c2d89e04e30e7be715"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a52b518b4e744d8c2d89e04e30e7be715">reorderOrder</a></div><div class="ttdeci">static void reorderOrder(SmallVectorImpl&lt; unsigned &gt; &amp;Order, ArrayRef&lt; int &gt; Mask)</div><div class="ttdoc">Reorders the given Order according to the given Mask.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03590">SLPVectorizer.cpp:3590</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_ada3b8b509fcb2a84e3b9e3bd678ba27f"><div class="ttname"><a href="SLPVectorizer_8cpp.html#ada3b8b509fcb2a84e3b9e3bd678ba27f">collectValuesToDemote</a></div><div class="ttdeci">static bool collectValuesToDemote(Value *V, SmallPtrSetImpl&lt; Value * &gt; &amp;Expr, SmallVectorImpl&lt; Value * &gt; &amp;ToDemote, SmallVectorImpl&lt; Value * &gt; &amp;Roots)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l11041">SLPVectorizer.cpp:11041</a></div></div>
<div class="ttc" id="anamespacellvm_html_a14c12bda1f5a9beed612b00f3f98b888"><div class="ttname"><a href="namespacellvm.html#a14c12bda1f5a9beed612b00f3f98b888">llvm::reorderScalars</a></div><div class="ttdeci">static void reorderScalars(SmallVectorImpl&lt; Value * &gt; &amp;Scalars, ArrayRef&lt; int &gt; Mask)</div><div class="ttdoc">Reorders the list of scalars in accordance with the given Mask.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00896">SLPVectorizer.cpp:896</a></div></div>
<div class="ttc" id="aclassllvm_1_1raw__string__ostream_html"><div class="ttname"><a href="classllvm_1_1raw__string__ostream.html">llvm::raw_string_ostream</a></div><div class="ttdoc">A raw_ostream that writes to an std::string.</div><div class="ttdef"><b>Definition:</b> <a href="raw__ostream_8h_source.html#l00642">raw_ostream.h:642</a></div></div>
<div class="ttc" id="aclassllvm_1_1PointerType_html_a050a395d1656e546679d8b144d951bb2"><div class="ttname"><a href="classllvm_1_1PointerType.html#a050a395d1656e546679d8b144d951bb2">llvm::PointerType::get</a></div><div class="ttdeci">static PointerType * get(Type *ElementType, unsigned AddressSpace)</div><div class="ttdoc">This constructs a pointer to an object of the specified type in a numbered address space.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00729">Type.cpp:729</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html_a18b9d328d2490f447589ba60345eba6e"><div class="ttname"><a href="classllvm_1_1SetVector.html#a18b9d328d2490f447589ba60345eba6e">llvm::SetVector::size</a></div><div class="ttdeci">size_type size() const</div><div class="ttdoc">Determine the number of elements in the SetVector.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00077">SetVector.h:77</a></div></div>
<div class="ttc" id="alib_2Target_2README_8txt_html_a2a2df5a25b9c703e74e82b48a75d0c3d"><div class="ttname"><a href="lib_2Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a></div><div class="ttdeci">instcombine should handle this C2 when C1</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2README_8txt_source.html#l00263">README.txt:263</a></div></div>
<div class="ttc" id="anamespacellvm_html_a9451ae71f535d06cd1d8ae642d76fc0d"><div class="ttname"><a href="namespacellvm.html#a9451ae71f535d06cd1d8ae642d76fc0d">llvm::propagateIRFlags</a></div><div class="ttdeci">void propagateIRFlags(Value *I, ArrayRef&lt; Value * &gt; VL, Value *OpValue=nullptr, bool IncludeWrapFlags=true)</div><div class="ttdoc">Get the intersection (logical and) of all of the potential IR flags of each scalar operation (VL) tha...</div><div class="ttdef"><b>Definition:</b> <a href="LoopUtils_8cpp_source.html#l01092">LoopUtils.cpp:1092</a></div></div>
<div class="ttc" id="aARMLowOverheadLoops_8cpp_html_aee9acb24ef4f057644a7cf7217922eaa"><div class="ttname"><a href="ARMLowOverheadLoops_8cpp.html#aee9acb24ef4f057644a7cf7217922eaa">Ignore</a></div><div class="ttdeci">ReachingDefAnalysis InstSet InstSet &amp; Ignore</div><div class="ttdef"><b>Definition:</b> <a href="ARMLowOverheadLoops_8cpp_source.html#l00547">ARMLowOverheadLoops.cpp:547</a></div></div>
<div class="ttc" id="aclassllvm_1_1ilist__node__with__parent_html_a26708685cc8b94fe3d7092ee080dbb34"><div class="ttname"><a href="classllvm_1_1ilist__node__with__parent.html#a26708685cc8b94fe3d7092ee080dbb34">llvm::ilist_node_with_parent::getNextNode</a></div><div class="ttdeci">NodeTy * getNextNode()</div><div class="ttdoc">Get the next node, or nullptr for the list tail.</div><div class="ttdef"><b>Definition:</b> <a href="ilist__node_8h_source.html#l00289">ilist_node.h:289</a></div></div>
<div class="ttc" id="aclassllvm_1_1MapVector_html_ae091b147039557cf8ce505740e7ff7ac"><div class="ttname"><a href="classllvm_1_1MapVector.html#ae091b147039557cf8ce505740e7ff7ac">llvm::MapVector::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00089">MapVector.h:89</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector</a></div><div class="ttdoc">This is a 'vector' (really, a variable-sized array), optimized for the case when the array is small.</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l01199">SmallVector.h:1199</a></div></div>
<div class="ttc" id="astructllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1ChildIteratorType_html_aa709fbae8ecf0c4d40fdbbcd1a37114f"><div class="ttname"><a href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1ChildIteratorType.html#aa709fbae8ecf0c4d40fdbbcd1a37114f">llvm::GraphTraits&lt; BoUpSLP * &gt;::ChildIteratorType::ChildIteratorType</a></div><div class="ttdeci">ChildIteratorType(SmallVector&lt; BoUpSLP::EdgeInfo, 1 &gt;::iterator W, ContainerTy &amp;VT)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03466">SLPVectorizer.cpp:3466</a></div></div>
<div class="ttc" id="aStatistic_8h_html"><div class="ttname"><a href="Statistic_8h.html">Statistic.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1RISCVFenceField_html_a147be9e9780c1e33363ea572d4c7b25fa05c79fbfc58d9dd2851c467a1ef166bf"><div class="ttname"><a href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa05c79fbfc58d9dd2851c467a1ef166bf">llvm::RISCVFenceField::W</a></div><div class="ttdeci">@ W</div><div class="ttdef"><b>Definition:</b> <a href="RISCVBaseInfo_8h_source.html#l00279">RISCVBaseInfo.h:279</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a6355b64ef621c21a21f5d3b41808dfa1"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a6355b64ef621c21a21f5d3b41808dfa1">MaxVFOption</a></div><div class="ttdeci">static cl::opt&lt; unsigned &gt; MaxVFOption(&quot;slp-max-vf&quot;, cl::init(0), cl::Hidden, cl::desc(&quot;Maximum SLP vectorization factor (0=unlimited)&quot;))</div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a944c25ac9b73b02a17a20a08a25b9b21"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a944c25ac9b73b02a17a20a08a25b9b21">llvm::PatternMatch::m_Add</a></div><div class="ttdeci">BinaryOp_match&lt; LHS, RHS, Instruction::Add &gt; m_Add(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00979">PatternMatch.h:979</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7b2175e18ff52174fad26b6b68818564"><div class="ttname"><a href="namespacellvm.html#a7b2175e18ff52174fad26b6b68818564">llvm::enumerate</a></div><div class="ttdeci">detail::enumerator&lt; R &gt; enumerate(R &amp;&amp;TheRange)</div><div class="ttdoc">Given an input range, returns a new range whose values are are pair (A,B) such that A is the 0-based ...</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l02264">STLExtras.h:2264</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a78cd22f497c1e81c4d8a5e9073ef5a24"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a78cd22f497c1e81c4d8a5e9073ef5a24">llvm::PatternMatch::m_Load</a></div><div class="ttdeci">OneOps_match&lt; OpTy, Instruction::Load &gt; m_Load(const OpTy &amp;Op)</div><div class="ttdoc">Matches LoadInst.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01563">PatternMatch.h:1563</a></div></div>
<div class="ttc" id="aSupport_2ErrorHandling_8h_html"><div class="ttname"><a href="Support_2ErrorHandling_8h.html">ErrorHandling.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a4b5e1f50cb0890ec60d8c61a61241170"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a4b5e1f50cb0890ec60d8c61a61241170">llvm::CmpInst::makeCmpResultType</a></div><div class="ttdeci">static Type * makeCmpResultType(Type *opnd_type)</div><div class="ttdoc">Create a result type for fcmp/icmp.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01054">InstrTypes.h:1054</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_af4feec45578e32fe65d8efc59112bc8e"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#af4feec45578e32fe65d8efc59112bc8e">llvm::PatternMatch::m_CombineOr</a></div><div class="ttdeci">match_combine_or&lt; LTy, RTy &gt; m_CombineOr(const LTy &amp;L, const RTy &amp;R)</div><div class="ttdoc">Combine two pattern matchers matching L || R.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00218">PatternMatch.h:218</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html">llvm::TargetTransformInfo</a></div><div class="ttdoc">This pass provides access to the codegen interfaces that are needed for IR-level transformations.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00196">TargetTransformInfo.h:196</a></div></div>
<div class="ttc" id="aLoopAccessAnalysis_8h_html"><div class="ttname"><a href="LoopAccessAnalysis_8h.html">LoopAccessAnalysis.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a5ab2d0b0f0b8ceec3b907184e7567197"><div class="ttname"><a href="classllvm_1_1Type.html#a5ab2d0b0f0b8ceec3b907184e7567197">llvm::Type::getPointerAddressSpace</a></div><div class="ttdeci">unsigned getPointerAddressSpace() const</div><div class="ttdoc">Get the address space of this pointer or pointer vector type.</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00729">DerivedTypes.h:729</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallDenseSet_html"><div class="ttname"><a href="classllvm_1_1SmallDenseSet.html">llvm::SmallDenseSet</a></div><div class="ttdoc">Implements a dense probed hash-table based set with some number of buckets stored inline.</div><div class="ttdef"><b>Definition:</b> <a href="DenseSet_8h_source.html#l00286">DenseSet.h:286</a></div></div>
<div class="ttc" id="aclassllvm_1_1IRBuilder_html"><div class="ttname"><a href="classllvm_1_1IRBuilder.html">llvm::IRBuilder&lt;&gt;</a></div></div>
<div class="ttc" id="astructllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo_html"><div class="ttname"><a href="structllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo.html">llvm::slpvectorizer::BoUpSLP::EdgeInfo</a></div><div class="ttdoc">This structure holds any data we need about the edges being traversed during buildTree_rec().</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l01174">SLPVectorizer.cpp:1174</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a68f8b6509e5780355450f139ddfe89ec"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a68f8b6509e5780355450f139ddfe89ec">buildShuffleEntryMask</a></div><div class="ttdeci">static void buildShuffleEntryMask(ArrayRef&lt; Value * &gt; VL, ArrayRef&lt; unsigned &gt; ReorderIndices, ArrayRef&lt; int &gt; ReusesIndices, const function_ref&lt; bool(Instruction *)&gt; IsAltOp, SmallVectorImpl&lt; int &gt; &amp;Mask, SmallVectorImpl&lt; Value * &gt; *OpScalars=nullptr, SmallVectorImpl&lt; Value * &gt; *AltScalars=nullptr)</div><div class="ttdoc">Build shuffle mask for shuffle graph entries and lists of main and alternate operations operands.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l06179">SLPVectorizer.cpp:6179</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_abf8c65a150fe96c228db5b19d6b09e3a"><div class="ttname"><a href="SLPVectorizer_8cpp.html#abf8c65a150fe96c228db5b19d6b09e3a">arePointersCompatible</a></div><div class="ttdeci">static bool arePointersCompatible(Value *Ptr1, Value *Ptr2, const TargetLibraryInfo &amp;TLI, bool CompareOpcodes=true)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03682">SLPVectorizer.cpp:3682</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a3d78104bfada8d17dad04e588b7d9a17"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a3d78104bfada8d17dad04e588b7d9a17">MinScheduleRegionSize</a></div><div class="ttdeci">static const int MinScheduleRegionSize</div><div class="ttdoc">If the ScheduleRegionSizeBudget is exhausted, we allow small scheduling regions to be handled.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00191">SLPVectorizer.cpp:191</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallDenseMap_html"><div class="ttname"><a href="classllvm_1_1SmallDenseMap.html">llvm::SmallDenseMap</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00880">DenseMap.h:880</a></div></div>
<div class="ttc" id="aclassllvm_1_1ScalarEvolution_html"><div class="ttname"><a href="classllvm_1_1ScalarEvolution.html">llvm::ScalarEvolution</a></div><div class="ttdoc">The main scalar evolution driver.</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8h_source.html#l00452">ScalarEvolution.h:452</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a4218f47749d093473e680ad0199fb239"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a4218f47749d093473e680ad0199fb239">llvm::TargetTransformInfo::getIntrinsicInstrCost</a></div><div class="ttdeci">InstructionCost getIntrinsicInstrCost(const IntrinsicCostAttributes &amp;ICA, TTI::TargetCostKind CostKind) const</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00983">TargetTransformInfo.cpp:983</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_aa2a54b545d237ecfe450fd1292f7675e"><div class="ttname"><a href="classllvm_1_1CmpInst.html#aa2a54b545d237ecfe450fd1292f7675e">llvm::CmpInst::getInversePredicate</a></div><div class="ttdeci">Predicate getInversePredicate() const</div><div class="ttdoc">For example, EQ -&gt; NE, UGT -&gt; ULE, SLT -&gt; SGE, OEQ -&gt; UNE, UGT -&gt; OLE, OLT -&gt; UGE,...</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00832">InstrTypes.h:832</a></div></div>
<div class="ttc" id="aLICM_8cpp_html_ab0cfc793d55940eac67854827dd365e9"><div class="ttname"><a href="LICM_8cpp.html#ab0cfc793d55940eac67854827dd365e9">eraseInstruction</a></div><div class="ttdeci">static void eraseInstruction(Instruction &amp;I, ICFLoopSafetyInfo &amp;SafetyInfo, MemorySSAUpdater &amp;MSSAU)</div><div class="ttdef"><b>Definition:</b> <a href="LICM_8cpp_source.html#l01475">LICM.cpp:1475</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_ada54fa869a50e6744d9e149b542efdb1"><div class="ttname"><a href="SLPVectorizer_8cpp.html#ada54fa869a50e6744d9e149b542efdb1">RunSLPVectorization</a></div><div class="ttdeci">cl::opt&lt; bool &gt; RunSLPVectorization(&quot;vectorize-slp&quot;, cl::init(true), cl::Hidden, cl::desc(&quot;Run the SLP vectorization passes&quot;))</div></div>
<div class="ttc" id="aValueTracking_8h_html"><div class="ttname"><a href="ValueTracking_8h.html">ValueTracking.h</a></div></div>
<div class="ttc" id="aTransforms_2Utils_2Local_8h_html"><div class="ttname"><a href="Transforms_2Utils_2Local_8h.html">Local.h</a></div></div>
<div class="ttc" id="aOptimizationRemarkEmitter_8h_html"><div class="ttname"><a href="OptimizationRemarkEmitter_8h.html">OptimizationRemarkEmitter.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_ac7b0ed5c6d30bad74769c6e87ab0edb8"><div class="ttname"><a href="classllvm_1_1Type.html#ac7b0ed5c6d30bad74769c6e87ab0edb8">llvm::Type::getTypeID</a></div><div class="ttdeci">TypeID getTypeID() const</div><div class="ttdoc">Return the type id for the type.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00137">Type.h:137</a></div></div>
<div class="ttc" id="aclassllvm_1_1DominatorTree_html"><div class="ttname"><a href="classllvm_1_1DominatorTree.html">llvm::DominatorTree</a></div><div class="ttdoc">Concrete subclass of DominatorTreeBase that is used to compute a normal dominator tree.</div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00166">Dominators.h:166</a></div></div>
<div class="ttc" id="anamespacellvm_html_ad5f1403d57d5cc4301785b181caa5f1b"><div class="ttname"><a href="namespacellvm.html#ad5f1403d57d5cc4301785b181caa5f1b">llvm::isVectorIntrinsicWithScalarOpAtArg</a></div><div class="ttdeci">bool isVectorIntrinsicWithScalarOpAtArg(Intrinsic::ID ID, unsigned ScalarOpdIdx)</div><div class="ttdoc">Identifies if the vector form of the intrinsic has a scalar operand.</div><div class="ttdef"><b>Definition:</b> <a href="VectorUtils_8cpp_source.html#l00101">VectorUtils.cpp:101</a></div></div>
<div class="ttc" id="aREADME__P9_8txt_html_acc80d72f12f6f9e1d8eda2ec3d74133c"><div class="ttname"><a href="README__P9_8txt.html#acc80d72f12f6f9e1d8eda2ec3d74133c">Right</a></div><div class="ttdeci">Vector Shift Left Right</div><div class="ttdef"><b>Definition:</b> <a href="README__P9_8txt_source.html#l00118">README_P9.txt:118</a></div></div>
<div class="ttc" id="aGlobalsModRef_8h_html"><div class="ttname"><a href="GlobalsModRef_8h.html">GlobalsModRef.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_ae7fe2d1bb4f708d68fe7a908ba675d1b"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#ae7fe2d1bb4f708d68fe7a908ba675d1b">llvm::TargetTransformInfo::getScalarizationOverhead</a></div><div class="ttdeci">InstructionCost getScalarizationOverhead(VectorType *Ty, const APInt &amp;DemandedElts, bool Insert, bool Extract, TTI::TargetCostKind CostKind) const</div><div class="ttdoc">Estimate the overhead of scalarizing an instruction.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00523">TargetTransformInfo.cpp:523</a></div></div>
<div class="ttc" id="anamespacellvm_html_a26389c546573f058ad8ecbdc5c1933cf"><div class="ttname"><a href="namespacellvm.html#a26389c546573f058ad8ecbdc5c1933cf">llvm::verifyFunction</a></div><div class="ttdeci">bool verifyFunction(const Function &amp;F, raw_ostream *OS=nullptr)</div><div class="ttdoc">Check a function for errors, useful for use when debugging a pass.</div><div class="ttdef"><b>Definition:</b> <a href="Verifier_8cpp_source.html#l06428">Verifier.cpp:6428</a></div></div>
<div class="ttc" id="anamespacellvm_1_1cl_html_a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6"><div class="ttname"><a href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">llvm::cl::Hidden</a></div><div class="ttdeci">@ Hidden</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00138">CommandLine.h:138</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_aaf5f659329577feb1b283d6b194599bd"><div class="ttname"><a href="SLPVectorizer_8cpp.html#aaf5f659329577feb1b283d6b194599bd">compareCmp</a></div><div class="ttdeci">static bool compareCmp(Value *V, Value *V2, TargetLibraryInfo &amp;TLI, function_ref&lt; bool(Instruction *)&gt; IsDeleted)</div><div class="ttdoc">Compare two cmp instructions.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l13380">SLPVectorizer.cpp:13380</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_html_a439ba19759640c34ec2262c0a837e82c"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a439ba19759640c34ec2262c0a837e82c">llvm::slpvectorizer::BoUpSLP::findBestRootPair</a></div><div class="ttdeci">std::optional&lt; int &gt; findBestRootPair(ArrayRef&lt; std::pair&lt; Value *, Value * &gt;&gt; Candidates, int Limit=LookAheadHeuristics::ScoreFail)</div><div class="ttdoc">Evaluate each pair in Candidates and return index into Candidates for a pair which have highest score...</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l02187">SLPVectorizer.cpp:2187</a></div></div>
<div class="ttc" id="anamespacellvm_html_af7b6ae12af3578f7a20ccc11a4458f9f"><div class="ttname"><a href="namespacellvm.html#af7b6ae12af3578f7a20ccc11a4458f9f">llvm::computeMinimumValueSizes</a></div><div class="ttdeci">MapVector&lt; Instruction *, uint64_t &gt; computeMinimumValueSizes(ArrayRef&lt; BasicBlock * &gt; Blocks, DemandedBits &amp;DB, const TargetTransformInfo *TTI=nullptr)</div><div class="ttdoc">Compute a map of integer instructions to their minimum legal type size.</div><div class="ttdef"><b>Definition:</b> <a href="VectorUtils_8cpp_source.html#l00666">VectorUtils.cpp:666</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_af37b2842424eb63440bdcacca0af9820"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#af37b2842424eb63440bdcacca0af9820">llvm::TargetTransformInfo::getVectorInstrCost</a></div><div class="ttdeci">InstructionCost getVectorInstrCost(unsigned Opcode, Type *Val, TTI::TargetCostKind CostKind, unsigned Index=-1, Value *Op0=nullptr, Value *Op1=nullptr) const</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00908">TargetTransformInfo.cpp:908</a></div></div>
<div class="ttc" id="anamespacellvm_html_a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639"><div class="ttname"><a href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">llvm::Depth</a></div><div class="ttdeci">@ Depth</div><div class="ttdef"><b>Definition:</b> <a href="SIMachineScheduler_8h_source.html#l00036">SIMachineScheduler.h:36</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a2be3583dac92a031fa1458d4d992c78ba720a42e85f7e981afd61e28473b0000a"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba720a42e85f7e981afd61e28473b0000a">llvm::CmpInst::ICMP_SGT</a></div><div class="ttdeci">@ ICMP_SGT</div><div class="ttdoc">signed greater than</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00745">InstrTypes.h:745</a></div></div>
<div class="ttc" id="aclassllvm_1_1DemandedBitsAnalysis_html"><div class="ttname"><a href="classllvm_1_1DemandedBitsAnalysis.html">llvm::DemandedBitsAnalysis</a></div><div class="ttdoc">An analysis that produces DemandedBits for a function.</div><div class="ttdef"><b>Definition:</b> <a href="DemandedBits_8h_source.html#l00123">DemandedBits.h:123</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallBitVector_html_a12297e7775aa1fc62fbea882aef623fc"><div class="ttname"><a href="classllvm_1_1SmallBitVector.html#a12297e7775aa1fc62fbea882aef623fc">llvm::SmallBitVector::find_first</a></div><div class="ttdeci">int find_first() const</div><div class="ttdoc">Returns the index of the first set bit, -1 if none of the bits are set.</div><div class="ttdef"><b>Definition:</b> <a href="SmallBitVector_8h_source.html#l00230">SmallBitVector.h:230</a></div></div>
<div class="ttc" id="aScalarEvolution_8h_html"><div class="ttname"><a href="ScalarEvolution_8h.html">ScalarEvolution.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a785bcc5cab17bd5d96f800247dad0649"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a785bcc5cab17bd5d96f800247dad0649">llvm::TargetTransformInfo::getMaximumVF</a></div><div class="ttdeci">unsigned getMaximumVF(unsigned ElemWidth, unsigned Opcode) const</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00684">TargetTransformInfo.cpp:684</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ARMII_html_a7d414894ef8cdc39b147eb7e0d7e4305a9e2a02c8e15c43cfe03fee48f85f76cf"><div class="ttname"><a href="namespacellvm_1_1ARMII.html#a7d414894ef8cdc39b147eb7e0d7e4305a9e2a02c8e15c43cfe03fee48f85f76cf">llvm::ARMII::HorizontalReduction</a></div><div class="ttdeci">@ HorizontalReduction</div><div class="ttdef"><b>Definition:</b> <a href="MCTargetDesc_2ARMBaseInfo_8h_source.html#l00409">ARMBaseInfo.h:409</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html"><div class="ttname"><a href="classllvm_1_1Type.html">llvm::Type</a></div><div class="ttdoc">The instances of the Type class are immutable: once they are created, they are never changed.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00045">Type.h:45</a></div></div>
<div class="ttc" id="aDenseMap_8h_html"><div class="ttname"><a href="DenseMap_8h.html">DenseMap.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_html_a70aa6f9a0441a7a9449cb206bd77bad2"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a70aa6f9a0441a7a9449cb206bd77bad2">llvm::slpvectorizer::BoUpSLP::deleteTree</a></div><div class="ttdeci">void deleteTree()</div><div class="ttdoc">Clear the internal data structures that are created by 'buildTree'.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l01054">SLPVectorizer.cpp:1054</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ZeroCallUsedRegs_html_af03f9c4ce466646943e50f317397cec0a019d1ca7d50cc54b995f60d456435e87"><div class="ttname"><a href="namespacellvm_1_1ZeroCallUsedRegs.html#af03f9c4ce466646943e50f317397cec0a019d1ca7d50cc54b995f60d456435e87">llvm::ZeroCallUsedRegs::ZeroCallUsedRegsKind::Used</a></div><div class="ttdeci">@ Used</div></div>
<div class="ttc" id="aMSA_8txt_html_ab49a28dbe60da0a607449e5308b1ec3f"><div class="ttname"><a href="MSA_8txt.html#ab49a28dbe60da0a607449e5308b1ec3f">Instructions</a></div><div class="ttdeci">Code Generation Notes for reduce the size of the ISel and reduce repetition in the implementation In a small number of this can cause even when no optimisation has taken place Instructions</div><div class="ttdef"><b>Definition:</b> <a href="MSA_8txt_source.html#l00011">MSA.txt:11</a></div></div>
<div class="ttc" id="aModule_8h_html"><div class="ttname"><a href="Module_8h.html">Module.h</a></div></div>
<div class="ttc" id="astructllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_html_a180903be02d9be17b09b5bab0a19cfde"><div class="ttname"><a href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a180903be02d9be17b09b5bab0a19cfde">llvm::GraphTraits&lt; BoUpSLP * &gt;::getEntryNode</a></div><div class="ttdeci">static NodeRef getEntryNode(BoUpSLP &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03473">SLPVectorizer.cpp:3473</a></div></div>
<div class="ttc" id="aInjectTLIMappings_8h_html"><div class="ttname"><a href="InjectTLIMappings_8h.html">InjectTLIMappings.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_a4cc11b26432f9343b3c532f06171ad04"><div class="ttname"><a href="namespacellvm.html#a4cc11b26432f9343b3c532f06171ad04">llvm::bit_ceil</a></div><div class="ttdeci">T bit_ceil(T Value)</div><div class="ttdoc">Returns the smallest integral power of two no smaller than Value if Value is nonzero.</div><div class="ttdef"><b>Definition:</b> <a href="bit_8h_source.html#l00306">bit.h:306</a></div></div>
<div class="ttc" id="aclassllvm_1_1ElementCount_html_a584cb8dfa0090b33a969c4dda27337f6"><div class="ttname"><a href="classllvm_1_1ElementCount.html#a584cb8dfa0090b33a969c4dda27337f6">llvm::ElementCount::getFixed</a></div><div class="ttdeci">static constexpr ElementCount getFixed(ScalarTy MinVal)</div><div class="ttdef"><b>Definition:</b> <a href="TypeSize_8h_source.html#l00291">TypeSize.h:291</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_a5e4a09f80c7cd5283dbbc7256d122d12"><div class="ttname"><a href="classllvm_1_1CallBase.html#a5e4a09f80c7cd5283dbbc7256d122d12">llvm::CallBase::getFunctionType</a></div><div class="ttdeci">FunctionType * getFunctionType() const</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01264">InstrTypes.h:1264</a></div></div>
<div class="ttc" id="anamespacellvm_1_1sys_1_1path_html_a00a76a729b319dc47beffbe07325565f"><div class="ttname"><a href="namespacellvm_1_1sys_1_1path.html#a00a76a729b319dc47beffbe07325565f">llvm::sys::path::begin</a></div><div class="ttdeci">const_iterator begin(StringRef path, Style style=Style::native)</div><div class="ttdoc">Get begin iterator over path.</div><div class="ttdef"><b>Definition:</b> <a href="Path_8cpp_source.html#l00226">Path.cpp:226</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoopInfoWrapperPass_html"><div class="ttname"><a href="classllvm_1_1LoopInfoWrapperPass.html">llvm::LoopInfoWrapperPass</a></div><div class="ttdoc">The legacy pass manager's analysis pass to compute loop information.</div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l01293">LoopInfo.h:1293</a></div></div>
<div class="ttc" id="aclassllvm_1_1iterator__adaptor__base_html"><div class="ttname"><a href="classllvm_1_1iterator__adaptor__base.html">llvm::iterator_adaptor_base</a></div><div class="ttdoc">CRTP base class for adapting an iterator to a different type.</div><div class="ttdef"><b>Definition:</b> <a href="iterator_8h_source.html#l00235">iterator.h:235</a></div></div>
<div class="ttc" id="anamespacellvm_html_abb650e853db0ddbb60411b885c499737"><div class="ttname"><a href="namespacellvm.html#abb650e853db0ddbb60411b885c499737">llvm::copy</a></div><div class="ttdeci">OutputIt copy(R &amp;&amp;Range, OutputIt Out)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01837">STLExtras.h:1837</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallSet_html"><div class="ttname"><a href="classllvm_1_1SmallSet.html">llvm::SmallSet</a></div><div class="ttdoc">SmallSet - This maintains a set of unique values, optimizing for the case when the set is small (less...</div><div class="ttdef"><b>Definition:</b> <a href="SmallSet_8h_source.html#l00135">SmallSet.h:135</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a784097fca76abad9e815cf1692de79c4"><div class="ttname"><a href="classllvm_1_1Instruction.html#a784097fca76abad9e815cf1692de79c4">llvm::Instruction::comesBefore</a></div><div class="ttdeci">bool comesBefore(const Instruction *Other) const</div><div class="ttdoc">Given an instruction Other in the same basic block as this instruction, return true if this instructi...</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00122">Instruction.cpp:122</a></div></div>
<div class="ttc" id="anamespacellvm_html_a854abfc88bcd24e3878e2c9ab1f70fd3"><div class="ttname"><a href="namespacellvm.html#a854abfc88bcd24e3878e2c9ab1f70fd3">llvm::isModOrRefSet</a></div><div class="ttdeci">bool isModOrRefSet(const ModRefInfo MRI)</div><div class="ttdef"><b>Definition:</b> <a href="ModRef_8h_source.html#l00042">ModRef.h:42</a></div></div>
<div class="ttc" id="aclassllvm_1_1MemIntrinsic_html"><div class="ttname"><a href="classllvm_1_1MemIntrinsic.html">llvm::MemIntrinsic</a></div><div class="ttdoc">This is the common base class for memset/memcpy/memmove.</div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l01048">IntrinsicInst.h:1048</a></div></div>
<div class="ttc" id="anamespacellvm_html_a07e02addfc027a2e0f403fdac5b49163"><div class="ttname"><a href="namespacellvm.html#a07e02addfc027a2e0f403fdac5b49163">llvm::isVectorIntrinsicWithOverloadTypeAtArg</a></div><div class="ttdeci">bool isVectorIntrinsicWithOverloadTypeAtArg(Intrinsic::ID ID, unsigned OpdIdx)</div><div class="ttdoc">Identifies if the vector form of the intrinsic has a operand that has an overloaded type.</div><div class="ttdef"><b>Definition:</b> <a href="VectorUtils_8cpp_source.html#l00119">VectorUtils.cpp:119</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands_html_a8d66b6c2df1694b91c47b9ffe7a9edb8"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#a8d66b6c2df1694b91c47b9ffe7a9edb8">llvm::slpvectorizer::BoUpSLP::VLOperands::dump</a></div><div class="ttdeci">LLVM_DUMP_METHOD void dump() const</div><div class="ttdoc">Debug print.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l02177">SLPVectorizer.cpp:2177</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a53408c95a7bfb5443b43fb2134c3eb23"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a53408c95a7bfb5443b43fb2134c3eb23">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::count</a></div><div class="ttdeci">size_type count(const_arg_type_t&lt; KeyT &gt; Val) const</div><div class="ttdoc">Return 1 if the specified key is in the map, 0 otherwise.</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00145">DenseMap.h:145</a></div></div>
<div class="ttc" id="aREADME__P9_8txt_html_ae6881514a39f1bcf75ad62e5188700a4"><div class="ttname"><a href="README__P9_8txt.html#ae6881514a39f1bcf75ad62e5188700a4">Vector</a></div><div class="ttdeci">So we should use XX3Form_Rcr to implement intrinsic Convert DP outs ins xscvdpsp No builtin are required Round &amp;Convert QP DP(dword[1] is set to zero) No builtin are required Round to Quad Precision because you need to assign rounding mode in instruction Provide builtin(set f128:$vT,(int_ppc_vsx_xsrqpi f128:$vB))(set f128 yields&lt; n x&lt; ty &gt; &gt;&lt; result &gt; yields&lt; ty &gt;&lt; result &gt; No builtin are required Load Store Vector</div><div class="ttdef"><b>Definition:</b> <a href="README__P9_8txt_source.html#l00497">README_P9.txt:497</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a1f68c27188f1836737bf22a62c558354"><div class="ttname"><a href="classllvm_1_1Type.html#a1f68c27188f1836737bf22a62c558354">llvm::Type::isX86_FP80Ty</a></div><div class="ttdeci">bool isX86_FP80Ty() const</div><div class="ttdoc">Return true if this is x86 long double.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00160">Type.h:160</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a43ac4fbaaf63a88eb5ac05f6d3e5649c"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a43ac4fbaaf63a88eb5ac05f6d3e5649c">llvm::PatternMatch::m_BinOp</a></div><div class="ttdeci">class_match&lt; BinaryOperator &gt; m_BinOp()</div><div class="ttdoc">Match an arbitrary binary operation and ignore it.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00084">PatternMatch.h:84</a></div></div>
<div class="ttc" id="aclassllvm_1_1MapVector_html"><div class="ttname"><a href="classllvm_1_1MapVector.html">llvm::MapVector</a></div><div class="ttdoc">This class implements a map that also provides access to all stored values in a deterministic order.</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00037">MapVector.h:37</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSet_html"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html">llvm::SmallPtrSet&lt; Value *, 16 &gt;</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a733fb237f3037c95ed59de6055b176c5a974f46ced0fd416db695ce5da6059dcc"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a733fb237f3037c95ed59de6055b176c5a974f46ced0fd416db695ce5da6059dcc">llvm::TargetTransformInfo::OP_PowerOf2</a></div><div class="ttdeci">@ OP_PowerOf2</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00940">TargetTransformInfo.h:940</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a417e088fc2533a49543b5e26feb58d32"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a417e088fc2533a49543b5e26feb58d32">MaxStoreLookup</a></div><div class="ttdeci">static cl::opt&lt; int &gt; MaxStoreLookup(&quot;slp-max-store-lookup&quot;, cl::init(32), cl::Hidden, cl::desc(&quot;Maximum depth of the lookup for consecutive stores.&quot;))</div></div>
<div class="ttc" id="anamespacellvm_1_1ore_html_a8f5533240c6722d987a2443cba42019d"><div class="ttname"><a href="namespacellvm_1_1ore.html#a8f5533240c6722d987a2443cba42019d">llvm::ore::NV</a></div><div class="ttdeci">DiagnosticInfoOptimizationBase::Argument NV</div><div class="ttdef"><b>Definition:</b> <a href="OptimizationRemarkEmitter_8h_source.html#l00136">OptimizationRemarkEmitter.h:136</a></div></div>
<div class="ttc" id="anamespacellvm_html_ad46ed333b920b20e78d948610366254c"><div class="ttname"><a href="namespacellvm.html#ad46ed333b920b20e78d948610366254c">llvm::ComputeNumSignBits</a></div><div class="ttdeci">unsigned ComputeNumSignBits(const Value *Op, const DataLayout &amp;DL, unsigned Depth=0, AssumptionCache *AC=nullptr, const Instruction *CxtI=nullptr, const DominatorTree *DT=nullptr, bool UseInstrInfo=true)</div><div class="ttdoc">Return the number of times the sign bit of the register is replicated into the other bits.</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l00383">ValueTracking.cpp:383</a></div></div>
<div class="ttc" id="aOperator_8h_html"><div class="ttname"><a href="Operator_8h.html">Operator.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1VectorType_html_a12e23c3d619db313388fe11dc76eb23f"><div class="ttname"><a href="classllvm_1_1VectorType.html#a12e23c3d619db313388fe11dc76eb23f">llvm::VectorType::getElementType</a></div><div class="ttdeci">Type * getElementType() const</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00422">DerivedTypes.h:422</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a158da2b6d3d938aaa15b6acd00150e2c"><div class="ttname"><a href="classllvm_1_1Value.html#a158da2b6d3d938aaa15b6acd00150e2c">llvm::Value::user_begin</a></div><div class="ttdeci">user_iterator user_begin()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00397">Value.h:397</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_ac396bb87eb4db1dd3ce315e4d91ee2de"><div class="ttname"><a href="SLPVectorizer_8cpp.html#ac396bb87eb4db1dd3ce315e4d91ee2de">isUndefVector</a></div><div class="ttdeci">static SmallBitVector isUndefVector(const Value *V, const SmallBitVector &amp;UseMask={})</div><div class="ttdoc">Checks if the given value is actually an undefined constant vector.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00363">SLPVectorizer.cpp:363</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a2be3583dac92a031fa1458d4d992c78ba2751d6136a2819749dcef65dc19a4246"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba2751d6136a2819749dcef65dc19a4246">llvm::CmpInst::ICMP_SLE</a></div><div class="ttdeci">@ ICMP_SLE</div><div class="ttdoc">signed less or equal</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00748">InstrTypes.h:748</a></div></div>
<div class="ttc" id="anamespacellvm_html_ab4d4bc901fedd8857f647dcc2c0d71de"><div class="ttname"><a href="namespacellvm.html#ab4d4bc901fedd8857f647dcc2c0d71de">llvm::max</a></div><div class="ttdeci">Expected&lt; ExpressionValue &gt; max(const ExpressionValue &amp;Lhs, const ExpressionValue &amp;Rhs)</div><div class="ttdef"><b>Definition:</b> <a href="FileCheck_8cpp_source.html#l00337">FileCheck.cpp:337</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a06a9edb69d0ed6fda201d59948acfd89"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a06a9edb69d0ed6fda201d59948acfd89">isVectorLikeInstWithConstOps</a></div><div class="ttdeci">static bool isVectorLikeInstWithConstOps(Value *V)</div><div class="ttdoc">Checks if V is one of vector-like instructions, i.e.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00214">SLPVectorizer.cpp:214</a></div></div>
<div class="ttc" id="anamespacellvm_html_ab8635363d4287c93f64c55ad5567fcf0"><div class="ttname"><a href="namespacellvm.html#ab8635363d4287c93f64c55ad5567fcf0">llvm::ViewGraph</a></div><div class="ttdeci">void ViewGraph(const GraphType &amp;G, const Twine &amp;Name, bool ShortNames=false, const Twine &amp;Title=&quot;&quot;, GraphProgram::Name Program=GraphProgram::DOT)</div><div class="ttdoc">ViewGraph - Emit a dot graph, run 'dot', run gv on the postscript file, then cleanup.</div><div class="ttdef"><b>Definition:</b> <a href="GraphWriter_8h_source.html#l00427">GraphWriter.h:427</a></div></div>
<div class="ttc" id="anamespacellvm_1_1Intrinsic_html_a35fedf4db6d756bd82501607f93c1e79aab5fb650050f184fa7c19c26abde5226"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a35fedf4db6d756bd82501607f93c1e79aab5fb650050f184fa7c19c26abde5226">llvm::Intrinsic::not_intrinsic</a></div><div class="ttdeci">@ not_intrinsic</div><div class="ttdef"><b>Definition:</b> <a href="Intrinsics_8h_source.html#l00044">Intrinsics.h:44</a></div></div>
<div class="ttc" id="anamespacellvm_html_a03503773241005f01b090b9862aad304"><div class="ttname"><a href="namespacellvm.html#a03503773241005f01b090b9862aad304">llvm::dump</a></div><div class="ttdeci">void dump(const SparseBitVector&lt; ElementSize &gt; &amp;LHS, raw_ostream &amp;out)</div><div class="ttdef"><b>Definition:</b> <a href="SparseBitVector_8h_source.html#l00877">SparseBitVector.h:877</a></div></div>
<div class="ttc" id="aAMDGPURegBankSelect_8cpp_html_a14e0c000ed52e5fc187d4a885914cc1a"><div class="ttname"><a href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a></div><div class="ttdeci">amdgpu AMDGPU Register Bank Select</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPURegBankSelect_8cpp_source.html#l00045">AMDGPURegBankSelect.cpp:45</a></div></div>
<div class="ttc" id="aSTLExtras_8h_html"><div class="ttname"><a href="STLExtras_8h.html">STLExtras.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_a5542d44947f8d964b5ce3b20ea719b44"><div class="ttname"><a href="namespacellvm.html#a5542d44947f8d964b5ce3b20ea719b44">llvm::PowerOf2Ceil</a></div><div class="ttdeci">uint64_t PowerOf2Ceil(uint64_t A)</div><div class="ttdoc">Returns the power of two which is greater than or equal to the given value.</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00469">MathExtras.h:469</a></div></div>
<div class="ttc" id="aX86PartialReduction_8cpp_html_a87b8bfbbe9d8f7146d7f20a5fb42efd0"><div class="ttname"><a href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a></div><div class="ttdeci">Value * RHS</div><div class="ttdef"><b>Definition:</b> <a href="X86PartialReduction_8cpp_source.html#l00076">X86PartialReduction.cpp:76</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ARM_html_a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6"><div class="ttname"><a href="namespacellvm_1_1ARM.html#a5667e0461a51d2c4887056c3f684c341a83f56f37a245ccaf8c885814074777f6">llvm::ARM::PredBlockMask::TE</a></div><div class="ttdeci">@ TE</div></div>
<div class="ttc" id="aclassllvm_1_1SmallBitVector_html_a585f149dd8c344a40c53b1694d3161ed"><div class="ttname"><a href="classllvm_1_1SmallBitVector.html#a585f149dd8c344a40c53b1694d3161ed">llvm::SmallBitVector::test</a></div><div class="ttdeci">bool test(unsigned Idx) const</div><div class="ttdef"><b>Definition:</b> <a href="SmallBitVector_8h_source.html#l00472">SmallBitVector.h:472</a></div></div>
<div class="ttc" id="anamespacellvm_html_a48a6deb3e714d54e75caadcf84b0ca76"><div class="ttname"><a href="namespacellvm.html#a48a6deb3e714d54e75caadcf84b0ca76">llvm::propagateMetadata</a></div><div class="ttdeci">Instruction * propagateMetadata(Instruction *I, ArrayRef&lt; Value * &gt; VL)</div><div class="ttdoc">Specifically, let Kinds = [MD_tbaa, MD_alias_scope, MD_noalias, MD_fpmath, MD_nontemporal,...</div><div class="ttdef"><b>Definition:</b> <a href="VectorUtils_8cpp_source.html#l00889">VectorUtils.cpp:889</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoadInst_html_ad47eefa1d094f60494b6b927061ca001"><div class="ttname"><a href="classllvm_1_1LoadInst.html#ad47eefa1d094f60494b6b927061ca001">llvm::LoadInst::getPointerOperand</a></div><div class="ttdeci">Value * getPointerOperand()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00264">Instructions.h:264</a></div></div>
<div class="ttc" id="anamespacellvm_html_a6dec2b5d3e04b47adf4d918d678e81c9"><div class="ttname"><a href="namespacellvm.html#a6dec2b5d3e04b47adf4d918d678e81c9">llvm::isPowerOf2_32</a></div><div class="ttdeci">constexpr bool isPowerOf2_32(uint32_t Value)</div><div class="ttdoc">Return true if the argument is a power of two &gt; 0.</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00292">MathExtras.h:292</a></div></div>
<div class="ttc" id="astructllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_html_a55cdb660a488b62f949a57dc65f5296e"><div class="ttname"><a href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a55cdb660a488b62f949a57dc65f5296e">llvm::GraphTraits&lt; BoUpSLP * &gt;::NodeRef</a></div><div class="ttdeci">TreeEntry * NodeRef</div><div class="ttdoc">NodeRef has to be a pointer per the GraphWriter.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03455">SLPVectorizer.cpp:3455</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_html_a8be50e44f28ca2f65e01a0babc1a1720"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a8be50e44f28ca2f65e01a0babc1a1720">llvm::slpvectorizer::BoUpSLP::getFirstNodeMainOp</a></div><div class="ttdeci">Instruction * getFirstNodeMainOp() const</div><div class="ttdoc">Returns the main instruction for the very first node.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l01035">SLPVectorizer.cpp:1035</a></div></div>
<div class="ttc" id="aclassllvm_1_1UnaryOperator_html"><div class="ttname"><a href="classllvm_1_1UnaryOperator.html">llvm::UnaryOperator</a></div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00100">InstrTypes.h:100</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a9e009f75d93ef01dc1f9c495dbe69327"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a9e009f75d93ef01dc1f9c495dbe69327">findBuildAggregate</a></div><div class="ttdeci">static bool findBuildAggregate(Instruction *LastInsertInst, TargetTransformInfo *TTI, SmallVectorImpl&lt; Value * &gt; &amp;BuildVectorOpds, SmallVectorImpl&lt; Value * &gt; &amp;InsertElts)</div><div class="ttdoc">Recognize construction of vectors like ra = insertelement &lt;4 x float&gt; poison, float s0,...</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l13051">SLPVectorizer.cpp:13051</a></div></div>
<div class="ttc" id="astructllvm_1_1SLPVectorizerPass_html"><div class="ttname"><a href="structllvm_1_1SLPVectorizerPass.html">llvm::SLPVectorizerPass</a></div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8h_source.html#l00058">SLPVectorizer.h:58</a></div></div>
<div class="ttc" id="aclassllvm_1_1FastMathFlags_html"><div class="ttname"><a href="classllvm_1_1FastMathFlags.html">llvm::FastMathFlags</a></div><div class="ttdoc">Convenience struct for specifying and reasoning about fast-math flags.</div><div class="ttdef"><b>Definition:</b> <a href="FMF_8h_source.html#l00021">FMF.h:21</a></div></div>
<div class="ttc" id="anamespacellvm_html_aac36edd0f1ce976f0025c98e88d3830ead6bb6a2eca7d60c75e349ea45e138d74"><div class="ttname"><a href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ead6bb6a2eca7d60c75e349ea45e138d74">llvm::RecurKind::SMin</a></div><div class="ttdeci">@ SMin</div><div class="ttdoc">Signed integer min implemented in terms of select(cmp()).</div></div>
<div class="ttc" id="aclassllvm_1_1SmallBitVector_html_af66ea412504abedf84eebd3a5c744bd8"><div class="ttname"><a href="classllvm_1_1SmallBitVector.html#af66ea412504abedf84eebd3a5c744bd8">llvm::SmallBitVector::none</a></div><div class="ttdeci">bool none() const</div><div class="ttdoc">Returns true if none of the bits are set.</div><div class="ttdef"><b>Definition:</b> <a href="SmallBitVector_8h_source.html#l00223">SmallBitVector.h:223</a></div></div>
<div class="ttc" id="anamespacellvm_html_aa0d93b31f835afb05e3d03ea5f8626df"><div class="ttname"><a href="namespacellvm.html#aa0d93b31f835afb05e3d03ea5f8626df">llvm::getMinMaxReductionPredicate</a></div><div class="ttdeci">CmpInst::Predicate getMinMaxReductionPredicate(RecurKind RK)</div><div class="ttdoc">Returns the comparison predicate used when expanding a min/max reduction.</div><div class="ttdef"><b>Definition:</b> <a href="LoopUtils_8cpp_source.html#l00883">LoopUtils.cpp:883</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_aac5759c83abd6a4af236401a7cfe7a0f"><div class="ttname"><a href="classllvm_1_1Type.html#aac5759c83abd6a4af236401a7cfe7a0f">llvm::Type::isFloatingPointTy</a></div><div class="ttdeci">bool isFloatingPointTy() const</div><div class="ttdoc">Return true if this is one of the floating-point types.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00185">Type.h:185</a></div></div>
<div class="ttc" id="astructllvm_1_1TargetTransformInfo_1_1OperandValueInfo_html"><div class="ttname"><a href="structllvm_1_1TargetTransformInfo_1_1OperandValueInfo.html">llvm::TargetTransformInfo::OperandValueInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00947">TargetTransformInfo.h:947</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a6848b7e929178610d01e1b2b5052af86"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a6848b7e929178610d01e1b2b5052af86">isConstant</a></div><div class="ttdeci">static bool isConstant(Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00207">SLPVectorizer.cpp:207</a></div></div>
<div class="ttc" id="aclassllvm_1_1detail_1_1DenseSetImpl_html_a79eed48913651aeedda2eed25201ea84"><div class="ttname"><a href="classllvm_1_1detail_1_1DenseSetImpl.html#a79eed48913651aeedda2eed25201ea84">llvm::detail::DenseSetImpl::insert</a></div><div class="ttdeci">std::pair&lt; iterator, bool &gt; insert(const ValueT &amp;V)</div><div class="ttdef"><b>Definition:</b> <a href="DenseSet_8h_source.html#l00206">DenseSet.h:206</a></div></div>
<div class="ttc" id="aclassllvm_1_1FixedVectorType_html"><div class="ttname"><a href="classllvm_1_1FixedVectorType.html">llvm::FixedVectorType</a></div><div class="ttdoc">Class to represent fixed width SIMD vectors.</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00525">DerivedTypes.h:525</a></div></div>
<div class="ttc" id="anamespacellvm_1_1SPII_html_a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f"><div class="ttname"><a href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">llvm::SPII::Load</a></div><div class="ttdeci">@ Load</div><div class="ttdef"><b>Definition:</b> <a href="SparcInstrInfo_8h_source.html#l00032">SparcInstrInfo.h:32</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoadInst_html_af51c113a039c82f6870df5dc9666b5e3"><div class="ttname"><a href="classllvm_1_1LoadInst.html#af51c113a039c82f6870df5dc9666b5e3">llvm::LoadInst::getAlign</a></div><div class="ttdeci">Align getAlign() const</div><div class="ttdoc">Return the alignment of the access that is being performed.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00220">Instructions.h:220</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_af46433d0e36d3f80afc3a8c67b5c53eca7beec9815d0197f2d31fac9968e9205b"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53eca7beec9815d0197f2d31fac9968e9205b">llvm::TargetTransformInfo::SK_PermuteSingleSrc</a></div><div class="ttdeci">@ SK_PermuteSingleSrc</div><div class="ttdoc">Shuffle elements of single source vector with any shuffle mask.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00921">TargetTransformInfo.h:921</a></div></div>
<div class="ttc" id="anamespacellvm_html_ac214df91cdc242f4710ea5a93939c678"><div class="ttname"><a href="namespacellvm.html#ac214df91cdc242f4710ea5a93939c678">llvm::count_if</a></div><div class="ttdeci">auto count_if(R &amp;&amp;Range, UnaryPredicate P)</div><div class="ttdoc">Wrapper function around std::count_if to count the number of times an element satisfying a given pred...</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01903">STLExtras.h:1903</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a9237251072bf6816163abc2d053212ee"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a9237251072bf6816163abc2d053212ee">llvm::BasicBlock::rend</a></div><div class="ttdeci">reverse_iterator rend()</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00321">BasicBlock.h:321</a></div></div>
<div class="ttc" id="aUse_8h_html"><div class="ttname"><a href="Use_8h.html">Use.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d"><div class="ttname"><a href="namespacellvm.html#ae551fe3e2b167b36005b26473e993884a26aa2e7865f749b52f3b77991776c40d">llvm::Data</a></div><div class="ttdeci">@ Data</div><div class="ttdef"><b>Definition:</b> <a href="SIMachineScheduler_8h_source.html#l00055">SIMachineScheduler.h:55</a></div></div>
<div class="ttc" id="aclassBoUpSLP_1_1ShuffleInstructionBuilder_html_aaee34f78593d529e1b378422b93062e1"><div class="ttname"><a href="classBoUpSLP_1_1ShuffleInstructionBuilder.html#aaee34f78593d529e1b378422b93062e1">BoUpSLP::ShuffleInstructionBuilder::ShuffleInstructionBuilder</a></div><div class="ttdeci">ShuffleInstructionBuilder(IRBuilderBase &amp;Builder, BoUpSLP &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l08837">SLPVectorizer.cpp:8837</a></div></div>
<div class="ttc" id="anamespacellvm_html_a206919e5542f742070811ced039f3461"><div class="ttname"><a href="namespacellvm.html#a206919e5542f742070811ced039f3461">llvm::createSimpleTargetReduction</a></div><div class="ttdeci">Value * createSimpleTargetReduction(IRBuilderBase &amp;B, const TargetTransformInfo *TTI, Value *Src, RecurKind RdxKind)</div><div class="ttdoc">Create a target reduction of the given vector.</div><div class="ttdef"><b>Definition:</b> <a href="LoopUtils_8cpp_source.html#l01025">LoopUtils.cpp:1025</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_add4e37b60ea64faafbc9a5bf3e27280f"><div class="ttname"><a href="classllvm_1_1APInt.html#add4e37b60ea64faafbc9a5bf3e27280f">llvm::APInt::getZero</a></div><div class="ttdeci">static APInt getZero(unsigned numBits)</div><div class="ttdoc">Get the '0' value for the specified bit-width.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00177">APInt.h:177</a></div></div>
<div class="ttc" id="anamespacellvm_html_a0f0d66fa63bebb53ddd51f1cc4def0f8"><div class="ttname"><a href="namespacellvm.html#a0f0d66fa63bebb53ddd51f1cc4def0f8">llvm::isEqual</a></div><div class="ttdeci">bool isEqual(const GCNRPTracker::LiveRegSet &amp;S1, const GCNRPTracker::LiveRegSet &amp;S2)</div><div class="ttdef"><b>Definition:</b> <a href="GCNRegPressure_8cpp_source.html#l00021">GCNRegPressure.cpp:21</a></div></div>
<div class="ttc" id="astructllvm_1_1DOTGraphTraits_3_01BoUpSLP_01_5_01_4_html_a45a13602ae6871b220b0f63d82853741"><div class="ttname"><a href="structllvm_1_1DOTGraphTraits_3_01BoUpSLP_01_5_01_4.html#a45a13602ae6871b220b0f63d82853741">llvm::DOTGraphTraits&lt; BoUpSLP * &gt;::DOTGraphTraits</a></div><div class="ttdeci">DOTGraphTraits(bool isSimple=false)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03515">SLPVectorizer.cpp:3515</a></div></div>
<div class="ttc" id="anamespacellvm_1_1APIntOps_html_aa606171b17bdde9015fa656e226ca9e0"><div class="ttname"><a href="namespacellvm_1_1APIntOps.html#aa606171b17bdde9015fa656e226ca9e0">llvm::APIntOps::umin</a></div><div class="ttdeci">const APInt &amp; umin(const APInt &amp;A, const APInt &amp;B)</div><div class="ttdoc">Determine the smaller of two APInts considered to be unsigned.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l02185">APInt.h:2185</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html_ac835b8735b1b2faec0efdca236e37d94"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#ac835b8735b1b2faec0efdca236e37d94">llvm::ArrayRef::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdoc">empty - Check if the array is empty.</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00158">ArrayRef.h:158</a></div></div>
<div class="ttc" id="aDebug_8h_html_a08efc68d15935eb8889400a46c3749ba"><div class="ttname"><a href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a></div><div class="ttdeci">#define LLVM_DEBUG(X)</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8h_source.html#l00101">Debug.h:101</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_adb9592b867016414cf26ca6bad0dc544"><div class="ttname"><a href="SLPVectorizer_8cpp.html#adb9592b867016414cf26ca6bad0dc544">ScheduleRegionSizeBudget</a></div><div class="ttdeci">static cl::opt&lt; int &gt; ScheduleRegionSizeBudget(&quot;slp-schedule-budget&quot;, cl::init(100000), cl::Hidden, cl::desc(&quot;Limit the size of the SLP scheduling region per block&quot;))</div><div class="ttdoc">Limits the size of scheduling regions in a block.</div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_af46433d0e36d3f80afc3a8c67b5c53ecab1ac8982cdb119f39a5fe74610a46796"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53ecab1ac8982cdb119f39a5fe74610a46796">llvm::TargetTransformInfo::SK_Broadcast</a></div><div class="ttdeci">@ SK_Broadcast</div><div class="ttdoc">Broadcast element 0 to all other elements.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00911">TargetTransformInfo.h:911</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_a96d73bbd7af15cb1fc38c3f4a3bd82e9"><div class="ttname"><a href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a></div><div class="ttdeci">#define F(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00055">MD5.cpp:55</a></div></div>
<div class="ttc" id="anamespacellvm_1_1RISCVFenceField_html_a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731"><div class="ttname"><a href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">llvm::RISCVFenceField::R</a></div><div class="ttdeci">@ R</div><div class="ttdef"><b>Definition:</b> <a href="RISCVBaseInfo_8h_source.html#l00278">RISCVBaseInfo.h:278</a></div></div>
<div class="ttc" id="astructllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_html_a69646757cf64341a41b3d5da0824fcc5"><div class="ttname"><a href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a69646757cf64341a41b3d5da0824fcc5">llvm::GraphTraits&lt; BoUpSLP * &gt;::size</a></div><div class="ttdeci">static unsigned size(BoUpSLP *R)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03509">SLPVectorizer.cpp:3509</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a5e3486337f60bed631149fb6b141bc3e"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a5e3486337f60bed631149fb6b141bc3e">llvm::PatternMatch::m_FAdd</a></div><div class="ttdeci">BinaryOp_match&lt; LHS, RHS, Instruction::FAdd &gt; m_FAdd(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00985">PatternMatch.h:985</a></div></div>
<div class="ttc" id="aKnownBits_8h_html"><div class="ttname"><a href="KnownBits_8h.html">KnownBits.h</a></div></div>
<div class="ttc" id="astructllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo_html_a245e7cffbc040976da0a6407651983de"><div class="ttname"><a href="structllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo.html#a245e7cffbc040976da0a6407651983de">llvm::slpvectorizer::BoUpSLP::EdgeInfo::EdgeInfo</a></div><div class="ttdeci">EdgeInfo(TreeEntry *UserTE, unsigned EdgeIdx)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l01176">SLPVectorizer.cpp:1176</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html"><div class="ttname"><a href="classllvm_1_1BasicBlock.html">llvm::BasicBlock</a></div><div class="ttdoc">LLVM Basic Block Representation.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00055">BasicBlock.h:55</a></div></div>
<div class="ttc" id="anamespacellvm_1_1lltok_html_af353621f14cb4b4b3af5ffaff84076b1abf5ba3ee47e95dae362eb24b6d4f48e5"><div class="ttname"><a href="namespacellvm_1_1lltok.html#af353621f14cb4b4b3af5ffaff84076b1abf5ba3ee47e95dae362eb24b6d4f48e5">llvm::lltok::equal</a></div><div class="ttdeci">@ equal</div><div class="ttdef"><b>Definition:</b> <a href="LLToken_8h_source.html#l00025">LLToken.h:25</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_a4e301518882466a796c3b890aac2e866"><div class="ttname"><a href="classllvm_1_1CallBase.html#a4e301518882466a796c3b890aac2e866">llvm::CallBase::hasIdenticalOperandBundleSchema</a></div><div class="ttdeci">bool hasIdenticalOperandBundleSchema(const CallBase &amp;Other) const</div><div class="ttdoc">Return true if Other has the same sequence of operand bundle tags with the same number of operands on...</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l02100">InstrTypes.h:2100</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AArch64PACKey_html_abf4394f452bde3f544999858d71e4b46a8a67c950f093761829058d45fbc3f522"><div class="ttname"><a href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46a8a67c950f093761829058d45fbc3f522">llvm::AArch64PACKey::DB</a></div><div class="ttdeci">@ DB</div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00794">AArch64BaseInfo.h:794</a></div></div>
<div class="ttc" id="astructllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_html_a0471d402d5bb1c256eeefc915d2bc00b"><div class="ttname"><a href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a0471d402d5bb1c256eeefc915d2bc00b">llvm::GraphTraits&lt; BoUpSLP * &gt;::child_end</a></div><div class="ttdeci">static ChildIteratorType child_end(NodeRef N)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03481">SLPVectorizer.cpp:3481</a></div></div>
<div class="ttc" id="anamespacellvm_html_a4e09435caee07f636a47006fa08b9ec4"><div class="ttname"><a href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">llvm::UndefMaskElem</a></div><div class="ttdeci">constexpr int UndefMaskElem</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02005">Instructions.h:2005</a></div></div>
<div class="ttc" id="aAliasAnalysis_8h_html"><div class="ttname"><a href="AliasAnalysis_8h.html">AliasAnalysis.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands_html_ab3635230226f6d60dad04b8e83d848fd"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#ab3635230226f6d60dad04b8e83d848fd">llvm::slpvectorizer::BoUpSLP::VLOperands::reorder</a></div><div class="ttdeci">void reorder()</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l01992">SLPVectorizer.cpp:1992</a></div></div>
<div class="ttc" id="aREADME__P9_8txt_html_ae070adaf1b4bf0e7c12fcae2b9c5ae67"><div class="ttname"><a href="README__P9_8txt.html#ae070adaf1b4bf0e7c12fcae2b9c5ae67">result</a></div><div class="ttdeci">It looks like we only need to define PPCfmarto for these because according to these instructions perform RTO on fma s result</div><div class="ttdef"><b>Definition:</b> <a href="README__P9_8txt_source.html#l00256">README_P9.txt:256</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_aca6428e7fec51ba0b55594f469eb9691"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#aca6428e7fec51ba0b55594f469eb9691">llvm::PatternMatch::m_OneUse</a></div><div class="ttdeci">OneUse_match&lt; T &gt; m_OneUse(const T &amp;SubPattern)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00067">PatternMatch.h:67</a></div></div>
<div class="ttc" id="anamespacellvm_html_aac36edd0f1ce976f0025c98e88d3830e"><div class="ttname"><a href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830e">llvm::RecurKind</a></div><div class="ttdeci">RecurKind</div><div class="ttdoc">These are the kinds of recurrences that we support.</div><div class="ttdef"><b>Definition:</b> <a href="IVDescriptors_8h_source.html#l00035">IVDescriptors.h:35</a></div></div>
<div class="ttc" id="aclassllvm_1_1InjectTLIMappingsLegacy_html"><div class="ttname"><a href="classllvm_1_1InjectTLIMappingsLegacy.html">llvm::InjectTLIMappingsLegacy</a></div><div class="ttdef"><b>Definition:</b> <a href="InjectTLIMappings_8h_source.html#l00028">InjectTLIMappings.h:28</a></div></div>
<div class="ttc" id="aclassllvm_1_1RecurrenceDescriptor_html_aef4824e1c55ce3d04e8759c333dbc5c5"><div class="ttname"><a href="classllvm_1_1RecurrenceDescriptor.html#aef4824e1c55ce3d04e8759c333dbc5c5">llvm::RecurrenceDescriptor::isIntMinMaxRecurrenceKind</a></div><div class="ttdeci">static bool isIntMinMaxRecurrenceKind(RecurKind Kind)</div><div class="ttdoc">Returns true if the recurrence kind is an integer min/max kind.</div><div class="ttdef"><b>Definition:</b> <a href="IVDescriptors_8h_source.html#l00222">IVDescriptors.h:222</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7c46c742c31be54870e2038048e6b391"><div class="ttname"><a href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">llvm::dbgs</a></div><div class="ttdeci">raw_ostream &amp; dbgs()</div><div class="ttdoc">dbgs() - This returns a reference to a raw_ostream for debugging messages.</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8cpp_source.html#l00163">Debug.cpp:163</a></div></div>
<div class="ttc" id="aCoroutines_8cpp_html_ac781ce96aa25ba7f6fd38f72de665450"><div class="ttname"><a href="Coroutines_8cpp.html#ac781ce96aa25ba7f6fd38f72de665450">clear</a></div><div class="ttdeci">static void clear(coro::Shape &amp;Shape)</div><div class="ttdef"><b>Definition:</b> <a href="Coroutines_8cpp_source.html#l00149">Coroutines.cpp:149</a></div></div>
<div class="ttc" id="aclassllvm_1_1DomTreeNodeBase_html_a718717ee958956ec34ed177ef0b7f2ba"><div class="ttname"><a href="classllvm_1_1DomTreeNodeBase.html#a718717ee958956ec34ed177ef0b7f2ba">llvm::DomTreeNodeBase::getDFSNumIn</a></div><div class="ttdeci">unsigned getDFSNumIn() const</div><div class="ttdoc">getDFSNumIn/getDFSNumOut - These return the DFS visitation order for nodes in the dominator tree.</div><div class="ttdef"><b>Definition:</b> <a href="GenericDomTree_8h_source.html#l00144">GenericDomTree.h:144</a></div></div>
<div class="ttc" id="aclassllvm_1_1DominatorTree_html_a5c69311e8d44898dac36a155c3d8691d"><div class="ttname"><a href="classllvm_1_1DominatorTree.html#a5c69311e8d44898dac36a155c3d8691d">llvm::DominatorTree::dominates</a></div><div class="ttdeci">bool dominates(const BasicBlock *BB, const Use &amp;U) const</div><div class="ttdoc">Return true if the (end of the) basic block BB dominates the use U.</div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8cpp_source.html#l00122">Dominators.cpp:122</a></div></div>
<div class="ttc" id="aInjectTLIMappings_8cpp_html_a3d23fb8c590cd607d4b25a05e31c69f5"><div class="ttname"><a href="InjectTLIMappings_8cpp.html#a3d23fb8c590cd607d4b25a05e31c69f5">Mappings</a></div><div class="ttdeci">Inject TLI Mappings</div><div class="ttdef"><b>Definition:</b> <a href="InjectTLIMappings_8cpp_source.html#l00171">InjectTLIMappings.cpp:171</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallBitVector_html"><div class="ttname"><a href="classllvm_1_1SmallBitVector.html">llvm::SmallBitVector</a></div><div class="ttdoc">This is a 'bitvector' (really, a variable-sized bit array), optimized for the case when the array is ...</div><div class="ttdef"><b>Definition:</b> <a href="SmallBitVector_8h_source.html#l00035">SmallBitVector.h:35</a></div></div>
<div class="ttc" id="astructllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_html_ab4c8013f467416a8c492e3a26fb8b077"><div class="ttname"><a href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#ab4c8013f467416a8c492e3a26fb8b077">llvm::GraphTraits&lt; BoUpSLP * &gt;::nodes_end</a></div><div class="ttdeci">static nodes_iterator nodes_end(BoUpSLP *R)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03505">SLPVectorizer.cpp:3505</a></div></div>
<div class="ttc" id="aAMDGPULibCalls_8cpp_html_afecf1cc1292b07f57d343c0f4d682044"><div class="ttname"><a href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a></div><div class="ttdeci">amdgpu Simplify well known AMD library false FunctionCallee Value * Arg</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPULibCalls_8cpp_source.html#l00187">AMDGPULibCalls.cpp:187</a></div></div>
<div class="ttc" id="anamespacellvm_html_a2554a96c67bdd7d0a62855a844ec55b0a945d5e233cf7d6240f6b783b36a374ff"><div class="ttname"><a href="namespacellvm.html#a2554a96c67bdd7d0a62855a844ec55b0a945d5e233cf7d6240f6b783b36a374ff">llvm::AlignStyle::Left</a></div><div class="ttdeci">@ Left</div></div>
<div class="ttc" id="anamespacellvm_html_a73257f51950d9ea50955e3fb9c724a25"><div class="ttname"><a href="namespacellvm.html#a73257f51950d9ea50955e3fb9c724a25">llvm::get</a></div><div class="ttdeci">decltype(auto) get(const PointerIntPair&lt; PointerTy, IntBits, IntType, PtrTraits, Info &gt; &amp;Pair)</div><div class="ttdef"><b>Definition:</b> <a href="PointerIntPair_8h_source.html#l00234">PointerIntPair.h:234</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_ac8e9faa42b77ed7ed26cba77288e6f73"><div class="ttname"><a href="SLPVectorizer_8cpp.html#ac8e9faa42b77ed7ed26cba77288e6f73">generateKeySubkey</a></div><div class="ttdeci">static std::pair&lt; size_t, size_t &gt; generateKeySubkey(Value *V, const TargetLibraryInfo *TLI, function_ref&lt; hash_code(size_t, LoadInst *)&gt; LoadsSubkeyGenerator, bool AllowAlternate)</div><div class="ttdoc">Generates key/subkey pair for the given value to provide effective sorting of the values and better d...</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l04889">SLPVectorizer.cpp:4889</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_html_aacc65a747c158a620f90f612a673a506"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#aacc65a747c158a620f90f612a673a506">llvm::slpvectorizer::BoUpSLP::getMinVF</a></div><div class="ttdeci">unsigned getMinVF(unsigned Sz) const</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l01128">SLPVectorizer.cpp:1128</a></div></div>
<div class="ttc" id="anamespacellvm_html_a6a84483f8f0bece492d8083c524db5c0"><div class="ttname"><a href="namespacellvm.html#a6a84483f8f0bece492d8083c524db5c0">llvm::createSLPVectorizerPass</a></div><div class="ttdeci">Pass * createSLPVectorizerPass()</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l13972">SLPVectorizer.cpp:13972</a></div></div>
<div class="ttc" id="anamespacellvm_1_1BitmaskEnumDetail_html_a91efa71de05b0c2d00730a0279f58658"><div class="ttname"><a href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">llvm::BitmaskEnumDetail::Mask</a></div><div class="ttdeci">constexpr std::underlying_type_t&lt; E &gt; Mask()</div><div class="ttdoc">Get a bitmask with 1s in all places up to the high-order bit of E's largest value.</div><div class="ttdef"><b>Definition:</b> <a href="BitmaskEnum_8h_source.html#l00080">BitmaskEnum.h:80</a></div></div>
<div class="ttc" id="aIR_2Instruction_8h_html"><div class="ttname"><a href="IR_2Instruction_8h.html">Instruction.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_aac9e78b3aa02ec087c4621358f506718"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#aac9e78b3aa02ec087c4621358f506718">llvm::PatternMatch::m_APInt</a></div><div class="ttdeci">apint_match m_APInt(const APInt *&amp;Res)</div><div class="ttdoc">Match a ConstantInt or splatted ConstantVector, binding the specified pointer to the contained APInt.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00278">PatternMatch.h:278</a></div></div>
<div class="ttc" id="aCommandLine_8h_html"><div class="ttname"><a href="CommandLine_8h.html">CommandLine.h</a></div></div>
<div class="ttc" id="aCodeMetrics_8h_html"><div class="ttname"><a href="CodeMetrics_8h.html">CodeMetrics.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1FixedVectorType_html_a1893caf878859959ba6a3d5442ef1439"><div class="ttname"><a href="classllvm_1_1FixedVectorType.html#a1893caf878859959ba6a3d5442ef1439">llvm::FixedVectorType::getNumElements</a></div><div class="ttdeci">unsigned getNumElements() const</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00568">DerivedTypes.h:568</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_ae5a9f5c71425f38b8874296c380567ad"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#ae5a9f5c71425f38b8874296c380567ad">llvm::PatternMatch::m_UMax</a></div><div class="ttdeci">MaxMin_match&lt; ICmpInst, LHS, RHS, umax_pred_ty &gt; m_UMax(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01865">PatternMatch.h:1865</a></div></div>
<div class="ttc" id="aX86PartialReduction_8cpp_html_a9e1483f7215664a2315c53c3558d9a8d"><div class="ttname"><a href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a></div><div class="ttdeci">Value * LHS</div><div class="ttdef"><b>Definition:</b> <a href="X86PartialReduction_8cpp_source.html#l00075">X86PartialReduction.cpp:75</a></div></div>
<div class="ttc" id="astructllvm_1_1SLPVectorizerPass_html_ad2e77c37d75ccdfcb7a3bc4fa8d58c85"><div class="ttname"><a href="structllvm_1_1SLPVectorizerPass.html#ad2e77c37d75ccdfcb7a3bc4fa8d58c85">llvm::SLPVectorizerPass::runImpl</a></div><div class="ttdeci">bool runImpl(Function &amp;F, ScalarEvolution *SE_, TargetTransformInfo *TTI_, TargetLibraryInfo *TLI_, AAResults *AA_, LoopInfo *LI_, DominatorTree *DT_, AssumptionCache *AC_, DemandedBits *DB_, OptimizationRemarkEmitter *ORE_)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l11318">SLPVectorizer.cpp:11318</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html"><div class="ttname"><a href="classllvm_1_1ConstantInt.html">llvm::ConstantInt</a></div><div class="ttdoc">This is the shared class of boolean and integer constants.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00078">Constants.h:78</a></div></div>
<div class="ttc" id="astructllvm_1_1KnownBits_html_a157efd68e8b4b838829cad165b1583f8"><div class="ttname"><a href="structllvm_1_1KnownBits.html#a157efd68e8b4b838829cad165b1583f8">llvm::KnownBits::isNonNegative</a></div><div class="ttdeci">bool isNonNegative() const</div><div class="ttdoc">Returns true if this value is known to be non-negative.</div><div class="ttdef"><b>Definition:</b> <a href="KnownBits_8h_source.html#l00099">KnownBits.h:99</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a5f6edc5246188225b3f49bd5c974c759"><div class="ttname"><a href="classllvm_1_1Type.html#a5f6edc5246188225b3f49bd5c974c759">llvm::Type::isSingleValueType</a></div><div class="ttdeci">bool isSingleValueType() const</div><div class="ttdoc">Return true if the type is a valid type for a register in codegen.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00280">Type.h:280</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a7a84209b8495d8fd3d2799eb01f1ab2b"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a7a84209b8495d8fd3d2799eb01f1ab2b">llvm::TargetTransformInfo::isTypeLegal</a></div><div class="ttdeci">bool isTypeLegal(Type *Ty) const</div><div class="ttdoc">Return true if this type is legal.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00498">TargetTransformInfo.cpp:498</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_ab4e05d690df389b8b1477c90387b575f"><div class="ttname"><a href="classllvm_1_1Instruction.html#ab4e05d690df389b8b1477c90387b575f">llvm::Instruction::getOpcode</a></div><div class="ttdeci">unsigned getOpcode() const</div><div class="ttdoc">Returns a member of one of the enums like Instruction::Add.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00168">Instruction.h:168</a></div></div>
<div class="ttc" id="anamespacellvm_html_a0d10fe510ced2849a8074fe81e5d04ce"><div class="ttname"><a href="namespacellvm.html#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all_of</a></div><div class="ttdeci">bool all_of(R &amp;&amp;range, UnaryPredicate P)</div><div class="ttdoc">Provide wrappers to std::all_of which take ranges instead of having to pass begin/end explicitly.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01735">STLExtras.h:1735</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_af46433d0e36d3f80afc3a8c67b5c53ecab4616961a3bfdaec42aedc4fc426ccfe"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53ecab4616961a3bfdaec42aedc4fc426ccfe">llvm::TargetTransformInfo::SK_PermuteTwoSrc</a></div><div class="ttdeci">@ SK_PermuteTwoSrc</div><div class="ttdoc">Merge elements from two source vectors into one with any shuffle mask.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00919">TargetTransformInfo.h:919</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html_adb38eaaa53c1d9c57b6fe11cf84bd7a4"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#adb38eaaa53c1d9c57b6fe11cf84bd7a4">llvm::ArrayRef::back</a></div><div class="ttdeci">const T &amp; back() const</div><div class="ttdoc">back - Get the last element.</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00172">ArrayRef.h:172</a></div></div>
<div class="ttc" id="aclassllvm_1_1StoreInst_html_a14298313bdf734e2db5a921cc6e861a0"><div class="ttname"><a href="classllvm_1_1StoreInst.html#a14298313bdf734e2db5a921cc6e861a0">llvm::StoreInst::getValueOperand</a></div><div class="ttdeci">Value * getValueOperand()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00390">Instructions.h:390</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a096c8b641174dc0e486006926c5202cf"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a096c8b641174dc0e486006926c5202cf">llvm::TargetTransformInfo::getCastContextHint</a></div><div class="ttdeci">static CastContextHint getCastContextHint(const Instruction *I)</div><div class="ttdoc">Calculates a CastContextHint from I.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00826">TargetTransformInfo.cpp:826</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a274654b7f5932cae6a71a113322481be"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a274654b7f5932cae6a71a113322481be">SV_NAME</a></div><div class="ttdeci">#define SV_NAME</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00107">SLPVectorizer.cpp:107</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a9679969ae87f8a08d5f6948be6cf7210"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a9679969ae87f8a08d5f6948be6cf7210">llvm::TargetTransformInfo::getArithmeticInstrCost</a></div><div class="ttdeci">InstructionCost getArithmeticInstrCost(unsigned Opcode, Type *Ty, TTI::TargetCostKind CostKind=TTI::TCK_RecipThroughput, TTI::OperandValueInfo Opd1Info={TTI::OK_AnyValue, TTI::OP_None}, TTI::OperandValueInfo Opd2Info={TTI::OK_AnyValue, TTI::OP_None}, ArrayRef&lt; const Value * &gt; Args=ArrayRef&lt; const Value * &gt;(), const Instruction *CxtI=nullptr) const</div><div class="ttdoc">This is an approximation of reciprocal throughput of a math/logic op.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00803">TargetTransformInfo.cpp:803</a></div></div>
<div class="ttc" id="anamespacellvm_html_aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b"><div class="ttname"><a href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">llvm::RecurKind::And</a></div><div class="ttdeci">@ And</div><div class="ttdoc">Bitwise or logical AND of integers.</div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a33f9f862dca8ee0f23bff5941bf433d8"><div class="ttname"><a href="classllvm_1_1APInt.html#a33f9f862dca8ee0f23bff5941bf433d8">llvm::APInt::setBit</a></div><div class="ttdeci">void setBit(unsigned BitPosition)</div><div class="ttdoc">Set the given bit to 1 whose position is given as &quot;bitPosition&quot;.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01308">APInt.h:1308</a></div></div>
<div class="ttc" id="aclassllvm_1_1PassRegistry_html_a05a729900b76c89e808c6c3094921b2f"><div class="ttname"><a href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">llvm::PassRegistry::getPassRegistry</a></div><div class="ttdeci">static PassRegistry * getPassRegistry()</div><div class="ttdoc">getPassRegistry - Access the global registry object, which is automatically initialized at applicatio...</div><div class="ttdef"><b>Definition:</b> <a href="PassRegistry_8cpp_source.html#l00024">PassRegistry.cpp:24</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_addb87fe3f509b7803d3f5933ee24b560"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#addb87fe3f509b7803d3f5933ee24b560">llvm::PatternMatch::m_Select</a></div><div class="ttdeci">ThreeOps_match&lt; Cond, LHS, RHS, Instruction::Select &gt; m_Select(const Cond &amp;C, const LHS &amp;L, const RHS &amp;R)</div><div class="ttdoc">Matches SelectInst.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01462">PatternMatch.h:1462</a></div></div>
<div class="ttc" id="aclassllvm_1_1VFDatabase_html"><div class="ttname"><a href="classllvm_1_1VFDatabase.html">llvm::VFDatabase</a></div><div class="ttdoc">The Vector Function Database.</div><div class="ttdef"><b>Definition:</b> <a href="VectorUtils_8h_source.html#l00224">VectorUtils.h:224</a></div></div>
<div class="ttc" id="alib_2Target_2ARM_2README_8txt_html_adefbb946b174533d5eb8db503b1f4ffa"><div class="ttname"><a href="lib_2Target_2ARM_2README_8txt.html#adefbb946b174533d5eb8db503b1f4ffa">L2</a></div><div class="ttdeci">add sub stmia L5 ldr L2</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2ARM_2README_8txt_source.html#l00201">README.txt:201</a></div></div>
<div class="ttc" id="aclassllvm_1_1MutableArrayRef_html"><div class="ttname"><a href="classllvm_1_1MutableArrayRef.html">llvm::MutableArrayRef</a></div><div class="ttdoc">MutableArrayRef - Represent a mutable reference to an array (0 or more elements consecutively in memo...</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00027">ArrayRef.h:27</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a2d77b9d450543e86acb394ff6dda6b53"><div class="ttname"><a href="classllvm_1_1Instruction.html#a2d77b9d450543e86acb394ff6dda6b53">llvm::Instruction::mayReadOrWriteMemory</a></div><div class="ttdeci">bool mayReadOrWriteMemory() const</div><div class="ttdoc">Return true if this instruction may read or write memory.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00622">Instruction.h:622</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a247b6987d634040b8aa6fb9c5887b703"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a247b6987d634040b8aa6fb9c5887b703">llvm::PatternMatch::m_ZExtOrSExt</a></div><div class="ttdeci">match_combine_or&lt; CastClass_match&lt; OpTy, Instruction::ZExt &gt;, CastClass_match&lt; OpTy, Instruction::SExt &gt; &gt; m_ZExtOrSExt(const OpTy &amp;Op)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01648">PatternMatch.h:1648</a></div></div>
<div class="ttc" id="aConstants_8h_html"><div class="ttname"><a href="Constants_8h.html">Constants.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_aeed8ef055d0b853fb0b4c07bf7c96206"><div class="ttname"><a href="namespacellvm.html#aeed8ef055d0b853fb0b4c07bf7c96206">llvm::Failed</a></div><div class="ttdeci">testing::Matcher&lt; const detail::ErrorHolder &amp; &gt; Failed()</div><div class="ttdef"><b>Definition:</b> <a href="Testing_2Support_2Error_8h_source.html#l00198">Error.h:198</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a25d956d9e0beadd47ce4bc255dfa811d"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">llvm::PatternMatch::match</a></div><div class="ttdeci">bool match(Val *V, const Pattern &amp;P)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00049">PatternMatch.h:49</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ISD_html_a22ea9cec080dd5f4f47ba234c2f59110aac2f0a84dd2aa5ee4c3f1385e9565f5e"><div class="ttname"><a href="namespacellvm_1_1ISD.html#a22ea9cec080dd5f4f47ba234c2f59110aac2f0a84dd2aa5ee4c3f1385e9565f5e">llvm::ISD::Constant</a></div><div class="ttdeci">@ Constant</div><div class="ttdef"><b>Definition:</b> <a href="ISDOpcodes_8h_source.html#l00076">ISDOpcodes.h:76</a></div></div>
<div class="ttc" id="aclassllvm_1_1AAResults_html"><div class="ttname"><a href="classllvm_1_1AAResults.html">llvm::AAResults</a></div><div class="ttdef"><b>Definition:</b> <a href="AliasAnalysis_8h_source.html#l00294">AliasAnalysis.h:294</a></div></div>
<div class="ttc" id="aSmallString_8h_html"><div class="ttname"><a href="SmallString_8h.html">SmallString.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a733fb237f3037c95ed59de6055b176c5a2bc39e3785b29fe7bc4af768842a2072"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a733fb237f3037c95ed59de6055b176c5a2bc39e3785b29fe7bc4af768842a2072">llvm::TargetTransformInfo::OP_None</a></div><div class="ttdeci">@ OP_None</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00939">TargetTransformInfo.h:939</a></div></div>
<div class="ttc" id="aInlineOrder_8cpp_html_a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6"><div class="ttname"><a href="InlineOrder_8cpp.html#a7ee6f0cb51c3b9056199e9a0001fe8c3a20b4f77bd00b4f63a49ec8e08f3bf6a6">InlinePriorityMode::Cost</a></div><div class="ttdeci">@ Cost</div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_af46433d0e36d3f80afc3a8c67b5c53ec"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53ec">llvm::TargetTransformInfo::ShuffleKind</a></div><div class="ttdeci">ShuffleKind</div><div class="ttdoc">The various kinds of shuffle patterns for vector queries.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00910">TargetTransformInfo.h:910</a></div></div>
<div class="ttc" id="aREADME-SSE_8txt_html_ae7fc2fb0e2d536219c1193f1a178e7db"><div class="ttname"><a href="README-SSE_8txt.html#ae7fc2fb0e2d536219c1193f1a178e7db">P2</a></div><div class="ttdeci">This might compile to this xmm1 xorps xmm0 movss xmm0 ret Now consider if the code caused xmm1 to get spilled This might produce this xmm1 movaps xmm0 movaps xmm1 movss xmm0 ret since the reload is only used by these we could fold it into the producing something like xmm1 movaps xmm0 ret saving two instructions The basic idea is that a reload from a spill if only one byte chunk is bring in zeros the one element instead of elements This can be used to simplify a variety of shuffle where the elements are fixed zeros This code generates ugly probably due to costs being off or&lt; 4 x float &gt; * P2</div><div class="ttdef"><b>Definition:</b> <a href="README-SSE_8txt_source.html#l00278">README-SSE.txt:278</a></div></div>
<div class="ttc" id="aBuiltinGCs_8cpp_html_a6742d2e0a668baf1196ec69e158d5f15"><div class="ttname"><a href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a></div><div class="ttdeci">static GCRegistry::Add&lt; CoreCLRGC &gt; E(&quot;coreclr&quot;, &quot;CoreCLR-compatible GC&quot;)</div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_ae3295545af0d12ee89d3102df3d45b06"><div class="ttname"><a href="SLPVectorizer_8cpp.html#ae3295545af0d12ee89d3102df3d45b06">SLPCostThreshold</a></div><div class="ttdeci">static cl::opt&lt; int &gt; SLPCostThreshold(&quot;slp-threshold&quot;, cl::init(0), cl::Hidden, cl::desc(&quot;Only vectorize if you gain more than this &quot; &quot;number &quot;))</div></div>
<div class="ttc" id="anamespacellvm_html_aeb65ce026673a69aac75e5a7a26007b3"><div class="ttname"><a href="namespacellvm.html#aeb65ce026673a69aac75e5a7a26007b3">llvm::isTriviallyVectorizable</a></div><div class="ttdeci">bool isTriviallyVectorizable(Intrinsic::ID ID)</div><div class="ttdoc">Identify if the intrinsic is trivially vectorizable.</div><div class="ttdef"><b>Definition:</b> <a href="VectorUtils_8cpp_source.html#l00044">VectorUtils.cpp:44</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_ae44dffe81e5d4e6584fc647153353e3c"><div class="ttname"><a href="SLPVectorizer_8cpp.html#ae44dffe81e5d4e6584fc647153353e3c">ShouldVectorizeHor</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; ShouldVectorizeHor(&quot;slp-vectorize-hor&quot;, cl::init(true), cl::Hidden, cl::desc(&quot;Attempt to vectorize horizontal reductions&quot;))</div></div>
<div class="ttc" id="anamespacellvm_1_1codeview_html_adea5cfab927f82e2664c69c86f8f572faffb12d1a144101cc60187107b298897d"><div class="ttname"><a href="namespacellvm_1_1codeview.html#adea5cfab927f82e2664c69c86f8f572faffb12d1a144101cc60187107b298897d">llvm::codeview::ExportFlags::IsConstant</a></div><div class="ttdeci">@ IsConstant</div></div>
<div class="ttc" id="aclassllvm_1_1User_html"><div class="ttname"><a href="classllvm_1_1User.html">llvm::User</a></div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00044">User.h:44</a></div></div>
<div class="ttc" id="aIntrinsics_8h_html"><div class="ttname"><a href="Intrinsics_8h.html">Intrinsics.h</a></div></div>
<div class="ttc" id="aREADME__ALTIVEC_8txt_html_a9aacd9146afe44bf656cd664e2a88c8c"><div class="ttname"><a href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a></div><div class="ttdeci">(vector float) vec_cmpeq(*A, *B) C</div><div class="ttdef"><b>Definition:</b> <a href="README__ALTIVEC_8txt_source.html#l00086">README_ALTIVEC.txt:86</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_ae37b3a41d982a793664ab021d9b9b325"><div class="ttname"><a href="SLPVectorizer_8cpp.html#ae37b3a41d982a793664ab021d9b9b325">getSameOpcode</a></div><div class="ttdeci">static InstructionsState getSameOpcode(ArrayRef&lt; Value * &gt; VL, const TargetLibraryInfo &amp;TLI, unsigned BaseIndex=0)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00635">SLPVectorizer.cpp:635</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a2be3583dac92a031fa1458d4d992c78bad92f160316221fd4090520bb2b3cefc5"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78bad92f160316221fd4090520bb2b3cefc5">llvm::CmpInst::ICMP_ULE</a></div><div class="ttdeci">@ ICMP_ULE</div><div class="ttdoc">unsigned less or equal</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00744">InstrTypes.h:744</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ARM__PROC_html_aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5"><div class="ttname"><a href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">llvm::ARM_PROC::A</a></div><div class="ttdeci">@ A</div><div class="ttdef"><b>Definition:</b> <a href="MCTargetDesc_2ARMBaseInfo_8h_source.html#l00034">ARMBaseInfo.h:34</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a6ef5b86735d738868e5fb00a18643b1c"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a6ef5b86735d738868e5fb00a18643b1c">isSplat</a></div><div class="ttdeci">static bool isSplat(ArrayRef&lt; Value * &gt; VL)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00260">SLPVectorizer.cpp:260</a></div></div>
<div class="ttc" id="aInstrTypes_8h_html"><div class="ttname"><a href="InstrTypes_8h.html">InstrTypes.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands_html_aae56f63ba0ddbe1875b6c76a27abbee8"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#aae56f63ba0ddbe1875b6c76a27abbee8">llvm::slpvectorizer::BoUpSLP::VLOperands::operator&lt;&lt;</a></div><div class="ttdeci">friend raw_ostream &amp; operator&lt;&lt;(raw_ostream &amp;OS, ReorderingMode RMode)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l02154">SLPVectorizer.cpp:2154</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_a83b8c9e572130f403445c0b0f69b837c"><div class="ttname"><a href="classllvm_1_1CallBase.html#a83b8c9e572130f403445c0b0f69b837c">llvm::CallBase::getCalledFunction</a></div><div class="ttdeci">Function * getCalledFunction() const</div><div class="ttdoc">Returns the function called, or null if this is an indirect function invocation or the function signa...</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01406">InstrTypes.h:1406</a></div></div>
<div class="ttc" id="alib_2Target_2README_8txt_html_a3217063f680fa8e35dea3c59b6e52b18"><div class="ttname"><a href="lib_2Target_2README_8txt.html#a3217063f680fa8e35dea3c59b6e52b18">int</a></div><div class="ttdeci">Clang compiles this i1 i64 store i64 i64 store i64 i64 store i64 i64 store i64 align Which gets codegen d xmm0 movaps rbp movaps rbp movaps rbp movaps rbp rbp rbp rbp rbp It would be better to have movq s of instead of the movaps s LLVM produces ret int</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2README_8txt_source.html#l00536">README.txt:536</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a91bbc1ac424839ba7e85d2d8542c288a"><div class="ttname"><a href="classllvm_1_1Type.html#a91bbc1ac424839ba7e85d2d8542c288a">llvm::Type::print</a></div><div class="ttdeci">void print(raw_ostream &amp;O, bool IsForDebug=false, bool NoDetails=false) const</div><div class="ttdoc">Print the current type.</div><div class="ttdef"><b>Definition:</b> <a href="AsmWriter_8cpp_source.html#l04673">AsmWriter.cpp:4673</a></div></div>
<div class="ttc" id="aOcamlGCPrinter_8cpp_html_afcf2f797ed287a723263583c9b1c1bce"><div class="ttname"><a href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a></div><div class="ttdeci">static GCMetadataPrinterRegistry::Add&lt; OcamlGCMetadataPrinter &gt; Y(&quot;ocaml&quot;, &quot;ocaml 3.10-compatible collector&quot;)</div></div>
<div class="ttc" id="aSIInstrInfo_8cpp_html_a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791"><div class="ttname"><a href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a></div><div class="ttdeci">@ SI</div><div class="ttdef"><b>Definition:</b> <a href="SIInstrInfo_8cpp_source.html#l07993">SIInstrInfo.cpp:7993</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisUsage_html"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html">llvm::AnalysisUsage</a></div><div class="ttdoc">Represent the analysis usage information of a pass.</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00047">PassAnalysisSupport.h:47</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_ad67b7e389a52ada1d5264e23d09f4cbe"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#ad67b7e389a52ada1d5264e23d09f4cbe">llvm::TargetTransformInfo::getNumberOfParts</a></div><div class="ttdeci">unsigned getNumberOfParts(Type *Tp) const</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00999">TargetTransformInfo.cpp:999</a></div></div>
<div class="ttc" id="aclassllvm_1_1RecurrenceDescriptor_html_a32c8ad694911bf6dcf6cb07824f2823e"><div class="ttname"><a href="classllvm_1_1RecurrenceDescriptor.html#a32c8ad694911bf6dcf6cb07824f2823e">llvm::RecurrenceDescriptor::getOpcode</a></div><div class="ttdeci">unsigned getOpcode() const</div><div class="ttdef"><b>Definition:</b> <a href="IVDescriptors_8h_source.html#l00200">IVDescriptors.h:200</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1PALMD_html_af892c75285b0f64d58ca76cb73059adf"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1PALMD.html#af892c75285b0f64d58ca76cb73059adf">llvm::AMDGPU::PALMD::Key</a></div><div class="ttdeci">Key</div><div class="ttdoc">PAL metadata keys.</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUMetadata_8h_source.html#l00486">AMDGPUMetadata.h:486</a></div></div>
<div class="ttc" id="aTargetLibraryInfo_8h_html"><div class="ttname"><a href="TargetLibraryInfo_8h.html">TargetLibraryInfo.h</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_af6afa6e00a2ef98815dd54413ab32fe2"><div class="ttname"><a href="SLPVectorizer_8cpp.html#af6afa6e00a2ef98815dd54413ab32fe2">getVectorCallCosts</a></div><div class="ttdeci">static std::pair&lt; InstructionCost, InstructionCost &gt; getVectorCallCosts(CallInst *CI, FixedVectorType *VecTy, TargetTransformInfo *TTI, TargetLibraryInfo *TLI)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l06082">SLPVectorizer.cpp:6082</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a04353aa48874f9bda89ff9059cd1a5a6"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a04353aa48874f9bda89ff9059cd1a5a6">llvm::PatternMatch::m_Instruction</a></div><div class="ttdeci">bind_ty&lt; Instruction &gt; m_Instruction(Instruction *&amp;I)</div><div class="ttdoc">Match an instruction, capturing it if we match.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00716">PatternMatch.h:716</a></div></div>
<div class="ttc" id="aclassllvm_1_1InsertElementInst_html"><div class="ttname"><a href="classllvm_1_1InsertElementInst.html">llvm::InsertElementInst</a></div><div class="ttdoc">This instruction inserts a single (scalar) element into a VectorType value.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01945">Instructions.h:1945</a></div></div>
<div class="ttc" id="anamespacellvm_1_1SPII_html_a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856"><div class="ttname"><a href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">llvm::SPII::Store</a></div><div class="ttdeci">@ Store</div><div class="ttdef"><b>Definition:</b> <a href="SparcInstrInfo_8h_source.html#l00033">SparcInstrInfo.h:33</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_aecb93439702247fe5353a9966f7cefcd"><div class="ttname"><a href="classllvm_1_1Value.html#aecb93439702247fe5353a9966f7cefcd">llvm::Value::uses</a></div><div class="ttdeci">iterator_range&lt; use_iterator &gt; uses()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00376">Value.h:376</a></div></div>
<div class="ttc" id="aDenseSet_8h_html"><div class="ttname"><a href="DenseSet_8h.html">DenseSet.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_html_adef9fad96a0d90c56a892520edbdb749"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#adef9fad96a0d90c56a892520edbdb749">llvm::slpvectorizer::BoUpSLP::isVectorized</a></div><div class="ttdeci">bool isVectorized(Value *V) const</div><div class="ttdoc">Check if the value is vectorized in the tree.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l02247">SLPVectorizer.cpp:2247</a></div></div>
<div class="ttc" id="anamespacefalse_html"><div class="ttname"><a href="namespacefalse.html">false</a></div><div class="ttdef"><b>Definition:</b> <a href="StackSlotColoring_8cpp_source.html#l00141">StackSlotColoring.cpp:141</a></div></div>
<div class="ttc" id="anamespacellvm_1_1dwarf_html_a5d3c920b66ea797d6adb243862fdf47a"><div class="ttname"><a href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">llvm::dwarf::Index</a></div><div class="ttdeci">Index</div><div class="ttdef"><b>Definition:</b> <a href="Dwarf_8h_source.html#l00550">Dwarf.h:550</a></div></div>
<div class="ttc" id="anamespacellvm_html_ad9be86c95736bfa4bb0dc52322a0002a"><div class="ttname"><a href="namespacellvm.html#ad9be86c95736bfa4bb0dc52322a0002a">llvm::alignDown</a></div><div class="ttdeci">uint64_t alignDown(uint64_t Value, uint64_t Align, uint64_t Skew=0)</div><div class="ttdoc">Returns the largest uint64_t less than or equal to Value and is Skew mod Align.</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00533">MathExtras.h:533</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a2cbdca7c8267aac6914d674f8e81841b"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a2cbdca7c8267aac6914d674f8e81841b">llvm::PatternMatch::m_ZExt</a></div><div class="ttdeci">CastClass_match&lt; OpTy, Instruction::ZExt &gt; m_ZExt(const OpTy &amp;Op)</div><div class="ttdoc">Matches ZExt.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01629">PatternMatch.h:1629</a></div></div>
<div class="ttc" id="aBuiltinGCs_8cpp_html_a7abf5fb4071cb25dbce06dfb5ee3c937"><div class="ttname"><a href="BuiltinGCs_8cpp.html#a7abf5fb4071cb25dbce06dfb5ee3c937">B</a></div><div class="ttdeci">static GCRegistry::Add&lt; OcamlGC &gt; B(&quot;ocaml&quot;, &quot;ocaml 3.10-compatible GC&quot;)</div></div>
<div class="ttc" id="aclassllvm_1_1SmallBitVector_html_a8cfcd92a373cdd7deefb939dd76b83e3"><div class="ttname"><a href="classllvm_1_1SmallBitVector.html#a8cfcd92a373cdd7deefb939dd76b83e3">llvm::SmallBitVector::all</a></div><div class="ttdeci">bool all() const</div><div class="ttdoc">Returns true if all bits are set.</div><div class="ttdef"><b>Definition:</b> <a href="SmallBitVector_8h_source.html#l00216">SmallBitVector.h:216</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a4a6ca5a5b87bd84231be9d8dbec46c1a"><div class="ttname"><a href="classllvm_1_1Value.html#a4a6ca5a5b87bd84231be9d8dbec46c1a">llvm::Value::getValueID</a></div><div class="ttdeci">unsigned getValueID() const</div><div class="ttdoc">Return an ID for the concrete type of this object.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00532">Value.h:532</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_adfb61ffe25c950c75c86310245b3ef39"><div class="ttname"><a href="classllvm_1_1PHINode.html#adfb61ffe25c950c75c86310245b3ef39">llvm::PHINode::getIncomingValueForBlock</a></div><div class="ttdeci">Value * getIncomingValueForBlock(const BasicBlock *BB) const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02889">Instructions.h:2889</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_afa0b2fa29ba074f2b6ec9ac11163f2d9"><div class="ttname"><a href="classllvm_1_1Instruction.html#afa0b2fa29ba074f2b6ec9ac11163f2d9">llvm::Instruction::CastOps</a></div><div class="ttdeci">CastOps</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00823">Instruction.h:823</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a644afe0cf8a4816171b3384098325dc2"><div class="ttname"><a href="classllvm_1_1Instruction.html#a644afe0cf8a4816171b3384098325dc2">llvm::Instruction::classof</a></div><div class="ttdeci">static bool classof(const Value *V)</div><div class="ttdoc">Methods for support type inquiry through isa, cast, and dyn_cast:</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00788">Instruction.h:788</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a677ac8d99ff3c2d32a95c21de9ed372c"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">llvm::PatternMatch::m_ConstantInt</a></div><div class="ttdeci">class_match&lt; ConstantInt &gt; m_ConstantInt()</div><div class="ttdoc">Match an arbitrary ConstantInt and ignore it.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00147">PatternMatch.h:147</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a5ce679c74f9d5aa21d8ea3d1a798f0a9"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a5ce679c74f9d5aa21d8ea3d1a798f0a9">lv_name</a></div><div class="ttdeci">static const char lv_name[]</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l13959">SLPVectorizer.cpp:13959</a></div></div>
<div class="ttc" id="aclassBoUpSLP_1_1ShuffleInstructionBuilder_html"><div class="ttname"><a href="classBoUpSLP_1_1ShuffleInstructionBuilder.html">BoUpSLP::ShuffleInstructionBuilder</a></div><div class="ttdoc">Merges shuffle masks and emits final shuffle instruction, if required.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l08739">SLPVectorizer.cpp:8739</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html"><div class="ttname"><a href="classllvm_1_1Instruction.html">llvm::Instruction</a></div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00041">Instruction.h:41</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_acd356293c4520fc1fb4a83de901e5bb7"><div class="ttname"><a href="SLPVectorizer_8cpp.html#acd356293c4520fc1fb4a83de901e5bb7">fixupOrderingIndices</a></div><div class="ttdeci">static void fixupOrderingIndices(SmallVectorImpl&lt; unsigned &gt; &amp;Order)</div><div class="ttdoc">Order may have elements assigned special value (size) which is out of bounds.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00860">SLPVectorizer.cpp:860</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_adc571425e9aecccf7ebf5fcc3c678d94"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#adc571425e9aecccf7ebf5fcc3c678d94">llvm::PatternMatch::m_UMin</a></div><div class="ttdeci">MaxMin_match&lt; ICmpInst, LHS, RHS, umin_pred_ty &gt; m_UMin(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01871">PatternMatch.h:1871</a></div></div>
<div class="ttc" id="aclassllvm_1_1DominatorTreeWrapperPass_html"><div class="ttname"><a href="classllvm_1_1DominatorTreeWrapperPass.html">llvm::DominatorTreeWrapperPass</a></div><div class="ttdoc">Legacy analysis pass which computes a DominatorTree.</div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00314">Dominators.h:314</a></div></div>
<div class="ttc" id="anamespacellvm_html_a0bf75467957937ad23ad7be19f489934"><div class="ttname"><a href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">llvm::STATISTIC</a></div><div class="ttdeci">STATISTIC(NumFunctions, &quot;Total number of functions&quot;)</div></div>
<div class="ttc" id="aclassllvm_1_1raw__ostream_html"><div class="ttname"><a href="classllvm_1_1raw__ostream.html">llvm::raw_ostream</a></div><div class="ttdoc">This class implements an extremely fast bulk output stream that can only output to a stream.</div><div class="ttdef"><b>Definition:</b> <a href="raw__ostream_8h_source.html#l00052">raw_ostream.h:52</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_ab0da56db6da27340e5a7151a4676106a"><div class="ttname"><a href="SLPVectorizer_8cpp.html#ab0da56db6da27340e5a7151a4676106a">isCommutative</a></div><div class="ttdeci">static bool isCommutative(Instruction *I)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00276">SLPVectorizer.cpp:276</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_ad0b3d8447f88377b62d9c019f3c4e118"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#ad0b3d8447f88377b62d9c019f3c4e118">llvm::SmallVectorImpl::resize</a></div><div class="ttdeci">void resize(size_type N)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00642">SmallVector.h:642</a></div></div>
<div class="ttc" id="anamespacellvm_1_1codeview_html_aa8c11d016a2dd473a4cf0ed1da777f5ea67f23a49a4828b272554feea07834f7d"><div class="ttname"><a href="namespacellvm_1_1codeview.html#aa8c11d016a2dd473a4cf0ed1da777f5ea67f23a49a4828b272554feea07834f7d">llvm::codeview::EncodedFramePtrReg::BasePtr</a></div><div class="ttdeci">@ BasePtr</div></div>
<div class="ttc" id="anamespacellvm_1_1AArch64CC_html_abfa1f7dce576430da99eed57807c7f28aeb67eda6b42e3237bc28fb457347a1cb"><div class="ttname"><a href="namespacellvm_1_1AArch64CC.html#abfa1f7dce576430da99eed57807c7f28aeb67eda6b42e3237bc28fb457347a1cb">llvm::AArch64CC::LE</a></div><div class="ttdeci">@ LE</div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00268">AArch64BaseInfo.h:268</a></div></div>
<div class="ttc" id="aclassllvm_1_1UndefValue_html_a4ae5ff22b700a42bcc5d889233721335"><div class="ttname"><a href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">llvm::UndefValue::get</a></div><div class="ttdeci">static UndefValue * get(Type *T)</div><div class="ttdoc">Static factory methods - Return an 'undef' object of the specified type.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01740">Constants.cpp:1740</a></div></div>
<div class="ttc" id="anamespacellvm_html_a99416758c13252bef45320a6ba6aa09c"><div class="ttname"><a href="namespacellvm.html#a99416758c13252bef45320a6ba6aa09c">llvm::MutableArrayRef</a></div><div class="ttdeci">MutableArrayRef(T &amp;OneElt) -&gt; MutableArrayRef&lt; T &gt;</div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_a969709dd49c28865a482d8b870f87c46"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">llvm::ConstantInt::get</a></div><div class="ttdeci">static Constant * get(Type *Ty, uint64_t V, bool IsSigned=false)</div><div class="ttdoc">If Ty is a vector type, return a Constant with a splat of the given value.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00887">Constants.cpp:887</a></div></div>
<div class="ttc" id="aLoopUtils_8h_html"><div class="ttname"><a href="LoopUtils_8h.html">LoopUtils.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1FunctionType_html_a0400b7a6fcffcd3892d7bb6de435674a"><div class="ttname"><a href="classllvm_1_1FunctionType.html#a0400b7a6fcffcd3892d7bb6de435674a">llvm::FunctionType::params</a></div><div class="ttdeci">ArrayRef&lt; Type * &gt; params() const</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00130">DerivedTypes.h:130</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a1c2af7a9e501d399f06ca7e10eef46e4"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a1c2af7a9e501d399f06ca7e10eef46e4">llvm::BasicBlock::rbegin</a></div><div class="ttdeci">reverse_iterator rbegin()</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00319">BasicBlock.h:319</a></div></div>
<div class="ttc" id="anamespacellvm_html_aac36edd0f1ce976f0025c98e88d3830ea6adf97f83acf6453d4a6a4b1070f3754"><div class="ttname"><a href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea6adf97f83acf6453d4a6a4b1070f3754">llvm::RecurKind::None</a></div><div class="ttdeci">@ None</div><div class="ttdoc">Not a recurrence.</div></div>
<div class="ttc" id="anamespacellvm_html_a3b1c5788b85ffa254be0e834edf5cf8f"><div class="ttname"><a href="namespacellvm.html#a3b1c5788b85ffa254be0e834edf5cf8f">llvm::getUnderlyingObject</a></div><div class="ttdeci">const Value * getUnderlyingObject(const Value *V, unsigned MaxLookup=6)</div><div class="ttdoc">This method strips off any GEP address adjustments and pointer casts from the specified value,...</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l04567">ValueTracking.cpp:4567</a></div></div>
<div class="ttc" id="astructllvm_1_1CodeMetrics_html_a7e174506b52ad46ea1f746a7f727d999"><div class="ttname"><a href="structllvm_1_1CodeMetrics.html#a7e174506b52ad46ea1f746a7f727d999">llvm::CodeMetrics::collectEphemeralValues</a></div><div class="ttdeci">static void collectEphemeralValues(const Loop *L, AssumptionCache *AC, SmallPtrSetImpl&lt; const Value * &gt; &amp;EphValues)</div><div class="ttdoc">Collect a loop's ephemeral values (those used only by an assume or similar intrinsics in the loop).</div><div class="ttdef"><b>Definition:</b> <a href="CodeMetrics_8cpp_source.html#l00070">CodeMetrics.cpp:70</a></div></div>
<div class="ttc" id="aclassllvm_1_1ScalarEvolutionWrapperPass_html"><div class="ttname"><a href="classllvm_1_1ScalarEvolutionWrapperPass.html">llvm::ScalarEvolutionWrapperPass</a></div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8h_source.html#l02249">ScalarEvolution.h:2249</a></div></div>
<div class="ttc" id="aSmallPtrSet_8h_html"><div class="ttname"><a href="SmallPtrSet_8h.html">SmallPtrSet.h</a></div></div>
<div class="ttc" id="astructllvm_1_1CallBase_1_1BundleOpInfo_html"><div class="ttname"><a href="structllvm_1_1CallBase_1_1BundleOpInfo.html">llvm::CallBase::BundleOpInfo</a></div><div class="ttdoc">Used to keep track of an operand bundle.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l02121">InstrTypes.h:2121</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a4062d42b1e96fb8e1936cd8a3c0c086d"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a4062d42b1e96fb8e1936cd8a3c0c086d">MaxVectorRegSizeOption</a></div><div class="ttdeci">static cl::opt&lt; int &gt; MaxVectorRegSizeOption(&quot;slp-max-reg-size&quot;, cl::init(128), cl::Hidden, cl::desc(&quot;Attempt to vectorize for this register size in bits&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_ad848bd0184fc7bcb7b71e19248f08f34"><div class="ttname"><a href="classllvm_1_1Instruction.html#ad848bd0184fc7bcb7b71e19248f08f34">llvm::Instruction::isIdenticalTo</a></div><div class="ttdeci">bool isIdenticalTo(const Instruction *I) const LLVM_READONLY</div><div class="ttdoc">Return true if the specified instruction is exactly identical to the current one.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00552">Instruction.cpp:552</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_a7efd1f0c1206d95e4fe01a9b49a57b82"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a7efd1f0c1206d95e4fe01a9b49a57b82">llvm::SmallVectorImpl::append</a></div><div class="ttdeci">void append(ItTy in_start, ItTy in_end)</div><div class="ttdoc">Add the specified range to the end of the SmallVector.</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00687">SmallVector.h:687</a></div></div>
<div class="ttc" id="astructllvm_1_1VFShape_html"><div class="ttname"><a href="structllvm_1_1VFShape.html">llvm::VFShape</a></div><div class="ttdoc">Contains the information about the kind of vectorization available.</div><div class="ttdef"><b>Definition:</b> <a href="VectorUtils_8h_source.html#l00082">VectorUtils.h:82</a></div></div>
<div class="ttc" id="aPatternMatch_8h_html"><div class="ttname"><a href="PatternMatch_8h.html">PatternMatch.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a46ef6115027606b67adcf4d28f3dac17"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a46ef6115027606b67adcf4d28f3dac17">llvm::BasicBlock::getFirstNonPHI</a></div><div class="ttdeci">const Instruction * getFirstNonPHI() const</div><div class="ttdoc">Returns a pointer to the first instruction in this block that is not a PHINode instruction.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00208">BasicBlock.cpp:208</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a8bb3b1ccf19b8c85429b777dfa4a0166a183020fbea95c99db23f6d3594f4c4af"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a8bb3b1ccf19b8c85429b777dfa4a0166a183020fbea95c99db23f6d3594f4c4af">llvm::TargetTransformInfo::RGK_FixedWidthVector</a></div><div class="ttdeci">@ RGK_FixedWidthVector</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00988">TargetTransformInfo.h:988</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a8379baf67781195103cce560febc792e"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a8379baf67781195103cce560febc792e">getInsertIndex</a></div><div class="ttdeci">static std::optional&lt; unsigned &gt; getInsertIndex(const Value *InsertInst, unsigned Offset=0)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00289">SLPVectorizer.cpp:289</a></div></div>
<div class="ttc" id="aclassllvm_1_1FixedVectorType_html_af9a870d5df50fe0133a410b7c9114c80"><div class="ttname"><a href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">llvm::FixedVectorType::get</a></div><div class="ttdeci">static FixedVectorType * get(Type *ElementType, unsigned NumElts)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00686">Type.cpp:686</a></div></div>
<div class="ttc" id="astructllvm_1_1Align_html"><div class="ttname"><a href="structllvm_1_1Align.html">llvm::Align</a></div><div class="ttdoc">This struct is a compact representation of a valid (non-zero power of two) alignment.</div><div class="ttdef"><b>Definition:</b> <a href="Alignment_8h_source.html#l00039">Alignment.h:39</a></div></div>
<div class="ttc" id="anamespacellvm_1_1MCID_html_ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f"><div class="ttname"><a href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">llvm::MCID::Call</a></div><div class="ttdeci">@ Call</div><div class="ttdef"><b>Definition:</b> <a href="MCInstrDesc_8h_source.html#l00156">MCInstrDesc.h:156</a></div></div>
<div class="ttc" id="anamespacellvm_1_1NVPTX_1_1PTXLdStInstCode_html_a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217"><div class="ttname"><a href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">llvm::NVPTX::PTXLdStInstCode::Scalar</a></div><div class="ttdeci">@ Scalar</div><div class="ttdef"><b>Definition:</b> <a href="NVPTX_8h_source.html#l00123">NVPTX.h:123</a></div></div>
<div class="ttc" id="aIVDescriptors_8h_html"><div class="ttname"><a href="IVDescriptors_8h.html">IVDescriptors.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html_aaf9ee38b9973681c1720aaf03af3a069"><div class="ttname"><a href="classllvm_1_1SetVector.html#aaf9ee38b9973681c1720aaf03af3a069">llvm::SetVector::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdoc">Determine if the SetVector is empty or not.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00072">SetVector.h:72</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_af9c2825ab53adf1bf8c9fa19ec89d986"><div class="ttname"><a href="classllvm_1_1Instruction.html#af9c2825ab53adf1bf8c9fa19ec89d986">llvm::Instruction::isIntDivRem</a></div><div class="ttdeci">bool isIntDivRem() const</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00174">Instruction.h:174</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands_html_aef7ceb8ccf02838b7d935dcfcf3a7fcc"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#aef7ceb8ccf02838b7d935dcfcf3a7fcc">llvm::slpvectorizer::BoUpSLP::VLOperands::printMode</a></div><div class="ttdeci">static LLVM_DUMP_METHOD raw_ostream &amp; printMode(ReorderingMode RMode, raw_ostream &amp;OS)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l02144">SLPVectorizer.cpp:2144</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html_ace7bdce94e806bb8870626657630dab0"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#ace7bdce94e806bb8870626657630dab0">llvm::ArrayRef::slice</a></div><div class="ttdeci">ArrayRef&lt; T &gt; slice(size_t N, size_t M) const</div><div class="ttdoc">slice(n, m) - Chop off the first N elements of the array, and keep M elements in the array.</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00193">ArrayRef.h:193</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_aef51af4b490af6b3bf2dfbc8737a8f9f"><div class="ttname"><a href="classllvm_1_1PHINode.html#aef51af4b490af6b3bf2dfbc8737a8f9f">llvm::PHINode::getNumIncomingValues</a></div><div class="ttdeci">unsigned getNumIncomingValues() const</div><div class="ttdoc">Return the number of incoming edges.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02790">Instructions.h:2790</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a13e877ef779ba7a0688081079f4f9b03"><div class="ttname"><a href="classllvm_1_1Type.html#a13e877ef779ba7a0688081079f4f9b03">llvm::Type::getIntegerBitWidth</a></div><div class="ttdeci">unsigned getIntegerBitWidth() const</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00097">DerivedTypes.h:97</a></div></div>
<div class="ttc" id="aclassBoUpSLP_1_1ShuffleInstructionBuilder_html_ae071f05fc43a0d7c6b2d4984f9aefe9b"><div class="ttname"><a href="classBoUpSLP_1_1ShuffleInstructionBuilder.html#ae071f05fc43a0d7c6b2d4984f9aefe9b">BoUpSLP::ShuffleInstructionBuilder::add</a></div><div class="ttdeci">void add(Value *V1, ArrayRef&lt; int &gt; Mask)</div><div class="ttdoc">Adds another one input vector and the mask for the shuffling.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l08869">SLPVectorizer.cpp:8869</a></div></div>
<div class="ttc" id="anamespacellvm_1_1CallingConv_html_a188c0836f8c3528401f1c236fd93b977"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">llvm::CallingConv::ID</a></div><div class="ttdeci">unsigned ID</div><div class="ttdoc">LLVM IR allows to use arbitrary numbers as calling convention identifiers.</div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00024">CallingConv.h:24</a></div></div>
<div class="ttc" id="anamespacellvm_html_aa82bb12b2879425012b3742487e10964"><div class="ttname"><a href="namespacellvm.html#aa82bb12b2879425012b3742487e10964">llvm::erase_value</a></div><div class="ttdeci">void erase_value(Container &amp;C, ValueType V)</div><div class="ttdoc">Wrapper function to remove a value from a container:</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l02006">STLExtras.h:2006</a></div></div>
<div class="ttc" id="aType_8h_html"><div class="ttname"><a href="Type_8h.html">Type.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1IntrinsicCostAttributes_html"><div class="ttname"><a href="classllvm_1_1IntrinsicCostAttributes.html">llvm::IntrinsicCostAttributes</a></div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00119">TargetTransformInfo.h:119</a></div></div>
<div class="ttc" id="astructllvm_1_1Loop_1_1LoopBounds_html_a1c06ad0290f168148c08edc0ce69703f"><div class="ttname"><a href="structllvm_1_1Loop_1_1LoopBounds.html#a1c06ad0290f168148c08edc0ce69703f">llvm::Loop::LoopBounds::Direction</a></div><div class="ttdeci">Direction</div><div class="ttdoc">An enum for the direction of the loop.</div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l00723">LoopInfo.h:723</a></div></div>
<div class="ttc" id="aErlangGCPrinter_8cpp_html_a74b474c0616ab55c1d9487f11fd31d26"><div class="ttname"><a href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a></div><div class="ttdeci">static GCMetadataPrinterRegistry::Add&lt; ErlangGCPrinter &gt; X(&quot;erlang&quot;, &quot;erlang-compatible garbage collector&quot;)</div></div>
<div class="ttc" id="anamespacellvm_1_1omp_html_a16d7c5f77008a84ae20bf4a5c41e51f0ae88b4464fe326a51e6e6dfae28dd536d"><div class="ttname"><a href="namespacellvm_1_1omp.html#a16d7c5f77008a84ae20bf4a5c41e51f0ae88b4464fe326a51e6e6dfae28dd536d">llvm::omp::RTLDependInfoFields::Len</a></div><div class="ttdeci">@ Len</div></div>
<div class="ttc" id="aclassllvm_1_1SmallString_html"><div class="ttname"><a href="classllvm_1_1SmallString.html">llvm::SmallString&lt; 256 &gt;</a></div></div>
<div class="ttc" id="aPassSupport_8h_html_a74ce8276b89067e806f67c45a6d92575"><div class="ttname"><a href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a></div><div class="ttdeci">#define INITIALIZE_PASS_END(passName, arg, name, cfg, analysis)</div><div class="ttdef"><b>Definition:</b> <a href="PassSupport_8h_source.html#l00059">PassSupport.h:59</a></div></div>
<div class="ttc" id="anamespacellvm_html_aac36edd0f1ce976f0025c98e88d3830ea1c692ed4bf463fb08fca4d8cb8201ac0"><div class="ttname"><a href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea1c692ed4bf463fb08fca4d8cb8201ac0">llvm::RecurKind::UMin</a></div><div class="ttdeci">@ UMin</div><div class="ttdoc">Unisgned integer min implemented in terms of select(cmp()).</div></div>
<div class="ttc" id="anamespacellvm_html_a636de400e4dd2bc090b729329a99e75b"><div class="ttname"><a href="namespacellvm.html#a636de400e4dd2bc090b729329a99e75b">llvm::maxnum</a></div><div class="ttdeci">LLVM_READONLY APFloat maxnum(const APFloat &amp;A, const APFloat &amp;B)</div><div class="ttdoc">Implements IEEE maxNum semantics.</div><div class="ttdef"><b>Definition:</b> <a href="APFloat_8h_source.html#l01357">APFloat.h:1357</a></div></div>
<div class="ttc" id="aLoopInfo_8h_html"><div class="ttname"><a href="LoopInfo_8h.html">LoopInfo.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1PriorityQueue_html"><div class="ttname"><a href="classllvm_1_1PriorityQueue.html">llvm::PriorityQueue</a></div><div class="ttdoc">PriorityQueue - This class behaves like std::priority_queue and provides a few additional convenience...</div><div class="ttdef"><b>Definition:</b> <a href="PriorityQueue_8h_source.html#l00028">PriorityQueue.h:28</a></div></div>
<div class="ttc" id="astructllvm_1_1DOTGraphTraits_html"><div class="ttname"><a href="structllvm_1_1DOTGraphTraits.html">llvm::DOTGraphTraits</a></div><div class="ttdoc">DOTGraphTraits - Template class that can be specialized to customize how graphs are converted to 'dot...</div><div class="ttdef"><b>Definition:</b> <a href="DOTGraphTraits_8h_source.html#l00166">DOTGraphTraits.h:166</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_adf0290c7c322f0bf8b275d6b26410b52"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#adf0290c7c322f0bf8b275d6b26410b52">llvm::PatternMatch::m_ExtractElt</a></div><div class="ttdeci">TwoOps_match&lt; Val_t, Idx_t, Instruction::ExtractElement &gt; m_ExtractElt(const Val_t &amp;Val, const Idx_t &amp;Idx)</div><div class="ttdoc">Matches ExtractElementInst.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01492">PatternMatch.h:1492</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a2acd0e4598d1a9c34a8f2d9c9f98aaca"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a2acd0e4598d1a9c34a8f2d9c9f98aaca">needToScheduleSingleInstruction</a></div><div class="ttdeci">static bool needToScheduleSingleInstruction(ArrayRef&lt; Value * &gt; VL)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l04870">SLPVectorizer.cpp:4870</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_html_aef776c88ca6591ad28a6f21f216f1ef7"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#aef776c88ca6591ad28a6f21f216f1ef7">llvm::slpvectorizer::BoUpSLP::getMinVecRegSize</a></div><div class="ttdeci">unsigned getMinVecRegSize() const</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l01124">SLPVectorizer.cpp:1124</a></div></div>
<div class="ttc" id="aMIRNamerPass_8cpp_html_a05e4be4ec3e2c3587dda0e376bb6822c"><div class="ttname"><a href="MIRNamerPass_8cpp.html#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a></div><div class="ttdeci">mir Rename Register Operands</div><div class="ttdef"><b>Definition:</b> <a href="MIRNamerPass_8cpp_source.html#l00074">MIRNamerPass.cpp:74</a></div></div>
<div class="ttc" id="aADT_2tmp_8txt_html_a07ed0bfaa124c15897944fe3eaa971ab"><div class="ttname"><a href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a></div><div class="ttdeci">Class for arbitrary precision integers APInt is a functional replacement for common case unsigned integer type like unsigned long or uint64_t</div><div class="ttdef"><b>Definition:</b> <a href="ADT_2tmp_8txt_source.html#l00001">tmp.txt:1</a></div></div>
<div class="ttc" id="aclassllvm_1_1FastMathFlags_html_a871def72ec0294092d71c3370c70228e"><div class="ttname"><a href="classllvm_1_1FastMathFlags.html#a871def72ec0294092d71c3370c70228e">llvm::FastMathFlags::set</a></div><div class="ttdeci">void set()</div><div class="ttdef"><b>Definition:</b> <a href="FMF_8h_source.html#l00063">FMF.h:63</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ARM__PROC_html_a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e"><div class="ttname"><a href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">llvm::ARM_PROC::IE</a></div><div class="ttdeci">@ IE</div><div class="ttdef"><b>Definition:</b> <a href="MCTargetDesc_2ARMBaseInfo_8h_source.html#l00027">ARMBaseInfo.h:27</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a58e54adaa7672bbf72091254a5391137"><div class="ttname"><a href="classllvm_1_1Type.html#a58e54adaa7672bbf72091254a5391137">llvm::Type::getStructNumElements</a></div><div class="ttdeci">unsigned getStructNumElements() const</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00348">DerivedTypes.h:348</a></div></div>
<div class="ttc" id="aclassllvm_1_1ScalarEvolution_html_a30bd18ac905eacf3601bc6a553a9ff49"><div class="ttname"><a href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">llvm::ScalarEvolution::getSCEV</a></div><div class="ttdeci">const SCEV * getSCEV(Value *V)</div><div class="ttdoc">Return a SCEV expression for the full generality of the specified expression.</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8cpp_source.html#l04534">ScalarEvolution.cpp:4534</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html"><div class="ttname"><a href="classllvm_1_1CmpInst.html">llvm::CmpInst</a></div><div class="ttdoc">This class is the base class for the comparison instructions.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00708">InstrTypes.h:708</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a8b409af081b7132c139c0bdc22c5cefd"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a8b409af081b7132c139c0bdc22c5cefd">isFixedVectorShuffle</a></div><div class="ttdeci">static std::optional&lt; TargetTransformInfo::ShuffleKind &gt; isFixedVectorShuffle(ArrayRef&lt; Value * &gt; VL, SmallVectorImpl&lt; int &gt; &amp;Mask)</div><div class="ttdoc">Checks if the vector of instructions can be represented as a shuffle, like: x0 = extractelement &lt;4 x ...</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00450">SLPVectorizer.cpp:450</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a82e2ea7f0ab67e33e22b3a2a188feaba"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a82e2ea7f0ab67e33e22b3a2a188feaba">llvm::PatternMatch::m_Xor</a></div><div class="ttdeci">BinaryOp_match&lt; LHS, RHS, Instruction::Xor &gt; m_Xor(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01105">PatternMatch.h:1105</a></div></div>
<div class="ttc" id="anamespacellvm_html_a74cdbd1e4f731e7d7cd83461b8b1de0b"><div class="ttname"><a href="namespacellvm.html#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a></div><div class="ttdeci">void sort(IteratorTy Start, IteratorTy End)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01683">STLExtras.h:1683</a></div></div>
<div class="ttc" id="aclassllvm_1_1function__ref_html"><div class="ttname"><a href="classllvm_1_1function__ref.html">llvm::function_ref</a></div><div class="ttdoc">An efficient, type-erasing, non-owning reference to a callable.</div><div class="ttdef"><b>Definition:</b> <a href="STLFunctionalExtras_8h_source.html#l00036">STLFunctionalExtras.h:36</a></div></div>
<div class="ttc" id="aclassllvm_1_1ShuffleVectorInst_html_a6659bba6a4be5e7102bdb10e5fc3658c"><div class="ttname"><a href="classllvm_1_1ShuffleVectorInst.html#a6659bba6a4be5e7102bdb10e5fc3658c">llvm::ShuffleVectorInst::isOneUseSingleSourceMask</a></div><div class="ttdeci">static bool isOneUseSingleSourceMask(ArrayRef&lt; int &gt; Mask, int VF)</div><div class="ttdoc">Return true if this shuffle mask represents &quot;clustered&quot; mask of size VF, i.e.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l02684">Instructions.cpp:2684</a></div></div>
<div class="ttc" id="aclassllvm_1_1VectorType_html_a071e25c5c6eae5299b1cdc3350c6d55c"><div class="ttname"><a href="classllvm_1_1VectorType.html#a071e25c5c6eae5299b1cdc3350c6d55c">llvm::VectorType::isValidElementType</a></div><div class="ttdeci">static bool isValidElementType(Type *ElemTy)</div><div class="ttdoc">Return true if the specified type is valid as a element type.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00677">Type.cpp:677</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImplBase_html_af8a50544090e81ac83601aff8f4b0142"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImplBase.html#af8a50544090e81ac83601aff8f4b0142">llvm::SmallPtrSetImplBase::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00092">SmallPtrSet.h:92</a></div></div>
<div class="ttc" id="aclassllvm_1_1VectorType_html"><div class="ttname"><a href="classllvm_1_1VectorType.html">llvm::VectorType</a></div><div class="ttdoc">Base class of all SIMD vector types.</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00389">DerivedTypes.h:389</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseSet_html"><div class="ttname"><a href="classllvm_1_1DenseSet.html">llvm::DenseSet&lt; Instruction * &gt;</a></div></div>
<div class="ttc" id="anamespacellvm_1_1tgtok_html_abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac"><div class="ttname"><a href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">llvm::tgtok::In</a></div><div class="ttdeci">@ In</div><div class="ttdef"><b>Definition:</b> <a href="TGLexer_8h_source.html#l00051">TGLexer.h:51</a></div></div>
<div class="ttc" id="anamespacellvm_html_a64ac0fc718d697dc3cb861e36b1c591a"><div class="ttname"><a href="namespacellvm.html#a64ac0fc718d697dc3cb861e36b1c591a">llvm::wouldInstructionBeTriviallyDead</a></div><div class="ttdeci">bool wouldInstructionBeTriviallyDead(Instruction *I, const TargetLibraryInfo *TLI=nullptr)</div><div class="ttdoc">Return true if the result produced by the instruction would have no side effects if it was not used.</div><div class="ttdef"><b>Definition:</b> <a href="Transforms_2Utils_2Local_8cpp_source.html#l00417">Local.cpp:417</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_afb636ad432c97f9178ff3f966e93d819"><div class="ttname"><a href="SLPVectorizer_8cpp.html#afb636ad432c97f9178ff3f966e93d819">isAlternateInstruction</a></div><div class="ttdeci">static bool isAlternateInstruction(const Instruction *I, const Instruction *MainOp, const Instruction *AltOp, const TargetLibraryInfo &amp;TLI)</div><div class="ttdoc">Checks if the specified instruction I is an alternate operation for the given MainOp and AltOp instru...</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l06214">SLPVectorizer.cpp:6214</a></div></div>
<div class="ttc" id="aVectorUtils_8h_html"><div class="ttname"><a href="VectorUtils_8h.html">VectorUtils.h</a></div></div>
<div class="ttc" id="aBasicBlock_8h_html"><div class="ttname"><a href="BasicBlock_8h.html">BasicBlock.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1cl_1_1opt_html"><div class="ttname"><a href="classllvm_1_1cl_1_1opt.html">llvm::cl::opt&lt; bool &gt;</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallBitVector_html_a823f7f9343d9bb1e02104ae3b2d3edb9"><div class="ttname"><a href="classllvm_1_1SmallBitVector.html#a823f7f9343d9bb1e02104ae3b2d3edb9">llvm::SmallBitVector::find_next</a></div><div class="ttdeci">int find_next(unsigned Prev) const</div><div class="ttdoc">Returns the index of the next set bit following the &quot;Prev&quot; bit.</div><div class="ttdef"><b>Definition:</b> <a href="SmallBitVector_8h_source.html#l00277">SmallBitVector.h:277</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoadInst_html_a161c2db145827f4e181e7fe662b53a81"><div class="ttname"><a href="classllvm_1_1LoadInst.html#a161c2db145827f4e181e7fe662b53a81">llvm::LoadInst::getPointerAddressSpace</a></div><div class="ttdeci">unsigned getPointerAddressSpace() const</div><div class="ttdoc">Returns the address space of the pointer operand.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00270">Instructions.h:270</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a06f9ac1f9413750e1782f666f635a4ed"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a06f9ac1f9413750e1782f666f635a4ed">canVectorizeLoads</a></div><div class="ttdeci">static LoadsState canVectorizeLoads(ArrayRef&lt; Value * &gt; VL, const Value *VL0, const TargetTransformInfo &amp;TTI, const DataLayout &amp;DL, ScalarEvolution &amp;SE, LoopInfo &amp;LI, const TargetLibraryInfo &amp;TLI, SmallVectorImpl&lt; unsigned &gt; &amp;Order, SmallVectorImpl&lt; Value * &gt; &amp;PointerOps)</div><div class="ttdoc">Checks if the given array of loads can be represented as a vectorized, scatter or just simple gather.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03703">SLPVectorizer.cpp:3703</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a4a37b37137fe1d0888e796e0429d3dc7"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a4a37b37137fe1d0888e796e0429d3dc7">RootLookAheadMaxDepth</a></div><div class="ttdeci">static cl::opt&lt; int &gt; RootLookAheadMaxDepth(&quot;slp-max-root-look-ahead-depth&quot;, cl::init(2), cl::Hidden, cl::desc(&quot;The maximum look-ahead depth for searching best rooting option&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1StoreInst_html"><div class="ttname"><a href="classllvm_1_1StoreInst.html">llvm::StoreInst</a></div><div class="ttdoc">An instruction for storing to memory.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00301">Instructions.h:301</a></div></div>
<div class="ttc" id="astructllvm_1_1DiagnosticInfoOptimizationBase_1_1Argument_html"><div class="ttname"><a href="structllvm_1_1DiagnosticInfoOptimizationBase_1_1Argument.html">llvm::DiagnosticInfoOptimizationBase::Argument</a></div><div class="ttdoc">Used in the streaming interface as the general argument type.</div><div class="ttdef"><b>Definition:</b> <a href="DiagnosticInfo_8h_source.html#l00426">DiagnosticInfo.h:426</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_a7a21e7face454c8ea6c4b9e12b506e40"><div class="ttname"><a href="classllvm_1_1CallBase.html#a7a21e7face454c8ea6c4b9e12b506e40">llvm::CallBase::getBundleOperandsStartIndex</a></div><div class="ttdeci">unsigned getBundleOperandsStartIndex() const</div><div class="ttdoc">Return the index of the first bundle operand in the Use array.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01957">InstrTypes.h:1957</a></div></div>
<div class="ttc" id="aclassBoUpSLP_1_1ShuffleInstructionBuilder_html_a96568e1eeadf54f7ec4b9265c6e98c80"><div class="ttname"><a href="classBoUpSLP_1_1ShuffleInstructionBuilder.html#a96568e1eeadf54f7ec4b9265c6e98c80">BoUpSLP::ShuffleInstructionBuilder::~ShuffleInstructionBuilder</a></div><div class="ttdeci">~ShuffleInstructionBuilder()</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l08957">SLPVectorizer.cpp:8957</a></div></div>
<div class="ttc" id="anamespacellvm_1_1MipsISD_html_a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913"><div class="ttname"><a href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">llvm::MipsISD::Ext</a></div><div class="ttdeci">@ Ext</div><div class="ttdef"><b>Definition:</b> <a href="MipsISelLowering_8h_source.html#l00159">MipsISelLowering.h:159</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_af46433d0e36d3f80afc3a8c67b5c53eca466a4d581cf3a553414b9c2e889b944a"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53eca466a4d581cf3a553414b9c2e889b944a">llvm::TargetTransformInfo::SK_InsertSubvector</a></div><div class="ttdeci">@ SK_InsertSubvector</div><div class="ttdoc">InsertSubvector. Index indicates start offset.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00917">TargetTransformInfo.h:917</a></div></div>
<div class="ttc" id="aSIInstrInfo_8cpp_html_a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd"><div class="ttname"><a href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a97bce951e4585a39601c04d86bb14ffd">VI</a></div><div class="ttdeci">@ VI</div><div class="ttdef"><b>Definition:</b> <a href="SIInstrInfo_8cpp_source.html#l07994">SIInstrInfo.cpp:7994</a></div></div>
<div class="ttc" id="aclassllvm_1_1Constant_html"><div class="ttname"><a href="classllvm_1_1Constant.html">llvm::Constant</a></div><div class="ttdoc">This is an important base class in LLVM.</div><div class="ttdef"><b>Definition:</b> <a href="Constant_8h_source.html#l00041">Constant.h:41</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallSet_html_a2a98f19750ba941ce791b75ca6d77e48"><div class="ttname"><a href="classllvm_1_1SmallSet.html#a2a98f19750ba941ce791b75ca6d77e48">llvm::SmallSet::count</a></div><div class="ttdeci">size_type count(const T &amp;V) const</div><div class="ttdoc">count - Return 1 if the element is in the set, 0 otherwise.</div><div class="ttdef"><b>Definition:</b> <a href="SmallSet_8h_source.html#l00164">SmallSet.h:164</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_aa3ea54a95743867473d32853d3c65603"><div class="ttname"><a href="SLPVectorizer_8cpp.html#aa3ea54a95743867473d32853d3c65603">isValidElementType</a></div><div class="ttdeci">static bool isValidElementType(Type *Ty)</div><div class="ttdoc">Predicate for the element types that the SLP vectorizer supports.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00200">SLPVectorizer.cpp:200</a></div></div>
<div class="ttc" id="aADT_2tmp_8txt_html_aa10ee7493bddf2c751ca6e05451ef410"><div class="ttname"><a href="ADT_2tmp_8txt.html#aa10ee7493bddf2c751ca6e05451ef410">unsigned</a></div><div class="ttdeci">Class for arbitrary precision integers APInt is a functional replacement for common case unsigned integer type like unsigned</div><div class="ttdef"><b>Definition:</b> <a href="ADT_2tmp_8txt_source.html#l00001">tmp.txt:1</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImpl_html_a153ea412ff7a0ba105111155d1e16128"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html#a153ea412ff7a0ba105111155d1e16128">llvm::SmallPtrSetImpl::find</a></div><div class="ttdeci">iterator find(ConstPtrType Ptr) const</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00386">SmallPtrSet.h:386</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a321240b67a372a24d41687f6a2e96877"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a321240b67a372a24d41687f6a2e96877">areCompatibleCmpOps</a></div><div class="ttdeci">static bool areCompatibleCmpOps(Value *BaseOp0, Value *BaseOp1, Value *Op0, Value *Op1, const TargetLibraryInfo &amp;TLI)</div><div class="ttdoc">Checks if the provided operands of 2 cmp instructions are compatible, i.e.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00599">SLPVectorizer.cpp:599</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html_a0b7abf908b6ce436de4d1012f2df7c0c"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#a0b7abf908b6ce436de4d1012f2df7c0c">llvm::ArrayRef::drop_front</a></div><div class="ttdeci">ArrayRef&lt; T &gt; drop_front(size_t N=1) const</div><div class="ttdoc">Drop the first N elements of the array.</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00202">ArrayRef.h:202</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a2bbbb8fefbe682386c09baafff9a7cf1"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a2bbbb8fefbe682386c09baafff9a7cf1">ViewSLPTree</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; ViewSLPTree(&quot;view-slp-tree&quot;, cl::Hidden, cl::desc(&quot;Display the SLP trees with Graphviz&quot;))</div></div>
<div class="ttc" id="astructllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_html_a7ceeff5a65c10abe289db52446ac088a"><div class="ttname"><a href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a7ceeff5a65c10abe289db52446ac088a">llvm::GraphTraits&lt; BoUpSLP * &gt;::TreeEntry</a></div><div class="ttdeci">BoUpSLP::TreeEntry TreeEntry</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03452">SLPVectorizer.cpp:3452</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1Hwreg_html_a6110fc30bc7311a6cf99814530362e21"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1Hwreg.html#a6110fc30bc7311a6cf99814530362e21">llvm::AMDGPU::Hwreg::Offset</a></div><div class="ttdeci">Offset</div><div class="ttdef"><b>Definition:</b> <a href="SIDefines_8h_source.html#l00432">SIDefines.h:432</a></div></div>
<div class="ttc" id="aclassllvm_1_1MapVector_html_a6b0c3e15c351ba9682837c29b0a141b6"><div class="ttname"><a href="classllvm_1_1MapVector.html#a6b0c3e15c351ba9682837c29b0a141b6">llvm::MapVector::find</a></div><div class="ttdeci">iterator find(const KeyT &amp;Key)</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00148">MapVector.h:148</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_adf4e7878fc0b3b8dcde545178564190d"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#adf4e7878fc0b3b8dcde545178564190d">llvm::DenseMapBase&lt; SmallDenseMap&lt; KeyT, ValueT, 4, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00110">DenseMap.h:110</a></div></div>
<div class="ttc" id="astructllvm_1_1DOTGraphTraits_3_01BoUpSLP_01_5_01_4_html_ac476b8b83abaea597007b025fa19a676"><div class="ttname"><a href="structllvm_1_1DOTGraphTraits_3_01BoUpSLP_01_5_01_4.html#ac476b8b83abaea597007b025fa19a676">llvm::DOTGraphTraits&lt; BoUpSLP * &gt;::getNodeAttributes</a></div><div class="ttdeci">static std::string getNodeAttributes(const TreeEntry *Entry, const BoUpSLP *)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03534">SLPVectorizer.cpp:3534</a></div></div>
<div class="ttc" id="anamespacellvm_html_ac2db21413768e904d56a02c26184823d"><div class="ttname"><a href="namespacellvm.html#ac2db21413768e904d56a02c26184823d">llvm::getPointerOperand</a></div><div class="ttdeci">const Value * getPointerOperand(const Value *V)</div><div class="ttdoc">A helper function that returns the pointer operand of a load, store or GEP instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l05377">Instructions.h:5377</a></div></div>
<div class="ttc" id="aELFObjHandler_8cpp_html_aef61945034b9431b804748fc317c5548"><div class="ttname"><a href="ELFObjHandler_8cpp.html#aef61945034b9431b804748fc317c5548">Index</a></div><div class="ttdeci">uint32_t Index</div><div class="ttdef"><b>Definition:</b> <a href="ELFObjHandler_8cpp_source.html#l00083">ELFObjHandler.cpp:83</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_ac612e1575824af0d08b013c8588f5c68"><div class="ttname"><a href="SLPVectorizer_8cpp.html#ac612e1575824af0d08b013c8588f5c68">tryToVectorizeSequence</a></div><div class="ttdeci">static bool tryToVectorizeSequence(SmallVectorImpl&lt; T * &gt; &amp;Incoming, function_ref&lt; unsigned(T *)&gt; Limit, function_ref&lt; bool(T *, T *)&gt; Comparator, function_ref&lt; bool(T *, T *)&gt; AreCompatible, function_ref&lt; bool(ArrayRef&lt; T * &gt;, bool)&gt; TryToVectorizeHelper, bool LimitForRegisterSize)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l13301">SLPVectorizer.cpp:13301</a></div></div>
<div class="ttc" id="anamespacellvm_html_a0b2a153b655ed78a07468297eb4c6256"><div class="ttname"><a href="namespacellvm.html#a0b2a153b655ed78a07468297eb4c6256">llvm::for_each</a></div><div class="ttdeci">UnaryFunction for_each(R &amp;&amp;Range, UnaryFunction F)</div><div class="ttdoc">Provide wrappers to std::for_each which take ranges instead of having to pass begin/end explicitly.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01728">STLExtras.h:1728</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a33ac7704be5bd5455f78caf0b5371012"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a33ac7704be5bd5455f78caf0b5371012">llvm::TargetTransformInfo::isLegalMaskedGather</a></div><div class="ttdeci">bool isLegalMaskedGather(Type *DataType, Align Alignment) const</div><div class="ttdoc">Return true if the target supports masked gather.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00424">TargetTransformInfo.cpp:424</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfoWrapperPass_html"><div class="ttname"><a href="classllvm_1_1TargetTransformInfoWrapperPass.html">llvm::TargetTransformInfoWrapperPass</a></div><div class="ttdoc">Wrapper pass for TargetTransformInfo.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l02682">TargetTransformInfo.h:2682</a></div></div>
<div class="ttc" id="aclassllvm_1_1VFDatabase_html_af9abb14ef675e9dee8dd14bd4dd43aac"><div class="ttname"><a href="classllvm_1_1VFDatabase.html#af9abb14ef675e9dee8dd14bd4dd43aac">llvm::VFDatabase::getMappings</a></div><div class="ttdeci">static SmallVector&lt; VFInfo, 8 &gt; getMappings(const CallInst &amp;CI)</div><div class="ttdoc">Retrieve all the VFInfo instances associated to the CallInst CI.</div><div class="ttdef"><b>Definition:</b> <a href="VectorUtils_8h_source.html#l00265">VectorUtils.h:265</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a1a06b1cff93069d7403ea03e6150e386"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a1a06b1cff93069d7403ea03e6150e386">llvm::PatternMatch::m_LogicalOr</a></div><div class="ttdeci">LogicalOp_match&lt; LHS, RHS, Instruction::Or &gt; m_LogicalOr(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdoc">Matches L || R either in the form of L | R or L ? true : R.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l02574">PatternMatch.h:2574</a></div></div>
<div class="ttc" id="anamespacellvm_html_a086e9fbdb06276db7753101a08a63adf"><div class="ttname"><a href="namespacellvm.html#a086e9fbdb06276db7753101a08a63adf">llvm::find</a></div><div class="ttdeci">auto find(R &amp;&amp;Range, const T &amp;Val)</div><div class="ttdoc">Provide wrappers to std::find which take ranges instead of having to pass begin/end explicitly.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01755">STLExtras.h:1755</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImpl_html_a7004354fbee1c8cd74ed9001915e1db5"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html#a7004354fbee1c8cd74ed9001915e1db5">llvm::SmallPtrSetImpl::end</a></div><div class="ttdeci">iterator end() const</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00408">SmallPtrSet.h:408</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ARM__MB_html_ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2"><div class="ttname"><a href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">llvm::ARM_MB::ST</a></div><div class="ttdeci">@ ST</div><div class="ttdef"><b>Definition:</b> <a href="MCTargetDesc_2ARMBaseInfo_8h_source.html#l00073">ARMBaseInfo.h:73</a></div></div>
<div class="ttc" id="aclassllvm_1_1AssumptionAnalysis_html"><div class="ttname"><a href="classllvm_1_1AssumptionAnalysis.html">llvm::AssumptionAnalysis</a></div><div class="ttdoc">A function analysis which provides an AssumptionCache.</div><div class="ttdef"><b>Definition:</b> <a href="AssumptionCache_8h_source.html#l00173">AssumptionCache.h:173</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics_html_a266c328585c72cd84dc48ef488acef49"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html#a266c328585c72cd84dc48ef488acef49">llvm::slpvectorizer::BoUpSLP::LookAheadHeuristics::getShallowScore</a></div><div class="ttdeci">int getShallowScore(Value *V1, Value *V2, Instruction *U1, Instruction *U2, ArrayRef&lt; Value * &gt; MainAltOps) const</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l01258">SLPVectorizer.cpp:1258</a></div></div>
<div class="ttc" id="aSVEIntrinsicOpts_8cpp_html_a2bb87eb1bcbc74783a83ae945eb8fa36"><div class="ttname"><a href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a></div><div class="ttdeci">INITIALIZE_PASS_DEPENDENCY(DominatorTreeWrapperPass)</div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_afa38851d75434d1476444ac93f94cb4ca76d8855d96b8e66b9411ed74737ca8f7"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#afa38851d75434d1476444ac93f94cb4ca76d8855d96b8e66b9411ed74737ca8f7">llvm::TargetTransformInfo::OK_UniformConstantValue</a></div><div class="ttdeci">@ OK_UniformConstantValue</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00933">TargetTransformInfo.h:933</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a661bd4bd069ee48ef7bf8a7892790468"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a661bd4bd069ee48ef7bf8a7892790468">llvm::TargetTransformInfo::forceScalarizeMaskedGather</a></div><div class="ttdeci">bool forceScalarizeMaskedGather(VectorType *Type, Align Alignment) const</div><div class="ttdoc">Return true if the target forces scalarizing of llvm.masked.gather intrinsics.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00440">TargetTransformInfo.cpp:440</a></div></div>
<div class="ttc" id="anamespacellvm_1_1LegalityPredicates_html_ad7ac7032baa62cc00002886633b9f281"><div class="ttname"><a href="namespacellvm_1_1LegalityPredicates.html#ad7ac7032baa62cc00002886633b9f281">llvm::LegalityPredicates::all</a></div><div class="ttdeci">Predicate all(Predicate P0, Predicate P1)</div><div class="ttdoc">True iff P0 and P1 are true.</div><div class="ttdef"><b>Definition:</b> <a href="LegalizerInfo_8h_source.html#l00228">LegalizerInfo.h:228</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ARM__AM_html_a5d0557608eaebed12bc00812724ba2cdae6bcee28992dab735eaa43f5dfa48a09"><div class="ttname"><a href="namespacellvm_1_1ARM__AM.html#a5d0557608eaebed12bc00812724ba2cdae6bcee28992dab735eaa43f5dfa48a09">llvm::ARM_AM::add</a></div><div class="ttdeci">@ add</div><div class="ttdef"><b>Definition:</b> <a href="ARMAddressingModes_8h_source.html#l00039">ARMAddressingModes.h:39</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_a089cccb6f231efee72abc76d0f9c695f"><div class="ttname"><a href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">llvm::PHINode::addIncoming</a></div><div class="ttdeci">void addIncoming(Value *V, BasicBlock *BB)</div><div class="ttdoc">Add an incoming value to the end of the PHI list.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02854">Instructions.h:2854</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a42569041ddafba7d40243e126af07f42"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a42569041ddafba7d40243e126af07f42">llvm::PatternMatch::m_Or</a></div><div class="ttdeci">BinaryOp_match&lt; LHS, RHS, Instruction::Or &gt; m_Or(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01099">PatternMatch.h:1099</a></div></div>
<div class="ttc" id="anamespacellvm_1_1NVPTX_html_a4faf1254f7468faf963b328603a1463ea6bf6e930014478ac74fdd6d309cc9004"><div class="ttname"><a href="namespacellvm_1_1NVPTX.html#a4faf1254f7468faf963b328603a1463ea6bf6e930014478ac74fdd6d309cc9004">llvm::NVPTX::VecInsert</a></div><div class="ttdeci">@ VecInsert</div><div class="ttdef"><b>Definition:</b> <a href="NVPTX_8h_source.html#l00091">NVPTX.h:91</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a623cced59353f83cc5eaba4068c57694"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a623cced59353f83cc5eaba4068c57694">llvm::TargetTransformInfo::getRegisterClassForType</a></div><div class="ttdeci">unsigned getRegisterClassForType(bool Vector, Type *Ty=nullptr) const</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00648">TargetTransformInfo.cpp:648</a></div></div>
<div class="ttc" id="agroup__VFDatabase_html_ga66862f50dead385e61e416b35110c5f1"><div class="ttname"><a href="group__VFDatabase.html#ga66862f50dead385e61e416b35110c5f1">llvm::VFDatabase::getVectorizedFunction</a></div><div class="ttdeci">Function * getVectorizedFunction(const VFShape &amp;Shape) const</div><div class="ttdef"><b>Definition:</b> <a href="VectorUtils_8h_source.html#l00284">VectorUtils.h:284</a></div></div>
<div class="ttc" id="alib_2Target_2ARM_2README_8txt_html_ad3a99906764c35b2694ae90fa57744a5"><div class="ttname"><a href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">move</a></div><div class="ttdeci">compiles ldr LCPI1_0 ldr ldr mov lsr tst moveq r1 ldr LCPI1_1 and r0 bx lr It would be better to do something like to fold the shift into the conditional move</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2ARM_2README_8txt_source.html#l00546">README.txt:546</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a72fb137716cff838d389e392b9729dc9"><div class="ttname"><a href="classllvm_1_1Value.html#a72fb137716cff838d389e392b9729dc9">llvm::Value::hasNUsesOrMore</a></div><div class="ttdeci">bool hasNUsesOrMore(unsigned N) const</div><div class="ttdoc">Return true if this value has N uses or more.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00152">Value.cpp:152</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a54507f01d7d06127068ee0663233511d"><div class="ttname"><a href="classllvm_1_1Instruction.html#a54507f01d7d06127068ee0663233511d">llvm::Instruction::moveAfter</a></div><div class="ttdeci">void moveAfter(Instruction *MovePos)</div><div class="ttdoc">Unlink this instruction from its current basic block and insert it into the basic block that MovePos ...</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00112">Instruction.cpp:112</a></div></div>
<div class="ttc" id="anamespacellvm_1_1numbers_html_a92f4283d4e0e2ea1776894b3ae93640f"><div class="ttname"><a href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">llvm::numbers::e</a></div><div class="ttdeci">constexpr double e</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00031">MathExtras.h:31</a></div></div>
<div class="ttc" id="aMemoryLocation_8h_html"><div class="ttname"><a href="MemoryLocation_8h.html">MemoryLocation.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMap_html"><div class="ttname"><a href="classllvm_1_1DenseMap.html">llvm::DenseMap</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00714">DenseMap.h:714</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_aae67acb89326f200683e3d0b872a5329"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#aae67acb89326f200683e3d0b872a5329">llvm::TargetTransformInfo::isLegalAltInstr</a></div><div class="ttdeci">bool isLegalAltInstr(VectorType *VecTy, unsigned Opcode0, unsigned Opcode1, const SmallBitVector &amp;OpcodeMask) const</div><div class="ttdoc">Return true if this is an alternating opcode pattern that can be lowered to a single instruction on t...</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00429">TargetTransformInfo.cpp:429</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_ab00c67eb2b92ca056ceefc07c67f46f0"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#ab00c67eb2b92ca056ceefc07c67f46f0">llvm::PatternMatch::m_Store</a></div><div class="ttdeci">TwoOps_match&lt; ValueOpTy, PointerOpTy, Instruction::Store &gt; m_Store(const ValueOpTy &amp;ValueOp, const PointerOpTy &amp;PointerOp)</div><div class="ttdoc">Matches StoreInst.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01570">PatternMatch.h:1570</a></div></div>
<div class="ttc" id="aclassllvm_1_1DemandedBits_html"><div class="ttname"><a href="classllvm_1_1DemandedBits.html">llvm::DemandedBits</a></div><div class="ttdef"><b>Definition:</b> <a href="DemandedBits_8h_source.html#l00040">DemandedBits.h:40</a></div></div>
<div class="ttc" id="anamespacellvm_html_aaf26535d65109ed3d13a21f1b66665a0"><div class="ttname"><a href="namespacellvm.html#aaf26535d65109ed3d13a21f1b66665a0">llvm::areAllOperandsNonInsts</a></div><div class="ttdeci">static bool areAllOperandsNonInsts(Value *V)</div><div class="ttdoc">Checks if the provided value does not require scheduling.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00911">SLPVectorizer.cpp:911</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a8920039419b33a0b7248a0957e262ee7"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a8920039419b33a0b7248a0957e262ee7">llvm::TargetTransformInfo::getCostOfKeepingLiveOverCall</a></div><div class="ttdeci">InstructionCost getCostOfKeepingLiveOverCall(ArrayRef&lt; Type * &gt; Tys) const</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l01049">TargetTransformInfo.cpp:1049</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoopInfoBase_html_a7a7c8e0e4f836c13c015b62e18f386bd"><div class="ttname"><a href="classllvm_1_1LoopInfoBase.html#a7a7c8e0e4f836c13c015b62e18f386bd">llvm::LoopInfoBase::getLoopFor</a></div><div class="ttdeci">LoopT * getLoopFor(const BlockT *BB) const</div><div class="ttdoc">Return the inner most loop that BB lives in.</div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l00992">LoopInfo.h:992</a></div></div>
<div class="ttc" id="aiterator_8h_html"><div class="ttname"><a href="iterator_8h.html">iterator.h</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00058">MD5.cpp:58</a></div></div>
<div class="ttc" id="aPriorityQueue_8h_html"><div class="ttname"><a href="PriorityQueue_8h.html">PriorityQueue.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a733fb237f3037c95ed59de6055b176c5"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a733fb237f3037c95ed59de6055b176c5">llvm::TargetTransformInfo::OperandValueProperties</a></div><div class="ttdeci">OperandValueProperties</div><div class="ttdoc">Additional properties of an operand's values.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00938">TargetTransformInfo.h:938</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a70927cb83bb008a2a60a657d651909aa"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a70927cb83bb008a2a60a657d651909aa">RecursionMaxDepth</a></div><div class="ttdeci">static cl::opt&lt; unsigned &gt; RecursionMaxDepth(&quot;slp-recursion-max-depth&quot;, cl::init(12), cl::Hidden, cl::desc(&quot;Limit the recursion depth when building a vectorizable tree&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1GetElementPtrInst_html"><div class="ttname"><a href="classllvm_1_1GetElementPtrInst.html">llvm::GetElementPtrInst</a></div><div class="ttdoc">an instruction for type-safe pointer arithmetic to access elements of arrays and structs</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00940">Instructions.h:940</a></div></div>
<div class="ttc" id="aclassllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1nodes__iterator_html_ae8c02c6d639d41ef827da13f8acf10f4"><div class="ttname"><a href="classllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1nodes__iterator.html#ae8c02c6d639d41ef827da13f8acf10f4">llvm::GraphTraits&lt; BoUpSLP * &gt;::nodes_iterator::operator!=</a></div><div class="ttdeci">bool operator!=(const nodes_iterator &amp;N2) const</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03498">SLPVectorizer.cpp:3498</a></div></div>
<div class="ttc" id="anamespacellvm_1_1cl_html_a10a041239ae1870cfcc064bfaa79fb65"><div class="ttname"><a href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">llvm::cl::init</a></div><div class="ttdeci">initializer&lt; Ty &gt; init(const Ty &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00445">CommandLine.h:445</a></div></div>
<div class="ttc" id="anamespacellvm_html_a8154638df88e4eaa568b67b23d463dac"><div class="ttname"><a href="namespacellvm.html#a8154638df88e4eaa568b67b23d463dac">llvm::make_early_inc_range</a></div><div class="ttdeci">iterator_range&lt; early_inc_iterator_impl&lt; detail::IterOfRange&lt; RangeT &gt; &gt; &gt; make_early_inc_range(RangeT &amp;&amp;Range)</div><div class="ttdoc">Make a range that does early increment to allow mutation of the underlying range without disrupting i...</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00721">STLExtras.h:721</a></div></div>
<div class="ttc" id="anamespacellvm_html_aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9"><div class="ttname"><a href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">llvm::RecurKind::Add</a></div><div class="ttdeci">@ Add</div><div class="ttdoc">Sum of integers.</div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands_html_a77bfd96a945ce3d147264ebaa8c6d2c7"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#a77bfd96a945ce3d147264ebaa8c6d2c7">llvm::slpvectorizer::BoUpSLP::VLOperands::print</a></div><div class="ttdeci">LLVM_DUMP_METHOD raw_ostream &amp; print(raw_ostream &amp;OS) const</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l02158">SLPVectorizer.cpp:2158</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoopBase_html_ac3280e7f76f955403fe17eacf126b90d"><div class="ttname"><a href="classllvm_1_1LoopBase.html#ac3280e7f76f955403fe17eacf126b90d">llvm::LoopBase::getLoopPreheader</a></div><div class="ttdeci">BlockT * getLoopPreheader() const</div><div class="ttdoc">If there is a preheader for this loop, return it.</div><div class="ttdef"><b>Definition:</b> <a href="LoopInfoImpl_8h_source.html#l00183">LoopInfoImpl.h:183</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a427435d4da769ae680a8e77ef89520aa"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a427435d4da769ae680a8e77ef89520aa">llvm::PatternMatch::m_And</a></div><div class="ttdeci">BinaryOp_match&lt; LHS, RHS, Instruction::And &gt; m_And(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01093">PatternMatch.h:1093</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImpl_html_abf73a826b5d6f739eb4af48ddf14c5b4"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html#abf73a826b5d6f739eb4af48ddf14c5b4">llvm::SmallPtrSetImpl::begin</a></div><div class="ttdeci">iterator begin() const</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00403">SmallPtrSet.h:403</a></div></div>
<div class="ttc" id="anamespacellvm_html_acd1cd968cb420c82d70926920fcdc7d7"><div class="ttname"><a href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">llvm::is_contained</a></div><div class="ttdeci">bool is_contained(R &amp;&amp;Range, const E &amp;Element)</div><div class="ttdoc">Wrapper function around std::find to detect if an element exists in a container.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01869">STLExtras.h:1869</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoopBase_html_a1230fd674d2609b96527fe65eaf40b1b"><div class="ttname"><a href="classllvm_1_1LoopBase.html#a1230fd674d2609b96527fe65eaf40b1b">llvm::LoopBase::getLoopLatch</a></div><div class="ttdeci">BlockT * getLoopLatch() const</div><div class="ttdoc">If there is a single latch block for this loop, return it.</div><div class="ttdef"><b>Definition:</b> <a href="LoopInfoImpl_8h_source.html#l00232">LoopInfoImpl.h:232</a></div></div>
<div class="ttc" id="aclassllvm_1_1details_1_1FixedOrScalableQuantity_html_a33880aaca0ad05e5f1557f079305bde5"><div class="ttname"><a href="classllvm_1_1details_1_1FixedOrScalableQuantity.html#a33880aaca0ad05e5f1557f079305bde5">llvm::details::FixedOrScalableQuantity::getFixedValue</a></div><div class="ttdeci">constexpr ScalarTy getFixedValue() const</div><div class="ttdef"><b>Definition:</b> <a href="TypeSize_8h_source.html#l00182">TypeSize.h:182</a></div></div>
<div class="ttc" id="anamespacellvm_1_1pdb_html_a0d3b0002f320808a94594a6718946d7ba2187e1021a911b3807cc1bea2eb1a9ca"><div class="ttname"><a href="namespacellvm_1_1pdb.html#a0d3b0002f320808a94594a6718946d7ba2187e1021a911b3807cc1bea2eb1a9ca">llvm::pdb::PDB_MemoryType::Stack</a></div><div class="ttdeci">@ Stack</div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a0c047f127ed4380a6f383d70bec4eb94"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::find</a></div><div class="ttdeci">iterator find(const_arg_type_t&lt; KeyT &gt; Val)</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00150">DenseMap.h:150</a></div></div>
<div class="ttc" id="anamespacellvm_html_aa1f8f0633edd8b9a1c5ec15bb9fc5640"><div class="ttname"><a href="namespacellvm.html#aa1f8f0633edd8b9a1c5ec15bb9fc5640">llvm::computeKnownBits</a></div><div class="ttdeci">void computeKnownBits(const Value *V, KnownBits &amp;Known, const DataLayout &amp;DL, unsigned Depth=0, AssumptionCache *AC=nullptr, const Instruction *CxtI=nullptr, const DominatorTree *DT=nullptr, OptimizationRemarkEmitter *ORE=nullptr, bool UseInstrInfo=true)</div><div class="ttdoc">Determine which bits of V are known to be either zero or one and return them in the KnownZero/KnownOn...</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l00186">ValueTracking.cpp:186</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html_a21ff1fd12b25b79fcd4449c35dc814b6"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#a21ff1fd12b25b79fcd4449c35dc814b6">llvm::ArrayRef::equals</a></div><div class="ttdeci">bool equals(ArrayRef RHS) const</div><div class="ttdoc">equals - Check for element-wise equality.</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00185">ArrayRef.h:185</a></div></div>
<div class="ttc" id="aIRBuilder_8h_html"><div class="ttname"><a href="IRBuilder_8h.html">IRBuilder.h</a></div></div>
<div class="ttc" id="aSILowerControlFlow_8cpp_html_a4868c5d81c5ccc98c47aeab6244346a0"><div class="ttname"><a href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a></div><div class="ttdeci">assert(ImpDefSCC.getReg()==AMDGPU::SCC &amp;&amp;ImpDefSCC.isDef())</div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics_html_a8e14accdaa3da86f319cd54a73cf7e79"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html#a8e14accdaa3da86f319cd54a73cf7e79">llvm::slpvectorizer::BoUpSLP::LookAheadHeuristics::LookAheadHeuristics</a></div><div class="ttdeci">LookAheadHeuristics(const TargetLibraryInfo &amp;TLI, const DataLayout &amp;DL, ScalarEvolution &amp;SE, const BoUpSLP &amp;R, int NumLanes, int MaxLevel)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l01207">SLPVectorizer.cpp:1207</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_aa0f4a801858ac7255f623ca0ec53394f"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#aa0f4a801858ac7255f623ca0ec53394f">llvm::TargetTransformInfo::getGatherScatterOpCost</a></div><div class="ttdeci">InstructionCost getGatherScatterOpCost(unsigned Opcode, Type *DataTy, const Value *Ptr, bool VariableMask, Align Alignment, TTI::TargetCostKind CostKind=TTI::TCK_RecipThroughput, const Instruction *I=nullptr) const</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00962">TargetTransformInfo.cpp:962</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_aecc0c27ae96638bc9d8fa4caffa92c31"><div class="ttname"><a href="classllvm_1_1CallBase.html#aecc0c27ae96638bc9d8fa4caffa92c31">llvm::CallBase::hasOperandBundles</a></div><div class="ttdeci">bool hasOperandBundles() const</div><div class="ttdoc">Return true if this User has any operand bundles.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01954">InstrTypes.h:1954</a></div></div>
<div class="ttc" id="anamespacestd_html_ab8424022895aee3e366fb9a32f2883cb"><div class="ttname"><a href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a></div><div class="ttdeci">void swap(llvm::BitVector &amp;LHS, llvm::BitVector &amp;RHS)</div><div class="ttdoc">Implement std::swap in terms of BitVector swap.</div><div class="ttdef"><b>Definition:</b> <a href="BitVector_8h_source.html#l00853">BitVector.h:853</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_af573e4ba5a78948226a4abdf5e713e75"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#af573e4ba5a78948226a4abdf5e713e75">llvm::TargetTransformInfo::getMinMaxReductionCost</a></div><div class="ttdeci">InstructionCost getMinMaxReductionCost(VectorType *Ty, VectorType *CondTy, bool IsUnsigned, TTI::TargetCostKind CostKind=TTI::TCK_RecipThroughput) const</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l01026">TargetTransformInfo.cpp:1026</a></div></div>
<div class="ttc" id="aclassllvm_1_1MapVector_html_a48284a35966b520c1da3a34a112726f5"><div class="ttname"><a href="classllvm_1_1MapVector.html#a48284a35966b520c1da3a34a112726f5">llvm::MapVector::takeVector</a></div><div class="ttdeci">VectorType takeVector()</div><div class="ttdoc">Clear the MapVector and return the underlying vector.</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00056">MapVector.h:56</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_abe36995f592a8ca21971d82531cb2c6d"><div class="ttname"><a href="SLPVectorizer_8cpp.html#abe36995f592a8ca21971d82531cb2c6d">performExtractsShuffleAction</a></div><div class="ttdeci">static T * performExtractsShuffleAction(MutableArrayRef&lt; std::pair&lt; T *, SmallVector&lt; int &gt;&gt;&gt; ShuffleMask, Value *Base, function_ref&lt; unsigned(T *)&gt; GetVF, function_ref&lt; std::pair&lt; T *, bool &gt;(T *, ArrayRef&lt; int &gt;, bool)&gt; ResizeAction, function_ref&lt; T *(ArrayRef&lt; int &gt;, ArrayRef&lt; T * &gt;)&gt; Action)</div><div class="ttdoc">Does the analysis of the provided shuffle masks and performs the requested actions on the vectors wit...</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l07782">SLPVectorizer.cpp:7782</a></div></div>
<div class="ttc" id="anamespacellvm_html_a05a7412bf10f2226fb69f2876b76e9cd"><div class="ttname"><a href="namespacellvm.html#a05a7412bf10f2226fb69f2876b76e9cd">llvm::doesNotNeedToBeScheduled</a></div><div class="ttdeci">static bool doesNotNeedToBeScheduled(Value *V)</div><div class="ttdoc">Checks if the specified value does not require scheduling.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00946">SLPVectorizer.cpp:946</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a2be3583dac92a031fa1458d4d992c78ba573bcd571c938fce863525330bbfc4b8"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba573bcd571c938fce863525330bbfc4b8">llvm::CmpInst::ICMP_UGE</a></div><div class="ttdeci">@ ICMP_UGE</div><div class="ttdoc">unsigned greater or equal</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00742">InstrTypes.h:742</a></div></div>
<div class="ttc" id="aTargetLibraryInfo_8cpp_html_aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053"><div class="ttname"><a href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a></div><div class="ttdeci">@ Ptr</div><div class="ttdef"><b>Definition:</b> <a href="TargetLibraryInfo_8cpp_source.html#l00062">TargetLibraryInfo.cpp:62</a></div></div>
<div class="ttc" id="aclassllvm_1_1SelectInst_html"><div class="ttname"><a href="classllvm_1_1SelectInst.html">llvm::SelectInst</a></div><div class="ttdoc">This class represents the LLVM 'select' instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01746">Instructions.h:1746</a></div></div>
<div class="ttc" id="aiterator__range_8h_html"><div class="ttname"><a href="iterator__range_8h.html">iterator_range.h</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_abae46c48115232bc5de18a6a5e1c7c7f"><div class="ttname"><a href="SLPVectorizer_8cpp.html#abae46c48115232bc5de18a6a5e1c7c7f">getReductionValue</a></div><div class="ttdeci">static Value * getReductionValue(const DominatorTree *DT, PHINode *P, BasicBlock *ParentBB, LoopInfo *LI)</div><div class="ttdoc">Try and get a reduction value from a phi node.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l13085">SLPVectorizer.cpp:13085</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a2be3583dac92a031fa1458d4d992c78ba07aee43ffb66908a25c55c77ce4c0d05"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba07aee43ffb66908a25c55c77ce4c0d05">llvm::CmpInst::BAD_ICMP_PREDICATE</a></div><div class="ttdeci">@ BAD_ICMP_PREDICATE</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00751">InstrTypes.h:751</a></div></div>
<div class="ttc" id="anamespacellvm_html_aa0d69e81725c10fa5407f0bf34462068"><div class="ttname"><a href="namespacellvm.html#aa0d69e81725c10fa5407f0bf34462068">llvm::TTI</a></div><div class="ttdeci">TargetTransformInfo TTI</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00191">TargetTransformInfo.h:191</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_abe6927d96b3815417479246b5afc732e"><div class="ttname"><a href="SLPVectorizer_8cpp.html#abe6927d96b3815417479246b5afc732e">areTwoInsertFromSameBuildVector</a></div><div class="ttdeci">static bool areTwoInsertFromSameBuildVector(InsertElementInst *VU, InsertElementInst *V, function_ref&lt; Value *(InsertElementInst *)&gt; GetBaseOperand)</div><div class="ttdoc">Check if two insertelement instructions are from the same buildvector.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03870">SLPVectorizer.cpp:3870</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a5c88132322ca3f46f242f7c023a57010"><div class="ttname"><a href="classllvm_1_1Instruction.html#a5c88132322ca3f46f242f7c023a57010">llvm::Instruction::isBinaryOp</a></div><div class="ttdeci">bool isBinaryOp() const</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00173">Instruction.h:173</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_af16a6c9336ca2a17389ea709b45fe7f5"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#af16a6c9336ca2a17389ea709b45fe7f5">llvm::PatternMatch::m_SMin</a></div><div class="ttdeci">MaxMin_match&lt; ICmpInst, LHS, RHS, smin_pred_ty &gt; m_SMin(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01859">PatternMatch.h:1859</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_ae8eaa0b4eeac52a2b2282cb1bfd981ae"><div class="ttname"><a href="classllvm_1_1Type.html#ae8eaa0b4eeac52a2b2282cb1bfd981ae">llvm::Type::isVoidTy</a></div><div class="ttdeci">bool isVoidTy() const</div><div class="ttdoc">Return true if this is 'void'.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00140">Type.h:140</a></div></div>
<div class="ttc" id="anamespaceBoUpSLP_html"><div class="ttname"><a href="namespaceBoUpSLP.html">BoUpSLP</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_afebd06edd5d7c956687d26be5c6040c1"><div class="ttname"><a href="SLPVectorizer_8cpp.html#afebd06edd5d7c956687d26be5c6040c1">InTreeUserNeedToExtract</a></div><div class="ttdeci">static bool InTreeUserNeedToExtract(Value *Scalar, Instruction *UserInst, TargetLibraryInfo *TLI)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00785">SLPVectorizer.cpp:785</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_html_acc0cf2fab0dd3b42f500516296cb0bea"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#acc0cf2fab0dd3b42f500516296cb0bea">llvm::slpvectorizer::BoUpSLP::isAnyGathered</a></div><div class="ttdeci">bool isAnyGathered(const SmallDenseSet&lt; Value * &gt; &amp;Vals) const</div><div class="ttdoc">Checks if the given value is gathered in one of the nodes.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l02242">SLPVectorizer.cpp:2242</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a425eab58717b81784602a0b169dd9ff8"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a425eab58717b81784602a0b169dd9ff8">llvm::TargetTransformInfo::getCastInstrCost</a></div><div class="ttdeci">InstructionCost getCastInstrCost(unsigned Opcode, Type *Dst, Type *Src, TTI::CastContextHint CCH, TTI::TargetCostKind CostKind=TTI::TCK_SizeAndLatency, const Instruction *I=nullptr) const</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00869">TargetTransformInfo.cpp:869</a></div></div>
<div class="ttc" id="aclassllvm_1_1Module_html"><div class="ttname"><a href="classllvm_1_1Module.html">llvm::Module</a></div><div class="ttdoc">A Module instance is used to store all the information related to an LLVM module.</div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00065">Module.h:65</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_html_a937e8e7cd2fb7c82d9512b69fc81b65b"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a937e8e7cd2fb7c82d9512b69fc81b65b">llvm::slpvectorizer::BoUpSLP::isDeleted</a></div><div class="ttdeci">bool isDeleted(Instruction *I) const</div><div class="ttdoc">Checks if the instruction is marked for deletion.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l02207">SLPVectorizer.cpp:2207</a></div></div>
<div class="ttc" id="aVPlanSLP_8cpp_html_af04704e906a9654777e92a4612c58c13"><div class="ttname"><a href="VPlanSLP_8cpp.html#af04704e906a9654777e92a4612c58c13">getOpcode</a></div><div class="ttdeci">static std::optional&lt; unsigned &gt; getOpcode(ArrayRef&lt; VPValue * &gt; Values)</div><div class="ttdoc">Returns the opcode of Values or ~0 if they do not all agree.</div><div class="ttdef"><b>Definition:</b> <a href="VPlanSLP_8cpp_source.html#l00191">VPlanSLP.cpp:191</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_afa38851d75434d1476444ac93f94cb4c"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#afa38851d75434d1476444ac93f94cb4c">llvm::TargetTransformInfo::OperandValueKind</a></div><div class="ttdeci">OperandValueKind</div><div class="ttdoc">Additional information about an operand's possible values.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00930">TargetTransformInfo.h:930</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a4ce8fdf40e75ddf217650e2b1b15b5e6"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a4ce8fdf40e75ddf217650e2b1b15b5e6">MaxMemDepDistance</a></div><div class="ttdeci">static const unsigned MaxMemDepDistance</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00187">SLPVectorizer.cpp:187</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImpl_html_a1f475b0df44ebd7169e720fa1bf9169e"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html#a1f475b0df44ebd7169e720fa1bf9169e">llvm::SmallPtrSetImpl::count</a></div><div class="ttdeci">size_type count(ConstPtrType Ptr) const</div><div class="ttdoc">count - Return 1 if the specified pointer is in the set, 0 otherwise.</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00383">SmallPtrSet.h:383</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a4e3a2187cacdec76028617a403c47d89"><div class="ttname"><a href="classllvm_1_1APInt.html#a4e3a2187cacdec76028617a403c47d89">llvm::APInt::urem</a></div><div class="ttdeci">APInt urem(const APInt &amp;RHS) const</div><div class="ttdoc">Unsigned remainder operation.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8cpp_source.html#l01664">APInt.cpp:1664</a></div></div>
<div class="ttc" id="aAssumeBundleBuilder_8cpp_html_afb136e0532bcaed86521b462e6538d62"><div class="ttname"><a href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a></div><div class="ttdeci">assume Assume Builder</div><div class="ttdef"><b>Definition:</b> <a href="AssumeBundleBuilder_8cpp_source.html#l00651">AssumeBundleBuilder.cpp:651</a></div></div>
<div class="ttc" id="aInstructionCost_8h_html"><div class="ttname"><a href="InstructionCost_8h.html">InstructionCost.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a24bca8838396aa81b87de8e7ac774b19"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">llvm::PatternMatch::m_Value</a></div><div class="ttdeci">class_match&lt; Value &gt; m_Value()</div><div class="ttdoc">Match an arbitrary value and ignore it.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00076">PatternMatch.h:76</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html"><div class="ttname"><a href="classllvm_1_1APInt.html">llvm::APInt</a></div><div class="ttdoc">Class for arbitrary precision integers.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00075">APInt.h:75</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics_html"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html">llvm::slpvectorizer::BoUpSLP::LookAheadHeuristics</a></div><div class="ttdoc">A helper class used for scoring candidates for two consecutive lanes.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l01198">SLPVectorizer.cpp:1198</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html_a72d928b7fc2c5f2d56c6ac0265fd9c6e"><div class="ttname"><a href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">llvm::SetVector::insert</a></div><div class="ttdeci">bool insert(const value_type &amp;X)</div><div class="ttdoc">Insert a new element into the SetVector.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00141">SetVector.h:141</a></div></div>
<div class="ttc" id="aM68kELFObjectWriter_8cpp_html_ae4a8bc3879d2282eefd72b16b12c2a37"><div class="ttname"><a href="M68kELFObjectWriter_8cpp.html#ae4a8bc3879d2282eefd72b16b12c2a37">getType</a></div><div class="ttdeci">static M68kRelType getType(unsigned Kind, MCSymbolRefExpr::VariantKind &amp;Modifier, bool &amp;IsPCRel)</div><div class="ttdef"><b>Definition:</b> <a href="M68kELFObjectWriter_8cpp_source.html#l00048">M68kELFObjectWriter.cpp:48</a></div></div>
<div class="ttc" id="anamespacellvm_html_a67980a8ae101d2fda845eb750ffb1942"><div class="ttname"><a href="namespacellvm.html#a67980a8ae101d2fda845eb750ffb1942">llvm::print</a></div><div class="ttdeci">Printable print(const GCNRegPressure &amp;RP, const GCNSubtarget *ST=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="GCNRegPressure_8cpp_source.html#l00138">GCNRegPressure.cpp:138</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a2be3583dac92a031fa1458d4d992c78ba15ae464950ac676919c2f0c7aafc706c"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba15ae464950ac676919c2f0c7aafc706c">llvm::CmpInst::ICMP_SLT</a></div><div class="ttdeci">@ ICMP_SLT</div><div class="ttdoc">signed less than</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00747">InstrTypes.h:747</a></div></div>
<div class="ttc" id="anamespacellvm_html_a10f3d955592ae2bc745f57e5b48ae115"><div class="ttname"><a href="namespacellvm.html#a10f3d955592ae2bc745f57e5b48ae115">llvm::size</a></div><div class="ttdeci">auto size(R &amp;&amp;Range, std::enable_if_t&lt; std::is_base_of&lt; std::random_access_iterator_tag, typename std::iterator_traits&lt; decltype(Range.begin())&gt;::iterator_category &gt;::value, void &gt; *=nullptr)</div><div class="ttdoc">Get the size of a range.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01716">STLExtras.h:1716</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_ac44f6b9fdbb5f9cc199f8329cb0b272ca89f768b1267e3083b4eb05b4ab77e717"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#ac44f6b9fdbb5f9cc199f8329cb0b272ca89f768b1267e3083b4eb05b4ab77e717">llvm::TargetTransformInfo::TCC_Free</a></div><div class="ttdeci">@ TCC_Free</div><div class="ttdoc">Expected to fold away in lowering.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00267">TargetTransformInfo.h:267</a></div></div>
<div class="ttc" id="anamespacellvm_1_1APIntOps_html_a87e2895d880926d0b9a2128b3acfc9dd"><div class="ttname"><a href="namespacellvm_1_1APIntOps.html#a87e2895d880926d0b9a2128b3acfc9dd">llvm::APIntOps::smin</a></div><div class="ttdeci">const APInt &amp; smin(const APInt &amp;A, const APInt &amp;B)</div><div class="ttdoc">Determine the smaller of two APInts considered to be signed.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l02175">APInt.h:2175</a></div></div>
<div class="ttc" id="anamespacellvm_html_aac36edd0f1ce976f0025c98e88d3830eafaa1f94cd925672925f691e7f5727a6b"><div class="ttname"><a href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eafaa1f94cd925672925f691e7f5727a6b">llvm::RecurKind::UMax</a></div><div class="ttdeci">@ UMax</div><div class="ttdoc">Unsigned integer max implemented in terms of select(cmp()).</div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a29dc6da1b32ad914af533bee9c23afda"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a29dc6da1b32ad914af533bee9c23afda">MinTreeSize</a></div><div class="ttdeci">static cl::opt&lt; unsigned &gt; MinTreeSize(&quot;slp-min-tree-size&quot;, cl::init(3), cl::Hidden, cl::desc(&quot;Only vectorize small trees if they are fully vectorizable&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImplBase_html_a16413f1a88d8baca228d0a1b4cc0bfc6"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImplBase.html#a16413f1a88d8baca228d0a1b4cc0bfc6">llvm::SmallPtrSetImplBase::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00095">SmallPtrSet.h:95</a></div></div>
<div class="ttc" id="aclassllvm_1_1AssumptionCacheTracker_html"><div class="ttname"><a href="classllvm_1_1AssumptionCacheTracker.html">llvm::AssumptionCacheTracker</a></div><div class="ttdoc">An immutable pass that tracks lazily created AssumptionCache objects.</div><div class="ttdef"><b>Definition:</b> <a href="AssumptionCache_8h_source.html#l00202">AssumptionCache.h:202</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html"><div class="ttname"><a href="classllvm_1_1ArrayRef.html">llvm::ArrayRef</a></div><div class="ttdoc">ArrayRef - Represent a constant reference to an array (0 or more elements consecutively in memory),...</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00033">APInt.h:33</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoopInfo_html"><div class="ttname"><a href="classllvm_1_1LoopInfo.html">llvm::LoopInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l01108">LoopInfo.h:1108</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_ac511b1624c43ecf7aefa3773fc3255f2"><div class="ttname"><a href="SLPVectorizer_8cpp.html#ac511b1624c43ecf7aefa3773fc3255f2">getAggregateSize</a></div><div class="ttdeci">static std::optional&lt; unsigned &gt; getAggregateSize(Instruction *InsertInst)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l12984">SLPVectorizer.cpp:12984</a></div></div>
<div class="ttc" id="aclassllvm_1_1BinaryOperator_html"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html">llvm::BinaryOperator</a></div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00187">InstrTypes.h:187</a></div></div>
<div class="ttc" id="aclassllvm_1_1OptimizationRemarkEmitter_html"><div class="ttname"><a href="classllvm_1_1OptimizationRemarkEmitter.html">llvm::OptimizationRemarkEmitter</a></div><div class="ttdoc">The optimization diagnostic interface.</div><div class="ttdef"><b>Definition:</b> <a href="OptimizationRemarkEmitter_8h_source.html#l00033">OptimizationRemarkEmitter.h:33</a></div></div>
<div class="ttc" id="astructllvm_1_1SLPVectorizerPass_html_aaec443311cb572adf0e2db9db82279ef"><div class="ttname"><a href="structllvm_1_1SLPVectorizerPass.html#aaec443311cb572adf0e2db9db82279ef">llvm::SLPVectorizerPass::run</a></div><div class="ttdeci">PreservedAnalyses run(Function &amp;F, FunctionAnalysisManager &amp;AM)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l11298">SLPVectorizer.cpp:11298</a></div></div>
<div class="ttc" id="aclassllvm_1_1MapVector_html_a9318649185cfc66ba4b4eb66d5968e00"><div class="ttname"><a href="classllvm_1_1MapVector.html#a9318649185cfc66ba4b4eb66d5968e00">llvm::MapVector::insert</a></div><div class="ttdeci">std::pair&lt; iterator, bool &gt; insert(const std::pair&lt; KeyT, ValueT &gt; &amp;KV)</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00118">MapVector.h:118</a></div></div>
<div class="ttc" id="anamespacellvm_html_a57f2ca0e57f4f7b13f56f9aa16af3e0d"><div class="ttname"><a href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">llvm::min</a></div><div class="ttdeci">Expected&lt; ExpressionValue &gt; min(const ExpressionValue &amp;Lhs, const ExpressionValue &amp;Rhs)</div><div class="ttdef"><b>Definition:</b> <a href="FileCheck_8cpp_source.html#l00357">FileCheck.cpp:357</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html_a171cb6c09b8e26e80eb13a55a5fd6dfe"><div class="ttname"><a href="classllvm_1_1User.html#a171cb6c09b8e26e80eb13a55a5fd6dfe">llvm::User::User</a></div><div class="ttdeci">User(Type *ty, unsigned vty, Use *, unsigned NumOps)</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00073">User.h:73</a></div></div>
<div class="ttc" id="aX86PartialReduction_8cpp_html_ae0f503db91504a3f3440ab81260e4134"><div class="ttname"><a href="X86PartialReduction_8cpp.html#ae0f503db91504a3f3440ab81260e4134">Mul</a></div><div class="ttdeci">BinaryOperator * Mul</div><div class="ttdef"><b>Definition:</b> <a href="X86PartialReduction_8cpp_source.html#l00070">X86PartialReduction.cpp:70</a></div></div>
<div class="ttc" id="anamespacellvm_html_a61d13d6824ec46c31260a4fd0997eda0"><div class="ttname"><a href="namespacellvm.html#a61d13d6824ec46c31260a4fd0997eda0">llvm::any_of</a></div><div class="ttdeci">bool any_of(R &amp;&amp;range, UnaryPredicate P)</div><div class="ttdoc">Provide wrappers to std::any_of which take ranges instead of having to pass begin/end explicitly.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01742">STLExtras.h:1742</a></div></div>
<div class="ttc" id="aDataLayout_8h_html"><div class="ttname"><a href="DataLayout_8h.html">DataLayout.h</a></div></div>
<div class="ttc" id="aBasicBlockSections_8cpp_html_a5fd0741d696f28faf65b33f6c6af8fda"><div class="ttname"><a href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a></div><div class="ttdeci">SmallVector&lt; MachineOperand, 4 &gt; Cond</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockSections_8cpp_source.html#l00137">BasicBlockSections.cpp:137</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisUsage_html_af11a6ebf7ab3c388234cb6d5378439a3"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#af11a6ebf7ab3c388234cb6d5378439a3">llvm::AnalysisUsage::setPreservesCFG</a></div><div class="ttdeci">void setPreservesCFG()</div><div class="ttdoc">This function should be called by the pass, iff they do not:</div><div class="ttdef"><b>Definition:</b> <a href="Pass_8cpp_source.html#l00265">Pass.cpp:265</a></div></div>
<div class="ttc" id="aclassllvm_1_1StringRef_html"><div class="ttname"><a href="classllvm_1_1StringRef.html">llvm::StringRef</a></div><div class="ttdoc">StringRef - Represent a constant reference to a string, i.e.</div><div class="ttdef"><b>Definition:</b> <a href="StringRef_8h_source.html#l00050">StringRef.h:50</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoadInst_html_aeb534c1a0391ce24551c226a582099a7"><div class="ttname"><a href="classllvm_1_1LoadInst.html#aeb534c1a0391ce24551c226a582099a7">llvm::LoadInst::isSimple</a></div><div class="ttdeci">bool isSimple() const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00256">Instructions.h:256</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_adea6dc2e42baa345b97be48b0370313d"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">llvm::PatternMatch::m_Undef</a></div><div class="ttdeci">auto m_Undef()</div><div class="ttdoc">Match an arbitrary undef constant.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00136">PatternMatch.h:136</a></div></div>
<div class="ttc" id="aclassllvm_1_1AssumptionCache_html"><div class="ttname"><a href="classllvm_1_1AssumptionCache.html">llvm::AssumptionCache</a></div><div class="ttdoc">A cache of @llvm.assume calls within a function.</div><div class="ttdef"><b>Definition:</b> <a href="AssumptionCache_8h_source.html#l00042">AssumptionCache.h:42</a></div></div>
<div class="ttc" id="aclassllvm_1_1UndefValue_html_a72f33f26b467287ba52d3adf82b7afb5"><div class="ttname"><a href="classllvm_1_1UndefValue.html#a72f33f26b467287ba52d3adf82b7afb5">llvm::UndefValue::classof</a></div><div class="ttdeci">static bool classof(const Value *V)</div><div class="ttdoc">Methods for support type inquiry through isa, cast, and dyn_cast:</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l01417">Constants.h:1417</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">llvm::CmpInst::ICMP_ULT</a></div><div class="ttdeci">@ ICMP_ULT</div><div class="ttdoc">unsigned less than</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00743">InstrTypes.h:743</a></div></div>
<div class="ttc" id="aSupport_2ErrorHandling_8h_html_ace243f5c25697a1107cce46626b3dc94"><div class="ttname"><a href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a></div><div class="ttdeci">#define llvm_unreachable(msg)</div><div class="ttdoc">Marks that the current location is not supposed to be reachable.</div><div class="ttdef"><b>Definition:</b> <a href="Support_2ErrorHandling_8h_source.html#l00143">ErrorHandling.h:143</a></div></div>
<div class="ttc" id="aclassllvm_1_1Constant_html_acd530d0571f320d47d37e7ae51cf70ff"><div class="ttname"><a href="classllvm_1_1Constant.html#acd530d0571f320d47d37e7ae51cf70ff">llvm::Constant::getAggregateElement</a></div><div class="ttdeci">Constant * getAggregateElement(unsigned Elt) const</div><div class="ttdoc">For aggregates (struct/array/vector) return the constant that corresponds to the specified element if...</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00418">Constants.cpp:418</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a6393a2d4fe7e10b28a0dcc35f881567b"><div class="ttname"><a href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">llvm::Value::getType</a></div><div class="ttdeci">Type * getType() const</div><div class="ttdoc">All values are typed, get the type of this value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00255">Value.h:255</a></div></div>
<div class="ttc" id="anamespacellvm_html_a615619b0b2879029152b9a20e96624bc"><div class="ttname"><a href="namespacellvm.html#a615619b0b2879029152b9a20e96624bc">llvm::transform</a></div><div class="ttdeci">OutputIt transform(R &amp;&amp;Range, OutputIt d_first, UnaryFunction F)</div><div class="ttdoc">Wrapper function around std::transform to apply a function to a range and store the result elsewhere.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01910">STLExtras.h:1910</a></div></div>
<div class="ttc" id="aclassllvm_1_1CFGAnalyses_html"><div class="ttname"><a href="classllvm_1_1CFGAnalyses.html">llvm::CFGAnalyses</a></div><div class="ttdoc">Represents analyses that only rely on functions' control flow.</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00113">PassManager.h:113</a></div></div>
<div class="ttc" id="ainclude_2llvm_2Support_2CMakeLists_8txt_html_aef9367eb0b7430eaf70b1f2725488f2a"><div class="ttname"><a href="include_2llvm_2Support_2CMakeLists_8txt.html#aef9367eb0b7430eaf70b1f2725488f2a">if</a></div><div class="ttdeci">if(llvm_vc STREQUAL &quot;&quot;) set(fake_version_inc &quot;$</div><div class="ttdef"><b>Definition:</b> <a href="include_2llvm_2Support_2CMakeLists_8txt_source.html#l00014">CMakeLists.txt:14</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a674549c09f11cbea1872d9d59b6c49df"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a674549c09f11cbea1872d9d59b6c49df">clusterSortPtrAccesses</a></div><div class="ttdeci">bool clusterSortPtrAccesses(ArrayRef&lt; Value * &gt; VL, Type *ElemTy, const DataLayout &amp;DL, ScalarEvolution &amp;SE, SmallVectorImpl&lt; unsigned &gt; &amp;SortedIndices)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03782">SLPVectorizer.cpp:3782</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisUsage_html_a884f90190bca4bd354f2d5c91c264028"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#a884f90190bca4bd354f2d5c91c264028">llvm::AnalysisUsage::addPreserved</a></div><div class="ttdeci">AnalysisUsage &amp; addPreserved()</div><div class="ttdoc">Add the specified Pass class to the set of analyses preserved by this pass.</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00098">PassAnalysisSupport.h:98</a></div></div>
<div class="ttc" id="aclassllvm_1_1detail_1_1DenseSetImpl_html_ad409c2de8502b94c8a0b1193307c63b6"><div class="ttname"><a href="classllvm_1_1detail_1_1DenseSetImpl.html#ad409c2de8502b94c8a0b1193307c63b6">llvm::detail::DenseSetImpl&lt; ValueT, SmallDenseMap&lt; ValueT, detail::DenseSetEmpty, 4, DenseMapInfo&lt; ValueT &gt;, detail::DenseSetPair&lt; ValueT &gt; &gt;, DenseMapInfo&lt; ValueT &gt; &gt;::contains</a></div><div class="ttdeci">bool contains(const_arg_type_t&lt; ValueT &gt; V) const</div><div class="ttdoc">Check if the set contains the given element.</div><div class="ttdef"><b>Definition:</b> <a href="DenseSet_8h_source.html#l00185">DenseSet.h:185</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a3ab5fc45117b450e8bb04e564cb6e5f2"><div class="ttname"><a href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">llvm::Value::replaceAllUsesWith</a></div><div class="ttdeci">void replaceAllUsesWith(Value *V)</div><div class="ttdoc">Change all uses of this to point to a new Value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00532">Value.cpp:532</a></div></div>
<div class="ttc" id="aCostModel_8cpp_html_a263d4048026a7c0a91393b998181f16e"><div class="ttname"><a href="CostModel_8cpp.html#a263d4048026a7c0a91393b998181f16e">CostKind</a></div><div class="ttdeci">static cl::opt&lt; TargetTransformInfo::TargetCostKind &gt; CostKind(&quot;cost-kind&quot;, cl::desc(&quot;Target cost kind&quot;), cl::init(TargetTransformInfo::TCK_RecipThroughput), cl::values(clEnumValN(TargetTransformInfo::TCK_RecipThroughput, &quot;throughput&quot;, &quot;Reciprocal throughput&quot;), clEnumValN(TargetTransformInfo::TCK_Latency, &quot;latency&quot;, &quot;Instruction latency&quot;), clEnumValN(TargetTransformInfo::TCK_CodeSize, &quot;code-size&quot;, &quot;Code size&quot;), clEnumValN(TargetTransformInfo::TCK_SizeAndLatency, &quot;size-latency&quot;, &quot;Code size and latency&quot;)))</div></div>
<div class="ttc" id="aBasicAliasAnalysis_8cpp_html_a2675de1d8479c7b00387979714da43f7"><div class="ttname"><a href="BasicAliasAnalysis_8cpp.html#a2675de1d8479c7b00387979714da43f7">getParent</a></div><div class="ttdeci">static const Function * getParent(const Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="BasicAliasAnalysis_8cpp_source.html#l00806">BasicAliasAnalysis.cpp:806</a></div></div>
<div class="ttc" id="aCompiler_8h_html"><div class="ttname"><a href="Compiler_8h.html">Compiler.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_ab3fc0225d8aaf8434026c3573f961f2c"><div class="ttname"><a href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">llvm::Value::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const</div><div class="ttdoc">All values hold a context through their type.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00994">Value.cpp:994</a></div></div>
<div class="ttc" id="aclassllvm_1_1IRBuilderBase_html"><div class="ttname"><a href="classllvm_1_1IRBuilderBase.html">llvm::IRBuilderBase</a></div><div class="ttdoc">Common base class shared among various IRBuilders.</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00094">IRBuilder.h:94</a></div></div>
<div class="ttc" id="aclassllvm_1_1ilist__node__impl_html_af719fc783be6589465137d997701a432"><div class="ttname"><a href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">llvm::ilist_node_impl::getIterator</a></div><div class="ttdeci">self_iterator getIterator()</div><div class="ttdef"><b>Definition:</b> <a href="ilist__node_8h_source.html#l00082">ilist_node.h:82</a></div></div>
<div class="ttc" id="aAArch64SLSHardening_8cpp_html_ad467c4ab9119043f9b7750ab986be61a"><div class="ttname"><a href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a></div><div class="ttdeci">MachineBasicBlock MachineBasicBlock::iterator DebugLoc DL</div><div class="ttdef"><b>Definition:</b> <a href="AArch64SLSHardening_8cpp_source.html#l00076">AArch64SLSHardening.cpp:76</a></div></div>
<div class="ttc" id="alib_2Target_2ARM_2README_8txt_html_a1b45f45820a60c09244a87eb59824aec"><div class="ttname"><a href="lib_2Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a></div><div class="ttdeci">add sub stmia L5 ldr r0 bl L_printf $stub Instead of a and a wouldn t it be better to do three moves *Return an aggregate type is even return S</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2ARM_2README_8txt_source.html#l00210">README.txt:210</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_aabfbce373feafd33ca9e104d8b164ece"><div class="ttname"><a href="SLPVectorizer_8cpp.html#aabfbce373feafd33ca9e104d8b164ece">allSameType</a></div><div class="ttdeci">static bool allSameType(ArrayRef&lt; Value * &gt; VL)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00774">SLPVectorizer.cpp:774</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantExpr_html_a90d84324b6b6aa2a60077a79b31a49e7"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#a90d84324b6b6aa2a60077a79b31a49e7">llvm::ConstantExpr::getIntegerCast</a></div><div class="ttdeci">static Constant * getIntegerCast(Constant *C, Type *Ty, bool IsSigned)</div><div class="ttdoc">Create a ZExt, Bitcast or Trunc for integer -&gt; integer casts.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l02067">Constants.cpp:2067</a></div></div>
<div class="ttc" id="anamespacellvm_html_aac36edd0f1ce976f0025c98e88d3830ea62b6d55816cf737bfc6f42e60df1a3f2"><div class="ttname"><a href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea62b6d55816cf737bfc6f42e60df1a3f2">llvm::RecurKind::Mul</a></div><div class="ttdeci">@ Mul</div><div class="ttdoc">Product of integers.</div></div>
<div class="ttc" id="anamespacellvm_1_1PICLevel_html_a66ddbf1bb21f90ddc44260d1ca677b6b"><div class="ttname"><a href="namespacellvm_1_1PICLevel.html#a66ddbf1bb21f90ddc44260d1ca677b6b">llvm::PICLevel::Level</a></div><div class="ttdeci">Level</div><div class="ttdef"><b>Definition:</b> <a href="CodeGen_8h_source.html#l00036">CodeGen.h:36</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_aae0e8ca52658f54e5cc6214eb1a291ef"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#aae0e8ca52658f54e5cc6214eb1a291ef">llvm::TargetTransformInfo::getNumberOfRegisters</a></div><div class="ttdeci">unsigned getNumberOfRegisters(unsigned ClassID) const</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00644">TargetTransformInfo.cpp:644</a></div></div>
<div class="ttc" id="aclassllvm_1_1CastInst_html"><div class="ttname"><a href="classllvm_1_1CastInst.html">llvm::CastInst</a></div><div class="ttdoc">This is the base class for all instructions that perform data casts.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00428">InstrTypes.h:428</a></div></div>
<div class="ttc" id="anamespacellvm_html_aac36edd0f1ce976f0025c98e88d3830ea8764eae15a1f2cf1c964d14dcf9283ee"><div class="ttname"><a href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea8764eae15a1f2cf1c964d14dcf9283ee">llvm::RecurKind::FMax</a></div><div class="ttdeci">@ FMax</div><div class="ttdoc">FP max implemented in terms of select(cmp()).</div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_ab7c8670d4d4589e06bedd21c48405060"><div class="ttname"><a href="SLPVectorizer_8cpp.html#ab7c8670d4d4589e06bedd21c48405060">LookAheadMaxDepth</a></div><div class="ttdeci">static cl::opt&lt; int &gt; LookAheadMaxDepth(&quot;slp-max-look-ahead-depth&quot;, cl::init(2), cl::Hidden, cl::desc(&quot;The maximum look-ahead depth for operand reordering scores&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_afa38851d75434d1476444ac93f94cb4ca9c0eecea29e9fa58e4dac7ee32b9b2ac"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#afa38851d75434d1476444ac93f94cb4ca9c0eecea29e9fa58e4dac7ee32b9b2ac">llvm::TargetTransformInfo::OK_AnyValue</a></div><div class="ttdeci">@ OK_AnyValue</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00931">TargetTransformInfo.h:931</a></div></div>
<div class="ttc" id="aclassllvm_1_1DomTreeNodeBase_html"><div class="ttname"><a href="classllvm_1_1DomTreeNodeBase.html">llvm::DomTreeNodeBase&lt; BasicBlock &gt;</a></div></div>
<div class="ttc" id="aclassBoUpSLP_1_1ShuffleInstructionBuilder_html_a90d914a4c74deeeb0224cb65ce60b897"><div class="ttname"><a href="classBoUpSLP_1_1ShuffleInstructionBuilder.html#a90d914a4c74deeeb0224cb65ce60b897">BoUpSLP::ShuffleInstructionBuilder::finalize</a></div><div class="ttdeci">Value * finalize(ArrayRef&lt; int &gt; ExtMask=std::nullopt)</div><div class="ttdoc">Finalize emission of the shuffles.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l08933">SLPVectorizer.cpp:8933</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a38a6a25e425f94c9836dda96f3718593"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a38a6a25e425f94c9836dda96f3718593">llvm::PatternMatch::m_SMax</a></div><div class="ttdeci">MaxMin_match&lt; ICmpInst, LHS, RHS, smax_pred_ty &gt; m_SMax(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01853">PatternMatch.h:1853</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_adb5c319f5905c1d3ca9eb5df546388c5"><div class="ttname"><a href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">llvm::Value::getName</a></div><div class="ttdeci">StringRef getName() const</div><div class="ttdoc">Return a constant reference to the value's name.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00308">Value.cpp:308</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoadInst_html"><div class="ttname"><a href="classllvm_1_1LoadInst.html">llvm::LoadInst</a></div><div class="ttdoc">An instruction for reading from memory.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00177">Instructions.h:177</a></div></div>
<div class="ttc" id="aValueHandle_8h_html"><div class="ttname"><a href="ValueHandle_8h.html">ValueHandle.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a99f811d53704275b4158c62a2dd138d9"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a99f811d53704275b4158c62a2dd138d9">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::insert</a></div><div class="ttdeci">std::pair&lt; iterator, bool &gt; insert(const std::pair&lt; KeyT, ValueT &gt; &amp;KV)</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00207">DenseMap.h:207</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a0feeaece30961860a542ba8ee2a1f9f3"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a0feeaece30961860a542ba8ee2a1f9f3">isRepeatedNonIdentityClusteredMask</a></div><div class="ttdeci">static bool isRepeatedNonIdentityClusteredMask(ArrayRef&lt; int &gt; Mask, unsigned Sz)</div><div class="ttdoc">Checks if the given mask is a &quot;clustered&quot; mask with the same clusters of size Sz, which are not ident...</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l04067">SLPVectorizer.cpp:4067</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html_a6bc2b53fce3b1d8975eea027d8a8eb90"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#a6bc2b53fce3b1d8975eea027d8a8eb90">llvm::ArrayRef::front</a></div><div class="ttdeci">const T &amp; front() const</div><div class="ttdoc">front - Get the first element.</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00166">ArrayRef.h:166</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html_a1600c7959045cb6b6a5f5a1d427ec67e"><div class="ttname"><a href="classllvm_1_1User.html#a1600c7959045cb6b6a5f5a1d427ec67e">llvm::User::replaceUsesOfWith</a></div><div class="ttdeci">bool replaceUsesOfWith(Value *From, Value *To)</div><div class="ttdoc">Replace uses of one Value with another.</div><div class="ttdef"><b>Definition:</b> <a href="User_8cpp_source.html#l00021">User.cpp:21</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands_html_a25c846db09b53a522a9fd2ac38462406"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#a25c846db09b53a522a9fd2ac38462406">llvm::slpvectorizer::BoUpSLP::VLOperands::getModeStr</a></div><div class="ttdeci">static LLVM_DUMP_METHOD StringRef getModeStr(ReorderingMode RMode)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l02128">SLPVectorizer.cpp:2128</a></div></div>
<div class="ttc" id="aSampleProfWriter_8cpp_html_ac5f3689931c7238da06ba00cf1002c62"><div class="ttname"><a href="SampleProfWriter_8cpp.html#ac5f3689931c7238da06ba00cf1002c62">OS</a></div><div class="ttdeci">raw_pwrite_stream &amp; OS</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfWriter_8cpp_source.html#l00053">SampleProfWriter.cpp:53</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_af84cce349a77262269fd3f6756f37a64a6adf97f83acf6453d4a6a4b1070f3754"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#af84cce349a77262269fd3f6756f37a64a6adf97f83acf6453d4a6a4b1070f3754">llvm::TargetTransformInfo::CastContextHint::None</a></div><div class="ttdeci">@ None</div><div class="ttdoc">The cast is not used with a load/store of any kind.</div></div>
<div class="ttc" id="anamespacellvm_1_1Intrinsic_html_aefa39f6b622360ce4e947feb9f671b73"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#aefa39f6b622360ce4e947feb9f671b73">llvm::Intrinsic::getDeclaration</a></div><div class="ttdeci">Function * getDeclaration(Module *M, ID id, ArrayRef&lt; Type * &gt; Tys=std::nullopt)</div><div class="ttdoc">Create or insert an LLVM Function declaration for an intrinsic, and return it.</div><div class="ttdef"><b>Definition:</b> <a href="Function_8cpp_source.html#l01502">Function.cpp:1502</a></div></div>
<div class="ttc" id="anamespacellvm_html_a766456df1dd21e804cd4596304e10764ae8b4b40ec3622e371789b790caabc083"><div class="ttname"><a href="namespacellvm.html#a766456df1dd21e804cd4596304e10764ae8b4b40ec3622e371789b790caabc083">llvm::ComplexDeinterleavingOperation::Shuffle</a></div><div class="ttdeci">@ Shuffle</div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImplBase_html_a0e1c3175b0ac22fe3853651c28e1ecb8"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImplBase.html#a0e1c3175b0ac22fe3853651c28e1ecb8">llvm::SmallPtrSetImplBase::size</a></div><div class="ttdeci">size_type size() const</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00093">SmallPtrSet.h:93</a></div></div>
<div class="ttc" id="astructllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1ChildIteratorType_html_a078cde4ddd868aff68189c7b4fe56f00"><div class="ttname"><a href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1ChildIteratorType.html#a078cde4ddd868aff68189c7b4fe56f00">llvm::GraphTraits&lt; BoUpSLP * &gt;::ChildIteratorType::operator*</a></div><div class="ttdeci">NodeRef operator*()</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03470">SLPVectorizer.cpp:3470</a></div></div>
<div class="ttc" id="aclassllvm_1_1MapVector_html_a0881334358ff6ff7ff8cea5562c7988e"><div class="ttname"><a href="classllvm_1_1MapVector.html#a0881334358ff6ff7ff8cea5562c7988e">llvm::MapVector::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00072">MapVector.h:72</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_html_a5e8175cf734a1f96d3e5cda536407932"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a5e8175cf734a1f96d3e5cda536407932">llvm::slpvectorizer::BoUpSLP::analyzedReductionRoot</a></div><div class="ttdeci">void analyzedReductionRoot(Instruction *I)</div><div class="ttdoc">Register given instruction as already analyzed for being possible reduction root.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l02223">SLPVectorizer.cpp:2223</a></div></div>
<div class="ttc" id="anamespacellvm_html_ac78c09ae232b2ce188ff590d51e3c268"><div class="ttname"><a href="namespacellvm.html#ac78c09ae232b2ce188ff590d51e3c268">llvm::find_if</a></div><div class="ttdeci">auto find_if(R &amp;&amp;Range, UnaryPredicate P)</div><div class="ttdoc">Provide wrappers to std::find_if which take ranges instead of having to pass begin/end explicitly.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01762">STLExtras.h:1762</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_html_a59c27b232cd05843ebd28dd6b0852ea5"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a59c27b232cd05843ebd28dd6b0852ea5">llvm::slpvectorizer::BoUpSLP::operator&lt;&lt;</a></div><div class="ttdeci">friend raw_ostream &amp; operator&lt;&lt;(raw_ostream &amp;os, const BoUpSLP::ScheduleData &amp;SD)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03064">SLPVectorizer.cpp:3064</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_ac09a21c371a9c535cbc13e8f82503aec"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#ac09a21c371a9c535cbc13e8f82503aec">llvm::ConstantInt::getZExtValue</a></div><div class="ttdeci">uint64_t getZExtValue() const</div><div class="ttdoc">Return the constant as a 64-bit unsigned integer value after it has been zero extended as appropriate...</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00141">Constants.h:141</a></div></div>
<div class="ttc" id="aDemandedBits_8h_html"><div class="ttname"><a href="DemandedBits_8h.html">DemandedBits.h</a></div></div>
<div class="ttc" id="aclassBoUpSLP_1_1ShuffleInstructionBuilder_html_a2a70579b10e07cbdcfa20fb9b05a48e7"><div class="ttname"><a href="classBoUpSLP_1_1ShuffleInstructionBuilder.html#a2a70579b10e07cbdcfa20fb9b05a48e7">BoUpSLP::ShuffleInstructionBuilder::add</a></div><div class="ttdeci">void add(Value *V1, Value *V2, ArrayRef&lt; int &gt; Mask)</div><div class="ttdoc">Adds 2 input vectors and the mask for their shuffling.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l08841">SLPVectorizer.cpp:8841</a></div></div>
<div class="ttc" id="astructllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_html_a20073b3e631a14c7639284690a2a3d63"><div class="ttname"><a href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a20073b3e631a14c7639284690a2a3d63">llvm::GraphTraits&lt; BoUpSLP * &gt;::child_begin</a></div><div class="ttdeci">static ChildIteratorType child_begin(NodeRef N)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03477">SLPVectorizer.cpp:3477</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a8f3292dcaad99569501ace7909f2ccf0"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a8f3292dcaad99569501ace7909f2ccf0">isValidForAlternation</a></div><div class="ttdeci">static bool isValidForAlternation(unsigned Opcode)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00586">SLPVectorizer.cpp:586</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a733fb237f3037c95ed59de6055b176c5a19af6b5f4f70eaefcc0b6734f1f06cd8"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a733fb237f3037c95ed59de6055b176c5a19af6b5f4f70eaefcc0b6734f1f06cd8">llvm::TargetTransformInfo::OP_NegatedPowerOf2</a></div><div class="ttdeci">@ OP_NegatedPowerOf2</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00941">TargetTransformInfo.h:941</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_html_adc72e9ea7ec5e94d10e2a9a4fdaa3fc2"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#adc72e9ea7ec5e94d10e2a9a4fdaa3fc2">llvm::slpvectorizer::BoUpSLP::getMaxVecRegSize</a></div><div class="ttdeci">unsigned getMaxVecRegSize() const</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l01119">SLPVectorizer.cpp:1119</a></div></div>
<div class="ttc" id="anamespacellvm_html_aac36edd0f1ce976f0025c98e88d3830eaa7dad289ea38506fb1c9b5b148405d0c"><div class="ttname"><a href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eaa7dad289ea38506fb1c9b5b148405d0c">llvm::RecurKind::FMulAdd</a></div><div class="ttdeci">@ FMulAdd</div><div class="ttdoc">Fused multiply-add of floats (a * b + c).</div></div>
<div class="ttc" id="aAttributes_8h_html"><div class="ttname"><a href="Attributes_8h.html">Attributes.h</a></div></div>
<div class="ttc" id="aEntryExitInstrumenter_8cpp_html_a3985f1f39349428d17f0d2b81ebc6349"><div class="ttname"><a href="EntryExitInstrumenter_8cpp.html#a3985f1f39349428d17f0d2b81ebc6349">runOnFunction</a></div><div class="ttdeci">static bool runOnFunction(Function &amp;F, bool PostInlining)</div><div class="ttdef"><b>Definition:</b> <a href="EntryExitInstrumenter_8cpp_source.html#l00085">EntryExitInstrumenter.cpp:85</a></div></div>
<div class="ttc" id="alib_2Target_2README_8txt_html_a3a76669632041022e6976766a22bd2b0"><div class="ttname"><a href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a></div><div class="ttdeci">return j(j&lt;&lt; 16)</div></div>
<div class="ttc" id="astructllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo_html_afaf1506235fe5124a0fe4bf12d655551"><div class="ttname"><a href="structllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo.html#afaf1506235fe5124a0fe4bf12d655551">llvm::slpvectorizer::BoUpSLP::EdgeInfo::dump</a></div><div class="ttdeci">void dump(raw_ostream &amp;OS) const</div><div class="ttdoc">Debug print.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l01189">SLPVectorizer.cpp:1189</a></div></div>
<div class="ttc" id="anamespacellvm_1_1APIntOps_html_a071b3581888d9e3b0b05cec58f152a91"><div class="ttname"><a href="namespacellvm_1_1APIntOps.html#a071b3581888d9e3b0b05cec58f152a91">llvm::APIntOps::umax</a></div><div class="ttdeci">const APInt &amp; umax(const APInt &amp;A, const APInt &amp;B)</div><div class="ttdoc">Determine the larger of two APInts considered to be unsigned.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l02190">APInt.h:2190</a></div></div>
<div class="ttc" id="aSLPVectorizer_8h_html"><div class="ttname"><a href="SLPVectorizer_8h.html">SLPVectorizer.h</a></div></div>
<div class="ttc" id="astructllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_html_aba5049d783b8594ef0a36b6c1d1a973b"><div class="ttname"><a href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#aba5049d783b8594ef0a36b6c1d1a973b">llvm::GraphTraits&lt; BoUpSLP * &gt;::ContainerTy</a></div><div class="ttdeci">BoUpSLP::TreeEntry::VecTreeTy ContainerTy</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03457">SLPVectorizer.cpp:3457</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a421ee26483edf3fd0cd1dca34513f45e"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a421ee26483edf3fd0cd1dca34513f45e">llvm::TargetTransformInfo::getArithmeticReductionCost</a></div><div class="ttdeci">InstructionCost getArithmeticReductionCost(unsigned Opcode, VectorType *Ty, std::optional&lt; FastMathFlags &gt; FMF, TTI::TargetCostKind CostKind=TTI::TCK_RecipThroughput) const</div><div class="ttdoc">Calculate the cost of vector reduction intrinsics.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l01017">TargetTransformInfo.cpp:1017</a></div></div>
<div class="ttc" id="aConstant_8h_html"><div class="ttname"><a href="Constant_8h.html">Constant.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1NVPTX_1_1PTXLdStInstCode_html_a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4"><div class="ttname"><a href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">llvm::NVPTX::PTXLdStInstCode::V2</a></div><div class="ttdeci">@ V2</div><div class="ttdef"><b>Definition:</b> <a href="NVPTX_8h_source.html#l00124">NVPTX.h:124</a></div></div>
<div class="ttc" id="aclassllvm_1_1Twine_html"><div class="ttname"><a href="classllvm_1_1Twine.html">llvm::Twine</a></div><div class="ttdoc">Twine - A lightweight data structure for efficiently representing the concatenation of temporary valu...</div><div class="ttdef"><b>Definition:</b> <a href="Twine_8h_source.html#l00081">Twine.h:81</a></div></div>
<div class="ttc" id="anamespacellvm_html_aa656aa475d13ec6a900414eadabe86b0"><div class="ttname"><a href="namespacellvm.html#aa656aa475d13ec6a900414eadabe86b0">llvm::minnum</a></div><div class="ttdeci">LLVM_READONLY APFloat minnum(const APFloat &amp;A, const APFloat &amp;B)</div><div class="ttdoc">Implements IEEE minNum semantics.</div><div class="ttdef"><b>Definition:</b> <a href="APFloat_8h_source.html#l01346">APFloat.h:1346</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallBitVector_html_ae0307ad5c950df7f6fb56dc8326184ce"><div class="ttname"><a href="classllvm_1_1SmallBitVector.html#ae0307ad5c950df7f6fb56dc8326184ce">llvm::SmallBitVector::count</a></div><div class="ttdeci">size_type count() const</div><div class="ttdoc">Returns the number of bits which are set.</div><div class="ttdef"><b>Definition:</b> <a href="SmallBitVector_8h_source.html#l00200">SmallBitVector.h:200</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands_html_a54b0557e2672c4799a99740259ddc41d"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#a54b0557e2672c4799a99740259ddc41d">llvm::slpvectorizer::BoUpSLP::VLOperands::dumpMode</a></div><div class="ttdeci">static LLVM_DUMP_METHOD void dumpMode(ReorderingMode RMode)</div><div class="ttdoc">Debug print.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l02150">SLPVectorizer.cpp:2150</a></div></div>
<div class="ttc" id="aclassllvm_1_1OptimizationRemarkEmitterWrapperPass_html"><div class="ttname"><a href="classllvm_1_1OptimizationRemarkEmitterWrapperPass.html">llvm::OptimizationRemarkEmitterWrapperPass</a></div><div class="ttdoc">OptimizationRemarkEmitter legacy analysis pass.</div><div class="ttdef"><b>Definition:</b> <a href="OptimizationRemarkEmitter_8h_source.html#l00146">OptimizationRemarkEmitter.h:146</a></div></div>
<div class="ttc" id="anamespacellvm_html_a076f93c387f454f0db13d4bc7d4e7f9c"><div class="ttname"><a href="namespacellvm.html#a076f93c387f454f0db13d4bc7d4e7f9c">llvm::stable_sort</a></div><div class="ttdeci">void stable_sort(R &amp;&amp;Range)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01948">STLExtras.h:1948</a></div></div>
<div class="ttc" id="aVerifier_8h_html"><div class="ttname"><a href="Verifier_8h.html">Verifier.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_aa0519f26bcb15c25ac0ff557061fa7af"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#aa0519f26bcb15c25ac0ff557061fa7af">llvm::TargetTransformInfo::getShuffleCost</a></div><div class="ttdeci">InstructionCost getShuffleCost(ShuffleKind Kind, VectorType *Tp, ArrayRef&lt; int &gt; Mask=std::nullopt, TTI::TargetCostKind CostKind=TTI::TCK_RecipThroughput, int Index=0, VectorType *SubTp=nullptr, ArrayRef&lt; const Value * &gt; Args=std::nullopt) const</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00815">TargetTransformInfo.cpp:815</a></div></div>
<div class="ttc" id="aGraphWriter_8h_html"><div class="ttname"><a href="GraphWriter_8h.html">GraphWriter.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_abd962b7b01f49ce61ea41ee10c49e313"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#abd962b7b01f49ce61ea41ee10c49e313">llvm::SmallVectorImpl::swap</a></div><div class="ttdeci">void swap(SmallVectorImpl &amp;RHS)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00972">SmallVector.h:972</a></div></div>
<div class="ttc" id="astructllvm_1_1KnownBits_html"><div class="ttname"><a href="structllvm_1_1KnownBits.html">llvm::KnownBits</a></div><div class="ttdef"><b>Definition:</b> <a href="KnownBits_8h_source.html#l00023">KnownBits.h:23</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a807bb3d2ecc2999993a91d499bd26543"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a807bb3d2ecc2999993a91d499bd26543">isCmpSameOrSwapped</a></div><div class="ttdeci">static bool isCmpSameOrSwapped(const CmpInst *BaseCI, const CmpInst *CI, const TargetLibraryInfo &amp;TLI)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00613">SLPVectorizer.cpp:613</a></div></div>
<div class="ttc" id="aclassllvm_1_1ScalarEvolution_html_a8bcb86d8d126d95b0dc05f09e8f3df96"><div class="ttname"><a href="classllvm_1_1ScalarEvolution.html#a8bcb86d8d126d95b0dc05f09e8f3df96">llvm::ScalarEvolution::getMinusSCEV</a></div><div class="ttdeci">const SCEV * getMinusSCEV(const SCEV *LHS, const SCEV *RHS, SCEV::NoWrapFlags Flags=SCEV::FlagAnyWrap, unsigned Depth=0)</div><div class="ttdoc">Return LHS-RHS.</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8cpp_source.html#l04642">ScalarEvolution.cpp:4642</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_abe11501239b82a4ba1730e12be769bc6"><div class="ttname"><a href="SLPVectorizer_8cpp.html#abe11501239b82a4ba1730e12be769bc6">getExtractIndex</a></div><div class="ttdeci">static std::optional&lt; unsigned &gt; getExtractIndex(Instruction *E)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00519">SLPVectorizer.cpp:519</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_ab040531a75b07eda10dc88c82439ff89"><div class="ttname"><a href="SLPVectorizer_8cpp.html#ab040531a75b07eda10dc88c82439ff89">findBuildAggregate_rec</a></div><div class="ttdeci">static void findBuildAggregate_rec(Instruction *LastInsertInst, TargetTransformInfo *TTI, SmallVectorImpl&lt; Value * &gt; &amp;BuildVectorOpds, SmallVectorImpl&lt; Value * &gt; &amp;InsertElts, unsigned OperandOffset)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l13012">SLPVectorizer.cpp:13012</a></div></div>
<div class="ttc" id="aclassllvm_1_1DemandedBitsWrapperPass_html"><div class="ttname"><a href="classllvm_1_1DemandedBitsWrapperPass.html">llvm::DemandedBitsWrapperPass</a></div><div class="ttdef"><b>Definition:</b> <a href="DemandedBits_8h_source.html#l00102">DemandedBits.h:102</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a65520b9c67759099e313d0f4e7b5ff9e"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a65520b9c67759099e313d0f4e7b5ff9e">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00084">DenseMap.h:84</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_a38c50aa8e3e9588f4f968c2e03a0cee0"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a38c50aa8e3e9588f4f968c2e03a0cee0">llvm::SmallVectorImpl::assign</a></div><div class="ttdeci">void assign(size_type NumElts, ValueParamT Elt)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00708">SmallVector.h:708</a></div></div>
<div class="ttc" id="anamespacellvm_html_a6f0917bf2ae18fac81fea6bf7e887115"><div class="ttname"><a href="namespacellvm.html#a6f0917bf2ae18fac81fea6bf7e887115">llvm::inversePermutation</a></div><div class="ttdeci">static void inversePermutation(ArrayRef&lt; unsigned &gt; Indices, SmallVectorImpl&lt; int &gt; &amp;Mask)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00886">SLPVectorizer.cpp:886</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1SendMsg_html_a8594419a4ddfad2c9a79279c490e466d"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">llvm::AMDGPU::SendMsg::Op</a></div><div class="ttdeci">Op</div><div class="ttdef"><b>Definition:</b> <a href="SIDefines_8h_source.html#l00357">SIDefines.h:357</a></div></div>
<div class="ttc" id="aclassllvm_1_1PreservedAnalyses_html_a1258a1ff55557c27684010ebd7283712"><div class="ttname"><a href="classllvm_1_1PreservedAnalyses.html#a1258a1ff55557c27684010ebd7283712">llvm::PreservedAnalyses::all</a></div><div class="ttdeci">static PreservedAnalyses all()</div><div class="ttdoc">Construct a special preserved set that preserves all passes.</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00158">PassManager.h:158</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands_html_a2f8993663388ca686412e1b22b2743de"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html#a2f8993663388ca686412e1b22b2743de">llvm::slpvectorizer::BoUpSLP::VLOperands::VLOperands</a></div><div class="ttdeci">VLOperands(ArrayRef&lt; Value * &gt; RootVL, const TargetLibraryInfo &amp;TLI, const DataLayout &amp;DL, ScalarEvolution &amp;SE, const BoUpSLP &amp;R)</div><div class="ttdoc">Initialize with all the operands of the instruction vector RootVL.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l01971">SLPVectorizer.cpp:1971</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_abd5114d6b451e9ca85a36fc3f19f76c4"><div class="ttname"><a href="SLPVectorizer_8cpp.html#abd5114d6b451e9ca85a36fc3f19f76c4">allSameBlock</a></div><div class="ttdeci">static bool allSameBlock(ArrayRef&lt; Value * &gt; VL)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00231">SLPVectorizer.cpp:231</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html_aab36927882fbfdcbb860d87fd9c30da8"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#aab36927882fbfdcbb860d87fd9c30da8">llvm::ArrayRef::begin</a></div><div class="ttdeci">iterator begin() const</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00151">ArrayRef.h:151</a></div></div>
<div class="ttc" id="anamespacellvm_1_1X86_html_a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e"><div class="ttname"><a href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">llvm::X86::FirstMacroFusionInstKind::Cmp</a></div><div class="ttdeci">@ Cmp</div></div>
<div class="ttc" id="astructllvm_1_1DOTGraphTraits_3_01BoUpSLP_01_5_01_4_html_a2c2b4fe580b504831c0fb50183e578a3"><div class="ttname"><a href="structllvm_1_1DOTGraphTraits_3_01BoUpSLP_01_5_01_4.html#a2c2b4fe580b504831c0fb50183e578a3">llvm::DOTGraphTraits&lt; BoUpSLP * &gt;::TreeEntry</a></div><div class="ttdeci">BoUpSLP::TreeEntry TreeEntry</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03513">SLPVectorizer.cpp:3513</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_adde2ea00dd2613ee41bfe91908e4e68e"><div class="ttname"><a href="classllvm_1_1CallBase.html#adde2ea00dd2613ee41bfe91908e4e68e">llvm::CallBase::arg_size</a></div><div class="ttdeci">unsigned arg_size() const</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01349">InstrTypes.h:1349</a></div></div>
<div class="ttc" id="anamespacellvm_html_ae22967d11b695d268992470debfae4b2"><div class="ttname"><a href="namespacellvm.html#ae22967d11b695d268992470debfae4b2">llvm::bit_floor</a></div><div class="ttdeci">T bit_floor(T Value)</div><div class="ttdoc">Returns the largest integral power of two no greater than Value if Value is nonzero.</div><div class="ttdef"><b>Definition:</b> <a href="bit_8h_source.html#l00291">bit.h:291</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a5fecba95c1ba20950ea8e2139127e621"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a5fecba95c1ba20950ea8e2139127e621">llvm::TargetTransformInfo::getOperandInfo</a></div><div class="ttdeci">static OperandValueInfo getOperandInfo(const Value *V)</div><div class="ttdoc">Collect properties of V used in cost analysis, e.g. OP_PowerOf2.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00743">TargetTransformInfo.cpp:743</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a4a3e80130d3f25468190ba343064b37e"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a4a3e80130d3f25468190ba343064b37e">reorderReuses</a></div><div class="ttdeci">static void reorderReuses(SmallVectorImpl&lt; int &gt; &amp;Reuses, ArrayRef&lt; int &gt; Mask)</div><div class="ttdoc">Reorders the given Reuses mask according to the given Mask.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03576">SLPVectorizer.cpp:3576</a></div></div>
<div class="ttc" id="aclassllvm_1_1ExtractValueInst_html"><div class="ttname"><a href="classllvm_1_1ExtractValueInst.html">llvm::ExtractValueInst</a></div><div class="ttdoc">This instruction extracts a struct member or array element value from an aggregate value.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02455">Instructions.h:2455</a></div></div>
<div class="ttc" id="anamespacellvm_html_abff5a423c1f45e23958dde8ee695c9a9"><div class="ttname"><a href="namespacellvm.html#abff5a423c1f45e23958dde8ee695c9a9">llvm::isGuaranteedToTransferExecutionToSuccessor</a></div><div class="ttdeci">bool isGuaranteedToTransferExecutionToSuccessor(const Instruction *I)</div><div class="ttdoc">Return true if this function can prove that the instruction I will always transfer execution to one o...</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l05612">ValueTracking.cpp:5612</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AArch64CC_html_abfa1f7dce576430da99eed57807c7f28afdd8238d6005774fe2bb9067de76eb8c"><div class="ttname"><a href="namespacellvm_1_1AArch64CC.html#abfa1f7dce576430da99eed57807c7f28afdd8238d6005774fe2bb9067de76eb8c">llvm::AArch64CC::LS</a></div><div class="ttdeci">@ LS</div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00264">AArch64BaseInfo.h:264</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisManager_html_a90a202de107720c5c6af3a5bc275d8f5"><div class="ttname"><a href="classllvm_1_1AnalysisManager.html#a90a202de107720c5c6af3a5bc275d8f5">llvm::AnalysisManager::getCachedResult</a></div><div class="ttdeci">PassT::Result * getCachedResult(IRUnitT &amp;IR) const</div><div class="ttdoc">Get the cached result of an analysis pass for a given IR unit.</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00793">PassManager.h:793</a></div></div>
<div class="ttc" id="aLoopInfo_8cpp_html_ab4c7e3039b29b12e4dc97bcae93d79c3"><div class="ttname"><a href="LoopInfo_8cpp.html#ab4c7e3039b29b12e4dc97bcae93d79c3">Direction</a></div><div class="ttdeci">Loop::LoopBounds::Direction Direction</div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8cpp_source.html#l00230">LoopInfo.cpp:230</a></div></div>
<div class="ttc" id="aCasting_8h_html"><div class="ttname"><a href="Casting_8h.html">Casting.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_aa0953557ed13c0ed48e740653e07c979"><div class="ttname"><a href="namespacellvm.html#aa0953557ed13c0ed48e740653e07c979">llvm::post_order</a></div><div class="ttdeci">iterator_range&lt; po_iterator&lt; T &gt; &gt; post_order(const T &amp;G)</div><div class="ttdef"><b>Definition:</b> <a href="PostOrderIterator_8h_source.html#l00191">PostOrderIterator.h:191</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_html_a47fd84cb035443c529e17a54beae390f"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a47fd84cb035443c529e17a54beae390f">llvm::slpvectorizer::BoUpSLP::areAnalyzedReductionVals</a></div><div class="ttdeci">bool areAnalyzedReductionVals(ArrayRef&lt; Value * &gt; VL) const</div><div class="ttdoc">Checks if the provided list of reduced values was checked already for vectorization.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l02228">SLPVectorizer.cpp:2228</a></div></div>
<div class="ttc" id="aFunction_8h_html"><div class="ttname"><a href="Function_8h.html">Function.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a7c779ce2ba55bc94f52014fc25f3d520"><div class="ttname"><a href="classllvm_1_1Value.html#a7c779ce2ba55bc94f52014fc25f3d520">llvm::Value::hasNUses</a></div><div class="ttdeci">bool hasNUses(unsigned N) const</div><div class="ttdoc">Return true if this Value has exactly N uses.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00148">Value.cpp:148</a></div></div>
<div class="ttc" id="aclassllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1nodes__iterator_html_a4c4742270efd4962f67118785836da65"><div class="ttname"><a href="classllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1nodes__iterator.html#a4c4742270efd4962f67118785836da65">llvm::GraphTraits&lt; BoUpSLP * &gt;::nodes_iterator::nodes_iterator</a></div><div class="ttdeci">nodes_iterator(const ItTy &amp;It2)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03492">SLPVectorizer.cpp:3492</a></div></div>
<div class="ttc" id="aclassllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1nodes__iterator_html_a7c96b270649e7b4bb961a85c9a03852c"><div class="ttname"><a href="classllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1nodes__iterator.html#a7c96b270649e7b4bb961a85c9a03852c">llvm::GraphTraits&lt; BoUpSLP * &gt;::nodes_iterator::operator*</a></div><div class="ttdeci">NodeRef operator*()</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03493">SLPVectorizer.cpp:3493</a></div></div>
<div class="ttc" id="aDOTGraphTraits_8h_html"><div class="ttname"><a href="DOTGraphTraits_8h.html">DOTGraphTraits.h</a></div></div>
<div class="ttc" id="astructllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_html_a54ec406eac73f6b06dd97f1d58c8bb97"><div class="ttname"><a href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4.html#a54ec406eac73f6b06dd97f1d58c8bb97">llvm::GraphTraits&lt; BoUpSLP * &gt;::nodes_begin</a></div><div class="ttdeci">static nodes_iterator nodes_begin(BoUpSLP *R)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03501">SLPVectorizer.cpp:3501</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a405ff61e8571b58fecaa716540af108f"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a405ff61e8571b58fecaa716540af108f">isFirstInsertElement</a></div><div class="ttdeci">static bool isFirstInsertElement(const InsertElementInst *IE1, const InsertElementInst *IE2)</div><div class="ttdoc">Checks if the IE1 instructions is followed by IE2 instruction in the buildvector sequence.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l07727">SLPVectorizer.cpp:7727</a></div></div>
<div class="ttc" id="aAMDGPULowerKernelArguments_8cpp_html_a1161e5a4e753384aaba3a8e4533c4261"><div class="ttname"><a href="AMDGPULowerKernelArguments_8cpp.html#a1161e5a4e753384aaba3a8e4533c4261">Arguments</a></div><div class="ttdeci">AMDGPU Lower Kernel Arguments</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPULowerKernelArguments_8cpp_source.html#l00240">AMDGPULowerKernelArguments.cpp:240</a></div></div>
<div class="ttc" id="aclassllvm_1_1MapVector_html_acf4c09e1f30cdd4e0b5b1b8a236ead34"><div class="ttname"><a href="classllvm_1_1MapVector.html#acf4c09e1f30cdd4e0b5b1b8a236ead34">llvm::MapVector::size</a></div><div class="ttdeci">size_type size() const</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00061">MapVector.h:61</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_adc01a7457de85fc52a3bb860d7e1c6a4"><div class="ttname"><a href="classllvm_1_1Type.html#adc01a7457de85fc52a3bb860d7e1c6a4">llvm::Type::getPointerTo</a></div><div class="ttdeci">PointerType * getPointerTo(unsigned AddrSpace=0) const</div><div class="ttdoc">Return a pointer to the current type.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00776">Type.cpp:776</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLibraryInfo_html"><div class="ttname"><a href="classllvm_1_1TargetLibraryInfo.html">llvm::TargetLibraryInfo</a></div><div class="ttdoc">Provides information about what library functions are available for the current target.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLibraryInfo_8h_source.html#l00234">TargetLibraryInfo.h:234</a></div></div>
<div class="ttc" id="aPPCCTRLoopsVerify_8cpp_html_a593cc2f204f7b2edc16ee222c37c3196"><div class="ttname"><a href="PPCCTRLoopsVerify_8cpp.html#a593cc2f204f7b2edc16ee222c37c3196">verify</a></div><div class="ttdeci">ppc ctr loops verify</div><div class="ttdef"><b>Definition:</b> <a href="PPCCTRLoopsVerify_8cpp_source.html#l00076">PPCCTRLoopsVerify.cpp:76</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html_a176409317fc26e8be3c6af0193643c27"><div class="ttname"><a href="classllvm_1_1User.html#a176409317fc26e8be3c6af0193643c27">llvm::User::operand_values</a></div><div class="ttdeci">iterator_range&lt; value_op_iterator &gt; operand_values()</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00266">User.h:266</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a2fd40bb67aec98438b791520159fb146"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a2fd40bb67aec98438b791520159fb146">buildUseMask</a></div><div class="ttdeci">static SmallBitVector buildUseMask(int VF, ArrayRef&lt; int &gt; Mask, UseMask MaskArg)</div><div class="ttdoc">Prepares a use bitset for the given mask either for the first argument or for the second.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00342">SLPVectorizer.cpp:342</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_html_a51b254a1b9cc02e8f8790cdd85b36a7f"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a51b254a1b9cc02e8f8790cdd85b36a7f">llvm::slpvectorizer::BoUpSLP::analyzedReductionVals</a></div><div class="ttdeci">void analyzedReductionVals(ArrayRef&lt; Value * &gt; VL)</div><div class="ttdoc">Adds the list of reduced values to list of already checked values for the vectorization.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l02233">SLPVectorizer.cpp:2233</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_ad3a526067810066884b7bb20ad94dcde"><div class="ttname"><a href="SLPVectorizer_8cpp.html#ad3a526067810066884b7bb20ad94dcde">matchRdxBop</a></div><div class="ttdeci">static bool matchRdxBop(Instruction *I, Value *&amp;V0, Value *&amp;V1)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l13129">SLPVectorizer.cpp:13129</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a670980c63f2e5ca39022baf96173eb9c"><div class="ttname"><a href="classllvm_1_1Type.html#a670980c63f2e5ca39022baf96173eb9c">llvm::Type::isPPC_FP128Ty</a></div><div class="ttdeci">bool isPPC_FP128Ty() const</div><div class="ttdoc">Return true if this is powerpc long double.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00166">Type.h:166</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a7568c08b526dbf7f7b5402f3eb605b55"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a7568c08b526dbf7f7b5402f3eb605b55">allConstant</a></div><div class="ttdeci">static bool allConstant(ArrayRef&lt; Value * &gt; VL)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00252">SLPVectorizer.cpp:252</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a34c987c590db0e5cff66d9869a34c556"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a34c987c590db0e5cff66d9869a34c556">llvm::TargetTransformInfo::getMemoryOpCost</a></div><div class="ttdeci">InstructionCost getMemoryOpCost(unsigned Opcode, Type *Src, Align Alignment, unsigned AddressSpace, TTI::TargetCostKind CostKind=TTI::TCK_RecipThroughput, OperandValueInfo OpdInfo={OK_AnyValue, OP_None}, const Instruction *I=nullptr) const</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00941">TargetTransformInfo.cpp:941</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_aac0ea55010b7b1a301e65a0baea057aa"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">llvm::SmallVectorImpl::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00614">SmallVector.h:614</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a9d624115133c3a9ac3109be4be89a32f"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a9d624115133c3a9ac3109be4be89a32f">AliasedCheckLimit</a></div><div class="ttdeci">static const unsigned AliasedCheckLimit</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00182">SLPVectorizer.cpp:182</a></div></div>
<div class="ttc" id="aExpandLargeDivRem_8cpp_html_ae64f9cd0977a8b47570154312540d7d2"><div class="ttname"><a href="ExpandLargeDivRem_8cpp.html#ae64f9cd0977a8b47570154312540d7d2">runImpl</a></div><div class="ttdeci">static bool runImpl(Function &amp;F, const TargetLowering &amp;TLI)</div><div class="ttdef"><b>Definition:</b> <a href="ExpandLargeDivRem_8cpp_source.html#l00056">ExpandLargeDivRem.cpp:56</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a2be3583dac92a031fa1458d4d992c78bac1aa7b798ba11d2e497d5cce6ce6d3dc"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78bac1aa7b798ba11d2e497d5cce6ce6d3dc">llvm::CmpInst::ICMP_SGE</a></div><div class="ttdeci">@ ICMP_SGE</div><div class="ttdoc">signed greater or equal</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00746">InstrTypes.h:746</a></div></div>
<div class="ttc" id="anamespacellvm_1_1MCID_html_ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec"><div class="ttname"><a href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec">llvm::MCID::Add</a></div><div class="ttdeci">@ Add</div><div class="ttdef"><b>Definition:</b> <a href="MCInstrDesc_8h_source.html#l00186">MCInstrDesc.h:186</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallSet_html_a1679469af9bb8ccfbe98441fb8228c79"><div class="ttname"><a href="classllvm_1_1SmallSet.html#a1679469af9bb8ccfbe98441fb8228c79">llvm::SmallSet::insert</a></div><div class="ttdeci">std::pair&lt; const_iterator, bool &gt; insert(const T &amp;V)</div><div class="ttdoc">insert - Insert an element into the set if it isn't already there.</div><div class="ttdef"><b>Definition:</b> <a href="SmallSet_8h_source.html#l00177">SmallSet.h:177</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a3ca9742688618517cc4690fb947fb609"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a3ca9742688618517cc4690fb947fb609">isSimple</a></div><div class="ttdeci">static bool isSimple(Instruction *I)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00821">SLPVectorizer.cpp:821</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1Hwreg_html_a6467ebe1e09a75203dd5f14bdfe21d11"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1Hwreg.html#a6467ebe1e09a75203dd5f14bdfe21d11">llvm::AMDGPU::Hwreg::Width</a></div><div class="ttdeci">Width</div><div class="ttdef"><b>Definition:</b> <a href="SIDefines_8h_source.html#l00449">SIDefines.h:449</a></div></div>
<div class="ttc" id="anamespacellvm_html_a2ec9079c9e11f3cad2a09d84a9c617f6"><div class="ttname"><a href="namespacellvm.html#a2ec9079c9e11f3cad2a09d84a9c617f6">llvm::getAlign</a></div><div class="ttdeci">bool getAlign(const Function &amp;F, unsigned index, unsigned &amp;align)</div><div class="ttdef"><b>Definition:</b> <a href="NVPTXUtilities_8cpp_source.html#l00295">NVPTXUtilities.cpp:295</a></div></div>
<div class="ttc" id="aclassllvm_1_1InstructionCost_html_a57207993e2fe6ec98912e8072e4600bc"><div class="ttname"><a href="classllvm_1_1InstructionCost.html#a57207993e2fe6ec98912e8072e4600bc">llvm::InstructionCost::getInvalid</a></div><div class="ttdeci">static InstructionCost getInvalid(CostType Val=0)</div><div class="ttdef"><b>Definition:</b> <a href="InstructionCost_8h_source.html#l00073">InstructionCost.h:73</a></div></div>
<div class="ttc" id="anamespacellvm_html_a0e2e479cf4860dc8a00614e36ee3d5e9"><div class="ttname"><a href="namespacellvm.html#a0e2e479cf4860dc8a00614e36ee3d5e9">llvm::hash_value</a></div><div class="ttdeci">hash_code hash_value(const FixedPointSemantics &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="APFixedPoint_8h_source.html#l00128">APFixedPoint.h:128</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_html_a782cc6906561f01e563f30e50833235d"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a782cc6906561f01e563f30e50833235d">llvm::slpvectorizer::BoUpSLP::getMaximumVF</a></div><div class="ttdeci">unsigned getMaximumVF(unsigned ElemWidth, unsigned Opcode) const</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l01132">SLPVectorizer.cpp:1132</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallBitVector_html_aa4dce99d953b67f83ef932810a44e21f"><div class="ttname"><a href="classllvm_1_1SmallBitVector.html#aa4dce99d953b67f83ef932810a44e21f">llvm::SmallBitVector::size</a></div><div class="ttdeci">size_type size() const</div><div class="ttdoc">Returns the number of bits in this bitvector.</div><div class="ttdef"><b>Definition:</b> <a href="SmallBitVector_8h_source.html#l00195">SmallBitVector.h:195</a></div></div>
<div class="ttc" id="aScalarEvolutionExpressions_8h_html"><div class="ttname"><a href="ScalarEvolutionExpressions_8h.html">ScalarEvolutionExpressions.h</a></div></div>
<div class="ttc" id="aclassBoUpSLP_1_1ShuffleInstructionBuilder_html_ae036b393a449f51cd7d7bf0458dac6be"><div class="ttname"><a href="classBoUpSLP_1_1ShuffleInstructionBuilder.html#ae036b393a449f51cd7d7bf0458dac6be">BoUpSLP::ShuffleInstructionBuilder::addOrdered</a></div><div class="ttdeci">void addOrdered(Value *V1, ArrayRef&lt; unsigned &gt; Order)</div><div class="ttdoc">Adds another one input vector and the mask for the shuffling.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l08926">SLPVectorizer.cpp:8926</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_ac26154a24f393f523c87cc5f8239f36c"><div class="ttname"><a href="classllvm_1_1Instruction.html#ac26154a24f393f523c87cc5f8239f36c">llvm::Instruction::BinaryOps</a></div><div class="ttdeci">BinaryOps</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00809">Instruction.h:809</a></div></div>
<div class="ttc" id="aclassllvm_1_1DominatorTreeAnalysis_html"><div class="ttname"><a href="classllvm_1_1DominatorTreeAnalysis.html">llvm::DominatorTreeAnalysis</a></div><div class="ttdoc">Analysis pass which computes a DominatorTree.</div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00279">Dominators.h:279</a></div></div>
<div class="ttc" id="aclassllvm_1_1InsertElementInst_html_a5532ffa629e5d85d605bb379f7aed857"><div class="ttname"><a href="classllvm_1_1InsertElementInst.html#a5532ffa629e5d85d605bb379f7aed857">llvm::InsertElementInst::getType</a></div><div class="ttdeci">VectorType * getType() const</div><div class="ttdoc">Overload to return most specific vector type.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01978">Instructions.h:1978</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands_html"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1VLOperands.html">llvm::slpvectorizer::BoUpSLP::VLOperands</a></div><div class="ttdoc">A helper data structure to hold the operands of a vector of instructions.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l01484">SLPVectorizer.cpp:1484</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a6d3231fb84ed4182ec22e9442a87dbf8"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a6d3231fb84ed4182ec22e9442a87dbf8">llvm::BasicBlock::reverse_iterator</a></div><div class="ttdeci">InstListType::reverse_iterator reverse_iterator</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00089">BasicBlock.h:89</a></div></div>
<div class="ttc" id="aclassllvm_1_1ShuffleVectorInst_html"><div class="ttname"><a href="classllvm_1_1ShuffleVectorInst.html">llvm::ShuffleVectorInst</a></div><div class="ttdoc">This instruction constructs a fixed permutation of two input vectors.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02017">Instructions.h:2017</a></div></div>
<div class="ttc" id="aclassllvm_1_1OptimizationRemark_html"><div class="ttname"><a href="classllvm_1_1OptimizationRemark.html">llvm::OptimizationRemark</a></div><div class="ttdoc">Diagnostic information for applied optimization remarks.</div><div class="ttdef"><b>Definition:</b> <a href="DiagnosticInfo_8h_source.html#l00689">DiagnosticInfo.h:689</a></div></div>
<div class="ttc" id="aclassllvm_1_1Pass_html"><div class="ttname"><a href="classllvm_1_1Pass.html">llvm::Pass</a></div><div class="ttdoc">Pass interface - Implemented by all 'passes'.</div><div class="ttdef"><b>Definition:</b> <a href="Pass_8h_source.html#l00091">Pass.h:91</a></div></div>
<div class="ttc" id="anamespacellvm_html_aac36edd0f1ce976f0025c98e88d3830eaf552e181879ad14956985859308d77d9"><div class="ttname"><a href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eaf552e181879ad14956985859308d77d9">llvm::RecurKind::FAdd</a></div><div class="ttdeci">@ FAdd</div><div class="ttdoc">Sum of floats.</div></div>
<div class="ttc" id="astructllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1ChildIteratorType_html_afd5f85f0c5276e1cc3a9bcee214ab81e"><div class="ttname"><a href="structllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1ChildIteratorType.html#afd5f85f0c5276e1cc3a9bcee214ab81e">llvm::GraphTraits&lt; BoUpSLP * &gt;::ChildIteratorType::VectorizableTree</a></div><div class="ttdeci">ContainerTy &amp; VectorizableTree</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03464">SLPVectorizer.cpp:3464</a></div></div>
<div class="ttc" id="aInstructions_8h_html"><div class="ttname"><a href="Instructions_8h.html">Instructions.h</a></div></div>
<div class="ttc" id="aPostOrderIterator_8h_html"><div class="ttname"><a href="PostOrderIterator_8h.html">PostOrderIterator.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1PreservedAnalyses_html_a937c42f77e161349ce0f999e448c7027"><div class="ttname"><a href="classllvm_1_1PreservedAnalyses.html#a937c42f77e161349ce0f999e448c7027">llvm::PreservedAnalyses::preserveSet</a></div><div class="ttdeci">void preserveSet()</div><div class="ttdoc">Mark an analysis set as preserved.</div><div class="ttdef"><b>Definition:</b> <a href="PassManager_8h_source.html#l00188">PassManager.h:188</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a0109582eb646d501101a7e6a059814fb"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a0109582eb646d501101a7e6a059814fb">isLoadCombineCandidateImpl</a></div><div class="ttdeci">static bool isLoadCombineCandidateImpl(Value *Root, unsigned NumElts, TargetTransformInfo *TTI, bool MustMatchOrInst)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l07518">SLPVectorizer.cpp:7518</a></div></div>
<div class="ttc" id="aPassSupport_8h_html_aaa970fc931c1c63037a8182e028d04b1"><div class="ttname"><a href="PassSupport_8h.html#aaa970fc931c1c63037a8182e028d04b1">INITIALIZE_PASS_BEGIN</a></div><div class="ttdeci">#define INITIALIZE_PASS_BEGIN(passName, arg, name, cfg, analysis)</div><div class="ttdef"><b>Definition:</b> <a href="PassSupport_8h_source.html#l00052">PassSupport.h:52</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a2d9861feadd3a09792967a012559e7b2"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">llvm::PatternMatch::m_Specific</a></div><div class="ttdeci">specificval_ty m_Specific(const Value *V)</div><div class="ttdoc">Match if we have a specific specified value.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00772">PatternMatch.h:772</a></div></div>
<div class="ttc" id="aclassllvm_1_1ilist__iterator_html_a78fdbf2880abbb855abdb5bf030d9105"><div class="ttname"><a href="classllvm_1_1ilist__iterator.html#a78fdbf2880abbb855abdb5bf030d9105">llvm::ilist_iterator::getReverse</a></div><div class="ttdeci">ilist_iterator&lt; OptionsT, !IsReverse, IsConst &gt; getReverse() const</div><div class="ttdoc">Get a reverse iterator to the same node.</div><div class="ttdef"><b>Definition:</b> <a href="ilist__iterator_8h_source.html#l00121">ilist_iterator.h:121</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_ab4f3bf98b5054831b608852e33427814"><div class="ttname"><a href="classllvm_1_1Instruction.html#ab4f3bf98b5054831b608852e33427814">llvm::Instruction::getDebugLoc</a></div><div class="ttdeci">const DebugLoc &amp; getDebugLoc() const</div><div class="ttdoc">Return the debug location for this node as a DebugLoc.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00358">Instruction.h:358</a></div></div>
<div class="ttc" id="aUser_8h_html"><div class="ttname"><a href="User_8h.html">User.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_add71474638430694c84640146383fc44"><div class="ttname"><a href="namespacellvm.html#add71474638430694c84640146383fc44">llvm::hash_combine</a></div><div class="ttdeci">hash_code hash_combine(const Ts &amp;...args)</div><div class="ttdoc">Combine values into a single hash_code.</div><div class="ttdef"><b>Definition:</b> <a href="Hashing_8h_source.html#l00613">Hashing.h:613</a></div></div>
<div class="ttc" id="aclassllvm_1_1StoreInst_html_ac03c1c093059ea000216af8dd6f2dbf4"><div class="ttname"><a href="classllvm_1_1StoreInst.html#ac03c1c093059ea000216af8dd6f2dbf4">llvm::StoreInst::getPointerOperand</a></div><div class="ttdeci">Value * getPointerOperand()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00393">Instructions.h:393</a></div></div>
<div class="ttc" id="aclassllvm_1_1raw__ostream_html_a8fdf5cdf041c8aded7e3308c1c3efacc"><div class="ttname"><a href="classllvm_1_1raw__ostream.html#a8fdf5cdf041c8aded7e3308c1c3efacc">llvm::raw_ostream::indent</a></div><div class="ttdeci">raw_ostream &amp; indent(unsigned NumSpaces)</div><div class="ttdoc">indent - Insert 'NumSpaces' spaces.</div><div class="ttdef"><b>Definition:</b> <a href="raw__ostream_8cpp_source.html#l00495">raw_ostream.cpp:495</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallSet_html_afd7c135e18f2d7253d4f8545cd7b1756"><div class="ttname"><a href="classllvm_1_1SmallSet.html#afd7c135e18f2d7253d4f8545cd7b1756">llvm::SmallSet::size</a></div><div class="ttdeci">size_type size() const</div><div class="ttdef"><b>Definition:</b> <a href="SmallSet_8h_source.html#l00159">SmallSet.h:159</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a2be3583dac92a031fa1458d4d992c78ba607cecdc5172814382033e001ed11fad"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78ba607cecdc5172814382033e001ed11fad">llvm::CmpInst::ICMP_UGT</a></div><div class="ttdeci">@ ICMP_UGT</div><div class="ttdoc">unsigned greater than</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00741">InstrTypes.h:741</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html_a2eeb1c7ed1cfe403f2ae0470e36c07e2"><div class="ttname"><a href="classllvm_1_1User.html#a2eeb1c7ed1cfe403f2ae0470e36c07e2">llvm::User::op_begin</a></div><div class="ttdeci">op_iterator op_begin()</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00234">User.h:234</a></div></div>
<div class="ttc" id="aDominators_8h_html"><div class="ttname"><a href="Dominators_8h.html">Dominators.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_ab2caa29167597390ab2fc3cf30d70389"><div class="ttname"><a href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">llvm::CallBase::getArgOperand</a></div><div class="ttdeci">Value * getArgOperand(unsigned i) const</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01351">InstrTypes.h:1351</a></div></div>
<div class="ttc" id="aSmallBitVector_8h_html"><div class="ttname"><a href="SmallBitVector_8h.html">SmallBitVector.h</a></div></div>
<div class="ttc" id="aregcomp_8c_html_a0240ac851181b84ac374872dc5434ee4"><div class="ttname"><a href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a></div><div class="ttdeci">#define N</div></div>
<div class="ttc" id="aclassllvm_1_1AAResultsWrapperPass_html"><div class="ttname"><a href="classllvm_1_1AAResultsWrapperPass.html">llvm::AAResultsWrapperPass</a></div><div class="ttdoc">A wrapper pass to provide the legacy pass manager access to a suitably prepared AAResults object.</div><div class="ttdef"><b>Definition:</b> <a href="AliasAnalysis_8h_source.html#l00933">AliasAnalysis.h:933</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_html_abeef90aa6ca3783373fedb682df96b6e"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#abeef90aa6ca3783373fedb682df96b6e">llvm::slpvectorizer::BoUpSLP::doesRootHaveInTreeUses</a></div><div class="ttdeci">bool doesRootHaveInTreeUses() const</div><div class="ttdoc">Returns whether the root node has in-tree uses.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l01041">SLPVectorizer.cpp:1041</a></div></div>
<div class="ttc" id="anamespacellvm_html_af80edfc5e42059e045aa7bf7fe42bee3"><div class="ttname"><a href="namespacellvm.html#af80edfc5e42059e045aa7bf7fe42bee3">llvm::hash_combine_range</a></div><div class="ttdeci">hash_code hash_combine_range(InputIteratorT first, InputIteratorT last)</div><div class="ttdoc">Compute a hash_code for a sequence of values.</div><div class="ttdef"><b>Definition:</b> <a href="Hashing_8h_source.html#l00491">Hashing.h:491</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a98c685a0c53f3f7ed5f4793890a6c850"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a98c685a0c53f3f7ed5f4793890a6c850">llvm::DenseMapBase&lt; SmallDenseMap&lt; KeyT, ValueT, 4, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::try_emplace</a></div><div class="ttdeci">std::pair&lt; iterator, bool &gt; try_emplace(KeyT &amp;&amp;Key, Ts &amp;&amp;... Args)</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00222">DenseMap.h:222</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a1a7f07aaef6a3bee130bf0e0f0536802"><div class="ttname"><a href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">llvm::Instruction::getParent</a></div><div class="ttdeci">const BasicBlock * getParent() const</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00090">Instruction.h:90</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_a0c8ffe664a36e30d49c84d0aded2fe08"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a0c8ffe664a36e30d49c84d0aded2fe08">llvm::SmallVectorImpl::pop_back_val</a></div><div class="ttdeci">T pop_back_val()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00677">SmallVector.h:677</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_aa7414ba9f658ff1287d22a4b8fe81bcb"><div class="ttname"><a href="classllvm_1_1CmpInst.html#aa7414ba9f658ff1287d22a4b8fe81bcb">llvm::CmpInst::getPredicate</a></div><div class="ttdeci">Predicate getPredicate() const</div><div class="ttdoc">Return the predicate for this instruction.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00808">InstrTypes.h:808</a></div></div>
<div class="ttc" id="anamespacellvm_html_abed730d9d5b8f4c70f4fbe1094a0157f"><div class="ttname"><a href="namespacellvm.html#abed730d9d5b8f4c70f4fbe1094a0157f">llvm::doesNotNeedToSchedule</a></div><div class="ttdeci">static bool doesNotNeedToSchedule(ArrayRef&lt; Value * &gt; VL)</div><div class="ttdoc">Checks if the specified array of instructions does not require scheduling.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00954">SLPVectorizer.cpp:954</a></div></div>
<div class="ttc" id="anamespacellvm_html_a13c1b5a253da5da49ce33d03dc1efc07"><div class="ttname"><a href="namespacellvm.html#a13c1b5a253da5da49ce33d03dc1efc07">llvm::to_string</a></div><div class="ttdeci">std::string to_string(const T &amp;Value)</div><div class="ttdef"><b>Definition:</b> <a href="ScopedPrinter_8h_source.html#l00085">ScopedPrinter.h:85</a></div></div>
<div class="ttc" id="aclassllvm_1_1GlobalsAAWrapperPass_html"><div class="ttname"><a href="classllvm_1_1GlobalsAAWrapperPass.html">llvm::GlobalsAAWrapperPass</a></div><div class="ttdoc">Legacy wrapper pass to provide the GlobalsAAResult object.</div><div class="ttdef"><b>Definition:</b> <a href="GlobalsModRef_8h_source.html#l00142">GlobalsModRef.h:142</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html_a85ffb6531d4cda988ea81f18d4e56fb7"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">llvm::ArrayRef::size</a></div><div class="ttdeci">size_t size() const</div><div class="ttdoc">size - Get the array size.</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00163">ArrayRef.h:163</a></div></div>
<div class="ttc" id="aIVUsers_8cpp_html_a4e5b9edb51eec9dbca592075eb64dfcb"><div class="ttname"><a href="IVUsers_8cpp.html#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a></div><div class="ttdeci">iv Induction Variable Users</div><div class="ttdef"><b>Definition:</b> <a href="IVUsers_8cpp_source.html#l00048">IVUsers.cpp:48</a></div></div>
<div class="ttc" id="aTargetTransformInfo_8h_html"><div class="ttname"><a href="TargetTransformInfo_8h.html">TargetTransformInfo.h</a></div></div>
<div class="ttc" id="astructllvm_1_1VFShape_html_a33df83a8555fc8dd7c7d547576abb354"><div class="ttname"><a href="structllvm_1_1VFShape.html#a33df83a8555fc8dd7c7d547576abb354">llvm::VFShape::get</a></div><div class="ttdeci">static VFShape get(const CallInst &amp;CI, ElementCount EC, bool HasGlobalPred)</div><div class="ttdef"><b>Definition:</b> <a href="VectorUtils_8h_source.html#l00108">VectorUtils.h:108</a></div></div>
<div class="ttc" id="astructllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo_html_a2b5258ea831ff51e2dc51dd405c547ba"><div class="ttname"><a href="structllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo.html#a2b5258ea831ff51e2dc51dd405c547ba">llvm::slpvectorizer::BoUpSLP::EdgeInfo::dump</a></div><div class="ttdeci">LLVM_DUMP_METHOD void dump() const</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l01193">SLPVectorizer.cpp:1193</a></div></div>
<div class="ttc" id="aclassllvm_1_1raw__svector__ostream_html"><div class="ttname"><a href="classllvm_1_1raw__svector__ostream.html">llvm::raw_svector_ostream</a></div><div class="ttdoc">A raw_ostream that writes to an SmallVector or SmallString.</div><div class="ttdef"><b>Definition:</b> <a href="raw__ostream_8h_source.html#l00672">raw_ostream.h:672</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_acbea7151f5e66776f92f7b4e305418d6"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#acbea7151f5e66776f92f7b4e305418d6">llvm::TargetTransformInfo::getExtractWithExtendCost</a></div><div class="ttdeci">InstructionCost getExtractWithExtendCost(unsigned Opcode, Type *Dst, VectorType *VecTy, unsigned Index) const</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00880">TargetTransformInfo.cpp:880</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html"><div class="ttname"><a href="classllvm_1_1PHINode.html">llvm::PHINode</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02708">Instructions.h:2708</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a8de021e28a3c04c9216ad8decf104f02"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a8de021e28a3c04c9216ad8decf104f02">llvm::BasicBlock::getTerminator</a></div><div class="ttdeci">const Instruction * getTerminator() const LLVM_READONLY</div><div class="ttdoc">Returns the terminator instruction if the block is well formed or null if the block is not well forme...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00127">BasicBlock.h:127</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html">llvm::PatternMatch</a></div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00047">PatternMatch.h:47</a></div></div>
<div class="ttc" id="anamespacellvm_html_a2162d123f222998300d308bdefdb38b9"><div class="ttname"><a href="namespacellvm.html#a2162d123f222998300d308bdefdb38b9">llvm::set_intersect</a></div><div class="ttdeci">void set_intersect(S1Ty &amp;S1, const S2Ty &amp;S2)</div><div class="ttdoc">set_intersect(A, B) - Compute A := A ^ B Identical to set_intersection, except that it works on set&lt;&gt;...</div><div class="ttdef"><b>Definition:</b> <a href="SetOperations_8h_source.html#l00040">SetOperations.h:40</a></div></div>
<div class="ttc" id="ablake3__impl_8h_html_a78823051d1dad34b9b3d8120112e674d"><div class="ttname"><a href="blake3__impl_8h.html#a78823051d1dad34b9b3d8120112e674d">IV</a></div><div class="ttdeci">static const uint32_t IV[8]</div><div class="ttdef"><b>Definition:</b> <a href="blake3__impl_8h_source.html#l00077">blake3_impl.h:77</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html">llvm::SmallVectorImpl&lt; int &gt;</a></div></div>
<div class="ttc" id="astructllvm_1_1DefaultDOTGraphTraits_html"><div class="ttname"><a href="structllvm_1_1DefaultDOTGraphTraits.html">llvm::DefaultDOTGraphTraits</a></div><div class="ttdoc">DefaultDOTGraphTraits - This class provides the default implementations of all of the DOTGraphTraits ...</div><div class="ttdef"><b>Definition:</b> <a href="DOTGraphTraits_8h_source.html#l00028">DOTGraphTraits.h:28</a></div></div>
<div class="ttc" id="anamespacellvm_html_a6b0ac1fa4f05de76413c5e0ca6334035"><div class="ttname"><a href="namespacellvm.html#a6b0ac1fa4f05de76413c5e0ca6334035">llvm::reverse</a></div><div class="ttdeci">auto reverse(ContainerTy &amp;&amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00484">STLExtras.h:484</a></div></div>
<div class="ttc" id="aTransforms_2Vectorize_8h_html"><div class="ttname"><a href="Transforms_2Vectorize_8h.html">Vectorize.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html"><div class="ttname"><a href="classllvm_1_1CallBase.html">llvm::CallBase</a></div><div class="ttdoc">Base class for all callable instructions (InvokeInst and CallInst) Holds everything related to callin...</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01184">InstrTypes.h:1184</a></div></div>
<div class="ttc" id="aclassllvm_1_1StoreInst_html_a67e539f9ec2e837c7b9653cb57c89b1e"><div class="ttname"><a href="classllvm_1_1StoreInst.html#a67e539f9ec2e837c7b9653cb57c89b1e">llvm::StoreInst::getPointerOperandType</a></div><div class="ttdeci">Type * getPointerOperandType() const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00396">Instructions.h:396</a></div></div>
<div class="ttc" id="aclassllvm_1_1Pass_html_a6590d0486104165ca40c7df0707f7b9e"><div class="ttname"><a href="classllvm_1_1Pass.html#a6590d0486104165ca40c7df0707f7b9e">llvm::Pass::getAnalysisUsage</a></div><div class="ttdeci">virtual void getAnalysisUsage(AnalysisUsage &amp;) const</div><div class="ttdoc">getAnalysisUsage - This function should be overriden by passes that need analysis information to do t...</div><div class="ttdef"><b>Definition:</b> <a href="Pass_8cpp_source.html#l00098">Pass.cpp:98</a></div></div>
<div class="ttc" id="anamespacellvm_html_ab9c6b351507d3c0730f4290919d43a12"><div class="ttname"><a href="namespacellvm.html#ab9c6b351507d3c0730f4290919d43a12">llvm::ArrayRef</a></div><div class="ttdeci">ArrayRef(const T &amp;OneElt) -&gt; ArrayRef&lt; T &gt;</div></div>
<div class="ttc" id="aDerivedTypes_8h_html"><div class="ttname"><a href="DerivedTypes_8h.html">DerivedTypes.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImpl_html"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html">llvm::SmallPtrSetImpl&lt; Value * &gt;</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisManager_html"><div class="ttname"><a href="classllvm_1_1AnalysisManager.html">llvm::AnalysisManager</a></div><div class="ttdoc">A container for analyses that lazily runs them and caches their results.</div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8h_source.html#l00042">InstructionSimplify.h:42</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_aae9f536130472bd3fbdd23c3d4486b3b"><div class="ttname"><a href="SLPVectorizer_8cpp.html#aae9f536130472bd3fbdd23c3d4486b3b">getLocation</a></div><div class="ttdeci">static MemoryLocation getLocation(Instruction *I)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00812">SLPVectorizer.cpp:812</a></div></div>
<div class="ttc" id="aclassllvm_1_1IntegerType_html_a14f7b4f1aed38192fb6b7772eb506bdb"><div class="ttname"><a href="classllvm_1_1IntegerType.html#a14f7b4f1aed38192fb6b7772eb506bdb">llvm::IntegerType::get</a></div><div class="ttdeci">static IntegerType * get(LLVMContext &amp;C, unsigned NumBits)</div><div class="ttdoc">This static method is the primary way of constructing an IntegerType.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00313">Type.cpp:313</a></div></div>
<div class="ttc" id="aclassllvm_1_1FunctionPass_html"><div class="ttname"><a href="classllvm_1_1FunctionPass.html">llvm::FunctionPass</a></div><div class="ttdoc">FunctionPass class - This class is used to implement most global optimizations.</div><div class="ttdef"><b>Definition:</b> <a href="Pass_8h_source.html#l00308">Pass.h:308</a></div></div>
<div class="ttc" id="astructllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo_html_a8f5111c835c412c59d5f3f158a2214ed"><div class="ttname"><a href="structllvm_1_1slpvectorizer_1_1BoUpSLP_1_1EdgeInfo.html#a8f5111c835c412c59d5f3f158a2214ed">llvm::slpvectorizer::BoUpSLP::EdgeInfo::operator&lt;&lt;</a></div><div class="ttdeci">friend raw_ostream &amp; operator&lt;&lt;(raw_ostream &amp;OS, const BoUpSLP::EdgeInfo &amp;EI)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l01183">SLPVectorizer.cpp:1183</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallInst_html"><div class="ttname"><a href="classllvm_1_1CallInst.html">llvm::CallInst</a></div><div class="ttdoc">This class represents a function call, abstracting a target machine's calling convention.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01485">Instructions.h:1485</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_html_a0c8459111fa90ca87265908605c4c9fe"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a0c8459111fa90ca87265908605c4c9fe">llvm::slpvectorizer::BoUpSLP::isVectorizedFirstNode</a></div><div class="ttdeci">bool isVectorizedFirstNode() const</div><div class="ttdoc">Checks if the very first tree node is going to be vectorized.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l01029">SLPVectorizer.cpp:1029</a></div></div>
<div class="ttc" id="anamespacellvm_html_aac36edd0f1ce976f0025c98e88d3830ead76b595f89852f41ac50173abae6da05"><div class="ttname"><a href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ead76b595f89852f41ac50173abae6da05">llvm::RecurKind::FMin</a></div><div class="ttdeci">@ FMin</div><div class="ttdoc">FP min implemented in terms of select(cmp()).</div></div>
<div class="ttc" id="anamespacellvm_html_ae058c4750de2c85f12a1f96841ac9ae3"><div class="ttname"><a href="namespacellvm.html#ae058c4750de2c85f12a1f96841ac9ae3">llvm::isGuaranteedNotToBePoison</a></div><div class="ttdeci">bool isGuaranteedNotToBePoison(const Value *V, AssumptionCache *AC=nullptr, const Instruction *CtxI=nullptr, const DominatorTree *DT=nullptr, unsigned Depth=0)</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l05588">ValueTracking.cpp:5588</a></div></div>
<div class="ttc" id="alib_2CodeGen_2README_8txt_html_a09776db24cf586ec9f1e18f3bae14099"><div class="ttname"><a href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a></div><div class="ttdeci">Common register allocation spilling lr str ldr sxth r3 ldr mla r4 can lr mov lr str ldr sxth r3 mla r4 and then merge mul and lr str ldr sxth r3 mla r4 It also increase the likelihood the store may become dead bb27 Successors according to LLVM BB</div><div class="ttdef"><b>Definition:</b> <a href="lib_2CodeGen_2README_8txt_source.html#l00039">README.txt:39</a></div></div>
<div class="ttc" id="aHexagonCommonGEP_8cpp_html_ad532e8710e50302e0a376b61c91fa91d"><div class="ttname"><a href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a></div><div class="ttdeci">Hexagon Common GEP</div><div class="ttdef"><b>Definition:</b> <a href="HexagonCommonGEP_8cpp_source.html#l00171">HexagonCommonGEP.cpp:171</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_af67833027bb46ddb390684a6f0b75398"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#af67833027bb46ddb390684a6f0b75398">llvm::TargetTransformInfo::getCallInstrCost</a></div><div class="ttdeci">InstructionCost getCallInstrCost(Function *F, Type *RetTy, ArrayRef&lt; Type * &gt; Tys, TTI::TargetCostKind CostKind=TTI::TCK_SizeAndLatency) const</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00991">TargetTransformInfo.cpp:991</a></div></div>
<div class="ttc" id="anamespacellvm_html_ad17df6f711037aaee99496571558475c"><div class="ttname"><a href="namespacellvm.html#ad17df6f711037aaee99496571558475c">llvm::initializeSLPVectorizerPass</a></div><div class="ttdeci">void initializeSLPVectorizerPass(PassRegistry &amp;)</div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisUsage_html_ae5c60fd282ee894c87ea02c3f0fcb6d0"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">llvm::AnalysisUsage::addRequired</a></div><div class="ttdeci">AnalysisUsage &amp; addRequired()</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00075">PassAnalysisSupport.h:75</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a2207681d736278c6968f548195f1f90c"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a2207681d736278c6968f548195f1f90c">isOneOf</a></div><div class="ttdeci">static Value * isOneOf(const InstructionsState &amp;S, Value *Op)</div><div class="ttdoc">Chooses the correct key for scheduling data.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00574">SLPVectorizer.cpp:574</a></div></div>
<div class="ttc" id="astructllvm_1_1GraphTraits_html"><div class="ttname"><a href="structllvm_1_1GraphTraits.html">llvm::GraphTraits</a></div><div class="ttdef"><b>Definition:</b> <a href="GraphTraits_8h_source.html#l00037">GraphTraits.h:37</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_ac44f6b9fdbb5f9cc199f8329cb0b272cae46c9eecc49bd2dc253c607e78a0fb86"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#ac44f6b9fdbb5f9cc199f8329cb0b272cae46c9eecc49bd2dc253c607e78a0fb86">llvm::TargetTransformInfo::TCC_Basic</a></div><div class="ttdeci">@ TCC_Basic</div><div class="ttdoc">The cost of a typical 'add' instruction.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00268">TargetTransformInfo.h:268</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key_html_a1958a762261549463a280bac3274d6d5"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">llvm::AMDGPU::HSAMD::Kernel::Key::Args</a></div><div class="ttdeci">constexpr char Args[]</div><div class="ttdoc">Key for Kernel::Metadata::mArgs.</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUMetadata_8h_source.html#l00394">AMDGPUMetadata.h:394</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html_abe1de1520a21f77ac57cc210bf0fb0b4"><div class="ttname"><a href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">llvm::User::getOperand</a></div><div class="ttdeci">Value * getOperand(unsigned i) const</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00169">User.h:169</a></div></div>
<div class="ttc" id="astructllvm_1_1cl_1_1desc_html"><div class="ttname"><a href="structllvm_1_1cl_1_1desc.html">llvm::cl::desc</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00411">CommandLine.h:411</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_a4aec7f237669d6c66b2386501edefa88"><div class="ttname"><a href="SLPVectorizer_8cpp.html#a4aec7f237669d6c66b2386501edefa88">MinVectorRegSizeOption</a></div><div class="ttdeci">static cl::opt&lt; int &gt; MinVectorRegSizeOption(&quot;slp-min-reg-size&quot;, cl::init(128), cl::Hidden, cl::desc(&quot;Attempt to vectorize for this register size in bits&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1RecurrenceDescriptor_html_af08d243545b64f4b77161992d0e2366e"><div class="ttname"><a href="classllvm_1_1RecurrenceDescriptor.html#af08d243545b64f4b77161992d0e2366e">llvm::RecurrenceDescriptor::isMinMaxRecurrenceKind</a></div><div class="ttdeci">static bool isMinMaxRecurrenceKind(RecurKind Kind)</div><div class="ttdoc">Returns true if the recurrence kind is any min/max kind.</div><div class="ttdef"><b>Definition:</b> <a href="IVDescriptors_8h_source.html#l00233">IVDescriptors.h:233</a></div></div>
<div class="ttc" id="anamespacellvm_1_1M68kBeads_html_a7eeab1fe8f39bf89dcd7929b816ebfcca27d0e059322508a76f918503800ef1bd"><div class="ttname"><a href="namespacellvm_1_1M68kBeads.html#a7eeab1fe8f39bf89dcd7929b816ebfcca27d0e059322508a76f918503800ef1bd">llvm::M68kBeads::Term</a></div><div class="ttdeci">@ Term</div><div class="ttdef"><b>Definition:</b> <a href="M68kBaseInfo_8h_source.html#l00090">M68kBaseInfo.h:90</a></div></div>
<div class="ttc" id="araw__ostream_8h_html"><div class="ttname"><a href="raw__ostream_8h.html">raw_ostream.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_a323137971325611ddc1b899b00b8aaa0"><div class="ttname"><a href="namespacellvm.html#a323137971325611ddc1b899b00b8aaa0">llvm::canConvertToMinOrMaxIntrinsic</a></div><div class="ttdeci">std::pair&lt; Intrinsic::ID, bool &gt; canConvertToMinOrMaxIntrinsic(ArrayRef&lt; Value * &gt; VL)</div><div class="ttdoc">Check if the values in VL are select instructions that can be converted to a min or max (vector) intr...</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l06635">ValueTracking.cpp:6635</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1VGPRIndexMode_html_a9afd95476c40096a5898ba0f06370b3a"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1VGPRIndexMode.html#a9afd95476c40096a5898ba0f06370b3a">llvm::AMDGPU::VGPRIndexMode::Id</a></div><div class="ttdeci">Id</div><div class="ttdef"><b>Definition:</b> <a href="SIDefines_8h_source.html#l00250">SIDefines.h:250</a></div></div>
<div class="ttc" id="astructllvm_1_1DOTGraphTraits_3_01BoUpSLP_01_5_01_4_html_a9946c2fd6dbd021039d7ec6e75fce182"><div class="ttname"><a href="structllvm_1_1DOTGraphTraits_3_01BoUpSLP_01_5_01_4.html#a9946c2fd6dbd021039d7ec6e75fce182">llvm::DOTGraphTraits&lt; BoUpSLP * &gt;::getNodeLabel</a></div><div class="ttdeci">std::string getNodeLabel(const TreeEntry *Entry, const BoUpSLP *R)</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03517">SLPVectorizer.cpp:3517</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html"><div class="ttname"><a href="classllvm_1_1SetVector.html">llvm::SetVector&lt; Instruction * &gt;</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImpl_html_af74676a3c7447be34bd2c1da76ec0c48"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html#af74676a3c7447be34bd2c1da76ec0c48">llvm::SmallPtrSetImpl::contains</a></div><div class="ttdeci">bool contains(ConstPtrType Ptr) const</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00389">SmallPtrSet.h:389</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_a499ea32ca1b8d16cedfe01d1e5b08f29"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a499ea32ca1b8d16cedfe01d1e5b08f29">llvm::SmallVectorImpl::reserve</a></div><div class="ttdeci">void reserve(size_type N)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00667">SmallVector.h:667</a></div></div>
<div class="ttc" id="aModuloSchedule_8cpp_html_a106e32122c569cdb42ddf61ecbb0aad1"><div class="ttname"><a href="ModuloSchedule_8cpp.html#a106e32122c569cdb42ddf61ecbb0aad1">test</a></div><div class="ttdeci">modulo schedule test</div><div class="ttdef"><b>Definition:</b> <a href="ModuloSchedule_8cpp_source.html#l02143">ModuloSchedule.cpp:2143</a></div></div>
<div class="ttc" id="aclassllvm_1_1InsertValueInst_html"><div class="ttname"><a href="classllvm_1_1InsertValueInst.html">llvm::InsertValueInst</a></div><div class="ttdoc">This instruction inserts a struct field of array element value into an aggregate value.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02566">Instructions.h:2566</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_afa38851d75434d1476444ac93f94cb4cacf63326297610dfbedd0ad408b54e3e4"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#afa38851d75434d1476444ac93f94cb4cacf63326297610dfbedd0ad408b54e3e4">llvm::TargetTransformInfo::OK_NonUniformConstantValue</a></div><div class="ttdeci">@ OK_NonUniformConstantValue</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00934">TargetTransformInfo.h:934</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_abdf352ba0545cdb2ad70f4d72b594cfa"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#abdf352ba0545cdb2ad70f4d72b594cfa">llvm::TargetTransformInfo::getStoreMinimumVF</a></div><div class="ttdeci">unsigned getStoreMinimumVF(unsigned VF, Type *ScalarMemTy, Type *ScalarValTy) const</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00689">TargetTransformInfo.cpp:689</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a7aff89f4f22502c8ad9118bed59ce21c"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a7aff89f4f22502c8ad9118bed59ce21c">llvm::PatternMatch::m_FMul</a></div><div class="ttdeci">BinaryOp_match&lt; LHS, RHS, Instruction::FMul &gt; m_FMul(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01051">PatternMatch.h:1051</a></div></div>
<div class="ttc" id="alib_2Target_2WebAssembly_2README_8txt_html_a79ea041233b5866026c3071dfc464ec0"><div class="ttname"><a href="lib_2Target_2WebAssembly_2README_8txt.html#a79ea041233b5866026c3071dfc464ec0">copy</a></div><div class="ttdeci">we should consider alternate ways to model stack dependencies Lots of things could be done in WebAssemblyTargetTransformInfo cpp there are numerous optimization related hooks that can be overridden in WebAssemblyTargetLowering Instead of the OptimizeReturned which should consider preserving the returned attribute through to MachineInstrs and extending the MemIntrinsicResults pass to do this optimization on calls too That would also let the WebAssemblyPeephole pass clean up dead defs for such as it does for stores Consider implementing and or getMachineCombinerPatterns Find a clean way to fix the problem which leads to the Shrink Wrapping pass being run after the WebAssembly PEI pass When setting multiple variables to the same we currently get code like const It could be done with a smaller encoding like local tee $pop5 local copy</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2WebAssembly_2README_8txt_source.html#l00101">README.txt:101</a></div></div>
<div class="ttc" id="aValue_8h_html"><div class="ttname"><a href="Value_8h.html">Value.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_a2816e84a08c108d18bc4665bc1817e01"><div class="ttname"><a href="namespacellvm.html#a2816e84a08c108d18bc4665bc1817e01">llvm::abs</a></div><div class="ttdeci">APFloat abs(APFloat X)</div><div class="ttdoc">Returns the absolute value of the argument.</div><div class="ttdef"><b>Definition:</b> <a href="APFloat_8h_source.html#l01332">APFloat.h:1332</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics_html_a54d9af6b4c656c782e017020406e8291"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP_1_1LookAheadHeuristics.html#a54d9af6b4c656c782e017020406e8291">llvm::slpvectorizer::BoUpSLP::LookAheadHeuristics::getScoreAtLevelRec</a></div><div class="ttdeci">int getScoreAtLevelRec(Value *LHS, Value *RHS, Instruction *U1, Instruction *U2, int CurrLevel, ArrayRef&lt; Value * &gt; MainAltOps) const</div><div class="ttdoc">Go through the operands of LHS and RHS recursively until MaxLevel, and return the cummulative score.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l01415">SLPVectorizer.cpp:1415</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a753e1338645ec04d045211b8a46d968d"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a753e1338645ec04d045211b8a46d968d">llvm::PatternMatch::m_Cmp</a></div><div class="ttdeci">class_match&lt; CmpInst &gt; m_Cmp()</div><div class="ttdoc">Matches any compare instruction and ignore it.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00089">PatternMatch.h:89</a></div></div>
<div class="ttc" id="aclassllvm_1_1OptimizationRemarkEmitterAnalysis_html"><div class="ttname"><a href="classllvm_1_1OptimizationRemarkEmitterAnalysis.html">llvm::OptimizationRemarkEmitterAnalysis</a></div><div class="ttdef"><b>Definition:</b> <a href="OptimizationRemarkEmitter_8h_source.html#l00164">OptimizationRemarkEmitter.h:164</a></div></div>
<div class="ttc" id="aclassllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1nodes__iterator_html_a110d907b8accd61d00d8a4b2354fc16e"><div class="ttname"><a href="classllvm_1_1GraphTraits_3_01BoUpSLP_01_5_01_4_1_1nodes__iterator.html#a110d907b8accd61d00d8a4b2354fc16e">llvm::GraphTraits&lt; BoUpSLP * &gt;::nodes_iterator::operator++</a></div><div class="ttdeci">nodes_iterator operator++()</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l03494">SLPVectorizer.cpp:3494</a></div></div>
<div class="ttc" id="aclassllvm_1_1FunctionType_html_ac453ad79a3d50950bac79bc9dff85918"><div class="ttname"><a href="classllvm_1_1FunctionType.html#ac453ad79a3d50950bac79bc9dff85918">llvm::FunctionType::getReturnType</a></div><div class="ttdeci">Type * getReturnType() const</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00124">DerivedTypes.h:124</a></div></div>
<div class="ttc" id="anamespacellvm_html_aac36edd0f1ce976f0025c98e88d3830eabccd0de85dfbe7aef83629b318a4df6e"><div class="ttname"><a href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eabccd0de85dfbe7aef83629b318a4df6e">llvm::RecurKind::SMax</a></div><div class="ttdeci">@ SMax</div><div class="ttdoc">Signed integer max implemented in terms of select(cmp()).</div></div>
<div class="ttc" id="anamespacellvm_html_abe76d72cda6b2b4562c72accb510040b"><div class="ttname"><a href="namespacellvm.html#abe76d72cda6b2b4562c72accb510040b">llvm::isSafeToSpeculativelyExecute</a></div><div class="ttdeci">bool isSafeToSpeculativelyExecute(const Instruction *I, const Instruction *CtxI=nullptr, AssumptionCache *AC=nullptr, const DominatorTree *DT=nullptr, const TargetLibraryInfo *TLI=nullptr)</div><div class="ttdoc">Return true if the instruction does not have any effects besides calculating the result and does not ...</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l04799">ValueTracking.cpp:4799</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html"><div class="ttname"><a href="classllvm_1_1Value.html">llvm::Value</a></div><div class="ttdoc">LLVM Value Representation.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00074">Value.h:74</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a37668d9884c78ac77254cf9fb8a4276a"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a37668d9884c78ac77254cf9fb8a4276a">llvm::PatternMatch::m_Shl</a></div><div class="ttdeci">BinaryOp_match&lt; LHS, RHS, Instruction::Shl &gt; m_Shl(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01111">PatternMatch.h:1111</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_a706f223f760b55668fbae74202b816bba59b32ea7b6f10564abd40ad90602ca5b"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a706f223f760b55668fbae74202b816bba59b32ea7b6f10564abd40ad90602ca5b">llvm::TargetTransformInfo::TCK_RecipThroughput</a></div><div class="ttdeci">@ TCK_RecipThroughput</div><div class="ttdoc">Reciprocal throughput.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00242">TargetTransformInfo.h:242</a></div></div>
<div class="ttc" id="aDebug_8h_html"><div class="ttname"><a href="Debug_8h.html">Debug.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLibraryAnalysis_html"><div class="ttname"><a href="classllvm_1_1TargetLibraryAnalysis.html">llvm::TargetLibraryAnalysis</a></div><div class="ttdoc">Analysis pass providing the TargetLibraryInfo.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLibraryInfo_8h_source.html#l00540">TargetLibraryInfo.h:540</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_ab4e0512c7e1c7adaa56677e3155685f1"><div class="ttname"><a href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">llvm::Value::users</a></div><div class="ttdeci">iterator_range&lt; user_iterator &gt; users()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00421">Value.h:421</a></div></div>
<div class="ttc" id="anamespacellvm_html_a3097c66d0a4a009897e2ea77298a37f1"><div class="ttname"><a href="namespacellvm.html#a3097c66d0a4a009897e2ea77298a37f1">llvm::isUsedOutsideBlock</a></div><div class="ttdeci">static bool isUsedOutsideBlock(Value *V)</div><div class="ttdoc">Checks if the provided value does not require scheduling.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l00928">SLPVectorizer.cpp:928</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetTransformInfo_html_af46433d0e36d3f80afc3a8c67b5c53ecafd6c03f570400fcb24d861aa21ddffe9"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#af46433d0e36d3f80afc3a8c67b5c53ecafd6c03f570400fcb24d861aa21ddffe9">llvm::TargetTransformInfo::SK_ExtractSubvector</a></div><div class="ttdeci">@ SK_ExtractSubvector</div><div class="ttdoc">ExtractSubvector Index indicates start offset.</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00918">TargetTransformInfo.h:918</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7b49849160e7f089916f83c52511da9e"><div class="ttname"><a href="namespacellvm.html#a7b49849160e7f089916f83c52511da9e">llvm::find_if_not</a></div><div class="ttdeci">auto find_if_not(R &amp;&amp;Range, UnaryPredicate P)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01767">STLExtras.h:1767</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a2be3583dac92a031fa1458d4d992c78bad99425e1c7df18b4be5edbffbf896e55"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78bad99425e1c7df18b4be5edbffbf896e55">llvm::CmpInst::BAD_FCMP_PREDICATE</a></div><div class="ttdeci">@ BAD_FCMP_PREDICATE</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00738">InstrTypes.h:738</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html_a7ca5197533a9c1fb8a2bd30587fcec6b"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#a7ca5197533a9c1fb8a2bd30587fcec6b">llvm::ArrayRef::end</a></div><div class="ttdeci">iterator end() const</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00152">ArrayRef.h:152</a></div></div>
<div class="ttc" id="anamespacellvm_1_1APIntOps_html_afee2477c062b67b487941ee0f4ff95ba"><div class="ttname"><a href="namespacellvm_1_1APIntOps.html#afee2477c062b67b487941ee0f4ff95ba">llvm::APIntOps::smax</a></div><div class="ttdeci">const APInt &amp; smax(const APInt &amp;A, const APInt &amp;B)</div><div class="ttdoc">Determine the larger of two APInts considered to be signed.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l02180">APInt.h:2180</a></div></div>
<div class="ttc" id="aReassociate_8cpp_html_ae32b03825183735233b4142e1945abf8"><div class="ttname"><a href="Reassociate_8cpp.html#ae32b03825183735233b4142e1945abf8">isLoadCombineCandidate</a></div><div class="ttdeci">static bool isLoadCombineCandidate(Instruction *Or)</div><div class="ttdef"><b>Definition:</b> <a href="Reassociate_8cpp_source.html#l00933">Reassociate.cpp:933</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a213e6c0ca6e838157373b9a6018c0769"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a213e6c0ca6e838157373b9a6018c0769">llvm::PatternMatch::m_LogicalAnd</a></div><div class="ttdeci">LogicalOp_match&lt; LHS, RHS, Instruction::And &gt; m_LogicalAnd(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdoc">Matches L &amp;&amp; R either in the form of L &amp; R or L ? R : false.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l02556">PatternMatch.h:2556</a></div></div>
<div class="ttc" id="aclassllvm_1_1MemoryLocation_html"><div class="ttname"><a href="classllvm_1_1MemoryLocation.html">llvm::MemoryLocation</a></div><div class="ttdoc">Representation for a specific memory location.</div><div class="ttdef"><b>Definition:</b> <a href="MemoryLocation_8h_source.html#l00211">MemoryLocation.h:211</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_ac63dbb4994494c46f025715272cdb81e"><div class="ttname"><a href="classllvm_1_1CallBase.html#ac63dbb4994494c46f025715272cdb81e">llvm::CallBase::args</a></div><div class="ttdeci">iterator_range&lt; User::op_iterator &gt; args()</div><div class="ttdoc">Iteration adapter for range-for loops.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01342">InstrTypes.h:1342</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoopAnalysis_html"><div class="ttname"><a href="classllvm_1_1LoopAnalysis.html">llvm::LoopAnalysis</a></div><div class="ttdoc">Analysis pass that exposes the LoopInfo for a function.</div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l01268">LoopInfo.h:1268</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a971522b36bf432ad69a0083581ab4108"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a971522b36bf432ad69a0083581ab4108">llvm::PatternMatch::m_Mul</a></div><div class="ttdeci">BinaryOp_match&lt; LHS, RHS, Instruction::Mul &gt; m_Mul(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01045">PatternMatch.h:1045</a></div></div>
<div class="ttc" id="anamespacellvm_html_aac36edd0f1ce976f0025c98e88d3830ea76feb79109026728a20736a8c6504548"><div class="ttname"><a href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea76feb79109026728a20736a8c6504548">llvm::RecurKind::Xor</a></div><div class="ttdeci">@ Xor</div><div class="ttdoc">Bitwise or logical XOR of integers.</div></div>
<div class="ttc" id="aclassllvm_1_1SmallSet_html_ae04ad615dfdd885e85cbddda146787c6"><div class="ttname"><a href="classllvm_1_1SmallSet.html#ae04ad615dfdd885e85cbddda146787c6">llvm::SmallSet::contains</a></div><div class="ttdeci">bool contains(const T &amp;V) const</div><div class="ttdoc">Check if the SmallSet contains the given element.</div><div class="ttdef"><b>Definition:</b> <a href="SmallSet_8h_source.html#l00234">SmallSet.h:234</a></div></div>
<div class="ttc" id="aSetVector_8h_html"><div class="ttname"><a href="SetVector_8h.html">SetVector.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1sampleprof_html_a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41"><div class="ttname"><a href="namespacellvm_1_1sampleprof.html#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">llvm::sampleprof::Base</a></div><div class="ttdeci">@ Base</div><div class="ttdef"><b>Definition:</b> <a href="Discriminator_8h_source.html#l00058">Discriminator.h:58</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_af67d1f3a518964d80a109bb3d9d5cf1e"><div class="ttname"><a href="classllvm_1_1Instruction.html#af67d1f3a518964d80a109bb3d9d5cf1e">llvm::Instruction::moveBefore</a></div><div class="ttdeci">void moveBefore(Instruction *MovePos)</div><div class="ttdoc">Unlink this instruction from its current basic block and insert it into the basic block that MovePos ...</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00108">Instruction.cpp:108</a></div></div>
<div class="ttc" id="aclassllvm_1_1Use_html"><div class="ttname"><a href="classllvm_1_1Use.html">llvm::Use</a></div><div class="ttdoc">A Use represents the edge between a Value definition and its users.</div><div class="ttdef"><b>Definition:</b> <a href="Use_8h_source.html#l00043">Use.h:43</a></div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_html_ab27b8e376a736c99b51c692c97a988fc"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#ab27b8e376a736c99b51c692c97a988fc">llvm::slpvectorizer::BoUpSLP::isAnalyzedReductionRoot</a></div><div class="ttdeci">bool isAnalyzedReductionRoot(Instruction *I) const</div><div class="ttdoc">Checks if the instruction was already analyzed for being possible reduction root.</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l02218">SLPVectorizer.cpp:2218</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_a396fcfee6914c76974b73c3d203da6a5"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">llvm::SmallVectorImpl::emplace_back</a></div><div class="ttdeci">reference emplace_back(ArgTypes &amp;&amp;... Args)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00941">SmallVector.h:941</a></div></div>
<div class="ttc" id="aSmallSet_8h_html"><div class="ttname"><a href="SmallSet_8h.html">SmallSet.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallPtrSetImpl_html_a6bc6fb89fe2e91c25559a8631f56e27e"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html#a6bc6fb89fe2e91c25559a8631f56e27e">llvm::SmallPtrSetImpl::insert</a></div><div class="ttdeci">std::pair&lt; iterator, bool &gt; insert(PtrType Ptr)</div><div class="ttdoc">Inserts Ptr if and only if there is no element in the container equal to Ptr.</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00365">SmallPtrSet.h:365</a></div></div>
<div class="ttc" id="anamespacellvm_1_1Intrinsic_html_a80add6b3b1cdaec560907995127adc16"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">llvm::Intrinsic::ID</a></div><div class="ttdeci">unsigned ID</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00039">TargetTransformInfo.h:39</a></div></div>
<div class="ttc" id="aclassllvm_1_1hash__code_html"><div class="ttname"><a href="classllvm_1_1hash__code.html">llvm::hash_code</a></div><div class="ttdoc">An opaque object representing a hash code.</div><div class="ttdef"><b>Definition:</b> <a href="Hashing_8h_source.html#l00074">Hashing.h:74</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_a94d23373106467003722f7d6c17b1528"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a94d23373106467003722f7d6c17b1528">llvm::SmallVectorImpl::insert</a></div><div class="ttdeci">iterator insert(iterator I, T &amp;&amp;Elt)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00809">SmallVector.h:809</a></div></div>
<div class="ttc" id="aclassllvm_1_1PoisonValue_html_a1bf08613fb664a2e377a9a72c59a6b66"><div class="ttname"><a href="classllvm_1_1PoisonValue.html#a1bf08613fb664a2e377a9a72c59a6b66">llvm::PoisonValue::get</a></div><div class="ttdeci">static PoisonValue * get(Type *T)</div><div class="ttdoc">Static factory methods - Return an 'poison' object of the specified type.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01759">Constants.cpp:1759</a></div></div>
<div class="ttc" id="aSLPVectorizer_8cpp_html_aa96c1a4a5e83e1e1c4bd56981a3d0773"><div class="ttname"><a href="SLPVectorizer_8cpp.html#aa96c1a4a5e83e1e1c4bd56981a3d0773">ShouldStartVectorizeHorAtStore</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; ShouldStartVectorizeHorAtStore(&quot;slp-vectorize-hor-store&quot;, cl::init(false), cl::Hidden, cl::desc(&quot;Attempt to vectorize horizontal reductions feeding into a store&quot;))</div></div>
<div class="ttc" id="aclassllvm_1_1slpvectorizer_1_1BoUpSLP_html_a3560e6ff2cf16b519313ee80c08a3383"><div class="ttname"><a href="classllvm_1_1slpvectorizer_1_1BoUpSLP.html#a3560e6ff2cf16b519313ee80c08a3383">llvm::slpvectorizer::BoUpSLP::getORE</a></div><div class="ttdeci">OptimizationRemarkEmitter * getORE()</div><div class="ttdef"><b>Definition:</b> <a href="SLPVectorizer_8cpp_source.html#l01168">SLPVectorizer.cpp:1168</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 7 2023 10:39:04 for LLVM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
