<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: lib/Transforms/InstCombine/InstCombineVectorOps.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LLVM
   &#160;<span id="projectnumber">17.0.0git</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_a72932e0778af28115095468f6286ff8.html">Transforms</a></li><li class="navelem"><a class="el" href="dir_99567d9c0c7f3685f25b19ecc341a865.html">InstCombine</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">InstCombineVectorOps.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="InstCombineVectorOps_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- InstCombineVectorOps.cpp -------------------------------------------===//</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// See https://llvm.org/LICENSE.txt for license information.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// This file implements instcombine for ExtractElement, InsertElement and</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// ShuffleVector.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160; </div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InstCombineInternal_8h.html">InstCombineInternal.h</a>&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="APInt_8h.html">llvm/ADT/APInt.h</a>&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ArrayRef_8h.html">llvm/ADT/ArrayRef.h</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DenseMap_8h.html">llvm/ADT/DenseMap.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="STLExtras_8h.html">llvm/ADT/STLExtras.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallBitVector_8h.html">llvm/ADT/SmallBitVector.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallVector_8h.html">llvm/ADT/SmallVector.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Statistic_8h.html">llvm/ADT/Statistic.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InstructionSimplify_8h.html">llvm/Analysis/InstructionSimplify.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="VectorUtils_8h.html">llvm/Analysis/VectorUtils.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BasicBlock_8h.html">llvm/IR/BasicBlock.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constant_8h.html">llvm/IR/Constant.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constants_8h.html">llvm/IR/Constants.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DerivedTypes_8h.html">llvm/IR/DerivedTypes.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InstrTypes_8h.html">llvm/IR/InstrTypes.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IR_2Instruction_8h.html">llvm/IR/Instruction.h</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Instructions_8h.html">llvm/IR/Instructions.h</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Operator_8h.html">llvm/IR/Operator.h</a>&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="PatternMatch_8h.html">llvm/IR/PatternMatch.h</a>&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Type_8h.html">llvm/IR/Type.h</a>&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="User_8h.html">llvm/IR/User.h</a>&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Value_8h.html">llvm/IR/Value.h</a>&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Casting_8h.html">llvm/Support/Casting.h</a>&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Support_2ErrorHandling_8h.html">llvm/Support/ErrorHandling.h</a>&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InstCombiner_8h.html">llvm/Transforms/InstCombine/InstCombiner.h</a>&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &lt;cstdint&gt;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &lt;iterator&gt;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &lt;utility&gt;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160; </div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">   44</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;instcombine&quot;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keyword">using namespace </span>PatternMatch;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160; </div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<a class="code" href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">STATISTIC</a>(NumAggregateReconstructionsSimplified,</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;          <span class="stringliteral">&quot;Number of aggregate reconstructions turned into reuse of the &quot;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;          <span class="stringliteral">&quot;original aggregate&quot;</span>);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">/// Return true if the value is cheaper to scalarize than it is to leave as a</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">/// vector operation. If the extract index \p EI is a constant integer then</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">/// some operations may be cheap to scalarize.</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">/// FIXME: It&#39;s possible to create more instructions than previously existed.</span></div>
<div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#a89f5f0f536cc9b0bae261737f13786f7">   58</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="InstCombineVectorOps_8cpp.html#a89f5f0f536cc9b0bae261737f13786f7">cheapToScalarize</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1Value.html">Value</a> *EI) {</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CEI = dyn_cast&lt;ConstantInt&gt;(EI);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160; </div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="comment">// If we can pick a scalar constant value out of a vector, that is free.</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;Constant&gt;(V))</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordflow">return</span> CEI || <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;<a class="code" href="classllvm_1_1Constant.html#a292ffa1290b082be7ce24676c26f04d6">getSplatValue</a>();</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160; </div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keywordflow">if</span> (CEI &amp;&amp; <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, m_Intrinsic&lt;Intrinsic::experimental_stepvector&gt;())) {</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a class="code" href="classllvm_1_1ElementCount.html">ElementCount</a> EC = cast&lt;VectorType&gt;(V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getElementCount();</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">// Index needs to be lower than the minimum size of the vector, because</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">// for scalable vector, the vector size is known at run time.</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordflow">return</span> CEI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>().<a class="code" href="classllvm_1_1APInt.html#a545e8d5dfa1688acea0d0e275b03682f">ult</a>(EC.getKnownMinValue());</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  }</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="comment">// An insertelement to the same constant index as our extract will simplify</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="comment">// to the scalar inserted element. An insertelement to a different constant</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="comment">// index is irrelevant to our extract.</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a class="code" href="namespacellvm_1_1PatternMatch.html#a9cae528bdb66086aa6c06da36fc6fa24">m_InsertElt</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">m_ConstantInt</a>())))</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordflow">return</span> CEI;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160; </div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a class="code" href="namespacellvm_1_1PatternMatch.html#aca6428e7fec51ba0b55594f469eb9691">m_OneUse</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a78cd22f497c1e81c4d8a5e9073ef5a24">m_Load</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>()))))</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160; </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a class="code" href="namespacellvm_1_1PatternMatch.html#aca6428e7fec51ba0b55594f469eb9691">m_OneUse</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a91de4bc9bca1d204b0c4b93d11a83c31">m_UnOp</a>())))</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *V0, *V1;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a class="code" href="namespacellvm_1_1PatternMatch.html#aca6428e7fec51ba0b55594f469eb9691">m_OneUse</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a43ac4fbaaf63a88eb5ac05f6d3e5649c">m_BinOp</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(V0), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(V1)))))</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="InstCombineVectorOps_8cpp.html#a89f5f0f536cc9b0bae261737f13786f7">cheapToScalarize</a>(V0, EI) || <a class="code" href="InstCombineVectorOps_8cpp.html#a89f5f0f536cc9b0bae261737f13786f7">cheapToScalarize</a>(V1, EI))</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> UnusedPred;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a class="code" href="namespacellvm_1_1PatternMatch.html#aca6428e7fec51ba0b55594f469eb9691">m_OneUse</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a753e1338645ec04d045211b8a46d968d">m_Cmp</a>(UnusedPred, <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(V0), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(V1)))))</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="InstCombineVectorOps_8cpp.html#a89f5f0f536cc9b0bae261737f13786f7">cheapToScalarize</a>(V0, EI) || <a class="code" href="InstCombineVectorOps_8cpp.html#a89f5f0f536cc9b0bae261737f13786f7">cheapToScalarize</a>(V1, EI))</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160; </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;}</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">// If we have a PHI node with a vector type that is only used to feed</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">// itself and be an operand of extractelement at a constant location,</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">// try to replace the PHI of the vector type with a PHI of a scalar type.</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *InstCombinerImpl::scalarizePHI(<a class="code" href="classllvm_1_1ExtractElementInst.html">ExtractElementInst</a> &amp;EI,</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                                            <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN) {</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 2&gt;</a> Extracts;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="comment">// The users we want the PHI to have are:</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="comment">// 1) The EI ExtractElement (we already know this)</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="comment">// 2) Possibly more ExtractElements with the same index.</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="comment">// 3) Another operand, which will feed back into the PHI.</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *PHIUser = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *U : PN-&gt;<a class="code" href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">users</a>()) {</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ExtractElementInst.html">ExtractElementInst</a> *EU = dyn_cast&lt;ExtractElementInst&gt;(U)) {</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      <span class="keywordflow">if</span> (EI.<a class="code" href="classllvm_1_1ExtractElementInst.html#a5c70cc08cbcb4490ef7a9b4cf7766db6">getIndexOperand</a>() == EU-&gt;getIndexOperand())</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        Extracts.push_back(EU);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!PHIUser) {</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      PHIUser = cast&lt;Instruction&gt;(U);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  }</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160; </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="keywordflow">if</span> (!PHIUser)</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="comment">// Verify that this PHI user has one use, which is the PHI itself,</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="comment">// and that it is a binary operation which is cheap to scalarize.</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="comment">// otherwise return nullptr.</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keywordflow">if</span> (!PHIUser-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() || !(PHIUser-&gt;<a class="code" href="classllvm_1_1Instruction.html#a2fd1d2dc14e22227cfa8238778ab87b8">user_back</a>() == PN) ||</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      !(isa&lt;BinaryOperator&gt;(PHIUser)) ||</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      !<a class="code" href="InstCombineVectorOps_8cpp.html#a89f5f0f536cc9b0bae261737f13786f7">cheapToScalarize</a>(PHIUser, EI.<a class="code" href="classllvm_1_1ExtractElementInst.html#a5c70cc08cbcb4490ef7a9b4cf7766db6">getIndexOperand</a>()))</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160; </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="comment">// Create a scalar PHI node that will replace the vector PHI node</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="comment">// just before the current PHI node.</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *scalarPHI = cast&lt;PHINode&gt;(InsertNewInstWith(</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <a class="code" href="classllvm_1_1PHINode.html#ab0ff669b12c20c07137705c38872ec63">PHINode::Create</a>(EI.<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(), <span class="stringliteral">&quot;&quot;</span>), *PN));</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="comment">// Scalarize each PHI operand.</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *PHIInVal = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a16c39eb6e60b42a40c399d8d65347bb6">getIncomingValue</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *inBB = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a8ce0c4746a1ec805e66409d20ae93922">getIncomingBlock</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Elt = EI.<a class="code" href="classllvm_1_1ExtractElementInst.html#a5c70cc08cbcb4490ef7a9b4cf7766db6">getIndexOperand</a>();</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="comment">// If the operand is the PHI induction variable:</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordflow">if</span> (PHIInVal == PHIUser) {</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      <span class="comment">// Scalarize the binary operation. Its first operand is the</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      <span class="comment">// scalar PHI, and the second operand is extracted from the other</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      <span class="comment">// vector operand.</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *B0 = cast&lt;BinaryOperator&gt;(PHIUser);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      <span class="keywordtype">unsigned</span> opId = (B0-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0) == PN) ? 1 : 0;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = InsertNewInstWith(</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;          <a class="code" href="classllvm_1_1ExtractElementInst.html#a5d496a334eff64bb2873339b54df932a">ExtractElementInst::Create</a>(B0-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(opId), Elt,</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                                     B0-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(opId)-&gt;<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + <span class="stringliteral">&quot;.Elt&quot;</span>),</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;          *B0);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *newPHIUser = InsertNewInstWith(</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;          <a class="code" href="classllvm_1_1BinaryOperator.html#a16799e07e39d599e81926d1a69301fab">BinaryOperator::CreateWithCopiedFlags</a>(B0-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>(),</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                                                scalarPHI, <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>, B0), *B0);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      scalarPHI-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(newPHIUser, inBB);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      <span class="comment">// Scalarize PHI input:</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *newEI = <a class="code" href="classllvm_1_1ExtractElementInst.html#a5d496a334eff64bb2873339b54df932a">ExtractElementInst::Create</a>(PHIInVal, Elt, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <span class="comment">// Insert the new instruction into the predecessor basic block.</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *pos = dyn_cast&lt;Instruction&gt;(PHIInVal);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPos;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <span class="keywordflow">if</span> (pos &amp;&amp; !isa&lt;PHINode&gt;(pos)) {</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        InsertPos = ++pos-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>();</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        InsertPos = inBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      }</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160; </div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      InsertNewInstWith(newEI, *InsertPos);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160; </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      scalarPHI-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(newEI, inBB);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    }</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  }</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160; </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> : Extracts)</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    replaceInstUsesWith(*<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, scalarPHI);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160; </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="keywordflow">return</span> &amp;EI;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;}</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160; </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *InstCombinerImpl::foldBitcastExtElt(<a class="code" href="classllvm_1_1ExtractElementInst.html">ExtractElementInst</a> &amp;<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>) {</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> ExtIndexC;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>.getVectorOperand(), <a class="code" href="namespacellvm_1_1PatternMatch.html#ac0467ca7fad871738b10db95feb40dad">m_BitCast</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>))) ||</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      !<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>.getIndexOperand(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">m_ConstantInt</a>(ExtIndexC)))</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <a class="code" href="classllvm_1_1ElementCount.html">ElementCount</a> NumElts =</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      cast&lt;VectorType&gt;(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>.getVectorOperandType())-&gt;getElementCount();</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *DestTy = <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>.getType();</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="keywordtype">unsigned</span> DestWidth = DestTy-&gt;<a class="code" href="classllvm_1_1Type.html#a833daf718a49c5cd637d8c9ddeaebe07">getPrimitiveSizeInBits</a>();</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="keywordtype">bool</span> IsBigEndian = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.isBigEndian();</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="comment">// If we are casting an integer to vector and extracting a portion, that is</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="comment">// a shift-right and truncate.</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>-&gt;getType()-&gt;isIntegerTy()) {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isa&lt;FixedVectorType&gt;(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>.getVectorOperand()-&gt;getType()) &amp;&amp;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;           <span class="stringliteral">&quot;Expected fixed vector type for bitcast from scalar integer&quot;</span>);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160; </div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="comment">// Big endian requires adjusting the extract index since MSB is at index 0.</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment">// LittleEndian: extelt (bitcast i32 X to v4i8), 0 -&gt; trunc i32 X to i8</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment">// BigEndian: extelt (bitcast i32 X to v4i8), 0 -&gt; trunc i32 (X &gt;&gt; 24) to i8</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordflow">if</span> (IsBigEndian)</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      ExtIndexC = NumElts.<a class="code" href="classllvm_1_1details_1_1FixedOrScalableQuantity.html#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() - 1 - ExtIndexC;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keywordtype">unsigned</span> ShiftAmountC = ExtIndexC * DestWidth;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keywordflow">if</span> (!ShiftAmountC ||</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        (isDesirableIntType(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>-&gt;getType()-&gt;getPrimitiveSizeInBits()) &amp;&amp;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>.getVectorOperand()-&gt;hasOneUse())) {</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <span class="keywordflow">if</span> (ShiftAmountC)</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateLShr(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, ShiftAmountC, <span class="stringliteral">&quot;extelt.offset&quot;</span>);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      <span class="keywordflow">if</span> (DestTy-&gt;<a class="code" href="classllvm_1_1Type.html#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>()) {</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <a class="code" href="classllvm_1_1Type.html">Type</a> *DstIntTy = <a class="code" href="classllvm_1_1Type.html#acaf8e4c3e40e01e848c1fad5f05b81cd">IntegerType::getIntNTy</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>-&gt;getContext(), DestWidth);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *Trunc = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateTrunc(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, DstIntTy);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a>(Trunc, DestTy);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      }</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1TruncInst.html">TruncInst</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, DestTy);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160; </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>-&gt;getType()-&gt;isVectorTy())</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="comment">// If this extractelement is using a bitcast from a vector of the same number</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="comment">// of elements, see if we can find the source element from the source vector:</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="comment">// extelt (bitcast VecX), IndexC --&gt; bitcast X[IndexC]</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keyword">auto</span> *SrcTy = cast&lt;VectorType&gt;(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>-&gt;getType());</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <a class="code" href="classllvm_1_1ElementCount.html">ElementCount</a> NumSrcElts = SrcTy-&gt;getElementCount();</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <span class="keywordflow">if</span> (NumSrcElts == NumElts)</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *Elt = <a class="code" href="namespacellvm.html#ab09fc7dee4f7e02c60f7a9c928dc1603">findScalarElement</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, ExtIndexC))</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a>(Elt, DestTy);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160; </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NumSrcElts.<a class="code" href="classllvm_1_1details_1_1FixedOrScalableQuantity.html#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() == NumElts.<a class="code" href="classllvm_1_1details_1_1FixedOrScalableQuantity.html#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() &amp;&amp;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;         <span class="stringliteral">&quot;Src and Dst must be the same sort of vector type&quot;</span>);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="comment">// If the source elements are wider than the destination, try to shift and</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="comment">// truncate a subset of scalar bits of an insert op.</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="keywordflow">if</span> (NumSrcElts.<a class="code" href="classllvm_1_1details_1_1FixedOrScalableQuantity.html#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() &lt; NumElts.<a class="code" href="classllvm_1_1details_1_1FixedOrScalableQuantity.html#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>()) {</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a>;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Vec;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> InsIndexC;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#a9cae528bdb66086aa6c06da36fc6fa24">m_InsertElt</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(Vec), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(Scalar),</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                              <a class="code" href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">m_ConstantInt</a>(InsIndexC))))</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="comment">// The extract must be from the subset of vector elements that we inserted</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="comment">// into. Example: if we inserted element 1 of a &lt;2 x i64&gt; and we are</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="comment">// extracting an i16 (narrowing ratio = 4), then this extract must be from 1</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="comment">// of elements 4-7 of the bitcasted vector.</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keywordtype">unsigned</span> NarrowingRatio =</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        NumElts.<a class="code" href="classllvm_1_1details_1_1FixedOrScalableQuantity.html#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() / NumSrcElts.<a class="code" href="classllvm_1_1details_1_1FixedOrScalableQuantity.html#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>();</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160; </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keywordflow">if</span> (ExtIndexC / NarrowingRatio != InsIndexC) {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <span class="comment">// Remove insertelement, if we don&#39;t use the inserted element.</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      <span class="comment">// extractelement (bitcast (insertelement (Vec, b)), a) -&gt;</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      <span class="comment">// extractelement (bitcast (Vec), a)</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="comment">// FIXME: this should be removed to SimplifyDemandedVectorElts,</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      <span class="comment">// once scale vectors are supported.</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>-&gt;hasOneUse() &amp;&amp; <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>.getVectorOperand()-&gt;hasOneUse()) {</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *NewBC = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(Vec, <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>.getVectorOperandType());</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1ExtractElementInst.html#a5d496a334eff64bb2873339b54df932a">ExtractElementInst::Create</a>(NewBC, <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>.getIndexOperand());</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    }</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160; </div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="comment">// We are extracting part of the original scalar. How that scalar is</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="comment">// inserted into the vector depends on the endian-ness. Example:</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="comment">//              Vector Byte Elt Index:    0  1  2  3  4  5  6  7</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="comment">//                                       +--+--+--+--+--+--+--+--+</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="comment">// inselt &lt;2 x i32&gt; V, &lt;i32&gt; S, 1:       |V0|V1|V2|V3|S0|S1|S2|S3|</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="comment">// extelt &lt;4 x i16&gt; V&#39;, 3:               |                 |S2|S3|</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="comment">//                                       +--+--+--+--+--+--+--+--+</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">// If this is little-endian, S2|S3 are the MSB of the 32-bit &#39;S&#39; value.</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="comment">// If this is big-endian, S2|S3 are the LSB of the 32-bit &#39;S&#39; value.</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="comment">// In this example, we must right-shift little-endian. Big-endian is just a</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="comment">// truncate.</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="keywordtype">unsigned</span> Chunk = ExtIndexC % NarrowingRatio;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">if</span> (IsBigEndian)</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      Chunk = NarrowingRatio - 1 - Chunk;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160; </div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="comment">// Bail out if this is an FP vector to FP vector sequence. That would take</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="comment">// more instructions than we started with unless there is no shift, and it</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="comment">// may not be handled as well in the backend.</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordtype">bool</span> NeedSrcBitcast = SrcTy-&gt;getScalarType()-&gt;isFloatingPointTy();</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordtype">bool</span> NeedDestBitcast = DestTy-&gt;<a class="code" href="classllvm_1_1Type.html#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>();</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">if</span> (NeedSrcBitcast &amp;&amp; NeedDestBitcast)</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordtype">unsigned</span> SrcWidth = SrcTy-&gt;getScalarSizeInBits();</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordtype">unsigned</span> ShAmt = Chunk * DestWidth;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160; </div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="comment">// TODO: This limitation is more strict than necessary. We could sum the</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="comment">// number of new instructions and subtract the number eliminated to know if</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="comment">// we can proceed.</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>-&gt;hasOneUse() || !<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>.getVectorOperand()-&gt;hasOneUse())</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <span class="keywordflow">if</span> (NeedSrcBitcast || NeedDestBitcast)</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keywordflow">if</span> (NeedSrcBitcast) {</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *SrcIntTy = <a class="code" href="classllvm_1_1Type.html#acaf8e4c3e40e01e848c1fad5f05b81cd">IntegerType::getIntNTy</a>(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a>-&gt;getContext(), SrcWidth);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(Scalar, SrcIntTy);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    }</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordflow">if</span> (ShAmt) {</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <span class="comment">// Bail out if we could end with more instructions than we started with.</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>.getVectorOperand()-&gt;hasOneUse())</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateLShr(Scalar, ShAmt);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    }</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordflow">if</span> (NeedDestBitcast) {</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *DestIntTy = <a class="code" href="classllvm_1_1Type.html#acaf8e4c3e40e01e848c1fad5f05b81cd">IntegerType::getIntNTy</a>(<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a>-&gt;getContext(), DestWidth);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateTrunc(Scalar, DestIntTy), DestTy);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    }</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1TruncInst.html">TruncInst</a>(Scalar, DestTy);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  }</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;}</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">/// Find elements of V demanded by UserInstr.</span></div>
<div class="line"><a name="l00320"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#aa5aa7648807905cd7b63153812029fe2">  320</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> <a class="code" href="InstCombineVectorOps_8cpp.html#aa5aa7648807905cd7b63153812029fe2">findDemandedEltsBySingleUser</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *UserInstr) {</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="keywordtype">unsigned</span> VWidth = cast&lt;FixedVectorType&gt;(V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getNumElements();</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  <span class="comment">// Conservatively assume that all elements are needed.</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <a class="code" href="classllvm_1_1APInt.html">APInt</a> UsedElts(<a class="code" href="classllvm_1_1APInt.html#a071e8d814b2b30b02544fad964227b8e">APInt::getAllOnes</a>(VWidth));</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160; </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="keywordflow">switch</span> (UserInstr-&gt;<a class="code" href="classllvm_1_1Instruction.html#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>()) {</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="keywordflow">case</span> Instruction::ExtractElement: {</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <a class="code" href="classllvm_1_1ExtractElementInst.html">ExtractElementInst</a> *EEI = cast&lt;ExtractElementInst&gt;(UserInstr);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EEI-&gt;<a class="code" href="classllvm_1_1ExtractElementInst.html#aaeb8650ea4319878fc7529daaaf0a9be">getVectorOperand</a>() == V);</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *EEIIndexC = dyn_cast&lt;ConstantInt&gt;(EEI-&gt;<a class="code" href="classllvm_1_1ExtractElementInst.html#a5c70cc08cbcb4490ef7a9b4cf7766db6">getIndexOperand</a>());</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="keywordflow">if</span> (EEIIndexC &amp;&amp; EEIIndexC-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>().<a class="code" href="classllvm_1_1APInt.html#a545e8d5dfa1688acea0d0e275b03682f">ult</a>(VWidth)) {</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      UsedElts = <a class="code" href="classllvm_1_1APInt.html#aec662ee6ab1490a4cabebf2812e5b9ca">APInt::getOneBitSet</a>(VWidth, EEIIndexC-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#ac09a21c371a9c535cbc13e8f82503aec">getZExtValue</a>());</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    }</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  }</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="keywordflow">case</span> Instruction::ShuffleVector: {</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a> *<a class="code" href="namespacellvm.html#a766456df1dd21e804cd4596304e10764ae8b4b40ec3622e371789b790caabc083">Shuffle</a> = cast&lt;ShuffleVectorInst&gt;(UserInstr);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordtype">unsigned</span> MaskNumElts =</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        cast&lt;FixedVectorType&gt;(UserInstr-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getNumElements();</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160; </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    UsedElts = <a class="code" href="classllvm_1_1APInt.html">APInt</a>(VWidth, 0);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; MaskNumElts; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      <span class="keywordtype">unsigned</span> MaskVal = <a class="code" href="namespacellvm.html#a766456df1dd21e804cd4596304e10764ae8b4b40ec3622e371789b790caabc083">Shuffle</a>-&gt;getMaskValue(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      <span class="keywordflow">if</span> (MaskVal == -1u || MaskVal &gt;= 2 * VWidth)</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a766456df1dd21e804cd4596304e10764ae8b4b40ec3622e371789b790caabc083">Shuffle</a>-&gt;getOperand(0) == V &amp;&amp; (MaskVal &lt; VWidth))</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        UsedElts.<a class="code" href="classllvm_1_1APInt.html#a33f9f862dca8ee0f23bff5941bf433d8">setBit</a>(MaskVal);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a766456df1dd21e804cd4596304e10764ae8b4b40ec3622e371789b790caabc083">Shuffle</a>-&gt;getOperand(1) == V &amp;&amp;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;          ((MaskVal &gt;= VWidth) &amp;&amp; (MaskVal &lt; 2 * VWidth)))</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        UsedElts.<a class="code" href="classllvm_1_1APInt.html#a33f9f862dca8ee0f23bff5941bf433d8">setBit</a>(MaskVal - VWidth);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    }</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  }</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  }</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="keywordflow">return</span> UsedElts;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;}</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">/// Find union of elements of V demanded by all its users.</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">/// If it is known by querying findDemandedEltsBySingleUser that</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">/// no user demands an element of V, then the corresponding bit</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">/// remains unset in the returned value.</span></div>
<div class="line"><a name="l00364"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#a1e71f36e9936f126265e383fd67440f7">  364</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> <a class="code" href="InstCombineVectorOps_8cpp.html#a1e71f36e9936f126265e383fd67440f7">findDemandedEltsByAllUsers</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="keywordtype">unsigned</span> VWidth = cast&lt;FixedVectorType&gt;(V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getNumElements();</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160; </div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <a class="code" href="classllvm_1_1APInt.html">APInt</a> UnionUsedElts(VWidth, 0);</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U : V-&gt;<a class="code" href="classllvm_1_1Value.html#aecb93439702247fe5353a9966f7cefcd">uses</a>()) {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(U.getUser())) {</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      UnionUsedElts |= <a class="code" href="InstCombineVectorOps_8cpp.html#aa5aa7648807905cd7b63153812029fe2">findDemandedEltsBySingleUser</a>(V, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      UnionUsedElts = <a class="code" href="classllvm_1_1APInt.html#a071e8d814b2b30b02544fad964227b8e">APInt::getAllOnes</a>(VWidth);</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    }</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160; </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordflow">if</span> (UnionUsedElts.<a class="code" href="classllvm_1_1APInt.html#a423e2c491de1408d54e35f0b47d076be">isAllOnes</a>())</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  }</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160; </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="keywordflow">return</span> UnionUsedElts;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;}</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">/// Given a constant index for a extractelement or insertelement instruction,</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">/// return it with the canonical type if it isn&#39;t already canonical.  We</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">/// arbitrarily pick 64 bit as our canonical type.  The actual bitwidth doesn&#39;t</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">/// matter, we just want a consistent type to simplify CSE.</span></div>
<div class="line"><a name="l00387"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#ae586e62daeb752c491198a77ee17a1d2">  387</a></span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<a class="code" href="InstCombineVectorOps_8cpp.html#ae586e62daeb752c491198a77ee17a1d2">getPreferredVectorIndex</a>(<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *IndexC) {</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> IndexBW = IndexC-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#afe3ce7fc89f36474eb0369cbb792c05a">getType</a>()-&gt;<a class="code" href="classllvm_1_1IntegerType.html#a90b790ccb1af4ea5ccd69db4b8cd2d81">getBitWidth</a>();</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="keywordflow">if</span> (IndexBW == 64 || IndexC-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>().<a class="code" href="classllvm_1_1APInt.html#a3015474e70e59c0a3ed4f9f0e8644b75">getActiveBits</a>() &gt; 64)</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(IndexC-&gt;<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(),</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                          IndexC-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">getValue</a>().<a class="code" href="classllvm_1_1APInt.html#a2ed912a28808268e35bd58e8f11251aa">zextOrTrunc</a>(64));</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;}</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160; </div>
<div class="line"><a name="l00395"></a><span class="lineno"><a class="line" href="classllvm_1_1InstCombinerImpl.html#a71ef354bd1ea9e02d70146d7218a7d39">  395</a></span>&#160;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1InstCombinerImpl.html#a71ef354bd1ea9e02d70146d7218a7d39">InstCombinerImpl::visitExtractElementInst</a>(<a class="code" href="classllvm_1_1ExtractElementInst.html">ExtractElementInst</a> &amp;EI) {</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *SrcVec = EI.<a class="code" href="classllvm_1_1ExtractElementInst.html#aaeb8650ea4319878fc7529daaaf0a9be">getVectorOperand</a>();</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a> = EI.<a class="code" href="classllvm_1_1ExtractElementInst.html#a5c70cc08cbcb4490ef7a9b4cf7766db6">getIndexOperand</a>();</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="namespacellvm.html#aee89448981f9fbc0d97fe68f354a8e82">simplifyExtractElementInst</a>(SrcVec, <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>,</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                                            SQ.getWithInstruction(&amp;EI)))</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keywordflow">return</span> replaceInstUsesWith(EI, V);</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160; </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  <span class="comment">// extractelt (select %x, %vec1, %vec2), %const -&gt;</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <span class="comment">// select %x, %vec1[%const], %vec2[%const]</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <span class="comment">// TODO: Support constant folding of multiple select operands:</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  <span class="comment">// extractelt (select %x, %vec1, %vec2), (select %x, %c1, %c2)</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <span class="comment">// If the extractelement will for instance try to do out of bounds accesses</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <span class="comment">// because of the values of %c1 and/or %c2, the sequence could be optimized</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="comment">// early. This is currently not possible because constant folding will reach</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="comment">// an unreachable assertion if it doesn&#39;t find a constant operand.</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;SelectInst&gt;(EI.<a class="code" href="classllvm_1_1ExtractElementInst.html#aaeb8650ea4319878fc7529daaaf0a9be">getVectorOperand</a>()))</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getCondition()-&gt;getType()-&gt;isIntegerTy() &amp;&amp;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        isa&lt;Constant&gt;(EI.<a class="code" href="classllvm_1_1ExtractElementInst.html#a5c70cc08cbcb4490ef7a9b4cf7766db6">getIndexOperand</a>()))</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *R = FoldOpIntoSelect(EI, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>))</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="keywordflow">return</span> R;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160; </div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <span class="comment">// If extracting a specified index from the vector, see if we can recursively</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="comment">// find a previously computed scalar that was inserted into the vector.</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <span class="keyword">auto</span> *IndexC = dyn_cast&lt;ConstantInt&gt;(<a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="keywordflow">if</span> (IndexC) {</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="comment">// Canonicalize type of constant indices to i64 to simplify CSE</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *NewIdx = <a class="code" href="InstCombineVectorOps_8cpp.html#ae586e62daeb752c491198a77ee17a1d2">getPreferredVectorIndex</a>(IndexC))</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      <span class="keywordflow">return</span> replaceOperand(EI, 1, NewIdx);</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160; </div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <a class="code" href="classllvm_1_1ElementCount.html">ElementCount</a> EC = EI.<a class="code" href="classllvm_1_1ExtractElementInst.html#a0774641c6da546aae7993a45235c73c0">getVectorOperandType</a>()-&gt;<a class="code" href="classllvm_1_1VectorType.html#a59632c5deb0423a518ad984bdd04d41f">getElementCount</a>();</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordtype">unsigned</span> NumElts = EC.getKnownMinValue();</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *II = dyn_cast&lt;IntrinsicInst&gt;(SrcVec)) {</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      <a class="code" href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IID = II-&gt;getIntrinsicID();</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <span class="comment">// Index needs to be lower than the minimum size of the vector, because</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <span class="comment">// for scalable vector, the vector size is known at run time.</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <span class="keywordflow">if</span> (IID == Intrinsic::experimental_stepvector &amp;&amp;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;          IndexC-&gt;getValue().ult(NumElts)) {</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty = EI.<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = Ty-&gt;<a class="code" href="classllvm_1_1Type.html#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>();</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *Idx;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <span class="comment">// Return index when its value does not exceed the allowed limit</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="comment">// for the element type of the vector, otherwise return undefined.</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <span class="keywordflow">if</span> (IndexC-&gt;getValue().getActiveBits() &lt;= <a class="code" href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>)</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;          Idx = <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(Ty, IndexC-&gt;getValue().zextOrTrunc(<a class="code" href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>));</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;          Idx = <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(Ty);</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <span class="keywordflow">return</span> replaceInstUsesWith(EI, Idx);</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    }</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160; </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="comment">// InstSimplify should handle cases where the index is invalid.</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="comment">// For fixed-length vector, it&#39;s invalid to extract out-of-range element.</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keywordflow">if</span> (!EC.isScalable() &amp;&amp; IndexC-&gt;getValue().uge(NumElts))</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = foldBitcastExtElt(EI))</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="comment">// If there&#39;s a vector PHI feeding a scalar use through this extractelement</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="comment">// instruction, try to scalarize the PHI.</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Phi = dyn_cast&lt;PHINode&gt;(SrcVec))</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ScalarPHI = scalarizePHI(EI, Phi))</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <span class="keywordflow">return</span> ScalarPHI;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  }</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160; </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="comment">// TODO come up with a n-ary matcher that subsumes both unary and</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="comment">// binary matchers.</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <a class="code" href="classllvm_1_1UnaryOperator.html">UnaryOperator</a> *UO;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(SrcVec, <a class="code" href="namespacellvm_1_1PatternMatch.html#a91de4bc9bca1d204b0c4b93d11a83c31">m_UnOp</a>(UO)) &amp;&amp; <a class="code" href="InstCombineVectorOps_8cpp.html#a89f5f0f536cc9b0bae261737f13786f7">cheapToScalarize</a>(SrcVec, <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>)) {</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="comment">// extelt (unop X), Index --&gt; unop (extelt X, Index)</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a> = UO-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateExtractElement(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>);</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1UnaryOperator.html#a19fab8f3b21b19f94e68830579d84982">UnaryOperator::CreateWithCopiedFlags</a>(UO-&gt;<a class="code" href="classllvm_1_1UnaryOperator.html#a7cece7ddf076c1dccc81f743e3b7bd36">getOpcode</a>(), <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>, UO);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  }</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *BO;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(SrcVec, <a class="code" href="namespacellvm_1_1PatternMatch.html#a43ac4fbaaf63a88eb5ac05f6d3e5649c">m_BinOp</a>(BO)) &amp;&amp; <a class="code" href="InstCombineVectorOps_8cpp.html#a89f5f0f536cc9b0bae261737f13786f7">cheapToScalarize</a>(SrcVec, <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>)) {</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="comment">// extelt (binop X, Y), Index --&gt; binop (extelt X, Index), (extelt Y, Index)</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a> = BO-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), *<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a> = BO-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *E0 = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateExtractElement(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *E1 = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateExtractElement(<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>, <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1BinaryOperator.html#a16799e07e39d599e81926d1a69301fab">BinaryOperator::CreateWithCopiedFlags</a>(BO-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>(), E0, E1, BO);</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  }</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160; </div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, *<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <a class="code" href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> Pred;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(SrcVec, <a class="code" href="namespacellvm_1_1PatternMatch.html#a753e1338645ec04d045211b8a46d968d">m_Cmp</a>(Pred, <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>))) &amp;&amp;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      <a class="code" href="InstCombineVectorOps_8cpp.html#a89f5f0f536cc9b0bae261737f13786f7">cheapToScalarize</a>(SrcVec, <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>)) {</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="comment">// extelt (cmp X, Y), Index --&gt; cmp (extelt X, Index), (extelt Y, Index)</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *E0 = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateExtractElement(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>);</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *E1 = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateExtractElement(<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>, <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>);</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1CmpInst.html#a3b4a54b076454fec43b13554b28252a9">CmpInst::Create</a>(cast&lt;CmpInst&gt;(SrcVec)-&gt;<a class="code" href="VPlanSLP_8cpp.html#af04704e906a9654777e92a4612c58c13">getOpcode</a>(), Pred, E0, E1);</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  }</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160; </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(SrcVec)) {</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a> = dyn_cast&lt;InsertElementInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      <span class="comment">// instsimplify already handled the case where the indices are constants</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      <span class="comment">// and equal by value, if both are constants, they must not be the same</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      <span class="comment">// value, extract from the pre-inserted value instead.</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      <span class="keywordflow">if</span> (isa&lt;Constant&gt;(<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>-&gt;getOperand(2)) &amp;&amp; IndexC)</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="keywordflow">return</span> replaceOperand(EI, 0, <a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>-&gt;getOperand(0));</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = dyn_cast&lt;GetElementPtrInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07c">VecType</a> = cast&lt;VectorType&gt;(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getType());</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;      <a class="code" href="classllvm_1_1ElementCount.html">ElementCount</a> EC = <a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07c">VecType</a>-&gt;getElementCount();</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> IdxVal = IndexC ? IndexC-&gt;<a class="code" href="classllvm_1_1APInt.html#a217e0207d9cc8e046c2dccbf0e4bb198">getZExtValue</a>() : 0;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      <span class="keywordflow">if</span> (IndexC &amp;&amp; IdxVal &lt; EC.getKnownMinValue() &amp;&amp; <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;hasOneUse()) {</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <span class="comment">// Find out why we have a vector result - these are a few examples:</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        <span class="comment">//  1. We have a scalar pointer and a vector of indices, or</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <span class="comment">//  2. We have a vector of pointers and a scalar index, or</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <span class="comment">//  3. We have a vector of pointers and a vector of indices, etc.</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        <span class="comment">// Here we only consider combining when there is exactly one vector</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <span class="comment">// operand, since the optimization is less obviously a win due to</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="comment">// needing more than one extractelements.</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160; </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="keywordtype">unsigned</span> VectorOps =</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;            <a class="code" href="namespacellvm.html#ac214df91cdc242f4710ea5a93939c678">llvm::count_if</a>(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;operands(), [](<span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;              return isa&lt;VectorType&gt;(V-&gt;getType());</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            });</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <span class="keywordflow">if</span> (VectorOps == 1) {</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *NewPtr = <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getPointerOperand();</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;          <span class="keywordflow">if</span> (isa&lt;VectorType&gt;(NewPtr-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()))</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            NewPtr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateExtractElement(NewPtr, IndexC);</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160; </div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;          <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *&gt;</a> NewOps;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 1; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getNumOperands(); ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getOperand(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            <span class="keywordflow">if</span> (isa&lt;VectorType&gt;(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>-&gt;getType()))</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;              NewOps.push_back(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateExtractElement(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>, IndexC));</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;              NewOps.push_back(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>);</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;          }</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160; </div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;          <a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *NewGEP = <a class="code" href="classllvm_1_1GetElementPtrInst.html#a74c47d18ecd4ca3399785e6ae07134dc">GetElementPtrInst::Create</a>(</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;              <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getSourceElementType(), NewPtr, NewOps);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;          NewGEP-&gt;<a class="code" href="classllvm_1_1GetElementPtrInst.html#a837e9f272fd070a5f8fc79c07a951106">setIsInBounds</a>(<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;isInBounds());</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;          <span class="keywordflow">return</span> NewGEP;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        }</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;      }</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *SVI = dyn_cast&lt;ShuffleVectorInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <span class="comment">// If this is extracting an element from a shufflevector, figure out where</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="comment">// it came from and extract from the appropriate input element instead.</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <span class="comment">// Restrict the following transformation to fixed-length vector.</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      <span class="keywordflow">if</span> (isa&lt;FixedVectorType&gt;(SVI-&gt;getType()) &amp;&amp; isa&lt;ConstantInt&gt;(<a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>)) {</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        <span class="keywordtype">int</span> SrcIdx =</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            SVI-&gt;getMaskValue(cast&lt;ConstantInt&gt;(<a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>)-&gt;getZExtValue());</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *Src;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        <span class="keywordtype">unsigned</span> LHSWidth = cast&lt;FixedVectorType&gt;(SVI-&gt;getOperand(0)-&gt;getType())</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                                -&gt;getNumElements();</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160; </div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        <span class="keywordflow">if</span> (SrcIdx &lt; 0)</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;          <span class="keywordflow">return</span> replaceInstUsesWith(EI, <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(EI.<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()));</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        <span class="keywordflow">if</span> (SrcIdx &lt; (<span class="keywordtype">int</span>)LHSWidth)</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;          Src = SVI-&gt;getOperand(0);</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;          SrcIdx -= LHSWidth;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;          Src = SVI-&gt;getOperand(1);</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        }</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <a class="code" href="classllvm_1_1Type.html">Type</a> *<a class="code" href="NVVMIntrRange_8cpp.html#abc8aecb5b627f6a91fc2fb09762d2a41">Int32Ty</a> = <a class="code" href="classllvm_1_1Type.html#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(EI.<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1ExtractElementInst.html#a5d496a334eff64bb2873339b54df932a">ExtractElementInst::Create</a>(</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            Src, <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(<a class="code" href="NVVMIntrRange_8cpp.html#abc8aecb5b627f6a91fc2fb09762d2a41">Int32Ty</a>, SrcIdx, <span class="keyword">false</span>));</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      }</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *CI = dyn_cast&lt;CastInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;      <span class="comment">// Canonicalize extractelement(cast) -&gt; cast(extractelement).</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;      <span class="comment">// Bitcasts can change the number of vector elements, and they cost</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      <span class="comment">// nothing.</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      <span class="keywordflow">if</span> (CI-&gt;hasOneUse() &amp;&amp; (CI-&gt;getOpcode() != Instruction::BitCast)) {</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *EE = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateExtractElement(CI-&gt;getOperand(0), <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>);</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1CastInst.html#a643fe5a9e7042f032dae78109c2b1e72">CastInst::Create</a>(CI-&gt;getOpcode(), EE, EI.<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      }</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    }</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  }</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160; </div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  <span class="comment">// Run demanded elements after other transforms as this can drop flags on</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <span class="comment">// binops.  If there&#39;s two paths to the same final result, we prefer the</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <span class="comment">// one which doesn&#39;t force us to drop flags.</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="keywordflow">if</span> (IndexC) {</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <a class="code" href="classllvm_1_1ElementCount.html">ElementCount</a> EC = EI.<a class="code" href="classllvm_1_1ExtractElementInst.html#a0774641c6da546aae7993a45235c73c0">getVectorOperandType</a>()-&gt;<a class="code" href="classllvm_1_1VectorType.html#a59632c5deb0423a518ad984bdd04d41f">getElementCount</a>();</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keywordtype">unsigned</span> NumElts = EC.getKnownMinValue();</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="comment">// This instruction only demands the single element from the input vector.</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="comment">// Skip for scalable type, the number of elements is unknown at</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="comment">// compile-time.</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordflow">if</span> (!EC.isScalable() &amp;&amp; NumElts != 1) {</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      <span class="comment">// If the input vector has a single use, simplify it based on this use</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <span class="comment">// property.</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      <span class="keywordflow">if</span> (SrcVec-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>()) {</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        <a class="code" href="classllvm_1_1APInt.html">APInt</a> UndefElts(NumElts, 0);</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <a class="code" href="classllvm_1_1APInt.html">APInt</a> DemandedElts(NumElts, 0);</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        DemandedElts.<a class="code" href="classllvm_1_1APInt.html#a33f9f862dca8ee0f23bff5941bf433d8">setBit</a>(IndexC-&gt;getZExtValue());</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V =</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                SimplifyDemandedVectorElts(SrcVec, DemandedElts, UndefElts))</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;          <span class="keywordflow">return</span> replaceOperand(EI, 0, V);</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        <span class="comment">// If the input vector has multiple uses, simplify it based on a union</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        <span class="comment">// of all elements used.</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        <a class="code" href="classllvm_1_1APInt.html">APInt</a> DemandedElts = <a class="code" href="InstCombineVectorOps_8cpp.html#a1e71f36e9936f126265e383fd67440f7">findDemandedEltsByAllUsers</a>(SrcVec);</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        <span class="keywordflow">if</span> (!DemandedElts.<a class="code" href="classllvm_1_1APInt.html#a423e2c491de1408d54e35f0b47d076be">isAllOnes</a>()) {</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;          <a class="code" href="classllvm_1_1APInt.html">APInt</a> UndefElts(NumElts, 0);</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V = SimplifyDemandedVectorElts(</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                  SrcVec, DemandedElts, UndefElts, 0 <span class="comment">/* Depth */</span>,</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                  <span class="keyword">true</span> <span class="comment">/* AllowMultipleUsers */</span>)) {</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            <span class="keywordflow">if</span> (V != SrcVec) {</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;              SrcVec-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(V);</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;              <span class="keywordflow">return</span> &amp;EI;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;            }</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;          }</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        }</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      }</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    }</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  }</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;}</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="comment">/// If V is a shuffle of values that ONLY returns elements from either LHS or</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment">/// RHS, return the shuffle mask and true. Otherwise, return false.</span></div>
<div class="line"><a name="l00610"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#a0f22159dceed07fd0d5d47915a80dc72">  610</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="InstCombineVectorOps_8cpp.html#a0f22159dceed07fd0d5d47915a80dc72">collectSingleShuffleElements</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>,</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                                         <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;int&gt;</a> &amp;<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>) {</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() == <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() &amp;&amp;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;         <span class="stringliteral">&quot;Invalid CollectSingleShuffleElements&quot;</span>);</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  <span class="keywordtype">unsigned</span> NumElts = cast&lt;FixedVectorType&gt;(V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getNumElements();</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160; </div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>())) {</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.assign(NumElts, -1);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  }</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160; </div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  <span class="keywordflow">if</span> (V == <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>) {</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != NumElts; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.push_back(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  }</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160; </div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <span class="keywordflow">if</span> (V == <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) {</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != NumElts; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.push_back(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> + NumElts);</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  }</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160; </div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> *IEI = dyn_cast&lt;InsertElementInst&gt;(V)) {</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <span class="comment">// If this is an insert of an extract from some other vector, include it.</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *VecOp    = IEI-&gt;getOperand(0);</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *ScalarOp = IEI-&gt;getOperand(1);</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *IdxOp    = IEI-&gt;getOperand(2);</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160; </div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="keywordflow">if</span> (!isa&lt;ConstantInt&gt;(IdxOp))</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="keywordtype">unsigned</span> InsertedIdx = cast&lt;ConstantInt&gt;(IdxOp)-&gt;getZExtValue();</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160; </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <span class="keywordflow">if</span> (isa&lt;UndefValue&gt;(ScalarOp)) {  <span class="comment">// inserting undef into vector.</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      <span class="comment">// We can handle this if the vector we are inserting into is</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      <span class="comment">// transitively ok.</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="InstCombineVectorOps_8cpp.html#a0f22159dceed07fd0d5d47915a80dc72">collectSingleShuffleElements</a>(VecOp, <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>)) {</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        <span class="comment">// If so, update the mask to reflect the inserted undef.</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[InsertedIdx] = -1;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      }</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ExtractElementInst.html">ExtractElementInst</a> *EI = dyn_cast&lt;ExtractElementInst&gt;(ScalarOp)){</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      <span class="keywordflow">if</span> (isa&lt;ConstantInt&gt;(EI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1))) {</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        <span class="keywordtype">unsigned</span> ExtractedIdx =</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        cast&lt;ConstantInt&gt;(EI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1))-&gt;getZExtValue();</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <span class="keywordtype">unsigned</span> NumLHSElts =</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;            cast&lt;FixedVectorType&gt;(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getNumElements();</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        <span class="comment">// This must be extracting from either LHS or RHS.</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        <span class="keywordflow">if</span> (EI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0) == <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> || EI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0) == <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) {</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;          <span class="comment">// We can handle this if the vector we are inserting into is</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;          <span class="comment">// transitively ok.</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="InstCombineVectorOps_8cpp.html#a0f22159dceed07fd0d5d47915a80dc72">collectSingleShuffleElements</a>(VecOp, <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>)) {</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;            <span class="comment">// If so, update the mask to reflect the inserted value.</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;            <span class="keywordflow">if</span> (EI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0) == <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>) {</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;              <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[InsertedIdx % NumElts] = ExtractedIdx;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;              <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0) == <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;              <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[InsertedIdx % NumElts] = ExtractedIdx + NumLHSElts;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;            }</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;          }</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        }</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      }</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    }</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  }</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160; </div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;}</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="comment">/// If we have insertion into a vector that is wider than the vector that we</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="comment">/// are extracting from, try to widen the source vector to allow a single</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="comment">/// shufflevector to replace one or more insert/extract pairs.</span></div>
<div class="line"><a name="l00683"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#a8f761d8d25e621e047614102c8569648">  683</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="InstCombineVectorOps_8cpp.html#a8f761d8d25e621e047614102c8569648">replaceExtractElements</a>(<a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> *InsElt,</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                                   <a class="code" href="classllvm_1_1ExtractElementInst.html">ExtractElementInst</a> *ExtElt,</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                                   <a class="code" href="classllvm_1_1InstCombinerImpl.html">InstCombinerImpl</a> &amp;IC) {</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <span class="keyword">auto</span> *InsVecType = cast&lt;FixedVectorType&gt;(InsElt-&gt;<a class="code" href="classllvm_1_1InsertElementInst.html#a5532ffa629e5d85d605bb379f7aed857">getType</a>());</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  <span class="keyword">auto</span> *ExtVecType = cast&lt;FixedVectorType&gt;(ExtElt-&gt;<a class="code" href="classllvm_1_1ExtractElementInst.html#a0774641c6da546aae7993a45235c73c0">getVectorOperandType</a>());</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  <span class="keywordtype">unsigned</span> NumInsElts = InsVecType-&gt;getNumElements();</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <span class="keywordtype">unsigned</span> NumExtElts = ExtVecType-&gt;getNumElements();</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160; </div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  <span class="comment">// The inserted-to vector must be wider than the extracted-from vector.</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  <span class="keywordflow">if</span> (InsVecType-&gt;getElementType() != ExtVecType-&gt;getElementType() ||</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      NumExtElts &gt;= NumInsElts)</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160; </div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  <span class="comment">// Create a shuffle mask to widen the extended-from vector using poison</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  <span class="comment">// values. The mask selects all of the values of the original vector followed</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  <span class="comment">// by as many poison values as needed to create a vector of the same length</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  <span class="comment">// as the inserted-to vector.</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int, 16&gt;</a> ExtendMask;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; NumExtElts; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    ExtendMask.push_back(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = NumExtElts; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; NumInsElts; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    ExtendMask.push_back(-1);</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160; </div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ExtVecOp = ExtElt-&gt;<a class="code" href="classllvm_1_1ExtractElementInst.html#aaeb8650ea4319878fc7529daaaf0a9be">getVectorOperand</a>();</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  <span class="keyword">auto</span> *ExtVecOpInst = dyn_cast&lt;Instruction&gt;(ExtVecOp);</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *InsertionBlock = (ExtVecOpInst &amp;&amp; !isa&lt;PHINode&gt;(ExtVecOpInst))</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                                   ? ExtVecOpInst-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a38bee869ad41aebfef3de2641b12004c">getParent</a>()</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                                   : ExtElt-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160; </div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  <span class="comment">// TODO: This restriction matches the basic block check below when creating</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  <span class="comment">// new extractelement instructions. If that limitation is removed, this one</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  <span class="comment">// could also be removed. But for now, we just bail out to ensure that we</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  <span class="comment">// will replace the extractelement instruction that is feeding our</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  <span class="comment">// insertelement instruction. This allows the insertelement to then be</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  <span class="comment">// replaced by a shufflevector. If the insertelement is not replaced, we can</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  <span class="comment">// induce infinite looping because there&#39;s an optimization for extractelement</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  <span class="comment">// that will delete our widening shuffle. This would trigger another attempt</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <span class="comment">// here to create that shuffle, and we spin forever.</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  <span class="keywordflow">if</span> (InsertionBlock != InsElt-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>())</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160; </div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  <span class="comment">// TODO: This restriction matches the check in visitInsertElementInst() and</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  <span class="comment">// prevents an infinite loop caused by not turning the extract/insert pair</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <span class="comment">// into a shuffle. We really should not need either check, but we&#39;re lacking</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  <span class="comment">// folds for shufflevectors because we&#39;re afraid to generate shuffle masks</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  <span class="comment">// that the backend can&#39;t handle.</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <span class="keywordflow">if</span> (InsElt-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; isa&lt;InsertElementInst&gt;(InsElt-&gt;<a class="code" href="classllvm_1_1Instruction.html#a2fd1d2dc14e22227cfa8238778ab87b8">user_back</a>()))</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160; </div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  <span class="keyword">auto</span> *WideVec = <span class="keyword">new</span> <a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a>(ExtVecOp, ExtendMask);</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160; </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  <span class="comment">// Insert the new shuffle after the vector operand of the extract is defined</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  <span class="comment">// (as long as it&#39;s not a PHI) or at the start of the basic block of the</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  <span class="comment">// extract, so any subsequent extracts in the same basic block can use it.</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  <span class="comment">// TODO: Insert before the earliest ExtractElementInst that is replaced.</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  <span class="keywordflow">if</span> (ExtVecOpInst &amp;&amp; !isa&lt;PHINode&gt;(ExtVecOpInst))</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    WideVec-&gt;insertAfter(ExtVecOpInst);</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    IC.<a class="code" href="classllvm_1_1InstCombiner.html#a5d11a3501303760859b83f2915434e32">InsertNewInstWith</a>(WideVec, *ExtElt-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>());</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160; </div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  <span class="comment">// Replace extracts from the original narrow vector with extracts from the new</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;  <span class="comment">// wide vector.</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1User.html">User</a> *U : ExtVecOp-&gt;<a class="code" href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">users</a>()) {</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <a class="code" href="classllvm_1_1ExtractElementInst.html">ExtractElementInst</a> *OldExt = dyn_cast&lt;ExtractElementInst&gt;(U);</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="keywordflow">if</span> (!OldExt || OldExt-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>() != WideVec-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a38bee869ad41aebfef3de2641b12004c">getParent</a>())</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <span class="keyword">auto</span> *NewExt = <a class="code" href="classllvm_1_1ExtractElementInst.html#a5d496a334eff64bb2873339b54df932a">ExtractElementInst::Create</a>(WideVec, OldExt-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1));</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    NewExt-&gt;insertAfter(OldExt);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    IC.<a class="code" href="classllvm_1_1InstCombiner.html#aa00031e59684d793baa874f11ddaf189">replaceInstUsesWith</a>(*OldExt, NewExt);</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;  }</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;}</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="comment">/// We are building a shuffle to create V, which is a sequence of insertelement,</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="comment">/// extractelement pairs. If PermittedRHS is set, then we must either use it or</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="comment">/// not rely on the second vector source. Return a std::pair containing the</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="comment">/// left and right vectors of the proposed shuffle (or 0), and set the Mask</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="comment">/// parameter as required.</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="comment">/// Note: we intentionally don&#39;t try to fold earlier shuffles since they have</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="comment">/// often been chosen carefully to be efficiently implementable on the target.</span></div>
<div class="line"><a name="l00763"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#a5ef308f5547e4c1a6dfe646dd7ea7abc">  763</a></span>&#160;<span class="comment"></span><span class="keyword">using</span> <a class="code" href="InstCombineVectorOps_8cpp.html#a5ef308f5547e4c1a6dfe646dd7ea7abc">ShuffleOps</a> = std::pair&lt;Value *, Value *&gt;;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160; </div>
<div class="line"><a name="l00765"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#a734417c242634bee69281295ccc5e863">  765</a></span>&#160;<span class="keyword">static</span> <a class="code" href="InstCombineVectorOps_8cpp.html#a5ef308f5547e4c1a6dfe646dd7ea7abc">ShuffleOps</a> <a class="code" href="InstCombineVectorOps_8cpp.html#a734417c242634bee69281295ccc5e863">collectShuffleElements</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;int&gt;</a> &amp;<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>,</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                                         <a class="code" href="classllvm_1_1Value.html">Value</a> *PermittedRHS,</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                                         <a class="code" href="classllvm_1_1InstCombinerImpl.html">InstCombinerImpl</a> &amp;IC) {</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() &amp;&amp; <span class="stringliteral">&quot;Invalid shuffle!&quot;</span>);</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  <span class="keywordtype">unsigned</span> NumElts = cast&lt;FixedVectorType&gt;(V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getNumElements();</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160; </div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>())) {</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.assign(NumElts, -1);</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <span class="keywordflow">return</span> std::make_pair(</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        PermittedRHS ? <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(PermittedRHS-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()) : V, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  }</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160; </div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <span class="keywordflow">if</span> (isa&lt;ConstantAggregateZero&gt;(V)) {</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.assign(NumElts, 0);</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keywordflow">return</span> std::make_pair(V, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  }</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160; </div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> *IEI = dyn_cast&lt;InsertElementInst&gt;(V)) {</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="comment">// If this is an insert of an extract from some other vector, include it.</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *VecOp    = IEI-&gt;getOperand(0);</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *ScalarOp = IEI-&gt;getOperand(1);</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *IdxOp    = IEI-&gt;getOperand(2);</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160; </div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ExtractElementInst.html">ExtractElementInst</a> *EI = dyn_cast&lt;ExtractElementInst&gt;(ScalarOp)) {</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;      <span class="keywordflow">if</span> (isa&lt;ConstantInt&gt;(EI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1)) &amp;&amp; isa&lt;ConstantInt&gt;(IdxOp)) {</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        <span class="keywordtype">unsigned</span> ExtractedIdx =</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;          cast&lt;ConstantInt&gt;(EI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1))-&gt;getZExtValue();</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        <span class="keywordtype">unsigned</span> InsertedIdx = cast&lt;ConstantInt&gt;(IdxOp)-&gt;getZExtValue();</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160; </div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <span class="comment">// Either the extracted from or inserted into vector must be RHSVec,</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <span class="comment">// otherwise we&#39;d end up with a shuffle of three inputs.</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        <span class="keywordflow">if</span> (EI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0) == PermittedRHS || PermittedRHS == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = EI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;          <a class="code" href="InstCombineVectorOps_8cpp.html#a5ef308f5547e4c1a6dfe646dd7ea7abc">ShuffleOps</a> LR = <a class="code" href="InstCombineVectorOps_8cpp.html#a734417c242634bee69281295ccc5e863">collectShuffleElements</a>(VecOp, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, IC);</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LR.second == <span class="keyword">nullptr</span> || LR.second == <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160; </div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;          <span class="keywordflow">if</span> (LR.first-&gt;getType() != <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()) {</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;            <span class="comment">// Although we are giving up for now, see if we can create extracts</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;            <span class="comment">// that match the inserts for another round of combining.</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;            <a class="code" href="InstCombineVectorOps_8cpp.html#a8f761d8d25e621e047614102c8569648">replaceExtractElements</a>(IEI, EI, IC);</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160; </div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            <span class="comment">// We tried our best, but we can&#39;t find anything compatible with RHS</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            <span class="comment">// further up the chain. Return a trivial shuffle.</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; NumElts; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;              <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;            <span class="keywordflow">return</span> std::make_pair(V, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;          }</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160; </div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;          <span class="keywordtype">unsigned</span> NumLHSElts =</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;              cast&lt;FixedVectorType&gt;(<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getNumElements();</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;          <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[InsertedIdx % NumElts] = NumLHSElts + ExtractedIdx;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;          <span class="keywordflow">return</span> std::make_pair(LR.first, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        }</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160; </div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        <span class="keywordflow">if</span> (VecOp == PermittedRHS) {</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;          <span class="comment">// We&#39;ve gone as far as we can: anything on the other side of the</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;          <span class="comment">// extractelement will already have been converted into a shuffle.</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;          <span class="keywordtype">unsigned</span> NumLHSElts =</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;              cast&lt;FixedVectorType&gt;(EI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                  -&gt;getNumElements();</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != NumElts; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;            <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.push_back(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> == InsertedIdx ? ExtractedIdx : NumLHSElts + <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;          <span class="keywordflow">return</span> std::make_pair(EI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), PermittedRHS);</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        }</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160; </div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        <span class="comment">// If this insertelement is a chain that comes from exactly these two</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        <span class="comment">// vectors, return the vector and the effective shuffle.</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        <span class="keywordflow">if</span> (EI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() == PermittedRHS-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() &amp;&amp;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;            <a class="code" href="InstCombineVectorOps_8cpp.html#a0f22159dceed07fd0d5d47915a80dc72">collectSingleShuffleElements</a>(IEI, EI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), PermittedRHS,</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;                                         <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>))</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;          <span class="keywordflow">return</span> std::make_pair(EI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), PermittedRHS);</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;      }</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    }</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  }</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160; </div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;  <span class="comment">// Otherwise, we can&#39;t do anything fancy. Return an identity vector.</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != NumElts; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.push_back(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  <span class="keywordflow">return</span> std::make_pair(V, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;}</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="comment">/// Look for chain of insertvalue&#39;s that fully define an aggregate, and trace</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="comment">/// back the values inserted, see if they are all were extractvalue&#39;d from</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="comment">/// the same source aggregate from the exact same element indexes.</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="comment">/// If they were, just reuse the source aggregate.</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="comment">/// This potentially deals with PHI indirections.</span></div>
<div class="line"><a name="l00851"></a><span class="lineno"><a class="line" href="classllvm_1_1InstCombinerImpl.html#acad657182350311f85bc33387733e506">  851</a></span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1InstCombinerImpl.html#acad657182350311f85bc33387733e506">InstCombinerImpl::foldAggregateConstructionIntoAggregateReuse</a>(</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <a class="code" href="classllvm_1_1InsertValueInst.html">InsertValueInst</a> &amp;OrigIVI) {</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *AggTy = OrigIVI.<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  <span class="keywordtype">unsigned</span> NumAggElts;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  <span class="keywordflow">switch</span> (AggTy-&gt;<a class="code" href="classllvm_1_1Type.html#ac7b0ed5c6d30bad74769c6e87ab0edb8">getTypeID</a>()) {</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1Type.html#a5e9e1c0dd93557be1b4ad72860f3cbdaa812a573d23fbb37aacd025e2a0588156">Type::StructTyID</a>:</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    NumAggElts = AggTy-&gt;<a class="code" href="classllvm_1_1Type.html#a58e54adaa7672bbf72091254a5391137">getStructNumElements</a>();</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1Type.html#a5e9e1c0dd93557be1b4ad72860f3cbdaa2989d3024a84b4dda9d77419b1648554">Type::ArrayTyID</a>:</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    NumAggElts = AggTy-&gt;<a class="code" href="classllvm_1_1Type.html#a5cfdb1cd5ccaae5daa8e4b29b3bb6b82">getArrayNumElements</a>();</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Unhandled aggregate type?&quot;</span>);</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  }</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160; </div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  <span class="comment">// Arbitrary aggregate size cut-off. Motivation for limit of 2 is to be able</span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <span class="comment">// to handle clang C++ exception struct (which is hardcoded as {i8*, i32}),</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  <span class="comment">// FIXME: any interesting patterns to be caught with larger limit?</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NumAggElts &gt; 0 &amp;&amp; <span class="stringliteral">&quot;Aggregate should have elements.&quot;</span>);</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  <span class="keywordflow">if</span> (NumAggElts &gt; 2)</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160; </div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  <span class="keyword">static</span> constexpr <span class="keyword">auto</span> <a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078aa2a0de09ad7131649f5caf2ca1093396">NotFound</a> = std::nullopt;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  <span class="keyword">static</span> constexpr <span class="keyword">auto</span> FoundMismatch = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160; </div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <span class="comment">// Try to find a value of each element of an aggregate.</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  <span class="comment">// FIXME: deal with more complex, not one-dimensional, aggregate types</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::optional&lt;Instruction *&gt;</a>, 2&gt; AggElts(NumAggElts, <a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078aa2a0de09ad7131649f5caf2ca1093396">NotFound</a>);</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160; </div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="comment">// Do we know values for each element of the aggregate?</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  <span class="keyword">auto</span> KnowAllElts = [&amp;AggElts]() {</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <span class="keywordflow">return</span> !<a class="code" href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">llvm::is_contained</a>(AggElts, <a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078aa2a0de09ad7131649f5caf2ca1093396">NotFound</a>);</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  };</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160; </div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> = 0;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160; </div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  <span class="comment">// Arbitrary `insertvalue` visitation depth limit. Let&#39;s be okay with</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <span class="comment">// every element being overwritten twice, which should never happen.</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> DepthLimit = 2 * NumAggElts;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160; </div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  <span class="comment">// Recurse up the chain of `insertvalue` aggregate operands until either we&#39;ve</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  <span class="comment">// reconstructed full initializer or can&#39;t visit any more `insertvalue`&#39;s.</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1InsertValueInst.html">InsertValueInst</a> *CurrIVI = &amp;OrigIVI;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;       <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> &lt; DepthLimit &amp;&amp; CurrIVI &amp;&amp; !KnowAllElts();</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;       CurrIVI = dyn_cast&lt;InsertValueInst&gt;(CurrIVI-&gt;getAggregateOperand()),</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                       ++<a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>) {</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <span class="keyword">auto</span> *InsertedValue =</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        dyn_cast&lt;Instruction&gt;(CurrIVI-&gt;getInsertedValueOperand());</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <span class="keywordflow">if</span> (!InsertedValue)</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>; <span class="comment">// Inserted value must be produced by an instruction.</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160; </div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;unsigned int&gt;</a> Indices = CurrIVI-&gt;getIndices();</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160; </div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <span class="comment">// Don&#39;t bother with more than single-level aggregates.</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <span class="keywordflow">if</span> (Indices.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() != 1)</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>; <span class="comment">// FIXME: deal with more complex aggregates?</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160; </div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    <span class="comment">// Now, we may have already previously recorded the value for this element</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <span class="comment">// of an aggregate. If we did, that means the CurrIVI will later be</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <span class="comment">// overwritten with the already-recorded value. But if not, let&#39;s record it!</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    std::optional&lt;Instruction *&gt; &amp;Elt = AggElts[Indices.<a class="code" href="classllvm_1_1ArrayRef.html#a6bc2b53fce3b1d8975eea027d8a8eb90">front</a>()];</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    Elt = Elt.value_or(InsertedValue);</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160; </div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <span class="comment">// FIXME: should we handle chain-terminating undef base operand?</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  }</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160; </div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  <span class="comment">// Was that sufficient to deduce the full initializer for the aggregate?</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  <span class="keywordflow">if</span> (!KnowAllElts())</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>; <span class="comment">// Give up then.</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160; </div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  <span class="comment">// We now want to find the source[s] of the aggregate elements we&#39;ve found.</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  <span class="comment">// And with &quot;source&quot; we mean the original aggregate[s] from which</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  <span class="comment">// the inserted elements were extracted. This may require PHI translation.</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160; </div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  <span class="keyword">enum class</span> AggregateDescription {<span class="comment"></span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="comment">    /// When analyzing the value that was inserted into an aggregate, we did</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="comment">    /// not manage to find defining `extractvalue` instruction to analyze.</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="comment"></span>    <a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078aa2a0de09ad7131649f5caf2ca1093396">NotFound</a>,<span class="comment"></span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="comment">    /// When analyzing the value that was inserted into an aggregate, we did</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="comment">    /// manage to find defining `extractvalue` instruction[s], and everything</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="comment">    /// matched perfectly - aggregate type, element insertion/extraction index.</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="comment"></span>    Found,<span class="comment"></span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="comment">    /// When analyzing the value that was inserted into an aggregate, we did</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="comment">    /// manage to find defining `extractvalue` instruction, but there was</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="comment">    /// a mismatch: either the source type from which the extraction was didn&#39;t</span></div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="comment">    /// match the aggregate type into which the insertion was,</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="comment">    /// or the extraction/insertion channels mismatched,</span></div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="comment">    /// or different elements had different source aggregates.</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="comment"></span>    FoundMismatch</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  };</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  <span class="keyword">auto</span> Describe = [](std::optional&lt;Value *&gt; SourceAggregate) {</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="keywordflow">if</span> (SourceAggregate == <a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078aa2a0de09ad7131649f5caf2ca1093396">NotFound</a>)</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078aa2a0de09ad7131649f5caf2ca1093396">AggregateDescription::NotFound</a>;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <span class="keywordflow">if</span> (*SourceAggregate == FoundMismatch)</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      <span class="keywordflow">return</span> AggregateDescription::FoundMismatch;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="keywordflow">return</span> AggregateDescription::Found;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  };</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160; </div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  <span class="comment">// Given the value \p Elt that was being inserted into element \p EltIdx of an</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  <span class="comment">// aggregate AggTy, see if \p Elt was originally defined by an</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  <span class="comment">// appropriate extractvalue (same element index, same aggregate type).</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  <span class="comment">// If found, return the source aggregate from which the extraction was.</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  <span class="comment">// If \p PredBB is provided, does PHI translation of an \p Elt first.</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  <span class="keyword">auto</span> FindSourceAggregate =</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;      [&amp;](<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Elt, <span class="keywordtype">unsigned</span> EltIdx, std::optional&lt;BasicBlock *&gt; UseBB,</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;          std::optional&lt;BasicBlock *&gt; PredBB) -&gt; std::optional&lt;Value *&gt; {</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    <span class="comment">// For now(?), only deal with, at most, a single level of PHI indirection.</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <span class="keywordflow">if</span> (UseBB &amp;&amp; PredBB)</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;      Elt = dyn_cast&lt;Instruction&gt;(Elt-&gt;<a class="code" href="classllvm_1_1Value.html#a159bf794249e0567baf2a2a714d5c679">DoPHITranslation</a>(*UseBB, *PredBB));</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <span class="comment">// FIXME: deal with multiple levels of PHI indirection?</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160; </div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <span class="comment">// Did we find an extraction?</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keyword">auto</span> *EVI = dyn_cast_or_null&lt;ExtractValueInst&gt;(Elt);</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="keywordflow">if</span> (!EVI)</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078aa2a0de09ad7131649f5caf2ca1093396">NotFound</a>;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160; </div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *SourceAggregate = EVI-&gt;getAggregateOperand();</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160; </div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <span class="comment">// Is the extraction from the same type into which the insertion was?</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <span class="keywordflow">if</span> (SourceAggregate-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() != AggTy)</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;      <span class="keywordflow">return</span> FoundMismatch;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="comment">// And the element index doesn&#39;t change between extraction and insertion?</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <span class="keywordflow">if</span> (EVI-&gt;getNumIndices() != 1 || EltIdx != EVI-&gt;getIndices().front())</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      <span class="keywordflow">return</span> FoundMismatch;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160; </div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    <span class="keywordflow">return</span> SourceAggregate; <span class="comment">// AggregateDescription::Found</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  };</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160; </div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  <span class="comment">// Given elements AggElts that were constructing an aggregate OrigIVI,</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  <span class="comment">// see if we can find appropriate source aggregate for each of the elements,</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  <span class="comment">// and see it&#39;s the same aggregate for each element. If so, return it.</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  <span class="keyword">auto</span> FindCommonSourceAggregate =</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      [&amp;](std::optional&lt;BasicBlock *&gt; UseBB,</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;          std::optional&lt;BasicBlock *&gt; PredBB) -&gt; std::optional&lt;Value *&gt; {</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    std::optional&lt;Value *&gt; SourceAggregate;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160; </div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="namespacellvm.html#a7b2175e18ff52174fad26b6b68818564">enumerate</a>(AggElts)) {</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Describe(SourceAggregate) != AggregateDescription::FoundMismatch &amp;&amp;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;             <span class="stringliteral">&quot;We don&#39;t store nullptr in SourceAggregate!&quot;</span>);</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((Describe(SourceAggregate) == AggregateDescription::Found) ==</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;                 (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.index() != 0) &amp;&amp;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;             <span class="stringliteral">&quot;SourceAggregate should be valid after the first element,&quot;</span>);</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160; </div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;      <span class="comment">// For this element, is there a plausible source aggregate?</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      <span class="comment">// FIXME: we could special-case undef element, IFF we know that in the</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      <span class="comment">//        source aggregate said element isn&#39;t poison.</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;      std::optional&lt;Value *&gt; SourceAggregateForElement =</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;          FindSourceAggregate(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.value(), <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.index(), UseBB, PredBB);</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160; </div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;      <span class="comment">// Okay, what have we found? Does that correlate with previous findings?</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160; </div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;      <span class="comment">// Regardless of whether or not we have previously found source</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;      <span class="comment">// aggregate for previous elements (if any), if we didn&#39;t find one for</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;      <span class="comment">// this element, passthrough whatever we have just found.</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;      <span class="keywordflow">if</span> (Describe(SourceAggregateForElement) != AggregateDescription::Found)</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        <span class="keywordflow">return</span> SourceAggregateForElement;</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160; </div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;      <span class="comment">// Okay, we have found source aggregate for this element.</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;      <span class="comment">// Let&#39;s see what we already know from previous elements, if any.</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;      <span class="keywordflow">switch</span> (Describe(SourceAggregate)) {</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078aa2a0de09ad7131649f5caf2ca1093396">AggregateDescription::NotFound</a>:</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        <span class="comment">// This is apparently the first element that we have examined.</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        SourceAggregate = SourceAggregateForElement; <span class="comment">// Record the aggregate!</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        <span class="keywordflow">continue</span>; <span class="comment">// Great, now look at next element.</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;      <span class="keywordflow">case</span> AggregateDescription::Found:</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        <span class="comment">// We have previously already successfully examined other elements.</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;        <span class="comment">// Is this the same source aggregate we&#39;ve found for other elements?</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        <span class="keywordflow">if</span> (*SourceAggregateForElement != *SourceAggregate)</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;          <span class="keywordflow">return</span> FoundMismatch;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        <span class="keywordflow">continue</span>; <span class="comment">// Still the same aggregate, look at next element.</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      <span class="keywordflow">case</span> AggregateDescription::FoundMismatch:</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;        <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Can&#39;t happen. We would have early-exited then.&quot;</span>);</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;      };</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    }</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160; </div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Describe(SourceAggregate) == AggregateDescription::Found &amp;&amp;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;           <span class="stringliteral">&quot;Must be a valid Value&quot;</span>);</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    <span class="keywordflow">return</span> *SourceAggregate;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;  };</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160; </div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  std::optional&lt;Value *&gt; SourceAggregate;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160; </div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  <span class="comment">// Can we find the source aggregate without looking at predecessors?</span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  SourceAggregate = FindCommonSourceAggregate(<span class="comment">/*UseBB=*/</span>std::nullopt,</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;                                              <span class="comment">/*PredBB=*/</span>std::nullopt);</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  <span class="keywordflow">if</span> (Describe(SourceAggregate) != <a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078aa2a0de09ad7131649f5caf2ca1093396">AggregateDescription::NotFound</a>) {</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    <span class="keywordflow">if</span> (Describe(SourceAggregate) == AggregateDescription::FoundMismatch)</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>; <span class="comment">// Conflicting source aggregates!</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    ++NumAggregateReconstructionsSimplified;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <span class="keywordflow">return</span> replaceInstUsesWith(OrigIVI, *SourceAggregate);</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  }</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160; </div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  <span class="comment">// Okay, apparently we need to look at predecessors.</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160; </div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;  <span class="comment">// We should be smart about picking the &quot;use&quot; basic block, which will be the</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  <span class="comment">// merge point for aggregate, where we&#39;ll insert the final PHI that will be</span></div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  <span class="comment">// used instead of OrigIVI. Basic block of OrigIVI is *not* the right choice.</span></div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  <span class="comment">// We should look in which blocks each of the AggElts is being defined,</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  <span class="comment">// they all should be defined in the same basic block.</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *UseBB = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160; </div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> std::optional&lt;Instruction *&gt; &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : AggElts) {</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = (*I)-&gt;getParent();</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    <span class="comment">// If it&#39;s the first instruction we&#39;ve encountered, record the basic block.</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    <span class="keywordflow">if</span> (!UseBB) {</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;      UseBB = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>;</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    }</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    <span class="comment">// Otherwise, this must be the same basic block we&#39;ve seen previously.</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    <span class="keywordflow">if</span> (UseBB != <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  }</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160; </div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  <span class="comment">// If *all* of the elements are basic-block-independent, meaning they are</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  <span class="comment">// either function arguments, or constant expressions, then if we didn&#39;t</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  <span class="comment">// handle them without predecessor-aware handling, we won&#39;t handle them now.</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;  <span class="keywordflow">if</span> (!UseBB)</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160; </div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;  <span class="comment">// If we didn&#39;t manage to find source aggregate without looking at</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;  <span class="comment">// predecessors, and there are no predecessors to look at, then we&#39;re done.</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ad66c4759666aab78529658362b498c74">pred_empty</a>(UseBB))</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160; </div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  <span class="comment">// Arbitrary predecessor count limit.</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> PredCountLimit = 64;</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160; </div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;  <span class="comment">// Cache the (non-uniqified!) list of predecessors in a vector,</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  <span class="comment">// checking the limit at the same time for efficiency.</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BasicBlock *, 4&gt;</a> Preds; <span class="comment">// May have duplicates!</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred : <a class="code" href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">predecessors</a>(UseBB)) {</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    <span class="comment">// Don&#39;t bother if there are too many predecessors.</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <span class="keywordflow">if</span> (Preds.size() &gt;= PredCountLimit) <span class="comment">// FIXME: only count duplicates once?</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    Preds.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">emplace_back</a>(Pred);</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  }</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160; </div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;  <span class="comment">// For each predecessor, what is the source aggregate,</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;  <span class="comment">// from which all the elements were originally extracted from?</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  <span class="comment">// Note that we want for the map to have stable iteration order!</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;BasicBlock *, Value *, 4&gt;</a> SourceAggregates;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred : Preds) {</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    std::pair&lt;decltype(SourceAggregates)::iterator, <span class="keywordtype">bool</span>&gt; <a class="code" href="blake3__impl_8h.html#a78823051d1dad34b9b3d8120112e674d">IV</a> =</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;        SourceAggregates.<a class="code" href="classllvm_1_1DenseMapBase.html#a99f811d53704275b4158c62a2dd138d9">insert</a>({Pred, <span class="keyword">nullptr</span>});</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    <span class="comment">// Did we already evaluate this predecessor?</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="blake3__impl_8h.html#a78823051d1dad34b9b3d8120112e674d">IV</a>.second)</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160; </div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    <span class="comment">// Let&#39;s hope that when coming from predecessor Pred, all elements of the</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    <span class="comment">// aggregate produced by OrigIVI must have been originally extracted from</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    <span class="comment">// the same aggregate. Is that so? Can we find said original aggregate?</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    SourceAggregate = FindCommonSourceAggregate(UseBB, Pred);</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <span class="keywordflow">if</span> (Describe(SourceAggregate) != AggregateDescription::Found)</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>; <span class="comment">// Give up.</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    <a class="code" href="blake3__impl_8h.html#a78823051d1dad34b9b3d8120112e674d">IV</a>.first-&gt;second = *SourceAggregate;</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;  }</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160; </div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;  <span class="comment">// All good! Now we just need to thread the source aggregates here.</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;  <span class="comment">// Note that we have to insert the new PHI here, ourselves, because we can&#39;t</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;  <span class="comment">// rely on InstCombinerImpl::run() inserting it into the right basic block.</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;  <span class="comment">// Note that the same block can be a predecessor more than once,</span></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;  <span class="comment">// and we need to preserve that invariant for the PHI node.</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;  <a class="code" href="classllvm_1_1IRBuilderBase_1_1InsertPointGuard.html">BuilderTy::InsertPointGuard</a> Guard(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>);</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(UseBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a46ef6115027606b67adcf4d28f3dac17">getFirstNonPHI</a>());</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> =</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePHI(AggTy, Preds.size(), OrigIVI.<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + <span class="stringliteral">&quot;.merged&quot;</span>);</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred : Preds)</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;addIncoming(SourceAggregates[Pred], Pred);</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160; </div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;  ++NumAggregateReconstructionsSimplified;</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  <span class="keywordflow">return</span> replaceInstUsesWith(OrigIVI, <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>);</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;}</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="comment">/// Try to find redundant insertvalue instructions, like the following ones:</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="comment">///  %0 = insertvalue { i8, i32 } undef, i8 %x, 0</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="comment">///  %1 = insertvalue { i8, i32 } %0,    i8 %y, 0</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="comment">/// Here the second instruction inserts values at the same indices, as the</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="comment">/// first one, making the first one redundant.</span></div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="comment">/// It should be transformed to:</span></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="comment">///  %0 = insertvalue { i8, i32 } undef, i8 %y, 0</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"><a class="line" href="classllvm_1_1InstCombinerImpl.html#a643f8d7ef849e1312c83906b4b27b4aa"> 1131</a></span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1InstCombinerImpl.html#a643f8d7ef849e1312c83906b4b27b4aa">InstCombinerImpl::visitInsertValueInst</a>(<a class="code" href="classllvm_1_1InsertValueInst.html">InsertValueInst</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="namespacellvm.html#a94b67449bc2ce740bcec33d149769fe0">simplifyInsertValueInst</a>(</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;          <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getAggregateOperand(), <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getInsertedValueOperand(), <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getIndices(),</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;          SQ.getWithInstruction(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)))</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <span class="keywordflow">return</span> replaceInstUsesWith(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, V);</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160; </div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;  <span class="keywordtype">bool</span> IsRedundant = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;  <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;unsigned int&gt;</a> FirstIndices = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getIndices();</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160; </div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;  <span class="comment">// If there is a chain of insertvalue instructions (each of them except the</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;  <span class="comment">// last one has only one use and it&#39;s another insertvalue insn from this</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;  <span class="comment">// chain), check if any of the &#39;children&#39; uses the same indices as the first</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;  <span class="comment">// instruction. In this case, the first one is redundant.</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *V = &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> = 0;</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;  <span class="keywordflow">while</span> (V-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> &lt; 10) {</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    <a class="code" href="classllvm_1_1User.html">User</a> *U = V-&gt;<a class="code" href="classllvm_1_1Value.html#ac2e338e4c120fc3ea43099b54880f1f1">user_back</a>();</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    <span class="keyword">auto</span> UserInsInst = dyn_cast&lt;InsertValueInst&gt;(U);</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    <span class="keywordflow">if</span> (!UserInsInst || U-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0) != V)</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    <span class="keywordflow">if</span> (UserInsInst-&gt;getIndices() == FirstIndices) {</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      IsRedundant = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    }</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    V = UserInsInst;</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>++;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;  }</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160; </div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  <span class="keywordflow">if</span> (IsRedundant)</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    <span class="keywordflow">return</span> replaceInstUsesWith(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0));</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160; </div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NewI = foldAggregateConstructionIntoAggregateReuse(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    <span class="keywordflow">return</span> NewI;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160; </div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;}</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160; </div>
<div class="line"><a name="l01168"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#ace7029cdad3163ebfb8172d25e8a59e3"> 1168</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="InstCombineVectorOps_8cpp.html#ace7029cdad3163ebfb8172d25e8a59e3">isShuffleEquivalentToSelect</a>(<a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a> &amp;Shuf) {</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  <span class="comment">// Can not analyze scalable type, the number of elements is not a compile-time</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  <span class="comment">// constant.</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  <span class="keywordflow">if</span> (isa&lt;ScalableVectorType&gt;(Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()))</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160; </div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;  <span class="keywordtype">int</span> MaskSize = Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>().size();</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="namespacellvm_1_1ARMII.html#a7d414894ef8cdc39b147eb7e0d7e4305a479711d0ab662307550fc709665589ea">VecSize</a> =</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;      cast&lt;FixedVectorType&gt;(Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getNumElements();</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160; </div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  <span class="comment">// A vector select does not change the size of the operands.</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;  <span class="keywordflow">if</span> (MaskSize != <a class="code" href="namespacellvm_1_1ARMII.html#a7d414894ef8cdc39b147eb7e0d7e4305a479711d0ab662307550fc709665589ea">VecSize</a>)</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160; </div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;  <span class="comment">// Each mask element must be undefined or choose a vector element from one of</span></div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;  <span class="comment">// the source operands without crossing vector lanes.</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != MaskSize; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="keywordtype">int</span> Elt = Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a3fb8619f70f51242f81ef96da349c884">getMaskValue</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    <span class="keywordflow">if</span> (Elt != -1 &amp;&amp; Elt != <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &amp;&amp; Elt != <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> + <a class="code" href="namespacellvm_1_1ARMII.html#a7d414894ef8cdc39b147eb7e0d7e4305a479711d0ab662307550fc709665589ea">VecSize</a>)</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;  }</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160; </div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;}</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;<span class="comment">/// Turn a chain of inserts that splats a value into an insert + shuffle:</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;<span class="comment">/// insertelt(insertelt(insertelt(insertelt X, %k, 0), %k, 1), %k, 2) ... -&gt;</span></div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;<span class="comment">/// shufflevector(insertelt(X, %k, 0), poison, zero)</span></div>
<div class="line"><a name="l01196"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#abdea7254f33e7e14fa824284e56319c3"> 1196</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="InstCombineVectorOps_8cpp.html#abdea7254f33e7e14fa824284e56319c3">foldInsSequenceIntoSplat</a>(<a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> &amp;InsElt) {</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;  <span class="comment">// We are interested in the last insert in a chain. So if this insert has a</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;  <span class="comment">// single user and that user is an insert, bail.</span></div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;  <span class="keywordflow">if</span> (InsElt.<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; isa&lt;InsertElementInst&gt;(InsElt.<a class="code" href="classllvm_1_1Instruction.html#a2fd1d2dc14e22227cfa8238778ab87b8">user_back</a>()))</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160; </div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;  <a class="code" href="classllvm_1_1VectorType.html">VectorType</a> *VecTy = InsElt.<a class="code" href="classllvm_1_1InsertElementInst.html#a5532ffa629e5d85d605bb379f7aed857">getType</a>();</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;  <span class="comment">// Can not handle scalable type, the number of elements is not a compile-time</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;  <span class="comment">// constant.</span></div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;  <span class="keywordflow">if</span> (isa&lt;ScalableVectorType&gt;(VecTy))</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;  <span class="keywordtype">unsigned</span> NumElements = cast&lt;FixedVectorType&gt;(VecTy)-&gt;getNumElements();</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160; </div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;  <span class="comment">// Do not try to do this for a one-element vector, since that&#39;s a nop,</span></div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;  <span class="comment">// and will cause an inf-loop.</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;  <span class="keywordflow">if</span> (NumElements == 1)</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160; </div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *SplatVal = InsElt.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1);</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;  <a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> *CurrIE = &amp;InsElt;</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;  <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> ElementPresent(NumElements, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;  <a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> *FirstIE = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160; </div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;  <span class="comment">// Walk the chain backwards, keeping track of which indices we inserted into,</span></div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;  <span class="comment">// until we hit something that isn&#39;t an insert of the splatted value.</span></div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  <span class="keywordflow">while</span> (CurrIE) {</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    <span class="keyword">auto</span> *Idx = dyn_cast&lt;ConstantInt&gt;(CurrIE-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(2));</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    <span class="keywordflow">if</span> (!Idx || CurrIE-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1) != SplatVal)</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160; </div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    <span class="keyword">auto</span> *NextIE = dyn_cast&lt;InsertElementInst&gt;(CurrIE-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0));</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    <span class="comment">// Check none of the intermediate steps have any additional uses, except</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    <span class="comment">// for the root insertelement instruction, which can be re-used, if it</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    <span class="comment">// inserts at position 0.</span></div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <span class="keywordflow">if</span> (CurrIE != &amp;InsElt &amp;&amp;</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        (!CurrIE-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; (NextIE != <span class="keyword">nullptr</span> || !Idx-&gt;isZero())))</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160; </div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    ElementPresent[Idx-&gt;getZExtValue()] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    FirstIE = CurrIE;</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    CurrIE = NextIE;</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;  }</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160; </div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  <span class="comment">// If this is just a single insertelement (not a sequence), we are done.</span></div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  <span class="keywordflow">if</span> (FirstIE == &amp;InsElt)</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160; </div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  <span class="comment">// If we are not inserting into an undef vector, make sure we&#39;ve seen an</span></div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  <span class="comment">// insert into every element.</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;  <span class="comment">// TODO: If the base vector is not undef, it might be better to create a splat</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;  <span class="comment">//       and then a select-shuffle (blend) with the base vector.</span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(FirstIE-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>()))</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    <span class="keywordflow">if</span> (!ElementPresent.<a class="code" href="classllvm_1_1SmallBitVector.html#a8cfcd92a373cdd7deefb939dd76b83e3">all</a>())</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160; </div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;  <span class="comment">// Create the insert + shuffle.</span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *<a class="code" href="NVVMIntrRange_8cpp.html#abc8aecb5b627f6a91fc2fb09762d2a41">Int32Ty</a> = <a class="code" href="classllvm_1_1Type.html#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(InsElt.<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;  <a class="code" href="classllvm_1_1PoisonValue.html">PoisonValue</a> *PoisonVec = <a class="code" href="classllvm_1_1PoisonValue.html#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(VecTy);</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Zero = <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(<a class="code" href="NVVMIntrRange_8cpp.html#abc8aecb5b627f6a91fc2fb09762d2a41">Int32Ty</a>, 0);</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;  <span class="keywordflow">if</span> (!cast&lt;ConstantInt&gt;(FirstIE-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(2))-&gt;isZero())</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    FirstIE = <a class="code" href="classllvm_1_1InsertElementInst.html#a44cefc7b60337e7e14d20e843c74e534">InsertElementInst::Create</a>(PoisonVec, SplatVal, Zero, <span class="stringliteral">&quot;&quot;</span>, &amp;InsElt);</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160; </div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  <span class="comment">// Splat from element 0, but replace absent elements with undef in the mask.</span></div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int, 16&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>(NumElements, 0);</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != NumElements; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    <span class="keywordflow">if</span> (!ElementPresent[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>])</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;      <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] = -1;</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160; </div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a>(FirstIE, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;}</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;<span class="comment">/// Try to fold an insert element into an existing splat shuffle by changing</span></div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;<span class="comment">/// the shuffle&#39;s mask to include the index of this insert element.</span></div>
<div class="line"><a name="l01269"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#ace3f33981357525d7cbe1990a68212b5"> 1269</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="InstCombineVectorOps_8cpp.html#ace3f33981357525d7cbe1990a68212b5">foldInsEltIntoSplat</a>(<a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> &amp;InsElt) {</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;  <span class="comment">// Check if the vector operand of this insert is a canonical splat shuffle.</span></div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  <span class="keyword">auto</span> *Shuf = dyn_cast&lt;ShuffleVectorInst&gt;(InsElt.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0));</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;  <span class="keywordflow">if</span> (!Shuf || !Shuf-&gt;isZeroEltSplat())</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160; </div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;  <span class="comment">// Bail out early if shuffle is scalable type. The number of elements in</span></div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;  <span class="comment">// shuffle mask is unknown at compile-time.</span></div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;  <span class="keywordflow">if</span> (isa&lt;ScalableVectorType&gt;(Shuf-&gt;getType()))</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160; </div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;  <span class="comment">// Check for a constant insertion index.</span></div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> IdxC;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(InsElt.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(2), <a class="code" href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">m_ConstantInt</a>(IdxC)))</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160; </div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;  <span class="comment">// Check if the splat shuffle&#39;s input is the same as this insert&#39;s scalar op.</span></div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a> = InsElt.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1);</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Op0 = Shuf-&gt;getOperand(0);</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0, <a class="code" href="namespacellvm_1_1PatternMatch.html#a9cae528bdb66086aa6c06da36fc6fa24">m_InsertElt</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">m_Specific</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#a874d53817a4923de8e58af6b278c09b0">m_ZeroInt</a>())))</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160; </div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;  <span class="comment">// Replace the shuffle mask element at the index of this insert with a zero.</span></div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;  <span class="comment">// For example:</span></div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;  <span class="comment">// inselt (shuf (inselt undef, X, 0), _, &lt;0,undef,0,undef&gt;), X, 1</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;  <span class="comment">//   --&gt; shuf (inselt undef, X, 0), poison, &lt;0,0,0,undef&gt;</span></div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;  <span class="keywordtype">unsigned</span> NumMaskElts =</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;      cast&lt;FixedVectorType&gt;(Shuf-&gt;getType())-&gt;getNumElements();</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int, 16&gt;</a> NewMask(NumMaskElts);</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != NumMaskElts; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    NewMask[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> == IdxC ? 0 : Shuf-&gt;getMaskValue(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160; </div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a>(Op0, NewMask);</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;}</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="comment">/// Try to fold an extract+insert element into an existing identity shuffle by</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="comment">/// changing the shuffle&#39;s mask to include the index of this insert element.</span></div>
<div class="line"><a name="l01306"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#a639d4e2996fe104ec92be89876430b41"> 1306</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="InstCombineVectorOps_8cpp.html#a639d4e2996fe104ec92be89876430b41">foldInsEltIntoIdentityShuffle</a>(<a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> &amp;InsElt) {</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;  <span class="comment">// Check if the vector operand of this insert is an identity shuffle.</span></div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;  <span class="keyword">auto</span> *Shuf = dyn_cast&lt;ShuffleVectorInst&gt;(InsElt.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0));</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;  <span class="keywordflow">if</span> (!Shuf || !<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shuf-&gt;getOperand(1), <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>()) ||</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;      !(Shuf-&gt;isIdentityWithExtract() || Shuf-&gt;isIdentityWithPadding()))</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160; </div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;  <span class="comment">// Bail out early if shuffle is scalable type. The number of elements in</span></div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;  <span class="comment">// shuffle mask is unknown at compile-time.</span></div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;  <span class="keywordflow">if</span> (isa&lt;ScalableVectorType&gt;(Shuf-&gt;getType()))</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160; </div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  <span class="comment">// Check for a constant insertion index.</span></div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> IdxC;</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(InsElt.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(2), <a class="code" href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">m_ConstantInt</a>(IdxC)))</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160; </div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;  <span class="comment">// Check if this insert&#39;s scalar op is extracted from the identity shuffle&#39;s</span></div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;  <span class="comment">// input vector.</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Scalar = InsElt.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1);</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a> = Shuf-&gt;getOperand(0);</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Scalar, <a class="code" href="namespacellvm_1_1PatternMatch.html#adf0290c7c322f0bf8b275d6b26410b52">m_ExtractElt</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">m_Specific</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#a3acbd0be97863e3e03e3b85641254018">m_SpecificInt</a>(IdxC))))</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160; </div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;  <span class="comment">// Replace the shuffle mask element at the index of this extract+insert with</span></div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;  <span class="comment">// that same index value.</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;  <span class="comment">// For example:</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;  <span class="comment">// inselt (shuf X, IdMask), (extelt X, IdxC), IdxC --&gt; shuf X, IdMask&#39;</span></div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;  <span class="keywordtype">unsigned</span> NumMaskElts =</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;      cast&lt;FixedVectorType&gt;(Shuf-&gt;getType())-&gt;getNumElements();</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int, 16&gt;</a> NewMask(NumMaskElts);</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> OldMask = Shuf-&gt;getShuffleMask();</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != NumMaskElts; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != IdxC) {</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;      <span class="comment">// All mask elements besides the inserted element remain the same.</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;      NewMask[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] = OldMask[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (OldMask[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] == (<span class="keywordtype">int</span>)IdxC) {</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;      <span class="comment">// If the mask element was already set, there&#39;s nothing to do</span></div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;      <span class="comment">// (demanded elements analysis may unset it later).</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OldMask[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a> &amp;&amp;</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;             <span class="stringliteral">&quot;Unexpected shuffle mask element for identity shuffle&quot;</span>);</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;      NewMask[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] = IdxC;</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    }</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;  }</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160; </div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, Shuf-&gt;getOperand(1), NewMask);</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;}</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="comment">/// If we have an insertelement instruction feeding into another insertelement</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;<span class="comment">/// and the 2nd is inserting a constant into the vector, canonicalize that</span></div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="comment">/// constant insertion before the insertion of a variable:</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="comment">/// insertelement (insertelement X, Y, IdxC1), ScalarC, IdxC2 --&gt;</span></div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="comment">/// insertelement (insertelement X, ScalarC, IdxC2), Y, IdxC1</span></div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="comment">/// This has the potential of eliminating the 2nd insertelement instruction</span></div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="comment">/// via constant folding of the scalar constant into a vector constant.</span></div>
<div class="line"><a name="l01365"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#ac9f0c867cdd5fe902a7d49c4c3631090"> 1365</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="InstCombineVectorOps_8cpp.html#ac9f0c867cdd5fe902a7d49c4c3631090">hoistInsEltConst</a>(<a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> &amp;InsElt2,</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;                                     <a class="code" href="classllvm_1_1IRBuilder.html">InstCombiner::BuilderTy</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>) {</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;  <span class="keyword">auto</span> *InsElt1 = dyn_cast&lt;InsertElementInst&gt;(InsElt2.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0));</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;  <span class="keywordflow">if</span> (!InsElt1 || !InsElt1-&gt;hasOneUse())</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160; </div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, *<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>;</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *ScalarC;</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *IdxC1, *IdxC2;</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(InsElt1-&gt;getOperand(0), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>)) &amp;&amp;</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;      <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(InsElt1-&gt;getOperand(1), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>)) &amp;&amp; !isa&lt;Constant&gt;(<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>) &amp;&amp;</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;      <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(InsElt1-&gt;getOperand(2), <a class="code" href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">m_ConstantInt</a>(IdxC1)) &amp;&amp;</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;      <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(InsElt2.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1), <a class="code" href="namespacellvm_1_1PatternMatch.html#aadd209ba7e1bfa8113a609e09a7fe62f">m_Constant</a>(ScalarC)) &amp;&amp;</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;      <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(InsElt2.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(2), <a class="code" href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">m_ConstantInt</a>(IdxC2)) &amp;&amp; IdxC1 != IdxC2) {</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *NewInsElt1 = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateInsertElement(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, ScalarC, IdxC2);</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1InsertElementInst.html#a44cefc7b60337e7e14d20e843c74e534">InsertElementInst::Create</a>(NewInsElt1, <a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>, IdxC1);</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;  }</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160; </div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;}</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="comment">/// insertelt (shufflevector X, CVec, Mask|insertelt X, C1, CIndex1), C, CIndex</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="comment">/// --&gt; shufflevector X, CVec&#39;, Mask&#39;</span></div>
<div class="line"><a name="l01388"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#a2d94a30dbf5569ba774109343ed5f999"> 1388</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="InstCombineVectorOps_8cpp.html#a2d94a30dbf5569ba774109343ed5f999">foldConstantInsEltIntoShuffle</a>(<a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> &amp;InsElt) {</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;  <span class="keyword">auto</span> *Inst = dyn_cast&lt;Instruction&gt;(InsElt.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0));</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;  <span class="comment">// Bail out if the parent has more than one use. In that case, we&#39;d be</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;  <span class="comment">// replacing the insertelt with a shuffle, and that&#39;s not a clear win.</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;  <span class="keywordflow">if</span> (!Inst || !Inst-&gt;hasOneUse())</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *Shuf = dyn_cast&lt;ShuffleVectorInst&gt;(InsElt.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0))) {</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    <span class="comment">// The shuffle must have a constant vector operand. The insertelt must have</span></div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    <span class="comment">// a constant scalar being inserted at a constant position in the vector.</span></div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *ShufConstVec, *InsEltScalar;</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> InsEltIndex;</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shuf-&gt;getOperand(1), <a class="code" href="namespacellvm_1_1PatternMatch.html#aadd209ba7e1bfa8113a609e09a7fe62f">m_Constant</a>(ShufConstVec)) ||</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;        !<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(InsElt.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1), <a class="code" href="namespacellvm_1_1PatternMatch.html#aadd209ba7e1bfa8113a609e09a7fe62f">m_Constant</a>(InsEltScalar)) ||</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;        !<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(InsElt.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(2), <a class="code" href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">m_ConstantInt</a>(InsEltIndex)))</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160; </div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    <span class="comment">// Adding an element to an arbitrary shuffle could be expensive, but a</span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    <span class="comment">// shuffle that selects elements from vectors without crossing lanes is</span></div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    <span class="comment">// assumed cheap.</span></div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;    <span class="comment">// If we&#39;re just adding a constant into that shuffle, it will still be</span></div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    <span class="comment">// cheap.</span></div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="InstCombineVectorOps_8cpp.html#ace7029cdad3163ebfb8172d25e8a59e3">isShuffleEquivalentToSelect</a>(*Shuf))</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160; </div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    <span class="comment">// From the above &#39;select&#39; check, we know that the mask has the same number</span></div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    <span class="comment">// of elements as the vector input operands. We also know that each constant</span></div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    <span class="comment">// input element is used in its lane and can not be used more than once by</span></div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    <span class="comment">// the shuffle. Therefore, replace the constant in the shuffle&#39;s constant</span></div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    <span class="comment">// vector with the insertelt constant. Replace the constant in the shuffle&#39;s</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    <span class="comment">// mask vector with the insertelt index plus the length of the vector</span></div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    <span class="comment">// (because the constant vector operand of a shuffle is always the 2nd</span></div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    <span class="comment">// operand).</span></div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a> = Shuf-&gt;getShuffleMask();</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <span class="keywordtype">unsigned</span> NumElts = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size();</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Constant *, 16&gt;</a> NewShufElts(NumElts);</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int, 16&gt;</a> NewMaskElts(NumElts);</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != NumElts; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> == InsEltIndex) {</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;        NewShufElts[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = InsEltScalar;</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;        NewMaskElts[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = InsEltIndex + NumElts;</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;        <span class="comment">// Copy over the existing values.</span></div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;        NewShufElts[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = ShufConstVec-&gt;<a class="code" href="classllvm_1_1Constant.html#acd530d0571f320d47d37e7ae51cf70ff">getAggregateElement</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;        NewMaskElts[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;      }</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160; </div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;      <span class="comment">// Bail if we failed to find an element.</span></div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;      <span class="keywordflow">if</span> (!NewShufElts[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>])</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    }</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160; </div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;    <span class="comment">// Create new operands for a shuffle that includes the constant of the</span></div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    <span class="comment">// original insertelt. The old shuffle will be dead now.</span></div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a>(Shuf-&gt;getOperand(0),</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;                                 <a class="code" href="classllvm_1_1ConstantVector.html#ade9fa017ca3aa82f7694a47090547bc1">ConstantVector::get</a>(NewShufElts), NewMaskElts);</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *IEI = dyn_cast&lt;InsertElementInst&gt;(Inst)) {</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    <span class="comment">// Transform sequences of insertelements ops with constant data/indexes into</span></div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;    <span class="comment">// a single shuffle op.</span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    <span class="comment">// Can not handle scalable type, the number of elements needed to create</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    <span class="comment">// shuffle mask is not a compile-time constant.</span></div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    <span class="keywordflow">if</span> (isa&lt;ScalableVectorType&gt;(InsElt.<a class="code" href="classllvm_1_1InsertElementInst.html#a5532ffa629e5d85d605bb379f7aed857">getType</a>()))</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    <span class="keywordtype">unsigned</span> NumElts =</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;        cast&lt;FixedVectorType&gt;(InsElt.<a class="code" href="classllvm_1_1InsertElementInst.html#a5532ffa629e5d85d605bb379f7aed857">getType</a>())-&gt;getNumElements();</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160; </div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> InsertIdx[2];</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Val[2];</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(InsElt.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(2), <a class="code" href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">m_ConstantInt</a>(InsertIdx[0])) ||</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        !<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(InsElt.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1), <a class="code" href="namespacellvm_1_1PatternMatch.html#aadd209ba7e1bfa8113a609e09a7fe62f">m_Constant</a>(Val[0])) ||</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        !<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(IEI-&gt;getOperand(2), <a class="code" href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">m_ConstantInt</a>(InsertIdx[1])) ||</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;        !<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(IEI-&gt;getOperand(1), <a class="code" href="namespacellvm_1_1PatternMatch.html#aadd209ba7e1bfa8113a609e09a7fe62f">m_Constant</a>(Val[1])))</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Constant *, 16&gt;</a> Values(NumElts);</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int, 16&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>(NumElts);</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    <span class="keyword">auto</span> ValI = <a class="code" href="namespacellvm_1_1sys_1_1path.html#a00a76a729b319dc47beffbe07325565f">std::begin</a>(Val);</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    <span class="comment">// Generate new constant vector and mask.</span></div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    <span class="comment">// We have 2 values/masks from the insertelements instructions. Insert them</span></div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    <span class="comment">// into new value/mask vectors.</span></div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : InsertIdx) {</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;      <span class="keywordflow">if</span> (!Values[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]) {</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;        Values[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = *ValI;</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;        <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = NumElts + <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;      }</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;      ++ValI;</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    }</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    <span class="comment">// Remaining values are filled with &#39;undef&#39; values.</span></div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumElts; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;      <span class="keywordflow">if</span> (!Values[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]) {</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;        Values[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(InsElt.<a class="code" href="classllvm_1_1InsertElementInst.html#a5532ffa629e5d85d605bb379f7aed857">getType</a>()-&gt;<a class="code" href="classllvm_1_1VectorType.html#a12e23c3d619db313388fe11dc76eb23f">getElementType</a>());</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;        <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;      }</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;    }</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    <span class="comment">// Create new operands for a shuffle that includes the constant of the</span></div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    <span class="comment">// original insertelt.</span></div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a>(IEI-&gt;getOperand(0),</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;                                 <a class="code" href="classllvm_1_1ConstantVector.html#ade9fa017ca3aa82f7694a47090547bc1">ConstantVector::get</a>(Values), <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;  }</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;}</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;<span class="comment">/// If both the base vector and the inserted element are extended from the same</span></div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;<span class="comment">/// type, do the insert element in the narrow source type followed by extend.</span></div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;<span class="comment">/// TODO: This can be extended to include other cast opcodes, but particularly</span></div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;<span class="comment">///       if we create a wider insertelement, make sure codegen is not harmed.</span></div>
<div class="line"><a name="l01492"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#a4f825637c0198827411f5f11aa3f2deb"> 1492</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="InstCombineVectorOps_8cpp.html#a4f825637c0198827411f5f11aa3f2deb">narrowInsElt</a>(<a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> &amp;InsElt,</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;                                 <a class="code" href="classllvm_1_1IRBuilder.html">InstCombiner::BuilderTy</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>) {</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;  <span class="comment">// We are creating a vector extend. If the original vector extend has another</span></div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;  <span class="comment">// use, that would mean we end up with 2 vector extends, so avoid that.</span></div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;  <span class="comment">// TODO: We could ease the use-clause to &quot;if at least one op has one use&quot;</span></div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;  <span class="comment">//       (assuming that the source types match - see next TODO comment).</span></div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Vec = InsElt.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;  <span class="keywordflow">if</span> (!Vec-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160; </div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Scalar = InsElt.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1);</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, *<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>;</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html#afa0b2fa29ba074f2b6ec9ac11163f2d9">CastInst::CastOps</a> CastOpcode;</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Vec, <a class="code" href="namespacellvm_1_1PatternMatch.html#a2997340992a508357b480467a6901c70">m_FPExt</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>))) &amp;&amp; <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Scalar, <a class="code" href="namespacellvm_1_1PatternMatch.html#a2997340992a508357b480467a6901c70">m_FPExt</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>))))</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    CastOpcode = Instruction::FPExt;</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Vec, <a class="code" href="namespacellvm_1_1PatternMatch.html#aaab494a433fbb23bc68393ee8bcfc5ac">m_SExt</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>))) &amp;&amp; <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Scalar, <a class="code" href="namespacellvm_1_1PatternMatch.html#aaab494a433fbb23bc68393ee8bcfc5ac">m_SExt</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>))))</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    CastOpcode = Instruction::SExt;</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Vec, <a class="code" href="namespacellvm_1_1PatternMatch.html#a2cbdca7c8267aac6914d674f8e81841b">m_ZExt</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>))) &amp;&amp; <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Scalar, <a class="code" href="namespacellvm_1_1PatternMatch.html#a2cbdca7c8267aac6914d674f8e81841b">m_ZExt</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>))))</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    CastOpcode = Instruction::ZExt;</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160; </div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;  <span class="comment">// TODO: We can allow mismatched types by creating an intermediate cast.</span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>-&gt;getType()-&gt;getScalarType() != <a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>-&gt;getType())</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160; </div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;  <span class="comment">// inselt (ext X), (ext Y), Index --&gt; ext (inselt X, Y, Index)</span></div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewInsElt = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateInsertElement(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, <a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>, InsElt.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(2));</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1CastInst.html#a643fe5a9e7042f032dae78109c2b1e72">CastInst::Create</a>(CastOpcode, NewInsElt, InsElt.<a class="code" href="classllvm_1_1InsertElementInst.html#a5532ffa629e5d85d605bb379f7aed857">getType</a>());</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;}</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;<span class="comment">/// If we are inserting 2 halves of a value into adjacent elements of a vector,</span></div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;<span class="comment">/// try to convert to a single insert with appropriate bitcasts.</span></div>
<div class="line"><a name="l01525"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#aeedeac4118d57ab8348374960c5aa0a6"> 1525</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="InstCombineVectorOps_8cpp.html#aeedeac4118d57ab8348374960c5aa0a6">foldTruncInsEltPair</a>(<a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> &amp;InsElt,</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;                                        <span class="keywordtype">bool</span> IsBigEndian,</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;                                        <a class="code" href="classllvm_1_1IRBuilder.html">InstCombiner::BuilderTy</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>) {</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *VecOp    = InsElt.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ScalarOp = InsElt.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1);</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *IndexOp  = InsElt.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(2);</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160; </div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;  <span class="comment">// Pattern depends on endian because we expect lower index is inserted first.</span></div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;  <span class="comment">// Big endian:</span></div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;  <span class="comment">// inselt (inselt BaseVec, (trunc (lshr X, BW/2), Index0), (trunc X), Index1</span></div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;  <span class="comment">// Little endian:</span></div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;  <span class="comment">// inselt (inselt BaseVec, (trunc X), Index0), (trunc (lshr X, BW/2)), Index1</span></div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;  <span class="comment">// Note: It is not safe to do this transform with an arbitrary base vector</span></div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;  <span class="comment">//       because the bitcast of that vector to fewer/larger elements could</span></div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;  <span class="comment">//       allow poison to spill into an element that was not poison before.</span></div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;  <span class="comment">// TODO: Detect smaller fractions of the scalar.</span></div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;  <span class="comment">// TODO: One-use checks are conservative.</span></div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;  <span class="keyword">auto</span> *VTy = dyn_cast&lt;FixedVectorType&gt;(InsElt.<a class="code" href="classllvm_1_1InsertElementInst.html#a5532ffa629e5d85d605bb379f7aed857">getType</a>());</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Scalar0, *BaseVec;</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> Index0, Index1;</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;  <span class="keywordflow">if</span> (!VTy || (VTy-&gt;getNumElements() &amp; 1) ||</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;      !<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(IndexOp, <a class="code" href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">m_ConstantInt</a>(Index1)) ||</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;      !<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VecOp, <a class="code" href="namespacellvm_1_1PatternMatch.html#a9cae528bdb66086aa6c06da36fc6fa24">m_InsertElt</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(BaseVec), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(Scalar0),</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;                                <a class="code" href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">m_ConstantInt</a>(Index0))) ||</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;      !<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BaseVec, <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>()))</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160; </div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;  <span class="comment">// The first insert must be to the index one less than this one, and</span></div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;  <span class="comment">// the first insert must be to an even index.</span></div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;  <span class="keywordflow">if</span> (Index0 + 1 != Index1 || Index0 &amp; 1)</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160; </div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;  <span class="comment">// For big endian, the high half of the value should be inserted first.</span></div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;  <span class="comment">// For little endian, the low half of the value should be inserted first.</span></div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>;</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> ShAmt;</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  <span class="keywordflow">if</span> (IsBigEndian) {</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ScalarOp, <a class="code" href="namespacellvm_1_1PatternMatch.html#a5b844aada27c4c6fdb87146ac458c0d8">m_Trunc</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>))) ||</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;        !<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Scalar0, <a class="code" href="namespacellvm_1_1PatternMatch.html#a5b844aada27c4c6fdb87146ac458c0d8">m_Trunc</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#aa08fee11e8a5ec10c0cc2a7abbbd799a">m_LShr</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">m_Specific</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">m_ConstantInt</a>(ShAmt)))))</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Scalar0, <a class="code" href="namespacellvm_1_1PatternMatch.html#a5b844aada27c4c6fdb87146ac458c0d8">m_Trunc</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>))) ||</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        !<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ScalarOp, <a class="code" href="namespacellvm_1_1PatternMatch.html#a5b844aada27c4c6fdb87146ac458c0d8">m_Trunc</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#aa08fee11e8a5ec10c0cc2a7abbbd799a">m_LShr</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">m_Specific</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">m_ConstantInt</a>(ShAmt)))))</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;  }</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160; </div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *SrcTy = <a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>-&gt;getType();</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;  <span class="keywordtype">unsigned</span> ScalarWidth = SrcTy-&gt;<a class="code" href="classllvm_1_1Type.html#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;  <span class="keywordtype">unsigned</span> VecEltWidth = VTy-&gt;getScalarSizeInBits();</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;  <span class="keywordflow">if</span> (ScalarWidth != VecEltWidth * 2 || ShAmt != VecEltWidth)</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160; </div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;  <span class="comment">// Bitcast the base vector to a vector type with the source element type.</span></div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *CastTy = <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(SrcTy, VTy-&gt;getNumElements() / 2);</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *CastBaseVec = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(BaseVec, CastTy);</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160; </div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;  <span class="comment">// Scale the insert index for a vector with half as many elements.</span></div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;  <span class="comment">// bitcast (inselt (bitcast BaseVec), X, NewIndex)</span></div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> NewIndex = IsBigEndian ? Index1 / 2 : Index0 / 2;</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewInsert = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateInsertElement(CastBaseVec, <a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, NewIndex);</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a>(NewInsert, VTy);</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;}</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160; </div>
<div class="line"><a name="l01588"></a><span class="lineno"><a class="line" href="classllvm_1_1InstCombinerImpl.html#a687fa4390149f0cb751d8ad89dca6a3c"> 1588</a></span>&#160;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1InstCombinerImpl.html#a687fa4390149f0cb751d8ad89dca6a3c">InstCombinerImpl::visitInsertElementInst</a>(<a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> &amp;<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>) {</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *VecOp    = <a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>.getOperand(0);</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ScalarOp = <a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>.getOperand(1);</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *IdxOp    = <a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>.getOperand(2);</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160; </div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *V = <a class="code" href="namespacellvm.html#abdf4b5f9e1dc6887cac393ee643c10b6">simplifyInsertElementInst</a>(</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;          VecOp, ScalarOp, IdxOp, SQ.getWithInstruction(&amp;<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>)))</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;    <span class="keywordflow">return</span> replaceInstUsesWith(<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>, V);</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160; </div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;  <span class="comment">// Canonicalize type of constant indices to i64 to simplify CSE</span></div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *IndexC = dyn_cast&lt;ConstantInt&gt;(IdxOp)) {</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> *NewIdx = <a class="code" href="InstCombineVectorOps_8cpp.html#ae586e62daeb752c491198a77ee17a1d2">getPreferredVectorIndex</a>(IndexC))</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;      <span class="keywordflow">return</span> replaceOperand(<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>, 2, NewIdx);</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160; </div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *BaseVec, *OtherScalar;</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> OtherIndexVal;</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VecOp, <a class="code" href="namespacellvm_1_1PatternMatch.html#aca6428e7fec51ba0b55594f469eb9691">m_OneUse</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a9cae528bdb66086aa6c06da36fc6fa24">m_InsertElt</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(BaseVec),</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;                                          <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(OtherScalar),</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;                                          <a class="code" href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">m_ConstantInt</a>(OtherIndexVal)))) &amp;&amp;</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;        !isa&lt;Constant&gt;(OtherScalar) &amp;&amp; OtherIndexVal &gt; IndexC-&gt;getZExtValue()) {</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *NewIns = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateInsertElement(BaseVec, ScalarOp, IdxOp);</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1InsertElementInst.html#a44cefc7b60337e7e14d20e843c74e534">InsertElementInst::Create</a>(NewIns, OtherScalar,</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;                                       <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt64(OtherIndexVal));</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;    }</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;  }</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160; </div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;  <span class="comment">// If the scalar is bitcast and inserted into undef, do the insert in the</span></div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;  <span class="comment">// source type followed by bitcast.</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;  <span class="comment">// TODO: Generalize for insert into any constant, not just undef?</span></div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ScalarSrc;</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VecOp, <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>()) &amp;&amp;</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;      <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ScalarOp, <a class="code" href="namespacellvm_1_1PatternMatch.html#aca6428e7fec51ba0b55594f469eb9691">m_OneUse</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#ac0467ca7fad871738b10db95feb40dad">m_BitCast</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(ScalarSrc)))) &amp;&amp;</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;      (ScalarSrc-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() ||</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;       ScalarSrc-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>())) {</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;    <span class="comment">// inselt undef, (bitcast ScalarSrc), IdxOp --&gt;</span></div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;    <span class="comment">//   bitcast (inselt undef, ScalarSrc, IdxOp)</span></div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *ScalarTy = ScalarSrc-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *VecTy = <a class="code" href="classllvm_1_1VectorType.html#a8c90e6c50e795b17466482a04947690e">VectorType::get</a>(ScalarTy, <a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>.getType()-&gt;getElementCount());</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;    <a class="code" href="classllvm_1_1UndefValue.html">UndefValue</a> *NewUndef = <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(VecTy);</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *NewInsElt = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateInsertElement(NewUndef, ScalarSrc, IdxOp);</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a>(NewInsElt, <a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>.getType());</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;  }</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160; </div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;  <span class="comment">// If the vector and scalar are both bitcast from the same element type, do</span></div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;  <span class="comment">// the insert in that source type followed by bitcast.</span></div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *VecSrc;</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VecOp, <a class="code" href="namespacellvm_1_1PatternMatch.html#ac0467ca7fad871738b10db95feb40dad">m_BitCast</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(VecSrc))) &amp;&amp;</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;      <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ScalarOp, <a class="code" href="namespacellvm_1_1PatternMatch.html#ac0467ca7fad871738b10db95feb40dad">m_BitCast</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(ScalarSrc))) &amp;&amp;</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;      (VecOp-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() || ScalarOp-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>()) &amp;&amp;</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;      VecSrc-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() &amp;&amp; !ScalarSrc-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() &amp;&amp;</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;      cast&lt;VectorType&gt;(VecSrc-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getElementType() ==</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;          ScalarSrc-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()) {</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    <span class="comment">// inselt (bitcast VecSrc), (bitcast ScalarSrc), IdxOp --&gt;</span></div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;    <span class="comment">//   bitcast (inselt VecSrc, ScalarSrc, IdxOp)</span></div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *NewInsElt = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateInsertElement(VecSrc, ScalarSrc, IdxOp);</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a>(NewInsElt, <a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>.getType());</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;  }</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160; </div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;  <span class="comment">// If the inserted element was extracted from some other fixed-length vector</span></div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;  <span class="comment">// and both indexes are valid constants, try to turn this into a shuffle.</span></div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;  <span class="comment">// Can not handle scalable vector type, the number of elements needed to</span></div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;  <span class="comment">// create shuffle mask is not a compile-time constant.</span></div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> InsertedIdx, ExtractedIdx;</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ExtVecOp;</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;  <span class="keywordflow">if</span> (isa&lt;FixedVectorType&gt;(<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>.getType()) &amp;&amp;</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;      <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(IdxOp, <a class="code" href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">m_ConstantInt</a>(InsertedIdx)) &amp;&amp;</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;      <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ScalarOp,</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;            <a class="code" href="namespacellvm_1_1PatternMatch.html#adf0290c7c322f0bf8b275d6b26410b52">m_ExtractElt</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(ExtVecOp), <a class="code" href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">m_ConstantInt</a>(ExtractedIdx))) &amp;&amp;</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;      isa&lt;FixedVectorType&gt;(ExtVecOp-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()) &amp;&amp;</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;      ExtractedIdx &lt;</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;          cast&lt;FixedVectorType&gt;(ExtVecOp-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getNumElements()) {</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    <span class="comment">// TODO: Looking at the user(s) to determine if this insert is a</span></div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;    <span class="comment">// fold-to-shuffle opportunity does not match the usual instcombine</span></div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;    <span class="comment">// constraints. We should decide if the transform is worthy based only</span></div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;    <span class="comment">// on this instruction and its operands, but that may not work currently.</span></div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;    <span class="comment">// Here, we are trying to avoid creating shuffles before reaching</span></div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;    <span class="comment">// the end of a chain of extract-insert pairs. This is complicated because</span></div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;    <span class="comment">// we do not generally form arbitrary shuffle masks in instcombine</span></div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;    <span class="comment">// (because those may codegen poorly), but collectShuffleElements() does</span></div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;    <span class="comment">// exactly that.</span></div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;    <span class="comment">// The rules for determining what is an acceptable target-independent</span></div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;    <span class="comment">// shuffle mask are fuzzy because they evolve based on the backend&#39;s</span></div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;    <span class="comment">// capabilities and real-world impact.</span></div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    <span class="keyword">auto</span> isShuffleRootCandidate = [](<a class="code" href="classllvm_1_1InsertElementInst.html">InsertElementInst</a> &amp;<a class="code" href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">Insert</a>) {</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">Insert</a>.hasOneUse())</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;      <span class="keyword">auto</span> *InsertUser = dyn_cast&lt;InsertElementInst&gt;(<a class="code" href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">Insert</a>.user_back());</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;      <span class="keywordflow">if</span> (!InsertUser)</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;    };</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160; </div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;    <span class="comment">// Try to form a shuffle from a chain of extract-insert ops.</span></div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;    <span class="keywordflow">if</span> (isShuffleRootCandidate(<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>)) {</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int, 16&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>;</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;      <a class="code" href="InstCombineVectorOps_8cpp.html#a5ef308f5547e4c1a6dfe646dd7ea7abc">ShuffleOps</a> LR = <a class="code" href="InstCombineVectorOps_8cpp.html#a734417c242634bee69281295ccc5e863">collectShuffleElements</a>(&amp;<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, <span class="keyword">nullptr</span>, *<span class="keyword">this</span>);</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160; </div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;      <span class="comment">// The proposed shuffle may be trivial, in which case we shouldn&#39;t</span></div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;      <span class="comment">// perform the combine.</span></div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;      <span class="keywordflow">if</span> (LR.first != &amp;<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a> &amp;&amp; LR.second != &amp;<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>) {</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;        <span class="comment">// We now have a shuffle of LHS, RHS, Mask.</span></div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;        <span class="keywordflow">if</span> (LR.second == <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;          LR.second = <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(LR.first-&gt;getType());</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a>(LR.first, LR.second, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;      }</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;    }</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;  }</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160; </div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> VecTy = dyn_cast&lt;FixedVectorType&gt;(VecOp-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())) {</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;    <span class="keywordtype">unsigned</span> VWidth = VecTy-&gt;getNumElements();</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;    <a class="code" href="classllvm_1_1APInt.html">APInt</a> UndefElts(VWidth, 0);</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    <a class="code" href="classllvm_1_1APInt.html">APInt</a> AllOnesEltMask(<a class="code" href="classllvm_1_1APInt.html#a071e8d814b2b30b02544fad964227b8e">APInt::getAllOnes</a>(VWidth));</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V = SimplifyDemandedVectorElts(&amp;<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>, AllOnesEltMask, UndefElts)) {</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;      <span class="keywordflow">if</span> (V != &amp;<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>)</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;        <span class="keywordflow">return</span> replaceInstUsesWith(<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>, V);</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;      <span class="keywordflow">return</span> &amp;<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>;</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    }</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;  }</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160; </div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Shuf = <a class="code" href="InstCombineVectorOps_8cpp.html#a2d94a30dbf5569ba774109343ed5f999">foldConstantInsEltIntoShuffle</a>(<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>))</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    <span class="keywordflow">return</span> Shuf;</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160; </div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NewInsElt = <a class="code" href="InstCombineVectorOps_8cpp.html#ac9f0c867cdd5fe902a7d49c4c3631090">hoistInsEltConst</a>(<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>))</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    <span class="keywordflow">return</span> NewInsElt;</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160; </div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Broadcast = <a class="code" href="InstCombineVectorOps_8cpp.html#abdea7254f33e7e14fa824284e56319c3">foldInsSequenceIntoSplat</a>(<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>))</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    <span class="keywordflow">return</span> Broadcast;</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160; </div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Splat = <a class="code" href="InstCombineVectorOps_8cpp.html#ace3f33981357525d7cbe1990a68212b5">foldInsEltIntoSplat</a>(<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>))</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    <span class="keywordflow">return</span> Splat;</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160; </div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *IdentityShuf = <a class="code" href="InstCombineVectorOps_8cpp.html#a639d4e2996fe104ec92be89876430b41">foldInsEltIntoIdentityShuffle</a>(<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>))</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    <span class="keywordflow">return</span> IdentityShuf;</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160; </div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a> = <a class="code" href="InstCombineVectorOps_8cpp.html#a4f825637c0198827411f5f11aa3f2deb">narrowInsElt</a>(<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>))</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>;</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160; </div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a> = <a class="code" href="InstCombineVectorOps_8cpp.html#aeedeac4118d57ab8348374960c5aa0a6">foldTruncInsEltPair</a>(<a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.isBigEndian(), <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>))</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>;</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160; </div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;}</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;<span class="comment">/// Return true if we can evaluate the specified expression tree if the vector</span></div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;<span class="comment">/// elements were shuffled in a different order.</span></div>
<div class="line"><a name="l01735"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#a95fd07ca61f35098e091aa2329f9c8a6"> 1735</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="InstCombineVectorOps_8cpp.html#a95fd07ca61f35098e091aa2329f9c8a6">canEvaluateShuffled</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>,</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;                                <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> = 5) {</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;  <span class="comment">// We can always reorder the elements of a constant.</span></div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;  <span class="keywordflow">if</span> (isa&lt;Constant&gt;(V))</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160; </div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;  <span class="comment">// We won&#39;t reorder vector arguments. No IPO here.</span></div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160; </div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;  <span class="comment">// Two users may expect different orders of the elements. Don&#39;t try it.</span></div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUse())</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160; </div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160; </div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;  <span class="keywordflow">switch</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) {</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;    <span class="keywordflow">case</span> Instruction::UDiv:</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    <span class="keywordflow">case</span> Instruction::SDiv:</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    <span class="keywordflow">case</span> Instruction::URem:</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;    <span class="keywordflow">case</span> Instruction::SRem:</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;      <span class="comment">// Propagating an undefined shuffle mask element to integer div/rem is not</span></div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;      <span class="comment">// allowed because those opcodes can create immediate undefined behavior</span></div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;      <span class="comment">// from an undefined element in an operand.</span></div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">llvm::is_contained</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, -1))</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;      [[fallthrough]];</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec">Instruction::Add</a>:</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    <span class="keywordflow">case</span> Instruction::FAdd:</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    <span class="keywordflow">case</span> Instruction::Sub:</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    <span class="keywordflow">case</span> Instruction::FSub:</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="X86PartialReduction_8cpp.html#ae0f503db91504a3f3440ab81260e4134">Instruction::Mul</a>:</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    <span class="keywordflow">case</span> Instruction::FMul:</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    <span class="keywordflow">case</span> Instruction::FDiv:</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    <span class="keywordflow">case</span> Instruction::FRem:</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    <span class="keywordflow">case</span> Instruction::Shl:</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;    <span class="keywordflow">case</span> Instruction::LShr:</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;    <span class="keywordflow">case</span> Instruction::AShr:</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;    <span class="keywordflow">case</span> Instruction::And:</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;    <span class="keywordflow">case</span> Instruction::Or:</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;    <span class="keywordflow">case</span> Instruction::Xor:</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;    <span class="keywordflow">case</span> Instruction::ICmp:</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;    <span class="keywordflow">case</span> Instruction::FCmp:</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;    <span class="keywordflow">case</span> Instruction::Trunc:</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;    <span class="keywordflow">case</span> Instruction::ZExt:</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;    <span class="keywordflow">case</span> Instruction::SExt:</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;    <span class="keywordflow">case</span> Instruction::FPToUI:</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;    <span class="keywordflow">case</span> Instruction::FPToSI:</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;    <span class="keywordflow">case</span> Instruction::UIToFP:</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;    <span class="keywordflow">case</span> Instruction::SIToFP:</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;    <span class="keywordflow">case</span> Instruction::FPTrunc:</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;    <span class="keywordflow">case</span> Instruction::FPExt:</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;    <span class="keywordflow">case</span> Instruction::GetElementPtr: {</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;      <span class="comment">// Bail out if we would create longer vector ops. We could allow creating</span></div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;      <span class="comment">// longer vector ops, but that may result in more expensive codegen.</span></div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *ITy = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType();</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;      <span class="keywordflow">if</span> (ITy-&gt;<a class="code" href="classllvm_1_1Type.html#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() &amp;&amp;</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;          <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size() &gt; cast&lt;FixedVectorType&gt;(ITy)-&gt;getNumElements())</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *Operand : <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands()) {</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="InstCombineVectorOps_8cpp.html#a95fd07ca61f35098e091aa2329f9c8a6">canEvaluateShuffled</a>(Operand, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> - 1))</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;      }</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;    }</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;    <span class="keywordflow">case</span> Instruction::InsertElement: {</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;      <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CI = dyn_cast&lt;ConstantInt&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(2));</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;      <span class="keywordflow">if</span> (!CI) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;      <span class="keywordtype">int</span> ElementNumber = CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a31e8da5adf63afd38b4ab94bca823150">getLimitedValue</a>();</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160; </div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;      <span class="comment">// Verify that &#39;CI&#39; does not occur twice in Mask. A single &#39;insertelement&#39;</span></div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;      <span class="comment">// can&#39;t put an element into multiple indices.</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;      <span class="keywordtype">bool</span> SeenOnce = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>) {</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> == ElementNumber) {</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;          <span class="keywordflow">if</span> (SeenOnce)</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;          SeenOnce = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;        }</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;      }</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="InstCombineVectorOps_8cpp.html#a95fd07ca61f35098e091aa2329f9c8a6">canEvaluateShuffled</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, <a class="code" href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> - 1);</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;    }</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;  }</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;}</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;<span class="comment">/// Rebuild a new instruction just like &#39;I&#39; but with the new operands given.</span></div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;<span class="comment">/// In the event of type mismatch, the type of the operands is correct.</span></div>
<div class="line"><a name="l01823"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#a01237a54c1c791145d5e5ea0d5dcd632"> 1823</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="InstCombineVectorOps_8cpp.html#a01237a54c1c791145d5e5ea0d5dcd632">buildNew</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value*&gt;</a> NewOps) {</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;  <span class="comment">// We don&#39;t want to use the IRBuilder here because we want the replacement</span></div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;  <span class="comment">// instructions to appear next to &#39;I&#39;, not the builder&#39;s insertion point.</span></div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;  <span class="keywordflow">switch</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) {</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec">Instruction::Add</a>:</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;    <span class="keywordflow">case</span> Instruction::FAdd:</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;    <span class="keywordflow">case</span> Instruction::Sub:</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;    <span class="keywordflow">case</span> Instruction::FSub:</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="X86PartialReduction_8cpp.html#ae0f503db91504a3f3440ab81260e4134">Instruction::Mul</a>:</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;    <span class="keywordflow">case</span> Instruction::FMul:</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;    <span class="keywordflow">case</span> Instruction::UDiv:</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;    <span class="keywordflow">case</span> Instruction::SDiv:</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;    <span class="keywordflow">case</span> Instruction::FDiv:</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;    <span class="keywordflow">case</span> Instruction::URem:</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;    <span class="keywordflow">case</span> Instruction::SRem:</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;    <span class="keywordflow">case</span> Instruction::FRem:</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;    <span class="keywordflow">case</span> Instruction::Shl:</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;    <span class="keywordflow">case</span> Instruction::LShr:</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;    <span class="keywordflow">case</span> Instruction::AShr:</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;    <span class="keywordflow">case</span> Instruction::And:</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;    <span class="keywordflow">case</span> Instruction::Or:</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;    <span class="keywordflow">case</span> Instruction::Xor: {</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;      <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *BO = cast&lt;BinaryOperator&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewOps.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() == 2 &amp;&amp; <span class="stringliteral">&quot;binary operator with #ops != 2&quot;</span>);</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;      <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *New =</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;          <a class="code" href="classllvm_1_1BinaryOperator.html#a02ce9966395063ac501ecbc1623deda4">BinaryOperator::Create</a>(cast&lt;BinaryOperator&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;<a class="code" href="VPlanSLP_8cpp.html#af04704e906a9654777e92a4612c58c13">getOpcode</a>(),</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;                                 NewOps[0], NewOps[1], <span class="stringliteral">&quot;&quot;</span>, BO);</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;      <span class="keywordflow">if</span> (isa&lt;OverflowingBinaryOperator&gt;(BO)) {</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;        New-&gt;setHasNoUnsignedWrap(BO-&gt;<a class="code" href="classllvm_1_1Instruction.html#a100c666f9253331dd1d166a863248326">hasNoUnsignedWrap</a>());</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;        New-&gt;setHasNoSignedWrap(BO-&gt;<a class="code" href="classllvm_1_1Instruction.html#a350f4fdc01c770b5cf6a8be2624ae3e5">hasNoSignedWrap</a>());</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;      }</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;      <span class="keywordflow">if</span> (isa&lt;PossiblyExactOperator&gt;(BO)) {</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;        New-&gt;setIsExact(BO-&gt;<a class="code" href="classllvm_1_1Instruction.html#a689a03df5b4ae094d6a3a1bd13dac574">isExact</a>());</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;      }</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;      <span class="keywordflow">if</span> (isa&lt;FPMathOperator&gt;(BO))</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;        New-&gt;copyFastMathFlags(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;      <span class="keywordflow">return</span> New;</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;    }</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;    <span class="keywordflow">case</span> Instruction::ICmp:</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewOps.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() == 2 &amp;&amp; <span class="stringliteral">&quot;icmp with #ops != 2&quot;</span>);</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, cast&lt;ICmpInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;<a class="code" href="namespacellvm_1_1PPC.html#a40c2294c9ecba721df7f29aaf05157d8">getPredicate</a>(),</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;                          NewOps[0], NewOps[1]);</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;    <span class="keywordflow">case</span> Instruction::FCmp:</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewOps.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() == 2 &amp;&amp; <span class="stringliteral">&quot;fcmp with #ops != 2&quot;</span>);</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1FCmpInst.html">FCmpInst</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, cast&lt;FCmpInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;<a class="code" href="namespacellvm_1_1PPC.html#a40c2294c9ecba721df7f29aaf05157d8">getPredicate</a>(),</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;                          NewOps[0], NewOps[1]);</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;    <span class="keywordflow">case</span> Instruction::Trunc:</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;    <span class="keywordflow">case</span> Instruction::ZExt:</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;    <span class="keywordflow">case</span> Instruction::SExt:</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;    <span class="keywordflow">case</span> Instruction::FPToUI:</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;    <span class="keywordflow">case</span> Instruction::FPToSI:</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;    <span class="keywordflow">case</span> Instruction::UIToFP:</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;    <span class="keywordflow">case</span> Instruction::SIToFP:</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    <span class="keywordflow">case</span> Instruction::FPTrunc:</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;    <span class="keywordflow">case</span> Instruction::FPExt: {</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;      <span class="comment">// It&#39;s possible that the mask has a different number of elements from</span></div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;      <span class="comment">// the original cast. We recompute the destination type to match the mask.</span></div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *DestTy = <a class="code" href="classllvm_1_1VectorType.html#a8c90e6c50e795b17466482a04947690e">VectorType::get</a>(</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;          <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()-&gt;getScalarType(),</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;          cast&lt;VectorType&gt;(NewOps[0]-&gt;getType())-&gt;getElementCount());</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewOps.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() == 1 &amp;&amp; <span class="stringliteral">&quot;cast with #ops != 1&quot;</span>);</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1CastInst.html#a643fe5a9e7042f032dae78109c2b1e72">CastInst::Create</a>(cast&lt;CastInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;<a class="code" href="VPlanSLP_8cpp.html#af04704e906a9654777e92a4612c58c13">getOpcode</a>(), NewOps[0], DestTy,</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;                              <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;    }</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;    <span class="keywordflow">case</span> Instruction::GetElementPtr: {</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = NewOps[0];</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;      <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value*&gt;</a> Idx = NewOps.<a class="code" href="classllvm_1_1ArrayRef.html#ace7bdce94e806bb8870626657630dab0">slice</a>(1);</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;      <a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *<a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a class="code" href="classllvm_1_1GetElementPtrInst.html#a74c47d18ecd4ca3399785e6ae07134dc">GetElementPtrInst::Create</a>(</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;          cast&lt;GetElementPtrInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getSourceElementType(), <a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, Idx, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;      <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;setIsInBounds(cast&lt;GetElementPtrInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;isInBounds());</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a>;</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;    }</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;  }</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;  <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;failed to rebuild vector instructions&quot;</span>);</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;}</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160; </div>
<div class="line"><a name="l01899"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#a55e58d0b566ef26217958483795974e5"> 1899</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="InstCombineVectorOps_8cpp.html#a55e58d0b566ef26217958483795974e5">evaluateInDifferentElementOrder</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>) {</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;  <span class="comment">// Mask.size() does not need to be equal to the number of vector elements.</span></div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160; </div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() &amp;&amp; <span class="stringliteral">&quot;can&#39;t reorder non-vector elements&quot;</span>);</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *EltTy = V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a4abb39a66573f61fda80469faa5d861d">getScalarType</a>();</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *I32Ty = <a class="code" href="classllvm_1_1Type.html#a30dd396c5b40cd86c1591872e574ccdf">IntegerType::getInt32Ty</a>(V-&gt;<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>()))</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(<a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(EltTy, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size()));</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160; </div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;  <span class="keywordflow">if</span> (isa&lt;ConstantAggregateZero&gt;(V))</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1ConstantAggregateZero.html#abfa1cf8b4348407b167f93bc7c01055f">ConstantAggregateZero::get</a>(<a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(EltTy, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size()));</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160; </div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;Constant&gt;(V))</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1ConstantExpr.html#a6f6506f0bc515fe29da3b58565300017">ConstantExpr::getShuffleVector</a>(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>, <a class="code" href="classllvm_1_1PoisonValue.html#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getType()),</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;                                          <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160; </div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;  <span class="keywordflow">switch</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) {</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec">Instruction::Add</a>:</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;    <span class="keywordflow">case</span> Instruction::FAdd:</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;    <span class="keywordflow">case</span> Instruction::Sub:</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;    <span class="keywordflow">case</span> Instruction::FSub:</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="X86PartialReduction_8cpp.html#ae0f503db91504a3f3440ab81260e4134">Instruction::Mul</a>:</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;    <span class="keywordflow">case</span> Instruction::FMul:</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;    <span class="keywordflow">case</span> Instruction::UDiv:</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;    <span class="keywordflow">case</span> Instruction::SDiv:</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;    <span class="keywordflow">case</span> Instruction::FDiv:</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;    <span class="keywordflow">case</span> Instruction::URem:</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;    <span class="keywordflow">case</span> Instruction::SRem:</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;    <span class="keywordflow">case</span> Instruction::FRem:</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;    <span class="keywordflow">case</span> Instruction::Shl:</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;    <span class="keywordflow">case</span> Instruction::LShr:</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;    <span class="keywordflow">case</span> Instruction::AShr:</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;    <span class="keywordflow">case</span> Instruction::And:</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    <span class="keywordflow">case</span> Instruction::Or:</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;    <span class="keywordflow">case</span> Instruction::Xor:</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;    <span class="keywordflow">case</span> Instruction::ICmp:</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;    <span class="keywordflow">case</span> Instruction::FCmp:</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;    <span class="keywordflow">case</span> Instruction::Trunc:</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;    <span class="keywordflow">case</span> Instruction::ZExt:</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;    <span class="keywordflow">case</span> Instruction::SExt:</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;    <span class="keywordflow">case</span> Instruction::FPToUI:</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;    <span class="keywordflow">case</span> Instruction::FPToSI:</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;    <span class="keywordflow">case</span> Instruction::UIToFP:</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;    <span class="keywordflow">case</span> Instruction::SIToFP:</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;    <span class="keywordflow">case</span> Instruction::FPTrunc:</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;    <span class="keywordflow">case</span> Instruction::FPExt:</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Instruction::Select</a>:</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;    <span class="keywordflow">case</span> Instruction::GetElementPtr: {</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value*, 8&gt;</a> NewOps;</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;      <span class="keywordtype">bool</span> NeedsRebuild =</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;          (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size() !=</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;           cast&lt;FixedVectorType&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType())-&gt;getNumElements());</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNumOperands(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *V;</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;        <span class="comment">// Recursively call evaluateInDifferentElementOrder on vector arguments</span></div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;        <span class="comment">// as well. E.g. GetElementPtr may have scalar operands even if the</span></div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;        <span class="comment">// return value is a vector, so we need to examine the operand type.</span></div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;getType()-&gt;isVectorTy())</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;          V = <a class="code" href="InstCombineVectorOps_8cpp.html#a55e58d0b566ef26217958483795974e5">evaluateInDifferentElementOrder</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>), <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;          V = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;        NewOps.push_back(V);</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;        NeedsRebuild |= (V != <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;      }</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;      <span class="keywordflow">if</span> (NeedsRebuild) {</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="InstCombineVectorOps_8cpp.html#a01237a54c1c791145d5e5ea0d5dcd632">buildNew</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, NewOps);</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;      }</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;    }</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;    <span class="keywordflow">case</span> Instruction::InsertElement: {</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;      <span class="keywordtype">int</span> Element = cast&lt;ConstantInt&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(2))-&gt;getLimitedValue();</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160; </div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;      <span class="comment">// The insertelement was inserting at Element. Figure out which element</span></div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;      <span class="comment">// that becomes after shuffling. The answer is guaranteed to be unique</span></div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;      <span class="comment">// by CanEvaluateShuffled.</span></div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;      <span class="keywordtype">bool</span> Found = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a> = 0;</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size(); <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>) {</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>] == Element) {</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;          Found = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;        }</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;      }</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160; </div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;      <span class="comment">// If element is not in Mask, no need to handle the operand 1 (element to</span></div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;      <span class="comment">// be inserted). Just evaluate values in operand 0 according to Mask.</span></div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;      <span class="keywordflow">if</span> (!Found)</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="InstCombineVectorOps_8cpp.html#a55e58d0b566ef26217958483795974e5">evaluateInDifferentElementOrder</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160; </div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="InstCombineVectorOps_8cpp.html#a55e58d0b566ef26217958483795974e5">evaluateInDifferentElementOrder</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1InsertElementInst.html#a44cefc7b60337e7e14d20e843c74e534">InsertElementInst::Create</a>(V, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1),</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;                                       <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(I32Ty, <a class="code" href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">Index</a>), <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;    }</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;  }</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;  <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;failed to reorder elements of vector instruction!&quot;</span>);</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;}</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160; </div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;<span class="comment">// Returns true if the shuffle is extracting a contiguous range of values from</span></div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;<span class="comment">// LHS, for example:</span></div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;<span class="comment">//                 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span></div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;<span class="comment">//   Input:        |AA|BB|CC|DD|EE|FF|GG|HH|II|JJ|KK|LL|MM|NN|OO|PP|</span></div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;<span class="comment">//   Shuffles to:  |EE|FF|GG|HH|</span></div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;<span class="comment">//                 +--+--+--+--+</span></div>
<div class="line"><a name="l02003"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#ae8f4745a87bae0a614d6bda1cc55ab01"> 2003</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="InstCombineVectorOps_8cpp.html#ae8f4745a87bae0a614d6bda1cc55ab01">isShuffleExtractingFromLHS</a>(<a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a> &amp;SVI,</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;                                       <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>) {</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;  <span class="keywordtype">unsigned</span> LHSElems =</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;      cast&lt;FixedVectorType&gt;(SVI.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getNumElements();</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;  <span class="keywordtype">unsigned</span> MaskElems = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size();</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;  <span class="keywordtype">unsigned</span> BegIdx = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.front();</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;  <span class="keywordtype">unsigned</span> EndIdx = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.back();</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;  <span class="keywordflow">if</span> (BegIdx &gt; EndIdx || EndIdx &gt;= LHSElems || EndIdx - BegIdx != MaskElems - 1)</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != MaskElems; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span><span class="keyword">&gt;</span>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]) != BegIdx + <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;}</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;<span class="comment">/// These are the ingredients in an alternate form binary operator as described</span></div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;<span class="comment">/// below.</span></div>
<div class="line"><a name="l02020"></a><span class="lineno"><a class="line" href="structBinopElts.html"> 2020</a></span>&#160;<span class="comment"></span><span class="keyword">struct </span><a class="code" href="structBinopElts.html">BinopElts</a> {</div>
<div class="line"><a name="l02021"></a><span class="lineno"><a class="line" href="structBinopElts.html#a0b1dcc01090bf24bebc2584f6a17b0d8"> 2021</a></span>&#160;  <a class="code" href="classllvm_1_1Instruction.html#ac26154a24f393f523c87cc5f8239f36c">BinaryOperator::BinaryOps</a> <a class="code" href="structBinopElts.html#a0b1dcc01090bf24bebc2584f6a17b0d8">Opcode</a>;</div>
<div class="line"><a name="l02022"></a><span class="lineno"><a class="line" href="structBinopElts.html#a7eb0f39f02b88e3c97ba994ee191f148"> 2022</a></span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="structBinopElts.html#a7eb0f39f02b88e3c97ba994ee191f148">Op0</a>;</div>
<div class="line"><a name="l02023"></a><span class="lineno"><a class="line" href="structBinopElts.html#a507629db7779162187dcbdc907798b45"> 2023</a></span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="structBinopElts.html#a507629db7779162187dcbdc907798b45">Op1</a>;</div>
<div class="line"><a name="l02024"></a><span class="lineno"><a class="line" href="structBinopElts.html#a085a4f7976730eeaeb8c7037fe8c7aab"> 2024</a></span>&#160;  <a class="code" href="structBinopElts.html#a085a4f7976730eeaeb8c7037fe8c7aab">BinopElts</a>(<a class="code" href="classllvm_1_1Instruction.html#ac26154a24f393f523c87cc5f8239f36c">BinaryOperator::BinaryOps</a> Opc = (<a class="code" href="classllvm_1_1Instruction.html#ac26154a24f393f523c87cc5f8239f36c">BinaryOperator::BinaryOps</a>)0,</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;            <a class="code" href="classllvm_1_1Value.html">Value</a> *V0 = <span class="keyword">nullptr</span>, <a class="code" href="classllvm_1_1Value.html">Value</a> *V1 = <span class="keyword">nullptr</span>) :</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;      Opcode(Opc), Op0(V0), Op1(V1) {}</div>
<div class="line"><a name="l02027"></a><span class="lineno"><a class="line" href="structBinopElts.html#a8865792409d2961bde1ac9c62bd75f93"> 2027</a></span>&#160;  <span class="keyword">operator</span> bool()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> Opcode != 0; }</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;};</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;<span class="comment">/// Binops may be transformed into binops with different opcodes and operands.</span></div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;<span class="comment">/// Reverse the usual canonicalization to enable folds with the non-canonical</span></div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;<span class="comment">/// form of the binop. If a transform is possible, return the elements of the</span></div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;<span class="comment">/// new binop. If not, return invalid elements.</span></div>
<div class="line"><a name="l02034"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#af7e7c9415c23ae336af651877798a377"> 2034</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="structBinopElts.html">BinopElts</a> <a class="code" href="InstCombineVectorOps_8cpp.html#af7e7c9415c23ae336af651877798a377">getAlternateBinop</a>(<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *BO, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>) {</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *BO0 = BO-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), *BO1 = BO-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1);</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty = BO-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;  <span class="keywordflow">switch</span> (BO-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>()) {</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;  <span class="keywordflow">case</span> Instruction::Shl: {</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;    <span class="comment">// shl X, C --&gt; mul X, (1 &lt;&lt; C)</span></div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>;</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BO1, <a class="code" href="namespacellvm_1_1PatternMatch.html#aadd209ba7e1bfa8113a609e09a7fe62f">m_Constant</a>(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>))) {</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;      <a class="code" href="classllvm_1_1Constant.html">Constant</a> *ShlOne = <a class="code" href="classllvm_1_1ConstantExpr.html#aa5ad9e9e7cc67e1675d8d1631a73e625">ConstantExpr::getShl</a>(<a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(Ty, 1), <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>);</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;      <span class="keywordflow">return</span> {<a class="code" href="X86PartialReduction_8cpp.html#ae0f503db91504a3f3440ab81260e4134">Instruction::Mul</a>, BO0, ShlOne};</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;    }</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;  }</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;  <span class="keywordflow">case</span> Instruction::Or: {</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;    <span class="comment">// or X, C --&gt; add X, C (when X and C have no common bits set)</span></div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>;</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BO1, <a class="code" href="namespacellvm_1_1PatternMatch.html#aac9e78b3aa02ec087c4621358f506718">m_APInt</a>(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>)) &amp;&amp; <a class="code" href="namespacellvm.html#aedbf3998b4ff72347a45cb4169d120db">MaskedValueIsZero</a>(BO0, *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;      <span class="keywordflow">return</span> {<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec">Instruction::Add</a>, BO0, BO1};</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;  }</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;  <span class="keywordflow">case</span> Instruction::Sub:</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;    <span class="comment">// sub 0, X --&gt; mul X, -1</span></div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BO0, <a class="code" href="namespacellvm_1_1PatternMatch.html#a874d53817a4923de8e58af6b278c09b0">m_ZeroInt</a>()))</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;      <span class="keywordflow">return</span> {<a class="code" href="X86PartialReduction_8cpp.html#ae0f503db91504a3f3440ab81260e4134">Instruction::Mul</a>, BO1, <a class="code" href="classllvm_1_1Constant.html#a4d51384de6e1798bb6aa875aebeea9f0">ConstantInt::getAllOnesValue</a>(Ty)};</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;  <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;  }</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;  <span class="keywordflow">return</span> {};</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;}</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;<span class="comment">/// A select shuffle of a select shuffle with a shared operand can be reduced</span></div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;<span class="comment">/// to a single select shuffle. This is an obvious improvement in IR, and the</span></div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;<span class="comment">/// backend is expected to lower select shuffles efficiently.</span></div>
<div class="line"><a name="l02068"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#a48d2595fd80a27962cdfe718529e1302"> 2068</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="InstCombineVectorOps_8cpp.html#a48d2595fd80a27962cdfe718529e1302">foldSelectShuffleOfSelectShuffle</a>(<a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a> &amp;Shuf) {</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a747673ac3ea44aadc3907c6b9fd86237">isSelect</a>() &amp;&amp; <span class="stringliteral">&quot;Must have select-equivalent shuffle&quot;</span>);</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160; </div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Op0 = Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), *Op1 = Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1);</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int, 16&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>;</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;  Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;  <span class="keywordtype">unsigned</span> NumElts = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size();</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160; </div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;  <span class="comment">// Canonicalize a select shuffle with common operand as Op1.</span></div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;  <span class="keyword">auto</span> *ShufOp = dyn_cast&lt;ShuffleVectorInst&gt;(Op0);</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;  <span class="keywordflow">if</span> (ShufOp &amp;&amp; ShufOp-&gt;isSelect() &amp;&amp;</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;      (ShufOp-&gt;getOperand(0) == Op1 || ShufOp-&gt;getOperand(1) == Op1)) {</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;    <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(Op0, Op1);</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;    <a class="code" href="classllvm_1_1ShuffleVectorInst.html#a9874bec83353914ed1e9309d5d9ccea0">ShuffleVectorInst::commuteShuffleMask</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, NumElts);</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;  }</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160; </div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;  ShufOp = dyn_cast&lt;ShuffleVectorInst&gt;(Op1);</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;  <span class="keywordflow">if</span> (!ShufOp || !ShufOp-&gt;isSelect() ||</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;      (ShufOp-&gt;getOperand(0) != Op0 &amp;&amp; ShufOp-&gt;getOperand(1) != Op0))</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160; </div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a> = ShufOp-&gt;getOperand(0), *<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a> = ShufOp-&gt;getOperand(1);</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int, 16&gt;</a> Mask1;</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;  ShufOp-&gt;getShuffleMask(Mask1);</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Mask1.size() == NumElts &amp;&amp; <span class="stringliteral">&quot;Vector size changed with select shuffle&quot;</span>);</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160; </div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;  <span class="comment">// Canonicalize common operand (Op0) as X (first operand of first shuffle).</span></div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a> == Op0) {</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;    <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, <a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>);</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;    <a class="code" href="classllvm_1_1ShuffleVectorInst.html#a9874bec83353914ed1e9309d5d9ccea0">ShuffleVectorInst::commuteShuffleMask</a>(Mask1, NumElts);</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;  }</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160; </div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;  <span class="comment">// If the mask chooses from X (operand 0), it stays the same.</span></div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;  <span class="comment">// If the mask chooses from the earlier shuffle, the other mask value is</span></div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;  <span class="comment">// transferred to the combined select shuffle:</span></div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;  <span class="comment">// shuf X, (shuf X, Y, M1), M --&gt; shuf X, Y, M&#39;</span></div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int, 16&gt;</a> NewMask(NumElts);</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != NumElts; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;    NewMask[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt; (<span class="keywordtype">signed</span>)NumElts ? <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] : Mask1[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160; </div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;  <span class="comment">// A select mask with undef elements might look like an identity mask.</span></div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a2a9db752c3cab553f75806ef939e6a76">ShuffleVectorInst::isSelectMask</a>(NewMask) ||</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;          <a class="code" href="classllvm_1_1ShuffleVectorInst.html#a4bc8953b0fd0277b0e5a8e5b78025150">ShuffleVectorInst::isIdentityMask</a>(NewMask)) &amp;&amp;</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;         <span class="stringliteral">&quot;Unexpected shuffle mask&quot;</span>);</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, <a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>, NewMask);</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;}</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160; </div>
<div class="line"><a name="l02115"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#a21c9d0a05a498a67033d97eb1200f3b6"> 2115</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="InstCombineVectorOps_8cpp.html#a21c9d0a05a498a67033d97eb1200f3b6">foldSelectShuffleWith1Binop</a>(<a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a> &amp;Shuf) {</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a747673ac3ea44aadc3907c6b9fd86237">isSelect</a>() &amp;&amp; <span class="stringliteral">&quot;Must have select-equivalent shuffle&quot;</span>);</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160; </div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;  <span class="comment">// Are we shuffling together some value and that same value after it has been</span></div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;  <span class="comment">// modified by a binop with a constant?</span></div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Op0 = Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), *Op1 = Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1);</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>;</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;  <span class="keywordtype">bool</span> Op0IsBinop;</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0, <a class="code" href="namespacellvm_1_1PatternMatch.html#a43ac4fbaaf63a88eb5ac05f6d3e5649c">m_BinOp</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">m_Specific</a>(Op1), <a class="code" href="namespacellvm_1_1PatternMatch.html#aadd209ba7e1bfa8113a609e09a7fe62f">m_Constant</a>(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>))))</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;    Op0IsBinop = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op1, <a class="code" href="namespacellvm_1_1PatternMatch.html#a43ac4fbaaf63a88eb5ac05f6d3e5649c">m_BinOp</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">m_Specific</a>(Op0), <a class="code" href="namespacellvm_1_1PatternMatch.html#aadd209ba7e1bfa8113a609e09a7fe62f">m_Constant</a>(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>))))</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;    Op0IsBinop = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160; </div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;  <span class="comment">// The identity constant for a binop leaves a variable operand unchanged. For</span></div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;  <span class="comment">// a vector, this is a splat of something like 0, -1, or 1.</span></div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;  <span class="comment">// If there&#39;s no identity constant for this binop, we&#39;re done.</span></div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;  <span class="keyword">auto</span> *BO = cast&lt;BinaryOperator&gt;(Op0IsBinop ? Op0 : Op1);</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html#ac26154a24f393f523c87cc5f8239f36c">BinaryOperator::BinaryOps</a> BOpcode = BO-&gt;getOpcode();</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *IdC = <a class="code" href="classllvm_1_1ConstantExpr.html#ae9c2f00a962cb8e0316cf3548a5d8029">ConstantExpr::getBinOpIdentity</a>(BOpcode, Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a50fe6a61ea745fb71fa8403af6e7deed">getType</a>(), <span class="keyword">true</span>);</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;  <span class="keywordflow">if</span> (!IdC)</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160; </div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;  <span class="comment">// Shuffle identity constants into the lanes that return the original value.</span></div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;  <span class="comment">// Example: shuf (mul X, {-1,-2,-3,-4}), X, {0,5,6,3} --&gt; mul X, {-1,1,1,-4}</span></div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;  <span class="comment">// Example: shuf X, (add X, {-1,-2,-3,-4}), {0,1,6,7} --&gt; add X, {0,0,-3,-4}</span></div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;  <span class="comment">// The existing binop constant vector remains in the same operand position.</span></div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;  <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a> = Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>();</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *NewC = Op0IsBinop ? <a class="code" href="classllvm_1_1ConstantExpr.html#a6f6506f0bc515fe29da3b58565300017">ConstantExpr::getShuffleVector</a>(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>, IdC, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>) :</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;                                <a class="code" href="classllvm_1_1ConstantExpr.html#a6f6506f0bc515fe29da3b58565300017">ConstantExpr::getShuffleVector</a>(IdC, <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160; </div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;  <span class="keywordtype">bool</span> MightCreatePoisonOrUB =</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;      <a class="code" href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">is_contained</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>) &amp;&amp;</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;      (<a class="code" href="classllvm_1_1Instruction.html#af9c2825ab53adf1bf8c9fa19ec89d986">Instruction::isIntDivRem</a>(BOpcode) || <a class="code" href="classllvm_1_1Instruction.html#ac5984d6827f6e6922bed00bf03ba9552">Instruction::isShift</a>(BOpcode));</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;  <span class="keywordflow">if</span> (MightCreatePoisonOrUB)</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;    NewC = <a class="code" href="classllvm_1_1InstCombiner.html#a7ae45c035aecd2db82513cf9d87a9465">InstCombiner::getSafeVectorConstantForBinop</a>(BOpcode, NewC, <span class="keyword">true</span>);</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160; </div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;  <span class="comment">// shuf (bop X, C), X, M --&gt; bop X, C&#39;</span></div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;  <span class="comment">// shuf X, (bop X, C), M --&gt; bop X, C&#39;</span></div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a> = Op0IsBinop ? Op1 : Op0;</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NewBO = <a class="code" href="classllvm_1_1BinaryOperator.html#a02ce9966395063ac501ecbc1623deda4">BinaryOperator::Create</a>(BOpcode, <a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, NewC);</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;  NewBO-&gt;<a class="code" href="classllvm_1_1Instruction.html#a3e6d2896c39a84cfa6c47f34cdc584ff">copyIRFlags</a>(BO);</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160; </div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;  <span class="comment">// An undef shuffle mask element may propagate as an undef constant element in</span></div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;  <span class="comment">// the new binop. That would produce poison where the original code might not.</span></div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;  <span class="comment">// If we already made a safe constant, then there&#39;s no danger.</span></div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">is_contained</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>) &amp;&amp; !MightCreatePoisonOrUB)</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;    NewBO-&gt;<a class="code" href="classllvm_1_1Instruction.html#ad4613def4002aa69721553e567ca4187">dropPoisonGeneratingFlags</a>();</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;  <span class="keywordflow">return</span> NewBO;</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;}</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;<span class="comment">/// If we have an insert of a scalar to a non-zero element of an undefined</span></div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;<span class="comment">/// vector and then shuffle that value, that&#39;s the same as inserting to the zero</span></div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;<span class="comment">/// element and shuffling. Splatting from the zero element is recognized as the</span></div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;<span class="comment">/// canonical form of splat.</span></div>
<div class="line"><a name="l02171"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#afcd925ff2a62d44f8e4591b0e10d9f83"> 2171</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="InstCombineVectorOps_8cpp.html#afcd925ff2a62d44f8e4591b0e10d9f83">canonicalizeInsertSplat</a>(<a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a> &amp;Shuf,</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;                                            <a class="code" href="classllvm_1_1IRBuilder.html">InstCombiner::BuilderTy</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>) {</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Op0 = Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), *Op1 = Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1);</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;  <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a> = Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>();</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>;</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> IndexC;</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160; </div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;  <span class="comment">// Match a shuffle that is a splat to a non-zero element.</span></div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0, <a class="code" href="namespacellvm_1_1PatternMatch.html#aca6428e7fec51ba0b55594f469eb9691">m_OneUse</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a9cae528bdb66086aa6c06da36fc6fa24">m_InsertElt</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>),</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;                                       <a class="code" href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">m_ConstantInt</a>(IndexC)))) ||</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;      !<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op1, <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>()) || <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, <a class="code" href="structllvm_1_1PatternMatch_1_1m__ZeroMask.html">m_ZeroMask</a>()) || IndexC == 0)</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160; </div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;  <span class="comment">// Insert into element 0 of an undef vector.</span></div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;  <a class="code" href="classllvm_1_1UndefValue.html">UndefValue</a> *UndefVec = <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a50fe6a61ea745fb71fa8403af6e7deed">getType</a>());</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Zero = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt32(0);</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewIns = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateInsertElement(UndefVec, <a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, Zero);</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160; </div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;  <span class="comment">// Splat from element 0. Any mask element that is undefined remains undefined.</span></div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;  <span class="comment">// For example:</span></div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;  <span class="comment">// shuf (inselt undef, X, 2), _, &lt;2,2,undef&gt;</span></div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;  <span class="comment">//   --&gt; shuf (inselt undef, X, 0), poison, &lt;0,0,undef&gt;</span></div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;  <span class="keywordtype">unsigned</span> NumMaskElts =</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;      cast&lt;FixedVectorType&gt;(Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a50fe6a61ea745fb71fa8403af6e7deed">getType</a>())-&gt;getNumElements();</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int, 16&gt;</a> NewMask(NumMaskElts, 0);</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != NumMaskElts; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;      NewMask[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160; </div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a>(NewIns, NewMask);</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;}</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;<span class="comment">/// Try to fold shuffles that are the equivalent of a vector select.</span></div>
<div class="line"><a name="l02204"></a><span class="lineno"><a class="line" href="classllvm_1_1InstCombinerImpl.html#a3b73df3a995af9ca26c9d024c957c45a"> 2204</a></span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1InstCombinerImpl.html#a3b73df3a995af9ca26c9d024c957c45a">InstCombinerImpl::foldSelectShuffle</a>(<a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a> &amp;Shuf) {</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;  <span class="keywordflow">if</span> (!Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a747673ac3ea44aadc3907c6b9fd86237">isSelect</a>())</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160; </div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;  <span class="comment">// Canonicalize to choose from operand 0 first unless operand 1 is undefined.</span></div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;  <span class="comment">// Commuting undef to operand 0 conflicts with another canonicalization.</span></div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;  <span class="keywordtype">unsigned</span> NumElts = cast&lt;FixedVectorType&gt;(Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a50fe6a61ea745fb71fa8403af6e7deed">getType</a>())-&gt;getNumElements();</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1), <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>()) &amp;&amp;</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;      Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a3fb8619f70f51242f81ef96da349c884">getMaskValue</a>(0) &gt;= (<span class="keywordtype">int</span>)NumElts) {</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;    <span class="comment">// TODO: Can we assert that both operands of a shuffle-select are not undef</span></div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;    <span class="comment">// (otherwise, it would have been folded by instsimplify?</span></div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;    Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#aa94c68d274d913e05b0423c7b2fded00">commute</a>();</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;    <span class="keywordflow">return</span> &amp;Shuf;</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;  }</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160; </div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="InstCombineVectorOps_8cpp.html#a48d2595fd80a27962cdfe718529e1302">foldSelectShuffleOfSelectShuffle</a>(Shuf))</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160; </div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="InstCombineVectorOps_8cpp.html#a21c9d0a05a498a67033d97eb1200f3b6">foldSelectShuffleWith1Binop</a>(Shuf))</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160; </div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;  <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *B0, *B1;</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), <a class="code" href="namespacellvm_1_1PatternMatch.html#a43ac4fbaaf63a88eb5ac05f6d3e5649c">m_BinOp</a>(B0)) ||</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;      !<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1), <a class="code" href="namespacellvm_1_1PatternMatch.html#a43ac4fbaaf63a88eb5ac05f6d3e5649c">m_BinOp</a>(B1)))</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160; </div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;  <span class="comment">// If one operand is &quot;0 - X&quot;, allow that to be viewed as &quot;X * -1&quot;</span></div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;  <span class="comment">// (ConstantsAreOp1) by getAlternateBinop below. If the neg is not paired</span></div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;  <span class="comment">// with a multiply, we will exit because C0/C1 will not be set.</span></div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, *<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>;</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *C0 = <span class="keyword">nullptr</span>, *<a class="code" href="lib_2Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;  <span class="keywordtype">bool</span> ConstantsAreOp1;</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(B0, <a class="code" href="namespacellvm_1_1PatternMatch.html#a43ac4fbaaf63a88eb5ac05f6d3e5649c">m_BinOp</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#aadd209ba7e1bfa8113a609e09a7fe62f">m_Constant</a>(C0), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>))) &amp;&amp;</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;      <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(B1, <a class="code" href="namespacellvm_1_1PatternMatch.html#a43ac4fbaaf63a88eb5ac05f6d3e5649c">m_BinOp</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#aadd209ba7e1bfa8113a609e09a7fe62f">m_Constant</a>(<a class="code" href="lib_2Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>))))</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;    ConstantsAreOp1 = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(B0, <a class="code" href="namespacellvm_1_1PatternMatch.html#af4feec45578e32fe65d8efc59112bc8e">m_CombineOr</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a43ac4fbaaf63a88eb5ac05f6d3e5649c">m_BinOp</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#aadd209ba7e1bfa8113a609e09a7fe62f">m_Constant</a>(C0)),</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;                                 <a class="code" href="namespacellvm_1_1PatternMatch.html#a2fed53ed2b3225752bd9e4fce4967361">m_Neg</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>)))) &amp;&amp;</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;           <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(B1, <a class="code" href="namespacellvm_1_1PatternMatch.html#af4feec45578e32fe65d8efc59112bc8e">m_CombineOr</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a43ac4fbaaf63a88eb5ac05f6d3e5649c">m_BinOp</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#aadd209ba7e1bfa8113a609e09a7fe62f">m_Constant</a>(<a class="code" href="lib_2Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a>)),</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;                                 <a class="code" href="namespacellvm_1_1PatternMatch.html#a2fed53ed2b3225752bd9e4fce4967361">m_Neg</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>)))))</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;    ConstantsAreOp1 = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160; </div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;  <span class="comment">// We need matching binops to fold the lanes together.</span></div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html#ac26154a24f393f523c87cc5f8239f36c">BinaryOperator::BinaryOps</a> Opc0 = B0-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>();</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html#ac26154a24f393f523c87cc5f8239f36c">BinaryOperator::BinaryOps</a> Opc1 = B1-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>();</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;  <span class="keywordtype">bool</span> DropNSW = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;  <span class="keywordflow">if</span> (ConstantsAreOp1 &amp;&amp; Opc0 != Opc1) {</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;    <span class="comment">// TODO: We drop &quot;nsw&quot; if shift is converted into multiply because it may</span></div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;    <span class="comment">// not be correct when the shift amount is BitWidth - 1. We could examine</span></div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;    <span class="comment">// each vector element to determine if it is safe to keep that flag.</span></div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;    <span class="keywordflow">if</span> (Opc0 == Instruction::Shl || Opc1 == Instruction::Shl)</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;      DropNSW = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structBinopElts.html">BinopElts</a> AltB0 = <a class="code" href="InstCombineVectorOps_8cpp.html#af7e7c9415c23ae336af651877798a377">getAlternateBinop</a>(B0, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>)) {</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isa&lt;Constant&gt;(AltB0.Op1) &amp;&amp; <span class="stringliteral">&quot;Expecting constant with alt binop&quot;</span>);</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;      Opc0 = AltB0.Opcode;</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;      C0 = cast&lt;Constant&gt;(AltB0.Op1);</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="structBinopElts.html">BinopElts</a> AltB1 = <a class="code" href="InstCombineVectorOps_8cpp.html#af7e7c9415c23ae336af651877798a377">getAlternateBinop</a>(B1, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>)) {</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isa&lt;Constant&gt;(AltB1.Op1) &amp;&amp; <span class="stringliteral">&quot;Expecting constant with alt binop&quot;</span>);</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;      Opc1 = AltB1.Opcode;</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;      <a class="code" href="lib_2Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a> = cast&lt;Constant&gt;(AltB1.Op1);</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;    }</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;  }</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160; </div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;  <span class="keywordflow">if</span> (Opc0 != Opc1 || !C0 || !<a class="code" href="lib_2Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a>)</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160; </div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;  <span class="comment">// The opcodes must be the same. Use a new name to make that clear.</span></div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html#ac26154a24f393f523c87cc5f8239f36c">BinaryOperator::BinaryOps</a> BOpc = Opc0;</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160; </div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;  <span class="comment">// Select the constant elements needed for the single binop.</span></div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;  <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a> = Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>();</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *NewC = <a class="code" href="classllvm_1_1ConstantExpr.html#a6f6506f0bc515fe29da3b58565300017">ConstantExpr::getShuffleVector</a>(C0, <a class="code" href="lib_2Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a>, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160; </div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;  <span class="comment">// We are moving a binop after a shuffle. When a shuffle has an undefined</span></div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;  <span class="comment">// mask element, the result is undefined, but it is not poison or undefined</span></div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;  <span class="comment">// behavior. That is not necessarily true for div/rem/shift.</span></div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;  <span class="keywordtype">bool</span> MightCreatePoisonOrUB =</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;      <a class="code" href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">is_contained</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>) &amp;&amp;</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;      (<a class="code" href="classllvm_1_1Instruction.html#af9c2825ab53adf1bf8c9fa19ec89d986">Instruction::isIntDivRem</a>(BOpc) || <a class="code" href="classllvm_1_1Instruction.html#ac5984d6827f6e6922bed00bf03ba9552">Instruction::isShift</a>(BOpc));</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;  <span class="keywordflow">if</span> (MightCreatePoisonOrUB)</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;    NewC = <a class="code" href="classllvm_1_1InstCombiner.html#a7ae45c035aecd2db82513cf9d87a9465">InstCombiner::getSafeVectorConstantForBinop</a>(BOpc, NewC,</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;                                                       ConstantsAreOp1);</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160; </div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *V;</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a> == <a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>) {</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;    <span class="comment">// Remove a binop and the shuffle by rearranging the constant:</span></div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;    <span class="comment">// shuffle (op V, C0), (op V, C1), M --&gt; op V, C&#39;</span></div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;    <span class="comment">// shuffle (op C0, V), (op C1, V), M --&gt; op C&#39;, V</span></div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;    V = <a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>;</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;    <span class="comment">// If there are 2 different variable operands, we must create a new shuffle</span></div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;    <span class="comment">// (select) first, so check uses to ensure that we don&#39;t end up with more</span></div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;    <span class="comment">// instructions than we started with.</span></div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;    <span class="keywordflow">if</span> (!B0-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; !B1-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160; </div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;    <span class="comment">// If we use the original shuffle mask and op1 is *variable*, we would be</span></div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;    <span class="comment">// putting an undef into operand 1 of div/rem/shift. This is either UB or</span></div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;    <span class="comment">// poison. We do not have to guard against UB when *constants* are op1</span></div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;    <span class="comment">// because safe constants guarantee that we do not overflow sdiv/srem (and</span></div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;    <span class="comment">// there&#39;s no danger for other opcodes).</span></div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;    <span class="comment">// TODO: To allow this case, create a new shuffle mask with no undefs.</span></div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;    <span class="keywordflow">if</span> (MightCreatePoisonOrUB &amp;&amp; !ConstantsAreOp1)</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160; </div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;    <span class="comment">// Note: In general, we do not create new shuffles in InstCombine because we</span></div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;    <span class="comment">// do not know if a target can lower an arbitrary shuffle optimally. In this</span></div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;    <span class="comment">// case, the shuffle uses the existing mask, so there is no additional risk.</span></div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160; </div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;    <span class="comment">// Select the variable vectors first, then perform the binop:</span></div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;    <span class="comment">// shuffle (op X, C0), (op Y, C1), M --&gt; op (shuffle X, Y, M), C&#39;</span></div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;    <span class="comment">// shuffle (op C0, X), (op C1, Y), M --&gt; op C&#39;, (shuffle X, Y, M)</span></div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;    V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShuffleVector(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, <a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;  }</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160; </div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewBO = ConstantsAreOp1 ? <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBinOp(BOpc, V, NewC) :</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;                                   <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBinOp(BOpc, NewC, V);</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160; </div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;  <span class="comment">// Flags are intersected from the 2 source binops. But there are 2 exceptions:</span></div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;  <span class="comment">// 1. If we changed an opcode, poison conditions might have changed.</span></div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;  <span class="comment">// 2. If the shuffle had undef mask elements, the new binop might have undefs</span></div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;  <span class="comment">//    where the original code did not. But if we already made a safe constant,</span></div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;  <span class="comment">//    then there&#39;s no danger.</span></div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *NewI = dyn_cast&lt;Instruction&gt;(NewBO)) {</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;    NewI-&gt;copyIRFlags(B0);</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;    NewI-&gt;andIRFlags(B1);</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;    <span class="keywordflow">if</span> (DropNSW)</div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;      NewI-&gt;setHasNoSignedWrap(<span class="keyword">false</span>);</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">is_contained</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>) &amp;&amp; !MightCreatePoisonOrUB)</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;      NewI-&gt;dropPoisonGeneratingFlags();</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;  }</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;  <span class="keywordflow">return</span> replaceInstUsesWith(Shuf, NewBO);</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;}</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;<span class="comment">/// Convert a narrowing shuffle of a bitcasted vector into a vector truncate.</span></div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;<span class="comment">/// Example (little endian):</span></div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;<span class="comment">/// shuf (bitcast &lt;4 x i16&gt; X to &lt;8 x i8&gt;), &lt;0, 2, 4, 6&gt; --&gt; trunc X to &lt;4 x i8&gt;</span></div>
<div class="line"><a name="l02342"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#aeb9966cdc23a95b13381c5b7e8f4ba2c"> 2342</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="InstCombineVectorOps_8cpp.html#aeb9966cdc23a95b13381c5b7e8f4ba2c">foldTruncShuffle</a>(<a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a> &amp;Shuf,</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;                                     <span class="keywordtype">bool</span> IsBigEndian) {</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;  <span class="comment">// This must be a bitcasted shuffle of 1 vector integer operand.</span></div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *DestType = Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a50fe6a61ea745fb71fa8403af6e7deed">getType</a>();</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>;</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), <a class="code" href="namespacellvm_1_1PatternMatch.html#ac0467ca7fad871738b10db95feb40dad">m_BitCast</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>))) ||</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;      !<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1), <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>()) || !DestType-&gt;<a class="code" href="classllvm_1_1Type.html#a34ee40bb2f4f5ece47ef19e5f1f57e3c">isIntOrIntVectorTy</a>())</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160; </div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;  <span class="comment">// The source type must have the same number of elements as the shuffle,</span></div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;  <span class="comment">// and the source element type must be larger than the shuffle element type.</span></div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *SrcType = <a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>-&gt;getType();</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;  <span class="keywordflow">if</span> (!SrcType-&gt;<a class="code" href="classllvm_1_1Type.html#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() || !SrcType-&gt;<a class="code" href="classllvm_1_1Type.html#a34ee40bb2f4f5ece47ef19e5f1f57e3c">isIntOrIntVectorTy</a>() ||</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;      cast&lt;FixedVectorType&gt;(SrcType)-&gt;getNumElements() !=</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;          cast&lt;FixedVectorType&gt;(DestType)-&gt;getNumElements() ||</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;      SrcType-&gt;<a class="code" href="classllvm_1_1Type.html#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() % DestType-&gt;<a class="code" href="classllvm_1_1Type.html#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() != 0)</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160; </div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a1552dc44fac81fb75a474feaa2ffdab8">changesLength</a>() &amp;&amp; !Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a6315811e3cc527c8f1ab15ae0c789b93">increasesLength</a>() &amp;&amp;</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;         <span class="stringliteral">&quot;Expected a shuffle that decreases length&quot;</span>);</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160; </div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;  <span class="comment">// Last, check that the mask chooses the correct low bits for each narrow</span></div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;  <span class="comment">// element in the result.</span></div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> TruncRatio =</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;      SrcType-&gt;<a class="code" href="classllvm_1_1Type.html#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() / DestType-&gt;<a class="code" href="classllvm_1_1Type.html#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;  <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a> = Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>();</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a>)</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;    <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> LSBIndex = IsBigEndian ? (<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1) * TruncRatio - 1 : <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> * TruncRatio;</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LSBIndex &lt;= INT32_MAX &amp;&amp; <span class="stringliteral">&quot;Overflowed 32-bits&quot;</span>);</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] != (<span class="keywordtype">int</span>)LSBIndex)</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;  }</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160; </div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1TruncInst.html">TruncInst</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, DestType);</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;}</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;<span class="comment">/// Match a shuffle-select-shuffle pattern where the shuffles are widening and</span></div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;<span class="comment">/// narrowing (concatenating with undef and extracting back to the original</span></div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;<span class="comment">/// length). This allows replacing the wide select with a narrow select.</span></div>
<div class="line"><a name="l02383"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#a9f2944f05cd70d1dc4816c38c9242d77"> 2383</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="InstCombineVectorOps_8cpp.html#a9f2944f05cd70d1dc4816c38c9242d77">narrowVectorSelect</a>(<a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a> &amp;Shuf,</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;                                       <a class="code" href="classllvm_1_1IRBuilder.html">InstCombiner::BuilderTy</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>) {</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;  <span class="comment">// This must be a narrowing identity shuffle. It extracts the 1st N elements</span></div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;  <span class="comment">// of the 1st vector operand of a shuffle.</span></div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1), <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>()) || !Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a64a379276cb10c6cc61146d8a95cd1a7">isIdentityWithExtract</a>())</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160; </div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;  <span class="comment">// The vector being shuffled must be a vector select that we can eliminate.</span></div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;  <span class="comment">// TODO: The one-use requirement could be eased if X and/or Y are constants.</span></div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>, *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, *<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>;</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0),</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;             <a class="code" href="namespacellvm_1_1PatternMatch.html#aca6428e7fec51ba0b55594f469eb9691">m_OneUse</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#addb87fe3f509b7803d3f5933ee24b560">m_Select</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>)))))</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160; </div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;  <span class="comment">// We need a narrow condition value. It must be extended with undef elements</span></div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;  <span class="comment">// and have the same number of elements as this shuffle.</span></div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;  <span class="keywordtype">unsigned</span> NarrowNumElts =</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;      cast&lt;FixedVectorType&gt;(Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a50fe6a61ea745fb71fa8403af6e7deed">getType</a>())-&gt;getNumElements();</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NarrowCond;</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#aca6428e7fec51ba0b55594f469eb9691">m_OneUse</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#afd3e8a6706810fef8cdbaf1f9f40dfbd">m_Shuffle</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(NarrowCond), <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>()))) ||</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;      cast&lt;FixedVectorType&gt;(NarrowCond-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getNumElements() !=</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;          NarrowNumElts ||</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;      !cast&lt;ShuffleVectorInst&gt;(<a class="code" href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a>)-&gt;isIdentityWithPadding())</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160; </div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;  <span class="comment">// shuf (sel (shuf NarrowCond, undef, WideMask), X, Y), undef, NarrowMask) --&gt;</span></div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;  <span class="comment">// sel NarrowCond, (shuf X, undef, NarrowMask), (shuf Y, undef, NarrowMask)</span></div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NarrowX = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShuffleVector(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>());</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NarrowY = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShuffleVector(<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>, Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>());</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1SelectInst.html#aa55fb74dd22008fdcc26a63f44576022">SelectInst::Create</a>(NarrowCond, NarrowX, NarrowY);</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;}</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;<span class="comment">/// Canonicalize FP negate/abs after shuffle.</span></div>
<div class="line"><a name="l02416"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#a86a84b490f6c77c0000bcbe71cd6057d"> 2416</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="InstCombineVectorOps_8cpp.html#a86a84b490f6c77c0000bcbe71cd6057d">foldShuffleOfUnaryOps</a>(<a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a> &amp;Shuf,</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;                                          <a class="code" href="classllvm_1_1IRBuilder.html">InstCombiner::BuilderTy</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>) {</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;  <span class="keyword">auto</span> *S0 = dyn_cast&lt;Instruction&gt;(Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0));</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>;</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;  <span class="keywordflow">if</span> (!S0 || !<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(S0, <a class="code" href="namespacellvm_1_1PatternMatch.html#af4feec45578e32fe65d8efc59112bc8e">m_CombineOr</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#af431ec215bba8bb9c56e7541d99920f2">m_FNeg</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>)), <a class="code" href="namespacellvm_1_1PatternMatch.html#a7638daf70e17d093dd35f06211dc7a87">m_FAbs</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>)))))</div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160; </div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;  <span class="keywordtype">bool</span> IsFNeg = S0-&gt;getOpcode() == Instruction::FNeg;</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160; </div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;  <span class="comment">// Match 1-input (unary) shuffle.</span></div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;  <span class="comment">// shuffle (fneg/fabs X), Mask --&gt; fneg/fabs (shuffle X, Mask)</span></div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;  <span class="keywordflow">if</span> (S0-&gt;hasOneUse() &amp;&amp; <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1), <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>())) {</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *NewShuf = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShuffleVector(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>());</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;    <span class="keywordflow">if</span> (IsFNeg)</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1UnaryOperator.html#a9f731708e681757d51c4dc2a004873c8">UnaryOperator::CreateFNegFMF</a>(NewShuf, S0);</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160; </div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;    <a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba4f09e5b9ab57b1d72349caeba37a0dc1">FAbs</a> = <a class="code" href="namespacellvm_1_1Intrinsic.html#aefa39f6b622360ce4e947feb9f671b73">Intrinsic::getDeclaration</a>(Shuf.<a class="code" href="classllvm_1_1Instruction.html#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>(),</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;                                               Intrinsic::fabs, Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a50fe6a61ea745fb71fa8403af6e7deed">getType</a>());</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;    <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *NewF = <a class="code" href="classllvm_1_1CallInst.html#a850d8262cd900958b3153c4aa080b2bb">CallInst::Create</a>(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba4f09e5b9ab57b1d72349caeba37a0dc1">FAbs</a>, {NewShuf});</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;    NewF-&gt;<a class="code" href="classllvm_1_1Instruction.html#a5ca8aa62fa8b3fe5bc0e8fbe5d8b8b7a">setFastMathFlags</a>(S0-&gt;getFastMathFlags());</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;    <span class="keywordflow">return</span> NewF;</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;  }</div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160; </div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;  <span class="comment">// Match 2-input (binary) shuffle.</span></div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;  <span class="keyword">auto</span> *S1 = dyn_cast&lt;Instruction&gt;(Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1));</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>;</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;  <span class="keywordflow">if</span> (!S1 || !<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(S1, <a class="code" href="namespacellvm_1_1PatternMatch.html#af4feec45578e32fe65d8efc59112bc8e">m_CombineOr</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#af431ec215bba8bb9c56e7541d99920f2">m_FNeg</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>)), <a class="code" href="namespacellvm_1_1PatternMatch.html#a7638daf70e17d093dd35f06211dc7a87">m_FAbs</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>)))) ||</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;      S0-&gt;getOpcode() != S1-&gt;getOpcode() ||</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;      (!S0-&gt;hasOneUse() &amp;&amp; !S1-&gt;hasOneUse()))</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160; </div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;  <span class="comment">// shuf (fneg/fabs X), (fneg/fabs Y), Mask --&gt; fneg/fabs (shuf X, Y, Mask)</span></div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewShuf = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShuffleVector(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, <a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>, Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>());</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NewF;</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;  <span class="keywordflow">if</span> (IsFNeg) {</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;    NewF = UnaryOperator::CreateFNeg(NewShuf);</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;    <a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba4f09e5b9ab57b1d72349caeba37a0dc1">FAbs</a> = <a class="code" href="namespacellvm_1_1Intrinsic.html#aefa39f6b622360ce4e947feb9f671b73">Intrinsic::getDeclaration</a>(Shuf.<a class="code" href="classllvm_1_1Instruction.html#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>(),</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;                                               Intrinsic::fabs, Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a50fe6a61ea745fb71fa8403af6e7deed">getType</a>());</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;    NewF = <a class="code" href="classllvm_1_1CallInst.html#a850d8262cd900958b3153c4aa080b2bb">CallInst::Create</a>(<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba4f09e5b9ab57b1d72349caeba37a0dc1">FAbs</a>, {NewShuf});</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;  }</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;  NewF-&gt;<a class="code" href="classllvm_1_1Instruction.html#a3e6d2896c39a84cfa6c47f34cdc584ff">copyIRFlags</a>(S0);</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;  NewF-&gt;<a class="code" href="classllvm_1_1Instruction.html#a4ea9acbe7fd20332ea6ccdb0183d6395">andIRFlags</a>(S1);</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;  <span class="keywordflow">return</span> NewF;</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;}</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;<span class="comment">/// Canonicalize casts after shuffle.</span></div>
<div class="line"><a name="l02463"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#a78e5e60cd789444b846f046aa99c11c4"> 2463</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="InstCombineVectorOps_8cpp.html#a78e5e60cd789444b846f046aa99c11c4">foldCastShuffle</a>(<a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a> &amp;Shuf,</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;                                    <a class="code" href="classllvm_1_1IRBuilder.html">InstCombiner::BuilderTy</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>) {</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;  <span class="comment">// Do we have 2 matching cast operands?</span></div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;  <span class="keyword">auto</span> *Cast0 = dyn_cast&lt;CastInst&gt;(Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0));</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;  <span class="keyword">auto</span> *Cast1 = dyn_cast&lt;CastInst&gt;(Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1));</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;  <span class="keywordflow">if</span> (!Cast0 || !Cast1 || Cast0-&gt;getOpcode() != Cast1-&gt;getOpcode() ||</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;      Cast0-&gt;getSrcTy() != Cast1-&gt;getSrcTy())</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160; </div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;  <span class="comment">// TODO: Allow other opcodes? That would require easing the type restrictions</span></div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;  <span class="comment">//       below here.</span></div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html#afa0b2fa29ba074f2b6ec9ac11163f2d9">CastInst::CastOps</a> CastOpcode = Cast0-&gt;getOpcode();</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;  <span class="keywordflow">switch</span> (CastOpcode) {</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;  <span class="keywordflow">case</span> Instruction::FPToSI:</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;  <span class="keywordflow">case</span> Instruction::FPToUI:</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;  <span class="keywordflow">case</span> Instruction::SIToFP:</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;  <span class="keywordflow">case</span> Instruction::UIToFP:</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;  <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;  }</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160; </div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;  <a class="code" href="classllvm_1_1VectorType.html">VectorType</a> *ShufTy = Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a50fe6a61ea745fb71fa8403af6e7deed">getType</a>();</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;  <a class="code" href="classllvm_1_1VectorType.html">VectorType</a> *ShufOpTy = cast&lt;VectorType&gt;(Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;  <a class="code" href="classllvm_1_1VectorType.html">VectorType</a> *CastSrcTy = cast&lt;VectorType&gt;(Cast0-&gt;getSrcTy());</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160; </div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;  <span class="comment">// TODO: Allow length-increasing shuffles?</span></div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;  <span class="keywordflow">if</span> (ShufTy-&gt;<a class="code" href="classllvm_1_1VectorType.html#a59632c5deb0423a518ad984bdd04d41f">getElementCount</a>().<a class="code" href="classllvm_1_1details_1_1FixedOrScalableQuantity.html#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() &gt;</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;      ShufOpTy-&gt;<a class="code" href="classllvm_1_1VectorType.html#a59632c5deb0423a518ad984bdd04d41f">getElementCount</a>().<a class="code" href="classllvm_1_1details_1_1FixedOrScalableQuantity.html#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>())</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160; </div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;  <span class="comment">// TODO: Allow element-size-decreasing casts (ex: fptosi float to i8)?</span></div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isa&lt;FixedVectorType&gt;(CastSrcTy) &amp;&amp; isa&lt;FixedVectorType&gt;(ShufOpTy) &amp;&amp;</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;         <span class="stringliteral">&quot;Expected fixed vector operands for casts and binary shuffle&quot;</span>);</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;  <span class="keywordflow">if</span> (CastSrcTy-&gt;<a class="code" href="classllvm_1_1Type.html#a833daf718a49c5cd637d8c9ddeaebe07">getPrimitiveSizeInBits</a>() &gt; ShufOpTy-&gt;<a class="code" href="classllvm_1_1Type.html#a833daf718a49c5cd637d8c9ddeaebe07">getPrimitiveSizeInBits</a>())</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160; </div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;  <span class="comment">// At least one of the operands must have only one use (the shuffle).</span></div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;  <span class="keywordflow">if</span> (!Cast0-&gt;hasOneUse() &amp;&amp; !Cast1-&gt;hasOneUse())</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160; </div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;  <span class="comment">// shuffle (cast X), (cast Y), Mask --&gt; cast (shuffle X, Y, Mask)</span></div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a> = Cast0-&gt;getOperand(0);</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a> = Cast1-&gt;getOperand(0);</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewShuf = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShuffleVector(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, <a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>, Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>());</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1CastInst.html#a643fe5a9e7042f032dae78109c2b1e72">CastInst::Create</a>(CastOpcode, NewShuf, ShufTy);</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;}</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;<span class="comment">/// Try to fold an extract subvector operation.</span></div>
<div class="line"><a name="l02512"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#a444937e7243ef0e376687b403c4bfd1e"> 2512</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="InstCombineVectorOps_8cpp.html#a444937e7243ef0e376687b403c4bfd1e">foldIdentityExtractShuffle</a>(<a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a> &amp;Shuf) {</div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Op0 = Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), *Op1 = Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1);</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;  <span class="keywordflow">if</span> (!Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a64a379276cb10c6cc61146d8a95cd1a7">isIdentityWithExtract</a>() || !<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op1, <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>()))</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160; </div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;  <span class="comment">// Check if we are extracting all bits of an inserted scalar:</span></div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;  <span class="comment">// extract-subvec (bitcast (inselt ?, X, 0) --&gt; bitcast X to subvec type</span></div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>;</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0, <a class="code" href="namespacellvm_1_1PatternMatch.html#ac0467ca7fad871738b10db95feb40dad">m_BitCast</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a9cae528bdb66086aa6c06da36fc6fa24">m_InsertElt</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#ae77be336e228cf9aa00709a8606dfb98">m_Zero</a>()))) &amp;&amp;</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;      <a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>-&gt;getType()-&gt;getPrimitiveSizeInBits() ==</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;          Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a50fe6a61ea745fb71fa8403af6e7deed">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a833daf718a49c5cd637d8c9ddeaebe07">getPrimitiveSizeInBits</a>())</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a50fe6a61ea745fb71fa8403af6e7deed">getType</a>());</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160; </div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;  <span class="comment">// Try to combine 2 shuffles into 1 shuffle by concatenating a shuffle mask.</span></div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>;</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;  <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>;</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0, <a class="code" href="namespacellvm_1_1PatternMatch.html#afd3e8a6706810fef8cdbaf1f9f40dfbd">m_Shuffle</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>), <a class="code" href="structllvm_1_1PatternMatch_1_1m__Mask.html">m_Mask</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>))))</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160; </div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;  <span class="comment">// Be conservative with shuffle transforms. If we can&#39;t kill the 1st shuffle,</span></div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;  <span class="comment">// then combining may result in worse codegen.</span></div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;  <span class="keywordflow">if</span> (!Op0-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160; </div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;  <span class="comment">// We are extracting a subvector from a shuffle. Remove excess elements from</span></div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;  <span class="comment">// the 1st shuffle mask to eliminate the extract.</span></div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;  <span class="comment">// This transform is conservatively limited to identity extracts because we do</span></div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;  <span class="comment">// not allow arbitrary shuffle mask creation as a target-independent transform</span></div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;  <span class="comment">// (because we can&#39;t guarantee that will lower efficiently).</span></div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;  <span class="comment">// If the extracting shuffle has an undef mask element, it transfers to the</span></div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;  <span class="comment">// new shuffle mask. Otherwise, copy the original mask element. Example:</span></div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;  <span class="comment">//   shuf (shuf X, Y, &lt;C0, C1, C2, undef, C4&gt;), undef, &lt;0, undef, 2, 3&gt; --&gt;</span></div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;  <span class="comment">//   shuf X, Y, &lt;C0, undef, C2, undef&gt;</span></div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;  <span class="keywordtype">unsigned</span> NumElts = cast&lt;FixedVectorType&gt;(Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a50fe6a61ea745fb71fa8403af6e7deed">getType</a>())-&gt;getNumElements();</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int, 16&gt;</a> NewMask(NumElts);</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NumElts &lt; <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size() &amp;&amp;</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;         <span class="stringliteral">&quot;Identity with extract must have less elements than its inputs&quot;</span>);</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160; </div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != NumElts; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;    <span class="keywordtype">int</span> ExtractMaskElt = Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a3fb8619f70f51242f81ef96da349c884">getMaskValue</a>(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;    <span class="keywordtype">int</span> MaskElt = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;    NewMask[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] = ExtractMaskElt == <a class="code" href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">UndefMaskElem</a> ? ExtractMaskElt : MaskElt;</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;  }</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, <a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>, NewMask);</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;}</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;<span class="comment">/// Try to replace a shuffle with an insertelement or try to replace a shuffle</span></div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;<span class="comment">/// operand with the operand of an insertelement.</span></div>
<div class="line"><a name="l02562"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#a0b4f3906851e4c43f596d9f8f40bcd94"> 2562</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="InstCombineVectorOps_8cpp.html#a0b4f3906851e4c43f596d9f8f40bcd94">foldShuffleWithInsert</a>(<a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a> &amp;Shuf,</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;                                          <a class="code" href="classllvm_1_1InstCombinerImpl.html">InstCombinerImpl</a> &amp;IC) {</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *V0 = Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0), *V1 = Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1);</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int, 16&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>;</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;  Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160; </div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;  <span class="keywordtype">int</span> NumElts = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size();</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;  <span class="keywordtype">int</span> InpNumElts = cast&lt;FixedVectorType&gt;(V0-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getNumElements();</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160; </div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;  <span class="comment">// This is a specialization of a fold in SimplifyDemandedVectorElts. We may</span></div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;  <span class="comment">// not be able to handle it there if the insertelement has &gt;1 use.</span></div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;  <span class="comment">// If the shuffle has an insertelement operand but does not choose the</span></div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;  <span class="comment">// inserted scalar element from that value, then we can replace that shuffle</span></div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;  <span class="comment">// operand with the source vector of the insertelement.</span></div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>;</div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;  <a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a> IdxC;</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V0, <a class="code" href="namespacellvm_1_1PatternMatch.html#a9cae528bdb66086aa6c06da36fc6fa24">m_InsertElt</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">m_ConstantInt</a>(IdxC)))) {</div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;    <span class="comment">// shuf (inselt X, ?, IdxC), ?, Mask --&gt; shuf X, ?, Mask</span></div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">is_contained</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, (<span class="keywordtype">int</span>)IdxC))</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;      <span class="keywordflow">return</span> IC.<a class="code" href="classllvm_1_1InstCombiner.html#abc13043585e5845ce7fc26b858851ec9">replaceOperand</a>(Shuf, 0, <a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>);</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;  }</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V1, <a class="code" href="namespacellvm_1_1PatternMatch.html#a9cae528bdb66086aa6c06da36fc6fa24">m_InsertElt</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">m_ConstantInt</a>(IdxC)))) {</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;    <span class="comment">// Offset the index constant by the vector width because we are checking for</span></div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;    <span class="comment">// accesses to the 2nd vector input of the shuffle.</span></div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;    IdxC += InpNumElts;</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;    <span class="comment">// shuf ?, (inselt X, ?, IdxC), Mask --&gt; shuf ?, X, Mask</span></div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">is_contained</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, (<span class="keywordtype">int</span>)IdxC))</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;      <span class="keywordflow">return</span> IC.<a class="code" href="classllvm_1_1InstCombiner.html#abc13043585e5845ce7fc26b858851ec9">replaceOperand</a>(Shuf, 1, <a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>);</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;  }</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;  <span class="comment">// For the rest of the transform, the shuffle must not change vector sizes.</span></div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;  <span class="comment">// TODO: This restriction could be removed if the insert has only one use</span></div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;  <span class="comment">//       (because the transform would require a new length-changing shuffle).</span></div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;  <span class="keywordflow">if</span> (NumElts != InpNumElts)</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160; </div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;  <span class="comment">// shuffle (insert ?, Scalar, IndexC), V1, Mask --&gt; insert V1, Scalar, IndexC&#39;</span></div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;  <span class="keyword">auto</span> isShufflingScalarIntoOp1 = [&amp;](<a class="code" href="classllvm_1_1Value.html">Value</a> *&amp;Scalar, <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *&amp;IndexC) {</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;    <span class="comment">// We need an insertelement with a constant index.</span></div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V0, <a class="code" href="namespacellvm_1_1PatternMatch.html#a9cae528bdb66086aa6c06da36fc6fa24">m_InsertElt</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(Scalar),</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;                               <a class="code" href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">m_ConstantInt</a>(IndexC))))</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160; </div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;    <span class="comment">// Test the shuffle mask to see if it splices the inserted scalar into the</span></div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;    <span class="comment">// operand 1 vector of the shuffle.</span></div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;    <span class="keywordtype">int</span> NewInsIndex = -1;</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != NumElts; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;      <span class="comment">// Ignore undef mask elements.</span></div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] == -1)</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160; </div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;      <span class="comment">// The shuffle takes elements of operand 1 without lane changes.</span></div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] == NumElts + <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160; </div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;      <span class="comment">// The shuffle must choose the inserted scalar exactly once.</span></div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;      <span class="keywordflow">if</span> (NewInsIndex != -1 || <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] != IndexC-&gt;getSExtValue())</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160; </div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;      <span class="comment">// The shuffle is placing the inserted scalar into element i.</span></div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;      NewInsIndex = <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;    }</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160; </div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewInsIndex != -1 &amp;&amp; <span class="stringliteral">&quot;Did not fold shuffle with unused operand?&quot;</span>);</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160; </div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;    <span class="comment">// Index is updated to the potentially translated insertion lane.</span></div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;    IndexC = <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(IndexC-&gt;getType(), NewInsIndex);</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;  };</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160; </div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;  <span class="comment">// If the shuffle is unnecessary, insert the scalar operand directly into</span></div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;  <span class="comment">// operand 1 of the shuffle. Example:</span></div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;  <span class="comment">// shuffle (insert ?, S, 1), V1, &lt;1, 5, 6, 7&gt; --&gt; insert V1, S, 0</span></div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Scalar;</div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *IndexC;</div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;  <span class="keywordflow">if</span> (isShufflingScalarIntoOp1(Scalar, IndexC))</div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1InsertElementInst.html#a44cefc7b60337e7e14d20e843c74e534">InsertElementInst::Create</a>(V1, Scalar, IndexC);</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160; </div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;  <span class="comment">// Try again after commuting shuffle. Example:</span></div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;  <span class="comment">// shuffle V0, (insert ?, S, 0), &lt;0, 1, 2, 4&gt; --&gt;</span></div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;  <span class="comment">// shuffle (insert ?, S, 0), V0, &lt;4, 5, 6, 0&gt; --&gt; insert V0, S, 3</span></div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;  <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(V0, V1);</div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;  <a class="code" href="classllvm_1_1ShuffleVectorInst.html#a9874bec83353914ed1e9309d5d9ccea0">ShuffleVectorInst::commuteShuffleMask</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, NumElts);</div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;  <span class="keywordflow">if</span> (isShufflingScalarIntoOp1(Scalar, IndexC))</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1InsertElementInst.html#a44cefc7b60337e7e14d20e843c74e534">InsertElementInst::Create</a>(V1, Scalar, IndexC);</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160; </div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;}</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160; </div>
<div class="line"><a name="l02650"></a><span class="lineno"><a class="line" href="InstCombineVectorOps_8cpp.html#ab903583d9f02e20dad7ebac266b73214"> 2650</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="InstCombineVectorOps_8cpp.html#ab903583d9f02e20dad7ebac266b73214">foldIdentityPaddedShuffles</a>(<a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a> &amp;Shuf) {</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;  <span class="comment">// Match the operands as identity with padding (also known as concatenation</span></div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;  <span class="comment">// with undef) shuffles of the same source type. The backend is expected to</span></div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;  <span class="comment">// recreate these concatenations from a shuffle of narrow operands.</span></div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;  <span class="keyword">auto</span> *Shuffle0 = dyn_cast&lt;ShuffleVectorInst&gt;(Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0));</div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;  <span class="keyword">auto</span> *Shuffle1 = dyn_cast&lt;ShuffleVectorInst&gt;(Shuf.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1));</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;  <span class="keywordflow">if</span> (!Shuffle0 || !Shuffle0-&gt;isIdentityWithPadding() ||</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;      !Shuffle1 || !Shuffle1-&gt;isIdentityWithPadding())</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160; </div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;  <span class="comment">// We limit this transform to power-of-2 types because we expect that the</span></div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;  <span class="comment">// backend can convert the simplified IR patterns to identical nodes as the</span></div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;  <span class="comment">// original IR.</span></div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;  <span class="comment">// TODO: If we can verify the same behavior for arbitrary types, the</span></div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;  <span class="comment">//       power-of-2 checks can be removed.</span></div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a> = Shuffle0-&gt;getOperand(0);</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a> = Shuffle1-&gt;getOperand(0);</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>-&gt;getType() != <a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>-&gt;getType() ||</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;      !<a class="code" href="namespacellvm.html#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2_32</a>(cast&lt;FixedVectorType&gt;(Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a50fe6a61ea745fb71fa8403af6e7deed">getType</a>())-&gt;getNumElements()) ||</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;      !<a class="code" href="namespacellvm.html#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2_32</a>(</div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;          cast&lt;FixedVectorType&gt;(Shuffle0-&gt;getType())-&gt;getNumElements()) ||</div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;      !<a class="code" href="namespacellvm.html#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2_32</a>(cast&lt;FixedVectorType&gt;(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>-&gt;getType())-&gt;getNumElements()) ||</div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;      <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>()) || <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>()))</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shuffle0-&gt;getOperand(1), <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>()) &amp;&amp;</div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;         <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shuffle1-&gt;getOperand(1), <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>()) &amp;&amp;</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;         <span class="stringliteral">&quot;Unexpected operand for identity shuffle&quot;</span>);</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160; </div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;  <span class="comment">// This is a shuffle of 2 widening shuffles. We can shuffle the narrow source</span></div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;  <span class="comment">// operands directly by adjusting the shuffle mask to account for the narrower</span></div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;  <span class="comment">// types:</span></div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;  <span class="comment">// shuf (widen X), (widen Y), Mask --&gt; shuf X, Y, Mask&#39;</span></div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;  <span class="keywordtype">int</span> NarrowElts = cast&lt;FixedVectorType&gt;(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>-&gt;getType())-&gt;getNumElements();</div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;  <span class="keywordtype">int</span> WideElts = cast&lt;FixedVectorType&gt;(Shuffle0-&gt;getType())-&gt;getNumElements();</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(WideElts &gt; NarrowElts &amp;&amp; <span class="stringliteral">&quot;Unexpected types for identity with padding&quot;</span>);</div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160; </div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;  <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a> = Shuf.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>();</div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int, 16&gt;</a> NewMask(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size(), -1);</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] == -1)</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160; </div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;    <span class="comment">// If this shuffle is choosing an undef element from 1 of the sources, that</span></div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;    <span class="comment">// element is undef.</span></div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt; WideElts) {</div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;      <span class="keywordflow">if</span> (Shuffle0-&gt;getMaskValue(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]) == -1)</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;      <span class="keywordflow">if</span> (Shuffle1-&gt;getMaskValue(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] - WideElts) == -1)</div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;    }</div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160; </div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;    <span class="comment">// If this shuffle is choosing from the 1st narrow op, the mask element is</span></div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;    <span class="comment">// the same. If this shuffle is choosing from the 2nd narrow op, the mask</span></div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;    <span class="comment">// element is offset down to adjust for the narrow vector widths.</span></div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt; WideElts) {</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt; NarrowElts &amp;&amp; <span class="stringliteral">&quot;Unexpected shuffle mask&quot;</span>);</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;      NewMask[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt; (WideElts + NarrowElts) &amp;&amp; <span class="stringliteral">&quot;Unexpected shuffle mask&quot;</span>);</div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;      NewMask[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] - (WideElts - NarrowElts);</div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;    }</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;  }</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, <a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>, NewMask);</div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;}</div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160; </div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;<span class="comment">// Splatting the first element of the result of a BinOp, where any of the</span></div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;<span class="comment">// BinOp&#39;s operands are the result of a first element splat can be simplified to</span></div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;<span class="comment">// splatting the first element of the result of the BinOp</span></div>
<div class="line"><a name="l02719"></a><span class="lineno"><a class="line" href="classllvm_1_1InstCombinerImpl.html#ab18666f9305cc63df7009c9e4ec0e35a"> 2719</a></span>&#160;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1InstCombinerImpl.html#ab18666f9305cc63df7009c9e4ec0e35a">InstCombinerImpl::simplifyBinOpSplats</a>(<a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a> &amp;SVI) {</div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(SVI.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1), <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>()) ||</div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;      !<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(SVI.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>(), <a class="code" href="structllvm_1_1PatternMatch_1_1m__ZeroMask.html">m_ZeroMask</a>()))</div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160; </div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Op0 = SVI.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, *<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>;</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0, <a class="code" href="namespacellvm_1_1PatternMatch.html#a43ac4fbaaf63a88eb5ac05f6d3e5649c">m_BinOp</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#afd3e8a6706810fef8cdbaf1f9f40dfbd">m_Shuffle</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>(), <a class="code" href="structllvm_1_1PatternMatch_1_1m__ZeroMask.html">m_ZeroMask</a>()),</div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;                          <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>))) &amp;&amp;</div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;      !<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0, <a class="code" href="namespacellvm_1_1PatternMatch.html#a43ac4fbaaf63a88eb5ac05f6d3e5649c">m_BinOp</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>),</div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;                          <a class="code" href="namespacellvm_1_1PatternMatch.html#afd3e8a6706810fef8cdbaf1f9f40dfbd">m_Shuffle</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>), <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>(), <a class="code" href="structllvm_1_1PatternMatch_1_1m__ZeroMask.html">m_ZeroMask</a>()))))</div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>-&gt;getType() != <a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>-&gt;getType())</div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160; </div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;  <span class="keyword">auto</span> *BinOp = cast&lt;BinaryOperator&gt;(Op0);</div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#abe76d72cda6b2b4562c72accb510040b">isSafeToSpeculativelyExecute</a>(BinOp))</div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160; </div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewBO = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBinOp(BinOp-&gt;getOpcode(), <a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, <a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>);</div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> NewBOI = dyn_cast&lt;Instruction&gt;(NewBO))</div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;    NewBOI-&gt;copyIRFlags(BinOp);</div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160; </div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a>(NewBO, SVI.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>());</div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;}</div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160; </div>
<div class="line"><a name="l02745"></a><span class="lineno"><a class="line" href="classllvm_1_1InstCombinerImpl.html#ad31108b4f7156db7565eadba1285c93a"> 2745</a></span>&#160;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1InstCombinerImpl.html#ad31108b4f7156db7565eadba1285c93a">InstCombinerImpl::visitShuffleVectorInst</a>(<a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a> &amp;SVI) {</div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = SVI.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = SVI.<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1);</div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;  <a class="code" href="structllvm_1_1SimplifyQuery.html">SimplifyQuery</a> ShufQuery = SQ.<a class="code" href="structllvm_1_1SimplifyQuery.html#aaf05c1194f5c7869a00434c13c46c228">getWithInstruction</a>(&amp;SVI);</div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> *V = <a class="code" href="namespacellvm.html#a4e04471ed9ac60e70f5cf2d81f49b8c4">simplifyShuffleVectorInst</a>(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, SVI.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>(),</div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;                                          SVI.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a50fe6a61ea745fb71fa8403af6e7deed">getType</a>(), ShufQuery))</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;    <span class="keywordflow">return</span> replaceInstUsesWith(SVI, V);</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160; </div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = simplifyBinOpSplats(SVI))</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160; </div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;  <span class="keywordflow">if</span> (isa&lt;ScalableVectorType&gt;(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()))</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160; </div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;  <span class="keywordtype">unsigned</span> VWidth = cast&lt;FixedVectorType&gt;(SVI.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a50fe6a61ea745fb71fa8403af6e7deed">getType</a>())-&gt;getNumElements();</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;  <span class="keywordtype">unsigned</span> LHSWidth = cast&lt;FixedVectorType&gt;(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getNumElements();</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160; </div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;  <span class="comment">// shuffle (bitcast X), (bitcast Y), Mask --&gt; bitcast (shuffle X, Y, Mask)</span></div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;  <span class="comment">// if X and Y are of the same (vector) type, and the element size is not</span></div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;  <span class="comment">// changed by the bitcasts, we can distribute the bitcasts through the</span></div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;  <span class="comment">// shuffle, hopefully reducing the number of instructions. We make sure that</span></div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;  <span class="comment">// at least one bitcast only has one use, so we don&#39;t *increase* the number of</span></div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;  <span class="comment">// instructions here.</span></div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, *<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>;</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#ac0467ca7fad871738b10db95feb40dad">m_BitCast</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>))) &amp;&amp; <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#ac0467ca7fad871738b10db95feb40dad">m_BitCast</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>))) &amp;&amp;</div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;      <a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>-&gt;getType()-&gt;isVectorTy() &amp;&amp; <a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>-&gt;getType() == <a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>-&gt;getType() &amp;&amp;</div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;      <a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>-&gt;getType()-&gt;getScalarSizeInBits() ==</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;          SVI.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a50fe6a61ea745fb71fa8403af6e7deed">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() &amp;&amp;</div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;      (<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() || <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;<a class="code" href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())) {</div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShuffleVector(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, <a class="code" href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a>, SVI.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>(),</div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;                                           SVI.<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + <span class="stringliteral">&quot;.uncasted&quot;</span>);</div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a>(V, SVI.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a50fe6a61ea745fb71fa8403af6e7deed">getType</a>());</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;  }</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160; </div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;  <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a> = SVI.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>();</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *<a class="code" href="NVVMIntrRange_8cpp.html#abc8aecb5b627f6a91fc2fb09762d2a41">Int32Ty</a> = <a class="code" href="classllvm_1_1Type.html#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(SVI.<a class="code" href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160; </div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;  <span class="comment">// Peek through a bitcasted shuffle operand by scaling the mask. If the</span></div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;  <span class="comment">// simulated shuffle can simplify, then this shuffle is unnecessary:</span></div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;  <span class="comment">// shuf (bitcast X), undef, Mask --&gt; bitcast X&#39;</span></div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;  <span class="comment">// TODO: This could be extended to allow length-changing shuffles.</span></div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;  <span class="comment">//       The transform might also be obsoleted if we allowed canonicalization</span></div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;  <span class="comment">//       of bitcasted shuffles.</span></div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#ac0467ca7fad871738b10db95feb40dad">m_BitCast</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>))) &amp;&amp; <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>()) &amp;&amp;</div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;      <a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>-&gt;getType()-&gt;isVectorTy() &amp;&amp; VWidth == LHSWidth) {</div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;    <span class="comment">// Try to create a scaled mask constant.</span></div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;    <span class="keyword">auto</span> *XType = cast&lt;FixedVectorType&gt;(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>-&gt;getType());</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;    <span class="keywordtype">unsigned</span> XNumElts = XType-&gt;getNumElements();</div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int, 16&gt;</a> ScaledMask;</div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;    <span class="keywordflow">if</span> (XNumElts &gt;= VWidth) {</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(XNumElts % VWidth == 0 &amp;&amp; <span class="stringliteral">&quot;Unexpected vector bitcast&quot;</span>);</div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;      <a class="code" href="namespacellvm.html#aa91449ed55cd3c525a3438252573527a">narrowShuffleMaskElts</a>(XNumElts / VWidth, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, ScaledMask);</div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VWidth % XNumElts == 0 &amp;&amp; <span class="stringliteral">&quot;Unexpected vector bitcast&quot;</span>);</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#a4373d3025961c2c2eeca56b02d7d009d">widenShuffleMaskElts</a>(VWidth / XNumElts, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, ScaledMask))</div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;        ScaledMask.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;    }</div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;    <span class="keywordflow">if</span> (!ScaledMask.empty()) {</div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;      <span class="comment">// If the shuffled source vector simplifies, cast that value to this</span></div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;      <span class="comment">// shuffle&#39;s type.</span></div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *V = <a class="code" href="namespacellvm.html#a4e04471ed9ac60e70f5cf2d81f49b8c4">simplifyShuffleVectorInst</a>(<a class="code" href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a>, <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(XType),</div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;                                              ScaledMask, XType, ShufQuery))</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1CastInst.html#a643fe5a9e7042f032dae78109c2b1e72">BitCastInst::Create</a>(Instruction::BitCast, V, SVI.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a50fe6a61ea745fb71fa8403af6e7deed">getType</a>());</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;    }</div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;  }</div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160; </div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;  <span class="comment">// shuffle x, x, mask --&gt; shuffle x, undef, mask&#39;</span></div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> == <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) {</div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>()) &amp;&amp;</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;           <span class="stringliteral">&quot;Shuffle with 2 undef ops not simplified?&quot;</span>);</div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a>(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="namespacellvm.html#a2bea09503a438b76b5c9253327118af5">createUnaryMask</a>(<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>, LHSWidth));</div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;  }</div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160; </div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;  <span class="comment">// shuffle undef, x, mask --&gt; shuffle x, undef, mask&#39;</span></div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>())) {</div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;    SVI.<a class="code" href="classllvm_1_1ShuffleVectorInst.html#aa94c68d274d913e05b0423c7b2fded00">commute</a>();</div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;    <span class="keywordflow">return</span> &amp;SVI;</div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;  }</div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160; </div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="InstCombineVectorOps_8cpp.html#afcd925ff2a62d44f8e4591b0e10d9f83">canonicalizeInsertSplat</a>(SVI, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>))</div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160; </div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = foldSelectShuffle(SVI))</div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160; </div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="InstCombineVectorOps_8cpp.html#aeb9966cdc23a95b13381c5b7e8f4ba2c">foldTruncShuffle</a>(SVI, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.isBigEndian()))</div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160; </div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="InstCombineVectorOps_8cpp.html#a9f2944f05cd70d1dc4816c38c9242d77">narrowVectorSelect</a>(SVI, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>))</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160; </div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="InstCombineVectorOps_8cpp.html#a86a84b490f6c77c0000bcbe71cd6057d">foldShuffleOfUnaryOps</a>(SVI, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>))</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160; </div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="InstCombineVectorOps_8cpp.html#a78e5e60cd789444b846f046aa99c11c4">foldCastShuffle</a>(SVI, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>))</div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160; </div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;  <a class="code" href="classllvm_1_1APInt.html">APInt</a> UndefElts(VWidth, 0);</div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;  <a class="code" href="classllvm_1_1APInt.html">APInt</a> AllOnesEltMask(<a class="code" href="classllvm_1_1APInt.html#a071e8d814b2b30b02544fad964227b8e">APInt::getAllOnes</a>(VWidth));</div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V = SimplifyDemandedVectorElts(&amp;SVI, AllOnesEltMask, UndefElts)) {</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;    <span class="keywordflow">if</span> (V != &amp;SVI)</div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;      <span class="keywordflow">return</span> replaceInstUsesWith(SVI, V);</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;    <span class="keywordflow">return</span> &amp;SVI;</div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;  }</div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160; </div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="InstCombineVectorOps_8cpp.html#a444937e7243ef0e376687b403c4bfd1e">foldIdentityExtractShuffle</a>(SVI))</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160; </div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;  <span class="comment">// These transforms have the potential to lose undef knowledge, so they are</span></div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;  <span class="comment">// intentionally placed after SimplifyDemandedVectorElts().</span></div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="InstCombineVectorOps_8cpp.html#a0b4f3906851e4c43f596d9f8f40bcd94">foldShuffleWithInsert</a>(SVI, *<span class="keyword">this</span>))</div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="InstCombineVectorOps_8cpp.html#ab903583d9f02e20dad7ebac266b73214">foldIdentityPaddedShuffles</a>(SVI))</div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160; </div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>()) &amp;&amp; <a class="code" href="InstCombineVectorOps_8cpp.html#a95fd07ca61f35098e091aa2329f9c8a6">canEvaluateShuffled</a>(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>)) {</div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="InstCombineVectorOps_8cpp.html#a55e58d0b566ef26217958483795974e5">evaluateInDifferentElementOrder</a>(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>);</div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;    <span class="keywordflow">return</span> replaceInstUsesWith(SVI, V);</div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;  }</div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160; </div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;  <span class="comment">// SROA generates shuffle+bitcast when the extracted sub-vector is bitcast to</span></div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;  <span class="comment">// a non-vector type. We can instead bitcast the original vector followed by</span></div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;  <span class="comment">// an extract of the desired element:</span></div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;  <span class="comment">//   %sroa = shufflevector &lt;16 x i8&gt; %in, &lt;16 x i8&gt; undef,</span></div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;  <span class="comment">//                         &lt;4 x i32&gt; &lt;i32 0, i32 1, i32 2, i32 3&gt;</span></div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;  <span class="comment">//   %1 = bitcast &lt;4 x i8&gt; %sroa to i32</span></div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;  <span class="comment">// Becomes:</span></div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;  <span class="comment">//   %bc = bitcast &lt;16 x i8&gt; %in to &lt;4 x i32&gt;</span></div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;  <span class="comment">//   %ext = extractelement &lt;4 x i32&gt; %bc, i32 0</span></div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;  <span class="comment">// If the shuffle is extracting a contiguous range of values from the input</span></div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;  <span class="comment">// vector then each use which is a bitcast of the extracted size can be</span></div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;  <span class="comment">// replaced. This will work if the vector types are compatible, and the begin</span></div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;  <span class="comment">// index is aligned to a value in the casted vector type. If the begin index</span></div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;  <span class="comment">// isn&#39;t aligned then we can shuffle the original vector (keeping the same</span></div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;  <span class="comment">// vector type) before extracting.</span></div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;  <span class="comment">// This code will bail out if the target type is fundamentally incompatible</span></div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;  <span class="comment">// with vectors of the source type.</span></div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;  <span class="comment">// Example of &lt;16 x i8&gt;, target type i32:</span></div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;  <span class="comment">// Index range [4,8):         v-----------v Will work.</span></div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;  <span class="comment">//                +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</span></div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;  <span class="comment">//     &lt;16 x i8&gt;: |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |</span></div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;  <span class="comment">//     &lt;4 x i32&gt;: |           |           |           |           |</span></div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;  <span class="comment">//                +-----------+-----------+-----------+-----------+</span></div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;  <span class="comment">// Index range [6,10):              ^-----------^ Needs an extra shuffle.</span></div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;  <span class="comment">// Target type i40:           ^--------------^ Won&#39;t work, bail.</span></div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="InstCombineVectorOps_8cpp.html#ae8f4745a87bae0a614d6bda1cc55ab01">isShuffleExtractingFromLHS</a>(SVI, <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>)) {</div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>;</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;    <span class="keywordtype">unsigned</span> MaskElems = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.size();</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;    <span class="keyword">auto</span> *SrcTy = cast&lt;FixedVectorType&gt;(V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;    <span class="keywordtype">unsigned</span> VecBitWidth = SrcTy-&gt;getPrimitiveSizeInBits().getFixedValue();</div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;    <span class="keywordtype">unsigned</span> SrcElemBitWidth = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(SrcTy-&gt;getElementType());</div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SrcElemBitWidth &amp;&amp; <span class="stringliteral">&quot;vector elements must have a bitwidth&quot;</span>);</div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;    <span class="keywordtype">unsigned</span> SrcNumElems = SrcTy-&gt;getNumElements();</div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BitCastInst *, 8&gt;</a> BCs;</div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Type *, Value *&gt;</a> NewBCs;</div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1User.html">User</a> *U : SVI.<a class="code" href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">users</a>())</div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *BC = dyn_cast&lt;BitCastInst&gt;(U))</div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;        <span class="keywordflow">if</span> (!BC-&gt;use_empty())</div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;          <span class="comment">// Only visit bitcasts that weren&#39;t previously handled.</span></div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;          BCs.push_back(BC);</div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *BC : BCs) {</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;      <span class="keywordtype">unsigned</span> BegIdx = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>.front();</div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *TgtTy = BC-&gt;getDestTy();</div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;      <span class="keywordtype">unsigned</span> TgtElemBitWidth = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(TgtTy);</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;      <span class="keywordflow">if</span> (!TgtElemBitWidth)</div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;      <span class="keywordtype">unsigned</span> TgtNumElems = VecBitWidth / TgtElemBitWidth;</div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;      <span class="keywordtype">bool</span> VecBitWidthsEqual = VecBitWidth == TgtNumElems * TgtElemBitWidth;</div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;      <span class="keywordtype">bool</span> BegIsAligned = 0 == ((SrcElemBitWidth * BegIdx) % TgtElemBitWidth);</div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;      <span class="keywordflow">if</span> (!VecBitWidthsEqual)</div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="classllvm_1_1VectorType.html#a071e25c5c6eae5299b1cdc3350c6d55c">VectorType::isValidElementType</a>(TgtTy))</div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;      <span class="keyword">auto</span> *CastSrcTy = <a class="code" href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(TgtTy, TgtNumElems);</div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;      <span class="keywordflow">if</span> (!BegIsAligned) {</div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;        <span class="comment">// Shuffle the input so [0,NumElements) contains the output, and</span></div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;        <span class="comment">// [NumElems,SrcNumElems) is undef.</span></div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;        <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int, 16&gt;</a> ShuffleMask(SrcNumElems, -1);</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = MaskElems, Idx = BegIdx; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++Idx, ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;          ShuffleMask[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = Idx;</div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;        V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShuffleVector(V, ShuffleMask,</div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;                                        SVI.<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + <span class="stringliteral">&quot;.extract&quot;</span>);</div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;        BegIdx = 0;</div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;      }</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;      <span class="keywordtype">unsigned</span> SrcElemsPerTgtElem = TgtElemBitWidth / SrcElemBitWidth;</div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SrcElemsPerTgtElem);</div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;      BegIdx /= SrcElemsPerTgtElem;</div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;      <span class="keywordtype">bool</span> BCAlreadyExists = NewBCs.<a class="code" href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">find</a>(CastSrcTy) != NewBCs.<a class="code" href="classllvm_1_1DenseMapBase.html#a65520b9c67759099e313d0f4e7b5ff9e">end</a>();</div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;      <span class="keyword">auto</span> *NewBC =</div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;          BCAlreadyExists</div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;              ? NewBCs[CastSrcTy]</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;              : <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(V, CastSrcTy, SVI.<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + <span class="stringliteral">&quot;.bc&quot;</span>);</div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;      <span class="keywordflow">if</span> (!BCAlreadyExists)</div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;        NewBCs[CastSrcTy] = NewBC;</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateExtractElement(</div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;          NewBC, <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(<a class="code" href="NVVMIntrRange_8cpp.html#abc8aecb5b627f6a91fc2fb09762d2a41">Int32Ty</a>, BegIdx), SVI.<a class="code" href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + <span class="stringliteral">&quot;.extract&quot;</span>);</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;      <span class="comment">// The shufflevector isn&#39;t being replaced: the bitcast that used it</span></div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;      <span class="comment">// is. InstCombine will visit the newly-created instructions.</span></div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;      replaceInstUsesWith(*BC, <a class="code" href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">Ext</a>);</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;      MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;    }</div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;  }</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160; </div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;  <span class="comment">// If the LHS is a shufflevector itself, see if we can combine it with this</span></div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;  <span class="comment">// one without producing an unusual shuffle.</span></div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;  <span class="comment">// Cases that might be simplified:</span></div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;  <span class="comment">// 1.</span></div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;  <span class="comment">// x1=shuffle(v1,v2,mask1)</span></div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;  <span class="comment">//  x=shuffle(x1,undef,mask)</span></div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;  <span class="comment">//        ==&gt;</span></div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;  <span class="comment">//  x=shuffle(v1,undef,newMask)</span></div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;  <span class="comment">// newMask[i] = (mask[i] &lt; x1.size()) ? mask1[mask[i]] : -1</span></div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;  <span class="comment">// 2.</span></div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;  <span class="comment">// x1=shuffle(v1,undef,mask1)</span></div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;  <span class="comment">//  x=shuffle(x1,x2,mask)</span></div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;  <span class="comment">// where v1.size() == mask1.size()</span></div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;  <span class="comment">//        ==&gt;</span></div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;  <span class="comment">//  x=shuffle(v1,x2,newMask)</span></div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;  <span class="comment">// newMask[i] = (mask[i] &lt; x1.size()) ? mask1[mask[i]] : mask[i]</span></div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;  <span class="comment">// 3.</span></div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;  <span class="comment">// x2=shuffle(v2,undef,mask2)</span></div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;  <span class="comment">//  x=shuffle(x1,x2,mask)</span></div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;  <span class="comment">// where v2.size() == mask2.size()</span></div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;  <span class="comment">//        ==&gt;</span></div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;  <span class="comment">//  x=shuffle(x1,v2,newMask)</span></div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;  <span class="comment">// newMask[i] = (mask[i] &lt; x1.size())</span></div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;  <span class="comment">//              ? mask[i] : mask2[mask[i]-x1.size()]+x1.size()</span></div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;  <span class="comment">// 4.</span></div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;  <span class="comment">// x1=shuffle(v1,undef,mask1)</span></div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;  <span class="comment">// x2=shuffle(v2,undef,mask2)</span></div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;  <span class="comment">//  x=shuffle(x1,x2,mask)</span></div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;  <span class="comment">// where v1.size() == v2.size()</span></div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;  <span class="comment">//        ==&gt;</span></div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;  <span class="comment">//  x=shuffle(v1,v2,newMask)</span></div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;  <span class="comment">// newMask[i] = (mask[i] &lt; x1.size())</span></div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;  <span class="comment">//              ? mask1[mask[i]] : mask2[mask[i]-x1.size()]+v1.size()</span></div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;  <span class="comment">// Here we are really conservative:</span></div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;  <span class="comment">// we are absolutely afraid of producing a shuffle mask not in the input</span></div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;  <span class="comment">// program, because the code gen may not be smart enough to turn a merged</span></div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;  <span class="comment">// shuffle into two specific shuffles: it may produce worse code.  As such,</span></div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;  <span class="comment">// we only merge two shuffles if the result is either a splat or one of the</span></div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;  <span class="comment">// input shuffle masks.  In this case, merging the shuffles just removes</span></div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;  <span class="comment">// one instruction, which we know is safe.  This is good for things like</span></div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;  <span class="comment">// turning: (splat(splat)) -&gt; splat, or</span></div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;  <span class="comment">// merge(V[0..n], V[n+1..2n]) -&gt; V[0..2n]</span></div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;  <a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a>* LHSShuffle = dyn_cast&lt;ShuffleVectorInst&gt;(<a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>);</div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;  <a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a>* RHSShuffle = dyn_cast&lt;ShuffleVectorInst&gt;(<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;  <span class="keywordflow">if</span> (LHSShuffle)</div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(LHSShuffle-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1), <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>()) &amp;&amp; !<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>()))</div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;      LHSShuffle = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;  <span class="keywordflow">if</span> (RHSShuffle)</div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RHSShuffle-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1), <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>()))</div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;      RHSShuffle = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;  <span class="keywordflow">if</span> (!LHSShuffle &amp;&amp; !RHSShuffle)</div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;    <span class="keywordflow">return</span> MadeChange ? &amp;SVI : <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160; </div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a>* LHSOp0 = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a>* LHSOp1 = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a>* RHSOp0 = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;  <span class="keywordtype">unsigned</span> LHSOp0Width = 0;</div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;  <span class="keywordtype">unsigned</span> RHSOp0Width = 0;</div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;  <span class="keywordflow">if</span> (LHSShuffle) {</div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;    LHSOp0 = LHSShuffle-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;    LHSOp1 = LHSShuffle-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1);</div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;    LHSOp0Width = cast&lt;FixedVectorType&gt;(LHSOp0-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getNumElements();</div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;  }</div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;  <span class="keywordflow">if</span> (RHSShuffle) {</div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;    RHSOp0 = RHSShuffle-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;    RHSOp0Width = cast&lt;FixedVectorType&gt;(RHSOp0-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())-&gt;getNumElements();</div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;  }</div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a>* newLHS = <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>;</div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a>* newRHS = <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>;</div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;  <span class="keywordflow">if</span> (LHSShuffle) {</div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;    <span class="comment">// case 1</span></div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>())) {</div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;      newLHS = LHSOp0;</div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;      newRHS = LHSOp1;</div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;    }</div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;    <span class="comment">// case 2 or 4</span></div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (LHSOp0Width == LHSWidth) {</div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;      newLHS = LHSOp0;</div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;    }</div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;  }</div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;  <span class="comment">// case 3 or 4</span></div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;  <span class="keywordflow">if</span> (RHSShuffle &amp;&amp; RHSOp0Width == LHSWidth) {</div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;    newRHS = RHSOp0;</div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;  }</div>
<div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;  <span class="comment">// case 4</span></div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;  <span class="keywordflow">if</span> (LHSOp0 == RHSOp0) {</div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;    newLHS = LHSOp0;</div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;    newRHS = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;  }</div>
<div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160; </div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;  <span class="keywordflow">if</span> (newLHS == <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> &amp;&amp; newRHS == <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>)</div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;    <span class="keywordflow">return</span> MadeChange ? &amp;SVI : <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160; </div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;  <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> LHSMask;</div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;  <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;int&gt;</a> RHSMask;</div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;  <span class="keywordflow">if</span> (newLHS != <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>)</div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;    LHSMask = LHSShuffle-&gt;<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>();</div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;  <span class="keywordflow">if</span> (RHSShuffle &amp;&amp; newRHS != <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>)</div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;    RHSMask = RHSShuffle-&gt;<a class="code" href="classllvm_1_1ShuffleVectorInst.html#a6eaff12d0d3ead952f2a2a2781df56ac">getShuffleMask</a>();</div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160; </div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;  <span class="keywordtype">unsigned</span> newLHSWidth = (newLHS != <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>) ? LHSOp0Width : LHSWidth;</div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int, 16&gt;</a> newMask;</div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="LowerMatrixIntrinsics_8cpp.html#a6a2164e5aeea9c3e9a02eab3747efd8c">isSplat</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;  <span class="keywordtype">int</span> SplatElt = -1;</div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;  <span class="comment">// Create a new mask for the new ShuffleVectorInst so that the new</span></div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;  <span class="comment">// ShuffleVectorInst is equivalent to the original one.</span></div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; VWidth; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;    <span class="keywordtype">int</span> eltMask;</div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt; 0) {</div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;      <span class="comment">// This element is an undef value.</span></div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;      eltMask = -1;</div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt; (<span class="keywordtype">int</span>)LHSWidth) {</div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;      <span class="comment">// This element is from left hand side vector operand.</span></div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;      <span class="comment">// If LHS is going to be replaced (case 1, 2, or 4), calculate the</span></div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;      <span class="comment">// new mask value for the element.</span></div>
<div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;      <span class="keywordflow">if</span> (newLHS != <a class="code" href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>) {</div>
<div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;        eltMask = LHSMask[<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]];</div>
<div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;        <span class="comment">// If the value selected is an undef value, explicitly specify it</span></div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;        <span class="comment">// with a -1 mask value.</span></div>
<div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;        <span class="keywordflow">if</span> (eltMask &gt;= (<span class="keywordtype">int</span>)LHSOp0Width &amp;&amp; isa&lt;UndefValue&gt;(LHSOp1))</div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;          eltMask = -1;</div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;      } <span class="keywordflow">else</span></div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;        eltMask = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;      <span class="comment">// This element is from right hand side vector operand</span></div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;      <span class="comment">// If the value selected is an undef value, explicitly specify it</span></div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;      <span class="comment">// with a -1 mask value. (case 1)</span></div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>()))</div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;        eltMask = -1;</div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;      <span class="comment">// If RHS is going to be replaced (case 3 or 4), calculate the</span></div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;      <span class="comment">// new mask value for the element.</span></div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (newRHS != <a class="code" href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) {</div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;        eltMask = RHSMask[<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]-LHSWidth];</div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;        <span class="comment">// If the value selected is an undef value, explicitly specify it</span></div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;        <span class="comment">// with a -1 mask value.</span></div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;        <span class="keywordflow">if</span> (eltMask &gt;= (<span class="keywordtype">int</span>)RHSOp0Width) {</div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;          <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RHSShuffle-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1), <a class="code" href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">m_Undef</a>()) &amp;&amp;</div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;                 <span class="stringliteral">&quot;should have been check above&quot;</span>);</div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;          eltMask = -1;</div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;        }</div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;      } <span class="keywordflow">else</span></div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;        eltMask = <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>[<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]-LHSWidth;</div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160; </div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;      <span class="comment">// If LHS&#39;s width is changed, shift the mask value accordingly.</span></div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;      <span class="comment">// If newRHS == nullptr, i.e. LHSOp0 == RHSOp0, we want to remap any</span></div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;      <span class="comment">// references from RHSOp0 to LHSOp0, so we don&#39;t need to shift the mask.</span></div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;      <span class="comment">// If newRHS == newLHS, we want to remap any references from newRHS to</span></div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;      <span class="comment">// newLHS so that we can properly identify splats that may occur due to</span></div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;      <span class="comment">// obfuscation across the two vectors.</span></div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;      <span class="keywordflow">if</span> (eltMask &gt;= 0 &amp;&amp; newRHS != <span class="keyword">nullptr</span> &amp;&amp; newLHS != newRHS)</div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;        eltMask += newLHSWidth;</div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;    }</div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160; </div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;    <span class="comment">// Check if this could still be a splat.</span></div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;    <span class="keywordflow">if</span> (eltMask &gt;= 0) {</div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;      <span class="keywordflow">if</span> (SplatElt &gt;= 0 &amp;&amp; SplatElt != eltMask)</div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;        <a class="code" href="LowerMatrixIntrinsics_8cpp.html#a6a2164e5aeea9c3e9a02eab3747efd8c">isSplat</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;      SplatElt = eltMask;</div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;    }</div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160; </div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;    newMask.push_back(eltMask);</div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;  }</div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160; </div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;  <span class="comment">// If the result mask is equal to one of the original shuffle masks,</span></div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;  <span class="comment">// or is a splat, do the replacement.</span></div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="LowerMatrixIntrinsics_8cpp.html#a6a2164e5aeea9c3e9a02eab3747efd8c">isSplat</a> || newMask == LHSMask || newMask == RHSMask || newMask == <a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a>) {</div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;    <span class="keywordflow">if</span> (!newRHS)</div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;      newRHS = <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(newLHS-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1ShuffleVectorInst.html">ShuffleVectorInst</a>(newLHS, newRHS, newMask);</div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;  }</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160; </div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;  <span class="keywordflow">return</span> MadeChange ? &amp;SVI : <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="alib_2Target_2README_8txt_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2README_8txt_source.html#l00029">README.txt:29</a></div></div>
<div class="ttc" id="anamespacellvm_html_abdf4b5f9e1dc6887cac393ee643c10b6"><div class="ttname"><a href="namespacellvm.html#abdf4b5f9e1dc6887cac393ee643c10b6">llvm::simplifyInsertElementInst</a></div><div class="ttdeci">Value * simplifyInsertElementInst(Value *Vec, Value *Elt, Value *Idx, const SimplifyQuery &amp;Q)</div><div class="ttdoc">Given operands for an InsertElement, fold the result or return null.</div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8cpp_source.html#l04916">InstructionSimplify.cpp:4916</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a5e9e1c0dd93557be1b4ad72860f3cbdaa2989d3024a84b4dda9d77419b1648554"><div class="ttname"><a href="classllvm_1_1Type.html#a5e9e1c0dd93557be1b4ad72860f3cbdaa2989d3024a84b4dda9d77419b1648554">llvm::Type::ArrayTyID</a></div><div class="ttdeci">@ ArrayTyID</div><div class="ttdoc">Arrays.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00075">Type.h:75</a></div></div>
<div class="ttc" id="aNVVMIntrRange_8cpp_html_abc8aecb5b627f6a91fc2fb09762d2a41"><div class="ttname"><a href="NVVMIntrRange_8cpp.html#abc8aecb5b627f6a91fc2fb09762d2a41">Int32Ty</a></div><div class="ttdeci">IntegerType * Int32Ty</div><div class="ttdef"><b>Definition:</b> <a href="NVVMIntrRange_8cpp_source.html#l00067">NVVMIntrRange.cpp:67</a></div></div>
<div class="ttc" id="astructBinopElts_html_a0b1dcc01090bf24bebc2584f6a17b0d8"><div class="ttname"><a href="structBinopElts.html#a0b1dcc01090bf24bebc2584f6a17b0d8">BinopElts::Opcode</a></div><div class="ttdeci">BinaryOperator::BinaryOps Opcode</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l02021">InstCombineVectorOps.cpp:2021</a></div></div>
<div class="ttc" id="aclassllvm_1_1GetElementPtrInst_html_a837e9f272fd070a5f8fc79c07a951106"><div class="ttname"><a href="classllvm_1_1GetElementPtrInst.html#a837e9f272fd070a5f8fc79c07a951106">llvm::GetElementPtrInst::setIsInBounds</a></div><div class="ttdeci">void setIsInBounds(bool b=true)</div><div class="ttdoc">Set or clear the inbounds flag on this GEP instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l01938">Instructions.cpp:1938</a></div></div>
<div class="ttc" id="aclassllvm_1_1ShuffleVectorInst_html_a64a379276cb10c6cc61146d8a95cd1a7"><div class="ttname"><a href="classllvm_1_1ShuffleVectorInst.html#a64a379276cb10c6cc61146d8a95cd1a7">llvm::ShuffleVectorInst::isIdentityWithExtract</a></div><div class="ttdeci">bool isIdentityWithExtract() const</div><div class="ttdoc">Return true if this shuffle extracts the first N elements of exactly one source vector.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l02563">Instructions.cpp:2563</a></div></div>
<div class="ttc" id="anamespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">This is an optimization pass for GlobalISel generic memory operations.</div><div class="ttdef"><b>Definition:</b> <a href="AddressRanges_8h_source.html#l00018">AddressRanges.h:18</a></div></div>
<div class="ttc" id="aclassllvm_1_1ShuffleVectorInst_html_a4bc8953b0fd0277b0e5a8e5b78025150"><div class="ttname"><a href="classllvm_1_1ShuffleVectorInst.html#a4bc8953b0fd0277b0e5a8e5b78025150">llvm::ShuffleVectorInst::isIdentityMask</a></div><div class="ttdeci">static bool isIdentityMask(ArrayRef&lt; int &gt; Mask)</div><div class="ttdoc">Return true if this shuffle mask chooses elements from exactly one source vector without lane crossin...</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l02320">Instructions.cpp:2320</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a4ba3a5be6c0e9b9e8a525de055836733"><div class="ttname"><a href="classllvm_1_1Instruction.html#a4ba3a5be6c0e9b9e8a525de055836733">llvm::Instruction::getModule</a></div><div class="ttdeci">const Module * getModule() const</div><div class="ttdoc">Return the module owning the function this instruction belongs to or nullptr it the function does not...</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00070">Instruction.cpp:70</a></div></div>
<div class="ttc" id="anamespacellvm_html_aedbf3998b4ff72347a45cb4169d120db"><div class="ttname"><a href="namespacellvm.html#aedbf3998b4ff72347a45cb4169d120db">llvm::MaskedValueIsZero</a></div><div class="ttdeci">bool MaskedValueIsZero(const Value *V, const APInt &amp;Mask, const DataLayout &amp;DL, unsigned Depth=0, AssumptionCache *AC=nullptr, const Instruction *CxtI=nullptr, const DominatorTree *DT=nullptr, bool UseInstrInfo=true)</div><div class="ttdoc">Return true if 'V &amp; Mask' is known to be zero.</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l00364">ValueTracking.cpp:364</a></div></div>
<div class="ttc" id="astructllvm_1_1PatternMatch_1_1m__Mask_html"><div class="ttname"><a href="structllvm_1_1PatternMatch_1_1m__Mask.html">llvm::PatternMatch::m_Mask</a></div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01514">PatternMatch.h:1514</a></div></div>
<div class="ttc" id="aclassllvm_1_1DataLayout_html"><div class="ttname"><a href="classllvm_1_1DataLayout.html">llvm::DataLayout</a></div><div class="ttdoc">A parsed version of the target data layout string in and methods for querying it.</div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00110">DataLayout.h:110</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a3a402430a1bbe70a9282dcb0e0b6a2cd"><div class="ttname"><a href="classllvm_1_1Value.html#a3a402430a1bbe70a9282dcb0e0b6a2cd">llvm::Value::hasOneUse</a></div><div class="ttdeci">bool hasOneUse() const</div><div class="ttdoc">Return true if there is exactly one use of this value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00434">Value.h:434</a></div></div>
<div class="ttc" id="aInstCombiner_8h_html"><div class="ttname"><a href="InstCombiner_8h.html">InstCombiner.h</a></div></div>
<div class="ttc" id="aREADME__P9_8txt_html_aa793083a95c48c23abfa352d4335685a"><div class="ttname"><a href="README__P9_8txt.html#aa793083a95c48c23abfa352d4335685a">Insert</a></div><div class="ttdeci">Vector Rotate Left Mask Mask Insert</div><div class="ttdef"><b>Definition:</b> <a href="README__P9_8txt_source.html#l00112">README_P9.txt:112</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a2be3583dac92a031fa1458d4d992c78b"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a2be3583dac92a031fa1458d4d992c78b">llvm::CmpInst::Predicate</a></div><div class="ttdeci">Predicate</div><div class="ttdoc">This enumeration lists the possible predicates for CmpInst subclasses.</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00718">InstrTypes.h:718</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a98c0a84a5dfa8bce341c829709f171e5"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">llvm::BasicBlock::iterator</a></div><div class="ttdeci">InstListType::iterator iterator</div><div class="ttdoc">Instruction iterators...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00087">BasicBlock.h:87</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_afe3ce7fc89f36474eb0369cbb792c05a"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#afe3ce7fc89f36474eb0369cbb792c05a">llvm::ConstantInt::getType</a></div><div class="ttdeci">IntegerType * getType() const</div><div class="ttdoc">getType - Specialize the getType() method to always return an IntegerType, which reduces the amount o...</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00172">Constants.h:172</a></div></div>
<div class="ttc" id="aAMDGPURewriteUndefForPHI_8cpp_html_a2e83cb1bc3f5e8986cbd14575755a134"><div class="ttname"><a href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a></div><div class="ttdeci">Rewrite undef for PHI</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPURewriteUndefForPHI_8cpp_source.html#l00101">AMDGPURewriteUndefForPHI.cpp:101</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a38bee869ad41aebfef3de2641b12004c"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a38bee869ad41aebfef3de2641b12004c">llvm::BasicBlock::getParent</a></div><div class="ttdeci">const Function * getParent() const</div><div class="ttdoc">Return the enclosing method, or null if none.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00112">BasicBlock.h:112</a></div></div>
<div class="ttc" id="astructllvm_1_1SimplifyQuery_html"><div class="ttname"><a href="structllvm_1_1SimplifyQuery.html">llvm::SimplifyQuery</a></div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8h_source.html#l00093">InstructionSimplify.h:93</a></div></div>
<div class="ttc" id="aclassllvm_1_1ShuffleVectorInst_html_a6eaff12d0d3ead952f2a2a2781df56ac"><div class="ttname"><a href="classllvm_1_1ShuffleVectorInst.html#a6eaff12d0d3ead952f2a2a2781df56ac">llvm::ShuffleVectorInst::getShuffleMask</a></div><div class="ttdeci">static void getShuffleMask(const Constant *Mask, SmallVectorImpl&lt; int &gt; &amp;Result)</div><div class="ttdoc">Convert the input shuffle mask operand to a vector of integers.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l02225">Instructions.cpp:2225</a></div></div>
<div class="ttc" id="aclassllvm_1_1ElementCount_html"><div class="ttname"><a href="classllvm_1_1ElementCount.html">llvm::ElementCount</a></div><div class="ttdef"><b>Definition:</b> <a href="TypeSize_8h_source.html#l00279">TypeSize.h:279</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_abdea7254f33e7e14fa824284e56319c3"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#abdea7254f33e7e14fa824284e56319c3">foldInsSequenceIntoSplat</a></div><div class="ttdeci">static Instruction * foldInsSequenceIntoSplat(InsertElementInst &amp;InsElt)</div><div class="ttdoc">Turn a chain of inserts that splats a value into an insert + shuffle: insertelt(insertelt(insertelt(i...</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l01196">InstCombineVectorOps.cpp:1196</a></div></div>
<div class="ttc" id="aclassllvm_1_1ExtractElementInst_html"><div class="ttname"><a href="classllvm_1_1ExtractElementInst.html">llvm::ExtractElementInst</a></div><div class="ttdoc">This instruction extracts a single (scalar) element from a VectorType value.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01881">Instructions.h:1881</a></div></div>
<div class="ttc" id="aclassllvm_1_1Function_html"><div class="ttname"><a href="classllvm_1_1Function.html">llvm::Function</a></div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00059">Function.h:59</a></div></div>
<div class="ttc" id="aclassllvm_1_1BinaryOperator_html_a16799e07e39d599e81926d1a69301fab"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html#a16799e07e39d599e81926d1a69301fab">llvm::BinaryOperator::CreateWithCopiedFlags</a></div><div class="ttdeci">static BinaryOperator * CreateWithCopiedFlags(BinaryOps Opc, Value *V1, Value *V2, Instruction *CopyO, const Twine &amp;Name=&quot;&quot;, Instruction *InsertBefore=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00248">InstrTypes.h:248</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_aa08fee11e8a5ec10c0cc2a7abbbd799a"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#aa08fee11e8a5ec10c0cc2a7abbbd799a">llvm::PatternMatch::m_LShr</a></div><div class="ttdeci">BinaryOp_match&lt; LHS, RHS, Instruction::LShr &gt; m_LShr(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01117">PatternMatch.h:1117</a></div></div>
<div class="ttc" id="aclassllvm_1_1details_1_1FixedOrScalableQuantity_html_a9188f84e1dd67530330dcab9cae787d7"><div class="ttname"><a href="classllvm_1_1details_1_1FixedOrScalableQuantity.html#a9188f84e1dd67530330dcab9cae787d7">llvm::details::FixedOrScalableQuantity::isScalable</a></div><div class="ttdeci">constexpr bool isScalable() const</div><div class="ttdoc">Returns whether the quantity is scaled by a runtime quantity (vscale).</div><div class="ttdef"><b>Definition:</b> <a href="TypeSize_8h_source.html#l00166">TypeSize.h:166</a></div></div>
<div class="ttc" id="aclassllvm_1_1BitCastInst_html"><div class="ttname"><a href="classllvm_1_1BitCastInst.html">llvm::BitCastInst</a></div><div class="ttdoc">This class represents a no-op cast from one type to another.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l05258">Instructions.h:5258</a></div></div>
<div class="ttc" id="alib_2Target_2README_8txt_html_a2a2df5a25b9c703e74e82b48a75d0c3d"><div class="ttname"><a href="lib_2Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a></div><div class="ttdeci">instcombine should handle this C2 when C1</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2README_8txt_source.html#l00263">README.txt:263</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a4abb39a66573f61fda80469faa5d861d"><div class="ttname"><a href="classllvm_1_1Type.html#a4abb39a66573f61fda80469faa5d861d">llvm::Type::getScalarType</a></div><div class="ttdeci">Type * getScalarType() const</div><div class="ttdoc">If this is a vector type, return the element type, otherwise return 'this'.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00341">Type.h:341</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a9cae528bdb66086aa6c06da36fc6fa24"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a9cae528bdb66086aa6c06da36fc6fa24">llvm::PatternMatch::m_InsertElt</a></div><div class="ttdeci">ThreeOps_match&lt; Val_t, Elt_t, Idx_t, Instruction::InsertElement &gt; m_InsertElt(const Val_t &amp;Val, const Elt_t &amp;Elt, const Idx_t &amp;Idx)</div><div class="ttdoc">Matches InsertElementInst.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01484">PatternMatch.h:1484</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_a4b001d9b458035fbbfc154d52d354ee9"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a4b001d9b458035fbbfc154d52d354ee9">llvm::ConstantInt::getValue</a></div><div class="ttdeci">const APInt &amp; getValue() const</div><div class="ttdoc">Return the constant as an APInt value reference.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00132">Constants.h:132</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector</a></div><div class="ttdoc">This is a 'vector' (really, a variable-sized array), optimized for the case when the array is small.</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l01199">SmallVector.h:1199</a></div></div>
<div class="ttc" id="aStatistic_8h_html"><div class="ttname"><a href="Statistic_8h.html">Statistic.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7b2175e18ff52174fad26b6b68818564"><div class="ttname"><a href="namespacellvm.html#a7b2175e18ff52174fad26b6b68818564">llvm::enumerate</a></div><div class="ttdeci">detail::enumerator&lt; R &gt; enumerate(R &amp;&amp;TheRange)</div><div class="ttdoc">Given an input range, returns a new range whose values are are pair (A,B) such that A is the 0-based ...</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l02264">STLExtras.h:2264</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a78cd22f497c1e81c4d8a5e9073ef5a24"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a78cd22f497c1e81c4d8a5e9073ef5a24">llvm::PatternMatch::m_Load</a></div><div class="ttdeci">OneOps_match&lt; OpTy, Instruction::Load &gt; m_Load(const OpTy &amp;Op)</div><div class="ttdoc">Matches LoadInst.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01563">PatternMatch.h:1563</a></div></div>
<div class="ttc" id="aSupport_2ErrorHandling_8h_html"><div class="ttname"><a href="Support_2ErrorHandling_8h.html">ErrorHandling.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_af4feec45578e32fe65d8efc59112bc8e"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#af4feec45578e32fe65d8efc59112bc8e">llvm::PatternMatch::m_CombineOr</a></div><div class="ttdeci">match_combine_or&lt; LTy, RTy &gt; m_CombineOr(const LTy &amp;L, const RTy &amp;R)</div><div class="ttdoc">Combine two pattern matchers matching L || R.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00218">PatternMatch.h:218</a></div></div>
<div class="ttc" id="aclassllvm_1_1IRBuilder_html"><div class="ttname"><a href="classllvm_1_1IRBuilder.html">llvm::IRBuilder&lt; TargetFolder, IRBuilderCallbackInserter &gt;</a></div></div>
<div class="ttc" id="aclassllvm_1_1CastInst_html_a643fe5a9e7042f032dae78109c2b1e72"><div class="ttname"><a href="classllvm_1_1CastInst.html#a643fe5a9e7042f032dae78109c2b1e72">llvm::CastInst::Create</a></div><div class="ttdeci">static CastInst * Create(Instruction::CastOps, Value *S, Type *Ty, const Twine &amp;Name=&quot;&quot;, Instruction *InsertBefore=nullptr)</div><div class="ttdoc">Provides a way to construct any of the CastInst subclasses using an opcode instead of the subclass's ...</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l03354">Instructions.cpp:3354</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a2ed912a28808268e35bd58e8f11251aa"><div class="ttname"><a href="classllvm_1_1APInt.html#a2ed912a28808268e35bd58e8f11251aa">llvm::APInt::zextOrTrunc</a></div><div class="ttdeci">APInt zextOrTrunc(unsigned width) const</div><div class="ttdoc">Zero extend or truncate to width.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8cpp_source.html#l00994">APInt.cpp:994</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallDenseMap_html"><div class="ttname"><a href="classllvm_1_1SmallDenseMap.html">llvm::SmallDenseMap</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00880">DenseMap.h:880</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_a4f825637c0198827411f5f11aa3f2deb"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#a4f825637c0198827411f5f11aa3f2deb">narrowInsElt</a></div><div class="ttdeci">static Instruction * narrowInsElt(InsertElementInst &amp;InsElt, InstCombiner::BuilderTy &amp;Builder)</div><div class="ttdoc">If both the base vector and the inserted element are extended from the same type, do the insert eleme...</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l01492">InstCombineVectorOps.cpp:1492</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_ac7b0ed5c6d30bad74769c6e87ab0edb8"><div class="ttname"><a href="classllvm_1_1Type.html#ac7b0ed5c6d30bad74769c6e87ab0edb8">llvm::Type::getTypeID</a></div><div class="ttdeci">TypeID getTypeID() const</div><div class="ttdoc">Return the type id for the type.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00137">Type.h:137</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_a48d2595fd80a27962cdfe718529e1302"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#a48d2595fd80a27962cdfe718529e1302">foldSelectShuffleOfSelectShuffle</a></div><div class="ttdeci">static Instruction * foldSelectShuffleOfSelectShuffle(ShuffleVectorInst &amp;Shuf)</div><div class="ttdoc">A select shuffle of a select shuffle with a shared operand can be reduced to a single select shuffle.</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l02068">InstCombineVectorOps.cpp:2068</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_a31e8da5adf63afd38b4ab94bca823150"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a31e8da5adf63afd38b4ab94bca823150">llvm::ConstantInt::getLimitedValue</a></div><div class="ttdeci">uint64_t getLimitedValue(uint64_t Limit=~0ULL) const</div><div class="ttdoc">getLimitedValue - If the value is smaller than the specified limit, return it, otherwise return the l...</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00243">Constants.h:243</a></div></div>
<div class="ttc" id="aAPInt_8h_html"><div class="ttname"><a href="APInt_8h.html">APInt.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1InsertElementInst_html_a44cefc7b60337e7e14d20e843c74e534"><div class="ttname"><a href="classllvm_1_1InsertElementInst.html#a44cefc7b60337e7e14d20e843c74e534">llvm::InsertElementInst::Create</a></div><div class="ttdeci">static InsertElementInst * Create(Value *Vec, Value *NewElt, Value *Idx, const Twine &amp;NameStr=&quot;&quot;, Instruction *InsertBefore=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01959">Instructions.h:1959</a></div></div>
<div class="ttc" id="anamespacellvm_html_a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639"><div class="ttname"><a href="namespacellvm.html#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">llvm::Depth</a></div><div class="ttdeci">@ Depth</div><div class="ttdef"><b>Definition:</b> <a href="SIMachineScheduler_8h_source.html#l00036">SIMachineScheduler.h:36</a></div></div>
<div class="ttc" id="aclassllvm_1_1ExtractElementInst_html_a5d496a334eff64bb2873339b54df932a"><div class="ttname"><a href="classllvm_1_1ExtractElementInst.html#a5d496a334eff64bb2873339b54df932a">llvm::ExtractElementInst::Create</a></div><div class="ttdeci">static ExtractElementInst * Create(Value *Vec, Value *Idx, const Twine &amp;NameStr=&quot;&quot;, Instruction *InsertBefore=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01894">Instructions.h:1894</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_a01237a54c1c791145d5e5ea0d5dcd632"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#a01237a54c1c791145d5e5ea0d5dcd632">buildNew</a></div><div class="ttdeci">static Value * buildNew(Instruction *I, ArrayRef&lt; Value * &gt; NewOps)</div><div class="ttdoc">Rebuild a new instruction just like 'I' but with the new operands given.</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l01823">InstCombineVectorOps.cpp:1823</a></div></div>
<div class="ttc" id="anamespacellvm_html_aa91449ed55cd3c525a3438252573527a"><div class="ttname"><a href="namespacellvm.html#aa91449ed55cd3c525a3438252573527a">llvm::narrowShuffleMaskElts</a></div><div class="ttdeci">void narrowShuffleMaskElts(int Scale, ArrayRef&lt; int &gt; Mask, SmallVectorImpl&lt; int &gt; &amp;ScaledMask)</div><div class="ttdoc">Replace each shuffle mask index with the scaled sequential indices for an equivalent mask of narrowed...</div><div class="ttdef"><b>Definition:</b> <a href="VectorUtils_8cpp_source.html#l00469">VectorUtils.cpp:469</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html"><div class="ttname"><a href="classllvm_1_1Type.html">llvm::Type</a></div><div class="ttdoc">The instances of the Type class are immutable: once they are created, they are never changed.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00045">Type.h:45</a></div></div>
<div class="ttc" id="aDenseMap_8h_html"><div class="ttname"><a href="DenseMap_8h.html">DenseMap.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ARMII_html_a7d414894ef8cdc39b147eb7e0d7e4305a479711d0ab662307550fc709665589ea"><div class="ttname"><a href="namespacellvm_1_1ARMII.html#a7d414894ef8cdc39b147eb7e0d7e4305a479711d0ab662307550fc709665589ea">llvm::ARMII::VecSize</a></div><div class="ttdeci">@ VecSize</div><div class="ttdef"><b>Definition:</b> <a href="MCTargetDesc_2ARMBaseInfo_8h_source.html#l00421">ARMBaseInfo.h:421</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_ac5984d6827f6e6922bed00bf03ba9552"><div class="ttname"><a href="classllvm_1_1Instruction.html#ac5984d6827f6e6922bed00bf03ba9552">llvm::Instruction::isShift</a></div><div class="ttdeci">bool isShift() const</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00175">Instruction.h:175</a></div></div>
<div class="ttc" id="anamespacellvm_1_1sys_1_1path_html_a00a76a729b319dc47beffbe07325565f"><div class="ttname"><a href="namespacellvm_1_1sys_1_1path.html#a00a76a729b319dc47beffbe07325565f">llvm::sys::path::begin</a></div><div class="ttdeci">const_iterator begin(StringRef path, Style style=Style::native)</div><div class="ttdoc">Get begin iterator over path.</div><div class="ttdef"><b>Definition:</b> <a href="Path_8cpp_source.html#l00226">Path.cpp:226</a></div></div>
<div class="ttc" id="aclassllvm_1_1InstCombinerImpl_html_a71ef354bd1ea9e02d70146d7218a7d39"><div class="ttname"><a href="classllvm_1_1InstCombinerImpl.html#a71ef354bd1ea9e02d70146d7218a7d39">llvm::InstCombinerImpl::visitExtractElementInst</a></div><div class="ttdeci">Instruction * visitExtractElementInst(ExtractElementInst &amp;EI)</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l00395">InstCombineVectorOps.cpp:395</a></div></div>
<div class="ttc" id="anamespacellvm_html_a2bea09503a438b76b5c9253327118af5"><div class="ttname"><a href="namespacellvm.html#a2bea09503a438b76b5c9253327118af5">llvm::createUnaryMask</a></div><div class="ttdeci">llvm::SmallVector&lt; int, 16 &gt; createUnaryMask(ArrayRef&lt; int &gt; Mask, unsigned NumElts)</div><div class="ttdoc">Given a shuffle mask for a binary shuffle, create the equivalent shuffle mask assuming both operands ...</div><div class="ttdef"><b>Definition:</b> <a href="VectorUtils_8cpp_source.html#l00996">VectorUtils.cpp:996</a></div></div>
<div class="ttc" id="anamespacellvm_html_a94b67449bc2ce740bcec33d149769fe0"><div class="ttname"><a href="namespacellvm.html#a94b67449bc2ce740bcec33d149769fe0">llvm::simplifyInsertValueInst</a></div><div class="ttdeci">Value * simplifyInsertValueInst(Value *Agg, Value *Val, ArrayRef&lt; unsigned &gt; Idxs, const SimplifyQuery &amp;Q)</div><div class="ttdoc">Given operands for an InsertValueInst, fold the result or return null.</div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8cpp_source.html#l04910">InstructionSimplify.cpp:4910</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_ace7029cdad3163ebfb8172d25e8a59e3"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#ace7029cdad3163ebfb8172d25e8a59e3">isShuffleEquivalentToSelect</a></div><div class="ttdeci">static bool isShuffleEquivalentToSelect(ShuffleVectorInst &amp;Shuf)</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l01168">InstCombineVectorOps.cpp:1168</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a43ac4fbaaf63a88eb5ac05f6d3e5649c"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a43ac4fbaaf63a88eb5ac05f6d3e5649c">llvm::PatternMatch::m_BinOp</a></div><div class="ttdeci">class_match&lt; BinaryOperator &gt; m_BinOp()</div><div class="ttdoc">Match an arbitrary binary operation and ignore it.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00084">PatternMatch.h:84</a></div></div>
<div class="ttc" id="aclassllvm_1_1InstCombinerImpl_html_ad31108b4f7156db7565eadba1285c93a"><div class="ttname"><a href="classllvm_1_1InstCombinerImpl.html#ad31108b4f7156db7565eadba1285c93a">llvm::InstCombinerImpl::visitShuffleVectorInst</a></div><div class="ttdeci">Instruction * visitShuffleVectorInst(ShuffleVectorInst &amp;SVI)</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l02745">InstCombineVectorOps.cpp:2745</a></div></div>
<div class="ttc" id="aOperator_8h_html"><div class="ttname"><a href="Operator_8h.html">Operator.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1VectorType_html_a12e23c3d619db313388fe11dc76eb23f"><div class="ttname"><a href="classllvm_1_1VectorType.html#a12e23c3d619db313388fe11dc76eb23f">llvm::VectorType::getElementType</a></div><div class="ttdeci">Type * getElementType() const</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00422">DerivedTypes.h:422</a></div></div>
<div class="ttc" id="aAMDGPURegBankSelect_8cpp_html_a14e0c000ed52e5fc187d4a885914cc1a"><div class="ttname"><a href="AMDGPURegBankSelect_8cpp.html#a14e0c000ed52e5fc187d4a885914cc1a">Select</a></div><div class="ttdeci">amdgpu AMDGPU Register Bank Select</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPURegBankSelect_8cpp_source.html#l00045">AMDGPURegBankSelect.cpp:45</a></div></div>
<div class="ttc" id="aSTLExtras_8h_html"><div class="ttname"><a href="STLExtras_8h.html">STLExtras.h</a></div></div>
<div class="ttc" id="aX86PartialReduction_8cpp_html_a87b8bfbbe9d8f7146d7f20a5fb42efd0"><div class="ttname"><a href="X86PartialReduction_8cpp.html#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a></div><div class="ttdeci">Value * RHS</div><div class="ttdef"><b>Definition:</b> <a href="X86PartialReduction_8cpp_source.html#l00076">X86PartialReduction.cpp:76</a></div></div>
<div class="ttc" id="anamespacellvm_html_a6dec2b5d3e04b47adf4d918d678e81c9"><div class="ttname"><a href="namespacellvm.html#a6dec2b5d3e04b47adf4d918d678e81c9">llvm::isPowerOf2_32</a></div><div class="ttdeci">constexpr bool isPowerOf2_32(uint32_t Value)</div><div class="ttdoc">Return true if the argument is a power of two &gt; 0.</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00292">MathExtras.h:292</a></div></div>
<div class="ttc" id="aclassllvm_1_1UnaryOperator_html"><div class="ttname"><a href="classllvm_1_1UnaryOperator.html">llvm::UnaryOperator</a></div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00100">InstrTypes.h:100</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_ac0467ca7fad871738b10db95feb40dad"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#ac0467ca7fad871738b10db95feb40dad">llvm::PatternMatch::m_BitCast</a></div><div class="ttdeci">CastClass_match&lt; OpTy, Instruction::BitCast &gt; m_BitCast(const OpTy &amp;Op)</div><div class="ttdoc">Matches BitCast.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01593">PatternMatch.h:1593</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_aac5759c83abd6a4af236401a7cfe7a0f"><div class="ttname"><a href="classllvm_1_1Type.html#aac5759c83abd6a4af236401a7cfe7a0f">llvm::Type::isFloatingPointTy</a></div><div class="ttdeci">bool isFloatingPointTy() const</div><div class="ttdoc">Return true if this is one of the floating-point types.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00185">Type.h:185</a></div></div>
<div class="ttc" id="anamespacellvm_html_ac214df91cdc242f4710ea5a93939c678"><div class="ttname"><a href="namespacellvm.html#ac214df91cdc242f4710ea5a93939c678">llvm::count_if</a></div><div class="ttdeci">auto count_if(R &amp;&amp;Range, UnaryPredicate P)</div><div class="ttdoc">Wrapper function around std::count_if to count the number of times an element satisfying a given pred...</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01903">STLExtras.h:1903</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_a86a84b490f6c77c0000bcbe71cd6057d"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#a86a84b490f6c77c0000bcbe71cd6057d">foldShuffleOfUnaryOps</a></div><div class="ttdeci">static Instruction * foldShuffleOfUnaryOps(ShuffleVectorInst &amp;Shuf, InstCombiner::BuilderTy &amp;Builder)</div><div class="ttdoc">Canonicalize FP negate/abs after shuffle.</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l02416">InstCombineVectorOps.cpp:2416</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a30dd396c5b40cd86c1591872e574ccdf"><div class="ttname"><a href="classllvm_1_1Type.html#a30dd396c5b40cd86c1591872e574ccdf">llvm::Type::getInt32Ty</a></div><div class="ttdeci">static IntegerType * getInt32Ty(LLVMContext &amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00241">Type.cpp:241</a></div></div>
<div class="ttc" id="anamespacellvm_1_1NVPTX_1_1PTXLdStInstCode_html_a91119cbee2be000c528a690252aee07c"><div class="ttname"><a href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07c">llvm::NVPTX::PTXLdStInstCode::VecType</a></div><div class="ttdeci">VecType</div><div class="ttdef"><b>Definition:</b> <a href="NVPTX_8h_source.html#l00122">NVPTX.h:122</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html"><div class="ttname"><a href="classllvm_1_1BasicBlock.html">llvm::BasicBlock</a></div><div class="ttdoc">LLVM Basic Block Representation.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00055">BasicBlock.h:55</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_a2d94a30dbf5569ba774109343ed5f999"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#a2d94a30dbf5569ba774109343ed5f999">foldConstantInsEltIntoShuffle</a></div><div class="ttdeci">static Instruction * foldConstantInsEltIntoShuffle(InsertElementInst &amp;InsElt)</div><div class="ttdoc">insertelt (shufflevector X, CVec, Mask|insertelt X, C1, CIndex1), C, CIndex --&gt; shufflevector X,...</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l01388">InstCombineVectorOps.cpp:1388</a></div></div>
<div class="ttc" id="anamespacellvm_html_a4e09435caee07f636a47006fa08b9ec4"><div class="ttname"><a href="namespacellvm.html#a4e09435caee07f636a47006fa08b9ec4">llvm::UndefMaskElem</a></div><div class="ttdeci">constexpr int UndefMaskElem</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02005">Instructions.h:2005</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_aca6428e7fec51ba0b55594f469eb9691"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#aca6428e7fec51ba0b55594f469eb9691">llvm::PatternMatch::m_OneUse</a></div><div class="ttdeci">OneUse_match&lt; T &gt; m_OneUse(const T &amp;SubPattern)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00067">PatternMatch.h:67</a></div></div>
<div class="ttc" id="anamespacellvm_html_aee89448981f9fbc0d97fe68f354a8e82"><div class="ttname"><a href="namespacellvm.html#aee89448981f9fbc0d97fe68f354a8e82">llvm::simplifyExtractElementInst</a></div><div class="ttdeci">Value * simplifyExtractElementInst(Value *Vec, Value *Idx, const SimplifyQuery &amp;Q)</div><div class="ttdoc">Given operands for an ExtractElementInst, fold the result or return null.</div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8cpp_source.html#l05028">InstructionSimplify.cpp:5028</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallBitVector_html"><div class="ttname"><a href="classllvm_1_1SmallBitVector.html">llvm::SmallBitVector</a></div><div class="ttdoc">This is a 'bitvector' (really, a variable-sized bit array), optimized for the case when the array is ...</div><div class="ttdef"><b>Definition:</b> <a href="SmallBitVector_8h_source.html#l00035">SmallBitVector.h:35</a></div></div>
<div class="ttc" id="anamespacellvm_1_1BitmaskEnumDetail_html_a91efa71de05b0c2d00730a0279f58658"><div class="ttname"><a href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">llvm::BitmaskEnumDetail::Mask</a></div><div class="ttdeci">constexpr std::underlying_type_t&lt; E &gt; Mask()</div><div class="ttdoc">Get a bitmask with 1s in all places up to the high-order bit of E's largest value.</div><div class="ttdef"><b>Definition:</b> <a href="BitmaskEnum_8h_source.html#l00080">BitmaskEnum.h:80</a></div></div>
<div class="ttc" id="aIR_2Instruction_8h_html"><div class="ttname"><a href="IR_2Instruction_8h.html">Instruction.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_aac9e78b3aa02ec087c4621358f506718"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#aac9e78b3aa02ec087c4621358f506718">llvm::PatternMatch::m_APInt</a></div><div class="ttdeci">apint_match m_APInt(const APInt *&amp;Res)</div><div class="ttdoc">Match a ConstantInt or splatted ConstantVector, binding the specified pointer to the contained APInt.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00278">PatternMatch.h:278</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantExpr_html_ae9c2f00a962cb8e0316cf3548a5d8029"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#ae9c2f00a962cb8e0316cf3548a5d8029">llvm::ConstantExpr::getBinOpIdentity</a></div><div class="ttdeci">static Constant * getBinOpIdentity(unsigned Opcode, Type *Ty, bool AllowRHSConstant=false, bool NSZ=false)</div><div class="ttdoc">Return the identity constant for a binary opcode.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l02741">Constants.cpp:2741</a></div></div>
<div class="ttc" id="aclassllvm_1_1UnaryOperator_html_a7cece7ddf076c1dccc81f743e3b7bd36"><div class="ttname"><a href="classllvm_1_1UnaryOperator.html#a7cece7ddf076c1dccc81f743e3b7bd36">llvm::UnaryOperator::getOpcode</a></div><div class="ttdeci">UnaryOps getOpcode() const</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00170">InstrTypes.h:170</a></div></div>
<div class="ttc" id="aX86PartialReduction_8cpp_html_a9e1483f7215664a2315c53c3558d9a8d"><div class="ttname"><a href="X86PartialReduction_8cpp.html#a9e1483f7215664a2315c53c3558d9a8d">LHS</a></div><div class="ttdeci">Value * LHS</div><div class="ttdef"><b>Definition:</b> <a href="X86PartialReduction_8cpp_source.html#l00075">X86PartialReduction.cpp:75</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html"><div class="ttname"><a href="classllvm_1_1ConstantInt.html">llvm::ConstantInt</a></div><div class="ttdoc">This is the shared class of boolean and integer constants.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00078">Constants.h:78</a></div></div>
<div class="ttc" id="aclassllvm_1_1InstCombiner_html_abc13043585e5845ce7fc26b858851ec9"><div class="ttname"><a href="classllvm_1_1InstCombiner.html#abc13043585e5845ce7fc26b858851ec9">llvm::InstCombiner::replaceOperand</a></div><div class="ttdeci">Instruction * replaceOperand(Instruction &amp;I, unsigned OpNum, Value *V)</div><div class="ttdoc">Replace operand of instruction and add old operand to the worklist.</div><div class="ttdef"><b>Definition:</b> <a href="InstCombiner_8h_source.html#l00442">InstCombiner.h:442</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_ab4e05d690df389b8b1477c90387b575f"><div class="ttname"><a href="classllvm_1_1Instruction.html#ab4e05d690df389b8b1477c90387b575f">llvm::Instruction::getOpcode</a></div><div class="ttdeci">unsigned getOpcode() const</div><div class="ttdoc">Returns a member of one of the enums like Instruction::Add.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00168">Instruction.h:168</a></div></div>
<div class="ttc" id="aclassllvm_1_1SelectInst_html_aa55fb74dd22008fdcc26a63f44576022"><div class="ttname"><a href="classllvm_1_1SelectInst.html#aa55fb74dd22008fdcc26a63f44576022">llvm::SelectInst::Create</a></div><div class="ttdeci">static SelectInst * Create(Value *C, Value *S1, Value *S2, const Twine &amp;NameStr=&quot;&quot;, Instruction *InsertBefore=nullptr, Instruction *MDFrom=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01777">Instructions.h:1777</a></div></div>
<div class="ttc" id="aLowerMatrixIntrinsics_8cpp_html_a6a2164e5aeea9c3e9a02eab3747efd8c"><div class="ttname"><a href="LowerMatrixIntrinsics_8cpp.html#a6a2164e5aeea9c3e9a02eab3747efd8c">isSplat</a></div><div class="ttdeci">static bool isSplat(Value *V)</div><div class="ttdoc">Return true if V is a splat of a value (which is used when multiplying a matrix with a scalar).</div><div class="ttdef"><b>Definition:</b> <a href="LowerMatrixIntrinsics_8cpp_source.html#l00111">LowerMatrixIntrinsics.cpp:111</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a33f9f862dca8ee0f23bff5941bf433d8"><div class="ttname"><a href="classllvm_1_1APInt.html#a33f9f862dca8ee0f23bff5941bf433d8">llvm::APInt::setBit</a></div><div class="ttdeci">void setBit(unsigned BitPosition)</div><div class="ttdoc">Set the given bit to 1 whose position is given as &quot;bitPosition&quot;.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01308">APInt.h:1308</a></div></div>
<div class="ttc" id="aclassllvm_1_1ShuffleVectorInst_html_a747673ac3ea44aadc3907c6b9fd86237"><div class="ttname"><a href="classllvm_1_1ShuffleVectorInst.html#a747673ac3ea44aadc3907c6b9fd86237">llvm::ShuffleVectorInst::isSelect</a></div><div class="ttdeci">bool isSelect() const</div><div class="ttdoc">Return true if this shuffle chooses elements from its source vectors without lane crossings and all o...</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02210">Instructions.h:2210</a></div></div>
<div class="ttc" id="aInstCombineInternal_8h_html"><div class="ttname"><a href="InstCombineInternal_8h.html">InstCombineInternal.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_addb87fe3f509b7803d3f5933ee24b560"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#addb87fe3f509b7803d3f5933ee24b560">llvm::PatternMatch::m_Select</a></div><div class="ttdeci">ThreeOps_match&lt; Cond, LHS, RHS, Instruction::Select &gt; m_Select(const Cond &amp;C, const LHS &amp;L, const RHS &amp;R)</div><div class="ttdoc">Matches SelectInst.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01462">PatternMatch.h:1462</a></div></div>
<div class="ttc" id="aConstants_8h_html"><div class="ttname"><a href="Constants_8h.html">Constants.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a25d956d9e0beadd47ce4bc255dfa811d"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">llvm::PatternMatch::match</a></div><div class="ttdeci">bool match(Val *V, const Pattern &amp;P)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00049">PatternMatch.h:49</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_a16c39eb6e60b42a40c399d8d65347bb6"><div class="ttname"><a href="classllvm_1_1PHINode.html#a16c39eb6e60b42a40c399d8d65347bb6">llvm::PHINode::getIncomingValue</a></div><div class="ttdeci">Value * getIncomingValue(unsigned i) const</div><div class="ttdoc">Return incoming value number x.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02794">Instructions.h:2794</a></div></div>
<div class="ttc" id="aBuiltinGCs_8cpp_html_a6742d2e0a668baf1196ec69e158d5f15"><div class="ttname"><a href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a></div><div class="ttdeci">static GCRegistry::Add&lt; CoreCLRGC &gt; E(&quot;coreclr&quot;, &quot;CoreCLR-compatible GC&quot;)</div></div>
<div class="ttc" id="aclassllvm_1_1User_html"><div class="ttname"><a href="classllvm_1_1User.html">llvm::User</a></div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00044">User.h:44</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a91de4bc9bca1d204b0c4b93d11a83c31"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a91de4bc9bca1d204b0c4b93d11a83c31">llvm::PatternMatch::m_UnOp</a></div><div class="ttdeci">class_match&lt; UnaryOperator &gt; m_UnOp()</div><div class="ttdoc">Match an arbitrary unary operation and ignore it.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00079">PatternMatch.h:79</a></div></div>
<div class="ttc" id="aREADME__ALTIVEC_8txt_html_a9aacd9146afe44bf656cd664e2a88c8c"><div class="ttname"><a href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a></div><div class="ttdeci">(vector float) vec_cmpeq(*A, *B) C</div><div class="ttdef"><b>Definition:</b> <a href="README__ALTIVEC_8txt_source.html#l00086">README_ALTIVEC.txt:86</a></div></div>
<div class="ttc" id="aInstrTypes_8h_html"><div class="ttname"><a href="InstrTypes_8h.html">InstrTypes.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1FCmpInst_html"><div class="ttname"><a href="classllvm_1_1FCmpInst.html">llvm::FCmpInst</a></div><div class="ttdoc">This instruction compares its operands according to the predicate given to the constructor.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01371">Instructions.h:1371</a></div></div>
<div class="ttc" id="aOcamlGCPrinter_8cpp_html_afcf2f797ed287a723263583c9b1c1bce"><div class="ttname"><a href="OcamlGCPrinter_8cpp.html#afcf2f797ed287a723263583c9b1c1bce">Y</a></div><div class="ttdeci">static GCMetadataPrinterRegistry::Add&lt; OcamlGCMetadataPrinter &gt; Y(&quot;ocaml&quot;, &quot;ocaml 3.10-compatible collector&quot;)</div></div>
<div class="ttc" id="aclassllvm_1_1CallInst_html_a850d8262cd900958b3153c4aa080b2bb"><div class="ttname"><a href="classllvm_1_1CallInst.html#a850d8262cd900958b3153c4aa080b2bb">llvm::CallInst::Create</a></div><div class="ttdeci">static CallInst * Create(FunctionType *Ty, Value *F, const Twine &amp;NameStr=&quot;&quot;, Instruction *InsertBefore=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01528">Instructions.h:1528</a></div></div>
<div class="ttc" id="aSIInstrInfo_8cpp_html_a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791"><div class="ttname"><a href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a></div><div class="ttdeci">@ SI</div><div class="ttdef"><b>Definition:</b> <a href="SIInstrInfo_8cpp_source.html#l07993">SIInstrInfo.cpp:7993</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_a639d4e2996fe104ec92be89876430b41"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#a639d4e2996fe104ec92be89876430b41">foldInsEltIntoIdentityShuffle</a></div><div class="ttdeci">static Instruction * foldInsEltIntoIdentityShuffle(InsertElementInst &amp;InsElt)</div><div class="ttdoc">Try to fold an extract+insert element into an existing identity shuffle by changing the shuffle's mas...</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l01306">InstCombineVectorOps.cpp:1306</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a071e8d814b2b30b02544fad964227b8e"><div class="ttname"><a href="classllvm_1_1APInt.html#a071e8d814b2b30b02544fad964227b8e">llvm::APInt::getAllOnes</a></div><div class="ttdeci">static APInt getAllOnes(unsigned numBits)</div><div class="ttdoc">Return an APInt of a specified width with all bits set.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00214">APInt.h:214</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a1bc022868b23918efa44df511f4d5b61"><div class="ttname"><a href="classllvm_1_1Type.html#a1bc022868b23918efa44df511f4d5b61">llvm::Type::isVectorTy</a></div><div class="ttdeci">bool isVectorTy() const</div><div class="ttdoc">True if this is an instance of VectorType.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00258">Type.h:258</a></div></div>
<div class="ttc" id="aclassllvm_1_1InsertElementInst_html"><div class="ttname"><a href="classllvm_1_1InsertElementInst.html">llvm::InsertElementInst</a></div><div class="ttdoc">This instruction inserts a single (scalar) element into a VectorType value.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01945">Instructions.h:1945</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_aecb93439702247fe5353a9966f7cefcd"><div class="ttname"><a href="classllvm_1_1Value.html#aecb93439702247fe5353a9966f7cefcd">llvm::Value::uses</a></div><div class="ttdeci">iterator_range&lt; use_iterator &gt; uses()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00376">Value.h:376</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a161fd4e9fa5367f64c2a4c9e921c3ad3"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a161fd4e9fa5367f64c2a4c9e921c3ad3">llvm::BasicBlock::getFirstInsertionPt</a></div><div class="ttdeci">const_iterator getFirstInsertionPt() const</div><div class="ttdoc">Returns an iterator to the first instruction in this block that is suitable for inserting a non-PHI i...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00245">BasicBlock.cpp:245</a></div></div>
<div class="ttc" id="aclassllvm_1_1VectorType_html_a59632c5deb0423a518ad984bdd04d41f"><div class="ttname"><a href="classllvm_1_1VectorType.html#a59632c5deb0423a518ad984bdd04d41f">llvm::VectorType::getElementCount</a></div><div class="ttdeci">ElementCount getElementCount() const</div><div class="ttdoc">Return an ElementCount instance to represent the (possibly scalable) number of elements in the vector...</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00627">DerivedTypes.h:627</a></div></div>
<div class="ttc" id="anamespacellvm_1_1dwarf_html_a5d3c920b66ea797d6adb243862fdf47a"><div class="ttname"><a href="namespacellvm_1_1dwarf.html#a5d3c920b66ea797d6adb243862fdf47a">llvm::dwarf::Index</a></div><div class="ttdeci">Index</div><div class="ttdef"><b>Definition:</b> <a href="Dwarf_8h_source.html#l00550">Dwarf.h:550</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a2cbdca7c8267aac6914d674f8e81841b"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a2cbdca7c8267aac6914d674f8e81841b">llvm::PatternMatch::m_ZExt</a></div><div class="ttdeci">CastClass_match&lt; OpTy, Instruction::ZExt &gt; m_ZExt(const OpTy &amp;Op)</div><div class="ttdoc">Matches ZExt.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01629">PatternMatch.h:1629</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallBitVector_html_a8cfcd92a373cdd7deefb939dd76b83e3"><div class="ttname"><a href="classllvm_1_1SmallBitVector.html#a8cfcd92a373cdd7deefb939dd76b83e3">llvm::SmallBitVector::all</a></div><div class="ttdeci">bool all() const</div><div class="ttdoc">Returns true if all bits are set.</div><div class="ttdef"><b>Definition:</b> <a href="SmallBitVector_8h_source.html#l00216">SmallBitVector.h:216</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_afa0b2fa29ba074f2b6ec9ac11163f2d9"><div class="ttname"><a href="classllvm_1_1Instruction.html#afa0b2fa29ba074f2b6ec9ac11163f2d9">llvm::Instruction::CastOps</a></div><div class="ttdeci">CastOps</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00823">Instruction.h:823</a></div></div>
<div class="ttc" id="aclassllvm_1_1ShuffleVectorInst_html_a3fb8619f70f51242f81ef96da349c884"><div class="ttname"><a href="classllvm_1_1ShuffleVectorInst.html#a3fb8619f70f51242f81ef96da349c884">llvm::ShuffleVectorInst::getMaskValue</a></div><div class="ttdeci">int getMaskValue(unsigned Elt) const</div><div class="ttdoc">Return the shuffle mask value of this instruction for the given element index.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02072">Instructions.h:2072</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_af431ec215bba8bb9c56e7541d99920f2"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#af431ec215bba8bb9c56e7541d99920f2">llvm::PatternMatch::m_FNeg</a></div><div class="ttdeci">FNeg_match&lt; OpTy &gt; m_FNeg(const OpTy &amp;X)</div><div class="ttdoc">Match 'fneg X' as 'fsub -0.0, X'.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01033">PatternMatch.h:1033</a></div></div>
<div class="ttc" id="aclassllvm_1_1Constant_html_a4d51384de6e1798bb6aa875aebeea9f0"><div class="ttname"><a href="classllvm_1_1Constant.html#a4d51384de6e1798bb6aa875aebeea9f0">llvm::Constant::getAllOnesValue</a></div><div class="ttdeci">static Constant * getAllOnesValue(Type *Ty)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00403">Constants.cpp:403</a></div></div>
<div class="ttc" id="aclassllvm_1_1BinaryOperator_html_a31bf07f3f61525486633bc1d0bbaf029"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html#a31bf07f3f61525486633bc1d0bbaf029">llvm::BinaryOperator::getOpcode</a></div><div class="ttdeci">BinaryOps getOpcode() const</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00391">InstrTypes.h:391</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a677ac8d99ff3c2d32a95c21de9ed372c"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a677ac8d99ff3c2d32a95c21de9ed372c">llvm::PatternMatch::m_ConstantInt</a></div><div class="ttdeci">class_match&lt; ConstantInt &gt; m_ConstantInt()</div><div class="ttdoc">Match an arbitrary ConstantInt and ignore it.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00147">PatternMatch.h:147</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html"><div class="ttname"><a href="classllvm_1_1Instruction.html">llvm::Instruction</a></div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00041">Instruction.h:41</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a9f382207d841377156d4c7868b66b9a5"><div class="ttname"><a href="classllvm_1_1Type.html#a9f382207d841377156d4c7868b66b9a5">llvm::Type::getScalarSizeInBits</a></div><div class="ttdeci">unsigned getScalarSizeInBits() const LLVM_READONLY</div><div class="ttdoc">If this is a vector type, return the getPrimitiveSizeInBits value for the element type.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00188">Type.cpp:188</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_a5ef308f5547e4c1a6dfe646dd7ea7abc"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#a5ef308f5547e4c1a6dfe646dd7ea7abc">ShuffleOps</a></div><div class="ttdeci">std::pair&lt; Value *, Value * &gt; ShuffleOps</div><div class="ttdoc">We are building a shuffle to create V, which is a sequence of insertelement, extractelement pairs.</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l00763">InstCombineVectorOps.cpp:763</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a423e2c491de1408d54e35f0b47d076be"><div class="ttname"><a href="classllvm_1_1APInt.html#a423e2c491de1408d54e35f0b47d076be">llvm::APInt::isAllOnes</a></div><div class="ttdeci">bool isAllOnes() const</div><div class="ttdoc">Determine if all bits are set. This is true for zero-width values.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00354">APInt.h:354</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a217e0207d9cc8e046c2dccbf0e4bb198"><div class="ttname"><a href="classllvm_1_1APInt.html#a217e0207d9cc8e046c2dccbf0e4bb198">llvm::APInt::getZExtValue</a></div><div class="ttdeci">uint64_t getZExtValue() const</div><div class="ttdoc">Get zero extended value.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01494">APInt.h:1494</a></div></div>
<div class="ttc" id="anamespacellvm_html_a0bf75467957937ad23ad7be19f489934"><div class="ttname"><a href="namespacellvm.html#a0bf75467957937ad23ad7be19f489934">llvm::STATISTIC</a></div><div class="ttdeci">STATISTIC(NumFunctions, &quot;Total number of functions&quot;)</div></div>
<div class="ttc" id="anamespacellvm_1_1MipsISD_html_a422daf9aa810935178671306b651d69ba4f09e5b9ab57b1d72349caeba37a0dc1"><div class="ttname"><a href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba4f09e5b9ab57b1d72349caeba37a0dc1">llvm::MipsISD::FAbs</a></div><div class="ttdeci">@ FAbs</div><div class="ttdef"><b>Definition:</b> <a href="MipsISelLowering_8h_source.html#l00103">MipsISelLowering.h:103</a></div></div>
<div class="ttc" id="aclassllvm_1_1UnaryOperator_html_a19fab8f3b21b19f94e68830579d84982"><div class="ttname"><a href="classllvm_1_1UnaryOperator.html#a19fab8f3b21b19f94e68830579d84982">llvm::UnaryOperator::CreateWithCopiedFlags</a></div><div class="ttdeci">static UnaryOperator * CreateWithCopiedFlags(UnaryOps Opc, Value *V, Instruction *CopyO, const Twine &amp;Name=&quot;&quot;, Instruction *InsertBefore=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00155">InstrTypes.h:155</a></div></div>
<div class="ttc" id="aclassllvm_1_1UndefValue_html_a4ae5ff22b700a42bcc5d889233721335"><div class="ttname"><a href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">llvm::UndefValue::get</a></div><div class="ttdeci">static UndefValue * get(Type *T)</div><div class="ttdoc">Static factory methods - Return an 'undef' object of the specified type.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01740">Constants.cpp:1740</a></div></div>
<div class="ttc" id="aclassllvm_1_1InstCombinerImpl_html"><div class="ttname"><a href="classllvm_1_1InstCombinerImpl.html">llvm::InstCombinerImpl</a></div><div class="ttdef"><b>Definition:</b> <a href="InstCombineInternal_8h_source.html#l00061">InstCombineInternal.h:61</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_a969709dd49c28865a482d8b870f87c46"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">llvm::ConstantInt::get</a></div><div class="ttdeci">static Constant * get(Type *Ty, uint64_t V, bool IsSigned=false)</div><div class="ttdoc">If Ty is a vector type, return a Constant with a splat of the given value.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00887">Constants.cpp:887</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_a734417c242634bee69281295ccc5e863"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#a734417c242634bee69281295ccc5e863">collectShuffleElements</a></div><div class="ttdeci">static ShuffleOps collectShuffleElements(Value *V, SmallVectorImpl&lt; int &gt; &amp;Mask, Value *PermittedRHS, InstCombinerImpl &amp;IC)</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l00765">InstCombineVectorOps.cpp:765</a></div></div>
<div class="ttc" id="aclassllvm_1_1InstCombinerImpl_html_acad657182350311f85bc33387733e506"><div class="ttname"><a href="classllvm_1_1InstCombinerImpl.html#acad657182350311f85bc33387733e506">llvm::InstCombinerImpl::foldAggregateConstructionIntoAggregateReuse</a></div><div class="ttdeci">Instruction * foldAggregateConstructionIntoAggregateReuse(InsertValueInst &amp;OrigIVI)</div><div class="ttdoc">Look for chain of insertvalue's that fully define an aggregate, and trace back the values inserted,...</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l00851">InstCombineVectorOps.cpp:851</a></div></div>
<div class="ttc" id="aPatternMatch_8h_html"><div class="ttname"><a href="PatternMatch_8h.html">PatternMatch.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a46ef6115027606b67adcf4d28f3dac17"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a46ef6115027606b67adcf4d28f3dac17">llvm::BasicBlock::getFirstNonPHI</a></div><div class="ttdeci">const Instruction * getFirstNonPHI() const</div><div class="ttdoc">Returns a pointer to the first instruction in this block that is not a PHINode instruction.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00208">BasicBlock.cpp:208</a></div></div>
<div class="ttc" id="aclassllvm_1_1FixedVectorType_html_af9a870d5df50fe0133a410b7c9114c80"><div class="ttname"><a href="classllvm_1_1FixedVectorType.html#af9a870d5df50fe0133a410b7c9114c80">llvm::FixedVectorType::get</a></div><div class="ttdeci">static FixedVectorType * get(Type *ElementType, unsigned NumElts)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00686">Type.cpp:686</a></div></div>
<div class="ttc" id="anamespacellvm_1_1NVPTX_1_1PTXLdStInstCode_html_a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217"><div class="ttname"><a href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">llvm::NVPTX::PTXLdStInstCode::Scalar</a></div><div class="ttdeci">@ Scalar</div><div class="ttdef"><b>Definition:</b> <a href="NVPTX_8h_source.html#l00123">NVPTX.h:123</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_af9c2825ab53adf1bf8c9fa19ec89d986"><div class="ttname"><a href="classllvm_1_1Instruction.html#af9c2825ab53adf1bf8c9fa19ec89d986">llvm::Instruction::isIntDivRem</a></div><div class="ttdeci">bool isIntDivRem() const</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00174">Instruction.h:174</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html_ace7bdce94e806bb8870626657630dab0"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#ace7bdce94e806bb8870626657630dab0">llvm::ArrayRef::slice</a></div><div class="ttdeci">ArrayRef&lt; T &gt; slice(size_t N, size_t M) const</div><div class="ttdoc">slice(n, m) - Chop off the first N elements of the array, and keep M elements in the array.</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00193">ArrayRef.h:193</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_aef51af4b490af6b3bf2dfbc8737a8f9f"><div class="ttname"><a href="classllvm_1_1PHINode.html#aef51af4b490af6b3bf2dfbc8737a8f9f">llvm::PHINode::getNumIncomingValues</a></div><div class="ttdeci">unsigned getNumIncomingValues() const</div><div class="ttdoc">Return the number of incoming edges.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02790">Instructions.h:2790</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a13e877ef779ba7a0688081079f4f9b03"><div class="ttname"><a href="classllvm_1_1Type.html#a13e877ef779ba7a0688081079f4f9b03">llvm::Type::getIntegerBitWidth</a></div><div class="ttdeci">unsigned getIntegerBitWidth() const</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00097">DerivedTypes.h:97</a></div></div>
<div class="ttc" id="aclassllvm_1_1ShuffleVectorInst_html_a50fe6a61ea745fb71fa8403af6e7deed"><div class="ttname"><a href="classllvm_1_1ShuffleVectorInst.html#a50fe6a61ea745fb71fa8403af6e7deed">llvm::ShuffleVectorInst::getType</a></div><div class="ttdeci">VectorType * getType() const</div><div class="ttdoc">Overload to return most specific vector type.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02063">Instructions.h:2063</a></div></div>
<div class="ttc" id="aType_8h_html"><div class="ttname"><a href="Type_8h.html">Type.h</a></div></div>
<div class="ttc" id="aErlangGCPrinter_8cpp_html_a74b474c0616ab55c1d9487f11fd31d26"><div class="ttname"><a href="ErlangGCPrinter_8cpp.html#a74b474c0616ab55c1d9487f11fd31d26">X</a></div><div class="ttdeci">static GCMetadataPrinterRegistry::Add&lt; ErlangGCPrinter &gt; X(&quot;erlang&quot;, &quot;erlang-compatible garbage collector&quot;)</div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_adf0290c7c322f0bf8b275d6b26410b52"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#adf0290c7c322f0bf8b275d6b26410b52">llvm::PatternMatch::m_ExtractElt</a></div><div class="ttdeci">TwoOps_match&lt; Val_t, Idx_t, Instruction::ExtractElement &gt; m_ExtractElt(const Val_t &amp;Val, const Idx_t &amp;Idx)</div><div class="ttdoc">Matches ExtractElementInst.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01492">PatternMatch.h:1492</a></div></div>
<div class="ttc" id="aADT_2tmp_8txt_html_a07ed0bfaa124c15897944fe3eaa971ab"><div class="ttname"><a href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a></div><div class="ttdeci">Class for arbitrary precision integers APInt is a functional replacement for common case unsigned integer type like unsigned long or uint64_t</div><div class="ttdef"><b>Definition:</b> <a href="ADT_2tmp_8txt_source.html#l00001">tmp.txt:1</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ARM__PROC_html_a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e"><div class="ttname"><a href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">llvm::ARM_PROC::IE</a></div><div class="ttdeci">@ IE</div><div class="ttdef"><b>Definition:</b> <a href="MCTargetDesc_2ARMBaseInfo_8h_source.html#l00027">ARMBaseInfo.h:27</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a58e54adaa7672bbf72091254a5391137"><div class="ttname"><a href="classllvm_1_1Type.html#a58e54adaa7672bbf72091254a5391137">llvm::Type::getStructNumElements</a></div><div class="ttdeci">unsigned getStructNumElements() const</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00348">DerivedTypes.h:348</a></div></div>
<div class="ttc" id="anamespacellvm_html_acb22fb04083152eee862457e42e8dc31"><div class="ttname"><a href="namespacellvm.html#acb22fb04083152eee862457e42e8dc31">llvm::predecessors</a></div><div class="ttdeci">auto predecessors(const MachineBasicBlock *BB)</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l01266">MachineBasicBlock.h:1266</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_ac6d28a9b11139182134a9618028a0d07"><div class="ttname"><a href="classllvm_1_1Type.html#ac6d28a9b11139182134a9618028a0d07">llvm::Type::isIntegerTy</a></div><div class="ttdeci">bool isIntegerTy() const</div><div class="ttdoc">True if this is an instance of IntegerType.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00222">Type.h:222</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_aec662ee6ab1490a4cabebf2812e5b9ca"><div class="ttname"><a href="classllvm_1_1APInt.html#aec662ee6ab1490a4cabebf2812e5b9ca">llvm::APInt::getOneBitSet</a></div><div class="ttdeci">static APInt getOneBitSet(unsigned numBits, unsigned BitNo)</div><div class="ttdoc">Return an APInt with exactly one bit set in the result.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00222">APInt.h:222</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_ac2e338e4c120fc3ea43099b54880f1f1"><div class="ttname"><a href="classllvm_1_1Value.html#ac2e338e4c120fc3ea43099b54880f1f1">llvm::Value::user_back</a></div><div class="ttdeci">User * user_back()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00407">Value.h:407</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantExpr_html_a6f6506f0bc515fe29da3b58565300017"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#a6f6506f0bc515fe29da3b58565300017">llvm::ConstantExpr::getShuffleVector</a></div><div class="ttdeci">static Constant * getShuffleVector(Constant *V1, Constant *V2, ArrayRef&lt; int &gt; Mask, Type *OnlyIfReducedTy=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l02618">Constants.cpp:2618</a></div></div>
<div class="ttc" id="aclassllvm_1_1VectorType_html_a071e25c5c6eae5299b1cdc3350c6d55c"><div class="ttname"><a href="classllvm_1_1VectorType.html#a071e25c5c6eae5299b1cdc3350c6d55c">llvm::VectorType::isValidElementType</a></div><div class="ttdeci">static bool isValidElementType(Type *ElemTy)</div><div class="ttdoc">Return true if the specified type is valid as a element type.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00677">Type.cpp:677</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_a0b4f3906851e4c43f596d9f8f40bcd94"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#a0b4f3906851e4c43f596d9f8f40bcd94">foldShuffleWithInsert</a></div><div class="ttdeci">static Instruction * foldShuffleWithInsert(ShuffleVectorInst &amp;Shuf, InstCombinerImpl &amp;IC)</div><div class="ttdoc">Try to replace a shuffle with an insertelement or try to replace a shuffle operand with the operand o...</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l02562">InstCombineVectorOps.cpp:2562</a></div></div>
<div class="ttc" id="aclassllvm_1_1VectorType_html"><div class="ttname"><a href="classllvm_1_1VectorType.html">llvm::VectorType</a></div><div class="ttdoc">Base class of all SIMD vector types.</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00389">DerivedTypes.h:389</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a4ea9acbe7fd20332ea6ccdb0183d6395"><div class="ttname"><a href="classllvm_1_1Instruction.html#a4ea9acbe7fd20332ea6ccdb0183d6395">llvm::Instruction::andIRFlags</a></div><div class="ttdeci">void andIRFlags(const Value *V)</div><div class="ttdoc">Logical 'and' of any supported wrapping, exact, and fast-math flags of V and this instruction.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00372">Instruction.cpp:372</a></div></div>
<div class="ttc" id="aclassllvm_1_1InstCombiner_html_a7ae45c035aecd2db82513cf9d87a9465"><div class="ttname"><a href="classllvm_1_1InstCombiner.html#a7ae45c035aecd2db82513cf9d87a9465">llvm::InstCombiner::getSafeVectorConstantForBinop</a></div><div class="ttdeci">static Constant * getSafeVectorConstantForBinop(BinaryOperator::BinaryOps Opcode, Constant *In, bool IsRHSConstant)</div><div class="ttdoc">Some binary operators require special handling to avoid poison and undefined behavior.</div><div class="ttdef"><b>Definition:</b> <a href="InstCombiner_8h_source.html#l00315">InstCombiner.h:315</a></div></div>
<div class="ttc" id="aVectorUtils_8h_html"><div class="ttname"><a href="VectorUtils_8h.html">VectorUtils.h</a></div></div>
<div class="ttc" id="aBasicBlock_8h_html"><div class="ttname"><a href="BasicBlock_8h.html">BasicBlock.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1ShuffleVectorInst_html_a6315811e3cc527c8f1ab15ae0c789b93"><div class="ttname"><a href="classllvm_1_1ShuffleVectorInst.html#a6315811e3cc527c8f1ab15ae0c789b93">llvm::ShuffleVectorInst::increasesLength</a></div><div class="ttdeci">bool increasesLength() const</div><div class="ttdoc">Return true if this shuffle returns a vector with a greater number of elements than its source vector...</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02113">Instructions.h:2113</a></div></div>
<div class="ttc" id="aclassllvm_1_1ShuffleVectorInst_html_a9874bec83353914ed1e9309d5d9ccea0"><div class="ttname"><a href="classllvm_1_1ShuffleVectorInst.html#a9874bec83353914ed1e9309d5d9ccea0">llvm::ShuffleVectorInst::commuteShuffleMask</a></div><div class="ttdeci">static void commuteShuffleMask(MutableArrayRef&lt; int &gt; Mask, unsigned InVecNumElts)</div><div class="ttdoc">Change values in a shuffle permute mask assuming the two vector operands of length InVecNumElts have ...</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02422">Instructions.h:2422</a></div></div>
<div class="ttc" id="aclassllvm_1_1InstCombinerImpl_html_a3b73df3a995af9ca26c9d024c957c45a"><div class="ttname"><a href="classllvm_1_1InstCombinerImpl.html#a3b73df3a995af9ca26c9d024c957c45a">llvm::InstCombinerImpl::foldSelectShuffle</a></div><div class="ttdeci">Instruction * foldSelectShuffle(ShuffleVectorInst &amp;Shuf)</div><div class="ttdoc">Try to fold shuffles that are the equivalent of a vector select.</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l02204">InstCombineVectorOps.cpp:2204</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_ae77be336e228cf9aa00709a8606dfb98"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#ae77be336e228cf9aa00709a8606dfb98">llvm::PatternMatch::m_Zero</a></div><div class="ttdeci">is_zero m_Zero()</div><div class="ttdoc">Match any null constant or a vector with all elements equal to 0.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00537">PatternMatch.h:537</a></div></div>
<div class="ttc" id="anamespacellvm_1_1MipsISD_html_a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913"><div class="ttname"><a href="namespacellvm_1_1MipsISD.html#a422daf9aa810935178671306b651d69ba88a797f57846adb2c382b3732b471913">llvm::MipsISD::Ext</a></div><div class="ttdeci">@ Ext</div><div class="ttdef"><b>Definition:</b> <a href="MipsISelLowering_8h_source.html#l00159">MipsISelLowering.h:159</a></div></div>
<div class="ttc" id="aclassllvm_1_1Constant_html"><div class="ttname"><a href="classllvm_1_1Constant.html">llvm::Constant</a></div><div class="ttdoc">This is an important base class in LLVM.</div><div class="ttdef"><b>Definition:</b> <a href="Constant_8h_source.html#l00041">Constant.h:41</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a350f4fdc01c770b5cf6a8be2624ae3e5"><div class="ttname"><a href="classllvm_1_1Instruction.html#a350f4fdc01c770b5cf6a8be2624ae3e5">llvm::Instruction::hasNoSignedWrap</a></div><div class="ttdeci">bool hasNoSignedWrap() const LLVM_READONLY</div><div class="ttdoc">Determine whether the no signed wrap flag is set.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00177">Instruction.cpp:177</a></div></div>
<div class="ttc" id="aclassllvm_1_1UnaryOperator_html_a9f731708e681757d51c4dc2a004873c8"><div class="ttname"><a href="classllvm_1_1UnaryOperator.html#a9f731708e681757d51c4dc2a004873c8">llvm::UnaryOperator::CreateFNegFMF</a></div><div class="ttdeci">static UnaryOperator * CreateFNegFMF(Value *Op, Instruction *FMFSource, const Twine &amp;Name=&quot;&quot;, Instruction *InsertBefore=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00163">InstrTypes.h:163</a></div></div>
<div class="ttc" id="aclassllvm_1_1ICmpInst_html"><div class="ttname"><a href="classllvm_1_1ICmpInst.html">llvm::ICmpInst</a></div><div class="ttdoc">This instruction compares its operands according to the predicate given to the constructor.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01197">Instructions.h:1197</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a100c666f9253331dd1d166a863248326"><div class="ttname"><a href="classllvm_1_1Instruction.html#a100c666f9253331dd1d166a863248326">llvm::Instruction::hasNoUnsignedWrap</a></div><div class="ttdeci">bool hasNoUnsignedWrap() const LLVM_READONLY</div><div class="ttdoc">Determine whether the no unsigned wrap flag is set.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00173">Instruction.cpp:173</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a2fd1d2dc14e22227cfa8238778ab87b8"><div class="ttname"><a href="classllvm_1_1Instruction.html#a2fd1d2dc14e22227cfa8238778ab87b8">llvm::Instruction::user_back</a></div><div class="ttdeci">Instruction * user_back()</div><div class="ttdoc">Specialize the methods defined in Value, as we know that an instruction can only be used by other ins...</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00087">Instruction.h:87</a></div></div>
<div class="ttc" id="aclassllvm_1_1TruncInst_html"><div class="ttname"><a href="classllvm_1_1TruncInst.html">llvm::TruncInst</a></div><div class="ttdoc">This class represents a truncation of integer types.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l04813">Instructions.h:4813</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_a089cccb6f231efee72abc76d0f9c695f"><div class="ttname"><a href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">llvm::PHINode::addIncoming</a></div><div class="ttdeci">void addIncoming(Value *V, BasicBlock *BB)</div><div class="ttdoc">Add an incoming value to the end of the PHI list.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02854">Instructions.h:2854</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_a8f761d8d25e621e047614102c8569648"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#a8f761d8d25e621e047614102c8569648">replaceExtractElements</a></div><div class="ttdeci">static void replaceExtractElements(InsertElementInst *InsElt, ExtractElementInst *ExtElt, InstCombinerImpl &amp;IC)</div><div class="ttdoc">If we have insertion into a vector that is wider than the vector that we are extracting from,...</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l00683">InstCombineVectorOps.cpp:683</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_ae586e62daeb752c491198a77ee17a1d2"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#ae586e62daeb752c491198a77ee17a1d2">getPreferredVectorIndex</a></div><div class="ttdeci">ConstantInt * getPreferredVectorIndex(ConstantInt *IndexC)</div><div class="ttdoc">Given a constant index for a extractelement or insertelement instruction, return it with the canonica...</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l00387">InstCombineVectorOps.cpp:387</a></div></div>
<div class="ttc" id="anamespacellvm_1_1numbers_html_a92f4283d4e0e2ea1776894b3ae93640f"><div class="ttname"><a href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">llvm::numbers::e</a></div><div class="ttdeci">constexpr double e</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00031">MathExtras.h:31</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMap_html"><div class="ttname"><a href="classllvm_1_1DenseMap.html">llvm::DenseMap</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00714">DenseMap.h:714</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00058">MD5.cpp:58</a></div></div>
<div class="ttc" id="aclassllvm_1_1UndefValue_html"><div class="ttname"><a href="classllvm_1_1UndefValue.html">llvm::UndefValue</a></div><div class="ttdoc">'undef' values are things that do not have specified contents.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l01382">Constants.h:1382</a></div></div>
<div class="ttc" id="aclassllvm_1_1GetElementPtrInst_html"><div class="ttname"><a href="classllvm_1_1GetElementPtrInst.html">llvm::GetElementPtrInst</a></div><div class="ttdoc">an instruction for type-safe pointer arithmetic to access elements of arrays and structs</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00940">Instructions.h:940</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantExpr_html_aa5ad9e9e7cc67e1675d8d1631a73e625"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#aa5ad9e9e7cc67e1675d8d1631a73e625">llvm::ConstantExpr::getShl</a></div><div class="ttdeci">static Constant * getShl(Constant *C1, Constant *C2, bool HasNUW=false, bool HasNSW=false)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l02695">Constants.cpp:2695</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a7638daf70e17d093dd35f06211dc7a87"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a7638daf70e17d093dd35f06211dc7a87">llvm::PatternMatch::m_FAbs</a></div><div class="ttdeci">m_Intrinsic_Ty&lt; Opnd0 &gt;::Ty m_FAbs(const Opnd0 &amp;Op0)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l02171">PatternMatch.h:2171</a></div></div>
<div class="ttc" id="anamespacellvm_html_acd1cd968cb420c82d70926920fcdc7d7"><div class="ttname"><a href="namespacellvm.html#acd1cd968cb420c82d70926920fcdc7d7">llvm::is_contained</a></div><div class="ttdeci">bool is_contained(R &amp;&amp;Range, const E &amp;Element)</div><div class="ttdoc">Wrapper function around std::find to detect if an element exists in a container.</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l01869">STLExtras.h:1869</a></div></div>
<div class="ttc" id="aArrayRef_8h_html"><div class="ttname"><a href="ArrayRef_8h.html">ArrayRef.h</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_afcd925ff2a62d44f8e4591b0e10d9f83"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#afcd925ff2a62d44f8e4591b0e10d9f83">canonicalizeInsertSplat</a></div><div class="ttdeci">static Instruction * canonicalizeInsertSplat(ShuffleVectorInst &amp;Shuf, InstCombiner::BuilderTy &amp;Builder)</div><div class="ttdoc">If we have an insert of a scalar to a non-zero element of an undefined vector and then shuffle that v...</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l02171">InstCombineVectorOps.cpp:2171</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a0c047f127ed4380a6f383d70bec4eb94"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a0c047f127ed4380a6f383d70bec4eb94">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::find</a></div><div class="ttdeci">iterator find(const_arg_type_t&lt; KeyT &gt; Val)</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00150">DenseMap.h:150</a></div></div>
<div class="ttc" id="aSILowerControlFlow_8cpp_html_a4868c5d81c5ccc98c47aeab6244346a0"><div class="ttname"><a href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a></div><div class="ttdeci">assert(ImpDefSCC.getReg()==AMDGPU::SCC &amp;&amp;ImpDefSCC.isDef())</div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a5cfdb1cd5ccaae5daa8e4b29b3bb6b82"><div class="ttname"><a href="classllvm_1_1Type.html#a5cfdb1cd5ccaae5daa8e4b29b3bb6b82">llvm::Type::getArrayNumElements</a></div><div class="ttdeci">uint64_t getArrayNumElements() const</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00384">DerivedTypes.h:384</a></div></div>
<div class="ttc" id="anamespacestd_html_ab8424022895aee3e366fb9a32f2883cb"><div class="ttname"><a href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a></div><div class="ttdeci">void swap(llvm::BitVector &amp;LHS, llvm::BitVector &amp;RHS)</div><div class="ttdoc">Implement std::swap in terms of BitVector swap.</div><div class="ttdef"><b>Definition:</b> <a href="BitVector_8h_source.html#l00853">BitVector.h:853</a></div></div>
<div class="ttc" id="astructBinopElts_html"><div class="ttname"><a href="structBinopElts.html">BinopElts</a></div><div class="ttdoc">These are the ingredients in an alternate form binary operator as described below.</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l02020">InstCombineVectorOps.cpp:2020</a></div></div>
<div class="ttc" id="aclassllvm_1_1ExtractElementInst_html_a0774641c6da546aae7993a45235c73c0"><div class="ttname"><a href="classllvm_1_1ExtractElementInst.html#a0774641c6da546aae7993a45235c73c0">llvm::ExtractElementInst::getVectorOperandType</a></div><div class="ttdeci">VectorType * getVectorOperandType() const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01915">Instructions.h:1915</a></div></div>
<div class="ttc" id="aTargetLibraryInfo_8cpp_html_aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053"><div class="ttname"><a href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a></div><div class="ttdeci">@ Ptr</div><div class="ttdef"><b>Definition:</b> <a href="TargetLibraryInfo_8cpp_source.html#l00062">TargetLibraryInfo.cpp:62</a></div></div>
<div class="ttc" id="aclassllvm_1_1SelectInst_html"><div class="ttname"><a href="classllvm_1_1SelectInst.html">llvm::SelectInst</a></div><div class="ttdoc">This class represents the LLVM 'select' instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01746">Instructions.h:1746</a></div></div>
<div class="ttc" id="astructllvm_1_1PatternMatch_1_1m__ZeroMask_html"><div class="ttname"><a href="structllvm_1_1PatternMatch_1_1m__ZeroMask.html">llvm::PatternMatch::m_ZeroMask</a></div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01523">PatternMatch.h:1523</a></div></div>
<div class="ttc" id="astructllvm_1_1SimplifyQuery_html_aaf05c1194f5c7869a00434c13c46c228"><div class="ttname"><a href="structllvm_1_1SimplifyQuery.html#aaf05c1194f5c7869a00434c13c46c228">llvm::SimplifyQuery::getWithInstruction</a></div><div class="ttdeci">SimplifyQuery getWithInstruction(Instruction *I) const</div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8h_source.html#l00120">InstructionSimplify.h:120</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_a0f22159dceed07fd0d5d47915a80dc72"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#a0f22159dceed07fd0d5d47915a80dc72">collectSingleShuffleElements</a></div><div class="ttdeci">static bool collectSingleShuffleElements(Value *V, Value *LHS, Value *RHS, SmallVectorImpl&lt; int &gt; &amp;Mask)</div><div class="ttdoc">If V is a shuffle of values that ONLY returns elements from either LHS or RHS, return the shuffle mas...</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l00610">InstCombineVectorOps.cpp:610</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_aadd209ba7e1bfa8113a609e09a7fe62f"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#aadd209ba7e1bfa8113a609e09a7fe62f">llvm::PatternMatch::m_Constant</a></div><div class="ttdeci">class_match&lt; Constant &gt; m_Constant()</div><div class="ttdoc">Match an arbitrary Constant and ignore it.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00144">PatternMatch.h:144</a></div></div>
<div class="ttc" id="aVPlanSLP_8cpp_html_af04704e906a9654777e92a4612c58c13"><div class="ttname"><a href="VPlanSLP_8cpp.html#af04704e906a9654777e92a4612c58c13">getOpcode</a></div><div class="ttdeci">static std::optional&lt; unsigned &gt; getOpcode(ArrayRef&lt; VPValue * &gt; Values)</div><div class="ttdoc">Returns the opcode of Values or ~0 if they do not all agree.</div><div class="ttdef"><b>Definition:</b> <a href="VPlanSLP_8cpp_source.html#l00191">VPlanSLP.cpp:191</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_a444937e7243ef0e376687b403c4bfd1e"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#a444937e7243ef0e376687b403c4bfd1e">foldIdentityExtractShuffle</a></div><div class="ttdeci">static Instruction * foldIdentityExtractShuffle(ShuffleVectorInst &amp;Shuf)</div><div class="ttdoc">Try to fold an extract subvector operation.</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l02512">InstCombineVectorOps.cpp:2512</a></div></div>
<div class="ttc" id="aAssumeBundleBuilder_8cpp_html_afb136e0532bcaed86521b462e6538d62"><div class="ttname"><a href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a></div><div class="ttdeci">assume Assume Builder</div><div class="ttdef"><b>Definition:</b> <a href="AssumeBundleBuilder_8cpp_source.html#l00651">AssumeBundleBuilder.cpp:651</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a24bca8838396aa81b87de8e7ac774b19"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">llvm::PatternMatch::m_Value</a></div><div class="ttdeci">class_match&lt; Value &gt; m_Value()</div><div class="ttdoc">Match an arbitrary value and ignore it.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00076">PatternMatch.h:76</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html"><div class="ttname"><a href="classllvm_1_1APInt.html">llvm::APInt</a></div><div class="ttdoc">Class for arbitrary precision integers.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00075">APInt.h:75</a></div></div>
<div class="ttc" id="aclassllvm_1_1GetElementPtrInst_html_a74c47d18ecd4ca3399785e6ae07134dc"><div class="ttname"><a href="classllvm_1_1GetElementPtrInst.html#a74c47d18ecd4ca3399785e6ae07134dc">llvm::GetElementPtrInst::Create</a></div><div class="ttdeci">static GetElementPtrInst * Create(Type *PointeeType, Value *Ptr, ArrayRef&lt; Value * &gt; IdxList, const Twine &amp;NameStr=&quot;&quot;, Instruction *InsertBefore=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00966">Instructions.h:966</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_aaab494a433fbb23bc68393ee8bcfc5ac"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#aaab494a433fbb23bc68393ee8bcfc5ac">llvm::PatternMatch::m_SExt</a></div><div class="ttdeci">CastClass_match&lt; OpTy, Instruction::SExt &gt; m_SExt(const OpTy &amp;Op)</div><div class="ttdoc">Matches SExt.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01623">PatternMatch.h:1623</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a3acbd0be97863e3e03e3b85641254018"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a3acbd0be97863e3e03e3b85641254018">llvm::PatternMatch::m_SpecificInt</a></div><div class="ttdeci">specific_intval&lt; false &gt; m_SpecificInt(APInt V)</div><div class="ttdoc">Match a specific integer value or vector with all elements equal to the value.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00854">PatternMatch.h:854</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html"><div class="ttname"><a href="classllvm_1_1ArrayRef.html">llvm::ArrayRef</a></div><div class="ttdoc">ArrayRef - Represent a constant reference to an array (0 or more elements consecutively in memory),...</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00033">APInt.h:33</a></div></div>
<div class="ttc" id="aclassllvm_1_1BinaryOperator_html"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html">llvm::BinaryOperator</a></div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00187">InstrTypes.h:187</a></div></div>
<div class="ttc" id="aX86PartialReduction_8cpp_html_ae0f503db91504a3f3440ab81260e4134"><div class="ttname"><a href="X86PartialReduction_8cpp.html#ae0f503db91504a3f3440ab81260e4134">Mul</a></div><div class="ttdeci">BinaryOperator * Mul</div><div class="ttdef"><b>Definition:</b> <a href="X86PartialReduction_8cpp_source.html#l00070">X86PartialReduction.cpp:70</a></div></div>
<div class="ttc" id="aclassllvm_1_1details_1_1FixedOrScalableQuantity_html_ac4ab9dd9440c55bee1aa4a1195cee759"><div class="ttname"><a href="classllvm_1_1details_1_1FixedOrScalableQuantity.html#ac4ab9dd9440c55bee1aa4a1195cee759">llvm::details::FixedOrScalableQuantity::getKnownMinValue</a></div><div class="ttdeci">constexpr ScalarTy getKnownMinValue() const</div><div class="ttdoc">Returns the minimum value this quantity can represent.</div><div class="ttdef"><b>Definition:</b> <a href="TypeSize_8h_source.html#l00163">TypeSize.h:163</a></div></div>
<div class="ttc" id="aBasicBlockSections_8cpp_html_a5fd0741d696f28faf65b33f6c6af8fda"><div class="ttname"><a href="BasicBlockSections_8cpp.html#a5fd0741d696f28faf65b33f6c6af8fda">Cond</a></div><div class="ttdeci">SmallVector&lt; MachineOperand, 4 &gt; Cond</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockSections_8cpp_source.html#l00137">BasicBlockSections.cpp:137</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_a55e58d0b566ef26217958483795974e5"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#a55e58d0b566ef26217958483795974e5">evaluateInDifferentElementOrder</a></div><div class="ttdeci">static Value * evaluateInDifferentElementOrder(Value *V, ArrayRef&lt; int &gt; Mask)</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l01899">InstCombineVectorOps.cpp:1899</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_adea6dc2e42baa345b97be48b0370313d"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#adea6dc2e42baa345b97be48b0370313d">llvm::PatternMatch::m_Undef</a></div><div class="ttdeci">auto m_Undef()</div><div class="ttdoc">Match an arbitrary undef constant.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00136">PatternMatch.h:136</a></div></div>
<div class="ttc" id="aclassllvm_1_1ExtractElementInst_html_aaeb8650ea4319878fc7529daaaf0a9be"><div class="ttname"><a href="classllvm_1_1ExtractElementInst.html#aaeb8650ea4319878fc7529daaaf0a9be">llvm::ExtractElementInst::getVectorOperand</a></div><div class="ttdeci">Value * getVectorOperand()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01910">Instructions.h:1910</a></div></div>
<div class="ttc" id="aSupport_2ErrorHandling_8h_html_ace243f5c25697a1107cce46626b3dc94"><div class="ttname"><a href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a></div><div class="ttdeci">#define llvm_unreachable(msg)</div><div class="ttdoc">Marks that the current location is not supposed to be reachable.</div><div class="ttdef"><b>Definition:</b> <a href="Support_2ErrorHandling_8h_source.html#l00143">ErrorHandling.h:143</a></div></div>
<div class="ttc" id="aclassllvm_1_1Constant_html_acd530d0571f320d47d37e7ae51cf70ff"><div class="ttname"><a href="classllvm_1_1Constant.html#acd530d0571f320d47d37e7ae51cf70ff">llvm::Constant::getAggregateElement</a></div><div class="ttdeci">Constant * getAggregateElement(unsigned Elt) const</div><div class="ttdoc">For aggregates (struct/array/vector) return the constant that corresponds to the specified element if...</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00418">Constants.cpp:418</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a6393a2d4fe7e10b28a0dcc35f881567b"><div class="ttname"><a href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">llvm::Value::getType</a></div><div class="ttdeci">Type * getType() const</div><div class="ttdoc">All values are typed, get the type of this value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00255">Value.h:255</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_afd3e8a6706810fef8cdbaf1f9f40dfbd"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#afd3e8a6706810fef8cdbaf1f9f40dfbd">llvm::PatternMatch::m_Shuffle</a></div><div class="ttdeci">TwoOps_match&lt; V1_t, V2_t, Instruction::ShuffleVector &gt; m_Shuffle(const V1_t &amp;v1, const V2_t &amp;v2)</div><div class="ttdoc">Matches ShuffleVectorInst independently of mask value.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01551">PatternMatch.h:1551</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a3ab5fc45117b450e8bb04e564cb6e5f2"><div class="ttname"><a href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">llvm::Value::replaceAllUsesWith</a></div><div class="ttdeci">void replaceAllUsesWith(Value *V)</div><div class="ttdoc">Change all uses of this to point to a new Value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00532">Value.cpp:532</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_ab3fc0225d8aaf8434026c3573f961f2c"><div class="ttname"><a href="classllvm_1_1Value.html#ab3fc0225d8aaf8434026c3573f961f2c">llvm::Value::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const</div><div class="ttdoc">All values hold a context through their type.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00994">Value.cpp:994</a></div></div>
<div class="ttc" id="aclassllvm_1_1IRBuilderBase_1_1InsertPointGuard_html"><div class="ttname"><a href="classllvm_1_1IRBuilderBase_1_1InsertPointGuard.html">llvm::IRBuilderBase::InsertPointGuard</a></div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00361">IRBuilder.h:361</a></div></div>
<div class="ttc" id="aclassllvm_1_1ilist__node__impl_html_af719fc783be6589465137d997701a432"><div class="ttname"><a href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">llvm::ilist_node_impl::getIterator</a></div><div class="ttdeci">self_iterator getIterator()</div><div class="ttdef"><b>Definition:</b> <a href="ilist__node_8h_source.html#l00082">ilist_node.h:82</a></div></div>
<div class="ttc" id="aAArch64SLSHardening_8cpp_html_ad467c4ab9119043f9b7750ab986be61a"><div class="ttname"><a href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a></div><div class="ttdeci">MachineBasicBlock MachineBasicBlock::iterator DebugLoc DL</div><div class="ttdef"><b>Definition:</b> <a href="AArch64SLSHardening_8cpp_source.html#l00076">AArch64SLSHardening.cpp:76</a></div></div>
<div class="ttc" id="aclassllvm_1_1InstCombinerImpl_html_a643f8d7ef849e1312c83906b4b27b4aa"><div class="ttname"><a href="classllvm_1_1InstCombinerImpl.html#a643f8d7ef849e1312c83906b4b27b4aa">llvm::InstCombinerImpl::visitInsertValueInst</a></div><div class="ttdeci">Instruction * visitInsertValueInst(InsertValueInst &amp;IV)</div><div class="ttdoc">Try to find redundant insertvalue instructions, like the following ones: %0 = insertvalue { i8,...</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l01131">InstCombineVectorOps.cpp:1131</a></div></div>
<div class="ttc" id="anamespacellvm_html_ad66c4759666aab78529658362b498c74"><div class="ttname"><a href="namespacellvm.html#ad66c4759666aab78529658362b498c74">llvm::pred_empty</a></div><div class="ttdeci">bool pred_empty(const BasicBlock *BB)</div><div class="ttdef"><b>Definition:</b> <a href="IR_2CFG_8h_source.html#l00118">CFG.h:118</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantVector_html_ade9fa017ca3aa82f7694a47090547bc1"><div class="ttname"><a href="classllvm_1_1ConstantVector.html#ade9fa017ca3aa82f7694a47090547bc1">llvm::ConstantVector::get</a></div><div class="ttdeci">static Constant * get(ArrayRef&lt; Constant * &gt; V)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01356">Constants.cpp:1356</a></div></div>
<div class="ttc" id="aclassllvm_1_1InstCombiner_html_a5d11a3501303760859b83f2915434e32"><div class="ttname"><a href="classllvm_1_1InstCombiner.html#a5d11a3501303760859b83f2915434e32">llvm::InstCombiner::InsertNewInstWith</a></div><div class="ttdeci">Instruction * InsertNewInstWith(Instruction *New, Instruction &amp;Old)</div><div class="ttdoc">Same as InsertNewInstBefore, but also sets the debug loc.</div><div class="ttdef"><b>Definition:</b> <a href="InstCombiner_8h_source.html#l00407">InstCombiner.h:407</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_a78e5e60cd789444b846f046aa99c11c4"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#a78e5e60cd789444b846f046aa99c11c4">foldCastShuffle</a></div><div class="ttdeci">static Instruction * foldCastShuffle(ShuffleVectorInst &amp;Shuf, InstCombiner::BuilderTy &amp;Builder)</div><div class="ttdoc">Canonicalize casts after shuffle.</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l02463">InstCombineVectorOps.cpp:2463</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a545e8d5dfa1688acea0d0e275b03682f"><div class="ttname"><a href="classllvm_1_1APInt.html#a545e8d5dfa1688acea0d0e275b03682f">llvm::APInt::ult</a></div><div class="ttdeci">bool ult(const APInt &amp;RHS) const</div><div class="ttdoc">Unsigned less than comparison.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01089">APInt.h:1089</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_adb5c319f5905c1d3ca9eb5df546388c5"><div class="ttname"><a href="classllvm_1_1Value.html#adb5c319f5905c1d3ca9eb5df546388c5">llvm::Value::getName</a></div><div class="ttdeci">StringRef getName() const</div><div class="ttdoc">Return a constant reference to the value's name.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00308">Value.cpp:308</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a99f811d53704275b4158c62a2dd138d9"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a99f811d53704275b4158c62a2dd138d9">llvm::DenseMapBase&lt; SmallDenseMap&lt; KeyT, ValueT, 4, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::insert</a></div><div class="ttdeci">std::pair&lt; iterator, bool &gt; insert(const std::pair&lt; KeyT, ValueT &gt; &amp;KV)</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00207">DenseMap.h:207</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html_a6bc2b53fce3b1d8975eea027d8a8eb90"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#a6bc2b53fce3b1d8975eea027d8a8eb90">llvm::ArrayRef::front</a></div><div class="ttdeci">const T &amp; front() const</div><div class="ttdoc">front - Get the first element.</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00166">ArrayRef.h:166</a></div></div>
<div class="ttc" id="anamespacellvm_1_1Intrinsic_html_aefa39f6b622360ce4e947feb9f671b73"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#aefa39f6b622360ce4e947feb9f671b73">llvm::Intrinsic::getDeclaration</a></div><div class="ttdeci">Function * getDeclaration(Module *M, ID id, ArrayRef&lt; Type * &gt; Tys=std::nullopt)</div><div class="ttdoc">Create or insert an LLVM Function declaration for an intrinsic, and return it.</div><div class="ttdef"><b>Definition:</b> <a href="Function_8cpp_source.html#l01502">Function.cpp:1502</a></div></div>
<div class="ttc" id="anamespacellvm_html_a766456df1dd21e804cd4596304e10764ae8b4b40ec3622e371789b790caabc083"><div class="ttname"><a href="namespacellvm.html#a766456df1dd21e804cd4596304e10764ae8b4b40ec3622e371789b790caabc083">llvm::ComplexDeinterleavingOperation::Shuffle</a></div><div class="ttdeci">@ Shuffle</div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_aa5aa7648807905cd7b63153812029fe2"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#aa5aa7648807905cd7b63153812029fe2">findDemandedEltsBySingleUser</a></div><div class="ttdeci">static APInt findDemandedEltsBySingleUser(Value *V, Instruction *UserInstr)</div><div class="ttdoc">Find elements of V demanded by UserInstr.</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l00320">InstCombineVectorOps.cpp:320</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_ac09a21c371a9c535cbc13e8f82503aec"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#ac09a21c371a9c535cbc13e8f82503aec">llvm::ConstantInt::getZExtValue</a></div><div class="ttdeci">uint64_t getZExtValue() const</div><div class="ttdoc">Return the constant as a 64-bit unsigned integer value after it has been zero extended as appropriate...</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00141">Constants.h:141</a></div></div>
<div class="ttc" id="aclassllvm_1_1InstCombiner_html_aa00031e59684d793baa874f11ddaf189"><div class="ttname"><a href="classllvm_1_1InstCombiner.html#aa00031e59684d793baa874f11ddaf189">llvm::InstCombiner::replaceInstUsesWith</a></div><div class="ttdeci">Instruction * replaceInstUsesWith(Instruction &amp;I, Value *V)</div><div class="ttdoc">A combiner-aware RAUW-like routine.</div><div class="ttdef"><b>Definition:</b> <a href="InstCombiner_8h_source.html#l00418">InstCombiner.h:418</a></div></div>
<div class="ttc" id="aclassllvm_1_1InstCombinerImpl_html_a687fa4390149f0cb751d8ad89dca6a3c"><div class="ttname"><a href="classllvm_1_1InstCombinerImpl.html#a687fa4390149f0cb751d8ad89dca6a3c">llvm::InstCombinerImpl::visitInsertElementInst</a></div><div class="ttdeci">Instruction * visitInsertElementInst(InsertElementInst &amp;IE)</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l01588">InstCombineVectorOps.cpp:1588</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a2997340992a508357b480467a6901c70"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a2997340992a508357b480467a6901c70">llvm::PatternMatch::m_FPExt</a></div><div class="ttdeci">CastClass_match&lt; OpTy, Instruction::FPExt &gt; m_FPExt(const OpTy &amp;Op)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01687">PatternMatch.h:1687</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a5ca8aa62fa8b3fe5bc0e8fbe5d8b8b7a"><div class="ttname"><a href="classllvm_1_1Instruction.html#a5ca8aa62fa8b3fe5bc0e8fbe5d8b8b7a">llvm::Instruction::setFastMathFlags</a></div><div class="ttdeci">void setFastMathFlags(FastMathFlags FMF)</div><div class="ttdoc">Convenience function for setting multiple fast-math flags on this instruction, which must be an opera...</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00289">Instruction.cpp:289</a></div></div>
<div class="ttc" id="anamespacellvm_html_a4373d3025961c2c2eeca56b02d7d009d"><div class="ttname"><a href="namespacellvm.html#a4373d3025961c2c2eeca56b02d7d009d">llvm::widenShuffleMaskElts</a></div><div class="ttdeci">bool widenShuffleMaskElts(int Scale, ArrayRef&lt; int &gt; Mask, SmallVectorImpl&lt; int &gt; &amp;ScaledMask)</div><div class="ttdoc">Try to transform a shuffle mask by replacing elements with the scaled index for an equivalent mask of...</div><div class="ttdef"><b>Definition:</b> <a href="VectorUtils_8cpp_source.html#l00490">VectorUtils.cpp:490</a></div></div>
<div class="ttc" id="aConstant_8h_html"><div class="ttname"><a href="Constant_8h.html">Constant.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PPC_html_a40c2294c9ecba721df7f29aaf05157d8"><div class="ttname"><a href="namespacellvm_1_1PPC.html#a40c2294c9ecba721df7f29aaf05157d8">llvm::PPC::getPredicate</a></div><div class="ttdeci">Predicate getPredicate(unsigned Condition, unsigned Hint)</div><div class="ttdoc">Return predicate consisting of specified condition and hint bits.</div><div class="ttdef"><b>Definition:</b> <a href="PPCPredicates_8h_source.html#l00087">PPCPredicates.h:87</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_aeb9966cdc23a95b13381c5b7e8f4ba2c"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#aeb9966cdc23a95b13381c5b7e8f4ba2c">foldTruncShuffle</a></div><div class="ttdeci">static Instruction * foldTruncShuffle(ShuffleVectorInst &amp;Shuf, bool IsBigEndian)</div><div class="ttdoc">Convert a narrowing shuffle of a bitcasted vector into a vector truncate.</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l02342">InstCombineVectorOps.cpp:2342</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_acaf8e4c3e40e01e848c1fad5f05b81cd"><div class="ttname"><a href="classllvm_1_1Type.html#acaf8e4c3e40e01e848c1fad5f05b81cd">llvm::Type::getIntNTy</a></div><div class="ttdeci">static IntegerType * getIntNTy(LLVMContext &amp;C, unsigned N)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00245">Type.cpp:245</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_a9f2944f05cd70d1dc4816c38c9242d77"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#a9f2944f05cd70d1dc4816c38c9242d77">narrowVectorSelect</a></div><div class="ttdeci">static Instruction * narrowVectorSelect(ShuffleVectorInst &amp;Shuf, InstCombiner::BuilderTy &amp;Builder)</div><div class="ttdoc">Match a shuffle-select-shuffle pattern where the shuffles are widening and narrowing (concatenating w...</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l02383">InstCombineVectorOps.cpp:2383</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_ae8f4745a87bae0a614d6bda1cc55ab01"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#ae8f4745a87bae0a614d6bda1cc55ab01">isShuffleExtractingFromLHS</a></div><div class="ttdeci">static bool isShuffleExtractingFromLHS(ShuffleVectorInst &amp;SVI, ArrayRef&lt; int &gt; Mask)</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l02003">InstCombineVectorOps.cpp:2003</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMapBase_html_a65520b9c67759099e313d0f4e7b5ff9e"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a65520b9c67759099e313d0f4e7b5ff9e">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;, KeyT, ValueT, DenseMapInfo&lt; KeyT &gt;, llvm::detail::DenseMapPair&lt; KeyT, ValueT &gt; &gt;::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00084">DenseMap.h:84</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1SendMsg_html_a8594419a4ddfad2c9a79279c490e466d"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">llvm::AMDGPU::SendMsg::Op</a></div><div class="ttdeci">Op</div><div class="ttdef"><b>Definition:</b> <a href="SIDefines_8h_source.html#l00357">SIDefines.h:357</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_ab0ff669b12c20c07137705c38872ec63"><div class="ttname"><a href="classllvm_1_1PHINode.html#ab0ff669b12c20c07137705c38872ec63">llvm::PHINode::Create</a></div><div class="ttdeci">static PHINode * Create(Type *Ty, unsigned NumReservedValues, const Twine &amp;NameStr=&quot;&quot;, Instruction *InsertBefore=nullptr)</div><div class="ttdoc">Constructors - NumReservedValues is a hint for the number of incoming edges that this phi node will h...</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02750">Instructions.h:2750</a></div></div>
<div class="ttc" id="aclassllvm_1_1ShuffleVectorInst_html_a2a9db752c3cab553f75806ef939e6a76"><div class="ttname"><a href="classllvm_1_1ShuffleVectorInst.html#a2a9db752c3cab553f75806ef939e6a76">llvm::ShuffleVectorInst::isSelectMask</a></div><div class="ttdeci">static bool isSelectMask(ArrayRef&lt; int &gt; Mask)</div><div class="ttdoc">Return true if this shuffle mask chooses elements from its source vectors without lane crossings.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l02356">Instructions.cpp:2356</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_ac9f0c867cdd5fe902a7d49c4c3631090"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#ac9f0c867cdd5fe902a7d49c4c3631090">hoistInsEltConst</a></div><div class="ttdeci">static Instruction * hoistInsEltConst(InsertElementInst &amp;InsElt2, InstCombiner::BuilderTy &amp;Builder)</div><div class="ttdoc">If we have an insertelement instruction feeding into another insertelement and the 2nd is inserting a...</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l01365">InstCombineVectorOps.cpp:1365</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a34ee40bb2f4f5ece47ef19e5f1f57e3c"><div class="ttname"><a href="classllvm_1_1Type.html#a34ee40bb2f4f5ece47ef19e5f1f57e3c">llvm::Type::isIntOrIntVectorTy</a></div><div class="ttdeci">bool isIntOrIntVectorTy() const</div><div class="ttdoc">Return true if this is an integer type or a vector of integer types.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00228">Type.h:228</a></div></div>
<div class="ttc" id="aCasting_8h_html"><div class="ttname"><a href="Casting_8h.html">Casting.h</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_aeedeac4118d57ab8348374960c5aa0a6"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#aeedeac4118d57ab8348374960c5aa0a6">foldTruncInsEltPair</a></div><div class="ttdeci">static Instruction * foldTruncInsEltPair(InsertElementInst &amp;InsElt, bool IsBigEndian, InstCombiner::BuilderTy &amp;Builder)</div><div class="ttdoc">If we are inserting 2 halves of a value into adjacent elements of a vector, try to convert to a singl...</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l01525">InstCombineVectorOps.cpp:1525</a></div></div>
<div class="ttc" id="anamespacellvm_html_abee0df5f7f703bb4462aba260ba0a60f"><div class="ttname"><a href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">llvm::BitWidth</a></div><div class="ttdeci">constexpr unsigned BitWidth</div><div class="ttdef"><b>Definition:</b> <a href="BitmaskEnum_8h_source.html#l00147">BitmaskEnum.h:147</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_ace3f33981357525d7cbe1990a68212b5"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#ace3f33981357525d7cbe1990a68212b5">foldInsEltIntoSplat</a></div><div class="ttdeci">static Instruction * foldInsEltIntoSplat(InsertElementInst &amp;InsElt)</div><div class="ttdoc">Try to fold an insert element into an existing splat shuffle by changing the shuffle's mask to includ...</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l01269">InstCombineVectorOps.cpp:1269</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_aac0ea55010b7b1a301e65a0baea057aa"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">llvm::SmallVectorImpl::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00614">SmallVector.h:614</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a874d53817a4923de8e58af6b278c09b0"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a874d53817a4923de8e58af6b278c09b0">llvm::PatternMatch::m_ZeroInt</a></div><div class="ttdeci">cst_pred_ty&lt; is_zero_int &gt; m_ZeroInt()</div><div class="ttdoc">Match an integer 0 or a vector with all elements equal to 0.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00524">PatternMatch.h:524</a></div></div>
<div class="ttc" id="anamespacellvm_1_1MCID_html_ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec"><div class="ttname"><a href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a2b016c207343046b2bac45e69e76dcec">llvm::MCID::Add</a></div><div class="ttdeci">@ Add</div><div class="ttdef"><b>Definition:</b> <a href="MCInstrDesc_8h_source.html#l00186">MCInstrDesc.h:186</a></div></div>
<div class="ttc" id="anamespacellvm_html_ab09fc7dee4f7e02c60f7a9c928dc1603"><div class="ttname"><a href="namespacellvm.html#ab09fc7dee4f7e02c60f7a9c928dc1603">llvm::findScalarElement</a></div><div class="ttdeci">Value * findScalarElement(Value *V, unsigned EltNo)</div><div class="ttdoc">Given a vector and an element number, see if the scalar value is already around as a register,...</div><div class="ttdef"><b>Definition:</b> <a href="VectorUtils_8cpp_source.html#l00285">VectorUtils.cpp:285</a></div></div>
<div class="ttc" id="aclassllvm_1_1IntrinsicInst_html"><div class="ttname"><a href="classllvm_1_1IntrinsicInst.html">llvm::IntrinsicInst</a></div><div class="ttdoc">A wrapper class for inspecting calls to intrinsic functions.</div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00047">IntrinsicInst.h:47</a></div></div>
<div class="ttc" id="aclassllvm_1_1CmpInst_html_a3b4a54b076454fec43b13554b28252a9"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a3b4a54b076454fec43b13554b28252a9">llvm::CmpInst::Create</a></div><div class="ttdeci">static CmpInst * Create(OtherOps Op, Predicate predicate, Value *S1, Value *S2, const Twine &amp;Name=&quot;&quot;, Instruction *InsertBefore=nullptr)</div><div class="ttdoc">Construct a compare instruction, given the opcode, the predicate and the two operands.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l04025">Instructions.cpp:4025</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_ac26154a24f393f523c87cc5f8239f36c"><div class="ttname"><a href="classllvm_1_1Instruction.html#ac26154a24f393f523c87cc5f8239f36c">llvm::Instruction::BinaryOps</a></div><div class="ttdeci">BinaryOps</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00809">Instruction.h:809</a></div></div>
<div class="ttc" id="aclassllvm_1_1InsertElementInst_html_a5532ffa629e5d85d605bb379f7aed857"><div class="ttname"><a href="classllvm_1_1InsertElementInst.html#a5532ffa629e5d85d605bb379f7aed857">llvm::InsertElementInst::getType</a></div><div class="ttdeci">VectorType * getType() const</div><div class="ttdoc">Overload to return most specific vector type.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01978">Instructions.h:1978</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a5e9e1c0dd93557be1b4ad72860f3cbdaa812a573d23fbb37aacd025e2a0588156"><div class="ttname"><a href="classllvm_1_1Type.html#a5e9e1c0dd93557be1b4ad72860f3cbdaa812a573d23fbb37aacd025e2a0588156">llvm::Type::StructTyID</a></div><div class="ttdeci">@ StructTyID</div><div class="ttdoc">Structures.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00074">Type.h:74</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_a95fd07ca61f35098e091aa2329f9c8a6"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#a95fd07ca61f35098e091aa2329f9c8a6">canEvaluateShuffled</a></div><div class="ttdeci">static bool canEvaluateShuffled(Value *V, ArrayRef&lt; int &gt; Mask, unsigned Depth=5)</div><div class="ttdoc">Return true if we can evaluate the specified expression tree if the vector elements were shuffled in ...</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l01735">InstCombineVectorOps.cpp:1735</a></div></div>
<div class="ttc" id="aclassllvm_1_1ShuffleVectorInst_html"><div class="ttname"><a href="classllvm_1_1ShuffleVectorInst.html">llvm::ShuffleVectorInst</a></div><div class="ttdoc">This instruction constructs a fixed permutation of two input vectors.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02017">Instructions.h:2017</a></div></div>
<div class="ttc" id="aInstructions_8h_html"><div class="ttname"><a href="Instructions_8h.html">Instructions.h</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_a89f5f0f536cc9b0bae261737f13786f7"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#a89f5f0f536cc9b0bae261737f13786f7">cheapToScalarize</a></div><div class="ttdeci">static bool cheapToScalarize(Value *V, Value *EI)</div><div class="ttdoc">Return true if the value is cheaper to scalarize than it is to leave as a vector operation.</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l00058">InstCombineVectorOps.cpp:58</a></div></div>
<div class="ttc" id="aSmallVector_8h_html"><div class="ttname"><a href="SmallVector_8h.html">SmallVector.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a2d9861feadd3a09792967a012559e7b2"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">llvm::PatternMatch::m_Specific</a></div><div class="ttdeci">specificval_ty m_Specific(const Value *V)</div><div class="ttdoc">Match if we have a specific specified value.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00772">PatternMatch.h:772</a></div></div>
<div class="ttc" id="aUser_8h_html"><div class="ttname"><a href="User_8h.html">User.h</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_a1e71f36e9936f126265e383fd67440f7"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#a1e71f36e9936f126265e383fd67440f7">findDemandedEltsByAllUsers</a></div><div class="ttdeci">static APInt findDemandedEltsByAllUsers(Value *V)</div><div class="ttdoc">Find union of elements of V demanded by all its users.</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l00364">InstCombineVectorOps.cpp:364</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a159bf794249e0567baf2a2a714d5c679"><div class="ttname"><a href="classllvm_1_1Value.html#a159bf794249e0567baf2a2a714d5c679">llvm::Value::DoPHITranslation</a></div><div class="ttdeci">const Value * DoPHITranslation(const BasicBlock *CurBB, const BasicBlock *PredBB) const</div><div class="ttdoc">Translate PHI node to its predecessor from the given basic block.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00986">Value.cpp:986</a></div></div>
<div class="ttc" id="aSmallBitVector_8h_html"><div class="ttname"><a href="SmallBitVector_8h.html">SmallBitVector.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a1a7f07aaef6a3bee130bf0e0f0536802"><div class="ttname"><a href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">llvm::Instruction::getParent</a></div><div class="ttdeci">const BasicBlock * getParent() const</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00090">Instruction.h:90</a></div></div>
<div class="ttc" id="aInstructionSimplify_8h_html"><div class="ttname"><a href="InstructionSimplify_8h.html">InstructionSimplify.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_a8ce0c4746a1ec805e66409d20ae93922"><div class="ttname"><a href="classllvm_1_1PHINode.html#a8ce0c4746a1ec805e66409d20ae93922">llvm::PHINode::getIncomingBlock</a></div><div class="ttdeci">BasicBlock * getIncomingBlock(unsigned i) const</div><div class="ttdoc">Return incoming basic block number i.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02814">Instructions.h:2814</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html_a85ffb6531d4cda988ea81f18d4e56fb7"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">llvm::ArrayRef::size</a></div><div class="ttdeci">size_t size() const</div><div class="ttdoc">size - Get the array size.</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00163">ArrayRef.h:163</a></div></div>
<div class="ttc" id="aclassllvm_1_1IntegerType_html_a90b790ccb1af4ea5ccd69db4b8cd2d81"><div class="ttname"><a href="classllvm_1_1IntegerType.html#a90b790ccb1af4ea5ccd69db4b8cd2d81">llvm::IntegerType::getBitWidth</a></div><div class="ttdeci">unsigned getBitWidth() const</div><div class="ttdoc">Get the number of bits in this IntegerType.</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00072">DerivedTypes.h:72</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a3015474e70e59c0a3ed4f9f0e8644b75"><div class="ttname"><a href="classllvm_1_1APInt.html#a3015474e70e59c0a3ed4f9f0e8644b75">llvm::APInt::getActiveBits</a></div><div class="ttdeci">unsigned getActiveBits() const</div><div class="ttdoc">Compute the number of active bits in the value.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01463">APInt.h:1463</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html"><div class="ttname"><a href="classllvm_1_1PHINode.html">llvm::PHINode</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02708">Instructions.h:2708</a></div></div>
<div class="ttc" id="aclassllvm_1_1InstCombinerImpl_html_ab18666f9305cc63df7009c9e4ec0e35a"><div class="ttname"><a href="classllvm_1_1InstCombinerImpl.html#ab18666f9305cc63df7009c9e4ec0e35a">llvm::InstCombinerImpl::simplifyBinOpSplats</a></div><div class="ttdeci">Instruction * simplifyBinOpSplats(ShuffleVectorInst &amp;SVI)</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l02719">InstCombineVectorOps.cpp:2719</a></div></div>
<div class="ttc" id="aclassllvm_1_1Constant_html_a292ffa1290b082be7ce24676c26f04d6"><div class="ttname"><a href="classllvm_1_1Constant.html#a292ffa1290b082be7ce24676c26f04d6">llvm::Constant::getSplatValue</a></div><div class="ttdeci">Constant * getSplatValue(bool AllowUndefs=false) const</div><div class="ttdoc">If all elements of the vector constant have the same value, return that value.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01631">Constants.cpp:1631</a></div></div>
<div class="ttc" id="aclassllvm_1_1ExtractElementInst_html_a5c70cc08cbcb4490ef7a9b4cf7766db6"><div class="ttname"><a href="classllvm_1_1ExtractElementInst.html#a5c70cc08cbcb4490ef7a9b4cf7766db6">llvm::ExtractElementInst::getIndexOperand</a></div><div class="ttdeci">Value * getIndexOperand()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01911">Instructions.h:1911</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a3e6d2896c39a84cfa6c47f34cdc584ff"><div class="ttname"><a href="classllvm_1_1Instruction.html#a3e6d2896c39a84cfa6c47f34cdc584ff">llvm::Instruction::copyIRFlags</a></div><div class="ttdeci">void copyIRFlags(const Value *V, bool IncludeWrapFlags=true)</div><div class="ttdoc">Convenience method to copy supported exact, fast-math, and (optionally) wrapping flags from V to this...</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00348">Instruction.cpp:348</a></div></div>
<div class="ttc" id="ablake3__impl_8h_html_a78823051d1dad34b9b3d8120112e674d"><div class="ttname"><a href="blake3__impl_8h.html#a78823051d1dad34b9b3d8120112e674d">IV</a></div><div class="ttdeci">static const uint32_t IV[8]</div><div class="ttdef"><b>Definition:</b> <a href="blake3__impl_8h_source.html#l00077">blake3_impl.h:77</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html">llvm::SmallVectorImpl&lt; int &gt;</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_ab903583d9f02e20dad7ebac266b73214"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#ab903583d9f02e20dad7ebac266b73214">foldIdentityPaddedShuffles</a></div><div class="ttdeci">static Instruction * foldIdentityPaddedShuffles(ShuffleVectorInst &amp;Shuf)</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l02650">InstCombineVectorOps.cpp:2650</a></div></div>
<div class="ttc" id="aDerivedTypes_8h_html"><div class="ttname"><a href="DerivedTypes_8h.html">DerivedTypes.h</a></div></div>
<div class="ttc" id="astructBinopElts_html_a7eb0f39f02b88e3c97ba994ee191f148"><div class="ttname"><a href="structBinopElts.html#a7eb0f39f02b88e3c97ba994ee191f148">BinopElts::Op0</a></div><div class="ttdeci">Value * Op0</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l02022">InstCombineVectorOps.cpp:2022</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a2fed53ed2b3225752bd9e4fce4967361"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a2fed53ed2b3225752bd9e4fce4967361">llvm::PatternMatch::m_Neg</a></div><div class="ttdeci">BinaryOp_match&lt; cst_pred_ty&lt; is_zero_int &gt;, ValTy, Instruction::Sub &gt; m_Neg(const ValTy &amp;V)</div><div class="ttdoc">Matches a 'Neg' as 'sub 0, V'.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l02284">PatternMatch.h:2284</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_af7e7c9415c23ae336af651877798a377"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#af7e7c9415c23ae336af651877798a377">getAlternateBinop</a></div><div class="ttdeci">static BinopElts getAlternateBinop(BinaryOperator *BO, const DataLayout &amp;DL)</div><div class="ttdoc">Binops may be transformed into binops with different opcodes and operands.</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l02034">InstCombineVectorOps.cpp:2034</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallInst_html"><div class="ttname"><a href="classllvm_1_1CallInst.html">llvm::CallInst</a></div><div class="ttdoc">This class represents a function call, abstracting a target machine's calling convention.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01485">Instructions.h:1485</a></div></div>
<div class="ttc" id="alib_2CodeGen_2README_8txt_html_a09776db24cf586ec9f1e18f3bae14099"><div class="ttname"><a href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a></div><div class="ttdeci">Common register allocation spilling lr str ldr sxth r3 ldr mla r4 can lr mov lr str ldr sxth r3 mla r4 and then merge mul and lr str ldr sxth r3 mla r4 It also increase the likelihood the store may become dead bb27 Successors according to LLVM BB</div><div class="ttdef"><b>Definition:</b> <a href="lib_2CodeGen_2README_8txt_source.html#l00039">README.txt:39</a></div></div>
<div class="ttc" id="aHexagonCommonGEP_8cpp_html_ad532e8710e50302e0a376b61c91fa91d"><div class="ttname"><a href="HexagonCommonGEP_8cpp.html#ad532e8710e50302e0a376b61c91fa91d">GEP</a></div><div class="ttdeci">Hexagon Common GEP</div><div class="ttdef"><b>Definition:</b> <a href="HexagonCommonGEP_8cpp_source.html#l00171">HexagonCommonGEP.cpp:171</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html_abe1de1520a21f77ac57cc210bf0fb0b4"><div class="ttname"><a href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">llvm::User::getOperand</a></div><div class="ttdeci">Value * getOperand(unsigned i) const</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00169">User.h:169</a></div></div>
<div class="ttc" id="aInstCombineVectorOps_8cpp_html_a21c9d0a05a498a67033d97eb1200f3b6"><div class="ttname"><a href="InstCombineVectorOps_8cpp.html#a21c9d0a05a498a67033d97eb1200f3b6">foldSelectShuffleWith1Binop</a></div><div class="ttdeci">static Instruction * foldSelectShuffleWith1Binop(ShuffleVectorInst &amp;Shuf)</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l02115">InstCombineVectorOps.cpp:2115</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a5b844aada27c4c6fdb87146ac458c0d8"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a5b844aada27c4c6fdb87146ac458c0d8">llvm::PatternMatch::m_Trunc</a></div><div class="ttdeci">CastClass_match&lt; OpTy, Instruction::Trunc &gt; m_Trunc(const OpTy &amp;Op)</div><div class="ttdoc">Matches Trunc.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l01611">PatternMatch.h:1611</a></div></div>
<div class="ttc" id="anamespacellvm_html_a4e04471ed9ac60e70f5cf2d81f49b8c4"><div class="ttname"><a href="namespacellvm.html#a4e04471ed9ac60e70f5cf2d81f49b8c4">llvm::simplifyShuffleVectorInst</a></div><div class="ttdeci">Value * simplifyShuffleVectorInst(Value *Op0, Value *Op1, ArrayRef&lt; int &gt; Mask, Type *RetTy, const SimplifyQuery &amp;Q)</div><div class="ttdoc">Given operands for a ShuffleVectorInst, fold the result or return null.</div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8cpp_source.html#l05279">InstructionSimplify.cpp:5279</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantAggregateZero_html_abfa1cf8b4348407b167f93bc7c01055f"><div class="ttname"><a href="classllvm_1_1ConstantAggregateZero.html#abfa1cf8b4348407b167f93bc7c01055f">llvm::ConstantAggregateZero::get</a></div><div class="ttdeci">static ConstantAggregateZero * get(Type *Ty)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01595">Constants.cpp:1595</a></div></div>
<div class="ttc" id="aclassllvm_1_1InsertValueInst_html"><div class="ttname"><a href="classllvm_1_1InsertValueInst.html">llvm::InsertValueInst</a></div><div class="ttdoc">This instruction inserts a struct field of array element value into an aggregate value.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02566">Instructions.h:2566</a></div></div>
<div class="ttc" id="aclassllvm_1_1BinaryOperator_html_a02ce9966395063ac501ecbc1623deda4"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html#a02ce9966395063ac501ecbc1623deda4">llvm::BinaryOperator::Create</a></div><div class="ttdeci">static BinaryOperator * Create(BinaryOps Op, Value *S1, Value *S2, const Twine &amp;Name=Twine(), Instruction *InsertBefore=nullptr)</div><div class="ttdoc">Construct a binary instruction, given the opcode and the two operands.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l02950">Instructions.cpp:2950</a></div></div>
<div class="ttc" id="aValue_8h_html"><div class="ttname"><a href="Value_8h.html">Value.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a753e1338645ec04d045211b8a46d968d"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a753e1338645ec04d045211b8a46d968d">llvm::PatternMatch::m_Cmp</a></div><div class="ttdeci">class_match&lt; CmpInst &gt; m_Cmp()</div><div class="ttdoc">Matches any compare instruction and ignore it.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00089">PatternMatch.h:89</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a689a03df5b4ae094d6a3a1bd13dac574"><div class="ttname"><a href="classllvm_1_1Instruction.html#a689a03df5b4ae094d6a3a1bd13dac574">llvm::Instruction::isExact</a></div><div class="ttdeci">bool isExact() const LLVM_READONLY</div><div class="ttdoc">Determine whether the exact flag is set.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00245">Instruction.cpp:245</a></div></div>
<div class="ttc" id="anamespacellvm_1_1LegacyLegalizeActions_html_ad25716c86372dafbf624b34891685078aa2a0de09ad7131649f5caf2ca1093396"><div class="ttname"><a href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078aa2a0de09ad7131649f5caf2ca1093396">llvm::LegacyLegalizeActions::NotFound</a></div><div class="ttdeci">@ NotFound</div><div class="ttdoc">Sentinel value for when no action was found in the specified table.</div><div class="ttdef"><b>Definition:</b> <a href="LegacyLegalizerInfo_8h_source.html#l00074">LegacyLegalizerInfo.h:74</a></div></div>
<div class="ttc" id="anamespacellvm_html_abe76d72cda6b2b4562c72accb510040b"><div class="ttname"><a href="namespacellvm.html#abe76d72cda6b2b4562c72accb510040b">llvm::isSafeToSpeculativelyExecute</a></div><div class="ttdeci">bool isSafeToSpeculativelyExecute(const Instruction *I, const Instruction *CtxI=nullptr, AssumptionCache *AC=nullptr, const DominatorTree *DT=nullptr, const TargetLibraryInfo *TLI=nullptr)</div><div class="ttdoc">Return true if the instruction does not have any effects besides calculating the result and does not ...</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l04799">ValueTracking.cpp:4799</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html"><div class="ttname"><a href="classllvm_1_1Value.html">llvm::Value</a></div><div class="ttdoc">LLVM Value Representation.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00074">Value.h:74</a></div></div>
<div class="ttc" id="astructBinopElts_html_a085a4f7976730eeaeb8c7037fe8c7aab"><div class="ttname"><a href="structBinopElts.html#a085a4f7976730eeaeb8c7037fe8c7aab">BinopElts::BinopElts</a></div><div class="ttdeci">BinopElts(BinaryOperator::BinaryOps Opc=(BinaryOperator::BinaryOps) 0, Value *V0=nullptr, Value *V1=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l02024">InstCombineVectorOps.cpp:2024</a></div></div>
<div class="ttc" id="astructBinopElts_html_a507629db7779162187dcbdc907798b45"><div class="ttname"><a href="structBinopElts.html#a507629db7779162187dcbdc907798b45">BinopElts::Op1</a></div><div class="ttdeci">Value * Op1</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineVectorOps_8cpp_source.html#l02023">InstCombineVectorOps.cpp:2023</a></div></div>
<div class="ttc" id="aclassllvm_1_1VectorType_html_a8c90e6c50e795b17466482a04947690e"><div class="ttname"><a href="classllvm_1_1VectorType.html#a8c90e6c50e795b17466482a04947690e">llvm::VectorType::get</a></div><div class="ttdeci">static VectorType * get(Type *ElementType, ElementCount EC)</div><div class="ttdoc">This static method is the primary way to construct an VectorType.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00670">Type.cpp:670</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_ab4e0512c7e1c7adaa56677e3155685f1"><div class="ttname"><a href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">llvm::Value::users</a></div><div class="ttdeci">iterator_range&lt; user_iterator &gt; users()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00421">Value.h:421</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_ad4613def4002aa69721553e567ca4187"><div class="ttname"><a href="classllvm_1_1Instruction.html#ad4613def4002aa69721553e567ca4187">llvm::Instruction::dropPoisonGeneratingFlags</a></div><div class="ttdeci">void dropPoisonGeneratingFlags()</div><div class="ttdoc">Drops flags that may cause this instruction to evaluate to poison despite having non-poison inputs.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00185">Instruction.cpp:185</a></div></div>
<div class="ttc" id="aclassllvm_1_1ShuffleVectorInst_html_a1552dc44fac81fb75a474feaa2ffdab8"><div class="ttname"><a href="classllvm_1_1ShuffleVectorInst.html#a1552dc44fac81fb75a474feaa2ffdab8">llvm::ShuffleVectorInst::changesLength</a></div><div class="ttdeci">bool changesLength() const</div><div class="ttdoc">Return true if this shuffle returns a vector with a different number of elements than its source vect...</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02102">Instructions.h:2102</a></div></div>
<div class="ttc" id="aclassllvm_1_1Use_html"><div class="ttname"><a href="classllvm_1_1Use.html">llvm::Use</a></div><div class="ttdoc">A Use represents the edge between a Value definition and its users.</div><div class="ttdef"><b>Definition:</b> <a href="Use_8h_source.html#l00043">Use.h:43</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a833daf718a49c5cd637d8c9ddeaebe07"><div class="ttname"><a href="classllvm_1_1Type.html#a833daf718a49c5cd637d8c9ddeaebe07">llvm::Type::getPrimitiveSizeInBits</a></div><div class="ttdeci">TypeSize getPrimitiveSizeInBits() const LLVM_READONLY</div><div class="ttdoc">Return the basic size of this type if it is a primitive type.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00163">Type.cpp:163</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_a396fcfee6914c76974b73c3d203da6a5"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a396fcfee6914c76974b73c3d203da6a5">llvm::SmallVectorImpl::emplace_back</a></div><div class="ttdeci">reference emplace_back(ArgTypes &amp;&amp;... Args)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00941">SmallVector.h:941</a></div></div>
<div class="ttc" id="anamespacellvm_1_1Intrinsic_html_a80add6b3b1cdaec560907995127adc16"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">llvm::Intrinsic::ID</a></div><div class="ttdeci">unsigned ID</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00039">TargetTransformInfo.h:39</a></div></div>
<div class="ttc" id="aclassllvm_1_1PoisonValue_html"><div class="ttname"><a href="classllvm_1_1PoisonValue.html">llvm::PoisonValue</a></div><div class="ttdoc">In order to facilitate speculative execution, many instructions do not invoke immediate undefined beh...</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l01430">Constants.h:1430</a></div></div>
<div class="ttc" id="aclassllvm_1_1PoisonValue_html_a1bf08613fb664a2e377a9a72c59a6b66"><div class="ttname"><a href="classllvm_1_1PoisonValue.html#a1bf08613fb664a2e377a9a72c59a6b66">llvm::PoisonValue::get</a></div><div class="ttdeci">static PoisonValue * get(Type *T)</div><div class="ttdoc">Static factory methods - Return an 'poison' object of the specified type.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01759">Constants.cpp:1759</a></div></div>
<div class="ttc" id="aclassllvm_1_1ShuffleVectorInst_html_aa94c68d274d913e05b0423c7b2fded00"><div class="ttname"><a href="classllvm_1_1ShuffleVectorInst.html#aa94c68d274d913e05b0423c7b2fded00">llvm::ShuffleVectorInst::commute</a></div><div class="ttdeci">void commute()</div><div class="ttdoc">Swap the operands and adjust the mask to preserve the semantics of the instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l02145">Instructions.cpp:2145</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 7 2023 10:23:45 for LLVM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
