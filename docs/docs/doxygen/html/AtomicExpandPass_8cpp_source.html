<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: lib/CodeGen/AtomicExpandPass.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LLVM
   &#160;<span id="projectnumber">17.0.0git</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_1e8ad0574bd6e387992681ee57691a07.html">CodeGen</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">AtomicExpandPass.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="AtomicExpandPass_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- AtomicExpandPass.cpp - Expand atomic instructions ------------------===//</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// See https://llvm.org/LICENSE.txt for license information.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// This file contains a pass (at IR level) to replace atomic instructions with</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// __atomic_* library calls, or target specific instruction which implement the</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// same semantics in a way which better fits the target backend.  This can</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// include the use of (intrinsic-based) load-linked/store-conditional loops,</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// AtomicCmpXchg, or type coercions.</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160; </div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ArrayRef_8h.html">llvm/ADT/ArrayRef.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="STLFunctionalExtras_8h.html">llvm/ADT/STLFunctionalExtras.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallVector_8h.html">llvm/ADT/SmallVector.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InstSimplifyFolder_8h.html">llvm/Analysis/InstSimplifyFolder.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="OptimizationRemarkEmitter_8h.html">llvm/Analysis/OptimizationRemarkEmitter.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AtomicExpandUtils_8h.html">llvm/CodeGen/AtomicExpandUtils.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="RuntimeLibcalls_8h.html">llvm/CodeGen/RuntimeLibcalls.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetLowering_8h.html">llvm/CodeGen/TargetLowering.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetPassConfig_8h.html">llvm/CodeGen/TargetPassConfig.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetSubtargetInfo_8h.html">llvm/CodeGen/TargetSubtargetInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ValueTypes_8h.html">llvm/CodeGen/ValueTypes.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Attributes_8h.html">llvm/IR/Attributes.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BasicBlock_8h.html">llvm/IR/BasicBlock.h</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constant_8h.html">llvm/IR/Constant.h</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constants_8h.html">llvm/IR/Constants.h</a>&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DataLayout_8h.html">llvm/IR/DataLayout.h</a>&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DerivedTypes_8h.html">llvm/IR/DerivedTypes.h</a>&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Function_8h.html">llvm/IR/Function.h</a>&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IRBuilder_8h.html">llvm/IR/IRBuilder.h</a>&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InstIterator_8h.html">llvm/IR/InstIterator.h</a>&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IR_2Instruction_8h.html">llvm/IR/Instruction.h</a>&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Instructions_8h.html">llvm/IR/Instructions.h</a>&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Module_8h.html">llvm/IR/Module.h</a>&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Type_8h.html">llvm/IR/Type.h</a>&quot;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="User_8h.html">llvm/IR/User.h</a>&quot;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Value_8h.html">llvm/IR/Value.h</a>&quot;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InitializePasses_8h.html">llvm/InitializePasses.h</a>&quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Pass_8h.html">llvm/Pass.h</a>&quot;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AtomicOrdering_8h.html">llvm/Support/AtomicOrdering.h</a>&quot;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Casting_8h.html">llvm/Support/Casting.h</a>&quot;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Debug_8h.html">llvm/Support/Debug.h</a>&quot;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Support_2ErrorHandling_8h.html">llvm/Support/ErrorHandling.h</a>&quot;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="raw__ostream_8h.html">llvm/Support/raw_ostream.h</a>&quot;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Target_2TargetMachine_8h.html">llvm/Target/TargetMachine.h</a>&quot;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="LowerAtomic_8h.html">llvm/Transforms/Utils/LowerAtomic.h</a>&quot;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &lt;cstdint&gt;</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &lt;iterator&gt;</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160; </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="AtomicExpandPass_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">   58</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;atomic-expand&quot;</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="keyword">class </span>AtomicExpand : <span class="keyword">public</span> <a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a> {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> *TLI = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160; </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>; <span class="comment">// Pass identification, replacement for typeid</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  AtomicExpand() : <a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a>(<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>) {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <a class="code" href="namespacellvm.html#a8641c386ba7874cb5c8edaa1377e4b85">initializeAtomicExpandPass</a>(*<a class="code" href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  }</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="EntryExitInstrumenter_8cpp.html#a3985f1f39349428d17f0d2b81ebc6349">runOnFunction</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) <span class="keyword">override</span>;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <span class="keywordtype">bool</span> bracketInstWithFences(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> Order);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <a class="code" href="classllvm_1_1IntegerType.html">IntegerType</a> *getCorrespondingIntegerType(<a class="code" href="classllvm_1_1Type.html">Type</a> *<a class="code" href="classT.html">T</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *convertAtomicLoadToIntegerType(<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="keywordtype">bool</span> tryExpandAtomicLoad(<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="keywordtype">bool</span> expandAtomicLoadToLL(<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="keywordtype">bool</span> expandAtomicLoadToCmpXchg(<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *convertAtomicStoreToIntegerType(<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="keywordtype">bool</span> tryExpandAtomicStore(<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="keywordtype">void</span> expandAtomicStore(<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordtype">bool</span> tryExpandAtomicRMW(<a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *AI);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *convertAtomicXchgToIntegerType(<a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *RMWI);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  insertRMWLLSCLoop(<a class="code" href="classllvm_1_1IRBuilderBase.html">IRBuilderBase</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="classllvm_1_1Type.html">Type</a> *ResultTy, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>,</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                    <a class="code" href="structllvm_1_1Align.html">Align</a> AddrAlign, <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> MemOpOrder,</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                    <a class="code" href="classllvm_1_1function__ref.html">function_ref</a>&lt;<a class="code" href="classllvm_1_1Value.html">Value</a> *(<a class="code" href="classllvm_1_1IRBuilderBase.html">IRBuilderBase</a> &amp;, <a class="code" href="classllvm_1_1Value.html">Value</a> *)&gt; PerformOp);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="keywordtype">void</span> expandAtomicOpToLLSC(</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="classllvm_1_1Type.html">Type</a> *ResultTy, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, <a class="code" href="structllvm_1_1Align.html">Align</a> AddrAlign,</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> MemOpOrder,</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      <a class="code" href="classllvm_1_1function__ref.html">function_ref</a>&lt;<a class="code" href="classllvm_1_1Value.html">Value</a> *(<a class="code" href="classllvm_1_1IRBuilderBase.html">IRBuilderBase</a> &amp;, <a class="code" href="classllvm_1_1Value.html">Value</a> *)&gt; PerformOp);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordtype">void</span> expandPartwordAtomicRMW(</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84">TargetLoweringBase::AtomicExpansionKind</a> ExpansionKind);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *widenPartwordAtomicRMW(<a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *AI);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keywordtype">bool</span> expandPartwordCmpXchg(<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html">AtomicCmpXchgInst</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="keywordtype">void</span> expandAtomicRMWToMaskedIntrinsic(<a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *AI);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="keywordtype">void</span> expandAtomicCmpXchgToMaskedIntrinsic(<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html">AtomicCmpXchgInst</a> *CI);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <a class="code" href="classllvm_1_1AtomicCmpXchgInst.html">AtomicCmpXchgInst</a> *convertCmpXchgToIntegerType(<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html">AtomicCmpXchgInst</a> *CI);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *insertRMWCmpXchgLoop(</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      <a class="code" href="classllvm_1_1IRBuilderBase.html">IRBuilderBase</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="classllvm_1_1Type.html">Type</a> *ResultType, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, <a class="code" href="structllvm_1_1Align.html">Align</a> AddrAlign,</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> MemOpOrder, <a class="code" href="namespacellvm_1_1SyncScope.html#a80741d3f96133391b683effd8e5b77f0">SyncScope::ID</a> SSID,</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      <a class="code" href="classllvm_1_1function__ref.html">function_ref</a>&lt;<a class="code" href="classllvm_1_1Value.html">Value</a> *(<a class="code" href="classllvm_1_1IRBuilderBase.html">IRBuilderBase</a> &amp;, <a class="code" href="classllvm_1_1Value.html">Value</a> *)&gt; PerformOp,</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      <a class="code" href="classllvm_1_1function__ref.html">CreateCmpXchgInstFun</a> CreateCmpXchg);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="keywordtype">bool</span> tryExpandAtomicCmpXchg(<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html">AtomicCmpXchgInst</a> *CI);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160; </div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="keywordtype">bool</span> expandAtomicCmpXchg(<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html">AtomicCmpXchgInst</a> *CI);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="keywordtype">bool</span> isIdempotentRMW(<a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *RMWI);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="keywordtype">bool</span> simplifyIdempotentRMW(<a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *RMWI);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; </div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="keywordtype">bool</span> expandAtomicOpToLibcall(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="keywordtype">unsigned</span> Size, <a class="code" href="structllvm_1_1Align.html">Align</a> Alignment,</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                               <a class="code" href="classllvm_1_1Value.html">Value</a> *PointerOperand, <a class="code" href="classllvm_1_1Value.html">Value</a> *ValueOperand,</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                               <a class="code" href="classllvm_1_1Value.html">Value</a> *CASExpected, <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> Ordering,</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                               <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> Ordering2,</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                               <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;RTLIB::Libcall&gt;</a> Libcalls);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="keywordtype">void</span> expandAtomicLoadToLibcall(<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordtype">void</span> expandAtomicStoreToLibcall(<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *LI);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="keywordtype">void</span> expandAtomicRMWToLibcall(<a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="keywordtype">void</span> expandAtomicCASToLibcall(<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html">AtomicCmpXchgInst</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="keyword">friend</span> <span class="keywordtype">bool</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <a class="code" href="namespacellvm.html#aa59c4ae8c95bb222039942e9ba995c3e">llvm::expandAtomicRMWToCmpXchg</a>(<a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *AI,</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                                 <a class="code" href="classllvm_1_1function__ref.html">CreateCmpXchgInstFun</a> CreateCmpXchg);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;};</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160; </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">// IRBuilder to be used for replacement atomic instructions.</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="keyword">struct </span>ReplacementIRBuilder : <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder</a>&lt;InstSimplifyFolder&gt; {</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="comment">// Preserves the DebugLoc from I, and preserves still valid metadata.</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="keyword">explicit</span> ReplacementIRBuilder(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>)</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      : <a class="code" href="namespacellvm.html#aa241826e10b4a9bf77c3115e7160d3c7">IRBuilder</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getContext(), <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>) {</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    SetInsertPoint(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    this-&gt;CollectMetadataToCopy(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, {LLVMContext::MD_pcsections});</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  }</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;};</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46">AtomicExpand::ID</a> = 0;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="namespacellvm.html#af81c48a69603bf5bc3e54302533ed4ab">  143</a></span>&#160;<span class="keywordtype">char</span> &amp;<a class="code" href="namespacellvm.html#af81c48a69603bf5bc3e54302533ed4ab">llvm::AtomicExpandID</a> = <a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46">AtomicExpand::ID</a>;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno"><a class="line" href="AtomicExpandPass_8cpp.html#a38d50193d10c3fe3a384b5279eec5a81">  145</a></span>&#160;<a class="code" href="AtomicExpandPass_8cpp.html#a38d50193d10c3fe3a384b5279eec5a81">INITIALIZE_PASS</a>(AtomicExpand, <a class="code" href="AtomicExpandPass_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a>, <span class="stringliteral">&quot;Expand Atomic instructions&quot;</span>, <span class="keyword">false</span>,</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                <span class="keyword">false</span>)</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160; </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a> *<a class="code" href="namespacellvm.html">llvm</a>::<a class="code" href="namespacellvm.html#aac70ae2b103201c54db337ea53995270">createAtomicExpandPass</a>() { <span class="keywordflow">return</span> <span class="keyword">new</span> AtomicExpand(); }</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">// Helper functions to retrieve the size of atomic instructions.</span></div>
<div class="line"><a name="l00151"></a><span class="lineno"><a class="line" href="AtomicExpandPass_8cpp.html#a2c4ed28bcf6025776c8aed0bf9159899">  151</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <a class="code" href="AtomicExpandPass_8cpp.html#a2c4ed28bcf6025776c8aed0bf9159899">getAtomicOpSize</a>(<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI) {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a> = LI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>()-&gt;<a class="code" href="classllvm_1_1Module.html#a6d883605206368bc536cc9ded97209b8">getDataLayout</a>();</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(LI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;}</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; </div>
<div class="line"><a name="l00156"></a><span class="lineno"><a class="line" href="AtomicExpandPass_8cpp.html#accc002905dbfe76b18e8ec1cea25cee6">  156</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <a class="code" href="AtomicExpandPass_8cpp.html#a2c4ed28bcf6025776c8aed0bf9159899">getAtomicOpSize</a>(<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>) {</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getModule()-&gt;getDataLayout();</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getValueOperand()-&gt;getType());</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;}</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160; </div>
<div class="line"><a name="l00161"></a><span class="lineno"><a class="line" href="AtomicExpandPass_8cpp.html#a48ac978d44f5d426d300a400142708b5">  161</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <a class="code" href="AtomicExpandPass_8cpp.html#a2c4ed28bcf6025776c8aed0bf9159899">getAtomicOpSize</a>(<a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *RMWI) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a> = RMWI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>()-&gt;<a class="code" href="classllvm_1_1Module.html#a6d883605206368bc536cc9ded97209b8">getDataLayout</a>();</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(RMWI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#ad0c33604d4cd5e05ce5f285ed47ec5b8">getValOperand</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;}</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno"><a class="line" href="AtomicExpandPass_8cpp.html#a11d6de2bddc669af3e9b358e46e38e9e">  166</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <a class="code" href="AtomicExpandPass_8cpp.html#a2c4ed28bcf6025776c8aed0bf9159899">getAtomicOpSize</a>(<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html">AtomicCmpXchgInst</a> *CASI) {</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a> = CASI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>()-&gt;<a class="code" href="classllvm_1_1Module.html#a6d883605206368bc536cc9ded97209b8">getDataLayout</a>();</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(CASI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a54ba0d7cdad65aa333e7756b26536c8e">getCompareOperand</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;}</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160; </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">// Determine if a particular atomic operation has a supported size,</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">// and is of appropriate alignment, to be passed through for target</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">// lowering. (Versus turning into a __atomic libcall)</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Inst&gt;</div>
<div class="line"><a name="l00175"></a><span class="lineno"><a class="line" href="AtomicExpandPass_8cpp.html#addb0d67f88876ee143acca486e03c53d">  175</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="AtomicExpandPass_8cpp.html#addb0d67f88876ee143acca486e03c53d">atomicSizeSupported</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLowering.html">TargetLowering</a> *TLI, Inst *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="keywordtype">unsigned</span> Size = <a class="code" href="AtomicExpandPass_8cpp.html#a2c4ed28bcf6025776c8aed0bf9159899">getAtomicOpSize</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <a class="code" href="structllvm_1_1Align.html">Align</a> Alignment = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getAlign();</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="keywordflow">return</span> Alignment &gt;= Size &amp;&amp;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;         Size &lt;= TLI-&gt;<a class="code" href="classllvm_1_1TargetLoweringBase.html#ab4f441f058eb21d972cd86d45089fc01">getMaxAtomicSizeInBitsSupported</a>() / 8;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;}</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160; </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="EntryExitInstrumenter_8cpp.html#a3985f1f39349428d17f0d2b81ebc6349">AtomicExpand::runOnFunction</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keyword">auto</span> *TPC = getAnalysisIfAvailable&lt;TargetPassConfig&gt;();</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="keywordflow">if</span> (!TPC)</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="keyword">auto</span> &amp;<a class="code" href="PassBuilderBindings_8cpp.html#ab76052bb166c65901edb603a3e1f03ab">TM</a> = TPC-&gt;getTM&lt;<a class="code" href="classllvm_1_1TargetMachine.html">TargetMachine</a>&gt;();</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> *Subtarget = <a class="code" href="PassBuilderBindings_8cpp.html#ab76052bb166c65901edb603a3e1f03ab">TM</a>.getSubtargetImpl(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="keywordflow">if</span> (!Subtarget-&gt;enableAtomicExpand())</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  TLI = Subtarget-&gt;getTargetLowering();</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a> = &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getParent()-&gt;getDataLayout();</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160; </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 1&gt;</a> AtomicInsts;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160; </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <span class="comment">// Changing control-flow while iterating through it is a bad idea, so gather a</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="comment">// list of all atomic instructions before we start.</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="namespacellvm.html#a7e3e687ddfdcbacd404bcf17b917dd88">instructions</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>))</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isAtomic() &amp;&amp; !isa&lt;FenceInst&gt;(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      AtomicInsts.push_back(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160; </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : AtomicInsts) {</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keyword">auto</span> LI = dyn_cast&lt;LoadInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keyword">auto</span> <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = dyn_cast&lt;StoreInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keyword">auto</span> RMWI = dyn_cast&lt;AtomicRMWInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keyword">auto</span> CASI = dyn_cast&lt;AtomicCmpXchgInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((LI || <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> || RMWI || CASI) &amp;&amp; <span class="stringliteral">&quot;Unknown atomic instruction&quot;</span>);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160; </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="comment">// If the Size/Alignment is not supported, replace with a libcall.</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">if</span> (LI) {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="AtomicExpandPass_8cpp.html#addb0d67f88876ee143acca486e03c53d">atomicSizeSupported</a>(TLI, LI)) {</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        expandAtomicLoadToLibcall(LI);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>) {</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="AtomicExpandPass_8cpp.html#addb0d67f88876ee143acca486e03c53d">atomicSizeSupported</a>(TLI, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>)) {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        expandAtomicStoreToLibcall(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      }</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (RMWI) {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="AtomicExpandPass_8cpp.html#addb0d67f88876ee143acca486e03c53d">atomicSizeSupported</a>(TLI, RMWI)) {</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        expandAtomicRMWToLibcall(RMWI);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      }</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CASI) {</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="AtomicExpandPass_8cpp.html#addb0d67f88876ee143acca486e03c53d">atomicSizeSupported</a>(TLI, CASI)) {</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        expandAtomicCASToLibcall(CASI);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      }</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordflow">if</span> (LI &amp;&amp; TLI-&gt;shouldCastAtomicLoadInIR(LI) ==</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                  <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a3cb580806c51b993a2981c906b62604b">TargetLoweringBase::AtomicExpansionKind::CastToInteger</a>) {</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = LI = convertAtomicLoadToIntegerType(LI);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> &amp;&amp;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;               TLI-&gt;shouldCastAtomicStoreInIR(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>) ==</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                   <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a3cb580806c51b993a2981c906b62604b">TargetLoweringBase::AtomicExpansionKind::CastToInteger</a>) {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> = convertAtomicStoreToIntegerType(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (RMWI &amp;&amp;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;               TLI-&gt;shouldCastAtomicRMWIInIR(RMWI) ==</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                   <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a3cb580806c51b993a2981c906b62604b">TargetLoweringBase::AtomicExpansionKind::CastToInteger</a>) {</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = RMWI = convertAtomicXchgToIntegerType(RMWI);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CASI) {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <span class="comment">// TODO: when we&#39;re ready to make the change at the IR level, we can</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      <span class="comment">// extend convertCmpXchgToInteger for floating point too.</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      <span class="keywordflow">if</span> (CASI-&gt;getCompareOperand()-&gt;getType()-&gt;isPointerTy()) {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="comment">// TODO: add a TLI hook to control this so that each target can</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <span class="comment">// convert to lowering the original type one at a time.</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = CASI = convertCmpXchgToIntegerType(CASI);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      }</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160; </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordflow">if</span> (TLI-&gt;shouldInsertFencesForAtomic(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <span class="keyword">auto</span> FenceOrdering = <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a14194d0b2e6c6680067975517cd58eac">AtomicOrdering::Monotonic</a>;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      <span class="keywordflow">if</span> (LI &amp;&amp; <a class="code" href="namespacellvm.html#abbc497e16b1809ff526b1c755483d35c">isAcquireOrStronger</a>(LI-&gt;getOrdering())) {</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        FenceOrdering = LI-&gt;getOrdering();</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        LI-&gt;setOrdering(<a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a14194d0b2e6c6680067975517cd58eac">AtomicOrdering::Monotonic</a>);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> &amp;&amp; <a class="code" href="namespacellvm.html#a586359566c841c85abfd8922e220213e">isReleaseOrStronger</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getOrdering())) {</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        FenceOrdering = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getOrdering();</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;setOrdering(<a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a14194d0b2e6c6680067975517cd58eac">AtomicOrdering::Monotonic</a>);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (RMWI &amp;&amp; (<a class="code" href="namespacellvm.html#a586359566c841c85abfd8922e220213e">isReleaseOrStronger</a>(RMWI-&gt;getOrdering()) ||</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                          <a class="code" href="namespacellvm.html#abbc497e16b1809ff526b1c755483d35c">isAcquireOrStronger</a>(RMWI-&gt;getOrdering()))) {</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        FenceOrdering = RMWI-&gt;getOrdering();</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        RMWI-&gt;setOrdering(<a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a14194d0b2e6c6680067975517cd58eac">AtomicOrdering::Monotonic</a>);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CASI &amp;&amp;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                 TLI-&gt;shouldExpandAtomicCmpXchgInIR(CASI) ==</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                     <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a6adf97f83acf6453d4a6a4b1070f3754">TargetLoweringBase::AtomicExpansionKind::None</a> &amp;&amp;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                 (<a class="code" href="namespacellvm.html#a586359566c841c85abfd8922e220213e">isReleaseOrStronger</a>(CASI-&gt;getSuccessOrdering()) ||</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                  <a class="code" href="namespacellvm.html#abbc497e16b1809ff526b1c755483d35c">isAcquireOrStronger</a>(CASI-&gt;getSuccessOrdering()) ||</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                  <a class="code" href="namespacellvm.html#abbc497e16b1809ff526b1c755483d35c">isAcquireOrStronger</a>(CASI-&gt;getFailureOrdering()))) {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        <span class="comment">// If a compare and swap is lowered to LL/SC, we can do smarter fence</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <span class="comment">// insertion, with a stronger one on the success path than on the</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <span class="comment">// failure path. As a result, fence insertion is directly done by</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <span class="comment">// expandAtomicCmpXchg in that case.</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        FenceOrdering = CASI-&gt;getMergedOrdering();</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        CASI-&gt;setSuccessOrdering(<a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a14194d0b2e6c6680067975517cd58eac">AtomicOrdering::Monotonic</a>);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        CASI-&gt;setFailureOrdering(<a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a14194d0b2e6c6680067975517cd58eac">AtomicOrdering::Monotonic</a>);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      }</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160; </div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      <span class="keywordflow">if</span> (FenceOrdering != <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a14194d0b2e6c6680067975517cd58eac">AtomicOrdering::Monotonic</a>) {</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        MadeChange |= bracketInstWithFences(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, FenceOrdering);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      }</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasAtomicStore() &amp;&amp;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;               TLI-&gt;shouldInsertTrailingFenceForAtomicStore(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <span class="keyword">auto</span> FenceOrdering = <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a14194d0b2e6c6680067975517cd58eac">AtomicOrdering::Monotonic</a>;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>)</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        FenceOrdering = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getOrdering();</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (RMWI)</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        FenceOrdering = RMWI-&gt;getOrdering();</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CASI &amp;&amp; TLI-&gt;shouldExpandAtomicCmpXchgInIR(CASI) !=</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                           <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a2985b9c595be648a72a6dd08268c2218">TargetLoweringBase::AtomicExpansionKind::LLSC</a>)</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        <span class="comment">// LLSC is handled in expandAtomicCmpXchg().</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        FenceOrdering = CASI-&gt;getSuccessOrdering();</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160; </div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> TrailingFence =</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;              TLI-&gt;emitTrailingFence(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, FenceOrdering)) {</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        TrailingFence-&gt;moveAfter(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      }</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    }</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160; </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordflow">if</span> (LI)</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      MadeChange |= tryExpandAtomicLoad(LI);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>)</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      MadeChange |= tryExpandAtomicStore(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (RMWI) {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <span class="comment">// There are two different ways of expanding RMW instructions:</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <span class="comment">// - into a load if it is idempotent</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      <span class="comment">// - into a Cmpxchg/LL-SC loop otherwise</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <span class="comment">// we try them in that order.</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160; </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <span class="keywordflow">if</span> (isIdempotentRMW(RMWI) &amp;&amp; simplifyIdempotentRMW(RMWI)) {</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615">AtomicRMWInst::BinOp</a> <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = RMWI-&gt;getOperation();</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordtype">unsigned</span> MinCASSize = TLI-&gt;getMinCmpXchgSizeInBits() / 8;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="keywordtype">unsigned</span> ValueSize = <a class="code" href="AtomicExpandPass_8cpp.html#a2c4ed28bcf6025776c8aed0bf9159899">getAtomicOpSize</a>(RMWI);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <span class="keywordflow">if</span> (ValueSize &lt; MinCASSize &amp;&amp;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            (<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> == <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a5954f59053121b87ebe0c5fe79942c6e">AtomicRMWInst::Or</a> || <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> == <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a71aab8ee954b6d71a4eed315e8f6556e">AtomicRMWInst::Xor</a> ||</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;             <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> == <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a660a31179bfecd737a256372e5fd6122">AtomicRMWInst::And</a>)) {</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;          RMWI = widenPartwordAtomicRMW(RMWI);</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;          MadeChange = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        }</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160; </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        MadeChange |= tryExpandAtomicRMW(RMWI);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      }</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CASI)</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      MadeChange |= tryExpandAtomicCmpXchg(CASI);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  }</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;}</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160; </div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="keywordtype">bool</span> AtomicExpand::bracketInstWithFences(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> Order) {</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  ReplacementIRBuilder <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160; </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="keyword">auto</span> LeadingFence = TLI-&gt;emitLeadingFence(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Order);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160; </div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="keyword">auto</span> TrailingFence = TLI-&gt;emitTrailingFence(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Order);</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="comment">// We have a guard here because not every atomic operation generates a</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="comment">// trailing fence.</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <span class="keywordflow">if</span> (TrailingFence)</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    TrailingFence-&gt;moveAfter(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160; </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <span class="keywordflow">return</span> (LeadingFence || TrailingFence);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;}</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">/// Get the iX type with the same bitwidth as T.</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1IntegerType.html">IntegerType</a> *AtomicExpand::getCorrespondingIntegerType(<a class="code" href="classllvm_1_1Type.html">Type</a> *<a class="code" href="classT.html">T</a>,</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                                                       <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>) {</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <a class="code" href="structllvm_1_1EVT.html">EVT</a> VT = TLI-&gt;getMemValueType(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a class="code" href="classT.html">T</a>);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = VT.<a class="code" href="structllvm_1_1EVT.html#a5f64c589a5312630fe76a37f62a39707">getStoreSizeInBits</a>();</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> == VT.<a class="code" href="structllvm_1_1EVT.html#a45e76d44a189e456d52e37ba3dda0fce">getSizeInBits</a>() &amp;&amp; <span class="stringliteral">&quot;must be a power of two&quot;</span>);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1IntegerType.html#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(<a class="code" href="classT.html">T</a>-&gt;getContext(), <a class="code" href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;}</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">/// Convert an atomic load of a non-integral type to an integer load of the</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">/// equivalent bitwidth.  See the function comment on</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">/// convertAtomicStoreToIntegerType for background.</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *AtomicExpand::convertAtomicLoadToIntegerType(<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI) {</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a> = LI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>();</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *NewTy = getCorrespondingIntegerType(LI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>-&gt;getDataLayout());</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160; </div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  ReplacementIRBuilder <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(LI, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160; </div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a> = LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad47eefa1d094f60494b6b927061ca001">getPointerOperand</a>();</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *PT = <a class="code" href="classllvm_1_1PointerType.html#a050a395d1656e546679d8b144d951bb2">PointerType::get</a>(NewTy, <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>-&gt;getType()-&gt;getPointerAddressSpace());</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewAddr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, PT);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160; </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="keyword">auto</span> *NewLI = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateLoad(NewTy, NewAddr);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  NewLI-&gt;setAlignment(LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#af51c113a039c82f6870df5dc9666b5e3">getAlign</a>());</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  NewLI-&gt;setVolatile(LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#a2eccc19f9061eeb7ad1e30e21f76034d">isVolatile</a>());</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  NewLI-&gt;setAtomic(LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#a93603fe0d4168b92a901f06015ecb2e7">getOrdering</a>(), LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#aca6c2de6950cb093f509ed2b67e02da2">getSyncScopeID</a>());</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Replaced &quot;</span> &lt;&lt; *LI &lt;&lt; <span class="stringliteral">&quot; with &quot;</span> &lt;&lt; *NewLI &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160; </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewVal = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(NewLI, LI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  LI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewVal);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  LI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="keywordflow">return</span> NewLI;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;}</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160; </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;AtomicExpand::convertAtomicXchgToIntegerType(<a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *RMWI) {</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a> = RMWI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>();</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *NewTy =</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      getCorrespondingIntegerType(RMWI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>-&gt;getDataLayout());</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160; </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  ReplacementIRBuilder <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(RMWI, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a> = RMWI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#a41a48e80366f5dbe6c065b5407d52c71">getPointerOperand</a>();</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Val = RMWI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#ad0c33604d4cd5e05ce5f285ed47ec5b8">getValOperand</a>();</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *PT = <a class="code" href="classllvm_1_1PointerType.html#a050a395d1656e546679d8b144d951bb2">PointerType::get</a>(NewTy, RMWI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#af39e1cad69b6406376c47e4b111228dc">getPointerAddressSpace</a>());</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewAddr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, PT);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewVal = Val-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>()</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                      ? <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePtrToInt(Val, NewTy)</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                      : <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(Val, NewTy);</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160; </div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <span class="keyword">auto</span> *NewRMWI =</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAtomicRMW(<a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615afc870a548088c5b7a93a34f648889d77">AtomicRMWInst::Xchg</a>, NewAddr, NewVal,</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                              RMWI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#a0b5bee42a0652f7f46ec24c924e610d7">getAlign</a>(), RMWI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#aefa60bfe67b4721c395ce966ac73b439">getOrdering</a>());</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  NewRMWI-&gt;setVolatile(RMWI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#a34f1aa991a80c9618af5d4e84aafcb9c">isVolatile</a>());</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Replaced &quot;</span> &lt;&lt; *RMWI &lt;&lt; <span class="stringliteral">&quot; with &quot;</span> &lt;&lt; *NewRMWI &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160; </div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewRVal = RMWI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>()</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                       ? <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntToPtr(NewRMWI, RMWI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>())</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                       : <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(NewRMWI, RMWI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  RMWI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewRVal);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  RMWI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <span class="keywordflow">return</span> NewRMWI;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;}</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160; </div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="keywordtype">bool</span> AtomicExpand::tryExpandAtomicLoad(<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI) {</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  <span class="keywordflow">switch</span> (TLI-&gt;shouldExpandAtomicLoadInIR(LI)) {</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a6adf97f83acf6453d4a6a4b1070f3754">TargetLoweringBase::AtomicExpansionKind::None</a>:</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a2985b9c595be648a72a6dd08268c2218">TargetLoweringBase::AtomicExpansionKind::LLSC</a>:</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    expandAtomicOpToLLSC(</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        LI, LI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad47eefa1d094f60494b6b927061ca001">getPointerOperand</a>(), LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#af51c113a039c82f6870df5dc9666b5e3">getAlign</a>(),</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#a93603fe0d4168b92a901f06015ecb2e7">getOrdering</a>(),</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        [](<a class="code" href="classllvm_1_1IRBuilderBase.html">IRBuilderBase</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *Loaded) { return Loaded; });</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a4cf4a97fbc85619dbd1e34842a54bdba">TargetLoweringBase::AtomicExpansionKind::LLOnly</a>:</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keywordflow">return</span> expandAtomicLoadToLL(LI);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a369f472273bc816735055f13a6e6fd6c">TargetLoweringBase::AtomicExpansionKind::CmpXChg</a>:</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="keywordflow">return</span> expandAtomicLoadToCmpXchg(LI);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a56a57d29a3f9dda8671b4d6490a94b08">TargetLoweringBase::AtomicExpansionKind::NotAtomic</a>:</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#a6ae88dc44b078c80ce3a25401fd4b05b">setAtomic</a>(<a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a56a57d29a3f9dda8671b4d6490a94b08">AtomicOrdering::NotAtomic</a>);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Unhandled case in tryExpandAtomicLoad&quot;</span>);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  }</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;}</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160; </div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="keywordtype">bool</span> AtomicExpand::tryExpandAtomicStore(<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>) {</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <span class="keywordflow">switch</span> (TLI-&gt;shouldExpandAtomicStoreInIR(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>)) {</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a6adf97f83acf6453d4a6a4b1070f3754">TargetLoweringBase::AtomicExpansionKind::None</a>:</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a8098b34f582537833b36b58273c3545b">TargetLoweringBase::AtomicExpansionKind::Expand</a>:</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    expandAtomicStore(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>);</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a56a57d29a3f9dda8671b4d6490a94b08">TargetLoweringBase::AtomicExpansionKind::NotAtomic</a>:</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;setAtomic(<a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a56a57d29a3f9dda8671b4d6490a94b08">AtomicOrdering::NotAtomic</a>);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Unhandled case in tryExpandAtomicStore&quot;</span>);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  }</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;}</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160; </div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="keywordtype">bool</span> AtomicExpand::expandAtomicLoadToLL(<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI) {</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  ReplacementIRBuilder <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(LI, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160; </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="comment">// On some architectures, load-linked instructions are atomic for larger</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="comment">// sizes than normal loads. For example, the only 64-bit load guaranteed</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="comment">// to be single-copy atomic by ARM is an ldrexd (A3.5.3).</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Val = TLI-&gt;emitLoadLinked(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, LI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(),</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                                   LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad47eefa1d094f60494b6b927061ca001">getPointerOperand</a>(), LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#a93603fe0d4168b92a901f06015ecb2e7">getOrdering</a>());</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  TLI-&gt;emitAtomicCmpXchgNoStoreLLBalance(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>);</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160; </div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  LI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Val);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  LI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;}</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160; </div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="keywordtype">bool</span> AtomicExpand::expandAtomicLoadToCmpXchg(<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI) {</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  ReplacementIRBuilder <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(LI, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> Order = LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#a93603fe0d4168b92a901f06015ecb2e7">getOrdering</a>();</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="keywordflow">if</span> (Order == <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a288d468c5e0969f26a310773eda65603">AtomicOrdering::Unordered</a>)</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    Order = <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a14194d0b2e6c6680067975517cd58eac">AtomicOrdering::Monotonic</a>;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160; </div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a> = LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad47eefa1d094f60494b6b927061ca001">getPointerOperand</a>();</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty = LI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *DummyVal = <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Ty);</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160; </div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Pair = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAtomicCmpXchg(</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, DummyVal, DummyVal, LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#af51c113a039c82f6870df5dc9666b5e3">getAlign</a>(), Order,</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      <a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a7ce03ab5b2a6006ebcdfe804e4c8f1a1">AtomicCmpXchgInst::getStrongestFailureOrdering</a>(Order));</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Loaded = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateExtractValue(Pair, 0, <span class="stringliteral">&quot;loaded&quot;</span>);</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160; </div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  LI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Loaded);</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  LI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160; </div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;}</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">/// Convert an atomic store of a non-integral type to an integer store of the</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">/// equivalent bitwidth.  We used to not support floating point or vector</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">/// atomics in the IR at all.  The backends learned to deal with the bitcast</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">/// idiom because that was the only way of expressing the notion of a atomic</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">/// float or vector store.  The long term plan is to teach each backend to</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">/// instruction select from the original atomic store, but as a migration</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment">/// mechanism, we convert back to the old format which the backends understand.</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">/// Each backend will need individual work to recognize the new format.</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *AtomicExpand::convertAtomicStoreToIntegerType(<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>) {</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  ReplacementIRBuilder <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a> = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getModule();</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *NewTy = getCorrespondingIntegerType(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getValueOperand()-&gt;getType(),</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                                            <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>-&gt;getDataLayout());</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewVal = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getValueOperand(), NewTy);</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160; </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a> = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getPointerOperand();</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *PT = <a class="code" href="classllvm_1_1PointerType.html#a050a395d1656e546679d8b144d951bb2">PointerType::get</a>(NewTy, <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>-&gt;getType()-&gt;getPointerAddressSpace());</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewAddr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, PT);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160; </div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *NewSI = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateStore(NewVal, NewAddr);</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  NewSI-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a55195fa18cf783fe74de0cced1ca6eb3">setAlignment</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getAlign());</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  NewSI-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a485d55d9f09489fd6d33a3369b2b3f4d">setVolatile</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;isVolatile());</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  NewSI-&gt;<a class="code" href="classllvm_1_1StoreInst.html#aff28bd42ac76fc3e1c0e4db7f9e06f2d">setAtomic</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getOrdering(), <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getSyncScopeID());</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Replaced &quot;</span> &lt;&lt; *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> &lt;&lt; <span class="stringliteral">&quot; with &quot;</span> &lt;&lt; *NewSI &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <span class="keywordflow">return</span> NewSI;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;}</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160; </div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="keywordtype">void</span> AtomicExpand::expandAtomicStore(<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>) {</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <span class="comment">// This function is only called on atomic stores that are too large to be</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="comment">// atomic if implemented as a native store. So we replace them by an</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="comment">// atomic swap, that can be implemented for example as a ldrex/strex on ARM</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="comment">// or lock cmpxchg8/16b on X86, as these are atomic for larger sizes.</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="comment">// It is the responsibility of the target to only signal expansion via</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <span class="comment">// shouldExpandAtomicRMW in cases where this is required and possible.</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  ReplacementIRBuilder <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(<a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> Ordering = <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getOrdering();</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Ordering != <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a56a57d29a3f9dda8671b4d6490a94b08">AtomicOrdering::NotAtomic</a>);</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> RMWOrdering = Ordering == <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a288d468c5e0969f26a310773eda65603">AtomicOrdering::Unordered</a></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                                   ? <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a14194d0b2e6c6680067975517cd58eac">AtomicOrdering::Monotonic</a></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                                   : Ordering;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  <a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *AI = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAtomicRMW(</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615afc870a548088c5b7a93a34f648889d77">AtomicRMWInst::Xchg</a>, <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getPointerOperand(), <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getValueOperand(),</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;getAlign(), RMWOrdering);</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  <a class="code" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160; </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <span class="comment">// Now we have an appropriate swap instruction, lower it as usual.</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  tryExpandAtomicRMW(AI);</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;}</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160; </div>
<div class="line"><a name="l00545"></a><span class="lineno"><a class="line" href="AtomicExpandPass_8cpp.html#af9ea90f22a3fced77614ad93a197f7df">  545</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="AtomicExpandPass_8cpp.html#af9ea90f22a3fced77614ad93a197f7df">createCmpXchgInstFun</a>(<a class="code" href="classllvm_1_1IRBuilderBase.html">IRBuilderBase</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>,</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                                 <a class="code" href="classllvm_1_1Value.html">Value</a> *Loaded, <a class="code" href="classllvm_1_1Value.html">Value</a> *NewVal, <a class="code" href="structllvm_1_1Align.html">Align</a> AddrAlign,</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                                 <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> MemOpOrder, <a class="code" href="namespacellvm_1_1SyncScope.html#a80741d3f96133391b683effd8e5b77f0">SyncScope::ID</a> SSID,</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                                 <a class="code" href="classllvm_1_1Value.html">Value</a> *&amp;<a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *&amp;NewLoaded) {</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *OrigTy = NewVal-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160; </div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  <span class="comment">// This code can go away when cmpxchg supports FP types.</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!OrigTy-&gt;<a class="code" href="classllvm_1_1Type.html#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>());</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  <span class="keywordtype">bool</span> NeedBitcast = OrigTy-&gt;<a class="code" href="classllvm_1_1Type.html#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>();</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <span class="keywordflow">if</span> (NeedBitcast) {</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <a class="code" href="classllvm_1_1IntegerType.html">IntegerType</a> *IntTy = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getIntNTy(OrigTy-&gt;<a class="code" href="classllvm_1_1Type.html#a833daf718a49c5cd637d8c9ddeaebe07">getPrimitiveSizeInBits</a>());</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="keywordtype">unsigned</span> AS = <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>-&gt;getType()-&gt;getPointerAddressSpace();</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, IntTy-&gt;<a class="code" href="classllvm_1_1Type.html#adc01a7457de85fc52a3bb860d7e1c6a4">getPointerTo</a>(AS));</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    NewVal = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(NewVal, IntTy);</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    Loaded = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(Loaded, IntTy);</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  }</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160; </div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Pair = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAtomicCmpXchg(</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, Loaded, NewVal, AddrAlign, MemOpOrder,</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      <a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a7ce03ab5b2a6006ebcdfe804e4c8f1a1">AtomicCmpXchgInst::getStrongestFailureOrdering</a>(MemOpOrder), SSID);</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateExtractValue(Pair, 1, <span class="stringliteral">&quot;success&quot;</span>);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  NewLoaded = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateExtractValue(Pair, 0, <span class="stringliteral">&quot;newloaded&quot;</span>);</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160; </div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  <span class="keywordflow">if</span> (NeedBitcast)</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    NewLoaded = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(NewLoaded, OrigTy);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;}</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160; </div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="keywordtype">bool</span> AtomicExpand::tryExpandAtomicRMW(<a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *AI) {</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx = AI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>()-&gt;<a class="code" href="classllvm_1_1Module.html#a9c00c70121af456007404bd456047766">getContext</a>();</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84">TargetLowering::AtomicExpansionKind</a> <a class="code" href="namespacellvm_1_1lltok.html#af353621f14cb4b4b3af5ffaff84076b1">Kind</a> = TLI-&gt;shouldExpandAtomicRMWInIR(AI);</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <span class="keywordflow">switch</span> (Kind) {</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a6adf97f83acf6453d4a6a4b1070f3754">TargetLoweringBase::AtomicExpansionKind::None</a>:</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a2985b9c595be648a72a6dd08268c2218">TargetLoweringBase::AtomicExpansionKind::LLSC</a>: {</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keywordtype">unsigned</span> MinCASSize = TLI-&gt;getMinCmpXchgSizeInBits() / 8;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="keywordtype">unsigned</span> ValueSize = <a class="code" href="AtomicExpandPass_8cpp.html#a2c4ed28bcf6025776c8aed0bf9159899">getAtomicOpSize</a>(AI);</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="keywordflow">if</span> (ValueSize &lt; MinCASSize) {</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      expandPartwordAtomicRMW(AI,</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                              <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a2985b9c595be648a72a6dd08268c2218">TargetLoweringBase::AtomicExpansionKind::LLSC</a>);</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      <span class="keyword">auto</span> PerformOp = [&amp;](<a class="code" href="classllvm_1_1IRBuilderBase.html">IRBuilderBase</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *Loaded) {</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a9af7e2dd206cc24d4690e1d2a996c43e">buildAtomicRMWValue</a>(AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#a99fd4ef84981d6a2774c14c741b5ed65">getOperation</a>(), <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, Loaded,</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                                   AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#ad0c33604d4cd5e05ce5f285ed47ec5b8">getValOperand</a>());</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      };</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      expandAtomicOpToLLSC(AI, AI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#a41a48e80366f5dbe6c065b5407d52c71">getPointerOperand</a>(),</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                           AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#a0b5bee42a0652f7f46ec24c924e610d7">getAlign</a>(), AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#aefa60bfe67b4721c395ce966ac73b439">getOrdering</a>(), PerformOp);</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    }</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  }</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a369f472273bc816735055f13a6e6fd6c">TargetLoweringBase::AtomicExpansionKind::CmpXChg</a>: {</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="keywordtype">unsigned</span> MinCASSize = TLI-&gt;getMinCmpXchgSizeInBits() / 8;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="keywordtype">unsigned</span> ValueSize = <a class="code" href="AtomicExpandPass_8cpp.html#a2c4ed28bcf6025776c8aed0bf9159899">getAtomicOpSize</a>(AI);</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="keywordflow">if</span> (ValueSize &lt; MinCASSize) {</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      expandPartwordAtomicRMW(AI,</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                              <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a369f472273bc816735055f13a6e6fd6c">TargetLoweringBase::AtomicExpansionKind::CmpXChg</a>);</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;StringRef&gt;</a> SSNs;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      Ctx.<a class="code" href="classllvm_1_1LLVMContext.html#afb1d554403d05394caf57d2d28a9eab4">getSyncScopeNames</a>(SSNs);</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      <span class="keyword">auto</span> MemScope = SSNs[AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#ac97b19e5c8e2843543087d67e47be222">getSyncScopeID</a>()].empty()</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                          ? <span class="stringliteral">&quot;system&quot;</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                          : SSNs[AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#ac97b19e5c8e2843543087d67e47be222">getSyncScopeID</a>()];</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      <a class="code" href="classllvm_1_1OptimizationRemarkEmitter.html">OptimizationRemarkEmitter</a> ORE(AI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>());</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;      ORE.emit([&amp;]() {</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1OptimizationRemark.html">OptimizationRemark</a>(<a class="code" href="AtomicExpandPass_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a>, <span class="stringliteral">&quot;Passed&quot;</span>, AI)</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;A compare and swap loop was generated for an atomic &quot;</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;               &lt;&lt; AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#ae8a61b9349a5ea2fb1b3d856bd4e9ab2">getOperationName</a>(AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#a99fd4ef84981d6a2774c14c741b5ed65">getOperation</a>()) &lt;&lt; <span class="stringliteral">&quot; operation at &quot;</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;               &lt;&lt; MemScope &lt;&lt; <span class="stringliteral">&quot; memory scope&quot;</span>;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      });</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      <a class="code" href="namespacellvm.html#aa59c4ae8c95bb222039942e9ba995c3e">expandAtomicRMWToCmpXchg</a>(AI, <a class="code" href="AtomicExpandPass_8cpp.html#af9ea90f22a3fced77614ad93a197f7df">createCmpXchgInstFun</a>);</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    }</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  }</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84ae8e80c2bf991369add363ad75aa12137">TargetLoweringBase::AtomicExpansionKind::MaskedIntrinsic</a>: {</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    expandAtomicRMWToMaskedIntrinsic(AI);</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  }</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a54d9453ceeccd44c5fdf248680e03691">TargetLoweringBase::AtomicExpansionKind::BitTestIntrinsic</a>: {</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    TLI-&gt;emitBitTestAtomicRMWIntrinsic(AI);</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  }</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a2c51b098e554adf20d46c85b8551da43">TargetLoweringBase::AtomicExpansionKind::CmpArithIntrinsic</a>: {</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    TLI-&gt;emitCmpArithAtomicRMWIntrinsic(AI);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  }</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a56a57d29a3f9dda8671b4d6490a94b08">TargetLoweringBase::AtomicExpansionKind::NotAtomic</a>:</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#ac963dddf8453fc717992d3ce36a27d8b">lowerAtomicRMWInst</a>(AI);</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a8098b34f582537833b36b58273c3545b">TargetLoweringBase::AtomicExpansionKind::Expand</a>:</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    TLI-&gt;emitExpandAtomicRMW(AI);</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Unhandled case in tryExpandAtomicRMW&quot;</span>);</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  }</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;}</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160; </div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160; </div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="keyword">struct </span>PartwordMaskValues {</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  <span class="comment">// These three fields are guaranteed to be set by createMaskInstrs.</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *WordType = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *<a class="code" href="classllvm_1_1PointerUnion.html">ValueType</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *IntValueType = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *AlignedAddr = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  <a class="code" href="structllvm_1_1Align.html">Align</a> AlignedAddrAlignment;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  <span class="comment">// The remaining fields can be null.</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ShiftAmt = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">Mask</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Inv_Mask = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;};</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160; </div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<a class="code" href="Compiler_8h.html#acc1c483f4b4ee2f17bb6643a3b353609">LLVM_ATTRIBUTE_UNUSED</a></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;<a class="code" href="namespacellvm.html#a5ee0a415cf089775fd277550b257f74e">operator&lt;&lt;</a>(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a>, <span class="keyword">const</span> PartwordMaskValues &amp;PMV) {</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  <span class="keyword">auto</span> PrintObj = [&amp;<a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a>](<span class="keyword">auto</span> *V) {</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="keywordflow">if</span> (V)</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a> &lt;&lt; *V;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a> &lt;&lt; <span class="stringliteral">&quot;nullptr&quot;</span>;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  };</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a> &lt;&lt; <span class="stringliteral">&quot;PartwordMaskValues {\n&quot;</span>;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a> &lt;&lt; <span class="stringliteral">&quot;  WordType: &quot;</span>;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  PrintObj(PMV.WordType);</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a> &lt;&lt; <span class="stringliteral">&quot;  ValueType: &quot;</span>;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  PrintObj(PMV.ValueType);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a> &lt;&lt; <span class="stringliteral">&quot;  AlignedAddr: &quot;</span>;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  PrintObj(PMV.AlignedAddr);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a> &lt;&lt; <span class="stringliteral">&quot;  AlignedAddrAlignment: &quot;</span> &lt;&lt; PMV.AlignedAddrAlignment.value() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a> &lt;&lt; <span class="stringliteral">&quot;  ShiftAmt: &quot;</span>;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  PrintObj(PMV.ShiftAmt);</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a> &lt;&lt; <span class="stringliteral">&quot;  Mask: &quot;</span>;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  PrintObj(PMV.Mask);</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a> &lt;&lt; <span class="stringliteral">&quot;  Inv_Mask: &quot;</span>;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  PrintObj(PMV.Inv_Mask);</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a> &lt;&lt; <span class="stringliteral">&quot;}\n&quot;</span>;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">O</a>;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;}</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160; </div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;} <span class="comment">// end anonymous namespace</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="comment">/// This is a helper function which builds instructions to provide</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="comment">/// values necessary for partword atomic operations. It takes an</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="comment">/// incoming address, Addr, and ValueType, and constructs the address,</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="comment">/// shift-amounts and masks needed to work with a larger value of size</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="comment">/// WordSize.</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="comment">/// AlignedAddr: Addr rounded down to a multiple of WordSize</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="comment">/// ShiftAmt: Number of bits to right-shift a WordSize value loaded</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="comment">///           from AlignAddr for it to have the same value as if</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="comment">///           ValueType was loaded from Addr.</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="comment">/// Mask: Value to mask with the value loaded from AlignAddr to</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="comment">///       include only the part that would&#39;ve been loaded from Addr.</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="comment">/// Inv_Mask: The inverse of Mask.</span></div>
<div class="line"><a name="l00699"></a><span class="lineno"><a class="line" href="AtomicExpandPass_8cpp.html#a44f4e9b64d7a612f2b8236f0d147f591">  699</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> PartwordMaskValues <a class="code" href="AtomicExpandPass_8cpp.html#a44f4e9b64d7a612f2b8236f0d147f591">createMaskInstrs</a>(<a class="code" href="classllvm_1_1IRBuilderBase.html">IRBuilderBase</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>,</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                                           <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="classllvm_1_1Type.html">Type</a> *<a class="code" href="classllvm_1_1PointerUnion.html">ValueType</a>,</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                                           <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, <a class="code" href="structllvm_1_1Align.html">Align</a> AddrAlign,</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                                           <span class="keywordtype">unsigned</span> MinWordSize) {</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  PartwordMaskValues PMV;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160; </div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  <a class="code" href="classllvm_1_1Module.html">Module</a> *<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getModule();</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx = <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>-&gt;getContext();</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>-&gt;getDataLayout();</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;  <span class="keywordtype">unsigned</span> ValueSize = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(<a class="code" href="classllvm_1_1PointerUnion.html">ValueType</a>);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160; </div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  PMV.ValueType = PMV.IntValueType = <a class="code" href="namespacellvm.html#aee5ce376091dcd04eaaf3fe13a3f3e77">ValueType</a>;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  <span class="keywordflow">if</span> (PMV.ValueType-&gt;isFloatingPointTy())</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    PMV.IntValueType =</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        <a class="code" href="classllvm_1_1Type.html#acaf8e4c3e40e01e848c1fad5f05b81cd">Type::getIntNTy</a>(Ctx, <a class="code" href="classllvm_1_1PointerUnion.html">ValueType</a>-&gt;getPrimitiveSizeInBits());</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160; </div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  PMV.WordType = MinWordSize &gt; ValueSize ? <a class="code" href="classllvm_1_1Type.html#acaf8e4c3e40e01e848c1fad5f05b81cd">Type::getIntNTy</a>(Ctx, MinWordSize * 8)</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                                         : <a class="code" href="namespacellvm.html#aee5ce376091dcd04eaaf3fe13a3f3e77">ValueType</a>;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  <span class="keywordflow">if</span> (PMV.ValueType == PMV.WordType) {</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    PMV.AlignedAddr = <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    PMV.AlignedAddrAlignment = AddrAlign;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    PMV.ShiftAmt = <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(PMV.ValueType, 0);</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    PMV.Mask = <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(PMV.ValueType, ~0, <span class="comment">/*isSigned*/</span> <span class="keyword">true</span>);</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <span class="keywordflow">return</span> PMV;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  }</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160; </div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  PMV.AlignedAddrAlignment = <a class="code" href="ELFObjHandler_8cpp.html#a043cdaf7b89aaeeb127be5d93411637f">Align</a>(MinWordSize);</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160; </div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ValueSize &lt; MinWordSize);</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160; </div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <a class="code" href="classllvm_1_1PointerType.html">PointerType</a> *PtrTy = cast&lt;PointerType&gt;(<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>-&gt;getType());</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *WordPtrType = PMV.WordType-&gt;getPointerTo(PtrTy-&gt;<a class="code" href="classllvm_1_1PointerType.html#af8aeced5e71d2589fa3e9791043af5cb">getAddressSpace</a>());</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;  <a class="code" href="classllvm_1_1IntegerType.html">IntegerType</a> *IntTy = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIntPtrType(Ctx, PtrTy-&gt;<a class="code" href="classllvm_1_1PointerType.html#af8aeced5e71d2589fa3e9791043af5cb">getAddressSpace</a>());</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *PtrLSB;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160; </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  <span class="keywordflow">if</span> (AddrAlign &lt; MinWordSize) {</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    PMV.AlignedAddr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntrinsic(</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        Intrinsic::ptrmask, {PtrTy, IntTy},</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        {<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(IntTy, ~(<a class="code" href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a>)(MinWordSize - 1))}, <span class="keyword">nullptr</span>,</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        <span class="stringliteral">&quot;AlignedAddr&quot;</span>);</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160; </div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *AddrInt = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePtrToInt(<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, IntTy);</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    PtrLSB = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAnd(AddrInt, MinWordSize - 1, <span class="stringliteral">&quot;PtrLSB&quot;</span>);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    <span class="comment">// If the alignment is high enough, the LSB are known 0.</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    PMV.AlignedAddr = <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    PtrLSB = <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">ConstantInt::getNullValue</a>(IntTy);</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  }</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160; </div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.isLittleEndian()) {</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <span class="comment">// turn bytes into bits</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    PMV.ShiftAmt = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShl(PtrLSB, 3);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="comment">// turn bytes into bits, and count from the other side.</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    PMV.ShiftAmt = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShl(</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateXor(PtrLSB, MinWordSize - ValueSize), 3);</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  }</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160; </div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;  PMV.ShiftAmt = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateTrunc(PMV.ShiftAmt, PMV.WordType, <span class="stringliteral">&quot;ShiftAmt&quot;</span>);</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  PMV.Mask = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShl(</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(PMV.WordType, (1 &lt;&lt; (ValueSize * 8)) - 1), PMV.ShiftAmt,</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      <span class="stringliteral">&quot;Mask&quot;</span>);</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160; </div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  PMV.Inv_Mask = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateNot(PMV.Mask, <span class="stringliteral">&quot;Inv_Mask&quot;</span>);</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160; </div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  <span class="comment">// Cast for typed pointers.</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  PMV.AlignedAddr =</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(PMV.AlignedAddr, WordPtrType, <span class="stringliteral">&quot;AlignedAddr&quot;</span>);</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160; </div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  <span class="keywordflow">return</span> PMV;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;}</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160; </div>
<div class="line"><a name="l00771"></a><span class="lineno"><a class="line" href="AtomicExpandPass_8cpp.html#aa4b0153efde0ef6386025f1fee119879">  771</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="AtomicExpandPass_8cpp.html#aa4b0153efde0ef6386025f1fee119879">extractMaskedValue</a>(<a class="code" href="classllvm_1_1IRBuilderBase.html">IRBuilderBase</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *WideWord,</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                                 <span class="keyword">const</span> PartwordMaskValues &amp;PMV) {</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(WideWord-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() == PMV.WordType &amp;&amp; <span class="stringliteral">&quot;Widened type mismatch&quot;</span>);</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  <span class="keywordflow">if</span> (PMV.WordType == PMV.ValueType)</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <span class="keywordflow">return</span> WideWord;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160; </div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="lib_2Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateLShr(WideWord, PMV.ShiftAmt, <span class="stringliteral">&quot;shifted&quot;</span>);</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Trunc = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateTrunc(<a class="code" href="lib_2Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a>, PMV.IntValueType, <span class="stringliteral">&quot;extracted&quot;</span>);</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(Trunc, PMV.ValueType);</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;}</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160; </div>
<div class="line"><a name="l00782"></a><span class="lineno"><a class="line" href="AtomicExpandPass_8cpp.html#a7744d6d4b041b49813f8dc9115a1afc6">  782</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="AtomicExpandPass_8cpp.html#a7744d6d4b041b49813f8dc9115a1afc6">insertMaskedValue</a>(<a class="code" href="classllvm_1_1IRBuilderBase.html">IRBuilderBase</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *WideWord,</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                                <a class="code" href="classllvm_1_1Value.html">Value</a> *Updated, <span class="keyword">const</span> PartwordMaskValues &amp;PMV) {</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(WideWord-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() == PMV.WordType &amp;&amp; <span class="stringliteral">&quot;Widened type mismatch&quot;</span>);</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Updated-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>() == PMV.ValueType &amp;&amp; <span class="stringliteral">&quot;Value type mismatch&quot;</span>);</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  <span class="keywordflow">if</span> (PMV.WordType == PMV.ValueType)</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="keywordflow">return</span> Updated;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160; </div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;  Updated = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(Updated, PMV.IntValueType);</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160; </div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ZExt = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateZExt(Updated, PMV.WordType, <span class="stringliteral">&quot;extended&quot;</span>);</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="lib_2Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a> =</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShl(ZExt, PMV.ShiftAmt, <span class="stringliteral">&quot;shifted&quot;</span>, <span class="comment">/*HasNUW*/</span> <span class="keyword">true</span>);</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAnd(WideWord, PMV.Inv_Mask, <span class="stringliteral">&quot;unmasked&quot;</span>);</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea3a2d5fe857d8f9541136a124c2edec6c">Or</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateOr(<a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>, <a class="code" href="lib_2Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a>, <span class="stringliteral">&quot;inserted&quot;</span>);</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea3a2d5fe857d8f9541136a124c2edec6c">Or</a>;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;}</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment">/// Emit IR to implement a masked version of a given atomicrmw</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment">/// operation. (That is, only the bits under the Mask should be</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="comment">/// affected by the operation)</span></div>
<div class="line"><a name="l00802"></a><span class="lineno"><a class="line" href="AtomicExpandPass_8cpp.html#af2b0c668c546d1bbfb312717115e7235">  802</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="AtomicExpandPass_8cpp.html#af2b0c668c546d1bbfb312717115e7235">performMaskedAtomicOp</a>(<a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615">AtomicRMWInst::BinOp</a> <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>,</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                                    <a class="code" href="classllvm_1_1IRBuilderBase.html">IRBuilderBase</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *Loaded,</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;                                    <a class="code" href="classllvm_1_1Value.html">Value</a> *Shifted_Inc, <a class="code" href="classllvm_1_1Value.html">Value</a> *Inc,</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                                    <span class="keyword">const</span> PartwordMaskValues &amp;PMV) {</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <span class="comment">// TODO: update to use</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <span class="comment">// https://graphics.stanford.edu/~seander/bithacks.html#MaskedMerge in order</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  <span class="comment">// to merge bits from two values without requiring PMV.Inv_Mask.</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  <span class="keywordflow">switch</span> (<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>) {</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615afc870a548088c5b7a93a34f648889d77">AtomicRMWInst::Xchg</a>: {</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Loaded_MaskOut = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAnd(Loaded, PMV.Inv_Mask);</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *FinalVal = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateOr(Loaded_MaskOut, Shifted_Inc);</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <span class="keywordflow">return</span> FinalVal;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  }</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a5954f59053121b87ebe0c5fe79942c6e">AtomicRMWInst::Or</a>:</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a71aab8ee954b6d71a4eed315e8f6556e">AtomicRMWInst::Xor</a>:</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a660a31179bfecd737a256372e5fd6122">AtomicRMWInst::And</a>:</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Or/Xor/And handled by widenPartwordAtomicRMW&quot;</span>);</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a0794c42b44989f9d9f1454d79ca0dd88">AtomicRMWInst::Add</a>:</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a5db6ca0c3e18acd87290f22ccb2ce564">AtomicRMWInst::Sub</a>:</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615afdcdc631cf4fa6829fd7499cd06a306b">AtomicRMWInst::Nand</a>: {</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="comment">// The other arithmetic ops need to be masked into place.</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *NewVal = <a class="code" href="namespacellvm.html#a9af7e2dd206cc24d4690e1d2a996c43e">buildAtomicRMWValue</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, Loaded, Shifted_Inc);</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *NewVal_Masked = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAnd(NewVal, PMV.Mask);</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Loaded_MaskOut = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAnd(Loaded, PMV.Inv_Mask);</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *FinalVal = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateOr(Loaded_MaskOut, NewVal_Masked);</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="keywordflow">return</span> FinalVal;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  }</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615aa1184a7e35e94d162a2d40f2b11beeb2">AtomicRMWInst::Max</a>:</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a39edb6e51c1ad37244e8b32a2af4077d">AtomicRMWInst::Min</a>:</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615abe171d96ba8de66fb30e08c00211591e">AtomicRMWInst::UMax</a>:</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615aa53854e09143f57d2ff2ad6ac89dc55d">AtomicRMWInst::UMin</a>:</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a08ef06068dcd583c2476568dda59b324">AtomicRMWInst::FAdd</a>:</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a92f66d4bc04fc8514bee80509f3e78d4">AtomicRMWInst::FSub</a>:</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615abd5e733a10a36f3572105b1a67538e18">AtomicRMWInst::FMin</a>:</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615acce124326ba87b0127b36c412bf555fd">AtomicRMWInst::FMax</a>:</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a9334c9815ddc2b25804c6c03b68cc39b">AtomicRMWInst::UIncWrap</a>:</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615ad3ed1a8c334bc3a50d59aaa57ee9e9f3">AtomicRMWInst::UDecWrap</a>: {</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="comment">// Finally, other ops will operate on the full value, so truncate down to</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <span class="comment">// the original size, and expand out again after doing the</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    <span class="comment">// operation. Bitcasts will be inserted for FP values.</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Loaded_Extract = <a class="code" href="AtomicExpandPass_8cpp.html#aa4b0153efde0ef6386025f1fee119879">extractMaskedValue</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, Loaded, PMV);</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *NewVal = <a class="code" href="namespacellvm.html#a9af7e2dd206cc24d4690e1d2a996c43e">buildAtomicRMWValue</a>(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, Loaded_Extract, Inc);</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *FinalVal = <a class="code" href="AtomicExpandPass_8cpp.html#a7744d6d4b041b49813f8dc9115a1afc6">insertMaskedValue</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, Loaded, NewVal, PMV);</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <span class="keywordflow">return</span> FinalVal;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  }</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Unknown atomic op&quot;</span>);</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  }</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;}</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="comment">/// Expand a sub-word atomicrmw operation into an appropriate</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="comment">/// word-sized operation.</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="comment">/// It will create an LL/SC or cmpxchg loop, as appropriate, the same</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="comment">/// way as a typical atomicrmw expansion. The only difference here is</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="comment">/// that the operation inside of the loop may operate upon only a</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="comment">/// part of the value.</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> AtomicExpand::expandPartwordAtomicRMW(</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *AI, <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84">TargetLoweringBase::AtomicExpansionKind</a> ExpansionKind) {</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> MemOpOrder = AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#aefa60bfe67b4721c395ce966ac73b439">getOrdering</a>();</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  <a class="code" href="namespacellvm_1_1SyncScope.html#a80741d3f96133391b683effd8e5b77f0">SyncScope::ID</a> SSID = AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#ac97b19e5c8e2843543087d67e47be222">getSyncScopeID</a>();</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160; </div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  ReplacementIRBuilder <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(AI, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160; </div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  PartwordMaskValues PMV =</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      <a class="code" href="AtomicExpandPass_8cpp.html#a44f4e9b64d7a612f2b8236f0d147f591">createMaskInstrs</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, AI, AI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#a41a48e80366f5dbe6c065b5407d52c71">getPointerOperand</a>(),</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                       AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#a0b5bee42a0652f7f46ec24c924e610d7">getAlign</a>(), TLI-&gt;getMinCmpXchgSizeInBits() / 8);</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160; </div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ValOperand_Shifted = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  <span class="keywordflow">if</span> (AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#a99fd4ef84981d6a2774c14c741b5ed65">getOperation</a>() == <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615afc870a548088c5b7a93a34f648889d77">AtomicRMWInst::Xchg</a> ||</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;      AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#a99fd4ef84981d6a2774c14c741b5ed65">getOperation</a>() == <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a0794c42b44989f9d9f1454d79ca0dd88">AtomicRMWInst::Add</a> ||</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;      AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#a99fd4ef84981d6a2774c14c741b5ed65">getOperation</a>() == <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a5db6ca0c3e18acd87290f22ccb2ce564">AtomicRMWInst::Sub</a> ||</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#a99fd4ef84981d6a2774c14c741b5ed65">getOperation</a>() == <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615afdcdc631cf4fa6829fd7499cd06a306b">AtomicRMWInst::Nand</a>) {</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    ValOperand_Shifted =</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;        <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShl(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateZExt(AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#ad0c33604d4cd5e05ce5f285ed47ec5b8">getValOperand</a>(), PMV.WordType),</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                          PMV.ShiftAmt, <span class="stringliteral">&quot;ValOperand_Shifted&quot;</span>);</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  }</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160; </div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="keyword">auto</span> PerformPartwordOp = [&amp;](<a class="code" href="classllvm_1_1IRBuilderBase.html">IRBuilderBase</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *Loaded) {</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="AtomicExpandPass_8cpp.html#af2b0c668c546d1bbfb312717115e7235">performMaskedAtomicOp</a>(AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#a99fd4ef84981d6a2774c14c741b5ed65">getOperation</a>(), <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, Loaded,</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                                 ValOperand_Shifted, AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#ad0c33604d4cd5e05ce5f285ed47ec5b8">getValOperand</a>(), PMV);</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  };</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160; </div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *OldResult;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="keywordflow">if</span> (ExpansionKind == <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a369f472273bc816735055f13a6e6fd6c">TargetLoweringBase::AtomicExpansionKind::CmpXChg</a>) {</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    OldResult = insertRMWCmpXchgLoop(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, PMV.WordType, PMV.AlignedAddr,</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;                                     PMV.AlignedAddrAlignment, MemOpOrder, SSID,</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;                                     PerformPartwordOp, <a class="code" href="AtomicExpandPass_8cpp.html#af9ea90f22a3fced77614ad93a197f7df">createCmpXchgInstFun</a>);</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ExpansionKind == <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a2985b9c595be648a72a6dd08268c2218">TargetLoweringBase::AtomicExpansionKind::LLSC</a>);</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    OldResult = insertRMWLLSCLoop(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, PMV.WordType, PMV.AlignedAddr,</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;                                  PMV.AlignedAddrAlignment, MemOpOrder,</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                                  PerformPartwordOp);</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  }</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160; </div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *FinalOldResult = <a class="code" href="AtomicExpandPass_8cpp.html#aa4b0153efde0ef6386025f1fee119879">extractMaskedValue</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, OldResult, PMV);</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  AI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(FinalOldResult);</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  AI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;}</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160; </div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="comment">// Widen the bitwise atomicrmw (or/xor/and) to the minimum supported width.</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *AtomicExpand::widenPartwordAtomicRMW(<a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *AI) {</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  ReplacementIRBuilder <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(AI, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615">AtomicRMWInst::BinOp</a> <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#a99fd4ef84981d6a2774c14c741b5ed65">getOperation</a>();</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160; </div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> == <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a5954f59053121b87ebe0c5fe79942c6e">AtomicRMWInst::Or</a> || <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> == <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a71aab8ee954b6d71a4eed315e8f6556e">AtomicRMWInst::Xor</a> ||</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;          <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> == <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a660a31179bfecd737a256372e5fd6122">AtomicRMWInst::And</a>) &amp;&amp;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;         <span class="stringliteral">&quot;Unable to widen operation&quot;</span>);</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160; </div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  PartwordMaskValues PMV =</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;      <a class="code" href="AtomicExpandPass_8cpp.html#a44f4e9b64d7a612f2b8236f0d147f591">createMaskInstrs</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, AI, AI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#a41a48e80366f5dbe6c065b5407d52c71">getPointerOperand</a>(),</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                       AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#a0b5bee42a0652f7f46ec24c924e610d7">getAlign</a>(), TLI-&gt;getMinCmpXchgSizeInBits() / 8);</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160; </div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ValOperand_Shifted =</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShl(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateZExt(AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#ad0c33604d4cd5e05ce5f285ed47ec5b8">getValOperand</a>(), PMV.WordType),</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                        PMV.ShiftAmt, <span class="stringliteral">&quot;ValOperand_Shifted&quot;</span>);</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160; </div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewOperand;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160; </div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> == <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a660a31179bfecd737a256372e5fd6122">AtomicRMWInst::And</a>)</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    NewOperand =</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateOr(PMV.Inv_Mask, ValOperand_Shifted, <span class="stringliteral">&quot;AndOperand&quot;</span>);</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    NewOperand = ValOperand_Shifted;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160; </div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  <a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *NewAI =</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAtomicRMW(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>, PMV.AlignedAddr, NewOperand,</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                              PMV.AlignedAddrAlignment, AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#aefa60bfe67b4721c395ce966ac73b439">getOrdering</a>());</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160; </div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *FinalOldResult = <a class="code" href="AtomicExpandPass_8cpp.html#aa4b0153efde0ef6386025f1fee119879">extractMaskedValue</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, NewAI, PMV);</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  AI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(FinalOldResult);</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  AI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  <span class="keywordflow">return</span> NewAI;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;}</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160; </div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="keywordtype">bool</span> AtomicExpand::expandPartwordCmpXchg(<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html">AtomicCmpXchgInst</a> *CI) {</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  <span class="comment">// The basic idea here is that we&#39;re expanding a cmpxchg of a</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  <span class="comment">// smaller memory size up to a word-sized cmpxchg. To do this, we</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <span class="comment">// need to add a retry-loop for strong cmpxchg, so that</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  <span class="comment">// modifications to other parts of the word don&#39;t cause a spurious</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  <span class="comment">// failure.</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160; </div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;  <span class="comment">// This generates code like the following:</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <span class="comment">//     [[Setup mask values PMV.*]]</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  <span class="comment">//     %NewVal_Shifted = shl i32 %NewVal, %PMV.ShiftAmt</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <span class="comment">//     %Cmp_Shifted = shl i32 %Cmp, %PMV.ShiftAmt</span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  <span class="comment">//     %InitLoaded = load i32* %addr</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  <span class="comment">//     %InitLoaded_MaskOut = and i32 %InitLoaded, %PMV.Inv_Mask</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  <span class="comment">//     br partword.cmpxchg.loop</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  <span class="comment">// partword.cmpxchg.loop:</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  <span class="comment">//     %Loaded_MaskOut = phi i32 [ %InitLoaded_MaskOut, %entry ],</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  <span class="comment">//        [ %OldVal_MaskOut, %partword.cmpxchg.failure ]</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  <span class="comment">//     %FullWord_NewVal = or i32 %Loaded_MaskOut, %NewVal_Shifted</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  <span class="comment">//     %FullWord_Cmp = or i32 %Loaded_MaskOut, %Cmp_Shifted</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  <span class="comment">//     %NewCI = cmpxchg i32* %PMV.AlignedAddr, i32 %FullWord_Cmp,</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  <span class="comment">//        i32 %FullWord_NewVal success_ordering failure_ordering</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  <span class="comment">//     %OldVal = extractvalue { i32, i1 } %NewCI, 0</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  <span class="comment">//     %Success = extractvalue { i32, i1 } %NewCI, 1</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  <span class="comment">//     br i1 %Success, label %partword.cmpxchg.end,</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  <span class="comment">//        label %partword.cmpxchg.failure</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <span class="comment">// partword.cmpxchg.failure:</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  <span class="comment">//     %OldVal_MaskOut = and i32 %OldVal, %PMV.Inv_Mask</span></div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  <span class="comment">//     %ShouldContinue = icmp ne i32 %Loaded_MaskOut, %OldVal_MaskOut</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <span class="comment">//     br i1 %ShouldContinue, label %partword.cmpxchg.loop,</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="comment">//         label %partword.cmpxchg.end</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  <span class="comment">// partword.cmpxchg.end:</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  <span class="comment">//    %tmp1 = lshr i32 %OldVal, %PMV.ShiftAmt</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  <span class="comment">//    %FinalOldVal = trunc i32 %tmp1 to i8</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  <span class="comment">//    %tmp2 = insertvalue { i8, i1 } undef, i8 %FinalOldVal, 0</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <span class="comment">//    %Res = insertvalue { i8, i1 } %25, i1 %Success, 1</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160; </div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a> = CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a5a64c7ba0455d8d8652cf471cab58e6e">getPointerOperand</a>();</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a> = CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a54ba0d7cdad65aa333e7756b26536c8e">getCompareOperand</a>();</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewVal = CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a184ce4a2bacba9b5ab1bcd829c7a774b">getNewValOperand</a>();</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160; </div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  <a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getParent();</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  ReplacementIRBuilder <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(CI, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getContext();</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160; </div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *EndBB =</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;splitBasicBlock(CI-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>(), <span class="stringliteral">&quot;partword.cmpxchg.end&quot;</span>);</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  <span class="keyword">auto</span> FailureBB =</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html#ace940beeee97c222f836fe0ac70f6cf5">BasicBlock::Create</a>(Ctx, <span class="stringliteral">&quot;partword.cmpxchg.failure&quot;</span>, <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, EndBB);</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  <span class="keyword">auto</span> LoopBB = <a class="code" href="classllvm_1_1BasicBlock.html#ace940beeee97c222f836fe0ac70f6cf5">BasicBlock::Create</a>(Ctx, <span class="stringliteral">&quot;partword.cmpxchg.loop&quot;</span>, <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, FailureBB);</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160; </div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;  <span class="comment">// The split call above &quot;helpfully&quot; added a branch at the end of BB</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  <span class="comment">// (to the wrong place).</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  std::prev(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;end())-&gt;eraseFromParent();</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160; </div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  PartwordMaskValues PMV =</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;      <a class="code" href="AtomicExpandPass_8cpp.html#a44f4e9b64d7a612f2b8236f0d147f591">createMaskInstrs</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, CI, CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a54ba0d7cdad65aa333e7756b26536c8e">getCompareOperand</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>,</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;                       CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a86d413c1d3a59e65cd9fe1c67ea12b0a">getAlign</a>(), TLI-&gt;getMinCmpXchgSizeInBits() / 8);</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160; </div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <span class="comment">// Shift the incoming values over, into the right location in the word.</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewVal_Shifted =</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShl(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateZExt(NewVal, PMV.WordType), PMV.ShiftAmt);</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Cmp_Shifted =</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShl(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateZExt(Cmp, PMV.WordType), PMV.ShiftAmt);</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160; </div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  <span class="comment">// Load the entire current word, and mask into place the expected and new</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  <span class="comment">// values</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *InitLoaded = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateLoad(PMV.WordType, PMV.AlignedAddr);</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  InitLoaded-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ac363814e84ac1a3aa74798ff4d358a53">setVolatile</a>(CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a248ee22702ba698e7704486bcdfed852">isVolatile</a>());</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *InitLoaded_MaskOut = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAnd(InitLoaded, PMV.Inv_Mask);</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBr(LoopBB);</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160; </div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;  <span class="comment">// partword.cmpxchg.loop:</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(LoopBB);</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *Loaded_MaskOut = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePHI(PMV.WordType, 2);</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  Loaded_MaskOut-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(InitLoaded_MaskOut, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160; </div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  <span class="comment">// Mask/Or the expected and new values into place in the loaded word.</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *FullWord_NewVal = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateOr(Loaded_MaskOut, NewVal_Shifted);</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *FullWord_Cmp = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateOr(Loaded_MaskOut, Cmp_Shifted);</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;  <a class="code" href="classllvm_1_1AtomicCmpXchgInst.html">AtomicCmpXchgInst</a> *NewCI = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAtomicCmpXchg(</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;      PMV.AlignedAddr, FullWord_Cmp, FullWord_NewVal, PMV.AlignedAddrAlignment,</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;      CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#abb509fb245e8c6b6331b5dec01e80ac7">getSuccessOrdering</a>(), CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a514c327438f006bc3fe66da51943b5cb">getFailureOrdering</a>(), CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#aec330b83cce31f4c2c90ea2276bca6ea">getSyncScopeID</a>());</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;  NewCI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#aad0a6acef46d026f2137af84d656decc">setVolatile</a>(CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a248ee22702ba698e7704486bcdfed852">isVolatile</a>());</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;  <span class="comment">// When we&#39;re building a strong cmpxchg, we need a loop, so you</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  <span class="comment">// might think we could use a weak cmpxchg inside. But, using strong</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;  <span class="comment">// allows the below comparison for ShouldContinue, and we&#39;re</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  <span class="comment">// expecting the underlying cmpxchg to be a machine instruction,</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;  <span class="comment">// which is strong anyways.</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  NewCI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a1c6b80273f7c1e1906580aef14a48061">setWeak</a>(CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a91b66c93e687bd0ea2d74a896c09408b">isWeak</a>());</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160; </div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *OldVal = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateExtractValue(NewCI, 0);</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateExtractValue(NewCI, 1);</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160; </div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  <span class="keywordflow">if</span> (CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a91b66c93e687bd0ea2d74a896c09408b">isWeak</a>())</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBr(EndBB);</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCondBr(<a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a>, EndBB, FailureBB);</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160; </div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  <span class="comment">// partword.cmpxchg.failure:</span></div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(FailureBB);</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;  <span class="comment">// Upon failure, verify that the masked-out part of the loaded value</span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;  <span class="comment">// has been modified.  If it didn&#39;t, abort the cmpxchg, since the</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  <span class="comment">// masked-in part must&#39;ve.</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *OldVal_MaskOut = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAnd(OldVal, PMV.Inv_Mask);</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ShouldContinue = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateICmpNE(Loaded_MaskOut, OldVal_MaskOut);</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCondBr(ShouldContinue, LoopBB, EndBB);</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160; </div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  <span class="comment">// Add the second value to the phi from above</span></div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  Loaded_MaskOut-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(OldVal_MaskOut, FailureBB);</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160; </div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  <span class="comment">// partword.cmpxchg.end:</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(CI);</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160; </div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *FinalOldVal = <a class="code" href="AtomicExpandPass_8cpp.html#aa4b0153efde0ef6386025f1fee119879">extractMaskedValue</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, OldVal, PMV);</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Res = <a class="code" href="classllvm_1_1PoisonValue.html#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(CI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;  Res = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateInsertValue(Res, FinalOldVal, 0);</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;  Res = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateInsertValue(Res, <a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a>, 1);</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160; </div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  CI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Res);</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;  CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;}</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160; </div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="keywordtype">void</span> AtomicExpand::expandAtomicOpToLLSC(</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="classllvm_1_1Type.html">Type</a> *ResultType, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, <a class="code" href="structllvm_1_1Align.html">Align</a> AddrAlign,</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> MemOpOrder,</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    <a class="code" href="classllvm_1_1function__ref.html">function_ref</a>&lt;<a class="code" href="classllvm_1_1Value.html">Value</a> *(<a class="code" href="classllvm_1_1IRBuilderBase.html">IRBuilderBase</a> &amp;, <a class="code" href="classllvm_1_1Value.html">Value</a> *)&gt; PerformOp) {</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  ReplacementIRBuilder <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Loaded = insertRMWLLSCLoop(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, ResultType, <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, AddrAlign,</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;                                    MemOpOrder, PerformOp);</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160; </div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;  <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceAllUsesWith(Loaded);</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;  <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;}</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160; </div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="keywordtype">void</span> AtomicExpand::expandAtomicRMWToMaskedIntrinsic(<a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *AI) {</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  ReplacementIRBuilder <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(AI, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160; </div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  PartwordMaskValues PMV =</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;      <a class="code" href="AtomicExpandPass_8cpp.html#a44f4e9b64d7a612f2b8236f0d147f591">createMaskInstrs</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, AI, AI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#a41a48e80366f5dbe6c065b5407d52c71">getPointerOperand</a>(),</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;                       AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#a0b5bee42a0652f7f46ec24c924e610d7">getAlign</a>(), TLI-&gt;getMinCmpXchgSizeInBits() / 8);</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160; </div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  <span class="comment">// The value operand must be sign-extended for signed min/max so that the</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;  <span class="comment">// target&#39;s signed comparison instructions can be used. Otherwise, just</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;  <span class="comment">// zero-ext.</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html#afa0b2fa29ba074f2b6ec9ac11163f2d9">Instruction::CastOps</a> CastOp = Instruction::ZExt;</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;  <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615">AtomicRMWInst::BinOp</a> RMWOp = AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#a99fd4ef84981d6a2774c14c741b5ed65">getOperation</a>();</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  <span class="keywordflow">if</span> (RMWOp == <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615aa1184a7e35e94d162a2d40f2b11beeb2">AtomicRMWInst::Max</a> || RMWOp == <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a39edb6e51c1ad37244e8b32a2af4077d">AtomicRMWInst::Min</a>)</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    CastOp = Instruction::SExt;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160; </div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ValOperand_Shifted = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShl(</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCast(CastOp, AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#ad0c33604d4cd5e05ce5f285ed47ec5b8">getValOperand</a>(), PMV.WordType),</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;      PMV.ShiftAmt, <span class="stringliteral">&quot;ValOperand_Shifted&quot;</span>);</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *OldResult = TLI-&gt;emitMaskedAtomicRMWIntrinsic(</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, AI, PMV.AlignedAddr, ValOperand_Shifted, PMV.Mask, PMV.ShiftAmt,</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;      AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#aefa60bfe67b4721c395ce966ac73b439">getOrdering</a>());</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *FinalOldResult = <a class="code" href="AtomicExpandPass_8cpp.html#aa4b0153efde0ef6386025f1fee119879">extractMaskedValue</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, OldResult, PMV);</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;  AI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(FinalOldResult);</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  AI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;}</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160; </div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="keywordtype">void</span> AtomicExpand::expandAtomicCmpXchgToMaskedIntrinsic(<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html">AtomicCmpXchgInst</a> *CI) {</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  ReplacementIRBuilder <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(CI, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160; </div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  PartwordMaskValues PMV = <a class="code" href="AtomicExpandPass_8cpp.html#a44f4e9b64d7a612f2b8236f0d147f591">createMaskInstrs</a>(</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, CI, CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a54ba0d7cdad65aa333e7756b26536c8e">getCompareOperand</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a5a64c7ba0455d8d8652cf471cab58e6e">getPointerOperand</a>(),</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a86d413c1d3a59e65cd9fe1c67ea12b0a">getAlign</a>(), TLI-&gt;getMinCmpXchgSizeInBits() / 8);</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160; </div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *CmpVal_Shifted = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShl(</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateZExt(CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a54ba0d7cdad65aa333e7756b26536c8e">getCompareOperand</a>(), PMV.WordType), PMV.ShiftAmt,</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      <span class="stringliteral">&quot;CmpVal_Shifted&quot;</span>);</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewVal_Shifted = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateShl(</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateZExt(CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a184ce4a2bacba9b5ab1bcd829c7a774b">getNewValOperand</a>(), PMV.WordType), PMV.ShiftAmt,</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;      <span class="stringliteral">&quot;NewVal_Shifted&quot;</span>);</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *OldVal = TLI-&gt;emitMaskedAtomicCmpXchgIntrinsic(</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, CI, PMV.AlignedAddr, CmpVal_Shifted, NewVal_Shifted, PMV.Mask,</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a1ac603480e5e3cf5e17c5e646aaebea1">getMergedOrdering</a>());</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *FinalOldVal = <a class="code" href="AtomicExpandPass_8cpp.html#aa4b0153efde0ef6386025f1fee119879">extractMaskedValue</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, OldVal, PMV);</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Res = <a class="code" href="classllvm_1_1PoisonValue.html#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(CI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  Res = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateInsertValue(Res, FinalOldVal, 0);</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateICmpEQ(</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;      CmpVal_Shifted, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAnd(OldVal, PMV.Mask), <span class="stringliteral">&quot;Success&quot;</span>);</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  Res = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateInsertValue(Res, <a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a>, 1);</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160; </div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;  CI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Res);</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;  CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;}</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160; </div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<a class="code" href="classllvm_1_1Value.html">Value</a> *AtomicExpand::insertRMWLLSCLoop(</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    <a class="code" href="classllvm_1_1IRBuilderBase.html">IRBuilderBase</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="classllvm_1_1Type.html">Type</a> *ResultTy, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, <a class="code" href="structllvm_1_1Align.html">Align</a> AddrAlign,</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> MemOpOrder,</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    <a class="code" href="classllvm_1_1function__ref.html">function_ref</a>&lt;<a class="code" href="classllvm_1_1Value.html">Value</a> *(<a class="code" href="classllvm_1_1IRBuilderBase.html">IRBuilderBase</a> &amp;, <a class="code" href="classllvm_1_1Value.html">Value</a> *)&gt; PerformOp) {</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;  <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getContext();</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.GetInsertBlock();</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;  <a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getParent();</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160; </div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(AddrAlign &gt;=</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;             <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getParent()-&gt;getDataLayout().getTypeStoreSize(ResultTy) &amp;&amp;</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;         <span class="stringliteral">&quot;Expected at least natural alignment at this point.&quot;</span>);</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160; </div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;  <span class="comment">// Given: atomicrmw some_op iN* %addr, iN %incr ordering</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;  <span class="comment">// The standard expansion we produce is:</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;  <span class="comment">//     [...]</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;  <span class="comment">// atomicrmw.start:</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;  <span class="comment">//     %loaded = @load.linked(%addr)</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;  <span class="comment">//     %new = some_op iN %loaded, %incr</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;  <span class="comment">//     %stored = @store_conditional(%new, %addr)</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;  <span class="comment">//     %try_again = icmp i32 ne %stored, 0</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  <span class="comment">//     br i1 %try_again, label %loop, label %atomicrmw.end</span></div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  <span class="comment">// atomicrmw.end:</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;  <span class="comment">//     [...]</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *ExitBB =</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;splitBasicBlock(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.GetInsertPoint(), <span class="stringliteral">&quot;atomicrmw.end&quot;</span>);</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *LoopBB = <a class="code" href="classllvm_1_1BasicBlock.html#ace940beeee97c222f836fe0ac70f6cf5">BasicBlock::Create</a>(Ctx, <span class="stringliteral">&quot;atomicrmw.start&quot;</span>, <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, ExitBB);</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160; </div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;  <span class="comment">// The split call above &quot;helpfully&quot; added a branch at the end of BB (to the</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;  <span class="comment">// wrong place).</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;  std::prev(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;end())-&gt;eraseFromParent();</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBr(LoopBB);</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160; </div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  <span class="comment">// Start the main loop block now that we&#39;ve taken care of the preliminaries.</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(LoopBB);</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Loaded = TLI-&gt;emitLoadLinked(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, ResultTy, <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, MemOpOrder);</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160; </div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewVal = PerformOp(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, Loaded);</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160; </div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *StoreSuccess =</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;      TLI-&gt;emitStoreConditional(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, NewVal, <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, MemOpOrder);</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *TryAgain = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateICmpNE(</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;      StoreSuccess, <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(<a class="code" href="classllvm_1_1IntegerType.html#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(Ctx, 32), 0), <span class="stringliteral">&quot;tryagain&quot;</span>);</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCondBr(TryAgain, LoopBB, ExitBB);</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160; </div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(ExitBB, ExitBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;  <span class="keywordflow">return</span> Loaded;</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;}</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;<span class="comment">/// Convert an atomic cmpxchg of a non-integral type to an integer cmpxchg of</span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;<span class="comment">/// the equivalent bitwidth.  We used to not support pointer cmpxchg in the</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;<span class="comment">/// IR.  As a migration step, we convert back to what use to be the standard</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;<span class="comment">/// way to represent a pointer cmpxchg so that we can update backends one by</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="comment">/// one.</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1AtomicCmpXchgInst.html">AtomicCmpXchgInst</a> *</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;AtomicExpand::convertCmpXchgToIntegerType(<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html">AtomicCmpXchgInst</a> *CI) {</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;  <span class="keyword">auto</span> *<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a> = CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>();</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *NewTy = getCorrespondingIntegerType(CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a54ba0d7cdad65aa333e7756b26536c8e">getCompareOperand</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(),</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;                                            <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>-&gt;getDataLayout());</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160; </div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;  ReplacementIRBuilder <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(CI, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160; </div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a> = CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a5a64c7ba0455d8d8652cf471cab58e6e">getPointerOperand</a>();</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *PT = <a class="code" href="classllvm_1_1PointerType.html#a050a395d1656e546679d8b144d951bb2">PointerType::get</a>(NewTy, <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>-&gt;getType()-&gt;getPointerAddressSpace());</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewAddr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, PT);</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160; </div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewCmp = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePtrToInt(CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a54ba0d7cdad65aa333e7756b26536c8e">getCompareOperand</a>(), NewTy);</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewNewVal = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePtrToInt(CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a184ce4a2bacba9b5ab1bcd829c7a774b">getNewValOperand</a>(), NewTy);</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160; </div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;  <span class="keyword">auto</span> *NewCI = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAtomicCmpXchg(</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;      NewAddr, NewCmp, NewNewVal, CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a86d413c1d3a59e65cd9fe1c67ea12b0a">getAlign</a>(), CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#abb509fb245e8c6b6331b5dec01e80ac7">getSuccessOrdering</a>(),</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;      CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a514c327438f006bc3fe66da51943b5cb">getFailureOrdering</a>(), CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#aec330b83cce31f4c2c90ea2276bca6ea">getSyncScopeID</a>());</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  NewCI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#aad0a6acef46d026f2137af84d656decc">setVolatile</a>(CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a248ee22702ba698e7704486bcdfed852">isVolatile</a>());</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;  NewCI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a1c6b80273f7c1e1906580aef14a48061">setWeak</a>(CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a91b66c93e687bd0ea2d74a896c09408b">isWeak</a>());</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;  <a class="code" href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Replaced &quot;</span> &lt;&lt; *CI &lt;&lt; <span class="stringliteral">&quot; with &quot;</span> &lt;&lt; *NewCI &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160; </div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *OldVal = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateExtractValue(NewCI, 0);</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Succ = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateExtractValue(NewCI, 1);</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160; </div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;  OldVal = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntToPtr(OldVal, CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a54ba0d7cdad65aa333e7756b26536c8e">getCompareOperand</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160; </div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Res = <a class="code" href="classllvm_1_1PoisonValue.html#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(CI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;  Res = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateInsertValue(Res, OldVal, 0);</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;  Res = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateInsertValue(Res, Succ, 1);</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160; </div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;  CI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Res);</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;  CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;  <span class="keywordflow">return</span> NewCI;</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;}</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160; </div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;<span class="keywordtype">bool</span> AtomicExpand::expandAtomicCmpXchg(<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html">AtomicCmpXchgInst</a> *CI) {</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;  <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> SuccessOrder = CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#abb509fb245e8c6b6331b5dec01e80ac7">getSuccessOrdering</a>();</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;  <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> FailureOrder = CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a514c327438f006bc3fe66da51943b5cb">getFailureOrdering</a>();</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a> = CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a5a64c7ba0455d8d8652cf471cab58e6e">getPointerOperand</a>();</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;  <a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getParent();</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;  <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx = <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getContext();</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;  <span class="comment">// If shouldInsertFencesForAtomic() returns true, then the target does not</span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;  <span class="comment">// want to deal with memory orders, and emitLeading/TrailingFence should take</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;  <span class="comment">// care of everything. Otherwise, emitLeading/TrailingFence are no-op and we</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;  <span class="comment">// should preserve the ordering.</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;  <span class="keywordtype">bool</span> ShouldInsertFencesForAtomic = TLI-&gt;shouldInsertFencesForAtomic(CI);</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> MemOpOrder = ShouldInsertFencesForAtomic</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;                                  ? <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a14194d0b2e6c6680067975517cd58eac">AtomicOrdering::Monotonic</a></div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;                                  : CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a1ac603480e5e3cf5e17c5e646aaebea1">getMergedOrdering</a>();</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160; </div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;  <span class="comment">// In implementations which use a barrier to achieve release semantics, we can</span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;  <span class="comment">// delay emitting this barrier until we know a store is actually going to be</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  <span class="comment">// attempted. The cost of this delay is that we need 2 copies of the block</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;  <span class="comment">// emitting the load-linked, affecting code size.</span></div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  <span class="comment">// Ideally, this logic would be unconditional except for the minsize check</span></div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  <span class="comment">// since in other cases the extra blocks naturally collapse down to the</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;  <span class="comment">// minimal loop. Unfortunately, this puts too much stress on later</span></div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;  <span class="comment">// optimisations so we avoid emitting the extra logic in those cases too.</span></div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  <span class="keywordtype">bool</span> HasReleasedLoadBB = !CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a91b66c93e687bd0ea2d74a896c09408b">isWeak</a>() &amp;&amp; ShouldInsertFencesForAtomic &amp;&amp;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;                           SuccessOrder != <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a14194d0b2e6c6680067975517cd58eac">AtomicOrdering::Monotonic</a> &amp;&amp;</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;                           SuccessOrder != <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a993ca650a85e8e69b8f7eaa4809c4862">AtomicOrdering::Acquire</a> &amp;&amp;</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;                           !<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;hasMinSize();</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160; </div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;  <span class="comment">// There&#39;s no overhead for sinking the release barrier in a weak cmpxchg, so</span></div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;  <span class="comment">// do it even on minsize.</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;  <span class="keywordtype">bool</span> UseUnconditionalReleaseBarrier = <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;hasMinSize() &amp;&amp; !CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a91b66c93e687bd0ea2d74a896c09408b">isWeak</a>();</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160; </div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;  <span class="comment">// Given: cmpxchg some_op iN* %addr, iN %desired, iN %new success_ord fail_ord</span></div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;  <span class="comment">// The full expansion we produce is:</span></div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;  <span class="comment">//     [...]</span></div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;  <span class="comment">// %aligned.addr = ...</span></div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;  <span class="comment">// cmpxchg.start:</span></div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  <span class="comment">//     %unreleasedload = @load.linked(%aligned.addr)</span></div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;  <span class="comment">//     %unreleasedload.extract = extract value from %unreleasedload</span></div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;  <span class="comment">//     %should_store = icmp eq %unreleasedload.extract, %desired</span></div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;  <span class="comment">//     br i1 %should_store, label %cmpxchg.releasingstore,</span></div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;  <span class="comment">//                          label %cmpxchg.nostore</span></div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;  <span class="comment">// cmpxchg.releasingstore:</span></div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  <span class="comment">//     fence?</span></div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;  <span class="comment">//     br label cmpxchg.trystore</span></div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;  <span class="comment">// cmpxchg.trystore:</span></div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  <span class="comment">//     %loaded.trystore = phi [%unreleasedload, %cmpxchg.releasingstore],</span></div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;  <span class="comment">//                            [%releasedload, %cmpxchg.releasedload]</span></div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;  <span class="comment">//     %updated.new = insert %new into %loaded.trystore</span></div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;  <span class="comment">//     %stored = @store_conditional(%updated.new, %aligned.addr)</span></div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  <span class="comment">//     %success = icmp eq i32 %stored, 0</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;  <span class="comment">//     br i1 %success, label %cmpxchg.success,</span></div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;  <span class="comment">//                     label %cmpxchg.releasedload/%cmpxchg.failure</span></div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;  <span class="comment">// cmpxchg.releasedload:</span></div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;  <span class="comment">//     %releasedload = @load.linked(%aligned.addr)</span></div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;  <span class="comment">//     %releasedload.extract = extract value from %releasedload</span></div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;  <span class="comment">//     %should_store = icmp eq %releasedload.extract, %desired</span></div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;  <span class="comment">//     br i1 %should_store, label %cmpxchg.trystore,</span></div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;  <span class="comment">//                          label %cmpxchg.failure</span></div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;  <span class="comment">// cmpxchg.success:</span></div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;  <span class="comment">//     fence?</span></div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;  <span class="comment">//     br label %cmpxchg.end</span></div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;  <span class="comment">// cmpxchg.nostore:</span></div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  <span class="comment">//     %loaded.nostore = phi [%unreleasedload, %cmpxchg.start],</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;  <span class="comment">//                           [%releasedload,</span></div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;  <span class="comment">//                               %cmpxchg.releasedload/%cmpxchg.trystore]</span></div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;  <span class="comment">//     @load_linked_fail_balance()?</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  <span class="comment">//     br label %cmpxchg.failure</span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;  <span class="comment">// cmpxchg.failure:</span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;  <span class="comment">//     fence?</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;  <span class="comment">//     br label %cmpxchg.end</span></div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;  <span class="comment">// cmpxchg.end:</span></div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;  <span class="comment">//     %loaded.exit = phi [%loaded.nostore, %cmpxchg.failure],</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;  <span class="comment">//                        [%loaded.trystore, %cmpxchg.trystore]</span></div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;  <span class="comment">//     %success = phi i1 [true, %cmpxchg.success], [false, %cmpxchg.failure]</span></div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;  <span class="comment">//     %loaded = extract value from %loaded.exit</span></div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;  <span class="comment">//     %restmp = insertvalue { iN, i1 } undef, iN %loaded, 0</span></div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;  <span class="comment">//     %res = insertvalue { iN, i1 } %restmp, i1 %success, 1</span></div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;  <span class="comment">//     [...]</span></div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *ExitBB = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;splitBasicBlock(CI-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>(), <span class="stringliteral">&quot;cmpxchg.end&quot;</span>);</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;  <span class="keyword">auto</span> FailureBB = <a class="code" href="classllvm_1_1BasicBlock.html#ace940beeee97c222f836fe0ac70f6cf5">BasicBlock::Create</a>(Ctx, <span class="stringliteral">&quot;cmpxchg.failure&quot;</span>, <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, ExitBB);</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;  <span class="keyword">auto</span> NoStoreBB = <a class="code" href="classllvm_1_1BasicBlock.html#ace940beeee97c222f836fe0ac70f6cf5">BasicBlock::Create</a>(Ctx, <span class="stringliteral">&quot;cmpxchg.nostore&quot;</span>, <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, FailureBB);</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;  <span class="keyword">auto</span> SuccessBB = <a class="code" href="classllvm_1_1BasicBlock.html#ace940beeee97c222f836fe0ac70f6cf5">BasicBlock::Create</a>(Ctx, <span class="stringliteral">&quot;cmpxchg.success&quot;</span>, <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, NoStoreBB);</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;  <span class="keyword">auto</span> ReleasedLoadBB =</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html#ace940beeee97c222f836fe0ac70f6cf5">BasicBlock::Create</a>(Ctx, <span class="stringliteral">&quot;cmpxchg.releasedload&quot;</span>, <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, SuccessBB);</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;  <span class="keyword">auto</span> TryStoreBB =</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html#ace940beeee97c222f836fe0ac70f6cf5">BasicBlock::Create</a>(Ctx, <span class="stringliteral">&quot;cmpxchg.trystore&quot;</span>, <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, ReleasedLoadBB);</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;  <span class="keyword">auto</span> ReleasingStoreBB =</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html#ace940beeee97c222f836fe0ac70f6cf5">BasicBlock::Create</a>(Ctx, <span class="stringliteral">&quot;cmpxchg.fencedstore&quot;</span>, <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, TryStoreBB);</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;  <span class="keyword">auto</span> StartBB = <a class="code" href="classllvm_1_1BasicBlock.html#ace940beeee97c222f836fe0ac70f6cf5">BasicBlock::Create</a>(Ctx, <span class="stringliteral">&quot;cmpxchg.start&quot;</span>, <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, ReleasingStoreBB);</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160; </div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;  ReplacementIRBuilder <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(CI, *<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160; </div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;  <span class="comment">// The split call above &quot;helpfully&quot; added a branch at the end of BB (to the</span></div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;  <span class="comment">// wrong place), but we might want a fence too. It&#39;s easiest to just remove</span></div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;  <span class="comment">// the branch entirely.</span></div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;  std::prev(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;end())-&gt;eraseFromParent();</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;  <span class="keywordflow">if</span> (ShouldInsertFencesForAtomic &amp;&amp; UseUnconditionalReleaseBarrier)</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    TLI-&gt;emitLeadingFence(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, CI, SuccessOrder);</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160; </div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;  PartwordMaskValues PMV =</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;      <a class="code" href="AtomicExpandPass_8cpp.html#a44f4e9b64d7a612f2b8236f0d147f591">createMaskInstrs</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, CI, CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a54ba0d7cdad65aa333e7756b26536c8e">getCompareOperand</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>,</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;                       CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a86d413c1d3a59e65cd9fe1c67ea12b0a">getAlign</a>(), TLI-&gt;getMinCmpXchgSizeInBits() / 8);</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBr(StartBB);</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160; </div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;  <span class="comment">// Start the main loop block now that we&#39;ve taken care of the preliminaries.</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(StartBB);</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *UnreleasedLoad =</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;      TLI-&gt;emitLoadLinked(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, PMV.WordType, PMV.AlignedAddr, MemOpOrder);</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *UnreleasedLoadExtract =</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;      <a class="code" href="AtomicExpandPass_8cpp.html#aa4b0153efde0ef6386025f1fee119879">extractMaskedValue</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, UnreleasedLoad, PMV);</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ShouldStore = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateICmpEQ(</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;      UnreleasedLoadExtract, CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a54ba0d7cdad65aa333e7756b26536c8e">getCompareOperand</a>(), <span class="stringliteral">&quot;should_store&quot;</span>);</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160; </div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  <span class="comment">// If the cmpxchg doesn&#39;t actually need any ordering when it fails, we can</span></div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  <span class="comment">// jump straight past that fence instruction (if it exists).</span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCondBr(ShouldStore, ReleasingStoreBB, NoStoreBB);</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160; </div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(ReleasingStoreBB);</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;  <span class="keywordflow">if</span> (ShouldInsertFencesForAtomic &amp;&amp; !UseUnconditionalReleaseBarrier)</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    TLI-&gt;emitLeadingFence(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, CI, SuccessOrder);</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBr(TryStoreBB);</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160; </div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(TryStoreBB);</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;  <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *LoadedTryStore =</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePHI(PMV.WordType, 2, <span class="stringliteral">&quot;loaded.trystore&quot;</span>);</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  LoadedTryStore-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(UnreleasedLoad, ReleasingStoreBB);</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewValueInsert =</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;      <a class="code" href="AtomicExpandPass_8cpp.html#a7744d6d4b041b49813f8dc9115a1afc6">insertMaskedValue</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, LoadedTryStore, CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a184ce4a2bacba9b5ab1bcd829c7a774b">getNewValOperand</a>(), PMV);</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *StoreSuccess = TLI-&gt;emitStoreConditional(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, NewValueInsert,</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;                                                  PMV.AlignedAddr, MemOpOrder);</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;  StoreSuccess = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateICmpEQ(</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;      StoreSuccess, <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(<a class="code" href="classllvm_1_1Type.html#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(Ctx), 0), <span class="stringliteral">&quot;success&quot;</span>);</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *RetryBB = HasReleasedLoadBB ? ReleasedLoadBB : StartBB;</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCondBr(StoreSuccess, SuccessBB,</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;                       CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a91b66c93e687bd0ea2d74a896c09408b">isWeak</a>() ? FailureBB : RetryBB);</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160; </div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(ReleasedLoadBB);</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *SecondLoad;</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;  <span class="keywordflow">if</span> (HasReleasedLoadBB) {</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    SecondLoad =</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;        TLI-&gt;emitLoadLinked(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, PMV.WordType, PMV.AlignedAddr, MemOpOrder);</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *SecondLoadExtract = <a class="code" href="AtomicExpandPass_8cpp.html#aa4b0153efde0ef6386025f1fee119879">extractMaskedValue</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, SecondLoad, PMV);</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    ShouldStore = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateICmpEQ(SecondLoadExtract,</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;                                       CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a54ba0d7cdad65aa333e7756b26536c8e">getCompareOperand</a>(), <span class="stringliteral">&quot;should_store&quot;</span>);</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160; </div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    <span class="comment">// If the cmpxchg doesn&#39;t actually need any ordering when it fails, we can</span></div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    <span class="comment">// jump straight past that fence instruction (if it exists).</span></div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCondBr(ShouldStore, TryStoreBB, NoStoreBB);</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;    <span class="comment">// Update PHI node in TryStoreBB.</span></div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    LoadedTryStore-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(SecondLoad, ReleasedLoadBB);</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;  } <span class="keywordflow">else</span></div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateUnreachable();</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160; </div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;  <span class="comment">// Make sure later instructions don&#39;t get reordered with a fence if</span></div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;  <span class="comment">// necessary.</span></div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(SuccessBB);</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;  <span class="keywordflow">if</span> (ShouldInsertFencesForAtomic ||</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;      TLI-&gt;shouldInsertTrailingFenceForAtomicStore(CI))</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    TLI-&gt;emitTrailingFence(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, CI, SuccessOrder);</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBr(ExitBB);</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160; </div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(NoStoreBB);</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;  <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *LoadedNoStore =</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePHI(UnreleasedLoad-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), 2, <span class="stringliteral">&quot;loaded.nostore&quot;</span>);</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;  LoadedNoStore-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(UnreleasedLoad, StartBB);</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;  <span class="keywordflow">if</span> (HasReleasedLoadBB)</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    LoadedNoStore-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(SecondLoad, ReleasedLoadBB);</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160; </div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;  <span class="comment">// In the failing case, where we don&#39;t execute the store-conditional, the</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;  <span class="comment">// target might want to balance out the load-linked with a dedicated</span></div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;  <span class="comment">// instruction (e.g., on ARM, clearing the exclusive monitor).</span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;  TLI-&gt;emitAtomicCmpXchgNoStoreLLBalance(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>);</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBr(FailureBB);</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160; </div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(FailureBB);</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;  <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *LoadedFailure =</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePHI(UnreleasedLoad-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), 2, <span class="stringliteral">&quot;loaded.failure&quot;</span>);</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;  LoadedFailure-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(LoadedNoStore, NoStoreBB);</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;  <span class="keywordflow">if</span> (CI-&gt;<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a91b66c93e687bd0ea2d74a896c09408b">isWeak</a>())</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    LoadedFailure-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(LoadedTryStore, TryStoreBB);</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;  <span class="keywordflow">if</span> (ShouldInsertFencesForAtomic)</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    TLI-&gt;emitTrailingFence(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, CI, FailureOrder);</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBr(ExitBB);</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160; </div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;  <span class="comment">// Finally, we have control-flow based knowledge of whether the cmpxchg</span></div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;  <span class="comment">// succeeded or not. We expose this to later passes by converting any</span></div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;  <span class="comment">// subsequent &quot;icmp eq/ne %loaded, %oldval&quot; into a use of an appropriate</span></div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;  <span class="comment">// PHI.</span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(ExitBB, ExitBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;  <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *LoadedExit =</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePHI(UnreleasedLoad-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), 2, <span class="stringliteral">&quot;loaded.exit&quot;</span>);</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;  LoadedExit-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(LoadedTryStore, SuccessBB);</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;  LoadedExit-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(LoadedFailure, FailureBB);</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePHI(<a class="code" href="classllvm_1_1Type.html#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(Ctx), 2, <span class="stringliteral">&quot;success&quot;</span>);</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  <a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a>-&gt;addIncoming(<a class="code" href="classllvm_1_1ConstantInt.html#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(Ctx), SuccessBB);</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;  <a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a>-&gt;addIncoming(<a class="code" href="classllvm_1_1ConstantInt.html#aa7cce62ac5cc6df09cce0535874336b7">ConstantInt::getFalse</a>(Ctx), FailureBB);</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160; </div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;  <span class="comment">// This is the &quot;exit value&quot; from the cmpxchg expansion. It may be of</span></div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;  <span class="comment">// a type wider than the one in the cmpxchg instruction.</span></div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *LoadedFull = LoadedExit;</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160; </div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(ExitBB, std::next(<a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a>-&gt;getIterator()));</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Loaded = <a class="code" href="AtomicExpandPass_8cpp.html#aa4b0153efde0ef6386025f1fee119879">extractMaskedValue</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, LoadedFull, PMV);</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160; </div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;  <span class="comment">// Look for any users of the cmpxchg that are just comparing the loaded value</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;  <span class="comment">// against the desired one, and replace them with the CFG-derived version.</span></div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;ExtractValueInst *, 2&gt;</a> PrunedInsts;</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="classllvm_1_1User.html">User</a> : CI-&gt;<a class="code" href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">users</a>()) {</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    <a class="code" href="classllvm_1_1ExtractValueInst.html">ExtractValueInst</a> *EV = dyn_cast&lt;ExtractValueInst&gt;(<a class="code" href="classllvm_1_1User.html">User</a>);</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    <span class="keywordflow">if</span> (!EV)</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160; </div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EV-&gt;<a class="code" href="classllvm_1_1ExtractValueInst.html#a0a21dcfb15673bbd3ac69eb4dfe7315e">getNumIndices</a>() == 1 &amp;&amp; EV-&gt;<a class="code" href="classllvm_1_1ExtractValueInst.html#a9ba97b7365f7fb9a08ae25982806b2a6">getIndices</a>()[0] &lt;= 1 &amp;&amp;</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;           <span class="stringliteral">&quot;weird extraction from { iN, i1 }&quot;</span>);</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160; </div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    <span class="keywordflow">if</span> (EV-&gt;<a class="code" href="classllvm_1_1ExtractValueInst.html#a9ba97b7365f7fb9a08ae25982806b2a6">getIndices</a>()[0] == 0)</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;      EV-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Loaded);</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;      EV-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(<a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a>);</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160; </div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    PrunedInsts.push_back(EV);</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  }</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160; </div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  <span class="comment">// We can remove the instructions now we&#39;re no longer iterating through them.</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *EV : PrunedInsts)</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    EV-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160; </div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;  <span class="keywordflow">if</span> (!CI-&gt;<a class="code" href="classllvm_1_1Value.html#a9d7de807ebdfe1819df3ff6cb0f16158">use_empty</a>()) {</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    <span class="comment">// Some use of the full struct return that we don&#39;t understand has happened,</span></div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    <span class="comment">// so we&#39;ve got to reconstruct it properly.</span></div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Res;</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    Res = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateInsertValue(<a class="code" href="classllvm_1_1PoisonValue.html#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(CI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()), Loaded, 0);</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    Res = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateInsertValue(Res, <a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a>, 1);</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160; </div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    CI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Res);</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;  }</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160; </div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;  CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;}</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160; </div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;<span class="keywordtype">bool</span> AtomicExpand::isIdempotentRMW(<a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *RMWI) {</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;  <span class="keyword">auto</span> <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;ConstantInt&gt;(RMWI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#ad0c33604d4cd5e05ce5f285ed47ec5b8">getValOperand</a>());</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>)</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160; </div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;  <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615">AtomicRMWInst::BinOp</a> <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = RMWI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#a99fd4ef84981d6a2774c14c741b5ed65">getOperation</a>();</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;  <span class="keywordflow">switch</span> (<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>) {</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a0794c42b44989f9d9f1454d79ca0dd88">AtomicRMWInst::Add</a>:</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a5db6ca0c3e18acd87290f22ccb2ce564">AtomicRMWInst::Sub</a>:</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a5954f59053121b87ebe0c5fe79942c6e">AtomicRMWInst::Or</a>:</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a71aab8ee954b6d71a4eed315e8f6556e">AtomicRMWInst::Xor</a>:</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;isZero();</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a660a31179bfecd737a256372e5fd6122">AtomicRMWInst::And</a>:</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;isMinusOne();</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;  <span class="comment">// FIXME: we could also treat Min/Max/UMin/UMax by the INT_MIN/INT_MAX/...</span></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;  <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;  }</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;}</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160; </div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;<span class="keywordtype">bool</span> AtomicExpand::simplifyIdempotentRMW(<a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *RMWI) {</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">auto</span> ResultingLoad = TLI-&gt;lowerIdempotentRMWIntoFencedLoad(RMWI)) {</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    tryExpandAtomicLoad(ResultingLoad);</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;  }</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;}</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160; </div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;<a class="code" href="classllvm_1_1Value.html">Value</a> *AtomicExpand::insertRMWCmpXchgLoop(</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;    <a class="code" href="classllvm_1_1IRBuilderBase.html">IRBuilderBase</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="classllvm_1_1Type.html">Type</a> *ResultTy, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, <a class="code" href="structllvm_1_1Align.html">Align</a> AddrAlign,</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;    <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> MemOpOrder, <a class="code" href="namespacellvm_1_1SyncScope.html#a80741d3f96133391b683effd8e5b77f0">SyncScope::ID</a> SSID,</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    <a class="code" href="classllvm_1_1function__ref.html">function_ref</a>&lt;<a class="code" href="classllvm_1_1Value.html">Value</a> *(<a class="code" href="classllvm_1_1IRBuilderBase.html">IRBuilderBase</a> &amp;, <a class="code" href="classllvm_1_1Value.html">Value</a> *)&gt; PerformOp,</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    <a class="code" href="classllvm_1_1function__ref.html">CreateCmpXchgInstFun</a> CreateCmpXchg) {</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;  <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getContext();</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.GetInsertBlock();</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;  <a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getParent();</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160; </div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;  <span class="comment">// Given: atomicrmw some_op iN* %addr, iN %incr ordering</span></div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;  <span class="comment">// The standard expansion we produce is:</span></div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;  <span class="comment">//     [...]</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;  <span class="comment">//     %init_loaded = load atomic iN* %addr</span></div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;  <span class="comment">//     br label %loop</span></div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;  <span class="comment">// loop:</span></div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;  <span class="comment">//     %loaded = phi iN [ %init_loaded, %entry ], [ %new_loaded, %loop ]</span></div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;  <span class="comment">//     %new = some_op iN %loaded, %incr</span></div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;  <span class="comment">//     %pair = cmpxchg iN* %addr, iN %loaded, iN %new</span></div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;  <span class="comment">//     %new_loaded = extractvalue { iN, i1 } %pair, 0</span></div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;  <span class="comment">//     %success = extractvalue { iN, i1 } %pair, 1</span></div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;  <span class="comment">//     br i1 %success, label %atomicrmw.end, label %loop</span></div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;  <span class="comment">// atomicrmw.end:</span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;  <span class="comment">//     [...]</span></div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *ExitBB =</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;      <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;splitBasicBlock(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.GetInsertPoint(), <span class="stringliteral">&quot;atomicrmw.end&quot;</span>);</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *LoopBB = <a class="code" href="classllvm_1_1BasicBlock.html#ace940beeee97c222f836fe0ac70f6cf5">BasicBlock::Create</a>(Ctx, <span class="stringliteral">&quot;atomicrmw.start&quot;</span>, <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, ExitBB);</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160; </div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;  <span class="comment">// The split call above &quot;helpfully&quot; added a branch at the end of BB (to the</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;  <span class="comment">// wrong place), but we want a load. It&#39;s easiest to just remove</span></div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;  <span class="comment">// the branch entirely.</span></div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;  std::prev(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;end())-&gt;eraseFromParent();</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;  <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *InitLoaded = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAlignedLoad(ResultTy, <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, AddrAlign);</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBr(LoopBB);</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160; </div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;  <span class="comment">// Start the main loop block now that we&#39;ve taken care of the preliminaries.</span></div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(LoopBB);</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;  <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *Loaded = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePHI(ResultTy, 2, <span class="stringliteral">&quot;loaded&quot;</span>);</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;  Loaded-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(InitLoaded, <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160; </div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewVal = PerformOp(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, Loaded);</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160; </div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewLoaded = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160; </div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;  CreateCmpXchg(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, Loaded, NewVal, AddrAlign,</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;                MemOpOrder == <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a288d468c5e0969f26a310773eda65603">AtomicOrdering::Unordered</a></div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;                    ? <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a14194d0b2e6c6680067975517cd58eac">AtomicOrdering::Monotonic</a></div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;                    : MemOpOrder,</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;                SSID, <a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a>, NewLoaded);</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a> &amp;&amp; NewLoaded);</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160; </div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;  Loaded-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(NewLoaded, LoopBB);</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160; </div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCondBr(<a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a>, ExitBB, LoopBB);</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160; </div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(ExitBB, ExitBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;  <span class="keywordflow">return</span> NewLoaded;</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;}</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160; </div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;<span class="keywordtype">bool</span> AtomicExpand::tryExpandAtomicCmpXchg(<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html">AtomicCmpXchgInst</a> *CI) {</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;  <span class="keywordtype">unsigned</span> MinCASSize = TLI-&gt;getMinCmpXchgSizeInBits() / 8;</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;  <span class="keywordtype">unsigned</span> ValueSize = <a class="code" href="AtomicExpandPass_8cpp.html#a2c4ed28bcf6025776c8aed0bf9159899">getAtomicOpSize</a>(CI);</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160; </div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;  <span class="keywordflow">switch</span> (TLI-&gt;shouldExpandAtomicCmpXchgInIR(CI)) {</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;  <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;    <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Unhandled case in tryExpandAtomicCmpXchg&quot;</span>);</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a6adf97f83acf6453d4a6a4b1070f3754">TargetLoweringBase::AtomicExpansionKind::None</a>:</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;    <span class="keywordflow">if</span> (ValueSize &lt; MinCASSize)</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;      <span class="keywordflow">return</span> expandPartwordCmpXchg(CI);</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a2985b9c595be648a72a6dd08268c2218">TargetLoweringBase::AtomicExpansionKind::LLSC</a>: {</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    <span class="keywordflow">return</span> expandAtomicCmpXchg(CI);</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;  }</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84ae8e80c2bf991369add363ad75aa12137">TargetLoweringBase::AtomicExpansionKind::MaskedIntrinsic</a>:</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    expandAtomicCmpXchgToMaskedIntrinsic(CI);</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a56a57d29a3f9dda8671b4d6490a94b08">TargetLoweringBase::AtomicExpansionKind::NotAtomic</a>:</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#ac306f2130698421f64f8a139faf38675">lowerAtomicCmpXchgInst</a>(CI);</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;  }</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;}</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160; </div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;<span class="comment">// Note: This function is exposed externally by AtomicExpandUtils.h</span></div>
<div class="line"><a name="l01576"></a><span class="lineno"><a class="line" href="namespacellvm.html#aa59c4ae8c95bb222039942e9ba995c3e"> 1576</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#aa59c4ae8c95bb222039942e9ba995c3e">llvm::expandAtomicRMWToCmpXchg</a>(<a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *AI,</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;                                    <a class="code" href="classllvm_1_1function__ref.html">CreateCmpXchgInstFun</a> CreateCmpXchg) {</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;  ReplacementIRBuilder <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(AI, AI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>()-&gt;<a class="code" href="classllvm_1_1Module.html#a6d883605206368bc536cc9ded97209b8">getDataLayout</a>());</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Loaded = AtomicExpand::insertRMWCmpXchgLoop(</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, AI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#a41a48e80366f5dbe6c065b5407d52c71">getPointerOperand</a>(), AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#a0b5bee42a0652f7f46ec24c924e610d7">getAlign</a>(),</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;      AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#aefa60bfe67b4721c395ce966ac73b439">getOrdering</a>(), AI-&gt;<a class="code" href="classllvm_1_1AtomicRMWInst.html#ac97b19e5c8e2843543087d67e47be222">getSyncScopeID</a>(),</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;      [&amp;](<a class="code" href="classllvm_1_1IRBuilderBase.html">IRBuilderBase</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *Loaded) {</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;        return buildAtomicRMWValue(AI-&gt;getOperation(), Builder, Loaded,</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;                                   AI-&gt;getValOperand());</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;      },</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      CreateCmpXchg);</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160; </div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;  AI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Loaded);</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;  AI-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;}</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160; </div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;<span class="comment">// In order to use one of the sized library calls such as</span></div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;<span class="comment">// __atomic_fetch_add_4, the alignment must be sufficient, the size</span></div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;<span class="comment">// must be one of the potentially-specialized sizes, and the value</span></div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="comment">// type must actually exist in C on the target (otherwise, the</span></div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="comment">// function wouldn&#39;t actually be defined.)</span></div>
<div class="line"><a name="l01598"></a><span class="lineno"><a class="line" href="AtomicExpandPass_8cpp.html#a6312845f74f9bb3101268e4598ae05a5"> 1598</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="AtomicExpandPass_8cpp.html#a6312845f74f9bb3101268e4598ae05a5">canUseSizedAtomicCall</a>(<span class="keywordtype">unsigned</span> Size, <a class="code" href="structllvm_1_1Align.html">Align</a> Alignment,</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;                                  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>) {</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;  <span class="comment">// TODO: &quot;LargestSize&quot; is an approximation for &quot;largest type that</span></div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;  <span class="comment">// you can express in C&quot;. It seems to be the case that int128 is</span></div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;  <span class="comment">// supported on all 64-bit platforms, otherwise only up to 64-bit</span></div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;  <span class="comment">// integers are supported. If we get this wrong, then we&#39;ll try to</span></div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;  <span class="comment">// call a sized libcall that doesn&#39;t actually exist. There should</span></div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;  <span class="comment">// really be some more reliable way in LLVM of determining integer</span></div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;  <span class="comment">// sizes which are valid in the target&#39;s C ABI...</span></div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;  <span class="keywordtype">unsigned</span> LargestSize = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getLargestLegalIntTypeSizeInBits() &gt;= 64 ? 16 : 8;</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;  <span class="keywordflow">return</span> Alignment &gt;= Size &amp;&amp;</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;         (Size == 1 || Size == 2 || Size == 4 || Size == 8 || Size == 16) &amp;&amp;</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;         Size &lt;= LargestSize;</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;}</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160; </div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;<span class="keywordtype">void</span> AtomicExpand::expandAtomicLoadToLibcall(<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespacellvm_1_1RTLIB.html#a50a0bab21f1d14a86a1483ec283e4447">RTLIB::Libcall</a> Libcalls[6] = {</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;      <a class="code" href="namespacellvm_1_1ISD.html#a22ea9cec080dd5f4f47ba234c2f59110a7c47226f266248f4b8c155b83601b109">RTLIB::ATOMIC_LOAD</a>,   RTLIB::ATOMIC_LOAD_1, RTLIB::ATOMIC_LOAD_2,</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;      RTLIB::ATOMIC_LOAD_4, RTLIB::ATOMIC_LOAD_8, RTLIB::ATOMIC_LOAD_16};</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1Check.html#a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396">Size</a> = <a class="code" href="AtomicExpandPass_8cpp.html#a2c4ed28bcf6025776c8aed0bf9159899">getAtomicOpSize</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160; </div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;  <span class="keywordtype">bool</span> expanded = expandAtomicOpToLibcall(</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Size, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getAlign(), <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getPointerOperand(), <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>,</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOrdering(), <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a56a57d29a3f9dda8671b4d6490a94b08">AtomicOrdering::NotAtomic</a>, Libcalls);</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;  <span class="keywordflow">if</span> (!expanded)</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;    <a class="code" href="namespacellvm.html#a7f2a3d4dcfee70225988aec53ff1e173">report_fatal_error</a>(<span class="stringliteral">&quot;expandAtomicOpToLibcall shouldn&#39;t fail for Load&quot;</span>);</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;}</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160; </div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="keywordtype">void</span> AtomicExpand::expandAtomicStoreToLibcall(<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespacellvm_1_1RTLIB.html#a50a0bab21f1d14a86a1483ec283e4447">RTLIB::Libcall</a> Libcalls[6] = {</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;      <a class="code" href="namespacellvm_1_1ISD.html#a22ea9cec080dd5f4f47ba234c2f59110a1db943abc1bf78a911daeb7b03d81de8">RTLIB::ATOMIC_STORE</a>,   RTLIB::ATOMIC_STORE_1, RTLIB::ATOMIC_STORE_2,</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;      RTLIB::ATOMIC_STORE_4, RTLIB::ATOMIC_STORE_8, RTLIB::ATOMIC_STORE_16};</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1Check.html#a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396">Size</a> = <a class="code" href="AtomicExpandPass_8cpp.html#a2c4ed28bcf6025776c8aed0bf9159899">getAtomicOpSize</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160; </div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;  <span class="keywordtype">bool</span> expanded = expandAtomicOpToLibcall(</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Size, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getAlign(), <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getPointerOperand(), <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getValueOperand(),</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;      <span class="keyword">nullptr</span>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOrdering(), <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a56a57d29a3f9dda8671b4d6490a94b08">AtomicOrdering::NotAtomic</a>, Libcalls);</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;  <span class="keywordflow">if</span> (!expanded)</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    <a class="code" href="namespacellvm.html#a7f2a3d4dcfee70225988aec53ff1e173">report_fatal_error</a>(<span class="stringliteral">&quot;expandAtomicOpToLibcall shouldn&#39;t fail for Store&quot;</span>);</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;}</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160; </div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;<span class="keywordtype">void</span> AtomicExpand::expandAtomicCASToLibcall(<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html">AtomicCmpXchgInst</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespacellvm_1_1RTLIB.html#a50a0bab21f1d14a86a1483ec283e4447">RTLIB::Libcall</a> Libcalls[6] = {</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;      RTLIB::ATOMIC_COMPARE_EXCHANGE,   RTLIB::ATOMIC_COMPARE_EXCHANGE_1,</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;      RTLIB::ATOMIC_COMPARE_EXCHANGE_2, RTLIB::ATOMIC_COMPARE_EXCHANGE_4,</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;      RTLIB::ATOMIC_COMPARE_EXCHANGE_8, RTLIB::ATOMIC_COMPARE_EXCHANGE_16};</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1Check.html#a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396">Size</a> = <a class="code" href="AtomicExpandPass_8cpp.html#a2c4ed28bcf6025776c8aed0bf9159899">getAtomicOpSize</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160; </div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;  <span class="keywordtype">bool</span> expanded = expandAtomicOpToLibcall(</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Size, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getAlign(), <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getPointerOperand(), <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNewValOperand(),</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getCompareOperand(), <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getSuccessOrdering(), <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getFailureOrdering(),</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;      Libcalls);</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;  <span class="keywordflow">if</span> (!expanded)</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;    <a class="code" href="namespacellvm.html#a7f2a3d4dcfee70225988aec53ff1e173">report_fatal_error</a>(<span class="stringliteral">&quot;expandAtomicOpToLibcall shouldn&#39;t fail for CAS&quot;</span>);</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;}</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160; </div>
<div class="line"><a name="l01654"></a><span class="lineno"><a class="line" href="AtomicExpandPass_8cpp.html#a24d8ddc93743b84813622f0c7c9f6f9a"> 1654</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;RTLIB::Libcall&gt;</a> <a class="code" href="AtomicExpandPass_8cpp.html#a24d8ddc93743b84813622f0c7c9f6f9a">GetRMWLibcall</a>(<a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615">AtomicRMWInst::BinOp</a> <a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>) {</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespacellvm_1_1RTLIB.html#a50a0bab21f1d14a86a1483ec283e4447">RTLIB::Libcall</a> LibcallsXchg[6] = {</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;      RTLIB::ATOMIC_EXCHANGE,   RTLIB::ATOMIC_EXCHANGE_1,</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;      RTLIB::ATOMIC_EXCHANGE_2, RTLIB::ATOMIC_EXCHANGE_4,</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;      RTLIB::ATOMIC_EXCHANGE_8, RTLIB::ATOMIC_EXCHANGE_16};</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespacellvm_1_1RTLIB.html#a50a0bab21f1d14a86a1483ec283e4447">RTLIB::Libcall</a> LibcallsAdd[6] = {</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;      RTLIB::UNKNOWN_LIBCALL,    RTLIB::ATOMIC_FETCH_ADD_1,</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;      RTLIB::ATOMIC_FETCH_ADD_2, RTLIB::ATOMIC_FETCH_ADD_4,</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;      RTLIB::ATOMIC_FETCH_ADD_8, RTLIB::ATOMIC_FETCH_ADD_16};</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespacellvm_1_1RTLIB.html#a50a0bab21f1d14a86a1483ec283e4447">RTLIB::Libcall</a> LibcallsSub[6] = {</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;      RTLIB::UNKNOWN_LIBCALL,    RTLIB::ATOMIC_FETCH_SUB_1,</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;      RTLIB::ATOMIC_FETCH_SUB_2, RTLIB::ATOMIC_FETCH_SUB_4,</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;      RTLIB::ATOMIC_FETCH_SUB_8, RTLIB::ATOMIC_FETCH_SUB_16};</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespacellvm_1_1RTLIB.html#a50a0bab21f1d14a86a1483ec283e4447">RTLIB::Libcall</a> LibcallsAnd[6] = {</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;      RTLIB::UNKNOWN_LIBCALL,    RTLIB::ATOMIC_FETCH_AND_1,</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;      RTLIB::ATOMIC_FETCH_AND_2, RTLIB::ATOMIC_FETCH_AND_4,</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;      RTLIB::ATOMIC_FETCH_AND_8, RTLIB::ATOMIC_FETCH_AND_16};</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespacellvm_1_1RTLIB.html#a50a0bab21f1d14a86a1483ec283e4447">RTLIB::Libcall</a> LibcallsOr[6] = {</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;      RTLIB::UNKNOWN_LIBCALL,   RTLIB::ATOMIC_FETCH_OR_1,</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;      RTLIB::ATOMIC_FETCH_OR_2, RTLIB::ATOMIC_FETCH_OR_4,</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;      RTLIB::ATOMIC_FETCH_OR_8, RTLIB::ATOMIC_FETCH_OR_16};</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespacellvm_1_1RTLIB.html#a50a0bab21f1d14a86a1483ec283e4447">RTLIB::Libcall</a> LibcallsXor[6] = {</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;      RTLIB::UNKNOWN_LIBCALL,    RTLIB::ATOMIC_FETCH_XOR_1,</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;      RTLIB::ATOMIC_FETCH_XOR_2, RTLIB::ATOMIC_FETCH_XOR_4,</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;      RTLIB::ATOMIC_FETCH_XOR_8, RTLIB::ATOMIC_FETCH_XOR_16};</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespacellvm_1_1RTLIB.html#a50a0bab21f1d14a86a1483ec283e4447">RTLIB::Libcall</a> LibcallsNand[6] = {</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;      RTLIB::UNKNOWN_LIBCALL,     RTLIB::ATOMIC_FETCH_NAND_1,</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;      RTLIB::ATOMIC_FETCH_NAND_2, RTLIB::ATOMIC_FETCH_NAND_4,</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;      RTLIB::ATOMIC_FETCH_NAND_8, RTLIB::ATOMIC_FETCH_NAND_16};</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160; </div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;  <span class="keywordflow">switch</span> (<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>) {</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a497e8f347648b1b2823ee0338c95f65f">AtomicRMWInst::BAD_BINOP</a>:</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;    <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Should not have BAD_BINOP.&quot;</span>);</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615afc870a548088c5b7a93a34f648889d77">AtomicRMWInst::Xchg</a>:</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(LibcallsXchg);</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a0794c42b44989f9d9f1454d79ca0dd88">AtomicRMWInst::Add</a>:</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(LibcallsAdd);</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a5db6ca0c3e18acd87290f22ccb2ce564">AtomicRMWInst::Sub</a>:</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(LibcallsSub);</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a660a31179bfecd737a256372e5fd6122">AtomicRMWInst::And</a>:</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(LibcallsAnd);</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a5954f59053121b87ebe0c5fe79942c6e">AtomicRMWInst::Or</a>:</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(LibcallsOr);</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a71aab8ee954b6d71a4eed315e8f6556e">AtomicRMWInst::Xor</a>:</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(LibcallsXor);</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615afdcdc631cf4fa6829fd7499cd06a306b">AtomicRMWInst::Nand</a>:</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(LibcallsNand);</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615aa1184a7e35e94d162a2d40f2b11beeb2">AtomicRMWInst::Max</a>:</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a39edb6e51c1ad37244e8b32a2af4077d">AtomicRMWInst::Min</a>:</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615abe171d96ba8de66fb30e08c00211591e">AtomicRMWInst::UMax</a>:</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615aa53854e09143f57d2ff2ad6ac89dc55d">AtomicRMWInst::UMin</a>:</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615acce124326ba87b0127b36c412bf555fd">AtomicRMWInst::FMax</a>:</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615abd5e733a10a36f3572105b1a67538e18">AtomicRMWInst::FMin</a>:</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a08ef06068dcd583c2476568dda59b324">AtomicRMWInst::FAdd</a>:</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a92f66d4bc04fc8514bee80509f3e78d4">AtomicRMWInst::FSub</a>:</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a9334c9815ddc2b25804c6c03b68cc39b">AtomicRMWInst::UIncWrap</a>:</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615ad3ed1a8c334bc3a50d59aaa57ee9e9f3">AtomicRMWInst::UDecWrap</a>:</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;    <span class="comment">// No atomic libcalls are available for max/min/umax/umin.</span></div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    <span class="keywordflow">return</span> {};</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;  }</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;  <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Unexpected AtomicRMW operation.&quot;</span>);</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;}</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160; </div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;<span class="keywordtype">void</span> AtomicExpand::expandAtomicRMWToLibcall(<a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;  <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;RTLIB::Libcall&gt;</a> Libcalls = <a class="code" href="AtomicExpandPass_8cpp.html#a24d8ddc93743b84813622f0c7c9f6f9a">GetRMWLibcall</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperation());</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160; </div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1Check.html#a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396">Size</a> = <a class="code" href="AtomicExpandPass_8cpp.html#a2c4ed28bcf6025776c8aed0bf9159899">getAtomicOpSize</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160; </div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;  <span class="keywordflow">if</span> (!Libcalls.<a class="code" href="classllvm_1_1ArrayRef.html#ac835b8735b1b2faec0efdca236e37d94">empty</a>())</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;    <a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a> = expandAtomicOpToLibcall(</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;        <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Size, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getAlign(), <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getPointerOperand(), <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getValOperand(),</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;        <span class="keyword">nullptr</span>, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOrdering(), <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a56a57d29a3f9dda8671b4d6490a94b08">AtomicOrdering::NotAtomic</a>, Libcalls);</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160; </div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;  <span class="comment">// The expansion failed: either there were no libcalls at all for</span></div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;  <span class="comment">// the operation (min/max), or there were only size-specialized</span></div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;  <span class="comment">// libcalls (add/sub/etc) and we needed a generic. So, expand to a</span></div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;  <span class="comment">// CAS libcall, via a CAS loop, instead.</span></div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a>) {</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;    <a class="code" href="namespacellvm.html#aa59c4ae8c95bb222039942e9ba995c3e">expandAtomicRMWToCmpXchg</a>(</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;        <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, [<span class="keyword">this</span>](<a class="code" href="classllvm_1_1IRBuilderBase.html">IRBuilderBase</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *Loaded,</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;                  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewVal, <a class="code" href="structllvm_1_1Align.html">Align</a> Alignment, <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> MemOpOrder,</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;                  <a class="code" href="namespacellvm_1_1SyncScope.html#a80741d3f96133391b683effd8e5b77f0">SyncScope::ID</a> SSID, <a class="code" href="classllvm_1_1Value.html">Value</a> *&amp;<a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *&amp;NewLoaded) {</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;          <span class="comment">// Create the CAS instruction normally...</span></div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;          <a class="code" href="classllvm_1_1AtomicCmpXchgInst.html">AtomicCmpXchgInst</a> *Pair = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAtomicCmpXchg(</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;              <a class="code" href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a>, Loaded, NewVal, Alignment, MemOpOrder,</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;              <a class="code" href="classllvm_1_1AtomicCmpXchgInst.html#a7ce03ab5b2a6006ebcdfe804e4c8f1a1">AtomicCmpXchgInst::getStrongestFailureOrdering</a>(MemOpOrder), SSID);</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;          <a class="code" href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateExtractValue(Pair, 1, <span class="stringliteral">&quot;success&quot;</span>);</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;          NewLoaded = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateExtractValue(Pair, 0, <span class="stringliteral">&quot;newloaded&quot;</span>);</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160; </div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;          <span class="comment">// ...and then expand the CAS into a libcall.</span></div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;          expandAtomicCASToLibcall(Pair);</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;        });</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;  }</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;}</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160; </div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;<span class="comment">// A helper routine for the above expandAtomic*ToLibcall functions.</span></div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;<span class="comment">// &#39;Libcalls&#39; contains an array of enum values for the particular</span></div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;<span class="comment">// ATOMIC libcalls to be emitted. All of the other arguments besides</span></div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;<span class="comment">// &#39;I&#39; are extracted from the Instruction subclass by the</span></div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;<span class="comment">// caller. Depending on the particular call, some will be null.</span></div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;<span class="keywordtype">bool</span> AtomicExpand::expandAtomicOpToLibcall(</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="keywordtype">unsigned</span> Size, <a class="code" href="structllvm_1_1Align.html">Align</a> Alignment, <a class="code" href="classllvm_1_1Value.html">Value</a> *PointerOperand,</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *ValueOperand, <a class="code" href="classllvm_1_1Value.html">Value</a> *CASExpected, <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> Ordering,</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> Ordering2, <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;RTLIB::Libcall&gt;</a> Libcalls) {</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Libcalls.<a class="code" href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() == 6);</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160; </div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;  <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getContext();</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;  <a class="code" href="classllvm_1_1Module.html">Module</a> *<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getModule();</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>-&gt;getDataLayout();</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> AllocaBuilder(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getFunction()-&gt;getEntryBlock().front());</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160; </div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;  <span class="keywordtype">bool</span> UseSizedLibcall = <a class="code" href="AtomicExpandPass_8cpp.html#a6312845f74f9bb3101268e4598ae05a5">canUseSizedAtomicCall</a>(Size, Alignment, <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *SizedIntTy = <a class="code" href="classllvm_1_1Type.html#acaf8e4c3e40e01e848c1fad5f05b81cd">Type::getIntNTy</a>(Ctx, Size * 8);</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160; </div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;  <span class="keyword">const</span> <a class="code" href="structllvm_1_1Align.html">Align</a> AllocaAlignment = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getPrefTypeAlign(SizedIntTy);</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160; </div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;  <span class="comment">// TODO: the &quot;order&quot; argument type is &quot;int&quot;, not int32. So</span></div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;  <span class="comment">// getInt32Ty may be wrong if the arch uses e.g. 16-bit ints.</span></div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *SizeVal64 = <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(<a class="code" href="classllvm_1_1Type.html#a05186fa23e4d11b9855a9599ba87a4b7">Type::getInt64Ty</a>(Ctx), Size);</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Ordering != <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a56a57d29a3f9dda8671b4d6490a94b08">AtomicOrdering::NotAtomic</a> &amp;&amp; <span class="stringliteral">&quot;expect atomic MO&quot;</span>);</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *OrderingVal =</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;      <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(<a class="code" href="classllvm_1_1Type.html#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(Ctx), (<span class="keywordtype">int</span>)<a class="code" href="namespacellvm.html#a66e6f90f41f1ea69d5ee532384f0af4e">toCABI</a>(Ordering));</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Ordering2Val = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;  <span class="keywordflow">if</span> (CASExpected) {</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Ordering2 != <a class="code" href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a56a57d29a3f9dda8671b4d6490a94b08">AtomicOrdering::NotAtomic</a> &amp;&amp; <span class="stringliteral">&quot;expect atomic MO&quot;</span>);</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;    Ordering2Val =</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;        <a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(<a class="code" href="classllvm_1_1Type.html#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(Ctx), (<span class="keywordtype">int</span>)<a class="code" href="namespacellvm.html#a66e6f90f41f1ea69d5ee532384f0af4e">toCABI</a>(Ordering2));</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;  }</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;  <span class="keywordtype">bool</span> HasResult = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType() != <a class="code" href="classllvm_1_1Type.html#a6e20e76960d952de088354cbcd14c3ab">Type::getVoidTy</a>(Ctx);</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160; </div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;  <a class="code" href="namespacellvm_1_1RTLIB.html#a50a0bab21f1d14a86a1483ec283e4447">RTLIB::Libcall</a> RTLibType;</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;  <span class="keywordflow">if</span> (UseSizedLibcall) {</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;    <span class="keywordflow">switch</span> (Size) {</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;    <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;      RTLibType = Libcalls[1];</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;    <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;      RTLibType = Libcalls[2];</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;    <span class="keywordflow">case</span> 4:</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;      RTLibType = Libcalls[3];</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;    <span class="keywordflow">case</span> 8:</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;      RTLibType = Libcalls[4];</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;    <span class="keywordflow">case</span> 16:</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;      RTLibType = Libcalls[5];</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;    }</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Libcalls[0] != RTLIB::UNKNOWN_LIBCALL) {</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;    RTLibType = Libcalls[0];</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;    <span class="comment">// Can&#39;t use sized function, and there&#39;s no generic for this</span></div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;    <span class="comment">// operation, so give up.</span></div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;  }</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160; </div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;  <span class="keywordflow">if</span> (!TLI-&gt;getLibcallName(RTLibType)) {</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;    <span class="comment">// This target does not implement the requested atomic libcall so give up.</span></div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;  }</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160; </div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;  <span class="comment">// Build up the function call. There&#39;s two kinds. First, the sized</span></div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;  <span class="comment">// variants.  These calls are going to be one of the following (with</span></div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;  <span class="comment">// N=1,2,4,8,16):</span></div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;  <span class="comment">//  iN    __atomic_load_N(iN *ptr, int ordering)</span></div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;  <span class="comment">//  void  __atomic_store_N(iN *ptr, iN val, int ordering)</span></div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;  <span class="comment">//  iN    __atomic_{exchange|fetch_*}_N(iN *ptr, iN val, int ordering)</span></div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;  <span class="comment">//  bool  __atomic_compare_exchange_N(iN *ptr, iN *expected, iN desired,</span></div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;  <span class="comment">//                                    int success_order, int failure_order)</span></div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;  <span class="comment">// Note that these functions can be used for non-integer atomic</span></div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;  <span class="comment">// operations, the values just need to be bitcast to integers on the</span></div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;  <span class="comment">// way in and out.</span></div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;  <span class="comment">// And, then, the generic variants. They look like the following:</span></div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;  <span class="comment">//  void  __atomic_load(size_t size, void *ptr, void *ret, int ordering)</span></div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;  <span class="comment">//  void  __atomic_store(size_t size, void *ptr, void *val, int ordering)</span></div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;  <span class="comment">//  void  __atomic_exchange(size_t size, void *ptr, void *val, void *ret,</span></div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;  <span class="comment">//                          int ordering)</span></div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;  <span class="comment">//  bool  __atomic_compare_exchange(size_t size, void *ptr, void *expected,</span></div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;  <span class="comment">//                                  void *desired, int success_order,</span></div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;  <span class="comment">//                                  int failure_order)</span></div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;  <span class="comment">// The different signatures are built up depending on the</span></div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;  <span class="comment">// &#39;UseSizedLibcall&#39;, &#39;CASExpected&#39;, &#39;ValueOperand&#39;, and &#39;HasResult&#39;</span></div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;  <span class="comment">// variables.</span></div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160; </div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;  <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AllocaCASExpected = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *AllocaCASExpected_i8 = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;  <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AllocaValue = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *AllocaValue_i8 = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;  <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AllocaResult = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *AllocaResult_i8 = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160; </div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *ResultTy;</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 6&gt;</a> <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>;</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;  <a class="code" href="classllvm_1_1AttributeList.html">AttributeList</a> Attr;</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160; </div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;  <span class="comment">// &#39;size&#39; argument.</span></div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;  <span class="keywordflow">if</span> (!UseSizedLibcall) {</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;    <span class="comment">// Note, getIntPtrType is assumed equivalent to size_t.</span></div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;    <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>.push_back(<a class="code" href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">ConstantInt::get</a>(<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIntPtrType(Ctx), Size));</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;  }</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160; </div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;  <span class="comment">// &#39;ptr&#39; argument.</span></div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;  <span class="comment">// note: This assumes all address spaces share a common libfunc</span></div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;  <span class="comment">// implementation and that addresses are convertable.  For systems without</span></div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;  <span class="comment">// that property, we&#39;d need to extend this mechanism to support AS-specific</span></div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;  <span class="comment">// families of atomic intrinsics.</span></div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;  <span class="keyword">auto</span> PtrTypeAS = PointerOperand-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>();</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *PtrVal =</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(PointerOperand, <a class="code" href="classllvm_1_1Type.html#a7fe9ccd4893f4e2caa826126c09545ea">Type::getInt8PtrTy</a>(Ctx, PtrTypeAS));</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;  PtrVal = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAddrSpaceCast(PtrVal, <a class="code" href="classllvm_1_1Type.html#a7fe9ccd4893f4e2caa826126c09545ea">Type::getInt8PtrTy</a>(Ctx));</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;  <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>.push_back(PtrVal);</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160; </div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;  <span class="comment">// &#39;expected&#39; argument, if present.</span></div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;  <span class="keywordflow">if</span> (CASExpected) {</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;    AllocaCASExpected = AllocaBuilder.CreateAlloca(CASExpected-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    AllocaCASExpected-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#af3bb24b322533dbe8a63c84b18568fe1">setAlignment</a>(AllocaAlignment);</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;    <span class="keywordtype">unsigned</span> AllocaAS = AllocaCASExpected-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#ac106bea55dfb26f8b14676aac05bd89f">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>();</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160; </div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;    AllocaCASExpected_i8 = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;        AllocaCASExpected, <a class="code" href="classllvm_1_1Type.html#a7fe9ccd4893f4e2caa826126c09545ea">Type::getInt8PtrTy</a>(Ctx, AllocaAS));</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateLifetimeStart(AllocaCASExpected_i8, SizeVal64);</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAlignedStore(CASExpected, AllocaCASExpected, AllocaAlignment);</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;    <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>.push_back(AllocaCASExpected_i8);</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;  }</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160; </div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;  <span class="comment">// &#39;val&#39; argument (&#39;desired&#39; for cas), if present.</span></div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;  <span class="keywordflow">if</span> (ValueOperand) {</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;    <span class="keywordflow">if</span> (UseSizedLibcall) {</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *IntValue =</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;          <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitOrPointerCast(ValueOperand, SizedIntTy);</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;      <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>.push_back(IntValue);</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;      AllocaValue = AllocaBuilder.CreateAlloca(ValueOperand-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;      AllocaValue-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#af3bb24b322533dbe8a63c84b18568fe1">setAlignment</a>(AllocaAlignment);</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;      AllocaValue_i8 =</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;          <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(AllocaValue, <a class="code" href="classllvm_1_1Type.html#a7fe9ccd4893f4e2caa826126c09545ea">Type::getInt8PtrTy</a>(Ctx));</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateLifetimeStart(AllocaValue_i8, SizeVal64);</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAlignedStore(ValueOperand, AllocaValue, AllocaAlignment);</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;      <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>.push_back(AllocaValue_i8);</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;    }</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;  }</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160; </div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;  <span class="comment">// &#39;ret&#39; argument.</span></div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;  <span class="keywordflow">if</span> (!CASExpected &amp;&amp; HasResult &amp;&amp; !UseSizedLibcall) {</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;    AllocaResult = AllocaBuilder.CreateAlloca(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType());</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;    AllocaResult-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#af3bb24b322533dbe8a63c84b18568fe1">setAlignment</a>(AllocaAlignment);</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;    <span class="keywordtype">unsigned</span> AllocaAS = AllocaResult-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#ac106bea55dfb26f8b14676aac05bd89f">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>();</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;    AllocaResult_i8 =</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;        <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(AllocaResult, <a class="code" href="classllvm_1_1Type.html#a7fe9ccd4893f4e2caa826126c09545ea">Type::getInt8PtrTy</a>(Ctx, AllocaAS));</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateLifetimeStart(AllocaResult_i8, SizeVal64);</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;    <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>.push_back(AllocaResult_i8);</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;  }</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160; </div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;  <span class="comment">// &#39;ordering&#39; (&#39;success_order&#39; for cas) argument.</span></div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;  <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>.push_back(OrderingVal);</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160; </div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;  <span class="comment">// &#39;failure_order&#39; argument, if present.</span></div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;  <span class="keywordflow">if</span> (Ordering2Val)</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;    <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>.push_back(Ordering2Val);</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160; </div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;  <span class="comment">// Now, the return type.</span></div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;  <span class="keywordflow">if</span> (CASExpected) {</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;    ResultTy = <a class="code" href="classllvm_1_1Type.html#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(Ctx);</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;    Attr = Attr.<a class="code" href="classllvm_1_1AttributeList.html#a32c2b32d61cf856c6a5b2ceb3de7fd0d">addRetAttribute</a>(Ctx, Attribute::ZExt);</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (HasResult &amp;&amp; UseSizedLibcall)</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;    ResultTy = SizedIntTy;</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;    ResultTy = <a class="code" href="classllvm_1_1Type.html#a6e20e76960d952de088354cbcd14c3ab">Type::getVoidTy</a>(Ctx);</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160; </div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;  <span class="comment">// Done with setting up arguments and return types, create the call:</span></div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Type *, 6&gt;</a> ArgTys;</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a> : <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>)</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    ArgTys.push_back(<a class="code" href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a>-&gt;getType());</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;  <a class="code" href="classllvm_1_1FunctionType.html">FunctionType</a> *FnType = <a class="code" href="classllvm_1_1FunctionType.html#a7e89b55242c964ae61b7850e99cacef0">FunctionType::get</a>(ResultTy, ArgTys, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;  <a class="code" href="classllvm_1_1FunctionCallee.html">FunctionCallee</a> LibcallFn =</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;      <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>-&gt;getOrInsertFunction(TLI-&gt;getLibcallName(RTLibType), FnType, Attr);</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;  <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *<a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a> = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateCall(LibcallFn, <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>);</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;  <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a>-&gt;setAttributes(Attr);</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = <a class="code" href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">Call</a>;</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160; </div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;  <span class="comment">// And then, extract the results...</span></div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;  <span class="keywordflow">if</span> (ValueOperand &amp;&amp; !UseSizedLibcall)</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateLifetimeEnd(AllocaValue_i8, SizeVal64);</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160; </div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;  <span class="keywordflow">if</span> (CASExpected) {</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;    <span class="comment">// The final result from the CAS is {load of &#39;expected&#39; alloca, bool result</span></div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;    <span class="comment">// from call}</span></div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *FinalResultTy = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType();</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="classllvm_1_1PoisonValue.html#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(FinalResultTy);</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *ExpectedOut = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAlignedLoad(</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;        CASExpected-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), AllocaCASExpected, AllocaAlignment);</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateLifetimeEnd(AllocaCASExpected_i8, SizeVal64);</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;    V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateInsertValue(V, ExpectedOut, 0);</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;    V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateInsertValue(V, Result, 1);</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;    <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceAllUsesWith(V);</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (HasResult) {</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V;</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;    <span class="keywordflow">if</span> (UseSizedLibcall)</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;      V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitOrPointerCast(Result, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType());</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;      V = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateAlignedLoad(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType(), AllocaResult,</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;                                    AllocaAlignment);</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateLifetimeEnd(AllocaResult_i8, SizeVal64);</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;    }</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;    <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceAllUsesWith(V);</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;  }</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;  <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="anamespacellvm_1_1Check_html_a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396"><div class="ttname"><a href="namespacellvm_1_1Check.html#a067ee17412e800f03802fa9517685732a3450a9712780ac26b071f9da4288a396">llvm::Check::Size</a></div><div class="ttdeci">@ Size</div><div class="ttdef"><b>Definition:</b> <a href="FileCheck_8h_source.html#l00077">FileCheck.h:77</a></div></div>
<div class="ttc" id="aValueTypes_8h_html"><div class="ttname"><a href="ValueTypes_8h.html">ValueTypes.h</a></div></div>
<div class="ttc" id="aAtomicExpandPass_8cpp_html_a24d8ddc93743b84813622f0c7c9f6f9a"><div class="ttname"><a href="AtomicExpandPass_8cpp.html#a24d8ddc93743b84813622f0c7c9f6f9a">GetRMWLibcall</a></div><div class="ttdeci">static ArrayRef&lt; RTLIB::Libcall &gt; GetRMWLibcall(AtomicRMWInst::BinOp Op)</div><div class="ttdef"><b>Definition:</b> <a href="AtomicExpandPass_8cpp_source.html#l01654">AtomicExpandPass.cpp:1654</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_ae8a61b9349a5ea2fb1b3d856bd4e9ab2"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#ae8a61b9349a5ea2fb1b3d856bd4e9ab2">llvm::AtomicRMWInst::getOperationName</a></div><div class="ttdeci">static StringRef getOperationName(BinOp Op)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l01773">Instructions.cpp:1773</a></div></div>
<div class="ttc" id="anamespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">This is an optimization pass for GlobalISel generic memory operations.</div><div class="ttdef"><b>Definition:</b> <a href="AddressRanges_8h_source.html#l00018">AddressRanges.h:18</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_aa75984a442f2379de0c66018201fa628"><div class="ttname"><a href="classllvm_1_1Type.html#aa75984a442f2379de0c66018201fa628">llvm::Type::getInt1Ty</a></div><div class="ttdeci">static IntegerType * getInt1Ty(LLVMContext &amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00238">Type.cpp:238</a></div></div>
<div class="ttc" id="alib_2Target_2X86_2README_8txt_html_ac88fe1d3a61b056a4f64fbbb156a62ff"><div class="ttname"><a href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a></div><div class="ttdeci">We currently emits eax Perhaps this is what we really should generate is Is imull three or four cycles eax eax The current instruction priority is based on pattern complexity The former is more complex because it folds a load so the latter will not be emitted Perhaps we should use AddedComplexity to give LEA32r a higher priority We should always try to match LEA first since the LEA matching code does some estimate to determine whether the match is profitable if we care more about code then imull is better It s two bytes shorter than movl leal On a Pentium M</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2X86_2README_8txt_source.html#l00252">README.txt:252</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a4ba3a5be6c0e9b9e8a525de055836733"><div class="ttname"><a href="classllvm_1_1Instruction.html#a4ba3a5be6c0e9b9e8a525de055836733">llvm::Instruction::getModule</a></div><div class="ttdeci">const Module * getModule() const</div><div class="ttdoc">Return the module owning the function this instruction belongs to or nullptr it the function does not...</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00070">Instruction.cpp:70</a></div></div>
<div class="ttc" id="anamespacellvm_html_aac36edd0f1ce976f0025c98e88d3830ea3a2d5fe857d8f9541136a124c2edec6c"><div class="ttname"><a href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830ea3a2d5fe857d8f9541136a124c2edec6c">llvm::RecurKind::Or</a></div><div class="ttdeci">@ Or</div><div class="ttdoc">Bitwise or logical OR of integers.</div></div>
<div class="ttc" id="aclassllvm_1_1DataLayout_html"><div class="ttname"><a href="classllvm_1_1DataLayout.html">llvm::DataLayout</a></div><div class="ttdoc">A parsed version of the target data layout string in and methods for querying it.</div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00110">DataLayout.h:110</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AArch64PACKey_html_abf4394f452bde3f544999858d71e4b46"><div class="ttname"><a href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46">llvm::AArch64PACKey::ID</a></div><div class="ttdeci">ID</div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00790">AArch64BaseInfo.h:790</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a7fe9ccd4893f4e2caa826126c09545ea"><div class="ttname"><a href="classllvm_1_1Type.html#a7fe9ccd4893f4e2caa826126c09545ea">llvm::Type::getInt8PtrTy</a></div><div class="ttdeci">static PointerType * getInt8PtrTy(LLVMContext &amp;C, unsigned AS=0)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00293">Type.cpp:293</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a3b996fbf8458aafffc86cb98a68d0a47"><div class="ttname"><a href="classllvm_1_1Type.html#a3b996fbf8458aafffc86cb98a68d0a47">llvm::Type::isPointerTy</a></div><div class="ttdeci">bool isPointerTy() const</div><div class="ttdoc">True if this is an instance of PointerType.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00249">Type.h:249</a></div></div>
<div class="ttc" id="aAtomicExpandPass_8cpp_html_a6312845f74f9bb3101268e4598ae05a5"><div class="ttname"><a href="AtomicExpandPass_8cpp.html#a6312845f74f9bb3101268e4598ae05a5">canUseSizedAtomicCall</a></div><div class="ttdeci">static bool canUseSizedAtomicCall(unsigned Size, Align Alignment, const DataLayout &amp;DL)</div><div class="ttdef"><b>Definition:</b> <a href="AtomicExpandPass_8cpp_source.html#l01598">AtomicExpandPass.cpp:1598</a></div></div>
<div class="ttc" id="aAtomicOrdering_8h_html"><div class="ttname"><a href="AtomicOrdering_8h.html">AtomicOrdering.h</a></div></div>
<div class="ttc" id="aInstIterator_8h_html"><div class="ttname"><a href="InstIterator_8h.html">InstIterator.h</a></div></div>
<div class="ttc" id="aclassT_html"><div class="ttname"><a href="classT.html">T</a></div></div>
<div class="ttc" id="aclassllvm_1_1Function_html"><div class="ttname"><a href="classllvm_1_1Function.html">llvm::Function</a></div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00059">Function.h:59</a></div></div>
<div class="ttc" id="aPass_8h_html"><div class="ttname"><a href="Pass_8h.html">Pass.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_a461cfbbb5c7a57ab73210498923cf615a71aab8ee954b6d71a4eed315e8f6556e"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a71aab8ee954b6d71a4eed315e8f6556e">llvm::AtomicRMWInst::Xor</a></div><div class="ttdeci">@ Xor</div><div class="ttdoc">*p = old ^ v</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00744">Instructions.h:744</a></div></div>
<div class="ttc" id="aclassllvm_1_1PointerType_html_a050a395d1656e546679d8b144d951bb2"><div class="ttname"><a href="classllvm_1_1PointerType.html#a050a395d1656e546679d8b144d951bb2">llvm::PointerType::get</a></div><div class="ttdeci">static PointerType * get(Type *ElementType, unsigned AddressSpace)</div><div class="ttdoc">This constructs a pointer to an object of the specified type in a numbered address space.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00729">Type.cpp:729</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_a99fd4ef84981d6a2774c14c741b5ed65"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#a99fd4ef84981d6a2774c14c741b5ed65">llvm::AtomicRMWInst::getOperation</a></div><div class="ttdeci">BinOp getOperation() const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00812">Instructions.h:812</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_a461cfbbb5c7a57ab73210498923cf615"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615">llvm::AtomicRMWInst::BinOp</a></div><div class="ttdeci">BinOp</div><div class="ttdoc">This enumeration lists the possible modifications atomicrmw can make.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00730">Instructions.h:730</a></div></div>
<div class="ttc" id="aclassllvm_1_1AllocaInst_html_ac106bea55dfb26f8b14676aac05bd89f"><div class="ttname"><a href="classllvm_1_1AllocaInst.html#ac106bea55dfb26f8b14676aac05bd89f">llvm::AllocaInst::getType</a></div><div class="ttdeci">PointerType * getType() const</div><div class="ttdoc">Overload to return most specific pointer type.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00100">Instructions.h:100</a></div></div>
<div class="ttc" id="aLowerAtomic_8h_html"><div class="ttname"><a href="LowerAtomic_8h.html">LowerAtomic.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector</a></div><div class="ttdoc">This is a 'vector' (really, a variable-sized array), optimized for the case when the array is small.</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l01199">SmallVector.h:1199</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicCmpXchgInst_html_abb509fb245e8c6b6331b5dec01e80ac7"><div class="ttname"><a href="classllvm_1_1AtomicCmpXchgInst.html#abb509fb245e8c6b6331b5dec01e80ac7">llvm::AtomicCmpXchgInst::getSuccessOrdering</a></div><div class="ttdeci">AtomicOrdering getSuccessOrdering() const</div><div class="ttdoc">Returns the success ordering constraint of this cmpxchg instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00596">Instructions.h:596</a></div></div>
<div class="ttc" id="aSupport_2ErrorHandling_8h_html"><div class="ttname"><a href="Support_2ErrorHandling_8h.html">ErrorHandling.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a5ab2d0b0f0b8ceec3b907184e7567197"><div class="ttname"><a href="classllvm_1_1Type.html#a5ab2d0b0f0b8ceec3b907184e7567197">llvm::Type::getPointerAddressSpace</a></div><div class="ttdeci">unsigned getPointerAddressSpace() const</div><div class="ttdoc">Get the address space of this pointer or pointer vector type.</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00729">DerivedTypes.h:729</a></div></div>
<div class="ttc" id="aclassllvm_1_1IRBuilder_html"><div class="ttname"><a href="classllvm_1_1IRBuilder.html">llvm::IRBuilder</a></div><div class="ttdoc">This provides a uniform API for creating instructions and inserting them into a basic block: either a...</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l02550">IRBuilder.h:2550</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicCmpXchgInst_html_a248ee22702ba698e7704486bcdfed852"><div class="ttname"><a href="classllvm_1_1AtomicCmpXchgInst.html#a248ee22702ba698e7704486bcdfed852">llvm::AtomicCmpXchgInst::isVolatile</a></div><div class="ttdeci">bool isVolatile() const</div><div class="ttdoc">Return true if this is a cmpxchg from a volatile memory location.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00569">Instructions.h:569</a></div></div>
<div class="ttc" id="aclassllvm_1_1PointerType_html_af8aeced5e71d2589fa3e9791043af5cb"><div class="ttname"><a href="classllvm_1_1PointerType.html#af8aeced5e71d2589fa3e9791043af5cb">llvm::PointerType::getAddressSpace</a></div><div class="ttdeci">unsigned getAddressSpace() const</div><div class="ttdoc">Return the address space of the Pointer type.</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00682">DerivedTypes.h:682</a></div></div>
<div class="ttc" id="aclassllvm_1_1FunctionType_html_a7e89b55242c964ae61b7850e99cacef0"><div class="ttname"><a href="classllvm_1_1FunctionType.html#a7e89b55242c964ae61b7850e99cacef0">llvm::FunctionType::get</a></div><div class="ttdeci">static FunctionType * get(Type *Result, ArrayRef&lt; Type * &gt; Params, bool isVarArg)</div><div class="ttdoc">This static method is the primary way of constructing a FunctionType.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00363">Type.cpp:363</a></div></div>
<div class="ttc" id="aOptimizationRemarkEmitter_8h_html"><div class="ttname"><a href="OptimizationRemarkEmitter_8h.html">OptimizationRemarkEmitter.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_aba40628328a660c78a9d73cc209f5e84a2c51b098e554adf20d46c85b8551da43"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a2c51b098e554adf20d46c85b8551da43">llvm::TargetLoweringBase::AtomicExpansionKind::CmpArithIntrinsic</a></div><div class="ttdeci">@ CmpArithIntrinsic</div></div>
<div class="ttc" id="alib_2Target_2README_8txt_html_a8db36c82f32d6f6a4d35a00e55be03a8"><div class="ttname"><a href="lib_2Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a></div><div class="ttdeci">bool Shift</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2README_8txt_source.html#l00468">README.txt:468</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html"><div class="ttname"><a href="classllvm_1_1Type.html">llvm::Type</a></div><div class="ttdoc">The instances of the Type class are immutable: once they are created, they are never changed.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00045">Type.h:45</a></div></div>
<div class="ttc" id="anamespacellvm_1_1RTLIB_html_a50a0bab21f1d14a86a1483ec283e4447"><div class="ttname"><a href="namespacellvm_1_1RTLIB.html#a50a0bab21f1d14a86a1483ec283e4447">llvm::RTLIB::Libcall</a></div><div class="ttdeci">Libcall</div><div class="ttdoc">RTLIB::Libcall enum - This enum defines all of the runtime library calls the backend can emit.</div><div class="ttdef"><b>Definition:</b> <a href="RuntimeLibcalls_8h_source.html#l00030">RuntimeLibcalls.h:30</a></div></div>
<div class="ttc" id="aModule_8h_html"><div class="ttname"><a href="Module_8h.html">Module.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1AttributeList_html"><div class="ttname"><a href="classllvm_1_1AttributeList.html">llvm::AttributeList</a></div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8h_source.html#l00432">Attributes.h:432</a></div></div>
<div class="ttc" id="aclassllvm_1_1StoreInst_html_a55195fa18cf783fe74de0cced1ca6eb3"><div class="ttname"><a href="classllvm_1_1StoreInst.html#a55195fa18cf783fe74de0cced1ca6eb3">llvm::StoreInst::setAlignment</a></div><div class="ttdeci">void setAlignment(Align Align)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00349">Instructions.h:349</a></div></div>
<div class="ttc" id="aclassllvm_1_1LLVMContext_html_afb1d554403d05394caf57d2d28a9eab4"><div class="ttname"><a href="classllvm_1_1LLVMContext.html#afb1d554403d05394caf57d2d28a9eab4">llvm::LLVMContext::getSyncScopeNames</a></div><div class="ttdeci">void getSyncScopeNames(SmallVectorImpl&lt; StringRef &gt; &amp;SSNs) const</div><div class="ttdoc">getSyncScopeNames - Populates client supplied SmallVector with synchronization scope names registered...</div><div class="ttdef"><b>Definition:</b> <a href="LLVMContext_8cpp_source.html#l00314">LLVMContext.cpp:314</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoadInst_html_ad47eefa1d094f60494b6b927061ca001"><div class="ttname"><a href="classllvm_1_1LoadInst.html#ad47eefa1d094f60494b6b927061ca001">llvm::LoadInst::getPointerOperand</a></div><div class="ttdeci">Value * getPointerOperand()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00264">Instructions.h:264</a></div></div>
<div class="ttc" id="aCompiler_8h_html_acc1c483f4b4ee2f17bb6643a3b353609"><div class="ttname"><a href="Compiler_8h.html#acc1c483f4b4ee2f17bb6643a3b353609">LLVM_ATTRIBUTE_UNUSED</a></div><div class="ttdeci">#define LLVM_ATTRIBUTE_UNUSED</div><div class="ttdef"><b>Definition:</b> <a href="Compiler_8h_source.html#l00172">Compiler.h:172</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_aac5759c83abd6a4af236401a7cfe7a0f"><div class="ttname"><a href="classllvm_1_1Type.html#aac5759c83abd6a4af236401a7cfe7a0f">llvm::Type::isFloatingPointTy</a></div><div class="ttdeci">bool isFloatingPointTy() const</div><div class="ttdoc">Return true if this is one of the floating-point types.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00185">Type.h:185</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoadInst_html_af51c113a039c82f6870df5dc9666b5e3"><div class="ttname"><a href="classllvm_1_1LoadInst.html#af51c113a039c82f6870df5dc9666b5e3">llvm::LoadInst::getAlign</a></div><div class="ttdeci">Align getAlign() const</div><div class="ttdoc">Return the alignment of the access that is being performed.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00220">Instructions.h:220</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_a461cfbbb5c7a57ab73210498923cf615ad3ed1a8c334bc3a50d59aaa57ee9e9f3"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615ad3ed1a8c334bc3a50d59aaa57ee9e9f3">llvm::AtomicRMWInst::UDecWrap</a></div><div class="ttdeci">@ UDecWrap</div><div class="ttdoc">Decrement one until a minimum value or zero.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00774">Instructions.h:774</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a30dd396c5b40cd86c1591872e574ccdf"><div class="ttname"><a href="classllvm_1_1Type.html#a30dd396c5b40cd86c1591872e574ccdf">llvm::Type::getInt32Ty</a></div><div class="ttdeci">static IntegerType * getInt32Ty(LLVMContext &amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00241">Type.cpp:241</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_a461cfbbb5c7a57ab73210498923cf615abd5e733a10a36f3572105b1a67538e18"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615abd5e733a10a36f3572105b1a67538e18">llvm::AtomicRMWInst::FMin</a></div><div class="ttdeci">@ FMin</div><div class="ttdoc">*p = minnum(old, v) minnum matches the behavior of llvm.minnum.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00766">Instructions.h:766</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html_ac835b8735b1b2faec0efdca236e37d94"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#ac835b8735b1b2faec0efdca236e37d94">llvm::ArrayRef::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdoc">empty - Check if the array is empty.</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00158">ArrayRef.h:158</a></div></div>
<div class="ttc" id="aDebug_8h_html_a08efc68d15935eb8889400a46c3749ba"><div class="ttname"><a href="Debug_8h.html#a08efc68d15935eb8889400a46c3749ba">LLVM_DEBUG</a></div><div class="ttdeci">#define LLVM_DEBUG(X)</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8h_source.html#l00101">Debug.h:101</a></div></div>
<div class="ttc" id="aclassllvm_1_1StoreInst_html_aff28bd42ac76fc3e1c0e4db7f9e06f2d"><div class="ttname"><a href="classllvm_1_1StoreInst.html#aff28bd42ac76fc3e1c0e4db7f9e06f2d">llvm::StoreInst::setAtomic</a></div><div class="ttdeci">void setAtomic(AtomicOrdering Ordering, SyncScope::ID SSID=SyncScope::System)</div><div class="ttdoc">Sets the ordering constraint and the synchronization scope ID of this store instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00376">Instructions.h:376</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_a96d73bbd7af15cb1fc38c3f4a3bd82e9"><div class="ttname"><a href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a></div><div class="ttdeci">#define F(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00055">MD5.cpp:55</a></div></div>
<div class="ttc" id="anamespacellvm_html_a9bccbe67aaab722783ca4e7c504aaaa7a14194d0b2e6c6680067975517cd58eac"><div class="ttname"><a href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a14194d0b2e6c6680067975517cd58eac">llvm::AtomicOrdering::Monotonic</a></div><div class="ttdeci">@ Monotonic</div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html"><div class="ttname"><a href="classllvm_1_1BasicBlock.html">llvm::BasicBlock</a></div><div class="ttdoc">LLVM Basic Block Representation.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00055">BasicBlock.h:55</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_a41a48e80366f5dbe6c065b5407d52c71"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#a41a48e80366f5dbe6c065b5407d52c71">llvm::AtomicRMWInst::getPointerOperand</a></div><div class="ttdeci">Value * getPointerOperand()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00877">Instructions.h:877</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7c46c742c31be54870e2038048e6b391"><div class="ttname"><a href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">llvm::dbgs</a></div><div class="ttdeci">raw_ostream &amp; dbgs()</div><div class="ttdoc">dbgs() - This returns a reference to a raw_ostream for debugging messages.</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8cpp_source.html#l00163">Debug.cpp:163</a></div></div>
<div class="ttc" id="aAMDGPULibCalls_8cpp_html_afecf1cc1292b07f57d343c0f4d682044"><div class="ttname"><a href="AMDGPULibCalls_8cpp.html#afecf1cc1292b07f57d343c0f4d682044">Arg</a></div><div class="ttdeci">amdgpu Simplify well known AMD library false FunctionCallee Value * Arg</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPULibCalls_8cpp_source.html#l00187">AMDGPULibCalls.cpp:187</a></div></div>
<div class="ttc" id="anamespacellvm_1_1BitmaskEnumDetail_html_a91efa71de05b0c2d00730a0279f58658"><div class="ttname"><a href="namespacellvm_1_1BitmaskEnumDetail.html#a91efa71de05b0c2d00730a0279f58658">llvm::BitmaskEnumDetail::Mask</a></div><div class="ttdeci">constexpr std::underlying_type_t&lt; E &gt; Mask()</div><div class="ttdoc">Get a bitmask with 1s in all places up to the high-order bit of E's largest value.</div><div class="ttdef"><b>Definition:</b> <a href="BitmaskEnum_8h_source.html#l00080">BitmaskEnum.h:80</a></div></div>
<div class="ttc" id="aIR_2Instruction_8h_html"><div class="ttname"><a href="IR_2Instruction_8h.html">Instruction.h</a></div></div>
<div class="ttc" id="aTargetLowering_8h_html"><div class="ttname"><a href="TargetLowering_8h.html">TargetLowering.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_aba40628328a660c78a9d73cc209f5e84a8098b34f582537833b36b58273c3545b"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a8098b34f582537833b36b58273c3545b">llvm::TargetLoweringBase::AtomicExpansionKind::Expand</a></div><div class="ttdeci">@ Expand</div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html"><div class="ttname"><a href="classllvm_1_1ConstantInt.html">llvm::ConstantInt</a></div><div class="ttdoc">This is the shared class of boolean and integer constants.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00078">Constants.h:78</a></div></div>
<div class="ttc" id="anamespacellvm_html_a8641c386ba7874cb5c8edaa1377e4b85"><div class="ttname"><a href="namespacellvm.html#a8641c386ba7874cb5c8edaa1377e4b85">llvm::initializeAtomicExpandPass</a></div><div class="ttdeci">void initializeAtomicExpandPass(PassRegistry &amp;)</div></div>
<div class="ttc" id="anamespacellvm_html_aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b"><div class="ttname"><a href="namespacellvm.html#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">llvm::RecurKind::And</a></div><div class="ttdeci">@ And</div><div class="ttdoc">Bitwise or logical AND of integers.</div></div>
<div class="ttc" id="aclassllvm_1_1AtomicCmpXchgInst_html_a184ce4a2bacba9b5ab1bcd829c7a774b"><div class="ttname"><a href="classllvm_1_1AtomicCmpXchgInst.html#a184ce4a2bacba9b5ab1bcd829c7a774b">llvm::AtomicCmpXchgInst::getNewValOperand</a></div><div class="ttdeci">Value * getNewValOperand()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00650">Instructions.h:650</a></div></div>
<div class="ttc" id="aAtomicExpandPass_8cpp_html_a38d50193d10c3fe3a384b5279eec5a81"><div class="ttname"><a href="AtomicExpandPass_8cpp.html#a38d50193d10c3fe3a384b5279eec5a81">INITIALIZE_PASS</a></div><div class="ttdeci">INITIALIZE_PASS(AtomicExpand, DEBUG_TYPE, &quot;Expand Atomic instructions&quot;, false, false) FunctionPass *llvm</div><div class="ttdef"><b>Definition:</b> <a href="AtomicExpandPass_8cpp_source.html#l00145">AtomicExpandPass.cpp:145</a></div></div>
<div class="ttc" id="aTarget_2TargetMachine_8h_html"><div class="ttname"><a href="Target_2TargetMachine_8h.html">TargetMachine.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1PassRegistry_html_a05a729900b76c89e808c6c3094921b2f"><div class="ttname"><a href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">llvm::PassRegistry::getPassRegistry</a></div><div class="ttdeci">static PassRegistry * getPassRegistry()</div><div class="ttdoc">getPassRegistry - Access the global registry object, which is automatically initialized at applicatio...</div><div class="ttdef"><b>Definition:</b> <a href="PassRegistry_8cpp_source.html#l00024">PassRegistry.cpp:24</a></div></div>
<div class="ttc" id="aConstants_8h_html"><div class="ttname"><a href="Constants_8h.html">Constants.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html"><div class="ttname"><a href="classllvm_1_1User.html">llvm::User</a></div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00044">User.h:44</a></div></div>
<div class="ttc" id="astructllvm_1_1EVT_html"><div class="ttname"><a href="structllvm_1_1EVT.html">llvm::EVT</a></div><div class="ttdoc">Extended Value Type.</div><div class="ttdef"><b>Definition:</b> <a href="ValueTypes_8h_source.html#l00034">ValueTypes.h:34</a></div></div>
<div class="ttc" id="aREADME__ALTIVEC_8txt_html_a9aacd9146afe44bf656cd664e2a88c8c"><div class="ttname"><a href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a></div><div class="ttdeci">(vector float) vec_cmpeq(*A, *B) C</div><div class="ttdef"><b>Definition:</b> <a href="README__ALTIVEC_8txt_source.html#l00086">README_ALTIVEC.txt:86</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLowering_html"><div class="ttname"><a href="classllvm_1_1TargetLowering.html">llvm::TargetLowering</a></div><div class="ttdoc">This class defines information used to lower LLVM code to legal SelectionDAG operators that the targe...</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l03515">TargetLowering.h:3515</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a0ed5f3ab3c2e4196ee0cffffa080c062"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">llvm::BasicBlock::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdoc">Instruction iterator methods.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00314">BasicBlock.h:314</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicCmpXchgInst_html_a514c327438f006bc3fe66da51943b5cb"><div class="ttname"><a href="classllvm_1_1AtomicCmpXchgInst.html#a514c327438f006bc3fe66da51943b5cb">llvm::AtomicCmpXchgInst::getFailureOrdering</a></div><div class="ttdeci">AtomicOrdering getFailureOrdering() const</div><div class="ttdoc">Returns the failure ordering constraint of this cmpxchg instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00608">Instructions.h:608</a></div></div>
<div class="ttc" id="aclassllvm_1_1ExtractValueInst_html_a0a21dcfb15673bbd3ac69eb4dfe7315e"><div class="ttname"><a href="classllvm_1_1ExtractValueInst.html#a0a21dcfb15673bbd3ac69eb4dfe7315e">llvm::ExtractValueInst::getNumIndices</a></div><div class="ttdeci">unsigned getNumIndices() const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02524">Instructions.h:2524</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoadInst_html_ac363814e84ac1a3aa74798ff4d358a53"><div class="ttname"><a href="classllvm_1_1LoadInst.html#ac363814e84ac1a3aa74798ff4d358a53">llvm::LoadInst::setVolatile</a></div><div class="ttdeci">void setVolatile(bool V)</div><div class="ttdoc">Specify whether this is a volatile load or not.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00217">Instructions.h:217</a></div></div>
<div class="ttc" id="aSIInstrInfo_8cpp_html_a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791"><div class="ttname"><a href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a></div><div class="ttdeci">@ SI</div><div class="ttdef"><b>Definition:</b> <a href="SIInstrInfo_8cpp_source.html#l07993">SIInstrInfo.cpp:7993</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ms__demangle_html_afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e"><div class="ttname"><a href="namespacellvm_1_1ms__demangle.html#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">llvm::ms_demangle::QualifierMangleMode::Result</a></div><div class="ttdeci">@ Result</div></div>
<div class="ttc" id="aclassllvm_1_1IntegerType_html"><div class="ttname"><a href="classllvm_1_1IntegerType.html">llvm::IntegerType</a></div><div class="ttdoc">Class to represent integer types.</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00040">DerivedTypes.h:40</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_afa0b2fa29ba074f2b6ec9ac11163f2d9"><div class="ttname"><a href="classllvm_1_1Instruction.html#afa0b2fa29ba074f2b6ec9ac11163f2d9">llvm::Instruction::CastOps</a></div><div class="ttdeci">CastOps</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00823">Instruction.h:823</a></div></div>
<div class="ttc" id="anamespacellvm_html_aac70ae2b103201c54db337ea53995270"><div class="ttname"><a href="namespacellvm.html#aac70ae2b103201c54db337ea53995270">llvm::createAtomicExpandPass</a></div><div class="ttdeci">FunctionPass * createAtomicExpandPass()</div><div class="ttdoc">AtomicExpandPass - At IR level this pass replace atomic instructions with __atomic_* library calls,...</div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_aba40628328a660c78a9d73cc209f5e84a3cb580806c51b993a2981c906b62604b"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a3cb580806c51b993a2981c906b62604b">llvm::TargetLoweringBase::AtomicExpansionKind::CastToInteger</a></div><div class="ttdeci">@ CastToInteger</div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html"><div class="ttname"><a href="classllvm_1_1Instruction.html">llvm::Instruction</a></div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00041">Instruction.h:41</a></div></div>
<div class="ttc" id="anamespacellvm_html_a9bccbe67aaab722783ca4e7c504aaaa7a993ca650a85e8e69b8f7eaa4809c4862"><div class="ttname"><a href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a993ca650a85e8e69b8f7eaa4809c4862">llvm::AtomicOrdering::Acquire</a></div><div class="ttdeci">@ Acquire</div></div>
<div class="ttc" id="anamespacellvm_html_a7f2a3d4dcfee70225988aec53ff1e173"><div class="ttname"><a href="namespacellvm.html#a7f2a3d4dcfee70225988aec53ff1e173">llvm::report_fatal_error</a></div><div class="ttdeci">void report_fatal_error(Error Err, bool gen_crash_diag=true)</div><div class="ttdoc">Report a serious error, calling any installed error handler.</div><div class="ttdef"><b>Definition:</b> <a href="Testing_2Support_2Error_8cpp_source.html#l00145">Error.cpp:145</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_a461cfbbb5c7a57ab73210498923cf615afdcdc631cf4fa6829fd7499cd06a306b"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615afdcdc631cf4fa6829fd7499cd06a306b">llvm::AtomicRMWInst::Nand</a></div><div class="ttdeci">@ Nand</div><div class="ttdoc">*p = ~(old &amp; v)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00740">Instructions.h:740</a></div></div>
<div class="ttc" id="aclassllvm_1_1raw__ostream_html"><div class="ttname"><a href="classllvm_1_1raw__ostream.html">llvm::raw_ostream</a></div><div class="ttdoc">This class implements an extremely fast bulk output stream that can only output to a stream.</div><div class="ttdef"><b>Definition:</b> <a href="raw__ostream_8h_source.html#l00052">raw_ostream.h:52</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ISD_html_a22ea9cec080dd5f4f47ba234c2f59110a1db943abc1bf78a911daeb7b03d81de8"><div class="ttname"><a href="namespacellvm_1_1ISD.html#a22ea9cec080dd5f4f47ba234c2f59110a1db943abc1bf78a911daeb7b03d81de8">llvm::ISD::ATOMIC_STORE</a></div><div class="ttdeci">@ ATOMIC_STORE</div><div class="ttdoc">OUTCHAIN = ATOMIC_STORE(INCHAIN, ptr, val) This corresponds to &quot;store atomic&quot; instruction.</div><div class="ttdef"><b>Definition:</b> <a href="ISDOpcodes_8h_source.html#l01165">ISDOpcodes.h:1165</a></div></div>
<div class="ttc" id="anamespacellvm_html_a5ee0a415cf089775fd277550b257f74e"><div class="ttname"><a href="namespacellvm.html#a5ee0a415cf089775fd277550b257f74e">llvm::operator&lt;&lt;</a></div><div class="ttdeci">raw_ostream &amp; operator&lt;&lt;(raw_ostream &amp;OS, const APFixedPoint &amp;FX)</div><div class="ttdef"><b>Definition:</b> <a href="APFixedPoint_8h_source.html#l00292">APFixedPoint.h:292</a></div></div>
<div class="ttc" id="anamespacellvm_html_af81c48a69603bf5bc3e54302533ed4ab"><div class="ttname"><a href="namespacellvm.html#af81c48a69603bf5bc3e54302533ed4ab">llvm::AtomicExpandID</a></div><div class="ttdeci">char &amp; AtomicExpandID</div><div class="ttdoc">AtomicExpandID  Lowers atomic operations in terms of either cmpxchg load-linked/store-conditional lo...</div><div class="ttdef"><b>Definition:</b> <a href="AtomicExpandPass_8cpp_source.html#l00143">AtomicExpandPass.cpp:143</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_a969709dd49c28865a482d8b870f87c46"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a969709dd49c28865a482d8b870f87c46">llvm::ConstantInt::get</a></div><div class="ttdeci">static Constant * get(Type *Ty, uint64_t V, bool IsSigned=false)</div><div class="ttdoc">If Ty is a vector type, return a Constant with a splat of the given value.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00887">Constants.cpp:887</a></div></div>
<div class="ttc" id="aclassllvm_1_1StoreInst_html_a485d55d9f09489fd6d33a3369b2b3f4d"><div class="ttname"><a href="classllvm_1_1StoreInst.html#a485d55d9f09489fd6d33a3369b2b3f4d">llvm::StoreInst::setVolatile</a></div><div class="ttdeci">void setVolatile(bool V)</div><div class="ttdoc">Specify whether this is a volatile store or not.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00340">Instructions.h:340</a></div></div>
<div class="ttc" id="aSTLFunctionalExtras_8h_html"><div class="ttname"><a href="STLFunctionalExtras_8h.html">STLFunctionalExtras.h</a></div></div>
<div class="ttc" id="aAtomicExpandUtils_8h_html"><div class="ttname"><a href="AtomicExpandUtils_8h.html">AtomicExpandUtils.h</a></div></div>
<div class="ttc" id="aELFObjHandler_8cpp_html_a043cdaf7b89aaeeb127be5d93411637f"><div class="ttname"><a href="ELFObjHandler_8cpp.html#a043cdaf7b89aaeeb127be5d93411637f">Align</a></div><div class="ttdeci">uint64_t Align</div><div class="ttdef"><b>Definition:</b> <a href="ELFObjHandler_8cpp_source.html#l00082">ELFObjHandler.cpp:82</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_a461cfbbb5c7a57ab73210498923cf615acce124326ba87b0127b36c412bf555fd"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615acce124326ba87b0127b36c412bf555fd">llvm::AtomicRMWInst::FMax</a></div><div class="ttdeci">@ FMax</div><div class="ttdoc">*p = maxnum(old, v) maxnum matches the behavior of llvm.maxnum.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00762">Instructions.h:762</a></div></div>
<div class="ttc" id="astructllvm_1_1Align_html"><div class="ttname"><a href="structllvm_1_1Align.html">llvm::Align</a></div><div class="ttdoc">This struct is a compact representation of a valid (non-zero power of two) alignment.</div><div class="ttdef"><b>Definition:</b> <a href="Alignment_8h_source.html#l00039">Alignment.h:39</a></div></div>
<div class="ttc" id="anamespacellvm_1_1MCID_html_ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f"><div class="ttname"><a href="namespacellvm_1_1MCID.html#ab357441fcd1ea1f9b0d27c12700f6023a463baf545246fea9718664d933ffe66f">llvm::MCID::Call</a></div><div class="ttdeci">@ Call</div><div class="ttdef"><b>Definition:</b> <a href="MCInstrDesc_8h_source.html#l00156">MCInstrDesc.h:156</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_a461cfbbb5c7a57ab73210498923cf615afc870a548088c5b7a93a34f648889d77"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615afc870a548088c5b7a93a34f648889d77">llvm::AtomicRMWInst::Xchg</a></div><div class="ttdeci">@ Xchg</div><div class="ttdoc">*p = v</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00732">Instructions.h:732</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_a461cfbbb5c7a57ab73210498923cf615a0794c42b44989f9d9f1454d79ca0dd88"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a0794c42b44989f9d9f1454d79ca0dd88">llvm::AtomicRMWInst::Add</a></div><div class="ttdeci">@ Add</div><div class="ttdoc">*p = old + v</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00734">Instructions.h:734</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoadInst_html_aca6c2de6950cb093f509ed2b67e02da2"><div class="ttname"><a href="classllvm_1_1LoadInst.html#aca6c2de6950cb093f509ed2b67e02da2">llvm::LoadInst::getSyncScopeID</a></div><div class="ttdeci">SyncScope::ID getSyncScopeID() const</div><div class="ttdoc">Returns the synchronization scope ID of this load instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00239">Instructions.h:239</a></div></div>
<div class="ttc" id="anamespacellvm_1_1lltok_html_af353621f14cb4b4b3af5ffaff84076b1"><div class="ttname"><a href="namespacellvm_1_1lltok.html#af353621f14cb4b4b3af5ffaff84076b1">llvm::lltok::Kind</a></div><div class="ttdeci">Kind</div><div class="ttdef"><b>Definition:</b> <a href="LLToken_8h_source.html#l00018">LLToken.h:18</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a9d7de807ebdfe1819df3ff6cb0f16158"><div class="ttname"><a href="classllvm_1_1Value.html#a9d7de807ebdfe1819df3ff6cb0f16158">llvm::Value::use_empty</a></div><div class="ttdeci">bool use_empty() const</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00344">Value.h:344</a></div></div>
<div class="ttc" id="anamespacellvm_1_1CallingConv_html_a188c0836f8c3528401f1c236fd93b977"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">llvm::CallingConv::ID</a></div><div class="ttdeci">unsigned ID</div><div class="ttdoc">LLVM IR allows to use arbitrary numbers as calling convention identifiers.</div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00024">CallingConv.h:24</a></div></div>
<div class="ttc" id="aType_8h_html"><div class="ttname"><a href="Type_8h.html">Type.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicCmpXchgInst_html_aad0a6acef46d026f2137af84d656decc"><div class="ttname"><a href="classllvm_1_1AtomicCmpXchgInst.html#aad0a6acef46d026f2137af84d656decc">llvm::AtomicCmpXchgInst::setVolatile</a></div><div class="ttdeci">void setVolatile(bool V)</div><div class="ttdoc">Specify whether this is a volatile cmpxchg.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00573">Instructions.h:573</a></div></div>
<div class="ttc" id="aADT_2tmp_8txt_html_a07ed0bfaa124c15897944fe3eaa971ab"><div class="ttname"><a href="ADT_2tmp_8txt.html#a07ed0bfaa124c15897944fe3eaa971ab">uint64_t</a></div><div class="ttdeci">Class for arbitrary precision integers APInt is a functional replacement for common case unsigned integer type like unsigned long or uint64_t</div><div class="ttdef"><b>Definition:</b> <a href="ADT_2tmp_8txt_source.html#l00001">tmp.txt:1</a></div></div>
<div class="ttc" id="astructllvm_1_1EVT_html_a5f64c589a5312630fe76a37f62a39707"><div class="ttname"><a href="structllvm_1_1EVT.html#a5f64c589a5312630fe76a37f62a39707">llvm::EVT::getStoreSizeInBits</a></div><div class="ttdeci">TypeSize getStoreSizeInBits() const</div><div class="ttdoc">Return the number of bits overwritten by a store of the specified value type.</div><div class="ttdef"><b>Definition:</b> <a href="ValueTypes_8h_source.html#l00379">ValueTypes.h:379</a></div></div>
<div class="ttc" id="aclassllvm_1_1function__ref_html"><div class="ttname"><a href="classllvm_1_1function__ref.html">llvm::function_ref</a></div><div class="ttdoc">An efficient, type-erasing, non-owning reference to a callable.</div><div class="ttdef"><b>Definition:</b> <a href="STLFunctionalExtras_8h_source.html#l00036">STLFunctionalExtras.h:36</a></div></div>
<div class="ttc" id="anamespacellvm_html_a9af7e2dd206cc24d4690e1d2a996c43e"><div class="ttname"><a href="namespacellvm.html#a9af7e2dd206cc24d4690e1d2a996c43e">llvm::buildAtomicRMWValue</a></div><div class="ttdeci">Value * buildAtomicRMWValue(AtomicRMWInst::BinOp Op, IRBuilderBase &amp;Builder, Value *Loaded, Value *Val)</div><div class="ttdoc">Emit IR to implement the given atomicrmw operation on values in registers, returning the new value.</div><div class="ttdef"><b>Definition:</b> <a href="LowerAtomic_8cpp_source.html#l00042">LowerAtomic.cpp:42</a></div></div>
<div class="ttc" id="anamespacellvm_html_a9bccbe67aaab722783ca4e7c504aaaa7"><div class="ttname"><a href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7">llvm::AtomicOrdering</a></div><div class="ttdeci">AtomicOrdering</div><div class="ttdoc">Atomic ordering for LLVM's memory model.</div><div class="ttdef"><b>Definition:</b> <a href="AtomicOrdering_8h_source.html#l00056">AtomicOrdering.h:56</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_a461cfbbb5c7a57ab73210498923cf615aa53854e09143f57d2ff2ad6ac89dc55d"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615aa53854e09143f57d2ff2ad6ac89dc55d">llvm::AtomicRMWInst::UMin</a></div><div class="ttdeci">@ UMin</div><div class="ttdoc">*p = old &lt;unsigned v ? old : v</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00752">Instructions.h:752</a></div></div>
<div class="ttc" id="aBasicBlock_8h_html"><div class="ttname"><a href="BasicBlock_8h.html">BasicBlock.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicCmpXchgInst_html_aec330b83cce31f4c2c90ea2276bca6ea"><div class="ttname"><a href="classllvm_1_1AtomicCmpXchgInst.html#aec330b83cce31f4c2c90ea2276bca6ea">llvm::AtomicCmpXchgInst::getSyncScopeID</a></div><div class="ttdeci">SyncScope::ID getSyncScopeID() const</div><div class="ttdoc">Returns the synchronization scope ID of this cmpxchg instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00634">Instructions.h:634</a></div></div>
<div class="ttc" id="anamespacellvm_1_1RISCVFenceField_html_a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb"><div class="ttname"><a href="namespacellvm_1_1RISCVFenceField.html#a147be9e9780c1e33363ea572d4c7b25fa1a33f1d911a725a1f81234a908d03edb">llvm::RISCVFenceField::O</a></div><div class="ttdeci">@ O</div><div class="ttdef"><b>Definition:</b> <a href="RISCVBaseInfo_8h_source.html#l00277">RISCVBaseInfo.h:277</a></div></div>
<div class="ttc" id="anamespacellvm_html_a7e3e687ddfdcbacd404bcf17b917dd88"><div class="ttname"><a href="namespacellvm.html#a7e3e687ddfdcbacd404bcf17b917dd88">llvm::instructions</a></div><div class="ttdeci">inst_range instructions(Function *F)</div><div class="ttdef"><b>Definition:</b> <a href="InstIterator_8h_source.html#l00133">InstIterator.h:133</a></div></div>
<div class="ttc" id="aclassllvm_1_1StoreInst_html"><div class="ttname"><a href="classllvm_1_1StoreInst.html">llvm::StoreInst</a></div><div class="ttdoc">An instruction for storing to memory.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00301">Instructions.h:301</a></div></div>
<div class="ttc" id="aclassllvm_1_1Constant_html"><div class="ttname"><a href="classllvm_1_1Constant.html">llvm::Constant</a></div><div class="ttdoc">This is an important base class in LLVM.</div><div class="ttdef"><b>Definition:</b> <a href="Constant_8h_source.html#l00041">Constant.h:41</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_ae6b978645b8ac72d1a35e1298ffdd4f0"><div class="ttname"><a href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">llvm::Instruction::eraseFromParent</a></div><div class="ttdeci">SymbolTableList&lt; Instruction &gt;::iterator eraseFromParent()</div><div class="ttdoc">This method unlinks 'this' from the containing basic block and deletes it.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00082">Instruction.cpp:82</a></div></div>
<div class="ttc" id="astructllvm_1_1EVT_html_a45e76d44a189e456d52e37ba3dda0fce"><div class="ttname"><a href="structllvm_1_1EVT.html#a45e76d44a189e456d52e37ba3dda0fce">llvm::EVT::getSizeInBits</a></div><div class="ttdeci">TypeSize getSizeInBits() const</div><div class="ttdoc">Return the size of the specified value type in bits.</div><div class="ttdef"><b>Definition:</b> <a href="ValueTypes_8h_source.html#l00340">ValueTypes.h:340</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_a461cfbbb5c7a57ab73210498923cf615a5db6ca0c3e18acd87290f22ccb2ce564"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a5db6ca0c3e18acd87290f22ccb2ce564">llvm::AtomicRMWInst::Sub</a></div><div class="ttdeci">@ Sub</div><div class="ttdoc">*p = old - v</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00736">Instructions.h:736</a></div></div>
<div class="ttc" id="aRuntimeLibcalls_8h_html"><div class="ttname"><a href="RuntimeLibcalls_8h.html">RuntimeLibcalls.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_aba40628328a660c78a9d73cc209f5e84a56a57d29a3f9dda8671b4d6490a94b08"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a56a57d29a3f9dda8671b4d6490a94b08">llvm::TargetLoweringBase::AtomicExpansionKind::NotAtomic</a></div><div class="ttdeci">@ NotAtomic</div></div>
<div class="ttc" id="aInstSimplifyFolder_8h_html"><div class="ttname"><a href="InstSimplifyFolder_8h.html">InstSimplifyFolder.h</a></div></div>
<div class="ttc" id="aELFObjHandler_8cpp_html_a9df82a8be2f17e80535a8937bf23e022"><div class="ttname"><a href="ELFObjHandler_8cpp.html#a9df82a8be2f17e80535a8937bf23e022">Addr</a></div><div class="ttdeci">uint64_t Addr</div><div class="ttdef"><b>Definition:</b> <a href="ELFObjHandler_8cpp_source.html#l00079">ELFObjHandler.cpp:79</a></div></div>
<div class="ttc" id="aclassllvm_1_1AttributeList_html_a32c2b32d61cf856c6a5b2ceb3de7fd0d"><div class="ttname"><a href="classllvm_1_1AttributeList.html#a32c2b32d61cf856c6a5b2ceb3de7fd0d">llvm::AttributeList::addRetAttribute</a></div><div class="ttdeci">AttributeList addRetAttribute(LLVMContext &amp;C, Attribute::AttrKind Kind) const</div><div class="ttdoc">Add a return value attribute to the list.</div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8h_source.html#l00548">Attributes.h:548</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_a089cccb6f231efee72abc76d0f9c695f"><div class="ttname"><a href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">llvm::PHINode::addIncoming</a></div><div class="ttdeci">void addIncoming(Value *V, BasicBlock *BB)</div><div class="ttdoc">Add an incoming value to the end of the PHI list.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02854">Instructions.h:2854</a></div></div>
<div class="ttc" id="aclassllvm_1_1LLVMContext_html"><div class="ttname"><a href="classllvm_1_1LLVMContext.html">llvm::LLVMContext</a></div><div class="ttdoc">This is an important class for using LLVM in a threaded context.</div><div class="ttdef"><b>Definition:</b> <a href="LLVMContext_8h_source.html#l00067">LLVMContext.h:67</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_aefa60bfe67b4721c395ce966ac73b439"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#aefa60bfe67b4721c395ce966ac73b439">llvm::AtomicRMWInst::getOrdering</a></div><div class="ttdeci">AtomicOrdering getOrdering() const</div><div class="ttdoc">Returns the ordering constraint of this rmw instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00854">Instructions.h:854</a></div></div>
<div class="ttc" id="anamespacellvm_1_1SyncScope_html_a80741d3f96133391b683effd8e5b77f0"><div class="ttname"><a href="namespacellvm_1_1SyncScope.html#a80741d3f96133391b683effd8e5b77f0">llvm::SyncScope::ID</a></div><div class="ttdeci">uint8_t ID</div><div class="ttdef"><b>Definition:</b> <a href="LLVMContext_8h_source.html#l00046">LLVMContext.h:46</a></div></div>
<div class="ttc" id="anamespacellvm_html_aa241826e10b4a9bf77c3115e7160d3c7"><div class="ttname"><a href="namespacellvm.html#aa241826e10b4a9bf77c3115e7160d3c7">llvm::IRBuilder</a></div><div class="ttdeci">IRBuilder(LLVMContext &amp;, FolderTy, InserterTy, MDNode *, ArrayRef&lt; OperandBundleDef &gt;) -&gt; IRBuilder&lt; FolderTy, InserterTy &gt;</div></div>
<div class="ttc" id="aAtomicExpandPass_8cpp_html_a2c4ed28bcf6025776c8aed0bf9159899"><div class="ttname"><a href="AtomicExpandPass_8cpp.html#a2c4ed28bcf6025776c8aed0bf9159899">getAtomicOpSize</a></div><div class="ttdeci">static unsigned getAtomicOpSize(LoadInst *LI)</div><div class="ttdef"><b>Definition:</b> <a href="AtomicExpandPass_8cpp_source.html#l00151">AtomicExpandPass.cpp:151</a></div></div>
<div class="ttc" id="anamespacellvm_html_a9bccbe67aaab722783ca4e7c504aaaa7a288d468c5e0969f26a310773eda65603"><div class="ttname"><a href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a288d468c5e0969f26a310773eda65603">llvm::AtomicOrdering::Unordered</a></div><div class="ttdeci">@ Unordered</div></div>
<div class="ttc" id="aMD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00058">MD5.cpp:58</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_a461cfbbb5c7a57ab73210498923cf615a39edb6e51c1ad37244e8b32a2af4077d"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a39edb6e51c1ad37244e8b32a2af4077d">llvm::AtomicRMWInst::Min</a></div><div class="ttdeci">@ Min</div><div class="ttdoc">*p = old &lt;signed v ? old : v</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00748">Instructions.h:748</a></div></div>
<div class="ttc" id="aclassllvm_1_1PointerType_html"><div class="ttname"><a href="classllvm_1_1PointerType.html">llvm::PointerType</a></div><div class="ttdoc">Class to represent pointers.</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00632">DerivedTypes.h:632</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_a461cfbbb5c7a57ab73210498923cf615a5954f59053121b87ebe0c5fe79942c6e"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a5954f59053121b87ebe0c5fe79942c6e">llvm::AtomicRMWInst::Or</a></div><div class="ttdeci">@ Or</div><div class="ttdoc">*p = old | v</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00742">Instructions.h:742</a></div></div>
<div class="ttc" id="aArrayRef_8h_html"><div class="ttname"><a href="ArrayRef_8h.html">ArrayRef.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_ac97b19e5c8e2843543087d67e47be222"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#ac97b19e5c8e2843543087d67e47be222">llvm::AtomicRMWInst::getSyncScopeID</a></div><div class="ttdeci">SyncScope::ID getSyncScopeID() const</div><div class="ttdoc">Returns the synchronization scope ID of this rmw instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00868">Instructions.h:868</a></div></div>
<div class="ttc" id="aTargetPassConfig_8h_html"><div class="ttname"><a href="TargetPassConfig_8h.html">TargetPassConfig.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_ac963dddf8453fc717992d3ce36a27d8b"><div class="ttname"><a href="namespacellvm.html#ac963dddf8453fc717992d3ce36a27d8b">llvm::lowerAtomicRMWInst</a></div><div class="ttdeci">bool lowerAtomicRMWInst(AtomicRMWInst *RMWI)</div><div class="ttdoc">Convert the given RMWI into primitive load and stores, assuming that doing so is legal.</div><div class="ttdef"><b>Definition:</b> <a href="LowerAtomic_8cpp_source.html#l00103">LowerAtomic.cpp:103</a></div></div>
<div class="ttc" id="aIRBuilder_8h_html"><div class="ttname"><a href="IRBuilder_8h.html">IRBuilder.h</a></div></div>
<div class="ttc" id="aSILowerControlFlow_8cpp_html_a4868c5d81c5ccc98c47aeab6244346a0"><div class="ttname"><a href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a></div><div class="ttdeci">assert(ImpDefSCC.getReg()==AMDGPU::SCC &amp;&amp;ImpDefSCC.isDef())</div></div>
<div class="ttc" id="aclassllvm_1_1TargetMachine_html"><div class="ttname"><a href="classllvm_1_1TargetMachine.html">llvm::TargetMachine</a></div><div class="ttdoc">Primary interface to the complete machine description for the target machine.</div><div class="ttdef"><b>Definition:</b> <a href="Target_2TargetMachine_8h_source.html#l00078">TargetMachine.h:78</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicCmpXchgInst_html_a54ba0d7cdad65aa333e7756b26536c8e"><div class="ttname"><a href="classllvm_1_1AtomicCmpXchgInst.html#a54ba0d7cdad65aa333e7756b26536c8e">llvm::AtomicCmpXchgInst::getCompareOperand</a></div><div class="ttdeci">Value * getCompareOperand()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00647">Instructions.h:647</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_aba40628328a660c78a9d73cc209f5e84a2985b9c595be648a72a6dd08268c2218"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a2985b9c595be648a72a6dd08268c2218">llvm::TargetLoweringBase::AtomicExpansionKind::LLSC</a></div><div class="ttdeci">@ LLSC</div></div>
<div class="ttc" id="aclassllvm_1_1AtomicCmpXchgInst_html_a91b66c93e687bd0ea2d74a896c09408b"><div class="ttname"><a href="classllvm_1_1AtomicCmpXchgInst.html#a91b66c93e687bd0ea2d74a896c09408b">llvm::AtomicCmpXchgInst::isWeak</a></div><div class="ttdeci">bool isWeak() const</div><div class="ttdoc">Return true if this cmpxchg may spuriously fail.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00576">Instructions.h:576</a></div></div>
<div class="ttc" id="anamespacellvm_html_ac306f2130698421f64f8a139faf38675"><div class="ttname"><a href="namespacellvm.html#ac306f2130698421f64f8a139faf38675">llvm::lowerAtomicCmpXchgInst</a></div><div class="ttdeci">bool lowerAtomicCmpXchgInst(AtomicCmpXchgInst *CXI)</div><div class="ttdoc">Convert the given Cmpxchg into primitive load and compare.</div><div class="ttdef"><b>Definition:</b> <a href="LowerAtomic_8cpp_source.html#l00023">LowerAtomic.cpp:23</a></div></div>
<div class="ttc" id="aclassllvm_1_1Module_html"><div class="ttname"><a href="classllvm_1_1Module.html">llvm::Module</a></div><div class="ttdoc">A Module instance is used to store all the information related to an LLVM module.</div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00065">Module.h:65</a></div></div>
<div class="ttc" id="aAssumeBundleBuilder_8cpp_html_afb136e0532bcaed86521b462e6538d62"><div class="ttname"><a href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a></div><div class="ttdeci">assume Assume Builder</div><div class="ttdef"><b>Definition:</b> <a href="AssumeBundleBuilder_8cpp_source.html#l00651">AssumeBundleBuilder.cpp:651</a></div></div>
<div class="ttc" id="aAtomicExpandPass_8cpp_html_af2b0c668c546d1bbfb312717115e7235"><div class="ttname"><a href="AtomicExpandPass_8cpp.html#af2b0c668c546d1bbfb312717115e7235">performMaskedAtomicOp</a></div><div class="ttdeci">static Value * performMaskedAtomicOp(AtomicRMWInst::BinOp Op, IRBuilderBase &amp;Builder, Value *Loaded, Value *Shifted_Inc, Value *Inc, const PartwordMaskValues &amp;PMV)</div><div class="ttdoc">Emit IR to implement a masked version of a given atomicrmw operation.</div><div class="ttdef"><b>Definition:</b> <a href="AtomicExpandPass_8cpp_source.html#l00802">AtomicExpandPass.cpp:802</a></div></div>
<div class="ttc" id="anamespacellvm_html_abbc497e16b1809ff526b1c755483d35c"><div class="ttname"><a href="namespacellvm.html#abbc497e16b1809ff526b1c755483d35c">llvm::isAcquireOrStronger</a></div><div class="ttdeci">bool isAcquireOrStronger(AtomicOrdering AO)</div><div class="ttdef"><b>Definition:</b> <a href="AtomicOrdering_8h_source.html#l00128">AtomicOrdering.h:128</a></div></div>
<div class="ttc" id="anamespacellvm_html_a66e6f90f41f1ea69d5ee532384f0af4e"><div class="ttname"><a href="namespacellvm.html#a66e6f90f41f1ea69d5ee532384f0af4e">llvm::toCABI</a></div><div class="ttdeci">AtomicOrderingCABI toCABI(AtomicOrdering AO)</div><div class="ttdef"><b>Definition:</b> <a href="AtomicOrdering_8h_source.html#l00146">AtomicOrdering.h:146</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_aba40628328a660c78a9d73cc209f5e84a54d9453ceeccd44c5fdf248680e03691"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a54d9453ceeccd44c5fdf248680e03691">llvm::TargetLoweringBase::AtomicExpansionKind::BitTestIntrinsic</a></div><div class="ttdeci">@ BitTestIntrinsic</div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html"><div class="ttname"><a href="classllvm_1_1ArrayRef.html">llvm::ArrayRef</a></div><div class="ttdoc">ArrayRef - Represent a constant reference to an array (0 or more elements consecutively in memory),...</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00033">APInt.h:33</a></div></div>
<div class="ttc" id="aclassllvm_1_1OptimizationRemarkEmitter_html"><div class="ttname"><a href="classllvm_1_1OptimizationRemarkEmitter.html">llvm::OptimizationRemarkEmitter</a></div><div class="ttdoc">The optimization diagnostic interface.</div><div class="ttdef"><b>Definition:</b> <a href="OptimizationRemarkEmitter_8h_source.html#l00033">OptimizationRemarkEmitter.h:33</a></div></div>
<div class="ttc" id="aDataLayout_8h_html"><div class="ttname"><a href="DataLayout_8h.html">DataLayout.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_a586359566c841c85abfd8922e220213e"><div class="ttname"><a href="namespacellvm.html#a586359566c841c85abfd8922e220213e">llvm::isReleaseOrStronger</a></div><div class="ttdeci">bool isReleaseOrStronger(AtomicOrdering AO)</div><div class="ttdef"><b>Definition:</b> <a href="AtomicOrdering_8h_source.html#l00132">AtomicOrdering.h:132</a></div></div>
<div class="ttc" id="aSupport_2ErrorHandling_8h_html_ace243f5c25697a1107cce46626b3dc94"><div class="ttname"><a href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a></div><div class="ttdeci">#define llvm_unreachable(msg)</div><div class="ttdoc">Marks that the current location is not supposed to be reachable.</div><div class="ttdef"><b>Definition:</b> <a href="Support_2ErrorHandling_8h_source.html#l00143">ErrorHandling.h:143</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a6393a2d4fe7e10b28a0dcc35f881567b"><div class="ttname"><a href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">llvm::Value::getType</a></div><div class="ttdeci">Type * getType() const</div><div class="ttdoc">All values are typed, get the type of this value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00255">Value.h:255</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a6a66ebb3aa12757479a3c88de77d78f8"><div class="ttname"><a href="classllvm_1_1Instruction.html#a6a66ebb3aa12757479a3c88de77d78f8">llvm::Instruction::getFunction</a></div><div class="ttdeci">const Function * getFunction() const</div><div class="ttdoc">Return the function this instruction belongs to.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00074">Instruction.cpp:74</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a3ab5fc45117b450e8bb04e564cb6e5f2"><div class="ttname"><a href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">llvm::Value::replaceAllUsesWith</a></div><div class="ttdeci">void replaceAllUsesWith(Value *V)</div><div class="ttdoc">Change all uses of this to point to a new Value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00532">Value.cpp:532</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_ace940beeee97c222f836fe0ac70f6cf5"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#ace940beeee97c222f836fe0ac70f6cf5">llvm::BasicBlock::Create</a></div><div class="ttdeci">static BasicBlock * Create(LLVMContext &amp;Context, const Twine &amp;Name=&quot;&quot;, Function *Parent=nullptr, BasicBlock *InsertBefore=nullptr)</div><div class="ttdoc">Creates a new BasicBlock.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00105">BasicBlock.h:105</a></div></div>
<div class="ttc" id="aclassllvm_1_1IRBuilderBase_html"><div class="ttname"><a href="classllvm_1_1IRBuilderBase.html">llvm::IRBuilderBase</a></div><div class="ttdoc">Common base class shared among various IRBuilders.</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00094">IRBuilder.h:94</a></div></div>
<div class="ttc" id="aAtomicExpandPass_8cpp_html_aa4b0153efde0ef6386025f1fee119879"><div class="ttname"><a href="AtomicExpandPass_8cpp.html#aa4b0153efde0ef6386025f1fee119879">extractMaskedValue</a></div><div class="ttdeci">static Value * extractMaskedValue(IRBuilderBase &amp;Builder, Value *WideWord, const PartwordMaskValues &amp;PMV)</div><div class="ttdef"><b>Definition:</b> <a href="AtomicExpandPass_8cpp_source.html#l00771">AtomicExpandPass.cpp:771</a></div></div>
<div class="ttc" id="aclassllvm_1_1ilist__node__impl_html_af719fc783be6589465137d997701a432"><div class="ttname"><a href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">llvm::ilist_node_impl::getIterator</a></div><div class="ttdeci">self_iterator getIterator()</div><div class="ttdef"><b>Definition:</b> <a href="ilist__node_8h_source.html#l00082">ilist_node.h:82</a></div></div>
<div class="ttc" id="aTargetSubtargetInfo_8h_html"><div class="ttname"><a href="TargetSubtargetInfo_8h.html">TargetSubtargetInfo.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicCmpXchgInst_html_a1c6b80273f7c1e1906580aef14a48061"><div class="ttname"><a href="classllvm_1_1AtomicCmpXchgInst.html#a1c6b80273f7c1e1906580aef14a48061">llvm::AtomicCmpXchgInst::setWeak</a></div><div class="ttdeci">void setWeak(bool IsWeak)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00578">Instructions.h:578</a></div></div>
<div class="ttc" id="aAArch64SLSHardening_8cpp_html_ad467c4ab9119043f9b7750ab986be61a"><div class="ttname"><a href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a></div><div class="ttdeci">MachineBasicBlock MachineBasicBlock::iterator DebugLoc DL</div><div class="ttdef"><b>Definition:</b> <a href="AArch64SLSHardening_8cpp_source.html#l00076">AArch64SLSHardening.cpp:76</a></div></div>
<div class="ttc" id="aAtomicExpandPass_8cpp_html_af9ea90f22a3fced77614ad93a197f7df"><div class="ttname"><a href="AtomicExpandPass_8cpp.html#af9ea90f22a3fced77614ad93a197f7df">createCmpXchgInstFun</a></div><div class="ttdeci">static void createCmpXchgInstFun(IRBuilderBase &amp;Builder, Value *Addr, Value *Loaded, Value *NewVal, Align AddrAlign, AtomicOrdering MemOpOrder, SyncScope::ID SSID, Value *&amp;Success, Value *&amp;NewLoaded)</div><div class="ttdef"><b>Definition:</b> <a href="AtomicExpandPass_8cpp_source.html#l00545">AtomicExpandPass.cpp:545</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoadInst_html_a6ae88dc44b078c80ce3a25401fd4b05b"><div class="ttname"><a href="classllvm_1_1LoadInst.html#a6ae88dc44b078c80ce3a25401fd4b05b">llvm::LoadInst::setAtomic</a></div><div class="ttdeci">void setAtomic(AtomicOrdering Ordering, SyncScope::ID SSID=SyncScope::System)</div><div class="ttdoc">Sets the ordering constraint and the synchronization scope ID of this load instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00250">Instructions.h:250</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_a0b5bee42a0652f7f46ec24c924e610d7"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#a0b5bee42a0652f7f46ec24c924e610d7">llvm::AtomicRMWInst::getAlign</a></div><div class="ttdeci">Align getAlign() const</div><div class="ttdoc">Return the alignment of the memory that is being allocated by the instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00834">Instructions.h:834</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoadInst_html_a93603fe0d4168b92a901f06015ecb2e7"><div class="ttname"><a href="classllvm_1_1LoadInst.html#a93603fe0d4168b92a901f06015ecb2e7">llvm::LoadInst::getOrdering</a></div><div class="ttdeci">AtomicOrdering getOrdering() const</div><div class="ttdoc">Returns the ordering constraint of this load instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00229">Instructions.h:229</a></div></div>
<div class="ttc" id="aAtomicExpandPass_8cpp_html_addb0d67f88876ee143acca486e03c53d"><div class="ttname"><a href="AtomicExpandPass_8cpp.html#addb0d67f88876ee143acca486e03c53d">atomicSizeSupported</a></div><div class="ttdeci">static bool atomicSizeSupported(const TargetLowering *TLI, Inst *I)</div><div class="ttdef"><b>Definition:</b> <a href="AtomicExpandPass_8cpp_source.html#l00175">AtomicExpandPass.cpp:175</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoadInst_html"><div class="ttname"><a href="classllvm_1_1LoadInst.html">llvm::LoadInst</a></div><div class="ttdoc">An instruction for reading from memory.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00177">Instructions.h:177</a></div></div>
<div class="ttc" id="aAtomicExpandPass_8cpp_html_a44f4e9b64d7a612f2b8236f0d147f591"><div class="ttname"><a href="AtomicExpandPass_8cpp.html#a44f4e9b64d7a612f2b8236f0d147f591">createMaskInstrs</a></div><div class="ttdeci">static PartwordMaskValues createMaskInstrs(IRBuilderBase &amp;Builder, Instruction *I, Type *ValueType, Value *Addr, Align AddrAlign, unsigned MinWordSize)</div><div class="ttdoc">This is a helper function which builds instructions to provide values necessary for partword atomic o...</div><div class="ttdef"><b>Definition:</b> <a href="AtomicExpandPass_8cpp_source.html#l00699">AtomicExpandPass.cpp:699</a></div></div>
<div class="ttc" id="anamespacellvm_html_aee5ce376091dcd04eaaf3fe13a3f3e77"><div class="ttname"><a href="namespacellvm.html#aee5ce376091dcd04eaaf3fe13a3f3e77">llvm::ValueType</a></div><div class="ttdeci">PointerUnion&lt; const Value *, const PseudoSourceValue * &gt; ValueType</div><div class="ttdef"><b>Definition:</b> <a href="ScheduleDAGInstrs_8h_source.html#l00107">ScheduleDAGInstrs.h:107</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html">llvm::AtomicRMWInst</a></div><div class="ttdoc">an instruction that atomically reads a memory location, combines it with another value,...</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00718">Instructions.h:718</a></div></div>
<div class="ttc" id="aclassllvm_1_1PointerUnion_html"><div class="ttname"><a href="classllvm_1_1PointerUnion.html">llvm::PointerUnion&lt; const Value *, const PseudoSourceValue * &gt;</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_aa7cce62ac5cc6df09cce0535874336b7"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#aa7cce62ac5cc6df09cce0535874336b7">llvm::ConstantInt::getFalse</a></div><div class="ttdeci">static ConstantInt * getFalse(LLVMContext &amp;Context)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00842">Constants.cpp:842</a></div></div>
<div class="ttc" id="aAtomicExpandPass_8cpp_html_ad78e062f62e0d6e453941fb4ca843e4d"><div class="ttname"><a href="AtomicExpandPass_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a></div><div class="ttdeci">#define DEBUG_TYPE</div><div class="ttdef"><b>Definition:</b> <a href="AtomicExpandPass_8cpp_source.html#l00058">AtomicExpandPass.cpp:58</a></div></div>
<div class="ttc" id="aAttributes_8h_html"><div class="ttname"><a href="Attributes_8h.html">Attributes.h</a></div></div>
<div class="ttc" id="aEntryExitInstrumenter_8cpp_html_a3985f1f39349428d17f0d2b81ebc6349"><div class="ttname"><a href="EntryExitInstrumenter_8cpp.html#a3985f1f39349428d17f0d2b81ebc6349">runOnFunction</a></div><div class="ttdeci">static bool runOnFunction(Function &amp;F, bool PostInlining)</div><div class="ttdef"><b>Definition:</b> <a href="EntryExitInstrumenter_8cpp_source.html#l00085">EntryExitInstrumenter.cpp:85</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_a34f1aa991a80c9618af5d4e84aafcb9c"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#a34f1aa991a80c9618af5d4e84aafcb9c">llvm::AtomicRMWInst::isVolatile</a></div><div class="ttdeci">bool isVolatile() const</div><div class="ttdoc">Return true if this is a RMW on a volatile memory location.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00844">Instructions.h:844</a></div></div>
<div class="ttc" id="aConstant_8h_html"><div class="ttname"><a href="Constant_8h.html">Constant.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a05186fa23e4d11b9855a9599ba87a4b7"><div class="ttname"><a href="classllvm_1_1Type.html#a05186fa23e4d11b9855a9599ba87a4b7">llvm::Type::getInt64Ty</a></div><div class="ttdeci">static IntegerType * getInt64Ty(LLVMContext &amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00242">Type.cpp:242</a></div></div>
<div class="ttc" id="aclassllvm_1_1ConstantInt_html_a82dbbd8e3688b0bc1eedb338864d0d0c"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a82dbbd8e3688b0bc1eedb338864d0d0c">llvm::ConstantInt::getTrue</a></div><div class="ttdeci">static ConstantInt * getTrue(LLVMContext &amp;Context)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00835">Constants.cpp:835</a></div></div>
<div class="ttc" id="aclassllvm_1_1Constant_html_aa6574d526b3e38a28f688a7bb4325c2c"><div class="ttname"><a href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">llvm::Constant::getNullValue</a></div><div class="ttdeci">static Constant * getNullValue(Type *Ty)</div><div class="ttdoc">Constructor to create a '0' constant of arbitrary type.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00356">Constants.cpp:356</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_acaf8e4c3e40e01e848c1fad5f05b81cd"><div class="ttname"><a href="classllvm_1_1Type.html#acaf8e4c3e40e01e848c1fad5f05b81cd">llvm::Type::getIntNTy</a></div><div class="ttdeci">static IntegerType * getIntNTy(LLVMContext &amp;C, unsigned N)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00245">Type.cpp:245</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_aba40628328a660c78a9d73cc209f5e84"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84">llvm::TargetLoweringBase::AtomicExpansionKind</a></div><div class="ttdeci">AtomicExpansionKind</div><div class="ttdoc">Enum that specifies what an atomic load/AtomicRMWInst is expanded to, if at all.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l00250">TargetLowering.h:250</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_a461cfbbb5c7a57ab73210498923cf615a92f66d4bc04fc8514bee80509f3e78d4"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a92f66d4bc04fc8514bee80509f3e78d4">llvm::AtomicRMWInst::FSub</a></div><div class="ttdeci">@ FSub</div><div class="ttdoc">*p = old - v</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00758">Instructions.h:758</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1SendMsg_html_a8594419a4ddfad2c9a79279c490e466d"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">llvm::AMDGPU::SendMsg::Op</a></div><div class="ttdeci">Op</div><div class="ttdef"><b>Definition:</b> <a href="SIDefines_8h_source.html#l00357">SIDefines.h:357</a></div></div>
<div class="ttc" id="anamespacellvm_1_1X86_html_a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e"><div class="ttname"><a href="namespacellvm_1_1X86.html#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">llvm::X86::FirstMacroFusionInstKind::Cmp</a></div><div class="ttdeci">@ Cmp</div></div>
<div class="ttc" id="aclassllvm_1_1ExtractValueInst_html"><div class="ttname"><a href="classllvm_1_1ExtractValueInst.html">llvm::ExtractValueInst</a></div><div class="ttdoc">This instruction extracts a struct member or array element value from an aggregate value.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02455">Instructions.h:2455</a></div></div>
<div class="ttc" id="aAArch64Disassembler_8cpp_html_abdb086b34295fb7aa09493c62d798465"><div class="ttname"><a href="AArch64Disassembler_8cpp.html#abdb086b34295fb7aa09493c62d798465">Success</a></div><div class="ttdeci">#define Success</div><div class="ttdef"><b>Definition:</b> <a href="AArch64Disassembler_8cpp_source.html#l00300">AArch64Disassembler.cpp:300</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_a461cfbbb5c7a57ab73210498923cf615a660a31179bfecd737a256372e5fd6122"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a660a31179bfecd737a256372e5fd6122">llvm::AtomicRMWInst::And</a></div><div class="ttdeci">@ And</div><div class="ttdoc">*p = old &amp; v</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00738">Instructions.h:738</a></div></div>
<div class="ttc" id="aclassllvm_1_1Module_html_a9c00c70121af456007404bd456047766"><div class="ttname"><a href="classllvm_1_1Module.html#a9c00c70121af456007404bd456047766">llvm::Module::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const</div><div class="ttdoc">Get the global data context.</div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00262">Module.h:262</a></div></div>
<div class="ttc" id="aCasting_8h_html"><div class="ttname"><a href="Casting_8h.html">Casting.h</a></div></div>
<div class="ttc" id="aFunction_8h_html"><div class="ttname"><a href="Function_8h.html">Function.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_abee0df5f7f703bb4462aba260ba0a60f"><div class="ttname"><a href="namespacellvm.html#abee0df5f7f703bb4462aba260ba0a60f">llvm::BitWidth</a></div><div class="ttdeci">constexpr unsigned BitWidth</div><div class="ttdef"><b>Definition:</b> <a href="BitmaskEnum_8h_source.html#l00147">BitmaskEnum.h:147</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicCmpXchgInst_html_a5a64c7ba0455d8d8652cf471cab58e6e"><div class="ttname"><a href="classllvm_1_1AtomicCmpXchgInst.html#a5a64c7ba0455d8d8652cf471cab58e6e">llvm::AtomicCmpXchgInst::getPointerOperand</a></div><div class="ttdeci">Value * getPointerOperand()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00643">Instructions.h:643</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_adc01a7457de85fc52a3bb860d7e1c6a4"><div class="ttname"><a href="classllvm_1_1Type.html#adc01a7457de85fc52a3bb860d7e1c6a4">llvm::Type::getPointerTo</a></div><div class="ttdeci">PointerType * getPointerTo(unsigned AddrSpace=0) const</div><div class="ttdoc">Return a pointer to the current type.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00776">Type.cpp:776</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_aba40628328a660c78a9d73cc209f5e84ae8e80c2bf991369add363ad75aa12137"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84ae8e80c2bf991369add363ad75aa12137">llvm::TargetLoweringBase::AtomicExpansionKind::MaskedIntrinsic</a></div><div class="ttdeci">@ MaskedIntrinsic</div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_af39e1cad69b6406376c47e4b111228dc"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#af39e1cad69b6406376c47e4b111228dc">llvm::AtomicRMWInst::getPointerAddressSpace</a></div><div class="ttdeci">unsigned getPointerAddressSpace() const</div><div class="ttdoc">Returns the address space of the pointer operand.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00885">Instructions.h:885</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_a461cfbbb5c7a57ab73210498923cf615a9334c9815ddc2b25804c6c03b68cc39b"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a9334c9815ddc2b25804c6c03b68cc39b">llvm::AtomicRMWInst::UIncWrap</a></div><div class="ttdeci">@ UIncWrap</div><div class="ttdoc">Increment one up to a maximum value.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00770">Instructions.h:770</a></div></div>
<div class="ttc" id="aclassllvm_1_1AllocaInst_html_af3bb24b322533dbe8a63c84b18568fe1"><div class="ttname"><a href="classllvm_1_1AllocaInst.html#af3bb24b322533dbe8a63c84b18568fe1">llvm::AllocaInst::setAlignment</a></div><div class="ttdeci">void setAlignment(Align Align)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00129">Instructions.h:129</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_ad0c33604d4cd5e05ce5f285ed47ec5b8"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#ad0c33604d4cd5e05ce5f285ed47ec5b8">llvm::AtomicRMWInst::getValOperand</a></div><div class="ttdeci">Value * getValOperand()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00881">Instructions.h:881</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a6e20e76960d952de088354cbcd14c3ab"><div class="ttname"><a href="classllvm_1_1Type.html#a6e20e76960d952de088354cbcd14c3ab">llvm::Type::getVoidTy</a></div><div class="ttdeci">static Type * getVoidTy(LLVMContext &amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00224">Type.cpp:224</a></div></div>
<div class="ttc" id="aclassllvm_1_1OptimizationRemark_html"><div class="ttname"><a href="classllvm_1_1OptimizationRemark.html">llvm::OptimizationRemark</a></div><div class="ttdoc">Diagnostic information for applied optimization remarks.</div><div class="ttdef"><b>Definition:</b> <a href="DiagnosticInfo_8h_source.html#l00689">DiagnosticInfo.h:689</a></div></div>
<div class="ttc" id="aInstructions_8h_html"><div class="ttname"><a href="Instructions_8h.html">Instructions.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1LoadInst_html_a2eccc19f9061eeb7ad1e30e21f76034d"><div class="ttname"><a href="classllvm_1_1LoadInst.html#a2eccc19f9061eeb7ad1e30e21f76034d">llvm::LoadInst::isVolatile</a></div><div class="ttdeci">bool isVolatile() const</div><div class="ttdoc">Return true if this is a load from a volatile memory location.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00214">Instructions.h:214</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_aba40628328a660c78a9d73cc209f5e84a4cf4a97fbc85619dbd1e34842a54bdba"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a4cf4a97fbc85619dbd1e34842a54bdba">llvm::TargetLoweringBase::AtomicExpansionKind::LLOnly</a></div><div class="ttdeci">@ LLOnly</div></div>
<div class="ttc" id="aSmallVector_8h_html"><div class="ttname"><a href="SmallVector_8h.html">SmallVector.h</a></div></div>
<div class="ttc" id="aUser_8h_html"><div class="ttname"><a href="User_8h.html">User.h</a></div></div>
<div class="ttc" id="aAtomicExpandPass_8cpp_html_a7744d6d4b041b49813f8dc9115a1afc6"><div class="ttname"><a href="AtomicExpandPass_8cpp.html#a7744d6d4b041b49813f8dc9115a1afc6">insertMaskedValue</a></div><div class="ttdeci">static Value * insertMaskedValue(IRBuilderBase &amp;Builder, Value *WideWord, Value *Updated, const PartwordMaskValues &amp;PMV)</div><div class="ttdef"><b>Definition:</b> <a href="AtomicExpandPass_8cpp_source.html#l00782">AtomicExpandPass.cpp:782</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a1a7f07aaef6a3bee130bf0e0f0536802"><div class="ttname"><a href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">llvm::Instruction::getParent</a></div><div class="ttdeci">const BasicBlock * getParent() const</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00090">Instruction.h:90</a></div></div>
<div class="ttc" id="aclassllvm_1_1ArrayRef_html_a85ffb6531d4cda988ea81f18d4e56fb7"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#a85ffb6531d4cda988ea81f18d4e56fb7">llvm::ArrayRef::size</a></div><div class="ttdeci">size_t size() const</div><div class="ttdoc">size - Get the array size.</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00163">ArrayRef.h:163</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_a461cfbbb5c7a57ab73210498923cf615a08ef06068dcd583c2476568dda59b324"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a08ef06068dcd583c2476568dda59b324">llvm::AtomicRMWInst::FAdd</a></div><div class="ttdeci">@ FAdd</div><div class="ttdoc">*p = old + v</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00755">Instructions.h:755</a></div></div>
<div class="ttc" id="aclassllvm_1_1FunctionCallee_html"><div class="ttname"><a href="classllvm_1_1FunctionCallee.html">llvm::FunctionCallee</a></div><div class="ttdoc">A handy container for a FunctionType+Callee-pointer pair, which can be passed around as a single enti...</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00165">DerivedTypes.h:165</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html"><div class="ttname"><a href="classllvm_1_1PHINode.html">llvm::PHINode</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02708">Instructions.h:2708</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicCmpXchgInst_html_a86d413c1d3a59e65cd9fe1c67ea12b0a"><div class="ttname"><a href="classllvm_1_1AtomicCmpXchgInst.html#a86d413c1d3a59e65cd9fe1c67ea12b0a">llvm::AtomicCmpXchgInst::getAlign</a></div><div class="ttdeci">Align getAlign() const</div><div class="ttdoc">Return the alignment of the memory that is being allocated by the instruction.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00558">Instructions.h:558</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_aba40628328a660c78a9d73cc209f5e84a6adf97f83acf6453d4a6a4b1070f3754"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a6adf97f83acf6453d4a6a4b1070f3754">llvm::TargetLoweringBase::AtomicExpansionKind::None</a></div><div class="ttdeci">@ None</div></div>
<div class="ttc" id="anamespacellvm_html_aa59c4ae8c95bb222039942e9ba995c3e"><div class="ttname"><a href="namespacellvm.html#aa59c4ae8c95bb222039942e9ba995c3e">llvm::expandAtomicRMWToCmpXchg</a></div><div class="ttdeci">bool expandAtomicRMWToCmpXchg(AtomicRMWInst *AI, CreateCmpXchgInstFun CreateCmpXchg)</div><div class="ttdoc">Expand an atomic RMW instruction into a loop utilizing cmpxchg.</div><div class="ttdef"><b>Definition:</b> <a href="AtomicExpandPass_8cpp_source.html#l01576">AtomicExpandPass.cpp:1576</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_a461cfbbb5c7a57ab73210498923cf615a497e8f347648b1b2823ee0338c95f65f"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615a497e8f347648b1b2823ee0338c95f65f">llvm::AtomicRMWInst::BAD_BINOP</a></div><div class="ttdeci">@ BAD_BINOP</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00778">Instructions.h:778</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_ab4f441f058eb21d972cd86d45089fc01"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#ab4f441f058eb21d972cd86d45089fc01">llvm::TargetLoweringBase::getMaxAtomicSizeInBitsSupported</a></div><div class="ttdeci">unsigned getMaxAtomicSizeInBitsSupported() const</div><div class="ttdoc">Returns the maximum atomic operation size (in bits) supported by the backend.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l01954">TargetLowering.h:1954</a></div></div>
<div class="ttc" id="aclassllvm_1_1Module_html_a6d883605206368bc536cc9ded97209b8"><div class="ttname"><a href="classllvm_1_1Module.html#a6d883605206368bc536cc9ded97209b8">llvm::Module::getDataLayout</a></div><div class="ttdeci">const DataLayout &amp; getDataLayout() const</div><div class="ttdoc">Get the data layout for the module's target platform.</div><div class="ttdef"><b>Definition:</b> <a href="Module_8cpp_source.html#l00398">Module.cpp:398</a></div></div>
<div class="ttc" id="anamespacellvm_html_ab9c6b351507d3c0730f4290919d43a12"><div class="ttname"><a href="namespacellvm.html#ab9c6b351507d3c0730f4290919d43a12">llvm::ArrayRef</a></div><div class="ttdeci">ArrayRef(const T &amp;OneElt) -&gt; ArrayRef&lt; T &gt;</div></div>
<div class="ttc" id="aDerivedTypes_8h_html"><div class="ttname"><a href="DerivedTypes_8h.html">DerivedTypes.h</a></div></div>
<div class="ttc" id="aPassBuilderBindings_8cpp_html_ab76052bb166c65901edb603a3e1f03ab"><div class="ttname"><a href="PassBuilderBindings_8cpp.html#ab76052bb166c65901edb603a3e1f03ab">TM</a></div><div class="ttdeci">const char LLVMTargetMachineRef TM</div><div class="ttdef"><b>Definition:</b> <a href="PassBuilderBindings_8cpp_source.html#l00047">PassBuilderBindings.cpp:47</a></div></div>
<div class="ttc" id="aclassllvm_1_1IntegerType_html_a14f7b4f1aed38192fb6b7772eb506bdb"><div class="ttname"><a href="classllvm_1_1IntegerType.html#a14f7b4f1aed38192fb6b7772eb506bdb">llvm::IntegerType::get</a></div><div class="ttdeci">static IntegerType * get(LLVMContext &amp;C, unsigned NumBits)</div><div class="ttdoc">This static method is the primary way of constructing an IntegerType.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00313">Type.cpp:313</a></div></div>
<div class="ttc" id="aclassllvm_1_1FunctionPass_html"><div class="ttname"><a href="classllvm_1_1FunctionPass.html">llvm::FunctionPass</a></div><div class="ttdoc">FunctionPass class - This class is used to implement most global optimizations.</div><div class="ttdef"><b>Definition:</b> <a href="Pass_8h_source.html#l00308">Pass.h:308</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallInst_html"><div class="ttname"><a href="classllvm_1_1CallInst.html">llvm::CallInst</a></div><div class="ttdoc">This class represents a function call, abstracting a target machine's calling convention.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01485">Instructions.h:1485</a></div></div>
<div class="ttc" id="alib_2CodeGen_2README_8txt_html_a09776db24cf586ec9f1e18f3bae14099"><div class="ttname"><a href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a></div><div class="ttdeci">Common register allocation spilling lr str ldr sxth r3 ldr mla r4 can lr mov lr str ldr sxth r3 mla r4 and then merge mul and lr str ldr sxth r3 mla r4 It also increase the likelihood the store may become dead bb27 Successors according to LLVM BB</div><div class="ttdef"><b>Definition:</b> <a href="lib_2CodeGen_2README_8txt_source.html#l00039">README.txt:39</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key_html_a1958a762261549463a280bac3274d6d5"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">llvm::AMDGPU::HSAMD::Kernel::Key::Args</a></div><div class="ttdeci">constexpr char Args[]</div><div class="ttdoc">Key for Kernel::Metadata::mArgs.</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUMetadata_8h_source.html#l00394">AMDGPUMetadata.h:394</a></div></div>
<div class="ttc" id="aclassllvm_1_1AllocaInst_html"><div class="ttname"><a href="classllvm_1_1AllocaInst.html">llvm::AllocaInst</a></div><div class="ttdoc">an instruction to allocate memory on the stack</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00058">Instructions.h:58</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_a461cfbbb5c7a57ab73210498923cf615abe171d96ba8de66fb30e08c00211591e"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615abe171d96ba8de66fb30e08c00211591e">llvm::AtomicRMWInst::UMax</a></div><div class="ttdeci">@ UMax</div><div class="ttdoc">*p = old &gt;unsigned v ? old : v</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00750">Instructions.h:750</a></div></div>
<div class="ttc" id="araw__ostream_8h_html"><div class="ttname"><a href="raw__ostream_8h.html">raw_ostream.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLoweringBase_html_aba40628328a660c78a9d73cc209f5e84a369f472273bc816735055f13a6e6fd6c"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html#aba40628328a660c78a9d73cc209f5e84a369f472273bc816735055f13a6e6fd6c">llvm::TargetLoweringBase::AtomicExpansionKind::CmpXChg</a></div><div class="ttdeci">@ CmpXChg</div></div>
<div class="ttc" id="aValue_8h_html"><div class="ttname"><a href="Value_8h.html">Value.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicCmpXchgInst_html_a7ce03ab5b2a6006ebcdfe804e4c8f1a1"><div class="ttname"><a href="classllvm_1_1AtomicCmpXchgInst.html#a7ce03ab5b2a6006ebcdfe804e4c8f1a1">llvm::AtomicCmpXchgInst::getStrongestFailureOrdering</a></div><div class="ttdeci">static AtomicOrdering getStrongestFailureOrdering(AtomicOrdering SuccessOrdering)</div><div class="ttdoc">Returns the strongest permitted ordering on failure, given the desired ordering on success.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00666">Instructions.h:666</a></div></div>
<div class="ttc" id="aInitializePasses_8h_html"><div class="ttname"><a href="InitializePasses_8h.html">InitializePasses.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicCmpXchgInst_html_a1ac603480e5e3cf5e17c5e646aaebea1"><div class="ttname"><a href="classllvm_1_1AtomicCmpXchgInst.html#a1ac603480e5e3cf5e17c5e646aaebea1">llvm::AtomicCmpXchgInst::getMergedOrdering</a></div><div class="ttdeci">AtomicOrdering getMergedOrdering() const</div><div class="ttdoc">Returns a single ordering which is at least as strong as both the success and failure orderings for t...</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00621">Instructions.h:621</a></div></div>
<div class="ttc" id="aclassllvm_1_1ExtractValueInst_html_a9ba97b7365f7fb9a08ae25982806b2a6"><div class="ttname"><a href="classllvm_1_1ExtractValueInst.html#a9ba97b7365f7fb9a08ae25982806b2a6">llvm::ExtractValueInst::getIndices</a></div><div class="ttdeci">ArrayRef&lt; unsigned &gt; getIndices() const</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02520">Instructions.h:2520</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html"><div class="ttname"><a href="classllvm_1_1Value.html">llvm::Value</a></div><div class="ttdoc">LLVM Value Representation.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00074">Value.h:74</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicCmpXchgInst_html"><div class="ttname"><a href="classllvm_1_1AtomicCmpXchgInst.html">llvm::AtomicCmpXchgInst</a></div><div class="ttdoc">An instruction that atomically checks whether a specified value is in a memory location,...</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00513">Instructions.h:513</a></div></div>
<div class="ttc" id="aDebug_8h_html"><div class="ttname"><a href="Debug_8h.html">Debug.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_ab4e0512c7e1c7adaa56677e3155685f1"><div class="ttname"><a href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">llvm::Value::users</a></div><div class="ttdeci">iterator_range&lt; user_iterator &gt; users()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00421">Value.h:421</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ISD_html_a22ea9cec080dd5f4f47ba234c2f59110a7c47226f266248f4b8c155b83601b109"><div class="ttname"><a href="namespacellvm_1_1ISD.html#a22ea9cec080dd5f4f47ba234c2f59110a7c47226f266248f4b8c155b83601b109">llvm::ISD::ATOMIC_LOAD</a></div><div class="ttdeci">@ ATOMIC_LOAD</div><div class="ttdoc">Val, OUTCHAIN = ATOMIC_LOAD(INCHAIN, ptr) This corresponds to &quot;load atomic&quot; instruction.</div><div class="ttdef"><b>Definition:</b> <a href="ISDOpcodes_8h_source.html#l01161">ISDOpcodes.h:1161</a></div></div>
<div class="ttc" id="anamespacellvm_html_a9bccbe67aaab722783ca4e7c504aaaa7a56a57d29a3f9dda8671b4d6490a94b08"><div class="ttname"><a href="namespacellvm.html#a9bccbe67aaab722783ca4e7c504aaaa7a56a57d29a3f9dda8671b4d6490a94b08">llvm::AtomicOrdering::NotAtomic</a></div><div class="ttdeci">@ NotAtomic</div></div>
<div class="ttc" id="aclassllvm_1_1FunctionType_html"><div class="ttname"><a href="classllvm_1_1FunctionType.html">llvm::FunctionType</a></div><div class="ttdoc">Class to represent function types.</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00103">DerivedTypes.h:103</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a833daf718a49c5cd637d8c9ddeaebe07"><div class="ttname"><a href="classllvm_1_1Type.html#a833daf718a49c5cd637d8c9ddeaebe07">llvm::Type::getPrimitiveSizeInBits</a></div><div class="ttdeci">TypeSize getPrimitiveSizeInBits() const LLVM_READONLY</div><div class="ttdoc">Return the basic size of this type if it is a primitive type.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00163">Type.cpp:163</a></div></div>
<div class="ttc" id="aclassllvm_1_1AtomicRMWInst_html_a461cfbbb5c7a57ab73210498923cf615aa1184a7e35e94d162a2d40f2b11beeb2"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html#a461cfbbb5c7a57ab73210498923cf615aa1184a7e35e94d162a2d40f2b11beeb2">llvm::AtomicRMWInst::Max</a></div><div class="ttdeci">@ Max</div><div class="ttdoc">*p = old &gt;signed v ? old : v</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00746">Instructions.h:746</a></div></div>
<div class="ttc" id="aclassllvm_1_1PoisonValue_html_a1bf08613fb664a2e377a9a72c59a6b66"><div class="ttname"><a href="classllvm_1_1PoisonValue.html#a1bf08613fb664a2e377a9a72c59a6b66">llvm::PoisonValue::get</a></div><div class="ttdeci">static PoisonValue * get(Type *T)</div><div class="ttdoc">Static factory methods - Return an 'poison' object of the specified type.</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01759">Constants.cpp:1759</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 7 2023 09:51:32 for LLVM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
