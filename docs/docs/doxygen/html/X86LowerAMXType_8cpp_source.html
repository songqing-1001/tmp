<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: lib/Target/X86/X86LowerAMXType.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LLVM
   &#160;<span id="projectnumber">17.0.0git</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_794e483eb1cc7921d35fd149d9cc325b.html">Target</a></li><li class="navelem"><a class="el" href="dir_558b7c0c66e2ff4834e628dd4b3edd32.html">X86</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">X86LowerAMXType.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="X86LowerAMXType_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- Target/X86/X86LowerAMXType.cpp - -------------------------*- C++ -*-===//</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// See https://llvm.org/LICENSE.txt for license information.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span><span class="comment"></span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">/// \file Pass to transform &lt;256 x i32&gt; load/store</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">/// &lt;256 x i32&gt; is bitcasted to x86_amx on X86, and AMX instruction set only</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">/// provides simple operation on x86_amx. The basic elementwise operation</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">/// is not supported by AMX. Since x86_amx is bitcasted from vector &lt;256 x i32&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">/// and only AMX intrinsics can operate on the type, we need transform</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">/// load/store &lt;256 x i32&gt; instruction to AMX load/store. If the bitcast can</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">/// not be combined with load/store, we transform the bitcast to amx load/store</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">/// and &lt;256 x i32&gt; store/load.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">/// If Front End not use O0 but the Mid/Back end use O0, (e.g. &quot;Clang -O2 -S</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">/// -emit-llvm t.c&quot; + &quot;llc t.ll&quot;) we should make sure the amx data is volatile,</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">/// because that is necessary for AMX fast register allocation. (In Fast</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">/// registera allocation, register will be allocated before spill/reload, so</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">/// there is no additional register for amx to identify the step in spill.)</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">/// The volatileTileData() will handle this case.</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">/// e.g.</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">/// ----------------------------------------------------------</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">/// | def %td = ...                                          |</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">/// | ...                                                    |</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">/// | &quot;use %td&quot;                                              |</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">/// ----------------------------------------------------------</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">/// will transfer to --&gt;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">/// ----------------------------------------------------------</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">/// | def %td = ...                                          |</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">/// | call void @llvm.x86.tilestored64.internal(mem, %td)    |</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">/// | ...                                                    |</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">/// | %td2 = call x86_amx @llvm.x86.tileloadd64.internal(mem)|</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">/// | &quot;use %td2&quot;                                             |</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">/// ----------------------------------------------------------</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"></span><span class="comment">//</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="X86_8h.html">X86.h</a>&quot;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="PostOrderIterator_8h.html">llvm/ADT/PostOrderIterator.h</a>&quot;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SetVector_8h.html">llvm/ADT/SetVector.h</a>&quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallSet_8h.html">llvm/ADT/SmallSet.h</a>&quot;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="OptimizationRemarkEmitter_8h.html">llvm/Analysis/OptimizationRemarkEmitter.h</a>&quot;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetLibraryInfo_8h.html">llvm/Analysis/TargetLibraryInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetTransformInfo_8h.html">llvm/Analysis/TargetTransformInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CodeGen_2Passes_8h.html">llvm/CodeGen/Passes.h</a>&quot;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetPassConfig_8h.html">llvm/CodeGen/TargetPassConfig.h</a>&quot;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ValueTypes_8h.html">llvm/CodeGen/ValueTypes.h</a>&quot;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DataLayout_8h.html">llvm/IR/DataLayout.h</a>&quot;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Function_8h.html">llvm/IR/Function.h</a>&quot;</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IRBuilder_8h.html">llvm/IR/IRBuilder.h</a>&quot;</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Instructions_8h.html">llvm/IR/Instructions.h</a>&quot;</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IntrinsicInst_8h.html">llvm/IR/IntrinsicInst.h</a>&quot;</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &quot;llvm/IR/IntrinsicsX86.h&quot;</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="PatternMatch_8h.html">llvm/IR/PatternMatch.h</a>&quot;</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InitializePasses_8h.html">llvm/InitializePasses.h</a>&quot;</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Pass_8h.html">llvm/Pass.h</a>&quot;</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Target_2TargetMachine_8h.html">llvm/Target/TargetMachine.h</a>&quot;</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AssumeBundleBuilder_8h.html">llvm/Transforms/Utils/AssumeBundleBuilder.h</a>&quot;</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Transforms_2Utils_2Local_8h.html">llvm/Transforms/Utils/Local.h</a>&quot;</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160; </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="keyword">using namespace </span>PatternMatch;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="X86LowerAMXType_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">   69</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;lower-amx-type&quot;</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160; </div>
<div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="X86LowerAMXType_8cpp.html#a040e84d289f1612a27fe09504681a491">   71</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="X86LowerAMXType_8cpp.html#a040e84d289f1612a27fe09504681a491">isAMXCast</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *II) {</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(II,</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;               m_Intrinsic&lt;Intrinsic::x86_cast_vector_to_tile&gt;(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>())) ||</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;         <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(II, m_Intrinsic&lt;Intrinsic::x86_cast_tile_to_vector&gt;(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>()));</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;}</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; </div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="X86LowerAMXType_8cpp.html#ad2e3c5b5a13d5f779e6ec0ef27f21fb1">   77</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="X86LowerAMXType_8cpp.html#ad2e3c5b5a13d5f779e6ec0ef27f21fb1">isAMXIntrinsic</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="keyword">auto</span> *II = dyn_cast&lt;IntrinsicInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="keywordflow">if</span> (!II)</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="X86LowerAMXType_8cpp.html#a040e84d289f1612a27fe09504681a491">isAMXCast</a>(II))</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="comment">// Check if return type or parameter is x86_amx. If it is x86_amx</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="comment">// the intrinsic must be x86 amx intrinsics.</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordflow">if</span> (II-&gt;getType()-&gt;isX86_AMXTy())</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V : II-&gt;args()) {</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordflow">if</span> (V-&gt;getType()-&gt;isX86_AMXTy())</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  }</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;}</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno"><a class="line" href="X86LowerAMXType_8cpp.html#afdbc5171b0df4d8c2f389868ed4f7d51">   95</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *<a class="code" href="X86LowerAMXType_8cpp.html#afdbc5171b0df4d8c2f389868ed4f7d51">createAllocaInstAtEntry</a>(<a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>,</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                                           <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty) {</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getParent();</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <a class="code" href="classllvm_1_1Module.html">Module</a> *<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a> = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getModule();</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>-&gt;getDataLayout();</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160; </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getContext();</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="keyword">auto</span> AllocaAlignment = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getPrefTypeAlign(<a class="code" href="classllvm_1_1Type.html#a08ceb864464bce07aed4387d665f6565">Type::getX86_AMXTy</a>(Ctx));</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="keywordtype">unsigned</span> AllocaAS = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getAllocaAddrSpace();</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AllocaRes =</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      <span class="keyword">new</span> <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a>(Ty, AllocaAS, <span class="stringliteral">&quot;&quot;</span>, &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getEntryBlock().front());</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  AllocaRes-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#af3bb24b322533dbe8a63c84b18568fe1">setAlignment</a>(AllocaAlignment);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keywordflow">return</span> AllocaRes;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;}</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160; </div>
<div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="X86LowerAMXType_8cpp.html#a675e1b0b7e399e08a3be91b58dde8a7a">  110</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="X86LowerAMXType_8cpp.html#a675e1b0b7e399e08a3be91b58dde8a7a">getFirstNonAllocaInTheEntryBlock</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getEntryBlock())</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordflow">if</span> (!isa&lt;AllocaInst&gt;(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      <span class="keywordflow">return</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;No terminator in the entry block!&quot;</span>);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;}</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div>
<div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="X86LowerAMXType_8cpp.html#aea4a4a9addf50f9e92972410a4e3cb17">  117</a></span>&#160;<span class="keyword">static</span> std::pair&lt;Value *, Value *&gt; <a class="code" href="X86LowerAMXType_8cpp.html#aea4a4a9addf50f9e92972410a4e3cb17">getShape</a>(<a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *II, <span class="keywordtype">unsigned</span> OpNo) {</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(II);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Row = <span class="keyword">nullptr</span>, *Col = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordflow">switch</span> (II-&gt;<a class="code" href="classllvm_1_1IntrinsicInst.html#a7ff64b3625b6f9020556ed05a5f72af4">getIntrinsicID</a>()) {</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Expect amx intrinsics&quot;</span>);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="keywordflow">case</span> Intrinsic::x86_tileloadd64_internal:</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="keywordflow">case</span> Intrinsic::x86_tileloaddt164_internal:</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="keywordflow">case</span> Intrinsic::x86_tilestored64_internal: {</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    Row = II-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(0);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    Col = II-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(1);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  }</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="comment">// a * b + c</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="comment">// The shape depends on which operand.</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="keywordflow">case</span> Intrinsic::x86_tdpbssd_internal:</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keywordflow">case</span> Intrinsic::x86_tdpbsud_internal:</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="keywordflow">case</span> Intrinsic::x86_tdpbusd_internal:</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="keywordflow">case</span> Intrinsic::x86_tdpbuud_internal:</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="keywordflow">case</span> Intrinsic::x86_tdpbf16ps_internal:</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keywordflow">case</span> Intrinsic::x86_tdpfp16ps_internal: {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordflow">switch</span> (OpNo) {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      Row = II-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(0);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      Col = II-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(1);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordflow">case</span> 4:</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      Row = II-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(0);</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      Col = II-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(2);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">case</span> 5:</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <span class="keywordflow">if</span> (isa&lt;ConstantInt&gt;(II-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(2)))</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        Row = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt16(</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            (cast&lt;ConstantInt&gt;(II-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(2))-&gt;getSExtValue()) / 4);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;Instruction&gt;(II-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(2))) {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="comment">// When it is not a const value and it is not a function argument, we</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="comment">// create Row after the definition of II-&gt;getOperand(2) instead of</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="comment">// before II. For example, II is %118, we try to getshape for %117:</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <span class="comment">//   %117 = call x86_amx @llvm.x86.cast.vector.to.tile.v256i32(&lt;256 x</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="comment">//   i32&gt; %115).</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="comment">//   %118 = call x86_amx @llvm.x86.tdpbf16ps.internal(i16</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="comment">//   %104, i16 %105, i16 %106, x86_amx %110, x86_amx %114, x86_amx</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="comment">//   %117).</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="comment">// If we create %row = udiv i16 %106, 4 before %118(aka. II), then its</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="comment">// definition is after its user(new tileload for %117).</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="comment">// So, the best choice is to create %row right after the definition of</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="comment">// %106.</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(cast&lt;Instruction&gt;(II-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(2)));</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        Row = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateUDiv(II-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(2), <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt16(4));</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        cast&lt;Instruction&gt;(Row)-&gt;moveAfter(cast&lt;Instruction&gt;(II-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(2)));</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="comment">// When it is not a const value and it is a function argument, we create</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <span class="comment">// Row at the entry bb.</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> NewBuilder(</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            <a class="code" href="X86LowerAMXType_8cpp.html#a675e1b0b7e399e08a3be91b58dde8a7a">getFirstNonAllocaInTheEntryBlock</a>(*II-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>()));</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        Row = NewBuilder.<a class="code" href="classllvm_1_1IRBuilderBase.html#a9c1be64c9c1c59250451d02d1a9ee21b">CreateUDiv</a>(II-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(2), NewBuilder.<a class="code" href="classllvm_1_1IRBuilderBase.html#a4ad9fba0470381b8af861befd5a7bc38">getInt16</a>(4));</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      }</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      Col = II-&gt;<a class="code" href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">getArgOperand</a>(1);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    }</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  }</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  }</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160; </div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="keywordflow">return</span> std::make_pair(Row, Col);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;}</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160; </div>
<div class="line"><a name="l00184"></a><span class="lineno"><a class="line" href="X86LowerAMXType_8cpp.html#ab65e3a31d51a7d0baf295340add7ceae">  184</a></span>&#160;<span class="keyword">static</span> std::pair&lt;Value *, Value *&gt; <a class="code" href="X86LowerAMXType_8cpp.html#aea4a4a9addf50f9e92972410a4e3cb17">getShape</a>(<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *Phi) {</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U = *(Phi-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>());</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="keywordtype">unsigned</span> OpNo = U.<a class="code" href="classllvm_1_1Use.html#a541187eb976df2189b40b3f62ed2cee0">getOperandNo</a>();</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <a class="code" href="classllvm_1_1User.html">User</a> *V = U.<a class="code" href="classllvm_1_1Use.html#a50a2e57da274f8d69b9f932977379cdf">getUser</a>();</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="comment">// TODO We don&#39;t traverse all users. To make the algorithm simple, here we</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="comment">// just traverse the first user. If we can find shape, then return the shape,</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="comment">// otherwise just return nullptr and the optimization for undef/zero will be</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="comment">// abandoned.</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="keywordflow">while</span> (V) {</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="X86LowerAMXType_8cpp.html#a040e84d289f1612a27fe09504681a491">isAMXCast</a>(dyn_cast&lt;Instruction&gt;(V))) {</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <span class="keywordflow">if</span> (V-&gt;<a class="code" href="classllvm_1_1Value.html#a9d7de807ebdfe1819df3ff6cb0f16158">use_empty</a>())</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      <a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U = *(V-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>());</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      OpNo = U.<a class="code" href="classllvm_1_1Use.html#a541187eb976df2189b40b3f62ed2cee0">getOperandNo</a>();</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      V = U.<a class="code" href="classllvm_1_1Use.html#a50a2e57da274f8d69b9f932977379cdf">getUser</a>();</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="X86LowerAMXType_8cpp.html#ad2e3c5b5a13d5f779e6ec0ef27f21fb1">isAMXIntrinsic</a>(V)) {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="X86LowerAMXType_8cpp.html#aea4a4a9addf50f9e92972410a4e3cb17">getShape</a>(cast&lt;IntrinsicInst&gt;(V), OpNo);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(V)) {</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="keywordflow">if</span> (V-&gt;<a class="code" href="classllvm_1_1Value.html#a9d7de807ebdfe1819df3ff6cb0f16158">use_empty</a>())</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      <a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U = *(V-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>());</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      V = U.<a class="code" href="classllvm_1_1Use.html#a50a2e57da274f8d69b9f932977379cdf">getUser</a>();</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    }</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  }</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160; </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="keywordflow">return</span> std::make_pair(<span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;}</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160; </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="keyword">class </span>X86LowerAMXType {</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="namespacellvm_1_1ifs.html#adfe04e1a9cc096fb571e8372debaa67ea00d0b4f2d7dcdaaef835b97cf5d1e0df">Func</a>;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="comment">// In AMX intrinsics we let Shape = {Row, Col}, but the</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="comment">// RealCol = Col / ElementSize. We may use the RealCol</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="comment">// as a new Row for other new created AMX intrinsics.</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  std::map&lt;Value *, Value *&gt; Col2Row;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160; </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  X86LowerAMXType(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) : <a class="code" href="namespacellvm_1_1ifs.html#adfe04e1a9cc096fb571e8372debaa67ea00d0b4f2d7dcdaaef835b97cf5d1e0df">Func</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {}</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keywordtype">bool</span> visit();</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <span class="keywordtype">void</span> combineLoadBitcast(<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85a7289f7156c17c31399fe5226bf556781">LD</a>, <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <span class="keywordtype">void</span> combineBitcastStore(<a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>, <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="keywordtype">bool</span> transformBitcast(<a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;};</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160; </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">// %src = load &lt;256 x i32&gt;, &lt;256 x i32&gt;* %addr, align 64</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">// %2 = bitcast &lt;256 x i32&gt; %src to x86_amx</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">// --&gt;</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">// %2 = call x86_amx @llvm.x86.tileloadd64.internal(i16 %row, i16 %col,</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">// i8* %addr, i64 %stride64)</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="keywordtype">void</span> X86LowerAMXType::combineLoadBitcast(<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85a7289f7156c17c31399fe5226bf556781">LD</a>, <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>) {</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Row = <span class="keyword">nullptr</span>, *Col = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U = *(<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>-&gt;use_begin());</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="keywordtype">unsigned</span> OpNo = U.<a class="code" href="classllvm_1_1Use.html#a541187eb976df2189b40b3f62ed2cee0">getOperandNo</a>();</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="keyword">auto</span> *II = cast&lt;IntrinsicInst&gt;(U.<a class="code" href="classllvm_1_1Use.html#a50a2e57da274f8d69b9f932977379cdf">getUser</a>());</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  std::tie(Row, Col) = <a class="code" href="X86LowerAMXType_8cpp.html#aea4a4a9addf50f9e92972410a4e3cb17">getShape</a>(II, OpNo);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="comment">// Use the maximun column as stride.</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Stride = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt64(64);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *I8Ptr =</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85a7289f7156c17c31399fe5226bf556781">LD</a>-&gt;getOperand(0), <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt8PtrTy());</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  std::array&lt;Value *, 4&gt; <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a> = {Row, Col, I8Ptr, Stride};</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160; </div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewInst = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntrinsic(Intrinsic::x86_tileloadd64_internal,</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                                           std::nullopt, <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>-&gt;replaceAllUsesWith(NewInst);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;}</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160; </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">// %src = call x86_amx @llvm.x86.tileloadd64.internal(%row, %col, %addr,</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">//                                                    %stride);</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">// %13 = bitcast x86_amx %src to &lt;256 x i32&gt;</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">// store &lt;256 x i32&gt; %13, &lt;256 x i32&gt;* %addr, align 64</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">// --&gt;</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">// call void @llvm.x86.tilestored64.internal(%row, %col, %addr,</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">//                                           %stride64, %13)</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="keywordtype">void</span> X86LowerAMXType::combineBitcastStore(<a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>, <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>) {</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Tile = <a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>-&gt;getOperand(0);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keyword">auto</span> *II = cast&lt;IntrinsicInst&gt;(Tile);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="comment">// Tile is output from AMX intrinsic. The first operand of the</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="comment">// intrinsic is row, the second operand of the intrinsic is column.</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Row = II-&gt;getOperand(0);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Col = II-&gt;getOperand(1);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="comment">// Use the maximum column as stride. It must be the same with load</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="comment">// stride.</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Stride = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt64(64);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *I8Ptr =</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;getOperand(1), <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt8PtrTy());</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  std::array&lt;Value *, 5&gt; <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a> = {Row, Col, I8Ptr, Stride, Tile};</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntrinsic(Intrinsic::x86_tilestored64_internal, std::nullopt,</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                          <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>-&gt;hasOneUse())</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="comment">// %13 = bitcast x86_amx %src to &lt;256 x i32&gt;</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="comment">// store &lt;256 x i32&gt; %13, &lt;256 x i32&gt;* %addr, align 64</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="comment">// %add = &lt;256 x i32&gt; %13, &lt;256 x i32&gt; %src2</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="comment">// --&gt;</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="comment">// %13 = bitcast x86_amx %src to &lt;256 x i32&gt;</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="comment">// call void @llvm.x86.tilestored64.internal(%row, %col, %addr,</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="comment">//                                           %stride64, %13)</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="comment">// %14 = load &lt;256 x i32&gt;, %addr</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="comment">// %add = &lt;256 x i32&gt; %14, &lt;256 x i32&gt; %src2</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Vec = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateLoad(<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>-&gt;getType(), <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;getOperand(1));</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>-&gt;replaceAllUsesWith(Vec);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;}</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">// transform bitcast to &lt;store, load&gt; instructions.</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="keywordtype">bool</span> X86LowerAMXType::transformBitcast(<a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>) {</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AllocaAddr;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *I8Ptr, *Stride;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="keyword">auto</span> *Src = <a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>-&gt;getOperand(0);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160; </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keyword">auto</span> Prepare = [&amp;](<a class="code" href="classllvm_1_1Type.html">Type</a> *MemTy) {</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    AllocaAddr = <a class="code" href="X86LowerAMXType_8cpp.html#afdbc5171b0df4d8c2f389868ed4f7d51">createAllocaInstAtEntry</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, <a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>-&gt;getParent(), MemTy);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    I8Ptr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(AllocaAddr, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt8PtrTy());</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    Stride = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt64(64);</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  };</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160; </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>-&gt;getType()-&gt;isX86_AMXTy()) {</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="comment">// %2 = bitcast &lt;256 x i32&gt; %src to x86_amx</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="comment">// --&gt;</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="comment">// %addr = alloca &lt;256 x i32&gt;, align 64</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="comment">// store &lt;256 x i32&gt; %src, &lt;256 x i32&gt;* %addr, align 64</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="comment">// %addr2 = bitcast &lt;256 x i32&gt;* to i8*</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="comment">// %2 = call x86_amx @llvm.x86.tileloadd64.internal(i16 %row, i16 %col,</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="comment">//                                                  i8* %addr2,</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="comment">//                                                  i64 64)</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U = *(<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>-&gt;use_begin());</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordtype">unsigned</span> OpNo = U.<a class="code" href="classllvm_1_1Use.html#a541187eb976df2189b40b3f62ed2cee0">getOperandNo</a>();</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keyword">auto</span> *II = dyn_cast&lt;IntrinsicInst&gt;(U.<a class="code" href="classllvm_1_1Use.html#a50a2e57da274f8d69b9f932977379cdf">getUser</a>());</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">if</span> (!II)</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// May be bitcast from x86amx to &lt;256 x i32&gt;.</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    Prepare(<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>-&gt;getOperand(0)-&gt;getType());</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateStore(Src, AllocaAddr);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="comment">// TODO we can pick an constant operand for the shape.</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Row = <span class="keyword">nullptr</span>, *Col = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    std::tie(Row, Col) = <a class="code" href="X86LowerAMXType_8cpp.html#aea4a4a9addf50f9e92972410a4e3cb17">getShape</a>(II, OpNo);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    std::array&lt;Value *, 4&gt; <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a> = {Row, Col, I8Ptr, Stride};</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *NewInst = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntrinsic(</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        Intrinsic::x86_tileloadd64_internal, std::nullopt, <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>-&gt;replaceAllUsesWith(NewInst);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="comment">// %2 = bitcast x86_amx %src to &lt;256 x i32&gt;</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="comment">// --&gt;</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="comment">// %addr = alloca &lt;256 x i32&gt;, align 64</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="comment">// %addr2 = bitcast &lt;256 x i32&gt;* to i8*</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="comment">// call void @llvm.x86.tilestored64.internal(i16 %row, i16 %col,</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="comment">//                                           i8* %addr2, i64 %stride)</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="comment">// %2 = load &lt;256 x i32&gt;, &lt;256 x i32&gt;* %addr, align 64</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keyword">auto</span> *II = dyn_cast&lt;IntrinsicInst&gt;(Src);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">if</span> (!II)</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// May be bitcast from &lt;256 x i32&gt; to x86amx.</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    Prepare(<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>-&gt;getType());</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Row = II-&gt;getOperand(0);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Col = II-&gt;getOperand(1);</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    std::array&lt;Value *, 5&gt; <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a> = {Row, Col, I8Ptr, Stride, Src};</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntrinsic(Intrinsic::x86_tilestored64_internal, std::nullopt,</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                            <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *NewInst = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateLoad(<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>-&gt;getType(), AllocaAddr);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>-&gt;replaceAllUsesWith(NewInst);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  }</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160; </div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;}</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160; </div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="keywordtype">bool</span> X86LowerAMXType::visit() {</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 8&gt;</a> DeadInsts;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  Col2Row.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160; </div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> : <a class="code" href="namespacellvm.html#aa0953557ed13c0ed48e740653e07c979">post_order</a>(&amp;Func)) {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;Inst : <a class="code" href="namespacellvm.html#a8154638df88e4eaa568b67b23d463dac">llvm::make_early_inc_range</a>(<a class="code" href="namespacellvm.html#a6b0ac1fa4f05de76413c5e0ca6334035">llvm::reverse</a>(*<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>))) {</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a> = dyn_cast&lt;BitCastInst&gt;(&amp;Inst);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>)</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160; </div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Src = <a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>-&gt;getOperand(0);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>-&gt;getType()-&gt;isX86_AMXTy()) {</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>-&gt;user_empty()) {</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;          DeadInsts.push_back(<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>);</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        }</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85a7289f7156c17c31399fe5226bf556781">LD</a> = dyn_cast&lt;LoadInst&gt;(Src);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85a7289f7156c17c31399fe5226bf556781">LD</a>) {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;          <span class="keywordflow">if</span> (transformBitcast(<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>))</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;            DeadInsts.push_back(<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>);</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        }</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <span class="comment">// If load has mutli-user, duplicate a vector load.</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <span class="comment">// %src = load &lt;256 x i32&gt;, &lt;256 x i32&gt;* %addr, align 64</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <span class="comment">// %2 = bitcast &lt;256 x i32&gt; %src to x86_amx</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        <span class="comment">// %add = add &lt;256 x i32&gt; %src, &lt;256 x i32&gt; %src2</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <span class="comment">// --&gt;</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <span class="comment">// %src = load &lt;256 x i32&gt;, &lt;256 x i32&gt;* %addr, align 64</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        <span class="comment">// %2 = call x86_amx @llvm.x86.tileloadd64.internal(i16 %row, i16 %col,</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <span class="comment">//                                            i8* %addr, i64 %stride64)</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        <span class="comment">// %add = add &lt;256 x i32&gt; %src, &lt;256 x i32&gt; %src2</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160; </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <span class="comment">// If load has one user, the load will be eliminated in DAG ISel.</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <span class="comment">// %src = load &lt;256 x i32&gt;, &lt;256 x i32&gt;* %addr, align 64</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        <span class="comment">// %2 = bitcast &lt;256 x i32&gt; %src to x86_amx</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <span class="comment">// --&gt;</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <span class="comment">// %2 = call x86_amx @llvm.x86.tileloadd64.internal(i16 %row, i16 %col,</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="comment">//                                            i8* %addr, i64 %stride64)</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        combineLoadBitcast(<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85a7289f7156c17c31399fe5226bf556781">LD</a>, <a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>);</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        DeadInsts.push_back(<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>);</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85a7289f7156c17c31399fe5226bf556781">LD</a>-&gt;hasOneUse())</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;          DeadInsts.push_back(<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85a7289f7156c17c31399fe5226bf556781">LD</a>);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Src-&gt;getType()-&gt;isX86_AMXTy()) {</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>-&gt;user_empty()) {</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;          DeadInsts.push_back(<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        }</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U : <a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>-&gt;uses()) {</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;          <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a> = dyn_cast&lt;StoreInst&gt;(U.<a class="code" href="classllvm_1_1Use.html#a50a2e57da274f8d69b9f932977379cdf">getUser</a>());</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>)</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        }</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>) {</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;          <span class="keywordflow">if</span> (transformBitcast(<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>))</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            DeadInsts.push_back(<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>);</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        }</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="comment">// If bitcast (%13) has one use, combine bitcast and store to amx store.</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <span class="comment">// %src = call x86_amx @llvm.x86.tileloadd64.internal(%row, %col, %addr,</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        <span class="comment">//                                                    %stride);</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="comment">// %13 = bitcast x86_amx %src to &lt;256 x i32&gt;</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <span class="comment">// store &lt;256 x i32&gt; %13, &lt;256 x i32&gt;* %addr, align 64</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <span class="comment">// --&gt;</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <span class="comment">// call void @llvm.x86.tilestored64.internal(%row, %col, %addr,</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="comment">//                                           %stride64, %13)</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="comment">// If bitcast (%13) has multi-use, transform as below.</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        <span class="comment">// %13 = bitcast x86_amx %src to &lt;256 x i32&gt;</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        <span class="comment">// store &lt;256 x i32&gt; %13, &lt;256 x i32&gt;* %addr, align 64</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <span class="comment">// %add = &lt;256 x i32&gt; %13, &lt;256 x i32&gt; %src2</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        <span class="comment">// --&gt;</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        <span class="comment">// %13 = bitcast x86_amx %src to &lt;256 x i32&gt;</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        <span class="comment">// call void @llvm.x86.tilestored64.internal(%row, %col, %addr,</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        <span class="comment">//                                           %stride64, %13)</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <span class="comment">// %14 = load &lt;256 x i32&gt;, %addr</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        <span class="comment">// %add = &lt;256 x i32&gt; %14, &lt;256 x i32&gt; %src2</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        combineBitcastStore(<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>, <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>);</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        <span class="comment">// Delete user first.</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        DeadInsts.push_back(<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>);</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        DeadInsts.push_back(<a class="code" href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">Bitcast</a>);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      }</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    }</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  }</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160; </div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = !DeadInsts.empty();</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160; </div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Inst : DeadInsts)</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    Inst-&gt;eraseFromParent();</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160; </div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;}</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;} <span class="comment">// anonymous namespace</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160; </div>
<div class="line"><a name="l00448"></a><span class="lineno"><a class="line" href="X86LowerAMXType_8cpp.html#a037d32dd369344ad942d161c3c2681a9">  448</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="X86LowerAMXType_8cpp.html#a037d32dd369344ad942d161c3c2681a9">getAllocaPos</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <a class="code" href="classllvm_1_1Module.html">Module</a> *<a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a> = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getModule();</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getParent();</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(&amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getEntryBlock().front());</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a class="code" href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>-&gt;getDataLayout();</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="keywordtype">unsigned</span> AllocaAS = <a class="code" href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getAllocaAddrSpace();</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *V256I32Ty = <a class="code" href="classllvm_1_1VectorType.html#a8c90e6c50e795b17466482a04947690e">VectorType::get</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt32Ty(), 256, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AllocaRes =</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;      <span class="keyword">new</span> <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a>(V256I32Ty, AllocaAS, <span class="stringliteral">&quot;&quot;</span>, &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getEntryBlock().front());</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> Iter = AllocaRes-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>();</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  ++Iter;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(&amp;*Iter);</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *I8Ptr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(AllocaRes, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt8PtrTy());</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="keywordflow">return</span> I8Ptr;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;}</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160; </div>
<div class="line"><a name="l00464"></a><span class="lineno"><a class="line" href="X86LowerAMXType_8cpp.html#abef33f2e31a1adf2ae4318a9b14b37fc">  464</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="X86LowerAMXType_8cpp.html#abef33f2e31a1adf2ae4318a9b14b37fc">createTileStore</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TileDef, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>) {</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TileDef-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#ab549082d9dfb91ec9a8dc06601d54855">isX86_AMXTy</a>() &amp;&amp; <span class="stringliteral">&quot;Not define tile!&quot;</span>);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="keyword">auto</span> *II = cast&lt;IntrinsicInst&gt;(TileDef);</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(II &amp;&amp; <span class="stringliteral">&quot;Not tile intrinsic!&quot;</span>);</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Row = II-&gt;getOperand(0);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Col = II-&gt;getOperand(1);</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = TileDef-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>();</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> Iter = TileDef-&gt;<a class="code" href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">getIterator</a>();</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, ++Iter);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Stride = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt64(64);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  std::array&lt;Value *, 5&gt; <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a> = {Row, Col, <a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, Stride, TileDef};</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160; </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TileStore = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntrinsic(</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      Intrinsic::x86_tilestored64_internal, std::nullopt, <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>);</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <span class="keywordflow">return</span> TileStore;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;}</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160; </div>
<div class="line"><a name="l00482"></a><span class="lineno"><a class="line" href="X86LowerAMXType_8cpp.html#a20c7ea50a73d61a91772d1c57f2baade">  482</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="X86LowerAMXType_8cpp.html#a20c7ea50a73d61a91772d1c57f2baade">replaceWithTileLoad</a>(<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U, <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, <span class="keywordtype">bool</span> IsPHI = <span class="keyword">false</span>) {</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *V = U.<a class="code" href="classllvm_1_1Use.html#a04219443419738082ae3a5fd4f8e4489">get</a>();</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(V-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#ab549082d9dfb91ec9a8dc06601d54855">isX86_AMXTy</a>() &amp;&amp; <span class="stringliteral">&quot;Not define tile!&quot;</span>);</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160; </div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="comment">// Get tile shape.</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *II = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="keywordflow">if</span> (IsPHI) {</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *PhiOp = dyn_cast&lt;PHINode&gt;(V)-&gt;getIncomingValue(0);</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    II = cast&lt;IntrinsicInst&gt;(PhiOp);</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    II = cast&lt;IntrinsicInst&gt;(V);</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  }</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Row = II-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Col = II-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(1);</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160; </div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *UserI = dyn_cast&lt;Instruction&gt;(U.<a class="code" href="classllvm_1_1Use.html#a50a2e57da274f8d69b9f932977379cdf">getUser</a>());</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(UserI);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Stride = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt64(64);</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  std::array&lt;Value *, 4&gt; <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a> = {Row, Col, <a class="code" href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, Stride};</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160; </div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *TileLoad = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntrinsic(Intrinsic::x86_tileloadd64_internal,</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                                            std::nullopt, <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  UserI-&gt;<a class="code" href="classllvm_1_1User.html#a1600c7959045cb6b6a5f5a1d427ec67e">replaceUsesOfWith</a>(V, TileLoad);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;}</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160; </div>
<div class="line"><a name="l00507"></a><span class="lineno"><a class="line" href="X86LowerAMXType_8cpp.html#acf41daf3eeda8514648fe10fbd699be7">  507</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="X86LowerAMXType_8cpp.html#acf41daf3eeda8514648fe10fbd699be7">isIncomingOfPHI</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U : <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;uses()) {</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <a class="code" href="classllvm_1_1User.html">User</a> *V = U.<a class="code" href="classllvm_1_1Use.html#a50a2e57da274f8d69b9f932977379cdf">getUser</a>();</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(V))</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  }</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;}</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160; </div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">// Let all AMX tile data become volatile data, shorten the life range</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment">// of each tile register before fast register allocation.</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="keyword">class </span>X86VolatileTileData {</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  X86VolatileTileData(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;Func) : <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>(<a class="code" href="namespacellvm_1_1ifs.html#adfe04e1a9cc096fb571e8372debaa67ea00d0b4f2d7dcdaaef835b97cf5d1e0df">Func</a>) {}</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *updatePhiIncomings(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>,</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                            <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 2&gt;</a> &amp;Incomings);</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="keywordtype">void</span> replacePhiDefWithLoad(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, <a class="code" href="classllvm_1_1Value.html">Value</a> *StorePtr);</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="keywordtype">bool</span> volatileTileData();</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="keywordtype">void</span> volatileTilePHI(<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *Inst);</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <span class="keywordtype">void</span> volatileTileNonPHI(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;};</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160; </div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<a class="code" href="classllvm_1_1Value.html">Value</a> *X86VolatileTileData::updatePhiIncomings(</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 2&gt;</a> &amp;Incomings) {</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *I8Ptr = <a class="code" href="X86LowerAMXType_8cpp.html#a037d32dd369344ad942d161c3c2681a9">getAllocaPos</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160; </div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Incomings) {</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <a class="code" href="classllvm_1_1User.html">User</a> *<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Store</a> = <a class="code" href="X86LowerAMXType_8cpp.html#abef33f2e31a1adf2ae4318a9b14b37fc">createTileStore</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, I8Ptr);</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160; </div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="comment">// All its uses (except phi) should load from stored mem.</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U : <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;uses()) {</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      <a class="code" href="classllvm_1_1User.html">User</a> *V = U.<a class="code" href="classllvm_1_1Use.html#a50a2e57da274f8d69b9f932977379cdf">getUser</a>();</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(V) || V == <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Store</a>)</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      <a class="code" href="X86LowerAMXType_8cpp.html#a20c7ea50a73d61a91772d1c57f2baade">replaceWithTileLoad</a>(U, I8Ptr);</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    }</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  }</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="keywordflow">return</span> I8Ptr;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;}</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160; </div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="keywordtype">void</span> X86VolatileTileData::replacePhiDefWithLoad(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>,</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                                                <a class="code" href="classllvm_1_1Value.html">Value</a> *StorePtr) {</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U : <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;uses())</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <a class="code" href="X86LowerAMXType_8cpp.html#a20c7ea50a73d61a91772d1c57f2baade">replaceWithTileLoad</a>(U, StorePtr, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;}</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160; </div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="comment">// Smilar with volatileTileNonPHI, this function only handle PHI Nodes</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="comment">// and their related AMX intrinsics.</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="comment">// 1) PHI Def should change to tileload.</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment">// 2) PHI Incoming Values should tilestored in just after their def.</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment">// 3) The mem of these tileload and tilestores should be same.</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">// e.g.</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment">// ------------------------------------------------------</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment">// bb_dom:</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment">//   ...</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment">//   br i1 %bool.cond, label %if.else, label %if.then</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment">// if.then:</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment">//   def %t0 = ...</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment">//   ...</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment">//   use %t0</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment">//   ...</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="comment">//   br label %if.end</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment">// if.else:</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="comment">//   def %t1 = ...</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment">//   br label %if.end</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment">// if.end:</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">//   %td = phi x86_amx [ %t1, %if.else ], [ %t0, %if.then ]</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment">//   ...</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">//   use %td</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">// ------------------------------------------------------</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment">// --&gt;</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">// ------------------------------------------------------</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="comment">// bb_entry:</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="comment">//   %mem = alloca &lt;256 x i32&gt;, align 1024                  *</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment">//   ...</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">// bb_dom:</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment">//   ...</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment">//   br i1 %bool.cond, label %if.else, label %if.then</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">// if.then:</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment">//   def %t0 = ...</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment">//   call void @llvm.x86.tilestored64.internal(mem, %t0)    *</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment">//   ...</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment">//   %t0` = call x86_amx @llvm.x86.tileloadd64.internal(mem)*</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">//   use %t0`                                               *</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment">//   ...</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">//   br label %if.end</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment">// if.else:</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="comment">//   def %t1 = ...</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="comment">//   call void @llvm.x86.tilestored64.internal(mem, %t1)    *</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="comment">//   br label %if.end</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment">// if.end:</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="comment">//   ...</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment">//   %td = call x86_amx @llvm.x86.tileloadd64.internal(mem) *</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment">//   use %td</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment">// ------------------------------------------------------</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="keywordtype">void</span> X86VolatileTileData::volatileTilePHI(<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>) {</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getParent();</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 2&gt;</a> Incomings;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160; </div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a> = <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getNumIncomingValues(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a> = <a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getIncomingValue(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst = dyn_cast&lt;Instruction&gt;(<a class="code" href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">Op</a>);</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Inst &amp;&amp; <span class="stringliteral">&quot;We shouldn&#39;t fold AMX instrution!&quot;</span>);</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    Incomings.push_back(Inst);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  }</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160; </div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *StorePtr = updatePhiIncomings(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, Incomings);</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  replacePhiDefWithLoad(<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, StorePtr);</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;}</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160; </div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment">// Store the defined tile and load it before use.</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="comment">// All its users are not PHI.</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment">// e.g.</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="comment">// ------------------------------------------------------</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="comment">// def %td = ...</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="comment">// ...</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="comment">// &quot;use %td&quot;</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment">// ------------------------------------------------------</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment">// --&gt;</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="comment">// ------------------------------------------------------</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="comment">// def %td = ...</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="comment">// call void @llvm.x86.tilestored64.internal(mem, %td)</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="comment">// ...</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="comment">// %td2 = call x86_amx @llvm.x86.tileloadd64.internal(mem)</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="comment">// &quot;use %td2&quot;</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment">// ------------------------------------------------------</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="keywordtype">void</span> X86VolatileTileData::volatileTileNonPHI(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *I8Ptr = <a class="code" href="X86LowerAMXType_8cpp.html#a037d32dd369344ad942d161c3c2681a9">getAllocaPos</a>(<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  <a class="code" href="classllvm_1_1User.html">User</a> *<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Store</a> = <a class="code" href="X86LowerAMXType_8cpp.html#abef33f2e31a1adf2ae4318a9b14b37fc">createTileStore</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, I8Ptr);</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160; </div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  <span class="comment">// All its uses should load from stored mem.</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U : <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;uses()) {</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <a class="code" href="classllvm_1_1User.html">User</a> *V = U.<a class="code" href="classllvm_1_1Use.html#a50a2e57da274f8d69b9f932977379cdf">getUser</a>();</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!isa&lt;PHINode&gt;(V) &amp;&amp; <span class="stringliteral">&quot;PHI Nodes should be excluded!&quot;</span>);</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="keywordflow">if</span> (V != <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Store</a>)</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      <a class="code" href="X86LowerAMXType_8cpp.html#a20c7ea50a73d61a91772d1c57f2baade">replaceWithTileLoad</a>(U, I8Ptr);</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  }</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;}</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160; </div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="comment">// Volatile Tile Model:</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="comment">// 1) All the uses of tile data comes from tileload in time.</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="comment">// 2) All the defs of tile data tilestore into mem immediately.</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="comment">// For example:</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="comment">// --------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment">// %t1 = call x86_amx @llvm.x86.tileloadd64.internal(m, k, ...)          key</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment">// %t2 = call x86_amx @llvm.x86.tileloadd64.internal(k, n, ...)</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment">// %t3 = call x86_amx @llvm.x86.tileloadd64.internal(m, n, ...)          amx</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment">// %td = tail call x86_amx @llvm.x86.tdpbssd.internal(m, n, k, t1, t2, t3)</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment">// call void @llvm.x86.tilestored64.internal(... td)                     area</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="comment">// --------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="comment">// 3) No terminator, call or other amx instructions in the key amx area.</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="keywordtype">bool</span> X86VolatileTileData::volatileTileData() {</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> &amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> : <a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) {</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 2&gt;</a> PHIInsts;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 8&gt;</a> AMXDefInsts;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160; </div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType()-&gt;isX86_AMXTy())</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        PHIInsts.push_back(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        AMXDefInsts.push_back(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    }</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160; </div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="comment">// First we &quot;volatile&quot; the non-phi related amx intrinsics.</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : AMXDefInsts) {</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="X86LowerAMXType_8cpp.html#acf41daf3eeda8514648fe10fbd699be7">isIncomingOfPHI</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      volatileTileNonPHI(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    }</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160; </div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : PHIInsts) {</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      volatileTilePHI(dyn_cast&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;      Changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    }</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  }</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  <span class="keywordflow">return</span> Changed;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;}</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160; </div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;} <span class="comment">// anonymous namespace</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160; </div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160; </div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="keyword">class </span>X86LowerAMXCast {</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  <a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="namespacellvm_1_1ifs.html#adfe04e1a9cc096fb571e8372debaa67ea00d0b4f2d7dcdaaef835b97cf5d1e0df">Func</a>;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  std::unique_ptr&lt;DominatorTree&gt; DT;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160; </div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  X86LowerAMXCast(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) : <a class="code" href="namespacellvm_1_1ifs.html#adfe04e1a9cc096fb571e8372debaa67ea00d0b4f2d7dcdaaef835b97cf5d1e0df">Func</a>(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>), DT(nullptr) {}</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  <span class="keywordtype">void</span> combineCastStore(<a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *Cast, <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  <span class="keywordtype">bool</span> combineLoadCast(<a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *Cast, <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85a7289f7156c17c31399fe5226bf556781">LD</a>);</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  <span class="keywordtype">bool</span> combineLdSt(<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;Casts);</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  <span class="keywordtype">bool</span> combineAMXcast(<a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> *TLI);</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  <span class="keywordtype">bool</span> transformAMXCast(<a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *AMXCast);</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  <span class="keywordtype">bool</span> transformAllAMXCast();</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  <span class="keywordtype">bool</span> optimizeAMXCastFromPhi(<a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *CI, <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN,</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                              <a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;Instruction *, 16&gt;</a> &amp;DeadInst);</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;};</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160; </div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="DCE_8cpp.html#ada357ebb15bf8c3cb88900273ec95888">DCEInstruction</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                           <a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;Instruction *, 16&gt;</a> &amp;WorkList,</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                           <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> *TLI) {</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a627b2f86ac433d829482d5a5a0f50668">isInstructionTriviallyDead</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, TLI)) {</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <a class="code" href="namespacellvm.html#a26be1141b23850a2b4eb78021d99e862">salvageDebugInfo</a>(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <a class="code" href="namespacellvm.html#aa39ca296d9689933bb0279c9ac3ee1fc">salvageKnowledge</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160; </div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="comment">// Null out all of the instruction&#39;s operands to see if any operand becomes</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="comment">// dead as we go.</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNumOperands(); <a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *OpV = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;setOperand(<a class="code" href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160; </div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      <span class="keywordflow">if</span> (!OpV-&gt;<a class="code" href="classllvm_1_1Value.html#a9d7de807ebdfe1819df3ff6cb0f16158">use_empty</a>() || <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> == OpV)</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160; </div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      <span class="comment">// If the operand is an instruction that became dead as we nulled out the</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      <span class="comment">// operand, and if it is &#39;trivially&#39; dead, delete it in a future loop</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      <span class="comment">// iteration.</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *OpI = dyn_cast&lt;Instruction&gt;(OpV)) {</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a627b2f86ac433d829482d5a5a0f50668">isInstructionTriviallyDead</a>(OpI, TLI)) {</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;          WorkList.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(OpI);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        }</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      }</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    }</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  }</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;}</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="comment">/// This function handles following case</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;<span class="comment">///     A  -&gt;  B    amxcast</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="comment">///     PHI</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="comment">///     B  -&gt;  A    amxcast</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="comment">/// All the related PHI nodes can be replaced by new PHI nodes with type A.</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="comment">/// The uses of \p CI can be changed to the new PHI node corresponding to \p PN.</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> X86LowerAMXCast::optimizeAMXCastFromPhi(</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *CI, <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN,</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;Instruction *, 16&gt;</a> &amp;DeadInst) {</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(CI);</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Src = CI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *SrcTy = Src-&gt;getType(); <span class="comment">// Type B</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *DestTy = CI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(); <span class="comment">// Type A</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160; </div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;PHINode *, 4&gt;</a> PhiWorklist;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  <a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;PHINode *, 4&gt;</a> OldPhiNodes;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160; </div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  <span class="comment">// Find all of the A-&gt;B casts and PHI nodes.</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  <span class="comment">// We need to inspect all related PHI nodes, but PHIs can be cyclic, so</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  <span class="comment">// OldPhiNodes is used to track all known PHI nodes, before adding a new</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  <span class="comment">// PHI to PhiWorklist, it is checked against and added to OldPhiNodes first.</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  PhiWorklist.push_back(PN);</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  OldPhiNodes.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(PN);</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  <span class="keywordflow">while</span> (!PhiWorklist.empty()) {</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="keyword">auto</span> *OldPN = PhiWorklist.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a0c8ffe664a36e30d49c84d0aded2fe08">pop_back_val</a>();</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; OldPN-&gt;getNumOperands(); ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *IncValue = OldPN-&gt;getIncomingValue(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      <span class="comment">// TODO: currently, We ignore cases where it is a const. In the future, we</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      <span class="comment">// might support const.</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      <span class="keywordflow">if</span> (isa&lt;Constant&gt;(IncValue)) {</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        <span class="keyword">auto</span> *IncConst = dyn_cast&lt;Constant&gt;(IncValue);</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        <span class="keywordflow">if</span> (!isa&lt;UndefValue&gt;(IncValue) &amp;&amp; !IncConst-&gt;isZeroValue())</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *Row = <span class="keyword">nullptr</span>, *Col = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        std::tie(Row, Col) = <a class="code" href="X86LowerAMXType_8cpp.html#aea4a4a9addf50f9e92972410a4e3cb17">getShape</a>(OldPN);</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        <span class="comment">// TODO: If it is not constant the Row and Col must domoniate tilezero</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        <span class="comment">// that we are going to create.</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        <span class="keywordflow">if</span> (!Row || !Col || !isa&lt;Constant&gt;(Row) || !isa&lt;Constant&gt;(Col))</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        <span class="comment">// Create tilezero at the end of incoming block.</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> = OldPN-&gt;getIncomingBlock(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <a class="code" href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> Iter = <a class="code" href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>-&gt;getTerminator()-&gt;getIterator();</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NewInst = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntrinsic(</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;            Intrinsic::x86_tilezero_internal, std::nullopt, {Row, Col});</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        NewInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(&amp;*Iter);</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        NewInst = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntrinsic(Intrinsic::x86_cast_tile_to_vector,</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                                          {IncValue-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()}, {NewInst});</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        NewInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(&amp;*Iter);</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <span class="comment">// Replace InValue with new Value.</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        OldPN-&gt;setIncomingValue(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, NewInst);</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        IncValue = NewInst;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;      }</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160; </div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> *PNode = dyn_cast&lt;PHINode&gt;(IncValue)) {</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        <span class="keywordflow">if</span> (OldPhiNodes.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(PNode))</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;          PhiWorklist.push_back(PNode);</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      }</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ACI = dyn_cast&lt;Instruction&gt;(IncValue);</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;      <span class="keywordflow">if</span> (ACI &amp;&amp; <a class="code" href="X86LowerAMXType_8cpp.html#a040e84d289f1612a27fe09504681a491">isAMXCast</a>(ACI)) {</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <span class="comment">// Verify it&#39;s a A-&gt;B cast.</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        <a class="code" href="classllvm_1_1Type.html">Type</a> *TyA = ACI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        <a class="code" href="classllvm_1_1Type.html">Type</a> *TyB = ACI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        <span class="keywordflow">if</span> (TyA != DestTy || TyB != SrcTy)</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      }</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    }</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  }</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160; </div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  <span class="comment">// Check that each user of each old PHI node is something that we can</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  <span class="comment">// rewrite, so that all of the old PHI nodes can be cleaned up afterwards.</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *OldPN : OldPhiNodes) {</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1User.html">User</a> *V : OldPN-&gt;<a class="code" href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">users</a>()) {</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ACI = dyn_cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;      <span class="keywordflow">if</span> (ACI &amp;&amp; <a class="code" href="X86LowerAMXType_8cpp.html#a040e84d289f1612a27fe09504681a491">isAMXCast</a>(ACI)) {</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        <span class="comment">// Verify it&#39;s a B-&gt;A cast.</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        <a class="code" href="classllvm_1_1Type.html">Type</a> *TyB = ACI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        <a class="code" href="classllvm_1_1Type.html">Type</a> *TyA = ACI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <span class="keywordflow">if</span> (TyA != DestTy || TyB != SrcTy)</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = dyn_cast&lt;PHINode&gt;(V)) {</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        <span class="comment">// As long as the user is another old PHI node, then even if we don&#39;t</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        <span class="comment">// rewrite it, the PHI web we&#39;re considering won&#39;t have any users</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        <span class="comment">// outside itself, so it&#39;ll be dead.</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        <span class="comment">// example:</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        <span class="comment">//   bb.0:</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        <span class="comment">//      %0 = amxcast ...</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        <span class="comment">//   bb.1:</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        <span class="comment">//      %1 = amxcast ...</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        <span class="comment">//   bb.2:</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        <span class="comment">//      %goodphi = phi %0, %1</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        <span class="comment">//      %3 = amxcast %goodphi</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        <span class="comment">//   bb.3:</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        <span class="comment">//      %goodphi2 = phi %0, %goodphi</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        <span class="comment">//      %4 = amxcast %goodphi2</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <span class="comment">// When optimizeAMXCastFromPhi process %3 and %goodphi, %goodphi2 is</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        <span class="comment">// outside the phi-web, so the combination stop When</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        <span class="comment">// optimizeAMXCastFromPhi process %4 and %goodphi2, the optimization</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        <span class="comment">// will be done.</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        <span class="keywordflow">if</span> (OldPhiNodes.count(<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>) == 0)</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      } <span class="keywordflow">else</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    }</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  }</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160; </div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  <span class="comment">// For each old PHI node, create a corresponding new PHI node with a type A.</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;PHINode *, PHINode *&gt;</a> NewPNodes;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *OldPN : OldPhiNodes) {</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(OldPN);</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *NewPN = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreatePHI(DestTy, OldPN-&gt;getNumOperands());</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    NewPNodes[OldPN] = NewPN;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  }</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160; </div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  <span class="comment">// Fill in the operands of new PHI nodes.</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *OldPN : OldPhiNodes) {</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *NewPN = NewPNodes[OldPN];</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a> = 0, <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = OldPN-&gt;getNumOperands(); <a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a> != <a class="code" href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>) {</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V = OldPN-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(<a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>);</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *NewV = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ACI = dyn_cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;      <span class="comment">// There should not be a AMXcast from a const.</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;      <span class="keywordflow">if</span> (ACI &amp;&amp; <a class="code" href="X86LowerAMXType_8cpp.html#a040e84d289f1612a27fe09504681a491">isAMXCast</a>(ACI))</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        NewV = ACI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *PrevPN = dyn_cast&lt;PHINode&gt;(V))</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        NewV = NewPNodes[PrevPN];</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewV);</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;      NewPN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(NewV, OldPN-&gt;getIncomingBlock(<a class="code" href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>));</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    }</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  }</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160; </div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="comment">// Traverse all accumulated PHI nodes and process its users,</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  <span class="comment">// which are Stores and BitcCasts. Without this processing</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <span class="comment">// NewPHI nodes could be replicated and could lead to extra</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  <span class="comment">// moves generated after DeSSA.</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  <span class="comment">// If there is a store with type B, change it to type A.</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160; </div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  <span class="comment">// Replace users of BitCast B-&gt;A with NewPHI. These will help</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  <span class="comment">// later to get rid of a closure formed by OldPHI nodes.</span></div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *OldPN : OldPhiNodes) {</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *NewPN = NewPNodes[OldPN];</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1User.html">User</a> *V : <a class="code" href="namespacellvm.html#a8154638df88e4eaa568b67b23d463dac">make_early_inc_range</a>(OldPN-&gt;users())) {</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ACI = dyn_cast&lt;Instruction&gt;(V);</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;      <span class="keywordflow">if</span> (ACI &amp;&amp; <a class="code" href="X86LowerAMXType_8cpp.html#a040e84d289f1612a27fe09504681a491">isAMXCast</a>(ACI)) {</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        <a class="code" href="classllvm_1_1Type.html">Type</a> *TyB = ACI-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        <a class="code" href="classllvm_1_1Type.html">Type</a> *TyA = ACI-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>();</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TyA == DestTy &amp;&amp; TyB == SrcTy);</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        (void)TyA;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        (void)TyB;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        ACI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewPN);</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        DeadInst.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(ACI);</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> *<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = dyn_cast&lt;PHINode&gt;(V)) {</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        <span class="comment">// We don&#39;t need to push PHINode into DeadInst since they are operands</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        <span class="comment">// of rootPN DCE can safely delete rootPN&#39;s operands if rootPN is dead.</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OldPhiNodes.contains(<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>));</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        (void)<a class="code" href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;      } <span class="keywordflow">else</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        <a class="code" href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;all uses should be handled&quot;</span>);</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    }</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  }</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;}</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160; </div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;<span class="comment">// %43 = call &lt;256 x i32&gt; @llvm.x86.cast.tile.to.vector.v256i32(x86_amx %42)</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;<span class="comment">// store &lt;256 x i32&gt; %43, &lt;256 x i32&gt;* %p, align 64</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;<span class="comment">// --&gt;</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="comment">// call void @llvm.x86.tilestored64.internal(i16 %row, i16 %col, i8* %p,</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="comment">//                                           i64 64, x86_amx %42)</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="keywordtype">void</span> X86LowerAMXCast::combineCastStore(<a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *Cast, <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>) {</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Tile = Cast-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  <span class="comment">// TODO: If it is cast intrinsic or phi node, we can propagate the</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  <span class="comment">// shape information through def-use chain.</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="X86LowerAMXType_8cpp.html#ad2e3c5b5a13d5f779e6ec0ef27f21fb1">isAMXIntrinsic</a>(Tile))</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  <span class="keyword">auto</span> *II = cast&lt;IntrinsicInst&gt;(Tile);</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  <span class="comment">// Tile is output from AMX intrinsic. The first operand of the</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;  <span class="comment">// intrinsic is row, the second operand of the intrinsic is column.</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Row = II-&gt;getOperand(0);</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Col = II-&gt;getOperand(1);</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>);</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  <span class="comment">// Use the maximum column as stride. It must be the same with load</span></div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  <span class="comment">// stride.</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Stride = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt64(64);</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *I8Ptr =</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;      <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a>-&gt;getOperand(1), <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt8PtrTy());</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  std::array&lt;Value *, 5&gt; <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a> = {Row, Col, I8Ptr, Stride, Tile};</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntrinsic(Intrinsic::x86_tilestored64_internal, std::nullopt,</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;                          <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>);</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;}</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160; </div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="comment">// %65 = load &lt;256 x i32&gt;, &lt;256 x i32&gt;* %p, align 64</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;<span class="comment">// %66 = call x86_amx @llvm.x86.cast.vector.to.tile(&lt;256 x i32&gt; %65)</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;<span class="comment">// --&gt;</span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="comment">// %66 = call x86_amx @llvm.x86.tileloadd64.internal(i16 %row, i16 %col,</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="comment">//                                                   i8* %p, i64 64)</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="keywordtype">bool</span> X86LowerAMXCast::combineLoadCast(<a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *Cast, <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85a7289f7156c17c31399fe5226bf556781">LD</a>) {</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  <span class="keywordtype">bool</span> EraseLoad = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Row = <span class="keyword">nullptr</span>, *Col = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  <a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U = *(Cast-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>());</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  <span class="keywordtype">unsigned</span> OpNo = U.<a class="code" href="classllvm_1_1Use.html#a541187eb976df2189b40b3f62ed2cee0">getOperandNo</a>();</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  <span class="keyword">auto</span> *II = cast&lt;IntrinsicInst&gt;(U.<a class="code" href="classllvm_1_1Use.html#a50a2e57da274f8d69b9f932977379cdf">getUser</a>());</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  <span class="comment">// TODO: If it is cast intrinsic or phi node, we can propagate the</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  <span class="comment">// shape information through def-use chain.</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="X86LowerAMXType_8cpp.html#ad2e3c5b5a13d5f779e6ec0ef27f21fb1">isAMXIntrinsic</a>(II))</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  std::tie(Row, Col) = <a class="code" href="X86LowerAMXType_8cpp.html#aea4a4a9addf50f9e92972410a4e3cb17">getShape</a>(II, OpNo);</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85a7289f7156c17c31399fe5226bf556781">LD</a>);</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <span class="comment">// Use the maximun column as stride.</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Stride = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt64(64);</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *I8Ptr;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160; </div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="comment">// To save compiling time, we create doninator tree when it is really</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  <span class="comment">// needed.</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  <span class="keywordflow">if</span> (!DT)</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    DT.reset(<span class="keyword">new</span> <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a>(Func));</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  <span class="keywordflow">if</span> (!DT-&gt;dominates(Row, <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85a7289f7156c17c31399fe5226bf556781">LD</a>) || !DT-&gt;dominates(Col, <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85a7289f7156c17c31399fe5226bf556781">LD</a>)) {</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <span class="comment">// store the value to stack and reload it from stack before cast.</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="keyword">auto</span> *AllocaAddr =</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        <a class="code" href="X86LowerAMXType_8cpp.html#afdbc5171b0df4d8c2f389868ed4f7d51">createAllocaInstAtEntry</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, Cast-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>(), <a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85a7289f7156c17c31399fe5226bf556781">LD</a>-&gt;getType());</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(&amp;*std::next(<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85a7289f7156c17c31399fe5226bf556781">LD</a>-&gt;getIterator()));</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateStore(<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85a7289f7156c17c31399fe5226bf556781">LD</a>, AllocaAddr);</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160; </div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.SetInsertPoint(Cast);</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    I8Ptr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(AllocaAddr, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt8PtrTy());</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    EraseLoad = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    I8Ptr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(<a class="code" href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85a7289f7156c17c31399fe5226bf556781">LD</a>-&gt;getOperand(0), <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt8PtrTy());</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  }</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  std::array&lt;Value *, 4&gt; <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a> = {Row, Col, I8Ptr, Stride};</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160; </div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewInst = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntrinsic(Intrinsic::x86_tileloadd64_internal,</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;                                           std::nullopt, <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>);</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  Cast-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewInst);</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160; </div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  <span class="keywordflow">return</span> EraseLoad;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;}</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160; </div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="keywordtype">bool</span> X86LowerAMXCast::combineLdSt(<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;Casts) {</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  <span class="keywordtype">bool</span> Change = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Cast : Casts) {</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <span class="keyword">auto</span> *II = cast&lt;IntrinsicInst&gt;(Cast);</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    <span class="comment">// %43 = call &lt;256 x i32&gt; @llvm.x86.cast.tile.to.vector(x86_amx %42)</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    <span class="comment">// store &lt;256 x i32&gt; %43, &lt;256 x i32&gt;* %p, align 64</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <span class="comment">// --&gt;</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    <span class="comment">// call void @llvm.x86.tilestored64.internal(i16 %row, i16 %col, i8* %p,</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <span class="comment">//                                           i64 64, x86_amx %42)</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    <span class="keywordflow">if</span> (II-&gt;getIntrinsicID() == Intrinsic::x86_cast_tile_to_vector) {</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 2&gt;</a> DeadStores;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1User.html">User</a> *U : Cast-&gt;<a class="code" href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">users</a>()) {</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Store</a> = dyn_cast&lt;StoreInst&gt;(U);</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Store</a>)</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        combineCastStore(cast&lt;IntrinsicInst&gt;(Cast), <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Store</a>);</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        DeadStores.push_back(<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Store</a>);</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        Change = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;      }</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Store</a> : DeadStores)</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    } <span class="keywordflow">else</span> { <span class="comment">// x86_cast_vector_to_tile</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 2&gt;</a> DeadLoads;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;      <span class="keyword">auto</span> *<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a> = dyn_cast&lt;LoadInst&gt;(Cast-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0));</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a> || !<a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;hasOneUse())</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;      <span class="comment">// %65 = load &lt;256 x i32&gt;, &lt;256 x i32&gt;* %p, align 64</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;      <span class="comment">// %66 = call x86_amx @llvm.x86.cast.vector.to.tile(&lt;256 x i32&gt; %65)</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;      <span class="comment">// --&gt;</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      <span class="comment">// %66 = call x86_amx @llvm.x86.tileloadd64.internal(i16 %row, i16 %col,</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      <span class="comment">//                                                   i8* %p, i64 64)</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;      <span class="keywordflow">if</span> (combineLoadCast(cast&lt;IntrinsicInst&gt;(Cast), <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a>)) {</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;        <span class="comment">// Set the operand is null so that load instruction can be erased.</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        Cast-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        <a class="code" href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;eraseFromParent();</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;      }</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    }</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;  }</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  <span class="keywordflow">return</span> Change;</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;}</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160; </div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="keywordtype">bool</span> X86LowerAMXCast::combineAMXcast(<a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> *TLI) {</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  <span class="keywordtype">bool</span> Change = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  <span class="comment">// Collect tile cast instruction.</span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 8&gt;</a> Vec2TileInsts;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 8&gt;</a> Tile2VecInsts;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 8&gt;</a> PhiCastWorkList;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;  <a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;Instruction *, 16&gt;</a> DeadInst;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> &amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> : Func) {</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Vec;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;                m_Intrinsic&lt;Intrinsic::x86_cast_vector_to_tile&gt;(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(Vec))))</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        Vec2TileInsts.push_back(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, m_Intrinsic&lt;Intrinsic::x86_cast_tile_to_vector&gt;(</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;                             <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(Vec))))</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;        Tile2VecInsts.push_back(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    }</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  }</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160; </div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  <span class="keyword">auto</span> Convert = [&amp;](<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;Insts, <a class="code" href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IID) {</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Inst : Insts) {</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1User.html">User</a> *U : Inst-&gt;<a class="code" href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">users</a>()) {</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        <a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *II = dyn_cast&lt;IntrinsicInst&gt;(U);</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        <span class="keywordflow">if</span> (!II || II-&gt;<a class="code" href="classllvm_1_1IntrinsicInst.html#a7ff64b3625b6f9020556ed05a5f72af4">getIntrinsicID</a>() != IID)</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        <span class="comment">// T1 = vec2tile V0</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;        <span class="comment">// V2 = tile2vec T1</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;        <span class="comment">// V3 = OP V2</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;        <span class="comment">// --&gt;</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;        <span class="comment">// T1 = vec2tile V0</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;        <span class="comment">// V2 = tile2vec T1</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;        <span class="comment">// V3 = OP V0</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;        II-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Inst-&gt;getOperand(0));</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;        Change = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;      }</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    }</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;  };</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160; </div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;  Convert(Vec2TileInsts, Intrinsic::x86_cast_tile_to_vector);</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  Convert(Tile2VecInsts, Intrinsic::x86_cast_vector_to_tile);</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160; </div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 8&gt;</a> LiveCasts;</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  <span class="keyword">auto</span> EraseInst = [&amp;](<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;Insts) {</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Inst : Insts) {</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;      <span class="keywordflow">if</span> (Inst-&gt;use_empty()) {</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        Inst-&gt;eraseFromParent();</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;        Change = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;        LiveCasts.push_back(Inst);</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;      }</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    }</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  };</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160; </div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  EraseInst(Vec2TileInsts);</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;  EraseInst(Tile2VecInsts);</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;  Change |= combineLdSt(LiveCasts);</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;  EraseInst(LiveCasts);</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160; </div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  <span class="comment">// Handle the A-&gt;B-&gt;A cast, and there is an intervening PHI node.</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> &amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> : Func) {</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="X86LowerAMXType_8cpp.html#a040e84d289f1612a27fe09504681a491">isAMXCast</a>(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;        <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0)))</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;          PhiCastWorkList.push_back(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;      }</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    }</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  }</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : PhiCastWorkList) {</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    <span class="comment">// We skip the dead Amxcast.</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    <span class="keywordflow">if</span> (DeadInst.<a class="code" href="classllvm_1_1SetVector.html#a51469ab7f147668678a486661b02ae59">contains</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = cast&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0));</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    <span class="keywordflow">if</span> (optimizeAMXCastFromPhi(cast&lt;IntrinsicInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>), PN, DeadInst)) {</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;      DeadInst.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(PN);</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;      Change = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    }</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;  }</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160; </div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;  <span class="comment">// Since we create new phi and merge AMXCast, some old phis and AMXCast might</span></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;  <span class="comment">// have no uses. We do some DeadCodeElimination for them.</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;  <span class="keywordflow">while</span> (!DeadInst.<a class="code" href="classllvm_1_1SetVector.html#aaf9ee38b9973681c1720aaf03af3a069">empty</a>()) {</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = DeadInst.<a class="code" href="classllvm_1_1SetVector.html#a3499f6a24500afba2c318295ad2d2d05">pop_back_val</a>();</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    Change |= <a class="code" href="DCE_8cpp.html#ada357ebb15bf8c3cb88900273ec95888">DCEInstruction</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, DeadInst, TLI);</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;  }</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;  <span class="keywordflow">return</span> Change;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;}</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160; </div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="comment">// There might be remaining AMXcast after combineAMXcast and they should be</span></div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="comment">// handled elegantly.</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="keywordtype">bool</span> X86LowerAMXCast::transformAMXCast(<a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *AMXCast) {</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>(AMXCast);</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;  <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AllocaAddr;</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *I8Ptr, *Stride;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;  <span class="keyword">auto</span> *Src = AMXCast-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0);</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160; </div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;  <span class="keyword">auto</span> Prepare = [&amp;](<a class="code" href="classllvm_1_1Type.html">Type</a> *MemTy) {</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    AllocaAddr = <a class="code" href="X86LowerAMXType_8cpp.html#afdbc5171b0df4d8c2f389868ed4f7d51">createAllocaInstAtEntry</a>(<a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>, AMXCast-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">getParent</a>(), MemTy);</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    I8Ptr = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateBitCast(AllocaAddr, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt8PtrTy());</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    Stride = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt64(64);</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;  };</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160; </div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;  <span class="keywordflow">if</span> (AMXCast-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#ab549082d9dfb91ec9a8dc06601d54855">isX86_AMXTy</a>()) {</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <span class="comment">// %2 = amxcast &lt;225 x i32&gt; %src to x86_amx</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    <span class="comment">// call void @llvm.x86.tilestored64.internal(i16 15, i16 60,</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    <span class="comment">//                                           i8* %addr3, i64 60, x86_amx %2)</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    <span class="comment">// --&gt;</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    <span class="comment">// %addr = alloca &lt;225 x i32&gt;, align 64</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    <span class="comment">// store &lt;225 x i32&gt; %src, &lt;225 x i32&gt;* %addr, align 64</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    <span class="comment">// %addr2 = bitcast &lt;225 x i32&gt;* %addr to i8*</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    <span class="comment">// %2 = call x86_amx @llvm.x86.tileloadd64.internal(i16 15, i16 60,</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    <span class="comment">//                                                  i8* %addr2,</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    <span class="comment">//                                                  i64 60)</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    <span class="comment">// call void @llvm.x86.tilestored64.internal(i16 15, i16 60,</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    <span class="comment">//                                           i8* %addr3, i64 60, x86_amx %2)</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    <span class="keywordflow">if</span> (AMXCast-&gt;<a class="code" href="classllvm_1_1Value.html#a9d7de807ebdfe1819df3ff6cb0f16158">use_empty</a>()) {</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;      AMXCast-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    }</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    <a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U = *(AMXCast-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>());</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    <span class="keywordtype">unsigned</span> OpNo = U.<a class="code" href="classllvm_1_1Use.html#a541187eb976df2189b40b3f62ed2cee0">getOperandNo</a>();</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    <span class="keyword">auto</span> *II = dyn_cast&lt;IntrinsicInst&gt;(U.<a class="code" href="classllvm_1_1Use.html#a50a2e57da274f8d69b9f932977379cdf">getUser</a>());</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    <span class="keywordflow">if</span> (!II)</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// May be bitcast from x86amx to &lt;256 x i32&gt;.</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    Prepare(AMXCast-&gt;<a class="code" href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateStore(Src, AllocaAddr);</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    <span class="comment">// TODO we can pick an constant operand for the shape.</span></div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Row = <span class="keyword">nullptr</span>, *Col = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    std::tie(Row, Col) = <a class="code" href="X86LowerAMXType_8cpp.html#aea4a4a9addf50f9e92972410a4e3cb17">getShape</a>(II, OpNo);</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    std::array&lt;Value *, 4&gt; <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a> = {</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;        Row, Col, I8Ptr, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSExt(Col, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt64Ty())};</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *NewInst = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntrinsic(</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;        Intrinsic::x86_tileloadd64_internal, std::nullopt, <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>);</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    AMXCast-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewInst);</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    AMXCast-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <span class="comment">// %2 = amxcast x86_amx %src to &lt;225 x i32&gt;</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <span class="comment">// --&gt;</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <span class="comment">// %addr = alloca &lt;225 x i32&gt;, align 64</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <span class="comment">// %addr2 = bitcast &lt;225 x i32&gt;* to i8*</span></div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    <span class="comment">// call void @llvm.x86.tilestored64.internal(i16 %row, i16 %col,</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    <span class="comment">//                                           i8* %addr2, i64 %stride)</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    <span class="comment">// %2 = load &lt;225 x i32&gt;, &lt;225 x i32&gt;* %addr, align 64</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    <span class="keyword">auto</span> *II = dyn_cast&lt;IntrinsicInst&gt;(Src);</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    <span class="keywordflow">if</span> (!II)</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// May be bitcast from &lt;256 x i32&gt; to x86amx.</span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    Prepare(AMXCast-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>());</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Row = II-&gt;getOperand(0);</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Col = II-&gt;getOperand(1);</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    std::array&lt;Value *, 5&gt; <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a> = {</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;        Row, Col, I8Ptr, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateSExt(Col, <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.getInt64Ty()), Src};</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateIntrinsic(Intrinsic::x86_tilestored64_internal, std::nullopt,</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;                            <a class="code" href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">Args</a>);</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *NewInst = <a class="code" href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a>.CreateLoad(AMXCast-&gt;<a class="code" href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">getType</a>(), AllocaAddr);</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    AMXCast-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewInst);</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    AMXCast-&gt;<a class="code" href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">eraseFromParent</a>();</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;  }</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160; </div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;}</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160; </div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;<span class="keywordtype">bool</span> X86LowerAMXCast::transformAllAMXCast() {</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;  <span class="keywordtype">bool</span> Change = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  <span class="comment">// Collect tile cast instruction.</span></div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 8&gt;</a> WorkLists;</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> &amp;<a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> : Func) {</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a class="code" href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="X86LowerAMXType_8cpp.html#a040e84d289f1612a27fe09504681a491">isAMXCast</a>(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;        WorkLists.push_back(&amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    }</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;  }</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160; </div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> *Inst : WorkLists) {</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    Change |= transformAMXCast(cast&lt;IntrinsicInst&gt;(Inst));</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  }</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160; </div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;  <span class="keywordflow">return</span> Change;</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;}</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160; </div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;} <span class="comment">// anonymous namespace</span></div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160; </div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160; </div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;<span class="keyword">class </span>X86LowerAMXTypeLegacyPass : <span class="keyword">public</span> <a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a> {</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>;</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160; </div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;  X86LowerAMXTypeLegacyPass() : <a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a>(<a class="code" href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">ID</a>) {</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    <a class="code" href="namespacellvm.html#aa57013f45eb61fd298b1826b78e46d2a">initializeX86LowerAMXTypeLegacyPassPass</a>(*<a class="code" href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  }</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160; </div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="EntryExitInstrumenter_8cpp.html#a3985f1f39349428d17f0d2b81ebc6349">runOnFunction</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)<span class="keyword"> override </span>{</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    <a class="code" href="classllvm_1_1TargetMachine.html">TargetMachine</a> *<a class="code" href="PassBuilderBindings_8cpp.html#ab76052bb166c65901edb603a3e1f03ab">TM</a> = &amp;getAnalysis&lt;TargetPassConfig&gt;().getTM&lt;<a class="code" href="classllvm_1_1TargetMachine.html">TargetMachine</a>&gt;();</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> *TLI =</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;        &amp;getAnalysis&lt;TargetLibraryInfoWrapperPass&gt;().getTLI(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160; </div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    X86LowerAMXCast LAC(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> |= LAC.combineAMXcast(TLI);</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    <span class="comment">// There might be remaining AMXcast after combineAMXcast and they should be</span></div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    <span class="comment">// handled elegantly.</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> |= LAC.transformAllAMXCast();</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160; </div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    X86LowerAMXType LAT(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> |= LAT.visit();</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160; </div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    <span class="comment">// Prepare for fast register allocation at O0.</span></div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    <span class="comment">// Todo: May better check the volatile model of AMX code, not just</span></div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    <span class="comment">// by checking Attribute::OptimizeNone and CodeGenOpt::None.</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="PassBuilderBindings_8cpp.html#ab76052bb166c65901edb603a3e1f03ab">TM</a>-&gt;getOptLevel() == <a class="code" href="namespacellvm_1_1CodeGenOpt.html#ad7e52174abb1cfb84238ad1ac475ee36a451bbac85aff02d070be3c17a6bef928">CodeGenOpt::None</a>) {</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;      <span class="comment">// If Front End not use O0 but the Mid/Back end use O0, (e.g.</span></div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;      <span class="comment">// &quot;Clang -O2 -S -emit-llvm t.c&quot; + &quot;llc t.ll&quot;) we should make</span></div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;      <span class="comment">// sure the amx data is volatile, that is nessary for AMX fast</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;      <span class="comment">// register allocation.</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasFnAttribute(Attribute::OptimizeNone)) {</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;        X86VolatileTileData VTD(<a class="code" href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;        <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = VTD.volatileTileData() || <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>;</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;      }</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    }</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160; </div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>;</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;  }</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160; </div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;  <span class="keywordtype">void</span> getAnalysisUsage(<a class="code" href="classllvm_1_1AnalysisUsage.html">AnalysisUsage</a> &amp;AU)<span class="keyword"> const override </span>{</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#af11a6ebf7ab3c388234cb6d5378439a3">setPreservesCFG</a>();</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1TargetPassConfig.html">TargetPassConfig</a>&gt;();</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1TargetLibraryInfoWrapperPass.html">TargetLibraryInfoWrapperPass</a>&gt;();</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;  }</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;};</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160; </div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;} <span class="comment">// anonymous namespace</span></div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160; </div>
<div class="line"><a name="l01264"></a><span class="lineno"><a class="line" href="X86LowerAMXType_8cpp.html#adb9257105a403ef9d0773b87693f7779"> 1264</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="X86LowerAMXType_8cpp.html#adb9257105a403ef9d0773b87693f7779">PassName</a>[] = <span class="stringliteral">&quot;Lower AMX type for load/store&quot;</span>;</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;<span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46">X86LowerAMXTypeLegacyPass::ID</a> = 0;</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;<a class="code" href="X86LowerAMXType_8cpp.html#a2137b1559a07e8633b8c8ee6dcec8fc0">INITIALIZE_PASS_BEGIN</a>(X86LowerAMXTypeLegacyPass, <a class="code" href="X86LowerAMXType_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a>, <a class="code" href="X86LowerAMXType_8cpp.html#adb9257105a403ef9d0773b87693f7779">PassName</a>, <span class="keyword">false</span>,</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;                      <span class="keyword">false</span>)</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;<a class="code" href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1TargetPassConfig.html">TargetPassConfig</a>)</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;<a class="code" href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1TargetLibraryInfoWrapperPass.html">TargetLibraryInfoWrapperPass</a>)</div>
<div class="line"><a name="l01270"></a><span class="lineno"><a class="line" href="X86LowerAMXType_8cpp.html#ae6c865df784842196d411c1466b01686"> 1270</a></span>&#160;<a class="code" href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a>(X86LowerAMXTypeLegacyPass, <a class="code" href="X86LowerAMXType_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a>, <a class="code" href="X86LowerAMXType_8cpp.html#adb9257105a403ef9d0773b87693f7779">PassName</a>, <a class="code" href="namespacefalse.html">false</a>,</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;                    <a class="code" href="namespacefalse.html">false</a>)</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160; </div>
<div class="line"><a name="l01273"></a><span class="lineno"><a class="line" href="namespacellvm.html#ad16e92f5dfb41058c8bd8041eab47eb8"> 1273</a></span>&#160;<a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a> *<a class="code" href="namespacellvm.html">llvm</a>::<a class="code" href="namespacellvm.html#ad16e92f5dfb41058c8bd8041eab47eb8">createX86LowerAMXTypePass</a>() {</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> X86LowerAMXTypeLegacyPass();</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="alib_2Target_2README_8txt_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="lib_2Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2README_8txt_source.html#l00029">README.txt:29</a></div></div>
<div class="ttc" id="anamespacellvm_html_ad16e92f5dfb41058c8bd8041eab47eb8"><div class="ttname"><a href="namespacellvm.html#ad16e92f5dfb41058c8bd8041eab47eb8">llvm::createX86LowerAMXTypePass</a></div><div class="ttdeci">FunctionPass * createX86LowerAMXTypePass()</div><div class="ttdoc">The pass transforms load/store &lt;256 x i32&gt; to AMX load/store intrinsics or split the data to two &lt;128...</div><div class="ttdef"><b>Definition:</b> <a href="X86LowerAMXType_8cpp_source.html#l01273">X86LowerAMXType.cpp:1273</a></div></div>
<div class="ttc" id="aValueTypes_8h_html"><div class="ttname"><a href="ValueTypes_8h.html">ValueTypes.h</a></div></div>
<div class="ttc" id="aDCE_8cpp_html_ada357ebb15bf8c3cb88900273ec95888"><div class="ttname"><a href="DCE_8cpp.html#ada357ebb15bf8c3cb88900273ec95888">DCEInstruction</a></div><div class="ttdeci">static bool DCEInstruction(Instruction *I, SmallSetVector&lt; Instruction *, 16 &gt; &amp;WorkList, const TargetLibraryInfo *TLI)</div><div class="ttdef"><b>Definition:</b> <a href="DCE_8cpp_source.html#l00088">DCE.cpp:88</a></div></div>
<div class="ttc" id="aX86LowerAMXType_8cpp_html_a2137b1559a07e8633b8c8ee6dcec8fc0"><div class="ttname"><a href="X86LowerAMXType_8cpp.html#a2137b1559a07e8633b8c8ee6dcec8fc0">INITIALIZE_PASS_BEGIN</a></div><div class="ttdeci">INITIALIZE_PASS_BEGIN(X86LowerAMXTypeLegacyPass, DEBUG_TYPE, PassName, false, false) INITIALIZE_PASS_END(X86LowerAMXTypeLegacyPass</div></div>
<div class="ttc" id="anamespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">This is an optimization pass for GlobalISel generic memory operations.</div><div class="ttdef"><b>Definition:</b> <a href="AddressRanges_8h_source.html#l00018">AddressRanges.h:18</a></div></div>
<div class="ttc" id="alib_2Target_2X86_2README_8txt_html_ac88fe1d3a61b056a4f64fbbb156a62ff"><div class="ttname"><a href="lib_2Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a></div><div class="ttdeci">We currently emits eax Perhaps this is what we really should generate is Is imull three or four cycles eax eax The current instruction priority is based on pattern complexity The former is more complex because it folds a load so the latter will not be emitted Perhaps we should use AddedComplexity to give LEA32r a higher priority We should always try to match LEA first since the LEA matching code does some estimate to determine whether the match is profitable if we care more about code then imull is better It s two bytes shorter than movl leal On a Pentium M</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2X86_2README_8txt_source.html#l00252">README.txt:252</a></div></div>
<div class="ttc" id="aclassllvm_1_1DataLayout_html"><div class="ttname"><a href="classllvm_1_1DataLayout.html">llvm::DataLayout</a></div><div class="ttdoc">A parsed version of the target data layout string in and methods for querying it.</div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00110">DataLayout.h:110</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AArch64PACKey_html_abf4394f452bde3f544999858d71e4b46"><div class="ttname"><a href="namespacellvm_1_1AArch64PACKey.html#abf4394f452bde3f544999858d71e4b46">llvm::AArch64PACKey::ID</a></div><div class="ttdeci">ID</div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00790">AArch64BaseInfo.h:790</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html_a98c0a84a5dfa8bce341c829709f171e5"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a98c0a84a5dfa8bce341c829709f171e5">llvm::BasicBlock::iterator</a></div><div class="ttdeci">InstListType::iterator iterator</div><div class="ttdoc">Instruction iterators...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00087">BasicBlock.h:87</a></div></div>
<div class="ttc" id="aAMDGPURewriteUndefForPHI_8cpp_html_a2e83cb1bc3f5e8986cbd14575755a134"><div class="ttname"><a href="AMDGPURewriteUndefForPHI_8cpp.html#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a></div><div class="ttdeci">Rewrite undef for PHI</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPURewriteUndefForPHI_8cpp_source.html#l00101">AMDGPURewriteUndefForPHI.cpp:101</a></div></div>
<div class="ttc" id="aIntrinsicInst_8h_html"><div class="ttname"><a href="IntrinsicInst_8h.html">IntrinsicInst.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Function_html"><div class="ttname"><a href="classllvm_1_1Function.html">llvm::Function</a></div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00059">Function.h:59</a></div></div>
<div class="ttc" id="aPass_8h_html"><div class="ttname"><a href="Pass_8h.html">Pass.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1IntrinsicInst_html_a7ff64b3625b6f9020556ed05a5f72af4"><div class="ttname"><a href="classllvm_1_1IntrinsicInst.html#a7ff64b3625b6f9020556ed05a5f72af4">llvm::IntrinsicInst::getIntrinsicID</a></div><div class="ttdeci">Intrinsic::ID getIntrinsicID() const</div><div class="ttdoc">Return the intrinsic ID of this intrinsic.</div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00054">IntrinsicInst.h:54</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ARM__MB_html_ad70272e2a9ec2a7e3a497458e1edbc85a7289f7156c17c31399fe5226bf556781"><div class="ttname"><a href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85a7289f7156c17c31399fe5226bf556781">llvm::ARM_MB::LD</a></div><div class="ttdeci">@ LD</div><div class="ttdef"><b>Definition:</b> <a href="MCTargetDesc_2ARMBaseInfo_8h_source.html#l00072">ARMBaseInfo.h:72</a></div></div>
<div class="ttc" id="aclassllvm_1_1BitCastInst_html"><div class="ttname"><a href="classllvm_1_1BitCastInst.html">llvm::BitCastInst</a></div><div class="ttdoc">This class represents a no-op cast from one type to another.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l05258">Instructions.h:5258</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector&lt; Instruction *, 8 &gt;</a></div></div>
<div class="ttc" id="anamespacellvm_1_1LegacyLegalizeActions_html_ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf"><div class="ttname"><a href="namespacellvm_1_1LegacyLegalizeActions.html#ad25716c86372dafbf624b34891685078a031174d0f974cf1041a9cadb84f0dcbf">llvm::LegacyLegalizeActions::Bitcast</a></div><div class="ttdeci">@ Bitcast</div><div class="ttdoc">Perform the operation on a different, but equivalently sized type.</div><div class="ttdef"><b>Definition:</b> <a href="LegacyLegalizerInfo_8h_source.html#l00054">LegacyLegalizerInfo.h:54</a></div></div>
<div class="ttc" id="aclassllvm_1_1IRBuilder_html"><div class="ttname"><a href="classllvm_1_1IRBuilder.html">llvm::IRBuilder&lt;&gt;</a></div></div>
<div class="ttc" id="aclassllvm_1_1Use_html_a04219443419738082ae3a5fd4f8e4489"><div class="ttname"><a href="classllvm_1_1Use.html#a04219443419738082ae3a5fd4f8e4489">llvm::Use::get</a></div><div class="ttdeci">Value * get() const</div><div class="ttdef"><b>Definition:</b> <a href="Use_8h_source.html#l00066">Use.h:66</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallDenseMap_html"><div class="ttname"><a href="classllvm_1_1SmallDenseMap.html">llvm::SmallDenseMap</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00880">DenseMap.h:880</a></div></div>
<div class="ttc" id="aTransforms_2Utils_2Local_8h_html"><div class="ttname"><a href="Transforms_2Utils_2Local_8h.html">Local.h</a></div></div>
<div class="ttc" id="aOptimizationRemarkEmitter_8h_html"><div class="ttname"><a href="OptimizationRemarkEmitter_8h.html">OptimizationRemarkEmitter.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1DominatorTree_html"><div class="ttname"><a href="classllvm_1_1DominatorTree.html">llvm::DominatorTree</a></div><div class="ttdoc">Concrete subclass of DominatorTreeBase that is used to compute a normal dominator tree.</div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00166">Dominators.h:166</a></div></div>
<div class="ttc" id="aX86LowerAMXType_8cpp_html_afdbc5171b0df4d8c2f389868ed4f7d51"><div class="ttname"><a href="X86LowerAMXType_8cpp.html#afdbc5171b0df4d8c2f389868ed4f7d51">createAllocaInstAtEntry</a></div><div class="ttdeci">static AllocaInst * createAllocaInstAtEntry(IRBuilder&lt;&gt; &amp;Builder, BasicBlock *BB, Type *Ty)</div><div class="ttdef"><b>Definition:</b> <a href="X86LowerAMXType_8cpp_source.html#l00095">X86LowerAMXType.cpp:95</a></div></div>
<div class="ttc" id="aX86LowerAMXType_8cpp_html_abef33f2e31a1adf2ae4318a9b14b37fc"><div class="ttname"><a href="X86LowerAMXType_8cpp.html#abef33f2e31a1adf2ae4318a9b14b37fc">createTileStore</a></div><div class="ttdeci">static Instruction * createTileStore(Instruction *TileDef, Value *Ptr)</div><div class="ttdef"><b>Definition:</b> <a href="X86LowerAMXType_8cpp_source.html#l00464">X86LowerAMXType.cpp:464</a></div></div>
<div class="ttc" id="aX86LowerAMXType_8cpp_html_a040e84d289f1612a27fe09504681a491"><div class="ttname"><a href="X86LowerAMXType_8cpp.html#a040e84d289f1612a27fe09504681a491">isAMXCast</a></div><div class="ttdeci">static bool isAMXCast(Instruction *II)</div><div class="ttdef"><b>Definition:</b> <a href="X86LowerAMXType_8cpp_source.html#l00071">X86LowerAMXType.cpp:71</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html"><div class="ttname"><a href="classllvm_1_1Type.html">llvm::Type</a></div><div class="ttdoc">The instances of the Type class are immutable: once they are created, they are never changed.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00045">Type.h:45</a></div></div>
<div class="ttc" id="aX86LowerAMXType_8cpp_html_ad2e3c5b5a13d5f779e6ec0ef27f21fb1"><div class="ttname"><a href="X86LowerAMXType_8cpp.html#ad2e3c5b5a13d5f779e6ec0ef27f21fb1">isAMXIntrinsic</a></div><div class="ttdeci">static bool isAMXIntrinsic(Value *I)</div><div class="ttdef"><b>Definition:</b> <a href="X86LowerAMXType_8cpp_source.html#l00077">X86LowerAMXType.cpp:77</a></div></div>
<div class="ttc" id="aclassllvm_1_1Use_html_a541187eb976df2189b40b3f62ed2cee0"><div class="ttname"><a href="classllvm_1_1Use.html#a541187eb976df2189b40b3f62ed2cee0">llvm::Use::getOperandNo</a></div><div class="ttdeci">unsigned getOperandNo() const</div><div class="ttdoc">Return the operand # of this use in its User.</div><div class="ttdef"><b>Definition:</b> <a href="Use_8cpp_source.html#l00031">Use.cpp:31</a></div></div>
<div class="ttc" id="aX86LowerAMXType_8cpp_html_a20c7ea50a73d61a91772d1c57f2baade"><div class="ttname"><a href="X86LowerAMXType_8cpp.html#a20c7ea50a73d61a91772d1c57f2baade">replaceWithTileLoad</a></div><div class="ttdeci">static void replaceWithTileLoad(Use &amp;U, Value *Ptr, bool IsPHI=false)</div><div class="ttdef"><b>Definition:</b> <a href="X86LowerAMXType_8cpp_source.html#l00482">X86LowerAMXType.cpp:482</a></div></div>
<div class="ttc" id="anamespacellvm_1_1SPII_html_a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f"><div class="ttname"><a href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa5069619ca8fdce305534f3fe85091a0f">llvm::SPII::Load</a></div><div class="ttdeci">@ Load</div><div class="ttdef"><b>Definition:</b> <a href="SparcInstrInfo_8h_source.html#l00032">SparcInstrInfo.h:32</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_a96d73bbd7af15cb1fc38c3f4a3bd82e9"><div class="ttname"><a href="MD5_8cpp.html#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a></div><div class="ttdeci">#define F(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00055">MD5.cpp:55</a></div></div>
<div class="ttc" id="aX86LowerAMXType_8cpp_html_ad78e062f62e0d6e453941fb4ca843e4d"><div class="ttname"><a href="X86LowerAMXType_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a></div><div class="ttdeci">#define DEBUG_TYPE</div><div class="ttdef"><b>Definition:</b> <a href="X86LowerAMXType_8cpp_source.html#l00069">X86LowerAMXType.cpp:69</a></div></div>
<div class="ttc" id="aclassllvm_1_1BasicBlock_html"><div class="ttname"><a href="classllvm_1_1BasicBlock.html">llvm::BasicBlock</a></div><div class="ttdoc">LLVM Basic Block Representation.</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00055">BasicBlock.h:55</a></div></div>
<div class="ttc" id="aX86_8h_html"><div class="ttname"><a href="X86_8h.html">X86.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_a08ceb864464bce07aed4387d665f6565"><div class="ttname"><a href="classllvm_1_1Type.html#a08ceb864464bce07aed4387d665f6565">llvm::Type::getX86_AMXTy</a></div><div class="ttdeci">static Type * getX86_AMXTy(LLVMContext &amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00236">Type.cpp:236</a></div></div>
<div class="ttc" id="aTarget_2TargetMachine_8h_html"><div class="ttname"><a href="Target_2TargetMachine_8h.html">TargetMachine.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1PassRegistry_html_a05a729900b76c89e808c6c3094921b2f"><div class="ttname"><a href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">llvm::PassRegistry::getPassRegistry</a></div><div class="ttdeci">static PassRegistry * getPassRegistry()</div><div class="ttdoc">getPassRegistry - Access the global registry object, which is automatically initialized at applicatio...</div><div class="ttdef"><b>Definition:</b> <a href="PassRegistry_8cpp_source.html#l00024">PassRegistry.cpp:24</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a25d956d9e0beadd47ce4bc255dfa811d"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">llvm::PatternMatch::match</a></div><div class="ttdeci">bool match(Val *V, const Pattern &amp;P)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00049">PatternMatch.h:49</a></div></div>
<div class="ttc" id="aBuiltinGCs_8cpp_html_a6742d2e0a668baf1196ec69e158d5f15"><div class="ttname"><a href="BuiltinGCs_8cpp.html#a6742d2e0a668baf1196ec69e158d5f15">E</a></div><div class="ttdeci">static GCRegistry::Add&lt; CoreCLRGC &gt; E(&quot;coreclr&quot;, &quot;CoreCLR-compatible GC&quot;)</div></div>
<div class="ttc" id="aclassllvm_1_1User_html"><div class="ttname"><a href="classllvm_1_1User.html">llvm::User</a></div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00044">User.h:44</a></div></div>
<div class="ttc" id="aREADME__ALTIVEC_8txt_html_a9aacd9146afe44bf656cd664e2a88c8c"><div class="ttname"><a href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a></div><div class="ttdeci">(vector float) vec_cmpeq(*A, *B) C</div><div class="ttdef"><b>Definition:</b> <a href="README__ALTIVEC_8txt_source.html#l00086">README_ALTIVEC.txt:86</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisUsage_html"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html">llvm::AnalysisUsage</a></div><div class="ttdoc">Represent the analysis usage information of a pass.</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00047">PassAnalysisSupport.h:47</a></div></div>
<div class="ttc" id="aTargetLibraryInfo_8h_html"><div class="ttname"><a href="TargetLibraryInfo_8h.html">TargetLibraryInfo.h</a></div></div>
<div class="ttc" id="aAssumeBundleBuilder_8h_html"><div class="ttname"><a href="AssumeBundleBuilder_8h.html">AssumeBundleBuilder.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1SPII_html_a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856"><div class="ttname"><a href="namespacellvm_1_1SPII.html#a1c7202c6054fef862bbed45957747cdfa36b3dd3b84fde3f8494a9b18af131856">llvm::SPII::Store</a></div><div class="ttdeci">@ Store</div><div class="ttdef"><b>Definition:</b> <a href="SparcInstrInfo_8h_source.html#l00033">SparcInstrInfo.h:33</a></div></div>
<div class="ttc" id="anamespacefalse_html"><div class="ttname"><a href="namespacefalse.html">false</a></div><div class="ttdef"><b>Definition:</b> <a href="StackSlotColoring_8cpp_source.html#l00141">StackSlotColoring.cpp:141</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html"><div class="ttname"><a href="classllvm_1_1Instruction.html">llvm::Instruction</a></div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00041">Instruction.h:41</a></div></div>
<div class="ttc" id="anamespacellvm_html_a26be1141b23850a2b4eb78021d99e862"><div class="ttname"><a href="namespacellvm.html#a26be1141b23850a2b4eb78021d99e862">llvm::salvageDebugInfo</a></div><div class="ttdeci">void salvageDebugInfo(const MachineRegisterInfo &amp;MRI, MachineInstr &amp;MI)</div><div class="ttdoc">Assuming the instruction MI is going to be deleted, attempt to salvage debug users of MI by writing t...</div><div class="ttdef"><b>Definition:</b> <a href="CodeGen_2GlobalISel_2Utils_8cpp_source.html#l01367">Utils.cpp:1367</a></div></div>
<div class="ttc" id="aclassllvm_1_1Use_html_a50a2e57da274f8d69b9f932977379cdf"><div class="ttname"><a href="classllvm_1_1Use.html#a50a2e57da274f8d69b9f932977379cdf">llvm::Use::getUser</a></div><div class="ttdeci">User * getUser() const</div><div class="ttdoc">Returns the User that contains this Use.</div><div class="ttdef"><b>Definition:</b> <a href="Use_8h_source.html#l00072">Use.h:72</a></div></div>
<div class="ttc" id="aPatternMatch_8h_html"><div class="ttname"><a href="PatternMatch_8h.html">PatternMatch.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html_aaf9ee38b9973681c1720aaf03af3a069"><div class="ttname"><a href="classllvm_1_1SetVector.html#aaf9ee38b9973681c1720aaf03af3a069">llvm::SetVector&lt; T, SmallVector&lt; T, N &gt;, SmallDenseSet&lt; T, N &gt; &gt;::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdoc">Determine if the SetVector is empty or not.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00072">SetVector.h:72</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a9d7de807ebdfe1819df3ff6cb0f16158"><div class="ttname"><a href="classllvm_1_1Value.html#a9d7de807ebdfe1819df3ff6cb0f16158">llvm::Value::use_empty</a></div><div class="ttdeci">bool use_empty() const</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00344">Value.h:344</a></div></div>
<div class="ttc" id="anamespacellvm_1_1CallingConv_html_a188c0836f8c3528401f1c236fd93b977"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a188c0836f8c3528401f1c236fd93b977">llvm::CallingConv::ID</a></div><div class="ttdeci">unsigned ID</div><div class="ttdoc">LLVM IR allows to use arbitrary numbers as calling convention identifiers.</div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00024">CallingConv.h:24</a></div></div>
<div class="ttc" id="aPassSupport_8h_html_a74ce8276b89067e806f67c45a6d92575"><div class="ttname"><a href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a></div><div class="ttdeci">#define INITIALIZE_PASS_END(passName, arg, name, cfg, analysis)</div><div class="ttdef"><b>Definition:</b> <a href="PassSupport_8h_source.html#l00059">PassSupport.h:59</a></div></div>
<div class="ttc" id="aCodeGen_2Passes_8h_html"><div class="ttname"><a href="CodeGen_2Passes_8h.html">Passes.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetPassConfig_html"><div class="ttname"><a href="classllvm_1_1TargetPassConfig.html">llvm::TargetPassConfig</a></div><div class="ttdoc">Target-Independent Code Generator Pass Configuration Options.</div><div class="ttdef"><b>Definition:</b> <a href="TargetPassConfig_8h_source.html#l00084">TargetPassConfig.h:84</a></div></div>
<div class="ttc" id="aclassllvm_1_1StoreInst_html"><div class="ttname"><a href="classllvm_1_1StoreInst.html">llvm::StoreInst</a></div><div class="ttdoc">An instruction for storing to memory.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00301">Instructions.h:301</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html_a51469ab7f147668678a486661b02ae59"><div class="ttname"><a href="classllvm_1_1SetVector.html#a51469ab7f147668678a486661b02ae59">llvm::SetVector&lt; T, SmallVector&lt; T, N &gt;, SmallDenseSet&lt; T, N &gt; &gt;::contains</a></div><div class="ttdeci">bool contains(const key_type &amp;key) const</div><div class="ttdoc">Check if the SetVector contains the given key.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00202">SetVector.h:202</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_ae6b978645b8ac72d1a35e1298ffdd4f0"><div class="ttname"><a href="classllvm_1_1Instruction.html#ae6b978645b8ac72d1a35e1298ffdd4f0">llvm::Instruction::eraseFromParent</a></div><div class="ttdeci">SymbolTableList&lt; Instruction &gt;::iterator eraseFromParent()</div><div class="ttdoc">This method unlinks 'this' from the containing basic block and deletes it.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00082">Instruction.cpp:82</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLibraryInfoWrapperPass_html"><div class="ttname"><a href="classllvm_1_1TargetLibraryInfoWrapperPass.html">llvm::TargetLibraryInfoWrapperPass</a></div><div class="ttdef"><b>Definition:</b> <a href="TargetLibraryInfo_8h_source.html#l00565">TargetLibraryInfo.h:565</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ARM__MB_html_ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2"><div class="ttname"><a href="namespacellvm_1_1ARM__MB.html#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">llvm::ARM_MB::ST</a></div><div class="ttdeci">@ ST</div><div class="ttdef"><b>Definition:</b> <a href="MCTargetDesc_2ARMBaseInfo_8h_source.html#l00073">ARMBaseInfo.h:73</a></div></div>
<div class="ttc" id="aSVEIntrinsicOpts_8cpp_html_a2bb87eb1bcbc74783a83ae945eb8fa36"><div class="ttname"><a href="SVEIntrinsicOpts_8cpp.html#a2bb87eb1bcbc74783a83ae945eb8fa36">INITIALIZE_PASS_DEPENDENCY</a></div><div class="ttdeci">INITIALIZE_PASS_DEPENDENCY(DominatorTreeWrapperPass)</div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html_a089cccb6f231efee72abc76d0f9c695f"><div class="ttname"><a href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">llvm::PHINode::addIncoming</a></div><div class="ttdeci">void addIncoming(Value *V, BasicBlock *BB)</div><div class="ttdoc">Add an incoming value to the end of the PHI list.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02854">Instructions.h:2854</a></div></div>
<div class="ttc" id="aclassllvm_1_1LLVMContext_html"><div class="ttname"><a href="classllvm_1_1LLVMContext.html">llvm::LLVMContext</a></div><div class="ttdoc">This is an important class for using LLVM in a threaded context.</div><div class="ttdef"><b>Definition:</b> <a href="LLVMContext_8h_source.html#l00067">LLVMContext.h:67</a></div></div>
<div class="ttc" id="anamespacellvm_1_1numbers_html_a92f4283d4e0e2ea1776894b3ae93640f"><div class="ttname"><a href="namespacellvm_1_1numbers.html#a92f4283d4e0e2ea1776894b3ae93640f">llvm::numbers::e</a></div><div class="ttdeci">constexpr double e</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00031">MathExtras.h:31</a></div></div>
<div class="ttc" id="aMD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00058">MD5.cpp:58</a></div></div>
<div class="ttc" id="anamespacellvm_html_a8154638df88e4eaa568b67b23d463dac"><div class="ttname"><a href="namespacellvm.html#a8154638df88e4eaa568b67b23d463dac">llvm::make_early_inc_range</a></div><div class="ttdeci">iterator_range&lt; early_inc_iterator_impl&lt; detail::IterOfRange&lt; RangeT &gt; &gt; &gt; make_early_inc_range(RangeT &amp;&amp;Range)</div><div class="ttdoc">Make a range that does early increment to allow mutation of the underlying range without disrupting i...</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00721">STLExtras.h:721</a></div></div>
<div class="ttc" id="aX86LowerAMXType_8cpp_html_a037d32dd369344ad942d161c3c2681a9"><div class="ttname"><a href="X86LowerAMXType_8cpp.html#a037d32dd369344ad942d161c3c2681a9">getAllocaPos</a></div><div class="ttdeci">static Value * getAllocaPos(BasicBlock *BB)</div><div class="ttdef"><b>Definition:</b> <a href="X86LowerAMXType_8cpp_source.html#l00448">X86LowerAMXType.cpp:448</a></div></div>
<div class="ttc" id="aTargetPassConfig_8h_html"><div class="ttname"><a href="TargetPassConfig_8h.html">TargetPassConfig.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_aa57013f45eb61fd298b1826b78e46d2a"><div class="ttname"><a href="namespacellvm.html#aa57013f45eb61fd298b1826b78e46d2a">llvm::initializeX86LowerAMXTypeLegacyPassPass</a></div><div class="ttdeci">void initializeX86LowerAMXTypeLegacyPassPass(PassRegistry &amp;)</div></div>
<div class="ttc" id="aIRBuilder_8h_html"><div class="ttname"><a href="IRBuilder_8h.html">IRBuilder.h</a></div></div>
<div class="ttc" id="aSILowerControlFlow_8cpp_html_a4868c5d81c5ccc98c47aeab6244346a0"><div class="ttname"><a href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a></div><div class="ttdeci">assert(ImpDefSCC.getReg()==AMDGPU::SCC &amp;&amp;ImpDefSCC.isDef())</div></div>
<div class="ttc" id="aclassllvm_1_1TargetMachine_html"><div class="ttname"><a href="classllvm_1_1TargetMachine.html">llvm::TargetMachine</a></div><div class="ttdoc">Primary interface to the complete machine description for the target machine.</div><div class="ttdef"><b>Definition:</b> <a href="Target_2TargetMachine_8h_source.html#l00078">TargetMachine.h:78</a></div></div>
<div class="ttc" id="aTargetLibraryInfo_8cpp_html_aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053"><div class="ttname"><a href="TargetLibraryInfo_8cpp.html#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a></div><div class="ttdeci">@ Ptr</div><div class="ttdef"><b>Definition:</b> <a href="TargetLibraryInfo_8cpp_source.html#l00062">TargetLibraryInfo.cpp:62</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a413abcab8dbc3900fc2fde96a5d8fca6"><div class="ttname"><a href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">llvm::Value::use_begin</a></div><div class="ttdeci">use_iterator use_begin()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00360">Value.h:360</a></div></div>
<div class="ttc" id="anamespacellvm_html_aa39ca296d9689933bb0279c9ac3ee1fc"><div class="ttname"><a href="namespacellvm.html#aa39ca296d9689933bb0279c9ac3ee1fc">llvm::salvageKnowledge</a></div><div class="ttdeci">void salvageKnowledge(Instruction *I, AssumptionCache *AC=nullptr, DominatorTree *DT=nullptr)</div><div class="ttdoc">Calls BuildAssumeFromInst and if the resulting llvm.assume is valid insert if before I.</div><div class="ttdef"><b>Definition:</b> <a href="AssumeBundleBuilder_8cpp_source.html#l00293">AssumeBundleBuilder.cpp:293</a></div></div>
<div class="ttc" id="aclassllvm_1_1Module_html"><div class="ttname"><a href="classllvm_1_1Module.html">llvm::Module</a></div><div class="ttdoc">A Module instance is used to store all the information related to an LLVM module.</div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00065">Module.h:65</a></div></div>
<div class="ttc" id="anamespacellvm_1_1CodeGenOpt_html_ad7e52174abb1cfb84238ad1ac475ee36a451bbac85aff02d070be3c17a6bef928"><div class="ttname"><a href="namespacellvm_1_1CodeGenOpt.html#ad7e52174abb1cfb84238ad1ac475ee36a451bbac85aff02d070be3c17a6bef928">llvm::CodeGenOpt::None</a></div><div class="ttdeci">@ None</div><div class="ttdoc">-O0</div><div class="ttdef"><b>Definition:</b> <a href="CodeGen_8h_source.html#l00058">CodeGen.h:58</a></div></div>
<div class="ttc" id="aX86LowerAMXType_8cpp_html_adb9257105a403ef9d0773b87693f7779"><div class="ttname"><a href="X86LowerAMXType_8cpp.html#adb9257105a403ef9d0773b87693f7779">PassName</a></div><div class="ttdeci">static const char PassName[]</div><div class="ttdef"><b>Definition:</b> <a href="X86LowerAMXType_8cpp_source.html#l01264">X86LowerAMXType.cpp:1264</a></div></div>
<div class="ttc" id="aAssumeBundleBuilder_8cpp_html_afb136e0532bcaed86521b462e6538d62"><div class="ttname"><a href="AssumeBundleBuilder_8cpp.html#afb136e0532bcaed86521b462e6538d62">Builder</a></div><div class="ttdeci">assume Assume Builder</div><div class="ttdef"><b>Definition:</b> <a href="AssumeBundleBuilder_8cpp_source.html#l00651">AssumeBundleBuilder.cpp:651</a></div></div>
<div class="ttc" id="anamespacellvm_1_1PatternMatch_html_a24bca8838396aa81b87de8e7ac774b19"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">llvm::PatternMatch::m_Value</a></div><div class="ttdeci">class_match&lt; Value &gt; m_Value()</div><div class="ttdoc">Match an arbitrary value and ignore it.</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00076">PatternMatch.h:76</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html_a5fa9b8e1842b354f64c1ba6be0a4a17f"><div class="ttname"><a href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">llvm::User::setOperand</a></div><div class="ttdeci">void setOperand(unsigned i, Value *Val)</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00174">User.h:174</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html_a72d928b7fc2c5f2d56c6ac0265fd9c6e"><div class="ttname"><a href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">llvm::SetVector&lt; T, SmallVector&lt; T, N &gt;, SmallDenseSet&lt; T, N &gt; &gt;::insert</a></div><div class="ttdeci">bool insert(const value_type &amp;X)</div><div class="ttdoc">Insert a new element into the SetVector.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00141">SetVector.h:141</a></div></div>
<div class="ttc" id="aX86LowerAMXType_8cpp_html_a675e1b0b7e399e08a3be91b58dde8a7a"><div class="ttname"><a href="X86LowerAMXType_8cpp.html#a675e1b0b7e399e08a3be91b58dde8a7a">getFirstNonAllocaInTheEntryBlock</a></div><div class="ttdeci">static Instruction * getFirstNonAllocaInTheEntryBlock(Function &amp;F)</div><div class="ttdef"><b>Definition:</b> <a href="X86LowerAMXType_8cpp_source.html#l00110">X86LowerAMXType.cpp:110</a></div></div>
<div class="ttc" id="anamespacellvm_html_a627b2f86ac433d829482d5a5a0f50668"><div class="ttname"><a href="namespacellvm.html#a627b2f86ac433d829482d5a5a0f50668">llvm::isInstructionTriviallyDead</a></div><div class="ttdeci">bool isInstructionTriviallyDead(Instruction *I, const TargetLibraryInfo *TLI=nullptr)</div><div class="ttdoc">Return true if the result produced by the instruction is not used, and the instruction will return.</div><div class="ttdef"><b>Definition:</b> <a href="Transforms_2Utils_2Local_8cpp_source.html#l00398">Local.cpp:398</a></div></div>
<div class="ttc" id="aclassllvm_1_1SetVector_html_a3499f6a24500afba2c318295ad2d2d05"><div class="ttname"><a href="classllvm_1_1SetVector.html#a3499f6a24500afba2c318295ad2d2d05">llvm::SetVector&lt; T, SmallVector&lt; T, N &gt;, SmallDenseSet&lt; T, N &gt; &gt;::pop_back_val</a></div><div class="ttdeci">T pop_back_val()</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00225">SetVector.h:225</a></div></div>
<div class="ttc" id="aDataLayout_8h_html"><div class="ttname"><a href="DataLayout_8h.html">DataLayout.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisUsage_html_af11a6ebf7ab3c388234cb6d5378439a3"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#af11a6ebf7ab3c388234cb6d5378439a3">llvm::AnalysisUsage::setPreservesCFG</a></div><div class="ttdeci">void setPreservesCFG()</div><div class="ttdoc">This function should be called by the pass, iff they do not:</div><div class="ttdef"><b>Definition:</b> <a href="Pass_8cpp_source.html#l00265">Pass.cpp:265</a></div></div>
<div class="ttc" id="aSupport_2ErrorHandling_8h_html_ace243f5c25697a1107cce46626b3dc94"><div class="ttname"><a href="Support_2ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a></div><div class="ttdeci">#define llvm_unreachable(msg)</div><div class="ttdoc">Marks that the current location is not supposed to be reachable.</div><div class="ttdef"><b>Definition:</b> <a href="Support_2ErrorHandling_8h_source.html#l00143">ErrorHandling.h:143</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a6393a2d4fe7e10b28a0dcc35f881567b"><div class="ttname"><a href="classllvm_1_1Value.html#a6393a2d4fe7e10b28a0dcc35f881567b">llvm::Value::getType</a></div><div class="ttdeci">Type * getType() const</div><div class="ttdoc">All values are typed, get the type of this value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00255">Value.h:255</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a6a66ebb3aa12757479a3c88de77d78f8"><div class="ttname"><a href="classllvm_1_1Instruction.html#a6a66ebb3aa12757479a3c88de77d78f8">llvm::Instruction::getFunction</a></div><div class="ttdeci">const Function * getFunction() const</div><div class="ttdoc">Return the function this instruction belongs to.</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00074">Instruction.cpp:74</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_a3ab5fc45117b450e8bb04e564cb6e5f2"><div class="ttname"><a href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">llvm::Value::replaceAllUsesWith</a></div><div class="ttdeci">void replaceAllUsesWith(Value *V)</div><div class="ttdoc">Change all uses of this to point to a new Value.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00532">Value.cpp:532</a></div></div>
<div class="ttc" id="aclassllvm_1_1ilist__node__impl_html_af719fc783be6589465137d997701a432"><div class="ttname"><a href="classllvm_1_1ilist__node__impl.html#af719fc783be6589465137d997701a432">llvm::ilist_node_impl::getIterator</a></div><div class="ttdeci">self_iterator getIterator()</div><div class="ttdef"><b>Definition:</b> <a href="ilist__node_8h_source.html#l00082">ilist_node.h:82</a></div></div>
<div class="ttc" id="aAArch64SLSHardening_8cpp_html_ad467c4ab9119043f9b7750ab986be61a"><div class="ttname"><a href="AArch64SLSHardening_8cpp.html#ad467c4ab9119043f9b7750ab986be61a">DL</a></div><div class="ttdeci">MachineBasicBlock MachineBasicBlock::iterator DebugLoc DL</div><div class="ttdef"><b>Definition:</b> <a href="AArch64SLSHardening_8cpp_source.html#l00076">AArch64SLSHardening.cpp:76</a></div></div>
<div class="ttc" id="aX86LowerAMXType_8cpp_html_acf41daf3eeda8514648fe10fbd699be7"><div class="ttname"><a href="X86LowerAMXType_8cpp.html#acf41daf3eeda8514648fe10fbd699be7">isIncomingOfPHI</a></div><div class="ttdeci">static bool isIncomingOfPHI(Instruction *I)</div><div class="ttdef"><b>Definition:</b> <a href="X86LowerAMXType_8cpp_source.html#l00507">X86LowerAMXType.cpp:507</a></div></div>
<div class="ttc" id="anamespacellvm_1_1ifs_html_adfe04e1a9cc096fb571e8372debaa67ea00d0b4f2d7dcdaaef835b97cf5d1e0df"><div class="ttname"><a href="namespacellvm_1_1ifs.html#adfe04e1a9cc096fb571e8372debaa67ea00d0b4f2d7dcdaaef835b97cf5d1e0df">llvm::ifs::IFSSymbolType::Func</a></div><div class="ttdeci">@ Func</div></div>
<div class="ttc" id="aclassllvm_1_1LoadInst_html"><div class="ttname"><a href="classllvm_1_1LoadInst.html">llvm::LoadInst</a></div><div class="ttdoc">An instruction for reading from memory.</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00177">Instructions.h:177</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html_a1600c7959045cb6b6a5f5a1d427ec67e"><div class="ttname"><a href="classllvm_1_1User.html#a1600c7959045cb6b6a5f5a1d427ec67e">llvm::User::replaceUsesOfWith</a></div><div class="ttdeci">bool replaceUsesOfWith(Value *From, Value *To)</div><div class="ttdoc">Replace uses of one Value with another.</div><div class="ttdef"><b>Definition:</b> <a href="User_8cpp_source.html#l00021">User.cpp:21</a></div></div>
<div class="ttc" id="aEntryExitInstrumenter_8cpp_html_a3985f1f39349428d17f0d2b81ebc6349"><div class="ttname"><a href="EntryExitInstrumenter_8cpp.html#a3985f1f39349428d17f0d2b81ebc6349">runOnFunction</a></div><div class="ttdeci">static bool runOnFunction(Function &amp;F, bool PostInlining)</div><div class="ttdef"><b>Definition:</b> <a href="EntryExitInstrumenter_8cpp_source.html#l00085">EntryExitInstrumenter.cpp:85</a></div></div>
<div class="ttc" id="alib_2Target_2README_8txt_html_a3a76669632041022e6976766a22bd2b0"><div class="ttname"><a href="lib_2Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a></div><div class="ttdeci">return j(j&lt;&lt; 16)</div></div>
<div class="ttc" id="aX86LowerAMXType_8cpp_html_aea4a4a9addf50f9e92972410a4e3cb17"><div class="ttname"><a href="X86LowerAMXType_8cpp.html#aea4a4a9addf50f9e92972410a4e3cb17">getShape</a></div><div class="ttdeci">static std::pair&lt; Value *, Value * &gt; getShape(IntrinsicInst *II, unsigned OpNo)</div><div class="ttdef"><b>Definition:</b> <a href="X86LowerAMXType_8cpp_source.html#l00117">X86LowerAMXType.cpp:117</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1SendMsg_html_a8594419a4ddfad2c9a79279c490e466d"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1SendMsg.html#a8594419a4ddfad2c9a79279c490e466d">llvm::AMDGPU::SendMsg::Op</a></div><div class="ttdeci">Op</div><div class="ttdef"><b>Definition:</b> <a href="SIDefines_8h_source.html#l00357">SIDefines.h:357</a></div></div>
<div class="ttc" id="anamespacellvm_html_aa0953557ed13c0ed48e740653e07c979"><div class="ttname"><a href="namespacellvm.html#aa0953557ed13c0ed48e740653e07c979">llvm::post_order</a></div><div class="ttdeci">iterator_range&lt; po_iterator&lt; T &gt; &gt; post_order(const T &amp;G)</div><div class="ttdef"><b>Definition:</b> <a href="PostOrderIterator_8h_source.html#l00191">PostOrderIterator.h:191</a></div></div>
<div class="ttc" id="aFunction_8h_html"><div class="ttname"><a href="Function_8h.html">Function.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1TargetLibraryInfo_html"><div class="ttname"><a href="classllvm_1_1TargetLibraryInfo.html">llvm::TargetLibraryInfo</a></div><div class="ttdoc">Provides information about what library functions are available for the current target.</div><div class="ttdef"><b>Definition:</b> <a href="TargetLibraryInfo_8h_source.html#l00234">TargetLibraryInfo.h:234</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_aac0ea55010b7b1a301e65a0baea057aa"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">llvm::SmallVectorImpl::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00614">SmallVector.h:614</a></div></div>
<div class="ttc" id="aclassllvm_1_1IntrinsicInst_html"><div class="ttname"><a href="classllvm_1_1IntrinsicInst.html">llvm::IntrinsicInst</a></div><div class="ttdoc">A wrapper class for inspecting calls to intrinsic functions.</div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00047">IntrinsicInst.h:47</a></div></div>
<div class="ttc" id="aclassllvm_1_1AllocaInst_html_af3bb24b322533dbe8a63c84b18568fe1"><div class="ttname"><a href="classllvm_1_1AllocaInst.html#af3bb24b322533dbe8a63c84b18568fe1">llvm::AllocaInst::setAlignment</a></div><div class="ttdeci">void setAlignment(Align Align)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00129">Instructions.h:129</a></div></div>
<div class="ttc" id="aInstructions_8h_html"><div class="ttname"><a href="Instructions_8h.html">Instructions.h</a></div></div>
<div class="ttc" id="aPostOrderIterator_8h_html"><div class="ttname"><a href="PostOrderIterator_8h.html">PostOrderIterator.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1IRBuilderBase_html_a4ad9fba0470381b8af861befd5a7bc38"><div class="ttname"><a href="classllvm_1_1IRBuilderBase.html#a4ad9fba0470381b8af861befd5a7bc38">llvm::IRBuilderBase::getInt16</a></div><div class="ttdeci">ConstantInt * getInt16(uint16_t C)</div><div class="ttdoc">Get a constant 16-bit value.</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00467">IRBuilder.h:467</a></div></div>
<div class="ttc" id="aclassllvm_1_1CallBase_html_ab2caa29167597390ab2fc3cf30d70389"><div class="ttname"><a href="classllvm_1_1CallBase.html#ab2caa29167597390ab2fc3cf30d70389">llvm::CallBase::getArgOperand</a></div><div class="ttdeci">Value * getArgOperand(unsigned i) const</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l01351">InstrTypes.h:1351</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_a1a7f07aaef6a3bee130bf0e0f0536802"><div class="ttname"><a href="classllvm_1_1Instruction.html#a1a7f07aaef6a3bee130bf0e0f0536802">llvm::Instruction::getParent</a></div><div class="ttdeci">const BasicBlock * getParent() const</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8h_source.html#l00090">Instruction.h:90</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html_a0c8ffe664a36e30d49c84d0aded2fe08"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a0c8ffe664a36e30d49c84d0aded2fe08">llvm::SmallVectorImpl::pop_back_val</a></div><div class="ttdeci">T pop_back_val()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00677">SmallVector.h:677</a></div></div>
<div class="ttc" id="aTargetTransformInfo_8h_html"><div class="ttname"><a href="TargetTransformInfo_8h.html">TargetTransformInfo.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1PHINode_html"><div class="ttname"><a href="classllvm_1_1PHINode.html">llvm::PHINode</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02708">Instructions.h:2708</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallVectorImpl_html"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html">llvm::SmallVectorImpl&lt; Instruction * &gt;</a></div></div>
<div class="ttc" id="anamespacellvm_html_a6b0ac1fa4f05de76413c5e0ca6334035"><div class="ttname"><a href="namespacellvm.html#a6b0ac1fa4f05de76413c5e0ca6334035">llvm::reverse</a></div><div class="ttdeci">auto reverse(ContainerTy &amp;&amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00484">STLExtras.h:484</a></div></div>
<div class="ttc" id="aclassllvm_1_1SmallSetVector_html"><div class="ttname"><a href="classllvm_1_1SmallSetVector.html">llvm::SmallSetVector</a></div><div class="ttdoc">A SetVector that performs no allocations if smaller than a certain size.</div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00300">SetVector.h:300</a></div></div>
<div class="ttc" id="aPassBuilderBindings_8cpp_html_ab76052bb166c65901edb603a3e1f03ab"><div class="ttname"><a href="PassBuilderBindings_8cpp.html#ab76052bb166c65901edb603a3e1f03ab">TM</a></div><div class="ttdeci">const char LLVMTargetMachineRef TM</div><div class="ttdef"><b>Definition:</b> <a href="PassBuilderBindings_8cpp_source.html#l00047">PassBuilderBindings.cpp:47</a></div></div>
<div class="ttc" id="aclassllvm_1_1FunctionPass_html"><div class="ttname"><a href="classllvm_1_1FunctionPass.html">llvm::FunctionPass</a></div><div class="ttdoc">FunctionPass class - This class is used to implement most global optimizations.</div><div class="ttdef"><b>Definition:</b> <a href="Pass_8h_source.html#l00308">Pass.h:308</a></div></div>
<div class="ttc" id="alib_2CodeGen_2README_8txt_html_a09776db24cf586ec9f1e18f3bae14099"><div class="ttname"><a href="lib_2CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a></div><div class="ttdeci">Common register allocation spilling lr str ldr sxth r3 ldr mla r4 can lr mov lr str ldr sxth r3 mla r4 and then merge mul and lr str ldr sxth r3 mla r4 It also increase the likelihood the store may become dead bb27 Successors according to LLVM BB</div><div class="ttdef"><b>Definition:</b> <a href="lib_2CodeGen_2README_8txt_source.html#l00039">README.txt:39</a></div></div>
<div class="ttc" id="aclassllvm_1_1IRBuilderBase_html_a9c1be64c9c1c59250451d02d1a9ee21b"><div class="ttname"><a href="classllvm_1_1IRBuilderBase.html#a9c1be64c9c1c59250451d02d1a9ee21b">llvm::IRBuilderBase::CreateUDiv</a></div><div class="ttdeci">Value * CreateUDiv(Value *LHS, Value *RHS, const Twine &amp;Name=&quot;&quot;, bool isExact=false)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l01293">IRBuilder.h:1293</a></div></div>
<div class="ttc" id="aclassllvm_1_1AnalysisUsage_html_ae5c60fd282ee894c87ea02c3f0fcb6d0"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">llvm::AnalysisUsage::addRequired</a></div><div class="ttdeci">AnalysisUsage &amp; addRequired()</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00075">PassAnalysisSupport.h:75</a></div></div>
<div class="ttc" id="anamespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key_html_a1958a762261549463a280bac3274d6d5"><div class="ttname"><a href="namespacellvm_1_1AMDGPU_1_1HSAMD_1_1Kernel_1_1Key.html#a1958a762261549463a280bac3274d6d5">llvm::AMDGPU::HSAMD::Kernel::Key::Args</a></div><div class="ttdeci">constexpr char Args[]</div><div class="ttdoc">Key for Kernel::Metadata::mArgs.</div><div class="ttdef"><b>Definition:</b> <a href="AMDGPUMetadata_8h_source.html#l00394">AMDGPUMetadata.h:394</a></div></div>
<div class="ttc" id="aclassllvm_1_1AllocaInst_html"><div class="ttname"><a href="classllvm_1_1AllocaInst.html">llvm::AllocaInst</a></div><div class="ttdoc">an instruction to allocate memory on the stack</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00058">Instructions.h:58</a></div></div>
<div class="ttc" id="aclassllvm_1_1User_html_abe1de1520a21f77ac57cc210bf0fb0b4"><div class="ttname"><a href="classllvm_1_1User.html#abe1de1520a21f77ac57cc210bf0fb0b4">llvm::User::getOperand</a></div><div class="ttdeci">Value * getOperand(unsigned i) const</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00169">User.h:169</a></div></div>
<div class="ttc" id="anamespacellvm_1_1pdb_html_a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2"><div class="ttname"><a href="namespacellvm_1_1pdb.html#a33e853ec74d48b1340d1d4bae772d30bae1e4c8c9ccd9fc39c391da4bcd093fb2">llvm::pdb::PDB_SymType::Block</a></div><div class="ttdeci">@ Block</div></div>
<div class="ttc" id="aInitializePasses_8h_html"><div class="ttname"><a href="InitializePasses_8h.html">InitializePasses.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html"><div class="ttname"><a href="classllvm_1_1Value.html">llvm::Value</a></div><div class="ttdoc">LLVM Value Representation.</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00074">Value.h:74</a></div></div>
<div class="ttc" id="aclassllvm_1_1VectorType_html_a8c90e6c50e795b17466482a04947690e"><div class="ttname"><a href="classllvm_1_1VectorType.html#a8c90e6c50e795b17466482a04947690e">llvm::VectorType::get</a></div><div class="ttdeci">static VectorType * get(Type *ElementType, ElementCount EC)</div><div class="ttdoc">This static method is the primary way to construct an VectorType.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00670">Type.cpp:670</a></div></div>
<div class="ttc" id="aclassllvm_1_1Value_html_ab4e0512c7e1c7adaa56677e3155685f1"><div class="ttname"><a href="classllvm_1_1Value.html#ab4e0512c7e1c7adaa56677e3155685f1">llvm::Value::users</a></div><div class="ttdeci">iterator_range&lt; user_iterator &gt; users()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00421">Value.h:421</a></div></div>
<div class="ttc" id="aclassllvm_1_1Type_html_ab549082d9dfb91ec9a8dc06601d54855"><div class="ttname"><a href="classllvm_1_1Type.html#ab549082d9dfb91ec9a8dc06601d54855">llvm::Type::isX86_AMXTy</a></div><div class="ttdeci">bool isX86_AMXTy() const</div><div class="ttdoc">Return true if this is X86 AMX.</div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00204">Type.h:204</a></div></div>
<div class="ttc" id="aSetVector_8h_html"><div class="ttname"><a href="SetVector_8h.html">SetVector.h</a></div></div>
<div class="ttc" id="aclassllvm_1_1Instruction_html_af67d1f3a518964d80a109bb3d9d5cf1e"><div class="ttname"><a href="classllvm_1_1Instruction.html#af67d1f3a518964d80a109bb3d9d5cf1e">llvm::Instruction::moveBefore</a></div><div class="ttdeci">void moveBefore(Instruction *MovePos)</div><div class="ttdoc">Unlink this instruction from its current basic block and insert it into the basic block that MovePos ...</div><div class="ttdef"><b>Definition:</b> <a href="IR_2Instruction_8cpp_source.html#l00108">Instruction.cpp:108</a></div></div>
<div class="ttc" id="aclassllvm_1_1Use_html"><div class="ttname"><a href="classllvm_1_1Use.html">llvm::Use</a></div><div class="ttdoc">A Use represents the edge between a Value definition and its users.</div><div class="ttdef"><b>Definition:</b> <a href="Use_8h_source.html#l00043">Use.h:43</a></div></div>
<div class="ttc" id="aSmallSet_8h_html"><div class="ttname"><a href="SmallSet_8h.html">SmallSet.h</a></div></div>
<div class="ttc" id="anamespacellvm_1_1Intrinsic_html_a80add6b3b1cdaec560907995127adc16"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a80add6b3b1cdaec560907995127adc16">llvm::Intrinsic::ID</a></div><div class="ttdeci">unsigned ID</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00039">TargetTransformInfo.h:39</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 7 2023 10:22:56 for LLVM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
